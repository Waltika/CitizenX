var dCe=Object.defineProperty;var JH=nt=>{throw TypeError(nt)};var hCe=(nt,Xe,jt)=>Xe in nt?dCe(nt,Xe,{enumerable:!0,configurable:!0,writable:!0,value:jt}):nt[Xe]=jt;var u=(nt,Xe,jt)=>hCe(nt,typeof Xe!="symbol"?Xe+"":Xe,jt),jA=(nt,Xe,jt)=>Xe.has(nt)||JH("Cannot "+jt);var ae=(nt,Xe,jt)=>(jA(nt,Xe,"read from private field"),jt?jt.call(nt):Xe.get(nt)),Ye=(nt,Xe,jt)=>Xe.has(nt)?JH("Cannot add the same private member more than once"):Xe instanceof WeakSet?Xe.add(nt):Xe.set(nt,jt),_t=(nt,Xe,jt,no)=>(jA(nt,Xe,"write to private field"),no?no.call(nt,jt):Xe.set(nt,jt),jt),Ie=(nt,Xe,jt)=>(jA(nt,Xe,"access private method"),jt);var ro=(nt,Xe,jt,no)=>({set _(E0){_t(nt,Xe,E0,jt)},get _(){return ae(nt,Xe,no)}});(function(){"use strict";var Fi,Aj,jh,Hh,Hc,u0,qh,d0,zi,Wh,mn,h0,Vi,Gh,ua,f0,V4,ct,YH,XH,ZH,eq,tq,H4,HA,qA,q4,rq,W4,Cj,zA,VA,KA,Zs,Ij,kj,_j,Tj,Pj,Dj,$j,Nj,da,G4,WA,Mj,Oj,Rj,Lj,Jh,qc,p0,g0,Iu,ku,Xh,Zh,_u,K4,nq,Bj,Uj,wn,m0,GA,w0,Fj,zj,Vj,Kj,jj,Hj,qj,Wj,Gj,Qj,Jj,Yj,Xj,Zj,zn,iq,b0,v0,eH,tH,rH,nH,iH,sH,oH,aH,cH,lH,uH,dH,hH,fH,pH,gH,yH,mH,wH,bH,ef,Q4,vH,EH,SH,xH,AH,CH,IH,kH,_H,TH,PH,Vn,J4,Y4,X4,DH,tf,Z4,$H,NH,MH,OH,RH,LH,BH,UH,FH,zH,VH,KH,jH,y0,QA,HH,qH,WH,GH;var nt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var jt={exports:{}},no={},E0={exports:{}},He={};/**
* @license React
* react.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var nf=Symbol.for("react.element"),oq=Symbol.for("react.portal"),aq=Symbol.for("react.fragment"),cq=Symbol.for("react.strict_mode"),lq=Symbol.for("react.profiler"),uq=Symbol.for("react.provider"),dq=Symbol.for("react.context"),hq=Symbol.for("react.forward_ref"),fq=Symbol.for("react.suspense"),pq=Symbol.for("react.memo"),gq=Symbol.for("react.lazy"),JA=Symbol.iterator;function yq(r){return r===null||typeof r!="object"?null:(r=JA&&r[JA]||r["@@iterator"],typeof r=="function"?r:null)}var YA={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},XA=Object.assign,ZA={};function Pu(r,e,t){this.props=r,this.context=e,this.refs=ZA,this.updater=t||YA}Pu.prototype.isReactComponent={},Pu.prototype.setState=function(r,e){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,e,"setState")},Pu.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function eC(){}eC.prototype=Pu.prototype;function e5(r,e,t){this.props=r,this.context=e,this.refs=ZA,this.updater=t||YA}var t5=e5.prototype=new eC;t5.constructor=e5,XA(t5,Pu.prototype),t5.isPureReactComponent=!0;var tC=Array.isArray,rC=Object.prototype.hasOwnProperty,r5={current:null},nC={key:!0,ref:!0,__self:!0,__source:!0};function iC(r,e,t){var n,i={},s=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)rC.call(e,n)&&!nC.hasOwnProperty(n)&&(i[n]=e[n]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(r&&r.defaultProps)for(n in a=r.defaultProps,a)i[n]===void 0&&(i[n]=a[n]);return{$$typeof:nf,type:r,key:s,ref:o,props:i,_owner:r5.current}}function mq(r,e){return{$$typeof:nf,type:r.type,key:e,ref:r.ref,props:r.props,_owner:r._owner}}function n5(r){return typeof r=="object"&&r!==null&&r.$$typeof===nf}function wq(r){var e={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(t){return e[t]})}var sC=/\/+/g;function i5(r,e){return typeof r=="object"&&r!==null&&r.key!=null?wq(""+r.key):e.toString(36)}function S0(r,e,t,n,i){var s=typeof r;(s==="undefined"||s==="boolean")&&(r=null);var o=!1;if(r===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(r.$$typeof){case nf:case oq:o=!0}}if(o)return o=r,i=i(o),r=n===""?"."+i5(o,0):n,tC(i)?(t="",r!=null&&(t=r.replace(sC,"$&/")+"/"),S0(i,e,t,"",function(l){return l})):i!=null&&(n5(i)&&(i=mq(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(sC,"$&/")+"/")+r)),e.push(i)),1;if(o=0,n=n===""?".":n+":",tC(r))for(var a=0;a<r.length;a++){s=r[a];var c=n+i5(s,a);o+=S0(s,e,t,c,i)}else if(c=yq(r),typeof c=="function")for(r=c.call(r),a=0;!(s=r.next()).done;)s=s.value,c=n+i5(s,a++),o+=S0(s,e,t,c,i);else if(s==="object")throw e=String(r),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function x0(r,e,t){if(r==null)return r;var n=[],i=0;return S0(r,n,"","",function(s){return e.call(t,s,i++)}),n}function bq(r){if(r._status===-1){var e=r._result;e=e(),e.then(function(t){(r._status===0||r._status===-1)&&(r._status=1,r._result=t)},function(t){(r._status===0||r._status===-1)&&(r._status=2,r._result=t)}),r._status===-1&&(r._status=0,r._result=e)}if(r._status===1)return r._result.default;throw r._result}var sn={current:null},A0={transition:null},vq={ReactCurrentDispatcher:sn,ReactCurrentBatchConfig:A0,ReactCurrentOwner:r5};function oC(){throw Error("act(...) is not supported in production builds of React.")}He.Children={map:x0,forEach:function(r,e,t){x0(r,function(){e.apply(this,arguments)},t)},count:function(r){var e=0;return x0(r,function(){e++}),e},toArray:function(r){return x0(r,function(e){return e})||[]},only:function(r){if(!n5(r))throw Error("React.Children.only expected to receive a single React element child.");return r}},He.Component=Pu,He.Fragment=aq,He.Profiler=lq,He.PureComponent=e5,He.StrictMode=cq,He.Suspense=fq,He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vq,He.act=oC,He.cloneElement=function(r,e,t){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var n=XA({},r.props),i=r.key,s=r.ref,o=r._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=r5.current),e.key!==void 0&&(i=""+e.key),r.type&&r.type.defaultProps)var a=r.type.defaultProps;for(c in e)rC.call(e,c)&&!nC.hasOwnProperty(c)&&(n[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)n.children=t;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];n.children=a}return{$$typeof:nf,type:r.type,key:i,ref:s,props:n,_owner:o}},He.createContext=function(r){return r={$$typeof:dq,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:uq,_context:r},r.Consumer=r},He.createElement=iC,He.createFactory=function(r){var e=iC.bind(null,r);return e.type=r,e},He.createRef=function(){return{current:null}},He.forwardRef=function(r){return{$$typeof:hq,render:r}},He.isValidElement=n5,He.lazy=function(r){return{$$typeof:gq,_payload:{_status:-1,_result:r},_init:bq}},He.memo=function(r,e){return{$$typeof:pq,type:r,compare:e===void 0?null:e}},He.startTransition=function(r){var e=A0.transition;A0.transition={};try{r()}finally{A0.transition=e}},He.unstable_act=oC,He.useCallback=function(r,e){return sn.current.useCallback(r,e)},He.useContext=function(r){return sn.current.useContext(r)},He.useDebugValue=function(){},He.useDeferredValue=function(r){return sn.current.useDeferredValue(r)},He.useEffect=function(r,e){return sn.current.useEffect(r,e)},He.useId=function(){return sn.current.useId()},He.useImperativeHandle=function(r,e,t){return sn.current.useImperativeHandle(r,e,t)},He.useInsertionEffect=function(r,e){return sn.current.useInsertionEffect(r,e)},He.useLayoutEffect=function(r,e){return sn.current.useLayoutEffect(r,e)},He.useMemo=function(r,e){return sn.current.useMemo(r,e)},He.useReducer=function(r,e,t){return sn.current.useReducer(r,e,t)},He.useRef=function(r){return sn.current.useRef(r)},He.useState=function(r){return sn.current.useState(r)},He.useSyncExternalStore=function(r,e,t){return sn.current.useSyncExternalStore(r,e,t)},He.useTransition=function(){return sn.current.useTransition()},He.version="18.3.1",E0.exports=He;var Be=E0.exports;const Eq=Xe(Be);/**
* @license React
* react-jsx-runtime.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var Sq=Be,xq=Symbol.for("react.element"),Aq=Symbol.for("react.fragment"),Cq=Object.prototype.hasOwnProperty,Iq=Sq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kq={key:!0,ref:!0,__self:!0,__source:!0};function aC(r,e,t){var n,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)Cq.call(e,n)&&!kq.hasOwnProperty(n)&&(i[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)i[n]===void 0&&(i[n]=e[n]);return{$$typeof:xq,type:r,key:s,ref:o,props:i,_owner:Iq.current}}no.Fragment=Aq,no.jsx=aC,no.jsxs=aC,jt.exports=no;var ne=jt.exports,cC={exports:{}},Kn={},lC={exports:{}},uC={};/**
* @license React
* scheduler.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/(function(r){function e(O,U){var W=O.length;O.push(U);e:for(;0<W;){var J=W-1>>>1,H=O[J];if(0<i(H,U))O[J]=U,O[W]=H,W=J;else break e}}function t(O){return O.length===0?null:O[0]}function n(O){if(O.length===0)return null;var U=O[0],W=O.pop();if(W!==U){O[0]=W;e:for(var J=0,H=O.length,se=H>>>1;J<se;){var we=2*(J+1)-1,ce=O[we],de=we+1,Ne=O[de];if(0>i(ce,W))de<H&&0>i(Ne,ce)?(O[J]=Ne,O[de]=W,J=de):(O[J]=ce,O[we]=W,J=we);else if(de<H&&0>i(Ne,W))O[J]=Ne,O[de]=W,J=de;else break e}}return U}function i(O,U){var W=O.sortIndex-U.sortIndex;return W!==0?W:O.id-U.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();r.unstable_now=function(){return o.now()-a}}var c=[],l=[],d=1,h=null,p=3,b=!1,f=!1,g=!1,v=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(O){for(var U=t(l);U!==null;){if(U.callback===null)n(l);else if(U.startTime<=O)n(l),U.sortIndex=U.expirationTime,e(c,U);else break;U=t(l)}}function E(O){if(g=!1,m(O),!f)if(t(c)!==null)f=!0,Q(A);else{var U=t(l);U!==null&&K(E,U.startTime-O)}}function A(O,U){f=!1,g&&(g=!1,y(I),I=-1),b=!0;var W=p;try{for(m(U),h=t(c);h!==null&&(!(h.expirationTime>U)||O&&!z());){var J=h.callback;if(typeof J=="function"){h.callback=null,p=h.priorityLevel;var H=J(h.expirationTime<=U);U=r.unstable_now(),typeof H=="function"?h.callback=H:h===t(c)&&n(c),m(U)}else n(c);h=t(c)}if(h!==null)var se=!0;else{var we=t(l);we!==null&&K(E,we.startTime-U),se=!1}return se}finally{h=null,p=W,b=!1}}var k=!1,x=null,I=-1,T=5,L=-1;function z(){return!(r.unstable_now()-L<T)}function B(){if(x!==null){var O=r.unstable_now();L=O;var U=!0;try{U=x(!0,O)}finally{U?G():(k=!1,x=null)}}else k=!1}var G;if(typeof w=="function")G=function(){w(B)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,q=j.port2;j.port1.onmessage=B,G=function(){q.postMessage(null)}}else G=function(){v(B,0)};function Q(O){x=O,k||(k=!0,G())}function K(O,U){I=v(function(){O(r.unstable_now())},U)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(O){O.callback=null},r.unstable_continueExecution=function(){f||b||(f=!0,Q(A))},r.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<O?Math.floor(1e3/O):5},r.unstable_getCurrentPriorityLevel=function(){return p},r.unstable_getFirstCallbackNode=function(){return t(c)},r.unstable_next=function(O){switch(p){case 1:case 2:case 3:var U=3;break;default:U=p}var W=p;p=U;try{return O()}finally{p=W}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(O,U){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var W=p;p=O;try{return U()}finally{p=W}},r.unstable_scheduleCallback=function(O,U,W){var J=r.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?J+W:J):W=J,O){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=W+H,O={id:d++,callback:U,priorityLevel:O,startTime:W,expirationTime:H,sortIndex:-1},W>J?(O.sortIndex=W,e(l,O),t(c)===null&&O===t(l)&&(g?(y(I),I=-1):g=!0,K(E,W-J))):(O.sortIndex=H,e(c,O),f||b||(f=!0,Q(A))),O},r.unstable_shouldYield=z,r.unstable_wrapCallback=function(O){var U=p;return function(){var W=p;p=U;try{return O.apply(this,arguments)}finally{p=W}}}})(uC),lC.exports=uC;var _q=lC.exports;/**
* @license React
* react-dom.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var Tq=Be,jn=_q;function ee(r){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+r,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+r+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var dC=new Set,sf={};function Jc(r,e){Du(r,e),Du(r+"Capture",e)}function Du(r,e){for(sf[r]=e,r=0;r<e.length;r++)dC.add(e[r])}var io=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),s5=Object.prototype.hasOwnProperty,Pq=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,hC={},fC={};function Dq(r){return s5.call(fC,r)?!0:s5.call(hC,r)?!1:Pq.test(r)?fC[r]=!0:(hC[r]=!0,!1)}function $q(r,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function Nq(r,e,t,n){if(e===null||typeof e>"u"||$q(r,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function on(r,e,t,n,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=r,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var mr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){mr[r]=new on(r,0,!1,r,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var e=r[0];mr[e]=new on(e,1,!1,r[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(r){mr[r]=new on(r,2,!1,r.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){mr[r]=new on(r,2,!1,r,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){mr[r]=new on(r,3,!1,r.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(r){mr[r]=new on(r,3,!0,r,null,!1,!1)}),["capture","download"].forEach(function(r){mr[r]=new on(r,4,!1,r,null,!1,!1)}),["cols","rows","size","span"].forEach(function(r){mr[r]=new on(r,6,!1,r,null,!1,!1)}),["rowSpan","start"].forEach(function(r){mr[r]=new on(r,5,!1,r.toLowerCase(),null,!1,!1)});var o5=/[\-:]([a-z])/g;function a5(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var e=r.replace(o5,a5);mr[e]=new on(e,1,!1,r,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var e=r.replace(o5,a5);mr[e]=new on(e,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(r){var e=r.replace(o5,a5);mr[e]=new on(e,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(r){mr[r]=new on(r,1,!1,r.toLowerCase(),null,!1,!1)}),mr.xlinkHref=new on("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(r){mr[r]=new on(r,1,!1,r.toLowerCase(),null,!0,!0)});function c5(r,e,t,n){var i=mr.hasOwnProperty(e)?mr[e]:null;(i!==null?i.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Nq(e,t,i,n)&&(t=null),n||i===null?Dq(e)&&(t===null?r.removeAttribute(e):r.setAttribute(e,""+t)):i.mustUseProperty?r[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,n=i.attributeNamespace,t===null?r.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,n?r.setAttributeNS(n,e,t):r.setAttribute(e,t))))}var so=Tq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,C0=Symbol.for("react.element"),$u=Symbol.for("react.portal"),Nu=Symbol.for("react.fragment"),l5=Symbol.for("react.strict_mode"),u5=Symbol.for("react.profiler"),pC=Symbol.for("react.provider"),gC=Symbol.for("react.context"),d5=Symbol.for("react.forward_ref"),h5=Symbol.for("react.suspense"),f5=Symbol.for("react.suspense_list"),p5=Symbol.for("react.memo"),pa=Symbol.for("react.lazy"),yC=Symbol.for("react.offscreen"),mC=Symbol.iterator;function of(r){return r===null||typeof r!="object"?null:(r=mC&&r[mC]||r["@@iterator"],typeof r=="function"?r:null)}var Lt=Object.assign,g5;function af(r){if(g5===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);g5=e&&e[1]||""}return`
`+g5+r}var y5=!1;function m5(r,e){if(!r||y5)return"";y5=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var n=l}Reflect.construct(r,[],e)}else{try{e.call()}catch(l){n=l}r.call(e.prototype)}else{try{throw Error()}catch(l){n=l}r()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),s=n.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var c=`
`+i[o].replace(" at new "," at ");return r.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",r.displayName)),c}while(1<=o&&0<=a);break}}}finally{y5=!1,Error.prepareStackTrace=t}return(r=r?r.displayName||r.name:"")?af(r):""}function Mq(r){switch(r.tag){case 5:return af(r.type);case 16:return af("Lazy");case 13:return af("Suspense");case 19:return af("SuspenseList");case 0:case 2:case 15:return r=m5(r.type,!1),r;case 11:return r=m5(r.type.render,!1),r;case 1:return r=m5(r.type,!0),r;default:return""}}function w5(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Nu:return"Fragment";case $u:return"Portal";case u5:return"Profiler";case l5:return"StrictMode";case h5:return"Suspense";case f5:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case gC:return(r.displayName||"Context")+".Consumer";case pC:return(r._context.displayName||"Context")+".Provider";case d5:var e=r.render;return r=r.displayName,r||(r=e.displayName||e.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case p5:return e=r.displayName||null,e!==null?e:w5(r.type)||"Memo";case pa:e=r._payload,r=r._init;try{return w5(r(e))}catch{}}return null}function Oq(r){var e=r.type;switch(r.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=e.render,r=r.displayName||r.name||"",e.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return w5(e);case 8:return e===l5?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ga(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function wC(r){var e=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Rq(r){var e=wC(r)?"checked":"value",t=Object.getOwnPropertyDescriptor(r.constructor.prototype,e),n=""+r[e];if(!r.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(r,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){n=""+o,s.call(this,o)}}),Object.defineProperty(r,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){r._valueTracker=null,delete r[e]}}}}function I0(r){r._valueTracker||(r._valueTracker=Rq(r))}function bC(r){if(!r)return!1;var e=r._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return r&&(n=wC(r)?r.checked?"true":"false":r.value),r=n,r!==t?(e.setValue(r),!0):!1}function k0(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function b5(r,e){var t=e.checked;return Lt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??r._wrapperState.initialChecked})}function vC(r,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=ga(e.value!=null?e.value:t),r._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function EC(r,e){e=e.checked,e!=null&&c5(r,"checked",e,!1)}function v5(r,e){EC(r,e);var t=ga(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&r.value===""||r.value!=t)&&(r.value=""+t):r.value!==""+t&&(r.value=""+t);else if(n==="submit"||n==="reset"){r.removeAttribute("value");return}e.hasOwnProperty("value")?E5(r,e.type,t):e.hasOwnProperty("defaultValue")&&E5(r,e.type,ga(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(r.defaultChecked=!!e.defaultChecked)}function SC(r,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+r._wrapperState.initialValue,t||e===r.value||(r.value=e),r.defaultValue=e}t=r.name,t!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,t!==""&&(r.name=t)}function E5(r,e,t){(e!=="number"||k0(r.ownerDocument)!==r)&&(t==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+t&&(r.defaultValue=""+t))}var cf=Array.isArray;function Mu(r,e,t,n){if(r=r.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<r.length;t++)i=e.hasOwnProperty("$"+r[t].value),r[t].selected!==i&&(r[t].selected=i),i&&n&&(r[t].defaultSelected=!0)}else{for(t=""+ga(t),e=null,i=0;i<r.length;i++){if(r[i].value===t){r[i].selected=!0,n&&(r[i].defaultSelected=!0);return}e!==null||r[i].disabled||(e=r[i])}e!==null&&(e.selected=!0)}}function S5(r,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ee(91));return Lt({},e,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function xC(r,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(ee(92));if(cf(t)){if(1<t.length)throw Error(ee(93));t=t[0]}e=t}e==null&&(e=""),t=e}r._wrapperState={initialValue:ga(t)}}function AC(r,e){var t=ga(e.value),n=ga(e.defaultValue);t!=null&&(t=""+t,t!==r.value&&(r.value=t),e.defaultValue==null&&r.defaultValue!==t&&(r.defaultValue=t)),n!=null&&(r.defaultValue=""+n)}function CC(r){var e=r.textContent;e===r._wrapperState.initialValue&&e!==""&&e!==null&&(r.value=e)}function IC(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function x5(r,e){return r==null||r==="http://www.w3.org/1999/xhtml"?IC(e):r==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var _0,kC=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return r(e,t,n,i)})}:r}(function(r,e){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=e;else{for(_0=_0||document.createElement("div"),_0.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=_0.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;e.firstChild;)r.appendChild(e.firstChild)}});function lf(r,e){if(e){var t=r.firstChild;if(t&&t===r.lastChild&&t.nodeType===3){t.nodeValue=e;return}}r.textContent=e}var uf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Lq=["Webkit","ms","Moz","O"];Object.keys(uf).forEach(function(r){Lq.forEach(function(e){e=e+r.charAt(0).toUpperCase()+r.substring(1),uf[e]=uf[r]})});function _C(r,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||uf.hasOwnProperty(r)&&uf[r]?(""+e).trim():e+"px"}function TC(r,e){r=r.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,i=_C(t,e[t],n);t==="float"&&(t="cssFloat"),n?r.setProperty(t,i):r[t]=i}}var Bq=Lt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function A5(r,e){if(e){if(Bq[r]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ee(137,r));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ee(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ee(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ee(62))}}function C5(r,e){if(r.indexOf("-")===-1)return typeof e.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var I5=null;function k5(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var _5=null,Ou=null,Ru=null;function PC(r){if(r=$f(r)){if(typeof _5!="function")throw Error(ee(280));var e=r.stateNode;e&&(e=Y0(e),_5(r.stateNode,r.type,e))}}function DC(r){Ou?Ru?Ru.push(r):Ru=[r]:Ou=r}function $C(){if(Ou){var r=Ou,e=Ru;if(Ru=Ou=null,PC(r),e)for(r=0;r<e.length;r++)PC(e[r])}}function NC(r,e){return r(e)}function MC(){}var T5=!1;function OC(r,e,t){if(T5)return r(e,t);T5=!0;try{return NC(r,e,t)}finally{T5=!1,(Ou!==null||Ru!==null)&&(MC(),$C())}}function df(r,e){var t=r.stateNode;if(t===null)return null;var n=Y0(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(r=r.type,n=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!n;break e;default:r=!1}if(r)return null;if(t&&typeof t!="function")throw Error(ee(231,e,typeof t));return t}var P5=!1;if(io)try{var hf={};Object.defineProperty(hf,"passive",{get:function(){P5=!0}}),window.addEventListener("test",hf,hf),window.removeEventListener("test",hf,hf)}catch{P5=!1}function Uq(r,e,t,n,i,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(d){this.onError(d)}}var ff=!1,T0=null,P0=!1,D5=null,Fq={onError:function(r){ff=!0,T0=r}};function zq(r,e,t,n,i,s,o,a,c){ff=!1,T0=null,Uq.apply(Fq,arguments)}function Vq(r,e,t,n,i,s,o,a,c){if(zq.apply(this,arguments),ff){if(ff){var l=T0;ff=!1,T0=null}else throw Error(ee(198));P0||(P0=!0,D5=l)}}function Yc(r){var e=r,t=r;if(r.alternate)for(;e.return;)e=e.return;else{r=e;do e=r,e.flags&4098&&(t=e.return),r=e.return;while(r)}return e.tag===3?t:null}function RC(r){if(r.tag===13){var e=r.memoizedState;if(e===null&&(r=r.alternate,r!==null&&(e=r.memoizedState)),e!==null)return e.dehydrated}return null}function LC(r){if(Yc(r)!==r)throw Error(ee(188))}function Kq(r){var e=r.alternate;if(!e){if(e=Yc(r),e===null)throw Error(ee(188));return e!==r?null:r}for(var t=r,n=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(n=i.return,n!==null){t=n;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return LC(i),r;if(s===n)return LC(i),e;s=s.sibling}throw Error(ee(188))}if(t.return!==n.return)t=i,n=s;else{for(var o=!1,a=i.child;a;){if(a===t){o=!0,t=i,n=s;break}if(a===n){o=!0,n=i,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,n=i;break}if(a===n){o=!0,n=s,t=i;break}a=a.sibling}if(!o)throw Error(ee(189))}}if(t.alternate!==n)throw Error(ee(190))}if(t.tag!==3)throw Error(ee(188));return t.stateNode.current===t?r:e}function BC(r){return r=Kq(r),r!==null?UC(r):null}function UC(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var e=UC(r);if(e!==null)return e;r=r.sibling}return null}var FC=jn.unstable_scheduleCallback,zC=jn.unstable_cancelCallback,jq=jn.unstable_shouldYield,Hq=jn.unstable_requestPaint,Gt=jn.unstable_now,qq=jn.unstable_getCurrentPriorityLevel,$5=jn.unstable_ImmediatePriority,VC=jn.unstable_UserBlockingPriority,D0=jn.unstable_NormalPriority,Wq=jn.unstable_LowPriority,KC=jn.unstable_IdlePriority,$0=null,Es=null;function Gq(r){if(Es&&typeof Es.onCommitFiberRoot=="function")try{Es.onCommitFiberRoot($0,r,void 0,(r.current.flags&128)===128)}catch{}}var ji=Math.clz32?Math.clz32:Yq,Qq=Math.log,Jq=Math.LN2;function Yq(r){return r>>>=0,r===0?32:31-(Qq(r)/Jq|0)|0}var N0=64,M0=4194304;function pf(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function O0(r,e){var t=r.pendingLanes;if(t===0)return 0;var n=0,i=r.suspendedLanes,s=r.pingedLanes,o=t&268435455;if(o!==0){var a=o&~i;a!==0?n=pf(a):(s&=o,s!==0&&(n=pf(s)))}else o=t&~i,o!==0?n=pf(o):s!==0&&(n=pf(s));if(n===0)return 0;if(e!==0&&e!==n&&!(e&i)&&(i=n&-n,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(n&4&&(n|=t&16),e=r.entangledLanes,e!==0)for(r=r.entanglements,e&=n;0<e;)t=31-ji(e),i=1<<t,n|=r[t],e&=~i;return n}function Xq(r,e){switch(r){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Zq(r,e){for(var t=r.suspendedLanes,n=r.pingedLanes,i=r.expirationTimes,s=r.pendingLanes;0<s;){var o=31-ji(s),a=1<<o,c=i[o];c===-1?(!(a&t)||a&n)&&(i[o]=Xq(a,e)):c<=e&&(r.expiredLanes|=a),s&=~a}}function N5(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function jC(){var r=N0;return N0<<=1,!(N0&4194240)&&(N0=64),r}function M5(r){for(var e=[],t=0;31>t;t++)e.push(r);return e}function gf(r,e,t){r.pendingLanes|=e,e!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,e=31-ji(e),r[e]=t}function eW(r,e){var t=r.pendingLanes&~e;r.pendingLanes=e,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=e,r.mutableReadLanes&=e,r.entangledLanes&=e,e=r.entanglements;var n=r.eventTimes;for(r=r.expirationTimes;0<t;){var i=31-ji(t),s=1<<i;e[i]=0,n[i]=-1,r[i]=-1,t&=~s}}function O5(r,e){var t=r.entangledLanes|=e;for(r=r.entanglements;t;){var n=31-ji(t),i=1<<n;i&e|r[n]&e&&(r[n]|=e),t&=~i}}var ft=0;function HC(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var qC,R5,WC,GC,QC,L5=!1,R0=[],ya=null,ma=null,wa=null,yf=new Map,mf=new Map,ba=[],tW="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function JC(r,e){switch(r){case"focusin":case"focusout":ya=null;break;case"dragenter":case"dragleave":ma=null;break;case"mouseover":case"mouseout":wa=null;break;case"pointerover":case"pointerout":yf.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":mf.delete(e.pointerId)}}function wf(r,e,t,n,i,s){return r===null||r.nativeEvent!==s?(r={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:s,targetContainers:[i]},e!==null&&(e=$f(e),e!==null&&R5(e)),r):(r.eventSystemFlags|=n,e=r.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),r)}function rW(r,e,t,n,i){switch(e){case"focusin":return ya=wf(ya,r,e,t,n,i),!0;case"dragenter":return ma=wf(ma,r,e,t,n,i),!0;case"mouseover":return wa=wf(wa,r,e,t,n,i),!0;case"pointerover":var s=i.pointerId;return yf.set(s,wf(yf.get(s)||null,r,e,t,n,i)),!0;case"gotpointercapture":return s=i.pointerId,mf.set(s,wf(mf.get(s)||null,r,e,t,n,i)),!0}return!1}function YC(r){var e=Xc(r.target);if(e!==null){var t=Yc(e);if(t!==null){if(e=t.tag,e===13){if(e=RC(t),e!==null){r.blockedOn=e,QC(r.priority,function(){WC(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){r.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}r.blockedOn=null}function L0(r){if(r.blockedOn!==null)return!1;for(var e=r.targetContainers;0<e.length;){var t=U5(r.domEventName,r.eventSystemFlags,e[0],r.nativeEvent);if(t===null){t=r.nativeEvent;var n=new t.constructor(t.type,t);I5=n,t.target.dispatchEvent(n),I5=null}else return e=$f(t),e!==null&&R5(e),r.blockedOn=t,!1;e.shift()}return!0}function XC(r,e,t){L0(r)&&t.delete(e)}function nW(){L5=!1,ya!==null&&L0(ya)&&(ya=null),ma!==null&&L0(ma)&&(ma=null),wa!==null&&L0(wa)&&(wa=null),yf.forEach(XC),mf.forEach(XC)}function bf(r,e){r.blockedOn===e&&(r.blockedOn=null,L5||(L5=!0,jn.unstable_scheduleCallback(jn.unstable_NormalPriority,nW)))}function vf(r){function e(i){return bf(i,r)}if(0<R0.length){bf(R0[0],r);for(var t=1;t<R0.length;t++){var n=R0[t];n.blockedOn===r&&(n.blockedOn=null)}}for(ya!==null&&bf(ya,r),ma!==null&&bf(ma,r),wa!==null&&bf(wa,r),yf.forEach(e),mf.forEach(e),t=0;t<ba.length;t++)n=ba[t],n.blockedOn===r&&(n.blockedOn=null);for(;0<ba.length&&(t=ba[0],t.blockedOn===null);)YC(t),t.blockedOn===null&&ba.shift()}var Lu=so.ReactCurrentBatchConfig,B0=!0;function iW(r,e,t,n){var i=ft,s=Lu.transition;Lu.transition=null;try{ft=1,B5(r,e,t,n)}finally{ft=i,Lu.transition=s}}function sW(r,e,t,n){var i=ft,s=Lu.transition;Lu.transition=null;try{ft=4,B5(r,e,t,n)}finally{ft=i,Lu.transition=s}}function B5(r,e,t,n){if(B0){var i=U5(r,e,t,n);if(i===null)r8(r,e,n,U0,t),JC(r,n);else if(rW(i,r,e,t,n))n.stopPropagation();else if(JC(r,n),e&4&&-1<tW.indexOf(r)){for(;i!==null;){var s=$f(i);if(s!==null&&qC(s),s=U5(r,e,t,n),s===null&&r8(r,e,n,U0,t),s===i)break;i=s}i!==null&&n.stopPropagation()}else r8(r,e,n,null,t)}}var U0=null;function U5(r,e,t,n){if(U0=null,r=k5(n),r=Xc(r),r!==null)if(e=Yc(r),e===null)r=null;else if(t=e.tag,t===13){if(r=RC(e),r!==null)return r;r=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;r=null}else e!==r&&(r=null);return U0=r,null}function ZC(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qq()){case $5:return 1;case VC:return 4;case D0:case Wq:return 16;case KC:return 536870912;default:return 16}default:return 16}}var va=null,F5=null,F0=null;function eI(){if(F0)return F0;var r,e=F5,t=e.length,n,i="value"in va?va.value:va.textContent,s=i.length;for(r=0;r<t&&e[r]===i[r];r++);var o=t-r;for(n=1;n<=o&&e[t-n]===i[s-n];n++);return F0=i.slice(r,1<n?1-n:void 0)}function z0(r){var e=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&e===13&&(r=13)):r=e,r===10&&(r=13),32<=r||r===13?r:0}function V0(){return!0}function tI(){return!1}function Hn(r){function e(t,n,i,s,o){this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in r)r.hasOwnProperty(a)&&(t=r[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?V0:tI,this.isPropagationStopped=tI,this}return Lt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=V0)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=V0)},persist:function(){},isPersistent:V0}),e}var Bu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},z5=Hn(Bu),Ef=Lt({},Bu,{view:0,detail:0}),oW=Hn(Ef),V5,K5,Sf,K0=Lt({},Ef,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:H5,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Sf&&(Sf&&r.type==="mousemove"?(V5=r.screenX-Sf.screenX,K5=r.screenY-Sf.screenY):K5=V5=0,Sf=r),V5)},movementY:function(r){return"movementY"in r?r.movementY:K5}}),rI=Hn(K0),aW=Lt({},K0,{dataTransfer:0}),cW=Hn(aW),lW=Lt({},Ef,{relatedTarget:0}),j5=Hn(lW),uW=Lt({},Bu,{animationName:0,elapsedTime:0,pseudoElement:0}),dW=Hn(uW),hW=Lt({},Bu,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),fW=Hn(hW),pW=Lt({},Bu,{data:0}),nI=Hn(pW),gW={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yW={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mW={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wW(r){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(r):(r=mW[r])?!!e[r]:!1}function H5(){return wW}var bW=Lt({},Ef,{key:function(r){if(r.key){var e=gW[r.key]||r.key;if(e!=="Unidentified")return e}return r.type==="keypress"?(r=z0(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?yW[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:H5,charCode:function(r){return r.type==="keypress"?z0(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?z0(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),vW=Hn(bW),EW=Lt({},K0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),iI=Hn(EW),SW=Lt({},Ef,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:H5}),xW=Hn(SW),AW=Lt({},Bu,{propertyName:0,elapsedTime:0,pseudoElement:0}),CW=Hn(AW),IW=Lt({},K0,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),kW=Hn(IW),_W=[9,13,27,32],q5=io&&"CompositionEvent"in window,xf=null;io&&"documentMode"in document&&(xf=document.documentMode);var TW=io&&"TextEvent"in window&&!xf,sI=io&&(!q5||xf&&8<xf&&11>=xf),oI=" ",aI=!1;function cI(r,e){switch(r){case"keyup":return _W.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function lI(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Uu=!1;function PW(r,e){switch(r){case"compositionend":return lI(e);case"keypress":return e.which!==32?null:(aI=!0,oI);case"textInput":return r=e.data,r===oI&&aI?null:r;default:return null}}function DW(r,e){if(Uu)return r==="compositionend"||!q5&&cI(r,e)?(r=eI(),F0=F5=va=null,Uu=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return sI&&e.locale!=="ko"?null:e.data;default:return null}}var $W={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function uI(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e==="input"?!!$W[r.type]:e==="textarea"}function dI(r,e,t,n){DC(n),e=G0(e,"onChange"),0<e.length&&(t=new z5("onChange","change",null,t,n),r.push({event:t,listeners:e}))}var Af=null,Cf=null;function NW(r){TI(r,0)}function j0(r){var e=ju(r);if(bC(e))return r}function MW(r,e){if(r==="change")return e}var hI=!1;if(io){var W5;if(io){var G5="oninput"in document;if(!G5){var fI=document.createElement("div");fI.setAttribute("oninput","return;"),G5=typeof fI.oninput=="function"}W5=G5}else W5=!1;hI=W5&&(!document.documentMode||9<document.documentMode)}function pI(){Af&&(Af.detachEvent("onpropertychange",gI),Cf=Af=null)}function gI(r){if(r.propertyName==="value"&&j0(Cf)){var e=[];dI(e,Cf,r,k5(r)),OC(NW,e)}}function OW(r,e,t){r==="focusin"?(pI(),Af=e,Cf=t,Af.attachEvent("onpropertychange",gI)):r==="focusout"&&pI()}function RW(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return j0(Cf)}function LW(r,e){if(r==="click")return j0(e)}function BW(r,e){if(r==="input"||r==="change")return j0(e)}function UW(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var Hi=typeof Object.is=="function"?Object.is:UW;function If(r,e){if(Hi(r,e))return!0;if(typeof r!="object"||r===null||typeof e!="object"||e===null)return!1;var t=Object.keys(r),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var i=t[n];if(!s5.call(e,i)||!Hi(r[i],e[i]))return!1}return!0}function yI(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function mI(r,e){var t=yI(r);r=0;for(var n;t;){if(t.nodeType===3){if(n=r+t.textContent.length,r<=e&&n>=e)return{node:t,offset:e-r};r=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=yI(t)}}function wI(r,e){return r&&e?r===e?!0:r&&r.nodeType===3?!1:e&&e.nodeType===3?wI(r,e.parentNode):"contains"in r?r.contains(e):r.compareDocumentPosition?!!(r.compareDocumentPosition(e)&16):!1:!1}function bI(){for(var r=window,e=k0();e instanceof r.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)r=e.contentWindow;else break;e=k0(r.document)}return e}function Q5(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e&&(e==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||e==="textarea"||r.contentEditable==="true")}function FW(r){var e=bI(),t=r.focusedElem,n=r.selectionRange;if(e!==t&&t&&t.ownerDocument&&wI(t.ownerDocument.documentElement,t)){if(n!==null&&Q5(t)){if(e=n.start,r=n.end,r===void 0&&(r=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(r,t.value.length);else if(r=(e=t.ownerDocument||document)&&e.defaultView||window,r.getSelection){r=r.getSelection();var i=t.textContent.length,s=Math.min(n.start,i);n=n.end===void 0?s:Math.min(n.end,i),!r.extend&&s>n&&(i=n,n=s,s=i),i=mI(t,s);var o=mI(t,n);i&&o&&(r.rangeCount!==1||r.anchorNode!==i.node||r.anchorOffset!==i.offset||r.focusNode!==o.node||r.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),r.removeAllRanges(),s>n?(r.addRange(e),r.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),r.addRange(e)))}}for(e=[],r=t;r=r.parentNode;)r.nodeType===1&&e.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)r=e[t],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var zW=io&&"documentMode"in document&&11>=document.documentMode,Fu=null,J5=null,kf=null,Y5=!1;function vI(r,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Y5||Fu==null||Fu!==k0(n)||(n=Fu,"selectionStart"in n&&Q5(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),kf&&If(kf,n)||(kf=n,n=G0(J5,"onSelect"),0<n.length&&(e=new z5("onSelect","select",null,e,t),r.push({event:e,listeners:n}),e.target=Fu)))}function H0(r,e){var t={};return t[r.toLowerCase()]=e.toLowerCase(),t["Webkit"+r]="webkit"+e,t["Moz"+r]="moz"+e,t}var zu={animationend:H0("Animation","AnimationEnd"),animationiteration:H0("Animation","AnimationIteration"),animationstart:H0("Animation","AnimationStart"),transitionend:H0("Transition","TransitionEnd")},X5={},EI={};io&&(EI=document.createElement("div").style,"AnimationEvent"in window||(delete zu.animationend.animation,delete zu.animationiteration.animation,delete zu.animationstart.animation),"TransitionEvent"in window||delete zu.transitionend.transition);function q0(r){if(X5[r])return X5[r];if(!zu[r])return r;var e=zu[r],t;for(t in e)if(e.hasOwnProperty(t)&&t in EI)return X5[r]=e[t];return r}var SI=q0("animationend"),xI=q0("animationiteration"),AI=q0("animationstart"),CI=q0("transitionend"),II=new Map,kI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ea(r,e){II.set(r,e),Jc(e,[r])}for(var Z5=0;Z5<kI.length;Z5++){var e8=kI[Z5],VW=e8.toLowerCase(),KW=e8[0].toUpperCase()+e8.slice(1);Ea(VW,"on"+KW)}Ea(SI,"onAnimationEnd"),Ea(xI,"onAnimationIteration"),Ea(AI,"onAnimationStart"),Ea("dblclick","onDoubleClick"),Ea("focusin","onFocus"),Ea("focusout","onBlur"),Ea(CI,"onTransitionEnd"),Du("onMouseEnter",["mouseout","mouseover"]),Du("onMouseLeave",["mouseout","mouseover"]),Du("onPointerEnter",["pointerout","pointerover"]),Du("onPointerLeave",["pointerout","pointerover"]),Jc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Jc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Jc("onBeforeInput",["compositionend","keypress","textInput","paste"]),Jc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Jc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Jc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _f="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jW=new Set("cancel close invalid load scroll toggle".split(" ").concat(_f));function _I(r,e,t){var n=r.type||"unknown-event";r.currentTarget=t,Vq(n,e,void 0,r),r.currentTarget=null}function TI(r,e){e=(e&4)!==0;for(var t=0;t<r.length;t++){var n=r[t],i=n.event;n=n.listeners;e:{var s=void 0;if(e)for(var o=n.length-1;0<=o;o--){var a=n[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&i.isPropagationStopped())break e;_I(i,a,l),s=c}else for(o=0;o<n.length;o++){if(a=n[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&i.isPropagationStopped())break e;_I(i,a,l),s=c}}}if(P0)throw r=D5,P0=!1,D5=null,r}function Tt(r,e){var t=e[c8];t===void 0&&(t=e[c8]=new Set);var n=r+"__bubble";t.has(n)||(PI(e,r,2,!1),t.add(n))}function t8(r,e,t){var n=0;e&&(n|=4),PI(t,r,n,e)}var W0="_reactListening"+Math.random().toString(36).slice(2);function Tf(r){if(!r[W0]){r[W0]=!0,dC.forEach(function(t){t!=="selectionchange"&&(jW.has(t)||t8(t,!1,r),t8(t,!0,r))});var e=r.nodeType===9?r:r.ownerDocument;e===null||e[W0]||(e[W0]=!0,t8("selectionchange",!1,e))}}function PI(r,e,t,n){switch(ZC(e)){case 1:var i=iW;break;case 4:i=sW;break;default:i=B5}t=i.bind(null,e,t,r),i=void 0,!P5||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),n?i!==void 0?r.addEventListener(e,t,{capture:!0,passive:i}):r.addEventListener(e,t,!0):i!==void 0?r.addEventListener(e,t,{passive:i}):r.addEventListener(e,t,!1)}function r8(r,e,t,n,i){var s=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var a=n.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=n.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Xc(a),o===null)return;if(c=o.tag,c===5||c===6){n=s=o;continue e}a=a.parentNode}}n=n.return}OC(function(){var l=s,d=k5(t),h=[];e:{var p=II.get(r);if(p!==void 0){var b=z5,f=r;switch(r){case"keypress":if(z0(t)===0)break e;case"keydown":case"keyup":b=vW;break;case"focusin":f="focus",b=j5;break;case"focusout":f="blur",b=j5;break;case"beforeblur":case"afterblur":b=j5;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":b=rI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":b=cW;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":b=xW;break;case SI:case xI:case AI:b=dW;break;case CI:b=CW;break;case"scroll":b=oW;break;case"wheel":b=kW;break;case"copy":case"cut":case"paste":b=fW;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":b=iI}var g=(e&4)!==0,v=!g&&r==="scroll",y=g?p!==null?p+"Capture":null:p;g=[];for(var w=l,m;w!==null;){m=w;var E=m.stateNode;if(m.tag===5&&E!==null&&(m=E,y!==null&&(E=df(w,y),E!=null&&g.push(Pf(w,E,m)))),v)break;w=w.return}0<g.length&&(p=new b(p,f,null,t,d),h.push({event:p,listeners:g}))}}if(!(e&7)){e:{if(p=r==="mouseover"||r==="pointerover",b=r==="mouseout"||r==="pointerout",p&&t!==I5&&(f=t.relatedTarget||t.fromElement)&&(Xc(f)||f[oo]))break e;if((b||p)&&(p=d.window===d?d:(p=d.ownerDocument)?p.defaultView||p.parentWindow:window,b?(f=t.relatedTarget||t.toElement,b=l,f=f?Xc(f):null,f!==null&&(v=Yc(f),f!==v||f.tag!==5&&f.tag!==6)&&(f=null)):(b=null,f=l),b!==f)){if(g=rI,E="onMouseLeave",y="onMouseEnter",w="mouse",(r==="pointerout"||r==="pointerover")&&(g=iI,E="onPointerLeave",y="onPointerEnter",w="pointer"),v=b==null?p:ju(b),m=f==null?p:ju(f),p=new g(E,w+"leave",b,t,d),p.target=v,p.relatedTarget=m,E=null,Xc(d)===l&&(g=new g(y,w+"enter",f,t,d),g.target=m,g.relatedTarget=v,E=g),v=E,b&&f)t:{for(g=b,y=f,w=0,m=g;m;m=Vu(m))w++;for(m=0,E=y;E;E=Vu(E))m++;for(;0<w-m;)g=Vu(g),w--;for(;0<m-w;)y=Vu(y),m--;for(;w--;){if(g===y||y!==null&&g===y.alternate)break t;g=Vu(g),y=Vu(y)}g=null}else g=null;b!==null&&DI(h,p,b,g,!1),f!==null&&v!==null&&DI(h,v,f,g,!0)}}e:{if(p=l?ju(l):window,b=p.nodeName&&p.nodeName.toLowerCase(),b==="select"||b==="input"&&p.type==="file")var A=MW;else if(uI(p))if(hI)A=BW;else{A=RW;var k=OW}else(b=p.nodeName)&&b.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(A=LW);if(A&&(A=A(r,l))){dI(h,A,t,d);break e}k&&k(r,p,l),r==="focusout"&&(k=p._wrapperState)&&k.controlled&&p.type==="number"&&E5(p,"number",p.value)}switch(k=l?ju(l):window,r){case"focusin":(uI(k)||k.contentEditable==="true")&&(Fu=k,J5=l,kf=null);break;case"focusout":kf=J5=Fu=null;break;case"mousedown":Y5=!0;break;case"contextmenu":case"mouseup":case"dragend":Y5=!1,vI(h,t,d);break;case"selectionchange":if(zW)break;case"keydown":case"keyup":vI(h,t,d)}var x;if(q5)e:{switch(r){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else Uu?cI(r,t)&&(I="onCompositionEnd"):r==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(sI&&t.locale!=="ko"&&(Uu||I!=="onCompositionStart"?I==="onCompositionEnd"&&Uu&&(x=eI()):(va=d,F5="value"in va?va.value:va.textContent,Uu=!0)),k=G0(l,I),0<k.length&&(I=new nI(I,r,null,t,d),h.push({event:I,listeners:k}),x?I.data=x:(x=lI(t),x!==null&&(I.data=x)))),(x=TW?PW(r,t):DW(r,t))&&(l=G0(l,"onBeforeInput"),0<l.length&&(d=new nI("onBeforeInput","beforeinput",null,t,d),h.push({event:d,listeners:l}),d.data=x))}TI(h,e)})}function Pf(r,e,t){return{instance:r,listener:e,currentTarget:t}}function G0(r,e){for(var t=e+"Capture",n=[];r!==null;){var i=r,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=df(r,t),s!=null&&n.unshift(Pf(r,s,i)),s=df(r,e),s!=null&&n.push(Pf(r,s,i))),r=r.return}return n}function Vu(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function DI(r,e,t,n,i){for(var s=e._reactName,o=[];t!==null&&t!==n;){var a=t,c=a.alternate,l=a.stateNode;if(c!==null&&c===n)break;a.tag===5&&l!==null&&(a=l,i?(c=df(t,s),c!=null&&o.unshift(Pf(t,c,a))):i||(c=df(t,s),c!=null&&o.push(Pf(t,c,a)))),t=t.return}o.length!==0&&r.push({event:e,listeners:o})}var HW=/\r\n?/g,qW=/\u0000|\uFFFD/g;function $I(r){return(typeof r=="string"?r:""+r).replace(HW,`
`).replace(qW,"")}function Q0(r,e,t){if(e=$I(e),$I(r)!==e&&t)throw Error(ee(425))}function J0(){}var n8=null,i8=null;function s8(r,e){return r==="textarea"||r==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var o8=typeof setTimeout=="function"?setTimeout:void 0,WW=typeof clearTimeout=="function"?clearTimeout:void 0,NI=typeof Promise=="function"?Promise:void 0,GW=typeof queueMicrotask=="function"?queueMicrotask:typeof NI<"u"?function(r){return NI.resolve(null).then(r).catch(QW)}:o8;function QW(r){setTimeout(function(){throw r})}function a8(r,e){var t=e,n=0;do{var i=t.nextSibling;if(r.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(n===0){r.removeChild(i),vf(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=i}while(t);vf(e)}function Sa(r){for(;r!=null;r=r.nextSibling){var e=r.nodeType;if(e===1||e===3)break;if(e===8){if(e=r.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return r}function MI(r){r=r.previousSibling;for(var e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return r;e--}else t==="/$"&&e++}r=r.previousSibling}return null}var Ku=Math.random().toString(36).slice(2),Ss="__reactFiber$"+Ku,Df="__reactProps$"+Ku,oo="__reactContainer$"+Ku,c8="__reactEvents$"+Ku,JW="__reactListeners$"+Ku,YW="__reactHandles$"+Ku;function Xc(r){var e=r[Ss];if(e)return e;for(var t=r.parentNode;t;){if(e=t[oo]||t[Ss]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(r=MI(r);r!==null;){if(t=r[Ss])return t;r=MI(r)}return e}r=t,t=r.parentNode}return null}function $f(r){return r=r[Ss]||r[oo],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function ju(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(ee(33))}function Y0(r){return r[Df]||null}var l8=[],Hu=-1;function xa(r){return{current:r}}function Pt(r){0>Hu||(r.current=l8[Hu],l8[Hu]=null,Hu--)}function Et(r,e){Hu++,l8[Hu]=r.current,r.current=e}var Aa={},Mr=xa(Aa),vn=xa(!1),Zc=Aa;function qu(r,e){var t=r.type.contextTypes;if(!t)return Aa;var n=r.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=e,r.__reactInternalMemoizedMaskedChildContext=i),i}function En(r){return r=r.childContextTypes,r!=null}function X0(){Pt(vn),Pt(Mr)}function OI(r,e,t){if(Mr.current!==Aa)throw Error(ee(168));Et(Mr,e),Et(vn,t)}function RI(r,e,t){var n=r.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var i in n)if(!(i in e))throw Error(ee(108,Oq(r)||"Unknown",i));return Lt({},t,n)}function Z0(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Aa,Zc=Mr.current,Et(Mr,r),Et(vn,vn.current),!0}function LI(r,e,t){var n=r.stateNode;if(!n)throw Error(ee(169));t?(r=RI(r,e,Zc),n.__reactInternalMemoizedMergedChildContext=r,Pt(vn),Pt(Mr),Et(Mr,r)):Pt(vn),Et(vn,t)}var ao=null,eg=!1,u8=!1;function BI(r){ao===null?ao=[r]:ao.push(r)}function XW(r){eg=!0,BI(r)}function Ca(){if(!u8&&ao!==null){u8=!0;var r=0,e=ft;try{var t=ao;for(ft=1;r<t.length;r++){var n=t[r];do n=n(!0);while(n!==null)}ao=null,eg=!1}catch(i){throw ao!==null&&(ao=ao.slice(r+1)),FC($5,Ca),i}finally{ft=e,u8=!1}}return null}var Wu=[],Gu=0,tg=null,rg=0,gi=[],yi=0,el=null,co=1,lo="";function tl(r,e){Wu[Gu++]=rg,Wu[Gu++]=tg,tg=r,rg=e}function UI(r,e,t){gi[yi++]=co,gi[yi++]=lo,gi[yi++]=el,el=r;var n=co;r=lo;var i=32-ji(n)-1;n&=~(1<<i),t+=1;var s=32-ji(e)+i;if(30<s){var o=i-i%5;s=(n&(1<<o)-1).toString(32),n>>=o,i-=o,co=1<<32-ji(e)+i|t<<i|n,lo=s+r}else co=1<<s|t<<i|n,lo=r}function d8(r){r.return!==null&&(tl(r,1),UI(r,1,0))}function h8(r){for(;r===tg;)tg=Wu[--Gu],Wu[Gu]=null,rg=Wu[--Gu],Wu[Gu]=null;for(;r===el;)el=gi[--yi],gi[yi]=null,lo=gi[--yi],gi[yi]=null,co=gi[--yi],gi[yi]=null}var qn=null,Wn=null,Mt=!1,qi=null;function FI(r,e){var t=vi(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=r,e=r.deletions,e===null?(r.deletions=[t],r.flags|=16):e.push(t)}function zI(r,e){switch(r.tag){case 5:var t=r.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(r.stateNode=e,qn=r,Wn=Sa(e.firstChild),!0):!1;case 6:return e=r.pendingProps===""||e.nodeType!==3?null:e,e!==null?(r.stateNode=e,qn=r,Wn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=el!==null?{id:co,overflow:lo}:null,r.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=vi(18,null,null,0),t.stateNode=e,t.return=r,r.child=t,qn=r,Wn=null,!0):!1;default:return!1}}function f8(r){return(r.mode&1)!==0&&(r.flags&128)===0}function p8(r){if(Mt){var e=Wn;if(e){var t=e;if(!zI(r,e)){if(f8(r))throw Error(ee(418));e=Sa(t.nextSibling);var n=qn;e&&zI(r,e)?FI(n,t):(r.flags=r.flags&-4097|2,Mt=!1,qn=r)}}else{if(f8(r))throw Error(ee(418));r.flags=r.flags&-4097|2,Mt=!1,qn=r}}}function VI(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;qn=r}function ng(r){if(r!==qn)return!1;if(!Mt)return VI(r),Mt=!0,!1;var e;if((e=r.tag!==3)&&!(e=r.tag!==5)&&(e=r.type,e=e!=="head"&&e!=="body"&&!s8(r.type,r.memoizedProps)),e&&(e=Wn)){if(f8(r))throw KI(),Error(ee(418));for(;e;)FI(r,e),e=Sa(e.nextSibling)}if(VI(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(ee(317));e:{for(r=r.nextSibling,e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="/$"){if(e===0){Wn=Sa(r.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}r=r.nextSibling}Wn=null}}else Wn=qn?Sa(r.stateNode.nextSibling):null;return!0}function KI(){for(var r=Wn;r;)r=Sa(r.nextSibling)}function Qu(){Wn=qn=null,Mt=!1}function g8(r){qi===null?qi=[r]:qi.push(r)}var ZW=so.ReactCurrentBatchConfig;function Nf(r,e,t){if(r=t.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(ee(309));var n=t.stateNode}if(!n)throw Error(ee(147,r));var i=n,s=""+r;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof r!="string")throw Error(ee(284));if(!t._owner)throw Error(ee(290,r))}return r}function ig(r,e){throw r=Object.prototype.toString.call(e),Error(ee(31,r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r))}function jI(r){var e=r._init;return e(r._payload)}function HI(r){function e(y,w){if(r){var m=y.deletions;m===null?(y.deletions=[w],y.flags|=16):m.push(w)}}function t(y,w){if(!r)return null;for(;w!==null;)e(y,w),w=w.sibling;return null}function n(y,w){for(y=new Map;w!==null;)w.key!==null?y.set(w.key,w):y.set(w.index,w),w=w.sibling;return y}function i(y,w){return y=Na(y,w),y.index=0,y.sibling=null,y}function s(y,w,m){return y.index=m,r?(m=y.alternate,m!==null?(m=m.index,m<w?(y.flags|=2,w):m):(y.flags|=2,w)):(y.flags|=1048576,w)}function o(y){return r&&y.alternate===null&&(y.flags|=2),y}function a(y,w,m,E){return w===null||w.tag!==6?(w=o6(m,y.mode,E),w.return=y,w):(w=i(w,m),w.return=y,w)}function c(y,w,m,E){var A=m.type;return A===Nu?d(y,w,m.props.children,E,m.key):w!==null&&(w.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===pa&&jI(A)===w.type)?(E=i(w,m.props),E.ref=Nf(y,w,m),E.return=y,E):(E=_g(m.type,m.key,m.props,null,y.mode,E),E.ref=Nf(y,w,m),E.return=y,E)}function l(y,w,m,E){return w===null||w.tag!==4||w.stateNode.containerInfo!==m.containerInfo||w.stateNode.implementation!==m.implementation?(w=a6(m,y.mode,E),w.return=y,w):(w=i(w,m.children||[]),w.return=y,w)}function d(y,w,m,E,A){return w===null||w.tag!==7?(w=ll(m,y.mode,E,A),w.return=y,w):(w=i(w,m),w.return=y,w)}function h(y,w,m){if(typeof w=="string"&&w!==""||typeof w=="number")return w=o6(""+w,y.mode,m),w.return=y,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case C0:return m=_g(w.type,w.key,w.props,null,y.mode,m),m.ref=Nf(y,null,w),m.return=y,m;case $u:return w=a6(w,y.mode,m),w.return=y,w;case pa:var E=w._init;return h(y,E(w._payload),m)}if(cf(w)||of(w))return w=ll(w,y.mode,m,null),w.return=y,w;ig(y,w)}return null}function p(y,w,m,E){var A=w!==null?w.key:null;if(typeof m=="string"&&m!==""||typeof m=="number")return A!==null?null:a(y,w,""+m,E);if(typeof m=="object"&&m!==null){switch(m.$$typeof){case C0:return m.key===A?c(y,w,m,E):null;case $u:return m.key===A?l(y,w,m,E):null;case pa:return A=m._init,p(y,w,A(m._payload),E)}if(cf(m)||of(m))return A!==null?null:d(y,w,m,E,null);ig(y,m)}return null}function b(y,w,m,E,A){if(typeof E=="string"&&E!==""||typeof E=="number")return y=y.get(m)||null,a(w,y,""+E,A);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case C0:return y=y.get(E.key===null?m:E.key)||null,c(w,y,E,A);case $u:return y=y.get(E.key===null?m:E.key)||null,l(w,y,E,A);case pa:var k=E._init;return b(y,w,m,k(E._payload),A)}if(cf(E)||of(E))return y=y.get(m)||null,d(w,y,E,A,null);ig(w,E)}return null}function f(y,w,m,E){for(var A=null,k=null,x=w,I=w=0,T=null;x!==null&&I<m.length;I++){x.index>I?(T=x,x=null):T=x.sibling;var L=p(y,x,m[I],E);if(L===null){x===null&&(x=T);break}r&&x&&L.alternate===null&&e(y,x),w=s(L,w,I),k===null?A=L:k.sibling=L,k=L,x=T}if(I===m.length)return t(y,x),Mt&&tl(y,I),A;if(x===null){for(;I<m.length;I++)x=h(y,m[I],E),x!==null&&(w=s(x,w,I),k===null?A=x:k.sibling=x,k=x);return Mt&&tl(y,I),A}for(x=n(y,x);I<m.length;I++)T=b(x,y,I,m[I],E),T!==null&&(r&&T.alternate!==null&&x.delete(T.key===null?I:T.key),w=s(T,w,I),k===null?A=T:k.sibling=T,k=T);return r&&x.forEach(function(z){return e(y,z)}),Mt&&tl(y,I),A}function g(y,w,m,E){var A=of(m);if(typeof A!="function")throw Error(ee(150));if(m=A.call(m),m==null)throw Error(ee(151));for(var k=A=null,x=w,I=w=0,T=null,L=m.next();x!==null&&!L.done;I++,L=m.next()){x.index>I?(T=x,x=null):T=x.sibling;var z=p(y,x,L.value,E);if(z===null){x===null&&(x=T);break}r&&x&&z.alternate===null&&e(y,x),w=s(z,w,I),k===null?A=z:k.sibling=z,k=z,x=T}if(L.done)return t(y,x),Mt&&tl(y,I),A;if(x===null){for(;!L.done;I++,L=m.next())L=h(y,L.value,E),L!==null&&(w=s(L,w,I),k===null?A=L:k.sibling=L,k=L);return Mt&&tl(y,I),A}for(x=n(y,x);!L.done;I++,L=m.next())L=b(x,y,I,L.value,E),L!==null&&(r&&L.alternate!==null&&x.delete(L.key===null?I:L.key),w=s(L,w,I),k===null?A=L:k.sibling=L,k=L);return r&&x.forEach(function(B){return e(y,B)}),Mt&&tl(y,I),A}function v(y,w,m,E){if(typeof m=="object"&&m!==null&&m.type===Nu&&m.key===null&&(m=m.props.children),typeof m=="object"&&m!==null){switch(m.$$typeof){case C0:e:{for(var A=m.key,k=w;k!==null;){if(k.key===A){if(A=m.type,A===Nu){if(k.tag===7){t(y,k.sibling),w=i(k,m.props.children),w.return=y,y=w;break e}}else if(k.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===pa&&jI(A)===k.type){t(y,k.sibling),w=i(k,m.props),w.ref=Nf(y,k,m),w.return=y,y=w;break e}t(y,k);break}else e(y,k);k=k.sibling}m.type===Nu?(w=ll(m.props.children,y.mode,E,m.key),w.return=y,y=w):(E=_g(m.type,m.key,m.props,null,y.mode,E),E.ref=Nf(y,w,m),E.return=y,y=E)}return o(y);case $u:e:{for(k=m.key;w!==null;){if(w.key===k)if(w.tag===4&&w.stateNode.containerInfo===m.containerInfo&&w.stateNode.implementation===m.implementation){t(y,w.sibling),w=i(w,m.children||[]),w.return=y,y=w;break e}else{t(y,w);break}else e(y,w);w=w.sibling}w=a6(m,y.mode,E),w.return=y,y=w}return o(y);case pa:return k=m._init,v(y,w,k(m._payload),E)}if(cf(m))return f(y,w,m,E);if(of(m))return g(y,w,m,E);ig(y,m)}return typeof m=="string"&&m!==""||typeof m=="number"?(m=""+m,w!==null&&w.tag===6?(t(y,w.sibling),w=i(w,m),w.return=y,y=w):(t(y,w),w=o6(m,y.mode,E),w.return=y,y=w),o(y)):t(y,w)}return v}var Ju=HI(!0),qI=HI(!1),sg=xa(null),og=null,Yu=null,y8=null;function m8(){y8=Yu=og=null}function w8(r){var e=sg.current;Pt(sg),r._currentValue=e}function b8(r,e,t){for(;r!==null;){var n=r.alternate;if((r.childLanes&e)!==e?(r.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),r===t)break;r=r.return}}function Xu(r,e){og=r,y8=Yu=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&e&&(Sn=!0),r.firstContext=null)}function mi(r){var e=r._currentValue;if(y8!==r)if(r={context:r,memoizedValue:e,next:null},Yu===null){if(og===null)throw Error(ee(308));Yu=r,og.dependencies={lanes:0,firstContext:r}}else Yu=Yu.next=r;return e}var rl=null;function v8(r){rl===null?rl=[r]:rl.push(r)}function WI(r,e,t,n){var i=e.interleaved;return i===null?(t.next=t,v8(e)):(t.next=i.next,i.next=t),e.interleaved=t,uo(r,n)}function uo(r,e){r.lanes|=e;var t=r.alternate;for(t!==null&&(t.lanes|=e),t=r,r=r.return;r!==null;)r.childLanes|=e,t=r.alternate,t!==null&&(t.childLanes|=e),t=r,r=r.return;return t.tag===3?t.stateNode:null}var Ia=!1;function E8(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function GI(r,e){r=r.updateQueue,e.updateQueue===r&&(e.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function ho(r,e){return{eventTime:r,lane:e,tag:0,payload:null,callback:null,next:null}}function ka(r,e,t){var n=r.updateQueue;if(n===null)return null;if(n=n.shared,rt&2){var i=n.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),n.pending=e,uo(r,t)}return i=n.interleaved,i===null?(e.next=e,v8(n)):(e.next=i.next,i.next=e),n.interleaved=e,uo(r,t)}function ag(r,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,O5(r,t)}}function QI(r,e){var t=r.updateQueue,n=r.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:n.shared,effects:n.effects},r.updateQueue=t;return}r=t.lastBaseUpdate,r===null?t.firstBaseUpdate=e:r.next=e,t.lastBaseUpdate=e}function cg(r,e,t,n){var i=r.updateQueue;Ia=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var d=r.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=l:a.next=l,d.lastBaseUpdate=c))}if(s!==null){var h=i.baseState;o=0,d=l=c=null,a=s;do{var p=a.lane,b=a.eventTime;if((n&p)===p){d!==null&&(d=d.next={eventTime:b,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=r,g=a;switch(p=e,b=t,g.tag){case 1:if(f=g.payload,typeof f=="function"){h=f.call(b,h,p);break e}h=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=g.payload,p=typeof f=="function"?f.call(b,h,p):f,p==null)break e;h=Lt({},h,p);break e;case 2:Ia=!0}}a.callback!==null&&a.lane!==0&&(r.flags|=64,p=i.effects,p===null?i.effects=[a]:p.push(a))}else b={eventTime:b,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(l=d=b,c=h):d=d.next=b,o|=p;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;p=a,a=p.next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}while(!0);if(d===null&&(c=h),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=d,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);sl|=o,r.lanes=o,r.memoizedState=h}}function JI(r,e,t){if(r=e.effects,e.effects=null,r!==null)for(e=0;e<r.length;e++){var n=r[e],i=n.callback;if(i!==null){if(n.callback=null,n=t,typeof i!="function")throw Error(ee(191,i));i.call(n)}}}var Mf={},xs=xa(Mf),Of=xa(Mf),Rf=xa(Mf);function nl(r){if(r===Mf)throw Error(ee(174));return r}function S8(r,e){switch(Et(Rf,e),Et(Of,r),Et(xs,Mf),r=e.nodeType,r){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:x5(null,"");break;default:r=r===8?e.parentNode:e,e=r.namespaceURI||null,r=r.tagName,e=x5(e,r)}Pt(xs),Et(xs,e)}function Zu(){Pt(xs),Pt(Of),Pt(Rf)}function YI(r){nl(Rf.current);var e=nl(xs.current),t=x5(e,r.type);e!==t&&(Et(Of,r),Et(xs,t))}function x8(r){Of.current===r&&(Pt(xs),Pt(Of))}var Bt=xa(0);function lg(r){for(var e=r;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var A8=[];function C8(){for(var r=0;r<A8.length;r++)A8[r]._workInProgressVersionPrimary=null;A8.length=0}var ug=so.ReactCurrentDispatcher,I8=so.ReactCurrentBatchConfig,il=0,Ut=null,ir=null,lr=null,dg=!1,Lf=!1,Bf=0,eG=0;function Or(){throw Error(ee(321))}function k8(r,e){if(e===null)return!1;for(var t=0;t<e.length&&t<r.length;t++)if(!Hi(r[t],e[t]))return!1;return!0}function _8(r,e,t,n,i,s){if(il=s,Ut=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ug.current=r===null||r.memoizedState===null?iG:sG,r=t(n,i),Lf){s=0;do{if(Lf=!1,Bf=0,25<=s)throw Error(ee(301));s+=1,lr=ir=null,e.updateQueue=null,ug.current=oG,r=t(n,i)}while(Lf)}if(ug.current=pg,e=ir!==null&&ir.next!==null,il=0,lr=ir=Ut=null,dg=!1,e)throw Error(ee(300));return r}function T8(){var r=Bf!==0;return Bf=0,r}function As(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return lr===null?Ut.memoizedState=lr=r:lr=lr.next=r,lr}function wi(){if(ir===null){var r=Ut.alternate;r=r!==null?r.memoizedState:null}else r=ir.next;var e=lr===null?Ut.memoizedState:lr.next;if(e!==null)lr=e,ir=r;else{if(r===null)throw Error(ee(310));ir=r,r={memoizedState:ir.memoizedState,baseState:ir.baseState,baseQueue:ir.baseQueue,queue:ir.queue,next:null},lr===null?Ut.memoizedState=lr=r:lr=lr.next=r}return lr}function Uf(r,e){return typeof e=="function"?e(r):e}function P8(r){var e=wi(),t=e.queue;if(t===null)throw Error(ee(311));t.lastRenderedReducer=r;var n=ir,i=n.baseQueue,s=t.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}n.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,n=n.baseState;var a=o=null,c=null,l=s;do{var d=l.lane;if((il&d)===d)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:r(n,l.action);else{var h={lane:d,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=h,o=n):c=c.next=h,Ut.lanes|=d,sl|=d}l=l.next}while(l!==null&&l!==s);c===null?o=n:c.next=a,Hi(n,e.memoizedState)||(Sn=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=c,t.lastRenderedState=n}if(r=t.interleaved,r!==null){i=r;do s=i.lane,Ut.lanes|=s,sl|=s,i=i.next;while(i!==r)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function D8(r){var e=wi(),t=e.queue;if(t===null)throw Error(ee(311));t.lastRenderedReducer=r;var n=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do s=r(s,o.action),o=o.next;while(o!==i);Hi(s,e.memoizedState)||(Sn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,n]}function XI(){}function ZI(r,e){var t=Ut,n=wi(),i=e(),s=!Hi(n.memoizedState,i);if(s&&(n.memoizedState=i,Sn=!0),n=n.queue,$8(rk.bind(null,t,n,r),[r]),n.getSnapshot!==e||s||lr!==null&&lr.memoizedState.tag&1){if(t.flags|=2048,Ff(9,tk.bind(null,t,n,i,e),void 0,null),ur===null)throw Error(ee(349));il&30||ek(t,e,i)}return i}function ek(r,e,t){r.flags|=16384,r={getSnapshot:e,value:t},e=Ut.updateQueue,e===null?(e={lastEffect:null,stores:null},Ut.updateQueue=e,e.stores=[r]):(t=e.stores,t===null?e.stores=[r]:t.push(r))}function tk(r,e,t,n){e.value=t,e.getSnapshot=n,nk(e)&&ik(r)}function rk(r,e,t){return t(function(){nk(e)&&ik(r)})}function nk(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!Hi(r,t)}catch{return!0}}function ik(r){var e=uo(r,1);e!==null&&Ji(e,r,1,-1)}function sk(r){var e=As();return typeof r=="function"&&(r=r()),e.memoizedState=e.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Uf,lastRenderedState:r},e.queue=r,r=r.dispatch=nG.bind(null,Ut,r),[e.memoizedState,r]}function Ff(r,e,t,n){return r={tag:r,create:e,destroy:t,deps:n,next:null},e=Ut.updateQueue,e===null?(e={lastEffect:null,stores:null},Ut.updateQueue=e,e.lastEffect=r.next=r):(t=e.lastEffect,t===null?e.lastEffect=r.next=r:(n=t.next,t.next=r,r.next=n,e.lastEffect=r)),r}function ok(){return wi().memoizedState}function hg(r,e,t,n){var i=As();Ut.flags|=r,i.memoizedState=Ff(1|e,t,void 0,n===void 0?null:n)}function fg(r,e,t,n){var i=wi();n=n===void 0?null:n;var s=void 0;if(ir!==null){var o=ir.memoizedState;if(s=o.destroy,n!==null&&k8(n,o.deps)){i.memoizedState=Ff(e,t,s,n);return}}Ut.flags|=r,i.memoizedState=Ff(1|e,t,s,n)}function ak(r,e){return hg(8390656,8,r,e)}function $8(r,e){return fg(2048,8,r,e)}function ck(r,e){return fg(4,2,r,e)}function lk(r,e){return fg(4,4,r,e)}function uk(r,e){if(typeof e=="function")return r=r(),e(r),function(){e(null)};if(e!=null)return r=r(),e.current=r,function(){e.current=null}}function dk(r,e,t){return t=t!=null?t.concat([r]):null,fg(4,4,uk.bind(null,e,r),t)}function N8(){}function hk(r,e){var t=wi();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&k8(e,n[1])?n[0]:(t.memoizedState=[r,e],r)}function fk(r,e){var t=wi();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&k8(e,n[1])?n[0]:(r=r(),t.memoizedState=[r,e],r)}function pk(r,e,t){return il&21?(Hi(t,e)||(t=jC(),Ut.lanes|=t,sl|=t,r.baseState=!0),e):(r.baseState&&(r.baseState=!1,Sn=!0),r.memoizedState=t)}function tG(r,e){var t=ft;ft=t!==0&&4>t?t:4,r(!0);var n=I8.transition;I8.transition={};try{r(!1),e()}finally{ft=t,I8.transition=n}}function gk(){return wi().memoizedState}function rG(r,e,t){var n=Da(r);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},yk(r))mk(e,t);else if(t=WI(r,e,t,n),t!==null){var i=cn();Ji(t,r,n,i),wk(t,e,n)}}function nG(r,e,t){var n=Da(r),i={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(yk(r))mk(e,i);else{var s=r.alternate;if(r.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(i.hasEagerState=!0,i.eagerState=a,Hi(a,o)){var c=e.interleaved;c===null?(i.next=i,v8(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}t=WI(r,e,i,n),t!==null&&(i=cn(),Ji(t,r,n,i),wk(t,e,n))}}function yk(r){var e=r.alternate;return r===Ut||e!==null&&e===Ut}function mk(r,e){Lf=dg=!0;var t=r.pending;t===null?e.next=e:(e.next=t.next,t.next=e),r.pending=e}function wk(r,e,t){if(t&4194240){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,O5(r,t)}}var pg={readContext:mi,useCallback:Or,useContext:Or,useEffect:Or,useImperativeHandle:Or,useInsertionEffect:Or,useLayoutEffect:Or,useMemo:Or,useReducer:Or,useRef:Or,useState:Or,useDebugValue:Or,useDeferredValue:Or,useTransition:Or,useMutableSource:Or,useSyncExternalStore:Or,useId:Or,unstable_isNewReconciler:!1},iG={readContext:mi,useCallback:function(r,e){return As().memoizedState=[r,e===void 0?null:e],r},useContext:mi,useEffect:ak,useImperativeHandle:function(r,e,t){return t=t!=null?t.concat([r]):null,hg(4194308,4,uk.bind(null,e,r),t)},useLayoutEffect:function(r,e){return hg(4194308,4,r,e)},useInsertionEffect:function(r,e){return hg(4,2,r,e)},useMemo:function(r,e){var t=As();return e=e===void 0?null:e,r=r(),t.memoizedState=[r,e],r},useReducer:function(r,e,t){var n=As();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:e},n.queue=r,r=r.dispatch=rG.bind(null,Ut,r),[n.memoizedState,r]},useRef:function(r){var e=As();return r={current:r},e.memoizedState=r},useState:sk,useDebugValue:N8,useDeferredValue:function(r){return As().memoizedState=r},useTransition:function(){var r=sk(!1),e=r[0];return r=tG.bind(null,r[1]),As().memoizedState=r,[e,r]},useMutableSource:function(){},useSyncExternalStore:function(r,e,t){var n=Ut,i=As();if(Mt){if(t===void 0)throw Error(ee(407));t=t()}else{if(t=e(),ur===null)throw Error(ee(349));il&30||ek(n,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,ak(rk.bind(null,n,s,r),[r]),n.flags|=2048,Ff(9,tk.bind(null,n,s,t,e),void 0,null),t},useId:function(){var r=As(),e=ur.identifierPrefix;if(Mt){var t=lo,n=co;t=(n&~(1<<32-ji(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=Bf++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=eG++,e=":"+e+"r"+t.toString(32)+":";return r.memoizedState=e},unstable_isNewReconciler:!1},sG={readContext:mi,useCallback:hk,useContext:mi,useEffect:$8,useImperativeHandle:dk,useInsertionEffect:ck,useLayoutEffect:lk,useMemo:fk,useReducer:P8,useRef:ok,useState:function(){return P8(Uf)},useDebugValue:N8,useDeferredValue:function(r){var e=wi();return pk(e,ir.memoizedState,r)},useTransition:function(){var r=P8(Uf)[0],e=wi().memoizedState;return[r,e]},useMutableSource:XI,useSyncExternalStore:ZI,useId:gk,unstable_isNewReconciler:!1},oG={readContext:mi,useCallback:hk,useContext:mi,useEffect:$8,useImperativeHandle:dk,useInsertionEffect:ck,useLayoutEffect:lk,useMemo:fk,useReducer:D8,useRef:ok,useState:function(){return D8(Uf)},useDebugValue:N8,useDeferredValue:function(r){var e=wi();return ir===null?e.memoizedState=r:pk(e,ir.memoizedState,r)},useTransition:function(){var r=D8(Uf)[0],e=wi().memoizedState;return[r,e]},useMutableSource:XI,useSyncExternalStore:ZI,useId:gk,unstable_isNewReconciler:!1};function Wi(r,e){if(r&&r.defaultProps){e=Lt({},e),r=r.defaultProps;for(var t in r)e[t]===void 0&&(e[t]=r[t]);return e}return e}function M8(r,e,t,n){e=r.memoizedState,t=t(n,e),t=t==null?e:Lt({},e,t),r.memoizedState=t,r.lanes===0&&(r.updateQueue.baseState=t)}var gg={isMounted:function(r){return(r=r._reactInternals)?Yc(r)===r:!1},enqueueSetState:function(r,e,t){r=r._reactInternals;var n=cn(),i=Da(r),s=ho(n,i);s.payload=e,t!=null&&(s.callback=t),e=ka(r,s,i),e!==null&&(Ji(e,r,i,n),ag(e,r,i))},enqueueReplaceState:function(r,e,t){r=r._reactInternals;var n=cn(),i=Da(r),s=ho(n,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=ka(r,s,i),e!==null&&(Ji(e,r,i,n),ag(e,r,i))},enqueueForceUpdate:function(r,e){r=r._reactInternals;var t=cn(),n=Da(r),i=ho(t,n);i.tag=2,e!=null&&(i.callback=e),e=ka(r,i,n),e!==null&&(Ji(e,r,n,t),ag(e,r,n))}};function bk(r,e,t,n,i,s,o){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(n,s,o):e.prototype&&e.prototype.isPureReactComponent?!If(t,n)||!If(i,s):!0}function vk(r,e,t){var n=!1,i=Aa,s=e.contextType;return typeof s=="object"&&s!==null?s=mi(s):(i=En(e)?Zc:Mr.current,n=e.contextTypes,s=(n=n!=null)?qu(r,i):Aa),e=new e(t,s),r.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=gg,r.stateNode=e,e._reactInternals=r,n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=i,r.__reactInternalMemoizedMaskedChildContext=s),e}function Ek(r,e,t,n){r=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==r&&gg.enqueueReplaceState(e,e.state,null)}function O8(r,e,t,n){var i=r.stateNode;i.props=t,i.state=r.memoizedState,i.refs={},E8(r);var s=e.contextType;typeof s=="object"&&s!==null?i.context=mi(s):(s=En(e)?Zc:Mr.current,i.context=qu(r,s)),i.state=r.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(M8(r,e,s,t),i.state=r.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&gg.enqueueReplaceState(i,i.state,null),cg(r,t,i,n),i.state=r.memoizedState),typeof i.componentDidMount=="function"&&(r.flags|=4194308)}function ed(r,e){try{var t="",n=e;do t+=Mq(n),n=n.return;while(n);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:r,source:e,stack:i,digest:null}}function R8(r,e,t){return{value:r,source:null,stack:t??null,digest:e??null}}function L8(r,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var aG=typeof WeakMap=="function"?WeakMap:Map;function Sk(r,e,t){t=ho(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){Sg||(Sg=!0,X8=n),L8(r,e)},t}function xk(r,e,t){t=ho(-1,t),t.tag=3;var n=r.type.getDerivedStateFromError;if(typeof n=="function"){var i=e.value;t.payload=function(){return n(i)},t.callback=function(){L8(r,e)}}var s=r.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){L8(r,e),typeof n!="function"&&(Ta===null?Ta=new Set([this]):Ta.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function Ak(r,e,t){var n=r.pingCache;if(n===null){n=r.pingCache=new aG;var i=new Set;n.set(e,i)}else i=n.get(e),i===void 0&&(i=new Set,n.set(e,i));i.has(t)||(i.add(t),r=EG.bind(null,r,e,t),e.then(r,r))}function Ck(r){do{var e;if((e=r.tag===13)&&(e=r.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return r;r=r.return}while(r!==null);return null}function Ik(r,e,t,n,i){return r.mode&1?(r.flags|=65536,r.lanes=i,r):(r===e?r.flags|=65536:(r.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=ho(-1,1),e.tag=2,ka(t,e,1))),t.lanes|=1),r)}var cG=so.ReactCurrentOwner,Sn=!1;function an(r,e,t,n){e.child=r===null?qI(e,null,t,n):Ju(e,r.child,t,n)}function kk(r,e,t,n,i){t=t.render;var s=e.ref;return Xu(e,i),n=_8(r,e,t,n,s,i),t=T8(),r!==null&&!Sn?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~i,fo(r,e,i)):(Mt&&t&&d8(e),e.flags|=1,an(r,e,n,i),e.child)}function _k(r,e,t,n,i){if(r===null){var s=t.type;return typeof s=="function"&&!s6(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,Tk(r,e,s,n,i)):(r=_g(t.type,null,n,e,e.mode,i),r.ref=e.ref,r.return=e,e.child=r)}if(s=r.child,!(r.lanes&i)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:If,t(o,n)&&r.ref===e.ref)return fo(r,e,i)}return e.flags|=1,r=Na(s,n),r.ref=e.ref,r.return=e,e.child=r}function Tk(r,e,t,n,i){if(r!==null){var s=r.memoizedProps;if(If(s,n)&&r.ref===e.ref)if(Sn=!1,e.pendingProps=n=s,(r.lanes&i)!==0)r.flags&131072&&(Sn=!0);else return e.lanes=r.lanes,fo(r,e,i)}return B8(r,e,t,n,i)}function Pk(r,e,t){var n=e.pendingProps,i=n.children,s=r!==null?r.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Et(rd,Gn),Gn|=t;else{if(!(t&1073741824))return r=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:r,cachePool:null,transitions:null},e.updateQueue=null,Et(rd,Gn),Gn|=r,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:t,Et(rd,Gn),Gn|=n}else s!==null?(n=s.baseLanes|t,e.memoizedState=null):n=t,Et(rd,Gn),Gn|=n;return an(r,e,i,t),e.child}function Dk(r,e){var t=e.ref;(r===null&&t!==null||r!==null&&r.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function B8(r,e,t,n,i){var s=En(t)?Zc:Mr.current;return s=qu(e,s),Xu(e,i),t=_8(r,e,t,n,s,i),n=T8(),r!==null&&!Sn?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~i,fo(r,e,i)):(Mt&&n&&d8(e),e.flags|=1,an(r,e,t,i),e.child)}function $k(r,e,t,n,i){if(En(t)){var s=!0;Z0(e)}else s=!1;if(Xu(e,i),e.stateNode===null)mg(r,e),vk(e,t,n),O8(e,t,n,i),n=!0;else if(r===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=t.contextType;typeof l=="object"&&l!==null?l=mi(l):(l=En(t)?Zc:Mr.current,l=qu(e,l));var d=t.getDerivedStateFromProps,h=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==n||c!==l)&&Ek(e,o,n,l),Ia=!1;var p=e.memoizedState;o.state=p,cg(e,n,o,i),c=e.memoizedState,a!==n||p!==c||vn.current||Ia?(typeof d=="function"&&(M8(e,t,d,n),c=e.memoizedState),(a=Ia||bk(e,t,a,n,p,c,l))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=c),o.props=n,o.state=c,o.context=l,n=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,GI(r,e),a=e.memoizedProps,l=e.type===e.elementType?a:Wi(e.type,a),o.props=l,h=e.pendingProps,p=o.context,c=t.contextType,typeof c=="object"&&c!==null?c=mi(c):(c=En(t)?Zc:Mr.current,c=qu(e,c));var b=t.getDerivedStateFromProps;(d=typeof b=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||p!==c)&&Ek(e,o,n,c),Ia=!1,p=e.memoizedState,o.state=p,cg(e,n,o,i);var f=e.memoizedState;a!==h||p!==f||vn.current||Ia?(typeof b=="function"&&(M8(e,t,b,n),f=e.memoizedState),(l=Ia||bk(e,t,l,n,p,f,c)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,f,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,f,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=f),o.props=n,o.state=f,o.context=c,n=l):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=1024),n=!1)}return U8(r,e,t,n,s,i)}function U8(r,e,t,n,i,s){Dk(r,e);var o=(e.flags&128)!==0;if(!n&&!o)return i&&LI(e,t,!1),fo(r,e,s);n=e.stateNode,cG.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,r!==null&&o?(e.child=Ju(e,r.child,null,s),e.child=Ju(e,null,a,s)):an(r,e,a,s),e.memoizedState=n.state,i&&LI(e,t,!0),e.child}function Nk(r){var e=r.stateNode;e.pendingContext?OI(r,e.pendingContext,e.pendingContext!==e.context):e.context&&OI(r,e.context,!1),S8(r,e.containerInfo)}function Mk(r,e,t,n,i){return Qu(),g8(i),e.flags|=256,an(r,e,t,n),e.child}var F8={dehydrated:null,treeContext:null,retryLane:0};function z8(r){return{baseLanes:r,cachePool:null,transitions:null}}function Ok(r,e,t){var n=e.pendingProps,i=Bt.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=r!==null&&r.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(r===null||r.memoizedState!==null)&&(i|=1),Et(Bt,i&1),r===null)return p8(e),r=e.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(e.mode&1?r.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,r=n.fallback,s?(n=e.mode,s=e.child,o={mode:"hidden",children:o},!(n&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Tg(o,n,0,null),r=ll(r,n,t,null),s.return=e,r.return=e,s.sibling=r,e.child=s,e.child.memoizedState=z8(t),e.memoizedState=F8,r):V8(e,o));if(i=r.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return lG(r,e,o,n,a,i,t);if(s){s=n.fallback,o=e.mode,i=r.child,a=i.sibling;var c={mode:"hidden",children:n.children};return!(o&1)&&e.child!==i?(n=e.child,n.childLanes=0,n.pendingProps=c,e.deletions=null):(n=Na(i,c),n.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Na(a,s):(s=ll(s,o,t,null),s.flags|=2),s.return=e,n.return=e,n.sibling=s,e.child=n,n=s,s=e.child,o=r.child.memoizedState,o=o===null?z8(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=r.childLanes&~t,e.memoizedState=F8,n}return s=r.child,r=s.sibling,n=Na(s,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,r!==null&&(t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)),e.child=n,e.memoizedState=null,n}function V8(r,e){return e=Tg({mode:"visible",children:e},r.mode,0,null),e.return=r,r.child=e}function yg(r,e,t,n){return n!==null&&g8(n),Ju(e,r.child,null,t),r=V8(e,e.pendingProps.children),r.flags|=2,e.memoizedState=null,r}function lG(r,e,t,n,i,s,o){if(t)return e.flags&256?(e.flags&=-257,n=R8(Error(ee(422))),yg(r,e,o,n)):e.memoizedState!==null?(e.child=r.child,e.flags|=128,null):(s=n.fallback,i=e.mode,n=Tg({mode:"visible",children:n.children},i,0,null),s=ll(s,i,o,null),s.flags|=2,n.return=e,s.return=e,n.sibling=s,e.child=n,e.mode&1&&Ju(e,r.child,null,o),e.child.memoizedState=z8(o),e.memoizedState=F8,s);if(!(e.mode&1))return yg(r,e,o,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var a=n.dgst;return n=a,s=Error(ee(419)),n=R8(s,n,void 0),yg(r,e,o,n)}if(a=(o&r.childLanes)!==0,Sn||a){if(n=ur,n!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,uo(r,i),Ji(n,r,i,-1))}return i6(),n=R8(Error(ee(421))),yg(r,e,o,n)}return i.data==="$?"?(e.flags|=128,e.child=r.child,e=SG.bind(null,r),i._reactRetry=e,null):(r=s.treeContext,Wn=Sa(i.nextSibling),qn=e,Mt=!0,qi=null,r!==null&&(gi[yi++]=co,gi[yi++]=lo,gi[yi++]=el,co=r.id,lo=r.overflow,el=e),e=V8(e,n.children),e.flags|=4096,e)}function Rk(r,e,t){r.lanes|=e;var n=r.alternate;n!==null&&(n.lanes|=e),b8(r.return,e,t)}function K8(r,e,t,n,i){var s=r.memoizedState;s===null?r.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=t,s.tailMode=i)}function Lk(r,e,t){var n=e.pendingProps,i=n.revealOrder,s=n.tail;if(an(r,e,n.children,t),n=Bt.current,n&2)n=n&1|2,e.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=e.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Rk(r,t,e);else if(r.tag===19)Rk(r,t,e);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}n&=1}if(Et(Bt,n),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)r=t.alternate,r!==null&&lg(r)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),K8(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(r=i.alternate,r!==null&&lg(r)===null){e.child=i;break}r=i.sibling,i.sibling=t,t=i,i=r}K8(e,!0,t,null,s);break;case"together":K8(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function mg(r,e){!(e.mode&1)&&r!==null&&(r.alternate=null,e.alternate=null,e.flags|=2)}function fo(r,e,t){if(r!==null&&(e.dependencies=r.dependencies),sl|=e.lanes,!(t&e.childLanes))return null;if(r!==null&&e.child!==r.child)throw Error(ee(153));if(e.child!==null){for(r=e.child,t=Na(r,r.pendingProps),e.child=t,t.return=e;r.sibling!==null;)r=r.sibling,t=t.sibling=Na(r,r.pendingProps),t.return=e;t.sibling=null}return e.child}function uG(r,e,t){switch(e.tag){case 3:Nk(e),Qu();break;case 5:YI(e);break;case 1:En(e.type)&&Z0(e);break;case 4:S8(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,i=e.memoizedProps.value;Et(sg,n._currentValue),n._currentValue=i;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(Et(Bt,Bt.current&1),e.flags|=128,null):t&e.child.childLanes?Ok(r,e,t):(Et(Bt,Bt.current&1),r=fo(r,e,t),r!==null?r.sibling:null);Et(Bt,Bt.current&1);break;case 19:if(n=(t&e.childLanes)!==0,r.flags&128){if(n)return Lk(r,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Et(Bt,Bt.current),n)break;return null;case 22:case 23:return e.lanes=0,Pk(r,e,t)}return fo(r,e,t)}var Bk,j8,Uk,Fk;Bk=function(r,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)r.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}},j8=function(){},Uk=function(r,e,t,n){var i=r.memoizedProps;if(i!==n){r=e.stateNode,nl(xs.current);var s=null;switch(t){case"input":i=b5(r,i),n=b5(r,n),s=[];break;case"select":i=Lt({},i,{value:void 0}),n=Lt({},n,{value:void 0}),s=[];break;case"textarea":i=S5(r,i),n=S5(r,n),s=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(r.onclick=J0)}A5(t,n);var o;t=null;for(l in i)if(!n.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var a=i[l];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(sf.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in n){var c=n[l];if(a=i!=null?i[l]:void 0,n.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(s||(s=[]),s.push(l,t)),t=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(sf.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&Tt("scroll",r),s||a===c||(s=[])):(s=s||[]).push(l,c))}t&&(s=s||[]).push("style",t);var l=s;(e.updateQueue=l)&&(e.flags|=4)}},Fk=function(r,e,t,n){t!==n&&(e.flags|=4)};function zf(r,e){if(!Mt)switch(r.tailMode){case"hidden":e=r.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?r.tail=null:t.sibling=null;break;case"collapsed":t=r.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||r.tail===null?r.tail=null:r.tail.sibling=null:n.sibling=null}}function Rr(r){var e=r.alternate!==null&&r.alternate.child===r.child,t=0,n=0;if(e)for(var i=r.child;i!==null;)t|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=r,i=i.sibling;else for(i=r.child;i!==null;)t|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=r,i=i.sibling;return r.subtreeFlags|=n,r.childLanes=t,e}function dG(r,e,t){var n=e.pendingProps;switch(h8(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rr(e),null;case 1:return En(e.type)&&X0(),Rr(e),null;case 3:return n=e.stateNode,Zu(),Pt(vn),Pt(Mr),C8(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(r===null||r.child===null)&&(ng(e)?e.flags|=4:r===null||r.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,qi!==null&&(t6(qi),qi=null))),j8(r,e),Rr(e),null;case 5:x8(e);var i=nl(Rf.current);if(t=e.type,r!==null&&e.stateNode!=null)Uk(r,e,t,n,i),r.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(ee(166));return Rr(e),null}if(r=nl(xs.current),ng(e)){n=e.stateNode,t=e.type;var s=e.memoizedProps;switch(n[Ss]=e,n[Df]=s,r=(e.mode&1)!==0,t){case"dialog":Tt("cancel",n),Tt("close",n);break;case"iframe":case"object":case"embed":Tt("load",n);break;case"video":case"audio":for(i=0;i<_f.length;i++)Tt(_f[i],n);break;case"source":Tt("error",n);break;case"img":case"image":case"link":Tt("error",n),Tt("load",n);break;case"details":Tt("toggle",n);break;case"input":vC(n,s),Tt("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},Tt("invalid",n);break;case"textarea":xC(n,s),Tt("invalid",n)}A5(t,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?n.textContent!==a&&(s.suppressHydrationWarning!==!0&&Q0(n.textContent,a,r),i=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Q0(n.textContent,a,r),i=["children",""+a]):sf.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Tt("scroll",n)}switch(t){case"input":I0(n),SC(n,s,!0);break;case"textarea":I0(n),CC(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=J0)}n=i,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=IC(t)),r==="http://www.w3.org/1999/xhtml"?t==="script"?(r=o.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof n.is=="string"?r=o.createElement(t,{is:n.is}):(r=o.createElement(t),t==="select"&&(o=r,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):r=o.createElementNS(r,t),r[Ss]=e,r[Df]=n,Bk(r,e,!1,!1),e.stateNode=r;e:{switch(o=C5(t,n),t){case"dialog":Tt("cancel",r),Tt("close",r),i=n;break;case"iframe":case"object":case"embed":Tt("load",r),i=n;break;case"video":case"audio":for(i=0;i<_f.length;i++)Tt(_f[i],r);i=n;break;case"source":Tt("error",r),i=n;break;case"img":case"image":case"link":Tt("error",r),Tt("load",r),i=n;break;case"details":Tt("toggle",r),i=n;break;case"input":vC(r,n),i=b5(r,n),Tt("invalid",r);break;case"option":i=n;break;case"select":r._wrapperState={wasMultiple:!!n.multiple},i=Lt({},n,{value:void 0}),Tt("invalid",r);break;case"textarea":xC(r,n),i=S5(r,n),Tt("invalid",r);break;default:i=n}A5(t,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?TC(r,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&kC(r,c)):s==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&lf(r,c):typeof c=="number"&&lf(r,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(sf.hasOwnProperty(s)?c!=null&&s==="onScroll"&&Tt("scroll",r):c!=null&&c5(r,s,c,o))}switch(t){case"input":I0(r),SC(r,n,!1);break;case"textarea":I0(r),CC(r);break;case"option":n.value!=null&&r.setAttribute("value",""+ga(n.value));break;case"select":r.multiple=!!n.multiple,s=n.value,s!=null?Mu(r,!!n.multiple,s,!1):n.defaultValue!=null&&Mu(r,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(r.onclick=J0)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Rr(e),null;case 6:if(r&&e.stateNode!=null)Fk(r,e,r.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(ee(166));if(t=nl(Rf.current),nl(xs.current),ng(e)){if(n=e.stateNode,t=e.memoizedProps,n[Ss]=e,(s=n.nodeValue!==t)&&(r=qn,r!==null))switch(r.tag){case 3:Q0(n.nodeValue,t,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Q0(n.nodeValue,t,(r.mode&1)!==0)}s&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[Ss]=e,e.stateNode=n}return Rr(e),null;case 13:if(Pt(Bt),n=e.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(Mt&&Wn!==null&&e.mode&1&&!(e.flags&128))KI(),Qu(),e.flags|=98560,s=!1;else if(s=ng(e),n!==null&&n.dehydrated!==null){if(r===null){if(!s)throw Error(ee(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ee(317));s[Ss]=e}else Qu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Rr(e),s=!1}else qi!==null&&(t6(qi),qi=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(r!==null&&r.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(r===null||Bt.current&1?sr===0&&(sr=3):i6())),e.updateQueue!==null&&(e.flags|=4),Rr(e),null);case 4:return Zu(),j8(r,e),r===null&&Tf(e.stateNode.containerInfo),Rr(e),null;case 10:return w8(e.type._context),Rr(e),null;case 17:return En(e.type)&&X0(),Rr(e),null;case 19:if(Pt(Bt),s=e.memoizedState,s===null)return Rr(e),null;if(n=(e.flags&128)!==0,o=s.rendering,o===null)if(n)zf(s,!1);else{if(sr!==0||r!==null&&r.flags&128)for(r=e.child;r!==null;){if(o=lg(r),o!==null){for(e.flags|=128,zf(s,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)s=t,r=n,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=r,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,r=o.dependencies,s.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t=t.sibling;return Et(Bt,Bt.current&1|2),e.child}r=r.sibling}s.tail!==null&&Gt()>nd&&(e.flags|=128,n=!0,zf(s,!1),e.lanes=4194304)}else{if(!n)if(r=lg(o),r!==null){if(e.flags|=128,n=!0,t=r.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),zf(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Mt)return Rr(e),null}else 2*Gt()-s.renderingStartTime>nd&&t!==1073741824&&(e.flags|=128,n=!0,zf(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Gt(),e.sibling=null,t=Bt.current,Et(Bt,n?t&1|2:t&1),e):(Rr(e),null);case 22:case 23:return n6(),n=e.memoizedState!==null,r!==null&&r.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Gn&1073741824&&(Rr(e),e.subtreeFlags&6&&(e.flags|=8192)):Rr(e),null;case 24:return null;case 25:return null}throw Error(ee(156,e.tag))}function hG(r,e){switch(h8(e),e.tag){case 1:return En(e.type)&&X0(),r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 3:return Zu(),Pt(vn),Pt(Mr),C8(),r=e.flags,r&65536&&!(r&128)?(e.flags=r&-65537|128,e):null;case 5:return x8(e),null;case 13:if(Pt(Bt),r=e.memoizedState,r!==null&&r.dehydrated!==null){if(e.alternate===null)throw Error(ee(340));Qu()}return r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 19:return Pt(Bt),null;case 4:return Zu(),null;case 10:return w8(e.type._context),null;case 22:case 23:return n6(),null;case 24:return null;default:return null}}var wg=!1,Lr=!1,fG=typeof WeakSet=="function"?WeakSet:Set,ve=null;function td(r,e){var t=r.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){Ht(r,e,n)}else t.current=null}function H8(r,e,t){try{t()}catch(n){Ht(r,e,n)}}var zk=!1;function pG(r,e){if(n8=B0,r=bI(),Q5(r)){if("selectionStart"in r)var t={start:r.selectionStart,end:r.selectionEnd};else e:{t=(t=r.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var i=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,c=-1,l=0,d=0,h=r,p=null;t:for(;;){for(var b;h!==t||i!==0&&h.nodeType!==3||(a=o+i),h!==s||n!==0&&h.nodeType!==3||(c=o+n),h.nodeType===3&&(o+=h.nodeValue.length),(b=h.firstChild)!==null;)p=h,h=b;for(;;){if(h===r)break t;if(p===t&&++l===i&&(a=o),p===s&&++d===n&&(c=o),(b=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=b}t=a===-1||c===-1?null:{start:a,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(i8={focusedElem:r,selectionRange:t},B0=!1,ve=e;ve!==null;)if(e=ve,r=e.child,(e.subtreeFlags&1028)!==0&&r!==null)r.return=e,ve=r;else for(;ve!==null;){e=ve;try{var f=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var g=f.memoizedProps,v=f.memoizedState,y=e.stateNode,w=y.getSnapshotBeforeUpdate(e.elementType===e.type?g:Wi(e.type,g),v);y.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var m=e.stateNode.containerInfo;m.nodeType===1?m.textContent="":m.nodeType===9&&m.documentElement&&m.removeChild(m.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ee(163))}}catch(E){Ht(e,e.return,E)}if(r=e.sibling,r!==null){r.return=e.return,ve=r;break}ve=e.return}return f=zk,zk=!1,f}function Vf(r,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&r)===r){var s=i.destroy;i.destroy=void 0,s!==void 0&&H8(e,t,s)}i=i.next}while(i!==n)}}function bg(r,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&r)===r){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function q8(r){var e=r.ref;if(e!==null){var t=r.stateNode;switch(r.tag){case 5:r=t;break;default:r=t}typeof e=="function"?e(r):e.current=r}}function Vk(r){var e=r.alternate;e!==null&&(r.alternate=null,Vk(e)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(e=r.stateNode,e!==null&&(delete e[Ss],delete e[Df],delete e[c8],delete e[JW],delete e[YW])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function Kk(r){return r.tag===5||r.tag===3||r.tag===4}function jk(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Kk(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function W8(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(r,e):t.insertBefore(r,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(r,t)):(e=t,e.appendChild(r)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=J0));else if(n!==4&&(r=r.child,r!==null))for(W8(r,e,t),r=r.sibling;r!==null;)W8(r,e,t),r=r.sibling}function G8(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.insertBefore(r,e):t.appendChild(r);else if(n!==4&&(r=r.child,r!==null))for(G8(r,e,t),r=r.sibling;r!==null;)G8(r,e,t),r=r.sibling}var wr=null,Gi=!1;function _a(r,e,t){for(t=t.child;t!==null;)Hk(r,e,t),t=t.sibling}function Hk(r,e,t){if(Es&&typeof Es.onCommitFiberUnmount=="function")try{Es.onCommitFiberUnmount($0,t)}catch{}switch(t.tag){case 5:Lr||td(t,e);case 6:var n=wr,i=Gi;wr=null,_a(r,e,t),wr=n,Gi=i,wr!==null&&(Gi?(r=wr,t=t.stateNode,r.nodeType===8?r.parentNode.removeChild(t):r.removeChild(t)):wr.removeChild(t.stateNode));break;case 18:wr!==null&&(Gi?(r=wr,t=t.stateNode,r.nodeType===8?a8(r.parentNode,t):r.nodeType===1&&a8(r,t),vf(r)):a8(wr,t.stateNode));break;case 4:n=wr,i=Gi,wr=t.stateNode.containerInfo,Gi=!0,_a(r,e,t),wr=n,Gi=i;break;case 0:case 11:case 14:case 15:if(!Lr&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&H8(t,e,o),i=i.next}while(i!==n)}_a(r,e,t);break;case 1:if(!Lr&&(td(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(a){Ht(t,e,a)}_a(r,e,t);break;case 21:_a(r,e,t);break;case 22:t.mode&1?(Lr=(n=Lr)||t.memoizedState!==null,_a(r,e,t),Lr=n):_a(r,e,t);break;default:_a(r,e,t)}}function qk(r){var e=r.updateQueue;if(e!==null){r.updateQueue=null;var t=r.stateNode;t===null&&(t=r.stateNode=new fG),e.forEach(function(n){var i=xG.bind(null,r,n);t.has(n)||(t.add(n),n.then(i,i))})}}function Qi(r,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var i=t[n];try{var s=r,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:wr=a.stateNode,Gi=!1;break e;case 3:wr=a.stateNode.containerInfo,Gi=!0;break e;case 4:wr=a.stateNode.containerInfo,Gi=!0;break e}a=a.return}if(wr===null)throw Error(ee(160));Hk(s,o,i),wr=null,Gi=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(l){Ht(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Wk(e,r),e=e.sibling}function Wk(r,e){var t=r.alternate,n=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Qi(e,r),Cs(r),n&4){try{Vf(3,r,r.return),bg(3,r)}catch(g){Ht(r,r.return,g)}try{Vf(5,r,r.return)}catch(g){Ht(r,r.return,g)}}break;case 1:Qi(e,r),Cs(r),n&512&&t!==null&&td(t,t.return);break;case 5:if(Qi(e,r),Cs(r),n&512&&t!==null&&td(t,t.return),r.flags&32){var i=r.stateNode;try{lf(i,"")}catch(g){Ht(r,r.return,g)}}if(n&4&&(i=r.stateNode,i!=null)){var s=r.memoizedProps,o=t!==null?t.memoizedProps:s,a=r.type,c=r.updateQueue;if(r.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&EC(i,s),C5(a,o);var l=C5(a,s);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];d==="style"?TC(i,h):d==="dangerouslySetInnerHTML"?kC(i,h):d==="children"?lf(i,h):c5(i,d,h,l)}switch(a){case"input":v5(i,s);break;case"textarea":AC(i,s);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var b=s.value;b!=null?Mu(i,!!s.multiple,b,!1):p!==!!s.multiple&&(s.defaultValue!=null?Mu(i,!!s.multiple,s.defaultValue,!0):Mu(i,!!s.multiple,s.multiple?[]:"",!1))}i[Df]=s}catch(g){Ht(r,r.return,g)}}break;case 6:if(Qi(e,r),Cs(r),n&4){if(r.stateNode===null)throw Error(ee(162));i=r.stateNode,s=r.memoizedProps;try{i.nodeValue=s}catch(g){Ht(r,r.return,g)}}break;case 3:if(Qi(e,r),Cs(r),n&4&&t!==null&&t.memoizedState.isDehydrated)try{vf(e.containerInfo)}catch(g){Ht(r,r.return,g)}break;case 4:Qi(e,r),Cs(r);break;case 13:Qi(e,r),Cs(r),i=r.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Y8=Gt())),n&4&&qk(r);break;case 22:if(d=t!==null&&t.memoizedState!==null,r.mode&1?(Lr=(l=Lr)||d,Qi(e,r),Lr=l):Qi(e,r),Cs(r),n&8192){if(l=r.memoizedState!==null,(r.stateNode.isHidden=l)&&!d&&r.mode&1)for(ve=r,d=r.child;d!==null;){for(h=ve=d;ve!==null;){switch(p=ve,b=p.child,p.tag){case 0:case 11:case 14:case 15:Vf(4,p,p.return);break;case 1:td(p,p.return);var f=p.stateNode;if(typeof f.componentWillUnmount=="function"){n=p,t=p.return;try{e=n,f.props=e.memoizedProps,f.state=e.memoizedState,f.componentWillUnmount()}catch(g){Ht(n,t,g)}}break;case 5:td(p,p.return);break;case 22:if(p.memoizedState!==null){Jk(h);continue}}b!==null?(b.return=p,ve=b):Jk(h)}d=d.sibling}e:for(d=null,h=r;;){if(h.tag===5){if(d===null){d=h;try{i=h.stateNode,l?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=_C("display",o))}catch(g){Ht(r,r.return,g)}}}else if(h.tag===6){if(d===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(g){Ht(r,r.return,g)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===r)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===r)break e;for(;h.sibling===null;){if(h.return===null||h.return===r)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Qi(e,r),Cs(r),n&4&&qk(r);break;case 21:break;default:Qi(e,r),Cs(r)}}function Cs(r){var e=r.flags;if(e&2){try{e:{for(var t=r.return;t!==null;){if(Kk(t)){var n=t;break e}t=t.return}throw Error(ee(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(lf(i,""),n.flags&=-33);var s=jk(r);G8(r,s,i);break;case 3:case 4:var o=n.stateNode.containerInfo,a=jk(r);W8(r,a,o);break;default:throw Error(ee(161))}}catch(c){Ht(r,r.return,c)}r.flags&=-3}e&4096&&(r.flags&=-4097)}function gG(r,e,t){ve=r,Gk(r)}function Gk(r,e,t){for(var n=(r.mode&1)!==0;ve!==null;){var i=ve,s=i.child;if(i.tag===22&&n){var o=i.memoizedState!==null||wg;if(!o){var a=i.alternate,c=a!==null&&a.memoizedState!==null||Lr;a=wg;var l=Lr;if(wg=o,(Lr=c)&&!l)for(ve=i;ve!==null;)o=ve,c=o.child,o.tag===22&&o.memoizedState!==null?Yk(i):c!==null?(c.return=o,ve=c):Yk(i);for(;s!==null;)ve=s,Gk(s),s=s.sibling;ve=i,wg=a,Lr=l}Qk(r)}else i.subtreeFlags&8772&&s!==null?(s.return=i,ve=s):Qk(r)}}function Qk(r){for(;ve!==null;){var e=ve;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Lr||bg(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Lr)if(t===null)n.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Wi(e.type,t.memoizedProps);n.componentDidUpdate(i,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&JI(e,s,n);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}JI(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var d=l.memoizedState;if(d!==null){var h=d.dehydrated;h!==null&&vf(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ee(163))}Lr||e.flags&512&&q8(e)}catch(p){Ht(e,e.return,p)}}if(e===r){ve=null;break}if(t=e.sibling,t!==null){t.return=e.return,ve=t;break}ve=e.return}}function Jk(r){for(;ve!==null;){var e=ve;if(e===r){ve=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ve=t;break}ve=e.return}}function Yk(r){for(;ve!==null;){var e=ve;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{bg(4,e)}catch(c){Ht(e,t,c)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var i=e.return;try{n.componentDidMount()}catch(c){Ht(e,i,c)}}var s=e.return;try{q8(e)}catch(c){Ht(e,s,c)}break;case 5:var o=e.return;try{q8(e)}catch(c){Ht(e,o,c)}}}catch(c){Ht(e,e.return,c)}if(e===r){ve=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ve=a;break}ve=e.return}}var yG=Math.ceil,vg=so.ReactCurrentDispatcher,Q8=so.ReactCurrentOwner,bi=so.ReactCurrentBatchConfig,rt=0,ur=null,Xt=null,br=0,Gn=0,rd=xa(0),sr=0,Kf=null,sl=0,Eg=0,J8=0,jf=null,xn=null,Y8=0,nd=1/0,po=null,Sg=!1,X8=null,Ta=null,xg=!1,Pa=null,Ag=0,Hf=0,Z8=null,Cg=-1,Ig=0;function cn(){return rt&6?Gt():Cg!==-1?Cg:Cg=Gt()}function Da(r){return r.mode&1?rt&2&&br!==0?br&-br:ZW.transition!==null?(Ig===0&&(Ig=jC()),Ig):(r=ft,r!==0||(r=window.event,r=r===void 0?16:ZC(r.type)),r):1}function Ji(r,e,t,n){if(50<Hf)throw Hf=0,Z8=null,Error(ee(185));gf(r,t,n),(!(rt&2)||r!==ur)&&(r===ur&&(!(rt&2)&&(Eg|=t),sr===4&&$a(r,br)),An(r,n),t===1&&rt===0&&!(e.mode&1)&&(nd=Gt()+500,eg&&Ca()))}function An(r,e){var t=r.callbackNode;Zq(r,e);var n=O0(r,r===ur?br:0);if(n===0)t!==null&&zC(t),r.callbackNode=null,r.callbackPriority=0;else if(e=n&-n,r.callbackPriority!==e){if(t!=null&&zC(t),e===1)r.tag===0?XW(Zk.bind(null,r)):BI(Zk.bind(null,r)),GW(function(){!(rt&6)&&Ca()}),t=null;else{switch(HC(n)){case 1:t=$5;break;case 4:t=VC;break;case 16:t=D0;break;case 536870912:t=KC;break;default:t=D0}t=a_(t,Xk.bind(null,r))}r.callbackPriority=e,r.callbackNode=t}}function Xk(r,e){if(Cg=-1,Ig=0,rt&6)throw Error(ee(327));var t=r.callbackNode;if(id()&&r.callbackNode!==t)return null;var n=O0(r,r===ur?br:0);if(n===0)return null;if(n&30||n&r.expiredLanes||e)e=kg(r,n);else{e=n;var i=rt;rt|=2;var s=t_();(ur!==r||br!==e)&&(po=null,nd=Gt()+500,al(r,e));do try{bG();break}catch(a){e_(r,a)}while(!0);m8(),vg.current=s,rt=i,Xt!==null?e=0:(ur=null,br=0,e=sr)}if(e!==0){if(e===2&&(i=N5(r),i!==0&&(n=i,e=e6(r,i))),e===1)throw t=Kf,al(r,0),$a(r,n),An(r,Gt()),t;if(e===6)$a(r,n);else{if(i=r.current.alternate,!(n&30)&&!mG(i)&&(e=kg(r,n),e===2&&(s=N5(r),s!==0&&(n=s,e=e6(r,s))),e===1))throw t=Kf,al(r,0),$a(r,n),An(r,Gt()),t;switch(r.finishedWork=i,r.finishedLanes=n,e){case 0:case 1:throw Error(ee(345));case 2:cl(r,xn,po);break;case 3:if($a(r,n),(n&130023424)===n&&(e=Y8+500-Gt(),10<e)){if(O0(r,0)!==0)break;if(i=r.suspendedLanes,(i&n)!==n){cn(),r.pingedLanes|=r.suspendedLanes&i;break}r.timeoutHandle=o8(cl.bind(null,r,xn,po),e);break}cl(r,xn,po);break;case 4:if($a(r,n),(n&4194240)===n)break;for(e=r.eventTimes,i=-1;0<n;){var o=31-ji(n);s=1<<o,o=e[o],o>i&&(i=o),n&=~s}if(n=i,n=Gt()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*yG(n/1960))-n,10<n){r.timeoutHandle=o8(cl.bind(null,r,xn,po),n);break}cl(r,xn,po);break;case 5:cl(r,xn,po);break;default:throw Error(ee(329))}}}return An(r,Gt()),r.callbackNode===t?Xk.bind(null,r):null}function e6(r,e){var t=jf;return r.current.memoizedState.isDehydrated&&(al(r,e).flags|=256),r=kg(r,e),r!==2&&(e=xn,xn=t,e!==null&&t6(e)),r}function t6(r){xn===null?xn=r:xn.push.apply(xn,r)}function mG(r){for(var e=r;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var i=t[n],s=i.getSnapshot;i=i.value;try{if(!Hi(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function $a(r,e){for(e&=~J8,e&=~Eg,r.suspendedLanes|=e,r.pingedLanes&=~e,r=r.expirationTimes;0<e;){var t=31-ji(e),n=1<<t;r[t]=-1,e&=~n}}function Zk(r){if(rt&6)throw Error(ee(327));id();var e=O0(r,0);if(!(e&1))return An(r,Gt()),null;var t=kg(r,e);if(r.tag!==0&&t===2){var n=N5(r);n!==0&&(e=n,t=e6(r,n))}if(t===1)throw t=Kf,al(r,0),$a(r,e),An(r,Gt()),t;if(t===6)throw Error(ee(345));return r.finishedWork=r.current.alternate,r.finishedLanes=e,cl(r,xn,po),An(r,Gt()),null}function r6(r,e){var t=rt;rt|=1;try{return r(e)}finally{rt=t,rt===0&&(nd=Gt()+500,eg&&Ca())}}function ol(r){Pa!==null&&Pa.tag===0&&!(rt&6)&&id();var e=rt;rt|=1;var t=bi.transition,n=ft;try{if(bi.transition=null,ft=1,r)return r()}finally{ft=n,bi.transition=t,rt=e,!(rt&6)&&Ca()}}function n6(){Gn=rd.current,Pt(rd)}function al(r,e){r.finishedWork=null,r.finishedLanes=0;var t=r.timeoutHandle;if(t!==-1&&(r.timeoutHandle=-1,WW(t)),Xt!==null)for(t=Xt.return;t!==null;){var n=t;switch(h8(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&X0();break;case 3:Zu(),Pt(vn),Pt(Mr),C8();break;case 5:x8(n);break;case 4:Zu();break;case 13:Pt(Bt);break;case 19:Pt(Bt);break;case 10:w8(n.type._context);break;case 22:case 23:n6()}t=t.return}if(ur=r,Xt=r=Na(r.current,null),br=Gn=e,sr=0,Kf=null,J8=Eg=sl=0,xn=jf=null,rl!==null){for(e=0;e<rl.length;e++)if(t=rl[e],n=t.interleaved,n!==null){t.interleaved=null;var i=n.next,s=t.pending;if(s!==null){var o=s.next;s.next=i,n.next=o}t.pending=n}rl=null}return r}function e_(r,e){do{var t=Xt;try{if(m8(),ug.current=pg,dg){for(var n=Ut.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}dg=!1}if(il=0,lr=ir=Ut=null,Lf=!1,Bf=0,Q8.current=null,t===null||t.return===null){sr=1,Kf=e,Xt=null;break}e:{var s=r,o=t.return,a=t,c=e;if(e=br,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,d=a,h=d.tag;if(!(d.mode&1)&&(h===0||h===11||h===15)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var b=Ck(o);if(b!==null){b.flags&=-257,Ik(b,o,a,s,e),b.mode&1&&Ak(s,l,e),e=b,c=l;var f=e.updateQueue;if(f===null){var g=new Set;g.add(c),e.updateQueue=g}else f.add(c);break e}else{if(!(e&1)){Ak(s,l,e),i6();break e}c=Error(ee(426))}}else if(Mt&&a.mode&1){var v=Ck(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),Ik(v,o,a,s,e),g8(ed(c,a));break e}}s=c=ed(c,a),sr!==4&&(sr=2),jf===null?jf=[s]:jf.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var y=Sk(s,c,e);QI(s,y);break e;case 1:a=c;var w=s.type,m=s.stateNode;if(!(s.flags&128)&&(typeof w.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Ta===null||!Ta.has(m)))){s.flags|=65536,e&=-e,s.lanes|=e;var E=xk(s,a,e);QI(s,E);break e}}s=s.return}while(s!==null)}n_(t)}catch(A){e=A,Xt===t&&t!==null&&(Xt=t=t.return);continue}break}while(!0)}function t_(){var r=vg.current;return vg.current=pg,r===null?pg:r}function i6(){(sr===0||sr===3||sr===2)&&(sr=4),ur===null||!(sl&268435455)&&!(Eg&268435455)||$a(ur,br)}function kg(r,e){var t=rt;rt|=2;var n=t_();(ur!==r||br!==e)&&(po=null,al(r,e));do try{wG();break}catch(i){e_(r,i)}while(!0);if(m8(),rt=t,vg.current=n,Xt!==null)throw Error(ee(261));return ur=null,br=0,sr}function wG(){for(;Xt!==null;)r_(Xt)}function bG(){for(;Xt!==null&&!jq();)r_(Xt)}function r_(r){var e=o_(r.alternate,r,Gn);r.memoizedProps=r.pendingProps,e===null?n_(r):Xt=e,Q8.current=null}function n_(r){var e=r;do{var t=e.alternate;if(r=e.return,e.flags&32768){if(t=hG(t,e),t!==null){t.flags&=32767,Xt=t;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{sr=6,Xt=null;return}}else if(t=dG(t,e,Gn),t!==null){Xt=t;return}if(e=e.sibling,e!==null){Xt=e;return}Xt=e=r}while(e!==null);sr===0&&(sr=5)}function cl(r,e,t){var n=ft,i=bi.transition;try{bi.transition=null,ft=1,vG(r,e,t,n)}finally{bi.transition=i,ft=n}return null}function vG(r,e,t,n){do id();while(Pa!==null);if(rt&6)throw Error(ee(327));t=r.finishedWork;var i=r.finishedLanes;if(t===null)return null;if(r.finishedWork=null,r.finishedLanes=0,t===r.current)throw Error(ee(177));r.callbackNode=null,r.callbackPriority=0;var s=t.lanes|t.childLanes;if(eW(r,s),r===ur&&(Xt=ur=null,br=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||xg||(xg=!0,a_(D0,function(){return id(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=bi.transition,bi.transition=null;var o=ft;ft=1;var a=rt;rt|=4,Q8.current=null,pG(r,t),Wk(t,r),FW(i8),B0=!!n8,i8=n8=null,r.current=t,gG(t),Hq(),rt=a,ft=o,bi.transition=s}else r.current=t;if(xg&&(xg=!1,Pa=r,Ag=i),s=r.pendingLanes,s===0&&(Ta=null),Gq(t.stateNode),An(r,Gt()),e!==null)for(n=r.onRecoverableError,t=0;t<e.length;t++)i=e[t],n(i.value,{componentStack:i.stack,digest:i.digest});if(Sg)throw Sg=!1,r=X8,X8=null,r;return Ag&1&&r.tag!==0&&id(),s=r.pendingLanes,s&1?r===Z8?Hf++:(Hf=0,Z8=r):Hf=0,Ca(),null}function id(){if(Pa!==null){var r=HC(Ag),e=bi.transition,t=ft;try{if(bi.transition=null,ft=16>r?16:r,Pa===null)var n=!1;else{if(r=Pa,Pa=null,Ag=0,rt&6)throw Error(ee(331));var i=rt;for(rt|=4,ve=r.current;ve!==null;){var s=ve,o=s.child;if(ve.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(ve=l;ve!==null;){var d=ve;switch(d.tag){case 0:case 11:case 15:Vf(8,d,s)}var h=d.child;if(h!==null)h.return=d,ve=h;else for(;ve!==null;){d=ve;var p=d.sibling,b=d.return;if(Vk(d),d===l){ve=null;break}if(p!==null){p.return=b,ve=p;break}ve=b}}}var f=s.alternate;if(f!==null){var g=f.child;if(g!==null){f.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(g!==null)}}ve=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,ve=o;else e:for(;ve!==null;){if(s=ve,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Vf(9,s,s.return)}var y=s.sibling;if(y!==null){y.return=s.return,ve=y;break e}ve=s.return}}var w=r.current;for(ve=w;ve!==null;){o=ve;var m=o.child;if(o.subtreeFlags&2064&&m!==null)m.return=o,ve=m;else e:for(o=w;ve!==null;){if(a=ve,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:bg(9,a)}}catch(A){Ht(a,a.return,A)}if(a===o){ve=null;break e}var E=a.sibling;if(E!==null){E.return=a.return,ve=E;break e}ve=a.return}}if(rt=i,Ca(),Es&&typeof Es.onPostCommitFiberRoot=="function")try{Es.onPostCommitFiberRoot($0,r)}catch{}n=!0}return n}finally{ft=t,bi.transition=e}}return!1}function i_(r,e,t){e=ed(t,e),e=Sk(r,e,1),r=ka(r,e,1),e=cn(),r!==null&&(gf(r,1,e),An(r,e))}function Ht(r,e,t){if(r.tag===3)i_(r,r,t);else for(;e!==null;){if(e.tag===3){i_(e,r,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Ta===null||!Ta.has(n))){r=ed(t,r),r=xk(e,r,1),e=ka(e,r,1),r=cn(),e!==null&&(gf(e,1,r),An(e,r));break}}e=e.return}}function EG(r,e,t){var n=r.pingCache;n!==null&&n.delete(e),e=cn(),r.pingedLanes|=r.suspendedLanes&t,ur===r&&(br&t)===t&&(sr===4||sr===3&&(br&130023424)===br&&500>Gt()-Y8?al(r,0):J8|=t),An(r,e)}function s_(r,e){e===0&&(r.mode&1?(e=M0,M0<<=1,!(M0&130023424)&&(M0=4194304)):e=1);var t=cn();r=uo(r,e),r!==null&&(gf(r,e,t),An(r,t))}function SG(r){var e=r.memoizedState,t=0;e!==null&&(t=e.retryLane),s_(r,t)}function xG(r,e){var t=0;switch(r.tag){case 13:var n=r.stateNode,i=r.memoizedState;i!==null&&(t=i.retryLane);break;case 19:n=r.stateNode;break;default:throw Error(ee(314))}n!==null&&n.delete(e),s_(r,t)}var o_;o_=function(r,e,t){if(r!==null)if(r.memoizedProps!==e.pendingProps||vn.current)Sn=!0;else{if(!(r.lanes&t)&&!(e.flags&128))return Sn=!1,uG(r,e,t);Sn=!!(r.flags&131072)}else Sn=!1,Mt&&e.flags&1048576&&UI(e,rg,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;mg(r,e),r=e.pendingProps;var i=qu(e,Mr.current);Xu(e,t),i=_8(null,e,n,r,i,t);var s=T8();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,En(n)?(s=!0,Z0(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,E8(e),i.updater=gg,e.stateNode=i,i._reactInternals=e,O8(e,n,r,t),e=U8(null,e,n,!0,s,t)):(e.tag=0,Mt&&s&&d8(e),an(null,e,i,t),e=e.child),e;case 16:n=e.elementType;e:{switch(mg(r,e),r=e.pendingProps,i=n._init,n=i(n._payload),e.type=n,i=e.tag=CG(n),r=Wi(n,r),i){case 0:e=B8(null,e,n,r,t);break e;case 1:e=$k(null,e,n,r,t);break e;case 11:e=kk(null,e,n,r,t);break e;case 14:e=_k(null,e,n,Wi(n.type,r),t);break e}throw Error(ee(306,n,""))}return e;case 0:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Wi(n,i),B8(r,e,n,i,t);case 1:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Wi(n,i),$k(r,e,n,i,t);case 3:e:{if(Nk(e),r===null)throw Error(ee(387));n=e.pendingProps,s=e.memoizedState,i=s.element,GI(r,e),cg(e,n,null,t);var o=e.memoizedState;if(n=o.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=ed(Error(ee(423)),e),e=Mk(r,e,n,t,i);break e}else if(n!==i){i=ed(Error(ee(424)),e),e=Mk(r,e,n,t,i);break e}else for(Wn=Sa(e.stateNode.containerInfo.firstChild),qn=e,Mt=!0,qi=null,t=qI(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Qu(),n===i){e=fo(r,e,t);break e}an(r,e,n,t)}e=e.child}return e;case 5:return YI(e),r===null&&p8(e),n=e.type,i=e.pendingProps,s=r!==null?r.memoizedProps:null,o=i.children,s8(n,i)?o=null:s!==null&&s8(n,s)&&(e.flags|=32),Dk(r,e),an(r,e,o,t),e.child;case 6:return r===null&&p8(e),null;case 13:return Ok(r,e,t);case 4:return S8(e,e.stateNode.containerInfo),n=e.pendingProps,r===null?e.child=Ju(e,null,n,t):an(r,e,n,t),e.child;case 11:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Wi(n,i),kk(r,e,n,i,t);case 7:return an(r,e,e.pendingProps,t),e.child;case 8:return an(r,e,e.pendingProps.children,t),e.child;case 12:return an(r,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,Et(sg,n._currentValue),n._currentValue=o,s!==null)if(Hi(s.value,o)){if(s.children===i.children&&!vn.current){e=fo(r,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===n){if(s.tag===1){c=ho(-1,t&-t),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var d=l.pending;d===null?c.next=c:(c.next=d.next,d.next=c),l.pending=c}}s.lanes|=t,c=s.alternate,c!==null&&(c.lanes|=t),b8(s.return,t,e),a.lanes|=t;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(ee(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),b8(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}an(r,e,i.children,t),e=e.child}return e;case 9:return i=e.type,n=e.pendingProps.children,Xu(e,t),i=mi(i),n=n(i),e.flags|=1,an(r,e,n,t),e.child;case 14:return n=e.type,i=Wi(n,e.pendingProps),i=Wi(n.type,i),_k(r,e,n,i,t);case 15:return Tk(r,e,e.type,e.pendingProps,t);case 17:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Wi(n,i),mg(r,e),e.tag=1,En(n)?(r=!0,Z0(e)):r=!1,Xu(e,t),vk(e,n,i),O8(e,n,i,t),U8(null,e,n,!0,r,t);case 19:return Lk(r,e,t);case 22:return Pk(r,e,t)}throw Error(ee(156,e.tag))};function a_(r,e){return FC(r,e)}function AG(r,e,t,n){this.tag=r,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vi(r,e,t,n){return new AG(r,e,t,n)}function s6(r){return r=r.prototype,!(!r||!r.isReactComponent)}function CG(r){if(typeof r=="function")return s6(r)?1:0;if(r!=null){if(r=r.$$typeof,r===d5)return 11;if(r===p5)return 14}return 2}function Na(r,e){var t=r.alternate;return t===null?(t=vi(r.tag,e,r.key,r.mode),t.elementType=r.elementType,t.type=r.type,t.stateNode=r.stateNode,t.alternate=r,r.alternate=t):(t.pendingProps=e,t.type=r.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=r.flags&14680064,t.childLanes=r.childLanes,t.lanes=r.lanes,t.child=r.child,t.memoizedProps=r.memoizedProps,t.memoizedState=r.memoizedState,t.updateQueue=r.updateQueue,e=r.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=r.sibling,t.index=r.index,t.ref=r.ref,t}function _g(r,e,t,n,i,s){var o=2;if(n=r,typeof r=="function")s6(r)&&(o=1);else if(typeof r=="string")o=5;else e:switch(r){case Nu:return ll(t.children,i,s,e);case l5:o=8,i|=8;break;case u5:return r=vi(12,t,e,i|2),r.elementType=u5,r.lanes=s,r;case h5:return r=vi(13,t,e,i),r.elementType=h5,r.lanes=s,r;case f5:return r=vi(19,t,e,i),r.elementType=f5,r.lanes=s,r;case yC:return Tg(t,i,s,e);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case pC:o=10;break e;case gC:o=9;break e;case d5:o=11;break e;case p5:o=14;break e;case pa:o=16,n=null;break e}throw Error(ee(130,r==null?r:typeof r,""))}return e=vi(o,t,e,i),e.elementType=r,e.type=n,e.lanes=s,e}function ll(r,e,t,n){return r=vi(7,r,n,e),r.lanes=t,r}function Tg(r,e,t,n){return r=vi(22,r,n,e),r.elementType=yC,r.lanes=t,r.stateNode={isHidden:!1},r}function o6(r,e,t){return r=vi(6,r,null,e),r.lanes=t,r}function a6(r,e,t){return e=vi(4,r.children!==null?r.children:[],r.key,e),e.lanes=t,e.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},e}function IG(r,e,t,n,i){this.tag=e,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=M5(0),this.expirationTimes=M5(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=M5(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function c6(r,e,t,n,i,s,o,a,c){return r=new IG(r,e,t,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=vi(3,null,null,e),r.current=s,s.stateNode=r,s.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},E8(s),r}function kG(r,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$u,key:n==null?null:""+n,children:r,containerInfo:e,implementation:t}}function c_(r){if(!r)return Aa;r=r._reactInternals;e:{if(Yc(r)!==r||r.tag!==1)throw Error(ee(170));var e=r;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(En(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ee(171))}if(r.tag===1){var t=r.type;if(En(t))return RI(r,t,e)}return e}function l_(r,e,t,n,i,s,o,a,c){return r=c6(t,n,!0,r,i,s,o,a,c),r.context=c_(null),t=r.current,n=cn(),i=Da(t),s=ho(n,i),s.callback=e??null,ka(t,s,i),r.current.lanes=i,gf(r,i,n),An(r,n),r}function Pg(r,e,t,n){var i=e.current,s=cn(),o=Da(i);return t=c_(t),e.context===null?e.context=t:e.pendingContext=t,e=ho(s,o),e.payload={element:r},n=n===void 0?null:n,n!==null&&(e.callback=n),r=ka(i,e,o),r!==null&&(Ji(r,i,o,s),ag(r,i,o)),o}function Dg(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function u_(r,e){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var t=r.retryLane;r.retryLane=t!==0&&t<e?t:e}}function l6(r,e){u_(r,e),(r=r.alternate)&&u_(r,e)}function _G(){return null}var d_=typeof reportError=="function"?reportError:function(r){console.error(r)};function u6(r){this._internalRoot=r}$g.prototype.render=u6.prototype.render=function(r){var e=this._internalRoot;if(e===null)throw Error(ee(409));Pg(r,e,null,null)},$g.prototype.unmount=u6.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var e=r.containerInfo;ol(function(){Pg(null,r,null,null)}),e[oo]=null}};function $g(r){this._internalRoot=r}$g.prototype.unstable_scheduleHydration=function(r){if(r){var e=GC();r={blockedOn:null,target:r,priority:e};for(var t=0;t<ba.length&&e!==0&&e<ba[t].priority;t++);ba.splice(t,0,r),t===0&&YC(r)}};function d6(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Ng(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function h_(){}function TG(r,e,t,n,i){if(i){if(typeof n=="function"){var s=n;n=function(){var l=Dg(o);s.call(l)}}var o=l_(e,n,r,0,null,!1,!1,"",h_);return r._reactRootContainer=o,r[oo]=o.current,Tf(r.nodeType===8?r.parentNode:r),ol(),o}for(;i=r.lastChild;)r.removeChild(i);if(typeof n=="function"){var a=n;n=function(){var l=Dg(c);a.call(l)}}var c=c6(r,0,!1,null,null,!1,!1,"",h_);return r._reactRootContainer=c,r[oo]=c.current,Tf(r.nodeType===8?r.parentNode:r),ol(function(){Pg(e,c,t,n)}),c}function Mg(r,e,t,n,i){var s=t._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var c=Dg(o);a.call(c)}}Pg(e,o,r,i)}else o=TG(t,e,r,i,n);return Dg(o)}qC=function(r){switch(r.tag){case 3:var e=r.stateNode;if(e.current.memoizedState.isDehydrated){var t=pf(e.pendingLanes);t!==0&&(O5(e,t|1),An(e,Gt()),!(rt&6)&&(nd=Gt()+500,Ca()))}break;case 13:ol(function(){var n=uo(r,1);if(n!==null){var i=cn();Ji(n,r,1,i)}}),l6(r,1)}},R5=function(r){if(r.tag===13){var e=uo(r,134217728);if(e!==null){var t=cn();Ji(e,r,134217728,t)}l6(r,134217728)}},WC=function(r){if(r.tag===13){var e=Da(r),t=uo(r,e);if(t!==null){var n=cn();Ji(t,r,e,n)}l6(r,e)}},GC=function(){return ft},QC=function(r,e){var t=ft;try{return ft=r,e()}finally{ft=t}},_5=function(r,e,t){switch(e){case"input":if(v5(r,t),e=t.name,t.type==="radio"&&e!=null){for(t=r;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==r&&n.form===r.form){var i=Y0(n);if(!i)throw Error(ee(90));bC(n),v5(n,i)}}}break;case"textarea":AC(r,t);break;case"select":e=t.value,e!=null&&Mu(r,!!t.multiple,e,!1)}},NC=r6,MC=ol;var PG={usingClientEntryPoint:!1,Events:[$f,ju,Y0,DC,$C,r6]},qf={findFiberByHostInstance:Xc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},DG={bundleType:qf.bundleType,version:qf.version,rendererPackageName:qf.rendererPackageName,rendererConfig:qf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:so.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=BC(r),r===null?null:r.stateNode},findFiberByHostInstance:qf.findFiberByHostInstance||_G,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Og=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Og.isDisabled&&Og.supportsFiber)try{$0=Og.inject(DG),Es=Og}catch{}}Kn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=PG,Kn.createPortal=function(r,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d6(e))throw Error(ee(200));return kG(r,e,null,t)},Kn.createRoot=function(r,e){if(!d6(r))throw Error(ee(299));var t=!1,n="",i=d_;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=c6(r,1,!1,null,null,t,!1,n,i),r[oo]=e.current,Tf(r.nodeType===8?r.parentNode:r),new u6(e)},Kn.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var e=r._reactInternals;if(e===void 0)throw typeof r.render=="function"?Error(ee(188)):(r=Object.keys(r).join(","),Error(ee(268,r)));return r=BC(e),r=r===null?null:r.stateNode,r},Kn.flushSync=function(r){return ol(r)},Kn.hydrate=function(r,e,t){if(!Ng(e))throw Error(ee(200));return Mg(null,r,e,!0,t)},Kn.hydrateRoot=function(r,e,t){if(!d6(r))throw Error(ee(405));var n=t!=null&&t.hydratedSources||null,i=!1,s="",o=d_;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=l_(e,null,r,1,t??null,i,!1,s,o),r[oo]=e.current,Tf(r),n)for(r=0;r<n.length;r++)t=n[r],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new $g(e)},Kn.render=function(r,e,t){if(!Ng(e))throw Error(ee(200));return Mg(null,r,e,!1,t)},Kn.unmountComponentAtNode=function(r){if(!Ng(r))throw Error(ee(40));return r._reactRootContainer?(ol(function(){Mg(null,null,r,!1,function(){r._reactRootContainer=null,r[oo]=null})}),!0):!1},Kn.unstable_batchedUpdates=r6,Kn.unstable_renderSubtreeIntoContainer=function(r,e,t,n){if(!Ng(t))throw Error(ee(200));if(r==null||r._reactInternals===void 0)throw Error(ee(38));return Mg(r,e,t,!1,n)},Kn.version="18.3.1-next-f1338f8080-20240426";function f_(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(f_)}catch(r){console.error(r)}}f_(),cC.exports=Kn;var $G=cC.exports,p_,g_=$G;p_=g_.createRoot,g_.hydrateRoot;var h6={exports:{}},sd=typeof Reflect=="object"?Reflect:null,y_=sd&&typeof sd.apply=="function"?sd.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},Rg;sd&&typeof sd.ownKeys=="function"?Rg=sd.ownKeys:Object.getOwnPropertySymbols?Rg=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Rg=function(e){return Object.getOwnPropertyNames(e)};function NG(r){console&&console.warn&&console.warn(r)}var m_=Number.isNaN||function(e){return e!==e};function gt(){gt.init.call(this)}h6.exports=gt,h6.exports.once=LG,gt.EventEmitter=gt,gt.prototype._events=void 0,gt.prototype._eventsCount=0,gt.prototype._maxListeners=void 0;var w_=10;function Lg(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(gt,"defaultMaxListeners",{enumerable:!0,get:function(){return w_},set:function(r){if(typeof r!="number"||r<0||m_(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");w_=r}}),gt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},gt.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||m_(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function b_(r){return r._maxListeners===void 0?gt.defaultMaxListeners:r._maxListeners}gt.prototype.getMaxListeners=function(){return b_(this)},gt.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")y_(c,this,t);else for(var l=c.length,d=A_(c,l),n=0;n<l;++n)y_(d[n],this,t);return!0};function v_(r,e,t,n){var i,s,o;if(Lg(t),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),s=r._events),o=s[e]),o===void 0)o=s[e]=t,++r._eventsCount;else if(typeof o=="function"?o=s[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),i=b_(r),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=o.length,NG(a)}return r}gt.prototype.addListener=function(e,t){return v_(this,e,t,!1)},gt.prototype.on=gt.prototype.addListener,gt.prototype.prependListener=function(e,t){return v_(this,e,t,!0)};function MG(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function E_(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=MG.bind(n);return i.listener=t,n.wrapFn=i,i}gt.prototype.once=function(e,t){return Lg(t),this.on(e,E_(this,e,t)),this},gt.prototype.prependOnceListener=function(e,t){return Lg(t),this.prependListener(e,E_(this,e,t)),this},gt.prototype.removeListener=function(e,t){var n,i,s,o,a;if(Lg(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():OG(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this},gt.prototype.off=gt.prototype.removeListener,gt.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function S_(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?RG(i):A_(i,i.length)}gt.prototype.listeners=function(e){return S_(this,e,!0)},gt.prototype.rawListeners=function(e){return S_(this,e,!1)},gt.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):x_.call(r,e)},gt.prototype.listenerCount=x_;function x_(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}gt.prototype.eventNames=function(){return this._eventsCount>0?Rg(this._events):[]};function A_(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function OG(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function RG(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function LG(r,e){return new Promise(function(t,n){function i(o){r.removeListener(e,s),n(o)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}C_(r,e,s,{once:!0}),e!=="error"&&BG(r,i,{once:!0})})}function BG(r,e,t){typeof r.on=="function"&&C_(r,"error",e,t)}function C_(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(s){n.once&&r.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var Bg=h6.exports,I_={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(c,l,d){this.fn=c,this.context=l,this.once=d||!1}function s(c,l,d,h,p){if(typeof d!="function")throw new TypeError("The listener must be a function");var b=new i(d,h||c,p),f=t?t+l:l;return c._events[f]?c._events[f].fn?c._events[f]=[c._events[f],b]:c._events[f].push(b):(c._events[f]=b,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new n:delete c._events[l]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],d,h;if(this._eventsCount===0)return l;for(h in d=this._events)e.call(d,h)&&l.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},a.prototype.listeners=function(l){var d=t?t+l:l,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var p=0,b=h.length,f=new Array(b);p<b;p++)f[p]=h[p].fn;return f},a.prototype.listenerCount=function(l){var d=t?t+l:l,h=this._events[d];return h?h.fn?1:h.length:0},a.prototype.emit=function(l,d,h,p,b,f){var g=t?t+l:l;if(!this._events[g])return!1;var v=this._events[g],y=arguments.length,w,m;if(v.fn){switch(v.once&&this.removeListener(l,v.fn,void 0,!0),y){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,d),!0;case 3:return v.fn.call(v.context,d,h),!0;case 4:return v.fn.call(v.context,d,h,p),!0;case 5:return v.fn.call(v.context,d,h,p,b),!0;case 6:return v.fn.call(v.context,d,h,p,b,f),!0}for(m=1,w=new Array(y-1);m<y;m++)w[m-1]=arguments[m];v.fn.apply(v.context,w)}else{var E=v.length,A;for(m=0;m<E;m++)switch(v[m].once&&this.removeListener(l,v[m].fn,void 0,!0),y){case 1:v[m].fn.call(v[m].context);break;case 2:v[m].fn.call(v[m].context,d);break;case 3:v[m].fn.call(v[m].context,d,h);break;case 4:v[m].fn.call(v[m].context,d,h,p);break;default:if(!w)for(A=1,w=new Array(y-1);A<y;A++)w[A-1]=arguments[A];v[m].fn.apply(v[m].context,w)}}return!0},a.prototype.on=function(l,d,h){return s(this,l,d,h,!1)},a.prototype.once=function(l,d,h){return s(this,l,d,h,!0)},a.prototype.removeListener=function(l,d,h,p){var b=t?t+l:l;if(!this._events[b])return this;if(!d)return o(this,b),this;var f=this._events[b];if(f.fn)f.fn===d&&(!p||f.once)&&(!h||f.context===h)&&o(this,b);else{for(var g=0,v=[],y=f.length;g<y;g++)(f[g].fn!==d||p&&!f[g].once||h&&f[g].context!==h)&&v.push(f[g]);v.length?this._events[b]=v.length===1?v[0]:v:o(this,b)}return this},a.prototype.removeAllListeners=function(l){var d;return l?(d=t?t+l:l,this._events[d]&&o(this,d)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a})(I_);var UG=I_.exports;const FG=Xe(UG);let k_=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},zG=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const __=r=>globalThis.DOMException===void 0?new zG(r):new DOMException(r),T_=r=>{const e=r.reason===void 0?__("This operation was aborted."):r.reason;return e instanceof Error?e:__(e)};function Wf(r,e){const{milliseconds:t,fallback:n,message:i,customTimers:s={setTimeout,clearTimeout}}=e;let o,a;const l=new Promise((d,h)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:b}=e;b.aborted&&h(T_(b)),a=()=>{h(T_(b))},b.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){r.then(d,h);return}const p=new k_;o=s.setTimeout.call(void 0,()=>{if(n){try{d(n())}catch(b){h(b)}return}typeof r.cancel=="function"&&r.cancel(),i===!1?d():i instanceof Error?h(i):(p.message=i??`Promise timed out after ${t} milliseconds`,h(p))},t),(async()=>{try{d(await r)}catch(b){h(b)}})()}).finally(()=>{l.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return l.clear=()=>{s.clearTimeout.call(void 0,o),o=void 0},l}function VG(r,e,t){let n=0,i=r.length;for(;i>0;){const s=Math.trunc(i/2);let o=n+s;t(r[o],e)<=0?(n=++o,i-=s+1):i=s}return n}let KG=(Aj=class{constructor(){Ye(this,Fi,[])}enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,id:t.id,run:e};if(this.size===0||ae(this,Fi)[this.size-1].priority>=t.priority){ae(this,Fi).push(n);return}const i=VG(ae(this,Fi),n,(s,o)=>o.priority-s.priority);ae(this,Fi).splice(i,0,n)}setPriority(e,t){const n=ae(this,Fi).findIndex(s=>s.id===e);if(n===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[i]=ae(this,Fi).splice(n,1);this.enqueue(i.run,{priority:t,id:e})}dequeue(){const e=ae(this,Fi).shift();return e==null?void 0:e.run}filter(e){return ae(this,Fi).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return ae(this,Fi).length}},Fi=new WeakMap,Aj);class Ma extends FG{constructor(t){var n,i;super();Ye(this,ct);Ye(this,jh);Ye(this,Hh);Ye(this,Hc,0);Ye(this,u0);Ye(this,qh);Ye(this,d0,0);Ye(this,zi);Ye(this,Wh);Ye(this,mn);Ye(this,h0);Ye(this,Vi,0);Ye(this,Gh);Ye(this,ua);Ye(this,f0);Ye(this,V4,1n);u(this,"timeout");if(t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:KG,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((n=t.intervalCap)==null?void 0:n.toString())??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((i=t.interval)==null?void 0:i.toString())??""}\` (${typeof t.interval})`);_t(this,jh,t.carryoverConcurrencyCount),_t(this,Hh,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),_t(this,u0,t.intervalCap),_t(this,qh,t.interval),_t(this,mn,new t.queueClass),_t(this,h0,t.queueClass),this.concurrency=t.concurrency,this.timeout=t.timeout,_t(this,f0,t.throwOnTimeout===!0),_t(this,ua,t.autoStart===!1)}get concurrency(){return ae(this,Gh)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);_t(this,Gh,t),Ie(this,ct,q4).call(this)}setPriority(t,n){ae(this,mn).setPriority(t,n)}async add(t,n={}){return n.id??(n.id=(ro(this,V4)._++).toString()),n={timeout:this.timeout,throwOnTimeout:ae(this,f0),...n},new Promise((i,s)=>{ae(this,mn).enqueue(async()=>{var o;ro(this,Vi)._++,ro(this,Hc)._++;try{(o=n.signal)==null||o.throwIfAborted();let a=t({signal:n.signal});n.timeout&&(a=Wf(Promise.resolve(a),{milliseconds:n.timeout})),n.signal&&(a=Promise.race([a,Ie(this,ct,rq).call(this,n.signal)]));const c=await a;i(c),this.emit("completed",c)}catch(a){if(a instanceof k_&&!n.throwOnTimeout){i();return}s(a),this.emit("error",a)}finally{Ie(this,ct,ZH).call(this)}},n),this.emit("add"),Ie(this,ct,H4).call(this)})}async addAll(t,n){return Promise.all(t.map(async i=>this.add(i,n)))}start(){return ae(this,ua)?(_t(this,ua,!1),Ie(this,ct,q4).call(this),this):this}pause(){_t(this,ua,!0)}clear(){_t(this,mn,new(ae(this,h0)))}async onEmpty(){ae(this,mn).size!==0&&await Ie(this,ct,W4).call(this,"empty")}async onSizeLessThan(t){ae(this,mn).size<t||await Ie(this,ct,W4).call(this,"next",()=>ae(this,mn).size<t)}async onIdle(){ae(this,Vi)===0&&ae(this,mn).size===0||await Ie(this,ct,W4).call(this,"idle")}get size(){return ae(this,mn).size}sizeBy(t){return ae(this,mn).filter(t).length}get pending(){return ae(this,Vi)}get isPaused(){return ae(this,ua)}}jh=new WeakMap,Hh=new WeakMap,Hc=new WeakMap,u0=new WeakMap,qh=new WeakMap,d0=new WeakMap,zi=new WeakMap,Wh=new WeakMap,mn=new WeakMap,h0=new WeakMap,Vi=new WeakMap,Gh=new WeakMap,ua=new WeakMap,f0=new WeakMap,V4=new WeakMap,ct=new WeakSet,YH=function(){return ae(this,Hh)||ae(this,Hc)<ae(this,u0)},XH=function(){return ae(this,Vi)<ae(this,Gh)},ZH=function(){ro(this,Vi)._--,Ie(this,ct,H4).call(this),this.emit("next")},eq=function(){Ie(this,ct,qA).call(this),Ie(this,ct,HA).call(this),_t(this,Wh,void 0)},tq=function(){const t=Date.now();if(ae(this,zi)===void 0){const n=ae(this,d0)-t;if(n<0)_t(this,Hc,ae(this,jh)?ae(this,Vi):0);else return ae(this,Wh)===void 0&&_t(this,Wh,setTimeout(()=>{Ie(this,ct,eq).call(this)},n)),!0}return!1},H4=function(){if(ae(this,mn).size===0)return ae(this,zi)&&clearInterval(ae(this,zi)),_t(this,zi,void 0),this.emit("empty"),ae(this,Vi)===0&&this.emit("idle"),!1;if(!ae(this,ua)){const t=!ae(this,ct,tq);if(ae(this,ct,YH)&&ae(this,ct,XH)){const n=ae(this,mn).dequeue();return n?(this.emit("active"),n(),t&&Ie(this,ct,HA).call(this),!0):!1}}return!1},HA=function(){ae(this,Hh)||ae(this,zi)!==void 0||(_t(this,zi,setInterval(()=>{Ie(this,ct,qA).call(this)},ae(this,qh))),_t(this,d0,Date.now()+ae(this,qh)))},qA=function(){ae(this,Hc)===0&&ae(this,Vi)===0&&ae(this,zi)&&(clearInterval(ae(this,zi)),_t(this,zi,void 0)),_t(this,Hc,ae(this,jh)?ae(this,Vi):0),Ie(this,ct,q4).call(this)},q4=function(){for(;Ie(this,ct,H4).call(this););},rq=async function(t){return new Promise((n,i)=>{t.addEventListener("abort",()=>{i(t.reason)},{once:!0})})},W4=async function(t,n){return new Promise(i=>{const s=()=>{n&&!n()||(this.off(t,s),i())};this.on(t,s)})};function Le(){const r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}class P_{constructor(e){u(this,"buffer");u(this,"mask");u(this,"top");u(this,"btm");u(this,"next");if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class f6{constructor(e={}){u(this,"size");u(this,"hwm");u(this,"head");u(this,"tail");this.hwm=e.splitLimit??16,this.head=new P_(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new P_(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let jG=class extends Error{constructor(t,n){super(t??"The operation was aborted");u(this,"type");u(this,"code");this.type="aborted",this.code=n??"ABORT_ERR"}};function go(r={}){return HG(t=>{const n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function HG(r,e){e=e??{};let t=e.onEnd,n=new f6,i,s,o,a=Le();const c=async()=>{try{return n.isEmpty()?o?{done:!0}:await new Promise((v,y)=>{s=w=>{s=null,n.push(w);try{v(r(n))}catch(m){y(m)}return i}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=Le()})}},l=v=>s!=null?s(v):(n.push(v),i),d=v=>(n=new f6,s!=null?s({error:v}):(n.push({error:v}),i)),h=v=>{if(o)return i;if((e==null?void 0:e.objectMode)!==!0&&(v==null?void 0:v.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:v})},p=v=>o?i:(o=!0,v!=null?d(v):l({done:!0})),b=()=>(n=new f6,p(),{done:!0}),f=v=>(p(v),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:c,return:b,throw:f,push:h,end:p,get readableLength(){return n.size},onEmpty:async v=>{const y=v==null?void 0:v.signal;if(y==null||y.throwIfAborted(),n.isEmpty())return;let w,m;y!=null&&(w=new Promise((E,A)=>{m=()=>{A(new jG)},y.addEventListener("abort",m)}));try{await Promise.race([a.promise,w])}finally{m!=null&&y!=null&&(y==null||y.removeEventListener("abort",m))}}},t==null)return i;const g=i;return i={[Symbol.asyncIterator](){return this},next(){return g.next()},throw(v){return g.throw(v),t!=null&&(t(v),t=void 0),{done:!0}},return(){return g.return(),t!=null&&(t(),t=void 0),{done:!0}},push:h,end(v){return g.end(v),t!=null&&(t(v),t=void 0),i},get readableLength(){return g.readableLength},onEmpty:v=>g.onEmpty(v)},i}let D_=class extends Error{constructor(t,n,i){super(t??"The operation was aborted");u(this,"type");u(this,"code");this.type="aborted",this.name=i??"AbortError",this.code=n??"ABORT_ERR"}};async function ln(r,e,t){if(e==null)return r;if(e.aborted)return r.catch(()=>{}),Promise.reject(new D_(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName));let n;const i=new D_(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName);try{return await Promise.race([r,new Promise((s,o)=>{n=()=>{o(i)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}}let qG=class{constructor(){u(this,"readNext");u(this,"haveNext");u(this,"ended");u(this,"nextResult");u(this,"error");this.ended=!1,this.readNext=Le(),this.haveNext=Le()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Le(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Le(),await ln(this.readNext.promise,t==null?void 0:t.signal,t)}};function WG(){return new qG}function GG(r){return r[Symbol.asyncIterator]!=null}async function QG(r,e){try{await Promise.all(r.map(async t=>{for await(const n of t)await e.push(n)})),await e.end()}catch(t){await e.end(t).catch(()=>{})}}async function*JG(r){const e=WG();QG(r,e).catch(()=>{}),yield*e}function*YG(r){for(const e of r)yield*e}function Oa(...r){const e=[];for(const t of r)GG(t)||e.push(t);return e.length===r.length?YG(e):JG(r)}function un(r,...e){if(r==null)throw new Error("Empty pipeline");if(p6(r)){const n=r;r=()=>n.source}else if(N_(r)||$_(r)){const n=r;r=()=>n}const t=[r,...e];if(t.length>1&&p6(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)p6(t[n])&&(t[n]=ZG(t[n]));return XG(...t)}const XG=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},$_=r=>(r==null?void 0:r[Symbol.asyncIterator])!=null,N_=r=>(r==null?void 0:r[Symbol.iterator])!=null,p6=r=>r==null?!1:r.sink!=null&&r.source!=null,ZG=r=>e=>{const t=r.sink(e);if((t==null?void 0:t.then)!=null){const n=go({objectMode:!0});t.then(()=>{n.end()},o=>{n.end(o)});let i;const s=r.source;if($_(s))i=async function*(){yield*s,n.end()};else if(N_(s))i=function*(){yield*s,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return Oa(n,i())}return r.source};var eQ=function(){return Date.now()};const Ug=eQ;class tQ{constructor(e,t,n){const i=this;this._started=Ug(),this._rescheduled=0,this._scheduled=t,this._args=n,this._triggered=!1,this._timerWrapper=()=>{i._rescheduled>0?(i._scheduled=i._rescheduled-(Ug()-i._started),i._schedule(i._scheduled)):(i._triggered=!0,e.apply(null,i._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);const t=Ug();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=Ug(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}}function rQ(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("timeout needed");let r;if(arguments.length>0){r=new Array(arguments.length-2);for(var e=0;e<r.length;e++)r[e]=arguments[e+2]}return new tQ(arguments[0],arguments[1],r)}var nQ=rQ;const{AbortController:iQ}=globalThis,M_=nQ;class g6 extends iQ{constructor(e){super(),this._ms=e,this._timer=M_(()=>this.abort(),e),Object.setPrototypeOf(this,g6.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=M_(()=>this.abort(),this._ms)}}var y6={TimeoutController:g6};const Ra=(...r)=>r.join("/").replace(new RegExp("((?<=\\/)\\/+)|(^\\.\\/)|((?<=\\/)\\.\\/)","g"),"")||".",sQ=3e4,oQ=async({ipfs:r,log:e,events:t,onSynced:n,start:i,timeout:s})=>{if(!r)throw new Error("An instance of ipfs is required.");if(!e)throw new Error("An instance of log is required.");const o=r.libp2p,a=r.libp2p.services.pubsub,c=e.id,l=Ra("/orbitdb/heads/",c),d=new Ma({concurrency:1}),h=new Set;t=t||new Bg.EventEmitter,s=s||sQ;let p=!1;const b=async x=>{const I=await e.heads();t.emit("join",x,I)},f=x=>async function*(){const I=await e.heads();for await(const{bytes:T}of I)yield T}(),g=x=>async I=>{for await(const T of I){const L=T.subarray();L&&n&&await n(L)}p&&await b(x)},v=async({connection:x,stream:I})=>{const T=String(x.remotePeer);try{h.add(T),await un(I,g(T),f,I)}catch(L){h.delete(T),t.emit("error",L)}},y=async x=>{const I=async()=>{const{peerId:T,subscriptions:L}=x.detail,z=String(T),B=L.find(G=>G.topic===c);if(B)if(B.subscribe){if(h.has(z))return;const G=new y6.TimeoutController(s),{signal:j}=G;try{h.add(z);const q=await o.dialProtocol(T,l,{signal:j});await un(f,q,g(z))}catch(q){h.delete(z),q.name==="UnsupportedProtocolError"||t.emit("error",q)}finally{G&&G.clear()}}else h.delete(z),t.emit("leave",z)};d.add(I)},w=async x=>{const{topic:I,data:T}=x.detail,L=async()=>{try{T&&n&&await n(T)}catch(z){t.emit("error",z)}};I===c&&d.add(L)},m=async x=>{h.delete(x.detail.toString())},E=async x=>{p&&await a.publish(c,x.bytes)},A=async()=>{p&&(p=!1,await d.onIdle(),a.removeEventListener("subscription-change",y),a.removeEventListener("message",w),await o.unhandle(l),await a.unsubscribe(c),o.removeEventListener("peer:disconnect",m),h.clear())},k=async()=>{p||(await o.handle(l,v),a.addEventListener("subscription-change",y),a.addEventListener("message",w),await a.subscribe(c),o.addEventListener("peer:disconnect",m),p=!0)};return i!==!1&&await k(),{add:E,stop:A,start:k,events:t,peers:h}};var m6={exports:{}};typeof Object.create=="function"?m6.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:m6.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}};var aQ=m6.exports,O_=Bg,cQ=aQ,lQ=Qn;function Qn(r){if(!(this instanceof Qn))return new Qn(r);typeof r=="number"&&(r={max:r}),r||(r={}),O_.EventEmitter.call(this),this.cache={},this.head=this.tail=null,this.length=0,this.max=r.max||1e3,this.maxAge=r.maxAge||0}cQ(Qn,O_.EventEmitter),Object.defineProperty(Qn.prototype,"keys",{get:function(){return Object.keys(this.cache)}}),Qn.prototype.clear=function(){this.cache={},this.head=this.tail=null,this.length=0},Qn.prototype.remove=function(r){if(typeof r!="string"&&(r=""+r),!!this.cache.hasOwnProperty(r)){var e=this.cache[r];return delete this.cache[r],this._unlink(r,e.prev,e.next),e.value}},Qn.prototype._unlink=function(r,e,t){this.length--,this.length===0?this.head=this.tail=null:this.head===r?(this.head=e,this.cache[this.head].next=null):this.tail===r?(this.tail=t,this.cache[this.tail].prev=null):(this.cache[e].next=t,this.cache[t].prev=e)},Qn.prototype.peek=function(r){if(this.cache.hasOwnProperty(r)){var e=this.cache[r];if(this._checkAge(r,e))return e.value}},Qn.prototype.set=function(r,e){typeof r!="string"&&(r=""+r);var t;if(this.cache.hasOwnProperty(r)){if(t=this.cache[r],t.value=e,this.maxAge&&(t.modified=Date.now()),r===this.head)return e;this._unlink(r,t.prev,t.next)}else t={value:e,modified:0,next:null,prev:null},this.maxAge&&(t.modified=Date.now()),this.cache[r]=t,this.length===this.max&&this.evict();return this.length++,t.next=null,t.prev=this.head,this.head&&(this.cache[this.head].next=r),this.head=r,this.tail||(this.tail=r),e},Qn.prototype._checkAge=function(r,e){return this.maxAge&&Date.now()-e.modified>this.maxAge?(this.remove(r),this.emit("evict",{key:r,value:e.value}),!1):!0},Qn.prototype.get=function(r){if(typeof r!="string"&&(r=""+r),!!this.cache.hasOwnProperty(r)){var e=this.cache[r];if(this._checkAge(r,e))return this.head!==r&&(r===this.tail?(this.tail=e.next,this.cache[this.tail].prev=null):this.cache[e.prev].next=e.next,this.cache[e.next].prev=e.prev,this.cache[this.head].next=r,e.prev=this.head,e.next=null,this.head=r),e.value}},Qn.prototype.evict=function(){if(this.tail){var r=this.tail,e=this.remove(this.tail);this.emit("evict",{key:r,value:e})}};const w6=Xe(lQ),uQ=(r,e)=>{const t=r.time-e.time;return t===0&&r.id!==e.id?r.id<e.id?-1:1:t},dQ=r=>Fg(r.id,++r.time),Fg=(r,e)=>(e=e||0,{id:r,time:e}),hQ=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},b6=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};function fQ(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var pQ=fQ,gQ=pQ;let yQ=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},mQ=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return R_(this,e)}},wQ=class{constructor(e){this.decoders=e}or(e){return R_(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const R_=(r,e)=>new wQ({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let bQ=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new yQ(e,t,n),this.decoder=new mQ(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const L_=({name:r,prefix:e,encode:t,decode:n})=>new bQ(r,e,t,n),B_=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:i}=gQ(t,e);return L_({prefix:r,name:e,encode:n,decode:s=>b6(i(s))})},vQ=(r,e,t,n)=>{const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},EQ=(r,e,t)=>{const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s},yo=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>L_({prefix:e,name:r,encode(i){return EQ(i,n,t)},decode(i){return vQ(i,n,t,r)}}),zg=yo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});yo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),yo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),yo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),yo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),yo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),yo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),yo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),yo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const dn=B_({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});B_({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var SQ=F_,U_=128,xQ=-128,AQ=Math.pow(2,31);function F_(r,e,t){e=e||[],t=t||0;for(var n=t;r>=AQ;)e[t++]=r&255|U_,r/=128;for(;r&xQ;)e[t++]=r&255|U_,r>>>=7;return e[t]=r|0,F_.bytes=t-n+1,e}var CQ=v6,IQ=128,z_=127;function v6(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw v6.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&z_)<<i:(o&z_)*Math.pow(2,i),i+=7}while(o>=IQ);return v6.bytes=s-n,t}var kQ=Math.pow(2,7),_Q=Math.pow(2,14),TQ=Math.pow(2,21),PQ=Math.pow(2,28),DQ=Math.pow(2,35),$Q=Math.pow(2,42),NQ=Math.pow(2,49),MQ=Math.pow(2,56),OQ=Math.pow(2,63),RQ=function(r){return r<kQ?1:r<_Q?2:r<TQ?3:r<PQ?4:r<DQ?5:r<$Q?6:r<NQ?7:r<MQ?8:r<OQ?9:10},LQ={encode:SQ,decode:CQ,encodingLength:RQ},Vg=LQ;const E6=(r,e=0)=>[Vg.decode(r,e),Vg.decode.bytes],Kg=(r,e,t=0)=>(Vg.encode(r,e,t),e),jg=r=>Vg.encodingLength(r),S6=(r,e)=>{const t=e.byteLength,n=jg(r),i=n+jg(t),s=new Uint8Array(i+t);return Kg(r,s,0),Kg(t,s,n),s.set(e,i),new x6(r,t,e,s)},BQ=r=>{const e=b6(r),[t,n]=E6(e),[i,s]=E6(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new x6(t,i,o,e)},UQ=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&hQ(r.bytes,t.bytes)}};let x6=class{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}};const V_=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return zQ(t,A6(r),e||dn.encoder);default:return VQ(t,A6(r),e||zg.encoder)}},K_=new WeakMap,A6=r=>{const e=K_.get(r);if(e==null){const t=new Map;return K_.set(r,t),t}return e};let Yi=class jr{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Gf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==KQ)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return jr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=S6(e,t);return jr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return jr.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&UQ(e.multihash,n.multihash)}toString(e){return V_(this,e)}toJSON(){return{"/":V_(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof jr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new jr(n,i,s,o||j_(n,i,s.bytes))}else if(t[jQ]===!0){const{version:n,multihash:i,code:s}=t,o=BQ(i);return jr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Gf)throw new Error(`Version 0 CID must use dag-pb (code: ${Gf}) block encoding`);return new jr(e,t,n,n.bytes)}case 1:{const i=j_(e,t,n.bytes);return new jr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return jr.create(0,Gf,e)}static createV1(e,t){return jr.create(1,e,t)}static decode(e){const[t,n]=jr.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=jr.inspectBytes(e),n=t.size-t.multihashSize,i=b6(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new x6(t.multihashCode,t.digestSize,s,i);return[t.version===0?jr.createV0(o):jr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=E6(e.subarray(t));return t+=p,h};let i=n(),s=Gf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=FQ(e,t),s=jr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return A6(s).set(n,e),s}};const FQ=(r,e)=>{switch(r[0]){case"Q":{const t=e||dn;return[dn.prefix,t.decode(`${dn.prefix}${r}`)]}case dn.prefix:{const t=e||dn;return[dn.prefix,t.decode(r)]}case zg.prefix:{const t=e||zg;return[zg.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},zQ=(r,e,t)=>{const{prefix:n}=t;if(n!==dn.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i},VQ=(r,e,t)=>{const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i},Gf=112,KQ=18,j_=(r,e,t)=>{const n=jg(r),i=n+jg(e),s=new Uint8Array(i+t.byteLength);return Kg(r,s,0),Kg(e,s,n),s.set(t,i),s},jQ=Symbol.for("@ipld/js-cid/CID"),HQ=({name:r,code:e,encode:t})=>new qQ(r,e,t);let qQ=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?S6(this.code,t):t.then(n=>S6(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Hg({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*WQ(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t],s=Yi.asCID(n);s?yield[i.join("/"),s]:typeof n=="object"&&(yield*C6(n,i))}else{const t=Yi.asCID(e);t?yield[r.join("/"),t]:yield*C6(e,r)}}function*C6(r,e){if(r==null||r instanceof Uint8Array)return;const t=Yi.asCID(r);t&&(yield[e.join("/"),t]);for(const[n,i]of Object.entries(r)){const s=[...e,n];yield*WQ(s,i)}}function*GQ(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t];yield i.join("/"),typeof n=="object"&&!Yi.asCID(n)&&(yield*I6(n,i))}else yield*I6(e,r)}function*I6(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const i=[...e,t];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!Yi.asCID(n)&&(yield*GQ(i,n))}}function QQ(r,e){let t=r;for(const[n,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);const s=Yi.asCID(t);if(s)return{value:s,remaining:e.slice(n+1).join("/")}}return{value:t}}let H_=class{constructor({cid:e,bytes:t,value:n}){if(!e||!t||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:Hg(),bytes:Hg(),value:Hg(),asBlock:Hg()})}links(){return C6(this.value,[])}tree(){return I6(this.value,[])}get(e="/"){return QQ(this.value,e.split("/").filter(Boolean))}};async function od({value:r,codec:e,hasher:t}){if(typeof r>"u")throw new Error('Missing required argument "value"');if(!e||!t)throw new Error("Missing required argument: codec or hasher");const n=e.encode(r),i=await t.digest(n),s=Yi.create(1,e.code,i);return new H_({value:r,bytes:n,cid:s})}async function qg({bytes:r,codec:e,hasher:t}){if(!r)throw new Error('Missing required argument "bytes"');if(!e||!t)throw new Error("Missing required argument: codec or hasher");const n=e.decode(r),i=await t.digest(r),s=Yi.create(1,e.code,i);return new H_({value:n,bytes:r,cid:s})}const JQ=["string","number","bigint","symbol"],YQ=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function XQ(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";const e=typeof r;if(JQ.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(ZQ(r))return"Buffer";const t=eJ(r);return t||"Object"}function ZQ(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function eJ(r){const e=Object.prototype.toString.call(r).slice(8,-1);if(YQ.includes(e))return e}class V{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}V.uint=new V(0,"uint",!0),V.negint=new V(1,"negint",!0),V.bytes=new V(2,"bytes",!0),V.string=new V(3,"string",!0),V.array=new V(4,"array",!1),V.map=new V(5,"map",!1),V.tag=new V(6,"tag",!1),V.float=new V(7,"float",!0),V.false=new V(7,"false",!0),V.true=new V(7,"true",!0),V.null=new V(7,"null",!0),V.undefined=new V(7,"undefined",!0),V.break=new V(7,"break",!0);class ie{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const ad=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",tJ=new TextDecoder,rJ=new TextEncoder;function Wg(r){return ad&&globalThis.Buffer.isBuffer(r)}function k6(r){return r instanceof Uint8Array?Wg(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}const nJ=ad?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):G_(r,e,t):(r,e,t)=>t-e>64?tJ.decode(r.subarray(e,t)):G_(r,e,t),q_=ad?r=>r.length>64?globalThis.Buffer.from(r):W_(r):r=>r.length>64?rJ.encode(r):W_(r),mo=r=>Uint8Array.from(r),_6=ad?(r,e,t)=>Wg(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),iJ=ad?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),k6(globalThis.Buffer.concat(r,e))):(r,e)=>{const t=new Uint8Array(e);let n=0;for(let i of r)n+i.length>t.length&&(i=i.subarray(0,t.length-n)),t.set(i,n),n+=i.length;return t},sJ=ad?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function oJ(r,e){if(Wg(r)&&Wg(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function W_(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e}function G_(r,e,t){const n=[];for(;e<t;){const i=r[e];let s=null,o=i>239?4:i>223?3:i>191?2:1;if(e+o<=t){let a,c,l,d;switch(o){case 1:i<128&&(s=i);break;case 2:a=r[e+1],(a&192)===128&&(d=(i&31)<<6|a&63,d>127&&(s=d));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(d=(i&15)<<12|(a&63)<<6|c&63,d>2047&&(d<55296||d>57343)&&(s=d));break;case 4:a=r[e+1],c=r[e+2],l=r[e+3],(a&192)===128&&(c&192)===128&&(l&192)===128&&(d=(i&15)<<18|(a&63)<<12|(c&63)<<6|l&63,d>65535&&d<1114112&&(s=d))}}s===null?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|s&1023),n.push(s),e+=o}return J_(n)}const Q_=4096;function J_(r){const e=r.length;if(e<=Q_)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=Q_));return t}const aJ=256;class Y_{constructor(e=aJ){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const i=t.length-(this.maxCursor-this.cursor)-1;t.set(e,i)}else{if(t){const i=t.length-(this.maxCursor-this.cursor)-1;i<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,i),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=sJ(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=_6(n,0,this.cursor)}else t=iJ(this.chunks,this.cursor);return e&&this.reset(),t}}const ke="CBOR decode error:",ul="CBOR encode error:";function cd(r,e,t){if(r.length-e<t)throw new Error(`${ke} not enough data for type`)}const vr=[24,256,65536,4294967296,BigInt("18446744073709551616")];function dl(r,e,t){cd(r,e,1);const n=r[e];if(t.strict===!0&&n<vr[0])throw new Error(`${ke} integer encoded in more bytes than necessary (strict decode)`);return n}function hl(r,e,t){cd(r,e,2);const n=r[e]<<8|r[e+1];if(t.strict===!0&&n<vr[1])throw new Error(`${ke} integer encoded in more bytes than necessary (strict decode)`);return n}function fl(r,e,t){cd(r,e,4);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<vr[2])throw new Error(`${ke} integer encoded in more bytes than necessary (strict decode)`);return n}function pl(r,e,t){cd(r,e,8);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],i=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],s=(BigInt(n)<<BigInt(32))+BigInt(i);if(t.strict===!0&&s<vr[3])throw new Error(`${ke} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(t.allowBigInt===!0)return s;throw new Error(`${ke} integers outside of the safe integer range are not supported`)}function cJ(r,e,t,n){return new ie(V.uint,dl(r,e+1,n),2)}function lJ(r,e,t,n){return new ie(V.uint,hl(r,e+1,n),3)}function uJ(r,e,t,n){return new ie(V.uint,fl(r,e+1,n),5)}function dJ(r,e,t,n){return new ie(V.uint,pl(r,e+1,n),9)}function gl(r,e){return Ei(r,0,e.value)}function Ei(r,e,t){if(t<vr[0]){const n=Number(t);r.push([e|n])}else if(t<vr[1]){const n=Number(t);r.push([e|24,n])}else if(t<vr[2]){const n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<vr[3]){const n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{const n=BigInt(t);if(n<vr[4]){const i=[e|27,0,0,0,0,0,0,0];let s=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=s&255,s=s>>8,i[7]=s&255,s=s>>8,i[6]=s&255,s=s>>8,i[5]=s&255,i[4]=o&255,o=o>>8,i[3]=o&255,o=o>>8,i[2]=o&255,o=o>>8,i[1]=o&255,r.push(i)}else throw new Error(`${ke} encountered BigInt larger than allowable range`)}}gl.encodedSize=function(e){return Ei.encodedSize(e.value)},Ei.encodedSize=function(e){return e<vr[0]?1:e<vr[1]?2:e<vr[2]?3:e<vr[3]?5:9},gl.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function hJ(r,e,t,n){return new ie(V.negint,-1-dl(r,e+1,n),2)}function fJ(r,e,t,n){return new ie(V.negint,-1-hl(r,e+1,n),3)}function pJ(r,e,t,n){return new ie(V.negint,-1-fl(r,e+1,n),5)}const T6=BigInt(-1),X_=BigInt(1);function gJ(r,e,t,n){const i=pl(r,e+1,n);if(typeof i!="bigint"){const s=-1-i;if(s>=Number.MIN_SAFE_INTEGER)return new ie(V.negint,s,9)}if(n.allowBigInt!==!0)throw new Error(`${ke} integers outside of the safe integer range are not supported`);return new ie(V.negint,T6-BigInt(i),9)}function P6(r,e){const t=e.value,n=typeof t=="bigint"?t*T6-X_:t*-1-1;Ei(r,e.type.majorEncoded,n)}P6.encodedSize=function(e){const t=e.value,n=typeof t=="bigint"?t*T6-X_:t*-1-1;return n<vr[0]?1:n<vr[1]?2:n<vr[2]?3:n<vr[3]?5:9},P6.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function Qf(r,e,t,n){cd(r,e,t+n);const i=_6(r,e+t,e+t+n);return new ie(V.bytes,i,t+n)}function yJ(r,e,t,n){return Qf(r,e,1,t)}function mJ(r,e,t,n){return Qf(r,e,2,dl(r,e+1,n))}function wJ(r,e,t,n){return Qf(r,e,3,hl(r,e+1,n))}function bJ(r,e,t,n){return Qf(r,e,5,fl(r,e+1,n))}function vJ(r,e,t,n){const i=pl(r,e+1,n);if(typeof i=="bigint")throw new Error(`${ke} 64-bit integer bytes lengths not supported`);return Qf(r,e,9,i)}function Gg(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===V.string?q_(r.value):r.value),r.encodedBytes}function Qg(r,e){const t=Gg(e);Ei(r,e.type.majorEncoded,t.length),r.push(t)}Qg.encodedSize=function(e){const t=Gg(e);return Ei.encodedSize(t.length)+t.length},Qg.compareTokens=function(e,t){return EJ(Gg(e),Gg(t))};function EJ(r,e){return r.length<e.length?-1:r.length>e.length?1:oJ(r,e)}function Jf(r,e,t,n,i){const s=t+n;cd(r,e,s);const o=new ie(V.string,nJ(r,e+t,e+s),s);return i.retainStringBytes===!0&&(o.byteValue=_6(r,e+t,e+s)),o}function SJ(r,e,t,n){return Jf(r,e,1,t,n)}function xJ(r,e,t,n){return Jf(r,e,2,dl(r,e+1,n),n)}function AJ(r,e,t,n){return Jf(r,e,3,hl(r,e+1,n),n)}function CJ(r,e,t,n){return Jf(r,e,5,fl(r,e+1,n),n)}function IJ(r,e,t,n){const i=pl(r,e+1,n);if(typeof i=="bigint")throw new Error(`${ke} 64-bit integer string lengths not supported`);return Jf(r,e,9,i,n)}const kJ=Qg;function ld(r,e,t,n){return new ie(V.array,n,t)}function _J(r,e,t,n){return ld(r,e,1,t)}function TJ(r,e,t,n){return ld(r,e,2,dl(r,e+1,n))}function PJ(r,e,t,n){return ld(r,e,3,hl(r,e+1,n))}function DJ(r,e,t,n){return ld(r,e,5,fl(r,e+1,n))}function $J(r,e,t,n){const i=pl(r,e+1,n);if(typeof i=="bigint")throw new Error(`${ke} 64-bit integer array lengths not supported`);return ld(r,e,9,i)}function NJ(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${ke} indefinite length items not allowed`);return ld(r,e,1,1/0)}function D6(r,e){Ei(r,V.array.majorEncoded,e.value)}D6.compareTokens=gl.compareTokens,D6.encodedSize=function(e){return Ei.encodedSize(e.value)};function ud(r,e,t,n){return new ie(V.map,n,t)}function MJ(r,e,t,n){return ud(r,e,1,t)}function OJ(r,e,t,n){return ud(r,e,2,dl(r,e+1,n))}function RJ(r,e,t,n){return ud(r,e,3,hl(r,e+1,n))}function LJ(r,e,t,n){return ud(r,e,5,fl(r,e+1,n))}function BJ(r,e,t,n){const i=pl(r,e+1,n);if(typeof i=="bigint")throw new Error(`${ke} 64-bit integer map lengths not supported`);return ud(r,e,9,i)}function UJ(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${ke} indefinite length items not allowed`);return ud(r,e,1,1/0)}function $6(r,e){Ei(r,V.map.majorEncoded,e.value)}$6.compareTokens=gl.compareTokens,$6.encodedSize=function(e){return Ei.encodedSize(e.value)};function FJ(r,e,t,n){return new ie(V.tag,t,1)}function zJ(r,e,t,n){return new ie(V.tag,dl(r,e+1,n),2)}function VJ(r,e,t,n){return new ie(V.tag,hl(r,e+1,n),3)}function KJ(r,e,t,n){return new ie(V.tag,fl(r,e+1,n),5)}function jJ(r,e,t,n){return new ie(V.tag,pl(r,e+1,n),9)}function N6(r,e){Ei(r,V.tag.majorEncoded,e.value)}N6.compareTokens=gl.compareTokens,N6.encodedSize=function(e){return Ei.encodedSize(e.value)};const HJ=20,qJ=21,WJ=22,GJ=23;function QJ(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${ke} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new ie(V.null,null,1):new ie(V.undefined,void 0,1)}function JJ(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${ke} indefinite length items not allowed`);return new ie(V.break,void 0,1)}function M6(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${ke} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${ke} Infinity values are not supported`)}return new ie(V.float,r,e)}function YJ(r,e,t,n){return M6(R6(r,e+1),3,n)}function XJ(r,e,t,n){return M6(L6(r,e+1),5,n)}function ZJ(r,e,t,n){return M6(rT(r,e+1),9,n)}function O6(r,e,t){const n=e.value;if(n===!1)r.push([V.float.majorEncoded|HJ]);else if(n===!0)r.push([V.float.majorEncoded|qJ]);else if(n===null)r.push([V.float.majorEncoded|WJ]);else if(n===void 0)r.push([V.float.majorEncoded|GJ]);else{let i,s=!1;(!t||t.float64!==!0)&&(eT(n),i=R6(Xi,1),n===i||Number.isNaN(n)?(Xi[0]=249,r.push(Xi.slice(0,3)),s=!0):(tT(n),i=L6(Xi,1),n===i&&(Xi[0]=250,r.push(Xi.slice(0,5)),s=!0))),s||(eY(n),i=rT(Xi,1),Xi[0]=251,r.push(Xi.slice(0,9)))}}O6.encodedSize=function(e,t){const n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){eT(n);let i=R6(Xi,1);if(n===i||Number.isNaN(n))return 3;if(tT(n),i=L6(Xi,1),n===i)return 5}return 9};const Z_=new ArrayBuffer(9),Si=new DataView(Z_,1),Xi=new Uint8Array(Z_,0);function eT(r){if(r===1/0)Si.setUint16(0,31744,!1);else if(r===-1/0)Si.setUint16(0,64512,!1);else if(Number.isNaN(r))Si.setUint16(0,32256,!1);else{Si.setFloat32(0,r);const e=Si.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)Si.setUint16(0,31744,!1);else if(t===0)Si.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{const i=t-127;i<-24?Si.setUint16(0,0):i<-14?Si.setUint16(0,(e&2147483648)>>16|1<<24+i,!1):Si.setUint16(0,(e&2147483648)>>16|i+15<<10|n>>13,!1)}}}function R6(r,e){if(r.length-e<2)throw new Error(`${ke} not enough data for float16`);const t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const n=t>>10&31,i=t&1023;let s;return n===0?s=i*2**-24:n!==31?s=(i+1024)*2**(n-25):s=i===0?1/0:NaN,t&32768?-s:s}function tT(r){Si.setFloat32(0,r,!1)}function L6(r,e){if(r.length-e<4)throw new Error(`${ke} not enough data for float32`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function eY(r){Si.setFloat64(0,r,!1)}function rT(r,e){if(r.length-e<8)throw new Error(`${ke} not enough data for float64`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}O6.compareTokens=gl.compareTokens;function it(r,e,t){throw new Error(`${ke} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function Jg(r){return()=>{throw new Error(`${ke} ${r}`)}}const ue=[];for(let r=0;r<=23;r++)ue[r]=it;ue[24]=cJ,ue[25]=lJ,ue[26]=uJ,ue[27]=dJ,ue[28]=it,ue[29]=it,ue[30]=it,ue[31]=it;for(let r=32;r<=55;r++)ue[r]=it;ue[56]=hJ,ue[57]=fJ,ue[58]=pJ,ue[59]=gJ,ue[60]=it,ue[61]=it,ue[62]=it,ue[63]=it;for(let r=64;r<=87;r++)ue[r]=yJ;ue[88]=mJ,ue[89]=wJ,ue[90]=bJ,ue[91]=vJ,ue[92]=it,ue[93]=it,ue[94]=it,ue[95]=Jg("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)ue[r]=SJ;ue[120]=xJ,ue[121]=AJ,ue[122]=CJ,ue[123]=IJ,ue[124]=it,ue[125]=it,ue[126]=it,ue[127]=Jg("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)ue[r]=_J;ue[152]=TJ,ue[153]=PJ,ue[154]=DJ,ue[155]=$J,ue[156]=it,ue[157]=it,ue[158]=it,ue[159]=NJ;for(let r=160;r<=183;r++)ue[r]=MJ;ue[184]=OJ,ue[185]=RJ,ue[186]=LJ,ue[187]=BJ,ue[188]=it,ue[189]=it,ue[190]=it,ue[191]=UJ;for(let r=192;r<=215;r++)ue[r]=FJ;ue[216]=zJ,ue[217]=VJ,ue[218]=KJ,ue[219]=jJ,ue[220]=it,ue[221]=it,ue[222]=it,ue[223]=it;for(let r=224;r<=243;r++)ue[r]=Jg("simple values are not supported");ue[244]=it,ue[245]=it,ue[246]=it,ue[247]=QJ,ue[248]=Jg("simple values are not supported"),ue[249]=YJ,ue[250]=XJ,ue[251]=ZJ,ue[252]=it,ue[253]=it,ue[254]=it,ue[255]=JJ;const Is=[];for(let r=0;r<24;r++)Is[r]=new ie(V.uint,r,1);for(let r=-1;r>=-24;r--)Is[31-r]=new ie(V.negint,r,1);Is[64]=new ie(V.bytes,new Uint8Array(0),1),Is[96]=new ie(V.string,"",1),Is[128]=new ie(V.array,0,1),Is[160]=new ie(V.map,0,1),Is[244]=new ie(V.false,!1,1),Is[245]=new ie(V.true,!0,1),Is[246]=new ie(V.null,null,1);function tY(r){switch(r.type){case V.false:return mo([244]);case V.true:return mo([245]);case V.null:return mo([246]);case V.bytes:return r.value.length?void 0:mo([64]);case V.string:return r.value===""?mo([96]):void 0;case V.array:return r.value===0?mo([128]):void 0;case V.map:return r.value===0?mo([160]):void 0;case V.uint:return r.value<24?mo([Number(r.value)]):void 0;case V.negint:if(r.value>=-24)return mo([31-Number(r.value)])}}const rY={float64:!1,mapSorter:sY,quickEncodeToken:tY};function nY(){const r=[];return r[V.uint.major]=gl,r[V.negint.major]=P6,r[V.bytes.major]=Qg,r[V.string.major]=kJ,r[V.array.major]=D6,r[V.map.major]=$6,r[V.tag.major]=N6,r[V.float.major]=O6,r}const nT=nY(),B6=new Y_;class Yg{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${ul} object contains circular references`);return new Yg(t,e)}}const La={null:new ie(V.null,null),undefined:new ie(V.undefined,void 0),true:new ie(V.true,!0),false:new ie(V.false,!1),emptyArray:new ie(V.array,0),emptyMap:new ie(V.map,0)},Ba={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new ie(V.float,r):r>=0?new ie(V.uint,r):new ie(V.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new ie(V.uint,r):new ie(V.negint,r)},Uint8Array(r,e,t,n){return new ie(V.bytes,r)},string(r,e,t,n){return new ie(V.string,r)},boolean(r,e,t,n){return r?La.true:La.false},null(r,e,t,n){return La.null},undefined(r,e,t,n){return La.undefined},ArrayBuffer(r,e,t,n){return new ie(V.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new ie(V.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[La.emptyArray,new ie(V.break)]:La.emptyArray;n=Yg.createCheck(n,r);const i=[];let s=0;for(const o of r)i[s++]=Xg(o,t,n);return t.addBreakTokens?[new ie(V.array,r.length),i,new ie(V.break)]:[new ie(V.array,r.length),i]},Object(r,e,t,n){const i=e!=="Object",s=i?r.keys():Object.keys(r),o=i?r.size:s.length;if(!o)return t.addBreakTokens===!0?[La.emptyMap,new ie(V.break)]:La.emptyMap;n=Yg.createCheck(n,r);const a=[];let c=0;for(const l of s)a[c++]=[Xg(l,t,n),Xg(i?r.get(l):r[l],t,n)];return iY(a,t),t.addBreakTokens?[new ie(V.map,o),a,new ie(V.break)]:[new ie(V.map,o),a]}};Ba.Map=Ba.Object,Ba.Buffer=Ba.Uint8Array;for(const r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Ba[`${r}Array`]=Ba.DataView;function Xg(r,e={},t){const n=XQ(r),i=e&&e.typeEncoders&&e.typeEncoders[n]||Ba[n];if(typeof i=="function"){const o=i(r,n,e,t);if(o!=null)return o}const s=Ba[n];if(!s)throw new Error(`${ul} unsupported type: ${n}`);return s(r,n,e,t)}function iY(r,e){e.mapSorter&&r.sort(e.mapSorter)}function sY(r,e){const t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);const i=t.type.major,s=nT[i].compareTokens(t,n);return s===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),s}function iT(r,e,t,n){if(Array.isArray(e))for(const i of e)iT(r,i,t,n);else t[e.type.major](r,e,n)}function sT(r,e,t){const n=Xg(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){const i=t.quickEncodeToken(n);if(i)return i;const s=e[n.type.major];if(s.encodedSize){const o=s.encodedSize(n,t),a=new Y_(o);if(s(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return k6(a.chunks[0])}}return B6.reset(),iT(B6,n,e,t),B6.toBytes(!0)}function Zg(r,e){return e=Object.assign({},rY,e),sT(r,nT,e)}const oY={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class aY{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=Is[e];if(t===void 0){const n=ue[e];if(!n)throw new Error(`${ke} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const i=e&31;t=n(this.data,this._pos,i,this.options)}return this._pos+=t.encodedLength,t}}const Yf=Symbol.for("DONE"),e2=Symbol.for("BREAK");function cY(r,e,t){const n=[];for(let i=0;i<r.value;i++){const s=Xf(e,t);if(s===e2){if(r.value===1/0)break;throw new Error(`${ke} got unexpected break to lengthed array`)}if(s===Yf)throw new Error(`${ke} found array but not enough entries (got ${i}, expected ${r.value})`);n[i]=s}return n}function lY(r,e,t){const n=t.useMaps===!0,i=n?void 0:{},s=n?new Map:void 0;for(let o=0;o<r.value;o++){const a=Xf(e,t);if(a===e2){if(r.value===1/0)break;throw new Error(`${ke} got unexpected break to lengthed map`)}if(a===Yf)throw new Error(`${ke} found map but not enough entries (got ${o} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${ke} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&s.has(a)||!n&&a in i))throw new Error(`${ke} found repeat map key "${a}"`);const c=Xf(e,t);if(c===Yf)throw new Error(`${ke} found map but not enough entries (got ${o} [no value], expected ${r.value})`);n?s.set(a,c):i[a]=c}return n?s:i}function Xf(r,e){if(r.done())return Yf;const t=r.next();if(t.type===V.break)return e2;if(t.type.terminal)return t.value;if(t.type===V.array)return cY(t,r,e);if(t.type===V.map)return lY(t,r,e);if(t.type===V.tag){if(e.tags&&typeof e.tags[t.value]=="function"){const n=Xf(r,e);return e.tags[t.value](n)}throw new Error(`${ke} tag not supported (${t.value})`)}throw new Error("unsupported")}function uY(r,e){if(!(r instanceof Uint8Array))throw new Error(`${ke} data to decode must be a Uint8Array`);e=Object.assign({},oY,e);const t=e.tokenizer||new aY(r,e),n=Xf(t,e);if(n===Yf)throw new Error(`${ke} did not find any content to decode`);if(n===e2)throw new Error(`${ke} got unexpected break`);return[n,r.subarray(t.pos())]}function Ua(r,e){const[t,n]=uY(r,e);if(n.length>0)throw new Error(`${ke} too many terminals, data makes no sense`);return t}function dY(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function U6(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function hY(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var fY=hY,pY=fY;let gY=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},yY=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return oT(this,e)}},mY=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return oT(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function oT(r,e){return new mY({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let wY=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new gY(e,t,n),this.decoder=new yY(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function aT({name:r,prefix:e,encode:t,decode:n}){return new wY(r,e,t,n)}function t2({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=pY(t,r);return aT({prefix:e,name:r,encode:n,decode:s=>U6(i(s))})}function bY(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function vY(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function wo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return aT({prefix:e,name:r,encode(i){return vY(i,n,t)},decode(i){return bY(i,n,t,r)}})}const r2=wo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});wo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),wo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),wo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),wo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),wo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),wo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),wo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),wo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const F6=t2({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});t2({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Fa=t2({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});t2({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var EY=lT,cT=128,SY=-128,xY=Math.pow(2,31);function lT(r,e,t){e=e||[],t=t||0;for(var n=t;r>=xY;)e[t++]=r&255|cT,r/=128;for(;r&SY;)e[t++]=r&255|cT,r>>>=7;return e[t]=r|0,lT.bytes=t-n+1,e}var AY=z6,CY=128,uT=127;function z6(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw z6.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&uT)<<i:(o&uT)*Math.pow(2,i),i+=7}while(o>=CY);return z6.bytes=s-n,t}var IY=Math.pow(2,7),kY=Math.pow(2,14),_Y=Math.pow(2,21),TY=Math.pow(2,28),PY=Math.pow(2,35),DY=Math.pow(2,42),$Y=Math.pow(2,49),NY=Math.pow(2,56),MY=Math.pow(2,63),OY=function(r){return r<IY?1:r<kY?2:r<_Y?3:r<TY?4:r<PY?5:r<DY?6:r<$Y?7:r<NY?8:r<MY?9:10},RY={encode:EY,decode:AY,encodingLength:OY},n2=RY;function V6(r,e=0){return[n2.decode(r,e),n2.decode.bytes]}function i2(r,e,t=0){return n2.encode(r,e,t),e}function s2(r){return n2.encodingLength(r)}function LY(r,e){const t=e.byteLength,n=s2(r),i=n+s2(t),s=new Uint8Array(i+t);return i2(r,s,0),i2(t,s,n),s.set(e,i),new K6(r,t,e,s)}function BY(r){const e=U6(r),[t,n]=V6(e),[i,s]=V6(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new K6(t,i,o,e)}function UY(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&dY(r.bytes,t.bytes)}}let K6=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function dT(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return zY(t,j6(r),e??Fa.encoder);default:return VY(t,j6(r),e??r2.encoder)}}const hT=new WeakMap;function j6(r){const e=hT.get(r);if(e==null){const t=new Map;return hT.set(r,t),t}return e}let fT=class Hr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Cj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Zf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==KY)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Hr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=LY(e,t);return Hr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Hr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&UY(e.multihash,n.multihash)}toString(e){return dT(this,e)}toJSON(){return{"/":dT(this)}}link(){return this}[(Cj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Hr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Hr(n,i,s,o??pT(n,i,s.bytes))}else if(t[jY]===!0){const{version:n,multihash:i,code:s}=t,o=BY(i);return Hr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Zf)throw new Error(`Version 0 CID must use dag-pb (code: ${Zf}) block encoding`);return new Hr(e,t,n,n.bytes)}case 1:{const i=pT(e,t,n.bytes);return new Hr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Hr.create(0,Zf,e)}static createV1(e,t){return Hr.create(1,e,t)}static decode(e){const[t,n]=Hr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Hr.inspectBytes(e),n=t.size-t.multihashSize,i=U6(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new K6(t.multihashCode,t.digestSize,s,i);return[t.version===0?Hr.createV0(o):Hr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=V6(e.subarray(t));return t+=p,h};let i=n(),s=Zf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=FY(e,t),s=Hr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return j6(s).set(n,e),s}};function FY(r,e){switch(r[0]){case"Q":{const t=e??Fa;return[Fa.prefix,t.decode(`${Fa.prefix}${r}`)]}case Fa.prefix:{const t=e??Fa;return[Fa.prefix,t.decode(r)]}case r2.prefix:{const t=e??r2;return[r2.prefix,t.decode(r)]}case F6.prefix:{const t=e??F6;return[F6.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function zY(r,e,t){const{prefix:n}=t;if(n!==Fa.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function VY(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Zf=112,KY=18;function pT(r,e,t){const n=s2(r),i=n+s2(e),s=new Uint8Array(i+t.byteLength);return i2(r,s,0),i2(e,s,n),s.set(t,i),s}const jY=Symbol.for("@ipld/js-cid/CID"),gT=42;function yT(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function HY(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=fT.asCID(r);if(!e)return null;const t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new ie(V.tag,gT),new ie(V.bytes,t)]}function qY(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function WY(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const H6={float64:!0,typeEncoders:{Object:HY,undefined:qY,number:WY}},GY={...H6,typeEncoders:{...H6.typeEncoders}};function QY(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return fT.decode(r.subarray(1))}const o2={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};o2.tags[gT]=QY;const JY={...o2,tags:o2.tags.slice()},YY="dag-cbor",mT=113,e1=Object.freeze(Object.defineProperty({__proto__:null,code:mT,decode:r=>Ua(yT(r),o2),decodeOptions:JY,encode:r=>Zg(r,H6),encodeOptions:GY,name:YY,toByteView:yT},Symbol.toStringTag,{value:"Module"})),a2=HQ({name:"sha2-256",code:18,encode:(r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)))("SHA-256")}),c2=e1,l2=a2,wT=dn,XY=async(r,e,t,n=null,i=[],s=[])=>{if(r==null)throw new Error("Identity is required, cannot create entry");if(e==null)throw new Error("Entry requires an id");if(t==null)throw new Error("Entry requires a payload");if(i==null||!Array.isArray(i))throw new Error("'next' argument is not an array");n=n||Fg(r.publicKey);const o={id:e,payload:t,next:i,refs:s,clock:n,v:2},{bytes:a}=await od({value:o,codec:c2,hasher:l2}),c=await r.sign(r,a);return o.key=r.publicKey,o.identity=r.hash,o.sig=c,vT(o)},ZY=async(r,e)=>{if(!r)throw new Error("Identities is required, cannot verify entry");if(!bT(e))throw new Error("Invalid Log entry");if(!e.key)throw new Error("Entry doesn't have a key");if(!e.sig)throw new Error("Entry doesn't have a signature");const t={id:e.id,payload:e.payload,next:e.next,refs:e.refs,clock:e.clock,v:e.v},{bytes:n}=await od({value:t,codec:c2,hasher:l2});return r.verify(e.sig,e.key,n)},bT=r=>r&&r.id!==void 0&&r.next!==void 0&&r.payload!==void 0&&r.v!==void 0&&r.clock!==void 0&&r.refs!==void 0,eX=(r,e)=>r&&e&&r.hash===e.hash,tX=async r=>{const{cid:e,value:t}=await qg({bytes:r,codec:c2,hasher:l2}),n=e.toString(wT);return{...t,hash:n,bytes:r}},vT=async r=>{const{cid:e,bytes:t}=await od({value:r,codec:c2,hasher:l2}),n=e.toString(wT),i=Fg(r.clock.id,r.clock.time);return{...r,clock:i,hash:n,bytes:t}},bo={create:XY,verify:ZY,decode:tX,encode:vT,isEntry:bT,isEqual:eX},q6=async()=>{let r={};const e=async(c,l)=>{r[c]=l};return{put:e,del:async c=>{delete r[c]},get:async c=>r[c],iterator:async function*(){for await(const[c,l]of Object.entries(r))yield[c,l]},merge:async c=>{if(c)for await(const[l,d]of c.iterator())e(l,d)},clear:async()=>{r={}},close:async()=>{}}},rX=q6,nX=async({storage:r,heads:e})=>{r=r||await rX();const t=async d=>{d=ET(d);for(const h of d)await r.put(h.hash,h.bytes)},n=async d=>{await r.clear(),await t(d)},i=async d=>{const h=await a();if(h.find(b=>bo.isEqual(b,d)))return;const p=ET([...h,d]);return await n(p),p},s=async d=>{const p=(await a()).filter(b=>b.hash!==d);await n(p)},o=async function*(){const d=r.iterator();for await(const[,h]of d)yield await bo.decode(h)},a=async()=>{const d=[];for await(const h of o())d.push(h);return d},c=async()=>{await r.clear()},l=async()=>{await r.close()};return await t(e||[]),{put:t,set:n,add:i,remove:s,iterator:o,all:a,clear:c,close:l}},ET=r=>{r=new Set(r);const e={};for(const n of r)for(const i of n.next)e[i]=n.hash;const t=[];for(const n of r)e[n.hash]||t.push(n);return t};function iX(r,e){const t=(s,o)=>s,n=(s,o)=>oX(s,o,t);return((s,o)=>sX(s,o,n))(r,e)}function sX(r,e,t){const n=uQ(r.clock,e.clock);return n===0?t(r,e):n}function oX(r,e,t){return r.clock.id===e.clock.id?t(r,e):r.clock.id<e.clock.id?-1:1}function aX(r){const e=`Your log's tiebreaker function, ${r.name}, has returned zero and therefore cannot be`;return(n,i)=>{const s=r(n,i);if(s===0)throw Error(e);return s}}const cX={LastWriteWins:iX,NoZeroes:aX},{LastWriteWins:lX,NoZeroes:uX}=cX,dX=()=>new Date().getTime().toString(),hX=(r,e)=>Math.max(r,e.clock.time),W6=q6,fX=async()=>({canAppend:async r=>!0}),pX=async(r,{logId:e,logHeads:t,access:n,entryStorage:i,headsStorage:s,indexStorage:o,sortFn:a}={})=>{if(r==null)throw new Error("Identity is required");if(t!=null&&!Array.isArray(t))throw new Error("'logHeads' argument must be an array");const c=e||dX();n=n||await fX();const l=i||await W6(),d=o||await W6();s=s||await W6();const h=await nX({storage:s,heads:t});a=uX(a||lX);const p=new Ma({concurrency:1}),b=new Ma({concurrency:1}),f=async()=>{const B=Math.max(0,(await g()).reduce(hX,0));return Fg(r.publicKey,B)},g=async()=>(await h.all()).sort(a).reverse(),v=async()=>{const B=[];for await(const G of k())B.unshift(G);return B},y=async B=>{const G=await l.get(B);if(G)return await bo.decode(G)},w=async B=>await d.get(B)!=null,m=async(B,G={referencesCount:0})=>{const j=async()=>{const q=await g(),Q=q.map(W=>W.hash),K=await z(q,G.referencesCount+q.length),O=await bo.create(r,c,B,dQ(await f()),Q,K);if(!await n.canAppend(O))throw new Error(`Could not append entry:
Key "${r.hash}" is not allowed to write to the log`);return await h.set([O]),await l.put(O.hash,O.bytes),await d.put(O.hash,!0),O};return p.add(j)},E=async B=>{if(!B)throw new Error("Log instance not defined");if(!L(B))throw new Error("Given argument is not an instance of Log");l.merge&&await l.merge(B.storage);const G=await B.heads();for(const j of G)await A(j)},A=async B=>{const G=async()=>{if(await w(B.hash))return!1;const q=async J=>{if(J.id!==c)throw new Error(`Entry's id (${J.id}) doesn't match the log's id (${c}).`);if(!await n.canAppend(J))throw new Error(`Could not append entry:
Key "${J.identity}" is not allowed to write to the log`);if(!await bo.verify(r,J))throw new Error(`Could not validate signature for entry "${J.hash}"`)};await q(B);const Q=(await g()).map(J=>J.hash),K=new Set([B.hash]),O=new Set([...B.next,...B.refs]),U=new Set,W=async()=>{const J=Array.from(O.values()).filter(w).map(y),H=await Promise.all(J);for(const se of H){O.delete(se.hash),await q(se),K.add(se.hash);for(const we of[...se.next,...se.refs])!await w(we)&&!K.has(we)?O.add(we):Q.includes(we)&&U.add(we)}O.size>0&&await W()};await W();for(const J of K.values())await d.put(J,!0);for(const J of U.values())await h.remove(J);return await l.put(B.hash,B.bytes),await h.add(B),!0};return b.add(G)},k=async function*(B,G){G=G||(()=>!1),B=B||await g();let q=B.sort(a);const Q={};let K=[];const O={},U=J=>!(Q[J]||O[J]);let W;for(;q.length>0;)if(q=q.sort(a),W=q.pop(),W){const{hash:J,next:H}=W;if(!Q[J]){if(yield W,await G(W)===!0)break;Q[J]=!0,O[J]=!0,K=[...K,...H].filter(U);const we=de=>{if(!Q[de]&&!O[de])return O[de]=!0,y(de)},ce=await Promise.all(K.map(we));K=ce.filter(de=>de!=null).reduce((de,Ne)=>Array.from(new Set([...de,...Ne.next])),[]).filter(U),q=[...ce,...q]}}},x=async function*({amount:B=-1,gt:G,gte:j,lt:q,lte:Q}={}){if(B===0)return;if(typeof Q=="string"&&(Q=[await y(Q)]),typeof q=="string"){const de=await y(q);q=await Promise.all(de.next.map(Me=>y(Me)))}if(q!=null&&!Array.isArray(q))throw new Error("lt must be a string or an array of Entries");if(Q!=null&&!Array.isArray(Q))throw new Error("lte must be a string or an array of Entries");const K=(q||Q||await g()).filter(de=>de!=null),O=G||j?await y(G||j):null,U=O||B===-1?-1:B;let W=0;const J=async de=>(W++,de?!!(W>=U&&U!==-1||O&&bo.isEqual(de,O)):!1),H=O&&B!==-1&&!q&&!Q,se=H?new w6(B+2):null;let we=0;const ce=k(K,J);for await(const de of ce){const Ne=q&&bo.isEqual(de,K),Me=G&&bo.isEqual(de,O);Ne||Me||(H?se.set(we++,de.hash):yield de)}if(H){const de=se.keys.length,Ne=de>B?de-B:0,Me=se.keys.slice(Ne,de);for(const Ze of Me){const lt=se.get(Ze);yield await y(lt)}}},I=async()=>{await d.clear(),await h.clear(),await l.clear()},T=async()=>{await d.close(),await h.close(),await l.close()},L=B=>B&&B.id!==void 0&&B.clock!==void 0&&B.heads!==void 0&&B.values!==void 0&&B.access!==void 0&&B.identity!==void 0&&B.storage!==void 0,z=async(B,G=0)=>{let j=[];const q=async Q=>j.length>=G&&G!==-1;for await(const{hash:Q}of k(B,q))j.push(Q);return j=j.slice(B.length+1,G),j};return{id:c,clock:f,heads:g,values:v,all:v,get:y,has:w,append:m,join:E,joinEntry:A,traverse:k,iterator:x,clear:I,close:T,access:n,identity:r,storage:l}},yl=async(r,e)=>({put:async(l,d)=>{await r.put(l,d),await e.put(l,d)},get:async l=>{let d=await r.get(l);return d||(d=await e.get(l),d&&await r.put(l,d)),d},del:async l=>{await r.del(l),await e.del(l)},iterator:async function*({amount:l,reverse:d}={}){const h=[],p={amount:l||-1,reverse:d||!1};for(const b of[r,e])for await(const[f,g]of b.iterator(p))h[f]||(h[f]=!0,yield[f,g])},merge:async l=>{await r.merge(l),await e.merge(l),await l.merge(r),await l.merge(e)},clear:async()=>{await r.clear(),await e.clear()},close:async()=>{await r.close(),await e.close()}});function gX(r){return r[Symbol.asyncIterator]!=null}function vo(r){if(gX(r))return(async()=>{for await(const e of r);})();for(const e of r);}const ST=3e4,u2=async({ipfs:r,pin:e,timeout:t}={})=>{if(!r)throw new Error("An instance of ipfs is required.");return{put:async(d,h)=>{const p=Yi.parse(d,dn),{signal:b}=new y6.TimeoutController(t||ST);await r.blockstore.put(p,h,{signal:b}),e&&!await r.pins.isPinned(p)&&await vo(r.pins.add(p))},del:async d=>{},get:async d=>{const h=Yi.parse(d,dn),{signal:p}=new y6.TimeoutController(t||ST),b=await r.blockstore.get(h,{signal:p});if(b)return b},iterator:async function*(){},merge:async d=>{},clear:async()=>{},close:async()=>{}}};var xT={},za={},d2={},AT={};AT.supports=function(...e){const t=e.reduce((n,i)=>Object.assign(n,i),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})};var CT={},ks=class extends Error{constructor(e,t){super(e||""),typeof t=="object"&&t!==null&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},ml={},h2={},f2={};f2.byteLength=wX,f2.toByteArray=vX,f2.fromByteArray=xX;for(var _s=[],xi=[],yX=typeof Uint8Array<"u"?Uint8Array:Array,G6="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",dd=0,mX=G6.length;dd<mX;++dd)_s[dd]=G6[dd],xi[G6.charCodeAt(dd)]=dd;xi[45]=62,xi[95]=63;function IT(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function wX(r){var e=IT(r),t=e[0],n=e[1];return(t+n)*3/4-n}function bX(r,e,t){return(e+t)*3/4-t}function vX(r){var e,t=IT(r),n=t[0],i=t[1],s=new yX(bX(r,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=xi[r.charCodeAt(c)]<<18|xi[r.charCodeAt(c+1)]<<12|xi[r.charCodeAt(c+2)]<<6|xi[r.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=xi[r.charCodeAt(c)]<<2|xi[r.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=xi[r.charCodeAt(c)]<<10|xi[r.charCodeAt(c+1)]<<4|xi[r.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function EX(r){return _s[r>>18&63]+_s[r>>12&63]+_s[r>>6&63]+_s[r&63]}function SX(r,e,t){for(var n,i=[],s=e;s<t;s+=3)n=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),i.push(EX(n));return i.join("")}function xX(r){for(var e,t=r.length,n=t%3,i=[],s=16383,o=0,a=t-n;o<a;o+=s)i.push(SX(r,o,o+s>a?a:o+s));return n===1?(e=r[t-1],i.push(_s[e>>2]+_s[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],i.push(_s[e>>10]+_s[e>>4&63]+_s[e<<2&63]+"=")),i.join("")}var Q6={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Q6.read=function(r,e,t,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,l=c>>1,d=-7,h=t?i-1:0,p=t?-1:1,b=r[e+h];for(h+=p,s=b&(1<<-d)-1,b>>=-d,d+=a;d>0;s=s*256+r[e+h],h+=p,d-=8);for(o=s&(1<<-d)-1,s>>=-d,d+=n;d>0;o=o*256+r[e+h],h+=p,d-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(b?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-l}return(b?-1:1)*o*Math.pow(2,s-n)},Q6.write=function(r,e,t,n,i,s){var o,a,c,l=s*8-i-1,d=(1<<l)-1,h=d>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=n?0:s-1,f=n?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=d):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?e+=p/c:e+=p*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=d?(a=0,o=d):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;r[t+b]=a&255,b+=f,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;r[t+b]=o&255,b+=f,o/=256,l-=8);r[t+b-f]|=g*128};/*!
* The buffer module from node.js, for the browser.
*
* @author   Feross Aboukhadijeh <https://feross.org>
* @license  MIT
*/(function(r){const e=f2,t=Q6,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=a,r.SlowBuffer=w,r.INSPECT_MAX_BYTES=50;const i=2147483647;r.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const D=new Uint8Array(1),S={foo:function(){return 42}};return Object.setPrototypeOf(S,Uint8Array.prototype),Object.setPrototypeOf(D,S),D.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(D){if(D>i)throw new RangeError('The value "'+D+'" is invalid for option "size"');const S=new Uint8Array(D);return Object.setPrototypeOf(S,a.prototype),S}function a(D,S,C){if(typeof D=="number"){if(typeof S=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return h(D)}return c(D,S,C)}a.poolSize=8192;function c(D,S,C){if(typeof D=="string")return p(D,S);if(ArrayBuffer.isView(D))return f(D);if(D==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof D);if(bn(D,ArrayBuffer)||D&&bn(D.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(bn(D,SharedArrayBuffer)||D&&bn(D.buffer,SharedArrayBuffer)))return g(D,S,C);if(typeof D=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const M=D.valueOf&&D.valueOf();if(M!=null&&M!==D)return a.from(M,S,C);const P=v(D);if(P)return P;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof D[Symbol.toPrimitive]=="function")return a.from(D[Symbol.toPrimitive]("string"),S,C);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof D)}a.from=function(D,S,C){return c(D,S,C)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function l(D){if(typeof D!="number")throw new TypeError('"size" argument must be of type number');if(D<0)throw new RangeError('The value "'+D+'" is invalid for option "size"')}function d(D,S,C){return l(D),D<=0?o(D):S!==void 0?typeof C=="string"?o(D).fill(S,C):o(D).fill(S):o(D)}a.alloc=function(D,S,C){return d(D,S,C)};function h(D){return l(D),o(D<0?0:y(D)|0)}a.allocUnsafe=function(D){return h(D)},a.allocUnsafeSlow=function(D){return h(D)};function p(D,S){if((typeof S!="string"||S==="")&&(S="utf8"),!a.isEncoding(S))throw new TypeError("Unknown encoding: "+S);const C=m(D,S)|0;let M=o(C);const P=M.write(D,S);return P!==C&&(M=M.slice(0,P)),M}function b(D){const S=D.length<0?0:y(D.length)|0,C=o(S);for(let M=0;M<S;M+=1)C[M]=D[M]&255;return C}function f(D){if(bn(D,Uint8Array)){const S=new Uint8Array(D);return g(S.buffer,S.byteOffset,S.byteLength)}return b(D)}function g(D,S,C){if(S<0||D.byteLength<S)throw new RangeError('"offset" is outside of buffer bounds');if(D.byteLength<S+(C||0))throw new RangeError('"length" is outside of buffer bounds');let M;return S===void 0&&C===void 0?M=new Uint8Array(D):C===void 0?M=new Uint8Array(D,S):M=new Uint8Array(D,S,C),Object.setPrototypeOf(M,a.prototype),M}function v(D){if(a.isBuffer(D)){const S=y(D.length)|0,C=o(S);return C.length===0||D.copy(C,0,0,S),C}if(D.length!==void 0)return typeof D.length!="number"||Qc(D.length)?o(0):b(D);if(D.type==="Buffer"&&Array.isArray(D.data))return b(D.data)}function y(D){if(D>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return D|0}function w(D){return+D!=D&&(D=0),a.alloc(+D)}a.isBuffer=function(S){return S!=null&&S._isBuffer===!0&&S!==a.prototype},a.compare=function(S,C){if(bn(S,Uint8Array)&&(S=a.from(S,S.offset,S.byteLength)),bn(C,Uint8Array)&&(C=a.from(C,C.offset,C.byteLength)),!a.isBuffer(S)||!a.isBuffer(C))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(S===C)return 0;let M=S.length,P=C.length;for(let N=0,R=Math.min(M,P);N<R;++N)if(S[N]!==C[N]){M=S[N],P=C[N];break}return M<P?-1:P<M?1:0},a.isEncoding=function(S){switch(String(S).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(S,C){if(!Array.isArray(S))throw new TypeError('"list" argument must be an Array of Buffers');if(S.length===0)return a.alloc(0);let M;if(C===void 0)for(C=0,M=0;M<S.length;++M)C+=S[M].length;const P=a.allocUnsafe(C);let N=0;for(M=0;M<S.length;++M){let R=S[M];if(bn(R,Uint8Array))N+R.length>P.length?(a.isBuffer(R)||(R=a.from(R)),R.copy(P,N)):Uint8Array.prototype.set.call(P,R,N);else if(a.isBuffer(R))R.copy(P,N);else throw new TypeError('"list" argument must be an Array of Buffers');N+=R.length}return P};function m(D,S){if(a.isBuffer(D))return D.length;if(ArrayBuffer.isView(D)||bn(D,ArrayBuffer))return D.byteLength;if(typeof D!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof D);const C=D.length,M=arguments.length>2&&arguments[2]===!0;if(!M&&C===0)return 0;let P=!1;for(;;)switch(S){case"ascii":case"latin1":case"binary":return C;case"utf8":case"utf-8":return eo(D).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C*2;case"hex":return C>>>1;case"base64":return Ki(D).length;default:if(P)return M?-1:eo(D).length;S=(""+S).toLowerCase(),P=!0}}a.byteLength=m;function E(D,S,C){let M=!1;if((S===void 0||S<0)&&(S=0),S>this.length||((C===void 0||C>this.length)&&(C=this.length),C<=0)||(C>>>=0,S>>>=0,C<=S))return"";for(D||(D="utf8");;)switch(D){case"hex":return U(this,S,C);case"utf8":case"utf-8":return j(this,S,C);case"ascii":return K(this,S,C);case"latin1":case"binary":return O(this,S,C);case"base64":return G(this,S,C);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return W(this,S,C);default:if(M)throw new TypeError("Unknown encoding: "+D);D=(D+"").toLowerCase(),M=!0}}a.prototype._isBuffer=!0;function A(D,S,C){const M=D[S];D[S]=D[C],D[C]=M}a.prototype.swap16=function(){const S=this.length;if(S%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let C=0;C<S;C+=2)A(this,C,C+1);return this},a.prototype.swap32=function(){const S=this.length;if(S%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let C=0;C<S;C+=4)A(this,C,C+3),A(this,C+1,C+2);return this},a.prototype.swap64=function(){const S=this.length;if(S%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let C=0;C<S;C+=8)A(this,C,C+7),A(this,C+1,C+6),A(this,C+2,C+5),A(this,C+3,C+4);return this},a.prototype.toString=function(){const S=this.length;return S===0?"":arguments.length===0?j(this,0,S):E.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(S){if(!a.isBuffer(S))throw new TypeError("Argument must be a Buffer");return this===S?!0:a.compare(this,S)===0},a.prototype.inspect=function(){let S="";const C=r.INSPECT_MAX_BYTES;return S=this.toString("hex",0,C).replace(/(.{2})/g,"$1 ").trim(),this.length>C&&(S+=" ... "),"<Buffer "+S+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(S,C,M,P,N){if(bn(S,Uint8Array)&&(S=a.from(S,S.offset,S.byteLength)),!a.isBuffer(S))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof S);if(C===void 0&&(C=0),M===void 0&&(M=S?S.length:0),P===void 0&&(P=0),N===void 0&&(N=this.length),C<0||M>S.length||P<0||N>this.length)throw new RangeError("out of range index");if(P>=N&&C>=M)return 0;if(P>=N)return-1;if(C>=M)return 1;if(C>>>=0,M>>>=0,P>>>=0,N>>>=0,this===S)return 0;let R=N-P,Y=M-C;const pe=Math.min(R,Y),Oe=this.slice(P,N),ze=S.slice(C,M);for(let Se=0;Se<pe;++Se)if(Oe[Se]!==ze[Se]){R=Oe[Se],Y=ze[Se];break}return R<Y?-1:Y<R?1:0};function k(D,S,C,M,P){if(D.length===0)return-1;if(typeof C=="string"?(M=C,C=0):C>2147483647?C=2147483647:C<-2147483648&&(C=-2147483648),C=+C,Qc(C)&&(C=P?0:D.length-1),C<0&&(C=D.length+C),C>=D.length){if(P)return-1;C=D.length-1}else if(C<0)if(P)C=0;else return-1;if(typeof S=="string"&&(S=a.from(S,M)),a.isBuffer(S))return S.length===0?-1:x(D,S,C,M,P);if(typeof S=="number")return S=S&255,typeof Uint8Array.prototype.indexOf=="function"?P?Uint8Array.prototype.indexOf.call(D,S,C):Uint8Array.prototype.lastIndexOf.call(D,S,C):x(D,[S],C,M,P);throw new TypeError("val must be string, number or Buffer")}function x(D,S,C,M,P){let N=1,R=D.length,Y=S.length;if(M!==void 0&&(M=String(M).toLowerCase(),M==="ucs2"||M==="ucs-2"||M==="utf16le"||M==="utf-16le")){if(D.length<2||S.length<2)return-1;N=2,R/=2,Y/=2,C/=2}function pe(ze,Se){return N===1?ze[Se]:ze.readUInt16BE(Se*N)}let Oe;if(P){let ze=-1;for(Oe=C;Oe<R;Oe++)if(pe(D,Oe)===pe(S,ze===-1?0:Oe-ze)){if(ze===-1&&(ze=Oe),Oe-ze+1===Y)return ze*N}else ze!==-1&&(Oe-=Oe-ze),ze=-1}else for(C+Y>R&&(C=R-Y),Oe=C;Oe>=0;Oe--){let ze=!0;for(let Se=0;Se<Y;Se++)if(pe(D,Oe+Se)!==pe(S,Se)){ze=!1;break}if(ze)return Oe}return-1}a.prototype.includes=function(S,C,M){return this.indexOf(S,C,M)!==-1},a.prototype.indexOf=function(S,C,M){return k(this,S,C,M,!0)},a.prototype.lastIndexOf=function(S,C,M){return k(this,S,C,M,!1)};function I(D,S,C,M){C=Number(C)||0;const P=D.length-C;M?(M=Number(M),M>P&&(M=P)):M=P;const N=S.length;M>N/2&&(M=N/2);let R;for(R=0;R<M;++R){const Y=parseInt(S.substr(R*2,2),16);if(Qc(Y))return R;D[C+R]=Y}return R}function T(D,S,C,M){return bs(eo(S,D.length-C),D,C,M)}function L(D,S,C,M){return bs(Gc(S),D,C,M)}function z(D,S,C,M){return bs(Ki(S),D,C,M)}function B(D,S,C,M){return bs(fe(S,D.length-C),D,C,M)}a.prototype.write=function(S,C,M,P){if(C===void 0)P="utf8",M=this.length,C=0;else if(M===void 0&&typeof C=="string")P=C,M=this.length,C=0;else if(isFinite(C))C=C>>>0,isFinite(M)?(M=M>>>0,P===void 0&&(P="utf8")):(P=M,M=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const N=this.length-C;if((M===void 0||M>N)&&(M=N),S.length>0&&(M<0||C<0)||C>this.length)throw new RangeError("Attempt to write outside buffer bounds");P||(P="utf8");let R=!1;for(;;)switch(P){case"hex":return I(this,S,C,M);case"utf8":case"utf-8":return T(this,S,C,M);case"ascii":case"latin1":case"binary":return L(this,S,C,M);case"base64":return z(this,S,C,M);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,S,C,M);default:if(R)throw new TypeError("Unknown encoding: "+P);P=(""+P).toLowerCase(),R=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function G(D,S,C){return S===0&&C===D.length?e.fromByteArray(D):e.fromByteArray(D.slice(S,C))}function j(D,S,C){C=Math.min(D.length,C);const M=[];let P=S;for(;P<C;){const N=D[P];let R=null,Y=N>239?4:N>223?3:N>191?2:1;if(P+Y<=C){let pe,Oe,ze,Se;switch(Y){case 1:N<128&&(R=N);break;case 2:pe=D[P+1],(pe&192)===128&&(Se=(N&31)<<6|pe&63,Se>127&&(R=Se));break;case 3:pe=D[P+1],Oe=D[P+2],(pe&192)===128&&(Oe&192)===128&&(Se=(N&15)<<12|(pe&63)<<6|Oe&63,Se>2047&&(Se<55296||Se>57343)&&(R=Se));break;case 4:pe=D[P+1],Oe=D[P+2],ze=D[P+3],(pe&192)===128&&(Oe&192)===128&&(ze&192)===128&&(Se=(N&15)<<18|(pe&63)<<12|(Oe&63)<<6|ze&63,Se>65535&&Se<1114112&&(R=Se))}}R===null?(R=65533,Y=1):R>65535&&(R-=65536,M.push(R>>>10&1023|55296),R=56320|R&1023),M.push(R),P+=Y}return Q(M)}const q=4096;function Q(D){const S=D.length;if(S<=q)return String.fromCharCode.apply(String,D);let C="",M=0;for(;M<S;)C+=String.fromCharCode.apply(String,D.slice(M,M+=q));return C}function K(D,S,C){let M="";C=Math.min(D.length,C);for(let P=S;P<C;++P)M+=String.fromCharCode(D[P]&127);return M}function O(D,S,C){let M="";C=Math.min(D.length,C);for(let P=S;P<C;++P)M+=String.fromCharCode(D[P]);return M}function U(D,S,C){const M=D.length;(!S||S<0)&&(S=0),(!C||C<0||C>M)&&(C=M);let P="";for(let N=S;N<C;++N)P+=rf[D[N]];return P}function W(D,S,C){const M=D.slice(S,C);let P="";for(let N=0;N<M.length-1;N+=2)P+=String.fromCharCode(M[N]+M[N+1]*256);return P}a.prototype.slice=function(S,C){const M=this.length;S=~~S,C=C===void 0?M:~~C,S<0?(S+=M,S<0&&(S=0)):S>M&&(S=M),C<0?(C+=M,C<0&&(C=0)):C>M&&(C=M),C<S&&(C=S);const P=this.subarray(S,C);return Object.setPrototypeOf(P,a.prototype),P};function J(D,S,C){if(D%1!==0||D<0)throw new RangeError("offset is not uint");if(D+S>C)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(S,C,M){S=S>>>0,C=C>>>0,M||J(S,C,this.length);let P=this[S],N=1,R=0;for(;++R<C&&(N*=256);)P+=this[S+R]*N;return P},a.prototype.readUintBE=a.prototype.readUIntBE=function(S,C,M){S=S>>>0,C=C>>>0,M||J(S,C,this.length);let P=this[S+--C],N=1;for(;C>0&&(N*=256);)P+=this[S+--C]*N;return P},a.prototype.readUint8=a.prototype.readUInt8=function(S,C){return S=S>>>0,C||J(S,1,this.length),this[S]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(S,C){return S=S>>>0,C||J(S,2,this.length),this[S]|this[S+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(S,C){return S=S>>>0,C||J(S,2,this.length),this[S]<<8|this[S+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(S,C){return S=S>>>0,C||J(S,4,this.length),(this[S]|this[S+1]<<8|this[S+2]<<16)+this[S+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(S,C){return S=S>>>0,C||J(S,4,this.length),this[S]*16777216+(this[S+1]<<16|this[S+2]<<8|this[S+3])},a.prototype.readBigUInt64LE=to(function(S){S=S>>>0,$t(S,"offset");const C=this[S],M=this[S+7];(C===void 0||M===void 0)&&nr(S,this.length-8);const P=C+this[++S]*2**8+this[++S]*2**16+this[++S]*2**24,N=this[++S]+this[++S]*2**8+this[++S]*2**16+M*2**24;return BigInt(P)+(BigInt(N)<<BigInt(32))}),a.prototype.readBigUInt64BE=to(function(S){S=S>>>0,$t(S,"offset");const C=this[S],M=this[S+7];(C===void 0||M===void 0)&&nr(S,this.length-8);const P=C*2**24+this[++S]*2**16+this[++S]*2**8+this[++S],N=this[++S]*2**24+this[++S]*2**16+this[++S]*2**8+M;return(BigInt(P)<<BigInt(32))+BigInt(N)}),a.prototype.readIntLE=function(S,C,M){S=S>>>0,C=C>>>0,M||J(S,C,this.length);let P=this[S],N=1,R=0;for(;++R<C&&(N*=256);)P+=this[S+R]*N;return N*=128,P>=N&&(P-=Math.pow(2,8*C)),P},a.prototype.readIntBE=function(S,C,M){S=S>>>0,C=C>>>0,M||J(S,C,this.length);let P=C,N=1,R=this[S+--P];for(;P>0&&(N*=256);)R+=this[S+--P]*N;return N*=128,R>=N&&(R-=Math.pow(2,8*C)),R},a.prototype.readInt8=function(S,C){return S=S>>>0,C||J(S,1,this.length),this[S]&128?(255-this[S]+1)*-1:this[S]},a.prototype.readInt16LE=function(S,C){S=S>>>0,C||J(S,2,this.length);const M=this[S]|this[S+1]<<8;return M&32768?M|4294901760:M},a.prototype.readInt16BE=function(S,C){S=S>>>0,C||J(S,2,this.length);const M=this[S+1]|this[S]<<8;return M&32768?M|4294901760:M},a.prototype.readInt32LE=function(S,C){return S=S>>>0,C||J(S,4,this.length),this[S]|this[S+1]<<8|this[S+2]<<16|this[S+3]<<24},a.prototype.readInt32BE=function(S,C){return S=S>>>0,C||J(S,4,this.length),this[S]<<24|this[S+1]<<16|this[S+2]<<8|this[S+3]},a.prototype.readBigInt64LE=to(function(S){S=S>>>0,$t(S,"offset");const C=this[S],M=this[S+7];(C===void 0||M===void 0)&&nr(S,this.length-8);const P=this[S+4]+this[S+5]*2**8+this[S+6]*2**16+(M<<24);return(BigInt(P)<<BigInt(32))+BigInt(C+this[++S]*2**8+this[++S]*2**16+this[++S]*2**24)}),a.prototype.readBigInt64BE=to(function(S){S=S>>>0,$t(S,"offset");const C=this[S],M=this[S+7];(C===void 0||M===void 0)&&nr(S,this.length-8);const P=(C<<24)+this[++S]*2**16+this[++S]*2**8+this[++S];return(BigInt(P)<<BigInt(32))+BigInt(this[++S]*2**24+this[++S]*2**16+this[++S]*2**8+M)}),a.prototype.readFloatLE=function(S,C){return S=S>>>0,C||J(S,4,this.length),t.read(this,S,!0,23,4)},a.prototype.readFloatBE=function(S,C){return S=S>>>0,C||J(S,4,this.length),t.read(this,S,!1,23,4)},a.prototype.readDoubleLE=function(S,C){return S=S>>>0,C||J(S,8,this.length),t.read(this,S,!0,52,8)},a.prototype.readDoubleBE=function(S,C){return S=S>>>0,C||J(S,8,this.length),t.read(this,S,!1,52,8)};function H(D,S,C,M,P,N){if(!a.isBuffer(D))throw new TypeError('"buffer" argument must be a Buffer instance');if(S>P||S<N)throw new RangeError('"value" argument is out of bounds');if(C+M>D.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(S,C,M,P){if(S=+S,C=C>>>0,M=M>>>0,!P){const Y=Math.pow(2,8*M)-1;H(this,S,C,M,Y,0)}let N=1,R=0;for(this[C]=S&255;++R<M&&(N*=256);)this[C+R]=S/N&255;return C+M},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(S,C,M,P){if(S=+S,C=C>>>0,M=M>>>0,!P){const Y=Math.pow(2,8*M)-1;H(this,S,C,M,Y,0)}let N=M-1,R=1;for(this[C+N]=S&255;--N>=0&&(R*=256);)this[C+N]=S/R&255;return C+M},a.prototype.writeUint8=a.prototype.writeUInt8=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,1,255,0),this[C]=S&255,C+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,2,65535,0),this[C]=S&255,this[C+1]=S>>>8,C+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,2,65535,0),this[C]=S>>>8,this[C+1]=S&255,C+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,4,4294967295,0),this[C+3]=S>>>24,this[C+2]=S>>>16,this[C+1]=S>>>8,this[C]=S&255,C+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,4,4294967295,0),this[C]=S>>>24,this[C+1]=S>>>16,this[C+2]=S>>>8,this[C+3]=S&255,C+4};function se(D,S,C,M,P){kt(S,M,P,D,C,7);let N=Number(S&BigInt(4294967295));D[C++]=N,N=N>>8,D[C++]=N,N=N>>8,D[C++]=N,N=N>>8,D[C++]=N;let R=Number(S>>BigInt(32)&BigInt(4294967295));return D[C++]=R,R=R>>8,D[C++]=R,R=R>>8,D[C++]=R,R=R>>8,D[C++]=R,C}function we(D,S,C,M,P){kt(S,M,P,D,C,7);let N=Number(S&BigInt(4294967295));D[C+7]=N,N=N>>8,D[C+6]=N,N=N>>8,D[C+5]=N,N=N>>8,D[C+4]=N;let R=Number(S>>BigInt(32)&BigInt(4294967295));return D[C+3]=R,R=R>>8,D[C+2]=R,R=R>>8,D[C+1]=R,R=R>>8,D[C]=R,C+8}a.prototype.writeBigUInt64LE=to(function(S,C=0){return se(this,S,C,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=to(function(S,C=0){return we(this,S,C,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(S,C,M,P){if(S=+S,C=C>>>0,!P){const pe=Math.pow(2,8*M-1);H(this,S,C,M,pe-1,-pe)}let N=0,R=1,Y=0;for(this[C]=S&255;++N<M&&(R*=256);)S<0&&Y===0&&this[C+N-1]!==0&&(Y=1),this[C+N]=(S/R>>0)-Y&255;return C+M},a.prototype.writeIntBE=function(S,C,M,P){if(S=+S,C=C>>>0,!P){const pe=Math.pow(2,8*M-1);H(this,S,C,M,pe-1,-pe)}let N=M-1,R=1,Y=0;for(this[C+N]=S&255;--N>=0&&(R*=256);)S<0&&Y===0&&this[C+N+1]!==0&&(Y=1),this[C+N]=(S/R>>0)-Y&255;return C+M},a.prototype.writeInt8=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,1,127,-128),S<0&&(S=255+S+1),this[C]=S&255,C+1},a.prototype.writeInt16LE=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,2,32767,-32768),this[C]=S&255,this[C+1]=S>>>8,C+2},a.prototype.writeInt16BE=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,2,32767,-32768),this[C]=S>>>8,this[C+1]=S&255,C+2},a.prototype.writeInt32LE=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,4,2147483647,-2147483648),this[C]=S&255,this[C+1]=S>>>8,this[C+2]=S>>>16,this[C+3]=S>>>24,C+4},a.prototype.writeInt32BE=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,4,2147483647,-2147483648),S<0&&(S=4294967295+S+1),this[C]=S>>>24,this[C+1]=S>>>16,this[C+2]=S>>>8,this[C+3]=S&255,C+4},a.prototype.writeBigInt64LE=to(function(S,C=0){return se(this,S,C,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=to(function(S,C=0){return we(this,S,C,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ce(D,S,C,M,P,N){if(C+M>D.length)throw new RangeError("Index out of range");if(C<0)throw new RangeError("Index out of range")}function de(D,S,C,M,P){return S=+S,C=C>>>0,P||ce(D,S,C,4),t.write(D,S,C,M,23,4),C+4}a.prototype.writeFloatLE=function(S,C,M){return de(this,S,C,!0,M)},a.prototype.writeFloatBE=function(S,C,M){return de(this,S,C,!1,M)};function Ne(D,S,C,M,P){return S=+S,C=C>>>0,P||ce(D,S,C,8),t.write(D,S,C,M,52,8),C+8}a.prototype.writeDoubleLE=function(S,C,M){return Ne(this,S,C,!0,M)},a.prototype.writeDoubleBE=function(S,C,M){return Ne(this,S,C,!1,M)},a.prototype.copy=function(S,C,M,P){if(!a.isBuffer(S))throw new TypeError("argument should be a Buffer");if(M||(M=0),!P&&P!==0&&(P=this.length),C>=S.length&&(C=S.length),C||(C=0),P>0&&P<M&&(P=M),P===M||S.length===0||this.length===0)return 0;if(C<0)throw new RangeError("targetStart out of bounds");if(M<0||M>=this.length)throw new RangeError("Index out of range");if(P<0)throw new RangeError("sourceEnd out of bounds");P>this.length&&(P=this.length),S.length-C<P-M&&(P=S.length-C+M);const N=P-M;return this===S&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(C,M,P):Uint8Array.prototype.set.call(S,this.subarray(M,P),C),N},a.prototype.fill=function(S,C,M,P){if(typeof S=="string"){if(typeof C=="string"?(P=C,C=0,M=this.length):typeof M=="string"&&(P=M,M=this.length),P!==void 0&&typeof P!="string")throw new TypeError("encoding must be a string");if(typeof P=="string"&&!a.isEncoding(P))throw new TypeError("Unknown encoding: "+P);if(S.length===1){const R=S.charCodeAt(0);(P==="utf8"&&R<128||P==="latin1")&&(S=R)}}else typeof S=="number"?S=S&255:typeof S=="boolean"&&(S=Number(S));if(C<0||this.length<C||this.length<M)throw new RangeError("Out of range index");if(M<=C)return this;C=C>>>0,M=M===void 0?this.length:M>>>0,S||(S=0);let N;if(typeof S=="number")for(N=C;N<M;++N)this[N]=S;else{const R=a.isBuffer(S)?S:a.from(S,P),Y=R.length;if(Y===0)throw new TypeError('The value "'+S+'" is invalid for argument "value"');for(N=0;N<M-C;++N)this[N+C]=R[N%Y]}return this};const Me={};function Ze(D,S,C){Me[D]=class extends C{constructor(){super(),Object.defineProperty(this,"message",{value:S.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${D}]`,this.stack,delete this.name}get code(){return D}set code(P){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:P,writable:!0})}toString(){return`${this.name} [${D}]: ${this.message}`}}}Ze("ERR_BUFFER_OUT_OF_BOUNDS",function(D){return D?`${D} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ze("ERR_INVALID_ARG_TYPE",function(D,S){return`The "${D}" argument must be of type number. Received type ${typeof S}`},TypeError),Ze("ERR_OUT_OF_RANGE",function(D,S,C){let M=`The value of "${D}" is out of range.`,P=C;return Number.isInteger(C)&&Math.abs(C)>2**32?P=lt(String(C)):typeof C=="bigint"&&(P=String(C),(C>BigInt(2)**BigInt(32)||C<-(BigInt(2)**BigInt(32)))&&(P=lt(P)),P+="n"),M+=` It must be ${S}. Received ${P}`,M},RangeError);function lt(D){let S="",C=D.length;const M=D[0]==="-"?1:0;for(;C>=M+4;C-=3)S=`_${D.slice(C-3,C)}${S}`;return`${D.slice(0,C)}${S}`}function vt(D,S,C){$t(S,"offset"),(D[S]===void 0||D[S+C]===void 0)&&nr(S,D.length-(C+1))}function kt(D,S,C,M,P,N){if(D>C||D<S){const R=typeof S=="bigint"?"n":"";let Y;throw S===0||S===BigInt(0)?Y=`>= 0${R} and < 2${R} ** ${(N+1)*8}${R}`:Y=`>= -(2${R} ** ${(N+1)*8-1}${R}) and < 2 ** ${(N+1)*8-1}${R}`,new Me.ERR_OUT_OF_RANGE("value",Y,D)}vt(M,P,N)}function $t(D,S){if(typeof D!="number")throw new Me.ERR_INVALID_ARG_TYPE(S,"number",D)}function nr(D,S,C){throw Math.floor(D)!==D?($t(D,C),new Me.ERR_OUT_OF_RANGE("offset","an integer",D)):S<0?new Me.ERR_BUFFER_OUT_OF_BOUNDS:new Me.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${S}`,D)}const Nr=/[^+/0-9A-Za-z-_]/g;function fa(D){if(D=D.split("=")[0],D=D.trim().replace(Nr,""),D.length<2)return"";for(;D.length%4!==0;)D=D+"=";return D}function eo(D,S){S=S||1/0;let C;const M=D.length;let P=null;const N=[];for(let R=0;R<M;++R){if(C=D.charCodeAt(R),C>55295&&C<57344){if(!P){if(C>56319){(S-=3)>-1&&N.push(239,191,189);continue}else if(R+1===M){(S-=3)>-1&&N.push(239,191,189);continue}P=C;continue}if(C<56320){(S-=3)>-1&&N.push(239,191,189),P=C;continue}C=(P-55296<<10|C-56320)+65536}else P&&(S-=3)>-1&&N.push(239,191,189);if(P=null,C<128){if((S-=1)<0)break;N.push(C)}else if(C<2048){if((S-=2)<0)break;N.push(C>>6|192,C&63|128)}else if(C<65536){if((S-=3)<0)break;N.push(C>>12|224,C>>6&63|128,C&63|128)}else if(C<1114112){if((S-=4)<0)break;N.push(C>>18|240,C>>12&63|128,C>>6&63|128,C&63|128)}else throw new Error("Invalid code point")}return N}function Gc(D){const S=[];for(let C=0;C<D.length;++C)S.push(D.charCodeAt(C)&255);return S}function fe(D,S){let C,M,P;const N=[];for(let R=0;R<D.length&&!((S-=2)<0);++R)C=D.charCodeAt(R),M=C>>8,P=C%256,N.push(P),N.push(M);return N}function Ki(D){return e.toByteArray(fa(D))}function bs(D,S,C,M){let P;for(P=0;P<M&&!(P+C>=S.length||P>=D.length);++P)S[P+C]=D[P];return P}function bn(D,S){return D instanceof S||D!=null&&D.constructor!=null&&D.constructor.name!=null&&D.constructor.name===S.name}function Qc(D){return D!==D}const rf=function(){const D="0123456789abcdef",S=new Array(256);for(let C=0;C<16;++C){const M=C*16;for(let P=0;P<16;++P)S[M+P]=D[C]+D[P]}return S}();function to(D){return typeof BigInt>"u"?Tu:D}function Tu(){throw new Error("BigInt not supported")}})(h2);let J6=null;var kT=function(){return J6===null&&(J6={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),J6},t1={},Y6={};const X6=ks,AX=new Set(["buffer","view","utf8"]);let CX=class{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!AX.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new X6(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new X6(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new X6(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};Y6.Encoding=CX;const{Buffer:Z6}=h2||{},{Encoding:eb}=Y6,IX=kT;let tb=class extends eb{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new rb({encode:this.encode,decode:e=>this.decode(Z6.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},rb=class extends eb{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new tb({encode:e=>{const t=this.encode(e);return Z6.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},kX=class extends eb{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new tb({encode:e=>Z6.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){const{textEncoder:e,textDecoder:t}=IX();return new rb({encode:n=>e.encode(this.encode(n)),decode:n=>this.decode(t.decode(n)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};t1.BufferFormat=tb,t1.ViewFormat=rb,t1.UTF8Format=kX;const{Buffer:Br}=h2||{Buffer:{isBuffer:()=>!1}},{textEncoder:_T,textDecoder:TT}=kT(),{BufferFormat:r1,ViewFormat:nb,UTF8Format:PT}=t1,p2=r=>r;ml.utf8=new PT({encode:function(r){return Br.isBuffer(r)?r.toString("utf8"):ArrayBuffer.isView(r)?TT.decode(r):String(r)},decode:p2,name:"utf8",createViewTranscoder(){return new nb({encode:function(r){return ArrayBuffer.isView(r)?r:_T.encode(r)},decode:function(r){return TT.decode(r)},name:`${this.name}+view`})},createBufferTranscoder(){return new r1({encode:function(r){return Br.isBuffer(r)?r:ArrayBuffer.isView(r)?Br.from(r.buffer,r.byteOffset,r.byteLength):Br.from(String(r),"utf8")},decode:function(r){return r.toString("utf8")},name:`${this.name}+buffer`})}}),ml.json=new PT({encode:JSON.stringify,decode:JSON.parse,name:"json"}),ml.buffer=new r1({encode:function(r){return Br.isBuffer(r)?r:ArrayBuffer.isView(r)?Br.from(r.buffer,r.byteOffset,r.byteLength):Br.from(String(r),"utf8")},decode:p2,name:"buffer",createViewTranscoder(){return new nb({encode:function(r){return ArrayBuffer.isView(r)?r:Br.from(String(r),"utf8")},decode:function(r){return Br.from(r.buffer,r.byteOffset,r.byteLength)},name:`${this.name}+view`})}}),ml.view=new nb({encode:function(r){return ArrayBuffer.isView(r)?r:_T.encode(r)},decode:p2,name:"view",createBufferTranscoder(){return new r1({encode:function(r){return Br.isBuffer(r)?r:ArrayBuffer.isView(r)?Br.from(r.buffer,r.byteOffset,r.byteLength):Br.from(String(r),"utf8")},decode:p2,name:`${this.name}+buffer`})}}),ml.hex=new r1({encode:function(r){return Br.isBuffer(r)?r:Br.from(String(r),"hex")},decode:function(r){return r.toString("hex")},name:"hex"}),ml.base64=new r1({encode:function(r){return Br.isBuffer(r)?r:Br.from(String(r),"base64")},decode:function(r){return r.toString("base64")},name:"base64"});const DT=ks,g2=ml,{Encoding:_X}=Y6,{BufferFormat:TX,ViewFormat:PX,UTF8Format:DX}=t1,n1=Symbol("formats"),y2=Symbol("encodings"),$X=new Set(["buffer","view","utf8"]);let NX=class{constructor(e){if(Array.isArray(e)){if(!e.every(t=>$X.has(t)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[y2]=new Map,this[n1]=new Set(e);for(const t in g2)try{this.encoding(t)}catch(n){if(n.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw n}}encodings(){return Array.from(new Set(this[y2].values()))}encoding(e){let t=this[y2].get(e);if(t===void 0){if(typeof e=="string"&&e!==""){if(t=LX[e],!t)throw new DT(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof e!="object"||e===null)throw new TypeError("First argument 'encoding' must be a string or object");t=MX(e)}const{name:n,format:i}=t;if(!this[n1].has(i))if(this[n1].has("view"))t=t.createViewTranscoder();else if(this[n1].has("buffer"))t=t.createBufferTranscoder();else if(this[n1].has("utf8"))t=t.createUTF8Transcoder();else throw new DT(`Encoding '${n}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(const s of[e,n,t.name,t.commonName])this[y2].set(s,t)}return t}};CT.Transcoder=NX;function MX(r){if(r instanceof _X)return r;const e="type"in r&&typeof r.type=="string"?r.type:void 0,t=r.name||e||`anonymous-${BX++}`;switch(OX(r)){case"view":return new PX({...r,name:t});case"utf8":return new DX({...r,name:t});case"buffer":return new TX({...r,name:t});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function OX(r){return"format"in r&&r.format!==void 0?r.format:"buffer"in r&&typeof r.buffer=="boolean"?r.buffer?"buffer":"utf8":"code"in r&&Number.isInteger(r.code)?"view":"buffer"}const RX={binary:g2.buffer,"utf-8":g2.utf8},LX={...g2,...RX};let BX=0;var hd={},UX=typeof queueMicrotask=="function"?queueMicrotask:r=>Promise.resolve().then(r),$T=UX;hd.fromCallback=function(r,e){if(r===void 0){var t=new Promise(function(n,i){r=function(s,o){s?i(s):n(o)}});r[e!==void 0?e:"promise"]=t}else if(typeof r!="function")throw new TypeError("Callback must be a function");return r},hd.fromPromise=function(r,e){if(e===void 0)return r;r.then(function(t){$T(()=>e(null,t))}).catch(function(t){$T(()=>e(t))})};var Ts={},i1={};i1.getCallback=function(r,e){return typeof r=="function"?r:e},i1.getOptions=function(r,e){return typeof r=="object"&&r!==null?r:e!==void 0?e:{}};const{fromCallback:ib}=hd,Jn=ks,{getOptions:sb,getCallback:NT}=i1,wl=Symbol("promise"),fd=Symbol("callback"),Ps=Symbol("working"),bl=Symbol("handleOne"),Eo=Symbol("handleMany"),ob=Symbol("autoClose"),Va=Symbol("finishWork"),Ds=Symbol("returnMany"),Ka=Symbol("closing"),s1=Symbol("handleClose"),m2=Symbol("closed"),o1=Symbol("closeCallbacks"),ja=Symbol("keyEncoding"),vl=Symbol("valueEncoding"),ab=Symbol("abortOnClose"),w2=Symbol("legacy"),cb=Symbol("keys"),lb=Symbol("values"),Ha=Symbol("limit"),Ai=Symbol("count"),b2=Object.freeze({}),FX=()=>{};let MT=!1;class ub{constructor(e,t,n){if(typeof e!="object"||e===null){const i=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${i}`)}if(typeof t!="object"||t===null)throw new TypeError("The second argument must be an options object");this[m2]=!1,this[o1]=[],this[Ps]=!1,this[Ka]=!1,this[ob]=!1,this[fd]=null,this[bl]=this[bl].bind(this),this[Eo]=this[Eo].bind(this),this[s1]=this[s1].bind(this),this[ja]=t[ja],this[vl]=t[vl],this[w2]=n,this[Ha]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[Ai]=0,this[ab]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[Ai]}get limit(){return this[Ha]}next(e){let t;if(e===void 0)t=new Promise((n,i)=>{e=(s,o,a)=>{s?i(s):this[w2]?o===void 0&&a===void 0?n():n([o,a]):n(o)}});else if(typeof e!="function")throw new TypeError("Callback must be a function");return this[Ka]?this.nextTick(e,new Jn("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Ps]?this.nextTick(e,new Jn("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[Ps]=!0,this[fd]=e,this[Ai]>=this[Ha]?this.nextTick(this[bl],null):this._next(this[bl])),t}_next(e){this.nextTick(e)}nextv(e,t,n){return n=NT(t,n),n=ib(n,wl),t=sb(t,b2),Number.isInteger(e)?(this[Ka]?this.nextTick(n,new Jn("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Ps]?this.nextTick(n,new Jn("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[Ha]<1/0&&(e=Math.min(e,this[Ha]-this[Ai])),this[Ps]=!0,this[fd]=n,e<=0?this.nextTick(this[Eo],null,[]):this._nextv(e,t,this[Eo])),n[wl]):(this.nextTick(n,new TypeError("The first argument 'size' must be an integer")),n[wl])}_nextv(e,t,n){const i=[],s=(o,a,c)=>{if(o)return n(o);if(this[w2]?a===void 0&&c===void 0:a===void 0)return n(null,i);i.push(this[w2]?[a,c]:a),i.length===e?n(null,i):this._next(s)};this._next(s)}all(e,t){return t=NT(e,t),t=ib(t,wl),e=sb(e,b2),this[Ka]?this.nextTick(t,new Jn("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Ps]?this.nextTick(t,new Jn("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[Ps]=!0,this[fd]=t,this[ob]=!0,this[Ai]>=this[Ha]?this.nextTick(this[Eo],null,[]):this._all(e,this[Eo])),t[wl]}_all(e,t){let n=this[Ai];const i=[],s=()=>{const a=this[Ha]<1/0?Math.min(1e3,this[Ha]-n):1e3;a<=0?this.nextTick(t,null,i):this._nextv(a,b2,o)},o=(a,c)=>{a?t(a):c.length===0?t(null,i):(i.push.apply(i,c),n+=c.length,s())};s()}[Va](){const e=this[fd];return this[ab]&&e===null?FX:(this[Ps]=!1,this[fd]=null,this[Ka]&&this._close(this[s1]),e)}[Ds](e,t,n){this[ob]?this.close(e.bind(null,t,n)):e(t,n)}seek(e,t){if(t=sb(t,b2),!this[Ka]){if(this[Ps])throw new Jn("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const n=this.db.keyEncoding(t.keyEncoding||this[ja]),i=n.format;t.keyEncoding!==i&&(t={...t,keyEncoding:i});const s=this.db.prefixKey(n.encode(e),i);this._seek(s,t)}}}_seek(e,t){throw new Jn("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){return e=ib(e,wl),this[m2]?this.nextTick(e):this[Ka]?this[o1].push(e):(this[Ka]=!0,this[o1].push(e),this[Ps]?this[ab]&&this[Va]()(new Jn("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[s1])),e[wl]}_close(e){this.nextTick(e)}[s1](){this[m2]=!0,this.db.detachResource(this);const e=this[o1];this[o1]=[];for(const t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;(e=await this.next())!==void 0;)yield e}finally{this[m2]||await this.close()}}}let v2=class extends ub{constructor(e,t){super(e,t,!0),this[cb]=t.keys!==!1,this[lb]=t.values!==!1}[bl](e,t,n){const i=this[Va]();if(e)return i(e);try{t=this[cb]&&t!==void 0?this[ja].decode(t):void 0,n=this[lb]&&n!==void 0?this[vl].decode(n):void 0}catch(s){return i(new pd("entry",s))}t===void 0&&n===void 0||this[Ai]++,i(null,t,n)}[Eo](e,t){const n=this[Va]();if(e)return this[Ds](n,e);try{for(const i of t){const s=i[0],o=i[1];i[0]=this[cb]&&s!==void 0?this[ja].decode(s):void 0,i[1]=this[lb]&&o!==void 0?this[vl].decode(o):void 0}}catch(i){return this[Ds](n,new pd("entries",i))}this[Ai]+=t.length,this[Ds](n,null,t)}end(e){return!MT&&typeof console<"u"&&(MT=!0,console.warn(new Jn("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}},zX=class extends ub{constructor(e,t){super(e,t,!1)}[bl](e,t){const n=this[Va]();if(e)return n(e);try{t=t!==void 0?this[ja].decode(t):void 0}catch(i){return n(new pd("key",i))}t!==void 0&&this[Ai]++,n(null,t)}[Eo](e,t){const n=this[Va]();if(e)return this[Ds](n,e);try{for(let i=0;i<t.length;i++){const s=t[i];t[i]=s!==void 0?this[ja].decode(s):void 0}}catch(i){return this[Ds](n,new pd("keys",i))}this[Ai]+=t.length,this[Ds](n,null,t)}},VX=class extends ub{constructor(e,t){super(e,t,!1)}[bl](e,t){const n=this[Va]();if(e)return n(e);try{t=t!==void 0?this[vl].decode(t):void 0}catch(i){return n(new pd("value",i))}t!==void 0&&this[Ai]++,n(null,t)}[Eo](e,t){const n=this[Va]();if(e)return this[Ds](n,e);try{for(let i=0;i<t.length;i++){const s=t[i];t[i]=s!==void 0?this[vl].decode(s):void 0}}catch(i){return this[Ds](n,new pd("values",i))}this[Ai]+=t.length,this[Ds](n,null,t)}};class pd extends Jn{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}}for(const r of["_ended property","_nexting property","_end method"])Object.defineProperty(v2.prototype,r.split(" ")[0],{get(){throw new Jn(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new Jn(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})}});v2.keyEncoding=ja,v2.valueEncoding=vl,Ts.AbstractIterator=v2,Ts.AbstractKeyIterator=zX,Ts.AbstractValueIterator=VX;var db={};const{AbstractKeyIterator:KX,AbstractValueIterator:jX}=Ts,El=Symbol("iterator"),a1=Symbol("callback"),gd=Symbol("handleOne"),Sl=Symbol("handleMany");let hb=class extends KX{constructor(e,t){super(e,t),this[El]=e.iterator({...t,keys:!0,values:!1}),this[gd]=this[gd].bind(this),this[Sl]=this[Sl].bind(this)}},OT=class extends jX{constructor(e,t){super(e,t),this[El]=e.iterator({...t,keys:!1,values:!0}),this[gd]=this[gd].bind(this),this[Sl]=this[Sl].bind(this)}};for(const r of[hb,OT]){const e=r===hb,t=e?n=>n[0]:n=>n[1];r.prototype._next=function(n){this[a1]=n,this[El].next(this[gd])},r.prototype[gd]=function(n,i,s){const o=this[a1];n?o(n):o(null,e?i:s)},r.prototype._nextv=function(n,i,s){this[a1]=s,this[El].nextv(n,i,this[Sl])},r.prototype._all=function(n,i){this[a1]=i,this[El].all(n,this[Sl])},r.prototype[Sl]=function(n,i){const s=this[a1];n?s(n):s(null,i.map(t))},r.prototype._seek=function(n,i){this[El].seek(n,i)},r.prototype._close=function(n){this[El].close(n)}}db.DefaultKeyIterator=hb,db.DefaultValueIterator=OT;var E2={};const{AbstractIterator:HX,AbstractKeyIterator:qX,AbstractValueIterator:WX}=Ts,fb=ks,Cn=Symbol("nut"),S2=Symbol("undefer"),x2=Symbol("factory");let RT=class extends HX{constructor(e,t){super(e,t),this[Cn]=null,this[x2]=()=>e.iterator(t),this.db.defer(()=>this[S2]())}},LT=class extends qX{constructor(e,t){super(e,t),this[Cn]=null,this[x2]=()=>e.keys(t),this.db.defer(()=>this[S2]())}},BT=class extends WX{constructor(e,t){super(e,t),this[Cn]=null,this[x2]=()=>e.values(t),this.db.defer(()=>this[S2]())}};for(const r of[RT,LT,BT])r.prototype[S2]=function(){this.db.status==="open"&&(this[Cn]=this[x2]())},r.prototype._next=function(e){this[Cn]!==null?this[Cn].next(e):this.db.status==="opening"?this.db.defer(()=>this._next(e)):this.nextTick(e,new fb("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._nextv=function(e,t,n){this[Cn]!==null?this[Cn].nextv(e,t,n):this.db.status==="opening"?this.db.defer(()=>this._nextv(e,t,n)):this.nextTick(n,new fb("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._all=function(e,t){this[Cn]!==null?this[Cn].all(t):this.db.status==="opening"?this.db.defer(()=>this._all(e,t)):this.nextTick(t,new fb("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._seek=function(e,t){this[Cn]!==null?this[Cn]._seek(e,t):this.db.status==="opening"&&this.db.defer(()=>this._seek(e,t))},r.prototype._close=function(e){this[Cn]!==null?this[Cn].close(e):this.db.status==="opening"?this.db.defer(()=>this._close(e)):this.nextTick(e)};E2.DeferredIterator=RT,E2.DeferredKeyIterator=LT,E2.DeferredValueIterator=BT;var UT={},pb={};const{fromCallback:FT}=hd,A2=ks,{getCallback:GX,getOptions:QX}=i1,C2=Symbol("promise"),Ci=Symbol("status"),yd=Symbol("operations"),c1=Symbol("finishClose"),md=Symbol("closeCallbacks");let JX=class{constructor(e){if(typeof e!="object"||e===null){const t=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${t}`)}this[yd]=[],this[md]=[],this[Ci]="open",this[c1]=this[c1].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[yd].length}put(e,t,n){if(this[Ci]!=="open")throw new A2("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const i=this.db._checkKey(e)||this.db._checkValue(t);if(i)throw i;const s=n&&n.sublevel!=null?n.sublevel:this.db,o=n,a=s.keyEncoding(n&&n.keyEncoding),c=s.valueEncoding(n&&n.valueEncoding),l=a.format;n={...n,keyEncoding:l,valueEncoding:c.format},s!==this.db&&(n.sublevel=null);const d=s.prefixKey(a.encode(e),l),h=c.encode(t);return this._put(d,h,n),this[yd].push({...o,type:"put",key:e,value:t}),this}_put(e,t,n){}del(e,t){if(this[Ci]!=="open")throw new A2("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const n=this.db._checkKey(e);if(n)throw n;const i=t&&t.sublevel!=null?t.sublevel:this.db,s=t,o=i.keyEncoding(t&&t.keyEncoding),a=o.format;return t={...t,keyEncoding:a},i!==this.db&&(t.sublevel=null),this._del(i.prefixKey(o.encode(e),a),t),this[yd].push({...s,type:"del",key:e}),this}_del(e,t){}clear(){if(this[Ci]!=="open")throw new A2("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[yd]=[],this}_clear(){}write(e,t){return t=GX(e,t),t=FT(t,C2),e=QX(e),this[Ci]!=="open"?this.nextTick(t,new A2("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(t):(this[Ci]="writing",this._write(e,n=>{this[Ci]="closing",this[md].push(()=>t(n)),n||this.db.emit("batch",this[yd]),this._close(this[c1])})),t[C2]}_write(e,t){}close(e){return e=FT(e,C2),this[Ci]==="closing"?this[md].push(e):this[Ci]==="closed"?this.nextTick(e):(this[md].push(e),this[Ci]!=="writing"&&(this[Ci]="closing",this._close(this[c1]))),e[C2]}_close(e){this.nextTick(e)}[c1](){this[Ci]="closed",this.db.detachResource(this);const e=this[md];this[md]=[];for(const t of e)t()}};pb.AbstractChainedBatch=JX;const{AbstractChainedBatch:YX}=pb,XX=ks,wd=Symbol("encoded");let ZX=class extends YX{constructor(e){super(e),this[wd]=[]}_put(e,t,n){this[wd].push({...n,type:"put",key:e,value:t})}_del(e,t){this[wd].push({...t,type:"del",key:e})}_clear(){this[wd]=[]}_write(e,t){this.db.status==="opening"?this.db.defer(()=>this._write(e,t)):this.db.status==="open"?this[wd].length===0?this.nextTick(t):this.db._batch(this[wd],e,t):this.nextTick(t,new XX("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};UT.DefaultChainedBatch=ZX;const zT=ks,eZ=Object.prototype.hasOwnProperty,tZ=new Set(["lt","lte","gt","gte"]);var rZ=function(r,e){const t={};for(const n in r)if(eZ.call(r,n)&&!(n==="keyEncoding"||n==="valueEncoding")){if(n==="start"||n==="end")throw new zT(`The legacy range option '${n}' has been removed`,{code:"LEVEL_LEGACY"});if(n==="encoding")throw new zT("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});tZ.has(n)?t[n]=e.encode(r[n]):t[n]=r[n]}return t.reverse=!!t.reverse,t.limit=Number.isInteger(t.limit)&&t.limit>=0?t.limit:-1,t};/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let VT;var KT=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:nt):r=>(VT||(VT=Promise.resolve())).then(r).catch(e=>setTimeout(()=>{throw e},0)),gb,jT;function nZ(){if(jT)return gb;jT=1;const r=KT;return gb=function(e,...t){t.length===0?r(e):r(()=>e(...t))},gb}var l1={},HT;function iZ(){if(HT)return l1;HT=1;const{AbstractIterator:r,AbstractKeyIterator:e,AbstractValueIterator:t}=Ts,n=Symbol("unfix"),i=Symbol("iterator"),s=Symbol("handleOne"),o=Symbol("handleMany"),a=Symbol("callback");class c extends r{constructor(p,b,f,g){super(p,b),this[i]=f,this[n]=g,this[s]=this[s].bind(this),this[o]=this[o].bind(this),this[a]=null}[s](p,b,f){const g=this[a];if(p)return g(p);b!==void 0&&(b=this[n](b)),g(p,b,f)}[o](p,b){const f=this[a];if(p)return f(p);for(const g of b){const v=g[0];v!==void 0&&(g[0]=this[n](v))}f(p,b)}}class l extends e{constructor(p,b,f,g){super(p,b),this[i]=f,this[n]=g,this[s]=this[s].bind(this),this[o]=this[o].bind(this),this[a]=null}[s](p,b){const f=this[a];if(p)return f(p);b!==void 0&&(b=this[n](b)),f(p,b)}[o](p,b){const f=this[a];if(p)return f(p);for(let g=0;g<b.length;g++){const v=b[g];v!==void 0&&(b[g]=this[n](v))}f(p,b)}}class d extends t{constructor(p,b,f){super(p,b),this[i]=f}}for(const h of[c,l])h.prototype._next=function(p){this[a]=p,this[i].next(this[s])},h.prototype._nextv=function(p,b,f){this[a]=f,this[i].nextv(p,b,this[o])},h.prototype._all=function(p,b){this[a]=b,this[i].all(p,this[o])};for(const h of[d])h.prototype._next=function(p){this[i].next(p)},h.prototype._nextv=function(p,b,f){this[i].nextv(p,b,f)},h.prototype._all=function(p,b){this[i].all(p,b)};for(const h of[c,l,d])h.prototype._seek=function(p,b){this[i].seek(p,b)},h.prototype._close=function(p){this[i].close(p)};return l1.AbstractSublevelIterator=c,l1.AbstractSublevelKeyIterator=l,l1.AbstractSublevelValueIterator=d,l1}var yb,qT;function sZ(){if(qT)return yb;qT=1;const r=ks,{Buffer:e}=h2||{},{AbstractSublevelIterator:t,AbstractSublevelKeyIterator:n,AbstractSublevelValueIterator:i}=iZ(),s=Symbol("prefix"),o=Symbol("upperBound"),a=Symbol("prefixRange"),c=Symbol("parent"),l=Symbol("unfix"),d=new TextEncoder,h={separator:"!"};yb=function({AbstractLevel:y}){class w extends y{static defaults(E){if(typeof E=="string")throw new r("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(E&&E.open)throw new r("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return E==null?h:E.separator?E:{...E,separator:"!"}}constructor(E,A,k){const{separator:x,manifest:I,...T}=w.defaults(k);A=v(A,x);const L=x.charCodeAt(0)+1,z=E[c]||E;if(!d.encode(A).every(j=>j>L&&j<127))throw new r(`Prefix must use bytes > ${L} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(p(z,I),T);const B=(E.prefix||"")+x+A+x,G=B.slice(0,-1)+String.fromCharCode(L);this[c]=z,this[s]=new f(B),this[o]=new f(G),this[l]=new g,this.nextTick=z.nextTick}prefixKey(E,A){if(A==="utf8")return this[s].utf8+E;if(E.byteLength===0)return this[s][A];if(A==="view"){const k=this[s].view,x=new Uint8Array(k.byteLength+E.byteLength);return x.set(k,0),x.set(E,k.byteLength),x}else{const k=this[s].buffer;return e.concat([k,E],k.byteLength+E.byteLength)}}[a](E,A){E.gte!==void 0?E.gte=this.prefixKey(E.gte,A):E.gt!==void 0?E.gt=this.prefixKey(E.gt,A):E.gte=this[s][A],E.lte!==void 0?E.lte=this.prefixKey(E.lte,A):E.lt!==void 0?E.lt=this.prefixKey(E.lt,A):E.lte=this[o][A]}get prefix(){return this[s].utf8}get db(){return this[c]}_open(E,A){this[c].open({passive:!0},A)}_put(E,A,k,x){this[c].put(E,A,k,x)}_get(E,A,k){this[c].get(E,A,k)}_getMany(E,A,k){this[c].getMany(E,A,k)}_del(E,A,k){this[c].del(E,A,k)}_batch(E,A,k){this[c].batch(E,A,k)}_clear(E,A){this[a](E,E.keyEncoding),this[c].clear(E,A)}_iterator(E){this[a](E,E.keyEncoding);const A=this[c].iterator(E),k=this[l].get(this[s].utf8.length,E.keyEncoding);return new t(this,E,A,k)}_keys(E){this[a](E,E.keyEncoding);const A=this[c].keys(E),k=this[l].get(this[s].utf8.length,E.keyEncoding);return new n(this,E,A,k)}_values(E){this[a](E,E.keyEncoding);const A=this[c].values(E);return new i(this,E,A)}}return{AbstractSublevel:w}};const p=function(y,w){return{...y.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...w,encodings:{utf8:b(y,"utf8"),buffer:b(y,"buffer"),view:b(y,"view")}}},b=function(y,w){return y.supports.encodings[w]?y.keyEncoding(w).name===w:!1};class f{constructor(w){this.utf8=w,this.view=d.encode(w),this.buffer=e?e.from(this.view.buffer,0,this.view.byteLength):{}}}class g{constructor(){this.cache=new Map}get(w,m){let E=this.cache.get(m);return E===void 0&&(m==="view"?E=(function(A,k){return k.subarray(A)}).bind(null,w):E=(function(A,k){return k.slice(A)}).bind(null,w),this.cache.set(m,E)),E}}const v=function(y,w){let m=0,E=y.length;for(;m<E&&y[m]===w;)m++;for(;E>m&&y[E-1]===w;)E--;return y.slice(m,E)};return yb}const{supports:oZ}=AT,{Transcoder:aZ}=CT,{EventEmitter:cZ}=Bg,{fromCallback:qa}=hd,Zi=ks,{AbstractIterator:xl}=Ts,{DefaultKeyIterator:lZ,DefaultValueIterator:uZ}=db,{DeferredIterator:dZ,DeferredKeyIterator:hZ,DeferredValueIterator:fZ}=E2,{DefaultChainedBatch:WT}=UT,{getCallback:Al,getOptions:Wa}=i1,I2=rZ,Ke=Symbol("promise"),So=Symbol("landed"),Cl=Symbol("resources"),mb=Symbol("closeResources"),u1=Symbol("operations"),d1=Symbol("undefer"),k2=Symbol("deferOpen"),GT=Symbol("options"),qe=Symbol("status"),Il=Symbol("defaultOptions"),bd=Symbol("transcoder"),_2=Symbol("keyEncoding"),wb=Symbol("valueEncoding"),pZ=()=>{};let bb=class extends cZ{constructor(e,t){if(super(),typeof e!="object"||e===null)throw new TypeError("The first argument 'manifest' must be an object");t=Wa(t);const{keyEncoding:n,valueEncoding:i,passive:s,...o}=t;this[Cl]=new Set,this[u1]=[],this[k2]=!0,this[GT]=o,this[qe]="opening",this.supports=oZ(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:e.snapshots!==!1,permanence:e.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[bd]=new aZ(gZ(this)),this[_2]=this[bd].encoding(n||"utf8"),this[wb]=this[bd].encoding(i||"utf8");for(const a of this[bd].encodings())this.supports.encodings[a.commonName]||(this.supports.encodings[a.commonName]=!0);this[Il]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[_2].commonName,valueEncoding:this[wb].commonName}),key:Object.freeze({keyEncoding:this[_2].commonName})},this.nextTick(()=>{this[k2]&&this.open({passive:!1},pZ)})}get status(){return this[qe]}keyEncoding(e){return this[bd].encoding(e??this[_2])}valueEncoding(e){return this[bd].encoding(e??this[wb])}open(e,t){t=Al(e,t),t=qa(t,Ke),e={...this[GT],...Wa(e)},e.createIfMissing=e.createIfMissing!==!1,e.errorIfExists=!!e.errorIfExists;const n=i=>{this[qe]==="closing"||this[qe]==="opening"?this.once(So,i?()=>n(i):n):this[qe]!=="open"?t(new Zi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:i})):t()};return e.passive?this[qe]==="opening"?this.once(So,n):this.nextTick(n):this[qe]==="closed"||this[k2]?(this[k2]=!1,this[qe]="opening",this.emit("opening"),this._open(e,i=>{if(i){this[qe]="closed",this[mb](()=>{this.emit(So),n(i)}),this[d1]();return}this[qe]="open",this[d1](),this.emit(So),this[qe]==="open"&&this.emit("open"),this[qe]==="open"&&this.emit("ready"),n()})):this[qe]==="open"?this.nextTick(n):this.once(So,()=>this.open(e,t)),t[Ke]}_open(e,t){this.nextTick(t)}close(e){e=qa(e,Ke);const t=n=>{this[qe]==="opening"||this[qe]==="closing"?this.once(So,n?t(n):t):this[qe]!=="closed"?e(new Zi("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:n})):e()};if(this[qe]==="open"){this[qe]="closing",this.emit("closing");const n=i=>{this[qe]="open",this[d1](),this.emit(So),t(i)};this[mb](()=>{this._close(i=>{if(i)return n(i);this[qe]="closed",this[d1](),this.emit(So),this[qe]==="closed"&&this.emit("closed"),t()})})}else this[qe]==="closed"?this.nextTick(t):this.once(So,()=>this.close(e));return e[Ke]}[mb](e){if(this[Cl].size===0)return this.nextTick(e);let t=this[Cl].size,n=!0;const i=()=>{--t===0&&(n?this.nextTick(e):e())};for(const s of this[Cl])s.close(i);n=!1,this[Cl].clear()}_close(e){this.nextTick(e)}get(e,t,n){if(n=Al(t,n),n=qa(n,Ke),t=Wa(t,this[Il].entry),this[qe]==="opening")return this.defer(()=>this.get(e,t,n)),n[Ke];if(vd(this,n))return n[Ke];const i=this._checkKey(e);if(i)return this.nextTick(n,i),n[Ke];const s=this.keyEncoding(t.keyEncoding),o=this.valueEncoding(t.valueEncoding),a=s.format,c=o.format;return(t.keyEncoding!==a||t.valueEncoding!==c)&&(t=Object.assign({},t,{keyEncoding:a,valueEncoding:c})),this._get(this.prefixKey(s.encode(e),a),t,(l,d)=>{if(l)return(l.code==="LEVEL_NOT_FOUND"||l.notFound||/NotFound/i.test(l))&&(l.code||(l.code="LEVEL_NOT_FOUND"),l.notFound||(l.notFound=!0),l.status||(l.status=404)),n(l);try{d=o.decode(d)}catch(h){return n(new Zi("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:h}))}n(null,d)}),n[Ke]}_get(e,t,n){this.nextTick(n,new Error("NotFound"))}getMany(e,t,n){if(n=Al(t,n),n=qa(n,Ke),t=Wa(t,this[Il].entry),this[qe]==="opening")return this.defer(()=>this.getMany(e,t,n)),n[Ke];if(vd(this,n))return n[Ke];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'keys' must be an array")),n[Ke];if(e.length===0)return this.nextTick(n,null,[]),n[Ke];const i=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),o=i.format,a=s.format;(t.keyEncoding!==o||t.valueEncoding!==a)&&(t=Object.assign({},t,{keyEncoding:o,valueEncoding:a}));const c=new Array(e.length);for(let l=0;l<e.length;l++){const d=e[l],h=this._checkKey(d);if(h)return this.nextTick(n,h),n[Ke];c[l]=this.prefixKey(i.encode(d),o)}return this._getMany(c,t,(l,d)=>{if(l)return n(l);try{for(let h=0;h<d.length;h++)d[h]!==void 0&&(d[h]=s.decode(d[h]))}catch(h){return n(new Zi(`Could not decode one or more of ${d.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:h}))}n(null,d)}),n[Ke]}_getMany(e,t,n){this.nextTick(n,null,new Array(e.length).fill(void 0))}put(e,t,n,i){if(i=Al(n,i),i=qa(i,Ke),n=Wa(n,this[Il].entry),this[qe]==="opening")return this.defer(()=>this.put(e,t,n,i)),i[Ke];if(vd(this,i))return i[Ke];const s=this._checkKey(e)||this._checkValue(t);if(s)return this.nextTick(i,s),i[Ke];const o=this.keyEncoding(n.keyEncoding),a=this.valueEncoding(n.valueEncoding),c=o.format,l=a.format;(n.keyEncoding!==c||n.valueEncoding!==l)&&(n=Object.assign({},n,{keyEncoding:c,valueEncoding:l}));const d=this.prefixKey(o.encode(e),c),h=a.encode(t);return this._put(d,h,n,p=>{if(p)return i(p);this.emit("put",e,t),i()}),i[Ke]}_put(e,t,n,i){this.nextTick(i)}del(e,t,n){if(n=Al(t,n),n=qa(n,Ke),t=Wa(t,this[Il].key),this[qe]==="opening")return this.defer(()=>this.del(e,t,n)),n[Ke];if(vd(this,n))return n[Ke];const i=this._checkKey(e);if(i)return this.nextTick(n,i),n[Ke];const s=this.keyEncoding(t.keyEncoding),o=s.format;return t.keyEncoding!==o&&(t=Object.assign({},t,{keyEncoding:o})),this._del(this.prefixKey(s.encode(e),o),t,a=>{if(a)return n(a);this.emit("del",e),n()}),n[Ke]}_del(e,t,n){this.nextTick(n)}batch(e,t,n){if(!arguments.length){if(this[qe]==="opening")return new WT(this);if(this[qe]!=="open")throw new Zi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof e=="function"?n=e:n=Al(t,n),n=qa(n,Ke),t=Wa(t,this[Il].empty),this[qe]==="opening")return this.defer(()=>this.batch(e,t,n)),n[Ke];if(vd(this,n))return n[Ke];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'operations' must be an array")),n[Ke];if(e.length===0)return this.nextTick(n),n[Ke];const i=new Array(e.length),{keyEncoding:s,valueEncoding:o,...a}=t;for(let c=0;c<e.length;c++){if(typeof e[c]!="object"||e[c]===null)return this.nextTick(n,new TypeError("A batch operation must be an object")),n[Ke];const l=Object.assign({},e[c]);if(l.type!=="put"&&l.type!=="del")return this.nextTick(n,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),n[Ke];const d=this._checkKey(l.key);if(d)return this.nextTick(n,d),n[Ke];const h=l.sublevel!=null?l.sublevel:this,p=h.keyEncoding(l.keyEncoding||s),b=p.format;if(l.key=h.prefixKey(p.encode(l.key),b),l.keyEncoding=b,l.type==="put"){const f=this._checkValue(l.value);if(f)return this.nextTick(n,f),n[Ke];const g=h.valueEncoding(l.valueEncoding||o);l.value=g.encode(l.value),l.valueEncoding=g.format}h!==this&&(l.sublevel=null),i[c]=l}return this._batch(i,a,c=>{if(c)return n(c);this.emit("batch",e),n()}),n[Ke]}_batch(e,t,n){this.nextTick(n)}sublevel(e,t){return this._sublevel(e,vb.defaults(t))}_sublevel(e,t){return new vb(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=Al(e,t),t=qa(t,Ke),e=Wa(e,this[Il].empty),this[qe]==="opening")return this.defer(()=>this.clear(e,t)),t[Ke];if(vd(this,t))return t[Ke];const n=e,i=this.keyEncoding(e.keyEncoding);return e=I2(e,i),e.keyEncoding=i.format,e.limit===0?this.nextTick(t):this._clear(e,s=>{if(s)return t(s);this.emit("clear",n),t()}),t[Ke]}_clear(e,t){this.nextTick(t)}iterator(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=I2(e,t),e.keys=e.keys!==!1,e.values=e.values!==!1,e[xl.keyEncoding]=t,e[xl.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[qe]==="opening")return new dZ(this,e);if(this[qe]!=="open")throw new Zi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new xl(this,e)}keys(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=I2(e,t),e[xl.keyEncoding]=t,e[xl.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[qe]==="opening")return new hZ(this,e);if(this[qe]!=="open")throw new Zi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new lZ(this,e)}values(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=I2(e,t),e[xl.keyEncoding]=t,e[xl.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[qe]==="opening")return new fZ(this,e);if(this[qe]!=="open")throw new Zi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new uZ(this,e)}defer(e){if(typeof e!="function")throw new TypeError("The first argument must be a function");this[u1].push(e)}[d1](){if(this[u1].length===0)return;const e=this[u1];this[u1]=[];for(const t of e)t()}attachResource(e){if(typeof e!="object"||e===null||typeof e.close!="function")throw new TypeError("The first argument must be a resource object");this[Cl].add(e)}detachResource(e){this[Cl].delete(e)}_chainedBatch(){return new WT(this)}_checkKey(e){if(e==null)return new Zi("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(e==null)return new Zi("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};bb.prototype.nextTick=nZ();const{AbstractSublevel:vb}=sZ()({AbstractLevel:bb});d2.AbstractLevel=bb,d2.AbstractSublevel=vb;const vd=function(r,e){return r[qe]!=="open"?(r.nextTick(e,new Zi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},gZ=function(r){return Object.keys(r.supports.encodings).filter(e=>!!r.supports.encodings[e])};za.AbstractLevel=d2.AbstractLevel,za.AbstractSublevel=d2.AbstractSublevel,za.AbstractIterator=Ts.AbstractIterator,za.AbstractKeyIterator=Ts.AbstractKeyIterator,za.AbstractValueIterator=Ts.AbstractValueIterator,za.AbstractChainedBatch=pb.AbstractChainedBatch;/*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var yZ=wZ;const mZ=KT;function wZ(r,e,t){if(typeof e!="number")throw new Error("second argument must be a Number");let n,i,s,o,a,c=!0,l;Array.isArray(r)?(n=[],s=i=r.length):(o=Object.keys(r),n={},s=i=o.length);function d(p){function b(){t&&t(p,n),t=null}c?mZ(b):b()}function h(p,b,f){if(n[p]=f,b&&(a=!0),--s===0||b)d(b);else if(!a&&l<i){let g;o?(g=o[l],l+=1,r[g](function(v,y){h(g,v,y)})):(g=l,l+=1,r[g](function(v,y){h(g,v,y)}))}}l=e,s?o?o.some(function(p,b){return r[p](function(f,g){h(p,f,g)}),b===e-1}):r.some(function(p,b){return p(function(f,g){h(b,f,g)}),b===e-1}):d(null),c=!1}var QT={},JT=function(e){const t=e.gte!==void 0?e.gte:e.gt!==void 0?e.gt:void 0,n=e.lte!==void 0?e.lte:e.lt!==void 0?e.lt:void 0,i=e.gte===void 0,s=e.lte===void 0;return t!==void 0&&n!==void 0?IDBKeyRange.bound(t,n,i,s):t!==void 0?IDBKeyRange.lowerBound(t,i):n!==void 0?IDBKeyRange.upperBound(n,s):null};const bZ=new TextEncoder;var YT=function(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):bZ.encode(r)};const{AbstractIterator:vZ}=za,XT=JT,T2=YT,$s=Symbol("cache"),xo=Symbol("finished"),Yn=Symbol("options"),Ao=Symbol("currentOptions"),kl=Symbol("position"),Eb=Symbol("location"),Ed=Symbol("first"),ZT={};let EZ=class extends vZ{constructor(e,t,n){super(e,n),this[$s]=[],this[xo]=this.limit===0,this[Yn]=n,this[Ao]={...n},this[kl]=void 0,this[Eb]=t,this[Ed]=!0}_nextv(e,t,n){if(this[Ed]=!1,this[xo])return this.nextTick(n,null,[]);if(this[$s].length>0)return e=Math.min(e,this[$s].length),this.nextTick(n,null,this[$s].splice(0,e));this[kl]!==void 0&&(this[Yn].reverse?(this[Ao].lt=this[kl],this[Ao].lte=void 0):(this[Ao].gt=this[kl],this[Ao].gte=void 0));let i;try{i=XT(this[Ao])}catch{return this[xo]=!0,this.nextTick(n,null,[])}const s=this.db.db.transaction([this[Eb]],"readonly"),o=s.objectStore(this[Eb]),a=[];if(this[Yn].reverse){const c=!this[Yn].values&&o.openKeyCursor?"openKeyCursor":"openCursor";o[c](i,"prev").onsuccess=l=>{const d=l.target.result;if(d){const{key:h,value:p}=d;this[kl]=h,a.push([this[Yn].keys&&h!==void 0?T2(h):void 0,this[Yn].values&&p!==void 0?T2(p):void 0]),a.length<e?d.continue():eP(s)}else this[xo]=!0}}else{let c,l;const d=()=>{if(c===void 0||l===void 0)return;const h=Math.max(c.length,l.length);h===0||e===1/0?this[xo]=!0:this[kl]=c[h-1],a.length=h;for(let p=0;p<h;p++){const b=c[p],f=l[p];a[p]=[this[Yn].keys&&b!==void 0?T2(b):void 0,this[Yn].values&&f!==void 0?T2(f):void 0]}eP(s)};this[Yn].keys||e<1/0?o.getAllKeys(i,e<1/0?e:void 0).onsuccess=h=>{c=h.target.result,d()}:(c=[],this.nextTick(d)),this[Yn].values?o.getAll(i,e<1/0?e:void 0).onsuccess=h=>{l=h.target.result,d()}:(l=[],this.nextTick(d))}s.onabort=()=>{n(s.error||new Error("aborted by user")),n=null},s.oncomplete=()=>{n(null,a),n=null}}_next(e){if(this[$s].length>0){const[t,n]=this[$s].shift();this.nextTick(e,null,t,n)}else if(this[xo])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[Ed]&&(this[Ed]=!1,t=1),this._nextv(t,ZT,(n,i)=>{if(n)return e(n);this[$s]=i,this._next(e)})}}_all(e,t){this[Ed]=!1;const n=this[$s].splice(0,this[$s].length),i=this.limit-this.count-n.length;if(i<=0)return this.nextTick(t,null,n);this._nextv(i,ZT,(s,o)=>{if(s)return t(s);n.length>0&&(o=n.concat(o)),t(null,o)})}_seek(e,t){this[Ed]=!0,this[$s]=[],this[xo]=!1,this[kl]=void 0,this[Ao]={...this[Yn]};let n;try{n=XT(this[Yn])}catch{this[xo]=!0;return}n!==null&&!n.includes(e)?this[xo]=!0:this[Yn].reverse?this[Ao].lte=e:this[Ao].gte=e}};QT.Iterator=EZ;function eP(r){typeof r.commit=="function"&&r.commit()}var SZ=function(e,t,n,i,s){if(i.limit===0)return e.nextTick(s);const o=e.db.transaction([t],"readwrite"),a=o.objectStore(t);let c=0;o.oncomplete=function(){s()},o.onabort=function(){s(o.error||new Error("aborted by user"))};const l=a.openKeyCursor?"openKeyCursor":"openCursor",d=i.reverse?"prev":"next";a[l](n,d).onsuccess=function(h){const p=h.target.result;p&&(a.delete(p.key).onsuccess=function(){(i.limit<=0||++c<i.limit)&&p.continue()})}};const{AbstractLevel:xZ}=za,tP=ks,AZ=yZ,{fromCallback:CZ}=hd,{Iterator:IZ}=QT,rP=YT,kZ=SZ,_Z=JT,nP="level-js-",h1=Symbol("idb"),Sb=Symbol("namePrefix"),Co=Symbol("location"),xb=Symbol("version"),_l=Symbol("store"),f1=Symbol("onComplete"),iP=Symbol("promise");class sP extends xZ{constructor(e,t,n){if(typeof t=="function"||typeof n=="function")throw new tP("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:i,version:s,...o}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),typeof e!="string")throw new Error("constructor requires a location string argument");this[Co]=e,this[Sb]=i??nP,this[xb]=parseInt(s||1,10),this[h1]=null}get location(){return this[Co]}get namePrefix(){return this[Sb]}get version(){return this[xb]}get db(){return this[h1]}get type(){return"browser-level"}_open(e,t){const n=indexedDB.open(this[Sb]+this[Co],this[xb]);n.onerror=function(){t(n.error||new Error("unknown error"))},n.onsuccess=()=>{this[h1]=n.result,t()},n.onupgradeneeded=i=>{const s=i.target.result;s.objectStoreNames.contains(this[Co])||s.createObjectStore(this[Co])}}[_l](e){return this[h1].transaction([this[Co]],e).objectStore(this[Co])}[f1](e,t){const n=e.transaction;n.onabort=function(){t(n.error||new Error("aborted by user"))},n.oncomplete=function(){t(null,e.result)}}_get(e,t,n){const i=this[_l]("readonly");let s;try{s=i.get(e)}catch(o){return this.nextTick(n,o)}this[f1](s,function(o,a){if(o)return n(o);if(a===void 0)return n(new tP("Entry not found",{code:"LEVEL_NOT_FOUND"}));n(null,rP(a))})}_getMany(e,t,n){const i=this[_l]("readonly"),s=e.map(o=>a=>{let c;try{c=i.get(o)}catch(l){return a(l)}c.onsuccess=()=>{const l=c.result;a(null,l===void 0?l:rP(l))},c.onerror=l=>{l.stopPropagation(),a(c.error)}});AZ(s,16,n)}_del(e,t,n){const i=this[_l]("readwrite");let s;try{s=i.delete(e)}catch(o){return this.nextTick(n,o)}this[f1](s,n)}_put(e,t,n,i){const s=this[_l]("readwrite");let o;try{o=s.put(t,e)}catch(a){return this.nextTick(i,a)}this[f1](o,i)}_iterator(e){return new IZ(this,this[Co],e)}_batch(e,t,n){const i=this[_l]("readwrite"),s=i.transaction;let o=0,a;s.onabort=function(){n(a||s.error||new Error("aborted by user"))},s.oncomplete=function(){n()};function c(){const l=e[o++],d=l.key;let h;try{h=l.type==="del"?i.delete(d):i.put(l.value,d)}catch(p){a=p,s.abort();return}o<e.length?h.onsuccess=c:typeof s.commit=="function"&&s.commit()}c()}_clear(e,t){let n,i;try{n=_Z(e)}catch{return this.nextTick(t)}if(e.limit>=0)return kZ(this,this[Co],n,e,t);try{const s=this[_l]("readwrite");i=n?s.delete(n):s.clear()}catch(s){return this.nextTick(t,s)}this[f1](i,t)}_close(e){this[h1].close(),this.nextTick(e)}}sP.destroy=function(r,e,t){typeof e=="function"&&(t=e,e=nP),t=CZ(t,iP);const n=indexedDB.deleteDatabase(e+r);return n.onsuccess=function(){t()},n.onerror=function(i){t(i)},t[iP]},xT.BrowserLevel=sP;var TZ=xT.BrowserLevel;const PZ="./level",DZ="view",Ab=async({path:r,valueEncoding:e}={})=>{r=r||PZ,e=e||DZ;const t=new TZ(r,{valueEncoding:e,passive:!0});return await t.open(),{put:async(d,h)=>{await t.put(d,h)},del:async d=>{await t.del(d)},get:async d=>{try{const h=await t.get(d);if(h)return h}catch{}},iterator:async function*({amount:d,reverse:h}={}){const p={limit:d||-1,reverse:h||!1};for await(const[b,f]of t.iterator(p))yield[b,f]},merge:async d=>{},clear:async()=>{await t.clear()},close:async()=>{await t.close()}}},oP=1e6,Ns=async({size:r}={})=>{let e=new w6(r||oP);return{put:async(l,d)=>{e.set(l,d)},del:async l=>{e.remove(l)},get:async l=>e.get(l),iterator:async function*(){for await(const l of e.keys){const d=e.get(l);yield[l,d]}},merge:async l=>{if(l)for await(const[d,h]of l.iterator())e.set(d,h)},clear:async()=>{e=new w6(r||oP)},close:async()=>{}}},$Z=16,Cb=1e3,Ib=async({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p})=>{s=Ra(s||"./orbitdb",`./${t}/`),o=o||{},d=Number(d)>-1?d:$Z,c=c||await yl(await Ns({size:Cb}),await u2({ipfs:r,pin:!0})),a=a||await yl(await Ns({size:Cb}),await Ab({path:Ra(s,"/log/_heads/")})),l=l||await yl(await Ns({size:Cb}),await Ab({path:Ra(s,"/log/_index/")}));const b=await pX(e,{logId:t,access:i,entryStorage:c,headsStorage:a,indexStorage:l}),f=new Bg.EventEmitter,g=new Ma({concurrency:1}),v=async A=>{const k=async()=>{const I=await b.append(A,{referencesCount:d});return await E.add(I),p&&await p(b,I),f.emit("update",I),I.hash},x=await g.add(k);return await g.onIdle(),x},y=async A=>{const k=async()=>{const x=await bo.decode(A);x&&await b.joinEntry(x)&&(p&&await p(b,x),f.emit("update",x))};await g.add(k)},w=async()=>{await E.stop(),await g.onIdle(),await b.close(),i&&i.close&&await i.close(),f.emit("close")},m=async()=>{await g.onIdle(),await b.clear(),i&&i.drop&&await i.drop(),f.emit("drop")},E=await oQ({ipfs:r,log:b,events:f,onSynced:y,start:h});return{address:t,name:n,identity:e,meta:o,close:w,drop:m,addOperation:v,log:b,sync:E,peers:E.peers,events:f,access:i}},aP="documents",NZ={indexBy:"_id"},cP=({indexBy:r}=NZ)=>async({ipfs:e,identity:t,address:n,name:i,access:s,directory:o,meta:a,headsStorage:c,entryStorage:l,indexStorage:d,referencesCount:h,syncAutomatically:p,onUpdate:b})=>{const f=await Ib({ipfs:e,identity:t,address:n,name:i,access:s,directory:o,meta:a,headsStorage:c,entryStorage:l,indexStorage:d,referencesCount:h,syncAutomatically:p}),{addOperation:g,log:v}=f,y=async x=>{const I=x[r];if(!I)throw new Error(`The provided document doesn't contain field '${r}'`);return g({op:"PUT",key:I,value:x})},w=async x=>{if(!await m(x))throw new Error(`No document with key '${x}' in the database`);return g({op:"DEL",key:x,value:null})},m=async x=>{for await(const I of A())if(x===I.key)return I},E=async x=>{const I=[];for await(const T of A())x(T.value)&&I.push(T.value);return I},A=async function*({amount:x}={}){const I={};let T=0;for await(const L of v.iterator()){const{op:z,key:B,value:G}=L.payload;if(z==="PUT"&&!I[B]?(I[B]=!0,T++,yield{hash:L.hash,key:B,value:G}):z==="DEL"&&!I[B]&&(I[B]=!0),T>=x)break}};return{...f,type:aP,put:y,del:w,get:m,iterator:A,query:E,indexBy:r,all:async()=>{const x=[];for await(const I of A())x.unshift(I);return x}}};cP.type=aP;const lP="events",uP=()=>async({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p})=>{const b=await Ib({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p}),{addOperation:f,log:g}=b,v=async E=>f({op:"ADD",key:null,value:E}),y=async E=>(await g.get(E)).payload.value,w=async function*({gt:E,gte:A,lt:k,lte:x,amount:I}={}){const T=g.iterator({gt:E,gte:A,lt:k,lte:x,amount:I});for await(const L of T){const z=L.hash,B=L.payload.value;yield{hash:z,value:B}}};return{...b,type:lP,add:v,get:y,iterator:w,all:async()=>{const E=[];for await(const A of w())E.unshift(A);return E}}};uP.type=lP;const dP="keyvalue",hP=()=>async({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p})=>{const b=await Ib({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p}),{addOperation:f,log:g}=b,v=async(A,k)=>f({op:"PUT",key:A,value:k}),y=async A=>f({op:"DEL",key:A,value:null}),w=async A=>{for await(const k of g.traverse()){const{op:x,key:I,value:T}=k.payload;if(x==="PUT"&&I===A)return T;if(x==="DEL"&&I===A)return}},m=async function*({amount:A}={}){const k={};let x=0;for await(const I of g.traverse()){const{op:T,key:L,value:z}=I.payload;if(T==="PUT"&&!k[L]){k[L]=!0,x++;const B=I.hash;yield{key:L,value:z,hash:B}}else T==="DEL"&&!k[L]&&(k[L]=!0);if(x>=A)break}};return{...b,type:dP,put:v,set:v,del:y,get:w,iterator:m,all:async()=>{const A=[];for await(const k of m())A.unshift(k);return A}}};hP.type=dP;const kb={},_b=r=>{if(!r.type)throw new Error("Database type does not contain required field 'type'.");kb[r.type]=r},MZ=r=>{if(!r)throw new Error("Type not specified");if(!kb[r])throw new Error(`Unsupported database type: '${r}'`);return kb[r]};_b(uP),_b(cP),_b(hP);const OZ=Symbol.for("@libp2p/connection"),Sd=Symbol.for("@libp2p/content-routing"),P2=Symbol.for("@libp2p/peer-discovery"),Tb=Symbol.for("@libp2p/peer-id");function fP(r){return!!(r!=null&&r[Tb])}const xd=Symbol.for("@libp2p/peer-routing"),D2="keep-alive",$2="StrictSign",Pb="StrictNoSign";var Ii;(function(r){r.Accept="accept",r.Ignore="ignore",r.Reject="reject"})(Ii||(Ii={}));const N2=Symbol.for("@libp2p/transport");var Ga;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(Ga||(Ga={}));let Tl=(zA=class extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}},u(zA,"name","AbortError"),zA);class pP extends Error{constructor(e="Unexpected Peer"){super(e),this.name="UnexpectedPeerError"}}u(pP,"name","UnexpectedPeerError");let RZ=(VA=class extends Error{constructor(e="Invalid crypto exchange"){super(e),this.name="InvalidCryptoExchangeError"}},u(VA,"name","InvalidCryptoExchangeError"),VA);class Z extends Error{constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}}u(Z,"name","InvalidParametersError");class p1 extends Error{constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}u(p1,"name","InvalidPublicKeyError");class Db extends Error{constructor(e="Invalid private key"){super(e),this.name="InvalidPrivateKeyError"}}u(Db,"name","InvalidPrivateKeyError");class gP extends Error{constructor(e="The connection is closing"){super(e),this.name="ConnectionClosingError"}}u(gP,"name","ConnectionClosingError");class $b extends Error{constructor(e="The connection is closed"){super(e),this.name="ConnectionClosedError"}}u($b,"name","ConnectionClosedError");class Nb extends Error{constructor(e="Connection failed"){super(e),this.name="ConnectionFailedError"}}u(Nb,"name","ConnectionFailedError");class Pl extends Error{constructor(e="The muxer is closed"){super(e),this.name="MuxerClosedError"}}u(Pl,"name","MuxerClosedError");class yP extends Error{constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}}u(yP,"name","StreamResetError");class M2 extends Error{constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}}u(M2,"name","StreamStateError");let Zt=(KA=class extends Error{constructor(e="Not found"){super(e),this.name="NotFoundError"}},u(KA,"name","NotFoundError"),KA);class Mb extends Error{constructor(e="Invalid PeerID"){super(e),this.name="InvalidPeerIdError"}}u(Mb,"name","InvalidPeerIdError");class O2 extends Error{constructor(e="Invalid multiaddr"){super(e),this.name="InvalidMultiaddrError"}}u(O2,"name","InvalidMultiaddrError");class mP extends Error{constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}u(mP,"name","InvalidCIDError");class R2 extends Error{constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}u(R2,"name","InvalidMultihashError");class g1 extends Error{constructor(e="Unsupported protocol error"){super(e),this.name="UnsupportedProtocolError"}}u(g1,"name","UnsupportedProtocolError");class St extends Error{constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}}u(St,"name","InvalidMessageError");class wP extends Error{constructor(e="Protocol error"){super(e),this.name="ProtocolError"}}u(wP,"name","ProtocolError");class y1 extends Error{constructor(e="Timed out"){super(e),this.name="TimeoutError"}}u(y1,"name","TimeoutError");class Dl extends Error{constructor(e="Not started"){super(e),this.name="NotStartedError"}}u(Dl,"name","NotStartedError");class Ad extends Error{constructor(e="Dial error"){super(e),this.name="DialError"}}u(Ad,"name","DialError");class L2 extends Error{constructor(e="Listen error"){super(e),this.name="ListenError"}}u(L2,"name","ListenError");class Ob extends Error{constructor(e="Limited connection"){super(e),this.name="LimitedConnectionError"}}u(Ob,"name","LimitedConnectionError");class bP extends Error{constructor(e="Too many inbound protocol streams"){super(e),this.name="TooManyInboundProtocolStreamsError"}}u(bP,"name","TooManyInboundProtocolStreamsError");class B2 extends Error{constructor(e="Too many outbound protocol streams"){super(e),this.name="TooManyOutboundProtocolStreamsError"}}u(B2,"name","TooManyOutboundProtocolStreamsError");class $l extends Error{constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}u($l,"name","UnsupportedKeyTypeError");function yCe(){}class er extends EventTarget{constructor(){super();Ye(this,Zs,new Map)}listenerCount(t){const n=ae(this,Zs).get(t);return n==null?0:n.length}addEventListener(t,n,i){super.addEventListener(t,n,i);let s=ae(this,Zs).get(t);s==null&&(s=[],ae(this,Zs).set(t,s)),s.push({callback:n,once:(i!==!0&&i!==!1&&(i==null?void 0:i.once))??!1})}removeEventListener(t,n,i){super.removeEventListener(t.toString(),n??null,i);let s=ae(this,Zs).get(t);s!=null&&(s=s.filter(({callback:o})=>o!==n),ae(this,Zs).set(t,s))}dispatchEvent(t){const n=super.dispatchEvent(t);let i=ae(this,Zs).get(t.type);return i==null||(i=i.filter(({once:s})=>!s),ae(this,Zs).set(t.type,i)),n}safeDispatchEvent(t,n={}){return this.dispatchEvent(new CustomEvent(t,n))}}Zs=new WeakMap;function Rb(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}async function Io(...r){const e=[];for(const t of r)Rb(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStart!=null&&await t.beforeStart()})),await Promise.all(e.map(async t=>{await t.start()})),await Promise.all(e.map(async t=>{t.afterStart!=null&&await t.afterStart()}))}async function Qa(...r){const e=[];for(const t of r)Rb(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStop!=null&&await t.beforeStop()})),await Promise.all(e.map(async t=>{await t.stop()})),await Promise.all(e.map(async t=>{t.afterStop!=null&&await t.afterStop()}))}const dr=Symbol.for("@libp2p/service-capabilities"),Ja=Symbol.for("@libp2p/service-dependencies");function LZ(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function U2(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function BZ(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var UZ=BZ,FZ=UZ;let zZ=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},VZ=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return vP(this,e)}},KZ=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return vP(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function vP(r,e){return new KZ({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let jZ=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new zZ(e,t,n),this.decoder=new VZ(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function EP({name:r,prefix:e,encode:t,decode:n}){return new jZ(r,e,t,n)}function F2({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=FZ(t,r);return EP({prefix:e,name:r,encode:n,decode:s=>U2(i(s))})}function HZ(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function qZ(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Xn({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return EP({prefix:e,name:r,encode(i){return qZ(i,n,t)},decode(i){return HZ(i,n,t,r)}})}const ki=F2({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});F2({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const z2=Xn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Xn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Xn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Xn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Xn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Xn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Xn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Xn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Xn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Lb=F2({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});F2({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var WZ=xP,SP=128,GZ=-128,QZ=Math.pow(2,31);function xP(r,e,t){e=e||[],t=t||0;for(var n=t;r>=QZ;)e[t++]=r&255|SP,r/=128;for(;r&GZ;)e[t++]=r&255|SP,r>>>=7;return e[t]=r|0,xP.bytes=t-n+1,e}var JZ=Bb,YZ=128,AP=127;function Bb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Bb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&AP)<<i:(o&AP)*Math.pow(2,i),i+=7}while(o>=YZ);return Bb.bytes=s-n,t}var XZ=Math.pow(2,7),ZZ=Math.pow(2,14),eee=Math.pow(2,21),tee=Math.pow(2,28),ree=Math.pow(2,35),nee=Math.pow(2,42),iee=Math.pow(2,49),see=Math.pow(2,56),oee=Math.pow(2,63),aee=function(r){return r<XZ?1:r<ZZ?2:r<eee?3:r<tee?4:r<ree?5:r<nee?6:r<iee?7:r<see?8:r<oee?9:10},cee={encode:WZ,decode:JZ,encodingLength:aee},V2=cee;function Ub(r,e=0){return[V2.decode(r,e),V2.decode.bytes]}function K2(r,e,t=0){return V2.encode(r,e,t),e}function j2(r){return V2.encodingLength(r)}function Nl(r,e){const t=e.byteLength,n=j2(r),i=n+j2(t),s=new Uint8Array(i+t);return K2(r,s,0),K2(t,s,n),s.set(e,i),new Fb(r,t,e,s)}function lee(r){const e=U2(r),[t,n]=Ub(e),[i,s]=Ub(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Fb(t,i,o,e)}function uee(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&LZ(r.bytes,t.bytes)}}let Fb=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function CP(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return hee(t,zb(r),e??ki.encoder);default:return fee(t,zb(r),e??z2.encoder)}}const IP=new WeakMap;function zb(r){const e=IP.get(r);if(e==null){const t=new Map;return IP.set(r,t),t}return e}let H2=class qr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Ij,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==m1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==pee)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return qr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Nl(e,t);return qr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return qr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&uee(e.multihash,n.multihash)}toString(e){return CP(this,e)}toJSON(){return{"/":CP(this)}}link(){return this}[(Ij=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof qr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new qr(n,i,s,o??kP(n,i,s.bytes))}else if(t[gee]===!0){const{version:n,multihash:i,code:s}=t,o=lee(i);return qr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==m1)throw new Error(`Version 0 CID must use dag-pb (code: ${m1}) block encoding`);return new qr(e,t,n,n.bytes)}case 1:{const i=kP(e,t,n.bytes);return new qr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return qr.create(0,m1,e)}static createV1(e,t){return qr.create(1,e,t)}static decode(e){const[t,n]=qr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=qr.inspectBytes(e),n=t.size-t.multihashSize,i=U2(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new Fb(t.multihashCode,t.digestSize,s,i);return[t.version===0?qr.createV0(o):qr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=Ub(e.subarray(t));return t+=p,h};let i=n(),s=m1;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=dee(e,t),s=qr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return zb(s).set(n,e),s}};function dee(r,e){switch(r[0]){case"Q":{const t=e??ki;return[ki.prefix,t.decode(`${ki.prefix}${r}`)]}case ki.prefix:{const t=e??ki;return[ki.prefix,t.decode(r)]}case z2.prefix:{const t=e??z2;return[z2.prefix,t.decode(r)]}case Lb.prefix:{const t=e??Lb;return[Lb.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function hee(r,e,t){const{prefix:n}=t;if(n!==ki.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function fee(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const m1=112,pee=18;function kP(r,e,t){const n=j2(r),i=n+j2(e),s=new Uint8Array(i+t.byteLength);return K2(r,s,0),K2(e,s,n),s.set(t,i),s}const gee=Symbol.for("@ipld/js-cid/CID"),_P=0,yee="identity",TP=U2;function mee(r){return Nl(_P,TP(r))}const Vb={code:_P,name:yee,encode:TP,digest:mee};function We(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Ge(r=0){return new Uint8Array(r)}function In(r=0){return new Uint8Array(r)}function mCe(r){return r}function or(r,e){e==null&&(e=r.reduce((i,s)=>i+s.length,0));const t=In(e);let n=0;for(const i of r)t.set(i,n),n+=i.length;return t}const PP=Symbol.for("@achingbrain/uint8arraylist");function DP(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(const n of r){const i=t+n.byteLength;if(e<i)return{buf:n,index:e-t};t=i}throw new RangeError("index is out of bounds")}function w1(r){return!!(r!=null&&r[PP])}class Ue{constructor(...e){u(this,"bufs");u(this,"length");u(this,kj,!0);this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[(kj=PP,Symbol.iterator)](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(w1(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(w1(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){const t=DP(this.bufs,e);return t.buf[t.index]}set(e,t){const n=DP(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(w1(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){const{bufs:n,length:i}=this._subList(e,t);return or(n,i)}subarray(e,t){const{bufs:n,length:i}=this._subList(e,t);return n.length===1?n[0]:or(n,i)}sublist(e,t){const{bufs:n,length:i}=this._subList(e,t),s=new Ue;return s.length=i,s.bufs=[...n],s}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};const n=[];let i=0;for(let s=0;s<this.bufs.length;s++){const o=this.bufs[s],a=i,c=a+o.byteLength;if(i=c,e>=c)continue;const l=e>=a&&e<c,d=t>a&&t<=c;if(l&&d){if(e===a&&t===c){n.push(o);break}const h=e-a;n.push(o.subarray(h,h+(t-e)));break}if(l){if(e===0){n.push(o);continue}n.push(o.subarray(e-a));continue}if(d){if(t===c){n.push(o);break}n.push(o.subarray(0,t-a));break}n.push(o)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!w1(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const i=n.byteLength;if(i===0)throw new TypeError("search must be at least 1 byte long");const s=256,o=new Int32Array(s);for(let h=0;h<s;h++)o[h]=-1;for(let h=0;h<i;h++)o[n[h]]=h;const a=o,c=this.byteLength-n.byteLength,l=n.byteLength-1;let d;for(let h=t;h<=c;h+=d){d=0;for(let p=l;p>=0;p--){const b=this.get(h+p);if(n[p]!==b){d=Math.max(1,p-a[b]);break}}if(d===0)return h}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const n=In(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){const i=Ge(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,t,n),this.write(i,e)}getInt32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){const i=Ge(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,t,n),this.write(i,e)}getBigInt64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){const i=Ge(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,t,n),this.write(i,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const n=In(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){const i=Ge(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,t,n),this.write(i,e)}getUint32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){const i=Ge(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,t,n),this.write(i,e)}getBigUint64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){const i=Ge(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,t,n),this.write(i,e)}getFloat32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){const i=Ge(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,t,n),this.write(i,e)}getFloat64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){const i=Ge(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,t,n),this.write(i,e)}equals(e){if(e==null||!(e instanceof Ue)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!We(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const n=new Ue;return n.bufs=e,t==null&&(t=e.reduce((i,s)=>i+s.byteLength,0)),n.length=t,n}}function wee(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function bee(r){return new TextEncoder().encode(r)}function vee(r){return new TextDecoder().decode(r)}function Eee(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var See=Eee,xee=See;let Aee=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Cee=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return $P(this,e)}},Iee=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return $P(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function $P(r,e){return new Iee({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let kee=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Aee(e,t,n),this.decoder=new Cee(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function q2({name:r,prefix:e,encode:t,decode:n}){return new kee(r,e,t,n)}function b1({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=xee(t,r);return q2({prefix:e,name:r,encode:n,decode:s=>wee(i(s))})}function _ee(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Tee(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Er({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return q2({prefix:e,name:r,encode(i){return Tee(i,n,t)},decode(i){return _ee(i,n,t,r)}})}const Pee=b1({prefix:"9",name:"base10",alphabet:"0123456789"}),Dee=Object.freeze(Object.defineProperty({__proto__:null,base10:Pee},Symbol.toStringTag,{value:"Module"})),$ee=Er({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Nee=Er({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Mee=Object.freeze(Object.defineProperty({__proto__:null,base16:$ee,base16upper:Nee},Symbol.toStringTag,{value:"Module"})),Oee=Er({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Ree=Object.freeze(Object.defineProperty({__proto__:null,base2:Oee},Symbol.toStringTag,{value:"Module"})),NP=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Lee=NP.reduce((r,e,t)=>(r[t]=e,r),[]),Bee=NP.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function Uee(r){return r.reduce((e,t)=>(e+=Lee[t],e),"")}function Fee(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const i=Bee[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const zee=q2({prefix:"🚀",name:"base256emoji",encode:Uee,decode:Fee}),Vee=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:zee},Symbol.toStringTag,{value:"Module"})),Kee=Er({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),jee=Er({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Hee=Er({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),qee=Er({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Wee=Er({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Gee=Er({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Qee=Er({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Jee=Er({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Yee=Er({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Xee=Object.freeze(Object.defineProperty({__proto__:null,base32:Kee,base32hex:Wee,base32hexpad:Qee,base32hexpadupper:Jee,base32hexupper:Gee,base32pad:Hee,base32padupper:qee,base32upper:jee,base32z:Yee},Symbol.toStringTag,{value:"Module"})),Zee=b1({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ete=b1({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),tte=Object.freeze(Object.defineProperty({__proto__:null,base36:Zee,base36upper:ete},Symbol.toStringTag,{value:"Module"})),rte=b1({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),nte=b1({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),ite=Object.freeze(Object.defineProperty({__proto__:null,base58btc:rte,base58flickr:nte},Symbol.toStringTag,{value:"Module"})),ste=Er({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ote=Er({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ate=Er({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),cte=Er({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),lte=Object.freeze(Object.defineProperty({__proto__:null,base64:ste,base64pad:ote,base64url:ate,base64urlpad:cte},Symbol.toStringTag,{value:"Module"})),ute=Er({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),dte=Object.freeze(Object.defineProperty({__proto__:null,base8:ute},Symbol.toStringTag,{value:"Module"})),hte=q2({prefix:"\0",name:"identity",encode:r=>vee(r),decode:r=>bee(r)}),fte=Object.freeze(Object.defineProperty({__proto__:null,identity:hte},Symbol.toStringTag,{value:"Module"}));new TextEncoder,new TextDecoder;const MP={...fte,...Ree,...dte,...Dee,...Mee,...Xee,...tte,...ite,...lte,...Vee};function OP(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const RP=OP("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Kb=OP("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=In(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),LP={utf8:RP,"utf-8":RP,hex:MP.base16,latin1:Kb,ascii:Kb,binary:Kb,...MP};function oe(r,e="utf8"){const t=LP[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}function re(r,e="utf8"){const t=LP[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}const pte=parseInt("11111",2),jb=parseInt("10000000",2),gte=parseInt("01111111",2),BP={0:E1,1:E1,2:yte,3:bte,4:vte,5:wte,6:mte,16:E1,22:E1,48:E1};function Ya(r,e={offset:0}){const t=r[e.offset]&pte;if(e.offset++,BP[t]!=null)return BP[t](r,e);throw new Error("No decoder for tag "+t)}function v1(r,e){let t=0;if((r[e.offset]&jb)===jb){const n=r[e.offset]&gte;let i="0x";e.offset++;for(let s=0;s<n;s++,e.offset++)i+=r[e.offset].toString(16).padStart(2,"0");t=parseInt(i,16)}else t=r[e.offset],e.offset++;return t}function E1(r,e){v1(r,e);const t=[];for(;!(e.offset>=r.byteLength);){const n=Ya(r,e);if(n===null)break;t.push(n)}return t}function yte(r,e){const t=v1(r,e),n=e.offset,i=e.offset+t,s=[];for(let o=n;o<i;o++)o===n&&r[o]===0||s.push(r[o]);return e.offset+=t,Uint8Array.from(s)}function mte(r,e){const t=v1(r,e),n=e.offset+t,i=r[e.offset];e.offset++;let s=0,o=0;i<40?(s=0,o=i):i<80?(s=1,o=i-40):(s=2,o=i-80);let a=`${s}.${o}`,c=[];for(;e.offset<n;){const l=r[e.offset];if(e.offset++,c.push(l&127),l<128){c.reverse();let d=0;for(let h=0;h<c.length;h++)d+=c[h]<<h*7;a+=`.${d}`,c=[]}}return a}function wte(r,e){return e.offset++,null}function bte(r,e){const t=v1(r,e),n=r[e.offset];e.offset++;const i=r.subarray(e.offset,e.offset+t-1);if(e.offset+=t,n!==0)throw new Error("Unused bits in bit string is unimplemented");return i}function vte(r,e){const t=v1(r,e),n=r.subarray(e.offset,e.offset+t);return e.offset+=t,n}function Ete(r){let e=r.toString(16);e.length%2===1&&(e="0"+e);const t=new Ue;for(let n=0;n<e.length;n+=2)t.append(Uint8Array.from([parseInt(`${e[n]}${e[n+1]}`,16)]));return t}function W2(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);const e=Ete(r.byteLength);return new Ue(Uint8Array.from([e.byteLength|jb]),e)}function Zn(r){const e=new Ue,t=128;return(r.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(r),new Ue(Uint8Array.from([2]),W2(e),e)}function Hb(r){const e=Uint8Array.from([0]),t=new Ue(e,r);return new Ue(Uint8Array.from([3]),W2(t),t)}function Ste(r){return new Ue(Uint8Array.from([4]),W2(r),r)}function ko(r,e=48){const t=new Ue;for(const n of r)t.append(n);return new Ue(Uint8Array.from([e]),W2(t),t)}const UP="1.2.840.10045.3.1.7",FP="1.3.132.0.34",zP="1.3.132.0.35";async function xte(r="P-256"){const e=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:r},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",e.publicKey),privateKey:await crypto.subtle.exportKey("jwk",e.privateKey)}}async function Ate(r,e){const t=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["sign"]),n=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},t,e.subarray());return new Uint8Array(n,0,n.byteLength)}async function Cte(r,e,t){const n=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["verify"]);return crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},n,e,t.subarray())}const Ite=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),kte=Uint8Array.from([6,5,43,129,4,0,34]),_te=Uint8Array.from([6,5,43,129,4,0,35]),VP={ext:!0,kty:"EC",crv:"P-256"},KP={ext:!0,kty:"EC",crv:"P-384"},jP={ext:!0,kty:"EC",crv:"P-521"},Cd=32,Id=48,kd=66;function Tte(r){const e=Ya(r);return HP(e)}function HP(r){const e=r[1],t=re(e,"base64url"),n=r[2][1][0],i=1;let s,o;if(e.byteLength===Cd)return s=re(n.subarray(i,i+Cd),"base64url"),o=re(n.subarray(i+Cd),"base64url"),new Q2({...VP,key_ops:["sign"],d:t,x:s,y:o});if(e.byteLength===Id)return s=re(n.subarray(i,i+Id),"base64url"),o=re(n.subarray(i+Id),"base64url"),new Q2({...KP,key_ops:["sign"],d:t,x:s,y:o});if(e.byteLength===kd)return s=re(n.subarray(i,i+kd),"base64url"),o=re(n.subarray(i+kd),"base64url"),new Q2({...jP,key_ops:["sign"],d:t,x:s,y:o});throw new Z(`Private key length was wrong length, got ${e.byteLength}, expected 32, 48 or 66`)}function qP(r){const e=Ya(r);return WP(e)}function WP(r){const e=r[1][1][0],t=1;let n,i;if(e.byteLength===Cd*2+1)return n=re(e.subarray(t,t+Cd),"base64url"),i=re(e.subarray(t+Cd),"base64url"),new G2({...VP,key_ops:["verify"],x:n,y:i});if(e.byteLength===Id*2+1)return n=re(e.subarray(t,t+Id),"base64url"),i=re(e.subarray(t+Id),"base64url"),new G2({...KP,key_ops:["verify"],x:n,y:i});if(e.byteLength===kd*2+1)return n=re(e.subarray(t,t+kd),"base64url"),i=re(e.subarray(t+kd),"base64url"),new G2({...jP,key_ops:["verify"],x:n,y:i});throw new Z(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function Pte(r){return ko([Zn(Uint8Array.from([1])),Ste(oe(r.d??"","base64url")),ko([GP(r.crv)],160),ko([Hb(new Ue(Uint8Array.from([4]),oe(r.x??"","base64url"),oe(r.y??"","base64url")))],161)]).subarray()}function Dte(r){return ko([Zn(Uint8Array.from([1])),ko([GP(r.crv)],160),ko([Hb(new Ue(Uint8Array.from([4]),oe(r.x??"","base64url"),oe(r.y??"","base64url")))],161)]).subarray()}function GP(r){if(r==="P-256")return Ite;if(r==="P-384")return kte;if(r==="P-521")return _te;throw new Z(`Invalid curve ${r}`)}async function $te(r="P-256"){const e=await xte(r);return new Q2(e.privateKey)}class G2{constructor(e){u(this,"type","ECDSA");u(this,"jwk");u(this,"_raw");this.jwk=e}get raw(){return this._raw==null&&(this._raw=Dte(this.jwk)),this._raw}toMultihash(){return Vb.digest(_i(this))}toCID(){return H2.createV1(114,this.toMultihash())}toString(){return ki.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}async verify(e,t){return Cte(this.jwk,t,e)}}class Q2{constructor(e){u(this,"type","ECDSA");u(this,"jwk");u(this,"publicKey");u(this,"_raw");this.jwk=e,this.publicKey=new G2({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){return this._raw==null&&(this._raw=Pte(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}async sign(e){return Ate(this.jwk,e)}}function QP(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Nte(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function J2(r,...e){if(!Nte(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Mte(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");QP(r.outputLen),QP(r.blockLen)}function Y2(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Ote(r,e){J2(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const _d=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function qb(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function Ms(r,e){return r<<32-e|r>>>e}typeof Uint8Array.from([]).toHex=="function"&&Uint8Array.fromHex;function Rte(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function Wb(r){return typeof r=="string"&&(r=Rte(r)),J2(r),r}function Lte(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];J2(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const s=r[n];t.set(s,i),i+=s.length}return t}let JP=class{clone(){return this._cloneInto()}};function YP(r){const e=n=>r().update(Wb(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Gb(r=32){if(_d&&typeof _d.getRandomValues=="function")return _d.getRandomValues(new Uint8Array(r));if(_d&&typeof _d.randomBytes=="function")return Uint8Array.from(_d.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function Bte(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function Ute(r,e,t){return r&e^~r&t}function Fte(r,e,t){return r&e^r&t^e&t}let XP=class extends JP{constructor(e,t,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=qb(this.buffer)}update(e){Y2(this);const{view:t,buffer:n,blockLen:i}=this;e=Wb(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=qb(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Y2(this),Ote(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)t[h]=0;Bte(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=qb(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,d[h],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%t&&e.buffer.set(n),e}};const zte=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Xa=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Za=new Uint32Array(64);let Vte=class extends XP{constructor(e=32){super(64,e,8,!1),this.A=Xa[0]|0,this.B=Xa[1]|0,this.C=Xa[2]|0,this.D=Xa[3]|0,this.E=Xa[4]|0,this.F=Xa[5]|0,this.G=Xa[6]|0,this.H=Xa[7]|0}get(){const{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)Za[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const p=Za[h-15],b=Za[h-2],f=Ms(p,7)^Ms(p,18)^p>>>3,g=Ms(b,17)^Ms(b,19)^b>>>10;Za[h]=g+Za[h-7]+f+Za[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:l,H:d}=this;for(let h=0;h<64;h++){const p=Ms(a,6)^Ms(a,11)^Ms(a,25),b=d+p+Ute(a,c,l)+zte[h]+Za[h]|0,g=(Ms(n,2)^Ms(n,13)^Ms(n,22))+Fte(n,i,s)|0;d=l,l=c,c=a,a=o+b|0,o=s,s=i,i=n,n=b+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(n,i,s,o,a,c,l,d)}roundClean(){Za.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Kte=YP(()=>new Vte),X2=BigInt(2**32-1),Qb=BigInt(32);function ZP(r,e=!1){return e?{h:Number(r&X2),l:Number(r>>Qb&X2)}:{h:Number(r>>Qb&X2)|0,l:Number(r&X2)|0}}function jte(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let i=0;i<r.length;i++){const{h:s,l:o}=ZP(r[i],e);[t[i],n[i]]=[s,o]}return[t,n]}const Hte=(r,e)=>BigInt(r>>>0)<<Qb|BigInt(e>>>0),qte=(r,e,t)=>r>>>t,Wte=(r,e,t)=>r<<32-t|e>>>t,Gte=(r,e,t)=>r>>>t|e<<32-t,Qte=(r,e,t)=>r<<32-t|e>>>t,Jte=(r,e,t)=>r<<64-t|e>>>t-32,Yte=(r,e,t)=>r>>>t-32|e<<64-t,Xte=(r,e)=>e,Zte=(r,e)=>r,ere=(r,e,t)=>r<<t|e>>>32-t,tre=(r,e,t)=>e<<t|r>>>32-t,rre=(r,e,t)=>e<<t-32|r>>>64-t,nre=(r,e,t)=>r<<t-32|e>>>64-t;function ire(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}const je={fromBig:ZP,split:jte,toBig:Hte,shrSH:qte,shrSL:Wte,rotrSH:Gte,rotrSL:Qte,rotrBH:Jte,rotrBL:Yte,rotr32H:Xte,rotr32L:Zte,rotlSH:ere,rotlSL:tre,rotlBH:rre,rotlBL:nre,add:ire,add3L:(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),add3H:(r,e,t,n)=>e+t+n+(r/2**32|0)|0,add4L:(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),add4H:(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,add5H:(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0,add5L:(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0)},[sre,ore]=je.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),ec=new Uint32Array(80),tc=new Uint32Array(80);let are=class extends XP{constructor(e=64){super(128,e,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:d,Fh:h,Fl:p,Gh:b,Gl:f,Hh:g,Hl:v}=this;return[e,t,n,i,s,o,a,c,l,d,h,p,b,f,g,v]}set(e,t,n,i,s,o,a,c,l,d,h,p,b,f,g,v){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=d|0,this.Fh=h|0,this.Fl=p|0,this.Gh=b|0,this.Gl=f|0,this.Hh=g|0,this.Hl=v|0}process(e,t){for(let m=0;m<16;m++,t+=4)ec[m]=e.getUint32(t),tc[m]=e.getUint32(t+=4);for(let m=16;m<80;m++){const E=ec[m-15]|0,A=tc[m-15]|0,k=je.rotrSH(E,A,1)^je.rotrSH(E,A,8)^je.shrSH(E,A,7),x=je.rotrSL(E,A,1)^je.rotrSL(E,A,8)^je.shrSL(E,A,7),I=ec[m-2]|0,T=tc[m-2]|0,L=je.rotrSH(I,T,19)^je.rotrBH(I,T,61)^je.shrSH(I,T,6),z=je.rotrSL(I,T,19)^je.rotrBL(I,T,61)^je.shrSL(I,T,6),B=je.add4L(x,z,tc[m-7],tc[m-16]),G=je.add4H(B,k,L,ec[m-7],ec[m-16]);ec[m]=G|0,tc[m]=B|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:d,Eh:h,El:p,Fh:b,Fl:f,Gh:g,Gl:v,Hh:y,Hl:w}=this;for(let m=0;m<80;m++){const E=je.rotrSH(h,p,14)^je.rotrSH(h,p,18)^je.rotrBH(h,p,41),A=je.rotrSL(h,p,14)^je.rotrSL(h,p,18)^je.rotrBL(h,p,41),k=h&b^~h&g,x=p&f^~p&v,I=je.add5L(w,A,x,ore[m],tc[m]),T=je.add5H(I,y,E,k,sre[m],ec[m]),L=I|0,z=je.rotrSH(n,i,28)^je.rotrBH(n,i,34)^je.rotrBH(n,i,39),B=je.rotrSL(n,i,28)^je.rotrBL(n,i,34)^je.rotrBL(n,i,39),G=n&s^n&a^s&a,j=i&o^i&c^o&c;y=g|0,w=v|0,g=b|0,v=f|0,b=h|0,f=p|0,{h,l:p}=je.add(l|0,d|0,T|0,L|0),l=a|0,d=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const q=je.add3L(L,B,j);n=je.add3H(q,T,z,G),i=q|0}({h:n,l:i}=je.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=je.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=je.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:d}=je.add(this.Dh|0,this.Dl|0,l|0,d|0),{h,l:p}=je.add(this.Eh|0,this.El|0,h|0,p|0),{h:b,l:f}=je.add(this.Fh|0,this.Fl|0,b|0,f|0),{h:g,l:v}=je.add(this.Gh|0,this.Gl|0,g|0,v|0),{h:y,l:w}=je.add(this.Hh|0,this.Hl|0,y|0,w|0),this.set(n,i,s,o,a,c,l,d,h,p,b,f,g,v,y,w)}roundClean(){ec.fill(0),tc.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const cre=YP(()=>new are);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Jb=BigInt(0),Yb=BigInt(1);function Td(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Xb(r){if(!Td(r))throw new Error("Uint8Array expected")}function rc(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}function Z2(r){const e=r.toString(16);return e.length&1?"0"+e:e}function eD(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Jb:BigInt("0x"+r)}const tD=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",lre=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Pd(r){if(Xb(r),tD)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=lre[r[t]];return e}const _o={_0:48,_9:57,A:65,F:70,a:97,f:102};function rD(r){if(r>=_o._0&&r<=_o._9)return r-_o._0;if(r>=_o.A&&r<=_o.F)return r-(_o.A-10);if(r>=_o.a&&r<=_o.f)return r-(_o.a-10)}function ey(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(tD)return Uint8Array.fromHex(r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let i=0,s=0;i<t;i++,s+=2){const o=rD(r.charCodeAt(s)),a=rD(r.charCodeAt(s+1));if(o===void 0||a===void 0){const c=r[s]+r[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function Ml(r){return eD(Pd(r))}function Ol(r){return Xb(r),eD(Pd(Uint8Array.from(r).reverse()))}function S1(r,e){return ey(r.toString(16).padStart(e*2,"0"))}function x1(r,e){return S1(r,e).reverse()}function qt(r,e,t){let n;if(typeof e=="string")try{n=ey(e)}catch(s){throw new Error(r+" must be hex string or Uint8Array, cause: "+s)}else if(Td(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const i=n.length;if(typeof t=="number"&&i!==t)throw new Error(r+" of length "+t+" expected, got "+i);return n}function Dd(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];Xb(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const s=r[n];t.set(s,i),i+=s.length}return t}const Zb=r=>typeof r=="bigint"&&Jb<=r;function ev(r,e,t){return Zb(r)&&Zb(e)&&Zb(t)&&e<=r&&r<t}function ei(r,e,t,n){if(!ev(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function ure(r){let e;for(e=0;r>Jb;r>>=Yb,e+=1);return e}const ty=r=>(Yb<<BigInt(r))-Yb,tv=r=>new Uint8Array(r),nD=r=>Uint8Array.from(r);function dre(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=tv(r),i=tv(r),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...h)=>t(i,n,...h),c=(h=tv(0))=>{i=a(nD([0]),h),n=a(),h.length!==0&&(i=a(nD([1]),h),n=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const p=[];for(;h<e;){n=a();const b=n.slice();p.push(b),h+=n.length}return Dd(...p)};return(h,p)=>{o(),c(h);let b;for(;!(b=p(l()));)c();return o(),b}}const hre={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||Td(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function $d(r,e,t={}){const n=(i,s,o)=>{const a=hre[s];if(typeof a!="function")throw new Error("invalid validator function");const c=r[i];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(t))n(i,s,!0);return r}function ry(r){const e=new WeakMap;return(t,...n)=>{const i=e.get(t);if(i!==void 0)return i;const s=r(t,...n);return e.set(t,s),s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const hr=BigInt(0),Ft=BigInt(1),Rl=BigInt(2),fre=BigInt(3),rv=BigInt(4),iD=BigInt(5),sD=BigInt(8);function xt(r,e){const t=r%e;return t>=hr?t:e+t}function oD(r,e,t){if(e<hr)throw new Error("invalid exponent, negatives unsupported");if(t<=hr)throw new Error("invalid modulus");if(t===Ft)return hr;let n=Ft;for(;e>hr;)e&Ft&&(n=n*r%t),r=r*r%t,e>>=Ft;return n}function zt(r,e,t){let n=r;for(;e-- >hr;)n*=n,n%=t;return n}function nv(r,e){if(r===hr)throw new Error("invert: expected non-zero number");if(e<=hr)throw new Error("invert: expected positive modulus, got "+e);let t=xt(r,e),n=e,i=hr,s=Ft;for(;t!==hr;){const a=n/t,c=n%t,l=i-s*a;n=t,t=c,i=s,s=l}if(n!==Ft)throw new Error("invert: does not exist");return xt(i,e)}function pre(r){const e=(r-Ft)/Rl;let t,n,i;for(t=r-Ft,n=0;t%Rl===hr;t/=Rl,n++);for(i=Rl;i<r&&oD(i,e,r)!==r-Ft;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(r+Ft)/rv;return function(c,l){const d=c.pow(l,o);if(!c.eql(c.sqr(d),l))throw new Error("Cannot find square root");return d}}const s=(t+Ft)/Rl;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=n,d=a.pow(a.mul(a.ONE,i),t),h=a.pow(c,s),p=a.pow(c,t);for(;!a.eql(p,a.ONE);){if(a.eql(p,a.ZERO))return a.ZERO;let b=1;for(let g=a.sqr(p);b<l&&!a.eql(g,a.ONE);b++)g=a.sqr(g);const f=a.pow(d,Ft<<BigInt(l-b-1));d=a.sqr(f),h=a.mul(h,f),p=a.mul(p,d),l=b}return h}}function gre(r){if(r%rv===fre){const e=(r+Ft)/rv;return function(n,i){const s=n.pow(i,e);if(!n.eql(n.sqr(s),i))throw new Error("Cannot find square root");return s}}if(r%sD===iD){const e=(r-iD)/sD;return function(n,i){const s=n.mul(i,Rl),o=n.pow(s,e),a=n.mul(i,o),c=n.mul(n.mul(a,Rl),o),l=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(l),i))throw new Error("Cannot find square root");return l}}return pre(r)}const yre=(r,e)=>(xt(r,e)&Ft)===Ft,mre=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function wre(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=mre.reduce((n,i)=>(n[i]="function",n),e);return $d(r,t)}function bre(r,e,t){if(t<hr)throw new Error("invalid exponent, negatives unsupported");if(t===hr)return r.ONE;if(t===Ft)return e;let n=r.ONE,i=e;for(;t>hr;)t&Ft&&(n=r.mul(n,i)),i=r.sqr(i),t>>=Ft;return n}function vre(r,e){const t=new Array(e.length),n=e.reduce((s,o,a)=>r.is0(o)?s:(t[a]=s,r.mul(s,o)),r.ONE),i=r.inv(n);return e.reduceRight((s,o,a)=>r.is0(o)?s:(t[a]=r.mul(s,t[a]),r.mul(s,o)),i),t}function aD(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function ny(r,e,t=!1,n={}){if(r<=hr)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:i,nByteLength:s}=aD(r,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:r,isLE:t,BITS:i,BYTES:s,MASK:ty(i),ZERO:hr,ONE:Ft,create:c=>xt(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return hr<=c&&c<r},is0:c=>c===hr,isOdd:c=>(c&Ft)===Ft,neg:c=>xt(-c,r),eql:(c,l)=>c===l,sqr:c=>xt(c*c,r),add:(c,l)=>xt(c+l,r),sub:(c,l)=>xt(c-l,r),mul:(c,l)=>xt(c*l,r),pow:(c,l)=>bre(a,c,l),div:(c,l)=>xt(c*nv(l,r),r),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>nv(c,r),sqrt:n.sqrt||(c=>(o||(o=gre(r)),o(a,c))),invertBatch:c=>vre(a,c),cmov:(c,l,d)=>d?l:c,toBytes:c=>t?x1(c,s):S1(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return t?Ol(c):Ml(c)}});return Object.freeze(a)}function cD(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function lD(r){const e=cD(r);return e+Math.ceil(e/2)}function Ere(r,e,t=!1){const n=r.length,i=cD(e),s=lD(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=t?Ol(r):Ml(r),a=xt(o,e-Ft)+Ft;return t?x1(a,i):S1(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const uD=BigInt(0),iv=BigInt(1);function sv(r,e){const t=e.negate();return r?t:e}function dD(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function ov(r,e){dD(r,e);const t=Math.ceil(e/r)+1,n=2**(r-1),i=2**r,s=ty(r),o=BigInt(r);return{windows:t,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function hD(r,e,t){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=t;let a=Number(r&i),c=r>>o;a>n&&(a-=s,c+=iv);const l=e*n,d=l+Math.abs(a)-1,h=a===0,p=a<0,b=e%2!==0;return{nextN:c,offset:d,isZero:h,isNeg:p,isNegF:b,offsetF:l}}function Sre(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function xre(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}const av=new WeakMap,fD=new WeakMap;function cv(r){return fD.get(r)||1}function pD(r,e){return{constTimeNegate:sv,hasPrecomputes(t){return cv(t)!==1},unsafeLadder(t,n,i=r.ZERO){let s=t;for(;n>uD;)n&iv&&(i=i.add(s)),s=s.double(),n>>=iv;return i},precomputeWindow(t,n){const{windows:i,windowSize:s}=ov(n,e),o=[];let a=t,c=a;for(let l=0;l<i;l++){c=a,o.push(c);for(let d=1;d<s;d++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,n,i){let s=r.ZERO,o=r.BASE;const a=ov(t,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:d,isZero:h,isNeg:p,isNegF:b,offsetF:f}=hD(i,c,a);i=l,h?o=o.add(sv(b,n[f])):s=s.add(sv(p,n[d]))}return{p:s,f:o}},wNAFUnsafe(t,n,i,s=r.ZERO){const o=ov(t,e);for(let a=0;a<o.windows&&i!==uD;a++){const{nextN:c,offset:l,isZero:d,isNeg:h}=hD(i,a,o);if(i=c,!d){const p=n[l];s=s.add(h?p.negate():p)}}return s},getPrecomputes(t,n,i){let s=av.get(n);return s||(s=this.precomputeWindow(n,t),t!==1&&av.set(n,i(s))),s},wNAFCached(t,n,i){const s=cv(t);return this.wNAF(s,this.getPrecomputes(s,t,i),n)},wNAFCachedUnsafe(t,n,i,s){const o=cv(t);return o===1?this.unsafeLadder(t,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,t,i),n,s)},setWindowSize(t,n){dD(n,e),fD.set(t,n),av.delete(t)}}}function gD(r,e,t,n){if(Sre(t,r),xre(n,e),t.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=r.ZERO,s=ure(BigInt(t.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=ty(o),c=new Array(Number(a)+1).fill(i),l=Math.floor((e.BITS-1)/o)*o;let d=i;for(let h=l;h>=0;h-=o){c.fill(i);for(let b=0;b<n.length;b++){const f=n[b],g=Number(f>>BigInt(h)&a);c[g]=c[g].add(t[b])}let p=i;for(let b=c.length-1,f=i;b>0;b--)f=f.add(c[b]),p=p.add(f);if(d=d.add(p),h!==0)for(let b=0;b<o;b++)d=d.double()}return d}function lv(r){return wre(r.Fp),$d(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...aD(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Os=BigInt(0),hn=BigInt(1),yD=BigInt(2),Are=BigInt(8),Cre={zip215:!0};function Ire(r){const e=lv(r);return $d(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function kre(r){const e=Ire(r),{Fp:t,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,l=yD<<BigInt(a*8)-hn,d=t.create,h=ny(e.n,e.nBitLength),p=e.uvRatio||((K,O)=>{try{return{isValid:!0,value:t.sqrt(K*t.inv(O))}}catch{return{isValid:!1,value:Os}}}),b=e.adjustScalarBytes||(K=>K),f=e.domain||((K,O,U)=>{if(rc("phflag",U),O.length||U)throw new Error("Contexts/pre-hash are not supported");return K});function g(K,O,U=!1){const W=U?hn:Os;ei("coordinate "+K,O,W,l)}function v(K){if(!(K instanceof m))throw new Error("ExtendedPoint expected")}const y=ry((K,O)=>{const{ex:U,ey:W,ez:J}=K,H=K.is0();O==null&&(O=H?Are:t.inv(J));const se=d(U*O),we=d(W*O),ce=d(J*O);if(H)return{x:Os,y:hn};if(ce!==hn)throw new Error("invZ was invalid");return{x:se,y:we}}),w=ry(K=>{const{a:O,d:U}=e;if(K.is0())throw new Error("bad point: ZERO");const{ex:W,ey:J,ez:H,et:se}=K,we=d(W*W),ce=d(J*J),de=d(H*H),Ne=d(de*de),Me=d(we*O),Ze=d(de*d(Me+ce)),lt=d(Ne+d(U*d(we*ce)));if(Ze!==lt)throw new Error("bad point: equation left != right (1)");const vt=d(W*J),kt=d(H*se);if(vt!==kt)throw new Error("bad point: equation left != right (2)");return!0});class m{constructor(O,U,W,J){g("x",O),g("y",U),g("z",W,!0),g("t",J),this.ex=O,this.ey=U,this.ez=W,this.et=J,Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(O){if(O instanceof m)throw new Error("extended point not allowed");const{x:U,y:W}=O||{};return g("x",U),g("y",W),new m(U,W,hn,d(U*W))}static normalizeZ(O){const U=t.invertBatch(O.map(W=>W.ez));return O.map((W,J)=>W.toAffine(U[J])).map(m.fromAffine)}static msm(O,U){return gD(m,h,O,U)}_setWindowSize(O){k.setWindowSize(this,O)}assertValidity(){w(this)}equals(O){v(O);const{ex:U,ey:W,ez:J}=this,{ex:H,ey:se,ez:we}=O,ce=d(U*we),de=d(H*J),Ne=d(W*we),Me=d(se*J);return ce===de&&Ne===Me}is0(){return this.equals(m.ZERO)}negate(){return new m(d(-this.ex),this.ey,this.ez,d(-this.et))}double(){const{a:O}=e,{ex:U,ey:W,ez:J}=this,H=d(U*U),se=d(W*W),we=d(yD*d(J*J)),ce=d(O*H),de=U+W,Ne=d(d(de*de)-H-se),Me=ce+se,Ze=Me-we,lt=ce-se,vt=d(Ne*Ze),kt=d(Me*lt),$t=d(Ne*lt),nr=d(Ze*Me);return new m(vt,kt,nr,$t)}add(O){v(O);const{a:U,d:W}=e,{ex:J,ey:H,ez:se,et:we}=this,{ex:ce,ey:de,ez:Ne,et:Me}=O,Ze=d(J*ce),lt=d(H*de),vt=d(we*W*Me),kt=d(se*Ne),$t=d((J+H)*(ce+de)-Ze-lt),nr=kt-vt,Nr=kt+vt,fa=d(lt-U*Ze),eo=d($t*nr),Gc=d(Nr*fa),fe=d($t*fa),Ki=d(nr*Nr);return new m(eo,Gc,Ki,fe)}subtract(O){return this.add(O.negate())}wNAF(O){return k.wNAFCached(this,O,m.normalizeZ)}multiply(O){const U=O;ei("scalar",U,hn,n);const{p:W,f:J}=this.wNAF(U);return m.normalizeZ([W,J])[0]}multiplyUnsafe(O,U=m.ZERO){const W=O;return ei("scalar",W,Os,n),W===Os?A:this.is0()||W===hn?this:k.wNAFCachedUnsafe(this,W,m.normalizeZ,U)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return k.unsafeLadder(this,n).is0()}toAffine(O){return y(this,O)}clearCofactor(){const{h:O}=e;return O===hn?this:this.multiplyUnsafe(O)}static fromHex(O,U=!1){const{d:W,a:J}=e,H=t.BYTES;O=qt("pointHex",O,H),rc("zip215",U);const se=O.slice(),we=O[H-1];se[H-1]=we&-129;const ce=Ol(se),de=U?l:t.ORDER;ei("pointHex.y",ce,Os,de);const Ne=d(ce*ce),Me=d(Ne-hn),Ze=d(W*Ne-J);let{isValid:lt,value:vt}=p(Me,Ze);if(!lt)throw new Error("Point.fromHex: invalid y coordinate");const kt=(vt&hn)===hn,$t=(we&128)!==0;if(!U&&vt===Os&&$t)throw new Error("Point.fromHex: x=0 and x_0=1");return $t!==kt&&(vt=d(-vt)),m.fromAffine({x:vt,y:ce})}static fromPrivateKey(O){const{scalar:U}=T(O);return E.multiply(U)}toRawBytes(){const{x:O,y:U}=this.toAffine(),W=x1(U,t.BYTES);return W[W.length-1]|=O&hn?128:0,W}toHex(){return Pd(this.toRawBytes())}}m.BASE=new m(e.Gx,e.Gy,hn,d(e.Gx*e.Gy)),m.ZERO=new m(Os,hn,hn,Os);const{BASE:E,ZERO:A}=m,k=pD(m,a*8);function x(K){return xt(K,n)}function I(K){return x(Ol(K))}function T(K){const O=t.BYTES;K=qt("private key",K,O);const U=qt("hashed private key",s(K),2*O),W=b(U.slice(0,O)),J=U.slice(O,2*O),H=I(W);return{head:W,prefix:J,scalar:H}}function L(K){const{head:O,prefix:U,scalar:W}=T(K),J=E.multiply(W),H=J.toRawBytes();return{head:O,prefix:U,scalar:W,point:J,pointBytes:H}}function z(K){return L(K).pointBytes}function B(K=new Uint8Array,...O){const U=Dd(...O);return I(s(f(U,qt("context",K),!!i)))}function G(K,O,U={}){K=qt("message",K),i&&(K=i(K));const{prefix:W,scalar:J,pointBytes:H}=L(O),se=B(U.context,W,K),we=E.multiply(se).toRawBytes(),ce=B(U.context,we,H,K),de=x(se+ce*J);ei("signature.s",de,Os,n);const Ne=Dd(we,x1(de,t.BYTES));return qt("result",Ne,t.BYTES*2)}const j=Cre;function q(K,O,U,W=j){const{context:J,zip215:H}=W,se=t.BYTES;K=qt("signature",K,2*se),O=qt("message",O),U=qt("publicKey",U,se),H!==void 0&&rc("zip215",H),i&&(O=i(O));const we=Ol(K.slice(se,2*se));let ce,de,Ne;try{ce=m.fromHex(U,H),de=m.fromHex(K.slice(0,se),H),Ne=E.multiplyUnsafe(we)}catch{return!1}if(!H&&ce.isSmallOrder())return!1;const Me=B(J,de.toRawBytes(),ce.toRawBytes(),O);return de.add(ce.multiplyUnsafe(Me)).subtract(Ne).clearCofactor().equals(m.ZERO)}return E._setWindowSize(8),{CURVE:e,getPublicKey:z,sign:G,verify:q,ExtendedPoint:m,utils:{getExtendedPublicKey:L,randomPrivateKey:()=>o(t.BYTES),precompute(K=8,O=m.BASE){return O._setWindowSize(K),O.multiply(BigInt(3)),O}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Nd=BigInt(0),uv=BigInt(1);function _re(r){return $d(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function Tre(r){const e=_re(r),{P:t}=e,n=w=>xt(w,t),i=e.montgomeryBits,s=Math.ceil(i/8),o=e.nByteLength,a=e.adjustScalarBytes||(w=>w),c=e.powPminus2||(w=>oD(w,t-BigInt(2),t));function l(w,m,E){const A=n(w*(m-E));return m=n(m-A),E=n(E+A),[m,E]}const d=(e.a-BigInt(2))/BigInt(4);function h(w,m){ei("u",w,Nd,t),ei("scalar",m,Nd,t);const E=m,A=w;let k=uv,x=Nd,I=w,T=uv,L=Nd,z;for(let G=BigInt(i-1);G>=Nd;G--){const j=E>>G&uv;L^=j,z=l(L,k,I),k=z[0],I=z[1],z=l(L,x,T),x=z[0],T=z[1],L=j;const q=k+x,Q=n(q*q),K=k-x,O=n(K*K),U=Q-O,W=I+T,J=I-T,H=n(J*q),se=n(W*K),we=H+se,ce=H-se;I=n(we*we),T=n(A*n(ce*ce)),k=n(Q*O),x=n(U*(Q+n(d*U)))}z=l(L,k,I),k=z[0],I=z[1],z=l(L,x,T),x=z[0],T=z[1];const B=c(x);return n(k*B)}function p(w){return x1(n(w),s)}function b(w){const m=qt("u coordinate",w,s);return o===32&&(m[31]&=127),Ol(m)}function f(w){const m=qt("scalar",w),E=m.length;if(E!==s&&E!==o){let A=""+s+" or "+o;throw new Error("invalid scalar, expected "+A+" bytes, got "+E)}return Ol(a(m))}function g(w,m){const E=b(m),A=f(w),k=h(E,A);if(k===Nd)throw new Error("invalid private or public key received");return p(k)}const v=p(e.Gu);function y(w){return g(w,v)}return{scalarMult:g,scalarMultBase:y,getSharedSecret:(w,m)=>g(w,m),getPublicKey:w=>y(w),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:v}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const A1=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),mD=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Pre=BigInt(1),wD=BigInt(2),Dre=BigInt(3),$re=BigInt(5),Nre=BigInt(8);function bD(r){const e=BigInt(10),t=BigInt(20),n=BigInt(40),i=BigInt(80),s=A1,a=r*r%s*r%s,c=zt(a,wD,s)*a%s,l=zt(c,Pre,s)*r%s,d=zt(l,$re,s)*l%s,h=zt(d,e,s)*d%s,p=zt(h,t,s)*h%s,b=zt(p,n,s)*p%s,f=zt(b,i,s)*b%s,g=zt(f,i,s)*b%s,v=zt(g,e,s)*d%s;return{pow_p_5_8:zt(v,wD,s)*r%s,b2:a}}function vD(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function Mre(r,e){const t=A1,n=xt(e*e*e,t),i=xt(n*n*e,t),s=bD(r*i).pow_p_5_8;let o=xt(r*n*s,t);const a=xt(e*o*o,t),c=o,l=xt(o*mD,t),d=a===r,h=a===xt(-r,t),p=a===xt(-r*mD,t);return d&&(o=c),(h||p)&&(o=l),yre(o,t)&&(o=xt(-o,t)),{isValid:d||h,value:o}}const ED=ny(A1,void 0,!0),Ore={a:ED.create(BigInt(-1)),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:ED,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Nre,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:cre,randomBytes:Gb,adjustScalarBytes:vD,uvRatio:Mre},iy=kre(Ore),sy=Tre({P:A1,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{const e=A1,{pow_p_5_8:t,b2:n}=bD(r);return xt(zt(t,Dre,e)*n,e)},adjustScalarBytes:vD,randomBytes:Gb}),C1=32,To=64,dv=32;function Rre(){const r=iy.utils.randomPrivateKey(),e=iy.getPublicKey(r);return{privateKey:Ure(r,e),publicKey:e}}function Lre(r,e){const t=r.subarray(0,dv);return iy.sign(e instanceof Uint8Array?e:e.subarray(),t)}function Bre(r,e,t){return iy.verify(e,t instanceof Uint8Array?t:t.subarray(),r)}function Ure(r,e){const t=new Uint8Array(To);for(let n=0;n<dv;n++)t[n]=r[n],t[dv+n]=e[n];return t}class SD{constructor(e){u(this,"type","Ed25519");u(this,"raw");this.raw=I1(e,C1)}toMultihash(){return Vb.digest(_i(this))}toCID(){return H2.createV1(114,this.toMultihash())}toString(){return ki.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}verify(e,t){return Bre(this.raw,t,e)}}class hv{constructor(e,t){u(this,"type","Ed25519");u(this,"raw");u(this,"publicKey");this.raw=I1(e,To),this.publicKey=new SD(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}sign(e){return Lre(this.raw,e)}}function xD(r){if(r.length>To){r=I1(r,To+C1);const n=r.subarray(0,To),i=r.subarray(To,r.length);return new hv(n,i)}r=I1(r,To);const e=r.subarray(0,To),t=r.subarray(C1);return new hv(e,t)}function fv(r){return r=I1(r,C1),new SD(r)}async function Fre(){const{privateKey:r,publicKey:e}=Rre();return new hv(r,e)}function I1(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new Z(`Key must be a Uint8Array of length ${e}, got ${r.length}`);return r}const zre=Math.pow(2,7),Vre=Math.pow(2,14),Kre=Math.pow(2,21),pv=Math.pow(2,28),gv=Math.pow(2,35),yv=Math.pow(2,42),mv=Math.pow(2,49),ut=128,Ur=127;function yt(r){if(r<zre)return 1;if(r<Vre)return 2;if(r<Kre)return 3;if(r<pv)return 4;if(r<gv)return 5;if(r<yv)return 6;if(r<mv)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function AD(r,e,t=0){switch(yt(r)){case 8:e[t++]=r&255|ut,r/=128;case 7:e[t++]=r&255|ut,r/=128;case 6:e[t++]=r&255|ut,r/=128;case 5:e[t++]=r&255|ut,r/=128;case 4:e[t++]=r&255|ut,r>>>=7;case 3:e[t++]=r&255|ut,r>>>=7;case 2:e[t++]=r&255|ut,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function jre(r,e,t=0){switch(yt(r)){case 8:e.set(t++,r&255|ut),r/=128;case 7:e.set(t++,r&255|ut),r/=128;case 6:e.set(t++,r&255|ut),r/=128;case 5:e.set(t++,r&255|ut),r/=128;case 4:e.set(t++,r&255|ut),r>>>=7;case 3:e.set(t++,r&255|ut),r>>>=7;case 2:e.set(t++,r&255|ut),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function CD(r,e){let t=r[e],n=0;if(n+=t&Ur,t<ut||(t=r[e+1],n+=(t&Ur)<<7,t<ut)||(t=r[e+2],n+=(t&Ur)<<14,t<ut)||(t=r[e+3],n+=(t&Ur)<<21,t<ut)||(t=r[e+4],n+=(t&Ur)*pv,t<ut)||(t=r[e+5],n+=(t&Ur)*gv,t<ut)||(t=r[e+6],n+=(t&Ur)*yv,t<ut)||(t=r[e+7],n+=(t&Ur)*mv,t<ut))return n;throw new RangeError("Could not decode varint")}function Hre(r,e){let t=r.get(e),n=0;if(n+=t&Ur,t<ut||(t=r.get(e+1),n+=(t&Ur)<<7,t<ut)||(t=r.get(e+2),n+=(t&Ur)<<14,t<ut)||(t=r.get(e+3),n+=(t&Ur)<<21,t<ut)||(t=r.get(e+4),n+=(t&Ur)*pv,t<ut)||(t=r.get(e+5),n+=(t&Ur)*gv,t<ut)||(t=r.get(e+6),n+=(t&Ur)*yv,t<ut)||(t=r.get(e+7),n+=(t&Ur)*mv,t<ut))return n;throw new RangeError("Could not decode varint")}function Sr(r,e,t=0){return e==null&&(e=In(yt(r))),e instanceof Uint8Array?AD(r,e,t):jre(r,e,t)}function es(r,e=0){return r instanceof Uint8Array?CD(r,e):Hre(r,e)}const wv=new Float32Array([-0]),nc=new Uint8Array(wv.buffer);function qre(r,e,t){wv[0]=r,e[t]=nc[0],e[t+1]=nc[1],e[t+2]=nc[2],e[t+3]=nc[3]}function Wre(r,e){return nc[0]=r[e],nc[1]=r[e+1],nc[2]=r[e+2],nc[3]=r[e+3],wv[0]}const bv=new Float64Array([-0]),Fr=new Uint8Array(bv.buffer);function Gre(r,e,t){bv[0]=r,e[t]=Fr[0],e[t+1]=Fr[1],e[t+2]=Fr[2],e[t+3]=Fr[3],e[t+4]=Fr[4],e[t+5]=Fr[5],e[t+6]=Fr[6],e[t+7]=Fr[7]}function Qre(r,e){return Fr[0]=r[e],Fr[1]=r[e+1],Fr[2]=r[e+2],Fr[3]=r[e+3],Fr[4]=r[e+4],Fr[5]=r[e+5],Fr[6]=r[e+6],Fr[7]=r[e+7],bv[0]}const Jre=BigInt(Number.MAX_SAFE_INTEGER),Yre=BigInt(Number.MIN_SAFE_INTEGER);class zr{constructor(e,t){u(this,"lo");u(this,"hi");this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return Ll;if(e<Jre&&e>Yre)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let n=e>>32n,i=e-(n<<32n);return t&&(n=~n|0n,i=~i|0n,++i>ID&&(i=0n,++n>ID&&(n=0n))),new zr(Number(i),Number(n))}static fromNumber(e){if(e===0)return Ll;const t=e<0;t&&(e=-e);let n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new zr(n,i)}static from(e){return typeof e=="number"?zr.fromNumber(e):typeof e=="bigint"?zr.fromBigInt(e):typeof e=="string"?zr.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new zr(e.low>>>0,e.high>>>0):Ll}}const Ll=new zr(0,0);Ll.toBigInt=function(){return 0n},Ll.zzEncode=Ll.zzDecode=function(){return this},Ll.length=function(){return 1};const ID=4294967296n;function Xre(r){let e=0,t=0;for(let n=0;n<r.length;++n)t=r.charCodeAt(n),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function Zre(r,e,t){if(t-e<1)return"";let i;const s=[];let o=0,a;for(;e<t;)a=r[e++],a<128?s[o++]=a:a>191&&a<224?s[o++]=(a&31)<<6|r[e++]&63:a>239&&a<365?(a=((a&7)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,s[o++]=55296+(a>>10),s[o++]=56320+(a&1023)):s[o++]=(a&15)<<12|(r[e++]&63)<<6|r[e++]&63,o>8191&&((i??(i=[])).push(String.fromCharCode.apply(String,s)),o=0);return i!=null?(o>0&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))}function kD(r,e,t){const n=t;let i,s;for(let o=0;o<r.length;++o)i=r.charCodeAt(o),i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&((s=r.charCodeAt(o+1))&64512)===56320?(i=65536+((i&1023)<<10)+(s&1023),++o,e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128);return t-n}function ts(r,e){return RangeError(`index out of range: ${r.pos} + ${e??1} > ${r.len}`)}function oy(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}class ene{constructor(e){u(this,"buf");u(this,"pos");u(this,"len");u(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,ts(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw ts(this,4);return oy(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw ts(this,4);return oy(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw ts(this,4);const e=Wre(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw ts(this,4);const e=Qre(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw ts(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){const e=this.bytes();return Zre(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw ts(this,e);this.pos+=e}else do if(this.pos>=this.len)throw ts(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new zr(0,0);let t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw ts(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw ts(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw ts(this,8);const e=oy(this.buf,this.pos+=4),t=oy(this.buf,this.pos+=4);return new zr(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=CD(this.buf,this.pos);return this.pos+=yt(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function tne(r){return new ene(r instanceof Uint8Array?r:r.subarray())}function Pe(r,e,t){const n=tne(r);return e.decode(n,void 0,t)}function rne(r){let n,i=8192;return function(o){if(o<1||o>4096)return In(o);i+o>8192&&(n=In(8192),i=0);const a=n.subarray(i,i+=o);return i&7&&(i=(i|7)+1),a}}class k1{constructor(e,t,n){u(this,"fn");u(this,"len");u(this,"next");u(this,"val");this.fn=e,this.len=t,this.next=void 0,this.val=n}}function vv(){}class nne{constructor(e){u(this,"head");u(this,"tail");u(this,"len");u(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const ine=rne();function sne(r){return globalThis.Buffer!=null?In(r):ine(r)}class Ev{constructor(){u(this,"len");u(this,"head");u(this,"tail");u(this,"states");this.len=0,this.head=new k1(vv,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new k1(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new ane((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(ay,10,zr.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=zr.fromBigInt(e);return this._push(ay,t.length(),t)}uint64Number(e){return this._push(AD,yt(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=zr.fromBigInt(e).zzEncode();return this._push(ay,t.length(),t)}sint64Number(e){const t=zr.fromNumber(e).zzEncode();return this._push(ay,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(Sv,1,e?1:0)}fixed32(e){return this._push(_1,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=zr.fromBigInt(e);return this._push(_1,4,t.lo)._push(_1,4,t.hi)}fixed64Number(e){const t=zr.fromNumber(e);return this._push(_1,4,t.lo)._push(_1,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(qre,4,e)}double(e){return this._push(Gre,8,e)}bytes(e){const t=e.length>>>0;return t===0?this._push(Sv,1,0):this.uint32(t)._push(cne,t,e)}string(e){const t=Xre(e);return t!==0?this.uint32(t)._push(kD,t,e):this._push(Sv,1,0)}fork(){return this.states=new nne(this),this.head=this.tail=new k1(vv,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new k1(vv,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next;const t=sne(this.len);let n=0;for(;e!=null;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}}function Sv(r,e,t){e[t]=r&255}function one(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}class ane extends k1{constructor(t,n){super(one,t,n);u(this,"next");this.next=void 0}}function ay(r,e,t){for(;r.hi!==0;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}function _1(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function cne(r,e,t){e.set(r,t)}globalThis.Buffer!=null&&(Ev.prototype.bytes=function(r){const e=r.length>>>0;return this.uint32(e),e>0&&this._push(lne,e,r),this},Ev.prototype.string=function(r){const e=globalThis.Buffer.byteLength(r);return this.uint32(e),e>0&&this._push(une,e,r),this});function lne(r,e,t){e.set(r,t)}function une(r,e,t){r.length<40?kD(r,e,t):e.utf8Write!=null?e.utf8Write(r,t):e.set(oe(r),t)}function dne(){return new Ev}function De(r,e){const t=dne();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var cy;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(cy||(cy={}));function _D(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function kn(r){function e(i){if(r[i.toString()]==null)throw new Error("Invalid enum value");return r[i]}const t=function(s,o){const a=e(s);o.int32(a)},n=function(s){const o=s.int32();return e(o)};return _D("enum",cy.VARINT,t,n)}function $e(r,e){return _D("message",cy.LENGTH_DELIMITED,r,e)}class mt extends Error{constructor(){super(...arguments);u(this,"code","ERR_MAX_LENGTH");u(this,"name","MaxLengthError")}}class TD extends Error{constructor(){super(...arguments);u(this,"code","ERR_MAX_SIZE");u(this,"name","MaxSizeError")}}var Ot;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.ECDSA="ECDSA"})(Ot||(Ot={}));var xv;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1",r[r.ECDSA=3]="ECDSA"})(xv||(xv={})),function(r){r.codec=()=>kn(xv)}(Ot||(Ot={}));var ic;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Ot.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=Ot.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(ic||(ic={}));var ly;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Ot.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=Ot.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(ly||(ly={}));const Md=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function hne(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Od(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function T1(r,...e){if(!hne(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function uy(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Od(r.outputLen),Od(r.blockLen)}function dy(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function fne(r,e){T1(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Rs(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function P1(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function Ls(r,e){return r<<32-e|r>>>e}function Av(r,e){return r<<e|r>>>32-e>>>0}const pne=async()=>{};async function gne(r,e,t){let n=Date.now();for(let i=0;i<r;i++){t(i);const s=Date.now()-n;s>=0&&s<e||(await pne(),n+=s)}}function PD(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function D1(r){return typeof r=="string"&&(r=PD(r)),T1(r),r}function DD(r){return typeof r=="string"&&(r=PD(r)),T1(r),r}function yne(r,e){if(e!==void 0&&{}.toString.call(e)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(r,e)}class $D{}function Cv(r){const e=n=>r().update(D1(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function mne(r=32){if(Md&&typeof Md.getRandomValues=="function")return Md.getRandomValues(new Uint8Array(r));if(Md&&typeof Md.randomBytes=="function")return Uint8Array.from(Md.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function sc(r){if(isNaN(r)||r<=0)throw new Z("random bytes length must be a Number bigger than 0");return mne(r)}class ND extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}}class MD extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class wne extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}const Bs={get(r=globalThis){const e=r.crypto;if((e==null?void 0:e.subtle)==null)throw new wne("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}};function bne(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function OD(r,e,t){return r&e^~r&t}function RD(r,e,t){return r&e^r&t^e&t}class Iv extends $D{constructor(e,t,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=P1(this.buffer)}update(e){dy(this),e=D1(e),T1(e);const{view:t,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=P1(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){dy(this),fne(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,Rs(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)t[h]=0;bne(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=P1(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,d[h],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const oc=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Vr=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),hy=BigInt(2**32-1),LD=BigInt(32);function vne(r,e=!1){return e?{h:Number(r&hy),l:Number(r>>LD&hy)}:{h:Number(r>>LD&hy)|0,l:Number(r&hy)|0}}function Ene(r,e=!1){const t=r.length;let n=new Uint32Array(t),i=new Uint32Array(t);for(let s=0;s<t;s++){const{h:o,l:a}=vne(r[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const BD=(r,e,t)=>r>>>t,UD=(r,e,t)=>r<<32-t|e>>>t,Rd=(r,e,t)=>r>>>t|e<<32-t,Ld=(r,e,t)=>r<<32-t|e>>>t,fy=(r,e,t)=>r<<64-t|e>>>t-32,py=(r,e,t)=>r>>>t-32|e<<64-t;function Po(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}const Sne=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),xne=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,Ane=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),Cne=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,Ine=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0),kne=(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0,_ne=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ac=new Uint32Array(64);class Tne extends Iv{constructor(e=32){super(64,e,8,!1),this.A=oc[0]|0,this.B=oc[1]|0,this.C=oc[2]|0,this.D=oc[3]|0,this.E=oc[4]|0,this.F=oc[5]|0,this.G=oc[6]|0,this.H=oc[7]|0}get(){const{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)ac[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const p=ac[h-15],b=ac[h-2],f=Ls(p,7)^Ls(p,18)^p>>>3,g=Ls(b,17)^Ls(b,19)^b>>>10;ac[h]=g+ac[h-7]+f+ac[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:l,H:d}=this;for(let h=0;h<64;h++){const p=Ls(a,6)^Ls(a,11)^Ls(a,25),b=d+p+OD(a,c,l)+_ne[h]+ac[h]|0,g=(Ls(n,2)^Ls(n,13)^Ls(n,22))+RD(n,i,s)|0;d=l,l=c,c=a,a=o+b|0,o=s,s=i,i=n,n=b+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(n,i,s,o,a,c,l,d)}roundClean(){Rs(ac)}destroy(){this.set(0,0,0,0,0,0,0,0),Rs(this.buffer)}}const FD=Ene(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Pne=FD[0],Dne=FD[1],cc=new Uint32Array(80),lc=new Uint32Array(80);class $ne extends Iv{constructor(e=64){super(128,e,16,!1),this.Ah=Vr[0]|0,this.Al=Vr[1]|0,this.Bh=Vr[2]|0,this.Bl=Vr[3]|0,this.Ch=Vr[4]|0,this.Cl=Vr[5]|0,this.Dh=Vr[6]|0,this.Dl=Vr[7]|0,this.Eh=Vr[8]|0,this.El=Vr[9]|0,this.Fh=Vr[10]|0,this.Fl=Vr[11]|0,this.Gh=Vr[12]|0,this.Gl=Vr[13]|0,this.Hh=Vr[14]|0,this.Hl=Vr[15]|0}get(){const{Ah:e,Al:t,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:d,Fh:h,Fl:p,Gh:b,Gl:f,Hh:g,Hl:v}=this;return[e,t,n,i,s,o,a,c,l,d,h,p,b,f,g,v]}set(e,t,n,i,s,o,a,c,l,d,h,p,b,f,g,v){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=d|0,this.Fh=h|0,this.Fl=p|0,this.Gh=b|0,this.Gl=f|0,this.Hh=g|0,this.Hl=v|0}process(e,t){for(let m=0;m<16;m++,t+=4)cc[m]=e.getUint32(t),lc[m]=e.getUint32(t+=4);for(let m=16;m<80;m++){const E=cc[m-15]|0,A=lc[m-15]|0,k=Rd(E,A,1)^Rd(E,A,8)^BD(E,A,7),x=Ld(E,A,1)^Ld(E,A,8)^UD(E,A,7),I=cc[m-2]|0,T=lc[m-2]|0,L=Rd(I,T,19)^fy(I,T,61)^BD(I,T,6),z=Ld(I,T,19)^py(I,T,61)^UD(I,T,6),B=Ane(x,z,lc[m-7],lc[m-16]),G=Cne(B,k,L,cc[m-7],cc[m-16]);cc[m]=G|0,lc[m]=B|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:d,Eh:h,El:p,Fh:b,Fl:f,Gh:g,Gl:v,Hh:y,Hl:w}=this;for(let m=0;m<80;m++){const E=Rd(h,p,14)^Rd(h,p,18)^fy(h,p,41),A=Ld(h,p,14)^Ld(h,p,18)^py(h,p,41),k=h&b^~h&g,x=p&f^~p&v,I=Ine(w,A,x,Dne[m],lc[m]),T=kne(I,y,E,k,Pne[m],cc[m]),L=I|0,z=Rd(n,i,28)^fy(n,i,34)^fy(n,i,39),B=Ld(n,i,28)^py(n,i,34)^py(n,i,39),G=n&s^n&a^s&a,j=i&o^i&c^o&c;y=g|0,w=v|0,g=b|0,v=f|0,b=h|0,f=p|0,{h,l:p}=Po(l|0,d|0,T|0,L|0),l=a|0,d=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const q=Sne(L,B,j);n=xne(q,T,z,G),i=q|0}({h:n,l:i}=Po(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=Po(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Po(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:d}=Po(this.Dh|0,this.Dl|0,l|0,d|0),{h,l:p}=Po(this.Eh|0,this.El|0,h|0,p|0),{h:b,l:f}=Po(this.Fh|0,this.Fl|0,b|0,f|0),{h:g,l:v}=Po(this.Gh|0,this.Gl|0,g|0,v|0),{h:y,l:w}=Po(this.Hh|0,this.Hl|0,y|0,w|0),this.set(n,i,s,o,a,c,l,d,h,p,b,f,g,v,y,w)}roundClean(){Rs(cc,lc)}destroy(){Rs(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Nne=Cv(()=>new Tne),Mne=Cv(()=>new $ne),Bl=Nne;let kv=class{constructor(e,t){u(this,"type","RSA");u(this,"jwk");u(this,"_raw");u(this,"_multihash");this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=Tv(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return H2.createV1(114,this._multihash)}toString(){return ki.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}verify(e,t){return Gne(this.jwk,t,e)}},zD=class{constructor(e,t){u(this,"type","RSA");u(this,"jwk");u(this,"_raw");u(this,"publicKey");this.jwk=e,this.publicKey=t}get raw(){return this._raw==null&&(this._raw=Bne(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}sign(e){return Wne(this.jwk,e)}};const VD=8192,_v=18,One=1062,Rne=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function Lne(r){return{n:re(r[1],"base64url"),e:re(r[2],"base64url"),d:re(r[3],"base64url"),p:re(r[4],"base64url"),q:re(r[5],"base64url"),dp:re(r[6],"base64url"),dq:re(r[7],"base64url"),qi:re(r[8],"base64url"),kty:"RSA"}}function Bne(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new Z("JWK was missing components");return ko([Zn(Uint8Array.from([0])),Zn(oe(r.n,"base64url")),Zn(oe(r.e,"base64url")),Zn(oe(r.d,"base64url")),Zn(oe(r.p,"base64url")),Zn(oe(r.q,"base64url")),Zn(oe(r.dp,"base64url")),Zn(oe(r.dq,"base64url")),Zn(oe(r.qi,"base64url"))]).subarray()}function Une(r){const e=Ya(r[1],{offset:0});return{kty:"RSA",n:re(e[0],"base64url"),e:re(e[1],"base64url")}}function Tv(r){if(r.n==null||r.e==null)throw new Z("JWK was missing components");return ko([Rne,Hb(ko([Zn(oe(r.n,"base64url")),Zn(oe(r.e,"base64url"))]))]).subarray()}function Fne(r){const e=Ya(r);return KD(e)}function KD(r){const e=Lne(r);return Vne(e)}function zne(r,e){if(r.byteLength>=One)throw new p1("Key size is too large");const t=Ya(r,{offset:0});return jD(t,r,e)}function jD(r,e,t){const n=Une(r);if(t==null){const i=Bl(ic.encode({Type:Ot.RSA,Data:e}));t=Nl(_v,i)}return new kv(n,t)}function Vne(r){if(Jne(r)>VD)throw new Z("Key size is too large");const e=jne(r),t=Bl(ic.encode({Type:Ot.RSA,Data:Tv(e.publicKey)})),n=Nl(_v,t);return new zD(e.privateKey,new kv(e.publicKey,n))}async function Kne(r){if(r>VD)throw new Z("Key size is too large");const e=await qne(r),t=Bl(ic.encode({Type:Ot.RSA,Data:Tv(e.publicKey)})),n=Nl(_v,t);return new zD(e.privateKey,new kv(e.publicKey,n))}function jne(r){if(r==null)throw new Z("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}const Hne="1.2.840.113549.1.1.1";async function qne(r){const e=await Bs.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await Qne(e);return{privateKey:t[0],publicKey:t[1]}}async function Wne(r,e){const t=await Bs.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Bs.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(n,0,n.byteLength)}async function Gne(r,e,t){const n=await Bs.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Bs.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,t instanceof Uint8Array?t:t.subarray())}async function Qne(r){if(r.privateKey==null||r.publicKey==null)throw new Z("Private and public key are required");return Promise.all([Bs.get().subtle.exportKey("jwk",r.privateKey),Bs.get().subtle.exportKey("jwk",r.publicKey)])}function Jne(r){if(r.kty!=="RSA")throw new Z("invalid key type");if(r.n==null)throw new Z("invalid key modulus");return oe(r.n,"base64url").length*8}let HD=class extends JP{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Mte(e);const n=Wb(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return Y2(this),this.iHash.update(e),this}digestInto(e){Y2(this),J2(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const qD=(r,e,t)=>new HD(r,e).update(t).digest();qD.create=(r,e)=>new HD(r,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function WD(r){r.lowS!==void 0&&rc("lowS",r.lowS),r.prehash!==void 0&&rc("prehash",r.prehash)}function Yne(r){const e=lv(r);$d(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:n,a:i}=e;if(t){if(!n.eql(i,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}class Xne extends Error{constructor(e=""){super(e)}}const Do={Err:Xne,_tlv:{encode:(r,e)=>{const{Err:t}=Do;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const n=e.length/2,i=Z2(n);if(i.length/2&128)throw new t("tlv.encode: long form length too big");const s=n>127?Z2(i.length/2|128):"";return Z2(r)+s+i+e},decode(r,e){const{Err:t}=Do;let n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const d of l)o=o<<8|d;if(n+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(r){const{Err:e}=Do;if(r<$o)throw new e("integer: negative integers are not allowed");let t=Z2(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=Do;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Ml(r)}},toSig(r){const{Err:e,_int:t,_tlv:n}=Do,i=qt("signature",r),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:l,l:d}=n.decode(2,c);if(d.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(r){const{_tlv:e,_int:t}=Do,n=e.encode(2,t.encode(r.r)),i=e.encode(2,t.encode(r.s)),s=n+i;return e.encode(48,s)}},$o=BigInt(0),fr=BigInt(1);BigInt(2);const GD=BigInt(3);BigInt(4);function Zne(r){const e=Yne(r),{Fp:t}=e,n=ny(e.n,e.nBitLength),i=e.toBytes||((g,v,y)=>{const w=v.toAffine();return Dd(Uint8Array.from([4]),t.toBytes(w.x),t.toBytes(w.y))}),s=e.fromBytes||(g=>{const v=g.subarray(1),y=t.fromBytes(v.subarray(0,t.BYTES)),w=t.fromBytes(v.subarray(t.BYTES,2*t.BYTES));return{x:y,y:w}});function o(g){const{a:v,b:y}=e,w=t.sqr(g),m=t.mul(w,g);return t.add(t.add(m,t.mul(g,v)),y)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(g){return ev(g,fr,e.n)}function c(g){const{allowedPrivateKeyLengths:v,nByteLength:y,wrapPrivateKey:w,n:m}=e;if(v&&typeof g!="bigint"){if(Td(g)&&(g=Pd(g)),typeof g!="string"||!v.includes(g.length))throw new Error("invalid private key");g=g.padStart(y*2,"0")}let E;try{E=typeof g=="bigint"?g:Ml(qt("private key",g,y))}catch{throw new Error("invalid private key, expected hex or "+y+" bytes, got "+typeof g)}return w&&(E=xt(E,m)),ei("private key",E,fr,m),E}function l(g){if(!(g instanceof p))throw new Error("ProjectivePoint expected")}const d=ry((g,v)=>{const{px:y,py:w,pz:m}=g;if(t.eql(m,t.ONE))return{x:y,y:w};const E=g.is0();v==null&&(v=E?t.ONE:t.inv(m));const A=t.mul(y,v),k=t.mul(w,v),x=t.mul(m,v);if(E)return{x:t.ZERO,y:t.ZERO};if(!t.eql(x,t.ONE))throw new Error("invZ was invalid");return{x:A,y:k}}),h=ry(g=>{if(g.is0()){if(e.allowInfinityPoint&&!t.is0(g.py))return;throw new Error("bad point: ZERO")}const{x:v,y}=g.toAffine();if(!t.isValid(v)||!t.isValid(y))throw new Error("bad point: x or y not FE");const w=t.sqr(y),m=o(v);if(!t.eql(w,m))throw new Error("bad point: equation left != right");if(!g.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class p{constructor(v,y,w){if(v==null||!t.isValid(v))throw new Error("x required");if(y==null||!t.isValid(y))throw new Error("y required");if(w==null||!t.isValid(w))throw new Error("z required");this.px=v,this.py=y,this.pz=w,Object.freeze(this)}static fromAffine(v){const{x:y,y:w}=v||{};if(!v||!t.isValid(y)||!t.isValid(w))throw new Error("invalid affine point");if(v instanceof p)throw new Error("projective point not allowed");const m=E=>t.eql(E,t.ZERO);return m(y)&&m(w)?p.ZERO:new p(y,w,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(v){const y=t.invertBatch(v.map(w=>w.pz));return v.map((w,m)=>w.toAffine(y[m])).map(p.fromAffine)}static fromHex(v){const y=p.fromAffine(s(qt("pointHex",v)));return y.assertValidity(),y}static fromPrivateKey(v){return p.BASE.multiply(c(v))}static msm(v,y){return gD(p,n,v,y)}_setWindowSize(v){f.setWindowSize(this,v)}assertValidity(){h(this)}hasEvenY(){const{y:v}=this.toAffine();if(t.isOdd)return!t.isOdd(v);throw new Error("Field doesn't support isOdd")}equals(v){l(v);const{px:y,py:w,pz:m}=this,{px:E,py:A,pz:k}=v,x=t.eql(t.mul(y,k),t.mul(E,m)),I=t.eql(t.mul(w,k),t.mul(A,m));return x&&I}negate(){return new p(this.px,t.neg(this.py),this.pz)}double(){const{a:v,b:y}=e,w=t.mul(y,GD),{px:m,py:E,pz:A}=this;let k=t.ZERO,x=t.ZERO,I=t.ZERO,T=t.mul(m,m),L=t.mul(E,E),z=t.mul(A,A),B=t.mul(m,E);return B=t.add(B,B),I=t.mul(m,A),I=t.add(I,I),k=t.mul(v,I),x=t.mul(w,z),x=t.add(k,x),k=t.sub(L,x),x=t.add(L,x),x=t.mul(k,x),k=t.mul(B,k),I=t.mul(w,I),z=t.mul(v,z),B=t.sub(T,z),B=t.mul(v,B),B=t.add(B,I),I=t.add(T,T),T=t.add(I,T),T=t.add(T,z),T=t.mul(T,B),x=t.add(x,T),z=t.mul(E,A),z=t.add(z,z),T=t.mul(z,B),k=t.sub(k,T),I=t.mul(z,L),I=t.add(I,I),I=t.add(I,I),new p(k,x,I)}add(v){l(v);const{px:y,py:w,pz:m}=this,{px:E,py:A,pz:k}=v;let x=t.ZERO,I=t.ZERO,T=t.ZERO;const L=e.a,z=t.mul(e.b,GD);let B=t.mul(y,E),G=t.mul(w,A),j=t.mul(m,k),q=t.add(y,w),Q=t.add(E,A);q=t.mul(q,Q),Q=t.add(B,G),q=t.sub(q,Q),Q=t.add(y,m);let K=t.add(E,k);return Q=t.mul(Q,K),K=t.add(B,j),Q=t.sub(Q,K),K=t.add(w,m),x=t.add(A,k),K=t.mul(K,x),x=t.add(G,j),K=t.sub(K,x),T=t.mul(L,Q),x=t.mul(z,j),T=t.add(x,T),x=t.sub(G,T),T=t.add(G,T),I=t.mul(x,T),G=t.add(B,B),G=t.add(G,B),j=t.mul(L,j),Q=t.mul(z,Q),G=t.add(G,j),j=t.sub(B,j),j=t.mul(L,j),Q=t.add(Q,j),B=t.mul(G,Q),I=t.add(I,B),B=t.mul(K,Q),x=t.mul(q,x),x=t.sub(x,B),B=t.mul(q,G),T=t.mul(K,T),T=t.add(T,B),new p(x,I,T)}subtract(v){return this.add(v.negate())}is0(){return this.equals(p.ZERO)}wNAF(v){return f.wNAFCached(this,v,p.normalizeZ)}multiplyUnsafe(v){const{endo:y,n:w}=e;ei("scalar",v,$o,w);const m=p.ZERO;if(v===$o)return m;if(this.is0()||v===fr)return this;if(!y||f.hasPrecomputes(this))return f.wNAFCachedUnsafe(this,v,p.normalizeZ);let{k1neg:E,k1:A,k2neg:k,k2:x}=y.splitScalar(v),I=m,T=m,L=this;for(;A>$o||x>$o;)A&fr&&(I=I.add(L)),x&fr&&(T=T.add(L)),L=L.double(),A>>=fr,x>>=fr;return E&&(I=I.negate()),k&&(T=T.negate()),T=new p(t.mul(T.px,y.beta),T.py,T.pz),I.add(T)}multiply(v){const{endo:y,n:w}=e;ei("scalar",v,fr,w);let m,E;if(y){const{k1neg:A,k1:k,k2neg:x,k2:I}=y.splitScalar(v);let{p:T,f:L}=this.wNAF(k),{p:z,f:B}=this.wNAF(I);T=f.constTimeNegate(A,T),z=f.constTimeNegate(x,z),z=new p(t.mul(z.px,y.beta),z.py,z.pz),m=T.add(z),E=L.add(B)}else{const{p:A,f:k}=this.wNAF(v);m=A,E=k}return p.normalizeZ([m,E])[0]}multiplyAndAddUnsafe(v,y,w){const m=p.BASE,E=(k,x)=>x===$o||x===fr||!k.equals(m)?k.multiplyUnsafe(x):k.multiply(x),A=E(this,y).add(E(v,w));return A.is0()?void 0:A}toAffine(v){return d(this,v)}isTorsionFree(){const{h:v,isTorsionFree:y}=e;if(v===fr)return!0;if(y)return y(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:v,clearCofactor:y}=e;return v===fr?this:y?y(p,this):this.multiplyUnsafe(e.h)}toRawBytes(v=!0){return rc("isCompressed",v),this.assertValidity(),i(p,this,v)}toHex(v=!0){return rc("isCompressed",v),Pd(this.toRawBytes(v))}}p.BASE=new p(e.Gx,e.Gy,t.ONE),p.ZERO=new p(t.ZERO,t.ONE,t.ZERO);const b=e.nBitLength,f=pD(p,e.endo?Math.ceil(b/2):b);return{CURVE:e,ProjectivePoint:p,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function eie(r){const e=lv(r);return $d(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function tie(r){const e=eie(r),{Fp:t,n}=e,i=t.BYTES+1,s=2*t.BYTES+1;function o(j){return xt(j,n)}function a(j){return nv(j,n)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:d,isWithinCurveOrder:h}=Zne({...e,toBytes(j,q,Q){const K=q.toAffine(),O=t.toBytes(K.x),U=Dd;return rc("isCompressed",Q),Q?U(Uint8Array.from([q.hasEvenY()?2:3]),O):U(Uint8Array.from([4]),O,t.toBytes(K.y))},fromBytes(j){const q=j.length,Q=j[0],K=j.subarray(1);if(q===i&&(Q===2||Q===3)){const O=Ml(K);if(!ev(O,fr,t.ORDER))throw new Error("Point is not on curve");const U=d(O);let W;try{W=t.sqrt(U)}catch(se){const we=se instanceof Error?": "+se.message:"";throw new Error("Point is not on curve"+we)}const J=(W&fr)===fr;return(Q&1)===1!==J&&(W=t.neg(W)),{x:O,y:W}}else if(q===s&&Q===4){const O=t.fromBytes(K.subarray(0,t.BYTES)),U=t.fromBytes(K.subarray(t.BYTES,2*t.BYTES));return{x:O,y:U}}else{const O=i,U=s;throw new Error("invalid Point, expected length of "+O+", or uncompressed "+U+", got "+q)}}}),p=j=>Pd(S1(j,e.nByteLength));function b(j){const q=n>>fr;return j>q}function f(j){return b(j)?o(-j):j}const g=(j,q,Q)=>Ml(j.slice(q,Q));class v{constructor(q,Q,K){ei("r",q,fr,n),ei("s",Q,fr,n),this.r=q,this.s=Q,K!=null&&(this.recovery=K),Object.freeze(this)}static fromCompact(q){const Q=e.nByteLength;return q=qt("compactSignature",q,Q*2),new v(g(q,0,Q),g(q,Q,2*Q))}static fromDER(q){const{r:Q,s:K}=Do.toSig(qt("DER",q));return new v(Q,K)}assertValidity(){}addRecoveryBit(q){return new v(this.r,this.s,q)}recoverPublicKey(q){const{r:Q,s:K,recovery:O}=this,U=k(qt("msgHash",q));if(O==null||![0,1,2,3].includes(O))throw new Error("recovery id invalid");const W=O===2||O===3?Q+e.n:Q;if(W>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const J=O&1?"03":"02",H=c.fromHex(J+p(W)),se=a(W),we=o(-U*se),ce=o(K*se),de=c.BASE.multiplyAndAddUnsafe(H,we,ce);if(!de)throw new Error("point at infinify");return de.assertValidity(),de}hasHighS(){return b(this.s)}normalizeS(){return this.hasHighS()?new v(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return ey(this.toDERHex())}toDERHex(){return Do.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return ey(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}}const y={isValidPrivateKey(j){try{return l(j),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const j=lD(e.n);return Ere(e.randomBytes(j),e.n)},precompute(j=8,q=c.BASE){return q._setWindowSize(j),q.multiply(BigInt(3)),q}};function w(j,q=!0){return c.fromPrivateKey(j).toRawBytes(q)}function m(j){const q=Td(j),Q=typeof j=="string",K=(q||Q)&&j.length;return q?K===i||K===s:Q?K===2*i||K===2*s:j instanceof c}function E(j,q,Q=!0){if(m(j))throw new Error("first arg must be private key");if(!m(q))throw new Error("second arg must be public key");return c.fromHex(q).multiply(l(j)).toRawBytes(Q)}const A=e.bits2int||function(j){if(j.length>8192)throw new Error("input is too large");const q=Ml(j),Q=j.length*8-e.nBitLength;return Q>0?q>>BigInt(Q):q},k=e.bits2int_modN||function(j){return o(A(j))},x=ty(e.nBitLength);function I(j){return ei("num < 2^"+e.nBitLength,j,$o,x),S1(j,e.nByteLength)}function T(j,q,Q=L){if(["recovered","canonical"].some(Me=>Me in Q))throw new Error("sign() legacy options not supported");const{hash:K,randomBytes:O}=e;let{lowS:U,prehash:W,extraEntropy:J}=Q;U==null&&(U=!0),j=qt("msgHash",j),WD(Q),W&&(j=qt("prehashed msgHash",K(j)));const H=k(j),se=l(q),we=[I(se),I(H)];if(J!=null&&J!==!1){const Me=J===!0?O(t.BYTES):J;we.push(qt("extraEntropy",Me))}const ce=Dd(...we),de=H;function Ne(Me){const Ze=A(Me);if(!h(Ze))return;const lt=a(Ze),vt=c.BASE.multiply(Ze).toAffine(),kt=o(vt.x);if(kt===$o)return;const $t=o(lt*o(de+kt*se));if($t===$o)return;let nr=(vt.x===kt?0:2)|Number(vt.y&fr),Nr=$t;return U&&b($t)&&(Nr=f($t),nr^=1),new v(kt,Nr,nr)}return{seed:ce,k2sig:Ne}}const L={lowS:e.lowS,prehash:!1},z={lowS:e.lowS,prehash:!1};function B(j,q,Q=L){const{seed:K,k2sig:O}=T(j,q,Q),U=e;return dre(U.hash.outputLen,U.nByteLength,U.hmac)(K,O)}c.BASE._setWindowSize(8);function G(j,q,Q,K=z){var nr;const O=j;q=qt("msgHash",q),Q=qt("publicKey",Q);const{lowS:U,prehash:W,format:J}=K;if(WD(K),"strict"in K)throw new Error("options.strict was renamed to lowS");if(J!==void 0&&J!=="compact"&&J!=="der")throw new Error("format must be compact or der");const H=typeof O=="string"||Td(O),se=!H&&!J&&typeof O=="object"&&O!==null&&typeof O.r=="bigint"&&typeof O.s=="bigint";if(!H&&!se)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let we,ce;try{if(se&&(we=new v(O.r,O.s)),H){try{J!=="compact"&&(we=v.fromDER(O))}catch(Nr){if(!(Nr instanceof Do.Err))throw Nr}!we&&J!=="der"&&(we=v.fromCompact(O))}ce=c.fromHex(Q)}catch{return!1}if(!we||U&&we.hasHighS())return!1;W&&(q=e.hash(q));const{r:de,s:Ne}=we,Me=k(q),Ze=a(Ne),lt=o(Me*Ze),vt=o(de*Ze),kt=(nr=c.BASE.multiplyAndAddUnsafe(ce,lt,vt))==null?void 0:nr.toAffine();return kt?o(kt.x)===de:!1}return{CURVE:e,getPublicKey:w,getSharedSecret:E,sign:B,verify:G,ProjectivePoint:c,Signature:v,utils:y}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function rie(r){return{hash:r,hmac:(e,...t)=>qD(r,e,Lte(...t)),randomBytes:Gb}}function nie(r,e){const t=n=>tie({...r,...rie(n)});return{...t(e),create:t}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const QD=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),JD=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),iie=BigInt(1),Pv=BigInt(2),YD=(r,e)=>(r+e/Pv)/e;function sie(r){const e=QD,t=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=r*r*r%e,d=l*l*r%e,h=zt(d,t,e)*d%e,p=zt(h,t,e)*d%e,b=zt(p,Pv,e)*l%e,f=zt(b,i,e)*b%e,g=zt(f,s,e)*f%e,v=zt(g,a,e)*g%e,y=zt(v,c,e)*v%e,w=zt(y,a,e)*g%e,m=zt(w,t,e)*d%e,E=zt(m,o,e)*f%e,A=zt(E,n,e)*l%e,k=zt(A,Pv,e);if(!Dv.eql(Dv.sqr(k),r))throw new Error("Cannot find square root");return k}const Dv=ny(QD,void 0,void 0,{sqrt:sie}),Us=nie({a:BigInt(0),b:BigInt(7),Fp:Dv,n:JD,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const e=JD,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-iie*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=t,o=BigInt("0x100000000000000000000000000000000"),a=YD(s*r,e),c=YD(-n*r,e);let l=xt(r-a*t-c*i,e),d=xt(-a*n-c*s,e);const h=l>o,p=d>o;if(h&&(l=e-l),p&&(d=e-d),l>o||d>o)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:h,k1:l,k2neg:p,k2:d}}}},Kte);BigInt(0),Us.ProjectivePoint;function oie({name:r,code:e,encode:t}){return new aie(r,e,t)}let aie=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Nl(this.code,t):t.then(n=>Nl(this.code,n))}else throw Error("Unknown type, must be binary type")}};function cie(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const XD=oie({name:"sha2-256",code:18,encode:cie("SHA-256")});function ZD(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}const lie=33,uie=32;function die(r,e){const t=XD.digest(e instanceof Uint8Array?e:e.subarray());if(ZD(t))return t.then(({digest:n})=>Us.sign(n,r).toDERRawBytes()).catch(n=>{throw new ND(String(n))});try{return Us.sign(t.digest,r).toDERRawBytes()}catch(n){throw new ND(String(n))}}function hie(r,e,t){const n=XD.digest(t instanceof Uint8Array?t:t.subarray());if(ZD(n))return n.then(({digest:i})=>Us.verify(e,i,r)).catch(i=>{throw new MD(String(i))});try{return Us.verify(e,n.digest,r)}catch(i){throw new MD(String(i))}}class e${constructor(e){u(this,"type","secp256k1");u(this,"raw");u(this,"_key");this._key=yie(e),this.raw=pie(this._key)}toMultihash(){return Vb.digest(_i(this))}toCID(){return H2.createV1(114,this.toMultihash())}toString(){return ki.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}verify(e,t){return hie(this._key,t,e)}}class t${constructor(e,t){u(this,"type","secp256k1");u(this,"raw");u(this,"publicKey");this.raw=gie(e),this.publicKey=new e$(t??mie(e))}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}sign(e){return die(this.raw,e)}}function r$(r){return new t$(r)}function $v(r){return new e$(r)}async function fie(){const r=wie();return new t$(r)}function pie(r){return Us.ProjectivePoint.fromHex(r).toRawBytes(!0)}function gie(r){try{return Us.getPublicKey(r,!0),r}catch(e){throw new Db(String(e))}}function yie(r){try{return Us.ProjectivePoint.fromHex(r),r}catch(e){throw new p1(String(e))}}function mie(r){try{return Us.getPublicKey(r,!0)}catch(e){throw new Db(String(e))}}function wie(){return Us.utils.randomPrivateKey()}async function gy(r,e){if(r==="Ed25519")return Fre();if(r==="secp256k1")return fie();if(r==="RSA")return Kne(Eie(e));if(r==="ECDSA")return $te(Sie(e));throw new $l}function _n(r,e){const{Type:t,Data:n}=ic.decode(r),i=n??new Uint8Array;switch(t){case Ot.RSA:return zne(i,e);case Ot.Ed25519:return fv(i);case Ot.secp256k1:return $v(i);case Ot.ECDSA:return qP(i);default:throw new $l}}function bie(r){var n,i;if(r.byteLength===C1)return fv(r);if(r.byteLength===lie)return $v(r);const e=Ya(r),t=(n=e[1])==null?void 0:n[0];if(t===UP||t===FP||t===zP)return WP(e);if(((i=e[0])==null?void 0:i[0])===Hne)return jD(e,r);throw new Z("Could not extract public key from raw bytes")}function n$(r){const{Type:e,Data:t}=ic.decode(r.digest),n=t??new Uint8Array;switch(e){case Ot.Ed25519:return fv(n);case Ot.secp256k1:return $v(n);case Ot.ECDSA:return qP(n);default:throw new $l}}function _i(r){return ic.encode({Type:Ot[r.type],Data:r.raw})}function vie(r){const e=ly.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case Ot.RSA:return Fne(t);case Ot.Ed25519:return xD(t);case Ot.secp256k1:return r$(t);case Ot.ECDSA:return Tte(t);default:throw new $l}}function Nv(r){var n;if(r.byteLength===To)return xD(r);if(r.byteLength===uie)return r$(r);const e=Ya(r),t=(n=e[2])==null?void 0:n[0];if(t===UP||t===FP||t===zP)return HP(e);if(e.length>8)return KD(e);throw new Z("Could not extract private key from raw bytes")}function $1(r){return ly.encode({Type:Ot[r.type],Data:r.raw})}function Eie(r){return r==null?2048:parseInt(r,10)}function Sie(r){if(r==="P-256"||r==null)return"P-256";if(r==="P-384")return"P-384";if(r==="P-521")return"P-521";throw new Z("Unsupported curve, should be P-256, P-384 or P-521")}async function i$(r){if(r.type==="RSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if(r.type==="ECDSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"ECDSA",namedCurve:r.jwk.crv??"P-256"},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"ECDSA",namedCurve:r.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new Z("Only RSA and ECDSA keys are supported")}function xie(r,e){for(let t=0;t<r.byteLength;t++){if(r[t]<e[t])return-1;if(r[t]>e[t])return 1}return r.byteLength>e.byteLength?1:r.byteLength<e.byteLength?-1:0}const Aie=async(r,e,t)=>{if(!r)throw new Error("No signature given");if(!e)throw new Error("Given publicKey was undefined");if(!t)throw new Error("Given input data was undefined");t instanceof Uint8Array||(t=typeof t=="string"?oe(t):new Uint8Array(t));const n=(s,o,a)=>s.verify(o,a);let i=!1;try{const s=bie(oe(e,"base16"));i=await n(s,t,oe(r,"base16"))}catch{}return Promise.resolve(i)},Mv=async(r,e)=>{if(!r)throw new Error("No signing key given");if(!e)throw new Error("Given input data was undefined");return e instanceof Uint8Array||(e=typeof e=="string"?oe(e):new Uint8Array(e)),re(await r.sign(e),"base16")},Cie=Ns({size:1e3}),s$=async(r,e,t)=>{const n=await Cie,i=await n.get(r);let s=!1;if(i){const o=(a,c)=>c instanceof Uint8Array?xie(a,c)===0:a.toString()===c.toString();s=i.publicKey===e&&o(i.data,t)}else{const o=await Aie(r,e,t);s=o,o&&await n.put(r,{publicKey:e,data:t})}return s},Iie="./keystore",o$=async({storage:r,path:e}={})=>{r=r||await yl(await Ns({size:1e3}),await Ab({path:e||Iie}));const t=await Ns({size:1e3}),n=async()=>{await r.close(),await t.close()},i=async()=>{await r.clear(),await t.clear()},s=async d=>{if(!d)throw new Error("id needed to check a key");let h=!1,p=await t.get(d);if(p)h=!0;else try{p=await r.get("private_"+d),h=p!=null}catch{console.error("Error: ENOENT: no such file or directory")}return h},o=async(d,h)=>{const{privateKey:p}=h;await r.put("private_"+d,p);const b=Nv(p);await t.put(d,b)};return{clear:i,close:n,hasKey:s,addKey:o,createKey:async d=>{if(!d)throw new Error("id needed to create a key");const h=await gy("secp256k1"),p={publicKey:h.publicKey.raw,privateKey:h.raw};return await o(d,p),h},getKey:async d=>{if(!d)throw new Error("id needed to get a key");let h=await t.get(d);if(!h){let p;try{p=await r.get("private_"+d)}catch{}if(!p)return;h=Nv(p),await t.put(d,h)}return h},getPublic:(d,h={})=>{const p=["hex","buffer"],b=h.format||"hex";if(p.indexOf(b)===-1)throw new Error("Supported formats are `hex` and `buffer`");const f=d.publicKey.raw;return b==="buffer"?f:re(f,"base16")}}},a$=e1,c$=a2,kie=dn,l$=async({id:r,publicKey:e,signatures:t,type:n,sign:i,verify:s}={})=>{if(!r)throw new Error("Identity id is required");if(!e)throw new Error("Invalid public key");if(!t)throw new Error("Signatures object is required");if(!t.id)throw new Error("Signature of id is required");if(!t.publicKey)throw new Error("Signature of publicKey+id is required");if(!n)throw new Error("Identity type is required");t=Object.assign({},t);const o={id:r,publicKey:e,signatures:t,type:n,sign:i,verify:s},{hash:a,bytes:c}=await _ie(o);return o.hash=a,o.bytes=c,o},_ie=async r=>{const{id:e,publicKey:t,signatures:n,type:i}=r,s={id:e,publicKey:t,signatures:n,type:i},{cid:o,bytes:a}=await od({value:s,codec:a$,hasher:c$});return{hash:o.toString(kie),bytes:Uint8Array.from(a)}},Tie=async r=>{const{value:e}=await qg({bytes:r,codec:a$,hasher:c$});return l$({...e})},Pie=r=>!!(r.id&&r.hash&&r.bytes&&r.publicKey&&r.signatures&&r.signatures.id&&r.signatures.publicKey&&r.type),Die=(r,e)=>r.id===e.id&&r.hash===e.hash&&r.type===e.type&&r.publicKey===e.publicKey&&r.signatures.id===e.signatures.id&&r.signatures.publicKey===e.signatures.publicKey,u$="publickey",$ie=async r=>{const{id:e,publicKey:t,signatures:n}=r;return s$(n.publicKey,e,t+n.id)},Ov=({keystore:r})=>async()=>{if(!r)throw new Error("PublicKeyIdentityProvider requires a keystore parameter");return{type:u$,getId:async({id:n}={})=>{if(!n)throw new Error("id is required");const i=await r.getKey(n)||await r.createKey(n);return re(i.publicKey.raw,"base16")},signIdentity:async(n,{id:i}={})=>{if(!i)throw new Error("id is required");const s=await r.getKey(i);if(!s)throw new Error(`Signing key for '${i}' not found`);return Mv(s,n)}}};Ov.verifyIdentity=$ie,Ov.type=u$;const Rv={},Nie=r=>Object.keys(Rv).includes(r),Lv=r=>{if(!Nie(r))throw new Error(`IdentityProvider type '${r}' is not supported`);return Rv[r]};(r=>{if(!r.type||typeof r.type!="string")throw new Error("Given IdentityProvider doesn't have a field 'type'.");if(!r.verifyIdentity)throw new Error("Given IdentityProvider doesn't have a function 'verifyIdentity'.");Rv[r.type]=r})(Ov);const Mie=Ra("./orbitdb","identities"),Oie=async({keystore:r,path:e,storage:t,ipfs:n}={})=>{r=r||await o$({path:e||Mie}),t||(t=n?await yl(await Ns({size:1e3}),await u2({ipfs:n,pin:!0})):await q6());const i=await Ns({size:1e3}),s=async d=>{const h=await t.get(d);if(h)return Tie(h)},o=async(d={})=>{d.keystore=r;const h=Lv("publickey"),b=await(d.provider||h({keystore:r}))();if(!Lv(b.type))throw new Error("Identity provider is unknown. Use useIdentityProvider(provider) to register the identity provider");const f=await b.getId(d),g=await r.getKey(f)||await r.createKey(f),v=r.getPublic(g),y=await Mv(g,f),w=await b.signIdentity(v+y,d),E=await l$({id:f,publicKey:v,signatures:{id:y,publicKey:w},type:b.type,sign:c,verify:l});return await t.put(E.hash,E.bytes),E},a=async d=>{if(!Pie(d))return!1;const{id:h,publicKey:p,signatures:b}=d;if(!await l(b.id,p,h))return!1;const g=await i.get(b.id);if(g)return Die(d,g);const y=await Lv(d.type).verifyIdentity(d);return y&&await i.put(b.id,d),y},c=async(d,h)=>{const p=await r.getKey(d.id);if(!p)throw new Error("Private signing key not found from KeyStore");return await Mv(p,h)},l=async(d,h,p)=>await s$(d,h,p);return{createIdentity:o,verifyIdentity:a,getIdentity:s,sign:c,verify:l,keystore:r}},Rie=r=>{if(r=r.toString(),!r.startsWith("/orbitdb")&&!r.startsWith("\\orbitdb"))return!1;r=r.replaceAll("/orbitdb/",""),r=r.replaceAll("\\orbitdb\\",""),r=r.replaceAll("/",""),r=r.replaceAll("\\","");let e;try{e=Yi.parse(r,dn)}catch{return!1}return e!==void 0},d$=r=>{if(r&&r.protocol==="orbitdb"&&r.hash)return r;const e="orbitdb",t=r.replace("/orbitdb/","").replace("\\orbitdb\\","");return{protocol:e,hash:t,address:r,toString:()=>Ra("/",e,t)}},h$=e1,f$=a2,Lie=dn,Bie=async({ipfs:r,storage:e}={})=>(e=e||await yl(await Ns({size:1e5}),await u2({ipfs:r,pin:!0})),{get:async s=>{const o=await e.get(s),{value:a}=await qg({bytes:o,codec:h$,hasher:f$});return a&&await e.put(s,o),a},create:async({name:s,type:o,accessController:a,meta:c})=>{if(!s)throw new Error("name is required");if(!o)throw new Error("type is required");if(!a)throw new Error("accessController is required");const l=Object.assign({name:s,type:o,accessController:a},c!==void 0?{meta:c}:{}),{cid:d,bytes:h}=await od({value:l,codec:h$,hasher:f$}),p=d.toString(Lie);return await e.put(p,h),{hash:p,manifest:l}},close:async()=>{await e.close()}}),p$=async(r=32)=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="",n=0;for(;n<r;)t+=e.charAt(Math.floor(Math.random()*e.length)),n+=1;return t},g$=e1,y$=a2,Uie=dn,Fie=async({storage:r,type:e,params:t})=>{const n={type:e,...t},{cid:i,bytes:s}=await od({value:n,codec:g$,hasher:y$}),o=i.toString(Uie);return await r.put(o,s),o},yy="ipfs",my=({write:r,storage:e}={})=>async({orbitdb:t,identities:n,address:i})=>{if(e=e||await yl(await Ns({size:1e3}),await u2({ipfs:t.ipfs,pin:!0})),r=r||[t.identity.id],i){const o=await e.get(i.replaceAll("/ipfs/","")),{value:a}=await qg({bytes:o,codec:g$,hasher:y$});r=a.write}else i=await Fie({storage:e,type:yy,params:{write:r}}),i=Ra("/",yy,i);return{type:yy,address:i,write:r,canAppend:async o=>{const a=await n.getIdentity(o.identity);if(!a)return!1;const{id:c}=a;return r.includes(c)||r.includes("*")?await n.verifyIdentity(a):!1}}};my.type=yy;const m$="orbitdb",w$=({write:r}={})=>async({orbitdb:e,identities:t,address:n,name:i})=>{n=n||i||await p$(64),r=r||[e.identity.id];const s=await e.open(n,{type:"keyvalue",AccessController:my({write:r})});n=s.address;const o=async f=>{const g=await t.getIdentity(f.identity);if(!g)return!1;const{id:v}=g;return await h("write",v)||await h("admin",v)?await t.verifyIdentity(g):!1},a=async()=>{const f=[];for await(const v of s.iterator())f[v.key]=v.value;const g=v=>{const y=v[0];f[y]=new Set([...f[y]||[],...v[1]])};return Object.entries({...f,admin:new Set([...f.admin||[],...s.access.write])}).forEach(g),f},c=async f=>(await a())[f]||new Set([]),l=async()=>{await s.close()},d=async()=>{await s.drop()},h=async(f,g)=>{const v=new Set(await c(f));return v.has(g)||v.has("*")};return{type:m$,address:n,write:r,canAppend:o,capabilities:a,get:c,grant:async(f,g)=>{const v=new Set([...await s.get(f)||[],g]);await s.put(f,Array.from(v.values()))},revoke:async(f,g)=>{const v=new Set(await s.get(f)||[]);v.delete(g),v.size>0?await s.put(f,Array.from(v.values())):await s.del(f)},close:l,drop:d,events:s.events}};w$.type=m$;const Bv={},zie=r=>{if(!Bv[r])throw new Error(`AccessController type '${r}' is not supported`);return Bv[r]},b$=r=>{if(!r.type)throw new Error("AccessController does not contain required field 'type'.");Bv[r.type]=r};b$(my),b$(w$);const Vie="events",Kie=my,Uv=async({ipfs:r,id:e,identity:t,identities:n,directory:i}={})=>{if(r==null)throw new Error("IPFS instance is a required argument.");e=e||await p$();const s=r.libp2p.peerId;i=i||"./orbitdb";let o;n?o=n.keystore:(o=await o$({path:Ra(i,"./keystore")}),n=await Oie({ipfs:r,keystore:o})),t?t.provider&&(t=await n.createIdentity({...t})):t=await n.createIdentity({id:e});const a=await Bie({ipfs:r});let c={};const l=async(p,{type:b,meta:f,sync:g,Database:v,AccessController:y,headsStorage:w,entryStorage:m,indexStorage:E,referencesCount:A}={})=>{let k,x,I;if(c[p])return c[p];if(Rie(p)){const L=d$(p);x=await a.get(L.hash);const z=x.accessController.split("/",2).pop();y=zie(z)(),I=await y({orbitdb:{open:l,identity:t,ipfs:r},identities:n,address:x.accessController}),k=x.name,b=b||x.type,f=x.meta}else{b=b||Vie,y=y||Kie(),I=await y({orbitdb:{open:l,identity:t,ipfs:r},identities:n,name:p});const L=await a.create({name:p,type:b,accessController:I.address,meta:f});if(x=L.manifest,p=d$(L.hash),k=x.name,f=x.meta,c[p])return c[p]}if(v=v||MZ(b)(),!v)throw new Error(`Unsupported database type: '${b}'`);p=p.toString();const T=await v({ipfs:r,identity:t,address:p,name:k,access:I,directory:i,meta:f,syncAutomatically:g,headsStorage:w,entryStorage:m,indexStorage:E,referencesCount:A});return T.events.on("close",d(p)),c[p]=T,T},d=p=>()=>{delete c[p]};return{id:e,open:l,stop:async()=>{for(const p of Object.values(c))await p.close();o&&await o.close(),a&&await a.close(),c={}},ipfs:r,directory:i,keystore:o,identities:n,identity:t,peerId:s}};function pt(r){const e=new globalThis.AbortController;function t(){e.abort();for(const s of r)(s==null?void 0:s.removeEventListener)!=null&&s.removeEventListener("abort",t)}for(const s of r){if((s==null?void 0:s.aborted)===!0){t();break}(s==null?void 0:s.addEventListener)!=null&&s.addEventListener("abort",t)}function n(){for(const s of r)(s==null?void 0:s.removeEventListener)!=null&&s.removeEventListener("abort",t)}const i=e.signal;return i.clear=n,i}let jie=class extends Error{constructor(t,n){super(t??"The operation was aborted");u(this,"type");u(this,"code");this.type="aborted",this.name="AbortError",this.code=n??"ABORT_ERR"}};async function Ti(r,e,t,n){const i=new jie(n==null?void 0:n.errorMessage,n==null?void 0:n.errorCode);return(t==null?void 0:t.aborted)===!0?Promise.reject(i):new Promise((s,o)=>{function a(){t==null||t.removeEventListener("abort",d),r.removeEventListener(e,c),(n==null?void 0:n.errorEvent)!=null&&r.removeEventListener(n.errorEvent,l)}const c=h=>{var p;try{if(((p=n==null?void 0:n.filter)==null?void 0:p.call(n,h))===!1)return}catch(b){a(),o(b);return}a(),s(h)},l=h=>{a(),o(h.detail)},d=()=>{a(),o(i)};t==null||t.addEventListener("abort",d),r.addEventListener(e,c),(n==null?void 0:n.errorEvent)!=null&&r.addEventListener(n.errorEvent,l)})}class Hie extends Error{constructor(t="Rate limit exceeded",n){super(t);u(this,"remainingPoints");u(this,"msBeforeNext");u(this,"consumedPoints");u(this,"isFirstInDuration");this.name="RateLimitError",this.remainingPoints=n.remainingPoints,this.msBeforeNext=n.msBeforeNext,this.consumedPoints=n.consumedPoints,this.isFirstInDuration=n.isFirstInDuration}}class v$ extends Error{constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}u(v$,"name","QueueFullError");class qie{constructor(e){u(this,"deferred");u(this,"signal");var t;this.signal=e,this.deferred=Le(),this.onAbort=this.onAbort.bind(this),(t=this.signal)==null||t.addEventListener("abort",this.onAbort)}onAbort(){var e;this.deferred.reject(((e=this.signal)==null?void 0:e.reason)??new Tl)}cleanup(){var e;(e=this.signal)==null||e.removeEventListener("abort",this.onAbort)}}function Wie(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}class Gie{constructor(e,t){u(this,"id");u(this,"fn");u(this,"options");u(this,"recipients");u(this,"status");u(this,"timeline");u(this,"controller");this.id=Wie(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,n)=>{var i;return t&&((i=n.signal)==null?void 0:i.aborted)===!0},!0)&&(this.controller.abort(new Tl),this.cleanup())}async join(e={}){var n;const t=new qie(e.signal);return this.recipients.push(t),(n=e.signal)==null||n.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await ln(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{var t;e.cleanup(),(t=e.signal)==null||t.removeEventListener("abort",this.onAbort)})}}class Ul extends er{constructor(t={}){var n;super();u(this,"concurrency");u(this,"maxSize");u(this,"queue");u(this,"pending");u(this,"sort");this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.maxSize=t.maxSize??Number.POSITIVE_INFINITY,this.pending=0,t.metricName!=null&&((n=t.metrics)==null||n.registerMetricGroup(t.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})})),this.sort=t.sort,this.queue=[]}tryToStartAnother(){if(this.size===0)return queueMicrotask(()=>{this.safeDispatchEvent("empty")}),this.running===0&&queueMicrotask(()=>{this.safeDispatchEvent("idle")}),!1;if(this.pending<this.concurrency){let t;for(const n of this.queue)if(n.status==="queued"){t=n;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let n=0;n<this.queue.length;n++)if(this.queue[n]===t){this.queue.splice(n,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(t){this.queue.push(t),this.sort!=null&&this.queue.sort(this.sort)}async add(t,n){var s;if((s=n==null?void 0:n.signal)==null||s.throwIfAborted(),this.size===this.maxSize)throw new v$;const i=new Gie(t,n);return this.enqueue(i),this.safeDispatchEvent("add"),this.tryToStartAnother(),i.join(n).then(o=>(this.safeDispatchEvent("completed",{detail:o}),this.safeDispatchEvent("success",{detail:{job:i,result:o}}),o)).catch(o=>{if(i.status==="queued"){for(let a=0;a<this.queue.length;a++)if(this.queue[a]===i){this.queue.splice(a,1);break}}throw this.safeDispatchEvent("error",{detail:o}),this.safeDispatchEvent("failure",{detail:{job:i,error:o}}),o})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new Tl)}),this.clear()}async onEmpty(t){this.size!==0&&await Ti(this,"empty",t==null?void 0:t.signal)}async onSizeLessThan(t,n){this.size<t||await Ti(this,"next",n==null?void 0:n.signal,{filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await Ti(this,"idle",t==null?void 0:t.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){var l,d,h;(l=t==null?void 0:t.signal)==null||l.throwIfAborted();const n=go({objectMode:!0}),i=p=>{p!=null?this.abort():this.clear(),n.end(p)},s=p=>{p.detail!=null&&n.push(p.detail)},o=p=>{i(p.detail)},a=()=>{i()},c=()=>{i(new Tl("Queue aborted"))};this.addEventListener("completed",s),this.addEventListener("error",o),this.addEventListener("idle",a),(d=t==null?void 0:t.signal)==null||d.addEventListener("abort",c);try{yield*n}finally{this.removeEventListener("completed",s),this.removeEventListener("error",o),this.removeEventListener("idle",a),(h=t==null?void 0:t.signal)==null||h.removeEventListener("abort",c),i()}}}class uc extends Ul{has(e){return this.find(e)!=null}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}const Qie=8,Fv=1024*1024*4;let Jie=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}},E$=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}},Yie=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}},S$=class extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}};function x$(r){return r[Symbol.asyncIterator]!=null}function A$(r,e){if(r.byteLength>e)throw new E$("Message length too long")}const wy=r=>{const e=yt(r),t=In(e);return Sr(r,t),wy.bytes=e,t};wy.bytes=0;function Bd(r,e){e=e??{};const t=e.lengthEncoder??wy,n=(e==null?void 0:e.maxDataLength)??Fv;function*i(s){A$(s,n);const o=t(s.byteLength);o instanceof Uint8Array?yield o:yield*o,s instanceof Uint8Array?yield s:yield*s}return x$(r)?async function*(){for await(const s of r)yield*i(s)}():function*(){for(const s of r)yield*i(s)}()}Bd.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??wy,n=(e==null?void 0:e.maxDataLength)??Fv;return A$(r,n),new Ue(t(r.byteLength),r)};var Fl;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(Fl||(Fl={}));const zv=r=>{const e=es(r);return zv.bytes=yt(e),e};zv.bytes=0;function Ud(r,e){const t=new Ue;let n=Fl.LENGTH,i=-1;const s=(e==null?void 0:e.lengthDecoder)??zv,o=(e==null?void 0:e.maxLengthLength)??Qie,a=(e==null?void 0:e.maxDataLength)??Fv;function*c(){for(;t.byteLength>0;){if(n===Fl.LENGTH)try{if(i=s(t),i<0)throw new Jie("Invalid message length");if(i>a)throw new E$("Message length too long");const l=s.bytes;t.consume(l),(e==null?void 0:e.onLength)!=null&&e.onLength(i),n=Fl.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>o)throw new Yie("Message length length too long");break}throw l}if(n===Fl.DATA){if(t.byteLength<i)break;const l=t.sublist(0,i);t.consume(i),(e==null?void 0:e.onData)!=null&&e.onData(l),yield l,n=Fl.LENGTH}}}return x$(r)?async function*(){for await(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new S$("Unexpected end of input")}():function*(){for(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new S$("Unexpected end of input")}()}Ud.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:s,value:o}=await r.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return Ud(n,{...e??{},onLength:s=>{t=s}})};function Vv(r){const[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:i=>{n.push(i)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}function Xie(r){return r[Symbol.asyncIterator]!=null}function Fd(r,e){let t=0;if(Xie(r))return async function*(){for await(const c of r)yield e(c,t++)}();const n=Vv(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof o.then=="function")return async function*(){yield await o;for await(const c of n)yield e(c,t++)}();const a=e;return function*(){yield o;for(const c of n)yield a(c,t++)}()}function Zie(r){return r[Symbol.asyncIterator]!=null}function by(r,e){return Zie(r)?async function*(){let t=0;if(!(e<1)){for await(const n of r)if(yield n,t++,t===e)return}}():function*(){let t=0;if(!(e<1)){for(const n of r)if(yield n,t++,t===e)return}}()}class _e extends Event{constructor(t,n){super(t);u(this,"type");u(this,"detail");this.type=t,this.detail=n}}const vy="/ipfs/bitswap/1.2.0",ese=1024,tse=1024,rse=1024,nse=5e3,ise=10,sse=50,ose=!1,ase=3,C$=1024*1024*4,cse=C$;var pr;(function(r){r.WantBlock="WantBlock",r.WantHave="WantHave"})(pr||(pr={}));var Kv;(function(r){r[r.WantBlock=0]="WantBlock",r[r.WantHave=1]="WantHave"})(Kv||(Kv={})),function(r){r.codec=()=>kn(Kv)}(pr||(pr={}));var N1;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.priority!=null&&t.priority!==0&&(n.uint32(16),n.int32(t.priority)),t.cancel!=null&&(n.uint32(24),n.bool(t.cancel)),t.wantType!=null&&(n.uint32(32),pr.codec().encode(t.wantType,n)),t.sendDontHave!=null&&(n.uint32(40),n.bool(t.sendDontHave)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={cid:Ge(0),priority:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.cid=t.bytes();break}case 2:{s.priority=t.int32();break}case 3:{s.cancel=t.bool();break}case 4:{s.wantType=pr.codec().decode(t);break}case 5:{s.sendDontHave=t.bool();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(N1||(N1={}));var Ey;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.entries!=null)for(const s of t.entries)n.uint32(10),N1.codec().encode(s,n);t.full!=null&&(n.uint32(16),n.bool(t.full)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={entries:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{if(((a=i.limits)==null?void 0:a.entries)!=null&&s.entries.length===i.limits.entries)throw new mt('Decode error - map field "entries" had too many elements');s.entries.push(N1.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.entries$}));break}case 2:{s.full=t.bool();break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(Ey||(Ey={}));var M1;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.prefix!=null&&t.prefix.byteLength>0&&(n.uint32(10),n.bytes(t.prefix)),t.data!=null&&t.data.byteLength>0&&(n.uint32(18),n.bytes(t.data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={prefix:Ge(0),data:Ge(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.prefix=t.bytes();break}case 2:{s.data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(M1||(M1={}));var Fs;(function(r){r.HaveBlock="HaveBlock",r.DoNotHaveBlock="DoNotHaveBlock"})(Fs||(Fs={}));var Sy;(function(r){r[r.HaveBlock=0]="HaveBlock",r[r.DoNotHaveBlock=1]="DoNotHaveBlock"})(Sy||(Sy={})),function(r){r.codec=()=>kn(Sy)}(Fs||(Fs={}));var O1;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.type!=null&&Sy[t.type]!==0&&(n.uint32(16),Fs.codec().encode(t.type,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={cid:Ge(0),type:Fs.HaveBlock},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.cid=t.bytes();break}case 2:{s.type=Fs.codec().decode(t);break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(O1||(O1={}));var R1;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.wantlist!=null&&(n.uint32(10),Ey.codec().encode(t.wantlist,n)),t.blocks!=null)for(const s of t.blocks)n.uint32(26),M1.codec().encode(s,n);if(t.blockPresences!=null)for(const s of t.blockPresences)n.uint32(34),O1.codec().encode(s,n);t.pendingBytes!=null&&t.pendingBytes!==0&&(n.uint32(40),n.int32(t.pendingBytes)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,d,h;const s={blocks:[],blockPresences:[],pendingBytes:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const p=t.uint32();switch(p>>>3){case 1:{s.wantlist=Ey.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.wantlist});break}case 3:{if(((c=i.limits)==null?void 0:c.blocks)!=null&&s.blocks.length===i.limits.blocks)throw new mt('Decode error - map field "blocks" had too many elements');s.blocks.push(M1.codec().decode(t,t.uint32(),{limits:(l=i.limits)==null?void 0:l.blocks$}));break}case 4:{if(((d=i.limits)==null?void 0:d.blockPresences)!=null&&s.blockPresences.length===i.limits.blockPresences)throw new mt('Decode error - map field "blockPresences" had too many elements');s.blockPresences.push(O1.codec().decode(t,t.uint32(),{limits:(h=i.limits)==null?void 0:h.blockPresences$}));break}case 5:{s.pendingBytes=t.int32();break}default:{t.skipType(p&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(R1||(R1={}));function lse(r,e){for(const[t,n]of e.wantlist.entries()){const i=r.wantlist.get(t);i!=null&&(i.priority>n.priority&&(n.priority=i.priority),n.cancel=n.cancel??i.cancel,n.wantType=n.wantType??i.wantType,n.sendDontHave=n.sendDontHave??i.sendDontHave),r.wantlist.set(t,n)}for(const[t,n]of e.blockPresences.entries())r.blockPresences.set(t,n);for(const[t,n]of e.blocks.entries())r.blocks.set(t,n);return e.full&&!r.full&&(r.full=!0),r}class I$ extends Error{constructor(e="Block too large"){super(e),this.name="BlockTooLargeError"}}u(I$,"name","BlockTooLargeError");const use=4193648+16;function*dse(r,e){const t=[...r.wantlist.values()],n=[...r.blockPresences.values()],i=[...r.blocks.values()];let s=0,o=0,a=0,c=!1;for(;;){const l={wantlist:{full:r.full??!1,entries:[]},blockPresences:[],blocks:[],pendingBytes:0};let d=R1.encode(l).byteLength,{added:h,hasMore:p,newSize:b}=jv(i,l.blocks,a,e,d,hse);a+=h,d=b;const f=p;({added:h,hasMore:p,newSize:b}=jv(n,l.blockPresences,o,e,d,fse)),o+=h,d=b;const g=p;if({added:h,hasMore:p,newSize:b}=jv(t,l.wantlist.entries,s,e,d,pse),s+=h,d=b,c=!f&&!g&&!p,c||(l.wantlist.full=!1),yield R1.encode(l),c)break}}function jv(r,e,t,n,i,s){let o=0,a=!1;for(let c=t;c<r.length;c++){const l=r[c],d=s(l);if(d>use)throw new I$("Cannot send block as after encoding it is over the max message size");const h=i+d;if(h>n){a=!0;break}e.push(l),o++,i=h}return{hasMore:a,added:o,newSize:i}}function hse(r){return Hv(3,M1.encode(r))}function fse(r){return Hv(4,O1.encode(r))}function pse(r){return Hv(1,N1.encode(r))}function Hv(r,e){const t=yt(r),n=yt(e.byteLength);return t+n+e.byteLength}let gse=class extends er{constructor(t,n={}){var i,s;super();u(this,"log");u(this,"libp2p");u(this,"routing");u(this,"protocols");u(this,"running");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"messageReceiveTimeout");u(this,"registrarIds");u(this,"metrics");u(this,"sendQueue");u(this,"runOnLimitedConnections");u(this,"maxOutgoingMessageSize");u(this,"maxIncomingMessageSize");this.log=t.logger.forComponent("helia:bitswap:network"),this.libp2p=t.libp2p,this.routing=t.routing,this.protocols=n.protocols??[vy],this.registrarIds=[],this.running=!1,this._onStream=this._onStream.bind(this),this.maxInboundStreams=n.maxInboundStreams??tse,this.maxOutboundStreams=n.maxOutboundStreams??rse,this.messageReceiveTimeout=n.messageReceiveTimeout??nse,this.runOnLimitedConnections=n.runOnLimitedConnections??ose,this.maxIncomingMessageSize=n.maxIncomingMessageSize??C$,this.maxOutgoingMessageSize=n.maxOutgoingMessageSize??n.maxIncomingMessageSize??cse,this.metrics={blocksSent:(i=t.metrics)==null?void 0:i.registerCounter("helia_bitswap_sent_blocks_total"),dataSent:(s=t.metrics)==null?void 0:s.registerCounter("helia_bitswap_sent_data_bytes_total")},this.sendQueue=new uc({concurrency:n.messageSendConcurrency??sse,metrics:t.metrics,metricName:"helia_bitswap_message_send_queue"}),this.sendQueue.addEventListener("error",o=>{this.log.error("error sending wantlist to peer",o.detail)})}async start(){if(this.running)return;this.running=!0,await this.libp2p.handle(this.protocols,this._onStream,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnections});const t={onConnect:n=>{this.safeDispatchEvent("peer:connected",{detail:n})},onDisconnect:n=>{this.safeDispatchEvent("peer:disconnected",{detail:n})}};this.registrarIds=[];for(const n of this.protocols)this.registrarIds.push(await this.libp2p.register(n,t));this.libp2p.getConnections().forEach(n=>{this.safeDispatchEvent("peer:connected",{detail:n.remotePeer})})}async stop(){if(this.running=!1,await this.libp2p.unhandle(this.protocols),this.registrarIds!=null){for(const t of this.registrarIds)this.libp2p.unregister(t);this.registrarIds=[]}}_onStream(t){if(!this.running)return;const{stream:n,connection:i}=t;Promise.resolve().then(async()=>{this.log("incoming new bitswap %s stream from %p",n.protocol,i.remotePeer);const s=()=>{n.status==="open"?n.abort(new y1(`Incoming Bitswap stream timed out after ${this.messageReceiveTimeout}ms`)):this.log("stream aborted with status %s",n.status)};let o=AbortSignal.timeout(this.messageReceiveTimeout);o.addEventListener("abort",s),await n.closeWrite(),await un(n,a=>Ud(a,{maxDataLength:this.maxIncomingMessageSize}),async a=>{for await(const c of a)try{const l=R1.decode(c);this.log("incoming new bitswap %s message from %p on stream",n.protocol,i.remotePeer,n.id),this.safeDispatchEvent("bitswap:message",{detail:{peer:i.remotePeer,message:l}}),o.removeEventListener("abort",s),o=AbortSignal.timeout(this.messageReceiveTimeout),o.addEventListener("abort",s)}catch(l){this.log.error("error reading incoming bitswap message from %p on stream",i.remotePeer,n.id,l),n.abort(l);break}})}).catch(s=>{this.log.error("error handling incoming stream from %p",i.remotePeer,s),n.abort(s)})}async*findProviders(t,n){var i;(i=n==null?void 0:n.onProgress)==null||i.call(n,new _e("bitswap:network:find-providers",t));for await(const s of this.routing.findProviders(t,n))await this.libp2p.isDialable(s.multiaddrs,{runOnLimitedConnection:this.runOnLimitedConnections})&&(yield s)}async findAndConnect(t,n){await vo(Fd(by(this.findProviders(t,n),(n==null?void 0:n.maxProviders)??ase),async i=>this.connectTo(i.id,n))).catch(i=>{this.log.error(i)})}async sendMessage(t,n,i){if(!this.running)throw new Error("network isn't running");const s=this.sendQueue.queue.find(o=>t.equals(o.options.peerId)&&o.status==="queued");if(s!=null){s.options.message=lse(s.options.message,n),await s.join({signal:i==null?void 0:i.signal});return}await this.sendQueue.add(async o=>{var l,d;const a=o==null?void 0:o.message;if(a==null)throw new Z("No message to send");this.log("sendMessage to %p",t),(l=o==null?void 0:o.onProgress)==null||l.call(o,new _e("bitswap:network:send-wantlist",t));const c=await this.libp2p.dialProtocol(t,vy,o);await c.closeRead();try{await un(dse(a,this.maxOutgoingMessageSize),h=>Bd(h),c),await c.close(o)}catch(h){(d=o==null?void 0:o.onProgress)==null||d.call(o,new _e("bitswap:network:send-wantlist:error",{peer:t,error:h})),this.log.error("error sending message to %p",t,h),c.abort(h)}this._updateSentStats(a.blocks)},{peerId:t,signal:i==null?void 0:i.signal,message:n})}async connectTo(t,n){var s;if(!this.running)throw new Dl("Network isn't running");(s=n==null?void 0:n.onProgress)==null||s.call(n,new _e("bitswap:network:dial",t));const[i]=await Promise.all([this.libp2p.dial(t,n),Ti(this.libp2p,"peer:identify",n==null?void 0:n.signal,{filter:o=>{if(!o.detail.peerId.equals(t))return!1;if(o.detail.protocols.includes(vy))return!0;throw new g1(`${t} did not support ${vy}`)}})]);return i}_updateSentStats(t){var i,s;let n=0;for(const o of t.values())n+=o.data.byteLength;(i=this.metrics.dataSent)==null||i.increment(n),(s=this.metrics.blocksSent)==null||s.increment(t.size)}};function yse(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function xy(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function mse(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var wse=mse,bse=wse;let vse=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Ese=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return k$(this,e)}},Sse=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return k$(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function k$(r,e){return new Sse({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let xse=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new vse(e,t,n),this.decoder=new Ese(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function _$({name:r,prefix:e,encode:t,decode:n}){return new xse(r,e,t,n)}function Ay({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=bse(t,r);return _$({prefix:e,name:r,encode:n,decode:s=>xy(i(s))})}function Ase(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Cse(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function No({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return _$({prefix:e,name:r,encode(i){return Cse(i,n,t)},decode(i){return Ase(i,n,t,r)}})}const zs=Ay({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Ay({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const Cy=No({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});No({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),No({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),No({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),No({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),No({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),No({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),No({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),No({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const qv=Ay({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Ay({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ise=P$,T$=128,kse=-128,_se=Math.pow(2,31);function P$(r,e,t){e=e||[],t=t||0;for(var n=t;r>=_se;)e[t++]=r&255|T$,r/=128;for(;r&kse;)e[t++]=r&255|T$,r>>>=7;return e[t]=r|0,P$.bytes=t-n+1,e}var Tse=Wv,Pse=128,D$=127;function Wv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Wv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&D$)<<i:(o&D$)*Math.pow(2,i),i+=7}while(o>=Pse);return Wv.bytes=s-n,t}var Dse=Math.pow(2,7),$se=Math.pow(2,14),Nse=Math.pow(2,21),Mse=Math.pow(2,28),Ose=Math.pow(2,35),Rse=Math.pow(2,42),Lse=Math.pow(2,49),Bse=Math.pow(2,56),Use=Math.pow(2,63),Fse=function(r){return r<Dse?1:r<$se?2:r<Nse?3:r<Mse?4:r<Ose?5:r<Rse?6:r<Lse?7:r<Bse?8:r<Use?9:10},zse={encode:Ise,decode:Tse,encodingLength:Fse},Iy=zse;function Gv(r,e=0){return[Iy.decode(r,e),Iy.decode.bytes]}function ky(r,e,t=0){return Iy.encode(r,e,t),e}function _y(r){return Iy.encodingLength(r)}function Ty(r,e){const t=e.byteLength,n=_y(r),i=n+_y(t),s=new Uint8Array(i+t);return ky(r,s,0),ky(t,s,n),s.set(e,i),new Qv(r,t,e,s)}function $$(r){const e=xy(r),[t,n]=Gv(e),[i,s]=Gv(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Qv(t,i,o,e)}function Vse(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&yse(r.bytes,t.bytes)}}let Qv=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function N$(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return jse(t,Jv(r),e??zs.encoder);default:return Hse(t,Jv(r),e??Cy.encoder)}}const M$=new WeakMap;function Jv(r){const e=M$.get(r);if(e==null){const t=new Map;return M$.set(r,t),t}return e}let Yv=class Wr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,_j,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==L1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==qse)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Wr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Ty(e,t);return Wr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Wr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Vse(e.multihash,n.multihash)}toString(e){return N$(this,e)}toJSON(){return{"/":N$(this)}}link(){return this}[(_j=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Wr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Wr(n,i,s,o??O$(n,i,s.bytes))}else if(t[Wse]===!0){const{version:n,multihash:i,code:s}=t,o=$$(i);return Wr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==L1)throw new Error(`Version 0 CID must use dag-pb (code: ${L1}) block encoding`);return new Wr(e,t,n,n.bytes)}case 1:{const i=O$(e,t,n.bytes);return new Wr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Wr.create(0,L1,e)}static createV1(e,t){return Wr.create(1,e,t)}static decode(e){const[t,n]=Wr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Wr.inspectBytes(e),n=t.size-t.multihashSize,i=xy(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new Qv(t.multihashCode,t.digestSize,s,i);return[t.version===0?Wr.createV0(o):Wr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=Gv(e.subarray(t));return t+=p,h};let i=n(),s=L1;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Kse(e,t),s=Wr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Jv(s).set(n,e),s}};function Kse(r,e){switch(r[0]){case"Q":{const t=e??zs;return[zs.prefix,t.decode(`${zs.prefix}${r}`)]}case zs.prefix:{const t=e??zs;return[zs.prefix,t.decode(r)]}case Cy.prefix:{const t=e??Cy;return[Cy.prefix,t.decode(r)]}case qv.prefix:{const t=e??qv;return[qv.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function jse(r,e,t){const{prefix:n}=t;if(n!==zs.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Hse(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const L1=112,qse=18;function O$(r,e,t){const n=_y(r),i=n+_y(e),s=new Uint8Array(i+t.byteLength);return ky(r,s,0),ky(e,s,n),s.set(t,i),s}const Wse=Symbol.for("@ipld/js-cid/CID"),R$=0,Gse="identity",L$=xy;function Qse(r){return Ty(R$,L$(r))}const B$={code:R$,name:Gse,encode:L$,digest:Qse};function Jse({name:r,code:e,encode:t}){return new Yse(r,e,t)}let Yse=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ty(this.code,t):t.then(n=>Ty(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Xse(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const Zse=Jse({name:"sha2-256",code:18,encode:Xse("SHA-256")}),U$=Symbol.for("nodejs.util.inspect.custom"),eoe=114;class Xv{constructor(e){u(this,"type");u(this,"multihash");u(this,"publicKey");u(this,"string");u(this,Tj,!0);this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=zs.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return Yv.createV1(eoe,this.multihash)}toJSON(){return this.toString()}equals(e){var t;if(e==null)return!1;if(e instanceof Uint8Array)return We(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(((t=e==null?void 0:e.toMultihash())==null?void 0:t.bytes)!=null)return We(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[(Tj=Tb,U$)](){return`PeerId(${this.toString()})`}}class F$ extends Xv{constructor(t){super({...t,type:"RSA"});u(this,"type","RSA");u(this,"publicKey");this.publicKey=t.publicKey}}class z$ extends Xv{constructor(t){super({...t,type:"Ed25519"});u(this,"type","Ed25519");u(this,"publicKey");this.publicKey=t.publicKey}}class V$ extends Xv{constructor(t){super({...t,type:"secp256k1"});u(this,"type","secp256k1");u(this,"publicKey");this.publicKey=t.publicKey}}const toe=2336;class K${constructor(e){u(this,"type","url");u(this,"multihash");u(this,"publicKey");u(this,"url");u(this,Pj,!0);this.url=e.toString(),this.multihash=B$.digest(oe(this.url))}[(Dj=U$,Pj=Tb,Dj)](){return`PeerId(${this.url})`}toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return Yv.createV1(toe,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=re(e)),e.toString()===this.toString())}}const roe=114,j$=2336;function tr(r,e){let t;if(r.charAt(0)==="1"||r.charAt(0)==="Q")t=$$(zs.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return Vd(Yv.parse(r));throw new Z('Please pass a multibase decoder for strings that do not start with "1" or "Q"')}return ti(t)}function zd(r){if(r.type==="Ed25519")return new z$({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new V$({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new F$({multihash:r.toCID().multihash,publicKey:r});throw new $l}function noe(r){return zd(r.publicKey)}function ti(r){if(soe(r))return new F$({multihash:r});if(ioe(r))try{const e=n$(r);if(e.type==="Ed25519")return new z$({multihash:r,publicKey:e});if(e.type==="secp256k1")return new V$({multihash:r,publicKey:e})}catch{const t=re(r.digest);return new K$(new URL(t))}throw new R2("Supplied PeerID Multihash is invalid")}function Vd(r){if((r==null?void 0:r.multihash)==null||r.version==null||r.version===1&&r.code!==roe&&r.code!==j$)throw new mP("Supplied PeerID CID is invalid");if(r.code===j$){const e=re(r.multihash.digest);return new K$(new URL(e))}return ti(r.multihash)}function ioe(r){return r.code===B$.code}function soe(r){return r.code===Zse.code}function H$(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function ooe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var aoe=ooe,coe=aoe;let loe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},uoe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return q$(this,e)}},doe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return q$(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function q$(r,e){return new doe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let hoe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new loe(e,t,n),this.decoder=new uoe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function foe({name:r,prefix:e,encode:t,decode:n}){return new hoe(r,e,t,n)}function W$({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=coe(t,r);return foe({prefix:e,name:r,encode:n,decode:s=>H$(i(s))})}const poe=W$({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});W$({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var goe=Q$,G$=128,yoe=-128,moe=Math.pow(2,31);function Q$(r,e,t){e=e||[],t=t||0;for(var n=t;r>=moe;)e[t++]=r&255|G$,r/=128;for(;r&yoe;)e[t++]=r&255|G$,r>>>=7;return e[t]=r|0,Q$.bytes=t-n+1,e}var woe=Zv,boe=128,J$=127;function Zv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Zv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&J$)<<i:(o&J$)*Math.pow(2,i),i+=7}while(o>=boe);return Zv.bytes=s-n,t}var voe=Math.pow(2,7),Eoe=Math.pow(2,14),Soe=Math.pow(2,21),xoe=Math.pow(2,28),Aoe=Math.pow(2,35),Coe=Math.pow(2,42),Ioe=Math.pow(2,49),koe=Math.pow(2,56),_oe=Math.pow(2,63),Toe=function(r){return r<voe?1:r<Eoe?2:r<Soe?3:r<xoe?4:r<Aoe?5:r<Coe?6:r<Ioe?7:r<koe?8:r<_oe?9:10},Poe={encode:goe,decode:woe,encodingLength:Toe},Y$=Poe;function X$(r,e=0){return[Y$.decode(r,e),Y$.decode.bytes]}function Doe(r){const e=H$(r),[t,n]=X$(e),[i,s]=X$(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new $oe(t,i,o,e)}let $oe=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function B1(r,e){const t={[Symbol.iterator]:()=>t,next:()=>{const n=r.next(),i=n.value;return n.done===!0||i==null?{done:!0,value:void 0}:{done:!1,value:e(i)}}};return t}function e7(r){const e=Doe(poe.decode(`z${r}`));return ti(e)}class dc{constructor(e){u(this,"map");if(this.map=new Map,e!=null)for(const[t,n]of e.entries())this.map.set(t.toString(),{key:t,value:n})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return B1(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,n)=>{e(t.value,t.key,this)})}get(e){var t;return(t=this.map.get(e.toString()))==null?void 0:t.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return B1(this.map.values(),e=>e.key)}values(){return B1(this.map.values(),e=>e.value)}get size(){return this.map.size}}class rs{constructor(e){u(this,"set");if(this.set=new Set,e!=null)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return B1(this.set.entries(),e=>{const t=e7(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{const n=e7(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return B1(this.set.values(),e=>e7(e))}intersection(e){const t=new rs;for(const n of e)this.has(n)&&t.add(n);return t}difference(e){const t=new rs;for(const n of this)e.has(n)||t.add(n);return t}union(e){const t=new rs;for(const n of e)t.add(n);for(const n of this)t.add(n);return t}}function Noe(){return new rs}class Z$ extends $D{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,uy(e);const n=D1(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Rs(s)}update(e){return dy(this),this.iHash.update(e),this}digestInto(e){dy(this),T1(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Py=(r,e,t)=>new Z$(r,e).update(t).digest();Py.create=(r,e)=>new Z$(r,e);function eN(r,e,t,n){uy(r);const i=yne({dkLen:32,asyncTick:10},n),{c:s,dkLen:o,asyncTick:a}=i;if(Od(s),Od(o),Od(a),s<1)throw new Error("iterations (c) should be >= 1");const c=DD(e),l=DD(t),d=new Uint8Array(o),h=Py.create(r,c),p=h._cloneInto().update(l);return{c:s,dkLen:o,asyncTick:a,DK:d,PRF:h,PRFSalt:p}}function tN(r,e,t,n,i){return r.destroy(),e.destroy(),n&&n.destroy(),Rs(i),t}function Moe(r,e,t,n){const{c:i,dkLen:s,DK:o,PRF:a,PRFSalt:c}=eN(r,e,t,n);let l;const d=new Uint8Array(4),h=P1(d),p=new Uint8Array(a.outputLen);for(let b=1,f=0;f<s;b++,f+=a.outputLen){const g=o.subarray(f,f+a.outputLen);h.setInt32(0,b,!1),(l=c._cloneInto(l)).update(d).digestInto(p),g.set(p.subarray(0,g.length));for(let v=1;v<i;v++){a._cloneInto(l).update(p).digestInto(p);for(let y=0;y<g.length;y++)g[y]^=p[y]}}return tN(a,c,o,l,p)}async function rN(r,e,t,n){const{c:i,dkLen:s,asyncTick:o,DK:a,PRF:c,PRFSalt:l}=eN(r,e,t,n);let d;const h=new Uint8Array(4),p=P1(h),b=new Uint8Array(c.outputLen);for(let f=1,g=0;g<s;f++,g+=c.outputLen){const v=a.subarray(g,g+c.outputLen);p.setInt32(0,f,!1),(d=l._cloneInto(d)).update(h).digestInto(b),v.set(b.subarray(0,v.length)),await gne(i-1,o,()=>{c._cloneInto(d).update(b).digestInto(b);for(let y=0;y<v.length;y++)v[y]^=b[y]})}return tN(c,l,a,d,b)}const U1=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),hc=new Uint32Array(80);class Ooe extends Iv{constructor(){super(64,20,8,!1),this.A=U1[0]|0,this.B=U1[1]|0,this.C=U1[2]|0,this.D=U1[3]|0,this.E=U1[4]|0}get(){const{A:e,B:t,C:n,D:i,E:s}=this;return[e,t,n,i,s]}set(e,t,n,i,s){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0}process(e,t){for(let c=0;c<16;c++,t+=4)hc[c]=e.getUint32(t,!1);for(let c=16;c<80;c++)hc[c]=Av(hc[c-3]^hc[c-8]^hc[c-14]^hc[c-16],1);let{A:n,B:i,C:s,D:o,E:a}=this;for(let c=0;c<80;c++){let l,d;c<20?(l=OD(i,s,o),d=1518500249):c<40?(l=i^s^o,d=1859775393):c<60?(l=RD(i,s,o),d=2400959708):(l=i^s^o,d=3395469782);const h=Av(n,5)+l+a+d+hc[c]|0;a=o,o=s,s=Av(i,30),i=n,n=h}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,this.set(n,i,s,o,a)}roundClean(){Rs(hc)}destroy(){this.set(0,0,0,0,0),Rs(this.buffer)}}const Roe=Cv(()=>new Ooe),t7=Mne,Loe=Xn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Xn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Xn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Xn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const nN={sha1:Roe,"sha2-256":Bl,"sha2-512":t7};function iN(r,e,t,n,i){if(i!=="sha1"&&i!=="sha2-256"&&i!=="sha2-512"){const a=Object.keys(nN).join(" / ");throw new Z(`Hash '${i}' is unknown or not supported. Must be ${a}`)}const s=nN[i],o=Moe(s,r,e,{c:t,dkLen:n});return Loe.encode(o).substring(1)}const r7={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},sN={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},oN=new globalThis.TextEncoder;function Boe(r,e){const t=r7[e];let n=sN[e];for(let i=0;i<r.length;i++)n^=BigInt(r[i]),n=BigInt.asUintN(e,n*t);return n}function Uoe(r,e,t){if(t.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");const n=r7[e];let i=sN[e],s=r;for(;s.length>0;){const o=oN.encodeInto(s,t);s=s.slice(o.read);for(let a=0;a<o.written;a++)i^=BigInt(t[a]),i=BigInt.asUintN(e,i*n)}return i}function Foe(r,{size:e=32,utf8Buffer:t}={}){if(!r7[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof r=="string"){if(t)return Uoe(r,e,t);r=oN.encode(r)}return Boe(r,e)}const n7={hash:r=>Number(Foe(r,{size:32})),hashV:(r,e)=>zoe(n7.hash(r,e))};function zoe(r){let e=r.toString(16);return e.length%2===1&&(e=`0${e}`),oe(e,"base16")}const aN=64;class zl{constructor(e,t,n,i=2){u(this,"fp");u(this,"h");u(this,"seed");if(i>aN)throw new TypeError("Invalid Fingerprint Size");const s=t.hashV(e,n),o=Ge(i);for(let a=0;a<o.length;a++)o[a]=s[a];o.length===0&&(o[0]=7),this.fp=o,this.h=t,this.seed=n}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return(e==null?void 0:e.fp)instanceof Uint8Array?We(this.fp,e.fp):!1}}function Dy(r,e){return Math.floor(Math.random()*(e-r))+r}class $y{constructor(e){u(this,"contents");this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof zl))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof zl))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof zl))throw new TypeError("Invalid Fingerprint");const t=Dy(0,this.contents.length-1),n=this.contents[t];return this.contents[t]=e,n}remove(e){if(!(e instanceof zl))throw new TypeError("Invalid Fingerprint");const t=this.contents.findIndex(n=>e.equals(n));return t>-1?(this.contents[t]=null,!0):!1}}const Voe=500;class cN{constructor(e){u(this,"bucketSize");u(this,"filterSize");u(this,"fingerprintSize");u(this,"buckets");u(this,"count");u(this,"hash");u(this,"seed");this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??n7,this.seed=e.seed??Dy(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=oe(e));const t=new zl(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=(n^t.hash())%this.filterSize;if(this.buckets[n]==null&&(this.buckets[n]=new $y(this.bucketSize)),this.buckets[i]==null&&(this.buckets[i]=new $y(this.bucketSize)),this.buckets[n].add(t)||this.buckets[i].add(t))return this.count++,!0;const s=[n,i];let o=s[Dy(0,s.length-1)];this.buckets[o]==null&&(this.buckets[o]=new $y(this.bucketSize));for(let a=0;a<Voe;a++){const c=this.buckets[o].swap(t);if(c!=null&&(o=(o^c.hash())%this.filterSize,this.buckets[o]==null&&(this.buckets[o]=new $y(this.bucketSize)),this.buckets[o].add(c)))return this.count++,!0}return!1}has(e){var o,a;typeof e=="string"&&(e=oe(e));const t=new zl(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=((o=this.buckets[n])==null?void 0:o.has(t))??!1;if(i)return i;const s=(n^t.hash())%this.filterSize;return((a=this.buckets[s])==null?void 0:a.has(t))??!1}remove(e){var a,c;typeof e=="string"&&(e=oe(e));const t=new zl(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=((a=this.buckets[n])==null?void 0:a.remove(t))??!1;if(i)return this.count--,i;const s=(n^t.hash())%this.filterSize,o=((c=this.buckets[s])==null?void 0:c.remove(t))??!1;return o&&this.count--,o}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}}const Koe={1:.5,2:.84,4:.95,8:.98};function joe(r=.001){return r>.002?2:r>1e-5?4:8}function Hoe(r,e=.001){const t=joe(e),n=Koe[t],i=Math.round(r/n),s=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),aN);return{filterSize:i,bucketSize:t,fingerprintSize:s}}class qoe{constructor(e){u(this,"filterSize");u(this,"bucketSize");u(this,"fingerprintSize");u(this,"scale");u(this,"filterSeries");u(this,"hash");u(this,"seed");this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??n7,this.seed=e.seed??Dy(0,Math.pow(2,10)),this.filterSeries=[new cN({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=oe(e)),this.has(e))return!0;let t=this.filterSeries.find(n=>n.reliable);if(t==null){const n=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new cN({filterSize:n,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=oe(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=oe(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}function Vl(r,e=.001,t){return new qoe({...Hoe(r,e)})}class Woe{constructor(e,t){u(this,"filter");this.filter=Vl(e,t)}has(e){return this.filter.has(e.toMultihash().bytes)}add(e){this.filter.add(e.toMultihash().bytes)}remove(e){var t,n;(n=(t=this.filter).remove)==null||n.call(t,e.toMultihash().bytes)}}function Goe(r,e=.001){return new Woe(r,e)}class Qoe extends dc{constructor(t){super();u(this,"metric");const{name:n,metrics:i}=t;this.metric=i.registerMetric(n),this.updateComponentMetric()}set(t,n){return super.set(t,n),this.updateComponentMetric(),this}delete(t){const n=super.delete(t);return this.updateComponentMetric(),n}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function lN(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new Qoe({name:e,metrics:t}):n=new dc,n}function Joe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function i7(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Yoe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var Xoe=Yoe,Zoe=Xoe;let eae=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},tae=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return uN(this,e)}},rae=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return uN(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function uN(r,e){return new rae({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let nae=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new eae(e,t,n),this.decoder=new tae(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function dN({name:r,prefix:e,encode:t,decode:n}){return new nae(r,e,t,n)}function Ny({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Zoe(t,r);return dN({prefix:e,name:r,encode:n,decode:s=>i7(i(s))})}function iae(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function sae(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function ri({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return dN({prefix:e,name:r,encode(i){return sae(i,n,t)},decode(i){return iae(i,n,t,r)}})}const My=ri({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ri({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ri({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ri({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ri({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ri({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ri({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ri({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ri({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const s7=Ny({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Ny({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const fc=Ny({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Ny({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var oae=fN,hN=128,aae=-128,cae=Math.pow(2,31);function fN(r,e,t){e=e||[],t=t||0;for(var n=t;r>=cae;)e[t++]=r&255|hN,r/=128;for(;r&aae;)e[t++]=r&255|hN,r>>>=7;return e[t]=r|0,fN.bytes=t-n+1,e}var lae=o7,uae=128,pN=127;function o7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw o7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&pN)<<i:(o&pN)*Math.pow(2,i),i+=7}while(o>=uae);return o7.bytes=s-n,t}var dae=Math.pow(2,7),hae=Math.pow(2,14),fae=Math.pow(2,21),pae=Math.pow(2,28),gae=Math.pow(2,35),yae=Math.pow(2,42),mae=Math.pow(2,49),wae=Math.pow(2,56),bae=Math.pow(2,63),vae=function(r){return r<dae?1:r<hae?2:r<fae?3:r<pae?4:r<gae?5:r<yae?6:r<mae?7:r<wae?8:r<bae?9:10},Eae={encode:oae,decode:lae,encodingLength:vae},Oy=Eae;function a7(r,e=0){return[Oy.decode(r,e),Oy.decode.bytes]}function Ry(r,e,t=0){return Oy.encode(r,e,t),e}function Ly(r){return Oy.encodingLength(r)}function c7(r,e){const t=e.byteLength,n=Ly(r),i=n+Ly(t),s=new Uint8Array(i+t);return Ry(r,s,0),Ry(t,s,n),s.set(e,i),new l7(r,t,e,s)}function Sae(r){const e=i7(r),[t,n]=a7(e),[i,s]=a7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new l7(t,i,o,e)}function xae(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Joe(r.bytes,t.bytes)}}let l7=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function gN(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Cae(t,u7(r),e??fc.encoder);default:return Iae(t,u7(r),e??My.encoder)}}const yN=new WeakMap;function u7(r){const e=yN.get(r);if(e==null){const t=new Map;return yN.set(r,t),t}return e}let d7=class Gr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,$j,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==F1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==kae)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Gr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=c7(e,t);return Gr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Gr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&xae(e.multihash,n.multihash)}toString(e){return gN(this,e)}toJSON(){return{"/":gN(this)}}link(){return this}[($j=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Gr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Gr(n,i,s,o??mN(n,i,s.bytes))}else if(t[_ae]===!0){const{version:n,multihash:i,code:s}=t,o=Sae(i);return Gr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==F1)throw new Error(`Version 0 CID must use dag-pb (code: ${F1}) block encoding`);return new Gr(e,t,n,n.bytes)}case 1:{const i=mN(e,t,n.bytes);return new Gr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Gr.create(0,F1,e)}static createV1(e,t){return Gr.create(1,e,t)}static decode(e){const[t,n]=Gr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Gr.inspectBytes(e),n=t.size-t.multihashSize,i=i7(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new l7(t.multihashCode,t.digestSize,s,i);return[t.version===0?Gr.createV0(o):Gr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=a7(e.subarray(t));return t+=p,h};let i=n(),s=F1;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Aae(e,t),s=Gr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return u7(s).set(n,e),s}};function Aae(r,e){switch(r[0]){case"Q":{const t=e??fc;return[fc.prefix,t.decode(`${fc.prefix}${r}`)]}case fc.prefix:{const t=e??fc;return[fc.prefix,t.decode(r)]}case My.prefix:{const t=e??My;return[My.prefix,t.decode(r)]}case s7.prefix:{const t=e??s7;return[s7.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Cae(r,e,t){const{prefix:n}=t;if(n!==fc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Iae(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const F1=112,kae=18;function mN(r,e,t){const n=Ly(r),i=n+Ly(e),s=new Uint8Array(i+t.byteLength);return Ry(r,s,0),Ry(e,s,n),s.set(t,i),s}const _ae=Symbol.for("@ipld/js-cid/CID"),h7=ri({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});ri({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ri({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ri({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});class z1{constructor(e=!1,t=0){u(this,"full");u(this,"pendingBytes");u(this,"wantlist");u(this,"blocks");u(this,"blockPresences");this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}addWantlistEntry(e,t){const n=h7.encode(e.multihash.bytes);this.wantlist.set(n,t)}addBlockPresence(e,t){const n=h7.encode(e.multihash.bytes);this.blockPresences.set(n,t)}addBlock(e,t){const n=h7.encode(e.multihash.bytes);this.blocks.set(n,t)}}function Tae(r){let e=new Uint8Array(r.reduce((n,i)=>n+yt(i),0)),t=0;for(const n of r)e=Sr(n,e,t),t+=yt(n);return e}function wN(r){return Tae([r.version,r.code,r.multihash.code,r.multihash.digest.byteLength])}class Pae{constructor(e,t){u(this,"peerId");u(this,"blockstore");u(this,"network");u(this,"wants");u(this,"exchangeCount");u(this,"bytesSent");u(this,"bytesReceived");u(this,"lastExchange");u(this,"maxSizeReplaceHasWithBlock");u(this,"log");this.peerId=e.peerId,this.blockstore=e.blockstore,this.network=e.network,this.wants=new Map,this.log=e.logger.forComponent(`helia:bitswap:ledger:${e.peerId}`),this.exchangeCount=0,this.bytesSent=0,this.bytesReceived=0,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock??ese}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesReceived+=e}debtRatio(){return this.bytesSent/(this.bytesReceived+1)}async sendBlocksToPeer(e){const t=new z1,n=new Set;for(const[i,s]of this.wants.entries())try{const o=await this.blockstore.get(s.cid,e);s.wantType===pr.WantHave?o.byteLength<this.maxSizeReplaceHasWithBlock?(this.log("sending have and block for %c",s.cid),n.add(i),t.addBlock(s.cid,{data:o,prefix:wN(s.cid)})):(this.log("sending have for %c",s.cid),t.addBlockPresence(s.cid,{cid:s.cid.bytes,type:Fs.HaveBlock})):(this.log("sending block for %c",s.cid),n.add(i),t.addBlock(s.cid,{data:o,prefix:wN(s.cid)}))}catch(o){if(o.name!=="NotFoundError")throw o;if(this.log("do not have block for %c",s.cid),!s.sendDontHave||s.sentDoNotHave===!0)continue;s.sentDoNotHave=!0,t.addBlockPresence(s.cid,{cid:s.cid.bytes,type:Fs.DoNotHaveBlock})}if(t.blocks.size>0||t.blockPresences.size>0){this.log("sending message"),await this.network.sendMessage(this.peerId,t,e),this.log("sent message"),this.sentBytes([...t.blocks.values()].reduce((i,s)=>i+s.data.byteLength,0));for(const i of n)this.wants.delete(i)}}}class Dae{constructor(e,t={}){u(this,"blockstore");u(this,"network");u(this,"ledgerMap");u(this,"maxSizeReplaceHasWithBlock");u(this,"log");u(this,"logger");this.blockstore=e.blockstore,this.network=e.network,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock,this.log=e.logger.forComponent("helia:bitswap:peer-want-lists"),this.logger=e.logger,this.ledgerMap=lN({name:"helia_bitswap_ledger_map",metrics:e.metrics}),this.network.addEventListener("bitswap:message",n=>{this.receiveMessage(n.detail.peer,n.detail.message).catch(i=>{this.log.error("error receiving bitswap message from %p",n.detail.peer,i)})}),this.network.addEventListener("peer:disconnected",n=>{this.peerDisconnected(n.detail)})}ledgerForPeer(e){const t=this.ledgerMap.get(e);if(t!=null)return{peer:t.peerId,value:t.debtRatio(),sent:t.bytesSent,received:t.bytesReceived,exchanged:t.exchangeCount}}wantListForPeer(e){const t=this.ledgerMap.get(e);if(t!=null)return[...t.wants.values()]}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.peerId)}async receiveMessage(e,t){var i;let n=this.ledgerMap.get(e);if(n==null&&(n=new Pae({peerId:e,blockstore:this.blockstore,network:this.network,logger:this.logger},{maxSizeReplaceHasWithBlock:this.maxSizeReplaceHasWithBlock}),this.ledgerMap.set(e,n)),n.receivedBytes(((i=t.blocks)==null?void 0:i.reduce((s,o)=>s+o.data.byteLength,0))??0),t.wantlist!=null){t.wantlist.full===!0&&n.wants.clear();for(const s of t.wantlist.entries){const o=d7.decode(s.cid),a=re(o.multihash.bytes,"base64");s.cancel===!0?(this.log("peer %p cancelled want of block for %c",e,o),n.wants.delete(a)):(s.wantType===pr.WantHave?this.log("peer %p wanted block presence for %c",e,o):this.log("peer %p wanted block for %c",e,o),n.wants.set(a,{cid:o,priority:s.priority,wantType:s.wantType??pr.WantBlock,sendDontHave:s.sendDontHave??!1}))}}this.log("send blocks to peer"),await n.sendBlocksToPeer()}async receivedBlock(e,t){const n=re(e.multihash.bytes,"base64"),i=[];for(const s of this.ledgerMap.values())s.wants.has(n)&&i.push(s);await Promise.all(i.map(async s=>s.sendBlocksToPeer(t)))}peerDisconnected(e){this.ledgerMap.delete(e)}}function $ae(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Nae(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var Mae=Nae,Oae=Mae;let Rae=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Lae=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return bN(this,e)}},Bae=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return bN(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function bN(r,e){return new Bae({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Uae=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Rae(e,t,n),this.decoder=new Lae(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function vN({name:r,prefix:e,encode:t,decode:n}){return new Uae(r,e,t,n)}function EN({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Oae(t,r);return vN({prefix:e,name:r,encode:n,decode:s=>$ae(i(s))})}function Fae(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function zae(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function ni({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return vN({prefix:e,name:r,encode(i){return zae(i,n,t)},decode(i){return Fae(i,n,t,r)}})}const Vae=ni({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ni({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ni({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ni({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ni({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ni({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ni({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ni({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ni({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Kae=EN({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});EN({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const jae=ni({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});ni({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ni({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ni({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const Kd=1e3,jd=Kd*60,Hd=jd*60,Kl=Hd*24,Hae=Kl*7,qae=Kl*365.25;function SN(r,e){try{if(typeof r=="string"&&r.length>0)return Wae(r);if(typeof r=="number"&&isFinite(r))return e!=null&&e.long?Qae(r):Gae(r);throw new Error("Value is not a string or number.")}catch(t){const n=Jae(t)?`${t.message}. value=${JSON.stringify(r)}`:"An unknown error has occured.";throw new Error(n)}}function Wae(r){if(r=String(r),r.length>100)throw new Error("Value exceeds the maximum length of 100 characters.");const e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!e)return NaN;const t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*qae;case"weeks":case"week":case"w":return t*Hae;case"days":case"day":case"d":return t*Kl;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Hd;case"minutes":case"minute":case"mins":case"min":case"m":return t*jd;case"seconds":case"second":case"secs":case"sec":case"s":return t*Kd;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:throw new Error(`The unit ${n} was matched, but no matching case exists.`)}}function Gae(r){const e=Math.abs(r);return e>=Kl?`${Math.round(r/Kl)}d`:e>=Hd?`${Math.round(r/Hd)}h`:e>=jd?`${Math.round(r/jd)}m`:e>=Kd?`${Math.round(r/Kd)}s`:`${r}ms`}function Qae(r){const e=Math.abs(r);return e>=Kl?By(r,e,Kl,"day"):e>=Hd?By(r,e,Hd,"hour"):e>=jd?By(r,e,jd,"minute"):e>=Kd?By(r,e,Kd,"second"):`${r} ms`}function By(r,e,t,n){const i=e>=t*1.5;return`${Math.round(r/t)} ${n}${i?"s":""}`}function Jae(r){return typeof r=="object"&&r!==null&&"message"in r}function Yae(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=i,t.enabled=o,t.humanize=SN,t.destroy=l,Object.keys(r).forEach(d=>{t[d]=r[d]}),t.names=[],t.skips=[],t.formatters={};function e(d){let h=0;for(let p=0;p<d.length;p++)h=(h<<5)-h+d.charCodeAt(p),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=e;function t(d){let h,p=null,b,f;function g(...v){if(!g.enabled)return;const y=g,w=Number(new Date),m=w-(h||w);y.diff=m,y.prev=h,y.curr=w,h=w,v[0]=t.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let E=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(k,x)=>{if(k==="%%")return"%";E++;const I=t.formatters[x];if(typeof I=="function"){const T=v[E];k=I.call(y,T),v.splice(E,1),E--}return k}),t.formatArgs.call(y,v),(y.log||t.log).apply(y,v)}return g.namespace=d,g.useColors=t.useColors(),g.color=t.selectColor(d),g.extend=n,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(b!==t.namespaces&&(b=t.namespaces,f=t.enabled(d)),f),set:v=>{p=v}}),typeof t.init=="function"&&t.init(g),g}function n(d,h){const p=t(this.namespace+(typeof h>"u"?":":h)+d);return p.log=this.log,p}function i(d){t.save(d),t.namespaces=d,t.names=[],t.skips=[];let h;const p=(typeof d=="string"?d:"").split(/[\s,]+/),b=p.length;for(h=0;h<b;h++)p[h]&&(d=p[h].replace(/\*/g,".*?"),d[0]==="-"?t.skips.push(new RegExp("^"+d.substr(1)+"$")):t.names.push(new RegExp("^"+d+"$")))}function s(){const d=[...t.names.map(a),...t.skips.map(a).map(h=>"-"+h)].join(",");return t.enable(""),d}function o(d){if(d[d.length-1]==="*")return!0;let h,p;for(h=0,p=t.skips.length;h<p;h++)if(t.skips[h].test(d))return!1;for(h=0,p=t.names.length;h<p;h++)if(t.names[h].test(d))return!0;return!1}function a(d){return d.toString().substring(2,d.toString().length-2).replace(/\.\*\?$/,"*")}function c(d){return d instanceof Error?d.stack??d.message:d}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.setupFormatters(t.formatters),t.enable(t.load()),t}var Xae={};const Vs=sce(),Zae=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function ece(){var r,e,t,n,i;return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&((r=navigator.userAgent)==null?void 0:r.toLowerCase().match(/(edge|trident)\/(\d+)/))!=null?!1:typeof document<"u"&&((t=(e=document.documentElement)==null?void 0:e.style)==null?void 0:t.WebkitAppearance)||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&((n=navigator.userAgent)==null?void 0:n.toLowerCase().match(/firefox\/(\d+)/))!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&((i=navigator.userAgent)==null?void 0:i.toLowerCase().match(/applewebkit\/(\d+)/))}function tce(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+SN(this.diff),!this.useColors)return;const e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}const rce=console.debug??console.log??(()=>{});function nce(r){try{r?Vs==null||Vs.setItem("debug",r):Vs==null||Vs.removeItem("debug")}catch{}}function ice(){let r;try{r=Vs==null?void 0:Vs.getItem("debug")}catch{}return!r&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(r=Xae.DEBUG),r}function sce(){try{return localStorage}catch{}}function oce(r){r.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}const ii=Yae({formatArgs:tce,save:nce,load:ice,useColors:ece,setupFormatters:oce,colors:Zae,storage:Vs,log:rce});ii.formatters.b=r=>r==null?"undefined":Kae.baseEncode(r),ii.formatters.t=r=>r==null?"undefined":Vae.baseEncode(r),ii.formatters.m=r=>r==null?"undefined":jae.baseEncode(r),ii.formatters.p=r=>r==null?"undefined":r.toString(),ii.formatters.c=r=>r==null?"undefined":r.toString(),ii.formatters.k=r=>r==null?"undefined":r.toString(),ii.formatters.a=r=>r==null?"undefined":r.toString(),ii.formatters.e=r=>r==null?"undefined":xN(r.stack)??xN(r.message)??r.toString();function ace(r){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function Uy(){return{forComponent(r){return qd(r)}}}function qd(r){let e=ace(`${r}:trace`);return ii.enabled(`${r}:trace`)&&ii.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=ii(`${r}:trace`)),Object.assign(ii(r),{error:ii(`${r}:error`),trace:e})}function xN(r){if(r!=null&&(r=r.trim(),r.length!==0))return r}function AN(r){const e=[pc.A];return r==null?e:Array.isArray(r)?r.length===0?e:r:[r]}const CN=60;function IN(r){return{Status:r.Status??0,TC:r.TC??r.flag_tc??!1,RD:r.RD??r.flag_rd??!1,RA:r.RA??r.flag_ra??!1,AD:r.AD??r.flag_ad??!1,CD:r.CD??r.flag_cd??!1,Question:(r.Question??r.questions??[]).map(e=>({name:e.name,type:pc[e.type]})),Answer:(r.Answer??r.answers??[]).map(e=>({name:e.name,type:pc[e.type],TTL:e.TTL??e.ttl??CN,data:e.data instanceof Uint8Array?re(e.data):e.data}))}}const cce=4;function kN(r,e={}){const t=new Ma({concurrency:e.queryConcurrency??cce});return async(n,i={})=>{var a;const s=new URLSearchParams;s.set("name",n),AN(i.types).forEach(c=>{s.append("type",pc[c])}),(a=i.onProgress)==null||a.call(i,new _e("dns:query",{detail:n}));const o=await t.add(async()=>{var d;const c=await fetch(`${r}?${s}`,{headers:{accept:"application/dns-json"},signal:i==null?void 0:i.signal});if(c.status!==200)throw new Error(`Unexpected HTTP status: ${c.status} - ${c.statusText}`);const l=IN(await c.json());return(d=i.onProgress)==null||d.call(i,new _e("dns:response",{detail:l})),l},{signal:i.signal});if(o==null)throw new Error("No DNS response received");return o}}function lce(){return[kN("https://cloudflare-dns.com/dns-query"),kN("https://dns.google/resolve")]}var uce=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),n=Object.create(null);function i(s,o){t[s]=o,e++,e>=r&&(e=0,n=t,t=Object.create(null))}return{has:function(s){return t[s]!==void 0||n[s]!==void 0},remove:function(s){t[s]!==void 0&&(t[s]=void 0),n[s]!==void 0&&(n[s]=void 0)},get:function(s){var o=t[s];if(o!==void 0)return o;if((o=n[s])!==void 0)return i(s,o),o},set:function(s,o){t[s]!==void 0?t[s]=o:i(s,o)},clear:function(){t=Object.create(null),n=Object.create(null)}}};const dce=Xe(uce);class hce{constructor(e){u(this,"lru");this.lru=dce(e)}get(e,t){let n=!0;const i=[];for(const s of t){const o=this.getAnswers(e,s);if(o.length===0){n=!1;break}i.push(...o)}if(n)return IN({answers:i})}getAnswers(e,t){const n=`${e.toLowerCase()}-${t}`,i=this.lru.get(n);if(i!=null){const s=i.filter(o=>o.expires>Date.now()).map(({expires:o,value:a})=>({...a,TTL:Math.round((o-Date.now())/1e3),type:pc[a.type]}));return s.length===0&&this.lru.remove(n),s}return[]}add(e,t){const n=`${e.toLowerCase()}-${t.type}`,i=this.lru.get(n)??[];i.push({expires:Date.now()+(t.TTL??CN)*1e3,value:t}),this.lru.set(n,i)}remove(e,t){const n=`${e.toLowerCase()}-${t}`;this.lru.remove(n)}clear(){this.lru.clear()}}function fce(r){return new hce(r)}const pce=1e3;let gce=class{constructor(e){u(this,"resolvers");u(this,"cache");this.resolvers={},this.cache=fce(e.cacheSize??pce),Object.entries(e.resolvers??{}).forEach(([t,n])=>{Array.isArray(n)||(n=[n]),t.endsWith(".")||(t=`${t}.`),this.resolvers[t]=n}),this.resolvers["."]==null&&(this.resolvers["."]=lce())}async query(e,t={}){var c,l,d;const n=AN(t.types),i=t.cached!==!1?this.cache.get(e,n):void 0;if(i!=null)return(c=t.onProgress)==null||c.call(t,new _e("dns:cache",{detail:i})),i;const s=`${e.split(".").pop()}.`,o=(this.resolvers[s]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),a=[];for(const h of o){if(((l=t.signal)==null?void 0:l.aborted)===!0)break;try{const p=await h(e,{...t,types:n});for(const b of p.Answer)this.cache.add(e,b);return p}catch(p){a.push(p),(d=t.onProgress)==null||d.call(t,new _e("dns:error",{detail:p}))}}throw a.length===1?a[0]:new AggregateError(a,`DNS lookup of ${e} ${n} failed`)}};var pc;(function(r){r[r.A=1]="A",r[r.CNAME=5]="CNAME",r[r.TXT=16]="TXT",r[r.AAAA=28]="AAAA"})(pc||(pc={}));function _N(r={}){return new gce(r)}const Mo="/",TN=new TextEncoder().encode(Mo),Fy=TN[0];class At{constructor(e,t){u(this,"_buf");if(typeof e=="string")this._buf=oe(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==Fy)throw new Error("Invalid key")}toString(e="utf8"){return re(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new At(e.join(Mo))}static random(){return new At(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new At(e):typeof e.uint8Array=="function"?new At(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=TN),this._buf[0]!==Fy){const e=new Uint8Array(this._buf.byteLength+1);e.fill(Fy,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Fy;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;const s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return At.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Mo).slice(1)}type(){return yce(this.baseNamespace())}name(){return mce(this.baseNamespace())}instance(e){return new At(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Mo)||(e+=Mo),e+=this.type(),new At(e)}parent(){const e=this.list();return e.length===1?new At(Mo):new At(e.slice(0,-1).join(Mo))}child(e){return this.toString()===Mo?e:e.toString()===Mo?this:new At(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return At.withNamespaces([...this.namespaces(),...wce(e.map(t=>t.namespaces()))])}}function yce(r){const e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function mce(r){const e=r.split(":");return e[e.length-1]}function wce(r){return[].concat(...r)}function bce(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Wd(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function vce(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var Ece=vce,Sce=Ece;let xce=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Ace=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return PN(this,e)}},Cce=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return PN(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function PN(r,e){return new Cce({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Ice=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new xce(e,t,n),this.decoder=new Ace(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function DN({name:r,prefix:e,encode:t,decode:n}){return new Ice(r,e,t,n)}function zy({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Sce(t,r);return DN({prefix:e,name:r,encode:n,decode:s=>Wd(i(s))})}function kce(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function _ce(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function si({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return DN({prefix:e,name:r,encode(i){return _ce(i,n,t)},decode(i){return kce(i,n,t,r)}})}const Gd=zy({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});zy({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Vy=si({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});si({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),si({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),si({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),si({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),si({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),si({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),si({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),si({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const gc=zy({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});zy({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Tce=NN,$N=128,Pce=-128,Dce=Math.pow(2,31);function NN(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Dce;)e[t++]=r&255|$N,r/=128;for(;r&Pce;)e[t++]=r&255|$N,r>>>=7;return e[t]=r|0,NN.bytes=t-n+1,e}var $ce=f7,Nce=128,MN=127;function f7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw f7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&MN)<<i:(o&MN)*Math.pow(2,i),i+=7}while(o>=Nce);return f7.bytes=s-n,t}var Mce=Math.pow(2,7),Oce=Math.pow(2,14),Rce=Math.pow(2,21),Lce=Math.pow(2,28),Bce=Math.pow(2,35),Uce=Math.pow(2,42),Fce=Math.pow(2,49),zce=Math.pow(2,56),Vce=Math.pow(2,63),Kce=function(r){return r<Mce?1:r<Oce?2:r<Rce?3:r<Lce?4:r<Bce?5:r<Uce?6:r<Fce?7:r<zce?8:r<Vce?9:10},jce={encode:Tce,decode:$ce,encodingLength:Kce},Ky=jce;function p7(r,e=0){return[Ky.decode(r,e),Ky.decode.bytes]}function jy(r,e,t=0){return Ky.encode(r,e,t),e}function Hy(r){return Ky.encodingLength(r)}function qy(r,e){const t=e.byteLength,n=Hy(r),i=n+Hy(t),s=new Uint8Array(i+t);return jy(r,s,0),jy(t,s,n),s.set(e,i),new g7(r,t,e,s)}function Hce(r){const e=Wd(r),[t,n]=p7(e),[i,s]=p7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new g7(t,i,o,e)}function qce(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&bce(r.bytes,t.bytes)}}let g7=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function ON(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Gce(t,y7(r),e??gc.encoder);default:return Qce(t,y7(r),e??Vy.encoder)}}const RN=new WeakMap;function y7(r){const e=RN.get(r);if(e==null){const t=new Map;return RN.set(r,t),t}return e}let jl=class Qr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Nj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==V1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Jce)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Qr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=qy(e,t);return Qr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Qr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&qce(e.multihash,n.multihash)}toString(e){return ON(this,e)}toJSON(){return{"/":ON(this)}}link(){return this}[(Nj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Qr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Qr(n,i,s,o??LN(n,i,s.bytes))}else if(t[Yce]===!0){const{version:n,multihash:i,code:s}=t,o=Hce(i);return Qr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==V1)throw new Error(`Version 0 CID must use dag-pb (code: ${V1}) block encoding`);return new Qr(e,t,n,n.bytes)}case 1:{const i=LN(e,t,n.bytes);return new Qr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Qr.create(0,V1,e)}static createV1(e,t){return Qr.create(1,e,t)}static decode(e){const[t,n]=Qr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Qr.inspectBytes(e),n=t.size-t.multihashSize,i=Wd(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new g7(t.multihashCode,t.digestSize,s,i);return[t.version===0?Qr.createV0(o):Qr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=p7(e.subarray(t));return t+=p,h};let i=n(),s=V1;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Wce(e,t),s=Qr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return y7(s).set(n,e),s}};function Wce(r,e){switch(r[0]){case"Q":{const t=e??gc;return[gc.prefix,t.decode(`${gc.prefix}${r}`)]}case gc.prefix:{const t=e??gc;return[gc.prefix,t.decode(r)]}case Vy.prefix:{const t=e??Vy;return[Vy.prefix,t.decode(r)]}case Gd.prefix:{const t=e??Gd;return[Gd.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Gce(r,e,t){const{prefix:n}=t;if(n!==gc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Qce(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const V1=112,Jce=18;function LN(r,e,t){const n=Hy(r),i=n+Hy(e),s=new Uint8Array(i+t.byteLength);return jy(r,s,0),jy(e,s,n),s.set(t,i),s}const Yce=Symbol.for("@ipld/js-cid/CID");function BN({name:r,code:e,encode:t}){return new Xce(r,e,t)}let Xce=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?qy(this.code,t):t.then(n=>qy(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Wy({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*Zce(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t],s=jl.asCID(n);s!=null?yield[i.join("/"),s]:typeof n=="object"&&(yield*m7(n,i))}else{const t=jl.asCID(e);t!=null?yield[r.join("/"),t]:yield*m7(e,r)}}function*m7(r,e){if(r==null||r instanceof Uint8Array)return;const t=jl.asCID(r);t!=null&&(yield[e.join("/"),t]);for(const[n,i]of Object.entries(r)){const s=[...e,n];yield*Zce(s,i)}}function*ele(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t];yield i.join("/"),typeof n=="object"&&jl.asCID(n)==null&&(yield*w7(n,i))}else yield*w7(e,r)}function*w7(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const i=[...e,t];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&jl.asCID(n)==null&&(yield*ele(i,n))}}function tle(r,e){let t=r;for(const[n,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);const s=jl.asCID(t);if(s!=null)return{value:s,remaining:e.slice(n+1).join("/")}}return{value:t}}class rle{constructor({cid:e,bytes:t,value:n}){u(this,"cid");u(this,"bytes");u(this,"value");u(this,"asBlock");if(e==null||t==null||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:Wy(),bytes:Wy(),value:Wy(),asBlock:Wy()})}links(){return m7(this.value,[])}tree(){return w7(this.value,[])}get(e="/"){return tle(this.value,e.split("/").filter(Boolean))}}function nle({bytes:r,cid:e,value:t,codec:n}){const i=t!==void 0?t:n==null?void 0:n.decode(r);if(i===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new rle({cid:e,bytes:r,value:i})}const UN="/pin/",FN="/pinned-block/",b7=Gd,zN=1;function Gy(r){return r.version===0&&(r=r.toV1()),new At(`${UN}${r.toString(b7)}`)}class ile{constructor(e,t,n){Ye(this,da);u(this,"datastore");u(this,"blockstore");u(this,"getCodec");this.datastore=e,this.blockstore=t,this.getCodec=n}async*add(e,t={}){const n=Gy(e);if(await this.datastore.has(n))throw new Error("Already pinned");const i=Math.round(t.depth??1/0);if(i<0)throw new Error("Depth must be greater than or equal to 0");const s=new Ul({concurrency:zN});for await(const a of Ie(this,da,G4).call(this,e,s,{...t,depth:i}))await Ie(this,da,WA).call(this,a,c=>c.pinnedBy.find(l=>We(l,e.bytes))!=null?!1:(c.pinCount++,c.pinnedBy.push(e.bytes),!0),t),yield a;const o={depth:i,metadata:t.metadata??{}};await this.datastore.put(n,Zg(o),t)}async*rm(e,t={}){const n=Gy(e),i=await this.datastore.get(n,t),s=Ua(i);await this.datastore.delete(n,t);const o=new Ul({concurrency:zN});for await(const a of Ie(this,da,G4).call(this,e,o,{...t,depth:s.depth}))await Ie(this,da,WA).call(this,a,c=>(c.pinCount--,c.pinnedBy=c.pinnedBy.filter(l=>We(l,e.bytes)),!0),{...t,depth:s.depth}),yield a}async*ls(e={}){for await(const{key:t,value:n}of this.datastore.query({prefix:UN+(e.cid!=null?`${e.cid.toString(Gd)}`:"")},e)){const i=jl.parse(t.toString().substring(5),Gd),s=Ua(n);yield{cid:i,...s}}}async isPinned(e,t={}){const n=new At(`${FN}${b7.encode(e.multihash.bytes)}`);return this.datastore.has(n,t)}async get(e,t){const n=Gy(e),i=await this.datastore.get(n,t);return Ua(i)}async setMetadata(e,t,n){const i=Gy(e),s=await this.datastore.get(i,n),o=Ua(s);o.metadata=t??{},await this.datastore.put(i,Zg(o),n)}}da=new WeakSet,G4=async function*(e,t,n){if(n.depth===-1)return;const i=await this.getCodec(e.code),s=await this.blockstore.get(e,n),o=nle({bytes:s,cid:e,codec:i});yield e;for await(const[,a]of o.links())yield*await t.add(async()=>Ie(this,da,G4).call(this,a,t,{...n,depth:n.depth-1}))},WA=async function(e,t,n){var a;const i=new At(`${FN}${b7.encode(e.multihash.bytes)}`);let s={pinCount:0,pinnedBy:[]};try{s=Ua(await this.datastore.get(i,n))}catch(c){if(c.name!=="NotFoundError")throw c}if(t(s)){if(s.pinCount===0&&await this.datastore.has(i)){await this.datastore.delete(i);return}await this.datastore.put(i,Zg(s),n),(a=n.onProgress)==null||a.call(n,new _e("helia:pin:add",e))}};const sle=1,ole=5;class VN extends Error{constructor(e="Insufficient providers found"){super(e),this.name="InsufficientProvidersError"}}u(VN,"name","InsufficientProvidersError");class K1 extends Error{constructor(e="No routers available"){super(e),this.name="NoRoutersAvailableError"}}u(K1,"name","NoRoutersAvailableError");class KN extends Error{constructor(e="Unknown hash algorithm"){super(e),this.name="UnknownHashAlgorithmError"}}u(KN,"name","UnknownHashAlgorithmError");class jN extends Error{constructor(e="Unknown codec"){super(e),this.name="UnknownCodecError"}}u(jN,"name","UnknownCodecError");const ale=5;class cle{constructor(e,t){u(this,"log");u(this,"routers");u(this,"providerLookupConcurrency");var n,i,s,o,a,c,l;this.log=e.logger.forComponent("helia:routing"),this.routers=t.routers??[],this.providerLookupConcurrency=t.providerLookupConcurrency??ale,this.findProviders=((n=e.metrics)==null?void 0:n.traceFunction("helia.routing.findProviders",this.findProviders.bind(this),{optionsIndex:1}))??this.findProviders,this.provide=((i=e.metrics)==null?void 0:i.traceFunction("helia.routing.provide",this.provide.bind(this),{optionsIndex:1}))??this.provide,this.cancelReprovide=((s=e.metrics)==null?void 0:s.traceFunction("helia.routing.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1}))??this.cancelReprovide,this.put=((o=e.metrics)==null?void 0:o.traceFunction("helia.routing.put",this.put.bind(this),{optionsIndex:2}))??this.put,this.get=((a=e.metrics)==null?void 0:a.traceFunction("helia.routing.get",this.get.bind(this),{optionsIndex:1}))??this.get,this.findPeer=((c=e.metrics)==null?void 0:c.traceFunction("helia.routing.findPeer",this.findPeer.bind(this),{optionsIndex:1}))??this.findPeer,this.getClosestPeers=((l=e.metrics)==null?void 0:l.traceFunction("helia.routing.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1}))??this.getClosestPeers}async start(){await Io(...this.routers)}async stop(){await Qa(...this.routers)}async*findProviders(e,t={}){if(this.routers.length===0)throw new K1("No content routers available");const n=new uc({concurrency:this.providerLookupConcurrency});n.addEventListener("error",()=>{});for await(const i of Oa(n.toGenerator(),...Hl(this.routers,"findProviders").map(s=>s.findProviders(e,t))))if(i!=null){if(i.multiaddrs.length===0){if(n.find(i.id)!=null)continue;n.add(async()=>{try{const s=await this.findPeer(i.id,t);return s.multiaddrs.length===0?null:s}catch(s){return this.log.error("could not load multiaddrs for peer %p",i.id,s),null}},{peerId:i.id,signal:t.signal}).catch(s=>{this.log.error("could not load multiaddrs for peer %p",i.id,s)})}yield i}}async provide(e,t={}){if(this.routers.length===0)throw new K1("No content routers available");await Promise.all(Hl(this.routers,"provide").map(async n=>{await n.provide(e,t)}))}async cancelReprovide(e,t={}){await Promise.all(Hl(this.routers,"cancelReprovide").map(async n=>{await n.cancelReprovide(e,t)}))}async put(e,t,n){await Promise.all(Hl(this.routers,"put").map(async i=>{await i.put(e,t,n)}))}async get(e,t){return Promise.any(Hl(this.routers,"get").map(async n=>n.get(e,t)))}async findPeer(e,t){if(this.routers.length===0)throw new K1("No peer routers available");const n=this,i=Oa(...Hl(this.routers,"findPeer").map(s=>async function*(){try{yield await s.findPeer(e,t)}catch(o){n.log.error(o)}}()));for await(const s of i)if(s!=null)return s;throw new Zt("Could not find peer in routing")}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new K1("No peer routers available");for await(const n of Oa(...Hl(this.routers,"getClosestPeers").map(i=>i.getClosestPeers(e,t))))n!=null&&(yield n)}}function Hl(r,e){return r.filter(t=>t[e]!=null)}const yc={},ql=r=>{r.addEventListener("message",e=>{ql.dispatchEvent("message",r,e)}),r.port!=null&&r.port.addEventListener("message",e=>{ql.dispatchEvent("message",r,e)})};ql.addEventListener=(r,e)=>{yc[r]==null&&(yc[r]=[]),yc[r].push(e)},ql.removeEventListener=(r,e)=>{yc[r]!=null&&(yc[r]=yc[r].filter(t=>t===e))},ql.dispatchEvent=function(r,e,t){yc[r]!=null&&yc[r].forEach(n=>n(e,t))};const HN="lock:worker:request-read",qN="lock:worker:release-read",WN="lock:master:grant-read",GN="lock:worker:request-write",QN="lock:worker:release-write",JN="lock:master:grant-write",lle=(r=21)=>Math.random().toString().substring(2),YN=(r,e,t,n,i)=>(s,o)=>{if(o.data.type!==t)return;const a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};r.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>{s.postMessage({type:i,name:a.name,identifier:a.identifier}),await new Promise(c=>{const l=d=>{if((d==null?void 0:d.data)==null)return;const h={type:d.data.type,name:d.data.name,identifier:d.data.identifier};h.type===n&&h.identifier===a.identifier&&(s.removeEventListener("message",l),c())};s.addEventListener("message",l)})}}}))},XN=(r,e,t,n)=>async()=>{const i=lle();return globalThis.postMessage({type:e,identifier:i,name:r}),new Promise(s=>{const o=a=>{if((a==null?void 0:a.data)==null)return;const c={type:a.data.type,identifier:a.data.identifier};c.type===t&&c.identifier===i&&(globalThis.removeEventListener("message",o),s(()=>{globalThis.postMessage({type:n,identifier:i,name:r})}))};globalThis.addEventListener("message",o)})},ule={singleProcess:!1},dle=r=>{if(r=Object.assign({},ule,r),!!globalThis.document||r.singleProcess){const t=new EventTarget;return ql.addEventListener("message",YN(t,"requestReadLock",HN,qN,WN)),ql.addEventListener("message",YN(t,"requestWriteLock",GN,QN,JN)),t}return{isWorker:!0,readLock:t=>XN(t,HN,WN,qN),writeLock:t=>XN(t,GN,JN,QN)}},Wl={};let mc;async function v7(r,e){let t;const n=new Promise(i=>{t=i});return r.add(async()=>Wf((async()=>{await new Promise(i=>{t(()=>{i()})})})(),{milliseconds:e.timeout})),n}const hle=(r,e)=>{if(mc.isWorker===!0)return{readLock:mc.readLock(r,e),writeLock:mc.writeLock(r,e)};const t=new Ma({concurrency:1});let n;return{async readLock(){if(n!=null)return v7(n,e);n=new Ma({concurrency:e.concurrency,autoStart:!1});const i=n,s=v7(n,e);return t.add(async()=>{i.start(),await i.onIdle().then(()=>{n===i&&(n=null)})}),s},async writeLock(){return n=null,v7(t,e)}}},fle={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function E7(r){const e=Object.assign({},fle,r);return mc==null&&(mc=dle(e),mc.isWorker!==!0&&(mc.addEventListener("requestReadLock",t=>{Wl[t.data.name]!=null&&Wl[t.data.name].readLock().then(async n=>t.data.handler().finally(()=>{n()}))}),mc.addEventListener("requestWriteLock",async t=>{Wl[t.data.name]!=null&&Wl[t.data.name].writeLock().then(async n=>t.data.handler().finally(()=>{n()}))}))),Wl[e.name]==null&&(Wl[e.name]=hle(e.name,e)),Wl[e.name]}class ple{constructor(e,t,n={}){u(this,"lock");u(this,"child");u(this,"pins");u(this,"started");this.child=e,this.pins=t,this.lock=E7({singleProcess:n.holdGcLock}),this.started=!1}isStarted(){return this.started}async start(){await Io(this.child),this.started=!0}async stop(){await Qa(this.child),this.started=!1}unwrap(){return this.child}async put(e,t,n={}){var s;(s=n==null?void 0:n.signal)==null||s.throwIfAborted();const i=await this.lock.readLock();try{return await this.child.put(e,t,n)}finally{i()}}async*putMany(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.putMany(e,t)}finally{n()}}async get(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{return await this.child.get(e,t)}finally{n()}}async*getMany(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.getMany(e,t)}finally{n()}}async delete(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.writeLock();try{if(await this.pins.isPinned(e))throw new Error("CID was pinned");await this.child.delete(e,t)}finally{n()}}async*deleteMany(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.writeLock();try{const s=this;yield*this.child.deleteMany(async function*(){for await(const o of e){if(await s.pins.isPinned(o))throw new Error("CID was pinned");yield o}}(),t)}finally{n()}}async has(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{return await this.child.has(e,t)}finally{n()}}async*getAll(e={}){var n;(n=e==null?void 0:e.signal)==null||n.throwIfAborted();const t=await this.lock.readLock();try{yield*this.child.getAll(e)}finally{t()}}createSession(e,t){var n;return(n=t==null?void 0:t.signal)==null||n.throwIfAborted(),this.child.createSession(e,t)}}const S7=new At("/version"),ZN=1;async function gle(r){if(!await r.has(S7)){await r.put(S7,oe(`${ZN}`));return}const e=await r.get(S7),t=re(e);if(parseInt(t,10)!==ZN)throw new Error("Unknown datastore version, a datastore migration may be required")}class yle extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===V.array&&(t.elements++,t.elements!==1&&e.push([44])),t.type===V.map&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[V.uint.major](e,t){this.prefix(e);const n=String(t.value),i=[];for(let s=0;s<n.length;s++)i[s]=n.charCodeAt(s);e.push(i)}[V.negint.major](e,t){this[V.uint.major](e,t)}[V.bytes.major](e,t){throw new Error(`${ul} unsupported type: Uint8Array`)}[V.string.major](e,t){this.prefix(e);const n=q_(JSON.stringify(t.value));e.push(n.length>32?k6(n):n)}[V.array.major](e,t){this.prefix(e),this.inRecursive.push({type:V.array,elements:0}),e.push([91])}[V.map.major](e,t){this.prefix(e),this.inRecursive.push({type:V.map,elements:0}),e.push([123])}[V.tag.major](e,t){}[V.float.major](e,t){if(t.type.name==="break"){const o=this.inRecursive.pop();if(o){if(o.type===V.array)e.push([93]);else if(o.type===V.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${ul} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}const n=String(t.value),i=[];let s=!1;for(let o=0;o<n.length;o++)i[o]=n.charCodeAt(o),!s&&(i[o]===46||i[o]===101||i[o]===69)&&(s=!0);s||(i.push(46),i.push(48)),e.push(i)}}function mle(r,e){if(Array.isArray(r[0])||Array.isArray(e[0]))throw new Error(`${ul} complex map keys are not supported`);const t=r[0],n=e[0];if(t.type!==V.string||n.type!==V.string)throw new Error(`${ul} non-string map keys are not supported`);if(t<n)return-1;if(t>n)return 1;throw new Error(`${ul} unexpected duplicate map keys, this is not supported`)}const wle={addBreakTokens:!0,mapSorter:mle};function ble(r,e){return e=Object.assign({},wle,e),sT(r,new yle,e)}class eM{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error(`${ke} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw new Error(`${ke} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this._pos;let t=!1,n=!1;const i=a=>{for(;!this.done();){const c=this.ch();if(a.includes(c))this._pos++;else break}};if(this.ch()===45&&(t=!0,this._pos++),this.ch()===48)if(this._pos++,this.ch()===46)this._pos++,n=!0;else return new ie(V.uint,0,this._pos-e);if(i([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw new Error(`${ke} unexpected token at position ${this._pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${ke} unexpected token at position ${this._pos}`);n=!0,this._pos++,i([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this._pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this._pos++,i([48,49,50,51,52,53,54,55,56,57]));const s=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),o=parseFloat(s);return n?new ie(V.float,o,this._pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(o)?new ie(o>=0?V.uint:V.negint,o,this._pos-e):new ie(o>=0?V.uint:V.negint,BigInt(s),this._pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${ke} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let s=this._pos,o=0;s<this.data.length&&o<65536;s++,o++){const a=this.data[s];if(a===92||a<32||a>=128)break;if(a===34){const c=String.fromCharCode.apply(null,this.data.subarray(this._pos,s));return this._pos=s+1,new ie(V.string,c,o)}}const e=this._pos,t=[],n=()=>{if(this._pos+4>=this.data.length)throw new Error(`${ke} unexpected end of unicode escape sequence at position ${this._pos}`);let s=0;for(let o=0;o<4;o++){let a=this.ch();if(a>=48&&a<=57)a-=48;else if(a>=97&&a<=102)a=a-97+10;else if(a>=65&&a<=70)a=a-65+10;else throw new Error(`${ke} unexpected unicode escape character at position ${this._pos}`);s=s*16+a,this._pos++}return s},i=()=>{const s=this.ch();let o=null,a=s>239?4:s>223?3:s>191?2:1;if(this._pos+a>this.data.length)throw new Error(`${ke} unexpected unicode sequence at position ${this._pos}`);let c,l,d,h;switch(a){case 1:s<128&&(o=s);break;case 2:c=this.data[this._pos+1],(c&192)===128&&(h=(s&31)<<6|c&63,h>127&&(o=h));break;case 3:c=this.data[this._pos+1],l=this.data[this._pos+2],(c&192)===128&&(l&192)===128&&(h=(s&15)<<12|(c&63)<<6|l&63,h>2047&&(h<55296||h>57343)&&(o=h));break;case 4:c=this.data[this._pos+1],l=this.data[this._pos+2],d=this.data[this._pos+3],(c&192)===128&&(l&192)===128&&(d&192)===128&&(h=(s&15)<<18|(c&63)<<12|(l&63)<<6|d&63,h>65535&&h<1114112&&(o=h))}o===null?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|o&1023),t.push(o),this._pos+=a};for(;!this.done();){const s=this.ch();let o;switch(s){case 92:if(this._pos++,this.done())throw new Error(`${ke} unexpected string termination at position ${this._pos}`);switch(o=this.ch(),this._pos++,o){case 34:case 39:case 92:case 47:t.push(o);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${ke} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new ie(V.string,J_(t),this._pos-e);default:if(s<32)throw new Error(`${ke} invalid control character at position ${this._pos}`);s<128?(t.push(s),this._pos++):i()}}throw new Error(`${ke} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new ie(V.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new ie(V.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new ie(V.null,null,4);case 102:return this.expect([102,97,108,115,101]),new ie(V.false,!1,5);case 116:return this.expect([116,114,117,101]),new ie(V.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${ke} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this._pos++,this.skipWhitespace(),new ie(V.break,void 0,1);if(this.ch()!==44)throw new Error(`${ke} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this._pos++,this.skipWhitespace(),new ie(V.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new ie(V.break,void 0,1);if(this.ch()!==44)throw new Error(`${ke} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this._pos++,this.skipWhitespace(),new ie(V.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${ke} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${ke} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}}function vle(r,e){return e=Object.assign({tokenizer:new eM(r,e)},e),Ua(r,e)}function Ele(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function x7(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Sle(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var xle=Sle,Ale=xle;let Cle=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Ile=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return tM(this,e)}},kle=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return tM(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function tM(r,e){return new kle({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let _le=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Cle(e,t,n),this.decoder=new Ile(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function rM({name:r,prefix:e,encode:t,decode:n}){return new _le(r,e,t,n)}function Qy({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Ale(t,r);return rM({prefix:e,name:r,encode:n,decode:s=>x7(i(s))})}function Tle(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Ple(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function oi({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return rM({prefix:e,name:r,encode(i){return Ple(i,n,t)},decode(i){return Tle(i,n,t,r)}})}const Jy=oi({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});oi({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),oi({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),oi({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),oi({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),oi({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),oi({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),oi({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),oi({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const A7=Qy({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Qy({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const wc=Qy({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Qy({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Dle=iM,nM=128,$le=-128,Nle=Math.pow(2,31);function iM(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Nle;)e[t++]=r&255|nM,r/=128;for(;r&$le;)e[t++]=r&255|nM,r>>>=7;return e[t]=r|0,iM.bytes=t-n+1,e}var Mle=C7,Ole=128,sM=127;function C7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw C7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&sM)<<i:(o&sM)*Math.pow(2,i),i+=7}while(o>=Ole);return C7.bytes=s-n,t}var Rle=Math.pow(2,7),Lle=Math.pow(2,14),Ble=Math.pow(2,21),Ule=Math.pow(2,28),Fle=Math.pow(2,35),zle=Math.pow(2,42),Vle=Math.pow(2,49),Kle=Math.pow(2,56),jle=Math.pow(2,63),Hle=function(r){return r<Rle?1:r<Lle?2:r<Ble?3:r<Ule?4:r<Fle?5:r<zle?6:r<Vle?7:r<Kle?8:r<jle?9:10},qle={encode:Dle,decode:Mle,encodingLength:Hle},Yy=qle;function I7(r,e=0){return[Yy.decode(r,e),Yy.decode.bytes]}function Xy(r,e,t=0){return Yy.encode(r,e,t),e}function Zy(r){return Yy.encodingLength(r)}function Wle(r,e){const t=e.byteLength,n=Zy(r),i=n+Zy(t),s=new Uint8Array(i+t);return Xy(r,s,0),Xy(t,s,n),s.set(e,i),new k7(r,t,e,s)}function Gle(r){const e=x7(r),[t,n]=I7(e),[i,s]=I7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new k7(t,i,o,e)}function Qle(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Ele(r.bytes,t.bytes)}}let k7=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function oM(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Yle(t,_7(r),e??wc.encoder);default:return Xle(t,_7(r),e??Jy.encoder)}}const aM=new WeakMap;function _7(r){const e=aM.get(r);if(e==null){const t=new Map;return aM.set(r,t),t}return e}let cM=class Jr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Mj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==j1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Zle)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Jr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Wle(e,t);return Jr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Jr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Qle(e.multihash,n.multihash)}toString(e){return oM(this,e)}toJSON(){return{"/":oM(this)}}link(){return this}[(Mj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Jr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Jr(n,i,s,o??lM(n,i,s.bytes))}else if(t[eue]===!0){const{version:n,multihash:i,code:s}=t,o=Gle(i);return Jr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==j1)throw new Error(`Version 0 CID must use dag-pb (code: ${j1}) block encoding`);return new Jr(e,t,n,n.bytes)}case 1:{const i=lM(e,t,n.bytes);return new Jr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Jr.create(0,j1,e)}static createV1(e,t){return Jr.create(1,e,t)}static decode(e){const[t,n]=Jr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Jr.inspectBytes(e),n=t.size-t.multihashSize,i=x7(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new k7(t.multihashCode,t.digestSize,s,i);return[t.version===0?Jr.createV0(o):Jr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=I7(e.subarray(t));return t+=p,h};let i=n(),s=j1;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Jle(e,t),s=Jr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return _7(s).set(n,e),s}};function Jle(r,e){switch(r[0]){case"Q":{const t=e??wc;return[wc.prefix,t.decode(`${wc.prefix}${r}`)]}case wc.prefix:{const t=e??wc;return[wc.prefix,t.decode(r)]}case Jy.prefix:{const t=e??Jy;return[Jy.prefix,t.decode(r)]}case A7.prefix:{const t=e??A7;return[A7.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Yle(r,e,t){const{prefix:n}=t;if(n!==wc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Xle(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const j1=112,Zle=18;function lM(r,e,t){const n=Zy(r),i=n+Zy(e),s=new Uint8Array(i+t.byteLength);return Xy(r,s,0),Xy(e,s,n),s.set(t,i),s}const eue=Symbol.for("@ipld/js-cid/CID"),uM=oi({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});oi({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),oi({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),oi({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function tue(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function rue(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=cM.asCID(r);if(!e)return null;const t=e.toString();return[new ie(V.map,1/0,1),new ie(V.string,"/",1),new ie(V.string,t,t.length),new ie(V.break,void 0,1)]}function em(r){const e=uM.encode(r).slice(1);return[new ie(V.map,1/0,1),new ie(V.string,"/",1),new ie(V.map,1/0,1),new ie(V.string,"bytes",5),new ie(V.string,e,e.length),new ie(V.break,void 0,1),new ie(V.break,void 0,1)]}function ns(r){return em(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}function nue(r){return em(new Uint8Array(r))}function iue(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function sue(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const oue={typeEncoders:{Object:rue,Buffer:em,Uint8Array:em,Int8Array:ns,Uint16Array:ns,Int16Array:ns,Uint32Array:ns,Int32Array:ns,Float32Array:ns,Float64Array:ns,Uint8ClampedArray:ns,BigInt64Array:ns,BigUint64Array:ns,DataView:ns,ArrayBuffer:nue,undefined:iue,number:sue}};class aue extends eM{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(e.type===V.map){const t=this._next();if(t.type===V.string&&t.value==="/"){const n=this._next();if(n.type===V.string){if(this._next().type!==V.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new ie(V.tag,42,0)}if(n.type===V.map){const i=this._next();if(i.type===V.string&&i.value==="bytes"){const s=this._next();if(s.type===V.string){for(let a=0;a<2;a++)if(this._next().type!==V.break)throw new Error("Invalid encoded Bytes form");const o=uM.decode(`m${s.value}`);return new ie(V.bytes,o,s.value.length)}this.tokenBuffer.push(s)}this.tokenBuffer.push(i)}this.tokenBuffer.push(n)}this.tokenBuffer.push(t)}return e}}const T7={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};T7.tags[42]=cM.parse;const cue="dag-json",dM=297,hM=r=>ble(r,oue),fM=r=>{const e=tue(r),t=Object.assign(T7,{tokenizer:new aue(e,T7)});return vle(e,t)},pM=r=>lue.decode(hM(r)),lue=new TextDecoder,uue=r=>fM(due.encode(r)),due=new TextEncoder,hue=Object.freeze(Object.defineProperty({__proto__:null,code:dM,decode:fM,encode:hM,format:pM,name:cue,parse:uue,stringify:pM},Symbol.toStringTag,{value:"Module"}));function fue(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function P7(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function pue(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var gue=pue,yue=gue;let mue=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},wue=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return gM(this,e)}},bue=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return gM(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function gM(r,e){return new bue({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let vue=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new mue(e,t,n),this.decoder=new wue(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function yM({name:r,prefix:e,encode:t,decode:n}){return new vue(r,e,t,n)}function tm({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=yue(t,r);return yM({prefix:e,name:r,encode:n,decode:s=>P7(i(s))})}function Eue(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Sue(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Oo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return yM({prefix:e,name:r,encode(i){return Sue(i,n,t)},decode(i){return Eue(i,n,t,r)}})}const rm=Oo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Oo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Oo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Oo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Oo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Oo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Oo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Oo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Oo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const D7=tm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});tm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const bc=tm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});tm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var xue=wM,mM=128,Aue=-128,Cue=Math.pow(2,31);function wM(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Cue;)e[t++]=r&255|mM,r/=128;for(;r&Aue;)e[t++]=r&255|mM,r>>>=7;return e[t]=r|0,wM.bytes=t-n+1,e}var Iue=$7,kue=128,bM=127;function $7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw $7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&bM)<<i:(o&bM)*Math.pow(2,i),i+=7}while(o>=kue);return $7.bytes=s-n,t}var _ue=Math.pow(2,7),Tue=Math.pow(2,14),Pue=Math.pow(2,21),Due=Math.pow(2,28),$ue=Math.pow(2,35),Nue=Math.pow(2,42),Mue=Math.pow(2,49),Oue=Math.pow(2,56),Rue=Math.pow(2,63),Lue=function(r){return r<_ue?1:r<Tue?2:r<Pue?3:r<Due?4:r<$ue?5:r<Nue?6:r<Mue?7:r<Oue?8:r<Rue?9:10},Bue={encode:xue,decode:Iue,encodingLength:Lue},nm=Bue;function N7(r,e=0){return[nm.decode(r,e),nm.decode.bytes]}function im(r,e,t=0){return nm.encode(r,e,t),e}function sm(r){return nm.encodingLength(r)}function Uue(r,e){const t=e.byteLength,n=sm(r),i=n+sm(t),s=new Uint8Array(i+t);return im(r,s,0),im(t,s,n),s.set(e,i),new M7(r,t,e,s)}function Fue(r){const e=P7(r),[t,n]=N7(e),[i,s]=N7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new M7(t,i,o,e)}function zue(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&fue(r.bytes,t.bytes)}}let M7=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function vM(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Kue(t,O7(r),e??bc.encoder);default:return jue(t,O7(r),e??rm.encoder)}}const EM=new WeakMap;function O7(r){const e=EM.get(r);if(e==null){const t=new Map;return EM.set(r,t),t}return e}let H1=class Yr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Oj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==q1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Hue)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Yr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Uue(e,t);return Yr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Yr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&zue(e.multihash,n.multihash)}toString(e){return vM(this,e)}toJSON(){return{"/":vM(this)}}link(){return this}[(Oj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Yr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Yr(n,i,s,o??SM(n,i,s.bytes))}else if(t[que]===!0){const{version:n,multihash:i,code:s}=t,o=Fue(i);return Yr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==q1)throw new Error(`Version 0 CID must use dag-pb (code: ${q1}) block encoding`);return new Yr(e,t,n,n.bytes)}case 1:{const i=SM(e,t,n.bytes);return new Yr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Yr.create(0,q1,e)}static createV1(e,t){return Yr.create(1,e,t)}static decode(e){const[t,n]=Yr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Yr.inspectBytes(e),n=t.size-t.multihashSize,i=P7(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new M7(t.multihashCode,t.digestSize,s,i);return[t.version===0?Yr.createV0(o):Yr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=N7(e.subarray(t));return t+=p,h};let i=n(),s=q1;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Vue(e,t),s=Yr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return O7(s).set(n,e),s}};function Vue(r,e){switch(r[0]){case"Q":{const t=e??bc;return[bc.prefix,t.decode(`${bc.prefix}${r}`)]}case bc.prefix:{const t=e??bc;return[bc.prefix,t.decode(r)]}case rm.prefix:{const t=e??rm;return[rm.prefix,t.decode(r)]}case D7.prefix:{const t=e??D7;return[D7.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Kue(r,e,t){const{prefix:n}=t;if(n!==bc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function jue(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const q1=112,Hue=18;function SM(r,e,t){const n=sm(r),i=n+sm(e),s=new Uint8Array(i+t.byteLength);return im(r,s,0),im(e,s,n),s.set(t,i),s}const que=Symbol.for("@ipld/js-cid/CID"),Wue=new TextDecoder;function R7(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");const i=r[e++];if(t+=n<28?(i&127)<<n:(i&127)*2**n,i<128)break}return[t,e]}function om(r,e){let t;[t,e]=R7(r,e);const n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function xM(r,e){let t;return[t,e]=R7(r,e),[t&7,t>>3,e]}function Gue(r){const e={},t=r.length;let n=0;for(;n<t;){let i,s;if([i,s,n]=xM(r,n),s===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=om(r,n)}else if(s===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=om(r,n),e.Name=Wue.decode(o)}else if(s===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(i!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Tsize`);[e.Tsize,n]=R7(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${s}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function Que(r){const e=r.length;let t=0,n,i=!1,s;for(;t<e;){let a,c;if([a,c,t]=xM(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(s)throw new Error("protobuf: (PBNode) duplicate Data section");[s,t]=om(r,t),n&&(i=!0)}else if(c===2){if(i)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let l;[l,t]=om(r,t),n.push(Gue(l))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");const o={};return s&&(o.Data=s),o.Links=n||[],o}const AM=new TextEncoder,CM=2**32,Jue=2**31;function Yue(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=W1(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){const n=AM.encode(r.Name);t-=n.length,e.set(n,t),t=W1(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=W1(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function Xue(r){const e=ede(r),t=new Uint8Array(e);let n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=W1(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let i=r.Links.length-1;i>=0;i--){const s=Yue(r.Links[i],t.subarray(0,n));n-=s,n=W1(t,n,s)-1,t[n]=18}return t}function Zue(r){let e=0;if(r.Hash){const t=r.Hash.length;e+=1+t+Qd(t)}if(typeof r.Name=="string"){const t=AM.encode(r.Name).length;e+=1+t+Qd(t)}return typeof r.Tsize=="number"&&(e+=1+Qd(r.Tsize)),e}function ede(r){let e=0;if(r.Data){const t=r.Data.length;e+=1+t+Qd(t)}if(r.Links)for(const t of r.Links){const n=Zue(t);e+=1+n+Qd(n)}return e}function W1(r,e,t){e-=Qd(t);const n=e;for(;t>=Jue;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function Qd(r){return r%2===0&&r++,Math.floor((tde(r)+6)/7)}function tde(r){let e=0;return r>=CM&&(r=Math.floor(r/CM),e=32),r>=65536&&(r>>>=16,e+=16),r>=256&&(r>>>=8,e+=8),e+rde[r]}const rde=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],nde=["Data","Links"],ide=["Hash","Name","Tsize"],L7=new TextEncoder;function IM(r,e){if(r===e)return 0;const t=r.Name?L7.encode(r.Name):[],n=e.Name?L7.encode(e.Name):[];let i=t.length,s=n.length;for(let o=0,a=Math.min(i,s);o<a;++o)if(t[o]!==n[o]){i=t[o],s=n[o];break}return i<s?-1:s<i?1:0}function kM(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function _M(r){if(typeof r.asCID=="object"){const t=H1.asCID(r);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Hash){let t=H1.asCID(r.Hash);try{t||(typeof r.Hash=="string"?t=H1.parse(r.Hash):r.Hash instanceof Uint8Array&&(t=H1.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(e.Name=r.Name),typeof r.Tsize=="number"&&(e.Tsize=r.Tsize),e}function TM(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Data!==void 0)if(typeof r.Data=="string")e.Data=L7.encode(r.Data);else if(r.Data instanceof Uint8Array)e.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))e.Links=r.Links.map(_M),e.Links.sort(IM);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function PM(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!kM(r,nde))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<r.Links.length;e++){const t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!kM(t,ide))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash==null||!t.Hash["/"]||t.Hash["/"]!==t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0){if(typeof t.Tsize!="number"||t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&IM(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function sde(r,e=[]){return TM({Data:r,Links:e})}function ode(r,e,t){return _M({Hash:t,Name:r,Tsize:e})}function ade(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}const cde="dag-pb",DM=112;function lde(r){PM(r);const e={};return r.Links&&(e.Links=r.Links.map(t=>{const n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),Xue(e)}function ude(r){const e=ade(r),t=Que(e),n={};return t.Data&&(n.Data=t.Data),t.Links&&(n.Links=t.Links.map(i=>{const s={};try{s.Hash=H1.decode(i.Hash)}catch{}if(!s.Hash)throw new Error("Invalid Hash field found in link, expected CID");return i.Name!==void 0&&(s.Name=i.Name),i.Tsize!==void 0&&(s.Tsize=i.Tsize),s})),n}const dde=Object.freeze(Object.defineProperty({__proto__:null,code:DM,createLink:ode,createNode:sde,decode:ude,encode:lde,name:cde,prepare:TM,validate:PM},Symbol.toStringTag,{value:"Module"})),hde=new TextEncoder,fde=new TextDecoder,pde="json",$M=512;function gde(r){return hde.encode(JSON.stringify(r))}function yde(r){return JSON.parse(fde.decode(r))}const mde=Object.freeze(Object.defineProperty({__proto__:null,code:$M,decode:yde,encode:gde,name:pde},Symbol.toStringTag,{value:"Module"})),wde="raw",NM=85;function bde(r){return Wd(r)}function vde(r){return Wd(r)}const Ede=Object.freeze(Object.defineProperty({__proto__:null,code:NM,decode:vde,encode:bde,name:wde},Symbol.toStringTag,{value:"Module"}));function B7(r){return(r==null?void 0:r.then)!=null}function Sde(r=[],e){const t={[DM]:dde,[NM]:Ede,[mT]:e1,[dM]:hue,[$M]:mde};return r.forEach(n=>{t[n.code]=n}),async n=>{let i=t[n];if(i==null&&e!=null){const s=e(n);B7(s)?i=await s:i=s,t[i.code]=i}if(i!=null)return i;throw new jN(`Could not load codec for ${n}`)}}const MM=0,xde="identity",OM=Wd;function Ade(r){return qy(MM,OM(r))}const RM={code:MM,name:xde,encode:OM,digest:Ade};function LM(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const BM=BN({name:"sha2-256",code:18,encode:LM("SHA-256")}),UM=BN({name:"sha2-512",code:19,encode:LM("SHA-512")});function Cde(r=[],e){const t={[BM.code]:BM,[UM.code]:UM,[RM.code]:RM};return r.forEach(n=>{t[n.code]=n}),async n=>{let i=t[n];if(i==null&&e!=null){const s=e(n);B7(s)?i=await s:i=s,t[i.code]=i}if(i!=null)return i;throw new KN(`No hasher configured for multihash code 0x${n.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)}}const Qh=class Qh extends Error{constructor(t="Not Found"){super(t);u(this,"name",Qh.name);u(this,"code",Qh.code)}};u(Qh,"name","NotFoundError"),u(Qh,"code","ERR_NOT_FOUND");let G1=Qh;class FM{has(e,t){return Promise.reject(new Error(".has is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}async*putMany(e,t){for await(const{cid:n,block:i}of e)await this.put(n,i,t),yield n}get(e,t){return Promise.reject(new Error(".get is not implemented"))}async*getMany(e,t){for await(const n of e)yield{cid:n,block:await this.get(n,t)}}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(e,t){for await(const n of e)await this.delete(n,t),yield n}async*getAll(e){throw new Error(".getAll is not implemented")}}const am=0;class Ide extends FM{constructor(t){super();u(this,"child");this.child=t}put(t,n){return t.multihash.code===am||this.child==null?t:this.child.put(t,n)}get(t){if(t.multihash.code===am)return t.multihash.digest;if(this.child==null)throw new G1;return this.child.get(t)}has(t){return t.multihash.code===am?!0:this.child==null?!1:this.child.has(t)}delete(t){if(t.code!==am&&this.child!=null)return this.child.delete(t)}getAll(t){return this.child!=null?this.child.getAll(t):[]}}function kde(r){return r[Symbol.asyncIterator]!=null}function Gl(r,e){let t=0;if(kde(r))return async function*(){for await(const c of r)await e(c,t++)&&(yield c)}();const n=Vv(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof o.then=="function")return async function*(){await o&&(yield i);for await(const c of n)await e(c,t++)&&(yield c)}();const a=e;return function*(){o===!0&&(yield i);for(const c of n)a(c,t++)&&(yield c)}()}function _de(r){return r[Symbol.asyncIterator]!=null}function zM(r){return(r==null?void 0:r.then)!=null}function cm(r,e){let t=0;if(_de(r))return async function*(){for await(const c of r){const l=e(c,t++);zM(l)&&await l,yield c}}();const n=Vv(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof(o==null?void 0:o.then)=="function")return async function*(){yield i;for await(const c of n){const l=e(c,t++);zM(l)&&await l,yield c}}();const a=e;return function*(){yield i;for(const c of n)a(c,t++),yield c}()}class VM{constructor(e){u(this,"child");u(this,"getHasher");u(this,"log");u(this,"logger");u(this,"components");this.log=e.logger.forComponent("helia:networked-storage"),this.logger=e.logger,this.components=e,this.child=new Ide(e.blockstore),this.getHasher=e.getHasher}async put(e,t,n={}){var i,s,o;return await this.child.has(e,n)?((i=n.onProgress)==null||i.call(n,new _e("blocks:put:duplicate",e)),e):((s=n.onProgress)==null||s.call(n,new _e("blocks:put:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async a=>{var c;return(c=a.announce)==null?void 0:c.call(a,e,t,n)})),(o=n.onProgress)==null||o.call(n,new _e("blocks:put:blockstore:put",e)),this.child.put(e,t,n))}async*putMany(e,t={}){var s;const n=Gl(e,async({cid:o})=>{var c;const a=await this.child.has(o,t);return a&&((c=t.onProgress)==null||c.call(t,new _e("blocks:put-many:duplicate",o))),!a}),i=cm(n,async({cid:o,block:a})=>{var c;(c=t.onProgress)==null||c.call(t,new _e("blocks:put-many:providers:notify",o)),await Promise.all(this.components.blockBrokers.map(async l=>{var d;return(d=l.announce)==null?void 0:d.call(l,o,a,t)}))});(s=t.onProgress)==null||s.call(t,new _e("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(i,t)}async get(e,t={}){var n,i,s,o;if(t.offline!==!0&&!await this.child.has(e,t)){const a=await this.getHasher(e.multihash.code);(n=t.onProgress)==null||n.call(t,new _e("blocks:get:providers:get",e));const c=await KM(e,this.components.blockBrokers,a,{...t,log:this.log});return(i=t.onProgress)==null||i.call(t,new _e("blocks:get:blockstore:put",e)),await this.child.put(e,c,t),(s=t.onProgress)==null||s.call(t,new _e("blocks:get:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async l=>{var d;return(d=l.announce)==null?void 0:d.call(l,e,c,t)})),c}return(o=t.onProgress)==null||o.call(t,new _e("blocks:get:blockstore:get",e)),this.child.get(e,t)}async*getMany(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new _e("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(cm(e,async i=>{var s,o,a;if(t.offline!==!0&&!await this.child.has(i,t)){const c=await this.getHasher(i.multihash.code);(s=t.onProgress)==null||s.call(t,new _e("blocks:get-many:providers:get",i));const l=await KM(i,this.components.blockBrokers,c,{...t,log:this.log});(o=t.onProgress)==null||o.call(t,new _e("blocks:get-many:blockstore:put",i)),await this.child.put(i,l,t),(a=t.onProgress)==null||a.call(t,new _e("blocks:get-many:providers:notify",i)),await Promise.all(this.components.blockBrokers.map(async d=>{var h;return(h=d.announce)==null?void 0:h.call(d,i,l,t)}))}}))}async delete(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new _e("blocks:delete:blockstore:delete",e)),await this.child.delete(e,t)}async*deleteMany(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new _e("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(const i of e)yield i}(),t)}async has(e,t={}){return this.child.has(e,t)}async*getAll(e={}){var t;(t=e.onProgress)==null||t.call(e,new _e("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(e)}}class Tde extends VM{constructor(t){super(t);u(this,"started");this.started=!1}isStarted(){return this.started}async start(){await Io(this.child,...this.components.blockBrokers),this.started=!0}async stop(){await Qa(this.child,...this.components.blockBrokers),this.started=!1}unwrap(){return this.child}createSession(t,n){const i=this.components.blockBrokers.map(s=>s.createSession==null?s:s.createSession(n));return new Pde({blockstore:this.child,blockBrokers:i,getHasher:this.getHasher,logger:this.logger},{root:t})}}class Pde extends VM{constructor(t,n){super(t);u(this,"closeController");this.closeController=new AbortController,this.closeController.signal,this.log=t.logger.forComponent(`helia:session-storage:${n.root}`)}close(){this.closeController.abort()}async put(t,n,i={}){const s=pt([this.closeController.signal,i.signal]);try{return await super.put(t,n,{...i,signal:s})}finally{s.clear()}}async*putMany(t,n={}){const i=pt([this.closeController.signal,n.signal]);try{yield*super.putMany(t,{...n,signal:i})}finally{i.clear()}}async get(t,n={}){const i=pt([this.closeController.signal,n.signal]);try{return await super.get(t,{...n,signal:i})}finally{i.clear()}}async*getMany(t,n={}){const i=pt([this.closeController.signal,n.signal]);try{yield*super.getMany(t,{...n,signal:i})}finally{i.clear()}}async delete(t,n={}){const i=pt([this.closeController.signal,n.signal]);try{await super.delete(t,{...n,signal:i})}finally{i.clear()}}async*deleteMany(t,n={}){const i=pt([this.closeController.signal,n.signal]);try{yield*super.deleteMany(t,{...n,signal:i})}finally{i.clear()}}async has(t,n={}){const i=pt([this.closeController.signal,n.signal]);try{return await super.has(t,{...n,signal:i})}finally{i.clear()}}async*getAll(t={}){const n=pt([this.closeController.signal,t.signal]);try{yield*super.getAll({...t,signal:n})}finally{n.clear()}}}function Dde(r){return typeof r.retrieve=="function"}const $de=(r,e)=>{if(e==null)throw new Z(`No hasher configured for multihash code 0x${r.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`);return async t=>{let n;const i=e.digest(t);if(B7(i)?n=await i:n=i,!We(n.digest,r.multihash.digest))throw new R2("Hash of downloaded block did not match multihash from passed CID")}};async function KM(r,e,t,n){const i=$de(r,t),s=new AbortController,o=pt([s.signal,n.signal]);s.signal;const a=[];for(const c of e)Dde(c)&&a.push(c);try{return await Promise.any(a.map(async c=>{try{let l=!1;const d=await c.retrieve(r,{...n,signal:o,validateFn:async h=>{await i(h),l=!0}});return l||await i(d),d}catch(l){throw n.log.error("could not retrieve verified block for %c",r,l),l}}))}finally{s.abort(),o.clear()}}const Nde=si({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});si({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),si({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),si({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});class jM extends er{constructor(t,n){super();u(this,"initialPeerSearchComplete");u(this,"requests");u(this,"name");u(this,"log");u(this,"logger");u(this,"minProviders");u(this,"maxProviders");u(this,"providers");u(this,"evictionFilter");this.name=n.name,this.logger=t.logger,this.log=t.logger.forComponent(this.name),this.requests=new Map,this.minProviders=n.minProviders??sle,this.maxProviders=n.maxProviders??ole,this.providers=[],this.evictionFilter=Vl(this.maxProviders)}async retrieve(t,n={}){const i=Nde.encode(t.multihash.bytes),s=this.requests.get(i);if(s!=null)return this.log("join existing request for %c",t),s;const o=Le();if(this.requests.set(i,o.promise),this.providers.length===0){let d=!1;this.initialPeerSearchComplete==null&&(d=!0,this.log=this.logger.forComponent(`${this.name}:${t}`),this.initialPeerSearchComplete=this.findProviders(t,this.minProviders,n)),await this.initialPeerSearchComplete,d&&this.log("found initial session peers for %c",t)}let a=!1;const c=new Ul({concurrency:this.maxProviders});c.addEventListener("error",()=>{}),c.addEventListener("failure",d=>{this.log.error("error querying provider %o, evicting from session",d.detail.job.options.provider,d.detail.error),this.evict(d.detail.job.options.provider)}),c.addEventListener("success",d=>{a=!0,o.resolve(d.detail.result)}),c.addEventListener("idle",()=>{var d;a||((d=n.signal)==null?void 0:d.aborted)===!0||Promise.resolve().then(async()=>{this.log("no session peers had block for for %c, finding new providers",t);for(let h=0;h<this.minProviders&&this.providers.length!==0;h++){const p=this.providers[Math.floor(Math.random()*this.providers.length)];this.evict(p)}await this.findProviders(t,this.minProviders,n),this.log("found new providers re-retrieving %c",t),this.requests.delete(i),o.resolve(await this.retrieve(t,n))}).catch(h=>{this.log.error("could not find new providers for %c",t,h),o.reject(h)})});const l=d=>{c.add(async()=>this.queryProvider(t,d.detail,n),{provider:d.detail}).catch(h=>{var p;((p=n.signal)==null?void 0:p.aborted)!==!0&&this.log.error("error retrieving session block for %c",t,h)})};this.addEventListener("provider",l),Promise.all([...this.providers].map(async d=>c.add(async()=>this.queryProvider(t,d,n),{provider:d}))).catch(d=>{var h;((h=n.signal)==null?void 0:h.aborted)!==!0&&this.log.error("error retrieving session block for %c",t,d)});try{return await o.promise}finally{this.removeEventListener("provider",l),c.clear(),this.requests.delete(i)}}evict(t){this.evictionFilter.add(this.toEvictionKey(t));const n=this.providers.findIndex(i=>this.equals(i,t));n!==-1&&this.providers.splice(n,1)}isEvicted(t){return this.evictionFilter.has(this.toEvictionKey(t))}hasProvider(t){return!!(this.providers.find(n=>this.equals(n,t))!=null||this.isEvicted(t))}async findProviders(t,n,i){const s=Le();let o=0;return Promise.resolve().then(async()=>{var a;this.log("finding %d-%d new provider(s) for %c",n,this.maxProviders,t);for await(const c of this.findNewProviders(t,i)){if(o===this.maxProviders||((a=i.signal)==null?void 0:a.aborted)===!0)break;if(!this.hasProvider(c)&&(this.log("found %d/%d new providers",o,this.maxProviders),this.providers.push(c),this.safeDispatchEvent("provider",{detail:c}),o++,o===n&&(this.log("session is ready"),s.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",o);break}}if(this.log("found %d/%d new session peers",o,this.maxProviders),o<n)throw new VN(`Found ${o} of ${n} ${this.name} providers for ${t}`)}).catch(a=>{this.log.error("error searching routing for potential session peers for %c",t,a.errors??a),s.reject(a)}),s.promise}}class Mde{constructor(e){u(this,"blockstore");u(this,"datastore");u(this,"pins");u(this,"logger");u(this,"routing");u(this,"getCodec");u(this,"getHasher");u(this,"dns");u(this,"metrics");u(this,"log");this.logger=e.logger??Uy(),this.log=this.logger.forComponent("helia"),this.getHasher=Cde(e.hashers,e.loadHasher),this.getCodec=Sde(e.codecs,e.loadCodec),this.dns=e.dns??_N(),this.metrics=e.metrics;const t={blockstore:e.blockstore,datastore:e.datastore,logger:this.logger,blockBrokers:[],getHasher:this.getHasher,getCodec:this.getCodec,dns:this.dns,metrics:this.metrics,...e.components??{}};this.routing=t.routing=new cle(t,{routers:(e.routers??[]).flatMap(i=>{const s=[i];return i[Sd]!=null&&s.push(i[Sd]),i[xd]!=null&&s.push(i[xd]),s}),providerLookupConcurrency:e.providerLookupConcurrency});const n=new Tde(t);this.pins=new ile(e.datastore,n,this.getCodec),this.blockstore=new ple(n,this.pins,{holdGcLock:e.holdGcLock??!0}),this.datastore=e.datastore,t.blockBrokers=e.blockBrokers.map(i=>i(t))}async start(){await gle(this.datastore),await Io(this.blockstore,this.datastore,this.routing)}async stop(){await Qa(this.blockstore,this.datastore,this.routing)}async gc(e={}){const t=await this.blockstore.lock.writeLock();try{const n=this,i=this.blockstore.unwrap();this.log("gc start"),await vo(i.deleteMany(async function*(){var s,o;for await(const{cid:a}of i.getAll())try{if(await n.pins.isPinned(a,e))continue;yield a,(s=e.onProgress)==null||s.call(e,new _e("helia:gc:deleted",a))}catch(c){n.log.error("Error during gc",c),(o=e.onProgress)==null||o.call(e,new _e("helia:gc:error",c))}}()))}finally{t()}this.log("gc finished")}}class Ode extends jM{constructor(t,n){super(t,{...n,name:"helia:bitswap:session"});u(this,"wantList");u(this,"network");this.wantList=t.wantList,this.network=t.network}async queryProvider(t,n,i){this.log("sending WANT-BLOCK for %c to %p",t,n);const s=await this.wantList.wantSessionBlock(t,n,i);if(this.log("%p %s %c",n,s.has?"has":"does not have",t),s.has&&s.block!=null)return s.block;throw new Error("Provider did not have block")}async*findNewProviders(t,n={}){for await(const i of this.network.findProviders(t,n))yield i.id}toEvictionKey(t){return t.toMultihash().bytes}equals(t,n){return t.equals(n)}}function Rde(r,e){return new Ode(r,e)}class Lde{constructor(e){u(this,"blocksReceived");u(this,"duplicateBlocksReceived");u(this,"dataReceived");u(this,"duplicateDataReceived");var t,n,i,s;this.blocksReceived=(t=e.metrics)==null?void 0:t.registerMetricGroup("helia_bitswap_received_blocks"),this.duplicateBlocksReceived=(n=e.metrics)==null?void 0:n.registerMetricGroup("helia_bitswap_duplicate_received_blocks"),this.dataReceived=(i=e.metrics)==null?void 0:i.registerMetricGroup("helia_bitswap_data_received_bytes"),this.duplicateDataReceived=(s=e.metrics)==null?void 0:s.registerMetricGroup("helia_bitswap_duplicate_data_received_bytes")}updateBlocksReceived(e=1,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.blocksReceived)==null||i.increment(n)}updateDuplicateBlocksReceived(e=1,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.duplicateBlocksReceived)==null||i.increment(n)}updateDataReceived(e,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.dataReceived)==null||i.increment(n)}updateDuplicateDataReceived(e,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.duplicateDataReceived)==null||i.increment(n)}}class Bde extends Map{constructor(t){super();u(this,"metric");const{name:n,metrics:i}=t;this.metric=i.registerMetric(n),this.updateComponentMetric()}set(t,n){return super.set(t,n),this.updateComponentMetric(),this}delete(t){const n=super.delete(t);return this.updateComponentMetric(),n}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function HM(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new Bde({name:e,metrics:t}):n=new Map,n}function Ude({name:r,code:e,encode:t}){return new Fde(r,e,t)}let Fde=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?c7(this.code,t):t.then(n=>c7(this.code,n))}else throw Error("Unknown type, must be binary type")}};function zde(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const qM=Ude({name:"sha2-256",code:18,encode:zde("SHA-256")});function Vde(r){if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");const e=[];for(;r.length>0;){const t=es(r);e.push(t),r=r.slice(yt(t))}return e}class Kde extends er{constructor(t,n={}){super();u(this,"peers");u(this,"wants");u(this,"network");u(this,"log");u(this,"sendMessagesDelay");u(this,"sendMessagesTimeout");u(this,"hashLoader");u(this,"sendingMessages");this.peers=lN({name:"helia_bitswap_peers",metrics:t.metrics}),this.wants=HM({name:"helia_bitswap_wantlist",metrics:t.metrics}),this.network=t.network,this.sendMessagesDelay=n.sendMessagesDelay??ise,this.log=t.logger.forComponent("helia:bitswap:wantlist"),this.hashLoader=n.hashLoader,this.network.addEventListener("bitswap:message",i=>{this.receiveMessage(i.detail.peer,i.detail.message).catch(s=>{this.log.error("error receiving bitswap message from %p",i.detail.peer,s)})}),this.network.addEventListener("peer:connected",i=>{this.peerConnected(i.detail).catch(s=>{this.log.error("error processing newly connected bitswap peer %p",i.detail,s)})}),this.network.addEventListener("peer:disconnected",i=>{this.peerDisconnected(i.detail)})}async addEntry(t,n){var o;const i=re(t.multihash.bytes,"base64");let s=this.wants.get(i);s==null&&(s={cid:t,priority:n.priority??1,wantType:n.wantType??pr.WantBlock,cancel:!1,sendDontHave:!0},this.wants.set(i,s)),s.wantType===pr.WantHave&&n.wantType===pr.WantBlock&&(s.wantType=pr.WantBlock),await this.sendMessagesDebounced();try{return n.wantType===pr.WantBlock?(await Ti(this,"block",n==null?void 0:n.signal,{filter:l=>We(t.multihash.digest,l.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail:(await Ti(this,"presence",n==null?void 0:n.signal,{filter:c=>We(t.multihash.digest,c.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail}finally{((o=n.signal)==null?void 0:o.aborted)===!0&&(this.log("want for %c was aborted, cancelling want",t),s.cancel=!0,await this.sendMessagesDebounced())}}async sendMessagesDebounced(){var t;await((t=this.sendingMessages)==null?void 0:t.promise),clearTimeout(this.sendMessagesTimeout),this.sendMessagesTimeout=setTimeout(()=>{this.sendMessages().catch(n=>{this.log("error sending messages to peers",n)})},this.sendMessagesDelay)}async sendMessages(){this.sendingMessages=Le(),await Promise.all([...this.peers.entries()].map(async([t,n])=>{const i=new Set,s=new z1;for(const[o,a]of this.wants.entries())n.has(o)||a.cancel||(i.add(o),s.addWantlistEntry(a.cid,{cid:a.cid.bytes,priority:a.priority,wantType:a.wantType,cancel:a.cancel,sendDontHave:a.sendDontHave}));if(s.wantlist.size!==0)try{await this.network.sendMessage(t,s);for(const o of i)n.add(o)}catch(o){this.log.error("error sending full wantlist to new peer",o)}})).catch(t=>{this.log.error("error sending messages",t)});for(const[t,n]of this.wants)if(n.cancel){this.wants.delete(t);for(const i of this.peers.values())i.delete(t)}this.sendingMessages.resolve()}has(t){const n=re(t.multihash.bytes,"base64");return this.wants.has(n)}async wantSessionPresence(t,n,i={}){const s=new z1;return s.addWantlistEntry(t,{cid:t.bytes,sendDontHave:!0,wantType:pr.WantHave,priority:1}),await this.network.sendMessage(n,s),(await Ti(this,"presence",i.signal,{filter:a=>n.equals(a.detail.sender)&&We(t.multihash.digest,a.detail.cid.multihash.digest)})).detail}async wantBlock(t,n={}){return this.addEntry(t,{...n,wantType:pr.WantBlock})}async wantSessionBlock(t,n,i={}){const s=new z1;return s.addWantlistEntry(t,{cid:t.bytes,sendDontHave:!0,wantType:pr.WantBlock,priority:1}),await this.network.sendMessage(n,s),(await Ti(this,"presence",i.signal,{filter:a=>n.equals(a.detail.sender)&&We(t.multihash.digest,a.detail.cid.multihash.digest)})).detail}async receivedBlock(t,n){const i=re(t.multihash.bytes,"base64"),s=this.wants.get(i);s!=null&&(s.cancel=!0,await this.sendMessagesDebounced())}async receiveMessage(t,n){var s;this.log("received message from %p with %d blocks",t,n.blocks.length);let i=!1;for(const o of n.blocks){if(o.prefix==null||o.data==null)continue;const a=Vde(o.prefix),c=a[0],l=a[1],d=a[2],h=d===qM.code?qM:await((s=this.hashLoader)==null?void 0:s.getHasher(d));if(h==null){this.log.error("unknown hash algorithm",d);continue}let p=h.digest(o.data);p.then!=null&&(p=await p);const b=d7.create(c===0?0:1,l,p);this.log("received block from %p for %c",t,b),this.safeDispatchEvent("block",{detail:{sender:t,cid:b,block:o.data}}),this.safeDispatchEvent("presence",{detail:{sender:t,cid:b,has:!0,block:o.data}});const f=re(b.multihash.bytes,"base64"),g=this.wants.get(f);g!=null&&(g.cancel=!0,i=!0)}for(const{cid:o,type:a}of n.blockPresences){const c=d7.decode(o);this.log("received %s from %p for %c",a,t,c),this.safeDispatchEvent("presence",{detail:{sender:t,cid:c,has:a===Fs.HaveBlock}})}i&&await this.sendMessagesDebounced()}async peerConnected(t){const n=new Set,i=new z1(!0);for(const[s,o]of this.wants.entries())o.cancel||(n.add(s),i.addWantlistEntry(o.cid,{cid:o.cid.bytes,priority:1,wantType:pr.WantBlock,cancel:!1,sendDontHave:!1}));if(i.wantlist.size===0){this.peers.set(t,n);return}try{await this.network.sendMessage(t,i),this.peers.set(t,n)}catch(s){this.log.error("error sending full wantlist to new peer %p",t,s)}}peerDisconnected(t){this.peers.delete(t)}start(){}stop(){this.peers.clear(),clearTimeout(this.sendMessagesTimeout)}}class jde{constructor(e,t={}){u(this,"log");u(this,"logger");u(this,"stats");u(this,"network");u(this,"blockstore");u(this,"peerWantLists");u(this,"wantList");this.logger=e.logger,this.log=e.logger.forComponent("helia:bitswap"),this.blockstore=e.blockstore,this.stats=new Lde(e),this.network=new gse(e,t),this.peerWantLists=new Dae({...e,network:this.network},t),this.wantList=new Kde({...e,network:this.network},t)}createSession(e={}){return Rde({wantList:this.wantList,network:this.network,logger:this.logger},e)}async want(e,t={}){const n=new AbortController,i=pt([n.signal,t.signal]);n.signal,this.network.findAndConnect(e,{...t,signal:i}).catch(s=>{n.signal.aborted||this.log.error("error during finding and connect for cid %c",e,s)});try{return(await this.wantList.wantBlock(e,{...t,signal:i})).block}finally{n.abort(),i.clear()}}async notify(e,t,n={}){await Promise.all([this.peerWantLists.receivedBlock(e,n),this.wantList.receivedBlock(e,n)])}getWantlist(){return[...this.wantList.wants.values()].filter(e=>!e.cancel).map(e=>({cid:e.cid,priority:e.priority,wantType:e.wantType}))}getPeerWantlist(e){return this.peerWantLists.wantListForPeer(e)}async start(){this.wantList.start(),await this.network.start()}async stop(){this.wantList.stop(),await this.network.stop()}}const Hde=(r,e={})=>new jde(r,e);class qde{constructor(e,t={}){u(this,"bitswap");u(this,"started");const{getHasher:n}=e;this.bitswap=Hde(e,{hashLoader:{getHasher:async i=>n(i)},...t}),this.started=!1}isStarted(){return this.started}async start(){await this.bitswap.start(),this.started=!0}async stop(){await this.bitswap.stop(),this.started=!1}async announce(e,t,n){await this.bitswap.notify(e,t,n)}async retrieve(e,t={}){return this.bitswap.want(e,t)}createSession(e){const t=this.bitswap.createSession(e);return{announce:async(n,i,s)=>{await this.bitswap.notify(n,i,s)},retrieve:async(n,i)=>t.retrieve(n,i)}}}function Wde(r={}){return e=>new qde(e,r)}class Gde{constructor(){u(this,"index",0);u(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,i){return this.readAtomically(()=>{let s=0,o=0;const a=this.peekChar();if(a===void 0)return;const c=a==="0",l=2**(8*i)-1;for(;;){const d=this.readAtomically(()=>{const h=this.readChar();if(h===void 0)return;const p=Number.parseInt(h,e);if(!Number.isNaN(p))return p});if(d===void 0)break;if(s*=e,s+=d,s>l||(o+=1,t!==void 0&&o>t))return}if(o!==0)return!n&&c&&o>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){const e=t=>{for(let n=0;n<t.length/2;n++){const i=n*2;if(n<t.length-3){const o=this.readSeparator(":",n,()=>this.readIPv4Addr());if(o!==void 0)return t[i]=o[0],t[i+1]=o[1],t[i+2]=o[2],t[i+3]=o[3],[i+4,!0]}const s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[i,!1];t[i]=s>>8,t[i+1]=s&255}return[t.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[n,i]=e(t);if(n===16)return t;if(i||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const s=new Uint8Array(14),o=16-(n+2),[a]=e(s.subarray(0,o));return t.set(s.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const WM=45,Qde=15,Jd=new Gde;function GM(r){if(!(r.length>Qde))return Jd.new(r).parseWith(()=>Jd.readIPv4Addr())}function QM(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>WM))return Jd.new(r).parseWith(()=>Jd.readIPv6Addr())}function lm(r,e=!1){if(r.includes("%")&&(r=r.split("%")[0]),r.length>WM)return;const t=Jd.new(r).parseWith(()=>Jd.readIPAddr());if(t)return e&&t.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,t[0],t[1],t[2],t[3]]):t}function Yd(r){return!!GM(r)}function U7(r){return!!QM(r)}function JM(r){return!!lm(r)}var YM;(function(){var r,e,t,n,i,s,o,a;a=function(c){var l,d,h,p;return l=(c&255<<24)>>>24,d=(c&255<<16)>>>16,h=(c&65280)>>>8,p=c&255,[l,d,h,p].join(".")},o=function(c){var l,d,h,p,b,f;for(l=[],h=p=0;p<=3&&c.length!==0;h=++p){if(h>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}f=e(c),b=f[0],d=f[1],c=c.substring(d),l.push(b)}if(c.length!==0)throw new Error("Invalid IP");switch(l.length){case 1:if(l[0]>4294967295)throw new Error("Invalid IP");return l[0]>>>0;case 2:if(l[0]>255||l[1]>16777215)throw new Error("Invalid IP");return(l[0]<<24|l[1])>>>0;case 3:if(l[0]>255||l[1]>255||l[2]>65535)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2])>>>0;case 4:if(l[0]>255||l[1]>255||l[2]>255||l[3]>255)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2]<<8|l[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},n=t("0"),s=t("a"),i=t("A"),e=function(c){var l,d,h,p,b;for(p=0,l=10,d="9",h=0,c.length>1&&c[h]==="0"&&(c[h+1]==="x"||c[h+1]==="X"?(h+=2,l=16):"0"<=c[h+1]&&c[h+1]<="9"&&(h++,l=8,d="7")),b=h;h<c.length;){if("0"<=c[h]&&c[h]<=d)p=p*l+(t(c[h])-n)>>>0;else if(l===16)if("a"<=c[h]&&c[h]<="f")p=p*l+(10+t(c[h])-s)>>>0;else if("A"<=c[h]&&c[h]<="F")p=p*l+(10+t(c[h])-i)>>>0;else break;else break;if(p>4294967295)throw new Error("too large");h++}if(h===b)throw new Error("empty octet");return[p,h]},r=function(){function c(l,d){var h,p,b;if(typeof l!="string")throw new Error("Missing `net' parameter");if(d||(b=l.split("/",2),l=b[0],d=b[1]),d||(d=32),typeof d=="string"&&d.indexOf(".")>-1){try{this.maskLong=o(d)}catch{throw new Error("Invalid mask: "+d)}for(h=p=32;p>=0;h=--p)if(this.maskLong===4294967295<<32-h>>>0){this.bitmask=h;break}}else if(d||d===0)this.bitmask=parseInt(d,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(o(l)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+l)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+d);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(l){return typeof l=="string"&&(l.indexOf("/")>0||l.split(".").length!==4)&&(l=new c(l)),l instanceof c?this.contains(l.base)&&this.contains(l.broadcast||l.last):(o(l)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(l){return l==null&&(l=1),new c(a(this.netLong+this.size*l),this.mask)},c.prototype.forEach=function(l){var d,h,p;for(p=o(this.first),h=o(this.last),d=0;p<=h;)l(a(p),p,d),d++,p++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),YM=r}).call(nt);const Jde=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"].map(r=>new YM(r));function F7(r){for(const e of Jde)if(e.contains(r))return!0;return!1}function Yde(r){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(r)}function Xde(r){const e=r.split(":");if(e.length<2)return!1;const t=e[e.length-1].padStart(4,"0"),n=e[e.length-2].padStart(4,"0"),i=`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(t.substring(0,2),16)}.${parseInt(t.substring(2),16)}`;return F7(i)}function Zde(r){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)}function ehe(r){const e=r.split(":"),t=e[e.length-1];return F7(t)}function the(r){return/^::$/.test(r)||/^::1$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}function vc(r){return Yd(r)?F7(r):Yde(r)?Xde(r):Zde(r)?ehe(r):U7(r)?the(r):void 0}function rhe(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function nhe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var ihe=nhe,she=ihe;let ohe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ahe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return XM(this,e)}},che=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return XM(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function XM(r,e){return new che({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let lhe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new ohe(e,t,n),this.decoder=new ahe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function ZM({name:r,prefix:e,encode:t,decode:n}){return new lhe(r,e,t,n)}function eO({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=she(t,r);return ZM({prefix:e,name:r,encode:n,decode:s=>rhe(i(s))})}function uhe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function dhe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function um({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return ZM({prefix:e,name:r,encode(i){return dhe(i,n,t)},decode(i){return uhe(i,n,t,r)}})}const hhe=eO({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});eO({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),um({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),um({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});const fhe=um({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});um({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const phe=r=>r.toString().split("/").slice(1),Q1=r=>({match:e=>e.length<1?!1:r(e[0])?e.slice(1):!1,pattern:"fn"}),Qe=r=>({match:e=>Q1(t=>t===r).match(e),pattern:r}),Xd=()=>({match:r=>Q1(e=>typeof e=="string").match(r),pattern:"{string}"}),dm=()=>({match:r=>Q1(e=>!isNaN(parseInt(e))).match(r),pattern:"{number}"}),wt=()=>({match:r=>{if(r.length<2||r[0]!=="p2p"&&r[0]!=="ipfs")return!1;if(r[1].startsWith("Q")||r[1].startsWith("1"))try{hhe.decode(`z${r[1]}`)}catch{return!1}else return!1;return r.slice(2)},pattern:"/p2p/{peerid}"}),hm=()=>({match:r=>{if(r.length<2||r[0]!=="certhash")return!1;try{fhe.decode(r[1])}catch{return!1}return r.slice(2)},pattern:"/certhash/{certhash}"}),dt=r=>({match:e=>{const t=r.match(e);return t===!1?e:t},pattern:`optional(${r.pattern})`}),fn=(...r)=>({match:e=>{let t;for(const n of r){const i=n.match(e);i!==!1&&(t==null||i.length<t.length)&&(t=i)}return t??!1},pattern:`or(${r.map(e=>e.pattern).join(", ")})`}),et=(...r)=>({match:e=>{for(const t of r){const n=t.match(e);if(n===!1)return!1;e=n}return e},pattern:`and(${r.map(e=>e.pattern).join(", ")})`});function Ct(...r){function e(i){let s=phe(i);for(const o of r){const a=o.match(s);if(a===!1)return!1;s=a}return s}function t(i){return e(i)!==!1}function n(i){const s=e(i);return s===!1?!1:s.length===0}return{matchers:r,matches:t,exactMatch:n}}const ghe=wt(),yhe=Ct(ghe),fm=et(Qe("dns4"),Xd()),pm=et(Qe("dns6"),Xd()),gm=et(Qe("dnsaddr"),Xd()),z7=et(Qe("dns"),Xd());Ct(fm,dt(wt())),Ct(pm,dt(wt())),Ct(gm,dt(wt()));const tO=Ct(fn(z7,gm,fm,pm),dt(wt())),rO=et(Qe("ip4"),Q1(Yd)),nO=et(Qe("ip6"),Q1(U7)),V7=fn(rO,nO),Ro=fn(V7,z7,fm,pm,gm),mhe=Ct(fn(V7,et(fn(z7,gm,fm,pm),dt(wt())))),iO=Ct(rO),sO=Ct(nO),whe=Ct(V7),K7=et(Ro,Qe("tcp"),dm()),J1=et(Ro,Qe("udp"),dm()),ym=Ct(et(K7,dt(wt())));Ct(J1);const j7=et(J1,Qe("quic"),dt(wt())),mm=et(J1,Qe("quic-v1"),dt(wt())),bhe=fn(j7,mm);Ct(j7);const vhe=Ct(mm),H7=fn(Ro,K7,J1,j7,mm),oO=fn(et(H7,Qe("ws"),dt(wt()))),Y1=Ct(oO),aO=fn(et(H7,Qe("wss"),dt(wt())),et(H7,Qe("tls"),dt(et(Qe("sni"),Xd())),Qe("ws"),dt(wt()))),wm=Ct(aO),cO=et(J1,Qe("webrtc-direct"),dt(hm()),dt(hm()),dt(wt())),q7=Ct(cO),lO=et(mm,Qe("webtransport"),dt(hm()),dt(hm()),dt(wt())),uO=Ct(lO),bm=fn(oO,aO,et(K7,dt(wt())),et(bhe,dt(wt())),et(Ro,dt(wt())),cO,lO,wt()),dO=Ct(bm),Ehe=et(bm,Qe("p2p-circuit"),wt()),Ec=Ct(Ehe),She=fn(et(bm,Qe("p2p-circuit"),Qe("webrtc"),dt(wt())),et(bm,Qe("webrtc"),dt(wt())),et(Qe("webrtc"),dt(wt()))),W7=Ct(She),xhe=fn(et(Ro,Qe("tcp"),dm(),Qe("http"),dt(wt())),et(Ro,Qe("http"),dt(wt()))),Ahe=Ct(xhe),Che=fn(et(Ro,Qe("tcp"),fn(et(Qe("443"),Qe("http")),et(dm(),Qe("https"))),dt(wt())),et(Ro,Qe("tls"),Qe("http"),dt(wt())),et(Ro,Qe("https"),dt(wt()))),Ihe=Ct(Che),khe=fn(et(Qe("memory"),Xd(),dt(wt())));Ct(khe);function _he(r,e,t){let n=0;for(const i of r)if(!(n<e)){if(n>t)break;if(i!==255)return!1;n++}return!0}function The(r,e,t,n){let i=0;for(const s of r)if(!(i<t)){if(i>n)break;if(s!==e[i])return!1;i++}return!0}function Phe(r){switch(r.length){case X1:return r.join(".");case Z1:{const e=[];for(let t=0;t<r.length;t++)t%2===0&&e.push(r[t].toString(16).padStart(2,"0")+r[t+1].toString(16).padStart(2,"0"));return e.join(":")}default:throw new Error("Invalid ip length")}}function Dhe(r){let e=0;for(let[t,n]of r.entries()){if(n===255){e+=8;continue}for(;n&128;)e++,n=n<<1;if(n&128)return-1;for(let i=t+1;i<r.length;i++)if(r[i]!=0)return-1;break}return e}function $he(r){let e="0x";for(const t of r)e+=(t>>4).toString(16)+(t&15).toString(16);return e}const X1=4,Z1=16,Nhe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function hO(r,e){e.length===Z1&&r.length===X1&&_he(e,0,11)&&(e=e.slice(12)),e.length===X1&&r.length===Z1&&The(r,Nhe,0,11)&&(r=r.slice(12));const t=r.length;if(t!=e.length)throw new Error("Failed to mask ip");const n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=r[i]&e[i];return n}function Mhe(r,e){if(typeof e=="string"&&(e=lm(e)),e==null)throw new Error("Invalid ip");if(e.length!==r.network.length)return!1;for(let t=0;t<e.length;t++)if((r.network[t]&r.mask[t])!==(e[t]&r.mask[t]))return!1;return!0}function Ohe(r){const[e,t]=r.split("/");if(!e||!t)throw new Error("Failed to parse given CIDR: "+r);let n=X1,i=GM(e);if(i==null&&(n=Z1,i=QM(e),i==null))throw new Error("Failed to parse given CIDR: "+r);const s=parseInt(t,10);if(Number.isNaN(s)||String(s).length!==t.length||s<0||s>n*8)throw new Error("Failed to parse given CIDR: "+r);const o=fO(s,8*n);return{network:hO(i,o),mask:o}}function fO(r,e){if(e!==8*X1&&e!==8*Z1)throw new Error("Invalid CIDR mask");if(r<0||r>e)throw new Error("Invalid CIDR mask");const t=e/8,n=new Uint8Array(t);for(let i=0;i<t;i++){if(r>=8){n[i]=255,r-=8;continue}n[i]=255-(255>>r),r=0}return n}class pO{constructor(e,t){if(t==null)({network:this.network,mask:this.mask}=Ohe(e));else{const n=lm(e);if(n==null)throw new Error("Failed to parse network");t=String(t);const i=parseInt(t,10);if(Number.isNaN(i)||String(i).length!==t.length||i<0||i>n.length*8){const s=lm(t);if(s==null)throw new Error("Failed to parse mask");this.mask=s}else this.mask=fO(i,8*n.length);this.network=hO(n,this.mask)}}contains(e){return Mhe({network:this.network,mask:this.mask},e)}toString(){const e=Dhe(this.mask),t=e!==-1?String(e):$he(this.mask);return Phe(this.network)+"/"+t}}function Rhe(r,e){return new pO(r).contains(e)}function Lhe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function G7(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Bhe(r){return new TextEncoder().encode(r)}function Uhe(r){return new TextDecoder().decode(r)}function Fhe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var zhe=Fhe,Vhe=zhe;let Khe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},jhe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return gO(this,e)}},Hhe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return gO(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function gO(r,e){return new Hhe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let qhe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Khe(e,t,n),this.decoder=new jhe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function vm({name:r,prefix:e,encode:t,decode:n}){return new qhe(r,e,t,n)}function ep({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Vhe(t,r);return vm({prefix:e,name:r,encode:n,decode:s=>G7(i(s))})}function Whe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Ghe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function xr({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return vm({prefix:e,name:r,encode(i){return Ghe(i,n,t)},decode(i){return Whe(i,n,t,r)}})}const Ql=xr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Qhe=xr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Jhe=xr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Yhe=xr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Xhe=xr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Zhe=xr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),efe=xr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),tfe=xr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),rfe=xr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),nfe=Object.freeze(Object.defineProperty({__proto__:null,base32:Ql,base32hex:Xhe,base32hexpad:efe,base32hexpadupper:tfe,base32hexupper:Zhe,base32pad:Jhe,base32padupper:Yhe,base32upper:Qhe,base32z:rfe},Symbol.toStringTag,{value:"Module"})),is=ep({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ife=ep({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),sfe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:is,base58flickr:ife},Symbol.toStringTag,{value:"Module"})),ofe=ep({prefix:"9",name:"base10",alphabet:"0123456789"}),afe=Object.freeze(Object.defineProperty({__proto__:null,base10:ofe},Symbol.toStringTag,{value:"Module"})),cfe=xr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),lfe=xr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),ufe=Object.freeze(Object.defineProperty({__proto__:null,base16:cfe,base16upper:lfe},Symbol.toStringTag,{value:"Module"})),dfe=xr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),hfe=Object.freeze(Object.defineProperty({__proto__:null,base2:dfe},Symbol.toStringTag,{value:"Module"})),yO=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),ffe=yO.reduce((r,e,t)=>(r[t]=e,r),[]),pfe=yO.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function gfe(r){return r.reduce((e,t)=>(e+=ffe[t],e),"")}function yfe(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const i=pfe[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const mfe=vm({prefix:"🚀",name:"base256emoji",encode:gfe,decode:yfe}),wfe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:mfe},Symbol.toStringTag,{value:"Module"})),Em=ep({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),bfe=ep({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),vfe=Object.freeze(Object.defineProperty({__proto__:null,base36:Em,base36upper:bfe},Symbol.toStringTag,{value:"Module"})),Efe=xr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Sfe=xr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),xfe=xr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Afe=xr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Cfe=Object.freeze(Object.defineProperty({__proto__:null,base64:Efe,base64pad:Sfe,base64url:xfe,base64urlpad:Afe},Symbol.toStringTag,{value:"Module"})),Ife=xr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),kfe=Object.freeze(Object.defineProperty({__proto__:null,base8:Ife},Symbol.toStringTag,{value:"Module"})),_fe=vm({prefix:"\0",name:"identity",encode:r=>Uhe(r),decode:r=>Bhe(r)}),Tfe=Object.freeze(Object.defineProperty({__proto__:null,identity:_fe},Symbol.toStringTag,{value:"Module"}));new TextEncoder,new TextDecoder;var Pfe=wO,mO=128,Dfe=-128,$fe=Math.pow(2,31);function wO(r,e,t){e=e||[],t=t||0;for(var n=t;r>=$fe;)e[t++]=r&255|mO,r/=128;for(;r&Dfe;)e[t++]=r&255|mO,r>>>=7;return e[t]=r|0,wO.bytes=t-n+1,e}var Nfe=Q7,Mfe=128,bO=127;function Q7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Q7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&bO)<<i:(o&bO)*Math.pow(2,i),i+=7}while(o>=Mfe);return Q7.bytes=s-n,t}var Ofe=Math.pow(2,7),Rfe=Math.pow(2,14),Lfe=Math.pow(2,21),Bfe=Math.pow(2,28),Ufe=Math.pow(2,35),Ffe=Math.pow(2,42),zfe=Math.pow(2,49),Vfe=Math.pow(2,56),Kfe=Math.pow(2,63),jfe=function(r){return r<Ofe?1:r<Rfe?2:r<Lfe?3:r<Bfe?4:r<Ufe?5:r<Ffe?6:r<zfe?7:r<Vfe?8:r<Kfe?9:10},Hfe={encode:Pfe,decode:Nfe,encodingLength:jfe},Sm=Hfe;function J7(r,e=0){return[Sm.decode(r,e),Sm.decode.bytes]}function xm(r,e,t=0){return Sm.encode(r,e,t),e}function Am(r){return Sm.encodingLength(r)}function qfe(r,e){const t=e.byteLength,n=Am(r),i=n+Am(t),s=new Uint8Array(i+t);return xm(r,s,0),xm(t,s,n),s.set(e,i),new Y7(r,t,e,s)}function vO(r){const e=G7(r),[t,n]=J7(e),[i,s]=J7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Y7(t,i,o,e)}function Wfe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Lhe(r.bytes,t.bytes)}}let Y7=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function EO(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Qfe(t,X7(r),e??is.encoder);default:return Jfe(t,X7(r),e??Ql.encoder)}}const SO=new WeakMap;function X7(r){const e=SO.get(r);if(e==null){const t=new Map;return SO.set(r,t),t}return e}let xO=class Xr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Rj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==tp)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Yfe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Xr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=qfe(e,t);return Xr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Xr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Wfe(e.multihash,n.multihash)}toString(e){return EO(this,e)}toJSON(){return{"/":EO(this)}}link(){return this}[(Rj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Xr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Xr(n,i,s,o??AO(n,i,s.bytes))}else if(t[Xfe]===!0){const{version:n,multihash:i,code:s}=t,o=vO(i);return Xr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==tp)throw new Error(`Version 0 CID must use dag-pb (code: ${tp}) block encoding`);return new Xr(e,t,n,n.bytes)}case 1:{const i=AO(e,t,n.bytes);return new Xr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Xr.create(0,tp,e)}static createV1(e,t){return Xr.create(1,e,t)}static decode(e){const[t,n]=Xr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Xr.inspectBytes(e),n=t.size-t.multihashSize,i=G7(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new Y7(t.multihashCode,t.digestSize,s,i);return[t.version===0?Xr.createV0(o):Xr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=J7(e.subarray(t));return t+=p,h};let i=n(),s=tp;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Gfe(e,t),s=Xr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return X7(s).set(n,e),s}};function Gfe(r,e){switch(r[0]){case"Q":{const t=e??is;return[is.prefix,t.decode(`${is.prefix}${r}`)]}case is.prefix:{const t=e??is;return[is.prefix,t.decode(r)]}case Ql.prefix:{const t=e??Ql;return[Ql.prefix,t.decode(r)]}case Em.prefix:{const t=e??Em;return[Em.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Qfe(r,e,t){const{prefix:n}=t;if(n!==is.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Jfe(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const tp=112,Yfe=18;function AO(r,e,t){const n=Am(r),i=n+Am(e),s=new Uint8Array(i+t.byteLength);return xm(r,s,0),xm(e,s,n),s.set(t,i),s}const Xfe=Symbol.for("@ipld/js-cid/CID"),Zfe={...Tfe,...hfe,...kfe,...afe,...ufe,...nfe,...vfe,...sfe,...Cfe,...wfe},CO=Yd,e1e=U7,IO=function(r){let e=0;if(r=r.toString().trim(),CO(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(e1e(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const s=CO(t[n]);let o;s&&(o=IO(t[n]),t[n]=re(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,re(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const s=[n,1];for(n=9-t.length;n>0;n--)s.push("0");t.splice.apply(t,s)}const i=new Uint8Array(e+16);for(n=0;n<t.length;n++){const s=parseInt(t[n],16);i[e++]=s>>8&255,i[e++]=s&255}return i}throw new Error("invalid ip address")},t1e=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const i=[];for(let s=0;s<t;s++)i.push(r[e+s]);return i.join(".")}if(t===16){const i=[];for(let s=0;s<t;s+=2)i.push(n.getUint16(e+s).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},ai=-1,rp={},Z7={};[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,ai,"ip6zone"],[43,8,"ipcidr"],[53,ai,"dns",!0],[54,ai,"dns4",!0],[55,ai,"dns6",!0],[56,ai,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,ai,"unix",!1,!0],[421,ai,"ipfs"],[421,ai,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,ai,"garlic64"],[448,0,"tls"],[449,ai,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,ai,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,ai,"http-path"],[777,ai,"memory"]].forEach(r=>{const e=r1e(...r);Z7[e.code]=e,rp[e.name]=e});function r1e(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:!!n,path:!!i}}function Ve(r){if(typeof r=="number"){if(Z7[r]!=null)return Z7[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(rp[r]!=null)return rp[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}const n1e=Ve("ip4"),i1e=Ve("ip6"),s1e=Ve("ipcidr");function e9(r,e){switch(Ve(r).code){case 4:case 41:return c1e(e);case 42:return i9(e);case 43:return re(e,"base10");case 6:case 273:case 33:case 132:return TO(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return i9(e);case 421:return h1e(e);case 444:return PO(e);case 445:return PO(e);case 466:return d1e(e);case 481:return globalThis.encodeURIComponent(i9(e));default:return re(e,"base16")}}function kO(r,e){switch(Ve(r).code){case 4:return _O(e);case 41:return _O(e);case 42:return n9(e);case 43:return oe(e,"base10");case 6:case 273:case 33:case 132:return r9(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return n9(e);case 421:return l1e(e);case 444:return f1e(e);case 445:return p1e(e);case 466:return u1e(e);case 481:return n9(globalThis.decodeURIComponent(e));default:return oe(e,"base16")}}function o1e(r){let e,t;if(r.stringTuples().forEach(([n,i])=>{(n===n1e.code||n===i1e.code)&&(t=i),n===s1e.code&&(e=i)}),e==null||t==null)throw new Error("Invalid multiaddr");return new pO(t,e)}const t9=Object.values(Zfe).map(r=>r.decoder),a1e=function(){let r=t9[0].or(t9[1]);return t9.slice(2).forEach(e=>r=r.or(e)),r}();function _O(r){if(!JM(r))throw new Error("invalid ip address");return IO(r)}function c1e(r){const e=t1e(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!JM(e))throw new Error("invalid ip address");return e}function r9(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function TO(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function n9(r){const e=oe(r),t=Uint8Array.from(Sr(e.length));return or([t,e],t.length+e.length)}function i9(r){const e=es(r);if(r=r.slice(yt(e)),r.length!==e)throw new Error("inconsistent lengths");return re(r)}function l1e(r){let e;r[0]==="Q"||r[0]==="1"?e=vO(is.decode(`z${r}`)).bytes:e=xO.parse(r).multihash.bytes;const t=Uint8Array.from(Sr(e.length));return or([t,e],t.length+e.length)}function u1e(r){const e=a1e.decode(r),t=Uint8Array.from(Sr(e.length));return or([t,e],t.length+e.length)}function d1e(r){const e=es(r),t=r.slice(yt(e));if(t.length!==e)throw new Error("inconsistent lengths");return"u"+re(t,"base64url")}function h1e(r){const e=es(r),t=r.slice(yt(e));if(t.length!==e)throw new Error("inconsistent lengths");return re(t,"base58btc")}function f1e(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Ql.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=r9(n);return or([t,i],t.length+i.length)}function p1e(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=Ql.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=r9(n);return or([t,i],t.length+i.length)}function PO(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=re(e,"base32"),i=TO(t);return`${n}:${i}`}function g1e(r){r=s9(r);const e=[],t=[];let n=null;const i=r.split("/").slice(1);if(i.length===1&&i[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<i.length;s++){const o=i[s],a=Ve(o);if(a.size===0){e.push([a.code]),t.push([a.code]);continue}if(s++,s>=i.length)throw new o9("invalid address: "+r);if(a.path===!0){n=s9(i.slice(s).join("/")),e.push([a.code,kO(a.code,n)]),t.push([a.code,n]);break}const c=kO(a.code,i[s]);e.push([a.code,c]),t.push([a.code,e9(a.code,c)])}return{string:$O(t),bytes:NO(e),tuples:e,stringTuples:t,path:n}}function DO(r){const e=[],t=[];let n=null,i=0;for(;i<r.length;){const s=es(r,i),o=yt(s),a=Ve(s),c=y1e(a,r.slice(i+o));if(c===0){e.push([s]),t.push([s]),i+=o;continue}const l=r.slice(i+o,i+o+c);if(i+=c+o,i>r.length)throw new o9("Invalid address Uint8Array: "+re(r,"base16"));e.push([s,l]);const d=e9(s,l);if(t.push([s,d]),a.path===!0){n=d;break}}return{bytes:Uint8Array.from(r),string:$O(t),tuples:e,stringTuples:t,path:n}}function $O(r){const e=[];return r.map(t=>{const n=Ve(t[0]);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),s9(e.join("/"))}function NO(r){return or(r.map(e=>{const t=Ve(e[0]);let n=Uint8Array.from(Sr(t.code));return e.length>1&&e[1]!=null&&(n=or([n,e[1]])),n}))}function y1e(r,e){if(r.size>0)return r.size/8;if(r.size===0)return 0;{const t=es(e instanceof Uint8Array?e:Uint8Array.from(e));return t+yt(t)}}function s9(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}class o9 extends Error{constructor(t){super(`Error parsing address: ${t}`);u(this,"name","ParseError")}}u(o9,"name","ParseError");const m1e=Symbol.for("nodejs.util.inspect.custom"),MO=Symbol.for("@multiformats/js-multiaddr/multiaddr"),w1e=[Ve("dns").code,Ve("dns4").code,Ve("dns6").code,Ve("dnsaddr").code];class b1e extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}const Yh=class Yh{constructor(e){u(this,"bytes");Ye(this,Jh);Ye(this,qc);Ye(this,p0);Ye(this,g0);u(this,Lj,!0);e==null&&(e="");let t;if(e instanceof Uint8Array)t=DO(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=g1e(e)}else if(Cm(e))t=DO(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,_t(this,Jh,t.string),_t(this,qc,t.tuples),_t(this,p0,t.stringTuples),_t(this,g0,t.path)}toString(){return ae(this,Jh)}toJSON(){return this.toString()}toOptions(){let e,t,n,i,s="";const o=Ve("tcp"),a=Ve("udp"),c=Ve("ip4"),l=Ve("ip6"),d=Ve("dns6"),h=Ve("ip6zone");for(const[b,f]of this.stringTuples())b===h.code&&(s=`%${f??""}`),w1e.includes(b)&&(t=o.name==="tcp"?"tcp":"udp",i=443,n=`${f??""}${s}`,e=b===d.code?6:4),(b===o.code||b===a.code)&&(t=Ve(b).name==="tcp"?"tcp":"udp",i=parseInt(f??"")),(b===c.code||b===l.code)&&(t=Ve(b).name==="tcp"?"tcp":"udp",n=`${f??""}${s}`,e=b===l.code?6:4);if(e==null||t==null||n==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:i}}protos(){return ae(this,qc).map(([e])=>Object.assign({},Ve(e)))}protoCodes(){return ae(this,qc).map(([e])=>e)}protoNames(){return ae(this,qc).map(([e])=>Ve(e).name)}tuples(){return ae(this,qc).map(([e,t])=>t==null?[e]:[e,t])}stringTuples(){return ae(this,p0).map(([e,t])=>t==null?[e]:[e,t])}encapsulate(e){return e=new Yh(e),new Yh(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Yh(n.slice(0,i))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new Yh(NO(t.slice(0,n)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([n,i])=>{n===rp.p2p.code&&e.push([n,i]),n===rp["p2p-circuit"].code&&(e=[])});const t=e.pop();if((t==null?void 0:t[1])!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?re(is.decode(`z${n}`),"base58btc"):re(xO.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return ae(this,g0)}equals(e){return We(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(s=>s.resolvable);if(t==null)return[this];const n=c9.get(t.name);if(n==null)throw new b1e(`no available resolver for ${t.name}`);return(await n(this,e)).map(s=>Re(s))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(Lj=MO,m1e)](){return`Multiaddr(${ae(this,Jh)})`}};Jh=new WeakMap,qc=new WeakMap,p0=new WeakMap,g0=new WeakMap;let a9=Yh;const c9=new Map;function Cm(r){return!!(r!=null&&r[MO])}function Re(r){return new a9(r)}const v1e=[Ve("tcp").code,Ve("dns").code,Ve("dnsaddr").code,Ve("dns4").code,Ve("dns6").code];function OO(r){var e;return(e=LO("sni",r))==null?void 0:e[1]}function RO(r){var t;const e=(t=LO("tcp",r))==null?void 0:t[1];return e==null?"":`:${e}`}function LO(r,e){let t;try{t=Ve(r).code}catch{return}for(const[n,i]of e)if(n===t&&i!=null)return[n,i]}function BO(r){return r.some(([e,t])=>e===Ve("tls").code)}function ss(r,e,t){const n=UO[Ve(r).name];if(n==null)throw new Error(`Can't interpret protocol ${Ve(r).name}`);const i=n(e,t);return r===Ve("ip6").code?`[${i}]`:i}const UO={ip4:(r,e)=>r,ip6:(r,e)=>e.length===0?r:`[${r}]`,tcp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`tcp://${ss(t[0],t[1]??"",e)}:${r}`},udp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`udp://${ss(t[0],t[1]??"",e)}:${r}`},dnsaddr:(r,e)=>r,dns4:(r,e)=>r,dns6:(r,e)=>r,dns:(r,e)=>r,ipfs:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${ss(t[0],t[1]??"",e)}`},p2p:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${ss(t[0],t[1]??"",e)}`},http:(r,e)=>{const t=BO(e),n=OO(e),i=RO(e);if(t&&n!=null)return`https://${n}${i}`;const s=t?"https://":"http://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=ss(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${s}${a}`},"http-path":(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");const n=ss(t[0],t[1]??"",e),i=decodeURIComponent(r);return`${n}/${i}`},tls:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return ss(t[0],t[1]??"",e)},sni:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return ss(t[0],t[1]??"",e)},https:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=ss(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`https://${n}`},ws:(r,e)=>{const t=BO(e),n=OO(e),i=RO(e);if(t&&n!=null)return`wss://${n}${i}`;const s=t?"wss://":"ws://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=ss(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${s}${a}`},wss:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=ss(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`wss://${n}`}};function FO(r,e){const n=Re(r).stringTuples(),i=n.pop();if(i==null)throw new Error("Unexpected end of multiaddr");const s=Ve(i[0]),o=UO[s.name];if(o==null)throw new Error(`No interpreter found for ${s.name}`);let a=o(i[1]??"",n);return v1e.includes(i[0])&&(a=a.replace(/^.*:\/\//,""),i[1]==="443"?a=`https://${a}`:a=`http://${a}`),(a.startsWith("http://")||a.startsWith("https://")||a.startsWith("ws://")||a.startsWith("wss://"))&&(a=new URL(a).toString(),a.endsWith("/")&&(a=a.substring(0,a.length-1))),a}let E1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},S1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return zO(this,e)}},x1e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return zO(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function zO(r,e){return new x1e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let A1e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new E1e(e,t,n),this.decoder=new S1e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function C1e({name:r,prefix:e,encode:t,decode:n}){return new A1e(r,e,t,n)}function I1e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function k1e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Im({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return C1e({prefix:e,name:r,encode(i){return k1e(i,n,t)},decode(i){return I1e(i,n,t,r)}})}const _1e=Im({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Im({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Im({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Im({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});class T1e{constructor(e,{logger:t,transformRequestInit:n}){Ye(this,K4);u(this,"url");Ye(this,Iu,0);Ye(this,ku,0);Ye(this,Xh,0);Ye(this,Zh,0);Ye(this,_u,new Map);u(this,"log");u(this,"transformRequestInit");this.url=e instanceof URL?e:new URL(e),this.transformRequestInit=n,this.log=t.forComponent(`helia:trustless-gateway-block-broker:${this.url.hostname}`)}async getRawBlock(e,t){const n=new URL(this.url.toString());if(n.pathname=`/ipfs/${e.toString()}`,n.search="?format=raw",(t==null?void 0:t.aborted)===!0)throw new Error(`Signal to fetch raw block for CID ${e} from gateway ${this.url} was aborted prior to fetch`);const i=Ie(this,K4,nq).call(this,e),s=new AbortController,o=()=>{s.abort()};t==null||t.addEventListener("abort",o);try{let a=ae(this,_u).get(i);if(a==null){ro(this,Iu)._++;const c={signal:s.signal,headers:{Accept:"application/vnd.ipld.raw"},cache:"force-cache"},l=this.transformRequestInit!=null?await this.transformRequestInit(c):c;a=fetch(n.toString(),l).then(async d=>{if(this.log("GET %s %d",n,d.status),!d.ok)throw ro(this,ku)._++,new Error(`unable to fetch raw block for CID ${e} from gateway ${this.url}`);return ro(this,Zh)._++,new Uint8Array(await d.arrayBuffer())}),ae(this,_u).set(i,a)}return await a}catch{throw(t==null?void 0:t.aborted)===!0?new Error(`fetching raw block for CID ${e} from gateway ${this.url} was aborted`):(ro(this,ku)._++,new Error(`unable to fetch raw block for CID ${e}`))}finally{t==null||t.removeEventListener("abort",o),ae(this,_u).delete(i)}}reliability(){return ae(this,Iu)===0?1:ae(this,Xh)>0?-1/0:ae(this,Zh)/(ae(this,Iu)+ae(this,ku)*3)}incrementInvalidBlocks(){ro(this,Xh)._++}getStats(){return{attempts:ae(this,Iu),errors:ae(this,ku),invalidBlocks:ae(this,Xh),successes:ae(this,Zh),pendingResponses:ae(this,_u).size}}}Iu=new WeakMap,ku=new WeakMap,Xh=new WeakMap,Zh=new WeakMap,_u=new WeakMap,K4=new WeakSet,nq=function(e){const t=e.multihash.bytes;return _1e.encode(t)};function P1e(r,e,t){return r.filter(n=>{if(Ihe.matches(n)||e&&Ahe.matches(n))return t||tO.matches(n)?!0:vc(n.toOptions().host)===!1;if(!e&&t){const{host:i}=n.toOptions();if(i==="127.0.0.1"||i==="localhost"||i.endsWith(".localhost"))return!0}return!1})}async function*VO(r,e,t,n,i,s={}){for await(const o of e.findProviders(r,s)){const a=P1e(o.multiaddrs,n,i);if(a.length===0)continue;const c=FO(a[0]);yield new T1e(c,{logger:t,transformRequestInit:s.transformRequestInit})}}class D1e extends jM{constructor(t,n){super(t,{...n,name:"helia:trustless-gateway:session"});u(this,"routing");u(this,"allowInsecure");u(this,"allowLocal");u(this,"transformRequestInit");this.routing=t.routing,this.allowInsecure=n.allowInsecure??KO,this.allowLocal=n.allowLocal??jO,this.transformRequestInit=n.transformRequestInit}async queryProvider(t,n,i){var o;this.log("fetching BLOCK for %c from %s",t,n.url);const s=await n.getRawBlock(t,i.signal);return this.log.trace("got block for %c from %s",t,n.url),await((o=i.validateFn)==null?void 0:o.call(i,s)),s}async*findNewProviders(t,n={}){yield*VO(t,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...n,transformRequestInit:this.transformRequestInit})}toEvictionKey(t){return t.url.toString()}equals(t,n){return t.url.toString()===n.url.toString()}}function $1e(r,e){return new D1e(r,e)}class N1e{constructor(e,t={}){u(this,"allowInsecure");u(this,"allowLocal");u(this,"transformRequestInit");u(this,"routing");u(this,"log");u(this,"logger");this.log=e.logger.forComponent("helia:trustless-gateway-block-broker"),this.logger=e.logger,this.routing=e.routing,this.allowInsecure=t.allowInsecure??KO,this.allowLocal=t.allowLocal??jO,this.transformRequestInit=t.transformRequestInit}async retrieve(e,t={}){var i,s;const n=[];for await(const o of VO(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...t,transformRequestInit:this.transformRequestInit})){this.log("getting block for %c from %s",e,o.url);try{const a=await o.getRawBlock(e,t.signal);this.log.trace("got block for %c from %s",e,o.url);try{await((i=t.validateFn)==null?void 0:i.call(t,a))}catch(c){this.log.error("failed to validate block for %c from %s",e,o.url,c);continue}return a}catch(a){if(this.log.error("failed to get block for %c from %s",e,o.url,a),a instanceof Error?n.push(a):n.push(new Error(`Unable to fetch raw block for CID ${e} from gateway ${o.url}`)),((s=t.signal)==null?void 0:s.aborted)===!0){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",e,o.url);break}}}throw n.length>0?new AggregateError(n,`Unable to fetch raw block for CID ${e} from any gateway`):new Error(`Unable to fetch raw block for CID ${e} from any gateway`)}createSession(e={}){return $1e({logger:this.logger,routing:this.routing},{...e,allowLocal:this.allowLocal,allowInsecure:this.allowInsecure,transformRequestInit:this.transformRequestInit})}}const KO=!1,jO=!1;function M1e(r={}){return e=>new N1e(e,r)}async function*HO(r,e={}){const t=r.getReader();try{for(;;){const n=await t.read();if(n.done)return;yield n.value}}finally{e.preventCancel!==!0&&await t.cancel(),t.releaseLock()}}var qO={exports:{}};(function(r){(function(){r.exports=v;var e=86400,t=3200,n=146097*t/400,i=e*n,s=1e3*i,o=864e13,a=4294967296,c=1e6,l="000000000",d=Math.trunc||function(T){var L=T-T%1;return L==0&&(T<0||T===0&&1/T!=1/0)?-0:L},h=v.prototype,p=(v.fromDate=function(T){return new v(+T)},v.fromInt64BE=A(0,1,2,3,0,4),v.fromInt64LE=A(3,2,1,0,4,0),v.fromString=function(B){var L,z=new v,B=(B+="").replace(/^\s*[+\-]?\d+/,function(j){var j=+j,q=1970+(j-1970)%400;return z.year=j-q,q}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(G,j,q){return j<0&&(q*=-1),L=6e4*(60*+j+ +q),""}).replace(/\.\d+$/,function(G){return z.nano=+(G+l).substr(1,9),""}).split(/\D+/);if(1<B.length?B[1]--:B[1]=0,z.time=L=Date.UTC.apply(Date,B)-(L||0),isNaN(L))throw new TypeError("Invalid Date");return y(z)},v.fromTimeT=function(T){return m(T,0)},h.year=0,h.time=0,h.nano=0,h.addNano=function(T){return this.nano+=+T||0,this},h.getNano=function(){var T=y(this);return(T.time%1e3*c+ +T.nano+1e9)%1e9},h.getTimeT=function(){var L=y(this),T=Math.floor(L.time/1e3),L=L.year;return L&&(T+=L*n*e/t),T},h.getYear=function(){return this.toDate().getUTCFullYear()+this.year},h.toDate=function(){return w(y(this).time)},h.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},h.toString=function(T){var L=this,z=L.toDate(),B={H:function(){return x(z.getUTCHours())},L:function(){return I(z.getUTCMilliseconds(),3)},M:function(){return x(z.getUTCMinutes())},N:function(){return I(L.getNano(),9)},S:function(){return x(z.getUTCSeconds())},Y:function(){var G=L.getYear();return 999999<G?"+"+G:9999<G?"+"+I(G,6):0<=G?I(G,4):-999999<=G?"-"+I(-G,6):G},a:function(){return f[z.getUTCDay()]},b:function(){return b[z.getUTCMonth()]},d:function(){return x(z.getUTCDate())},e:function(){return function(G){return(9<G?"":" ")+(0|G)}(z.getUTCDate())},m:function(){return x(z.getUTCMonth()+1)}};return function G(j){return j.replace(/%./g,function(q){var K=q[1],Q=g[K],K=B[K];return Q?G(Q):K?K():q})}(T||p)},h.writeInt64BE=E(0,1,2,3,0,4),h.writeInt64LE=E(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return v;function v(T,L,z){var B=this;if(!(B instanceof v))return new v(T,L,z);B.time=+T||0,B.nano=+L||0,B.year=+z||0,y(B)}function y(T){var L,z,B,G=T.year,j=T.time,q=T.nano,Q=((q<0||c<=q)&&(q-=(z=Math.floor(q/c))*c,j+=z,z=1),G%t);return(j<-864e13||o<j||Q)&&((L=d(j/s))&&(G+=L*t,j-=L*s),(B=w(j)).setUTCFullYear(Q+B.getUTCFullYear()),B=(j=+B)+(L=d((G-=Q)/t))*s,L&&-864e13<=B&&B<=o&&(G-=L*t,j=B),z=1),z&&(T.year=G,T.time=j,T.nano=q),T}function w(T){var L=new Date(0);return L.setTime(T),L}function m(G,B){G=+G||0;var z=d((B=(B|0)*a)/i)+d(G/i),B=B%i+G%i,G=d(B/i);return G&&(z+=G,B-=G*i),new v(1e3*B,0,z*t)}function E(T,L,z,B,G,j){return function(Q,K){var U=y(this);Q=Q||new Array(8),k(Q,K|=0);var W=Math.floor(U.time/1e3),U=U.year*(n*e/t),O=d(U/a)+d(W/a),U=U%a+W%a,W=Math.floor(U/a);return W&&(O+=W,U-=W*a),q(Q,K+G,O),q(Q,K+j,U),Q};function q(Q,K,O){Q[K+T]=O>>24&255,Q[K+L]=O>>16&255,Q[K+z]=O>>8&255,Q[K+B]=255&O}}function A(T,L,z,B,G,j){return function(Q,K){k(Q,K|=0);var O=q(Q,K+G);return m(q(Q,K+j),O)};function q(Q,K){return 16777216*Q[K+T]+(Q[K+L]<<16|Q[K+z]<<8|Q[K+B])}}function k(T,L){if(T=T&&T.length,T==null)throw new TypeError("Invalid Buffer");if(T<L+8)throw new RangeError("Out of range")}function x(T){return(9<T?"":"0")+(0|T)}function I(T,L){return(l+(0|T)).substr(-L)}})()})(qO);var O1e=qO.exports;const l9=Xe(O1e);class Sc extends Error{constructor(e="Record signature verification failed"){super(e),this.name="SignatureVerificationError"}}u(Sc,"name","SignatureVerificationError");class WO extends Error{constructor(e="Record has expired"){super(e),this.name="RecordExpiredError"}}u(WO,"name","RecordExpiredError");class u9 extends Error{constructor(e="The validity type is unsupported"){super(e),this.name="UnsupportedValidityError"}}u(u9,"name","UnsupportedValidityError");class GO extends Error{constructor(e="The record is too large"){super(e),this.name="RecordTooLargeError"}}u(GO,"name","RecordTooLargeError");class QO extends Error{constructor(e="Value must be a valid content path starting with /"){super(e),this.name="InvalidValueError"}}u(QO,"name","InvalidValueError");class JO extends Error{constructor(e="Invalid record data"){super(e),this.name="InvalidRecordDataError"}}u(JO,"name","InvalidRecordDataError");class d9 extends Error{constructor(e="Invalid embedded public key"){super(e),this.name="InvalidEmbeddedPublicKeyError"}}u(d9,"name","InvalidEmbeddedPublicKeyError");var os;(function(r){(function(n){n.EOL="EOL"})(r.ValidityType||(r.ValidityType={}));let e;(function(n){n[n.EOL=0]="EOL"})(e||(e={})),function(n){n.codec=()=>kn(e)}(r.ValidityType||(r.ValidityType={}));let t;r.codec=()=>(t==null&&(t=$e((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.value!=null&&(i.uint32(10),i.bytes(n.value)),n.signatureV1!=null&&(i.uint32(18),i.bytes(n.signatureV1)),n.validityType!=null&&(i.uint32(24),r.ValidityType.codec().encode(n.validityType,i)),n.validity!=null&&(i.uint32(34),i.bytes(n.validity)),n.sequence!=null&&(i.uint32(40),i.uint64(n.sequence)),n.ttl!=null&&(i.uint32(48),i.uint64(n.ttl)),n.pubKey!=null&&(i.uint32(58),i.bytes(n.pubKey)),n.signatureV2!=null&&(i.uint32(66),i.bytes(n.signatureV2)),n.data!=null&&(i.uint32(74),i.bytes(n.data)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.value=n.bytes();break}case 2:{o.signatureV1=n.bytes();break}case 3:{o.validityType=r.ValidityType.codec().decode(n);break}case 4:{o.validity=n.bytes();break}case 5:{o.sequence=n.uint64();break}case 6:{o.ttl=n.uint64();break}case 7:{o.pubKey=n.bytes();break}case 8:{o.signatureV2=n.bytes();break}case 9:{o.data=n.bytes();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>De(n,r.codec()),r.decode=(n,i)=>Pe(n,r.codec(),i)})(os||(os={}));function R1e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function h9(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function L1e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var B1e=L1e,U1e=B1e;let F1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},z1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return YO(this,e)}},V1e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return YO(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function YO(r,e){return new V1e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let K1e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new F1e(e,t,n),this.decoder=new z1e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function XO({name:r,prefix:e,encode:t,decode:n}){return new K1e(r,e,t,n)}function km({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=U1e(t,r);return XO({prefix:e,name:r,encode:n,decode:s=>h9(i(s))})}function j1e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function H1e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Lo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return XO({prefix:e,name:r,encode(i){return H1e(i,n,t)},decode(i){return j1e(i,n,t,r)}})}const f9=km({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});km({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const _m=Lo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Lo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Lo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Lo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Lo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Lo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Lo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Lo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Lo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const xc=km({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});km({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var q1e=eR,ZO=128,W1e=-128,G1e=Math.pow(2,31);function eR(r,e,t){e=e||[],t=t||0;for(var n=t;r>=G1e;)e[t++]=r&255|ZO,r/=128;for(;r&W1e;)e[t++]=r&255|ZO,r>>>=7;return e[t]=r|0,eR.bytes=t-n+1,e}var Q1e=p9,J1e=128,tR=127;function p9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw p9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&tR)<<i:(o&tR)*Math.pow(2,i),i+=7}while(o>=J1e);return p9.bytes=s-n,t}var Y1e=Math.pow(2,7),X1e=Math.pow(2,14),Z1e=Math.pow(2,21),epe=Math.pow(2,28),tpe=Math.pow(2,35),rpe=Math.pow(2,42),npe=Math.pow(2,49),ipe=Math.pow(2,56),spe=Math.pow(2,63),ope=function(r){return r<Y1e?1:r<X1e?2:r<Z1e?3:r<epe?4:r<tpe?5:r<rpe?6:r<npe?7:r<ipe?8:r<spe?9:10},ape={encode:q1e,decode:Q1e,encodingLength:ope},Tm=ape;function g9(r,e=0){return[Tm.decode(r,e),Tm.decode.bytes]}function Pm(r,e,t=0){return Tm.encode(r,e,t),e}function Dm(r){return Tm.encodingLength(r)}function cpe(r,e){const t=e.byteLength,n=Dm(r),i=n+Dm(t),s=new Uint8Array(i+t);return Pm(r,s,0),Pm(t,s,n),s.set(e,i),new y9(r,t,e,s)}function rR(r){const e=h9(r),[t,n]=g9(e),[i,s]=g9(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new y9(t,i,o,e)}function lpe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&R1e(r.bytes,t.bytes)}}let y9=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function nR(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return dpe(t,m9(r),e??xc.encoder);default:return hpe(t,m9(r),e??_m.encoder)}}const iR=new WeakMap;function m9(r){const e=iR.get(r);if(e==null){const t=new Map;return iR.set(r,t),t}return e}let sR=class Zr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Bj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==np)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==fpe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Zr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=cpe(e,t);return Zr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Zr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&lpe(e.multihash,n.multihash)}toString(e){return nR(this,e)}toJSON(){return{"/":nR(this)}}link(){return this}[(Bj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Zr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Zr(n,i,s,o??oR(n,i,s.bytes))}else if(t[ppe]===!0){const{version:n,multihash:i,code:s}=t,o=rR(i);return Zr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==np)throw new Error(`Version 0 CID must use dag-pb (code: ${np}) block encoding`);return new Zr(e,t,n,n.bytes)}case 1:{const i=oR(e,t,n.bytes);return new Zr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Zr.create(0,np,e)}static createV1(e,t){return Zr.create(1,e,t)}static decode(e){const[t,n]=Zr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Zr.inspectBytes(e),n=t.size-t.multihashSize,i=h9(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new y9(t.multihashCode,t.digestSize,s,i);return[t.version===0?Zr.createV0(o):Zr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=g9(e.subarray(t));return t+=p,h};let i=n(),s=np;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=upe(e,t),s=Zr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return m9(s).set(n,e),s}};function upe(r,e){switch(r[0]){case"Q":{const t=e??xc;return[xc.prefix,t.decode(`${xc.prefix}${r}`)]}case xc.prefix:{const t=e??xc;return[xc.prefix,t.decode(r)]}case _m.prefix:{const t=e??_m;return[_m.prefix,t.decode(r)]}case f9.prefix:{const t=e??f9;return[f9.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function dpe(r,e,t){const{prefix:n}=t;if(n!==xc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function hpe(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const np=112,fpe=18;function oR(r,e,t){const n=Dm(r),i=n+Dm(e),s=new Uint8Array(i+t.byteLength);return Pm(r,s,0),Pm(e,s,n),s.set(t,i),s}const ppe=Symbol.for("@ipld/js-cid/CID"),gpe=qd("ipns:utils"),aR=oe("/ipns/"),ype=0,mpe=18;function wpe(r){let e;if(r.pubKey!=null)try{e=_n(r.pubKey)}catch(t){throw gpe.error(t),t}if(e!=null)return e}function bpe(r){const e=oe("ipns-signature:");return or([e,r])}function cR(r){return"signatureV1"in r?os.encode({value:oe(r.value),signatureV1:r.signatureV1,validityType:r.validityType,validity:oe(r.validity),sequence:r.sequence,ttl:r.ttl,pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data}):os.encode({pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data})}function ip(r){const e=os.decode(r);if(e.sequence!=null&&(e.sequence=BigInt(e.sequence)),e.ttl!=null&&(e.ttl=BigInt(e.ttl)),e.signatureV2==null||e.data==null)throw new Sc("Missing data or signatureV2");const t=uR(e.data),n=vpe(t.Value),i=re(t.Validity);if(e.value!=null&&e.signatureV1!=null)return Epe(e),{value:n,validityType:os.ValidityType.EOL,validity:i,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV1:e.signatureV1,signatureV2:e.signatureV2,data:e.data};if(e.signatureV2!=null)return{value:n,validityType:os.ValidityType.EOL,validity:i,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}function lR(r){return or([aR,r.bytes])}function w9(r){const e=rR(r.slice(aR.length));if(!b9(e,ype)&&!b9(e,mpe))throw new R2("Multihash in IPNS key was not identity or sha2-256");return e}function uR(r){const e=Ua(r);if(e.ValidityType===0)e.ValidityType=os.ValidityType.EOL;else throw new u9("The validity type is unsupported");return Number.isInteger(e.Sequence)&&(e.Sequence=BigInt(e.Sequence)),Number.isInteger(e.TTL)&&(e.TTL=BigInt(e.TTL)),e}function vpe(r){const e=re(r).trim();if(e.startsWith("/"))return e;try{return`/ipfs/${sR.decode(r).toV1().toString()}`}catch{}try{return`/ipfs/${sR.parse(e).toV1().toString()}`}catch{}throw new QO("Value must be a valid content path starting with /")}function Epe(r){if(r.data==null)throw new JO("Record data is missing");const e=uR(r.data);if(!We(e.Value,r.value??new Uint8Array(0)))throw new Sc('Field "value" did not match between protobuf and CBOR');if(!We(e.Validity,r.validity??new Uint8Array(0)))throw new Sc('Field "validity" did not match between protobuf and CBOR');if(e.ValidityType!==r.validityType)throw new Sc('Field "validityType" did not match between protobuf and CBOR');if(e.Sequence!==r.sequence)throw new Sc('Field "sequence" did not match between protobuf and CBOR');if(e.TTL!==r.ttl)throw new Sc('Field "ttl" did not match between protobuf and CBOR')}function b9(r,e){return r.code===e}const $m=qd("ipns:validator"),Spe=1024*10,xpe=async(r,e)=>{const t=ip(e);let n;try{const i=bpe(t.data);n=await r.verify(i,t.signatureV2)}catch{n=!1}if(!n)throw $m.error("record signature verification failed"),new Sc("Record signature verification failed");if(t.validityType===os.ValidityType.EOL){if(l9.fromString(t.validity).toDate().getTime()<Date.now())throw $m.error("record has expired"),new WO("record has expired")}else if(t.validityType!=null)throw $m.error("the validity type is unsupported"),new u9("The validity type is unsupported");$m("ipns record for %s is valid",t.value)};async function dR(r,e){if(e.byteLength>Spe)throw new GO("The record is too large");const t=w9(r);let n;b9(t,0)&&(n=n$(t));const i=ip(e),s=wpe(i)??n;if(s==null)throw new d9("Could not extract public key from IPNS record or routing key");const o=lR(s.toMultihash());if(!We(o,r))throw new d9("Embedded public key did not match routing key");await xpe(s,e)}let Ape=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MESSAGE_LENGTH")}};async function*hR(r,e={}){const t=/\r?\n/,n=new TextDecoder("utf8");let i="";for await(let s of r){if(typeof s=="string"&&(s=new TextEncoder().encode(s)),w1(s)&&(s=s.subarray()),i+=n.decode(s,{stream:!0}),i.length>((e==null?void 0:e.maxMessageLength)??i.length))throw new Ape("Incoming message too long");const o=i.split(t);i=o.pop()??"";for(let a=0;a<o.length;a++)yield JSON.parse(o[a])}i+=n.decode(),i!==""&&(yield JSON.parse(i))}class Nm extends Error{constructor(e="Invalid request"){super(e),this.name="InvalidRequestError"}}u(Nm,"name","InvalidRequestError");class Bo extends Error{constructor(e="Bad response"){super(e),this.name="BadResponseError"}}u(Bo,"name","BadResponseError");function Cpe(r){return r[Symbol.asyncIterator]!=null}function Ipe(r){if(Cpe(r))return(async()=>{for await(const e of r)return e})();for(const e of r)return e}function kpe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function v9(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function _pe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var Tpe=_pe,Ppe=Tpe;let Dpe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},$pe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return fR(this,e)}},Npe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return fR(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function fR(r,e){return new Npe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Mpe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Dpe(e,t,n),this.decoder=new $pe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function pR({name:r,prefix:e,encode:t,decode:n}){return new Mpe(r,e,t,n)}function Mm({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Ppe(t,r);return pR({prefix:e,name:r,encode:n,decode:s=>v9(i(s))})}function Ope(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Rpe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Uo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return pR({prefix:e,name:r,encode(i){return Rpe(i,n,t)},decode(i){return Ope(i,n,t,r)}})}const Om=Uo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Uo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Uo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Uo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Uo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Uo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Uo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Uo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Uo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const E9=Mm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Mm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Ac=Mm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Mm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Lpe=yR,gR=128,Bpe=-128,Upe=Math.pow(2,31);function yR(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Upe;)e[t++]=r&255|gR,r/=128;for(;r&Bpe;)e[t++]=r&255|gR,r>>>=7;return e[t]=r|0,yR.bytes=t-n+1,e}var Fpe=S9,zpe=128,mR=127;function S9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw S9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&mR)<<i:(o&mR)*Math.pow(2,i),i+=7}while(o>=zpe);return S9.bytes=s-n,t}var Vpe=Math.pow(2,7),Kpe=Math.pow(2,14),jpe=Math.pow(2,21),Hpe=Math.pow(2,28),qpe=Math.pow(2,35),Wpe=Math.pow(2,42),Gpe=Math.pow(2,49),Qpe=Math.pow(2,56),Jpe=Math.pow(2,63),Ype=function(r){return r<Vpe?1:r<Kpe?2:r<jpe?3:r<Hpe?4:r<qpe?5:r<Wpe?6:r<Gpe?7:r<Qpe?8:r<Jpe?9:10},Xpe={encode:Lpe,decode:Fpe,encodingLength:Ype},Rm=Xpe;function x9(r,e=0){return[Rm.decode(r,e),Rm.decode.bytes]}function Lm(r,e,t=0){return Rm.encode(r,e,t),e}function Bm(r){return Rm.encodingLength(r)}function Zpe(r,e){const t=e.byteLength,n=Bm(r),i=n+Bm(t),s=new Uint8Array(i+t);return Lm(r,s,0),Lm(t,s,n),s.set(e,i),new A9(r,t,e,s)}function e0e(r){const e=v9(r),[t,n]=x9(e),[i,s]=x9(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new A9(t,i,o,e)}function t0e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&kpe(r.bytes,t.bytes)}}let A9=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function wR(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return n0e(t,C9(r),e??Ac.encoder);default:return i0e(t,C9(r),e??Om.encoder)}}const bR=new WeakMap;function C9(r){const e=bR.get(r);if(e==null){const t=new Map;return bR.set(r,t),t}return e}let vR=class en{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Uj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==sp)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==s0e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return en.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Zpe(e,t);return en.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return en.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&t0e(e.multihash,n.multihash)}toString(e){return wR(this,e)}toJSON(){return{"/":wR(this)}}link(){return this}[(Uj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof en)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new en(n,i,s,o??ER(n,i,s.bytes))}else if(t[o0e]===!0){const{version:n,multihash:i,code:s}=t,o=e0e(i);return en.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==sp)throw new Error(`Version 0 CID must use dag-pb (code: ${sp}) block encoding`);return new en(e,t,n,n.bytes)}case 1:{const i=ER(e,t,n.bytes);return new en(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return en.create(0,sp,e)}static createV1(e,t){return en.create(1,e,t)}static decode(e){const[t,n]=en.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=en.inspectBytes(e),n=t.size-t.multihashSize,i=v9(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new A9(t.multihashCode,t.digestSize,s,i);return[t.version===0?en.createV0(o):en.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=x9(e.subarray(t));return t+=p,h};let i=n(),s=sp;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=r0e(e,t),s=en.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return C9(s).set(n,e),s}};function r0e(r,e){switch(r[0]){case"Q":{const t=e??Ac;return[Ac.prefix,t.decode(`${Ac.prefix}${r}`)]}case Ac.prefix:{const t=e??Ac;return[Ac.prefix,t.decode(r)]}case Om.prefix:{const t=e??Om;return[Om.prefix,t.decode(r)]}case E9.prefix:{const t=e??E9;return[E9.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function n0e(r,e,t){const{prefix:n}=t;if(n!==Ac.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function i0e(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const sp=112,s0e=18;function ER(r,e,t){const n=Bm(r),i=n+Bm(e),s=new Uint8Array(i+t.byteLength);return Lm(r,s,0),Lm(e,s,n),s.set(t,i),s}const o0e=Symbol.for("@ipld/js-cid/CID"),SR=oe("/ipns/");function xR(r){return We(r.subarray(0,SR.byteLength),SR)}class a0e{constructor(e){u(this,"client");this.client=e}async*findProviders(e,t={}){yield*Fd(this.client.getProviders(e,t),n=>({id:n.ID,multiaddrs:n.Addrs??[]}))}async provide(){}async cancelReprovide(){}async put(e,t,n){if(!xR(e))return;const i=w9(e),s=vR.createV1(114,i),o=ip(t);await this.client.putIPNS(s,o,n)}async get(e,t){if(!xR(e))throw new Zt("Not found");const n=w9(e),i=vR.createV1(114,n);try{const s=await this.client.getIPNS(i,t);return cR(s)}catch(s){throw s.name==="BadResponseError"?new Zt("Not found"):s}}}class c0e{constructor(e){u(this,"client");this.client=e}async findPeer(e,t={}){const n=await Ipe(this.client.getPeers(e,t));if(n!=null)return{id:n.ID,multiaddrs:n.Addrs??[]};throw new Zt("Not found")}async*getClosestPeers(e,t={}){}}const gr=qd("delegated-routing-v1-http-api-client"),Um={concurrentRequests:4,timeout:3e4,cacheTTL:5*60*1e3,cacheName:"delegated-routing-v1-cache"};class l0e{constructor(e,t={}){Ye(this,wn);u(this,"started");u(this,"httpQueue");u(this,"shutDownController");u(this,"clientUrl");u(this,"timeout");u(this,"contentRouting");u(this,"peerRouting");u(this,"filterAddrs");u(this,"filterProtocols");u(this,"inFlightRequests");u(this,"cacheName");u(this,"cache");u(this,"cacheTTL");this.started=!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.httpQueue=new Ma({concurrency:t.concurrentRequests??Um.concurrentRequests}),this.inFlightRequests=new Map,this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=t.timeout??Um.timeout,this.filterAddrs=t.filterAddrs,this.filterProtocols=t.filterProtocols,this.contentRouting=new a0e(this),this.peerRouting=new c0e(this),this.cacheName=t.cacheName??Um.cacheName,this.cacheTTL=t.cacheTTL??Um.cacheTTL}get[Sd](){return this.contentRouting}get[xd](){return this.peerRouting}isStarted(){return this.started}async start(){var e;this.started||(this.started=!0,this.cacheTTL>0&&(this.cache=await((e=globalThis.caches)==null?void 0:e.open(this.cacheName)),this.cache!=null&&gr("cache enabled with ttl %d",this.cacheTTL)))}async stop(){var e;this.httpQueue.clear(),this.shutDownController.abort(),await((e=globalThis.caches)==null?void 0:e.delete(this.cacheName)),this.started=!1}async*getProviders(e,t={}){gr("getProviders starts: %c",e);const n=AbortSignal.timeout(this.timeout),i=pt([this.shutDownController.signal,n,t.signal]),s=Le(),o=Le();this.httpQueue.add(async()=>(s.resolve(),o.promise));try{await s.promise;const a=new URL(`${this.clientUrl}routing/v1/providers/${e.toString()}`);Ie(this,wn,GA).call(this,a,t.filterAddrs,t.filterProtocols);const c={headers:{Accept:"application/x-ndjson"},signal:i},l=await Ie(this,wn,w0).call(this,a.toString(),c);if(l==null)throw new Bo("No response received");if(!l.ok)throw l.status===404?new Zt("No matching records found"):l.status===422?new Nm("Request does not conform to schema or semantic constraints"):new Bo(`Unexpected status code: ${l.status}`);if(l.body==null)throw new Bo("Routing response had no body");const d=l.headers.get("Content-Type");if(d==null)throw new Bo("No Content-Type header received");if(d!=null&&d.startsWith("application/json")){const h=await l.json();for(const p of h.Providers){const b=Ie(this,wn,m0).call(this,p);b!=null&&(yield b)}}else if(d.includes("application/x-ndjson"))for await(const h of hR(HO(l.body))){const p=Ie(this,wn,m0).call(this,h);p!=null&&(yield p)}else throw new Bo(`Unsupported Content-Type: ${d}`)}catch(a){gr.error("getProviders errored:",a)}finally{i.clear(),o.resolve(),gr("getProviders finished: %c",e)}}async*getPeers(e,t={}){gr("getPeers starts: %c",e);const n=AbortSignal.timeout(this.timeout),i=pt([this.shutDownController.signal,n,t.signal]),s=Le(),o=Le();this.httpQueue.add(async()=>(s.resolve(),o.promise));try{await s.promise;const a=new URL(`${this.clientUrl}routing/v1/peers/${e.toCID().toString()}`);Ie(this,wn,GA).call(this,a,t.filterAddrs,t.filterProtocols);const c={headers:{Accept:"application/x-ndjson"},signal:i},l=await Ie(this,wn,w0).call(this,a.toString(),c);if(l.status===404)throw new Zt("No matching records found");if(l.status===422)throw new Nm("Request does not conform to schema or semantic constraints");if(l.body==null)throw new Bo("Routing response had no body");if(l.headers.get("Content-Type")==="application/json"){const h=await l.json();for(const p of h.Peers){const b=Ie(this,wn,m0).call(this,p);b!=null&&(yield b)}}else for await(const h of hR(HO(l.body))){const p=Ie(this,wn,m0).call(this,h);p!=null&&(yield p)}}catch(a){gr.error("getPeers errored:",a)}finally{i.clear(),o.resolve(),gr("getPeers finished: %c",e)}}async getIPNS(e,t={}){gr("getIPNS starts: %s",e);const n=AbortSignal.timeout(this.timeout),i=pt([this.shutDownController.signal,n,t.signal]),s=Le(),o=Le();this.httpQueue.add(async()=>(s.resolve(),o.promise));const a=`${this.clientUrl}routing/v1/ipns/${e}`;try{await s.promise;const c={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:i},l=await Ie(this,wn,w0).call(this,a,c);if(gr("getIPNS GET %s %d",a,l.status),l.status===404)throw new Zt("No matching records found");if(l.status===422)throw new Nm("Request does not conform to schema or semantic constraints");if(l.body==null)throw new Bo("GET ipns response had no body");const d=await l.arrayBuffer(),h=new Uint8Array(d,0,d.byteLength);return t.validate!==!1&&await dR(lR(e.multihash),h),ip(h)}catch(c){throw gr.error("getIPNS GET %s error:",a,c),c}finally{i.clear(),o.resolve(),gr("getIPNS finished: %s",e)}}async putIPNS(e,t,n={}){gr("putIPNS starts: %c",e);const i=AbortSignal.timeout(this.timeout),s=pt([this.shutDownController.signal,i,n.signal]),o=Le(),a=Le();this.httpQueue.add(async()=>(o.resolve(),a.promise));const c=`${this.clientUrl}routing/v1/ipns/${e}`;try{await o.promise;const l=cR(t),d={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:l,signal:s},h=await Ie(this,wn,w0).call(this,c,d);if(gr("putIPNS PUT %s %d",c,h.status),h.status!==200)throw new Bo("PUT ipns response had status other than 200")}catch(l){throw gr.error("putIPNS PUT %s error:",c,l.stack),l}finally{s.clear(),a.resolve(),gr("putIPNS finished: %c",e)}}}wn=new WeakSet,m0=function(e){var t;try{const n=[],i=((t=e.Addrs)==null?void 0:t.map(Re))??[];return e.Protocols!=null&&n.push(...e.Protocols),e.Protocol!=null&&(n.push(e.Protocol),delete e.Protocol),{...e,Schema:"peer",ID:tr(e.ID),Addrs:i,Protocols:n}}catch(n){gr.error("could not conform record to peer schema",n)}},GA=function(e,t,n){var i,s;if(t!=null||this.filterAddrs!=null){const o=(t==null?void 0:t.join(","))??((i=this.filterAddrs)==null?void 0:i.join(","))??"";o!==""&&e.searchParams.set("filter-addrs",o)}if(n!=null||this.filterProtocols!=null){const o=(n==null?void 0:n.join(","))??((s=this.filterProtocols)==null?void 0:s.join(","))??"";o!==""&&e.searchParams.set("filter-protocols",o)}},w0=async function(e,t){var c,l;const n=t.method??"GET",i=`${n}-${e}`;if(n==="GET"){const d=await((c=this.cache)==null?void 0:c.match(e));if(d!=null){if(parseInt(d.headers.get("x-cache-expires")??"0",10)>Date.now())return gr("returning cached response for %s",i),d;await((l=this.cache)==null?void 0:l.delete(e))}}const s=this.inFlightRequests.get(i);if(s!=null){const d=await s;return gr("deduplicating outgoing request for %s",i),d.clone()}const o=fetch(e,t).then(async d=>{if(this.cache!=null&&d.ok&&n==="GET"){const h=Date.now()+this.cacheTTL,p=new Headers(d.headers);p.set("x-cache-expires",h.toString());const b=new Response(d.clone().body,{status:d.status,statusText:d.statusText,headers:p});await this.cache.put(e,b)}return d}).finally(()=>{this.inFlightRequests.delete(i)});return this.inFlightRequests.set(i,o),await o};function u0e(r,e={}){return new l0e(new URL(r),e)}function d0e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Fm(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function h0e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var f0e=h0e,p0e=f0e;let g0e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},y0e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return AR(this,e)}},m0e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return AR(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function AR(r,e){return new m0e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let w0e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new g0e(e,t,n),this.decoder=new y0e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function CR({name:r,prefix:e,encode:t,decode:n}){return new w0e(r,e,t,n)}function zm({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=p0e(t,r);return CR({prefix:e,name:r,encode:n,decode:s=>Fm(i(s))})}function b0e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function v0e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Fo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return CR({prefix:e,name:r,encode(i){return v0e(i,n,t)},decode(i){return b0e(i,n,t,r)}})}const Vm=Fo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Fo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Fo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Fo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Fo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Fo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Fo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Fo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Fo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const I9=zm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});zm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Cc=zm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});zm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var E0e=kR,IR=128,S0e=-128,x0e=Math.pow(2,31);function kR(r,e,t){e=e||[],t=t||0;for(var n=t;r>=x0e;)e[t++]=r&255|IR,r/=128;for(;r&S0e;)e[t++]=r&255|IR,r>>>=7;return e[t]=r|0,kR.bytes=t-n+1,e}var A0e=k9,C0e=128,_R=127;function k9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw k9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&_R)<<i:(o&_R)*Math.pow(2,i),i+=7}while(o>=C0e);return k9.bytes=s-n,t}var I0e=Math.pow(2,7),k0e=Math.pow(2,14),_0e=Math.pow(2,21),T0e=Math.pow(2,28),P0e=Math.pow(2,35),D0e=Math.pow(2,42),$0e=Math.pow(2,49),N0e=Math.pow(2,56),M0e=Math.pow(2,63),O0e=function(r){return r<I0e?1:r<k0e?2:r<_0e?3:r<T0e?4:r<P0e?5:r<D0e?6:r<$0e?7:r<N0e?8:r<M0e?9:10},R0e={encode:E0e,decode:A0e,encodingLength:O0e},Km=R0e;function _9(r,e=0){return[Km.decode(r,e),Km.decode.bytes]}function jm(r,e,t=0){return Km.encode(r,e,t),e}function Hm(r){return Km.encodingLength(r)}function TR(r,e){const t=e.byteLength,n=Hm(r),i=n+Hm(t),s=new Uint8Array(i+t);return jm(r,s,0),jm(t,s,n),s.set(e,i),new T9(r,t,e,s)}function L0e(r){const e=Fm(r),[t,n]=_9(e),[i,s]=_9(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new T9(t,i,o,e)}function B0e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&d0e(r.bytes,t.bytes)}}let T9=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function PR(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return z0e(t,P9(r),e??Cc.encoder);default:return V0e(t,P9(r),e??Vm.encoder)}}const DR=new WeakMap;function P9(r){const e=DR.get(r);if(e==null){const t=new Map;return DR.set(r,t),t}return e}let U0e=class tn{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Fj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==op)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==K0e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return tn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=TR(e,t);return tn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return tn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&B0e(e.multihash,n.multihash)}toString(e){return PR(this,e)}toJSON(){return{"/":PR(this)}}link(){return this}[(Fj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof tn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new tn(n,i,s,o??$R(n,i,s.bytes))}else if(t[j0e]===!0){const{version:n,multihash:i,code:s}=t,o=L0e(i);return tn.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==op)throw new Error(`Version 0 CID must use dag-pb (code: ${op}) block encoding`);return new tn(e,t,n,n.bytes)}case 1:{const i=$R(e,t,n.bytes);return new tn(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return tn.create(0,op,e)}static createV1(e,t){return tn.create(1,e,t)}static decode(e){const[t,n]=tn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=tn.inspectBytes(e),n=t.size-t.multihashSize,i=Fm(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new T9(t.multihashCode,t.digestSize,s,i);return[t.version===0?tn.createV0(o):tn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=_9(e.subarray(t));return t+=p,h};let i=n(),s=op;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=F0e(e,t),s=tn.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return P9(s).set(n,e),s}};function F0e(r,e){switch(r[0]){case"Q":{const t=e??Cc;return[Cc.prefix,t.decode(`${Cc.prefix}${r}`)]}case Cc.prefix:{const t=e??Cc;return[Cc.prefix,t.decode(r)]}case Vm.prefix:{const t=e??Vm;return[Vm.prefix,t.decode(r)]}case I9.prefix:{const t=e??I9;return[I9.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function z0e(r,e,t){const{prefix:n}=t;if(n!==Cc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function V0e(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const op=112,K0e=18;function $R(r,e,t){const n=Hm(r),i=n+Hm(e),s=new Uint8Array(i+t.byteLength);return jm(r,s,0),jm(e,s,n),s.set(t,i),s}const j0e=Symbol.for("@ipld/js-cid/CID");function H0e(){return{filterProtocols:["unknown","transport-bitswap","transport-ipfs-gateway-http"],filterAddrs:["https","webtransport","webrtc","webrtc-direct","wss","tls"]}}const NR="[a-fA-F\\d:]",Ic=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${NR})|(?<=${NR})(?=\\s|$))`:"",as="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",rr="[a-fA-F\\d]{1,4}",qm=`
(?:
(?:${rr}:){7}(?:${rr}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${rr}:){6}(?:${as}|:${rr}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${rr}:){5}(?::${as}|(?::${rr}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${rr}:){4}(?:(?::${rr}){0,1}:${as}|(?::${rr}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${rr}:){3}(?:(?::${rr}){0,2}:${as}|(?::${rr}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${rr}:){2}(?:(?::${rr}){0,3}:${as}|(?::${rr}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${rr}:){1}(?:(?::${rr}){0,4}:${as}|(?::${rr}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${rr}){0,5}:${as}|(?::${rr}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),q0e=new RegExp(`(?:^${as}$)|(?:^${qm}$)`),W0e=new RegExp(`^${as}$`),G0e=new RegExp(`^${qm}$`),Wm=r=>r&&r.exact?q0e:new RegExp(`(?:${Ic(r)}${as}${Ic(r)})|(?:${Ic(r)}${qm}${Ic(r)})`,"g");Wm.v4=r=>r&&r.exact?W0e:new RegExp(`${Ic(r)}${as}${Ic(r)}`,"g"),Wm.v6=r=>r&&r.exact?G0e:new RegExp(`${Ic(r)}${qm}${Ic(r)}`,"g");function Q0e(r){const e=(...t)=>r(...t);return Object.defineProperty(e,"name",{value:`functionTimeout(${r.name||"<anonymous>"})`,configurable:!0}),e}const{toString:J0e}=Object.prototype;function Y0e(r){return J0e.call(r)==="[object RegExp]"}const MR={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function X0e(r,e={}){if(!Y0e(r))throw new TypeError("Expected a RegExp instance");const t=Object.keys(MR).map(i=>(typeof e[i]=="boolean"?e[i]:r[i])?MR[i]:"").join(""),n=new RegExp(e.source||r.source,t);return n.lastIndex=typeof e.lastIndex=="number"?e.lastIndex:r.lastIndex,n}function OR(r,e,{timeout:t}={}){try{return Q0e(()=>X0e(r).test(e),{timeout:t})()}catch(n){throw n}}const Z0e=15,ege=45,RR={timeout:400};function LR(r){return r.length>ege?!1:OR(Wm.v6({exact:!0}),r,RR)}function tge(r){return r.length>Z0e?!1:OR(Wm.v4({exact:!0}),r,RR)}const BR={http:"80",https:"443",ws:"80",wss:"443"},rge=["http","https","ws","wss"];function nge(r,e){e=e??{};const t=e.defaultDnsType??"dns4",{scheme:n,hostname:i,port:s,path:o}=ige(r),a=[sge(i,t),oge(s,n),age(n)];o!=null&&a.push(cge(o));const c="/"+a.filter(l=>!!l).reduce((l,d)=>l.concat(d),[]).join("/");return Re(c)}function ige(r){const[e]=r.split(":");rge.includes(e)||(r="http"+r.substring(e.length));let{protocol:t,hostname:n,port:i,pathname:s,search:o}=new URL(r);if(i==null||i===""){const c=lge(e);c!=null&&(i=c),c==null&&t==="http:"&&(i="80")}let a;return s!=null&&s!==""&&s!=="/"&&(s.startsWith("/")&&(s=s.substring(1)),a=s),o!=null&&o!==""&&(a=a??"",a+=o),{scheme:e,hostname:n,port:i,path:a}}function sge(r,e){if(!(r==null||r==="")){if(tge(r))return["ip4",r];if(LR(r))return["ip6",r];if(r[0]==="["){const t=r.substring(1,r.length-1);if(LR(t))return["ip6",t]}return[e,r]}}function oge(r,e){if(!(r==null||r===""))return e==="udp"?["udp",r]:["tcp",r]}function age(r){if(r.match(/^tcp$|^udp$/)==null)return[r]}function cge(r){if(!(r==null||r===""))return["http-path",encodeURIComponent(r)]}function lge(r){if(!(r==null||r===""||BR[r]==null))return BR[r]}const UR=0,uge="identity",FR=Fm;function dge(r){return TR(UR,FR(r))}const hge={code:UR,name:uge,encode:FR,digest:dge},fge=["https://trustless-gateway.link","https://4everland.io"],pge=2336;function gge(r){return r=r.toString(),{id:Vd(U0e.createV1(pge,hge.digest(oe(r)))),multiaddrs:[nge(r)]}}class yge{constructor(e={}){u(this,"gateways");this.gateways=(e.gateways??fge).map(t=>gge(t))}async*findProviders(e,t){yield*this.gateways.toSorted(()=>Math.random()>.5?1:-1).map(n=>({...n,protocols:["transport-ipfs-gateway-http"]}))}}function mge(r={}){return new yge(r)}class wge{constructor(e){u(this,"libp2p");this.libp2p=e}async provide(e,t){await this.libp2p.contentRouting.provide(e,t)}async cancelReprovide(e,t){await this.libp2p.contentRouting.cancelReprovide(e,t)}async*findProviders(e,t){yield*this.libp2p.contentRouting.findProviders(e,t)}async put(e,t,n){await this.libp2p.contentRouting.put(e,t,n)}async get(e,t){return this.libp2p.contentRouting.get(e,t)}async findPeer(e,t){return this.libp2p.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t){yield*this.libp2p.peerRouting.getClosestPeers(e,t)}}function bge(r){return new wge(r)}function vge(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function D9(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Ege(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var Sge=Ege,xge=Sge;let Age=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Cge=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return zR(this,e)}},Ige=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return zR(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function zR(r,e){return new Ige({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let kge=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Age(e,t,n),this.decoder=new Cge(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function VR({name:r,prefix:e,encode:t,decode:n}){return new kge(r,e,t,n)}function Gm({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=xge(t,r);return VR({prefix:e,name:r,encode:n,decode:s=>D9(i(s))})}function _ge(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Tge(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function zo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return VR({prefix:e,name:r,encode(i){return Tge(i,n,t)},decode(i){return _ge(i,n,t,r)}})}const Vo=zo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});zo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),zo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),zo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),zo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),zo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),zo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),zo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),zo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const $9=Gm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Gm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const kc=Gm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Gm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Pge=jR,KR=128,Dge=-128,$ge=Math.pow(2,31);function jR(r,e,t){e=e||[],t=t||0;for(var n=t;r>=$ge;)e[t++]=r&255|KR,r/=128;for(;r&Dge;)e[t++]=r&255|KR,r>>>=7;return e[t]=r|0,jR.bytes=t-n+1,e}var Nge=N9,Mge=128,HR=127;function N9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw N9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&HR)<<i:(o&HR)*Math.pow(2,i),i+=7}while(o>=Mge);return N9.bytes=s-n,t}var Oge=Math.pow(2,7),Rge=Math.pow(2,14),Lge=Math.pow(2,21),Bge=Math.pow(2,28),Uge=Math.pow(2,35),Fge=Math.pow(2,42),zge=Math.pow(2,49),Vge=Math.pow(2,56),Kge=Math.pow(2,63),jge=function(r){return r<Oge?1:r<Rge?2:r<Lge?3:r<Bge?4:r<Uge?5:r<Fge?6:r<zge?7:r<Vge?8:r<Kge?9:10},Hge={encode:Pge,decode:Nge,encodingLength:jge},Qm=Hge;function M9(r,e=0){return[Qm.decode(r,e),Qm.decode.bytes]}function Jm(r,e,t=0){return Qm.encode(r,e,t),e}function Ym(r){return Qm.encodingLength(r)}function qge(r,e){const t=e.byteLength,n=Ym(r),i=n+Ym(t),s=new Uint8Array(i+t);return Jm(r,s,0),Jm(t,s,n),s.set(e,i),new O9(r,t,e,s)}function qR(r){const e=D9(r),[t,n]=M9(e),[i,s]=M9(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new O9(t,i,o,e)}function Wge(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&vge(r.bytes,t.bytes)}}let O9=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function WR(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Jge(t,R9(r),e??kc.encoder);default:return Yge(t,R9(r),e??Vo.encoder)}}const GR=new WeakMap;function R9(r){const e=GR.get(r);if(e==null){const t=new Map;return GR.set(r,t),t}return e}let Gge=class rn{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,zj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==ap)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Xge)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return rn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=qge(e,t);return rn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return rn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Wge(e.multihash,n.multihash)}toString(e){return WR(this,e)}toJSON(){return{"/":WR(this)}}link(){return this}[(zj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof rn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new rn(n,i,s,o??QR(n,i,s.bytes))}else if(t[Zge]===!0){const{version:n,multihash:i,code:s}=t,o=qR(i);return rn.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==ap)throw new Error(`Version 0 CID must use dag-pb (code: ${ap}) block encoding`);return new rn(e,t,n,n.bytes)}case 1:{const i=QR(e,t,n.bytes);return new rn(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return rn.create(0,ap,e)}static createV1(e,t){return rn.create(1,e,t)}static decode(e){const[t,n]=rn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=rn.inspectBytes(e),n=t.size-t.multihashSize,i=D9(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new O9(t.multihashCode,t.digestSize,s,i);return[t.version===0?rn.createV0(o):rn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=M9(e.subarray(t));return t+=p,h};let i=n(),s=ap;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Qge(e,t),s=rn.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return R9(s).set(n,e),s}};function Qge(r,e){switch(r[0]){case"Q":{const t=e??kc;return[kc.prefix,t.decode(`${kc.prefix}${r}`)]}case kc.prefix:{const t=e??kc;return[kc.prefix,t.decode(r)]}case Vo.prefix:{const t=e??Vo;return[Vo.prefix,t.decode(r)]}case $9.prefix:{const t=e??$9;return[$9.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Jge(r,e,t){const{prefix:n}=t;if(n!==kc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Yge(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const ap=112,Xge=18;function QR(r,e,t){const n=Ym(r),i=n+Ym(e),s=new Uint8Array(i+t.byteLength);return Jm(r,s,0),Jm(e,s,n),s.set(t,i),s}const Zge=Symbol.for("@ipld/js-cid/CID"),e2e=85;class t2e extends FM{constructor(){super();u(this,"data");this.data=new Map}put(t,n){return this.data.set(Vo.encode(t.multihash.bytes),n),t}get(t){const n=this.data.get(Vo.encode(t.multihash.bytes));if(n==null)throw new G1;return n}has(t){return this.data.has(Vo.encode(t.multihash.bytes))}async delete(t){this.data.delete(Vo.encode(t.multihash.bytes))}async*getAll(){for(const[t,n]of this.data.entries())yield{cid:Gge.createV1(e2e,qR(Vo.decode(t))),block:n}}}qd("blockstore:core:tiered");const r2e="SHARDING";function n2e(r){return r[Symbol.asyncIterator]!=null}function Xm(r){if(n2e(r))return(async()=>{const t=[];for await(const n of r)t.push(n);return t})();const e=[];for(const t of r)e.push(t);return e}function i2e(r){return r[Symbol.asyncIterator]!=null}function JR(r,e){return i2e(r)?async function*(){yield*(await Xm(r)).sort(e)}():function*(){yield*Xm(r).sort(e)}()}class s2e{put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:i}of e)await this.put(n,i,t),yield n}async*getMany(e,t={}){for await(const n of e)yield{key:n,value:await this.get(n,t)}}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await vo(this.putMany(e,n)),e=[],await vo(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null){const i=e.prefix;n=Gl(n,s=>s.key.toString().startsWith(i))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>Gl(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>JR(i,s),n)),e.offset!=null){let i=0;const s=e.offset;n=Gl(n,()=>i++>=s)}return e.limit!=null&&(n=by(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null){const i=e.prefix;n=Gl(n,s=>s.toString().startsWith(i))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>Gl(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>JR(i,s),n)),e.offset!=null){const i=e.offset;let s=0;n=Gl(n,()=>s++>=i)}return e.limit!=null&&(n=by(n,e.limit)),n}}class YR extends s2e{constructor(){super();u(this,"data");this.data=new Map}put(t,n){return this.data.set(t.toString(),n),t}get(t){const n=this.data.get(t.toString());if(n==null)throw new G1;return n}has(t){return this.data.has(t.toString())}delete(t){this.data.delete(t.toString())}*_all(){for(const[t,n]of this.data.entries())yield{key:new At(t),value:n}}*_allKeys(){for(const t of this.data.keys())yield new At(t)}}new At(r2e),qd("datastore:core:tiered");class o2e extends Mde{constructor(t){super({...t,components:{libp2p:t.libp2p}});u(this,"libp2p");this.libp2p=t.libp2p}async start(){await super.start(),await this.libp2p.start()}async stop(){await super.stop(),await this.libp2p.stop()}}let a2e=class{constructor(){u(this,"readNext");u(this,"haveNext");u(this,"ended");u(this,"nextResult");u(this,"error");this.ended=!1,this.readNext=Le(),this.haveNext=Le()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Le(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Le(),await ln(this.readNext.promise,t==null?void 0:t.signal,t)}};function c2e(){return new a2e}let l2e=class extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}};function Zm(r,e){const t=c2e();r.sink(t).catch(async o=>{await t.end(o)}),r.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());const i=new Ue;return{read:async o=>{var c;if((c=o==null?void 0:o.signal)==null||c.throwIfAborted(),(o==null?void 0:o.bytes)==null){const{done:l,value:d}=await ln(n.next(),o==null?void 0:o.signal);return l===!0?null:d}for(;i.byteLength<o.bytes;){const{value:l,done:d}=await ln(n.next(),o==null?void 0:o.signal);if(d===!0)throw new l2e("unexpected end of input");i.append(l)}const a=i.sublist(0,o.bytes);return i.consume(o.bytes),a},write:async(o,a)=>{var c;(c=a==null?void 0:a.signal)==null||c.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(i.byteLength>0){const o=r.source;r.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield i:yield*i,yield*o}()}return r}}}let u2e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}},d2e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}},h2e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}};function Zd(r,e={}){const t=Zm(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=yt(e.maxDataLength));const n=(e==null?void 0:e.lengthDecoder)??es,i=(e==null?void 0:e.lengthEncoder)??Sr;return{read:async o=>{let a=-1;const c=new Ue;for(;;){c.append(await t.read({...o,bytes:1}));try{a=n(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new u2e("Invalid message length");if((e==null?void 0:e.maxLengthLength)!=null&&c.byteLength>e.maxLengthLength)throw new h2e("message length length too long");if(a>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&a>e.maxDataLength)throw new d2e("message length too long");return t.read({...o,bytes:a})},write:async(o,a)=>{await t.write(new Ue(i(o.byteLength),o),a)},writeV:async(o,a)=>{const c=new Ue(...o.flatMap(l=>[i(l.byteLength),l]));await t.write(c,a)},unwrap:()=>t.unwrap()}}function XR(){const r=Le();let e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,r.resolve(t)},source:async function*(){yield*await r.promise}()}}function f2e(){const r=XR(),e=XR();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}const cp=65535,ZR=cp-16,lp=!!((Kj=(Vj=globalThis.process)==null?void 0:Vj.env)!=null&&Kj.DUMP_SESSION_KEYS);function L9(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function eL(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function ci(r,...e){if(!eL(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function tL(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function p2e(r,e){ci(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function rL(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const _c=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),g2e=r=>new DataView(r.buffer,r.byteOffset,r.byteLength);if(!(new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68))throw new Error("Non little-endian hardware is not supported");function y2e(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function B9(r){if(typeof r=="string")r=y2e(r);else if(eL(r))r=U9(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function m2e(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function w2e(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}const b2e=(r,e)=>{function t(n,...i){if(ci(n),r.nonceLength!==void 0){const d=i[0];if(!d)throw new Error("nonce / iv required");r.varSizeNonce?ci(d):ci(d,r.nonceLength)}const s=r.tagLength;s&&i[1]!==void 0&&ci(i[1]);const o=e(n,...i),a=(d,h)=>{if(h!==void 0){if(d!==2)throw new Error("cipher output not supported");ci(h)}};let c=!1;return{encrypt(d,h){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,ci(d),a(o.encrypt.length,h),o.encrypt(d,h)},decrypt(d,h){if(ci(d),s&&d.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,h),o.decrypt(d,h)}}}return Object.assign(t,r),t};function nL(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!v2e(e))throw new Error("invalid output, must be aligned");return e}function iL(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=4,l=0;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function v2e(r){return r.byteOffset%4===0}function U9(r){return Uint8Array.from(r)}function eh(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}const sL=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),E2e=sL("expand 16-byte k"),S2e=sL("expand 32-byte k"),x2e=_c(E2e),A2e=_c(S2e);function st(r,e){return r<<e|r>>>32-e}function F9(r){return r.byteOffset%4===0}const e3=64,C2e=16,oL=2**32-1,aL=new Uint32Array;function I2e(r,e,t,n,i,s,o,a){const c=i.length,l=new Uint8Array(e3),d=_c(l),h=F9(i)&&F9(s),p=h?_c(i):aL,b=h?_c(s):aL;for(let f=0;f<c;o++){if(r(e,t,n,d,o,a),o>=oL)throw new Error("arx: counter overflow");const g=Math.min(e3,c-f);if(h&&g===e3){const v=f/4;if(f%4!==0)throw new Error("arx: invalid block position");for(let y=0,w;y<C2e;y++)w=v+y,b[w]=p[w]^d[y];f+=e3;continue}for(let v=0,y;v<g;v++)y=f+v,s[y]=i[y]^l[v];f+=g}}function k2e(r,e){const{allowShortKeys:t,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=m2e({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return L9(i),L9(o),rL(s),rL(t),(a,c,l,d,h=0)=>{ci(a),ci(c),ci(l);const p=l.length;if(d===void 0&&(d=new Uint8Array(p)),ci(d),L9(h),h<0||h>=oL)throw new Error("arx: counter overflow");if(d.length<p)throw new Error(`arx: output (${d.length}) is shorter than data (${p})`);const b=[];let f=a.length,g,v;if(f===32)b.push(g=U9(a)),v=A2e;else if(f===16&&t)g=new Uint8Array(32),g.set(a),g.set(a,16),v=x2e,b.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${f}`);F9(c)||b.push(c=U9(c));const y=_c(g);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(v,y,_c(c.subarray(0,16)),y),c=c.subarray(16)}const w=16-i;if(w!==c.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(w!==12){const E=new Uint8Array(12);E.set(c,s?0:12-c.length),c=E,b.push(c)}const m=_c(c);return I2e(r,v,y,m,l,d,h,o),eh(...b),d}}const Ar=(r,e)=>r[e++]&255|(r[e++]&255)<<8;class _2e{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=B9(e),ci(e,32);const t=Ar(e,0),n=Ar(e,2),i=Ar(e,4),s=Ar(e,6),o=Ar(e,8),a=Ar(e,10),c=Ar(e,12),l=Ar(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let d=0;d<8;d++)this.pad[d]=Ar(e,16+2*d)}process(e,t,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],l=o[2],d=o[3],h=o[4],p=o[5],b=o[6],f=o[7],g=o[8],v=o[9],y=Ar(e,t+0),w=Ar(e,t+2),m=Ar(e,t+4),E=Ar(e,t+6),A=Ar(e,t+8),k=Ar(e,t+10),x=Ar(e,t+12),I=Ar(e,t+14);let T=s[0]+(y&8191),L=s[1]+((y>>>13|w<<3)&8191),z=s[2]+((w>>>10|m<<6)&8191),B=s[3]+((m>>>7|E<<9)&8191),G=s[4]+((E>>>4|A<<12)&8191),j=s[5]+(A>>>1&8191),q=s[6]+((A>>>14|k<<2)&8191),Q=s[7]+((k>>>11|x<<5)&8191),K=s[8]+((x>>>8|I<<8)&8191),O=s[9]+(I>>>5|i),U=0,W=U+T*a+L*(5*v)+z*(5*g)+B*(5*f)+G*(5*b);U=W>>>13,W&=8191,W+=j*(5*p)+q*(5*h)+Q*(5*d)+K*(5*l)+O*(5*c),U+=W>>>13,W&=8191;let J=U+T*c+L*a+z*(5*v)+B*(5*g)+G*(5*f);U=J>>>13,J&=8191,J+=j*(5*b)+q*(5*p)+Q*(5*h)+K*(5*d)+O*(5*l),U+=J>>>13,J&=8191;let H=U+T*l+L*c+z*a+B*(5*v)+G*(5*g);U=H>>>13,H&=8191,H+=j*(5*f)+q*(5*b)+Q*(5*p)+K*(5*h)+O*(5*d),U+=H>>>13,H&=8191;let se=U+T*d+L*l+z*c+B*a+G*(5*v);U=se>>>13,se&=8191,se+=j*(5*g)+q*(5*f)+Q*(5*b)+K*(5*p)+O*(5*h),U+=se>>>13,se&=8191;let we=U+T*h+L*d+z*l+B*c+G*a;U=we>>>13,we&=8191,we+=j*(5*v)+q*(5*g)+Q*(5*f)+K*(5*b)+O*(5*p),U+=we>>>13,we&=8191;let ce=U+T*p+L*h+z*d+B*l+G*c;U=ce>>>13,ce&=8191,ce+=j*a+q*(5*v)+Q*(5*g)+K*(5*f)+O*(5*b),U+=ce>>>13,ce&=8191;let de=U+T*b+L*p+z*h+B*d+G*l;U=de>>>13,de&=8191,de+=j*c+q*a+Q*(5*v)+K*(5*g)+O*(5*f),U+=de>>>13,de&=8191;let Ne=U+T*f+L*b+z*p+B*h+G*d;U=Ne>>>13,Ne&=8191,Ne+=j*l+q*c+Q*a+K*(5*v)+O*(5*g),U+=Ne>>>13,Ne&=8191;let Me=U+T*g+L*f+z*b+B*p+G*h;U=Me>>>13,Me&=8191,Me+=j*d+q*l+Q*c+K*a+O*(5*v),U+=Me>>>13,Me&=8191;let Ze=U+T*v+L*g+z*f+B*b+G*p;U=Ze>>>13,Ze&=8191,Ze+=j*h+q*d+Q*l+K*c+O*a,U+=Ze>>>13,Ze&=8191,U=(U<<2)+U|0,U=U+W|0,W=U&8191,U=U>>>13,J+=U,s[0]=W,s[1]=J,s[2]=H,s[3]=se,s[4]=we,s[5]=ce,s[6]=de,s[7]=Ne,s[8]=Me,s[9]=Ze}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;eh(n)}update(e){tL(this);const{buffer:t,blockLen:n}=this;e=B9(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}t.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){eh(this.h,this.r,this.buffer,this.pad)}digestInto(e){tL(this),p2e(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}function T2e(r){const e=(n,i)=>r(i).update(B9(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}const P2e=T2e(r=>new _2e(r));function D2e(r,e,t,n,i,s=20){let o=r[0],a=r[1],c=r[2],l=r[3],d=e[0],h=e[1],p=e[2],b=e[3],f=e[4],g=e[5],v=e[6],y=e[7],w=i,m=t[0],E=t[1],A=t[2],k=o,x=a,I=c,T=l,L=d,z=h,B=p,G=b,j=f,q=g,Q=v,K=y,O=w,U=m,W=E,J=A;for(let se=0;se<s;se+=2)k=k+L|0,O=st(O^k,16),j=j+O|0,L=st(L^j,12),k=k+L|0,O=st(O^k,8),j=j+O|0,L=st(L^j,7),x=x+z|0,U=st(U^x,16),q=q+U|0,z=st(z^q,12),x=x+z|0,U=st(U^x,8),q=q+U|0,z=st(z^q,7),I=I+B|0,W=st(W^I,16),Q=Q+W|0,B=st(B^Q,12),I=I+B|0,W=st(W^I,8),Q=Q+W|0,B=st(B^Q,7),T=T+G|0,J=st(J^T,16),K=K+J|0,G=st(G^K,12),T=T+G|0,J=st(J^T,8),K=K+J|0,G=st(G^K,7),k=k+z|0,J=st(J^k,16),Q=Q+J|0,z=st(z^Q,12),k=k+z|0,J=st(J^k,8),Q=Q+J|0,z=st(z^Q,7),x=x+B|0,O=st(O^x,16),K=K+O|0,B=st(B^K,12),x=x+B|0,O=st(O^x,8),K=K+O|0,B=st(B^K,7),I=I+G|0,U=st(U^I,16),j=j+U|0,G=st(G^j,12),I=I+G|0,U=st(U^I,8),j=j+U|0,G=st(G^j,7),T=T+L|0,W=st(W^T,16),q=q+W|0,L=st(L^q,12),T=T+L|0,W=st(W^T,8),q=q+W|0,L=st(L^q,7);let H=0;n[H++]=o+k|0,n[H++]=a+x|0,n[H++]=c+I|0,n[H++]=l+T|0,n[H++]=d+L|0,n[H++]=h+z|0,n[H++]=p+B|0,n[H++]=b+G|0,n[H++]=f+j|0,n[H++]=g+q|0,n[H++]=v+Q|0,n[H++]=y+K|0,n[H++]=w+O|0,n[H++]=m+U|0,n[H++]=E+W|0,n[H++]=A+J|0}const $2e=k2e(D2e,{counterRight:!1,counterLength:4,allowShortKeys:!1}),N2e=new Uint8Array(16),cL=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(N2e.subarray(t))},M2e=new Uint8Array(32);function lL(r,e,t,n,i){const s=r(e,t,M2e),o=P2e.create(s);i&&cL(o,i),cL(o,n);const a=new Uint8Array(16),c=g2e(a);iL(c,0,BigInt(i?i.length:0),!0),iL(c,8,BigInt(n.length),!0),o.update(a);const l=o.digest();return eh(s,a),l}const uL=b2e({blockSize:64,nonceLength:12,tagLength:16},(r=>(e,t,n)=>({encrypt(s,o){const a=s.length;o=nL(a+16,o,!1),o.set(s);const c=o.subarray(0,-16);r(e,t,c,c,1);const l=lL(r,e,t,c,n);return o.set(l,a),eh(l),o},decrypt(s,o){o=nL(s.length-16,o,!1);const a=s.subarray(0,-16),c=s.subarray(-16),l=lL(r,e,t,a,n);if(!w2e(c,l))throw new Error("invalid tag");return o.set(s.subarray(0,-16)),r(e,t,o,o,1),eh(l),o}}))($2e));function O2e(r,e,t){return uy(r),t===void 0&&(t=new Uint8Array(r.outputLen)),Py(r,D1(t),D1(e))}const z9=Uint8Array.from([0]),dL=Uint8Array.of();function R2e(r,e,t,n=32){uy(r),Od(n);const i=r.outputLen;if(n>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(n/i);t===void 0&&(t=dL);const o=new Uint8Array(s*i),a=Py.create(r,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let d=0;d<s;d++)z9[0]=d+1,c.update(d===0?dL:l).update(t).update(z9).digestInto(l),o.set(l,i*d),a._cloneInto(c);return a.destroy(),c.destroy(),Rs(l,z9),o.slice(0,n)}const L2e={hashSHA256(r){return Bl(r.subarray())},getHKDF(r,e){const t=O2e(Bl,e,r),i=R2e(Bl,t,void 0,96),s=i.subarray(0,32),o=i.subarray(32,64),a=i.subarray(64,96);return[s,o,a]},generateX25519KeyPair(){const r=sy.utils.randomPrivateKey();return{publicKey:sy.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:sy.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,e){return sy.getSharedSecret(r.subarray(),e.subarray())},chaCha20Poly1305Encrypt(r,e,t,n){return uL(n,e,t).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,e,t,n,i){return uL(n,e,t).decrypt(r.subarray(),i)}};function B2e(r){return{generateKeypair:r.generateX25519KeyPair,dh:(e,t)=>r.generateX25519SharedKey(e.privateKey,t).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}const t3=r=>{const e=In(2);return e[0]=r>>8,e[1]=r,e};t3.bytes=2;const r3=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let e=0;return e+=r[0]<<8,e+=r[1],e}return r.getUint16(0)};r3.bytes=2;function U2e(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function hL(r,e){!e.enabled||!lp||(r?(e(`LOCAL_STATIC_PUBLIC_KEY ${re(r.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${re(r.privateKey,"hex")}`)):e("Missing local static keys."))}function fL(r,e){!e.enabled||!lp||(r?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${re(r.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${re(r.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function F2e(r,e){!e.enabled||!lp||e(r?`REMOTE_STATIC_PUBLIC_KEY ${re(r.subarray(),"hex")}`:"Missing remote static public key.")}function pL(r,e){!e.enabled||!lp||e(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${re(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function gL(r,e,t){!t.enabled||!lp||(t(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&re(r.k,"hex")}`),t(`CIPHER_STATE_2 ${e.n.getUint64()} ${e.k&&re(e.k,"hex")}`))}function Tc(r,e){if(r.length!==e.length)throw new Error("Inputs should have the same length");const t=In(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return t}const j4=class j4 extends Error{constructor(t="Invalid crypto exchange"){super(t);u(this,"code");this.code=j4.code}};u(j4,"code","ERR_INVALID_CRYPTO_EXCHANGE");let up=j4;const z2e=0,V2e=4294967295,K2e="Cipherstate has reached maximum n, a new handshake must be performed";class j2e{constructor(e=z2e){u(this,"n");u(this,"bytes");u(this,"view");this.n=e,this.bytes=Ge(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>V2e)throw new Error(K2e)}}const th=Ge(0);class n3{constructor(e,t=void 0,n=0){u(this,"k");u(this,"n");u(this,"crypto");this.crypto=e,this.k=t,this.n=new j2e(n)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();const n=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),n}decryptWithAd(e,t,n){if(!this.hasKey())return t;this.n.assertValue();const i=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,n);return this.n.increment(),i}}class H2e{constructor(e,t){u(this,"cs");u(this,"ck");u(this,"h");u(this,"crypto");this.crypto=e;const n=oe(t,"utf-8");this.h=W2e(e,n),this.ck=this.h,this.cs=new n3(e)}mixKey(e){const[t,n]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new n3(this.crypto,n)}mixHash(e){this.h=this.crypto.hash(new Ue(this.h,e))}encryptAndHash(e){const t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){const t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){const[e,t]=this.crypto.hkdf(this.ck,th);return[new n3(this.crypto,e),new n3(this.crypto,t)]}}class q2e{constructor(e){u(this,"ss");u(this,"s");u(this,"e");u(this,"rs");u(this,"re");u(this,"initiator");u(this,"crypto");const{crypto:t,protocolName:n,prologue:i,initiator:s,s:o,e:a,rs:c,re:l}=e;this.crypto=t,this.ss=new H2e(t,n),this.ss.mixHash(i),this.initiator=s,this.s=o,this.e=a,this.rs=c,this.re=l}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");const e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw new Error("remote static public key is already set");const n=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+n)throw new Error("message is not long enough");const i=e.sublist(t,t+n);return this.rs=this.ss.decryptAndHash(i),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class yL extends q2e{writeMessageA(e){return new Ue(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){const t=this.writeE();this.writeEE();const n=this.writeS();return this.writeES(),new Ue(t,n,this.ss.encryptAndHash(e))}writeMessageC(e){const t=this.writeS();return this.writeSE(),new Ue(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(t){throw new up(`handshake stage 0 validation fail: ${t.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();const t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(t){throw new up(`handshake stage 1 validation fail: ${t.message}`)}}readMessageC(e){try{const t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(t){throw new up(`handshake stage 2 validation fail: ${t.message}`)}}}function W2e(r,e){if(e.length<=32){const t=Ge(32);return t.set(e),t}else return r.hash(e)}var i3;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(const s of t.webtransportCerthashes)n.uint32(10),n.bytes(s);if(t.streamMuxers!=null)for(const s of t.streamMuxers)n.uint32(18),n.string(s);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={webtransportCerthashes:[],streamMuxers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{if(((a=i.limits)==null?void 0:a.webtransportCerthashes)!=null&&s.webtransportCerthashes.length===i.limits.webtransportCerthashes)throw new mt('Decode error - map field "webtransportCerthashes" had too many elements');s.webtransportCerthashes.push(t.bytes());break}case 2:{if(((c=i.limits)==null?void 0:c.streamMuxers)!=null&&s.streamMuxers.length===i.limits.streamMuxers)throw new mt('Decode error - map field "streamMuxers" had too many elements');s.streamMuxers.push(t.string());break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(i3||(i3={}));var s3;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.identityKey!=null&&t.identityKey.byteLength>0&&(n.uint32(10),n.bytes(t.identityKey)),t.identitySig!=null&&t.identitySig.byteLength>0&&(n.uint32(18),n.bytes(t.identitySig)),t.extensions!=null&&(n.uint32(34),i3.codec().encode(t.extensions,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={identityKey:Ge(0),identitySig:Ge(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.identityKey=t.bytes();break}case 2:{s.identitySig=t.bytes();break}case 4:{s.extensions=i3.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.extensions});break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(s3||(s3={}));async function mL(r,e,t){const n=await r.sign(bL(e));return s3.encode({identityKey:_i(r.publicKey),identitySig:n,extensions:t})}async function wL(r,e,t){try{const n=s3.decode(r),i=_n(n.identityKey);if((t==null?void 0:t.equals(i))===!1)throw new Error(`Payload identity key ${i} does not match expected remote identity key ${t}`);if(!e)throw new Error("Remote static does not exist");const s=bL(e);if(!await i.verify(s,n.identitySig))throw new Error("Invalid payload signature");return n}catch(n){throw new pP(n.message)}}function bL(r){const e=oe("noise-libp2p-static-key:");return r instanceof Uint8Array?or([e,r],e.length+r.length):(r.prepend(e),r)}async function G2e(r,e){const{log:t,connection:n,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=r,d=await mL(s,a.publicKey,l),h=new yL({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:o,s:a});hL(h.s,t),t.trace("Stage 0 - Initiator starting to send first message."),await n.write(h.writeMessageA(th),e),t.trace("Stage 0 - Initiator finished sending first message."),fL(h.e,t),t.trace("Stage 1 - Initiator waiting to receive first message from responder...");const p=h.readMessageB(await n.read(e));t.trace("Stage 1 - Initiator received the message."),pL(h.re,t),F2e(h.rs,t),t.trace("Initiator going to check remote's signature...");const b=await wL(p,h.rs,c);t.trace("All good with the signature!"),t.trace("Stage 2 - Initiator sending third handshake message."),await n.write(h.writeMessageC(d),e),t.trace("Stage 2 - Initiator sent message with signed payload.");const[f,g]=h.ss.split();return gL(f,g,t),{payload:b,encrypt:v=>f.encryptWithAd(th,v),decrypt:(v,y)=>g.decryptWithAd(th,v,y)}}async function Q2e(r,e){const{log:t,connection:n,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=r,d=await mL(s,a.publicKey,l),h=new yL({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:o,s:a});hL(h.s,t),t.trace("Stage 0 - Responder waiting to receive first message."),h.readMessageA(await n.read(e)),t.trace("Stage 0 - Responder received first message."),pL(h.re,t),t.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(h.writeMessageB(d),e),t.trace("Stage 1 - Responder sent the second handshake message with signed payload."),fL(h.e,t),t.trace("Stage 2 - Responder waiting for third handshake message...");const p=h.readMessageC(await n.read(e));t.trace("Stage 2 - Responder received the message, finished handshake.");const b=await wL(p,h.rs,c),[f,g]=h.ss.split();return gL(f,g,t),{payload:b,encrypt:v=>g.encryptWithAd(th,v),decrypt:(v,y)=>f.decryptWithAd(th,v,y)}}const vL=16;function J2e(r,e){return async function*(t){for await(const n of t)for(let i=0;i<n.length;i+=ZR){let s=i+ZR;s>n.length&&(s=n.length);let o;n instanceof Uint8Array?o=r.encrypt(n.subarray(i,s)):o=r.encrypt(n.sublist(i,s)),e==null||e.encryptedPackets.increment(),yield new Ue(t3(o.byteLength),o)}}}function Y2e(r,e){return async function*(t){for await(const n of t)for(let i=0;i<n.length;i+=cp){let s=i+cp;if(s>n.length&&(s=n.length),s-vL<i)throw new Error("Invalid chunk");const o=n.sublist(i,s),a=n.subarray(i,s-vL);try{const c=r.decrypt(o,a);e==null||e.decryptedPackets.increment(),yield c}catch(c){throw e==null||e.decryptErrors.increment(),c}}}}Hj=Symbol.toStringTag,jj=dr;class X2e{constructor(e,t={}){u(this,"protocol","/noise");u(this,"crypto");u(this,"prologue");u(this,"staticKey");u(this,"extensions");u(this,"metrics");u(this,"components");u(this,Hj,"@chainsafe/libp2p-noise");u(this,jj,["@libp2p/connection-encryption","@chainsafe/libp2p-noise"]);const{staticNoiseKey:n,extensions:i,crypto:s,prologueBytes:o}=t,{metrics:a}=e;this.components=e;const c=s??L2e;this.crypto=B2e(c),this.extensions={webtransportCerthashes:[],...i},this.metrics=a?U2e(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=o??Ge(0)}async secureOutbound(e,t){var a,c;const n=Zd(e,{lengthEncoder:t3,lengthDecoder:r3,maxDataLength:cp}),i=await this.performHandshakeInitiator(n,this.components.privateKey,(a=t==null?void 0:t.remotePeer)==null?void 0:a.publicKey,t),s=await this.createSecureConnection(n,i);e.source=s.source,e.sink=s.sink;const o=_n(i.payload.identityKey);return{conn:e,remoteExtensions:i.payload.extensions,remotePeer:zd(o),streamMuxer:this.getStreamMuxer((c=i.payload.extensions)==null?void 0:c.streamMuxers)}}getStreamMuxer(e){if(e==null)return;const t=this.components.upgrader.getStreamMuxers();if(t!=null)for(const n of e){const i=t.get(n);if(i!=null)return i}if(e.length)throw new RZ("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(e,t){var a,c;const n=Zd(e,{lengthEncoder:t3,lengthDecoder:r3,maxDataLength:cp}),i=await this.performHandshakeResponder(n,this.components.privateKey,(a=t==null?void 0:t.remotePeer)==null?void 0:a.publicKey,t),s=await this.createSecureConnection(n,i);e.source=s.source,e.sink=s.sink;const o=_n(i.payload.identityKey);return{conn:e,remoteExtensions:i.payload.extensions,remotePeer:zd(o),streamMuxer:this.getStreamMuxer((c=i.payload.extensions)==null?void 0:c.streamMuxers)}}async performHandshakeInitiator(e,t,n,i){var o,a;let s;try{s=await G2e({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},i),(o=this.metrics)==null||o.xxHandshakeSuccesses.increment()}catch(c){throw(a=this.metrics)==null||a.xxHandshakeErrors.increment(),c}return s}async performHandshakeResponder(e,t,n,i){var o,a;let s;try{s=await Q2e({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},i),(o=this.metrics)==null||o.xxHandshakeSuccesses.increment()}catch(c){throw(a=this.metrics)==null||a.xxHandshakeErrors.increment(),c}return s}async createSecureConnection(e,t){const[n,i]=f2e(),s=e.unwrap();return await un(n,J2e(t,this.metrics),s,o=>Ud(o,{lengthDecoder:r3}),Y2e(t,this.metrics),n),i}}function EL(r={}){return e=>new X2e(e,r)}function SL(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}class Jl extends Error{constructor(e="The frame was invalid"){super(e),this.name="InvalidFrameError"}}u(Jl,"name","InvalidFrameError");class V9 extends Error{constructor(e="Unrequested ping error"){super(e),this.name="UnrequestedPingError"}}u(V9,"name","UnrequestedPingError");class K9 extends Error{constructor(e="Unrequested ping error"){super(e),this.name="NotMatchingPingError"}}u(K9,"name","NotMatchingPingError");class xL extends Error{constructor(e="Invalid state"){super(e),this.name="InvalidStateError"}}u(xL,"name","InvalidStateError");class AL extends Error{constructor(e="Strean already exists"){super(e),this.name="StreamAlreadyExistsError"}}u(AL,"name","StreamAlreadyExistsError");class CL extends Error{constructor(e="Decode invalid version"){super(e),this.name="DecodeInvalidVersionError"}}u(CL,"name","DecodeInvalidVersionError");class IL extends Error{constructor(e="Both clients"){super(e),this.name="BothClientsError"}}u(IL,"name","BothClientsError");class j9 extends Error{constructor(e="Receive window exceeded"){super(e),this.name="ReceiveWindowExceededError"}}u(j9,"name","ReceiveWindowExceededError");const Z2e=new Set([Jl.name,V9.name,K9.name,AL.name,CL.name,IL.name,j9.name]),H9=256*1024,eye=16*1024*1024,tye={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:H9,maxStreamWindowSize:eye,maxMessageSize:64*1024};function rye(r){if(r.keepAliveInterval<=0)throw new Z("keep-alive interval must be positive");if(r.maxInboundStreams<0)throw new Z("max inbound streams must be larger or equal 0");if(r.maxOutboundStreams<0)throw new Z("max outbound streams must be larger or equal 0");if(r.initialStreamWindowSize<H9)throw new Z("InitialStreamWindowSize must be larger or equal 256 kB");if(r.maxStreamWindowSize<r.initialStreamWindowSize)throw new Z("MaxStreamWindowSize must be larger than the InitialStreamWindowSize");if(r.maxStreamWindowSize>2**32-1)throw new Z("MaxStreamWindowSize must be less than equal MAX_UINT32");if(r.maxMessageSize<1024)throw new Z("MaxMessageSize must be greater than a kilobyte")}var ar;(function(r){r[r.Data=0]="Data",r[r.WindowUpdate=1]="WindowUpdate",r[r.Ping=2]="Ping",r[r.GoAway=3]="GoAway"})(ar||(ar={}));var Wt;(function(r){r[r.SYN=1]="SYN",r[r.ACK=2]="ACK",r[r.FIN=4]="FIN",r[r.RST=8]="RST"})(Wt||(Wt={})),Object.values(Wt).filter(r=>typeof r!="string");const nye=0;var Ks;(function(r){r[r.NormalTermination=0]="NormalTermination",r[r.ProtocolError=1]="ProtocolError",r[r.InternalError=2]="InternalError"})(Ks||(Ks={}));const dp=12,kL=2**24;function iye(r){if(r[0]!==nye)throw new Jl("Invalid frame version");return{type:r[1],flag:(r[2]<<8)+r[3],streamID:r[4]*kL+(r[5]<<16)+(r[6]<<8)+r[7],length:r[8]*kL+(r[9]<<16)+(r[10]<<8)+r[11]}}let sye=class{constructor(e){u(this,"source");u(this,"buffer");u(this,"frameInProgress");this.source=oye(e),this.buffer=new Ue,this.frameInProgress=!1}async*emitFrames(){for await(const e of this.source)for(this.buffer.append(e);;){const t=this.readHeader();if(t===void 0)break;const{type:n,length:i}=t;n===ar.Data?(this.frameInProgress=!0,yield{header:t,readData:this.readBytes.bind(this,i)}):yield{header:t}}}readHeader(){if(this.frameInProgress)throw new xL("decoding frame already in progress");if(this.buffer.length<dp)return;const e=iye(this.buffer.subarray(0,dp));return this.buffer.consume(dp),e}async readBytes(e){if(this.buffer.length<e){for await(const n of this.source)if(this.buffer.append(n),this.buffer.length>=e)break}const t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}};function oye(r){if(r[Symbol.iterator]!==void 0){const e=r[Symbol.iterator]();return e.return=void 0,{[Symbol.iterator](){return e}}}else if(r[Symbol.asyncIterator]!==void 0){const e=r[Symbol.asyncIterator]();return e.return=void 0,{[Symbol.asyncIterator](){return e}}}else throw new Error("a source must be either an iterable or an async iterable")}function _L(r){const e=new Uint8Array(dp);return e[1]=r.type,e[2]=r.flag>>>8,e[3]=r.flag,e[4]=r.streamID>>>24,e[5]=r.streamID>>>16,e[6]=r.streamID>>>8,e[7]=r.streamID,e[8]=r.length>>>24,e[9]=r.length>>>16,e[10]=r.length>>>8,e[11]=r.length,e}function aye(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function TL(r,e){var n,i;const t=(i=(n=SL(r)).return)==null?void 0:i.call(n);aye(t)&&t.catch(s=>{e.error("could not cause iterator to return",s)})}const cye=5e3;function q9(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}class W9{constructor(e){u(this,"id");u(this,"direction");u(this,"timeline");u(this,"protocol");u(this,"metadata");u(this,"source");u(this,"status");u(this,"readStatus");u(this,"writeStatus");u(this,"log");u(this,"sinkController");u(this,"sinkEnd");u(this,"closed");u(this,"endErr");u(this,"streamSource");u(this,"onEnd");u(this,"onCloseRead");u(this,"onCloseWrite");u(this,"onReset");u(this,"onAbort");u(this,"sendCloseWriteTimeout");u(this,"sendingData");this.sinkController=new AbortController,this.sinkEnd=Le(),this.closed=Le(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??cye,this.onEnd=e.onEnd,this.onCloseRead=e==null?void 0:e.onCloseRead,this.onCloseWrite=e==null?void 0:e.onCloseWrite,this.onReset=e==null?void 0:e.onReset,this.onAbort=e==null?void 0:e.onAbort,this.source=this.streamSource=go({onEnd:t=>{t!=null?this.log.trace("source ended with error",t):this.log.trace("source ended"),this.onSourceEnd(t)}}),this.sink=this.sink.bind(this)}async sink(e){if(this.writeStatus!=="ready")throw new M2(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";const t={signal:this.sinkController.signal};if(this.direction==="outbound"){const i=this.sendNewStream(t);q9(i)&&await i}const n=()=>{TL(e,this.log)};try{this.sinkController.signal.addEventListener("abort",n),this.log.trace("sink reading from source");for await(let i of e){i=i instanceof Uint8Array?new Ue(i):i;const s=this.sendData(i,t);q9(s)&&(this.sendingData=Le(),await s,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",n)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(t){throw this.log.trace("sink ended with error, calling abort with error",t),this.abort(t),t}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){var t;this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(t=this.onCloseRead)==null||t.call(this),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){var t;this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(t=this.onCloseWrite)==null||t.call(this),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.status==="open"&&(this.log.trace("closing gracefully"),this.status="closing",await ln(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e==null?void 0:e.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(e={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const t=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),t==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(e={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),await ln(this.sink([]),e.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&await ln(this.sendingData.promise,e.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await ln(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){var n;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",e),this.log("try to send reset to remote");const t=this.sendReset();q9(t)&&t.catch(i=>{this.log.error("error sending reset message",i)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),(n=this.onAbort)==null||n.call(this,e)}reset(){var t;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;const e=new yP("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),(t=this.onReset)==null||t.call(this)}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}var cs;(function(r){r[r.Init=0]="Init",r[r.SYNSent=1]="SYNSent",r[r.SYNReceived=2]="SYNReceived",r[r.Established=3]="Established",r[r.Finished=4]="Finished"})(cs||(cs={}));class lye extends W9{constructor(t){super({...t,onEnd:n=>{var i;this.state=cs.Finished,(i=t.onEnd)==null||i.call(t,n)}});u(this,"name");u(this,"state");u(this,"config");u(this,"_id");u(this,"sendWindowCapacity");u(this,"sendWindowCapacityUpdate");u(this,"recvWindow");u(this,"recvWindowCapacity");u(this,"epochStart");u(this,"getRTT");u(this,"sendFrame");this.config=t.config,this._id=parseInt(t.id,10),this.name=t.name,this.state=t.state,this.sendWindowCapacity=H9,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=t.getRTT,this.sendFrame=t.sendFrame,this.source=cm(this.source,()=>{this.sendWindowUpdate()})}async sendNewStream(){}async sendData(t,n={}){var i,s;for(t=t.sublist();t.byteLength!==0;){if(this.sendWindowCapacity===0&&((i=this.log)==null||i.trace("wait for send window capacity, status %s",this.status),await this.waitForSendWindowCapacity(n),this.status==="closed"||this.status==="aborted"||this.status==="reset")){(s=this.log)==null||s.trace("%s while waiting for send window capacity",this.status);return}const o=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-dp,t.length),a=this.getSendFlags();this.sendFrame({type:ar.Data,flag:a,streamID:this._id,length:o},t.sublist(0,o)),this.sendWindowCapacity-=o,t.consume(o)}}async sendReset(){this.sendFrame({type:ar.WindowUpdate,flag:Wt.RST,streamID:this._id,length:0})}async sendCloseWrite(){const t=this.getSendFlags()|Wt.FIN;this.sendFrame({type:ar.WindowUpdate,flag:t,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(t={}){var o,a;if(this.sendWindowCapacity>0)return;let n,i;const s=()=>{this.status==="open"||this.status==="closing"?i(new Tl("Stream aborted")):n()};(o=t.signal)==null||o.addEventListener("abort",s);try{await new Promise((c,l)=>{this.sendWindowCapacityUpdate=()=>{c()},i=l,n=c})}finally{(a=t.signal)==null||a.removeEventListener("abort",s)}}handleWindowUpdate(t){var i,s;(i=this.log)==null||i.trace("stream received window update id=%s",this._id),this.processFlags(t.flag);const n=this.sendWindowCapacity;this.sendWindowCapacity+=t.length,n===0&&t.length>0&&((s=this.sendWindowCapacityUpdate)==null||s.call(this))}async handleData(t,n){var s;if((s=this.log)==null||s.trace("stream received data id=%s",this._id),this.processFlags(t.flag),this.recvWindowCapacity<t.length)throw new j9("Receive window exceeded");const i=await n();this.recvWindowCapacity-=t.length,this.sourcePush(i)}processFlags(t){(t&Wt.ACK)===Wt.ACK&&this.state===cs.SYNSent&&(this.state=cs.Established),(t&Wt.FIN)===Wt.FIN&&this.remoteCloseWrite(),(t&Wt.RST)===Wt.RST&&this.reset()}getSendFlags(){switch(this.state){case cs.Init:return this.state=cs.SYNSent,Wt.SYN;case cs.SYNReceived:return this.state=cs.Established,Wt.ACK;default:return 0}}sendWindowUpdate(){const t=this.getSendFlags(),n=Date.now(),i=this.getRTT();if(t===0&&i>-1&&n-this.epochStart<i*4&&(this.recvWindow=Math.min(this.recvWindow*2,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&t===0)return;const s=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=n,this.sendFrame({type:ar.WindowUpdate,flag:t,streamID:this._id,length:s})}}const PL="/yamux/1.0.0",uye=500;Wj=Symbol.toStringTag,qj=dr;class dye{constructor(e,t={}){u(this,"protocol",PL);u(this,"_components");u(this,"_init");u(this,Wj,"@chainsafe/libp2p-yamux");u(this,qj,["@libp2p/stream-multiplexing"]);this._components=e,this._init=t}createStreamMuxer(e){return new hye(this._components,{...this._init,...e})}}class hye{constructor(e,t){u(this,"protocol",PL);u(this,"source");u(this,"sink");u(this,"config");u(this,"log");u(this,"logger");u(this,"closeController");u(this,"nextStreamID");u(this,"_streams");u(this,"nextPingID");u(this,"activePing");u(this,"rtt");u(this,"client");u(this,"localGoAway");u(this,"remoteGoAway");u(this,"numInboundStreams");u(this,"numOutboundStreams");u(this,"onIncomingStream");u(this,"onStreamEnd");var n;this.client=t.direction==="outbound",this.config={...tye,...t},this.logger=e.logger,this.log=this.logger.forComponent("libp2p:yamux"),rye(this.config),this.closeController=new AbortController,this.closeController.signal,this.onIncomingStream=t.onIncomingStream,this.onStreamEnd=t.onStreamEnd,this._streams=new Map,this.source=go({onEnd:()=>{var i;(i=this.log)==null||i.trace("muxer source ended"),this._streams.forEach(s=>{s.destroy()})}}),this.sink=async i=>{var c,l,d;const s=()=>{const h=SL(i);if(h.return!=null){const p=h.return();fye(p)&&p.catch(b=>{var f;(f=this.log)==null||f.call(this,"could not cause sink source to return",b)})}};let o,a;try{const h=new sye(i);try{this.closeController.signal.addEventListener("abort",s);for await(const p of h.emitFrames())await this.handleFrame(p.header,p.readData)}finally{this.closeController.signal.removeEventListener("abort",s)}o=Ks.NormalTermination}catch(h){Z2e.has(h.name)?((c=this.log)==null||c.error("protocol error in sink",h),o=Ks.ProtocolError):((l=this.log)==null||l.error("internal error in sink",h),o=Ks.InternalError),a=h}(d=this.log)==null||d.trace("muxer sink ended"),a!=null?this.abort(a,o):await this.close({reason:o})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,(n=this.log)==null||n.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("keepalive error: %s",i)}),this.ping().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("ping error: %s",i)})}get streams(){return Array.from(this._streams.values())}newStream(e){var i;if(this.remoteGoAway!==void 0)throw new Pl("Muxer closed remotely");if(this.localGoAway!==void 0)throw new Pl("Muxer closed locally");const t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new B2("max outbound streams exceeded");(i=this.log)==null||i.trace("new outgoing stream id=%s",t);const n=this._newStream(t,e,cs.Init,"outbound");return this._streams.set(t,n),this.numOutboundStreams++,n.sendWindowUpdate(),n}async ping(){if(this.remoteGoAway!==void 0)throw new Pl("Muxer closed remotely");if(this.localGoAway!==void 0)throw new Pl("Muxer closed locally");if(this.activePing===void 0){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((i,s)=>{const o=()=>{s(new Pl("Muxer closed locally"))};this.closeController.signal.addEventListener("abort",o,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",o),i()}}),resolve:e};const t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const n=Date.now();this.rtt=n-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(e={}){var n;if(this.closeController.signal.aborted)return;const t=(e==null?void 0:e.reason)??Ks.NormalTermination;if((n=this.log)==null||n.trace("muxer close reason=%s",t),e.signal==null){const i=AbortSignal.timeout(uye);e={...e,signal:i}}try{await Promise.all([...this._streams.values()].map(async i=>i.close(e))),this.sendGoAway(t),this._closeMuxer()}catch(i){this.abort(i)}}abort(e,t){var n;if(!this.closeController.signal.aborted){t=t??Ks.InternalError,(n=this.log)==null||n.error("muxer abort reason=%s error=%s",t,e);for(const i of this._streams.values())i.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,n,i){if(this._streams.get(e)!=null)throw new Z("Stream already exists with that id");const s=new lye({id:e.toString(),name:t,state:n,direction:i,sendFrame:this.sendFrame.bind(this),onEnd:()=>{var o;this.closeStream(e),(o=this.onStreamEnd)==null||o.call(this,s)},log:this.logger.forComponent(`libp2p:yamux:${i}:${e}`),config:this.config,getRTT:this.getRTT.bind(this)});return s}closeStream(e){this.client===(e%2===0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){var t;const e=new Promise((n,i)=>{this.closeController.signal.addEventListener("abort",i,{once:!0})});for((t=this.log)==null||t.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let n;try{await Promise.race([e,new Promise(i=>{n=setTimeout(i,this.config.keepAliveInterval)})]),this.ping().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("ping error: %s",i)})}catch{clearInterval(n);return}}}async handleFrame(e,t){var o;const{streamID:n,type:i,length:s}=e;if((o=this.log)==null||o.trace("received frame %o",e),n===0)switch(i){case ar.Ping:{this.handlePing(e);return}case ar.GoAway:{this.handleGoAway(s);return}default:throw new Jl("Invalid frame type")}else switch(e.type){case ar.Data:case ar.WindowUpdate:{await this.handleStreamMessage(e,t);return}default:throw new Jl("Invalid frame type")}}handlePing(e){var t,n;if(e.flag===Wt.SYN)(t=this.log)==null||t.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,Wt.ACK);else if(e.flag===Wt.ACK)(n=this.log)==null||n.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length);else throw new Jl("Invalid frame flag")}handlePingResponse(e){if(this.activePing===void 0)throw new V9("ping not requested");if(this.activePing.id!==e)throw new K9("ping doesn't match our id");this.activePing.resolve()}handleGoAway(e){var t;(t=this.log)==null||t.trace("received GoAway reason=%s",Ks[e]??"unknown"),this.remoteGoAway=e;for(const n of this._streams.values())n.reset();this._closeMuxer()}async handleStreamMessage(e,t){var a,c;const{streamID:n,flag:i,type:s}=e;(i&Wt.SYN)===Wt.SYN&&this.incomingStream(n);const o=this._streams.get(n);if(o===void 0){if(s===ar.Data){if((a=this.log)==null||a.call(this,"discarding data for stream id=%s",n),t===void 0)throw new Error("unreachable");await t()}else(c=this.log)==null||c.trace("frame for missing stream id=%s",n);return}switch(s){case ar.WindowUpdate:{o.handleWindowUpdate(e);return}case ar.Data:{if(t===void 0)throw new Error("unreachable");await o.handleData(e,t);return}default:throw new Error("unreachable")}}incomingStream(e){var n,i,s;if(this.client!==(e%2===0))throw new Z("Both endpoints are clients");if(this._streams.has(e))return;if((n=this.log)==null||n.trace("new incoming stream id=%s",e),this.localGoAway!==void 0){this.sendFrame({type:ar.WindowUpdate,flag:Wt.RST,streamID:e,length:0});return}if(this.numInboundStreams>=this.config.maxInboundStreams){(i=this.log)==null||i.call(this,"maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:ar.WindowUpdate,flag:Wt.RST,streamID:e,length:0});return}const t=this._newStream(e,void 0,cs.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),(s=this.onIncomingStream)==null||s.call(this,t)}sendFrame(e,t){var n;if((n=this.log)==null||n.trace("sending frame %o",e),e.type===ar.Data){if(t===void 0)throw new Jl("Invalid frame");this.source.push(new Ue(_L(e),t))}else this.source.push(_L(e))}sendPing(e,t=Wt.SYN){var n,i;t===Wt.SYN?(n=this.log)==null||n.trace("sending ping request pingId=%s",e):(i=this.log)==null||i.trace("sending ping response pingId=%s",e),this.sendFrame({type:ar.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=Ks.NormalTermination){var t;(t=this.log)==null||t.call(this,"sending GoAway reason=%s",Ks[e]),this.localGoAway=e,this.sendFrame({type:ar.GoAway,flag:0,streamID:0,length:e})}}function fye(r){return r!=null&&typeof r.then=="function"}function pye(r={}){return e=>new dye(e,r)}const gye=41;function DL(r){try{const[[e,t]]=r.stringTuples();if(t==null)return!1;if(e===gye)return Rhe("2000::/3",t)}catch{}return!1}const yye=4,mye=41;function $L(r){try{const[[e]]=r.stringTuples();return e===yye||e===mye}catch{}return!1}function Yl(r){try{if(!$L(r))return!1;const[[,e]]=r.stringTuples();return e==null?!1:vc(e)??!1}catch{}return!0}function wye(r,e,t){let n,i;function s(){const a={signal:i.signal};if((t==null?void 0:t.timeout)!=null){const c=pt([i.signal,AbortSignal.timeout(t.timeout)]);a.signal=c}Promise.resolve().then(async()=>{await r(a)}).catch(()=>{}).finally(()=>{i.signal.aborted||(n=setTimeout(s,e))})}let o=!1;return{setInterval:a=>{e=a,n!=null&&(clearTimeout(n),n=setTimeout(s,e))},setTimeout:a=>{t==null&&(t={}),t.timeout=a},start:()=>{o||(o=!0,i=new AbortController,i.signal,(t==null?void 0:t.runImmediately)===!0?queueMicrotask(()=>{s()}):n=setTimeout(s,e))},stop:()=>{clearTimeout(n),i==null||i.abort(),o=!1}}}function li(r,e){const t=Zd(r,e),n={read:async(i,s)=>{const o=await t.read(s);return i.decode(o)},write:async(i,s,o)=>{await t.write(s.encode(i),o)},writeV:async(i,s,o)=>{await t.writeV(i.map(a=>s.encode(a)),o)},pb:i=>({read:async s=>n.read(i,s),write:async(s,o)=>n.write(s,i,o),writeV:async(s,o)=>n.writeV(s,i,o),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}function bye(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var vye=ML,NL=128,Eye=-128,Sye=Math.pow(2,31);function ML(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Sye;)e[t++]=r&255|NL,r/=128;for(;r&Eye;)e[t++]=r&255|NL,r>>>=7;return e[t]=r|0,ML.bytes=t-n+1,e}var xye=G9,Aye=128,OL=127;function G9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw G9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&OL)<<i:(o&OL)*Math.pow(2,i),i+=7}while(o>=Aye);return G9.bytes=s-n,t}var Cye=Math.pow(2,7),Iye=Math.pow(2,14),kye=Math.pow(2,21),_ye=Math.pow(2,28),Tye=Math.pow(2,35),Pye=Math.pow(2,42),Dye=Math.pow(2,49),$ye=Math.pow(2,56),Nye=Math.pow(2,63),Mye=function(r){return r<Cye?1:r<Iye?2:r<kye?3:r<_ye?4:r<Tye?5:r<Pye?6:r<Dye?7:r<$ye?8:r<Nye?9:10},Oye={encode:vye,decode:xye,encodingLength:Mye},RL=Oye;function LL(r,e=0){return[RL.decode(r,e),RL.decode.bytes]}function Rye(r){const e=bye(r),[t,n]=LL(e),[i,s]=LL(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Lye(t,i,o,e)}let Lye=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};const Bye="libp2p",Uye="autonat",Fye="1.0.0",zye=3e4,Vye=2,Kye=20,jye=80,Hye=8192;var Rt;(function(r){(function(i){i.DIAL="DIAL",i.DIAL_RESPONSE="DIAL_RESPONSE"})(r.MessageType||(r.MessageType={}));let e;(function(i){i[i.DIAL=0]="DIAL",i[i.DIAL_RESPONSE=1]="DIAL_RESPONSE"})(e||(e={})),function(i){i.codec=()=>kn(e)}(r.MessageType||(r.MessageType={})),function(i){i.OK="OK",i.E_DIAL_ERROR="E_DIAL_ERROR",i.E_DIAL_REFUSED="E_DIAL_REFUSED",i.E_BAD_REQUEST="E_BAD_REQUEST",i.E_INTERNAL_ERROR="E_INTERNAL_ERROR"}(r.ResponseStatus||(r.ResponseStatus={}));let t;(function(i){i[i.OK=0]="OK",i[i.E_DIAL_ERROR=100]="E_DIAL_ERROR",i[i.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",i[i.E_BAD_REQUEST=200]="E_BAD_REQUEST",i[i.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"})(t||(t={})),function(i){i.codec=()=>kn(t)}(r.ResponseStatus||(r.ResponseStatus={})),function(i){let s;i.codec=()=>(s==null&&(s=$e((o,a,c={})=>{if(c.lengthDelimited!==!1&&a.fork(),o.id!=null&&(a.uint32(10),a.bytes(o.id)),o.addrs!=null)for(const l of o.addrs)a.uint32(18),a.bytes(l);c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{var h;const l={addrs:[]},d=a==null?o.len:o.pos+a;for(;o.pos<d;){const p=o.uint32();switch(p>>>3){case 1:{l.id=o.bytes();break}case 2:{if(((h=c.limits)==null?void 0:h.addrs)!=null&&l.addrs.length===c.limits.addrs)throw new mt('Decode error - map field "addrs" had too many elements');l.addrs.push(o.bytes());break}default:{o.skipType(p&7);break}}}return l})),s),i.encode=o=>De(o,i.codec()),i.decode=(o,a)=>Pe(o,i.codec(),a)}(r.PeerInfo||(r.PeerInfo={})),function(i){let s;i.codec=()=>(s==null&&(s=$e((o,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),o.peer!=null&&(a.uint32(10),r.PeerInfo.codec().encode(o.peer,a)),c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{var h;const l={},d=a==null?o.len:o.pos+a;for(;o.pos<d;){const p=o.uint32();switch(p>>>3){case 1:{l.peer=r.PeerInfo.codec().decode(o,o.uint32(),{limits:(h=c.limits)==null?void 0:h.peer});break}default:{o.skipType(p&7);break}}}return l})),s),i.encode=o=>De(o,i.codec()),i.decode=(o,a)=>Pe(o,i.codec(),a)}(r.Dial||(r.Dial={})),function(i){let s;i.codec=()=>(s==null&&(s=$e((o,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),o.status!=null&&(a.uint32(8),r.ResponseStatus.codec().encode(o.status,a)),o.statusText!=null&&(a.uint32(18),a.string(o.statusText)),o.addr!=null&&(a.uint32(26),a.bytes(o.addr)),c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{const l={},d=a==null?o.len:o.pos+a;for(;o.pos<d;){const h=o.uint32();switch(h>>>3){case 1:{l.status=r.ResponseStatus.codec().decode(o);break}case 2:{l.statusText=o.string();break}case 3:{l.addr=o.bytes();break}default:{o.skipType(h&7);break}}}return l})),s),i.encode=o=>De(o,i.codec()),i.decode=(o,a)=>Pe(o,i.codec(),a)}(r.DialResponse||(r.DialResponse={}));let n;r.codec=()=>(n==null&&(n=$e((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.type!=null&&(s.uint32(8),r.MessageType.codec().encode(i.type,s)),i.dial!=null&&(s.uint32(18),r.Dial.codec().encode(i.dial,s)),i.dialResponse!=null&&(s.uint32(26),r.DialResponse.codec().encode(i.dialResponse,s)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l,d;const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const h=i.uint32();switch(h>>>3){case 1:{a.type=r.MessageType.codec().decode(i);break}case 2:{a.dial=r.Dial.codec().decode(i,i.uint32(),{limits:(l=o.limits)==null?void 0:l.dial});break}case 3:{a.dialResponse=r.DialResponse.codec().decode(i,i.uint32(),{limits:(d=o.limits)==null?void 0:d.dialResponse});break}default:{i.skipType(h&7);break}}}return a})),n),r.encode=i=>De(i,r.codec()),r.decode=(i,s)=>Pe(i,r.codec(),s)})(Rt||(Rt={}));const qye=4,Wye=8;class Gye{constructor(e,t){u(this,"components");u(this,"protocol");u(this,"timeout");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"maxMessageSize");u(this,"started");u(this,"log");u(this,"topologyId");u(this,"dialResults");u(this,"findPeers");u(this,"addressFilter");u(this,"connectionThreshold");u(this,Qj,"@libp2p/autonat");u(this,Gj,["@libp2p/autonat"]);this.components=e,this.log=e.logger.forComponent("libp2p:auto-nat"),this.started=!1,this.protocol=`/${t.protocolPrefix??Bye}/${Uye}/${Fye}`,this.timeout=t.timeout??zye,this.maxInboundStreams=t.maxInboundStreams??Vye,this.maxOutboundStreams=t.maxOutboundStreams??Kye,this.connectionThreshold=t.connectionThreshold??jye,this.maxMessageSize=t.maxMessageSize??Hye,this.dialResults=new Map,this.findPeers=wye(this.findRandomPeers.bind(this),6e4),this.addressFilter=Vl(1024)}get[(Qj=Symbol.toStringTag,Gj=dr,Ja)](){return["@libp2p/identify"]}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,e=>{this.handleIncomingAutonatStream(e).catch(t=>{this.log.error("error handling incoming autonat stream - %e",t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.topologyId=await this.components.registrar.register(this.protocol,{onConnect:(e,t)=>{this.verifyExternalAddresses(t).catch(n=>{this.log.error("could not verify addresses - %e",n)})}}),this.findPeers.start(),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),this.topologyId!=null&&await this.components.registrar.unhandle(this.topologyId),this.dialResults.clear(),this.findPeers.stop(),this.started=!1}allAddressesAreVerified(){return this.components.addressManager.getAddressesWithMetadata().every(e=>e.expires>Date.now()?!0:e.verified)}async findRandomPeers(e){if(this.allAddressesAreVerified())return;const t=pt([AbortSignal.timeout(1e4),e==null?void 0:e.signal]);try{this.log("starting random walk to find peers to run AutoNAT");for await(const n of this.components.randomWalk.walk({signal:t})){if(!await this.components.connectionManager.isDialable(n.multiaddrs)){this.log.trace("random peer %p was not dialable %s",n.id,n.multiaddrs.map(i=>i.toString()).join(", "));continue}try{this.log.trace("dial random peer %p",n.id),await this.components.connectionManager.openConnection(n.multiaddrs,{signal:t})}catch{}if(this.allAddressesAreVerified()){this.log("stopping random walk, all addresses are verified");return}if(!this.hasConnectionCapacity()){this.log("stopping random walk, too close to max connections");return}}}catch{}}async handleIncomingAutonatStream(e){const t=AbortSignal.timeout(this.timeout),n=li(e.stream,{maxDataLength:this.maxMessageSize}).pb(Rt);try{const i=await n.read({signal:t}),s=await this.handleAutonatMessage(i,e.connection,{signal:t});await n.write(s,{signal:t}),await n.unwrap().unwrap().close({signal:t})}catch(i){this.log.error("error handling incoming autonat stream - %e",i),e.stream.abort(i)}}async handleAutonatMessage(e,t,n){const i=this.components.addressManager.getAddresses().map(h=>h.toOptions().host),s=e.dial;if(s==null)return this.log.error("dial was missing from message"),{type:Rt.MessageType.DIAL_RESPONSE,dialResponse:{status:Rt.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}};let o;const a=s.peer;if((a==null?void 0:a.id)==null)return this.log.error("PeerId missing from message"),{type:Rt.MessageType.DIAL_RESPONSE,dialResponse:{status:Rt.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}};try{const h=Rye(a.id);o=ti(h)}catch(h){return this.log.error("invalid PeerId - %e",h),{type:Rt.MessageType.DIAL_RESPONSE,dialResponse:{status:Rt.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}}if(this.log("incoming request from %p",o),!t.remotePeer.equals(o))return this.log("target peer %p did not equal sending peer %p",o,t.remotePeer),{type:Rt.MessageType.DIAL_RESPONSE,dialResponse:{status:Rt.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}};const c=a.addrs.map(h=>Re(h)).filter(h=>{const p=h.toOptions();return Yl(h)?!1:p.host!==t.remoteAddr.toOptions().host?(this.log.trace("not dialing %a - target host did not match remote host %a",h,t.remoteAddr),!1):i.includes(p.host)?!1:this.components.transportManager.dialTransportForMultiaddr(h)==null?(this.log.trace("not dialing %a - transport unsupported",h),!1):!0}).map(h=>(h.getPeerId()==null&&(h=h.encapsulate(`/p2p/${o.toString()}`)),h));if(c.length===0)return this.log("refused to dial all multiaddrs for %p from message",o),{type:Rt.MessageType.DIAL_RESPONSE,dialResponse:{status:Rt.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}};this.log("dial multiaddrs %s for peer %p",c.map(h=>h.toString()).join(", "),o);let l="",d=c[0];for await(const h of c){let p;d=h;try{if(p=await this.components.connectionManager.openConnection(h,n),!p.remoteAddr.equals(h))throw this.log.error("tried to dial %a but dialed %a",h,p.remoteAddr),new Error("Unexpected remote address");return this.log("successfully dialed %p via %a",o,h),{type:Rt.MessageType.DIAL_RESPONSE,dialResponse:{status:Rt.ResponseStatus.OK,addr:p.remoteAddr.decapsulateCode(Ve("p2p").code).bytes}}}catch(b){this.log.error("could not dial %p - %e",o,b),l=b.message}finally{p!=null&&await p.close()}}return{type:Rt.MessageType.DIAL_RESPONSE,dialResponse:{status:Rt.ResponseStatus.E_DIAL_ERROR,statusText:l,addr:d.bytes}}}getFirstUnverifiedMultiaddr(e,t){var i,s;const n=this.components.addressManager.getAddressesWithMetadata().sort((o,a)=>o.type==="observed"&&a.type!=="observed"?1:a.type==="observed"&&o.type!=="observed"?-1:0).filter(o=>!(!(o.expires<Date.now())||o.multiaddr.toOptions().family===6&&(!t||!DL(o.multiaddr))||Yl(o.multiaddr)));for(const o of n){const a=o.multiaddr.toString();let c=this.dialResults.get(a);if(c!=null){if(c.networkSegments.includes(e)){this.log.trace("%a already has a network segment result from %s",c.multiaddr,e);continue}if(c.queue.size>10){this.log.trace("%a already has enough peers queued",c.multiaddr);continue}}if(c==null){const l=o.expires<Date.now();if(l&&((s=(i=this.addressFilter).remove)==null||s.call(i,a)),this.addressFilter.has(a))continue;this.addressFilter.add(a),this.log.trace("creating dial result %s %s",l?"to revalidate":"for",a),c={multiaddr:o.multiaddr,success:0,failure:0,networkSegments:[],verifyingPeers:Noe(),queue:new uc({concurrency:3,maxSize:50}),type:o.type,lastVerified:o.lastVerified},this.dialResults.set(a,c)}return c}}removeOutdatedMultiaddrResults(){const e=new Set(this.components.addressManager.getAddressesWithMetadata().filter(({expires:t})=>t<Date.now()).map(({multiaddr:t})=>t.toString()));for(const t of this.dialResults.keys())e.has(t)||(this.log.trace("remove results for %a",t),this.dialResults.delete(t))}async verifyExternalAddresses(e){if(!this.isStarted())return;this.removeOutdatedMultiaddrResults();const n=(await this.components.peerStore.get(e.remotePeer)).addresses.some(({multiaddr:o})=>o.toOptions().family===6),i=this.getNetworkSegment(e.remoteAddr),s=this.getFirstUnverifiedMultiaddr(i,n);if(s==null){this.log.trace("no unverified public addresses found for peer %p to verify, not requesting verification",e.remotePeer);return}if(!this.hasConnectionCapacity()){s.lastVerified!=null?(this.log("automatically re-verifying %a because we are too close to the connection limit",s.multiaddr),this.confirmAddress(s)):this.log("skipping verifying %a because we are too close to the connection limit",s.multiaddr);return}s.queue.add(async o=>{await this.askPeerToVerify(e,i,o)},{peerId:e.remotePeer,multiaddr:s.multiaddr}).catch(o=>{(s==null?void 0:s.result)==null&&this.log.error("error from %p verifying address %a - %e",e.remotePeer,s==null?void 0:s.multiaddr,o)})}async askPeerToVerify(e,t,n){let i=this.dialResults.get(n.multiaddr.toString());if(i==null){this.log("%a was verified while %p was queued",n.multiaddr,e.remotePeer);return}const s=AbortSignal.timeout(this.timeout);this.log.trace("asking %p to verify multiaddr %s",e.remotePeer,n.multiaddr);const o=await e.newStream(this.protocol,{signal:s});try{const a=li(o).pb(Rt),[,c]=await Promise.all([a.write({type:Rt.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toMultihash().bytes,addrs:[n.multiaddr.bytes]}}},{signal:s}),a.read({signal:s})]);if(c.type!==Rt.MessageType.DIAL_RESPONSE||c.dialResponse==null){this.log("invalid autonat response from %p - %j",e.remotePeer,c);return}const l=c.dialResponse.status;if(this.log.trace("autonat response from %p for %a is %s",e.remotePeer,n.multiaddr,l),l!==Rt.ResponseStatus.OK&&l!==Rt.ResponseStatus.E_DIAL_ERROR)return;if(i=this.dialResults.get(n.multiaddr.toString()),i==null){this.log.trace("peer reported %a as %s but there is no result object",n.multiaddr,c.dialResponse.status);return}if(i.networkSegments.includes(t)){this.log.trace("%a results included network segment %s",n.multiaddr,t);return}if(i.result!=null){this.log.trace("already resolved result for %a, ignoring response from",n.multiaddr,e.remotePeer);return}if(i.verifyingPeers.has(e.remotePeer)){this.log.trace("peer %p has already verified %a, ignoring response",e.remotePeer,n.multiaddr);return}if(i.verifyingPeers.add(e.remotePeer),i.networkSegments.push(t),l===Rt.ResponseStatus.OK){if(i.success++,i.type!=="observed"){this.confirmAddress(i);return}}else l===Rt.ResponseStatus.E_DIAL_ERROR&&i.failure++;this.log("%a success %d failure %d",i.multiaddr,i.success,i.failure),i.success===qye&&this.confirmAddress(i),i.failure===Wye&&this.unconfirmAddress(i)}finally{try{await o.close({signal:s})}catch(a){o.abort(a)}}}hasConnectionCapacity(){const t=this.components.connectionManager.getConnections().length,n=this.components.connectionManager.getMaxConnections();return t/n*100<this.connectionThreshold}confirmAddress(e){this.log("%s address %a is externally dialable",e.type,e.multiaddr),this.components.addressManager.confirmObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!0,e.queue.abort()}unconfirmAddress(e){this.log("%s address %a is not externally dialable",e.type,e.multiaddr),this.components.addressManager.removeObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!1,e.queue.abort()}getNetworkSegment(e){const t=e.toOptions();return t.family===4?t.host.split(".")[0].padStart(3,"0"):t.host.split(":")[0].padStart(4,"0")}}function Qye(r={}){return e=>new Gye(e,r)}const Jye=ge("dns4"),Yye=ge("dns6"),Xye=ge("dnsaddr"),Xl=Qt(ge("dns"),Xye,Jye,Yye),o3=Qt(ge("ip4"),ge("ip6")),rh=Qt(Te(o3,ge("tcp")),Te(Xl,ge("tcp"))),a3=Te(o3,ge("udp")),Zye=Te(a3,ge("utp")),eme=Te(a3,ge("quic")),tme=Te(a3,ge("quic-v1")),Q9=Qt(Te(rh,ge("ws")),Te(Xl,ge("ws"))),c3=Qt(Te(Q9,ge("p2p")),Q9),J9=Qt(Te(rh,ge("wss")),Te(Xl,ge("wss")),Te(rh,ge("tls"),ge("ws")),Te(Xl,ge("tls"),ge("ws"))),l3=Qt(Te(J9,ge("p2p")),J9),Y9=Qt(Te(rh,ge("http")),Te(o3,ge("http")),Te(Xl,ge("http"))),X9=Qt(Te(rh,ge("https")),Te(o3,ge("https")),Te(Xl,ge("https"))),BL=Te(a3,ge("webrtc-direct"),ge("certhash")),UL=Qt(Te(BL,ge("p2p")),BL),FL=Te(tme,ge("webtransport"),ge("certhash"),ge("certhash")),zL=Qt(Te(FL,ge("p2p")),FL),VL=Qt(Te(c3,ge("p2p-webrtc-star"),ge("p2p")),Te(l3,ge("p2p-webrtc-star"),ge("p2p")),Te(c3,ge("p2p-webrtc-star")),Te(l3,ge("p2p-webrtc-star")));Qt(Te(c3,ge("p2p-websocket-star"),ge("p2p")),Te(l3,ge("p2p-websocket-star"),ge("p2p")),Te(c3,ge("p2p-websocket-star")),Te(l3,ge("p2p-websocket-star")));const KL=Qt(Te(Y9,ge("p2p-webrtc-direct"),ge("p2p")),Te(X9,ge("p2p-webrtc-direct"),ge("p2p")),Te(Y9,ge("p2p-webrtc-direct")),Te(X9,ge("p2p-webrtc-direct"))),Zl=Qt(Q9,J9,Y9,X9,VL,KL,rh,Zye,eme,Xl,UL,zL);Qt(Te(Zl,ge("p2p-stardust"),ge("p2p")),Te(Zl,ge("p2p-stardust")));const Pc=Qt(Te(Zl,ge("p2p")),VL,KL,UL,zL,ge("p2p")),jL=Qt(Te(Pc,ge("p2p-circuit"),Pc),Te(Pc,ge("p2p-circuit")),Te(ge("p2p-circuit"),Pc),Te(Zl,ge("p2p-circuit")),Te(ge("p2p-circuit"),Zl),ge("p2p-circuit")),HL=()=>Qt(Te(jL,HL),jL),eu=HL(),rme=Qt(Te(eu,Pc,eu),Te(Pc,eu),Te(eu,Pc),eu,Pc);Qt(Te(eu,ge("webrtc"),ge("p2p")),Te(eu,ge("webrtc")),Te(Zl,ge("webrtc"),ge("p2p")),Te(Zl,ge("webrtc")),ge("webrtc"));function qL(r){function e(t){let n;try{n=Re(t)}catch{return!1}const i=r(n.protoNames());return i===null?!1:i===!0||i===!1?i:i.length===0}return e}function Te(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(i=>(n=typeof i=="function"?i().partialMatch(t):i.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:qL(e),partialMatch:e}}function Qt(...r){function e(n){let i=null;return r.some(s=>{const o=typeof s=="function"?s().partialMatch(n):s.partialMatch(n);return o!=null?(i=o,!0):!1}),i}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:qL(e),partialMatch:e}}function ge(r){const e=r;function t(i){let s;try{s=Re(i)}catch{return!1}const o=s.protoNames();return o.length===1&&o[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}const nme="bootstrap",ime=50,sme=1e3;class WL extends(Zj=er,Xj=P2,Yj=Symbol.toStringTag,Jj=dr,Zj){constructor(t,n={list:[]}){if(n.list==null||n.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super();u(this,"log");u(this,"timer");u(this,"list");u(this,"timeout");u(this,"components");u(this,"_init");u(this,Xj,this);u(this,Yj,"@libp2p/bootstrap");u(this,Jj,["@libp2p/peer-discovery"]);this.components=t,this.log=t.logger.forComponent("libp2p:bootstrap"),this.timeout=n.timeout??sme,this.list=[];for(const i of n.list){if(!rme.matches(i)){this.log.error("Invalid multiaddr");continue}const s=Re(i),o=s.getPeerId();if(o==null){this.log.error("Invalid bootstrap multiaddr without peer id");continue}const a={id:tr(o),multiaddrs:[s]};this.list.push(a)}this._init=n}isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(t=>{this.log.error(t)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(const t of this.list){if(await this.components.peerStore.merge(t.id,{tags:{[this._init.tagName??nme]:{value:this._init.tagValue??ime,ttl:this._init.tagTTL}},multiaddrs:t.multiaddrs}),this.timer==null)return;this.safeDispatchEvent("peer",{detail:t}),this.components.connectionManager.openConnection(t.id).catch(n=>{this.log.error("could not dial bootstrap peer %p",t.id,n)})}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}}u(WL,"tag","bootstrap");function u3(r){return e=>new WL(e,r)}var d3;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(n.uint32(26),n.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={publicKey:Ge(0),payloadType:Ge(0),payload:Ge(0),signature:Ge(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.publicKey=t.bytes();break}case 2:{s.payloadType=t.bytes();break}case 3:{s.payload=t.bytes();break}case 5:{s.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(d3||(d3={}));class ome extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}}const Wc=class Wc{constructor(e){u(this,"publicKey");u(this,"payloadType");u(this,"payload");u(this,"signature");u(this,"marshaled");const{publicKey:t,payloadType:n,payload:i,signature:s}=e;this.publicKey=t,this.payloadType=n,this.payload=i,this.signature=s}marshal(){return this.marshaled==null&&(this.marshaled=d3.encode({publicKey:_i(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return We(this.marshal(),e.marshal())}async validate(e){const t=GL(e,this.payloadType,this.payload);return this.publicKey.verify(t.subarray(),this.signature)}};u(Wc,"createFromProtobuf",async e=>{const t=d3.decode(e),n=_n(t.publicKey);return new Wc({publicKey:n,payloadType:t.payloadType,payload:t.payload,signature:t.signature})}),u(Wc,"seal",async(e,t)=>{if(t==null)throw new Error("Missing private key");const n=e.domain,i=e.codec,s=e.marshal(),o=GL(n,i,s),a=await t.sign(o.subarray());return new Wc({publicKey:t.publicKey,payloadType:i,payload:s,signature:a})}),u(Wc,"openAndCertify",async(e,t)=>{const n=await Wc.createFromProtobuf(e);if(!await n.validate(t))throw new ome("Envelope signature is not valid for the given domain");return n});let Dc=Wc;const GL=(r,e,t)=>{const n=oe(r),i=Sr(n.byteLength),s=Sr(e.length),o=Sr(t.length);return new Ue(i,n,s,e,o,t)};function ame(r,e){const t=(n,i)=>n.toString().localeCompare(i.toString());return r.length!==e.length?!1:(e.sort(t),r.sort(t).every((n,i)=>e[i].equals(n)))}function cme(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var lme=JL,QL=128,ume=-128,dme=Math.pow(2,31);function JL(r,e,t){e=e||[],t=t||0;for(var n=t;r>=dme;)e[t++]=r&255|QL,r/=128;for(;r&ume;)e[t++]=r&255|QL,r>>>=7;return e[t]=r|0,JL.bytes=t-n+1,e}var hme=Z9,fme=128,YL=127;function Z9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Z9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&YL)<<i:(o&YL)*Math.pow(2,i),i+=7}while(o>=fme);return Z9.bytes=s-n,t}var pme=Math.pow(2,7),gme=Math.pow(2,14),yme=Math.pow(2,21),mme=Math.pow(2,28),wme=Math.pow(2,35),bme=Math.pow(2,42),vme=Math.pow(2,49),Eme=Math.pow(2,56),Sme=Math.pow(2,63),xme=function(r){return r<pme?1:r<gme?2:r<yme?3:r<mme?4:r<wme?5:r<bme?6:r<vme?7:r<Eme?8:r<Sme?9:10},Ame={encode:lme,decode:hme,encodingLength:xme},XL=Ame;function ZL(r,e=0){return[XL.decode(r,e),XL.decode.bytes]}function Cme(r){const e=cme(r),[t,n]=ZL(e),[i,s]=ZL(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Ime(t,i,o,e)}let Ime=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};const kme="libp2p-peer-record",_me=Uint8Array.from([3,1]);var h3;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.multiaddr!=null&&i.multiaddr.byteLength>0&&(s.uint32(10),s.bytes(i.multiaddr)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={multiaddr:Ge(0)},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.multiaddr=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)})(r.AddressInfo||(r.AddressInfo={}));let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.peerId!=null&&t.peerId.byteLength>0&&(n.uint32(10),n.bytes(t.peerId)),t.seq!=null&&t.seq!==0n&&(n.uint32(16),n.uint64(t.seq)),t.addresses!=null)for(const s of t.addresses)n.uint32(26),r.AddressInfo.codec().encode(s,n);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={peerId:Ge(0),seq:0n,addresses:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.peerId=t.bytes();break}case 2:{s.seq=t.uint64();break}case 3:{if(((a=i.limits)==null?void 0:a.addresses)!=null&&s.addresses.length===i.limits.addresses)throw new mt('Decode error - map field "addresses" had too many elements');s.addresses.push(r.AddressInfo.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.addresses$}));break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(h3||(h3={}));const ha=class ha{constructor(e){u(this,"peerId");u(this,"multiaddrs");u(this,"seqNumber");u(this,"domain",ha.DOMAIN);u(this,"codec",ha.CODEC);u(this,"marshaled");const{peerId:t,multiaddrs:n,seqNumber:i}=e;this.peerId=t,this.multiaddrs=n??[],this.seqNumber=i??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=h3.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof ha)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!ame(this.multiaddrs,e.multiaddrs))}};u(ha,"createFromProtobuf",e=>{const t=h3.decode(e),n=ti(Cme(t.peerId)),i=(t.addresses??[]).map(o=>Re(o.multiaddr)),s=t.seq;return new ha({peerId:n,multiaddrs:i,seqNumber:s})}),u(ha,"DOMAIN",kme),u(ha,"CODEC",_me);let js=ha;function eB(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var Tme=rB,tB=128,Pme=-128,Dme=Math.pow(2,31);function rB(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Dme;)e[t++]=r&255|tB,r/=128;for(;r&Pme;)e[t++]=r&255|tB,r>>>=7;return e[t]=r|0,rB.bytes=t-n+1,e}var $me=eE,Nme=128,nB=127;function eE(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw eE.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&nB)<<i:(o&nB)*Math.pow(2,i),i+=7}while(o>=Nme);return eE.bytes=s-n,t}var Mme=Math.pow(2,7),Ome=Math.pow(2,14),Rme=Math.pow(2,21),Lme=Math.pow(2,28),Bme=Math.pow(2,35),Ume=Math.pow(2,42),Fme=Math.pow(2,49),zme=Math.pow(2,56),Vme=Math.pow(2,63),Kme=function(r){return r<Mme?1:r<Ome?2:r<Rme?3:r<Lme?4:r<Bme?5:r<Ume?6:r<Fme?7:r<zme?8:r<Vme?9:10},jme={encode:Tme,decode:$me,encodingLength:Kme},iB=jme;function sB(r,e=0){return[iB.decode(r,e),iB.decode.bytes]}function Hme(r){const e=eB(r),[t,n]=sB(e),[i,s]=sB(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new qme(t,i,o,e)}let qme=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};const Wme=290,Gme=1,oB=2e3,Qme=100,f3=`${D2}-circuit-relay`;BigInt(1<<17);const p3="/libp2p/circuit/relay/0.2.0/hop",aB="/libp2p/circuit/relay/0.2.0/stop",cB=300,Jme=4096,Yme=.001;var nh;(function(r){(function(n){n.RESERVE="RESERVE",n.CONNECT="CONNECT",n.STATUS="STATUS"})(r.Type||(r.Type={}));let e;(function(n){n[n.RESERVE=0]="RESERVE",n[n.CONNECT=1]="CONNECT",n[n.STATUS=2]="STATUS"})(e||(e={})),function(n){n.codec=()=>kn(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=$e((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.peer!=null&&(i.uint32(18),ih.codec().encode(n.peer,i)),n.reservation!=null&&(i.uint32(26),g3.codec().encode(n.reservation,i)),n.limit!=null&&(i.uint32(34),sh.codec().encode(n.limit,i)),n.status!=null&&(i.uint32(40),pn.codec().encode(n.status,i)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{var c,l,d;const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const h=n.uint32();switch(h>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.peer=ih.codec().decode(n,n.uint32(),{limits:(c=s.limits)==null?void 0:c.peer});break}case 3:{o.reservation=g3.codec().decode(n,n.uint32(),{limits:(l=s.limits)==null?void 0:l.reservation});break}case 4:{o.limit=sh.codec().decode(n,n.uint32(),{limits:(d=s.limits)==null?void 0:d.limit});break}case 5:{o.status=pn.codec().decode(n);break}default:{n.skipType(h&7);break}}}return o})),t),r.encode=n=>De(n,r.codec()),r.decode=(n,i)=>Pe(n,r.codec(),i)})(nh||(nh={}));var Ko;(function(r){(function(n){n.CONNECT="CONNECT",n.STATUS="STATUS"})(r.Type||(r.Type={}));let e;(function(n){n[n.CONNECT=0]="CONNECT",n[n.STATUS=1]="STATUS"})(e||(e={})),function(n){n.codec=()=>kn(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=$e((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.peer!=null&&(i.uint32(18),ih.codec().encode(n.peer,i)),n.limit!=null&&(i.uint32(26),sh.codec().encode(n.limit,i)),n.status!=null&&(i.uint32(32),pn.codec().encode(n.status,i)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{var c,l;const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const d=n.uint32();switch(d>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.peer=ih.codec().decode(n,n.uint32(),{limits:(c=s.limits)==null?void 0:c.peer});break}case 3:{o.limit=sh.codec().decode(n,n.uint32(),{limits:(l=s.limits)==null?void 0:l.limit});break}case 4:{o.status=pn.codec().decode(n);break}default:{n.skipType(d&7);break}}}return o})),t),r.encode=n=>De(n,r.codec()),r.decode=(n,i)=>Pe(n,r.codec(),i)})(Ko||(Ko={}));var ih;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.addrs!=null)for(const s of t.addrs)n.uint32(18),n.bytes(s);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={id:Ge(0),addrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.id=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.addrs)!=null&&s.addrs.length===i.limits.addrs)throw new mt('Decode error - map field "addrs" had too many elements');s.addrs.push(t.bytes());break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(ih||(ih={}));var g3;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.expire!=null&&t.expire!==0n&&(n.uint32(8),n.uint64(t.expire)),t.addrs!=null)for(const s of t.addrs)n.uint32(18),n.bytes(s);t.voucher!=null&&(n.uint32(26),m3.codec().encode(t.voucher,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={expire:0n,addrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.expire=t.uint64();break}case 2:{if(((a=i.limits)==null?void 0:a.addrs)!=null&&s.addrs.length===i.limits.addrs)throw new mt('Decode error - map field "addrs" had too many elements');s.addrs.push(t.bytes());break}case 3:{s.voucher=m3.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.voucher});break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(g3||(g3={}));var sh;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.duration!=null&&(n.uint32(8),n.uint32(t.duration)),t.data!=null&&(n.uint32(16),n.uint64(t.data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.duration=t.uint32();break}case 2:{s.data=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(sh||(sh={}));var pn;(function(r){r.UNUSED="UNUSED",r.OK="OK",r.RESERVATION_REFUSED="RESERVATION_REFUSED",r.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONNECTION_FAILED="CONNECTION_FAILED",r.NO_RESERVATION="NO_RESERVATION",r.MALFORMED_MESSAGE="MALFORMED_MESSAGE",r.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"})(pn||(pn={}));var tE;(function(r){r[r.UNUSED=0]="UNUSED",r[r.OK=100]="OK",r[r.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",r[r.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",r[r.PERMISSION_DENIED=202]="PERMISSION_DENIED",r[r.CONNECTION_FAILED=203]="CONNECTION_FAILED",r[r.NO_RESERVATION=204]="NO_RESERVATION",r[r.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",r[r.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"})(tE||(tE={})),function(r){r.codec=()=>kn(tE)}(pn||(pn={}));var y3;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.relay!=null&&t.relay.byteLength>0&&(n.uint32(10),n.bytes(t.relay)),t.peer!=null&&t.peer.byteLength>0&&(n.uint32(18),n.bytes(t.peer)),t.expiration!=null&&t.expiration!==0n&&(n.uint32(24),n.uint64(t.expiration)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={relay:Ge(0),peer:Ge(0),expiration:0n},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.relay=t.bytes();break}case 2:{s.peer=t.bytes();break}case 3:{s.expiration=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(y3||(y3={}));var m3;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&(n.uint32(26),y3.codec().encode(t.payload,n)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={publicKey:Ge(0),payloadType:Ge(0),signature:Ge(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.publicKey=t.bytes();break}case 2:{s.payloadType=t.bytes();break}case 3:{s.payload=y3.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.payload});break}case 5:{s.signature=t.bytes();break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(m3||(m3={}));function Xme(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var Zme=Xme,e3e=Zme;let t3e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},r3e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return lB(this,e)}},n3e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return lB(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function lB(r,e){return new n3e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let i3e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new t3e(e,t,n),this.decoder=new r3e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function uB({name:r,prefix:e,encode:t,decode:n}){return new i3e(r,e,t,n)}function w3({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=e3e(t,r);return uB({prefix:e,name:r,encode:n,decode:s=>eB(i(s))})}function s3e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function o3e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function jo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return uB({prefix:e,name:r,encode(i){return o3e(i,n,t)},decode(i){return s3e(i,n,t,r)}})}jo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),jo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),jo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),jo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),jo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),jo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),jo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),jo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),jo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),w3({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),w3({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),w3({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),w3({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});class rE extends Error{constructor(){super(...arguments);u(this,"name","HadEnoughRelaysError")}}u(rE,"name","HadEnoughRelaysError");class dB extends Error{constructor(){super(...arguments);u(this,"name","DoubleRelayError")}}u(dB,"name","DoubleRelayError");class hB extends Error{constructor(){super(...arguments);u(this,"name","RelayQueueFullError")}}u(hB,"name","RelayQueueFullError");function fB(r){const e=r*BigInt(1e3),t=new Date().getTime();return Number(e-BigInt(t))}class pB{constructor(e){u(this,"expires");u(this,"bytes");(e==null?void 0:e.duration)!=null&&(e==null?void 0:e.duration)!==0&&(this.expires=Date.now()+e.duration*1e3),this.bytes=e==null?void 0:e.data,this.bytes===0n&&(this.bytes=void 0),this.onData=this.onData.bind(this)}onData(e){this.bytes!=null&&(this.bytes-=BigInt(e.byteLength),this.bytes<0n&&(this.bytes=0n))}getLimits(){if(this.expires==null&&this.bytes==null)return;const e={};if(this.bytes!=null){const t=this;Object.defineProperty(e,"bytes",{get(){return t.bytes}})}if(this.expires!=null){const t=this;Object.defineProperty(e,"seconds",{get(){return Math.round(((t.expires??0)-Date.now())/1e3)}})}return e}}const gB=Ct(et(dO.matchers[0],Qe("p2p-circuit"))),yB=Ct(Qe("p2p-circuit"));function mB(r){const{stream:e,remoteAddr:t,logger:n,onDataRead:i,onDataWrite:s}=r,o=n.forComponent("libp2p:stream:converter");let a=!1,c=!1;const l=e.close.bind(e);e.close=async f=>{await l(f),b(!0)};const d=e.abort.bind(e);e.abort=f=>{d(f),b(!0)};const h=e.sink.bind(e);e.sink=async f=>{try{await h(un(f,g=>cm(g,v=>s==null?void 0:s(v))))}catch(g){g.type!=="aborted"&&o.error("%s error in sink",t,g)}finally{c=!0,b()}};const p={log:o,sink:e.sink,source:async function*(){try{for await(const f of e.source)i==null||i(f),yield f}finally{a=!0,b()}}(),remoteAddr:t,timeline:{open:Date.now(),close:void 0},close:e.close,abort:e.abort};function b(f){f===!0&&(a=!0,c=!0),a&&c&&p.timeline.close==null&&(p.timeline.close=Date.now())}return p}class a3e extends er{constructor(t,n={}){super();u(this,"peerStore");u(this,"registrar");u(this,"connectionManager");u(this,"randomWalk");u(this,"started");u(this,"running");u(this,"topologyId");u(this,"log");u(this,"discoveryController");u(this,"filter");u(this,"queue");this.log=t.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.started=!1,this.running=!1,this.peerStore=t.peerStore,this.registrar=t.registrar,this.connectionManager=t.connectionManager,this.randomWalk=t.randomWalk,this.filter=n.filter,this.discoveryController=new AbortController,this.discoveryController.signal}isStarted(){return this.started}async start(){this.topologyId=await this.registrar.register(p3,{filter:this.filter,onConnect:t=>{var n,i;this.log.trace("discovered relay %p queue (length: %d, active %d)",t,(n=this.queue)==null?void 0:n.size,(i=this.queue)==null?void 0:i.running),this.safeDispatchEvent("relay:discover",{detail:t})}}),this.started=!0}stop(){var t;this.topologyId!=null&&this.registrar.unregister(this.topologyId),(t=this.discoveryController)==null||t.abort(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,this.discoveryController.signal,Promise.resolve().then(async()=>{var i;this.log("searching peer store for relays");const t=await this.peerStore.all({filters:[s=>s.protocols.includes(p3)],orders:[()=>Math.random()<.5?1:-1,(s,o)=>{const a=wB(s),c=wB(o);return a>c?-1:c>a?1:0}]});for(const s of t)this.log.trace("found relay peer %p in peer store",s.id),this.safeDispatchEvent("relay:discover",{detail:s.id});this.log("found %d relay peers in peer store",t.length);const n=this.queue=new uc({concurrency:5});this.log("start random walk");for await(const s of this.randomWalk.walk({signal:this.discoveryController.signal})){if(this.log.trace("found random peer %p",s.id),n.has(s.id)){this.log.trace("random peer %p was already in queue",s.id);continue}if(((i=this.connectionManager.getConnections(s.id))==null?void 0:i.length)>0){this.log.trace("random peer %p was already connected",s.id);continue}if(!await this.connectionManager.isDialable(s.multiaddrs)){this.log.trace("random peer %p was not dialable",s.id,s.multiaddrs.map(o=>o.toString()));continue}n.queued>10&&(this.log.trace("wait for space in queue for %p",s.id),await n.onSizeLessThan(10,{signal:this.discoveryController.signal})),this.log("adding random peer %p to dial queue (length: %d, active %d)",s.id,n.size,n.running),n.add(async()=>{const o=pt([this.discoveryController.signal,AbortSignal.timeout(5e3)]);try{await this.connectionManager.openConnection(s.id,{signal:o})}finally{o.clear()}},{peerId:s.id,signal:this.discoveryController.signal}).catch(o=>{this.log.error("error opening connection to random peer %p",s.id,o)})}this.log("stop random walk"),await n.onIdle()}).catch(t=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network",t)}))}stopDiscovery(){var t;this.log("stop discovery"),this.running=!1,(t=this.discoveryController)==null||t.abort()}}function wB(r){const e=r.metadata.get("last-dial-success");return e==null?0:new Date(re(e)).getTime()}class c3e extends er{constructor(t,n={}){super();u(this,"connectionManager");u(this,"addressManager");u(this,"reservationStore");u(this,"listeningAddrs");u(this,"log");u(this,"listenTimeout");u(this,"reservationId");u(this,"relay");u(this,"_onRemoveRelayPeer",t=>{var n,i;this.log("relay removed %p our relay %p",t.detail.relay,this.relay,(n=this.relay)==null?void 0:n.equals(t.detail.relay)),((i=this.relay)==null?void 0:i.equals(t.detail.relay))===!0&&(this.log("relay peer removed %p",t.detail.relay),this.listeningAddrs.forEach(s=>{this.addressManager.removeObservedAddr(s)}),this.listeningAddrs=[],this.safeDispatchEvent("listening"))});u(this,"_onAddRelayPeer",t=>{const{details:n}=t.detail;n.type!=="configured"&&n.id===this.reservationId&&this.addedRelay(t.detail)});this.log=t.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=t.connectionManager,this.addressManager=t.addressManager,this.reservationStore=t.reservationStore,this.listeningAddrs=[],this.listenTimeout=n.listenTimeout??oB,this.reservationStore.addEventListener("relay:removed",this._onRemoveRelayPeer),this.reservationStore.addEventListener("relay:created-reservation",this._onAddRelayPeer)}async listen(t){if(yB.exactMatch(t))this.log("searching for circuit relay servers"),this.reservationId=this.reservationStore.reserveRelay();else if(gB.exactMatch(t)){this.log("listen on specific relay server %a",t);const n=AbortSignal.timeout(this.listenTimeout),i=t.decapsulate("/p2p-circuit"),s=await this.connectionManager.openConnection(i,{signal:n});if(!this.reservationStore.hasReservation(s.remotePeer)){this.log("making reservation on peer %p",s.remotePeer);const o=await this.reservationStore.addRelay(s.remotePeer,"configured");this.addedRelay(o)}}else throw new L2(`Could not listen on p2p-circuit address "${t}"`)}getAddrs(){return[...this.listeningAddrs.values()].flat()}updateAnnounceAddrs(){}async close(){this.reservationStore.cancelReservations(),this.listeningAddrs=[],this.reservationStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),queueMicrotask(()=>{this.safeDispatchEvent("close")})}addedRelay(t){this.log("relay peer added %p",t.relay),this.relay=t.relay,this.listeningAddrs=t.details.reservation.addrs.map(n=>Re(n).encapsulate("/p2p-circuit")),this.listeningAddrs.forEach(n=>{this.addressManager.confirmObservedAddr(n,{type:"transport"})}),queueMicrotask(()=>{this.safeDispatchEvent("listening")})}}function l3e(r){return new c3e(r)}const u3e="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let d3e=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=u3e[t[r]&63];return e};const h3e=60*1e3*10,f3e=60*1e3*5,p3e=30*1e3;class g3e extends er{constructor(t,n){super();Ye(this,zn);u(this,"peerId");u(this,"connectionManager");u(this,"peerStore");u(this,"events");u(this,"reserveQueue");u(this,"reservations");u(this,"pendingReservations");u(this,"maxReservationQueueLength");u(this,"reservationCompletionTimeout");u(this,"started");u(this,"log");u(this,"relayFilter");this.log=t.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=t.peerId,this.connectionManager=t.connectionManager,this.peerStore=t.peerStore,this.events=t.events,this.reservations=new dc,this.pendingReservations=[],this.maxReservationQueueLength=(n==null?void 0:n.maxReservationQueueLength)??Qme,this.reservationCompletionTimeout=(n==null?void 0:n.reservationCompletionTimeout)??oB,this.started=!1,this.relayFilter=Vl(100),this.reserveQueue=new uc({concurrency:(n==null?void 0:n.reservationConcurrency)??Gme,metricName:"libp2p_relay_reservation_queue",metrics:t.metrics}),this.events.addEventListener("connection:close",i=>{[...this.reservations.values()].find(o=>o.connection===i.detail.id)!=null&&Ie(this,zn,b0).call(this,i.detail.remotePeer).catch(o=>{this.log("could not remove relay %p - %e",i.detail,o)})})}isStarted(){return this.started}start(){this.started=!0}afterStart(){Promise.resolve().then(async()=>{const t=await this.peerStore.all({filters:[n=>n.tags.has(f3)]});this.log("removing tag from %d old relays",t.length),await Promise.all(t.map(async n=>{await this.peerStore.merge(n.id,{tags:{[f3]:void 0}})})),this.log("redialing %d old relays",t.length),await Promise.all(t.map(async n=>this.addRelay(n.id,"discovered"))),Ie(this,zn,v0).call(this)}).catch(t=>{this.log.error(t)})}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:t})=>{clearTimeout(t)}),this.reservations.clear(),this.started=!1}reserveRelay(){const t=d3e();return this.pendingReservations.push(t),Ie(this,zn,v0).call(this),t}async addRelay(t,n){if(this.peerId.equals(t))throw this.log.trace("not trying to use self as relay"),new L2("Cannot use self as relay");if(this.reserveQueue.size>this.maxReservationQueueLength)throw new hB("The reservation queue is full");const i=this.reserveQueue.find(t);if(i!=null)return this.log.trace("potential relay peer %p is already in the reservation queue",t),i.join();if(this.relayFilter.has(t.toMultihash().bytes))throw new L2("The relay was previously invalid");return this.log.trace("try to reserve relay slot with %p",t),this.reserveQueue.add(async()=>{const s=Date.now();try{const o=this.reservations.get(t);if(o!=null){const g=this.connectionManager.getConnections(t);let v=!1;if(g.length===0&&this.log("already have relay reservation with %p but we are no longer connected",t),g.map(y=>y.id).includes(o.connection)&&(this.log("already have relay reservation with %p and the original connection is still open",t),v=!0),v&&fB(o.reservation.expire)>h3e)return this.log("already have relay reservation with %p but we are still connected and it does not expire soon",t),{relay:t,details:o};await Ie(this,zn,b0).call(this,t)}if(n==="discovered"&&this.pendingReservations.length===0)throw new rE("Not making reservation on discovered relay because we do not need any more relays");const a=AbortSignal.timeout(this.reservationCompletionTimeout);const c=await this.connectionManager.openConnection(t,{signal:a});if(Ec.matches(c.remoteAddr))throw new dB("not creating reservation over relayed connection");const l=await Ie(this,zn,iq).call(this,c,{signal:a}),d=fB(l.expire);this.log("created reservation on relay peer %p, expiry date is %s",t,new Date(Date.now()+d).toString());const h=Math.min(Math.max(d-f3e,p3e),Math.pow(2,31)-1),p=setTimeout(()=>{this.log("refresh reservation to relay %p",t),this.addRelay(t,n).catch(async g=>{this.log.error("could not refresh reservation to relay %p - %e",t,g),await Ie(this,zn,b0).call(this,t)}).catch(g=>{this.log.error("could not remove expired reservation to relay %p - %e",t,g)})},h);let b;if(n==="discovered"){const g=this.pendingReservations.pop();if(g==null)throw new rE("Made reservation on relay but did not need any more discovered relays");b={timeout:p,reservation:l,type:n,connection:c.id,id:g}}else b={timeout:p,reservation:l,type:n,connection:c.id};this.reservations.set(t,b),await this.peerStore.merge(t,{tags:{[f3]:{value:1,ttl:d}}}),Ie(this,zn,v0).call(this);const f={relay:t,details:b};return this.safeDispatchEvent("relay:created-reservation",{detail:f}),f}catch(o){throw n==="discovered"&&o.name==="HadEnoughRelaysError"||this.log.error("could not reserve slot on %p after %dms - %e",t,Date.now()-s,o),(o.name==="DialError"||o.name==="UnsupportedProtocolError")&&this.relayFilter.add(t.toMultihash().bytes),Ie(this,zn,b0).call(this,t).catch(a=>{this.log.error("could not remove reservation on %p after reserving slot failed - %e",t,a)}),o}},{peerId:t})}hasReservation(t){return this.reservations.has(t)}getReservation(t){var n;return(n=this.reservations.get(t))==null?void 0:n.reservation}reservationCount(t){return t==null?this.reservations.size:[...this.reservations.values()].reduce((n,i)=>(i.type===t&&n++,n),0)}cancelReservations(){[...this.reservations.values()].forEach(t=>{clearTimeout(t.timeout)}),this.reservations.clear()}}zn=new WeakSet,iq=async function(t,n){var l;(l=n.signal)==null||l.throwIfAborted(),this.log("requesting reservation from %p",t.remotePeer);const i=await t.newStream(p3,n),o=li(i).pb(nh);this.log.trace("send RESERVE to %p",t.remotePeer),await o.write({type:nh.Type.RESERVE},n);let a;try{this.log.trace("reading response from %p",t.remotePeer),a=await o.read(n)}catch(d){throw i.abort(d),d}finally{i.status!=="closed"&&await i.close(n)}if(this.log.trace("read response %o",a),a.status===pn.OK&&a.reservation!=null){const d=new Set;d.add(t.remoteAddr.toString());for(const h of a.reservation.addrs){let p=Re(h);p.getPeerId()==null&&(p=p.encapsulate(`/p2p/${t.remotePeer}`)),p=Re(p.toString().replace(`/p2p/${t.remotePeer}/p2p/${t.remotePeer}`,`/p2p/${t.remotePeer}`)),d.add(p.toString())}return a.reservation.addrs=[...d].map(h=>Re(h).bytes),a.reservation}const c=`reservation failed with status ${a.status??"undefined"}`;throw this.log.error(c),new Error(c)},b0=async function(t){const n=this.reservations.get(t);n!=null&&(this.log("removing relay reservation with %p from local store",t),clearTimeout(n.timeout),this.reservations.delete(t),n.type==="discovered"&&this.pendingReservations.push(n.id),await this.peerStore.merge(t,{tags:{[f3]:void 0}}),this.safeDispatchEvent("relay:removed",{detail:{relay:t,details:n}}),Ie(this,zn,v0).call(this))},v0=function(){if(this.pendingReservations.length===0){this.log.trace("have discovered enough relays"),this.reserveQueue.clear(),this.safeDispatchEvent("relay:found-enough-relays");return}this.relayFilter=Vl(100),this.log("not discovered enough relays %d/%d",this.reservations.size,this.pendingReservations.length),this.safeDispatchEvent("relay:not-enough-relays")};const y3e=r=>{if(r.peer==null)return!1;try{r.peer.addrs.forEach(Re)}catch{return!1}return!0},bB={maxInboundStopStreams:cB,maxOutboundStopStreams:cB};class m3e{constructor(e,t={}){u(this,"discovery");u(this,"registrar");u(this,"peerStore");u(this,"connectionManager");u(this,"transportManager");u(this,"peerId");u(this,"upgrader");u(this,"addressManager");u(this,"connectionGater");u(this,"reservationStore");u(this,"logger");u(this,"maxInboundStopStreams");u(this,"maxOutboundStopStreams");u(this,"started");u(this,"log");u(this,"shutdownController");u(this,nH,"@libp2p/circuit-relay-v2-transport");u(this,rH,["@libp2p/transport","@libp2p/circuit-relay-v2-transport"]);u(this,eH,!0);this.log=e.logger.forComponent("libp2p:circuit-relay:transport"),this.registrar=e.registrar,this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.logger=e.logger,this.peerId=e.peerId,this.upgrader=e.upgrader,this.addressManager=e.addressManager,this.connectionGater=e.connectionGater,this.maxInboundStopStreams=t.maxInboundStopStreams??bB.maxInboundStopStreams,this.maxOutboundStopStreams=t.maxOutboundStopStreams??bB.maxOutboundStopStreams,this.shutdownController=new AbortController,this.discovery=new a3e(e,{filter:t.discoveryFilter??Goe(Jme,Yme)}),this.discovery.addEventListener("relay:discover",n=>{this.reservationStore.addRelay(n.detail,"discovered").catch(i=>{i.name!=="HadEnoughRelaysError"&&i.name!=="RelayQueueFullError"&&this.log.error("could not add discovered relay %p",n.detail,i)})}),this.reservationStore=new g3e(e,t),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{var n;(n=this.discovery)==null||n.startDiscovery()}),this.reservationStore.addEventListener("relay:found-enough-relays",()=>{var n;(n=this.discovery)==null||n.stopDiscovery()}),this.started=!1}get[(nH=Symbol.toStringTag,rH=dr,tH=Ja,eH=N2,tH)](){return this.discovery!=null?["@libp2p/identify"]:[]}isStarted(){return this.started}async start(){this.shutdownController=new AbortController,await this.registrar.handle(aB,e=>{const t=this.upgrader.createInboundAbortSignal(this.shutdownController.signal);this.onStop(e,t).catch(n=>{this.log.error("error while handling STOP protocol",n),e.stream.abort(n)}).finally(()=>{t.clear()})},{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0}),await Io(this.discovery,this.reservationStore),this.started=!0}async stop(){this.shutdownController.abort(),await Qa(this.discovery,this.reservationStore),await this.registrar.unhandle(aB),this.started=!1}async dial(e,t){var b,f,g,v,y,w;if(e.protoCodes().filter(m=>m===Wme).length!==1){const m="Invalid circuit relay address";throw this.log.error(m,e),new Ad(m)}const n=e.toString().split("/p2p-circuit"),i=Re(n[0]),s=Re(n[n.length-1]),o=i.getPeerId(),a=s.getPeerId();if(o==null||a==null){const m=`ircuit relay dial to ${e.toString()} failed as address did not have both relay and destination PeerIDs`;throw this.log.error(`c${m}`),new Ad(`C${m}`)}const c=tr(o),l=tr(a);let h=this.connectionManager.getConnections(c)[0];h==null?(await this.peerStore.merge(c,{multiaddrs:[i]}),(b=t.onProgress)==null||b.call(t,new _e("circuit-relay:open-connection")),h=await this.connectionManager.openConnection(c,t)):(f=t.onProgress)==null||f.call(t,new _e("circuit-relay:reuse-connection"));let p;try{(g=t.onProgress)==null||g.call(t,new _e("circuit-relay:open-hop-stream")),p=await h.newStream(p3,t);const m=li(p),E=m.pb(nh);(v=t.onProgress)==null||v.call(t,new _e("circuit-relay:write-connect-message")),await E.write({type:nh.Type.CONNECT,peer:{id:l.toMultihash().bytes,addrs:[Re(s).bytes]}},t),(y=t.onProgress)==null||y.call(t,new _e("circuit-relay:read-connect-response"));const A=await E.read(t);if(A.status!==pn.OK)throw new St(`failed to connect via relay with status ${((w=A==null?void 0:A.status)==null?void 0:w.toString())??"undefined"}`);const k=new pB(A.limit),x=mB({stream:m.unwrap(),remoteAddr:e,localAddr:i.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`),logger:this.logger,onDataRead:k.onData,onDataWrite:k.onData});return this.log("new outbound relayed connection %a",x.remoteAddr),await this.upgrader.upgradeOutbound(x,{...t,limits:k.getLimits()})}catch(m){throw this.log.error("circuit relay dial to destination %p via relay %p failed",l,c,m),p==null||p.abort(m),m}}createListener(e){return l3e({peerId:this.peerId,connectionManager:this.connectionManager,addressManager:this.addressManager,reservationStore:this.reservationStore,logger:this.logger})}listenFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>gB.exactMatch(t)||yB.exactMatch(t))}dialFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>Ec.exactMatch(t))}async onStop({connection:e,stream:t},n){var d,h;if(!this.reservationStore.hasReservation(e.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.transportManager.listen([e.remoteAddr.encapsulate("/p2p-circuit")])}catch(p){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on",p)}const i=li(t).pb(Ko),s=await i.read({signal:n});if(this.log("new circuit relay v2 stop stream from %p with type %s",e.remotePeer,s.type),(s==null?void 0:s.type)===void 0){this.log.error("type was missing from circuit v2 stop protocol request from %s",e.remotePeer),await i.write({type:Ko.Type.STATUS,status:pn.MALFORMED_MESSAGE},{signal:n}),await t.close();return}if(s.type!==Ko.Type.CONNECT){this.log.error("invalid stop connect request via peer %p",e.remotePeer),await i.write({type:Ko.Type.STATUS,status:pn.UNEXPECTED_MESSAGE},{signal:n}),await t.close();return}if(!y3e(s)){this.log.error("invalid stop connect request via peer %p",e.remotePeer),await i.write({type:Ko.Type.STATUS,status:pn.MALFORMED_MESSAGE},{signal:n}),await t.close({signal:n});return}const o=ti(Hme(s.peer.id));if(await((h=(d=this.connectionGater).denyInboundRelayedConnection)==null?void 0:h.call(d,e.remotePeer,o))===!0){this.log.error("connection gater denied inbound relayed connection from %p",e.remotePeer),await i.write({type:Ko.Type.STATUS,status:pn.PERMISSION_DENIED},{signal:n}),await t.close({signal:n});return}this.log.trace("sending success response to %p",e.remotePeer),await i.write({type:Ko.Type.STATUS,status:pn.OK},{signal:n});const a=new pB(s.limit),c=e.remoteAddr.encapsulate(`/p2p-circuit/p2p/${o.toString()}`);this.addressManager.getAddresses()[0];const l=mB({stream:i.unwrap().unwrap(),remoteAddr:c,logger:this.logger,onDataRead:a.onData,onDataWrite:a.onData});this.log("new inbound relayed connection %a",l.remoteAddr),await this.upgrader.upgradeInbound(l,{limits:a.getLimits(),signal:n}),this.log("%s connection %a upgraded","inbound",l.remoteAddr)}}function b3(r={}){return e=>new m3e(e,r)}const vB=()=>{const r=new Error("Delay aborted");return r.name="AbortError",r},w3e=new WeakMap;function b3e({clearTimeout:r,setTimeout:e}={}){return(t,{value:n,signal:i}={})=>{if(i!=null&&i.aborted)return Promise.reject(vB());let s,o,a;const c=r??clearTimeout,l=()=>{c(s),a(vB())},d=()=>{i&&i.removeEventListener("abort",l)},h=new Promise((p,b)=>{o=()=>{d(),p(n)},a=b,s=(e??setTimeout)(o,t)});return i&&i.addEventListener("abort",l,{once:!0}),w3e.set(h,()=>{c(s),s=null,o()}),h}}const EB=b3e();var Hs;(function(r){(function(n){n.UNUSED="UNUSED",n.CONNECT="CONNECT",n.SYNC="SYNC"})(r.Type||(r.Type={}));let e;(function(n){n[n.UNUSED=0]="UNUSED",n[n.CONNECT=100]="CONNECT",n[n.SYNC=300]="SYNC"})(e||(e={})),function(n){n.codec=()=>kn(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=$e((n,i,s={})=>{if(s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.observedAddresses!=null)for(const o of n.observedAddresses)i.uint32(18),i.bytes(o);s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{var c;const o={observedAddresses:[]},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const l=n.uint32();switch(l>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{if(((c=s.limits)==null?void 0:c.observedAddresses)!=null&&o.observedAddresses.length===s.limits.observedAddresses)throw new mt('Decode error - map field "observedAddresses" had too many elements');o.observedAddresses.push(n.bytes());break}default:{n.skipType(l&7);break}}}return o})),t),r.encode=n=>De(n,r.codec()),r.decode=(n,i)=>Pe(n,r.codec(),i)})(Hs||(Hs={}));function SB(r,e){return Ec.matches(r)||e.dialTransportForMultiaddr(r)==null?!1:tO.matches(r)?!0:whe.matches(r)?vc(r.toOptions().host)===!1:!1}const xB=1024*4,AB=100,v3={timeout:5e3,retries:3,maxInboundStreams:1,maxOutboundStreams:1};sH=Symbol.toStringTag,iH=Ja;class v3e{constructor(e,t){u(this,"started");u(this,"timeout");u(this,"retries");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"peerStore");u(this,"registrar");u(this,"connectionManager");u(this,"addressManager");u(this,"transportManager");u(this,"topologyId");u(this,"log");u(this,sH,"@libp2p/dcutr");u(this,iH,["@libp2p/identify"]);this.log=e.logger.forComponent("libp2p:dcutr"),this.started=!1,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.timeout=t.timeout??v3.timeout,this.retries=t.retries??v3.retries,this.maxInboundStreams=t.maxInboundStreams??v3.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??v3.maxOutboundStreams}isStarted(){return this.started}async start(){this.started||(this.topologyId=await this.registrar.register(E3,{notifyOnLimitedConnection:!0,onConnect:(e,t)=>{Ec.exactMatch(t.remoteAddr)&&t.direction==="inbound"&&this.upgradeInbound(t).catch(n=>{this.log.error("error during outgoing DCUtR attempt",n)})}}),await this.registrar.handle(E3,e=>{this.handleIncomingUpgrade(e.stream,e.connection).catch(t=>{this.log.error("error during incoming DCUtR attempt",t),e.stream.abort(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:!0}),this.started=!0)}async stop(){await this.registrar.unhandle(E3),this.topologyId!=null&&this.registrar.unregister(this.topologyId),this.started=!1}async upgradeInbound(e){if(await this.attemptUnilateralConnectionUpgrade(e))return;let t;for(let n=0;n<this.retries;n++){const i={signal:AbortSignal.timeout(this.timeout)};try{t=await e.newStream([E3],{signal:i.signal,runOnLimitedConnection:!0});const s=li(t,{maxDataLength:xB}).pb(Hs);this.log("B sending connect to %p",e.remotePeer);const o=Date.now();await s.write({type:Hs.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(h=>h.bytes)},i),this.log("B receiving connect from %p",e.remotePeer);const a=await s.read(i);if(a.type!==Hs.Type.CONNECT)throw this.log("A sent wrong message type"),new St("DCUtR message type was incorrect");const c=this.getDialableMultiaddrs(a.observedAddresses);if(c.length===0)throw this.log("A did not have any dialable multiaddrs"),new St("DCUtR connect message had no multiaddrs");const l=Date.now()-o;this.log("A sending sync, rtt %dms",l),await s.write({type:Hs.Type.SYNC,observedAddresses:[]},i),this.log("A waiting for half RTT"),await EB(l/2),this.log("B dialing",c);const d=await this.connectionManager.openConnection(c,{signal:i.signal,priority:AB,force:!0,initiator:!1});this.log("DCUtR to %p succeeded to address %a, closing relayed connection",e.remotePeer,d.remoteAddr),await e.close(i);break}catch(s){if(this.log.error("error while attempting DCUtR on attempt %d of %d",n+1,this.retries,s),t==null||t.abort(s),n===this.retries)throw s}finally{t!=null&&await t.close(i)}}}async attemptUnilateralConnectionUpgrade(e){const n=(await this.peerStore.get(e.remotePeer)).addresses.map(i=>{const s=i.multiaddr;return s.getPeerId()==null?s.encapsulate(`/p2p/${e.remotePeer}`):s}).filter(i=>SB(i,this.transportManager));if(n.length>0){const i=AbortSignal.timeout(this.timeout);try{this.log("attempting unilateral connection upgrade to %a",n);const s=await this.connectionManager.openConnection(n,{signal:i,force:!0});if(Ec.exactMatch(s.remoteAddr))throw new Error("Could not open a new, non-limited, connection");return this.log("unilateral connection upgrade to %p succeeded via %a, closing relayed connection",e.remotePeer,s.remoteAddr),await e.close({signal:i}),!0}catch(s){this.log.error("unilateral connection upgrade to %p on addresses %a failed",e.remotePeer,n,s)}}else this.log("peer %p has no public addresses, not attempting unilateral connection upgrade",e.remotePeer);return!1}async handleIncomingUpgrade(e,t){const n={signal:AbortSignal.timeout(this.timeout)};try{const i=li(e,{maxDataLength:xB}).pb(Hs);this.log("A receiving connect");const s=await i.read(n);if(s.type!==Hs.Type.CONNECT)throw this.log("B sent wrong message type"),new St("DCUtR message type was incorrect");if(s.observedAddresses.length===0)throw this.log("B sent no multiaddrs"),new St("DCUtR connect message had no multiaddrs");const o=this.getDialableMultiaddrs(s.observedAddresses);if(o.length===0)throw this.log("B had no dialable multiaddrs"),new St("DCUtR connect message had no dialable multiaddrs");if(this.log("A sending connect"),await i.write({type:Hs.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(l=>l.bytes)}),this.log("A receiving sync"),(await i.read(n)).type!==Hs.Type.SYNC)throw new St("DCUtR message type was incorrect");this.log("A dialing",o);const c=await this.connectionManager.openConnection(o,{signal:n.signal,priority:AB,force:!0});this.log("DCUtR to %p succeeded via %a, closing relayed connection",t.remotePeer,c.remoteAddr),await t.close(n)}catch(i){this.log.error("incoming DCUtR from %p failed",t.remotePeer,i),e.abort(i)}finally{await e.close(n)}}getDialableMultiaddrs(e){const t=[];for(const n of e)if(!(n==null||n.length===0))try{const i=Re(n);if(!SB(i,this.transportManager))continue;t.push(i)}catch{}return t}}const E3="/libp2p/dcutr";function E3e(r={}){return e=>new v3e(e,r)}const S3=globalThis.CustomEvent??Event;async function*hp(r,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);const n=e.ordered??!1,i=new EventTarget,s=[];let o=Le(),a=Le(),c=!1,l,d=!1;i.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(const f of r){if(s.length===t&&(o=Le(),await o.promise),d)break;const g={done:!1};s.push(g),f().then(v=>{g.done=!0,g.ok=!0,g.value=v,i.dispatchEvent(new S3("task-complete"))},v=>{g.done=!0,g.err=v,i.dispatchEvent(new S3("task-complete"))})}c=!0,i.dispatchEvent(new S3("task-complete"))}catch(f){l=f,i.dispatchEvent(new S3("task-complete"))}});function h(){var f;return n?(f=s[0])==null?void 0:f.done:!!s.find(g=>g.done)}function*p(){for(;s.length>0&&s[0].done;){const f=s[0];if(s.shift(),f.ok)yield f.value;else throw d=!0,o.resolve(),f.err;o.resolve()}}function*b(){for(;h();)for(let f=0;f<s.length;f++)if(s[f].done){const g=s[f];if(s.splice(f,1),f--,g.ok)yield g.value;else throw d=!0,o.resolve(),g.err;o.resolve()}}for(;;){if(h()||(a=Le(),await a.promise),l!=null)throw l;if(n?yield*p():yield*b(),c&&s.length===0)break}}const S3e="0.1.0",x3e="id",A3e="id/push",C3e="1.0.0",I3e="1.0.0",k3e=1024*8,_3e=32;var oh;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.protocolVersion!=null&&(n.uint32(42),n.string(t.protocolVersion)),t.agentVersion!=null&&(n.uint32(50),n.string(t.agentVersion)),t.publicKey!=null&&(n.uint32(10),n.bytes(t.publicKey)),t.listenAddrs!=null)for(const s of t.listenAddrs)n.uint32(18),n.bytes(s);if(t.observedAddr!=null&&(n.uint32(34),n.bytes(t.observedAddr)),t.protocols!=null)for(const s of t.protocols)n.uint32(26),n.string(s);t.signedPeerRecord!=null&&(n.uint32(66),n.bytes(t.signedPeerRecord)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={listenAddrs:[],protocols:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 5:{s.protocolVersion=t.string();break}case 6:{s.agentVersion=t.string();break}case 1:{s.publicKey=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.listenAddrs)!=null&&s.listenAddrs.length===i.limits.listenAddrs)throw new mt('Decode error - map field "listenAddrs" had too many elements');s.listenAddrs.push(t.bytes());break}case 4:{s.observedAddr=t.bytes();break}case 3:{if(((c=i.limits)==null?void 0:c.protocols)!=null&&s.protocols.length===i.limits.protocols)throw new mt('Decode error - map field "protocols" had too many elements');s.protocols.push(t.string());break}case 8:{s.signedPeerRecord=t.bytes();break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(oh||(oh={}));const Pi={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:k3e,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnLimitedConnection:!0,concurrency:_3e};function T3e(r){if(r!=null&&r.length>0)try{return Re(r)}catch{}}function P3e(r,e){return e??r.userAgent}async function CB(r,e,t,n,i){if(t("received identify from %p",n.remotePeer),i==null)throw new St("message was null or undefined");const s={};if(i.listenAddrs.length>0&&(s.addresses=i.listenAddrs.map(c=>({isCertified:!1,multiaddr:Re(c)}))),i.protocols.length>0&&(s.protocols=i.protocols),i.publicKey!=null){const c=_n(i.publicKey);if(!zd(c).equals(n.remotePeer))throw new St("public key did not match remote PeerId");s.publicKey=c}let o;if(i.signedPeerRecord!=null){t.trace("received signedPeerRecord from %p",n.remotePeer);let c=i.signedPeerRecord;const l=await Dc.openAndCertify(c,js.DOMAIN);let d=js.createFromProtobuf(l.payload);const h=Vd(l.publicKey.toCID());if(!d.peerId.equals(h))throw new St("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(d.peerId))throw new St("signing key does not match remote PeerId");let p;try{p=await r.get(d.peerId)}catch(b){if(b.name!=="NotFoundError")throw b}if(p!=null&&(s.metadata=p.metadata,p.peerRecordEnvelope!=null)){const b=await Dc.createFromProtobuf(p.peerRecordEnvelope),f=js.createFromProtobuf(b.payload);f.seqNumber>=d.seqNumber&&(t("sequence number was lower or equal to existing sequence number - stored: %d received: %d",f.seqNumber,d.seqNumber),d=f,c=p.peerRecordEnvelope)}s.peerRecordEnvelope=c,s.addresses=d.multiaddrs.map(b=>({isCertified:!0,multiaddr:b})),o={seq:d.seqNumber,addresses:d.multiaddrs}}else t("%p did not send a signed peer record",n.remotePeer);if(t.trace("patching %p with",n.remotePeer,s),await r.patch(n.remotePeer,s),i.agentVersion!=null||i.protocolVersion!=null){const c={};i.agentVersion!=null&&(c.AgentVersion=oe(i.agentVersion)),i.protocolVersion!=null&&(c.ProtocolVersion=oe(i.protocolVersion)),t.trace("merging %p metadata",n.remotePeer,c),await r.merge(n.remotePeer,{metadata:c})}const a={peerId:n.remotePeer,protocolVersion:i.protocolVersion,agentVersion:i.agentVersion,publicKey:i.publicKey,listenAddrs:i.listenAddrs.map(c=>Re(c)),observedAddr:i.observedAddr==null?void 0:Re(i.observedAddr),protocols:i.protocols,signedPeerRecord:o,connection:n};return e.safeDispatchEvent("peer:identify",{detail:a}),a}class IB{constructor(e,t){u(this,"host");u(this,"protocol");u(this,"started");u(this,"timeout");u(this,"peerId");u(this,"privateKey");u(this,"peerStore");u(this,"registrar");u(this,"addressManager");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"maxMessageSize");u(this,"maxObservedAddresses");u(this,"events");u(this,"runOnLimitedConnection");u(this,"log");this.protocol=t.protocol,this.started=!1,this.peerId=e.peerId,this.privateKey=e.privateKey,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.events=e.events,this.log=t.log,this.timeout=t.timeout??Pi.timeout,this.maxInboundStreams=t.maxInboundStreams??Pi.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??Pi.maxOutboundStreams,this.maxMessageSize=t.maxMessageSize??Pi.maxMessageSize,this.maxObservedAddresses=t.maxObservedAddresses??Pi.maxObservedAddresses,this.runOnLimitedConnection=t.runOnLimitedConnection??Pi.runOnLimitedConnection,this.host={protocolVersion:`${t.protocolPrefix??Pi.protocolPrefix}/${S3e}`,agentVersion:P3e(e.nodeInfo,t.agentVersion)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:oe(this.host.agentVersion),ProtocolVersion:oe(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,e=>{this.handleProtocol(e).catch(t=>{this.log.error(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}}class D3e extends(aH=IB,oH=dr,aH){constructor(t,n={}){super(t,{...n,protocol:`/${n.protocolPrefix??Pi.protocolPrefix}/${A3e}/${I3e}`,log:t.logger.forComponent("libp2p:identify-push")});u(this,"connectionManager");u(this,"concurrency");u(this,oH,["@libp2p/identify-push"]);this.connectionManager=t.connectionManager,this.concurrency=n.concurrency??Pi.concurrency,(n.runOnSelfUpdate??Pi.runOnSelfUpdate)&&t.events.addEventListener("self:peer:update",i=>{this.push().catch(s=>{this.log.error(s)})})}async push(){if(!this.isStarted())return;const t=this.addressManager.getAddresses().map(h=>h.decapsulateCode(Ve("p2p").code)),n=new js({peerId:this.peerId,multiaddrs:t}),i=await Dc.seal(n,this.privateKey),s=this.registrar.getProtocols(),o=await this.peerStore.get(this.peerId),a=re(o.metadata.get("AgentVersion")??oe(this.host.agentVersion)),c=re(o.metadata.get("ProtocolVersion")??oe(this.host.protocolVersion)),l=this;async function*d(){for(const h of l.connectionManager.getConnections())(await l.peerStore.get(h.remotePeer)).protocols.includes(l.protocol)&&(yield async()=>{let b;const f=AbortSignal.timeout(l.timeout);try{b=await h.newStream(l.protocol,{signal:f,runOnLimitedConnection:l.runOnLimitedConnection}),await li(b,{maxDataLength:l.maxMessageSize}).pb(oh).write({listenAddrs:t.map(v=>v.bytes),signedPeerRecord:i.marshal(),protocols:s,agentVersion:a,protocolVersion:c},{signal:f}),await b.close({signal:f})}catch(g){l.log.error("could not push identify update to peer",g),b==null||b.abort(g)}})}await vo(hp(d(),{concurrency:this.concurrency}))}async handleProtocol(t){const{connection:n,stream:i}=t;try{if(this.peerId.equals(n.remotePeer))throw new Error("received push from ourselves?");const s={signal:AbortSignal.timeout(this.timeout)},a=await li(i,{maxDataLength:this.maxMessageSize}).pb(oh).read(s);await i.close(s),await CB(this.peerStore,this.events,this.log,n,a)}catch(s){this.log.error("received invalid message",s),i.abort(s);return}this.log.trace("handled push from %p",n.remotePeer)}}const $3e=41;class N3e extends(lH=IB,cH=dr,lH){constructor(t,n={}){super(t,{...n,protocol:`/${n.protocolPrefix??Pi.protocolPrefix}/${x3e}/${C3e}`,log:t.logger.forComponent("libp2p:identify")});u(this,cH,["@libp2p/identify"]);(n.runOnConnectionOpen??Pi.runOnConnectionOpen)&&t.events.addEventListener("connection:open",i=>{const s=i.detail;this.identify(s).catch(o=>{o.name!==g1.name&&this.log.error("error during identify trigged by connection:open",o)})})}async _identify(t,n={}){let i;if(n.signal==null){const s=AbortSignal.timeout(this.timeout);n={...n,signal:s}}try{i=await t.newStream(this.protocol,{...n,runOnLimitedConnection:this.runOnLimitedConnection});const o=await li(i,{maxDataLength:this.maxMessageSize}).pb(oh).read(n);return await i.close(n),o}catch(s){throw i==null||i.abort(s),s}}async identify(t,n={}){const i=await this._identify(t,n),{publicKey:s,protocols:o,observedAddr:a}=i;if(s==null)throw new St("public key was missing from identify message");const c=_n(s),l=Vd(c.toCID());if(!t.remotePeer.equals(l))throw new St("identified peer does not match the expected peer");if(this.peerId.equals(l))throw new St("identified peer is our own peer id?");return this.maybeAddObservedAddress(a),this.log("identify completed for peer %p and protocols %o",l,o),CB(this.peerStore,this.events,this.log,t,i)}maybeAddObservedAddress(t){const n=T3e(t);if(n==null)return;if(this.log.trace("our observed address was %a",n),Yl(n)){this.log.trace("our observed address was private");return}if(n.stringTuples()[0][0]===$3e&&!DL(n)){this.log.trace("our observed address was IPv6 but not a global unicast address");return}ym.exactMatch(n)||(this.log.trace("storing the observed address"),this.addressManager.addObservedAddr(n))}async handleProtocol(t){const{connection:n,stream:i}=t,s=AbortSignal.timeout(this.timeout);try{const o=await this.peerStore.get(this.peerId),a=this.addressManager.getAddresses().map(h=>h.decapsulateCode(Ve("p2p").code));let c=o.peerRecordEnvelope;if(a.length>0&&c==null){const h=new js({peerId:this.peerId,multiaddrs:a});c=(await Dc.seal(h,this.privateKey)).marshal().subarray()}let l=n.remoteAddr.bytes;mhe.matches(n.remoteAddr)||(l=void 0),await li(i).pb(oh).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:_i(this.privateKey.publicKey),listenAddrs:a.map(h=>h.bytes),signedPeerRecord:c,observedAddr:l,protocols:o.protocols},{signal:s}),await i.close({signal:s})}catch(o){this.log.error("could not respond to identify request",o),i.abort(o)}}}function x3(r={}){return e=>new N3e(e,r)}function M3e(r={}){return e=>new D3e(e,r)}const fp=1e3,nE=60*fp,A3=60*nE,O3e=36*A3,R3e="/ipfs/kad/1.0.0",L3e=48*A3,B3e=24*A3,U3e=10,F3e=16384,z3e=A3,kB=20,iE=3,V3e=5*nE,K3e=fp,j3e=5*fp,H3e=5*nE,q3e=30*fp,W3e=180*fp,_B=`${D2}-kad-dht`;var C3;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key.byteLength>0&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={key:Ge(0),value:Ge(0),timeReceived:""},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.key=t.bytes();break}case 2:{s.value=t.bytes();break}case 5:{s.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(C3||(C3={}));function G3e(r){const e=r.getUTCFullYear(),t=String(r.getUTCMonth()+1).padStart(2,"0"),n=String(r.getUTCDate()).padStart(2,"0"),i=String(r.getUTCHours()).padStart(2,"0"),s=String(r.getUTCMinutes()).padStart(2,"0"),o=String(r.getUTCSeconds()).padStart(2,"0"),a=r.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${n}T${i}:${s}:${o}.${c}Z`}function Q3e(r){const e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");const n=parseInt(t[1],10),i=parseInt(t[2],10)-1,s=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),l=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,i,s,o,a,c,l))}class Di{constructor(e,t,n){u(this,"key");u(this,"value");u(this,"timeReceived");if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return C3.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:G3e(this.timeReceived)}}static deserialize(e){const t=C3.decode(e);return new Di(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=Q3e(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new Di(e.key,e.value,t)}}class I3 extends Error{constructor(e="Query error"){super(e),this.name="QueryError"}}class J3e extends Error{constructor(e="Query aborted"){super(e),this.name="QueryAbortedError"}}class Y3e extends Error{constructor(e="Invalid record"){super(e),this.name="InvalidRecordError"}}class X3e extends Error{constructor(e="No selector function configured for prefix"){super(e),this.name="MissingSelectorError"}}var TB;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&(n.uint32(18),n.bytes(t.value)),t.author!=null&&(n.uint32(26),n.bytes(t.author)),t.signature!=null&&(n.uint32(34),n.bytes(t.signature)),t.timeReceived!=null&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.key=t.bytes();break}case 2:{s.value=t.bytes();break}case 3:{s.author=t.bytes();break}case 4:{s.signature=t.bytes();break}case 5:{s.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(TB||(TB={}));var It;(function(r){r.PUT_VALUE="PUT_VALUE",r.GET_VALUE="GET_VALUE",r.ADD_PROVIDER="ADD_PROVIDER",r.GET_PROVIDERS="GET_PROVIDERS",r.FIND_NODE="FIND_NODE",r.PING="PING"})(It||(It={}));var k3;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(k3||(k3={})),function(r){r.codec=()=>kn(k3)}(It||(It={}));var ah;(function(r){r.NOT_CONNECTED="NOT_CONNECTED",r.CONNECTED="CONNECTED",r.CAN_CONNECT="CAN_CONNECT",r.CANNOT_CONNECT="CANNOT_CONNECT"})(ah||(ah={}));var sE;(function(r){r[r.NOT_CONNECTED=0]="NOT_CONNECTED",r[r.CONNECTED=1]="CONNECTED",r[r.CAN_CONNECT=2]="CAN_CONNECT",r[r.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(sE||(sE={})),function(r){r.codec=()=>kn(sE)}(ah||(ah={}));var ch;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.multiaddrs!=null)for(const s of t.multiaddrs)n.uint32(18),n.bytes(s);t.connection!=null&&(n.uint32(24),ah.codec().encode(t.connection,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={id:Ge(0),multiaddrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.id=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.multiaddrs)!=null&&s.multiaddrs.length===i.limits.multiaddrs)throw new mt('Decode error - map field "multiaddrs" had too many elements');s.multiaddrs.push(t.bytes());break}case 3:{s.connection=ah.codec().decode(t);break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(ch||(ch={}));var tu;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.type!=null&&k3[t.type]!==0&&(n.uint32(8),It.codec().encode(t.type,n)),t.clusterLevel!=null&&(n.uint32(80),n.int32(t.clusterLevel)),t.key!=null&&(n.uint32(18),n.bytes(t.key)),t.record!=null&&(n.uint32(26),n.bytes(t.record)),t.closer!=null)for(const s of t.closer)n.uint32(66),ch.codec().encode(s,n);if(t.providers!=null)for(const s of t.providers)n.uint32(74),ch.codec().encode(s,n);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,d;const s={type:It.PUT_VALUE,closer:[],providers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const h=t.uint32();switch(h>>>3){case 1:{s.type=It.codec().decode(t);break}case 10:{s.clusterLevel=t.int32();break}case 2:{s.key=t.bytes();break}case 3:{s.record=t.bytes();break}case 8:{if(((a=i.limits)==null?void 0:a.closer)!=null&&s.closer.length===i.limits.closer)throw new mt('Decode error - map field "closer" had too many elements');s.closer.push(ch.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.closer$}));break}case 9:{if(((l=i.limits)==null?void 0:l.providers)!=null&&s.providers.length===i.limits.providers)throw new mt('Decode error - map field "providers" had too many elements');s.providers.push(ch.codec().decode(t,t.uint32(),{limits:(d=i.limits)==null?void 0:d.providers$}));break}default:{t.skipType(h&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(tu||(tu={}));function PB(r,e={}){var n;const t={...r,name:"SEND_QUERY",type:0,messageName:r.type,messageType:r.type};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:send-query",{detail:t})),t}function oE(r,e={}){var n;const t={...r,name:"PEER_RESPONSE",type:1,messageName:r.messageType,closer:r.closer??[],providers:r.providers??[]};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:peer-response",{detail:t})),t}function aE(r,e={}){var n;const t={...r,name:"FINAL_PEER",type:2};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:final-peer",{detail:t})),t}function $c(r,e={}){var n;const t={...r,name:"QUERY_ERROR",type:3};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:query-error",{detail:t})),t}function DB(r,e={}){var n;const t={...r,name:"PROVIDER",type:4};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:provider",{detail:t})),t}function cE(r,e={}){var n;const t={...r,name:"VALUE",type:5};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:value",{detail:t})),t}function $B(r,e={}){var n;const t={...r,name:"DIAL_PEER",type:7};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:dial-peer",{detail:t})),t}function Z3e(r,e,t){if(t.length===0)throw new Z("No records given");const i=re(e).split("/");if(i.length<3)throw new Z("Record key does not have a selector function");const s=r[i[1].toString()];if(s==null)throw new X3e(`No selector function configured for key type "${i[1]}"`);return t.length===1?0:s(e,t)}function ewe(r,e){return 0}const twe={pk:ewe};async function lE(r,e){const t=e.key,i=re(t).split("/");if(i.length<3)return;const s=r[i[1].toString()];if(s==null)throw new Z(`No validator available for key type "${i[1]}"`);await s(t,e.value)}const rwe={pk:async(r,e)=>{if(!(r instanceof Uint8Array))throw new Z('"key" must be a Uint8Array');if(r.byteLength<5)throw new Z("Invalid public key record");if(re(r.subarray(0,4))!=="/pk/")throw new Z("key was not prefixed with /pk/");const n=_n(e),i=r.slice(4);if(!We(i,n.toMultihash().bytes))throw new Z("public key does not match passed in key")}};function nwe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function uE(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function iwe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var swe=iwe,owe=swe;let awe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},cwe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return NB(this,e)}},lwe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return NB(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function NB(r,e){return new lwe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let uwe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new awe(e,t,n),this.decoder=new cwe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function MB({name:r,prefix:e,encode:t,decode:n}){return new uwe(r,e,t,n)}function _3({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=owe(t,r);return MB({prefix:e,name:r,encode:n,decode:s=>uE(i(s))})}function dwe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function hwe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Ho({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return MB({prefix:e,name:r,encode(i){return hwe(i,n,t)},decode(i){return dwe(i,n,t,r)}})}const T3=Ho({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Ho({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ho({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ho({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ho({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ho({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ho({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ho({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Ho({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const dE=_3({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});_3({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Nc=_3({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});_3({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var fwe=RB,OB=128,pwe=-128,gwe=Math.pow(2,31);function RB(r,e,t){e=e||[],t=t||0;for(var n=t;r>=gwe;)e[t++]=r&255|OB,r/=128;for(;r&pwe;)e[t++]=r&255|OB,r>>>=7;return e[t]=r|0,RB.bytes=t-n+1,e}var ywe=hE,mwe=128,LB=127;function hE(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw hE.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&LB)<<i:(o&LB)*Math.pow(2,i),i+=7}while(o>=mwe);return hE.bytes=s-n,t}var wwe=Math.pow(2,7),bwe=Math.pow(2,14),vwe=Math.pow(2,21),Ewe=Math.pow(2,28),Swe=Math.pow(2,35),xwe=Math.pow(2,42),Awe=Math.pow(2,49),Cwe=Math.pow(2,56),Iwe=Math.pow(2,63),kwe=function(r){return r<wwe?1:r<bwe?2:r<vwe?3:r<Ewe?4:r<Swe?5:r<xwe?6:r<Awe?7:r<Cwe?8:r<Iwe?9:10},_we={encode:fwe,decode:ywe,encodingLength:kwe},P3=_we;function fE(r,e=0){return[P3.decode(r,e),P3.decode.bytes]}function D3(r,e,t=0){return P3.encode(r,e,t),e}function $3(r){return P3.encodingLength(r)}function pE(r,e){const t=e.byteLength,n=$3(r),i=n+$3(t),s=new Uint8Array(i+t);return D3(r,s,0),D3(t,s,n),s.set(e,i),new gE(r,t,e,s)}function ru(r){const e=uE(r),[t,n]=fE(e),[i,s]=fE(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new gE(t,i,o,e)}function Twe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&nwe(r.bytes,t.bytes)}}let gE=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function BB(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Dwe(t,yE(r),e??Nc.encoder);default:return $we(t,yE(r),e??T3.encoder)}}const UB=new WeakMap;function yE(r){const e=UB.get(r);if(e==null){const t=new Map;return UB.set(r,t),t}return e}let mE=class nn{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,uH,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==pp)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Nwe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return nn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=pE(e,t);return nn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return nn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Twe(e.multihash,n.multihash)}toString(e){return BB(this,e)}toJSON(){return{"/":BB(this)}}link(){return this}[(uH=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof nn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new nn(n,i,s,o??FB(n,i,s.bytes))}else if(t[Mwe]===!0){const{version:n,multihash:i,code:s}=t,o=ru(i);return nn.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==pp)throw new Error(`Version 0 CID must use dag-pb (code: ${pp}) block encoding`);return new nn(e,t,n,n.bytes)}case 1:{const i=FB(e,t,n.bytes);return new nn(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return nn.create(0,pp,e)}static createV1(e,t){return nn.create(1,e,t)}static decode(e){const[t,n]=nn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=nn.inspectBytes(e),n=t.size-t.multihashSize,i=uE(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new gE(t.multihashCode,t.digestSize,s,i);return[t.version===0?nn.createV0(o):nn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=fE(e.subarray(t));return t+=p,h};let i=n(),s=pp;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Pwe(e,t),s=nn.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return yE(s).set(n,e),s}};function Pwe(r,e){switch(r[0]){case"Q":{const t=e??Nc;return[Nc.prefix,t.decode(`${Nc.prefix}${r}`)]}case Nc.prefix:{const t=e??Nc;return[Nc.prefix,t.decode(r)]}case T3.prefix:{const t=e??T3;return[T3.prefix,t.decode(r)]}case dE.prefix:{const t=e??dE;return[dE.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Dwe(r,e,t){const{prefix:n}=t;if(n!==Nc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function $we(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const pp=112,Nwe=18;function FB(r,e,t){const n=$3(r),i=n+$3(e),s=new Uint8Array(i+t.byteLength);return D3(r,s,0),D3(e,s,n),s.set(t,i),s}const Mwe=Symbol.for("@ipld/js-cid/CID"),Owe=85;function Rwe({name:r,code:e,encode:t}){return new Lwe(r,e,t)}let Lwe=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?pE(this.code,t):t.then(n=>pE(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Bwe(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const zB=Rwe({name:"sha2-256",code:18,encode:Bwe("SHA-256")}),Uwe=oe("/pk/");function Fwe(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{const[[t,n]]=e.stringTuples();if(t===53||t===54||t===55)return n!=="localhost";if(t!==4&&t!==6||n==null)return!1;const i=vc(n);return i==null?!0:!i})}}async function gp(r){return(await zB.digest(r)).digest}async function ls(r){return gp(r.toMultihash().bytes)}function yp(r,e){return new At(`${r}/${re(e,"base32")}`,!1)}function zwe(r){return or([Uwe,r.toMultihash().bytes])}function Vwe(r){return re(r.subarray(0,4))==="/pk/"}function Kwe(r){const e=ru(r.subarray(4));return ti(e)}function VB(r,e){const t=new Date;return new Di(r,e,t).serialize()}const jwe=290,Hwe=54,qwe=55,Wwe=56,Gwe=4,Qwe=41;function Jwe(r){const e=r.stringTuples();for(const t of e)if(t[0]===jwe)return!1;if(e[0][0]===Hwe||e[0][0]===qwe||e[0][0]===Wwe)return!0;if(e[0][0]===Gwe||e[0][0]===Qwe){const t=vc(`${e[0][1]}`);return t==null||!t}return!1}function KB(r){const e=r.toString().split("/"),t=e.pop(),n=e.pop();if(t==null||n==null)throw new Error(`incorrectly formatted provider entry key in datastore: ${r.toString()}`);return{cid:mE.createV1(Owe,ru(oe(n,"base32"))),peerId:tr(t)}}function wE(r,e,t){const n=typeof e=="string"?e:re(e.multihash.bytes,"base32"),i=[r,n];return t!=null&&i.push(t.toString()),new At(i.join("/"))}function jB(r){return new Date(es(r))}function lh(r,e,t){return async function*(...n){var a,c,l,d,h;const i=(a=e.queryTime)==null?void 0:a.timer(t),s=(c=e.errorTime)==null?void 0:c.timer(t);let o=!1;try{(l=e.queries)==null||l.increment({[t]:!0}),yield*r(...n)}catch(p){throw o=!0,s==null||s(),(d=e.errors)==null||d.increment({[t]:!0}),p}finally{(h=e.queries)==null||h.decrement({[t]:!0}),o||i==null||i()}}}function HB(r,e,t){return async function(...n){var a,c,l,d,h;const i=(a=e==null?void 0:e.queryTime)==null?void 0:a.timer(t),s=(c=e==null?void 0:e.errorTime)==null?void 0:c.timer(t);let o=!1;try{return(l=e.queries)==null||l.increment({[t]:!0}),await r(...n)}catch(p){throw o=!0,s==null||s(),(d=e.errors)==null||d.increment({[t]:!0}),p}finally{(h=e.queries)==null||h.decrement({[t]:!0}),o||i==null||i()}}}class Ywe{constructor(e,t){u(this,"log");u(this,"components");u(this,"validators");u(this,"selectors");u(this,"peerRouting");u(this,"queryManager");u(this,"network");u(this,"datastorePrefix");var l,d;const{validators:n,selectors:i,peerRouting:s,queryManager:o,network:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-fetching`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n,this.selectors=i,this.peerRouting=s,this.queryManager=o,this.network=a,this.get=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.get",this.get.bind(this),{optionsIndex:1}))??this.get,this.put=((d=e.metrics)==null?void 0:d.traceFunction("libp2p.kadDHT.put",this.put.bind(this),{optionsIndex:2}))??this.put}async getLocal(e){this.log("getLocal %b",e);const t=yp(this.datastorePrefix,e);this.log("fetching record for key %k",t);const n=await this.components.datastore.get(t);this.log("found %k in local datastore",t);const i=Di.deserialize(n);return await lE(this.validators,i),i}async*sendCorrectionRecord(e,t,n,i={}){this.log("sendCorrection for %b",e);const s=VB(e,n);for(const{value:o,from:a}of t){if(We(o,n)){this.log("record was ok");continue}if(this.components.peerId.equals(a)){try{const d=yp(this.datastorePrefix,e);this.log(`Storing corrected record for key ${d.toString()}`),await this.components.datastore.put(d,s.subarray())}catch(d){this.log.error("Failed error correcting self",d)}continue}let c=!1;const l={type:It.PUT_VALUE,key:e,record:s};for await(const d of this.network.sendRequest(a,l,i))d.name==="PEER_RESPONSE"&&d.record!=null&&We(d.record.value,Di.deserialize(s).value)&&(c=!0),yield d;c||(yield $c({from:a,error:new I3("Value not put correctly")},i)),this.log.error("Failed error correcting entry")}}async*put(e,t,n={}){this.log("put key %b value %b",e,t);const i=VB(e,t),s=yp(this.datastorePrefix,e);this.log(`storing record for key ${s.toString()}`),await this.components.datastore.put(s,i.subarray()),yield*un(this.peerRouting.getClosestPeers(e,{...n,signal:n.signal}),o=>Fd(o,a=>async()=>{if(a.name!=="FINAL_PEER")return[a];const c=[],l={type:It.PUT_VALUE,key:e,record:i};this.log("send put to %p",a.peer.id);for await(const d of this.network.sendRequest(a.peer.id,l,n))c.push(d),d.name==="PEER_RESPONSE"&&(d.record!=null&&We(d.record.value,Di.deserialize(i).value)||c.push($c({from:a.peer.id,error:new I3("Value not put correctly")},n)));return c}),o=>hp(o,{ordered:!1,concurrency:iE}),async function*(o){for await(const a of o)yield*a})}async*get(e,t={}){this.log("get %b",e);const n=[];for await(const a of this.getMany(e,t))a.name==="VALUE"&&n.push(a),yield a;if(n.length===0)return;const i=n.map(a=>a.value);let s=0;try{s=Z3e(this.selectors,e,i)}catch(a){if(a.name!=="InvalidParametersError")throw a}const o=i[s];if(this.log("GetValue %b %b",e,o),o==null)throw new Zt("Best value was not found");yield*this.sendCorrectionRecord(e,n,o,t),yield n[s]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{const s=await this.getLocal(e);yield cE({value:s.value,from:this.components.peerId},t)}catch(s){this.log("error getting local value for %b",e,s)}const n=this,i=async function*({peer:s,signal:o}){for await(const a of n.peerRouting.getValueOrPeers(s,e,{...t,signal:o}))yield a,a.name==="PEER_RESPONSE"&&a.record!=null&&(yield cE({from:s,value:a.record.value},t))};yield*this.queryManager.run(e,i,t)}}function Xwe(r,e){return{id:r.id.toMultihash().bytes,multiaddrs:(r.multiaddrs??[]).map(n=>n.bytes),connection:e}}function N3(r){if(r.id==null)throw new Error("Invalid peer in message");const e=ru(r.id);return{id:ti(e),multiaddrs:(r.multiaddrs??[]).map(t=>Re(t))}}class Zwe{constructor(e,t){u(this,"log");u(this,"components");u(this,"network");u(this,"peerRouting");u(this,"queryManager");u(this,"routingTable");u(this,"providers");var l,d;const{network:n,peerRouting:i,queryManager:s,routingTable:o,providers:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-routing`),this.network=n,this.peerRouting=i,this.queryManager=s,this.routingTable=o,this.providers=a,this.findProviders=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(h,p)=>(h.name==="PROVIDER"&&(p.providers??(p.providers=[]),p.providers.push(...h.providers.map(b=>b.id.toString()))),p)}))??this.findProviders,this.provide=((d=e.metrics)==null?void 0:d.traceFunction("libp2p.kadDHT.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(h,p)=>(h.name==="PEER_RESPONSE"&&h.messageName==="ADD_PROVIDER"&&(p.providers??(p.providers=[]),p.providers.push(h.from.toString())),p)}))??this.provide}async*provide(e,t,n={}){this.log("provide %s",e);const i=e.multihash.bytes;await this.providers.addProvider(e,this.components.peerId);const s={type:It.ADD_PROVIDER,key:i,providers:[Xwe({id:this.components.peerId,multiaddrs:t})]};let o=0;const a=c=>async()=>{if(c.name!=="FINAL_PEER")return[c];const l=[];this.log("putProvider %s to %p",e,c.peer.id);try{this.log("sending provider record for %s to %p",e,c.peer.id);for await(const d of this.network.sendMessage(c.peer.id,s,n))d.name==="PEER_RESPONSE"&&(this.log("sent provider record for %s to %p",e,c.peer.id),o++),l.push(d)}catch(d){this.log.error("error sending provide record to peer %p",c.peer.id,d),l.push($c({from:c.peer.id,error:d},n))}return l};yield*un(this.peerRouting.getClosestPeers(i,n),c=>Fd(c,l=>a(l)),c=>hp(c,{ordered:!1,concurrency:iE}),async function*(c){for await(const l of c)yield*l}),this.log("sent provider records to %d peers",o)}async*findProviders(e,t){const n=this.routingTable.kBucketSize;let i=0;const s=e.multihash.bytes,o=this;this.log("findProviders %c",e);const a=await this.providers.getProviders(e);if(a.length>0){const d=[];for(const h of a.slice(0,n))try{const p=await this.components.peerStore.get(h);d.push({id:h,multiaddrs:p.addresses.map(({multiaddr:b})=>b)})}catch(p){if(p.name!=="NotFoundError")throw p;this.log("no peer store entry for %p",h)}if(yield oE({from:this.components.peerId,messageType:It.GET_PROVIDERS,providers:d},t),yield DB({from:this.components.peerId,providers:d},t),i+=d.length,i>=n)return}const c=async function*({peer:d,signal:h}){const p={type:It.GET_PROVIDERS,key:s};yield*o.network.sendRequest(d,p,{...t,signal:h})},l=new rs(a);for await(const d of this.queryManager.run(s,c,t))if(yield d,d.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",d.providers.length,e,d.closer.length);const h=[];for(const p of d.providers)l.has(p.id)||(l.add(p.id),h.push(p));if(h.length>0&&(yield DB({from:d.from,providers:h},t),i+=h.length,i>=n))return}}}class bE{constructor(e){u(this,"movingAverage");u(this,"variance");u(this,"deviation");u(this,"forecast");u(this,"timeSpan");u(this,"previousTime");this.timeSpan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timeSpan)}push(e,t=Date.now()){if(this.previousTime!=null){const n=this.alpha(t,this.previousTime),i=e-this.movingAverage,s=n*i;this.movingAverage=n*e+(1-n)*this.movingAverage,this.variance=(1-n)*(this.variance+i*s),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+n*i}else this.movingAverage=e;this.previousTime=t}}const e4e=1.2,t4e=2,r4e=2e3;class mp{constructor(e={}){u(this,"success");u(this,"failure");u(this,"next");u(this,"metric");u(this,"timeoutMultiplier");u(this,"failureMultiplier");u(this,"minTimeout");var t;this.success=new bE(e.interval??5e3),this.failure=new bE(e.interval??5e3),this.next=new bE(e.interval??5e3),this.failureMultiplier=e.failureMultiplier??t4e,this.timeoutMultiplier=e.timeoutMultiplier??e4e,this.minTimeout=e.minTimeout??r4e,e.metricName!=null&&(this.metric=(t=e.metrics)==null?void 0:t.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){const t=Math.max(Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier)),this.minTimeout),n=AbortSignal.timeout(t),i=pt([e.signal,n]);return i.start=Date.now(),i.timeout=t,i}cleanUp(e){var n,i;const t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),(n=this.metric)==null||n.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),(i=this.metric)==null||i.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}}class n4e{constructor(){u(this,"readNext");u(this,"haveNext");u(this,"ended");u(this,"nextResult");this.ended=!1,this.readNext=Le(),this.haveNext=Le()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Le(),e}async throw(e){return this.ended=!0,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Le(),await ln(this.readNext.promise,t==null?void 0:t.signal,t)}}function i4e(){return new n4e}let s4e=class extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}};class o4e extends Error{constructor(t,n){super(t);u(this,"code");this.code=n}}let a4e=class extends o4e{constructor(t){super(t,"ABORT_ERR");u(this,"type");this.type="aborted",this.name="AbortError"}};function c4e(r,e){const t=i4e();r.sink(t).catch(async o=>{await t.end(o)}),r.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());const i=new Ue;return{read:async(o,a)=>{var d,h;(d=a==null?void 0:a.signal)==null||d.throwIfAborted();let c;const l=new Promise((p,b)=>{var f;c=()=>{b(new a4e("Read aborted"))},(f=a==null?void 0:a.signal)==null||f.addEventListener("abort",c)});try{if(o==null){const{done:b,value:f}=await Promise.race([n.next(),l]);return b===!0?new Ue:f}for(;i.byteLength<o;){const{value:b,done:f}=await Promise.race([n.next(),l]);if(f===!0)throw new s4e("unexpected end of input");i.append(b)}const p=i.sublist(0,o);return i.consume(o),p}finally{c!=null&&((h=a==null?void 0:a.signal)==null||h.removeEventListener("abort",c))}},write:async(o,a)=>{var c;(c=a==null?void 0:a.signal)==null||c.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(i.byteLength>0){const o=r.source;r.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield i:yield*i,yield*o}()}return r}}}let l4e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}},u4e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}},d4e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}};function h4e(r,e={}){const t=c4e(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=yt(e.maxDataLength));const n=(e==null?void 0:e.lengthDecoder)??es,i=(e==null?void 0:e.lengthEncoder)??Sr;return{read:async o=>{let a=-1;const c=new Ue;for(;;){c.append(await t.read(1,o));try{a=n(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new l4e("Invalid message length");if((e==null?void 0:e.maxLengthLength)!=null&&c.byteLength>e.maxLengthLength)throw new d4e("message length length too long");if(a>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&a>e.maxDataLength)throw new u4e("message length too long");return t.read(a,o)},write:async(o,a)=>{await t.write(new Ue(i(o.byteLength),o),a)},writeV:async(o,a)=>{const c=new Ue(...o.flatMap(l=>[i(l.byteLength),l]));await t.write(c,a)},unwrap:()=>t.unwrap()}}function qB(r,e){const t=h4e(r,e),n={read:async(i,s)=>{const o=await t.read(s);return i.decode(o)},write:async(i,s,o)=>{await t.write(s.encode(i),o)},writeV:async(i,s,o)=>{await t.writeV(i.map(a=>s.encode(a)),o)},pb:i=>({read:async s=>n.read(i,s),write:async(s,o)=>n.write(s,i,o),writeV:async(s,o)=>n.writeV(s,i,o),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}class f4e extends er{constructor(t,n){var i,s,o,a;super();u(this,"log");u(this,"protocol");u(this,"running");u(this,"components");u(this,"timeout");u(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${n.logPrefix}:network`),this.running=!1,this.protocol=n.protocol,this.timeout=new mp({...n.timeout??{},metrics:t.metrics,metricName:`${n.metricsPrefix}_network_message_send_times_milliseconds`}),this.metrics={operations:(i=t.metrics)==null?void 0:i.registerCounterGroup(`${n.metricsPrefix}_outbound_rpc_requests_total`),errors:(s=t.metrics)==null?void 0:s.registerCounterGroup(`${n.metricsPrefix}_outbound_rpc_errors_total`)},this.sendRequest=((o=t.metrics)==null?void 0:o.traceFunction("libp2p.kadDHT.sendRequest",this.sendRequest.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],d){return{...d,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((d,h)=>{l[`providers-${h}`]=d.id.toString()}),c.closer.length>0&&c.closer.forEach((d,h)=>{l[`closer-${h}`]=d.id.toString()})),l)}))??this.sendRequest,this.sendMessage=((a=t.metrics)==null?void 0:a.traceFunction("libp2p.kadDHT.sendMessage",this.sendMessage.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],d){return{...d,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((d,h)=>{l[`providers-${h}`]=d.id.toString()}),c.closer.length>0&&c.closer.forEach((d,h)=>{l[`closer-${h}`]=d.id.toString()})),l)}))??this.sendMessage}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(t,n,i={}){var c,l,d;if(!this.running)return;const s=n.type;if(s==null)throw new Z("Message type was missing");this.log("sending %s to %p",n.type,t),yield $B({peer:t},i),yield PB({to:t,type:s},i);let o;const a=this.timeout.getTimeoutSignal(i);i={...i,signal:a};try{(c=this.metrics.operations)==null||c.increment({[s]:!0}),o=await(await this.components.connectionManager.openConnection(t,i)).newStream(this.protocol,i);const p=await this._writeReadMessage(o,n,i);o.close(i).catch(b=>{this.log.error("error closing stream to %p",t,b),o==null||o.abort(b)}),yield oE({from:t,messageType:p.type,closer:p.closer.map(N3),providers:p.providers.map(N3),record:p.record==null?void 0:Di.deserialize(p.record)},i)}catch(h){(l=this.metrics.errors)==null||l.increment({[s]:!0}),o==null||o.abort(h),((d=i.signal)==null?void 0:d.aborted)!==!0&&this.log.error("could not send %s to %p - %e",n.type,t,h),yield $c({from:t,error:h},i)}finally{this.timeout.cleanUp(a)}}async*sendMessage(t,n,i={}){var c,l;if(!this.running)return;const s=n.type;if(s==null)throw new Z("Message type was missing");this.log("sending %s to %p",n.type,t),yield $B({peer:t},i),yield PB({to:t,type:s},i);let o;const a=this.timeout.getTimeoutSignal(i);i={...i,signal:a};try{(c=this.metrics.operations)==null||c.increment({[s]:!0}),o=await(await this.components.connectionManager.openConnection(t,i)).newStream(this.protocol,i),await this._writeMessage(o,n,i),o.close(i).catch(h=>{this.log.error("error closing stream to %p",t,h),o==null||o.abort(h)}),yield oE({from:t,messageType:s},i)}catch(d){(l=this.metrics.errors)==null||l.increment({[s]:!0}),o==null||o.abort(d),yield $c({from:t,error:d},i)}finally{this.timeout.cleanUp(a)}}async _writeMessage(t,n,i){await qB(t).write(n,tu,i)}async _writeReadMessage(t,n,i){const s=qB(t);await s.write(n,tu,i);const o=await s.read(tu,i);return o.closer.forEach(a=>{this.safeDispatchEvent("peer",{detail:N3(a)})}),o.providers.forEach(a=>{this.safeDispatchEvent("peer",{detail:N3(a)})}),o}}function wp(r,e){if(r.byteLength!==e.byteLength)throw new Error("Inputs should have the same length");for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}class vE{constructor(e,t){u(this,"originDhtKey");u(this,"capacity");u(this,"peerDistances");this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peer)}async add(e){const t=await ls(e.id);this.addWithKadId(e,t)}addWithKadId(e,t){if(this.peerDistances.find(s=>s.peer.id.equals(e.id))!=null)return;const n={peer:e,distance:Tc(this.originDhtKey,t)};let i=!1;for(let s=0;s<this.peerDistances.length;s++){const o=wp(this.peerDistances[s].distance,n.distance);if(o===0||o===1){i=!0,this.peerDistances.splice(s,0,n);break}}i||this.peerDistances.push(n),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async isCloser(e){if(this.length===0)return!0;const t=await ls(e),n=Tc(t,this.originDhtKey),i=this.peerDistances[this.peerDistances.length-1].distance;return wp(n,i)===-1}async anyCloser(e){return e.length===0?!1:Promise.any(e.map(async t=>this.isCloser(t)))}}class p4e{constructor(e,t){u(this,"log");u(this,"routingTable");u(this,"network");u(this,"validators");u(this,"queryManager");u(this,"peerStore");u(this,"peerId");var n,i;this.routingTable=t.routingTable,this.network=t.network,this.validators=t.validators,this.queryManager=t.queryManager,this.peerStore=e.peerStore,this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:peer-routing`),this.findPeer=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.kadDHT.findPeer",this.findPeer.bind(this),{optionsIndex:1}))??this.findPeer,this.getClosestPeers=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.kadDHT.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1}))??this.getClosestPeers}async findPeerLocal(e){let t;const n=await this.routingTable.find(e);if(n!=null){this.log("findPeerLocal found %p in routing table",e);try{t=await this.peerStore.get(n)}catch(i){if(i.name!=="NotFoundError")throw i}}if(t==null)try{t=await this.peerStore.get(e)}catch(i){if(i.name!=="NotFoundError")throw i}if(t!=null)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(i=>i.multiaddr)}}async*_getValueSingle(e,t,n={}){const i={type:It.GET_VALUE,key:t};yield*this.network.sendRequest(e,i,n)}async*getPublicKeyFromNode(e,t={}){const n=zwe(e);for await(const i of this._getValueSingle(e,n,t))if(yield i,i.name==="PEER_RESPONSE"&&i.record!=null){const s=_n(i.record.value),o=zd(s);if(!o.equals(e))throw new p1("public key does not match id");if(o.publicKey==null)throw new p1("public key missing");yield cE({from:e,value:i.record.value},t)}throw new I3(`Node not responding with its public key: ${e.toString()}`)}async*findPeer(e,t={}){if(this.log("findPeer %p",e),t.useCache!==!1){const i=await this.findPeerLocal(e);if(i!=null){this.log("found local"),yield aE({from:this.peerId,peer:i},t);return}}let n=!1;if(t.useNetwork!==!1){const i=this,s=async function*({peer:o,signal:a}){const c={type:It.FIND_NODE,key:e.toMultihash().bytes};for await(const l of i.network.sendRequest(o,c,{...t,signal:a}))if(yield l,l.name==="PEER_RESPONSE"){const d=l.closer.find(h=>h.id.equals(e));d!=null&&(yield aE({from:l.from,peer:d},t))}};for await(const o of this.queryManager.run(e.toMultihash().bytes,s,t))o.name==="FINAL_PEER"&&(n=!0),yield o}n||(yield $c({from:this.peerId,error:new Zt("Not found")},t))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);const n=await gp(e),i=this.routingTable.closestPeers(n),s=this,o=new vE(n,this.routingTable.kBucketSize);await Promise.all(i.map(async c=>{await o.add({id:c,multiaddrs:[]})}));const a=async function*({peer:c,signal:l}){s.log("closerPeersSingle %s from %p",re(e,"base32"),c);const d={type:It.FIND_NODE,key:e};yield*s.network.sendRequest(c,d,{...t,signal:l})};for await(const c of this.queryManager.run(e,a,t))c.name==="PEER_RESPONSE"&&await Promise.all(c.closer.map(async l=>{await o.add(l)})),yield c;this.log("found %d peers close to %b",o.length,e);for(const c of o.peers)yield aE({from:this.peerId,peer:c},t)}async*getValueOrPeers(e,t,n={}){for await(const i of this._getValueSingle(e,t,n)){if(i.name==="PEER_RESPONSE"&&i.record!=null)try{await this._verifyRecordOnline(i.record)}catch{const o="invalid record received, discarded";this.log(o),yield $c({from:i.from,error:new I3(o)},n);continue}yield i}}async _verifyRecordOnline(e){if(e.timeReceived==null)throw new Y3e("invalid record received");await lE(this.validators,new Di(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){const n=[];try{const c=ru(e),l=ti(c),d=await this.peerStore.get(l);n.push({id:d.id,multiaddrs:d.addresses.map(({multiaddr:h})=>h)})}catch{}const i=await gp(e),s=this.routingTable.closestPeers(i),o=await ls(t),a=Tc(o,i);for(const c of s){const l=await ls(c),d=Tc(l,i);if(wp(d,a)===-1)try{const h=await this.peerStore.get(c);n.push({id:c,multiaddrs:h.addresses.map(({multiaddr:p})=>p)})}catch(h){if(h.name!=="NotFoundError")throw h}}return n.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",n.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p with %d peers in the routing table",e,t,this.routingTable.size),n}}class g4e{constructor(e,t){u(this,"log");u(this,"datastore");u(this,"datastorePrefix");u(this,"lock");this.log=e.logger.forComponent(`${t.logPrefix}:providers`),this.datastorePrefix=`${t.datastorePrefix}/provider`,this.datastore=e.datastore,this.lock=t.lock}async addProvider(e,t){const n=await this.lock.readLock();try{this.log("%p provides %s",t,e),await this.writeProviderEntry(e,t)}finally{n()}}async removeProvider(e,t){const n=await this.lock.writeLock();try{const i=wE(this.datastorePrefix,e,t);this.log("%p no longer provides %s",t,e),await this.datastore.delete(i)}finally{n()}}async getProviders(e){const t=await this.lock.readLock();try{this.log("get providers for %c",e);const n=await this.loadProviders(e);return this.log("got %d providers for %c",n.size,e),[...n.keys()]}finally{t()}}async writeProviderEntry(e,t,n=new Date){const i=wE(this.datastorePrefix,e,t),s=Sr(n.getTime());await this.datastore.put(i,s)}async loadProviders(e){const t=new dc,n=wE(this.datastorePrefix,e);for await(const i of this.datastore.query({prefix:n.toString()})){const{peerId:s}=KB(i.key);t.set(s,jB(i.value))}return t}}async function*y4e(r){const{key:e,startingPeer:t,ourPeerId:n,signal:i,query:s,alpha:o,pathIndex:a,numPaths:c,queryFuncTimeout:l,log:d,peersSeen:h,connectionManager:p}=r,b=new Ul({concurrency:o,sort:(v,y)=>wp(v.options.distance,y.options.distance)}),f=await gp(e);function g(v,y){if(v==null)return;h.add(v);const w=Tc(y,f);b.add(async()=>{const m=[i];l!=null&&m.push(AbortSignal.timeout(l));const E=pt(m);try{for await(const A of s({...r,key:e,peer:v,signal:E,pathIndex:a,numPaths:c})){if(E.aborted)return;if(A.name==="PEER_RESPONSE")for(const k of A.closer){if(h.has(k.id)){d.trace("already seen %p in query",k.id);continue}if(n.equals(k.id)){d("not querying ourselves");continue}if(!await p.isDialable(k.multiaddrs)){d("not querying undialable peer");continue}const x=await ls(k.id),I=Tc(x,f);if(wp(I,w)!==-1){d.trace("skipping %p as they are not closer to %b than %p",k.id,e,v);continue}d.trace("querying closer peer %p",k.id),g(k.id,x)}b.safeDispatchEvent("completed",{detail:A})}}catch(A){if(!i.aborted)return $c({from:v,error:A},r)}finally{E.clear()}},{distance:w}).catch(m=>{d.error(m)})}g(t,await ls(t));try{for await(const v of b.toGenerator({signal:i}))v!=null&&(yield v)}catch(v){throw i.aborted?new J3e("Query aborted"):v}}class m4e{constructor(e,t){u(this,"disjointPaths");u(this,"alpha");u(this,"shutDownController");u(this,"running");u(this,"logger");u(this,"peerId");u(this,"connectionManager");u(this,"routingTable");u(this,"initialQuerySelfHasRun");u(this,"logPrefix");this.logPrefix=t.logPrefix,this.disjointPaths=t.disjointPaths??kB,this.alpha=t.alpha??iE,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.shutDownController=new AbortController,this.shutDownController.signal,this.running=!1}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutDownController=new AbortController,this.shutDownController.signal,void 0)}async stop(){this.running=!1,this.shutDownController.abort()}async*run(e,t,n={}){if(!this.running)throw new Error("QueryManager not started");if(n.signal==null){const c=AbortSignal.timeout(W3e);n={...n,signal:c}}const i=new AbortController,s=pt([this.shutDownController.signal,i.signal,n.signal]);i.signal;const o=this.logger.forComponent(`${this.logPrefix}:query:`+re(e,"base58btc"));let a=!1;try{n.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(o("waiting for initial query-self query before continuing"),await ln(this.initialQuerySelfHasRun.promise,s),this.initialQuerySelfHasRun=void 0),o("query:start");const c=await gp(e),l=this.routingTable.closestPeers(c),d=l.slice(0,Math.min(this.disjointPaths,l.length));if(l.length===0){o.error("Running query with no peers");return}const h=new rs,p=d.map((b,f)=>y4e({...n,key:e,startingPeer:b,ourPeerId:this.peerId,signal:s,query:t,pathIndex:f,numPaths:d.length,alpha:this.alpha,queryFuncTimeout:n.queryFuncTimeout,log:o,peersSeen:h,onProgress:n.onProgress,connectionManager:this.connectionManager}));for await(const b of Oa(...p)){if(b.name==="QUERY_ERROR"&&o.error("query error",b.error),b.name==="PEER_RESPONSE")for(const f of[...b.closer,...b.providers])await this.connectionManager.isDialable(f.multiaddrs)&&await this.routingTable.add(f.id);yield b}a=!0}catch(c){if(!(!this.running&&c.name==="QueryAbortedError"))throw c}finally{a||(o("query exited early"),i.abort()),s.clear(),o("query:done")}}}function w4e(r){return r[Symbol.asyncIterator]!=null}function WB(r){if(w4e(r))return(async()=>{let e=0;for await(const t of r)e++;return e})();{let e=0;for(const t of r)e++;return e}}const b4e=r=>{const e=r.addEventListener||r.on||r.addListener,t=r.removeEventListener||r.off||r.removeListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function v4e(r,e,t){let n;const i=new Promise((s,o)=>{var b;if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");(b=t.signal)==null||b.throwIfAborted();const a=[e].flat(),c=[],{addListener:l,removeListener:d}=b4e(r),h=(...f)=>{const g=t.multiArgs?f:f[0];t.filter&&!t.filter(g)||(c.push(g),t.count===c.length&&(n(),s(c)))},p=f=>{n(),o(f)};n=()=>{for(const f of a)d(f,h);for(const f of t.rejectionEvents)d(f,p)};for(const f of a)l(f,h);for(const f of t.rejectionEvents)l(f,p);t.signal&&t.signal.addEventListener("abort",()=>{p(t.signal.reason)},{once:!0}),t.resolveImmediately&&s(c)});if(i.cancel=n,typeof t.timeout=="number"){const s=Wf(i,{milliseconds:t.timeout});return s.cancel=n,s}return i}function E4e(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};const n=v4e(r,e,t),i=n.then(s=>s[0]);return i.cancel=n.cancel,i}class S4e{constructor(e,t){u(this,"log");u(this,"peerId");u(this,"peerRouting");u(this,"routingTable");u(this,"count");u(this,"interval");u(this,"initialInterval");u(this,"queryTimeout");u(this,"running");u(this,"timeoutId");u(this,"controller");u(this,"initialQuerySelfHasRun");u(this,"querySelfPromise");this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:query-self`),this.running=!1,this.peerRouting=t.peerRouting,this.routingTable=t.routingTable,this.count=t.count??kB,this.interval=t.interval??V3e,this.initialInterval=t.initialInterval??K3e,this.queryTimeout=t.queryTimeout??j3e,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.querySelf=HB(this.querySelf.bind(this),t.operationMetrics,"SELF_QUERY")}isStarted(){return this.running}start(){this.running||(this.running=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.initialInterval))}stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}async querySelf(){if(!this.running){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=Le(),this.running){this.controller=new AbortController;const e=[this.controller.signal];if(this.initialQuerySelfHasRun==null){const n=AbortSignal.timeout(this.queryTimeout);e.push(n)}const t=pt(e);this.controller.signal;try{this.routingTable.size===0&&(this.log("routing table was empty, waiting for some peers before running query"),await E4e(this.routingTable,"peer:add",{signal:t,filter:s=>!this.peerId.equals(s.detail)}),this.log("routing table has peers, continuing with query")),this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);const n=Date.now(),i=await un(this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes,{signal:t,isSelfQuery:!0}),s=>by(s,this.count),async s=>WB(s));this.log("self-query found %d peers in %dms",i,Date.now()-n)}catch(n){this.log.error("self-query error",n)}finally{t.clear(),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.running&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.interval))}}class x4e extends er{constructor(t,n){super();u(this,"log");u(this,"reprovideQueue");u(this,"maxQueueSize");u(this,"datastore");u(this,"timeout");u(this,"reprovideTimeout");u(this,"running");u(this,"shutdownController");u(this,"reprovideThreshold");u(this,"contentRouting");u(this,"datastorePrefix");u(this,"addressManager");u(this,"validity");u(this,"interval");u(this,"lock");u(this,"peerId");this.log=t.logger.forComponent(`${n.logPrefix}:reprovider`),this.peerId=t.peerId,this.reprovideQueue=new Ul({concurrency:n.concurrency??U3e,metrics:t.metrics,metricName:`${n.metricsPrefix}_reprovide_queue`}),this.reprovideTimeout=new mp({...n.timeout??{},metrics:t.metrics,metricName:`${n.metricsPrefix}_reprovide_timeout_milliseconds`}),this.datastore=t.datastore,this.addressManager=t.addressManager,this.datastorePrefix=`${n.datastorePrefix}/provider`,this.reprovideThreshold=n.threshold??B3e,this.maxQueueSize=n.maxQueueSize??F3e,this.validity=n.validity??L3e,this.interval=n.interval??z3e,this.contentRouting=n.contentRouting,this.lock=n.lock,this.running=!1,this.reprovide=HB(this.reprovide.bind(this),n.operationMetrics,"PROVIDE")}start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,this.timeout=setTimeout(()=>{this.cleanUp().catch(t=>{this.log.error("error running reprovide/cleanup - %e",t)})},this.interval))}stop(){var t;this.running=!1,this.reprovideQueue.clear(),clearTimeout(this.timeout),(t=this.shutdownController)==null||t.abort()}async cleanUp(){const t=await this.lock.writeLock();try{this.safeDispatchEvent("reprovide:start");for await(const n of this.datastore.query({prefix:this.datastorePrefix}))try{const{cid:i,peerId:s}=KB(n.key),o=jB(n.value).getTime(),a=o+this.validity,c=Date.now(),l=c>a;this.log.trace("comparing: %d < %d = %s %s",o,c-this.validity,l,l?"(expired)":""),l&&await this.datastore.delete(n.key),this.peerId.equals(s)&&c-a<this.reprovideThreshold&&this.queueReprovide(i).catch(d=>{this.log.error("could not reprovide %c - %e",i,d)})}catch(i){this.log.error("error processing datastore key %s - %e",n.key,i.message)}this.log("reprovide/cleanup successful")}finally{t(),this.safeDispatchEvent("reprovide:end"),this.running&&(this.timeout=setTimeout(()=>{this.cleanUp().catch(n=>{this.log.error("error running re-provide - %e",n)})},this.interval))}}async queueReprovide(t){var i;if(!this.running)return;this.log.trace("waiting for queue capacity before adding %c to re-provide queue",t),await this.reprovideQueue.onSizeLessThan(this.maxQueueSize);const n=this.reprovideQueue.queue.find(s=>s.options.cid.equals(t));if(n!=null)return this.log.trace("not adding %c to re-provide queue - already in queue",t),n.join();this.log.trace("adding %c to re-provide queue",t),this.reprovideQueue.add(async s=>{var a;if((a=s.signal)==null||a.throwIfAborted(),!this.running)return;this.log.trace("re-providing %c",t);const o=this.reprovideTimeout.getTimeoutSignal(s);try{await this.reprovide(s.cid,s)}finally{this.reprovideTimeout.cleanUp(o)}this.log.trace("re-provided %c",t)},{signal:(i=this.shutdownController)==null?void 0:i.signal,cid:t}).catch(s=>{this.log.error("could not re-provide key %c - %e",t,s)})}async reprovide(t,n){await vo(this.contentRouting.provide(t,this.addressManager.getAddresses(),n))}}const A4e=20,C4e=5e3,I4e="kad-close",k4e=50;class _4e{constructor(e,t){u(this,"routingTable");u(this,"components");u(this,"closestPeers");u(this,"newPeers");u(this,"refreshInterval");u(this,"peerSetSize");u(this,"timeout");u(this,"closeTagName");u(this,"closeTagValue");u(this,"log");u(this,"running");this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.routingTable=t.routingTable,this.refreshInterval=t.refreshInterval??C4e,this.peerSetSize=t.peerSetSize??A4e,this.closeTagName=t.closeTagName??I4e,this.closeTagValue=t.closeTagValue??k4e,this.closestPeers=new rs,this.onPeerPing=this.onPeerPing.bind(this),this.running=!1}async start(){if(this.running)return;this.running=!0;const e=await ls(this.components.peerId);this.newPeers=new vE(e,this.peerSetSize),this.routingTable.addEventListener("peer:ping",this.onPeerPing),this.timeout=setInterval(()=>{this.updatePeerTags().catch(t=>{this.log.error("error updating peer tags - %e",t)})},this.refreshInterval)}stop(){this.running=!1,this.routingTable.removeEventListener("peer:ping",this.onPeerPing),clearTimeout(this.timeout)}onPeerPing(e){var t;(t=this.newPeers)==null||t.add({id:e.detail,multiaddrs:[]}).catch(n=>{this.log.error("error adding peer to distance list - %e",n)})}async updatePeerTags(){var i;const e=new rs((i=this.newPeers)==null?void 0:i.peers.map(s=>s.id)),t=e.difference(this.closestPeers),n=this.closestPeers.difference(e);this.closestPeers=e,await Promise.all([...[...t].map(async s=>{await this.components.peerStore.merge(s,{tags:{[this.closeTagName]:{value:this.closeTagValue},[_B]:{value:1}}})}),...[...n].map(async s=>{await this.components.peerStore.merge(s,{tags:{[this.closeTagName]:void 0,[_B]:void 0}})})])}}function M3(r){return Array.isArray(r==null?void 0:r.peers)}class T4e{constructor(e){u(this,"root");u(this,"localPeer");u(this,"prefixLength");u(this,"splitThreshold");u(this,"kBucketSize");u(this,"numberOfNodesToPing");u(this,"lastPingThreshold");u(this,"ping");u(this,"verify");u(this,"onAdd");u(this,"onRemove");u(this,"onMove");u(this,"addingPeerMap");this.prefixLength=e.prefixLength??$4e,this.kBucketSize=e.kBucketSize??GB,this.splitThreshold=e.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=e.numberOfOldContactsToPing??O4e,this.lastPingThreshold=e.lastPingThreshold??U4e,this.ping=e.ping,this.verify=e.verify,this.onAdd=e.onAdd,this.onRemove=e.onRemove,this.addingPeerMap=new dc,this.root={prefix:"",depth:0,peers:[]}}async addSelfPeer(e){this.localPeer={peerId:e,kadId:await ls(e),lastPing:Date.now()}}async add(e,t){const n={peerId:e,kadId:await ls(e),lastPing:0},i=this.addingPeerMap.get(e);if(i!=null)return i;try{const s=this._add(n,t);this.addingPeerMap.set(e,s),await s}finally{this.addingPeerMap.delete(e)}}async _add(e,t){var o;const n=this._determineBucket(e.kadId);if(this._indexOf(n,e.kadId)>-1)return;if(n.peers.length===this.splitThreshold&&n.depth<this.prefixLength){await this._split(n),await this._add(e,t);return}if(n.peers.length<this.kBucketSize){if(!D4e(e,this.lastPingThreshold)){n.peers.push(e),await((o=this.onAdd)==null?void 0:o.call(this,e,n));return}await this.verify(e,t)&&(e.lastPing=Date.now(),await this._add(e,t));return}const i=n.peers.filter(a=>{var c;return!(a.peerId.equals((c=this.localPeer)==null?void 0:c.peerId)||a.lastPing>Date.now()-this.lastPingThreshold)}).sort((a,c)=>a.lastPing<c.lastPing?-1:a.lastPing>c.lastPing?1:0).slice(0,this.numberOfNodesToPing);let s=!1;for await(const a of this.ping(i,t))s=!0,await this.remove(a.kadId);s&&await this._add(e,t)}*closest(e,t=this.kBucketSize){const n=new vE(e,t);for(const i of this.toIterable())n.addWithKadId({id:i.peerId,multiaddrs:[]},i.kadId);yield*Fd(n.peers,i=>i.id)}count(){function e(t){if(M3(t))return t.peers.length;let n=0;return t.left!=null&&(n+=e(t.left)),t.right!=null&&(n+=e(t.right)),n}return e(this.root)}get(e){const t=this._determineBucket(e),n=this._indexOf(t,e);return t.peers[n]}async remove(e){var i;const t=this._determineBucket(e),n=this._indexOf(t,e);if(n>-1){const s=t.peers.splice(n,1)[0];await((i=this.onRemove)==null?void 0:i.call(this,s,t))}}*toIterable(){function*e(t){if(M3(t)){yield*t.peers;return}yield*e(t.left),yield*e(t.right)}yield*e(this.root)}distance(e,t){return BigInt("0x"+re(Tc(e,t),"base16"))}_determineBucket(e){const t=re(e,"base2");function n(i,s=0){return M3(i)?i:t[s]==="0"?n(i.left,s+1):n(i.right,s+1)}return n(this.root)}_indexOf(e,t){return e.peers.findIndex(n=>We(n.kadId,t))}async _split(e){var i,s;const t={prefix:"0",depth:e.depth+1,peers:[]},n={prefix:"1",depth:e.depth+1,peers:[]};for(const o of e.peers)re(o.kadId,"base2")[e.depth]==="0"?(t.peers.push(o),await((i=this.onMove)==null?void 0:i.call(this,o,e,t))):(n.peers.push(o),await((s=this.onMove)==null?void 0:s.call(this,o,e,n)));P4e(e,t,n)}}function P4e(r,e,t){return delete r.peers,r.left=e,r.right=t,r.prefix===""&&(delete r.depth,delete r.prefix),!0}function D4e(r,e){return r.lastPing<Date.now()-e}const GB=20,$4e=6,N4e=20,M4e=100,O4e=3,R4e=20,L4e=100,QB="kad-peer",B4e=1,U4e=6e5,F4e=!0,z4e=1e3;class V4e extends er{constructor(t,n){super();u(this,"kBucketSize");u(this,"kb");u(this,"network");u(this,"closestPeerTagger");u(this,"log");u(this,"components");u(this,"running");u(this,"pingNewContactTimeout");u(this,"pingNewContactQueue");u(this,"pingOldContactTimeout");u(this,"pingOldContactQueue");u(this,"populateFromDatastoreOnStart");u(this,"populateFromDatastoreLimit");u(this,"protocol");u(this,"peerTagName");u(this,"peerTagValue");u(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${n.logPrefix}:routing-table`),this.kBucketSize=n.kBucketSize??GB,this.running=!1,this.protocol=n.protocol,this.network=n.network,this.peerTagName=n.peerTagName??QB,this.peerTagValue=n.peerTagValue??B4e,this.pingOldContacts=this.pingOldContacts.bind(this),this.verifyNewContact=this.verifyNewContact.bind(this),this.peerAdded=this.peerAdded.bind(this),this.peerRemoved=this.peerRemoved.bind(this),this.populateFromDatastoreOnStart=n.populateFromDatastoreOnStart??F4e,this.populateFromDatastoreLimit=n.populateFromDatastoreLimit??z4e,this.pingOldContactQueue=new uc({concurrency:n.pingOldContactConcurrency??R4e,metricName:`${n.metricsPrefix}_ping_old_contact_queue`,metrics:this.components.metrics,maxSize:n.pingOldContactMaxQueueSize??L4e}),this.pingOldContactTimeout=new mp({...n.pingOldContactTimeout??{},metrics:this.components.metrics,metricName:`${n.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`}),this.pingNewContactQueue=new uc({concurrency:n.pingNewContactConcurrency??N4e,metricName:`${n.metricsPrefix}_ping_new_contact_queue`,metrics:this.components.metrics,maxSize:n.pingNewContactMaxQueueSize??M4e}),this.pingNewContactTimeout=new mp({...n.pingNewContactTimeout??{},metrics:this.components.metrics,metricName:`${n.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`}),this.kb=new T4e({kBucketSize:n.kBucketSize,prefixLength:n.prefixLength,splitThreshold:n.splitThreshold,numberOfOldContactsToPing:n.numberOfOldContactsToPing,lastPingThreshold:n.lastPingThreshold,ping:this.pingOldContacts,verify:this.verifyNewContact,onAdd:this.peerAdded,onRemove:this.peerRemoved}),this.closestPeerTagger=new _4e(this.components,{logPrefix:n.logPrefix,routingTable:this,peerSetSize:n.closestPeerSetSize,refreshInterval:n.closestPeerSetRefreshInterval,closeTagName:n.closeTagName,closeTagValue:n.closeTagValue}),this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMinOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),routingTableKadBucketMaxOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_max_depth`),kadBucketEvents:this.components.metrics.registerCounterGroup(`${n.metricsPrefix}_kad_bucket_events_total`)})}isStarted(){return this.running}async start(){this.running||(this.running=!0,await Io(this.closestPeerTagger),await this.kb.addSelfPeer(this.components.peerId))}async afterStart(){Promise.resolve().then(async()=>{if(!this.populateFromDatastoreOnStart)return;let t=0;for(const n of await this.components.peerStore.all({filters:[i=>i.protocols.includes(this.protocol)&&i.tags.has(QB)],limit:this.populateFromDatastoreLimit})){if(!this.running)return;try{await this.add(n.id),t++}catch{this.log("failed to add peer %p to routing table, removing kad-dht peer tags - %e"),await this.components.peerStore.merge(n.id,{tags:{[this.peerTagName]:void 0}})}}this.log("added %d peer store peers to the routing table",t)}).catch(t=>{this.log.error("error adding peer store peers to the routing table %e",t)})}async stop(){this.running=!1,await Qa(this.closestPeerTagger),this.pingOldContactQueue.abort(),this.pingNewContactQueue.abort()}async peerAdded(t,n){var i;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:{value:this.peerTagValue}}}),this.updateMetrics(),(i=this.metrics)==null||i.kadBucketEvents.increment({peer_added:!0}),this.safeDispatchEvent("peer:add",{detail:t.peerId})}async peerRemoved(t,n){var i;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:void 0}}),this.updateMetrics(),(i=this.metrics)==null||i.kadBucketEvents.increment({peer_removed:!0}),this.safeDispatchEvent("peer:remove",{detail:t.peerId})}async*pingOldContacts(t,n){var s;if(!this.running)return;const i=[];for(const o of t){if(this.kb.get(o.kadId)==null){this.log("asked to ping contact %p that was not in routing table",o.peerId);continue}(s=this.metrics)==null||s.kadBucketEvents.increment({ping_old_contact:!0}),i.push(async()=>{const a=this.pingOldContactQueue.find(o.peerId);if(a!=null)return this.log("asked to ping contact %p was already being pinged",o.peerId),await a.join(n)?void 0:o;if(!await this.pingOldContactQueue.add(async l=>{var p;const d=this.pingOldContactTimeout.getTimeoutSignal(),h=pt([d,l==null?void 0:l.signal]);try{return await this.pingContact(o,l)}catch{return(p=this.metrics)==null||p.kadBucketEvents.increment({ping_old_contact_error:!0}),!0}finally{this.pingOldContactTimeout.cleanUp(d),h.clear()}},{peerId:o.peerId,signal:n==null?void 0:n.signal}))return o})}for await(const o of hp(i))o!=null&&(yield o)}async verifyNewContact(t,n){var o;const i=this.pingNewContactTimeout.getTimeoutSignal(),s=pt([i,n==null?void 0:n.signal]);try{const a=this.pingNewContactQueue.find(t.peerId);return a!=null?(this.log("joining existing ping to add new peer %p to routing table",t.peerId),await a.join({signal:s})):await this.pingNewContactQueue.add(async c=>{var l;return(l=this.metrics)==null||l.kadBucketEvents.increment({ping_new_contact:!0}),this.log("pinging new peer %p before adding to routing table",t.peerId),this.pingContact(t,c)},{peerId:t.peerId,signal:s})}catch{return this.log.trace("tried to add peer %p but they were not online",t.peerId),(o=this.metrics)==null||o.kadBucketEvents.increment({ping_new_contact_error:!0}),!1}finally{this.pingNewContactTimeout.cleanUp(i),s.clear()}}async pingContact(t,n){try{this.log("pinging contact %p",t.peerId);for await(const i of this.network.sendRequest(t.peerId,{type:It.PING},n))if(i.type===EE.PEER_RESPONSE)return i.messageType===It.PING?(this.log("contact %p ping ok",t.peerId),this.safeDispatchEvent("peer:ping",{detail:t.peerId}),!0):!1;return!1}catch(i){return this.log("error pinging old contact %p - %e",t.peerId,i),!1}}get size(){return this.kb==null?0:this.kb.count()}async find(t){var i;const n=await ls(t);return(i=this.kb.get(n))==null?void 0:i.peerId}closestPeer(t){const n=this.closestPeers(t,1);if(n.length>0)return n[0]}closestPeers(t,n=this.kBucketSize){return this.kb==null?[]:[...this.kb.closest(t,n)]}async add(t,n){if(this.kb==null)throw new Error("RoutingTable is not started");await this.kb.add(t,n)}async remove(t){if(this.kb==null)throw new Error("RoutingTable is not started");const n=await ls(t);await this.kb.remove(n)}updateMetrics(){if(this.metrics==null||this.kb==null)return;let t=0,n=0,i=0,s=20,o=0;function a(c){if(M3(c)){c.depth>i&&(i=c.depth),n++,t+=c.peers.length,c.peers.length<s&&(s=c.peers.length),c.peers.length>o&&(o=c.peers.length);return}a(c.left),a(c.right)}a(this.kb.root),this.metrics.routingTableSize.update(t),this.metrics.routingTableKadBucketTotal.update(n),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(t/n)),this.metrics.routingTableKadBucketMinOccupancy.update(s),this.metrics.routingTableKadBucketMaxOccupancy.update(o),this.metrics.routingTableKadBucketMaxDepth.update(i)}}const K4e=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],O3=15;class j4e{constructor(e,t){u(this,"log");u(this,"peerRouting");u(this,"routingTable");u(this,"refreshInterval");u(this,"refreshQueryTimeout");u(this,"commonPrefixLengthRefreshedAt");u(this,"refreshTimeoutId");const{peerRouting:n,routingTable:i,refreshInterval:s,refreshQueryTimeout:o,logPrefix:a}=t;this.log=e.logger.forComponent(`${a}:routing-table:refresh`),this.peerRouting=n,this.routingTable=i,this.refreshInterval=s??H3e,this.refreshQueryTimeout=o??q3e,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async afterStart(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");const t=this._maxCommonPrefix(),n=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${n.map(i=>i.toISOString()).join(", ")} ]`),Promise.all(n.map(async(i,s)=>{try{if(await this._refreshCommonPrefixLength(s,i,e),this._numPeersForCpl(t)===0){const o=Math.min(2*(s+1),n.length-1);for(let a=s+1;a<o+1;a++)try{await this._refreshCommonPrefixLength(a,i,e)}catch(c){this.log.error(c)}}}catch(o){this.log.error(o)}})).catch(i=>{this.log.error(i)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(i=>{this.log.error(i)})}async _refreshCommonPrefixLength(e,t,n){if(!n&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}const i=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,i,this.routingTable.size);const s=AbortSignal.timeout(this.refreshQueryTimeout),o=await WB(this.peerRouting.getClosestPeers(i.toMultihash().bytes,{signal:s}));this.log(`found ${o} peers that were close to imaginary peer %p`,i),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,i,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(e){e>O3&&(e=O3);const t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}async _generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");if(this.routingTable.kb.localPeer==null)throw new Error("Local peer not set");const t=sc(2),n=(t[1]<<8)+t[0],i=await this._makePeerId(this.routingTable.kb.localPeer.kadId,n,e),s=ru(i);return ti(s)}async _makePeerId(e,t,n){if(n>O3)throw new Error(`Cannot generate peer ID for common prefix length greater than ${O3}`);const o=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>n,a=65535<<16-(n+1),c=o&a|t&~a,l=K4e[c],d=new ArrayBuffer(34),h=new DataView(d,0,d.byteLength);return h.setUint8(0,zB.code),h.setUint8(1,32),h.setUint32(2,l,!1),new Uint8Array(h.buffer,h.byteOffset,h.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){var e;if(((e=this.routingTable.kb)==null?void 0:e.localPeer)!=null)for(const{kadId:t}of this.routingTable.kb.toIterable()){const n=Tc(this.routingTable.kb.localPeer.kadId,t);let i=0;for(const s of n)if(s===0)i++;else break;yield i}}}class H4e{constructor(e,t){u(this,"peerId");u(this,"providers");u(this,"peerStore");u(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:add-provider`),this.peerId=e.peerId,this.providers=t.providers,this.peerStore=e.peerStore}async handle(e,t){if(t.key==null||t.key.length===0)throw new St("Missing key");let n;try{n=mE.decode(t.key)}catch{throw new St("Invalid CID")}(t.providers==null||t.providers.length===0)&&this.log.error("no providers found in message"),this.log("%p asked us, %p to store provider record for for %c",e,this.peerId,n),await Promise.all(t.providers.map(async i=>{const s=ru(i.id),o=ti(s),a=i.multiaddrs.map(c=>Re(c));if(!e.equals(o)){this.log("invalid provider peer %p from %p",i.id,e);return}if(i.multiaddrs.length<1){this.log("no valid addresses for provider %p. Ignore",e);return}this.log.trace("received provider %p for %s (addrs %s)",e,n,a),await this.providers.addProvider(n,o),await this.peerStore.merge(o,{multiaddrs:a})}))}}class q4e{constructor(e,t){u(this,"peerRouting");u(this,"peerInfoMapper");u(this,"peerId");u(this,"addressManager");u(this,"log");const{peerRouting:n,logPrefix:i}=t;this.log=e.logger.forComponent(`${i}:rpc:handlers:find-node`),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=n,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(this.log("incoming request from %p for peers closer to %b",e,t.key),t.key==null)throw new St("Invalid FIND_NODE message received - key was missing");const n=await this.peerRouting.getCloserPeersOffline(t.key,e);We(this.peerId.toMultihash().bytes,t.key)&&n.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(s=>s.decapsulateCode(Ve("p2p").code))});const i={type:It.FIND_NODE,clusterLevel:t.clusterLevel,closer:n.map(this.peerInfoMapper).filter(({multiaddrs:s})=>s.length).map(s=>({id:s.id.toMultihash().bytes,multiaddrs:s.multiaddrs.map(o=>o.bytes)})),providers:[]};return i.closer.length===0&&this.log("could not find any peers closer to %b than %p",t.key,e),i}}class W4e{constructor(e,t){u(this,"peerId");u(this,"peerRouting");u(this,"providers");u(this,"peerStore");u(this,"peerInfoMapper");u(this,"log");const{peerRouting:n,providers:i,logPrefix:s}=t;this.log=e.logger.forComponent(`${s}:rpc:handlers:get-providers`),this.peerId=e.peerId,this.peerStore=e.peerStore,this.peerRouting=n,this.providers=i,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(t.key==null)throw new St("Invalid GET_PROVIDERS message received - key was missing");let n;try{n=mE.decode(t.key)}catch{throw new St("Invalid CID")}this.log("%p asking for providers for %s",e,n);const[i,s]=await Promise.all([Xm(Fd(await this.providers.getProviders(n),async a=>{const c=await this.peerStore.get(a);return{id:c.id,multiaddrs:c.addresses.map(({multiaddr:d})=>d)}})),this.peerRouting.getCloserPeersOffline(t.key,this.peerId)]),o={type:It.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:s.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)})),providers:i.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))};return this.log("got %s providers %s closerPeers",o.providers.length,o.closer.length),o}async _getAddresses(e){return[]}}class G4e{constructor(e,t){u(this,"peerStore");u(this,"datastore");u(this,"peerRouting");u(this,"log");u(this,"datastorePrefix");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:get-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}async handle(e,t){const n=t.key;if(this.log("%p asked for key %b",e,n),n==null||n.length===0)throw new St("Invalid key");const i={type:It.GET_VALUE,key:n,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(Vwe(n)){this.log("is public key");const a=Kwe(n);let c;try{const l=await this.peerStore.get(a);if(l.id.publicKey==null)throw new Zt("No public key found in key book");c=_i(l.id.publicKey)}catch(l){if(l.name!=="NotFoundError")throw l}if(c!=null)return this.log("returning found public key"),i.record=new Di(n,c,new Date).serialize(),i}const[s,o]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getCloserPeersOffline(n,e)]);return s!=null&&(this.log("had record for %b in local datastore",n),i.record=s.serialize()),o.length>0&&(this.log("had %s closer peers in routing table",o.length),i.closer=o.map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))),i}async _checkLocalDatastore(e){this.log("checkLocalDatastore looking for %b",e);const t=yp(this.datastorePrefix,e);let n;try{n=await this.datastore.get(t)}catch(s){if(s.name==="NotFoundError")return;throw s}const i=Di.deserialize(n);if(i.timeReceived==null||Date.now()-i.timeReceived.getTime()>O3e){await this.datastore.delete(t);return}return i}}class Q4e{constructor(e,t){u(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:ping`)}async handle(e,t){return this.log("ping from %p",e),t}}class J4e{constructor(e,t){u(this,"components");u(this,"validators");u(this,"log");u(this,"datastorePrefix");const{validators:n}=t;this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:put-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n}async handle(e,t){const n=t.key;if(this.log("%p asked us to store value for key %b",e,n),t.record==null){const i=`Empty record from: ${e.toString()}`;throw this.log.error(i),new St(i)}try{const i=Di.deserialize(t.record);await lE(this.validators,i),i.timeReceived=new Date;const s=yp(this.datastorePrefix,i.key);await this.components.datastore.put(s,i.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,s)}catch(i){this.log("did not put record for key %b into datastore %o",n,i)}return t}}let Y4e=class{constructor(e,t){u(this,"handlers");u(this,"routingTable");u(this,"log");u(this,"metrics");var n,i;this.metrics={operations:(n=e.metrics)==null?void 0:n.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_requests_total`),errors:(i=e.metrics)==null?void 0:i.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_errors_total`)},this.log=e.logger.forComponent(`${t.logPrefix}:rpc`),this.routingTable=t.routingTable,this.handlers={[It.GET_VALUE.toString()]:new G4e(e,t),[It.PUT_VALUE.toString()]:new J4e(e,t),[It.FIND_NODE.toString()]:new q4e(e,t),[It.ADD_PROVIDER.toString()]:new H4e(e,t),[It.GET_PROVIDERS.toString()]:new W4e(e,t),[It.PING.toString()]:new Q4e(e,t)}}async handleMessage(e,t){var i,s;const n=this.handlers[t.type];if(n==null){this.log.error(`no handler found for message type: ${t.type}`);return}try{return(i=this.metrics.operations)==null||i.increment({[t.type]:!0}),await n.handle(e,t)}catch{(s=this.metrics.errors)==null||s.increment({[t.type]:!0})}}onIncomingStream(e){let t="unknown";Promise.resolve().then(async()=>{const{stream:n,connection:i}=e,s=i.remotePeer,o=this;await un(n,a=>Ud(a),async function*(a){for await(const c of a){const l=tu.decode(c);t=l.type,o.log("incoming %s from %p",l.type,s);const d=await o.handleMessage(s,l);d!=null&&(yield tu.encode(d))}},a=>Bd(a),n)}).catch(n=>{this.log.error("error handling %s RPC message from %p - %e",t,e.connection.remotePeer,n)})}};class X4e extends er{constructor(t,n){super();u(this,"log");u(this,"components");u(this,"protocol");u(this,"running");u(this,"registrarId");const{protocol:i,logPrefix:s}=n;this.components=t,this.log=t.logger.forComponent(`${s}:topology-listener`),this.running=!1,this.protocol=i}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:t=>{this.log("observed peer %p with protocol %s",t,this.protocol),this.dispatchEvent(new CustomEvent("peer",{detail:t}))}}))}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class Z4e{constructor(e){u(this,"dht");this.dht=e}async provide(e,t={}){await vo(this.dht.provide(e,t))}async cancelReprovide(e){await this.dht.cancelReprovide(e)}async*findProviders(e,t={}){for await(const n of this.dht.findProviders(e,t))n.name==="PROVIDER"&&(yield*n.providers)}async put(e,t,n){await vo(this.dht.put(e,t,n))}async get(e,t){for await(const n of this.dht.get(e,t))if(n.name==="VALUE")return n.value;throw new Zt("Could not find value for key")}}class e5e{constructor(e){u(this,"dht");this.dht=e}async findPeer(e,t={}){for await(const n of this.dht.findPeer(e,t))if(n.name==="FINAL_PEER")return n.peer;throw new Zt("Peer not found")}async*getClosestPeers(e,t={}){for await(const n of this.dht.getClosestPeers(e,t))n.name==="FINAL_PEER"&&(yield n.peer)}}const t5e=32,r5e=64;class n5e extends er{constructor(t,n={}){var d,h,p,b;super();u(this,"protocol");u(this,"routingTable");u(this,"providers");u(this,"network");u(this,"peerRouting");u(this,"components");u(this,"log");u(this,"running");u(this,"kBucketSize");u(this,"clientMode");u(this,"validators");u(this,"selectors");u(this,"queryManager");u(this,"contentFetching");u(this,"contentRouting");u(this,"routingTableRefresh");u(this,"rpc");u(this,"topologyListener");u(this,"querySelf");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"dhtContentRouting");u(this,"dhtPeerRouting");u(this,"peerInfoMapper");u(this,"reprovider");u(this,fH,"@libp2p/kad-dht");u(this,hH,["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery"]);u(this,dH,["@libp2p/identify"]);const i=n.logPrefix??"libp2p:kad-dht",s=n.datastorePrefix??"/dht",o=n.metricsPrefix??"libp2p_kad_dht",a={queries:(d=t.metrics)==null?void 0:d.registerMetricGroup(`${o}_operations_total`,{label:"operation"}),errors:(h=t.metrics)==null?void 0:h.registerCounterGroup(`${o}_operation_errors_total`,{label:"operation"}),queryTime:(p=t.metrics)==null?void 0:p.registerMetricGroup(`${o}_operation_time_seconds`,{label:"operation"}),errorTime:(b=t.metrics)==null?void 0:b.registerMetricGroup(`${o}_operation_error_time_seconds`,{label:"operation"})};this.running=!1,this.components=t,this.log=t.logger.forComponent(i),this.protocol=n.protocol??R3e,this.kBucketSize=n.kBucketSize??20,this.clientMode=n.clientMode??!0,this.maxInboundStreams=n.maxInboundStreams??t5e,this.maxOutboundStreams=n.maxOutboundStreams??r5e,this.peerInfoMapper=n.peerInfoMapper??Fwe;const c=E7();this.providers=new g4e(t,{...n.providers,logPrefix:i,datastorePrefix:s,lock:c}),this.validators={...rwe,...n.validators},this.selectors={...twe,...n.selectors},this.network=new f4e(t,{protocol:this.protocol,logPrefix:i,metricsPrefix:o}),this.routingTable=new V4e(t,{kBucketSize:n.kBucketSize,pingOldContactTimeout:n.pingOldContactTimeout,pingOldContactConcurrency:n.pingOldContactConcurrency,pingOldContactMaxQueueSize:n.pingOldContactMaxQueueSize,pingNewContactTimeout:n.pingNewContactTimeout,pingNewContactConcurrency:n.pingNewContactConcurrency,pingNewContactMaxQueueSize:n.pingNewContactMaxQueueSize,protocol:this.protocol,logPrefix:i,metricsPrefix:o,prefixLength:n.prefixLength,splitThreshold:n.kBucketSplitThreshold,network:this.network});const l=Le();n.allowQueryWithZeroPeers===!0&&l.resolve(),this.queryManager=new m4e(t,{disjointPaths:Math.ceil(this.kBucketSize/2),logPrefix:i,metricsPrefix:o,initialQuerySelfHasRun:l,routingTable:this.routingTable}),this.peerRouting=new p4e(t,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:i}),this.contentFetching=new Ywe(t,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:i,datastorePrefix:s}),this.contentRouting=new Zwe(t,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:i}),this.routingTableRefresh=new j4e(t,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:i}),this.rpc=new Y4e(t,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:i,metricsPrefix:o,datastorePrefix:s,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new X4e(t,{protocol:this.protocol,logPrefix:i}),this.querySelf=new S4e(t,{peerRouting:this.peerRouting,interval:n.querySelfInterval,initialInterval:n.initialQuerySelfInterval,logPrefix:i,initialQuerySelfHasRun:l,routingTable:this.routingTable,operationMetrics:a}),this.reprovider=new x4e(t,{...n.reprovide,logPrefix:i,metricsPrefix:o,datastorePrefix:s,contentRouting:this.contentRouting,lock:c,operationMetrics:a}),this.network.addEventListener("peer",f=>{const g=f.detail;this.onPeerConnect(g).catch(v=>{this.log.error("could not add %p to routing table",g.id,v)}),this.dispatchEvent(new CustomEvent("peer",{detail:g}))}),this.topologyListener.addEventListener("peer",f=>{const g=f.detail;Promise.resolve().then(async()=>{const v=await this.components.peerStore.get(g),y={id:g,multiaddrs:v.addresses.map(({multiaddr:w})=>w),protocols:v.protocols};await this.onPeerConnect(y)}).catch(v=>{this.log.error("could not add %p to routing table - %e",g,v)})}),this.dhtPeerRouting=new e5e(this),this.dhtContentRouting=new Z4e(this),n.clientMode==null&&t.events.addEventListener("self:peer:update",f=>{this.log("received update of self-peer info"),Promise.resolve().then(async()=>{const g=f.detail.peer.addresses.some(({multiaddr:y})=>Jwe(y)),v=this.getMode();g&&v==="client"?await this.setMode("server"):v==="server"&&!g&&await this.setMode("client")}).catch(g=>{this.log.error("error setting dht server mode",g)})}),this.get=lh(this.get.bind(this),a,"GET_VALUE"),this.findProviders=lh(this.findProviders.bind(this),a,"FIND_PROVIDERS"),this.findPeer=lh(this.findPeer.bind(this),a,"FIND_PEER"),this.getClosestPeers=lh(this.getClosestPeers.bind(this),a,"GET_CLOSEST_PEERS"),this.provide=lh(this.provide.bind(this),a,"PROVIDE"),this.put=lh(this.put.bind(this),a,"PUT_VALUE")}get[(fH=Symbol.toStringTag,hH=dr,dH=Ja,Sd)](){return this.dhtContentRouting}get[xd](){return this.dhtPeerRouting}get[P2](){return this}async onPeerConnect(t){if(this.log.trace("peer %p connected",t.id),t=this.peerInfoMapper(t),t.multiaddrs.length===0){this.log.trace("ignoring %p as there were no valid addresses in %s after filtering",t.id,t.multiaddrs.map(n=>n.toString()));return}try{await this.routingTable.add(t.id)}catch(n){this.log.error("could not add %p to routing table",t.id,n)}}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(t,n=!1){if(t===this.getMode()&&!n){this.log("already in %s mode",t);return}if(await this.components.registrar.unhandle(this.protocol),t===this.getMode()&&!n){this.log("already in %s mode",t);return}t==="client"?(this.log("enabling client mode while in %s mode",this.getMode()),this.clientMode=!0):(this.log("enabling server mode while in %s mode",this.getMode()),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running||(this.running=!0,await this.setMode(this.clientMode?"client":"server",!0),await Io(this.routingTable,this.queryManager,this.network,this.topologyListener,this.routingTableRefresh,this.reprovider),await Io(this.querySelf))}async stop(){this.running=!1,await Qa(this.querySelf,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener,this.reprovider)}async*put(t,n,i={}){yield*this.contentFetching.put(t,n,i)}async*get(t,n={}){yield*this.contentFetching.get(t,n)}async*provide(t,n={}){yield*this.contentRouting.provide(t,this.components.addressManager.getAddresses(),n)}async cancelReprovide(t){await this.providers.removeProvider(t,this.components.peerId)}async*findProviders(t,n={}){yield*this.contentRouting.findProviders(t,n)}async*findPeer(t,n={}){yield*this.peerRouting.findPeer(t,n)}async*getClosestPeers(t,n={}){yield*this.peerRouting.getClosestPeers(t,n)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}}var EE;(function(r){r[r.SEND_QUERY=0]="SEND_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADD_PEER=6]="ADD_PEER",r[r.DIAL_PEER=7]="DIAL_PEER"})(EE||(EE={}));function i5e(r={}){return e=>new n5e(e,r)}var s5e=r=>{if(Object.prototype.toString.call(r)!=="[object Object]")return!1;const e=Object.getPrototypeOf(r);return e===null||e===Object.prototype};const R3=s5e,{hasOwnProperty:JB}=Object.prototype,{propertyIsEnumerable:o5e}=Object,uh=(r,e,t)=>Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),a5e=nt,YB={concatArrays:!1,ignoreUndefined:!1},L3=r=>{const e=[];for(const t in r)JB.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){const t=Object.getOwnPropertySymbols(r);for(const n of t)o5e.call(r,n)&&e.push(n)}return e};function dh(r){return Array.isArray(r)?c5e(r):R3(r)?l5e(r):r}function c5e(r){const e=r.slice(0,0);return L3(r).forEach(t=>{uh(e,t,dh(r[t]))}),e}function l5e(r){const e=Object.getPrototypeOf(r)===null?Object.create(null):{};return L3(r).forEach(t=>{uh(e,t,dh(r[t]))}),e}const XB=(r,e,t,n)=>(t.forEach(i=>{typeof e[i]>"u"&&n.ignoreUndefined||(i in r&&r[i]!==Object.getPrototypeOf(r)?uh(r,i,SE(r[i],e[i],n)):uh(r,i,dh(e[i])))}),r),u5e=(r,e,t)=>{let n=r.slice(0,0),i=0;return[r,e].forEach(s=>{const o=[];for(let a=0;a<s.length;a++)JB.call(s,a)&&(o.push(String(a)),s===r?uh(n,i++,s[a]):uh(n,i++,dh(s[a])));n=XB(n,s,L3(s).filter(a=>!o.includes(a)),t)}),n};function SE(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?u5e(r,e,t):!R3(e)||!R3(r)?dh(e):XB(r,e,L3(e),t)}var d5e=function(...r){const e=SE(dh(YB),this!==a5e&&this||{},YB);let t={_:{}};for(const n of r)if(n!==void 0){if(!R3(n))throw new TypeError("`"+n+"` is not an Option Object");t=SE(t,{_:n},e)}return t._};const xE=Xe(d5e);function h5e(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function f5e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var p5e=f5e,g5e=p5e;let y5e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},m5e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ZB(this,e)}},w5e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return ZB(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function ZB(r,e){return new w5e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let b5e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new y5e(e,t,n),this.decoder=new m5e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function eU({name:r,prefix:e,encode:t,decode:n}){return new b5e(r,e,t,n)}function tU({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=g5e(t,r);return eU({prefix:e,name:r,encode:n,decode:s=>h5e(i(s))})}function v5e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function E5e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function B3({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return eU({prefix:e,name:r,encode(i){return E5e(i,n,t)},decode(i){return v5e(i,n,t,r)}})}const S5e=tU({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});tU({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var x5e=nU,rU=128,A5e=-128,C5e=Math.pow(2,31);function nU(r,e,t){e=e||[],t=t||0;for(var n=t;r>=C5e;)e[t++]=r&255|rU,r/=128;for(;r&A5e;)e[t++]=r&255|rU,r>>>=7;return e[t]=r|0,nU.bytes=t-n+1,e}var I5e=AE,k5e=128,iU=127;function AE(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw AE.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&iU)<<i:(o&iU)*Math.pow(2,i),i+=7}while(o>=k5e);return AE.bytes=s-n,t}var _5e=Math.pow(2,7),T5e=Math.pow(2,14),P5e=Math.pow(2,21),D5e=Math.pow(2,28),$5e=Math.pow(2,35),N5e=Math.pow(2,42),M5e=Math.pow(2,49),O5e=Math.pow(2,56),R5e=Math.pow(2,63),L5e=function(r){return r<_5e?1:r<T5e?2:r<P5e?3:r<D5e?4:r<$5e?5:r<N5e?6:r<M5e?7:r<O5e?8:r<R5e?9:10},B5e={encode:x5e,decode:I5e,encodingLength:L5e},sU=B5e;function oU(r,e,t=0){return sU.encode(r,e,t),e}function aU(r){return sU.encodingLength(r)}function cU(r,e){const t=e.byteLength,n=aU(r),i=n+aU(t),s=new Uint8Array(i+t);return oU(r,s,0),oU(t,s,n),s.set(e,i),new U5e(r,t,e,s)}let U5e=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function F5e({name:r,code:e,encode:t}){return new z5e(r,e,t)}let z5e=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?cU(this.code,t):t.then(n=>cU(this.code,n))}else throw Error("Unknown type, must be binary type")}};function V5e(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const K5e=F5e({name:"sha2-256",code:18,encode:V5e("SHA-256")});function j5e(r){return r>=55296&&r<=56319}function H5e(r){return r>=56320&&r<=57343}var q5e=function(e,t,n){if(typeof t!="string")throw new Error("Input must be string");for(var i=t.length,s=0,o,a,c=0;c<i;c+=1){if(o=t.charCodeAt(c),a=t[c],j5e(o)&&H5e(t.charCodeAt(c+1))&&(c+=1,a+=t[c]),s+=e(a),s===n)return t.slice(0,c+1);if(s>n)return t.slice(0,c-a.length+1)}return t};function W5e(r){return r>=55296&&r<=56319}function G5e(r){return r>=56320&&r<=57343}var Q5e=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var t=e.length,n=0,i=null,s=null,o=0;o<t;o++)i=e.charCodeAt(o),G5e(i)?s!=null&&W5e(s)?n+=1:n+=3:i<=127?n+=1:i>=128&&i<=2047?n+=2:i>=2048&&i<=65535&&(n+=3),s=i;return n},J5e=q5e,Y5e=Q5e,X5e=J5e.bind(null,Y5e),Z5e=X5e,e8e=/[\/\?<>\\:\*\|"]/g,t8e=/[\x00-\x1f\x80-\x9f]/g,r8e=/^\.+$/,n8e=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,i8e=/[\. ]+$/;function lU(r,e){if(typeof r!="string")throw new Error("Input must be string");var t=r.replace(e8e,e).replace(t8e,e).replace(r8e,e).replace(n8e,e).replace(i8e,e);return Z5e(t,255)}var s8e=function(r,e){var t=e&&e.replacement||"",n=lU(r,t);return t===""?n:lU(n,"")};const o8e=Xe(s8e),CE={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function uU(r){const e="AES-GCM";let t=16;const n=12,i="SHA-256",s=16,o=32767,a=Bs.get();t*=8;async function c(h,p){const b=a.getRandomValues(new Uint8Array(s)),f=a.getRandomValues(new Uint8Array(n)),g={name:e,iv:f};typeof p=="string"&&(p=oe(p));let v;if(p.length===0){v=await a.subtle.importKey("jwk",CE,{name:"AES-GCM"},!0,["encrypt"]);try{const w={name:"PBKDF2",salt:b,iterations:o,hash:{name:i}},m=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);v=await a.subtle.deriveKey(w,m,{name:e,length:t},!0,["encrypt"])}catch{v=await a.subtle.importKey("jwk",CE,{name:"AES-GCM"},!0,["encrypt"])}}else{const w={name:"PBKDF2",salt:b,iterations:o,hash:{name:i}},m=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);v=await a.subtle.deriveKey(w,m,{name:e,length:t},!0,["encrypt"])}const y=await a.subtle.encrypt(g,v,h);return or([b,g.iv,new Uint8Array(y)])}async function l(h,p){const b=h.subarray(0,s),f=h.subarray(s,s+n),g=h.subarray(s+n),v={name:e,iv:f};typeof p=="string"&&(p=oe(p));let y;if(p.length===0)try{const m={name:"PBKDF2",salt:b,iterations:o,hash:{name:i}},E=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(m,E,{name:e,length:t},!0,["decrypt"])}catch{y=await a.subtle.importKey("jwk",CE,{name:"AES-GCM"},!0,["decrypt"])}else{const m={name:"PBKDF2",salt:b,iterations:o,hash:{name:i}},E=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(m,E,{name:e,length:t},!0,["decrypt"])}const w=await a.subtle.decrypt(v,y,g);return new Uint8Array(w)}return{encrypt:c,decrypt:l}}/*!
* MIT License
* 
* Copyright (c) 2017-2024 Peculiar Ventures, LLC
* 
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
* 
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
* 
*/const a8e="[object ArrayBuffer]";class he{static isArrayBuffer(e){return Object.prototype.toString.call(e)===a8e}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const n=he.toUint8Array(e),i=he.toUint8Array(t);if(n.length!==i.byteLength)return!1;for(let s=0;s<n.length;s++)if(n[s]!==i[s])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let n=0;for(const o of t)n+=o.byteLength;const i=new Uint8Array(n);let s=0;for(const o of t){const a=this.toUint8Array(o);i.set(a,s),s+=a.length}return e[e.length-1]instanceof Function?this.toView(i,e[e.length-1]):i.buffer}}const IE="string",c8e=/^[0-9a-f\s]+$/i,l8e=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,u8e=/^[a-zA-Z0-9-_]+$/;class dU{static fromString(e){const t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n.buffer}static toString(e){const t=he.toUint8Array(e);let n="";for(let s=0;s<t.length;s++)n+=String.fromCharCode(t[s]);return decodeURIComponent(escape(n))}}class qs{static toString(e,t=!1){const n=he.toArrayBuffer(e),i=new DataView(n);let s="";for(let o=0;o<n.byteLength;o+=2){const a=i.getUint16(o,t);s+=String.fromCharCode(a)}return s}static fromString(e,t=!1){const n=new ArrayBuffer(e.length*2),i=new DataView(n);for(let s=0;s<e.length;s++)i.setUint16(s*2,e.charCodeAt(s),t);return n}}class xe{static isHex(e){return typeof e===IE&&c8e.test(e)}static isBase64(e){return typeof e===IE&&l8e.test(e)}static isBase64Url(e){return typeof e===IE&&u8e.test(e)}static ToString(e,t="utf8"){const n=he.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return qs.toString(n,!0);case"utf16":case"utf16be":return qs.toString(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return qs.fromString(e,!0);case"utf16":case"utf16be":return qs.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=he.toUint8Array(e);if(typeof btoa<"u"){const n=this.ToString(t,"binary");return btoa(n)}else return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!xe.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!xe.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=xe.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return dU.fromString(e);case"utf16":case"utf16be":return qs.fromString(e);case"utf16le":case"usc2":return qs.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=xe.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return dU.toString(e);case"utf16":case"utf16be":return qs.toString(e);case"utf16le":case"usc2":return qs.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);return n.buffer}static ToBinary(e){const t=he.toUint8Array(e);let n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return n}static ToHex(e){const t=he.toUint8Array(e);let n="";const i=t.length;for(let s=0;s<i;s++){const o=t[s];o<16&&(n+="0"),n+=o.toString(16)}return n}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!xe.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const n=new Uint8Array(t.length/2);for(let i=0;i<t.length;i=i+2){const s=t.slice(i,i+2);n[i/2]=parseInt(s,16)}return n.buffer}static ToUtf16String(e,t=!1){return qs.toString(e,t)}static FromUtf16String(e,t=!1){return qs.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}static formatString(e){return(e==null?void 0:e.replace(/[\n\r\t ]/g,""))||""}}xe.DEFAULT_UTF8_ENCODING="utf8";function d8e(...r){const e=r.map(i=>i.byteLength).reduce((i,s)=>i+s),t=new Uint8Array(e);let n=0;return r.map(i=>new Uint8Array(i)).forEach(i=>{for(const s of i)t[n++]=s}),t.buffer}function hU(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<r.byteLength;i++)if(t[i]!==n[i])return!1;return!0}/*!
 Copyright (c) Peculiar Ventures, LLC
*/function hh(r,e){let t=0;if(r.length===1)return r[0];for(let n=r.length-1;n>=0;n--)t+=r[r.length-1-n]*Math.pow(2,e*n);return t}function nu(r,e,t=-1){const n=t;let i=r,s=0,o=Math.pow(2,e);for(let a=1;a<8;a++){if(r<o){let c;if(n<0)c=new ArrayBuffer(a),s=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),s=n}const l=new Uint8Array(c);for(let d=a-1;d>=0;d--){const h=Math.pow(2,d*e);l[s-d-1]=Math.floor(i/h),i-=l[s-d-1]*h}return c}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function kE(...r){let e=0,t=0;for(const s of r)e+=s.length;const n=new ArrayBuffer(e),i=new Uint8Array(n);for(const s of r)i.set(s,t),t+=s.length;return i}function fU(){const r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const a=r[0]===255&&r[1]&128,c=r[0]===0&&(r[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=r[0]&128;const n=hh(t,8),i=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(i);for(let a=0;a<this.valueHex.byteLength;a++)s[a]=r[a];return s[0]&=127,hh(s,8)-n}function h8e(r){const e=r<0?r*-1:r;let t=128;for(let n=1;n<8;n++){if(e<=t){if(r<0){const o=t-e,a=nu(o,8,n),c=new Uint8Array(a);return c[0]|=128,a}let i=nu(e,8,n),s=new Uint8Array(i);if(s[0]&128){const o=i.slice(0),a=new Uint8Array(o);i=new ArrayBuffer(i.byteLength+1),s=new Uint8Array(i);for(let c=0;c<o.byteLength;c++)s[c+1]=a[c];s[0]=0}return i}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function f8e(r,e){if(r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<t.length;i++)if(t[i]!==n[i])return!1;return!0}function ui(r,e){const t=r.toString(10);if(e<t.length)return"";const n=e-t.length,i=new Array(n);for(let o=0;o<n;o++)i[o]="0";return i.join("").concat(t)}/*!
* Copyright (c) 2014, GMO GlobalSign
* Copyright (c) 2015-2022, Peculiar Ventures
* All rights reserved.
* 
* Author 2014-2019, Yury Strozhevsky
* 
* Redistribution and use in source and binary forms, with or without modification,
* are permitted provided that the following conditions are met:
* 
* * Redistributions of source code must retain the above copyright notice, this
*   list of conditions and the following disclaimer.
* 
* * Redistributions in binary form must reproduce the above copyright notice, this
*   list of conditions and the following disclaimer in the documentation and/or
*   other materials provided with the distribution.
* 
* * Neither the name of the copyright holder nor the names of its
*   contributors may be used to endorse or promote products derived from
*   this software without specific prior written permission.
* 
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
* WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
* DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
* ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
* (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
* LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
* ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* 
*/function U3(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function _E(r){let e=0,t=0;for(let i=0;i<r.length;i++){const s=r[i];e+=s.byteLength}const n=new Uint8Array(e);for(let i=0;i<r.length;i++){const s=r[i];n.set(new Uint8Array(s),t),t+=s.byteLength}return n.buffer}function qo(r,e,t,n){return e instanceof Uint8Array?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class F3{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return _E(this.items)}}const bp=[new Uint8Array([1])],pU="0123456789",TE="name",gU="valueHexView",p8e="isHexOnly",g8e="idBlock",y8e="tagClass",m8e="tagNumber",w8e="isConstructed",b8e="fromBER",v8e="toBER",E8e="local",Tn="",us=new ArrayBuffer(0),z3=new Uint8Array(0),vp="EndOfContent",yU="OCTET STRING",mU="BIT STRING";function Ws(r){var e;return e=class extends r{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}constructor(...n){var i;super(...n);const s=n[0]||{};this.isHexOnly=(i=s.isHexOnly)!==null&&i!==void 0?i:!1,this.valueHexView=s.valueHex?he.toUint8Array(s.valueHex):z3}fromBER(n,i,s){const o=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!qo(this,o,i,s))return-1;const a=i+s;return this.valueHexView=o.subarray(i,a),this.valueHexView.length?(this.blockLength=s,a):(this.warnings.push("Zero buffer length"),i)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",us)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:xe.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class iu{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=Tn,warnings:n=[],valueBeforeDecode:i=z3}={}){this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=he.toUint8Array(i)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:xe.ToHex(this.valueBeforeDecodeView)}}}iu.NAME="baseBlock";class gn extends iu{fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}gn.NAME="valueBlock";class wU extends Ws(iu){constructor({idBlock:e={}}={}){var t,n,i,s;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?he.toUint8Array(e.valueHex):z3,this.tagClass=(n=e.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(i=e.tagNumber)!==null&&i!==void 0?i:-1,this.isConstructed=(s=e.isConstructed)!==null&&s!==void 0?s:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",us}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const i=new Uint8Array(1);if(!e){let s=this.tagNumber;s&=31,t|=s,i[0]=t}return i.buffer}if(!this.isHexOnly){const i=nu(this.tagNumber,7),s=new Uint8Array(i),o=i.byteLength,a=new Uint8Array(o+1);if(a[0]=t|31,!e){for(let c=0;c<o-1;c++)a[c+1]=s[c]|128;a[o]=s[o-1]}return a.buffer}const n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=t|31,!e){const i=this.valueHexView;for(let s=0;s<i.length-1;s++)n[s+1]=i[s]|128;n[this.valueHexView.byteLength]=i[i.length-1]}return n.buffer}fromBER(e,t,n){const i=he.toUint8Array(e);if(!qo(this,i,t,n))return-1;const s=i.subarray(t,t+n);if(s.length===0)return this.error="Zero buffer length",-1;switch(s[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(s[0]&32)===32,this.isHexOnly=!1;const a=s[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,l=this.valueHexView=new Uint8Array(255),d=255;for(;s[c]&128;){if(l[c-1]=s[c]&127,c++,c>=s.length)return this.error="End of input reached before message was fully decoded",-1;if(c===d){d+=255;const p=new Uint8Array(d);for(let b=0;b<l.length;b++)p[b]=l[b];l=this.valueHexView=new Uint8Array(d)}}this.blockLength=c+1,l[c-1]=s[c]&127;const h=new Uint8Array(c);for(let p=0;p<c;p++)h[p]=l[p];l=this.valueHexView=new Uint8Array(c),l.set(h),this.blockLength<=9?this.tagNumber=hh(l,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}wU.NAME="identificationBlock";class bU extends iu{constructor({lenBlock:e={}}={}){var t,n,i;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(n=e.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(i=e.length)!==null&&i!==void 0?i:0}fromBER(e,t,n){const i=he.toUint8Array(e);if(!qo(this,i,t,n))return-1;const s=i.subarray(t,t+n);if(s.length===0)return this.error="Zero buffer length",-1;if(s[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=s[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(s[0]&128),this.longFormUsed===!1)return this.length=s[0],this.blockLength=1,t+this.blockLength;const o=s[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>s.length)return this.error="End of input reached before message was fully decoded",-1;const a=t+1,c=i.subarray(a,a+o);return c[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=hh(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(e=!1){let t,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=128),t;if(this.longFormUsed){const i=nu(this.length,8);if(i.byteLength>127)return this.error="Too big length",us;if(t=new ArrayBuffer(i.byteLength+1),e)return t;const s=new Uint8Array(i);n=new Uint8Array(t),n[0]=i.byteLength|128;for(let o=0;o<i.byteLength;o++)n[o+1]=s[o];return t}return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}bU.NAME="lengthBlock";const be={};class Cr extends iu{constructor({name:e=Tn,optional:t=!1,primitiveSchema:n,...i}={},s){super(i),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new wU(i),this.lenBlock=new bU(i),this.valueBlock=s?new s(i):new gn(i)}fromBER(e,t,n){const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}toBER(e,t){const n=t||new F3;t||vU(this);const i=this.idBlock.toBER(e);if(n.write(i),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{const s=this.valueBlock.toBER(e);this.lenBlock.length=s.byteLength;const o=this.lenBlock.toBER(e);n.write(o),n.write(s)}return t?us:n.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():xe.ToHex(this.toBER())}onAsciiEncoding(){const e=this.constructor.NAME,t=xe.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),n=e.toBER();return f8e(t,n)}}Cr.NAME="BaseBlock";function vU(r){var e;if(r instanceof be.Constructed)for(const t of r.valueBlock.value)vU(t)&&(r.lenBlock.isIndefiniteForm=!0);return!!(!((e=r.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}class PE extends Cr{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=Tn,...t}={},n){super(t,n),e&&this.fromString(e)}fromBER(e,t,n){const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}PE.NAME="BaseStringBlock";class EU extends Ws(gn){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}EU.NAME="PrimitiveValueBlock";var SU;class Ep extends Cr{constructor(e={}){super(e,EU),this.idBlock.isConstructed=!1}}SU=Ep,be.Primitive=SU,Ep.NAME="PRIMITIVE";function S8e(r,e){if(r instanceof e)return r;const t=new e;return t.idBlock=r.idBlock,t.lenBlock=r.lenBlock,t.warnings=r.warnings,t.valueBeforeDecodeView=r.valueBeforeDecodeView,t}function fh(r,e=0,t=r.length){const n=e;let i=new Cr({},gn);const s=new iu;if(!qo(s,r,e,t))return i.error=s.error,{offset:-1,result:i};if(!r.subarray(e,e+t).length)return i.error="Zero buffer length",{offset:-1,result:i};let a=i.idBlock.fromBER(r,e,t);if(i.idBlock.warnings.length&&i.warnings.concat(i.idBlock.warnings),a===-1)return i.error=i.idBlock.error,{offset:-1,result:i};if(e=a,t-=i.idBlock.blockLength,a=i.lenBlock.fromBER(r,e,t),i.lenBlock.warnings.length&&i.warnings.concat(i.lenBlock.warnings),a===-1)return i.error=i.lenBlock.error,{offset:-1,result:i};if(e=a,t-=i.lenBlock.blockLength,!i.idBlock.isConstructed&&i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};let c=Cr;switch(i.idBlock.tagClass){case 1:if(i.idBlock.tagNumber>=37&&i.idBlock.isHexOnly===!1)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};c=be.EndOfContent;break;case 1:c=be.Boolean;break;case 2:c=be.Integer;break;case 3:c=be.BitString;break;case 4:c=be.OctetString;break;case 5:c=be.Null;break;case 6:c=be.ObjectIdentifier;break;case 10:c=be.Enumerated;break;case 12:c=be.Utf8String;break;case 13:c=be.RelativeObjectIdentifier;break;case 14:c=be.TIME;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:c=be.Sequence;break;case 17:c=be.Set;break;case 18:c=be.NumericString;break;case 19:c=be.PrintableString;break;case 20:c=be.TeletexString;break;case 21:c=be.VideotexString;break;case 22:c=be.IA5String;break;case 23:c=be.UTCTime;break;case 24:c=be.GeneralizedTime;break;case 25:c=be.GraphicString;break;case 26:c=be.VisibleString;break;case 27:c=be.GeneralString;break;case 28:c=be.UniversalString;break;case 29:c=be.CharacterString;break;case 30:c=be.BmpString;break;case 31:c=be.DATE;break;case 32:c=be.TimeOfDay;break;case 33:c=be.DateTime;break;case 34:c=be.Duration;break;default:{const l=i.idBlock.isConstructed?new be.Constructed:new be.Primitive;l.idBlock=i.idBlock,l.lenBlock=i.lenBlock,l.warnings=i.warnings,i=l}}break;case 2:case 3:case 4:default:c=i.idBlock.isConstructed?be.Constructed:be.Primitive}return i=S8e(i,c),a=i.fromBER(r,e,i.lenBlock.isIndefiniteForm?t:i.lenBlock.length),i.valueBeforeDecodeView=r.subarray(n,n+i.blockLength),{offset:a,result:i}}function Wo(r){if(!r.byteLength){const e=new Cr({},gn);return e.error="Input buffer has zero length",{offset:-1,result:e}}return fh(he.toUint8Array(r).slice(),0,r.byteLength)}function x8e(r,e){return r?1:e}class Mc extends gn{constructor({value:e=[],isIndefiniteForm:t=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){const i=he.toUint8Array(e);if(!qo(this,i,t,n))return-1;if(this.valueBeforeDecodeView=i.subarray(t,t+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let s=t;for(;x8e(this.isIndefiniteForm,n)>0;){const o=fh(i,s,n);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(s=o.offset,this.blockLength+=o.result.blockLength,n-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===vp)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===vp?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}toBER(e,t){const n=t||new F3;for(let i=0;i<this.value.length;i++)this.value[i].toBER(e,n);return t?us:n.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}Mc.NAME="ConstructedValueBlock";var xU;class Pn extends Cr{constructor(e={}){super(e,Mc),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){const e=[];for(const n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(i=>`  ${i}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}xU=Pn,be.Constructed=xU,Pn.NAME="CONSTRUCTED";class AU extends gn{fromBER(e,t,n){return t}toBER(e){return us}}AU.override="EndOfContentValueBlock";var CU;class DE extends Cr{constructor(e={}){super(e,AU),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}CU=DE,be.EndOfContent=CU,DE.NAME=vp;var IU;class Go extends Cr{constructor(e={}){super(e,gn),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){const n=new ArrayBuffer(2);if(!e){const i=new Uint8Array(n);i[0]=5,i[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}}IU=Go,be.Null=IU,Go.NAME="NULL";class kU extends Ws(gn){get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=he.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,n){const i=he.toUint8Array(e);return qo(this,i,t,n)?(this.valueHexView=i.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,fU.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}kU.NAME="BooleanValueBlock";var _U;let V3=class extends Cr{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,kU),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};_U=V3,be.Boolean=_U,V3.NAME="BOOLEAN";class TU extends Ws(Mc){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,n){let i=0;if(this.isConstructed){if(this.isHexOnly=!1,i=Mc.prototype.fromBER.call(this,e,t,n),i===-1)return i;for(let s=0;s<this.value.length;s++){const o=this.value[s].constructor.NAME;if(o===vp){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==yU)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,i=super.fromBER(e,t,n),this.blockLength=n;return i}toBER(e,t){return this.isConstructed?Mc.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}TU.NAME="OctetStringValueBlock";var $E;let ds=class extends Cr{constructor({idBlock:e={},lenBlock:t={},...n}={}){var i,s;(i=n.isConstructed)!==null&&i!==void 0||(n.isConstructed=!!(!((s=n.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},TU),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const s=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(s.byteLength){const o=fh(s,0,s.byteLength);o.offset!==-1&&o.offset===n&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Pn.prototype.onAsciiEncoding.call(this);const e=this.constructor.NAME,t=xe.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof $E&&e.push(t.valueBlock.valueHexView);return he.concat(e)}};$E=ds,be.OctetString=$E,ds.NAME=yU;class PU extends Ws(Mc){constructor({unusedBits:e=0,isConstructed:t=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let i=-1;if(this.isConstructed){if(i=Mc.prototype.fromBER.call(this,e,t,n),i===-1)return i;for(const a of this.value){const c=a.constructor.NAME;if(c===vp){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==mU)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const l=a.valueBlock;if(this.unusedBits>0&&l.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=l.unusedBits}return i}const s=he.toUint8Array(e);if(!qo(this,s,t,n))return-1;const o=s.subarray(t,t+n);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const a=o.subarray(1);try{if(a.byteLength){const c=fh(a,0,a.byteLength);c.offset!==-1&&c.offset===n-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+n}toBER(e,t){if(this.isConstructed)return Mc.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return us;const n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}PU.NAME="BitStringValueBlock";var DU;let su=class extends Cr{constructor({idBlock:e={},lenBlock:t={},...n}={}){var i,s;(i=n.isConstructed)!==null&&i!==void 0||(n.isConstructed=!!(!((s=n.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},PU),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Pn.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const o of t)e.push(o.toString(2).padStart(8,"0"));const n=e.join(""),i=this.constructor.NAME,s=n.substring(0,n.length-this.valueBlock.unusedBits);return`${i} : ${s}`}}};DU=su,be.BitString=DU,su.NAME=mU;var $U;function A8e(r,e){const t=new Uint8Array([0]),n=new Uint8Array(r),i=new Uint8Array(e);let s=n.slice(0);const o=s.length-1,a=i.slice(0),c=a.length-1;let l=0;const d=c<o?o:c;let h=0;for(let p=d;p>=0;p--,h++){switch(!0){case h<a.length:l=s[o-h]+a[c-h]+t[0];break;default:l=s[o-h]+t[0]}switch(t[0]=l/10,!0){case h>=s.length:s=kE(new Uint8Array([l%10]),s);break;default:s[o-h]=l%10}}return t[0]>0&&(s=kE(t,s)),s}function NU(r){if(r>=bp.length)for(let e=bp.length;e<=r;e++){const t=new Uint8Array([0]);let n=bp[e-1].slice(0);for(let i=n.length-1;i>=0;i--){const s=new Uint8Array([(n[i]<<1)+t[0]]);t[0]=s[0]/10,n[i]=s[0]%10}t[0]>0&&(n=kE(t,n)),bp.push(n)}return bp[r]}function C8e(r,e){let t=0;const n=new Uint8Array(r),i=new Uint8Array(e),s=n.slice(0),o=s.length-1,a=i.slice(0),c=a.length-1;let l,d=0;for(let h=c;h>=0;h--,d++)switch(l=s[o-d]-a[c-d]-t,!0){case l<0:t=1,s[o-d]=l+10;break;default:t=0,s[o-d]=l}if(t>0)for(let h=o-c+1;h>=0;h--,d++)if(l=s[o-d]-t,l<0)t=1,s[o-d]=l+10;else{t=0,s[o-d]=l;break}return s.slice()}class NE extends Ws(gn){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=fU.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(h8e(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,i=0){const s=this.fromBER(e,t,n);if(s===-1)return s;const o=this.valueHexView;return o[0]===0&&o[1]&128?this.valueHexView=o.subarray(1):i!==0&&o.length<i&&(i-o.length>1&&(i=o.length+1),this.valueHexView=o.subarray(i-o.length)),s}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(t,1),this.valueHexView=n}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,n){const i=super.fromBER(e,t,n);return i===-1||this.setValueHex(),i}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),n=0,i;const s=this.valueHexView;let o="",a=!1;for(let c=s.byteLength-1;c>=0;c--){i=s[c];for(let l=0;l<8;l++){if((i&1)===1)switch(n){case e:t=C8e(NU(n),t),o="-";break;default:t=A8e(t,NU(n))}n++,i>>=1}}for(let c=0;c<t.length;c++)t[c]&&(a=!0),a&&(o+=pU.charAt(t[c]));return a===!1&&(o+=pU.charAt(0)),o}}$U=NE,NE.NAME="IntegerValueBlock",Object.defineProperty($U.prototype,"valueHex",{set:function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var Sp;class Qo extends Cr{constructor(e={}){super(e,NE),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return U3(),BigInt(this.valueBlock.toString())}static fromBigInt(e){U3();const t=BigInt(e),n=new F3,i=t.toString(16).replace(/^-/,""),s=new Uint8Array(xe.FromHex(i));if(t<0){const a=new Uint8Array(s.length+(s[0]&128?1:0));a[0]|=128;const l=BigInt(`0x${xe.ToHex(a)}`)+t,d=he.toUint8Array(xe.FromHex(l.toString(16)));d[0]|=128,n.write(d)}else s[0]&128&&n.write(new Uint8Array([0])),n.write(s);return new Sp({valueHex:n.final()})}convertToDER(){const e=new Sp({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new Sp({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}Sp=Qo,be.Integer=Sp,Qo.NAME="INTEGER";var MU;class K3 extends Qo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}MU=K3,be.Enumerated=MU,K3.NAME="ENUMERATED";class ME extends Ws(gn){constructor({valueDec:e=-1,isFirstSid:t=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;const i=he.toUint8Array(e);if(!qo(this,i,t,n))return-1;const s=i.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=s[a]&127,this.blockLength++,!!(s[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,s[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=hh(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){U3();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const n=new Uint8Array(t.length/7);for(let i=0;i<n.length;i++)n[i]=parseInt(t.slice(i*7,i*7+7),2)+(i+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=i[o]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}const t=nu(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",us;const n=new Uint8Array(t.byteLength);if(!e){const i=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)n[o]=i[o]|128;n[s]=i[s]}return n}toString(){let e="";if(this.isHexOnly)e=xe.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}ME.NAME="sidBlock";class OU extends gn{constructor({value:e=Tn,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let i=t;for(;n>0;){const s=new ME;if(i=s.fromBER(e,i,n),i===-1)return this.blockLength=0,this.error=s.error,i;this.value.length===0&&(s.isFirstSid=!0),this.blockLength+=s.blockLength,n-=s.blockLength,this.value.push(s)}return i}toBER(e){const t=[];for(let n=0;n<this.value.length;n++){const i=this.value[n].toBER(e);if(i.byteLength===0)return this.error=this.value[n].error,us;t.push(i)}return _E(t)}fromString(e){this.value=[];let t=0,n=0,i="",s=!1;do if(n=e.indexOf(".",t),n===-1?i=e.substring(t):i=e.substring(t,n),t=n+1,s){const o=this.value[0];let a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}const c=parseInt(i,10);if(isNaN(c))return;o.valueDec=c+a,s=!1}else{const o=new ME;if(i>Number.MAX_SAFE_INTEGER){U3();const a=BigInt(i);o.valueBigInt=a}else if(o.valueDec=parseInt(i,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,s=!0),this.value.push(o)}while(n!==-1)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let i=this.value[n].toString();n!==0&&(e=`${e}.`),t?(i=`{${i}}`,this.value[n].isFirstSid?e=`2.{${i} - 80}`:e+=i):e+=i}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}OU.NAME="ObjectIdentifierValueBlock";var RU;class Jo extends Cr{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,OU),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}RU=Jo,be.ObjectIdentifier=RU,Jo.NAME="OBJECT IDENTIFIER";class OE extends Ws(iu){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,n){if(n===0)return t;const i=he.toUint8Array(e);if(!qo(this,i,t,n))return-1;const s=i.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=s[a]&127,this.blockLength++,!!(s[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,s[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=hh(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=i[o]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}const t=nu(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",us;const n=new Uint8Array(t.byteLength);if(!e){const i=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)n[o]=i[o]|128;n[s]=i[s]}return n.buffer}toString(){let e="";return this.isHexOnly?e=xe.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}OE.NAME="relativeSidBlock";class LU extends gn{constructor({value:e=Tn,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let i=t;for(;n>0;){const s=new OE;if(i=s.fromBER(e,i,n),i===-1)return this.blockLength=0,this.error=s.error,i;this.blockLength+=s.blockLength,n-=s.blockLength,this.value.push(s)}return i}toBER(e,t){const n=[];for(let i=0;i<this.value.length;i++){const s=this.value[i].toBER(e);if(s.byteLength===0)return this.error=this.value[i].error,us;n.push(s)}return _E(n)}fromString(e){this.value=[];let t=0,n=0,i="";do{n=e.indexOf(".",t),n===-1?i=e.substring(t):i=e.substring(t,n),t=n+1;const s=new OE;if(s.valueDec=parseInt(i,10),isNaN(s.valueDec))return!0;this.value.push(s)}while(n!==-1);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let i=this.value[n].toString();n!==0&&(e=`${e}.`),t&&(i=`{${i}}`),e+=i}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}LU.NAME="RelativeObjectIdentifierValueBlock";var BU;class RE extends Cr{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,LU),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}BU=RE,be.RelativeObjectIdentifier=BU,RE.NAME="RelativeObjectIdentifier";var UU;class yr extends Pn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}UU=yr,be.Sequence=UU,yr.NAME="SEQUENCE";var FU;let Yo=class extends Pn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};FU=Yo,be.Set=FU,Yo.NAME="SET";class zU extends Ws(gn){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=Tn}toJSON(){return{...super.toJSON(),value:this.value}}}zU.NAME="StringValueBlock";class VU extends zU{}VU.NAME="SimpleStringValueBlock";class di extends PE{constructor({...e}={}){super(e,VU)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,he.toUint8Array(e))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);this.valueBlock.value=e}}di.NAME="SIMPLE STRING";class KU extends di{fromBuffer(e){this.valueBlock.valueHexView=he.toUint8Array(e);try{this.valueBlock.value=xe.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=xe.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(xe.FromUtf8String(e)),this.valueBlock.value=e}}KU.NAME="Utf8StringValueBlock";var jU;class Xo extends KU{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}jU=Xo,be.Utf8String=jU,Xo.NAME="UTF8String";class HU extends di{fromBuffer(e){this.valueBlock.value=xe.ToUtf16String(e),this.valueBlock.valueHexView=he.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(xe.FromUtf16String(e))}}HU.NAME="BmpStringValueBlock";var qU;class j3 extends HU{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}qU=j3,be.BmpString=qU,j3.NAME="BMPString";class WU extends di{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let i=0;i<n.length;i+=4)n[i]=n[i+3],n[i+1]=n[i+2],n[i+2]=0,n[i+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let i=0;i<t;i++){const s=nu(e.charCodeAt(i),8),o=new Uint8Array(s);if(o.length>4)continue;const a=4-o.length;for(let c=o.length-1;c>=0;c--)n[i*4+c+a]=o[c]}this.valueBlock.value=e}}WU.NAME="UniversalStringValueBlock";var GU;class H3 extends WU{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}GU=H3,be.UniversalString=GU,H3.NAME="UniversalString";var QU;class q3 extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}QU=q3,be.NumericString=QU,q3.NAME="NumericString";var JU;class W3 extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}JU=W3,be.PrintableString=JU,W3.NAME="PrintableString";var YU;class G3 extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}YU=G3,be.TeletexString=YU,G3.NAME="TeletexString";var XU;class Q3 extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}XU=Q3,be.VideotexString=XU,Q3.NAME="VideotexString";var ZU;class J3 extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}ZU=J3,be.IA5String=ZU,J3.NAME="IA5String";var eF;class Y3 extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}eF=Y3,be.GraphicString=eF,Y3.NAME="GraphicString";var tF;class xp extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}tF=xp,be.VisibleString=tF,xp.NAME="VisibleString";var rF;class X3 extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}rF=X3,be.GeneralString=rF,X3.NAME="GeneralString";var nF;class Z3 extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}nF=Z3,be.CharacterString=nF,Z3.NAME="CharacterString";var iF;class Ap extends xp{constructor({value:e,valueDate:t,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let i=0;i<e.length;i++)this.valueBlock.valueHexView[i]=e.charCodeAt(i)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,he.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}const i=parseInt(n[1],10);i>=50?this.year=1900+i:this.year=2e3+i,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=ui(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=ui(this.month,2),t[2]=ui(this.day,2),t[3]=ui(this.hour,2),t[4]=ui(this.minute,2),t[5]=ui(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}iF=Ap,be.UTCTime=iF,Ap.NAME="UTCTime";var sF;class ew extends Ap{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){const e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,n="",i="",s=0,o,a=0,c=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),t=!0;else{const h=new Number(e[e.length-1]);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(t){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let h=1,p=n.indexOf("+"),b="";if(p===-1&&(p=n.indexOf("-"),h=-1),p!==-1){if(b=n.substring(p+1),n=n.substring(0,p),b.length!==2&&b.length!==4)throw new Error("Wrong input string for conversion");let f=parseInt(b.substring(0,2),10);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");if(a=h*f,b.length===4){if(f=parseInt(b.substring(2,4),10),isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");c=h*f}}}let l=n.indexOf(".");if(l===-1&&(l=n.indexOf(",")),l!==-1){const h=new Number(`0${n.substring(l)}`);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");s=h.valueOf(),i=n.substring(0,l)}else i=n;switch(!0){case i.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,l!==-1)throw new Error("Wrong input string for conversion");break;case i.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let h=60*s;this.minute=Math.floor(h),h=60*(h-this.minute),this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case i.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let h=60*s;this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case i.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){const h=1e3*s;this.millisecond=Math.floor(h)}break;default:throw new Error("Wrong input string for conversion")}const d=o.exec(i);if(d===null)throw new Error("Wrong input string for conversion");for(let h=1;h<d.length;h++)switch(h){case 1:this.year=parseInt(d[h],10);break;case 2:this.month=parseInt(d[h],10);break;case 3:this.day=parseInt(d[h],10);break;case 4:this.hour=parseInt(d[h],10)+a;break;case 5:this.minute=parseInt(d[h],10)+c;break;case 6:this.second=parseInt(d[h],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const h=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=h.getUTCFullYear(),this.month=h.getUTCMonth(),this.day=h.getUTCDay(),this.hour=h.getUTCHours(),this.minute=h.getUTCMinutes(),this.second=h.getUTCSeconds(),this.millisecond=h.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push(ui(this.year,4)),t.push(ui(this.month,2)),t.push(ui(this.day,2)),t.push(ui(this.hour,2)),t.push(ui(this.minute,2)),t.push(ui(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(ui(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}sF=ew,be.GeneralizedTime=sF,ew.NAME="GeneralizedTime";var oF;class LE extends Xo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}oF=LE,be.DATE=oF,LE.NAME="DATE";var aF;class BE extends Xo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}aF=BE,be.TimeOfDay=aF,BE.NAME="TimeOfDay";var cF;class UE extends Xo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}cF=UE,be.DateTime=cF,UE.NAME="DateTime";var lF;class FE extends Xo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}lF=FE,be.Duration=lF,FE.NAME="Duration";var uF;class zE extends Xo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}uF=zE,be.TIME=uF,zE.NAME="TIME";class ou{constructor({name:e=Tn,optional:t=!1}={}){this.name=e,this.optional=t}}class VE extends ou{constructor({value:e=[],...t}={}){super(t),this.value=e}}class tw extends ou{constructor({value:e=new ou,local:t=!1,...n}={}){super(n),this.value=e,this.local=t}}class I8e{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=he.toUint8Array(e)}constructor({data:e=z3}={}){this.dataView=he.toUint8Array(e)}fromBER(e,t,n){const i=t+n;return this.dataView=he.toUint8Array(e).subarray(t,i),i}toBER(e){return this.dataView.slice().buffer}}function au(r,e,t){if(t instanceof VE){for(const s of t.value)if(au(r,e,s).verified)return{verified:!0,result:r};{const s={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(TE)&&(s.name=t.name),s}}if(t instanceof ou)return t.hasOwnProperty(TE)&&(r[t.name]=e),{verified:!0,result:r};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(g8e in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(b8e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(v8e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const n=t.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(y8e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(m8e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(w8e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:r};if(!(p8e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:r};if(t.idBlock.isHexOnly){if(!(gU in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const s=t.idBlock.valueHexView,o=e.idBlock.valueHexView;if(s.length!==o.length)return{verified:!1,result:r};for(let a=0;a<s.length;a++)if(s[a]!==o[1])return{verified:!1,result:r}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Tn),t.name&&(r[t.name]=e)),t instanceof be.Constructed){let s=0,o={verified:!1,result:{error:"Unknown error"}},a=t.valueBlock.value.length;if(a>0&&t.valueBlock.value[0]instanceof tw&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:r};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let c=!0;for(let l=0;l<t.valueBlock.value.length;l++)c=c&&(t.valueBlock.value[l].optional||!1);return c?{verified:!0,result:r}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Tn),t.name&&delete r[t.name]),r.error="Inconsistent object length",{verified:!1,result:r})}for(let c=0;c<a;c++)if(c-s>=e.valueBlock.value.length){if(t.valueBlock.value[c].optional===!1){const l={verified:!1,result:r};return r.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Tn),t.name&&(delete r[t.name],l.name=t.name)),l}}else if(t.valueBlock.value[0]instanceof tw){if(o=au(r,e.valueBlock.value[c],t.valueBlock.value[0].value),o.verified===!1)if(t.valueBlock.value[0].optional)s++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Tn),t.name&&delete r[t.name]),o;if(TE in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let l={};E8e in t.valueBlock.value[0]&&t.valueBlock.value[0].local?l=e:l=r,typeof l[t.valueBlock.value[0].name]>"u"&&(l[t.valueBlock.value[0].name]=[]),l[t.valueBlock.value[0].name].push(e.valueBlock.value[c])}}else if(o=au(r,e.valueBlock.value[c-s],t.valueBlock.value[c]),o.verified===!1)if(t.valueBlock.value[c].optional)s++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Tn),t.name&&delete r[t.name]),o;if(o.verified===!1){const c={verified:!1,result:r};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Tn),t.name&&(delete r[t.name],c.name=t.name)),c}return{verified:!0,result:r}}if(t.primitiveSchema&&gU in e.valueBlock){const s=fh(e.valueBlock.valueHexView);if(s.offset===-1){const o={verified:!1,result:s.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Tn),t.name&&(delete r[t.name],o.name=t.name)),o}return au(r,s.result,t.primitiveSchema)}return{verified:!0,result:r}}function k8e(r,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};const t=fh(he.toUint8Array(r));return t.offset===-1?{verified:!1,result:t.result}:au(t.result,t.result,e)}const dF=Object.freeze(Object.defineProperty({__proto__:null,Any:ou,BaseBlock:Cr,BaseStringBlock:PE,BitString:su,BmpString:j3,Boolean:V3,CharacterString:Z3,Choice:VE,Constructed:Pn,DATE:LE,DateTime:UE,Duration:FE,EndOfContent:DE,Enumerated:K3,GeneralString:X3,GeneralizedTime:ew,GraphicString:Y3,HexBlock:Ws,IA5String:J3,Integer:Qo,Null:Go,NumericString:q3,ObjectIdentifier:Jo,OctetString:ds,Primitive:Ep,PrintableString:W3,RawData:I8e,RelativeObjectIdentifier:RE,Repeated:tw,Sequence:yr,Set:Yo,TIME:zE,TeletexString:G3,TimeOfDay:BE,UTCTime:Ap,UniversalString:H3,Utf8String:Xo,ValueBlock:gn,VideotexString:Q3,ViewWriter:F3,VisibleString:xp,compareSchema:au,fromBER:Wo,verifySchema:k8e},Symbol.toStringTag,{value:"Module"})),hF=B3({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});B3({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),B3({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),B3({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const _8e=16,KE=32,jE=1e4;async function rw(r,e){const n=await uU().encrypt(r,e);return hF.encode(n)}async function fF(r,e,t){if(r.type==="RSA")return $8e(r,e,t);if(r.type==="Ed25519")return T8e(r,e,t);if(r.type==="secp256k1")return P8e(r,e,t);if(r.type==="ECDSA")return D8e(r,e,t);throw new $l}async function T8e(r,e,t="libp2p-key"){if(t==="libp2p-key")return rw($1(r),e);throw new Z(`export format '${t}' is not supported`)}async function P8e(r,e,t="libp2p-key"){if(t==="libp2p-key")return rw($1(r),e);throw new Z("Export format is not supported")}async function D8e(r,e,t="libp2p-key"){if(t==="libp2p-key")return rw($1(r),e);throw new Z(`export format '${t}' is not supported`)}async function $8e(r,e,t="pkcs-8"){if(t==="pkcs-8")return N8e(r,e);if(t==="libp2p-key")return rw($1(r),e);throw new Z("Export format is not supported")}async function N8e(r,e){const t=Bs.get(),i=new yr({value:[new Qo({value:0}),new yr({value:[new Jo({value:"1.2.840.113549.1.1.1"}),new Go]}),new ds({valueHex:r.raw})]}).toBER(),s=new Uint8Array(i,0,i.byteLength),o=sc(_8e),a=await rN(t7,e,o,{c:jE,dkLen:KE}),c=sc(16),l=await t.subtle.importKey("raw",a,"AES-CBC",!1,["encrypt"]),d=await t.subtle.encrypt({name:"AES-CBC",iv:c},l,s),h=new yr({value:[new ds({valueHex:o}),new Qo({value:jE}),new Qo({value:KE}),new yr({value:[new Jo({value:"1.2.840.113549.2.11"}),new Go]})]}),p=new yr({value:[new Jo({value:"1.2.840.113549.1.5.13"}),new yr({value:[new yr({value:[new Jo({value:"1.2.840.113549.1.5.12"}),h]}),new yr({value:[new Jo({value:"2.16.840.1.101.3.4.1.42"}),new ds({valueHex:c})]})]})]}),f=new yr({value:[p,new ds({valueHex:d})]}).toBER(),g=new Uint8Array(f,0,f.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...re(g,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join(`
`)}async function pF(r,e){try{const t=await M8e(r,e);return vie(t)}catch{}if(!r.includes("BEGIN"))throw new Z("Encrypted key was not a libp2p-key or a PEM file");return O8e(r,e)}async function M8e(r,e){const t=hF.decode(r);return uU().decrypt(t,e)}async function O8e(r,e){const t=Bs.get();let n;if(r.includes("-----BEGIN ENCRYPTED PRIVATE KEY-----")){const s=oe(r.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:o}=Wo(s),{iv:a,salt:c,iterations:l,keySize:d,cipherText:h}=R8e(o),p=await rN(t7,e,c,{c:l,dkLen:d}),b=await t.subtle.importKey("raw",p,"AES-CBC",!1,["decrypt"]),f=Cp(await t.subtle.decrypt({name:"AES-CBC",iv:a},b,h)),{result:g}=Wo(f);n=gF(g)}else if(r.includes("-----BEGIN PRIVATE KEY-----")){const s=oe(r.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:o}=Wo(s);n=gF(o)}else throw new Z("Could not parse private key from PEM data");const i=Nv(n);if(i.type!=="RSA")throw new Z("Could not parse RSA private key from PEM data");return i}function R8e(r){const e=r.valueBlock.value[0];if(e.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.13")throw new Z("Only pkcs5PBES2 encrypted private keys are supported");const n=e.valueBlock.value[1].valueBlock.value[0];if(n.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.12")throw new Z("Only pkcs5PBKDF2 key derivation functions are supported");const s=n.valueBlock.value[1],o=Cp(s.valueBlock.value[0].getValue());let a=jE,c=KE;if(s.valueBlock.value.length===3)a=Number(s.valueBlock.value[1].toBigInt()),c=Number(s.valueBlock.value[2].toBigInt());else if(s.valueBlock.value.length===2)throw new Z("Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key");const l=e.valueBlock.value[1].valueBlock.value[1],d=l.valueBlock.value[0].toString();if(d!=="OBJECT IDENTIFIER : 1.2.840.113549.3.7"){if(d!=="OBJECT IDENTIFIER : 1.3.14.3.2.7"){if(d!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2"){if(d!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22"){if(d!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42")throw new Z("Only AES-CBC encryption schemes are supported")}}}}const h=Cp(l.valueBlock.value[1].getValue());return{cipherText:Cp(r.valueBlock.value[1].getValue()),salt:o,iterations:a,keySize:c,iv:h}}function gF(r){return Cp(r.valueBlock.value[2].getValue())}function Cp(r){return new Uint8Array(r,0,r.byteLength)}const L8e="/pkcs8/",HE="/info/",Ip=new WeakMap,cu={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},qE={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function ph(r){return r==null||typeof r!="string"?!1:r===o8e(r.trim())&&r.length>0}async function Ir(){const t=Math.random()*800+200;await new Promise(n=>setTimeout(n,t))}function lu(r){return new At(L8e+r)}function gh(r){return new At(HE+r)}async function B8e(r){const e=$1(r),t=await K5e.digest(e);return S5e.encode(t.bytes).substring(1)}gH=Symbol.toStringTag,pH=dr;class U8e{constructor(e,t){u(this,"components");u(this,"init");u(this,"log");u(this,"self");u(this,gH,"@libp2p/keychain");u(this,pH,["@libp2p/keychain"]);var i,s,o,a,c,l,d,h,p,b;if(this.components=e,this.log=e.logger.forComponent("libp2p:keychain"),this.init=xE(qE,t),this.self=t.selfKey??"self",this.init.pass!=null&&((i=this.init.pass)==null?void 0:i.length)<20)throw new Error("pass must be least 20 characters");if(((s=this.init.dek)==null?void 0:s.keyLength)!=null&&this.init.dek.keyLength<cu.minKeyLength)throw new Error(`dek.keyLength must be least ${cu.minKeyLength} bytes`);if(((a=(o=this.init.dek)==null?void 0:o.salt)==null?void 0:a.length)!=null&&this.init.dek.salt.length<cu.minSaltLength)throw new Error(`dek.saltLength must be least ${cu.minSaltLength} bytes`);if(((c=this.init.dek)==null?void 0:c.iterationCount)!=null&&this.init.dek.iterationCount<cu.minIterationCount)throw new Error(`dek.iterationCount must be least ${cu.minIterationCount}`);const n=this.init.pass!=null&&((l=this.init.dek)==null?void 0:l.salt)!=null?iN(this.init.pass,(d=this.init.dek)==null?void 0:d.salt,(h=this.init.dek)==null?void 0:h.iterationCount,(p=this.init.dek)==null?void 0:p.keyLength,(b=this.init.dek)==null?void 0:b.hash):"";Ip.set(this,{dek:n})}static generateOptions(){const e=Object.assign({},qE),t=Math.ceil(cu.minSaltLength/3)*3;return e.dek.salt=re(sc(t),"base64"),e}static get options(){return qE}async findKeyByName(e){if(!ph(e))throw await Ir(),new Z(`Invalid key name '${e}'`);const t=gh(e);try{const n=await this.components.datastore.get(t);return JSON.parse(re(n))}catch(n){throw await Ir(),this.log.error(n),new Zt(`Key '${e}' does not exist.`)}}async findKeyById(e){try{const t={prefix:HE};for await(const n of this.components.datastore.query(t)){const i=JSON.parse(re(n.value));if(i.id===e)return i}throw new Z(`Key with id '${e}' does not exist.`)}catch(t){throw await Ir(),t}}async importKey(e,t){if(!ph(e))throw await Ir(),new Z(`Invalid key name '${e}'`);if(t==null)throw await Ir(),new Z("Key is required");const n=lu(e);if(await this.components.datastore.has(n))throw await Ir(),new Z(`Key '${e}' already exists`);let s,o;try{s=await B8e(t);const l=Ip.get(this);if(l==null)throw new Z("dek missing");const d=l.dek;o=await fF(t,d,t.type==="RSA"?"pkcs-8":"libp2p-key")}catch(l){throw await Ir(),l}const a={name:e,id:s},c=this.components.datastore.batch();return c.put(n,oe(o)),c.put(gh(e),oe(JSON.stringify(a))),await c.commit(),a}async exportKey(e){if(!ph(e))throw await Ir(),new Z(`Invalid key name '${e}'`);const t=lu(e);try{const n=await this.components.datastore.get(t),i=re(n),s=Ip.get(this);if(s==null)throw new Z("dek missing");const o=s.dek;return await pF(i,o)}catch(n){throw await Ir(),n}}async removeKey(e){if(!ph(e)||e===this.self)throw await Ir(),new Z(`Invalid key name '${e}'`);const t=lu(e),n=await this.findKeyByName(e),i=this.components.datastore.batch();return i.delete(t),i.delete(gh(e)),await i.commit(),n}async listKeys(){const e={prefix:HE},t=[];for await(const n of this.components.datastore.query(e))t.push(JSON.parse(re(n.value)));return t}async renameKey(e,t){if(!ph(e)||e===this.self)throw await Ir(),new Z(`Invalid old key name '${e}'`);if(!ph(t)||t===this.self)throw await Ir(),new Z(`Invalid new key name '${t}'`);const n=lu(e),i=lu(t),s=gh(e),o=gh(t);if(await this.components.datastore.has(i))throw await Ir(),new Z(`Key '${t}' already exists`);try{const c=await this.components.datastore.get(n),l=await this.components.datastore.get(s),d=JSON.parse(re(l));d.name=t;const h=this.components.datastore.batch();return h.put(i,c),h.put(o,oe(JSON.stringify(d))),h.delete(n),h.delete(s),await h.commit(),d}catch(c){throw await Ir(),c}}async rotateKeychainPass(e,t){var a,c,l,d;if(typeof e!="string")throw await Ir(),new Z(`Invalid old pass type '${typeof e}'`);if(typeof t!="string")throw await Ir(),new Z(`Invalid new pass type '${typeof t}'`);if(t.length<20)throw await Ir(),new Z(`Invalid pass length ${t.length}`);this.log("recreating keychain");const n=Ip.get(this);if(n==null)throw new Z("dek missing");const i=n.dek;this.init.pass=t;const s=t!=null&&((a=this.init.dek)==null?void 0:a.salt)!=null?iN(t,this.init.dek.salt,(c=this.init.dek)==null?void 0:c.iterationCount,(l=this.init.dek)==null?void 0:l.keyLength,(d=this.init.dek)==null?void 0:d.hash):"";Ip.set(this,{dek:s});const o=await this.listKeys();for(const h of o){const p=await this.components.datastore.get(lu(h.name)),b=re(p),f=await pF(b,i),g=s.toString(),v=await fF(f,g,f.type==="RSA"?"pkcs-8":"libp2p-key"),y=this.components.datastore.batch(),w={name:h.name,id:h.id};y.put(lu(h.name),oe(v)),y.put(gh(h.name),oe(JSON.stringify(w))),await y.commit()}this.log("keychain reconstructed")}}function yF(r={}){return e=>new U8e(e,r)}class mF{constructor(e={}){u(this,"memoryStorage");u(this,"points");u(this,"duration");u(this,"blockDuration");u(this,"execEvenly");u(this,"execEvenlyMinDelayMs");u(this,"keyPrefix");this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??this.duration*1e3/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new F8e}async consume(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n);let o=this.memoryStorage.incrby(i,t,s);if(o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.consumedPoints>this.points)throw this.blockDuration>0&&o.consumedPoints<=this.points+t&&(o=this.memoryStorage.set(i,o.consumedPoints,this.blockDuration)),new Hie("Rate limit exceeded",o);if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let a=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));a<this.execEvenlyMinDelayMs&&(a=o.consumedPoints*this.execEvenlyMinDelayMs),await EB(a)}return o}penalty(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n),o=this.memoryStorage.incrby(i,t,s);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}reward(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n),o=this.memoryStorage.incrby(i,-t,s);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}block(e,t){const n=t*1e3,i=this.points+1;return this.memoryStorage.set(this.getKey(e),i,t),{remainingPoints:0,msBeforeNext:n===0?-1:n,consumedPoints:i,isFirstInDuration:!1}}set(e,t,n=0){const i=(n>=0?n:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,n),{remainingPoints:0,msBeforeNext:i===0?-1:i,consumedPoints:t,isFirstInDuration:!1}}get(e){const t=this.memoryStorage.get(this.getKey(e));return t!=null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return(e==null?void 0:e.customDuration)!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}}class F8e{constructor(){u(this,"storage");this.storage=new Map}incrby(e,t,n){const i=this.storage.get(e);if(i!=null){const s=i.expiresAt!=null?i.expiresAt.getTime()-new Date().getTime():-1;return i.expiresAt==null||s>0?(i.value+=t,{remainingPoints:0,msBeforeNext:s,consumedPoints:i.value,isFirstInDuration:!1}):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){const i=n*1e3,s=this.storage.get(e);s!=null&&clearTimeout(s.timeoutId);const o={value:t,expiresAt:i>0?new Date(Date.now()+i):void 0};return this.storage.set(e,o),i>0&&(o.timeoutId=setTimeout(()=>{this.storage.delete(e)},i),o.timeoutId.unref!=null&&o.timeoutId.unref()),{remainingPoints:0,msBeforeNext:i===0?-1:i,consumedPoints:o.value,isFirstInDuration:!0}}get(e){const t=this.storage.get(e);if(t!=null)return{remainingPoints:0,msBeforeNext:t.expiresAt!=null?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){const t=this.storage.get(e);return t!=null?(t.timeoutId!=null&&clearTimeout(t.timeoutId),this.storage.delete(e),!0):!1}}var ot;(function(r){r[r.NEW_STREAM=0]="NEW_STREAM",r[r.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",r[r.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",r[r.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",r[r.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",r[r.RESET_RECEIVER=5]="RESET_RECEIVER",r[r.RESET_INITIATOR=6]="RESET_INITIATOR"})(ot||(ot={}));const WE=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),wF=Object.freeze({NEW_STREAM:ot.NEW_STREAM,MESSAGE:ot.MESSAGE_INITIATOR,CLOSE:ot.CLOSE_INITIATOR,RESET:ot.RESET_INITIATOR}),z8e=Object.freeze({MESSAGE:ot.MESSAGE_RECEIVER,CLOSE:ot.CLOSE_RECEIVER,RESET:ot.RESET_RECEIVER}),bF=1<<20,V8e=4<<20;let K8e=class{constructor(e=bF,t=V8e){u(this,"_buffer");u(this,"_headerInfo");u(this,"_maxMessageSize");u(this,"_maxUnprocessedMessageQueueSize");this._buffer=new Ue,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw new St("Unprocessed message queue size too large!");const t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(l){if(l.name==="InvalidMessageError")throw l;break}const{id:n,type:i,length:s,offset:o}=this._headerInfo;if(this._buffer.length-o<s)break;const c={id:n,type:i};(i===ot.NEW_STREAM||i===ot.MESSAGE_INITIATOR||i===ot.MESSAGE_RECEIVER)&&(c.data=this._buffer.sublist(o,o+s)),t.push(c),this._buffer.consume(o+s),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:n}=EF(e),{value:i,offset:s}=EF(e,n),o=t&7;if(WE[o]==null)throw new Error(`Invalid type received: ${o}`);if(i>this._maxMessageSize)throw new St("Message size too large");return{id:t>>3,type:o,offset:n+s,length:i}}};const j8e=128,vF=127;function EF(r,e=0){let t=0,n=0,i=e,s;const o=r.length;do{if(i>=o||n>49)throw e=0,new RangeError("Could not decode varint");s=r.get(i++),t+=n<28?(s&vF)<<n:(s&vF)*Math.pow(2,n),n+=7}while(s>=j8e);return e=i-e,{value:t,offset:e}}const GE=10*1024;let H8e=class{constructor(){u(this,"_pool");u(this,"_poolOffset");this._pool=In(GE),this._poolOffset=0}write(e,t){const n=this._pool;let i=this._poolOffset;Sr(e.id<<3|e.type,n,i),i+=yt(e.id<<3|e.type),(e.type===ot.NEW_STREAM||e.type===ot.MESSAGE_INITIATOR||e.type===ot.MESSAGE_RECEIVER)&&e.data!=null?(Sr(e.data.length,n,i),i+=yt(e.data.length)):(Sr(0,n,i),i+=yt(0));const s=n.subarray(this._poolOffset,i);GE-i<100?(this._pool=In(GE),this._poolOffset=0):this._poolOffset=i,t.append(s),(e.type===ot.NEW_STREAM||e.type===ot.MESSAGE_INITIATOR||e.type===ot.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}};const q8e=new H8e;async function*W8e(r){for await(const e of r){const t=new Ue;q8e.write(e,t),yield t}}class G8e extends Error{constructor(e="Stream input buffer error"){super(e),this.name="StreamInputBufferError"}}class Q8e extends W9{constructor(t){super(t);u(this,"name");u(this,"streamId");u(this,"send");u(this,"types");u(this,"maxDataSize");this.types=t.direction==="outbound"?wF:z8e,this.send=t.send,this.name=t.name,this.streamId=t.streamId,this.maxDataSize=t.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:wF.NEW_STREAM,data:new Ue(oe(this.name))})}async sendData(t){for(t=t.sublist();t.byteLength>0;){const n=Math.min(t.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:t.sublist(0,n)}),t.consume(n)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}function J8e(r){const{id:e,name:t,send:n,onEnd:i,type:s="initiator",maxMsgSize:o=bF}=r;return new Q8e({id:s==="initiator"?`i${e}`:`r${e}`,streamId:e,name:`${t??e}`,direction:s==="initiator"?"outbound":"inbound",maxDataSize:o,onEnd:i,send:n,log:r.logger.forComponent(`libp2p:mplex:stream:${s}:${e}`)})}const Y8e=1024,X8e=1024,Z8e=1024*1024*4,e6e=5,t6e=500;function SF(r){const e={...r,type:`${WE[r.type]} (${r.type})`};return r.type===ot.NEW_STREAM&&(e.data=re(r.data instanceof Uint8Array?r.data:r.data.subarray())),(r.type===ot.MESSAGE_INITIATOR||r.type===ot.MESSAGE_RECEIVER)&&(e.data=re(r.data instanceof Uint8Array?r.data:r.data.subarray(),"base16")),e}class r6e{constructor(e,t){u(this,"protocol","/mplex/6.7.0");u(this,"sink");u(this,"source");u(this,"log");u(this,"_streamId");u(this,"_streams");u(this,"_init");u(this,"_source");u(this,"closeController");u(this,"rateLimiter");u(this,"closeTimeout");u(this,"logger");t=t??{},this.log=e.logger.forComponent("libp2p:mplex"),this.logger=e.logger,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=t,this.closeTimeout=t.closeTimeout??t6e,this.sink=this._createSink(),this._source=go({objectMode:!0,onEnd:()=>{for(const n of this._streams.initiators.values())n.destroy();for(const n of this._streams.receivers.values())n.destroy()}}),this.source=un(this._source,n=>W8e(n)),this.closeController=new AbortController,this.rateLimiter=new mF({points:t.disconnectThreshold??e6e,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Pl("Muxer already closed");const t=this._streamId++;e=e==null?t.toString():e.toString();const n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}async close(e){if(this.closeController.signal.aborted)return;const t=(e==null?void 0:e.signal)??AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map(async n=>n.close({signal:t}))),this._source.end(),await this._source.onEmpty({signal:t}),this.closeController.abort()}catch(n){this.abort(n)}}abort(e){this.closeController.signal.aborted||(this.streams.forEach(t=>{t.abort(e)}),this.closeController.abort(e))}_newReceiverStream(e){const{id:t,name:n}=e,i=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:i})}_newStream(e){const{id:t,name:n,type:i,registry:s}=e;if(this.log("new %s stream %s",i,t),i==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??X8e))throw new B2("Too many outbound streams open");if(s.has(t))throw new Error(`${i} stream ${t} already exists!`);const c=J8e({id:t,name:n,send:async l=>{this.log.enabled&&this.log.trace("%s stream %s send",i,t,SF(l)),this._source.push(l)},type:i,onEnd:()=>{this.log("%s stream with id %s and protocol %s ended",i,t,c.protocol),s.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(c)},maxMsgSize:this._init.maxMsgSize,logger:this.logger});return s.set(t,c),c}_createSink(){return async t=>{const n=()=>{TL(t,this.log)};this.closeController.signal.addEventListener("abort",n);try{const i=new K8e(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const s of t)for(const o of i.write(s))await this._handleIncoming(o);this._source.end()}catch(i){this.log("error in sink",i),this._source.end(i)}finally{this.closeController.signal.removeEventListener("abort",n)}}}async _handleIncoming(e){const{id:t,type:n}=e;if(this.log.enabled&&this.log.trace("incoming message",SF(e)),e.type===ot.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??Y8e)){this.log("too many inbound streams open"),this._source.push({id:t,type:ot.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(new Error("Too many open streams"));return}return}const a=this._newReceiverStream({id:t,name:re(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(a);return}const s=((n&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(s==null){this.log("missing stream %s for message type %s",t,WE[n]);try{await this.rateLimiter.consume("missing-stream",1)}catch{this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(new Error("Too many messages for missing streams"));return}return}const o=this._init.maxStreamBufferSize??Z8e;try{switch(n){case ot.MESSAGE_INITIATOR:case ot.MESSAGE_RECEIVER:if(s.sourceReadableLength()>o)throw this._source.push({id:e.id,type:n===ot.MESSAGE_INITIATOR?ot.RESET_RECEIVER:ot.RESET_INITIATOR}),new G8e("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers");s.sourcePush(e.data);break;case ot.CLOSE_INITIATOR:case ot.CLOSE_RECEIVER:s.remoteCloseWrite();break;case ot.RESET_INITIATOR:case ot.RESET_RECEIVER:s.reset();break;default:this.log("unknown message type %s",n)}}catch(a){this.log.error("error while processing message",a),s.abort(a)}}}mH=Symbol.toStringTag,yH=dr;class n6e{constructor(e,t={}){u(this,"protocol","/mplex/6.7.0");u(this,"_init");u(this,"components");u(this,mH,"@libp2p/mplex");u(this,yH,["@libp2p/stream-multiplexing"]);this.components=e,this._init=t}createStreamMuxer(e={}){return new r6e(this.components,{...e,...this._init})}}function i6e(r={}){return e=>new n6e(e,r)}const QE=32,s6e="1.0.0",o6e="ping",a6e="ipfs",c6e=1e4,l6e=2,u6e=1;bH=Symbol.toStringTag,wH=dr;class d6e{constructor(e,t={}){u(this,"protocol");u(this,"components");u(this,"started");u(this,"timeout");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"runOnLimitedConnection");u(this,"log");u(this,bH,"@libp2p/ping");u(this,wH,["@libp2p/ping"]);this.components=e,this.log=e.logger.forComponent("libp2p:ping"),this.started=!1,this.protocol=`/${t.protocolPrefix??a6e}/${o6e}/${s6e}`,this.timeout=t.timeout??c6e,this.maxInboundStreams=t.maxInboundStreams??l6e,this.maxOutboundStreams=t.maxOutboundStreams??u6e,this.runOnLimitedConnection=t.runOnLimitedConnection??!0,this.handleMessage=this.handleMessage.bind(this)}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){this.log("incoming ping from %p",e.connection.remotePeer);const{stream:t}=e,n=Date.now(),i=Zm(t);let s=!1;Promise.resolve().then(async()=>{for(;;){const o=AbortSignal.timeout(this.timeout);o.addEventListener("abort",()=>{t==null||t.abort(new y1("ping timeout"))});const a=await i.read({bytes:QE,signal:o});await i.write(a,{signal:o}),s=!0}}).catch(o=>{s&&o.name==="UnexpectedEOFError"&&t.readStatus!=="ready"||(this.log.error("incoming ping from %p failed with error - %e",e.connection.remotePeer,o),t==null||t.abort(o))}).finally(()=>{const o=Date.now()-n;this.log("incoming ping from %p complete in %dms",e.connection.remotePeer,o);const a=AbortSignal.timeout(this.timeout);t.close({signal:a}).catch(c=>{this.log.error("error closing ping stream from %p - %e",e.connection.remotePeer,c),t==null||t.abort(c)})})}async ping(e,t={}){this.log("pinging %p",e);const n=Date.now(),i=sc(QE),s=await this.components.connectionManager.openConnection(e,t);let o;if(t.signal==null){const a=AbortSignal.timeout(this.timeout);t={...t,signal:a}}try{o=await s.newStream(this.protocol,{...t,runOnLimitedConnection:this.runOnLimitedConnection});const a=Zm(o),[,c]=await Promise.all([a.write(i,t),a.read({...t,bytes:QE})]),l=Date.now()-n;if(!We(i,c.subarray()))throw new wP(`Received wrong ping ack after ${l}ms`);return this.log("ping %p complete in %dms",s.remotePeer,l),l}catch(a){throw this.log.error("error while pinging %p",s.remotePeer,a),o==null||o.abort(a),a}finally{o!=null&&await o.close(t)}}}function h6e(r={}){return e=>new d6e(e,r)}var Dn;(function(r){(function(n){n.FIN="FIN",n.STOP_SENDING="STOP_SENDING",n.RESET="RESET",n.FIN_ACK="FIN_ACK"})(r.Flag||(r.Flag={}));let e;(function(n){n[n.FIN=0]="FIN",n[n.STOP_SENDING=1]="STOP_SENDING",n[n.RESET=2]="RESET",n[n.FIN_ACK=3]="FIN_ACK"})(e||(e={})),function(n){n.codec=()=>kn(e)}(r.Flag||(r.Flag={}));let t;r.codec=()=>(t==null&&(t=$e((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.flag!=null&&(i.uint32(8),r.Flag.codec().encode(n.flag,i)),n.message!=null&&(i.uint32(18),i.bytes(n.message)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.flag=r.Flag.codec().decode(n);break}case 2:{o.message=n.bytes();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>De(n,r.codec()),r.decode=(n,i)=>Pe(n,r.codec(),i)})(Dn||(Dn={}));const f6e=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],xF=Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),p6e="libp2p+webrtc+v1/",g6e=466,y6e=2*1024*1024,m6e=30*1e3,nw=16*1024;function w6e(r=nw){const e=yt(r-yt(r)),t=1+yt(Object.keys(Dn.Flag).length-1),n=1,i=r-e-t-n,s=yt(i);return e+t+n+s}const b6e=w6e(),v6e=5e3,E6e=5e3,S6e=3e4,AF="/webrtc",JE="/webrtc-signaling/0.0.1",x6e="/libp2p/webrtc-direct/certificate",A6e="webrtc-direct-certificate-private-key",C6e=12096e5,CF=864e5;var IF=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||Array.prototype.slice.call(e))},I6e=function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r}(),k6e=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}(),_6e=function(){function r(e,t,n,i){this.name=e,this.version=t,this.os=n,this.bot=i,this.type="bot-device"}return r}(),T6e=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),P6e=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),D6e=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,$6e=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,kF=3,N6e=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",D6e]],_F=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function M6e(r){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new P6e:typeof navigator<"u"?R6e(navigator.userAgent):B6e()}function O6e(r){return r!==""&&N6e.reduce(function(e,t){var n=t[0],i=t[1];if(e)return e;var s=i.exec(r);return!!s&&[n,s]},!1)}function R6e(r){var e=O6e(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new T6e;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<kF&&(i=IF(IF([],i,!0),U6e(kF-i.length),!0)):i=[];var s=i.join("."),o=L6e(r),a=$6e.exec(r);return a&&a[1]?new _6e(t,s,o,a[1]):new I6e(t,s,o)}function L6e(r){for(var e=0,t=_F.length;e<t;e++){var n=_F[e],i=n[0],s=n[1],o=s.exec(r);if(o)return i}return null}function B6e(){var r=typeof process<"u"&&process.version;return r?new k6e(process.version.slice(1)):null}function U6e(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}const TF=M6e(),YE=TF!=null&&TF.name==="firefox",PF=async function*(){},DF=async r=>{};function F6e(r,e,t=S6e,n){r.readyState==="open"&&Promise.resolve().then(async()=>{if(r.bufferedAmount>0){n.log("%s drain channel with %d buffered bytes",e,r.bufferedAmount);const i=Le();let s=!1;r.bufferedAmountLowThreshold=0;const o=()=>{s||(n.log("%s drain channel closed before drain",e),i.resolve())};r.addEventListener("close",o,{once:!0}),r.addEventListener("bufferedamountlow",()=>{s=!0,r.removeEventListener("close",o),i.resolve()}),await Wf(i.promise,{milliseconds:t})}}).then(async()=>{r.readyState==="open"&&r.close()}).catch(i=>{n.log.error("error closing outbound stream",i)})}async function $F(r){return r=r??{},typeof r=="function"&&(r=await r()),r.iceServers=r.iceServers??f6e.map(e=>({urls:[e]})),r}const z6e=(r=32)=>p6e+[...Array(r)].map(()=>xF.at(Math.floor(Math.random()*xF.length))).join("");class XE{constructor(e,t){u(this,"log");u(this,"peerConnection");u(this,"remoteAddr");u(this,"timeline");u(this,"metrics");u(this,"source",PF());u(this,"sink",DF);this.log=e.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=t.remoteAddr,this.timeline=t.timeline,this.peerConnection=t.peerConnection;const n=this.peerConnection,i=n.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",n.connectionState,"initial state",i),(n.connectionState==="disconnected"||n.connectionState==="failed"||n.connectionState==="closed")&&(this.timeline.close=Date.now())}}async close(e){var t;this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),(t=this.metrics)==null||t.increment({close:!0})}abort(e){var t;this.log.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),(t=this.metrics)==null||t.increment({abort:!0})}}class V6e extends W9{constructor(t){const n=t.onEnd;t.onEnd=s=>{this.log.trace('readable and writeable ends closed with status "%s"',this.status),Promise.resolve(async()=>{if(!(this.timeline.abort!=null||this.timeline.reset!==null))try{await Wf(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(o){this.log.error("error receiving FIN_ACK",o)}}).then(()=>{this.incomingData.end(),n==null||n(s)}).catch(o=>{this.log.error("error ending stream",o)}).finally(()=>{this.channel.close()})};super(t);u(this,"channel");u(this,"incomingData");u(this,"maxBufferedAmount");u(this,"bufferedAmountLowEventTimeout");u(this,"maxMessageSize");u(this,"receiveFinAck");u(this,"finAckTimeout");u(this,"openTimeout");u(this,"closeController");switch(this.channel=t.channel,this.channel.binaryType="arraybuffer",this.incomingData=go(),this.bufferedAmountLowEventTimeout=t.bufferedAmountLowEventTimeout??m6e,this.maxBufferedAmount=t.maxBufferedAmount??y6e,this.maxMessageSize=(t.maxMessageSize??nw)-b6e,this.receiveFinAck=Le(),this.finAckTimeout=t.closeTimeout??v6e,this.openTimeout=t.openTimeout??E6e,this.closeController=new AbortController,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(this.timeline.close===void 0||this.timeline.close===0)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new M2("Unknown datachannel state")}this.channel.onopen=s=>{this.timeline.open=new Date().getTime()},this.channel.onclose=s=>{this.log.trace("received onclose event"),this.closeController.abort(),this.receiveFinAck.resolve(),this.close().catch(o=>{this.log.error("error closing stream after channel closed",o)})},this.channel.onerror=s=>{this.log.trace("received onerror event"),this.closeController.abort();const o=s.error;this.abort(o)},this.channel.onmessage=async s=>{const{data:o}=s;o===null||o.byteLength===0||this.incomingData.push(new Uint8Array(o,0,o.byteLength))};const i=this;Promise.resolve().then(async()=>{for await(const s of Ud(this.incomingData)){const o=i.processIncomingProtobuf(s);o!=null&&i.sourcePush(new Ue(o))}}).catch(s=>{this.log.error("error processing incoming data channel messages",s)})}sendNewStream(){}async _sendMessage(t,n=!0){if(this.channel.readyState==="closed"||this.channel.readyState==="closing")throw new M2(`Invalid datachannel state - ${this.channel.readyState}`);if(this.channel.readyState!=="open"){const i=AbortSignal.timeout(this.openTimeout),s=pt([this.closeController.signal,i]);try{this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await Ti(this.channel,"open",s)}finally{s.clear()}this.log('channel state is now "%s", sending data',this.channel.readyState)}if(n&&this.channel.bufferedAmount>this.maxBufferedAmount){const i=AbortSignal.timeout(this.bufferedAmountLowEventTimeout),s=pt([this.closeController.signal,i]);try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await Ti(this.channel,"bufferedamountlow",s)}catch(o){throw i.aborted?new y1(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`):o}finally{s.clear()}}try{this.log.trace('sending message, channel state "%s"',this.channel.readyState),this.channel.send(t.subarray())}catch(i){this.log.error("error while sending message",i)}}async sendData(t){const n=t.byteLength;for(t=t.sublist();t.byteLength>0;){const i=Math.min(t.byteLength,this.maxMessageSize),s=t.subarray(0,i),o=Dn.encode({message:s}),a=Bd.single(o);this.log.trace("sending %d/%d bytes on channel",s.byteLength,n),await this._sendMessage(a),t.consume(i)}this.log.trace('finished sending data, channel state "%s"',this.channel.readyState)}async sendReset(){try{await this._sendFlag(Dn.Flag.RESET)}catch(t){this.log.error("failed to send reset - %e",t)}finally{this.channel.close()}}async sendCloseWrite(t){if(this.channel.readyState!=="open"){this.receiveFinAck.resolve();return}if(await this._sendFlag(Dn.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await ln(this.receiveFinAck.promise,t==null?void 0:t.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorName:"FinAckNotReceivedError"})}catch(i){this.log.error("failed to await FIN_ACK",i)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){this.channel.readyState==="open"&&await this._sendFlag(Dn.Flag.STOP_SENDING)}processIncomingProtobuf(t){const n=Dn.decode(t);if(n.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',n.flag,this.writeStatus,this.readStatus),n.flag===Dn.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(Dn.Flag.FIN_ACK).catch(i=>{this.log.error("error sending FIN_ACK immediately",i)})),n.flag===Dn.Flag.RESET&&this.reset(),n.flag===Dn.Flag.STOP_SENDING&&this.remoteCloseRead(),n.flag===Dn.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),this.readStatus==="ready")return n.message}async _sendFlag(t){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',t.toString(),this.channel.readyState),!1;this.log.trace("sending flag %s",t.toString());const n=Dn.encode({flag:t}),i=Bd.single(n);try{return await this._sendMessage(i,!1),!0}catch(s){this.log.error("could not send flag %s - %e",t.toString(),s)}return!1}}function iw(r){const{channel:e,direction:t,handshake:n}=r;return new V6e({id:`${e.id}`,log:r.logger.forComponent(`libp2p:webrtc:stream:${n===!0?"handshake":t}:${e.id}`),...r})}class ZE{constructor(e,t){u(this,"protocol");u(this,"peerConnection");u(this,"bufferedStreams",[]);u(this,"metrics");u(this,"dataChannelOptions");u(this,"components");u(this,"log");this.components=e,this.peerConnection=t.peerConnection,this.metrics=t.metrics,this.protocol=t.protocol??AF,this.dataChannelOptions=t.dataChannelOptions??{},this.log=e.logger.forComponent("libp2p:webrtc:muxerfactory"),this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',n.id),n.label==="init"){this.log.trace("closing early init channel"),n.close();return}const i={},s=iw({channel:n,direction:"inbound",onEnd:o=>{i.onEnd(o)},logger:e.logger,...this.dataChannelOptions});i.stream=s,i.channel=n,i.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(o=>o.stream.id!==s.id)},this.bufferedStreams.push(i)}}createStreamMuxer(e){return new K6e(this.components,{...e,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}}class K6e{constructor(e,t){Ye(this,ef);u(this,"init");u(this,"streams");u(this,"protocol");u(this,"log");u(this,"peerConnection");u(this,"dataChannelOptions");u(this,"metrics");u(this,"logger");u(this,"source",PF());u(this,"sink",DF);this.init=t,this.log=e.logger.forComponent("libp2p:webrtc:muxer"),this.logger=e.logger,this.streams=t.streams.map(n=>n.stream),this.peerConnection=t.peerConnection,this.protocol=t.protocol??AF,this.metrics=t.metrics,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:n})=>{var o,a;if(this.log.trace("incoming datachannel with channel id %d",n.id),n.label==="init"){this.log.trace("closing init channel"),n.close();return}const i=n.id,s=iw({channel:n,direction:"inbound",onEnd:()=>{Ie(this,ef,Q4).call(this,s,n),this.log("incoming channel %s ended",i)},logger:this.logger,...this.dataChannelOptions});this.streams.push(s),(o=this.metrics)==null||o.increment({incoming_stream:!0}),(a=t==null?void 0:t.onIncomingStream)==null||a.call(t,s)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(n=>{var i,s,o;n.onEnd=()=>{this.log("incoming early channel %s ended with state %s",n.channel.id,n.channel.readyState),Ie(this,ef,Q4).call(this,n.stream,n.channel)},(i=this.metrics)==null||i.increment({incoming_stream:!0}),(o=(s=this.init)==null?void 0:s.onIncomingStream)==null||o.call(s,n.stream)})})}async close(e){try{await Promise.all(this.streams.map(async t=>t.close(e)))}catch(t){this.abort(t)}}abort(e){for(const t of this.streams)t.abort(e)}newStream(){var i;const e=this.peerConnection.createDataChannel(""),t=e.id;this.log.trace("opened outgoing datachannel with channel id %s",t);const n=iw({channel:e,direction:"outbound",onEnd:()=>{Ie(this,ef,Q4).call(this,n,e),this.log("outgoing channel %s ended",t)},logger:this.logger,...this.dataChannelOptions});return this.streams.push(n),(i=this.metrics)==null||i.increment({outgoing_stream:!0}),n}}ef=new WeakSet,Q4=function(e,t){var n,i,s;this.log.trace("stream %s %s %s onEnd",e.direction,e.id,e.protocol),F6e(t,`${e.direction} ${e.id} ${e.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(o=>o.id!==e.id),(n=this.metrics)==null||n.increment({stream_end:!0}),(s=(i=this.init)==null?void 0:i.onStreamEnd)==null||s.call(i,e)};const NF=globalThis.RTCPeerConnection,MF=globalThis.RTCSessionDescription,j6e=globalThis.RTCIceCandidate;class kp extends Error{constructor(e){super(`WebRTC transport error: ${e}`),this.name="WebRTCTransportError"}}class Oc extends kp{constructor(e="SDP handshake failed"){super(e),this.name="SDPHandshakeFailedError"}}class H6e extends kp{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`),this.name="WebRTC/InvalidFingerprintError"}}class q6e extends kp{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}}class W6e extends kp{constructor(e){super(`unsupported hash algorithm code: ${e} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}}var hs;(function(r){(function(n){n.SDP_OFFER="SDP_OFFER",n.SDP_ANSWER="SDP_ANSWER",n.ICE_CANDIDATE="ICE_CANDIDATE"})(r.Type||(r.Type={}));let e;(function(n){n[n.SDP_OFFER=0]="SDP_OFFER",n[n.SDP_ANSWER=1]="SDP_ANSWER",n[n.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(e||(e={})),function(n){n.codec=()=>kn(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=$e((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.data!=null&&(i.uint32(18),i.string(n.data)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.data=n.string();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>De(n,r.codec()),r.decode=(n,i)=>Pe(n,r.codec(),i)})(hs||(hs={}));const OF=async(r,e,t)=>{var n,i,s,o;try{const a=Le();for(G6e(r,a);;){const c=await Promise.race([a.promise,e.read({signal:t.signal}).catch(()=>{})]);if(c==null){(n=t.signal)==null||n.throwIfAborted();break}if(c.type!==hs.Type.ICE_CANDIDATE)throw new St("ICE candidate message expected");const l=JSON.parse(c.data??"null");if(l===""||l===null){(i=t.onProgress)==null||i.call(t,new _e("webrtc:end-of-ice-candidates")),t.log.trace("end-of-candidates received");continue}const d=new j6e(l);t.log.trace("%s received new ICE candidate %o",t.direction,l);try{(s=t.onProgress)==null||s.call(t,new _e("webrtc:add-ice-candidate",d.candidate)),await r.addIceCandidate(d)}catch(h){t.log.error("%s bad candidate received",t.direction,l,h)}}}catch(a){if(t.log.error("%s error parsing ICE candidate",t.direction,a),((o=t.signal)==null?void 0:o.aborted)===!0&&eS(r)!=="connected")throw a}};function eS(r){return YE?r.iceConnectionState:r.connectionState}function G6e(r,e){r[YE?"oniceconnectionstatechange":"onconnectionstatechange"]=t=>{switch(eS(r)){case"connected":e.resolve();break;case"failed":case"disconnected":case"closed":e.reject(new Nb("RTCPeerConnection was closed"));break}}}async function Q6e({rtcConfiguration:r,dataChannel:e,signal:t,metrics:n,multiaddr:i,connectionManager:s,transportManager:o,log:a,logger:c,onProgress:l}){const{baseAddr:d}=X6e(i);n==null||n.dialerEvents.increment({open:!0}),a.trace("dialing base address: %a",d);const h=d.getPeerId();if(h==null)throw new Z("Relay peer was missing");const p=s.getConnections(tr(h));let b,f=!1;p.length===0?(l==null||l(new _e("webrtc:dial-relay")),b=await o.dial(d,{signal:t,onProgress:l}),f=!0):(l==null||l(new _e("webrtc:reuse-relay-connection")),b=p[0]);try{l==null||l(new _e("webrtc:open-signaling-stream"));const g=await b.newStream(JE,{signal:t,runOnLimitedConnection:!0}),v=li(g).pb(hs),y=new NF(r),w=new ZE({logger:c},{peerConnection:y,dataChannelOptions:e});try{const m=y.createDataChannel("init");y.onicecandidate=({candidate:x})=>{const I=JSON.stringify((x==null?void 0:x.toJSON())??null);a.trace("initiator sending ICE candidate %o",x),v.write({type:hs.Type.ICE_CANDIDATE,data:I},{signal:t}).catch(T=>{a.error("error sending ICE candidate",T)})},y.onicecandidateerror=x=>{a.error("initiator ICE candidate error",x)};const E=await y.createOffer().catch(x=>{throw a.error("could not execute createOffer",x),new Oc("Failed to set createOffer")});a.trace("initiator send SDP offer %s",E.sdp),l==null||l(new _e("webrtc:send-sdp-offer")),await v.write({type:hs.Type.SDP_OFFER,data:E.sdp},{signal:t}),await y.setLocalDescription(E).catch(x=>{throw a.error("could not execute setLocalDescription",x),new Oc("Failed to set localDescription")}),l==null||l(new _e("webrtc:read-sdp-answer")),a.trace("initiator read SDP answer");const A=await v.read({signal:t});if(A.type!==hs.Type.SDP_ANSWER)throw new Oc("Remote should send an SDP answer");a.trace("initiator received SDP answer %s",A.data);const k=new MF({type:"answer",sdp:A.data});return await y.setRemoteDescription(k).catch(x=>{throw a.error("could not execute setRemoteDescription",x),new Oc("Failed to set remoteDescription")}),a.trace("initiator read candidates until connected"),l==null||l(new _e("webrtc:read-ice-candidates")),await OF(y,v,{direction:"initiator",signal:t,log:a,onProgress:l}),a.trace("initiator connected, closing init channel"),m.close(),l==null||l(new _e("webrtc:close-signaling-stream")),a.trace("closing signaling channel"),await g.close({signal:t}),a.trace("initiator connected to remote address %s",i),{remoteAddress:i,peerConnection:y,muxerFactory:w}}catch(m){throw a.error("outgoing signaling error",m),y.close(),g.abort(m),m}finally{y.onicecandidate=null,y.onicecandidateerror=null}}finally{if(f)try{await b.close({signal:t})}catch(g){b.abort(g)}}}const RF=Ct(dO.matchers[0],Qe("p2p-circuit"));class tS extends er{constructor(t,n){super();u(this,"transportManager");u(this,"shutdownController");u(this,"events");this.transportManager=t.transportManager,this.events=t.events,this.shutdownController=n.shutdownController,this.onTransportListening=this.onTransportListening.bind(this)}async listen(){this.events.addEventListener("transport:listening",this.onTransportListening)}onTransportListening(t){t.detail.getAddrs().filter(i=>RF.exactMatch(i)).map(i=>i.encapsulate("/webrtc")).length>0&&this.safeDispatchEvent("listening")}getAddrs(){return this.transportManager.getListeners().filter(t=>!(t instanceof tS)).map(t=>t.getAddrs().filter(n=>RF.exactMatch(n)).map(n=>n.encapsulate("/webrtc"))).flat()}updateAnnounceAddrs(){}async close(){this.events.removeEventListener("transport:listening",this.onTransportListening),this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})}}async function J6e({peerConnection:r,stream:e,signal:t,connection:n,log:i}){i.trace("new inbound signaling stream");const s=li(e).pb(hs);try{r.onicecandidate=({candidate:d})=>{const h=JSON.stringify((d==null?void 0:d.toJSON())??null);i.trace("recipient sending ICE candidate %s",h),s.write({type:hs.Type.ICE_CANDIDATE,data:h},{signal:t}).catch(p=>{i.error("error sending ICE candidate",p)})},i.trace("recipient read SDP offer");const a=await s.read({signal:t});if(a.type!==hs.Type.SDP_OFFER)throw new Oc(`expected message type SDP_OFFER, received: ${a.type??"undefined"} `);i.trace("recipient received SDP offer %s",a.data);const c=new MF({type:"offer",sdp:a.data});await r.setRemoteDescription(c).catch(d=>{throw i.error("could not execute setRemoteDescription",d),new Oc("Failed to set remoteDescription")});const l=await r.createAnswer().catch(d=>{throw i.error("could not execute createAnswer",d),new Oc("Failed to create answer")});i.trace("recipient send SDP answer %s",l.sdp),await s.write({type:hs.Type.SDP_ANSWER,data:l.sdp},{signal:t}),await r.setLocalDescription(l).catch(d=>{throw i.error("could not execute setLocalDescription",d),new Oc("Failed to set localDescription")}),i.trace("recipient read candidates until connected"),await OF(r,s,{direction:"recipient",signal:t,log:i})}catch(a){if(eS(r)!=="connected")throw i.error("error while handling signaling stream from peer %a",n.remoteAddr,a),r.close(),a;i("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",n.remoteAddr,a)}const o=Re(`/webrtc/p2p/${n.remoteAddr.getPeerId()}`);return i.trace("recipient connected to remote address %s",o),{remoteAddress:o}}xH=N2,SH=Symbol.toStringTag,EH=dr,vH=Ja;class Y6e{constructor(e,t={}){u(this,"components");u(this,"init");u(this,"log");u(this,"_started",!1);u(this,"metrics");u(this,"shutdownController");u(this,xH,!0);u(this,SH,"@libp2p/webrtc");u(this,EH,["@libp2p/transport"]);u(this,vH,["@libp2p/identify","@libp2p/circuit-relay-v2-transport"]);this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}isStarted(){return this._started}async start(){await this.components.registrar.handle(JE,e=>{const t=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);this._onProtocol(e,t).catch(n=>{this.log.error("failed to handle incoming connect from %p",e.connection.remotePeer,n)}).finally(()=>{t.clear()})},{runOnLimitedConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(JE),this._started=!1}createListener(e){return new tS(this.components,{shutdownController:this.shutdownController})}listenFilter(e){return e.filter(W7.exactMatch)}dialFilter(e){return this.listenFilter(e)}async dial(e,t){var c;this.log.trace("dialing address: %a",e);const{remoteAddress:n,peerConnection:i,muxerFactory:s}=await Q6e({rtcConfiguration:await $F(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:t.onProgress}),o=new XE(this.components,{peerConnection:i,timeline:{open:Date.now()},remoteAddr:n,metrics:(c=this.metrics)==null?void 0:c.dialerEvents}),a=await t.upgrader.upgradeOutbound(o,{skipProtection:!0,skipEncryption:!0,muxerFactory:s,onProgress:t.onProgress,signal:t.signal});return this._closeOnShutdown(i,o),a}async _onProtocol({connection:e,stream:t},n){var o;const i=new NF(await $F(this.init.rtcConfiguration)),s=new ZE(this.components,{peerConnection:i,dataChannelOptions:this.init.dataChannel});try{const{remoteAddress:a}=await J6e({peerConnection:i,connection:e,stream:t,signal:n,log:this.log});await t.close({signal:n});const c=new XE(this.components,{peerConnection:i,timeline:{open:new Date().getTime()},remoteAddr:a,metrics:(o=this.metrics)==null?void 0:o.listenerEvents});await this.components.upgrader.upgradeInbound(c,{skipEncryption:!0,skipProtection:!0,muxerFactory:s,signal:n}),this._closeOnShutdown(i,c)}catch(a){throw this.log.error("incoming signaling error",a),i.close(),t.abort(a),a}}_closeOnShutdown(e,t){const n=()=>{t.close().catch(i=>{this.log.error("could not close WebRTCMultiaddrConnection",i)})};this.shutdownController.signal.addEventListener("abort",n),e.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",n)})}}function X6e(r){const e=r.toString().split("/webrtc/");if(e.length!==2)throw new Z("webrtc protocol was not present in multiaddr");if(!e[0].includes("/p2p-circuit"))throw new Z("p2p-circuit protocol was not present in multiaddr");let t=Re(e[0]);const i=Re("/"+e[1]).getPeerId();if(i==null)throw new Z("destination peer id was missing");const s=t.protos().pop();if(s===void 0)throw new Z("invalid multiaddr");return s.name!=="p2p"&&(t=t.encapsulate(`/p2p/${i}`)),{baseAddr:t,peerId:tr(i)}}/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var LF;(function(r){(function(e){var t=typeof globalThis=="object"?globalThis:typeof nt=="object"?nt:typeof self=="object"?self:typeof this=="object"?this:a(),n=i(r);typeof t.Reflect<"u"&&(n=i(t.Reflect,n)),e(n,t),typeof t.Reflect>"u"&&(t.Reflect=r);function i(c,l){return function(d,h){Object.defineProperty(c,d,{configurable:!0,writable:!0,value:h}),l&&l(d,h)}}function s(){try{return Function("return this;")()}catch{}}function o(){try{return(0,eval)("(function() { return this; })()")}catch{}}function a(){return s()||o()}})(function(e,t){var n=Object.prototype.hasOwnProperty,i=typeof Symbol=="function",s=i&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=i&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",c={__proto__:[]}instanceof Array,l=!a&&!c,d={create:a?function(){return M(Object.create(null))}:c?function(){return M({__proto__:null})}:function(){return M({})},has:l?function(P,N){return n.call(P,N)}:function(P,N){return N in P},get:l?function(P,N){return n.call(P,N)?P[N]:void 0}:function(P,N){return P[N]}},h=Object.getPrototypeOf(Function),p=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:D(),b=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:S(),f=typeof WeakMap=="function"?WeakMap:C(),g=i?Symbol.for("@reflect-metadata:registry"):void 0,v=Qc(),y=rf(v);function w(P,N,R,Y){if(H(R)){if(!vt(P))throw new TypeError;if(!$t(N))throw new TypeError;return B(P,N)}else{if(!vt(P))throw new TypeError;if(!ce(N))throw new TypeError;if(!ce(Y)&&!H(Y)&&!se(Y))throw new TypeError;return se(Y)&&(Y=void 0),R=lt(R),G(P,N,R,Y)}}e("decorate",w);function m(P,N){function R(Y,pe){if(!ce(Y))throw new TypeError;if(!H(pe)&&!nr(pe))throw new TypeError;O(P,N,Y,pe)}return R}e("metadata",m);function E(P,N,R,Y){if(!ce(R))throw new TypeError;return H(Y)||(Y=lt(Y)),O(P,N,R,Y)}e("defineMetadata",E);function A(P,N,R){if(!ce(N))throw new TypeError;return H(R)||(R=lt(R)),j(P,N,R)}e("hasMetadata",A);function k(P,N,R){if(!ce(N))throw new TypeError;return H(R)||(R=lt(R)),q(P,N,R)}e("hasOwnMetadata",k);function x(P,N,R){if(!ce(N))throw new TypeError;return H(R)||(R=lt(R)),Q(P,N,R)}e("getMetadata",x);function I(P,N,R){if(!ce(N))throw new TypeError;return H(R)||(R=lt(R)),K(P,N,R)}e("getOwnMetadata",I);function T(P,N){if(!ce(P))throw new TypeError;return H(N)||(N=lt(N)),U(P,N)}e("getMetadataKeys",T);function L(P,N){if(!ce(P))throw new TypeError;return H(N)||(N=lt(N)),W(P,N)}e("getOwnMetadataKeys",L);function z(P,N,R){if(!ce(N))throw new TypeError;if(H(R)||(R=lt(R)),!ce(N))throw new TypeError;H(R)||(R=lt(R));var Y=Tu(N,R,!1);return H(Y)?!1:Y.OrdinaryDeleteMetadata(P,N,R)}e("deleteMetadata",z);function B(P,N){for(var R=P.length-1;R>=0;--R){var Y=P[R],pe=Y(N);if(!H(pe)&&!se(pe)){if(!$t(pe))throw new TypeError;N=pe}}return N}function G(P,N,R,Y){for(var pe=P.length-1;pe>=0;--pe){var Oe=P[pe],ze=Oe(N,R,Y);if(!H(ze)&&!se(ze)){if(!ce(ze))throw new TypeError;Y=ze}}return Y}function j(P,N,R){var Y=q(P,N,R);if(Y)return!0;var pe=bs(N);return se(pe)?!1:j(P,pe,R)}function q(P,N,R){var Y=Tu(N,R,!1);return H(Y)?!1:Me(Y.OrdinaryHasOwnMetadata(P,N,R))}function Q(P,N,R){var Y=q(P,N,R);if(Y)return K(P,N,R);var pe=bs(N);if(!se(pe))return Q(P,pe,R)}function K(P,N,R){var Y=Tu(N,R,!1);if(!H(Y))return Y.OrdinaryGetOwnMetadata(P,N,R)}function O(P,N,R,Y){var pe=Tu(R,Y,!0);pe.OrdinaryDefineOwnMetadata(P,N,R,Y)}function U(P,N){var R=W(P,N),Y=bs(P);if(Y===null)return R;var pe=U(Y,N);if(pe.length<=0)return R;if(R.length<=0)return pe;for(var Oe=new b,ze=[],Se=0,ye=R;Se<ye.length;Se++){var Ee=ye[Se],Ae=Oe.has(Ee);Ae||(Oe.add(Ee),ze.push(Ee))}for(var Ce=0,Je=pe;Ce<Je.length;Ce++){var Ee=Je[Ce],Ae=Oe.has(Ee);Ae||(Oe.add(Ee),ze.push(Ee))}return ze}function W(P,N){var R=Tu(P,N,!1);return R?R.OrdinaryOwnMetadataKeys(P,N):[]}function J(P){if(P===null)return 1;switch(typeof P){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return P===null?1:6;default:return 6}}function H(P){return P===void 0}function se(P){return P===null}function we(P){return typeof P=="symbol"}function ce(P){return typeof P=="object"?P!==null:typeof P=="function"}function de(P,N){switch(J(P)){case 0:return P;case 1:return P;case 2:return P;case 3:return P;case 4:return P;case 5:return P}var R="string",Y=fa(P,s);if(Y!==void 0){var pe=Y.call(P,R);if(ce(pe))throw new TypeError;return pe}return Ne(P)}function Ne(P,N){var R,Y,pe;{var Oe=P.toString;if(kt(Oe)){var Y=Oe.call(P);if(!ce(Y))return Y}var R=P.valueOf;if(kt(R)){var Y=R.call(P);if(!ce(Y))return Y}}throw new TypeError}function Me(P){return!!P}function Ze(P){return""+P}function lt(P){var N=de(P);return we(N)?N:Ze(N)}function vt(P){return Array.isArray?Array.isArray(P):P instanceof Object?P instanceof Array:Object.prototype.toString.call(P)==="[object Array]"}function kt(P){return typeof P=="function"}function $t(P){return typeof P=="function"}function nr(P){switch(J(P)){case 3:return!0;case 4:return!0;default:return!1}}function Nr(P,N){return P===N||P!==P&&N!==N}function fa(P,N){var R=P[N];if(R!=null){if(!kt(R))throw new TypeError;return R}}function eo(P){var N=fa(P,o);if(!kt(N))throw new TypeError;var R=N.call(P);if(!ce(R))throw new TypeError;return R}function Gc(P){return P.value}function fe(P){var N=P.next();return N.done?!1:N}function Ki(P){var N=P.return;N&&N.call(P)}function bs(P){var N=Object.getPrototypeOf(P);if(typeof P!="function"||P===h||N!==h)return N;var R=P.prototype,Y=R&&Object.getPrototypeOf(R);if(Y==null||Y===Object.prototype)return N;var pe=Y.constructor;return typeof pe!="function"||pe===P?N:pe}function bn(){var P;!H(g)&&typeof t.Reflect<"u"&&!(g in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&(P=to(t.Reflect));var N,R,Y,pe=new f,Oe={registerProvider:ze,getProvider:ye,setProvider:Ae};return Oe;function ze(Ce){if(!Object.isExtensible(Oe))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case P===Ce:break;case H(N):N=Ce;break;case N===Ce:break;case H(R):R=Ce;break;case R===Ce:break;default:Y===void 0&&(Y=new b),Y.add(Ce);break}}function Se(Ce,Je){if(!H(N)){if(N.isProviderFor(Ce,Je))return N;if(!H(R)){if(R.isProviderFor(Ce,Je))return N;if(!H(Y))for(var Nt=eo(Y);;){var Yt=fe(Nt);if(!Yt)return;var vs=Gc(Yt);if(vs.isProviderFor(Ce,Je))return Ki(Nt),vs}}}if(!H(P)&&P.isProviderFor(Ce,Je))return P}function ye(Ce,Je){var Nt=pe.get(Ce),Yt;return H(Nt)||(Yt=Nt.get(Je)),H(Yt)&&(Yt=Se(Ce,Je),H(Yt)||(H(Nt)&&(Nt=new p,pe.set(Ce,Nt)),Nt.set(Je,Yt))),Yt}function Ee(Ce){if(H(Ce))throw new TypeError;return N===Ce||R===Ce||!H(Y)&&Y.has(Ce)}function Ae(Ce,Je,Nt){if(!Ee(Nt))throw new Error("Metadata provider not registered.");var Yt=ye(Ce,Je);if(Yt!==Nt){if(!H(Yt))return!1;var vs=pe.get(Ce);H(vs)&&(vs=new p,pe.set(Ce,vs)),vs.set(Je,Nt)}return!0}}function Qc(){var P;return!H(g)&&ce(t.Reflect)&&Object.isExtensible(t.Reflect)&&(P=t.Reflect[g]),H(P)&&(P=bn()),!H(g)&&ce(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,g,{enumerable:!1,configurable:!1,writable:!1,value:P}),P}function rf(P){var N=new f,R={isProviderFor:function(Ee,Ae){var Ce=N.get(Ee);return H(Ce)?!1:Ce.has(Ae)},OrdinaryDefineOwnMetadata:ze,OrdinaryHasOwnMetadata:pe,OrdinaryGetOwnMetadata:Oe,OrdinaryOwnMetadataKeys:Se,OrdinaryDeleteMetadata:ye};return v.registerProvider(R),R;function Y(Ee,Ae,Ce){var Je=N.get(Ee),Nt=!1;if(H(Je)){if(!Ce)return;Je=new p,N.set(Ee,Je),Nt=!0}var Yt=Je.get(Ae);if(H(Yt)){if(!Ce)return;if(Yt=new p,Je.set(Ae,Yt),!P.setProvider(Ee,Ae,R))throw Je.delete(Ae),Nt&&N.delete(Ee),new Error("Wrong provider for target.")}return Yt}function pe(Ee,Ae,Ce){var Je=Y(Ae,Ce,!1);return H(Je)?!1:Me(Je.has(Ee))}function Oe(Ee,Ae,Ce){var Je=Y(Ae,Ce,!1);if(!H(Je))return Je.get(Ee)}function ze(Ee,Ae,Ce,Je){var Nt=Y(Ce,Je,!0);Nt.set(Ee,Ae)}function Se(Ee,Ae){var Ce=[],Je=Y(Ee,Ae,!1);if(H(Je))return Ce;for(var Nt=Je.keys(),Yt=eo(Nt),vs=0;;){var QH=fe(Yt);if(!QH)return Ce.length=vs,Ce;var lCe=Gc(QH);try{Ce[vs]=lCe}catch(uCe){try{Ki(Yt)}finally{throw uCe}}vs++}}function ye(Ee,Ae,Ce){var Je=Y(Ae,Ce,!1);if(H(Je)||!Je.delete(Ee))return!1;if(Je.size===0){var Nt=N.get(Ae);H(Nt)||(Nt.delete(Ce),Nt.size===0&&N.delete(Nt))}return!0}}function to(P){var N=P.defineMetadata,R=P.hasOwnMetadata,Y=P.getOwnMetadata,pe=P.getOwnMetadataKeys,Oe=P.deleteMetadata,ze=new f,Se={isProviderFor:function(ye,Ee){var Ae=ze.get(ye);return!H(Ae)&&Ae.has(Ee)?!0:pe(ye,Ee).length?(H(Ae)&&(Ae=new b,ze.set(ye,Ae)),Ae.add(Ee),!0):!1},OrdinaryDefineOwnMetadata:N,OrdinaryHasOwnMetadata:R,OrdinaryGetOwnMetadata:Y,OrdinaryOwnMetadataKeys:pe,OrdinaryDeleteMetadata:Oe};return Se}function Tu(P,N,R){var Y=v.getProvider(P,N);if(!H(Y))return Y;if(R){if(v.setProvider(P,N,y))return y;throw new Error("Illegal state.")}}function D(){var P={},N=[],R=function(){function Se(ye,Ee,Ae){this._index=0,this._keys=ye,this._values=Ee,this._selector=Ae}return Se.prototype["@@iterator"]=function(){return this},Se.prototype[o]=function(){return this},Se.prototype.next=function(){var ye=this._index;if(ye>=0&&ye<this._keys.length){var Ee=this._selector(this._keys[ye],this._values[ye]);return ye+1>=this._keys.length?(this._index=-1,this._keys=N,this._values=N):this._index++,{value:Ee,done:!1}}return{value:void 0,done:!0}},Se.prototype.throw=function(ye){throw this._index>=0&&(this._index=-1,this._keys=N,this._values=N),ye},Se.prototype.return=function(ye){return this._index>=0&&(this._index=-1,this._keys=N,this._values=N),{value:ye,done:!0}},Se}(),Y=function(){function Se(){this._keys=[],this._values=[],this._cacheKey=P,this._cacheIndex=-2}return Object.defineProperty(Se.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Se.prototype.has=function(ye){return this._find(ye,!1)>=0},Se.prototype.get=function(ye){var Ee=this._find(ye,!1);return Ee>=0?this._values[Ee]:void 0},Se.prototype.set=function(ye,Ee){var Ae=this._find(ye,!0);return this._values[Ae]=Ee,this},Se.prototype.delete=function(ye){var Ee=this._find(ye,!1);if(Ee>=0){for(var Ae=this._keys.length,Ce=Ee+1;Ce<Ae;Ce++)this._keys[Ce-1]=this._keys[Ce],this._values[Ce-1]=this._values[Ce];return this._keys.length--,this._values.length--,Nr(ye,this._cacheKey)&&(this._cacheKey=P,this._cacheIndex=-2),!0}return!1},Se.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=P,this._cacheIndex=-2},Se.prototype.keys=function(){return new R(this._keys,this._values,pe)},Se.prototype.values=function(){return new R(this._keys,this._values,Oe)},Se.prototype.entries=function(){return new R(this._keys,this._values,ze)},Se.prototype["@@iterator"]=function(){return this.entries()},Se.prototype[o]=function(){return this.entries()},Se.prototype._find=function(ye,Ee){if(!Nr(this._cacheKey,ye)){this._cacheIndex=-1;for(var Ae=0;Ae<this._keys.length;Ae++)if(Nr(this._keys[Ae],ye)){this._cacheIndex=Ae;break}}return this._cacheIndex<0&&Ee&&(this._cacheIndex=this._keys.length,this._keys.push(ye),this._values.push(void 0)),this._cacheIndex},Se}();return Y;function pe(Se,ye){return Se}function Oe(Se,ye){return ye}function ze(Se,ye){return[Se,ye]}}function S(){var P=function(){function N(){this._map=new p}return Object.defineProperty(N.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),N.prototype.has=function(R){return this._map.has(R)},N.prototype.add=function(R){return this._map.set(R,R),this},N.prototype.delete=function(R){return this._map.delete(R)},N.prototype.clear=function(){this._map.clear()},N.prototype.keys=function(){return this._map.keys()},N.prototype.values=function(){return this._map.keys()},N.prototype.entries=function(){return this._map.entries()},N.prototype["@@iterator"]=function(){return this.keys()},N.prototype[o]=function(){return this.keys()},N}();return P}function C(){var P=16,N=d.create(),R=Y();return function(){function ye(){this._key=Y()}return ye.prototype.has=function(Ee){var Ae=pe(Ee,!1);return Ae!==void 0?d.has(Ae,this._key):!1},ye.prototype.get=function(Ee){var Ae=pe(Ee,!1);return Ae!==void 0?d.get(Ae,this._key):void 0},ye.prototype.set=function(Ee,Ae){var Ce=pe(Ee,!0);return Ce[this._key]=Ae,this},ye.prototype.delete=function(Ee){var Ae=pe(Ee,!1);return Ae!==void 0?delete Ae[this._key]:!1},ye.prototype.clear=function(){this._key=Y()},ye}();function Y(){var ye;do ye="@@WeakMap@@"+Se();while(d.has(N,ye));return N[ye]=!0,ye}function pe(ye,Ee){if(!n.call(ye,R)){if(!Ee)return;Object.defineProperty(ye,R,{value:d.create()})}return ye[R]}function Oe(ye,Ee){for(var Ae=0;Ae<Ee;++Ae)ye[Ae]=Math.random()*255|0;return ye}function ze(ye){if(typeof Uint8Array=="function"){var Ee=new Uint8Array(ye);return typeof crypto<"u"?crypto.getRandomValues(Ee):typeof msCrypto<"u"?msCrypto.getRandomValues(Ee):Oe(Ee,ye),Ee}return Oe(new Array(ye),ye)}function Se(){var ye=ze(P);ye[6]=ye[6]&79|64,ye[8]=ye[8]&191|128;for(var Ee="",Ae=0;Ae<P;++Ae){var Ce=ye[Ae];(Ae===4||Ae===6||Ae===8)&&(Ee+="-"),Ce<16&&(Ee+="0"),Ee+=Ce.toString(16).toLowerCase()}return Ee}}function M(P){return P.__=void 0,delete P.__,P}})})(LF||(LF={}));var X;(function(r){r[r.Sequence=0]="Sequence",r[r.Set=1]="Set",r[r.Choice=2]="Choice"})(X||(X={}));var F;(function(r){r[r.Any=1]="Any",r[r.Boolean=2]="Boolean",r[r.OctetString=3]="OctetString",r[r.BitString=4]="BitString",r[r.Integer=5]="Integer",r[r.Enumerated=6]="Enumerated",r[r.ObjectIdentifier=7]="ObjectIdentifier",r[r.Utf8String=8]="Utf8String",r[r.BmpString=9]="BmpString",r[r.UniversalString=10]="UniversalString",r[r.NumericString=11]="NumericString",r[r.PrintableString=12]="PrintableString",r[r.TeletexString=13]="TeletexString",r[r.VideotexString=14]="VideotexString",r[r.IA5String=15]="IA5String",r[r.GraphicString=16]="GraphicString",r[r.VisibleString=17]="VisibleString",r[r.GeneralString=18]="GeneralString",r[r.CharacterString=19]="CharacterString",r[r.UTCTime=20]="UTCTime",r[r.GeneralizedTime=21]="GeneralizedTime",r[r.DATE=22]="DATE",r[r.TimeOfDay=23]="TimeOfDay",r[r.DateTime=24]="DateTime",r[r.Duration=25]="Duration",r[r.TIME=26]="TIME",r[r.Null=27]="Null"})(F||(F={}));class sw{constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if(typeof e=="number")this.fromNumber(e);else if(he.isBufferSource(e))this.unusedBits=t,this.value=he.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof su))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new su({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new su({name:e})}toNumber(){let e="";const t=new Uint8Array(this.value);for(const n of t)e+=n.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2);const n=t.length+7>>3;this.unusedBits=(n<<3)-t.length;const i=new Uint8Array(n);t=t.padStart(n<<3,"0").split("").reverse().join("");let s=0;for(;s<n;)i[s]=parseInt(t.slice(s<<3,(s<<3)+8),2),s++;this.value=i.buffer}}class tt{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){typeof e=="number"?this.buffer=new ArrayBuffer(e):he.isBufferSource(e)?this.buffer=he.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof ds))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new ds({valueHex:this.buffer})}toSchema(e){return new ds({name:e})}}const Z6e={fromASN:r=>r instanceof Go?null:r.valueBeforeDecodeView,toASN:r=>{if(r===null)return new Go;const e=Wo(r);if(e.result.error)throw new Error(e.result.error);return e.result}},ebe={fromASN:r=>r.valueBlock.valueHexView.byteLength>=4?r.valueBlock.toString():r.valueBlock.valueDec,toASN:r=>new Qo({value:+r})},tbe={fromASN:r=>r.valueBlock.valueDec,toASN:r=>new K3({value:r})},Dt={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Qo({valueHex:r})},rbe={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new su({valueHex:r})},nbe={fromASN:r=>r.valueBlock.toString(),toASN:r=>new Jo({value:r})},ibe={fromASN:r=>r.valueBlock.value,toASN:r=>new V3({value:r})},ow={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new ds({valueHex:r})},sbe={fromASN:r=>new tt(r.getValue()),toASN:r=>r.toASN()};function $i(r){return{fromASN:e=>e.valueBlock.value,toASN:e=>new r({value:e})}}const BF=$i(Xo),obe=$i(j3),abe=$i(H3),cbe=$i(q3),lbe=$i(W3),ube=$i(G3),dbe=$i(Q3),hbe=$i(J3),fbe=$i(Y3),pbe=$i(xp),gbe=$i(X3),ybe=$i(Z3),mbe={fromASN:r=>r.toDate(),toASN:r=>new Ap({valueDate:r})},wbe={fromASN:r=>r.toDate(),toASN:r=>new ew({valueDate:r})},bbe={fromASN:()=>null,toASN:()=>new Go};function rS(r){switch(r){case F.Any:return Z6e;case F.BitString:return rbe;case F.BmpString:return obe;case F.Boolean:return ibe;case F.CharacterString:return ybe;case F.Enumerated:return tbe;case F.GeneralString:return gbe;case F.GeneralizedTime:return wbe;case F.GraphicString:return fbe;case F.IA5String:return hbe;case F.Integer:return ebe;case F.Null:return bbe;case F.NumericString:return cbe;case F.ObjectIdentifier:return nbe;case F.OctetString:return ow;case F.PrintableString:return lbe;case F.TeletexString:return ube;case F.UTCTime:return mbe;case F.UniversalString:return abe;case F.Utf8String:return BF;case F.VideotexString:return dbe;case F.VisibleString:return pbe;default:return null}}function Zo(r){return typeof r=="function"&&r.prototype?r.prototype.toASN&&r.prototype.fromASN?!0:Zo(r.prototype):!!(r&&typeof r=="object"&&"toASN"in r&&"fromASN"in r)}function UF(r){var e;if(r){const t=Object.getPrototypeOf(r);return((e=t==null?void 0:t.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:UF(t)}return!1}function vbe(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<r.byteLength;i++)if(t[i]!==n[i])return!1;return!0}class Ebe{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){const n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!n.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return n}cache(e){const t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){const t={type:X.Sequence,items:{}},n=this.findParentSchema(e);return n&&(Object.assign(t,n),t.items=Object.assign({},t.items,n.items)),t}create(e,t){const n=this.items.get(e)||this.createDefault(e),i=[];for(const s in n.items){const o=n.items[s],a=t?s:"";let c;if(typeof o.type=="number"){const d=F[o.type],h=dF[d];if(!h)throw new Error(`Cannot get ASN1 class by name '${d}'`);c=new h({name:a})}else Zo(o.type)?c=new o.type().toSchema(a):o.optional?this.get(o.type).type===X.Choice?c=new ou({name:a}):(c=this.create(o.type,!1),c.name=a):c=new ou({name:a});const l=!!o.optional||o.defaultValue!==void 0;if(o.repeated){c.name="";const d=o.repeated==="set"?Yo:yr;c=new d({name:"",value:[new tw({name:a,value:c})]})}if(o.context!==null&&o.context!==void 0)if(o.implicit)if(typeof o.type=="number"||Zo(o.type)){const d=o.repeated?Pn:Ep;i.push(new d({name:a,optional:l,idBlock:{tagClass:3,tagNumber:o.context}}))}else{this.cache(o.type);const d=!!o.repeated;let h=d?c:this.get(o.type,!0).schema;h="valueBlock"in h?h.valueBlock.value:h.value,i.push(new Pn({name:d?"":a,optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:h}))}else i.push(new Pn({optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:[c]}));else c.optional=l,i.push(c)}switch(n.type){case X.Sequence:return new yr({value:i,name:""});case X.Set:return new Yo({value:i,name:""});case X.Choice:return new VE({value:i,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){const t=Object.getPrototypeOf(e);return t?this.items.get(t)||this.findParentSchema(t):null}}const Ni=new Ebe,te=r=>e=>{let t;Ni.has(e)?t=Ni.get(e):(t=Ni.createDefault(e),Ni.set(e,t)),Object.assign(t,r)},$=r=>(e,t)=>{let n;Ni.has(e.constructor)?n=Ni.get(e.constructor):(n=Ni.createDefault(e.constructor),Ni.set(e.constructor,n));const i=Object.assign({},r);if(typeof i.type=="number"&&!i.converter){const s=rS(r.type);if(!s)throw new Error(`Cannot get default converter for property '${t}' of ${e.constructor.name}`);i.converter=s}n.items[t]=i};class FF extends Error{constructor(){super(...arguments),this.schemas=[]}}class Sbe{static parse(e,t){const n=Wo(e);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,t)}static fromASN(e,t){var n;try{if(Zo(t))return new t().fromASN(e);const i=Ni.get(t);Ni.cache(t);let s=i.schema;if(e.constructor===Pn&&i.type!==X.Choice){s=new Pn({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:i.schema.valueBlock.value});for(const c in i.items)delete e[c]}const o=au({},e,s);if(!o.verified)throw new FF(`Data does not match to ${t.name} ASN1 schema. ${o.result.error}`);const a=new t;if(UF(t)){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const c=i.itemType;if(typeof c=="number"){const l=rS(c);if(!l)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);return t.from(e.valueBlock.value,d=>l.fromASN(d))}else return t.from(e.valueBlock.value,l=>this.fromASN(l,c))}for(const c in i.items){const l=o.result[c];if(!l)continue;const d=i.items[c],h=d.type;if(typeof h=="number"||Zo(h)){const p=(n=d.converter)!==null&&n!==void 0?n:Zo(h)?new h:null;if(!p)throw new Error("Converter is empty");if(d.repeated)if(d.implicit){const b=d.repeated==="sequence"?yr:Yo,f=new b;f.valueBlock=l.valueBlock;const g=Wo(f.toBER(!1));if(g.offset===-1)throw new Error(`Cannot parse the child item. ${g.result.error}`);if(!("value"in g.result.valueBlock&&Array.isArray(g.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const v=g.result.valueBlock.value;a[c]=Array.from(v,y=>p.fromASN(y))}else a[c]=Array.from(l,b=>p.fromASN(b));else{let b=l;if(d.implicit){let f;if(Zo(h))f=new h().toSchema("");else{const g=F[h],v=dF[g];if(!v)throw new Error(`Cannot get '${g}' class from asn1js module`);f=new v}f.valueBlock=b.valueBlock,b=Wo(f.toBER(!1)).result}a[c]=p.fromASN(b)}}else if(d.repeated){if(!Array.isArray(l))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");a[c]=Array.from(l,p=>this.fromASN(p,h))}else a[c]=this.fromASN(l,h)}return a}catch(i){throw i instanceof FF&&i.schemas.push(t.name),i}}}class nS{static serialize(e){return e instanceof Cr?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&typeof e=="object"&&Zo(e))return e.toASN();if(!(e&&typeof e=="object"))throw new TypeError("Parameter 1 should be type of Object.");const t=e.constructor,n=Ni.get(t);Ni.cache(t);let i=[];if(n.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if(typeof n.itemType=="number"){const o=rS(n.itemType);if(!o)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);i=e.map(a=>o.toASN(a))}else i=e.map(o=>this.toAsnItem({type:n.itemType},"[]",t,o))}else for(const o in n.items){const a=n.items[o],c=e[o];if(c===void 0||a.defaultValue===c||typeof a.defaultValue=="object"&&typeof c=="object"&&vbe(this.serialize(a.defaultValue),this.serialize(c)))continue;const l=nS.toAsnItem(a,o,t,c);if(typeof a.context=="number")if(a.implicit)if(!a.repeated&&(typeof a.type=="number"||Zo(a.type))){const d={};d.valueHex=l instanceof Go?l.valueBeforeDecodeView:l.valueBlock.toBER(),i.push(new Ep({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},...d}))}else i.push(new Pn({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:l.valueBlock.value}));else i.push(new Pn({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:[l]}));else a.repeated?i=i.concat(l):i.push(l)}let s;switch(n.type){case X.Sequence:s=new yr({value:i});break;case X.Set:s=new Yo({value:i});break;case X.Choice:if(!i[0])throw new Error(`Schema '${t.name}' has wrong data. Choice cannot be empty.`);s=i[0];break}return s}static toAsnItem(e,t,n,i){let s;if(typeof e.type=="number"){const o=e.converter;if(!o)throw new Error(`Property '${t}' doesn't have converter for type ${F[e.type]} in schema '${n.name}'`);if(e.repeated){if(!Array.isArray(i))throw new TypeError("Parameter 'objProp' should be type of Array.");const a=Array.from(i,l=>o.toASN(l)),c=e.repeated==="sequence"?yr:Yo;s=new c({value:a})}else s=o.toASN(i)}else if(e.repeated){if(!Array.isArray(i))throw new TypeError("Parameter 'objProp' should be type of Array.");const o=Array.from(i,c=>this.toASN(c)),a=e.repeated==="sequence"?yr:Yo;s=new a({value:o})}else s=this.toASN(i);return s}}class ht extends Array{constructor(e=[]){if(typeof e=="number")super(e);else{super();for(const t of e)this.push(t)}}}class le{static serialize(e){return nS.serialize(e)}static parse(e,t){return Sbe.parse(e,t)}static toString(e){const t=he.isBufferSource(e)?he.toArrayBuffer(e):le.serialize(e),n=Wo(t);if(n.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${n.result.error}`);return n.result.toString()}}function _(r,e,t,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}typeof SuppressedError=="function"&&SuppressedError;class zF{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){const t=e.split(".");if(t.length!==4)throw new Error("Invalid IPv4 address");return t.map(n=>{const i=parseInt(n,10);if(isNaN(i)||i<0||i>255)throw new Error("Invalid IPv4 address part");return i})}static parseIPv6(e){const n=this.expandIPv6(e).split(":");if(n.length!==8)throw new Error("Invalid IPv6 address");return n.reduce((i,s)=>{const o=parseInt(s,16);if(isNaN(o)||o<0||o>65535)throw new Error("Invalid IPv6 address part");return i.push(o>>8&255),i.push(o&255),i},[])}static expandIPv6(e){if(!e.includes("::"))return e;const t=e.split("::");if(t.length>2)throw new Error("Invalid IPv6 address");const n=t[0]?t[0].split(":"):[],i=t[1]?t[1].split(":"):[],s=8-(n.length+i.length);if(s<0)throw new Error("Invalid IPv6 address");return[...n,...Array(s).fill("0"),...i].join(":")}static formatIPv6(e){const t=[];for(let n=0;n<16;n+=2)t.push((e[n]<<8|e[n+1]).toString(16));return this.compressIPv6(t.join(":"))}static compressIPv6(e){const t=e.split(":");let n=-1,i=0,s=-1,o=0;for(let a=0;a<t.length;a++)t[a]==="0"?(s===-1&&(s=a),o++):(o>i&&(n=s,i=o),s=-1,o=0);if(o>i&&(n=s,i=o),i>1){const a=t.slice(0,n).join(":"),c=t.slice(n+i).join(":");return`${a}::${c}`}return e}static parseCIDR(e){const[t,n]=e.split("/"),i=parseInt(n,10);if(this.isIPv4(t)){if(i<0||i>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(t),i]}else{if(i<0||i>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(t),i]}}static decodeIP(e){if(e.length===64&&parseInt(e,16)===0)return"::/0";if(e.length!==16)return e;const t=parseInt(e.slice(8),16).toString(2).split("").reduce((i,s)=>i+ +s,0);let n=e.slice(0,8).replace(/(.{2})/g,i=>`${parseInt(i,16)}.`);return n=n.slice(0,-1),`${n}/${t}`}static toString(e){const t=new Uint8Array(e);if(t.length===4)return Array.from(t).join(".");if(t.length===16)return this.formatIPv6(t);if(t.length===8||t.length===32){const n=t.length/2,i=t.slice(0,n),s=t.slice(n);if(t.every(c=>c===0))return t.length===8?"0.0.0.0/0":"::/0";const a=s.reduce((c,l)=>c+(l.toString(2).match(/1/g)||[]).length,0);return t.length===8?`${Array.from(i).join(".")}/${a}`:`${this.formatIPv6(i)}/${a}`}return this.decodeIP(xe.ToHex(e))}static fromString(e){if(e.includes("/")){const[n,i]=this.parseCIDR(e),s=new Uint8Array(n.length);let o=i;for(let c=0;c<s.length;c++)o>=8?(s[c]=255,o-=8):o>0&&(s[c]=255<<8-o,o=0);const a=new Uint8Array(n.length*2);return a.set(n,0),a.set(s,n.length),a.buffer}const t=this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e);return new Uint8Array(t).buffer}}var iS,sS,oS;let kr=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};_([$({type:F.TeletexString})],kr.prototype,"teletexString",void 0),_([$({type:F.PrintableString})],kr.prototype,"printableString",void 0),_([$({type:F.UniversalString})],kr.prototype,"universalString",void 0),_([$({type:F.Utf8String})],kr.prototype,"utf8String",void 0),_([$({type:F.BmpString})],kr.prototype,"bmpString",void 0),kr=_([te({type:X.Choice})],kr);let yh=class extends kr{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?xe.ToHex(this.anyValue):super.toString())}};_([$({type:F.IA5String})],yh.prototype,"ia5String",void 0),_([$({type:F.Any})],yh.prototype,"anyValue",void 0),yh=_([te({type:X.Choice})],yh);class aw{constructor(e={}){this.type="",this.value=new yh,Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],aw.prototype,"type",void 0),_([$({type:yh})],aw.prototype,"value",void 0);let mh=iS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,iS.prototype)}};mh=iS=_([te({type:X.Set,itemType:aw})],mh);let aS=sS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,sS.prototype)}};aS=sS=_([te({type:X.Sequence,itemType:mh})],aS);let Jt=oS=class extends aS{constructor(e){super(e),Object.setPrototypeOf(this,oS.prototype)}};Jt=oS=_([te({type:X.Sequence})],Jt);const xbe={fromASN:r=>zF.toString(ow.fromASN(r)),toASN:r=>ow.toASN(zF.fromString(r))};class _p{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],_p.prototype,"typeId",void 0),_([$({type:F.Any,context:0})],_p.prototype,"value",void 0);class cS{constructor(e={}){this.partyName=new kr,Object.assign(this,e)}}_([$({type:kr,optional:!0,context:0,implicit:!0})],cS.prototype,"nameAssigner",void 0),_([$({type:kr,context:1,implicit:!0})],cS.prototype,"partyName",void 0);let Fe=class{constructor(e={}){Object.assign(this,e)}};_([$({type:_p,context:0,implicit:!0})],Fe.prototype,"otherName",void 0),_([$({type:F.IA5String,context:1,implicit:!0})],Fe.prototype,"rfc822Name",void 0),_([$({type:F.IA5String,context:2,implicit:!0})],Fe.prototype,"dNSName",void 0),_([$({type:F.Any,context:3,implicit:!0})],Fe.prototype,"x400Address",void 0),_([$({type:Jt,context:4,implicit:!1})],Fe.prototype,"directoryName",void 0),_([$({type:cS,context:5})],Fe.prototype,"ediPartyName",void 0),_([$({type:F.IA5String,context:6,implicit:!0})],Fe.prototype,"uniformResourceIdentifier",void 0),_([$({type:F.OctetString,context:7,implicit:!0,converter:xbe})],Fe.prototype,"iPAddress",void 0),_([$({type:F.ObjectIdentifier,context:8,implicit:!0})],Fe.prototype,"registeredID",void 0),Fe=_([te({type:X.Choice})],Fe);const lS="1.3.6.1.5.5.7",Abe=`${lS}.1`,wh=`${lS}.3`,cw=`${lS}.48`,VF=`${cw}.1`,KF=`${cw}.2`,jF=`${cw}.3`,HF=`${cw}.5`,Rc="2.5.29";var uS;const dS=`${Abe}.1`;class Tp{constructor(e={}){this.accessMethod="",this.accessLocation=new Fe,Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],Tp.prototype,"accessMethod",void 0),_([$({type:Fe})],Tp.prototype,"accessLocation",void 0);let bh=uS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,uS.prototype)}};bh=uS=_([te({type:X.Sequence,itemType:Tp})],bh);const hS=`${Rc}.35`;class fS extends tt{}class uu{constructor(e={}){e&&Object.assign(this,e)}}_([$({type:fS,context:0,optional:!0,implicit:!0})],uu.prototype,"keyIdentifier",void 0),_([$({type:Fe,context:1,optional:!0,implicit:!0,repeated:"sequence"})],uu.prototype,"authorityCertIssuer",void 0),_([$({type:F.Integer,context:2,optional:!0,implicit:!0,converter:Dt})],uu.prototype,"authorityCertSerialNumber",void 0);const qF=`${Rc}.19`;class lw{constructor(e={}){this.cA=!1,Object.assign(this,e)}}_([$({type:F.Boolean,defaultValue:!1})],lw.prototype,"cA",void 0),_([$({type:F.Integer,optional:!0})],lw.prototype,"pathLenConstraint",void 0);var pS;let yn=pS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,pS.prototype)}};yn=pS=_([te({type:X.Sequence,itemType:Fe})],yn);var gS;let WF=gS=class extends yn{constructor(e){super(e),Object.setPrototypeOf(this,gS.prototype)}};WF=gS=_([te({type:X.Sequence})],WF);var yS;const GF=`${Rc}.32`;let ea=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};_([$({type:F.IA5String})],ea.prototype,"ia5String",void 0),_([$({type:F.VisibleString})],ea.prototype,"visibleString",void 0),_([$({type:F.BmpString})],ea.prototype,"bmpString",void 0),_([$({type:F.Utf8String})],ea.prototype,"utf8String",void 0),ea=_([te({type:X.Choice})],ea);class mS{constructor(e={}){this.organization=new ea,this.noticeNumbers=[],Object.assign(this,e)}}_([$({type:ea})],mS.prototype,"organization",void 0),_([$({type:F.Integer,repeated:"sequence"})],mS.prototype,"noticeNumbers",void 0);class wS{constructor(e={}){Object.assign(this,e)}}_([$({type:mS,optional:!0})],wS.prototype,"noticeRef",void 0),_([$({type:ea,optional:!0})],wS.prototype,"explicitText",void 0);let uw=class{constructor(e={}){Object.assign(this,e)}};_([$({type:F.IA5String})],uw.prototype,"cPSuri",void 0),_([$({type:wS})],uw.prototype,"userNotice",void 0),uw=_([te({type:X.Choice})],uw);class bS{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],bS.prototype,"policyQualifierId",void 0),_([$({type:F.Any})],bS.prototype,"qualifier",void 0);class dw{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],dw.prototype,"policyIdentifier",void 0),_([$({type:bS,repeated:"sequence",optional:!0})],dw.prototype,"policyQualifiers",void 0);let hw=yS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,yS.prototype)}};hw=yS=_([te({type:X.Sequence,itemType:dw})],hw);let fw=class{constructor(e=0){this.value=e}};_([$({type:F.Integer})],fw.prototype,"value",void 0),fw=_([te({type:X.Choice})],fw);let QF=class extends fw{};QF=_([te({type:X.Choice})],QF);var vS;const ES=`${Rc}.31`;var fs;(function(r){r[r.unused=1]="unused",r[r.keyCompromise=2]="keyCompromise",r[r.cACompromise=4]="cACompromise",r[r.affiliationChanged=8]="affiliationChanged",r[r.superseded=16]="superseded",r[r.cessationOfOperation=32]="cessationOfOperation",r[r.certificateHold=64]="certificateHold",r[r.privilegeWithdrawn=128]="privilegeWithdrawn",r[r.aACompromise=256]="aACompromise"})(fs||(fs={}));class JF extends sw{toJSON(){const e=[],t=this.toNumber();return t&fs.aACompromise&&e.push("aACompromise"),t&fs.affiliationChanged&&e.push("affiliationChanged"),t&fs.cACompromise&&e.push("cACompromise"),t&fs.certificateHold&&e.push("certificateHold"),t&fs.cessationOfOperation&&e.push("cessationOfOperation"),t&fs.keyCompromise&&e.push("keyCompromise"),t&fs.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&fs.superseded&&e.push("superseded"),t&fs.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}}let du=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Fe,context:0,repeated:"sequence",implicit:!0})],du.prototype,"fullName",void 0),_([$({type:mh,context:1,implicit:!0})],du.prototype,"nameRelativeToCRLIssuer",void 0),du=_([te({type:X.Choice})],du);class vh{constructor(e={}){Object.assign(this,e)}}_([$({type:du,context:0,optional:!0})],vh.prototype,"distributionPoint",void 0),_([$({type:JF,context:1,optional:!0,implicit:!0})],vh.prototype,"reasons",void 0),_([$({type:Fe,context:2,optional:!0,repeated:"sequence",implicit:!0})],vh.prototype,"cRLIssuer",void 0);let Eh=vS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,vS.prototype)}};Eh=vS=_([te({type:X.Sequence,itemType:vh})],Eh);var SS;let YF=SS=class extends Eh{constructor(e){super(e),Object.setPrototypeOf(this,SS.prototype)}};YF=SS=_([te({type:X.Sequence,itemType:vh})],YF);class Kr{constructor(e={}){this.onlyContainsUserCerts=Kr.ONLY,this.onlyContainsCACerts=Kr.ONLY,this.indirectCRL=Kr.ONLY,this.onlyContainsAttributeCerts=Kr.ONLY,Object.assign(this,e)}}Kr.ONLY=!1,_([$({type:du,context:0,optional:!0})],Kr.prototype,"distributionPoint",void 0),_([$({type:F.Boolean,context:1,defaultValue:Kr.ONLY,implicit:!0})],Kr.prototype,"onlyContainsUserCerts",void 0),_([$({type:F.Boolean,context:2,defaultValue:Kr.ONLY,implicit:!0})],Kr.prototype,"onlyContainsCACerts",void 0),_([$({type:JF,context:3,optional:!0,implicit:!0})],Kr.prototype,"onlySomeReasons",void 0),_([$({type:F.Boolean,context:4,defaultValue:Kr.ONLY,implicit:!0})],Kr.prototype,"indirectCRL",void 0),_([$({type:F.Boolean,context:5,defaultValue:Kr.ONLY,implicit:!0})],Kr.prototype,"onlyContainsAttributeCerts",void 0);var Pp;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(Pp||(Pp={}));let xS=class{constructor(e=Pp.unspecified){this.reason=Pp.unspecified,this.reason=e}toJSON(){return Pp[this.reason]}toString(){return this.toJSON()}};_([$({type:F.Enumerated})],xS.prototype,"reason",void 0),xS=_([te({type:X.Choice})],xS);var AS;const XF=`${Rc}.37`;let pw=AS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,AS.prototype)}};pw=AS=_([te({type:X.Sequence,itemType:F.ObjectIdentifier})],pw);const Cbe=`${wh}.1`,Ibe=`${wh}.2`,kbe=`${wh}.3`,_be=`${wh}.4`,Tbe=`${wh}.8`,Pbe=`${wh}.9`;let CS=class{constructor(e=new ArrayBuffer(0)){this.value=e}};_([$({type:F.Integer,converter:Dt})],CS.prototype,"value",void 0),CS=_([te({type:X.Choice})],CS);let IS=class{constructor(e){this.value=new Date,e&&(this.value=e)}};_([$({type:F.GeneralizedTime})],IS.prototype,"value",void 0),IS=_([te({type:X.Choice})],IS);var kS;let ZF=kS=class extends yn{constructor(e){super(e),Object.setPrototypeOf(this,kS.prototype)}};ZF=kS=_([te({type:X.Sequence})],ZF);const ez=`${Rc}.15`;var ps;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(ps||(ps={}));class _S extends sw{toJSON(){const e=this.toNumber(),t=[];return e&ps.cRLSign&&t.push("crlSign"),e&ps.dataEncipherment&&t.push("dataEncipherment"),e&ps.decipherOnly&&t.push("decipherOnly"),e&ps.digitalSignature&&t.push("digitalSignature"),e&ps.encipherOnly&&t.push("encipherOnly"),e&ps.keyAgreement&&t.push("keyAgreement"),e&ps.keyCertSign&&t.push("keyCertSign"),e&ps.keyEncipherment&&t.push("keyEncipherment"),e&ps.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}}var TS;class gw{constructor(e={}){this.base=new Fe,this.minimum=0,Object.assign(this,e)}}_([$({type:Fe})],gw.prototype,"base",void 0),_([$({type:F.Integer,context:0,defaultValue:0,implicit:!0})],gw.prototype,"minimum",void 0),_([$({type:F.Integer,context:1,optional:!0,implicit:!0})],gw.prototype,"maximum",void 0);let yw=TS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,TS.prototype)}};yw=TS=_([te({type:X.Sequence,itemType:gw})],yw);class tz{constructor(e={}){Object.assign(this,e)}}_([$({type:yw,context:0,optional:!0,implicit:!0})],tz.prototype,"permittedSubtrees",void 0),_([$({type:yw,context:1,optional:!0,implicit:!0})],tz.prototype,"excludedSubtrees",void 0);class rz{constructor(e={}){Object.assign(this,e)}}_([$({type:F.Integer,context:0,implicit:!0,optional:!0,converter:Dt})],rz.prototype,"requireExplicitPolicy",void 0),_([$({type:F.Integer,context:1,implicit:!0,optional:!0,converter:Dt})],rz.prototype,"inhibitPolicyMapping",void 0);var PS;class DS{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],DS.prototype,"issuerDomainPolicy",void 0),_([$({type:F.ObjectIdentifier})],DS.prototype,"subjectDomainPolicy",void 0);let nz=PS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,PS.prototype)}};nz=PS=_([te({type:X.Sequence,itemType:DS})],nz);var $S;const iz=`${Rc}.17`;let NS=$S=class extends yn{constructor(e){super(e),Object.setPrototypeOf(this,$S.prototype)}};NS=$S=_([te({type:X.Sequence})],NS);let ta=class{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}};_([$({type:F.ObjectIdentifier})],ta.prototype,"type",void 0),_([$({type:F.Any,repeated:"set"})],ta.prototype,"values",void 0);var MS;let sz=MS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,MS.prototype)}};sz=MS=_([te({type:X.Sequence,itemType:ta})],sz);const oz=`${Rc}.14`;class Lc extends fS{}class az{constructor(e={}){Object.assign(this,e)}}_([$({type:F.GeneralizedTime,context:0,implicit:!0,optional:!0})],az.prototype,"notBefore",void 0),_([$({type:F.GeneralizedTime,context:1,implicit:!0,optional:!0})],az.prototype,"notAfter",void 0);var Dp;(function(r){r[r.keyUpdateAllowed=1]="keyUpdateAllowed",r[r.newExtensions=2]="newExtensions",r[r.pKIXCertificate=4]="pKIXCertificate"})(Dp||(Dp={}));class cz extends sw{toJSON(){const e=[],t=this.toNumber();return t&Dp.pKIXCertificate&&e.push("pKIXCertificate"),t&Dp.newExtensions&&e.push("newExtensions"),t&Dp.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}}class lz{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new cz,Object.assign(this,e)}}_([$({type:F.GeneralString})],lz.prototype,"entrustVers",void 0),_([$({type:cz})],lz.prototype,"entrustInfoFlags",void 0);var OS;let uz=OS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,OS.prototype)}};uz=OS=_([te({type:X.Sequence,itemType:Tp})],uz);class me{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof me&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&hU(e.parameters,this.parameters)||e.parameters===this.parameters)}}_([$({type:F.ObjectIdentifier})],me.prototype,"algorithm",void 0),_([$({type:F.Any,optional:!0})],me.prototype,"parameters",void 0);class gs{constructor(e={}){this.algorithm=new me,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:me})],gs.prototype,"algorithm",void 0),_([$({type:F.BitString})],gs.prototype,"subjectPublicKey",void 0);let _r=class{constructor(e){if(e)if(typeof e=="string"||typeof e=="number"||e instanceof Date){const t=new Date(e);t.getUTCFullYear()>2049?this.generalTime=t:this.utcTime=t}else Object.assign(this,e)}getTime(){const e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};_([$({type:F.UTCTime})],_r.prototype,"utcTime",void 0),_([$({type:F.GeneralizedTime})],_r.prototype,"generalTime",void 0),_r=_([te({type:X.Choice})],_r);class $p{constructor(e){this.notBefore=new _r(new Date),this.notAfter=new _r(new Date),e&&(this.notBefore=new _r(e.notBefore),this.notAfter=new _r(e.notAfter))}}_([$({type:_r})],$p.prototype,"notBefore",void 0),_([$({type:_r})],$p.prototype,"notAfter",void 0);var RS;let Mi=class sq{constructor(e={}){this.extnID="",this.critical=sq.CRITICAL,this.extnValue=new tt,Object.assign(this,e)}};Mi.CRITICAL=!1,_([$({type:F.ObjectIdentifier})],Mi.prototype,"extnID",void 0),_([$({type:F.Boolean,defaultValue:Mi.CRITICAL})],Mi.prototype,"critical",void 0),_([$({type:tt})],Mi.prototype,"extnValue",void 0);let Bc=RS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,RS.prototype)}};Bc=RS=_([te({type:X.Sequence,itemType:Mi})],Bc);var hu;(function(r){r[r.v1=0]="v1",r[r.v2=1]="v2",r[r.v3=2]="v3"})(hu||(hu={}));class hi{constructor(e={}){this.version=hu.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new me,this.issuer=new Jt,this.validity=new $p,this.subject=new Jt,this.subjectPublicKeyInfo=new gs,Object.assign(this,e)}}_([$({type:F.Integer,context:0,defaultValue:hu.v1})],hi.prototype,"version",void 0),_([$({type:F.Integer,converter:Dt})],hi.prototype,"serialNumber",void 0),_([$({type:me})],hi.prototype,"signature",void 0),_([$({type:Jt})],hi.prototype,"issuer",void 0),_([$({type:$p})],hi.prototype,"validity",void 0),_([$({type:Jt})],hi.prototype,"subject",void 0),_([$({type:gs})],hi.prototype,"subjectPublicKeyInfo",void 0),_([$({type:F.BitString,context:1,implicit:!0,optional:!0})],hi.prototype,"issuerUniqueID",void 0),_([$({type:F.BitString,context:2,implicit:!0,optional:!0})],hi.prototype,"subjectUniqueID",void 0),_([$({type:Bc,context:3,optional:!0})],hi.prototype,"extensions",void 0);class fu{constructor(e={}){this.tbsCertificate=new hi,this.signatureAlgorithm=new me,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:hi})],fu.prototype,"tbsCertificate",void 0),_([$({type:me})],fu.prototype,"signatureAlgorithm",void 0),_([$({type:F.BitString})],fu.prototype,"signatureValue",void 0);class mw{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new _r,Object.assign(this,e)}}_([$({type:F.Integer,converter:Dt})],mw.prototype,"userCertificate",void 0),_([$({type:_r})],mw.prototype,"revocationDate",void 0),_([$({type:Mi,optional:!0,repeated:"sequence"})],mw.prototype,"crlEntryExtensions",void 0);class ra{constructor(e={}){this.signature=new me,this.issuer=new Jt,this.thisUpdate=new _r,Object.assign(this,e)}}_([$({type:F.Integer,optional:!0})],ra.prototype,"version",void 0),_([$({type:me})],ra.prototype,"signature",void 0),_([$({type:Jt})],ra.prototype,"issuer",void 0),_([$({type:_r})],ra.prototype,"thisUpdate",void 0),_([$({type:_r,optional:!0})],ra.prototype,"nextUpdate",void 0),_([$({type:mw,repeated:"sequence",optional:!0})],ra.prototype,"revokedCertificates",void 0),_([$({type:Mi,optional:!0,context:0,repeated:"sequence"})],ra.prototype,"crlExtensions",void 0);class LS{constructor(e={}){this.tbsCertList=new ra,this.signatureAlgorithm=new me,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:ra})],LS.prototype,"tbsCertList",void 0),_([$({type:me})],LS.prototype,"signatureAlgorithm",void 0),_([$({type:F.BitString})],LS.prototype,"signature",void 0);class Sh{constructor(e={}){this.issuer=new Jt,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:Jt})],Sh.prototype,"issuer",void 0),_([$({type:F.Integer,converter:Dt})],Sh.prototype,"serialNumber",void 0);let xh=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Lc,context:0,implicit:!0})],xh.prototype,"subjectKeyIdentifier",void 0),_([$({type:Sh})],xh.prototype,"issuerAndSerialNumber",void 0),xh=_([te({type:X.Choice})],xh);var na;(function(r){r[r.v0=0]="v0",r[r.v1=1]="v1",r[r.v2=2]="v2",r[r.v3=3]="v3",r[r.v4=4]="v4",r[r.v5=5]="v5"})(na||(na={}));let Np=class extends me{};Np=_([te({type:X.Sequence})],Np);let ww=class extends me{};ww=_([te({type:X.Sequence})],ww);let Gs=class extends me{};Gs=_([te({type:X.Sequence})],Gs);let bw=class extends me{};bw=_([te({type:X.Sequence})],bw);let dz=class extends me{};dz=_([te({type:X.Sequence})],dz);let BS=class extends me{};BS=_([te({type:X.Sequence})],BS);let Ah=class{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}};_([$({type:F.ObjectIdentifier})],Ah.prototype,"attrType",void 0),_([$({type:F.Any,repeated:"set"})],Ah.prototype,"attrValues",void 0);var US;class Qs{constructor(e={}){this.version=na.v0,this.sid=new xh,this.digestAlgorithm=new Np,this.signatureAlgorithm=new ww,this.signature=new tt,Object.assign(this,e)}}_([$({type:F.Integer})],Qs.prototype,"version",void 0),_([$({type:xh})],Qs.prototype,"sid",void 0),_([$({type:Np})],Qs.prototype,"digestAlgorithm",void 0),_([$({type:Ah,repeated:"set",context:0,implicit:!0,optional:!0})],Qs.prototype,"signedAttrs",void 0),_([$({type:ww})],Qs.prototype,"signatureAlgorithm",void 0),_([$({type:tt})],Qs.prototype,"signature",void 0),_([$({type:Ah,repeated:"set",context:1,implicit:!0,optional:!0})],Qs.prototype,"unsignedAttrs",void 0);let vw=US=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,US.prototype)}};vw=US=_([te({type:X.Set,itemType:Qs})],vw);let hz=class extends _r{};hz=_([te({type:X.Choice})],hz);let fz=class extends Qs{};fz=_([te({type:X.Sequence})],fz);class FS{constructor(e={}){this.acIssuer=new Fe,this.acSerial=0,this.attrs=[],Object.assign(this,e)}}_([$({type:Fe})],FS.prototype,"acIssuer",void 0),_([$({type:F.Integer})],FS.prototype,"acSerial",void 0),_([$({type:ta,repeated:"sequence"})],FS.prototype,"attrs",void 0);var zS;let Ew=zS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,zS.prototype)}};Ew=zS=_([te({type:X.Sequence,itemType:F.ObjectIdentifier})],Ew);class Sw{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}}_([$({type:F.Integer,optional:!0})],Sw.prototype,"pathLenConstraint",void 0),_([$({type:Ew,implicit:!0,context:0,optional:!0})],Sw.prototype,"permittedAttrs",void 0),_([$({type:Ew,implicit:!0,context:1,optional:!0})],Sw.prototype,"excludedAttrs",void 0),_([$({type:F.Boolean,defaultValue:!0})],Sw.prototype,"permitUnSpecified",void 0);class pu{constructor(e={}){this.issuer=new yn,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:yn})],pu.prototype,"issuer",void 0),_([$({type:F.Integer,converter:Dt})],pu.prototype,"serial",void 0),_([$({type:F.BitString,optional:!0})],pu.prototype,"issuerUID",void 0);var VS;(function(r){r[r.publicKey=0]="publicKey",r[r.publicKeyCert=1]="publicKeyCert",r[r.otherObjectTypes=2]="otherObjectTypes"})(VS||(VS={}));class gu{constructor(e={}){this.digestedObjectType=VS.publicKey,this.digestAlgorithm=new me,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.Enumerated})],gu.prototype,"digestedObjectType",void 0),_([$({type:F.ObjectIdentifier,optional:!0})],gu.prototype,"otherObjectTypeID",void 0),_([$({type:me})],gu.prototype,"digestAlgorithm",void 0),_([$({type:F.BitString})],gu.prototype,"objectDigest",void 0);class xw{constructor(e={}){Object.assign(this,e)}}_([$({type:yn,optional:!0})],xw.prototype,"issuerName",void 0),_([$({type:pu,context:0,implicit:!0,optional:!0})],xw.prototype,"baseCertificateID",void 0),_([$({type:gu,context:1,implicit:!0,optional:!0})],xw.prototype,"objectDigestInfo",void 0);let Ch=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Fe,repeated:"sequence"})],Ch.prototype,"v1Form",void 0),_([$({type:xw,context:0,implicit:!0})],Ch.prototype,"v2Form",void 0),Ch=_([te({type:X.Choice})],Ch);class Aw{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}}_([$({type:F.GeneralizedTime})],Aw.prototype,"notBeforeTime",void 0),_([$({type:F.GeneralizedTime})],Aw.prototype,"notAfterTime",void 0);class Mp{constructor(e={}){Object.assign(this,e)}}_([$({type:pu,implicit:!0,context:0,optional:!0})],Mp.prototype,"baseCertificateID",void 0),_([$({type:yn,implicit:!0,context:1,optional:!0})],Mp.prototype,"entityName",void 0),_([$({type:gu,implicit:!0,context:2,optional:!0})],Mp.prototype,"objectDigestInfo",void 0);var KS;(function(r){r[r.v2=1]="v2"})(KS||(KS={}));class ys{constructor(e={}){this.version=KS.v2,this.holder=new Mp,this.issuer=new Ch,this.signature=new me,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new Aw,this.attributes=[],Object.assign(this,e)}}_([$({type:F.Integer})],ys.prototype,"version",void 0),_([$({type:Mp})],ys.prototype,"holder",void 0),_([$({type:Ch})],ys.prototype,"issuer",void 0),_([$({type:me})],ys.prototype,"signature",void 0),_([$({type:F.Integer,converter:Dt})],ys.prototype,"serialNumber",void 0),_([$({type:Aw})],ys.prototype,"attrCertValidityPeriod",void 0),_([$({type:ta,repeated:"sequence"})],ys.prototype,"attributes",void 0),_([$({type:F.BitString,optional:!0})],ys.prototype,"issuerUniqueID",void 0),_([$({type:Bc,optional:!0})],ys.prototype,"extensions",void 0);class Cw{constructor(e={}){this.acinfo=new ys,this.signatureAlgorithm=new me,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:ys})],Cw.prototype,"acinfo",void 0),_([$({type:me})],Cw.prototype,"signatureAlgorithm",void 0),_([$({type:F.BitString})],Cw.prototype,"signatureValue",void 0);var Iw;(function(r){r[r.unmarked=1]="unmarked",r[r.unclassified=2]="unclassified",r[r.restricted=4]="restricted",r[r.confidential=8]="confidential",r[r.secret=16]="secret",r[r.topSecret=32]="topSecret"})(Iw||(Iw={}));class jS extends sw{}class HS{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier,implicit:!0,context:0})],HS.prototype,"type",void 0),_([$({type:F.Any,implicit:!0,context:1})],HS.prototype,"value",void 0);class qS{constructor(e={}){this.policyId="",this.classList=new jS(Iw.unclassified),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],qS.prototype,"policyId",void 0),_([$({type:jS,defaultValue:new jS(Iw.unclassified)})],qS.prototype,"classList",void 0),_([$({type:HS,repeated:"set"})],qS.prototype,"securityCategories",void 0);class kw{constructor(e={}){Object.assign(this,e)}}_([$({type:tt})],kw.prototype,"cotets",void 0),_([$({type:F.ObjectIdentifier})],kw.prototype,"oid",void 0),_([$({type:F.Utf8String})],kw.prototype,"string",void 0);class pz{constructor(e={}){this.values=[],Object.assign(this,e)}}_([$({type:yn,implicit:!0,context:0,optional:!0})],pz.prototype,"policyAuthority",void 0),_([$({type:kw,repeated:"sequence"})],pz.prototype,"values",void 0);var WS;class _w{constructor(e={}){this.targetCertificate=new pu,Object.assign(this,e)}}_([$({type:pu})],_w.prototype,"targetCertificate",void 0),_([$({type:Fe,optional:!0})],_w.prototype,"targetName",void 0),_([$({type:gu,optional:!0})],_w.prototype,"certDigestInfo",void 0);let Ih=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Fe,context:0,implicit:!0})],Ih.prototype,"targetName",void 0),_([$({type:Fe,context:1,implicit:!0})],Ih.prototype,"targetGroup",void 0),_([$({type:_w,context:2,implicit:!0})],Ih.prototype,"targetCert",void 0),Ih=_([te({type:X.Choice})],Ih);let GS=WS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,WS.prototype)}};GS=WS=_([te({type:X.Sequence,itemType:Ih})],GS);var QS;let gz=QS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,QS.prototype)}};gz=QS=_([te({type:X.Sequence,itemType:GS})],gz);class yz{constructor(e={}){Object.assign(this,e)}}_([$({type:yn,implicit:!0,context:0,optional:!0})],yz.prototype,"roleAuthority",void 0),_([$({type:Fe,implicit:!0,context:1})],yz.prototype,"roleName",void 0);class JS{constructor(e={}){this.service=new Fe,this.ident=new Fe,Object.assign(this,e)}}_([$({type:Fe})],JS.prototype,"service",void 0),_([$({type:Fe})],JS.prototype,"ident",void 0),_([$({type:tt,optional:!0})],JS.prototype,"authInfo",void 0);var YS;class XS{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],XS.prototype,"otherCertFormat",void 0),_([$({type:F.Any})],XS.prototype,"otherCert",void 0);let kh=class{constructor(e={}){Object.assign(this,e)}};_([$({type:fu})],kh.prototype,"certificate",void 0),_([$({type:Cw,context:2,implicit:!0})],kh.prototype,"v2AttrCert",void 0),_([$({type:XS,context:3,implicit:!0})],kh.prototype,"other",void 0),kh=_([te({type:X.Choice})],kh);let Tw=YS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,YS.prototype)}};Tw=YS=_([te({type:X.Set,itemType:kh})],Tw);class _h{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],_h.prototype,"contentType",void 0),_([$({type:F.Any,context:0})],_h.prototype,"content",void 0);let Op=class{constructor(e={}){Object.assign(this,e)}};_([$({type:tt})],Op.prototype,"single",void 0),_([$({type:F.Any})],Op.prototype,"any",void 0),Op=_([te({type:X.Choice})],Op);class Pw{constructor(e={}){this.eContentType="",Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],Pw.prototype,"eContentType",void 0),_([$({type:Op,context:0,optional:!0})],Pw.prototype,"eContent",void 0);let Rp=class{constructor(e={}){Object.assign(this,e)}};_([$({type:tt,context:0,implicit:!0,optional:!0})],Rp.prototype,"value",void 0),_([$({type:tt,converter:sbe,context:0,implicit:!0,optional:!0,repeated:"sequence"})],Rp.prototype,"constructedValue",void 0),Rp=_([te({type:X.Choice})],Rp);class Lp{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new bw,Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],Lp.prototype,"contentType",void 0),_([$({type:bw})],Lp.prototype,"contentEncryptionAlgorithm",void 0),_([$({type:Rp,optional:!0})],Lp.prototype,"encryptedContent",void 0);class Dw{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],Dw.prototype,"keyAttrId",void 0),_([$({type:F.Any,optional:!0})],Dw.prototype,"keyAttr",void 0);var ZS;class $w{constructor(e={}){this.subjectKeyIdentifier=new Lc,Object.assign(this,e)}}_([$({type:Lc})],$w.prototype,"subjectKeyIdentifier",void 0),_([$({type:F.GeneralizedTime,optional:!0})],$w.prototype,"date",void 0),_([$({type:Dw,optional:!0})],$w.prototype,"other",void 0);let Th=class{constructor(e={}){Object.assign(this,e)}};_([$({type:$w,context:0,implicit:!0,optional:!0})],Th.prototype,"rKeyId",void 0),_([$({type:Sh,optional:!0})],Th.prototype,"issuerAndSerialNumber",void 0),Th=_([te({type:X.Choice})],Th);class ex{constructor(e={}){this.rid=new Th,this.encryptedKey=new tt,Object.assign(this,e)}}_([$({type:Th})],ex.prototype,"rid",void 0),_([$({type:tt})],ex.prototype,"encryptedKey",void 0);let Nw=ZS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,ZS.prototype)}};Nw=ZS=_([te({type:X.Sequence,itemType:ex})],Nw);class tx{constructor(e={}){this.algorithm=new me,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:me})],tx.prototype,"algorithm",void 0),_([$({type:F.BitString})],tx.prototype,"publicKey",void 0);let yu=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Lc,context:0,implicit:!0,optional:!0})],yu.prototype,"subjectKeyIdentifier",void 0),_([$({type:tx,context:1,implicit:!0,optional:!0})],yu.prototype,"originatorKey",void 0),_([$({type:Sh,optional:!0})],yu.prototype,"issuerAndSerialNumber",void 0),yu=_([te({type:X.Choice})],yu);class Ph{constructor(e={}){this.version=na.v3,this.originator=new yu,this.keyEncryptionAlgorithm=new Gs,this.recipientEncryptedKeys=new Nw,Object.assign(this,e)}}_([$({type:F.Integer})],Ph.prototype,"version",void 0),_([$({type:yu,context:0})],Ph.prototype,"originator",void 0),_([$({type:tt,context:1,optional:!0})],Ph.prototype,"ukm",void 0),_([$({type:Gs})],Ph.prototype,"keyEncryptionAlgorithm",void 0),_([$({type:Nw})],Ph.prototype,"recipientEncryptedKeys",void 0);let Dh=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Lc,context:0,implicit:!0})],Dh.prototype,"subjectKeyIdentifier",void 0),_([$({type:Sh})],Dh.prototype,"issuerAndSerialNumber",void 0),Dh=_([te({type:X.Choice})],Dh);class Bp{constructor(e={}){this.version=na.v0,this.rid=new Dh,this.keyEncryptionAlgorithm=new Gs,this.encryptedKey=new tt,Object.assign(this,e)}}_([$({type:F.Integer})],Bp.prototype,"version",void 0),_([$({type:Dh})],Bp.prototype,"rid",void 0),_([$({type:Gs})],Bp.prototype,"keyEncryptionAlgorithm",void 0),_([$({type:tt})],Bp.prototype,"encryptedKey",void 0);class Up{constructor(e={}){this.keyIdentifier=new tt,Object.assign(this,e)}}_([$({type:tt})],Up.prototype,"keyIdentifier",void 0),_([$({type:F.GeneralizedTime,optional:!0})],Up.prototype,"date",void 0),_([$({type:Dw,optional:!0})],Up.prototype,"other",void 0);class Fp{constructor(e={}){this.version=na.v4,this.kekid=new Up,this.keyEncryptionAlgorithm=new Gs,this.encryptedKey=new tt,Object.assign(this,e)}}_([$({type:F.Integer})],Fp.prototype,"version",void 0),_([$({type:Up})],Fp.prototype,"kekid",void 0),_([$({type:Gs})],Fp.prototype,"keyEncryptionAlgorithm",void 0),_([$({type:tt})],Fp.prototype,"encryptedKey",void 0);class zp{constructor(e={}){this.version=na.v0,this.keyEncryptionAlgorithm=new Gs,this.encryptedKey=new tt,Object.assign(this,e)}}_([$({type:F.Integer})],zp.prototype,"version",void 0),_([$({type:BS,context:0,optional:!0})],zp.prototype,"keyDerivationAlgorithm",void 0),_([$({type:Gs})],zp.prototype,"keyEncryptionAlgorithm",void 0),_([$({type:tt})],zp.prototype,"encryptedKey",void 0);class rx{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],rx.prototype,"oriType",void 0),_([$({type:F.Any})],rx.prototype,"oriValue",void 0);let Uc=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Bp,optional:!0})],Uc.prototype,"ktri",void 0),_([$({type:Ph,context:1,implicit:!0,optional:!0})],Uc.prototype,"kari",void 0),_([$({type:Fp,context:2,implicit:!0,optional:!0})],Uc.prototype,"kekri",void 0),_([$({type:zp,context:3,implicit:!0,optional:!0})],Uc.prototype,"pwri",void 0),_([$({type:rx,context:4,implicit:!0,optional:!0})],Uc.prototype,"ori",void 0),Uc=_([te({type:X.Choice})],Uc);var nx;let Mw=nx=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,nx.prototype)}};Mw=nx=_([te({type:X.Set,itemType:Uc})],Mw);var ix;class Ow{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],Ow.prototype,"otherRevInfoFormat",void 0),_([$({type:F.Any})],Ow.prototype,"otherRevInfo",void 0);let Rw=class{constructor(e={}){this.other=new Ow,Object.assign(this,e)}};_([$({type:Ow,context:1,implicit:!0})],Rw.prototype,"other",void 0),Rw=_([te({type:X.Choice})],Rw);let Lw=ix=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,ix.prototype)}};Lw=ix=_([te({type:X.Set,itemType:Rw})],Lw);class sx{constructor(e={}){Object.assign(this,e)}}_([$({type:Tw,context:0,implicit:!0,optional:!0})],sx.prototype,"certs",void 0),_([$({type:Lw,context:1,implicit:!0,optional:!0})],sx.prototype,"crls",void 0);var ox;let ax=ox=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,ox.prototype)}};ax=ox=_([te({type:X.Set,itemType:Ah})],ax);class Vp{constructor(e={}){this.version=na.v0,this.recipientInfos=new Mw,this.encryptedContentInfo=new Lp,Object.assign(this,e)}}_([$({type:F.Integer})],Vp.prototype,"version",void 0),_([$({type:sx,context:0,implicit:!0,optional:!0})],Vp.prototype,"originatorInfo",void 0),_([$({type:Mw})],Vp.prototype,"recipientInfos",void 0),_([$({type:Lp})],Vp.prototype,"encryptedContentInfo",void 0),_([$({type:ax,context:1,implicit:!0,optional:!0})],Vp.prototype,"unprotectedAttrs",void 0);const Dbe="1.2.840.113549.1.7.2";var cx;let Bw=cx=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,cx.prototype)}};Bw=cx=_([te({type:X.Set,itemType:Np})],Bw);class $h{constructor(e={}){this.version=na.v0,this.digestAlgorithms=new Bw,this.encapContentInfo=new Pw,this.signerInfos=new vw,Object.assign(this,e)}}_([$({type:F.Integer})],$h.prototype,"version",void 0),_([$({type:Bw})],$h.prototype,"digestAlgorithms",void 0),_([$({type:Pw})],$h.prototype,"encapContentInfo",void 0),_([$({type:Tw,context:0,implicit:!0,optional:!0})],$h.prototype,"certificates",void 0),_([$({type:Lw,context:1,implicit:!0,optional:!0})],$h.prototype,"crls",void 0),_([$({type:vw})],$h.prototype,"signerInfos",void 0);const Kp="1.2.840.10045.2.1",lx="1.2.840.10045.4.1",mz="1.2.840.10045.4.3.1",ux="1.2.840.10045.4.3.2",dx="1.2.840.10045.4.3.3",hx="1.2.840.10045.4.3.4",wz="1.2.840.10045.3.1.7",bz="1.3.132.0.34",vz="1.3.132.0.35";function jp(r){return new me({algorithm:r})}const $be=jp(lx);jp(mz);const Nbe=jp(ux),Mbe=jp(dx),Obe=jp(hx);let Hp=class{constructor(e={}){Object.assign(this,e)}};_([$({type:F.ObjectIdentifier})],Hp.prototype,"fieldType",void 0),_([$({type:F.Any})],Hp.prototype,"parameters",void 0),Hp=_([te({type:X.Sequence})],Hp);class Rbe extends tt{}let Nh=class{constructor(e={}){Object.assign(this,e)}};_([$({type:F.OctetString})],Nh.prototype,"a",void 0),_([$({type:F.OctetString})],Nh.prototype,"b",void 0),_([$({type:F.BitString,optional:!0})],Nh.prototype,"seed",void 0),Nh=_([te({type:X.Sequence})],Nh);var fx;(function(r){r[r.ecpVer1=1]="ecpVer1"})(fx||(fx={}));let ia=class{constructor(e={}){this.version=fx.ecpVer1,Object.assign(this,e)}};_([$({type:F.Integer})],ia.prototype,"version",void 0),_([$({type:Hp})],ia.prototype,"fieldID",void 0),_([$({type:Nh})],ia.prototype,"curve",void 0),_([$({type:Rbe})],ia.prototype,"base",void 0),_([$({type:F.Integer,converter:Dt})],ia.prototype,"order",void 0),_([$({type:F.Integer,optional:!0})],ia.prototype,"cofactor",void 0),ia=_([te({type:X.Sequence})],ia);let Fc=class{constructor(e={}){Object.assign(this,e)}};_([$({type:F.ObjectIdentifier})],Fc.prototype,"namedCurve",void 0),_([$({type:F.Null})],Fc.prototype,"implicitCurve",void 0),_([$({type:ia})],Fc.prototype,"specifiedCurve",void 0),Fc=_([te({type:X.Choice})],Fc);class Uw{constructor(e={}){this.version=1,this.privateKey=new tt,Object.assign(this,e)}}_([$({type:F.Integer})],Uw.prototype,"version",void 0),_([$({type:tt})],Uw.prototype,"privateKey",void 0),_([$({type:Fc,context:0,optional:!0})],Uw.prototype,"parameters",void 0),_([$({type:F.BitString,context:1,optional:!0})],Uw.prototype,"publicKey",void 0);class Fw{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.Integer,converter:Dt})],Fw.prototype,"r",void 0),_([$({type:F.Integer,converter:Dt})],Fw.prototype,"s",void 0);const $n="1.2.840.113549.1.1",mu=`${$n}.1`,Lbe=`${$n}.7`,Bbe=`${$n}.9`,qp=`${$n}.10`,Ube=`${$n}.2`,Fbe=`${$n}.4`,zw=`${$n}.5`,zbe=`${$n}.14`,px=`${$n}.11`,Vw=`${$n}.12`,Kw=`${$n}.13`,Ez=`${$n}.15`,Sz=`${$n}.16`,jw="1.3.14.3.2.26",xz="2.16.840.1.101.3.4.2.4",Hw="2.16.840.1.101.3.4.2.1",qw="2.16.840.1.101.3.4.2.2",Ww="2.16.840.1.101.3.4.2.3",Vbe="2.16.840.1.101.3.4.2.5",Kbe="2.16.840.1.101.3.4.2.6",jbe="1.2.840.113549.2.2",Hbe="1.2.840.113549.2.5",Gw=`${$n}.8`;function cr(r){return new me({algorithm:r,parameters:null})}cr(jbe),cr(Hbe);const wu=cr(jw);cr(xz),cr(Hw),cr(qw),cr(Ww),cr(Vbe),cr(Kbe);const Az=new me({algorithm:Gw,parameters:le.serialize(wu)}),Cz=new me({algorithm:Bbe,parameters:le.serialize(ow.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))});cr(mu),cr(Ube),cr(Fbe),cr(zw),cr(Ez),cr(Sz),cr(Vw),cr(Kw),cr(Ez),cr(Sz);class Qw{constructor(e={}){this.hashAlgorithm=new me(wu),this.maskGenAlgorithm=new me({algorithm:Gw,parameters:le.serialize(wu)}),this.pSourceAlgorithm=new me(Cz),Object.assign(this,e)}}_([$({type:me,context:0,defaultValue:wu})],Qw.prototype,"hashAlgorithm",void 0),_([$({type:me,context:1,defaultValue:Az})],Qw.prototype,"maskGenAlgorithm",void 0),_([$({type:me,context:2,defaultValue:Cz})],Qw.prototype,"pSourceAlgorithm",void 0),new me({algorithm:Lbe,parameters:le.serialize(new Qw)});class bu{constructor(e={}){this.hashAlgorithm=new me(wu),this.maskGenAlgorithm=new me({algorithm:Gw,parameters:le.serialize(wu)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}}_([$({type:me,context:0,defaultValue:wu})],bu.prototype,"hashAlgorithm",void 0),_([$({type:me,context:1,defaultValue:Az})],bu.prototype,"maskGenAlgorithm",void 0),_([$({type:F.Integer,context:2,defaultValue:20})],bu.prototype,"saltLength",void 0),_([$({type:F.Integer,context:3,defaultValue:1})],bu.prototype,"trailerField",void 0),new me({algorithm:qp,parameters:le.serialize(new bu)});class Jw{constructor(e={}){this.digestAlgorithm=new me,this.digest=new tt,Object.assign(this,e)}}_([$({type:me})],Jw.prototype,"digestAlgorithm",void 0),_([$({type:tt})],Jw.prototype,"digest",void 0);var gx;class Yw{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.Integer,converter:Dt})],Yw.prototype,"prime",void 0),_([$({type:F.Integer,converter:Dt})],Yw.prototype,"exponent",void 0),_([$({type:F.Integer,converter:Dt})],Yw.prototype,"coefficient",void 0);let yx=gx=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,gx.prototype)}};yx=gx=_([te({type:X.Sequence,itemType:Yw})],yx);class Js{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.Integer})],Js.prototype,"version",void 0),_([$({type:F.Integer,converter:Dt})],Js.prototype,"modulus",void 0),_([$({type:F.Integer,converter:Dt})],Js.prototype,"publicExponent",void 0),_([$({type:F.Integer,converter:Dt})],Js.prototype,"privateExponent",void 0),_([$({type:F.Integer,converter:Dt})],Js.prototype,"prime1",void 0),_([$({type:F.Integer,converter:Dt})],Js.prototype,"prime2",void 0),_([$({type:F.Integer,converter:Dt})],Js.prototype,"exponent1",void 0),_([$({type:F.Integer,converter:Dt})],Js.prototype,"exponent2",void 0),_([$({type:F.Integer,converter:Dt})],Js.prototype,"coefficient",void 0),_([$({type:yx,optional:!0})],Js.prototype,"otherPrimeInfos",void 0);class mx{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.Integer,converter:Dt})],mx.prototype,"modulus",void 0),_([$({type:F.Integer,converter:Dt})],mx.prototype,"publicExponent",void 0);var wx;(function(r){r[r.Transient=0]="Transient",r[r.Singleton=1]="Singleton",r[r.ResolutionScoped=2]="ResolutionScoped",r[r.ContainerScoped=3]="ContainerScoped"})(wx||(wx={}));const Nn=wx;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var bx=function(r,e){return bx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},bx(r,e)};function vx(r,e){bx(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function qbe(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(d){try{l(n.next(d))}catch(h){o(h)}}function c(d){try{l(n.throw(d))}catch(h){o(h)}}function l(d){d.done?s(d.value):i(d.value).then(a,c)}l((n=n.apply(r,[])).next())})}function Wbe(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(d){return c([l,d])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(d){l=[6,d],i=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Xw(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Zw(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s}function vu(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(Zw(arguments[e]));return r}var Gbe="injectionTokens";function Qbe(r){var e=Reflect.getMetadata("design:paramtypes",r)||[],t=Reflect.getOwnMetadata(Gbe,r)||{};return Object.keys(t).forEach(function(n){e[+n]=t[n]}),e}function Iz(r){return!!r.useClass}function Ex(r){return!!r.useFactory}var kz=function(){function r(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return r.prototype.createProxy=function(e){var t=this,n={},i=!1,s,o=function(){return i||(s=e(t.wrap()),i=!0),s};return new Proxy(n,this.createHandler(o))},r.prototype.createHandler=function(e){var t={},n=function(i){t[i]=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];s[0]=e();var a=Reflect[i];return a.apply(void 0,vu(s))}};return this.reflectMethods.forEach(n),t},r}();function Mh(r){return typeof r=="string"||typeof r=="symbol"}function Jbe(r){return typeof r=="object"&&"token"in r&&"multiple"in r}function _z(r){return typeof r=="object"&&"token"in r&&"transform"in r}function Ybe(r){return typeof r=="function"||r instanceof kz}function e4(r){return!!r.useToken}function t4(r){return r.useValue!=null}function Xbe(r){return Iz(r)||t4(r)||e4(r)||Ex(r)}var Sx=function(){function r(){this._registryMap=new Map}return r.prototype.entries=function(){return this._registryMap.entries()},r.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},r.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},r.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},r.prototype.setAll=function(e,t){this._registryMap.set(e,t)},r.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},r.prototype.clear=function(){this._registryMap.clear()},r.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},r}(),Zbe=function(r){vx(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(Sx),r4=function(){function r(){this.scopedResolutions=new Map}return r}();function eve(r,e){if(r===null)return"at position #"+e;var t=r.split(",")[e].trim();return'"'+t+'" at position #'+e}function tve(r,e,t){return t===void 0&&(t="    "),vu([r],e.message.split(`
`).map(function(n){return t+n})).join(`
`)}function rve(r,e,t){var n=Zw(r.toString().match(/constructor\(([\w, ]+)\)/)||[],2),i=n[1],s=i===void 0?null:i,o=eve(s,e);return tve("Cannot inject the dependency "+o+' of "'+r.name+'" constructor. Reason:',t)}function nve(r){if(typeof r.dispose!="function")return!1;var e=r.dispose;return!(e.length>0)}var ive=function(r){vx(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(Sx),sve=function(r){vx(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(Sx),ove=function(){function r(){this.preResolution=new ive,this.postResolution=new sve}return r}(),Tz=new Map,ave=function(){function r(e){this.parent=e,this._registry=new Zbe,this.interceptors=new ove,this.disposed=!1,this.disposables=new Set}return r.prototype.register=function(e,t,n){n===void 0&&(n={lifecycle:Nn.Transient}),this.ensureNotDisposed();var i;if(Xbe(t)?i=t:i={useClass:t},e4(i))for(var s=[e],o=i;o!=null;){var a=o.useToken;if(s.includes(a))throw new Error("Token registration cycle detected! "+vu(s,[a]).join(" -> "));s.push(a);var c=this._registry.get(a);c&&e4(c.provider)?o=c.provider:o=null}if((n.lifecycle===Nn.Singleton||n.lifecycle==Nn.ContainerScoped||n.lifecycle==Nn.ResolutionScoped)&&(t4(i)||Ex(i)))throw new Error('Cannot use lifecycle "'+Nn[n.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:i,options:n}),this},r.prototype.registerType=function(e,t){return this.ensureNotDisposed(),Mh(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},r.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},r.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),Mh(e)){if(Mh(t))return this.register(e,{useToken:t},{lifecycle:Nn.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:Nn.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var n=e;return t&&!Mh(t)&&(n=t),this.register(e,{useClass:n},{lifecycle:Nn.Singleton})},r.prototype.resolve=function(e,t,n){t===void 0&&(t=new r4),n===void 0&&(n=!1),this.ensureNotDisposed();var i=this.getRegistration(e);if(!i&&Mh(e)){if(n)return;throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"Single"),i){var s=this.resolveRegistration(i,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}if(Ybe(e)){var s=this.construct(e,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},r.prototype.executePreResolutionInterceptor=function(e,t){var n,i;if(this.interceptors.preResolution.has(e)){var s=[];try{for(var o=Xw(this.interceptors.preResolution.getAll(e)),a=o.next();!a.done;a=o.next()){var c=a.value;c.options.frequency!="Once"&&s.push(c),c.callback(e,t)}}catch(l){n={error:l}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}this.interceptors.preResolution.setAll(e,s)}},r.prototype.executePostResolutionInterceptor=function(e,t,n){var i,s;if(this.interceptors.postResolution.has(e)){var o=[];try{for(var a=Xw(this.interceptors.postResolution.getAll(e)),c=a.next();!c.done;c=a.next()){var l=c.value;l.options.frequency!="Once"&&o.push(l),l.callback(e,t,n)}}catch(d){i={error:d}}finally{try{c&&!c.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}this.interceptors.postResolution.setAll(e,o)}},r.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===Nn.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var n=e.options.lifecycle===Nn.Singleton,i=e.options.lifecycle===Nn.ContainerScoped,s=n||i,o;return t4(e.provider)?o=e.provider.useValue:e4(e.provider)?o=s?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):Iz(e.provider)?o=s?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):Ex(e.provider)?o=e.provider.useFactory(this):o=this.construct(e.provider,t),e.options.lifecycle===Nn.ResolutionScoped&&t.scopedResolutions.set(e,o),o},r.prototype.resolveAll=function(e,t,n){var i=this;t===void 0&&(t=new r4),n===void 0&&(n=!1),this.ensureNotDisposed();var s=this.getAllRegistrations(e);if(!s&&Mh(e)){if(n)return[];throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"All"),s){var o=s.map(function(c){return i.resolveRegistration(c,t)});return this.executePostResolutionInterceptor(e,o,"All"),o}var a=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,a,"All"),a},r.prototype.isRegistered=function(e,t){return t===void 0&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},r.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},r.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var n=Xw(this._registry.entries()),i=n.next();!i.done;i=n.next()){var s=Zw(i.value,2),o=s[0],a=s[1];this._registry.setAll(o,a.filter(function(c){return!t4(c.provider)}).map(function(c){return c.instance=void 0,c}))}}catch(c){e={error:c}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},r.prototype.createChildContainer=function(){var e,t;this.ensureNotDisposed();var n=new r(this);try{for(var i=Xw(this._registry.entries()),s=i.next();!s.done;s=i.next()){var o=Zw(s.value,2),a=o[0],c=o[1];c.some(function(l){var d=l.options;return d.lifecycle===Nn.ContainerScoped})&&n._registry.setAll(a,c.map(function(l){return l.options.lifecycle===Nn.ContainerScoped?{provider:l.provider,options:l.options}:l}))}}catch(l){e={error:l}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r.prototype.beforeResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:n})},r.prototype.afterResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:n})},r.prototype.dispose=function(){return qbe(this,void 0,void 0,function(){var e;return Wbe(this,function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach(function(n){var i=n.dispose();i&&e.push(i)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},r.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},r.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},r.prototype.construct=function(e,t){var n=this;if(e instanceof kz)return e.createProxy(function(s){return n.resolve(s,t)});var i=function(){var s=Tz.get(e);if(!s||s.length===0){if(e.length===0)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var o=s.map(n.resolveParams(t,e));return new(e.bind.apply(e,vu([void 0],o)))}();return nve(i)&&this.disposables.add(i),i},r.prototype.resolveParams=function(e,t){var n=this;return function(i,s){var o,a,c;try{return Jbe(i)?_z(i)?i.multiple?(o=n.resolve(i.transform)).transform.apply(o,vu([n.resolveAll(i.token,new r4,i.isOptional)],i.transformArgs)):(a=n.resolve(i.transform)).transform.apply(a,vu([n.resolve(i.token,e,i.isOptional)],i.transformArgs)):i.multiple?n.resolveAll(i.token,new r4,i.isOptional):n.resolve(i.token,e,i.isOptional):_z(i)?(c=n.resolve(i.transform,e)).transform.apply(c,vu([n.resolve(i.token,e)],i.transformArgs)):n.resolve(i,e)}catch(l){throw new Error(rve(t,s,l))}}},r.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},r}(),Tr=new ave;function n4(r){return function(e){Tz.set(e,Qbe(e))}}if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var xx;class i4{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}}_([$({type:F.ObjectIdentifier})],i4.prototype,"attrId",void 0),_([$({type:F.Any,repeated:"set"})],i4.prototype,"attrValues",void 0);let Pz=xx=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,xx.prototype)}};Pz=xx=_([te({type:X.Sequence,itemType:i4})],Pz);var Ax;let Dz=Ax=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,Ax.prototype)}};Dz=Ax=_([te({type:X.Sequence,itemType:_h})],Dz);class $z{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],$z.prototype,"certId",void 0),_([$({type:F.Any,context:0})],$z.prototype,"certValue",void 0);class Nz{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],Nz.prototype,"crlId",void 0),_([$({type:F.Any,context:0})],Nz.prototype,"crltValue",void 0);class Mz extends tt{}let s4=class{constructor(e={}){this.encryptionAlgorithm=new me,this.encryptedData=new Mz,Object.assign(this,e)}};_([$({type:me})],s4.prototype,"encryptionAlgorithm",void 0),_([$({type:Mz})],s4.prototype,"encryptedData",void 0);var Cx,Ix;(function(r){r[r.v1=0]="v1"})(Ix||(Ix={}));class Oz extends tt{}let kx=Cx=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,Cx.prototype)}};kx=Cx=_([te({type:X.Sequence,itemType:ta})],kx);class Wp{constructor(e={}){this.version=Ix.v1,this.privateKeyAlgorithm=new me,this.privateKey=new Oz,Object.assign(this,e)}}_([$({type:F.Integer})],Wp.prototype,"version",void 0),_([$({type:me})],Wp.prototype,"privateKeyAlgorithm",void 0),_([$({type:Oz})],Wp.prototype,"privateKey",void 0),_([$({type:kx,implicit:!0,context:0,optional:!0})],Wp.prototype,"attributes",void 0);let Rz=class extends Wp{};Rz=_([te({type:X.Sequence})],Rz);let Lz=class extends s4{};Lz=_([te({type:X.Sequence})],Lz);class Bz{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],Bz.prototype,"secretTypeId",void 0),_([$({type:F.Any,context:0})],Bz.prototype,"secretValue",void 0);class Gp{constructor(e={}){this.mac=new Jw,this.macSalt=new tt,this.iterations=1,Object.assign(this,e)}}_([$({type:Jw})],Gp.prototype,"mac",void 0),_([$({type:tt})],Gp.prototype,"macSalt",void 0),_([$({type:F.Integer,defaultValue:1})],Gp.prototype,"iterations",void 0);class o4{constructor(e={}){this.version=3,this.authSafe=new _h,this.macData=new Gp,Object.assign(this,e)}}_([$({type:F.Integer})],o4.prototype,"version",void 0),_([$({type:_h})],o4.prototype,"authSafe",void 0),_([$({type:Gp,optional:!0})],o4.prototype,"macData",void 0);var _x;class a4{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],a4.prototype,"bagId",void 0),_([$({type:F.Any,context:0})],a4.prototype,"bagValue",void 0),_([$({type:i4,repeated:"set",optional:!0})],a4.prototype,"bagAttributes",void 0);let Uz=_x=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,_x.prototype)}};Uz=_x=_([te({type:X.Sequence,itemType:a4})],Uz);var Tx,Px,Dx;const Fz="1.2.840.113549.1.9",zz=`${Fz}.7`,$x=`${Fz}.14`;let c4=class extends kr{constructor(e={}){super(e)}toString(){return this.ia5String||super.toString()}};_([$({type:F.IA5String})],c4.prototype,"ia5String",void 0),c4=_([te({type:X.Choice})],c4);let Vz=class extends _h{};Vz=_([te({type:X.Sequence})],Vz);let Kz=class extends o4{};Kz=_([te({type:X.Sequence})],Kz);let jz=class extends s4{};jz=_([te({type:X.Sequence})],jz);let Nx=class{constructor(e=""){this.value=e}toString(){return this.value}};_([$({type:F.IA5String})],Nx.prototype,"value",void 0),Nx=_([te({type:X.Choice})],Nx);let Hz=class extends c4{};Hz=_([te({type:X.Choice})],Hz);let qz=class extends kr{};qz=_([te({type:X.Choice})],qz);let Mx=class{constructor(e=new Date){this.value=e}};_([$({type:F.GeneralizedTime})],Mx.prototype,"value",void 0),Mx=_([te({type:X.Choice})],Mx);let Wz=class extends kr{};Wz=_([te({type:X.Choice})],Wz);let Ox=class{constructor(e="M"){this.value=e}toString(){return this.value}};_([$({type:F.PrintableString})],Ox.prototype,"value",void 0),Ox=_([te({type:X.Choice})],Ox);let l4=class{constructor(e=""){this.value=e}toString(){return this.value}};_([$({type:F.PrintableString})],l4.prototype,"value",void 0),l4=_([te({type:X.Choice})],l4);let Gz=class extends l4{};Gz=_([te({type:X.Choice})],Gz);let Qz=class extends kr{};Qz=_([te({type:X.Choice})],Qz);let Rx=class{constructor(e=""){this.value=e}toString(){return this.value}};_([$({type:F.ObjectIdentifier})],Rx.prototype,"value",void 0),Rx=_([te({type:X.Choice})],Rx);let Jz=class extends _r{};Jz=_([te({type:X.Choice})],Jz);let Lx=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};_([$({type:F.Integer})],Lx.prototype,"value",void 0),Lx=_([te({type:X.Choice})],Lx);let Yz=class extends Qs{};Yz=_([te({type:X.Sequence})],Yz);let u4=class extends kr{};u4=_([te({type:X.Choice})],u4);let Xz=Tx=class extends Bc{constructor(e){super(e),Object.setPrototypeOf(this,Tx.prototype)}};Xz=Tx=_([te({type:X.Sequence})],Xz);let Zz=Px=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,Px.prototype)}};Zz=Px=_([te({type:X.Set,itemType:Ah})],Zz);let Bx=class{constructor(e=""){this.value=e}toString(){return this.value}};_([$({type:F.BmpString})],Bx.prototype,"value",void 0),Bx=_([te({type:X.Choice})],Bx);let Ux=class extends me{};Ux=_([te({type:X.Sequence})],Ux);let eV=Dx=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,Dx.prototype)}};eV=Dx=_([te({type:X.Sequence,itemType:Ux})],eV);var Fx;let d4=Fx=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,Fx.prototype)}};d4=Fx=_([te({type:X.Sequence,itemType:ta})],d4);class Oh{constructor(e={}){this.version=0,this.subject=new Jt,this.subjectPKInfo=new gs,this.attributes=new d4,Object.assign(this,e)}}_([$({type:F.Integer})],Oh.prototype,"version",void 0),_([$({type:Jt})],Oh.prototype,"subject",void 0),_([$({type:gs})],Oh.prototype,"subjectPKInfo",void 0),_([$({type:d4,implicit:!0,context:0})],Oh.prototype,"attributes",void 0);class Qp{constructor(e={}){this.certificationRequestInfo=new Oh,this.signatureAlgorithm=new me,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:Oh})],Qp.prototype,"certificationRequestInfo",void 0),_([$({type:me})],Qp.prototype,"signatureAlgorithm",void 0),_([$({type:F.BitString})],Qp.prototype,"signature",void 0);/*!
* MIT License
* 
* Copyright (c) Peculiar Ventures. All rights reserved.
* 
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
* 
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
* 
*/const Jp="crypto.algorithm";class cve{getAlgorithms(){return Tr.resolveAll(Jp)}toAsnAlgorithm(e){({...e});for(const t of this.getAlgorithms()){const n=t.toAsnAlgorithm(e);if(n)return n}if(/^[0-9.]+$/.test(e.name)){const t=new me({algorithm:e.name});if("parameters"in e){const n=e;t.parameters=n.parameters}return t}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(const n of this.getAlgorithms()){const i=n.toWebAlgorithm(e);if(i)return i}return{name:e.algorithm,parameters:e.parameters}}}const Eu="crypto.algorithmProvider";Tr.registerSingleton(Eu,cve);var h4;const Mn="1.3.36.3.3.2.8.1.1",tV=`${Mn}.1`,rV=`${Mn}.2`,nV=`${Mn}.3`,iV=`${Mn}.4`,sV=`${Mn}.5`,oV=`${Mn}.6`,aV=`${Mn}.7`,cV=`${Mn}.8`,lV=`${Mn}.9`,uV=`${Mn}.10`,dV=`${Mn}.11`,hV=`${Mn}.12`,fV=`${Mn}.13`,pV=`${Mn}.14`,gV="brainpoolP160r1",yV="brainpoolP160t1",mV="brainpoolP192r1",wV="brainpoolP192t1",bV="brainpoolP224r1",vV="brainpoolP224t1",EV="brainpoolP256r1",SV="brainpoolP256t1",xV="brainpoolP320r1",AV="brainpoolP320t1",CV="brainpoolP384r1",IV="brainpoolP384t1",kV="brainpoolP512r1",_V="brainpoolP512t1",Vt="ECDSA";let Yp=h4=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case Vt.toLowerCase():if("hash"in e)switch((typeof e.hash=="string"?e.hash:e.hash.name).toLowerCase()){case"sha-1":return $be;case"sha-256":return Nbe;case"sha-384":return Mbe;case"sha-512":return Obe}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t=wz;break;case"K-256":t=h4.SECP256K1;break;case"P-384":t=bz;break;case"P-521":t=vz;break;case gV:t=tV;break;case yV:t=rV;break;case mV:t=nV;break;case wV:t=iV;break;case bV:t=sV;break;case vV:t=oV;break;case EV:t=aV;break;case SV:t=cV;break;case xV:t=lV;break;case AV:t=uV;break;case CV:t=dV;break;case IV:t=hV;break;case kV:t=fV;break;case _V:t=pV;break}if(t)return new me({algorithm:Kp,parameters:le.serialize(new Fc({namedCurve:t}))})}}return null}toWebAlgorithm(e){switch(e.algorithm){case lx:return{name:Vt,hash:{name:"SHA-1"}};case ux:return{name:Vt,hash:{name:"SHA-256"}};case dx:return{name:Vt,hash:{name:"SHA-384"}};case hx:return{name:Vt,hash:{name:"SHA-512"}};case Kp:{if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(le.parse(e.parameters,Fc).namedCurve){case wz:return{name:Vt,namedCurve:"P-256"};case h4.SECP256K1:return{name:Vt,namedCurve:"K-256"};case bz:return{name:Vt,namedCurve:"P-384"};case vz:return{name:Vt,namedCurve:"P-521"};case tV:return{name:Vt,namedCurve:gV};case rV:return{name:Vt,namedCurve:yV};case nV:return{name:Vt,namedCurve:mV};case iV:return{name:Vt,namedCurve:wV};case sV:return{name:Vt,namedCurve:bV};case oV:return{name:Vt,namedCurve:vV};case aV:return{name:Vt,namedCurve:EV};case cV:return{name:Vt,namedCurve:SV};case lV:return{name:Vt,namedCurve:xV};case uV:return{name:Vt,namedCurve:AV};case dV:return{name:Vt,namedCurve:CV};case hV:return{name:Vt,namedCurve:IV};case fV:return{name:Vt,namedCurve:kV};case pV:return{name:Vt,namedCurve:_V}}}}return null}};Yp.SECP256K1="1.3.132.0.10",Yp=h4=_([n4()],Yp),Tr.registerSingleton(Jp,Yp);const TV=Symbol("name"),PV=Symbol("value");class at{constructor(e,t={},n=""){this[TV]=e,this[PV]=n;for(const i in t)this[i]=t[i]}}at.NAME=TV,at.VALUE=PV;class lve{static toTextObject(e){const t=new at("Algorithm Identifier",{},zc.toString(e.algorithm));if(e.parameters)switch(e.algorithm){case Kp:{const n=new Yp().toWebAlgorithm(e);n&&"namedCurve"in n?t["Named Curve"]=n.namedCurve:t.Parameters=e.parameters;break}default:t.Parameters=e.parameters}return t}}class zc{static toString(e){const t=this.items[e];return t||e}}zc.items={[jw]:"sha1",[xz]:"sha224",[Hw]:"sha256",[qw]:"sha384",[Ww]:"sha512",[mu]:"rsaEncryption",[zw]:"sha1WithRSAEncryption",[zbe]:"sha224WithRSAEncryption",[px]:"sha256WithRSAEncryption",[Vw]:"sha384WithRSAEncryption",[Kw]:"sha512WithRSAEncryption",[Kp]:"ecPublicKey",[lx]:"ecdsaWithSHA1",[mz]:"ecdsaWithSHA224",[ux]:"ecdsaWithSHA256",[dx]:"ecdsaWithSHA384",[hx]:"ecdsaWithSHA512",[Cbe]:"TLS WWW server authentication",[Ibe]:"TLS WWW client authentication",[kbe]:"Code Signing",[_be]:"E-mail Protection",[Tbe]:"Time Stamping",[Pbe]:"OCSP Signing",[Dbe]:"Signed Data"};class Su{static serialize(e){return this.serializeObj(e).join(`
`)}static pad(e=0){return"".padStart(2*e," ")}static serializeObj(e,t=0){const n=[];let i=this.pad(t++),s="";const o=e[at.VALUE];o&&(s=` ${o}`),n.push(`${i}${e[at.NAME]}:${s}`),i=this.pad(t);for(const a in e){if(typeof a=="symbol")continue;const c=e[a],l=a?`${a}: `:"";if(typeof c=="string"||typeof c=="number"||typeof c=="boolean")n.push(`${i}${l}${c}`);else if(c instanceof Date)n.push(`${i}${l}${c.toUTCString()}`);else if(Array.isArray(c))for(const d of c)d[at.NAME]=a,n.push(...this.serializeObj(d,t));else if(c instanceof at)c[at.NAME]=a,n.push(...this.serializeObj(c,t));else if(he.isBufferSource(c))a?(n.push(`${i}${l}`),n.push(...this.serializeBufferSource(c,t+1))):n.push(...this.serializeBufferSource(c,t));else if("toTextObject"in c){const d=c.toTextObject();d[at.NAME]=a,n.push(...this.serializeObj(d,t))}else throw new TypeError("Cannot serialize data in text format. Unsupported type.")}return n}static serializeBufferSource(e,t=0){const n=this.pad(t),i=he.toUint8Array(e),s=[];for(let o=0;o<i.length;){const a=[];for(let c=0;c<16&&o<i.length;c++){c===8&&a.push("");const l=i[o++].toString(16).padStart(2,"0");a.push(l)}s.push(`${n}${a.join(" ")}`)}return s}static serializeAlgorithm(e){return this.algorithmSerializer.toTextObject(e)}}Su.oidSerializer=zc,Su.algorithmSerializer=lve;class Vc{constructor(...e){if(e.length===1){const t=e[0];this.rawData=le.serialize(t),this.onInit(t)}else{const t=le.parse(e[0],e[1]);this.rawData=he.toArrayBuffer(e[0]),this.onInit(t)}}equal(e){return e instanceof Vc?hU(e.rawData,this.rawData):!1}toString(e="text"){switch(e){case"asn":return le.toString(this.rawData);case"text":return Su.serialize(this.toTextObject());case"hex":return xe.ToHex(this.rawData);case"base64":return xe.ToBase64(this.rawData);case"base64url":return xe.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){const e=this.toTextObjectEmpty();return e[""]=this.rawData,e}toTextObjectEmpty(e){return new at(this.getTextName(),{},e)}}Vc.NAME="ASN";class Oi extends Vc{constructor(...e){let t;he.isBufferSource(e[0])?t=he.toArrayBuffer(e[0]):t=le.serialize(new Mi({extnID:e[0],critical:e[1],extnValue:new tt(he.toArrayBuffer(e[2]))})),super(t,Mi)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[at.NAME]===Oi.NAME&&(e[at.NAME]=zc.toString(this.type)),e}}var DV;class Kc{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&e.extractable!==void 0}constructor(){this.items=new Map,this[DV]="CryptoProvider",typeof self<"u"&&typeof crypto<"u"?this.set(Kc.DEFAULT,crypto):typeof global<"u"&&global.crypto&&global.crypto.subtle&&this.set(Kc.DEFAULT,global.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,t){return this.items.forEach(e,t)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=Kc.DEFAULT){const t=this.items.get(e.toLowerCase());if(!t)throw new Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if(typeof e=="string"){if(!t)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),t)}else this.items.set(Kc.DEFAULT,e);return this}}DV=Symbol.toStringTag,Kc.DEFAULT="default";const Pr=new Kc,uve=/^[0-2](?:\.[1-9][0-9]*)+$/;function dve(r){return new RegExp(uve).test(r)}class $V{constructor(e={}){this.items={};for(const t in e)this.register(t,e[t])}get(e){return this.items[e]||null}findId(e){return dve(e)?e:this.get(e)}register(e,t){this.items[e]=t,this.items[t]=e}}const On=new $V;On.register("CN","2.5.4.3"),On.register("L","2.5.4.7"),On.register("ST","2.5.4.8"),On.register("O","2.5.4.10"),On.register("OU","2.5.4.11"),On.register("C","2.5.4.6"),On.register("DC","0.9.2342.19200300.100.1.25"),On.register("E","1.2.840.113549.1.9.1"),On.register("G","2.5.4.42"),On.register("I","2.5.4.43"),On.register("SN","2.5.4.4"),On.register("T","2.5.4.12");function hve(r,e){return`\\${xe.ToHex(xe.FromUtf8String(e)).toUpperCase()}`}function fve(r){return r.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,hve)}class Ri{static isASCII(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!1;return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,t={}){this.extraNames=new $V,this.asn=new Jt;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const i=t[n];this.extraNames.register(n,i)}typeof e=="string"?this.asn=this.fromString(e):e instanceof Jt?this.asn=e:he.isBufferSource(e)?this.asn=le.parse(e,Jt):this.asn=this.fromJSON(e)}getField(e){const t=this.extraNames.findId(e)||On.findId(e),n=[];for(const i of this.asn)for(const s of i)s.type===t&&n.push(s.value.toString());return n}getName(e){return this.extraNames.get(e)||On.get(e)}toString(){return this.asn.map(e=>e.map(t=>{const n=this.getName(t.type)||t.type,i=t.value.anyValue?`#${xe.ToHex(t.value.anyValue)}`:fve(t.value.toString());return`${n}=${i}`}).join("+")).join(", ")}toJSON(){var e;const t=[];for(const n of this.asn){const i={};for(const s of n){const o=this.getName(s.type)||s.type;(e=i[o])!==null&&e!==void 0||(i[o]=[]),i[o].push(s.value.anyValue?`#${xe.ToHex(s.value.anyValue)}`:s.value.toString())}t.push(i)}return t}fromString(e){const t=new Jt,n=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g;let i=null,s=",";for(;i=n.exec(`${e},`);){let[,o,a]=i;const c=a[a.length-1];(c===","||c==="+")&&(a=a.slice(0,a.length-1),i[3]=c);const l=i[3];o=this.getTypeOid(o);const d=this.createAttribute(o,a);s==="+"?t[t.length-1].push(d):t.push(new mh([d])),s=l}return t}fromJSON(e){const t=new Jt;for(const n of e){const i=new mh;for(const s in n){const o=this.getTypeOid(s),a=n[s];for(const c of a){const l=this.createAttribute(o,c);i.push(l)}}t.push(i)}return t}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,t){const n=new aw({type:e});if(typeof t=="object")for(const i in t)switch(i){case"ia5String":n.value.ia5String=t[i];break;case"utf8String":n.value.utf8String=t[i];break;case"universalString":n.value.universalString=t[i];break;case"bmpString":n.value.bmpString=t[i];break;case"printableString":n.value.printableString=t[i];break}else if(t[0]==="#")n.value.anyValue=xe.FromHex(t.slice(1));else{const i=this.processStringValue(t);e===this.getName("E")||e===this.getName("DC")?n.value.ia5String=i:Ri.isPrintableString(i)?n.value.printableString=i:n.value.utf8String=i}return n}processStringValue(e){const t=/"(.*?[^\\])?"/.exec(e);return t&&(e=t[1]),e.replace(/\\0a/ig,`
`).replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return le.serialize(this.asn)}async getThumbprint(...e){var t;let n,i="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(i=e[0]||i,n=e[1]||Pr.get()):n=e[0]||Pr.get(),await n.subtle.digest(i,this.toArrayBuffer())}}const NV="Cannot initialize GeneralName from ASN.1 data.",MV=`${NV} Unsupported string format in use.`,pve=`${NV} Value doesn't match to GUID regular expression.`,OV=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,RV="1.3.6.1.4.1.311.25.1",LV="1.3.6.1.4.1.311.20.2.3",zx="dns",Vx="dn",Kx="email",jx="ip",Hx="url",qx="guid",Wx="upn",f4="id";class jc extends Vc{constructor(...e){let t;if(e.length===2)switch(e[0]){case Vx:{const n=new Ri(e[1]).toArrayBuffer(),i=le.parse(n,Jt);t=new Fe({directoryName:i});break}case zx:t=new Fe({dNSName:e[1]});break;case Kx:t=new Fe({rfc822Name:e[1]});break;case qx:{const n=new RegExp(OV,"i").exec(e[1]);if(!n)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");const i=n.slice(1).map((s,o)=>o<3?xe.ToHex(new Uint8Array(xe.FromHex(s)).reverse()):s).join("");t=new Fe({otherName:new _p({typeId:RV,value:le.serialize(new tt(xe.FromHex(i)))})});break}case jx:t=new Fe({iPAddress:e[1]});break;case f4:t=new Fe({registeredID:e[1]});break;case Wx:{t=new Fe({otherName:new _p({typeId:LV,value:le.serialize(BF.toASN(e[1]))})});break}case Hx:t=new Fe({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else he.isBufferSource(e[0])?t=le.parse(e[0],Fe):t=e[0];super(t)}onInit(e){if(e.dNSName!=null)this.type=zx,this.value=e.dNSName;else if(e.rfc822Name!=null)this.type=Kx,this.value=e.rfc822Name;else if(e.iPAddress!=null)this.type=jx,this.value=e.iPAddress;else if(e.uniformResourceIdentifier!=null)this.type=Hx,this.value=e.uniformResourceIdentifier;else if(e.registeredID!=null)this.type=f4,this.value=e.registeredID;else if(e.directoryName!=null)this.type=Vx,this.value=new Ri(e.directoryName).toString();else if(e.otherName!=null)if(e.otherName.typeId===RV){this.type=qx;const t=le.parse(e.otherName.value,tt),n=new RegExp(OV,"i").exec(xe.ToHex(t));if(!n)throw new Error(pve);this.value=n.slice(1).map((i,s)=>s<3?xe.ToHex(new Uint8Array(xe.FromHex(i)).reverse()):i).join("-")}else if(e.otherName.typeId===LV)this.type=Wx,this.value=le.parse(e.otherName.value,kr).toString();else throw new Error(MV);else throw new Error(MV)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case Vx:case zx:case qx:case jx:case f4:case Wx:case Hx:e=this.type.toUpperCase();break;case Kx:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let t=this.value;return this.type===f4&&(t=zc.toString(t)),new at(e,void 0,t)}}class Xp extends Vc{constructor(e){let t;if(e instanceof yn)t=e;else if(Array.isArray(e)){const n=[];for(const i of e)if(i instanceof Fe)n.push(i);else{const s=le.parse(new jc(i.type,i.value).rawData,Fe);n.push(s)}t=new yn(n)}else if(he.isBufferSource(e))t=le.parse(e,yn);else throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(t)}onInit(e){const t=[];for(const n of e){let i=null;try{i=new jc(n)}catch{continue}t.push(i)}this.items=t}toJSON(){return this.items.map(e=>e.toJSON())}toTextObject(){const e=super.toTextObjectEmpty();for(const t of this.items){const n=t.toTextObject();let i=e[n[at.NAME]];Array.isArray(i)||(i=[],e[n[at.NAME]]=i),i.push(n)}return e}}Xp.NAME="GeneralNames";const Zp="-{5}",e0="\\n",gve=`[^${e0}]+`,yve=`${Zp}BEGIN (${gve}(?=${Zp}))${Zp}`,mve=`${Zp}END \\1${Zp}`,Rh="\\n",wve=`[^:${e0}]+`,bve=`(?:[^${e0}]+${Rh}(?: +[^${e0}]+${Rh})*)`,vve=`(?:[a-zA-Z0-9=+/]+${Rh})+`,BV=`${yve}${Rh}(?:((?:${wve}: ${bve})+))?${Rh}?(${vve})${mve}`;class fi{static isPem(e){return typeof e=="string"&&new RegExp(BV,"g").test(e)}static decodeWithHeaders(e){e=e.replace(/\r/g,"");const t=new RegExp(BV,"g"),n=[];let i=null;for(;i=t.exec(e);){const s=i[3].replace(new RegExp(`[${e0}]+`,"g"),""),o={type:i[1],headers:[],rawData:xe.FromBase64(s)},a=i[2];if(a){const c=a.split(new RegExp(Rh,"g"));let l=null;for(const d of c){const[h,p]=d.split(/:(.*)/);if(p===void 0){if(!l)throw new Error("Cannot parse PEM string. Incorrect header value");l.value+=h.trim()}else l&&o.headers.push(l),l={key:h,value:p.trim()}}l&&o.headers.push(l)}n.push(o)}return n}static decode(e){return this.decodeWithHeaders(e).map(n=>n.rawData)}static decodeFirst(e){const t=this.decode(e);if(!t.length)throw new RangeError("PEM string doesn't contain any objects");return t[0]}static encode(e,t){if(Array.isArray(e)){const n=new Array;return t?e.forEach(i=>{if(!he.isBufferSource(i))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");n.push(this.encodeStruct({type:t,rawData:he.toArrayBuffer(i)}))}):e.forEach(i=>{if(!("type"in i))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");n.push(this.encodeStruct(i))}),n.join(`
`)}else{if(!t)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:t,rawData:he.toArrayBuffer(e)})}}static encodeStruct(e){var t;const n=e.type.toLocaleUpperCase(),i=[];if(i.push(`-----BEGIN ${n}-----`),!((t=e.headers)===null||t===void 0)&&t.length){for(const l of e.headers)i.push(`${l.key}: ${l.value}`);i.push("")}const s=xe.ToBase64(e.rawData);let o,a=0;const c=Array();for(;a<s.length&&(s.length-a<64?o=s.substring(a):(o=s.substring(a,a+64),a+=64),o.length!==0);)if(c.push(o),o.length<64)break;return i.push(...c),i.push(`-----END ${n}-----`),i.join(`
`)}}fi.CertificateTag="CERTIFICATE",fi.CrlTag="CRL",fi.CertificateRequestTag="CERTIFICATE REQUEST",fi.PublicKeyTag="PUBLIC KEY",fi.PrivateKeyTag="PRIVATE KEY";class sa extends Vc{static isAsnEncoded(e){return he.isBufferSource(e)||typeof e=="string"}static toArrayBuffer(e){if(typeof e=="string"){if(fi.isPem(e))return fi.decode(e)[0];if(xe.isHex(e))return xe.FromHex(e);if(xe.isBase64(e))return xe.FromBase64(e);if(xe.isBase64Url(e))return xe.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}else{const t=xe.ToBinary(e);return fi.isPem(t)?fi.decode(t)[0]:xe.isHex(t)?xe.FromHex(t):xe.isBase64(t)?xe.FromBase64(t):xe.isBase64Url(t)?xe.FromBase64Url(t):he.toArrayBuffer(e)}}constructor(...e){sa.isAsnEncoded(e[0])?super(sa.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){switch(e){case"pem":return fi.encode(this.rawData,this.tag);default:return super.toString(e)}}}class ms extends sa{static async create(e,t=Pr.get()){if(e instanceof ms)return e;if(Kc.isCryptoKey(e)){if(e.type!=="public")throw new TypeError("Public key is required");const n=await t.subtle.exportKey("spki",e);return new ms(n)}else{if(e.publicKey)return e.publicKey;if(he.isBufferSource(e))return new ms(e);throw new TypeError("Unsupported PublicKeyType")}}constructor(e){sa.isAsnEncoded(e)?super(e,gs):super(e),this.tag=fi.PublicKeyTag}async export(...e){let t,n=["verify"],i={hash:"SHA-256",...this.algorithm};e.length>1?(i=e[0]||i,n=e[1]||n,t=e[2]||Pr.get()):t=e[0]||Pr.get();let s=this.rawData;const o=le.parse(this.rawData,gs);return o.algorithm.algorithm===qp&&(s=Eve(o,s)),t.subtle.importKey("spki",s,i,!0,n)}onInit(e){const t=Tr.resolve(Eu),n=this.algorithm=t.toWebAlgorithm(e.algorithm);switch(e.algorithm.algorithm){case mu:{const i=le.parse(e.subjectPublicKey,mx),s=he.toUint8Array(i.modulus);n.publicExponent=he.toUint8Array(i.publicExponent),n.modulusLength=(s[0]?s:s.slice(1)).byteLength<<3;break}}}async getThumbprint(...e){var t;let n,i="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(i=e[0]||i,n=e[1]||Pr.get()):n=e[0]||Pr.get(),await n.subtle.digest(i,this.rawData)}async getKeyIdentifier(...e){let t,n="SHA-1";e.length===1?typeof e[0]=="string"?(n=e[0],t=Pr.get()):t=e[0]:e.length===2?(n=e[0],t=e[1]):t=Pr.get();const i=le.parse(this.rawData,gs);return await t.subtle.digest(n,i.subjectPublicKey)}toTextObject(){const e=this.toTextObjectEmpty(),t=le.parse(this.rawData,gs);switch(e.Algorithm=Su.serializeAlgorithm(t.algorithm),t.algorithm.algorithm){case Kp:e["EC Point"]=t.subjectPublicKey;break;case mu:default:e["Raw Data"]=t.subjectPublicKey}return e}}function Eve(r,e){return r.algorithm=new me({algorithm:mu,parameters:null}),e=le.serialize(r),e}class t0 extends Oi{static async create(e,t=!1,n=Pr.get()){if("name"in e&&"serialNumber"in e)return new t0(e,t);const s=await(await ms.create(e,n)).getKeyIdentifier(n);return new t0(xe.ToHex(s),t)}constructor(...e){if(he.isBufferSource(e[0]))super(e[0]);else if(typeof e[0]=="string"){const t=new uu({keyIdentifier:new fS(xe.FromHex(e[0]))});super(hS,e[1],le.serialize(t))}else{const t=e[0],n=t.name instanceof Xp?le.parse(t.name.rawData,yn):t.name,i=new uu({authorityCertIssuer:n,authorityCertSerialNumber:xe.FromHex(t.serialNumber)});super(hS,e[1],le.serialize(i))}}onInit(e){super.onInit(e);const t=le.parse(e.extnValue,uu);t.keyIdentifier&&(this.keyId=xe.ToHex(t.keyIdentifier)),(t.authorityCertIssuer||t.authorityCertSerialNumber)&&(this.certId={name:t.authorityCertIssuer||[],serialNumber:t.authorityCertSerialNumber?xe.ToHex(t.authorityCertSerialNumber):""})}toTextObject(){const e=this.toTextObjectWithoutValue(),t=le.parse(this.value,uu);return t.authorityCertIssuer&&(e["Authority Issuer"]=new Xp(t.authorityCertIssuer).toTextObject()),t.authorityCertSerialNumber&&(e["Authority Serial Number"]=t.authorityCertSerialNumber),t.keyIdentifier&&(e[""]=t.keyIdentifier),e}}t0.NAME="Authority Key Identifier";class Gx extends Oi{constructor(...e){if(he.isBufferSource(e[0])){super(e[0]);const t=le.parse(this.value,lw);this.ca=t.cA,this.pathLength=t.pathLenConstraint}else{const t=new lw({cA:e[0],pathLenConstraint:e[1]});super(qF,e[2],le.serialize(t)),this.ca=e[0],this.pathLength=e[1]}}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ca&&(e.CA=this.ca),this.pathLength!==void 0&&(e["Path Length"]=this.pathLength),e}}Gx.NAME="Basic Constraints";var UV;(function(r){r.serverAuth="1.3.6.1.5.5.7.3.1",r.clientAuth="1.3.6.1.5.5.7.3.2",r.codeSigning="1.3.6.1.5.5.7.3.3",r.emailProtection="1.3.6.1.5.5.7.3.4",r.timeStamping="1.3.6.1.5.5.7.3.8",r.ocspSigning="1.3.6.1.5.5.7.3.9"})(UV||(UV={}));class FV extends Oi{constructor(...e){if(he.isBufferSource(e[0])){super(e[0]);const t=le.parse(this.value,pw);this.usages=t.map(n=>n)}else{const t=new pw(e[0]);super(XF,e[1],le.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.usages.map(t=>zc.toString(t)).join(", "),e}}FV.NAME="Extended Key Usages";var zV;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(zV||(zV={}));class VV extends Oi{constructor(...e){if(he.isBufferSource(e[0])){super(e[0]);const t=le.parse(this.value,_S);this.usages=t.toNumber()}else{const t=new _S(e[0]);super(ez,e[1],le.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=le.parse(this.value,_S);return e[""]=t.toJSON().join(", "),e}}VV.NAME="Key Usages";class p4 extends Oi{static async create(e,t=!1,n=Pr.get()){const s=await(await ms.create(e,n)).getKeyIdentifier(n);return new p4(xe.ToHex(s),t)}constructor(...e){if(he.isBufferSource(e[0])){super(e[0]);const t=le.parse(this.value,Lc);this.keyId=xe.ToHex(t)}else{const t=typeof e[0]=="string"?xe.FromHex(e[0]):e[0],n=new Lc(t);super(oz,e[1],le.serialize(n)),this.keyId=xe.ToHex(t)}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=le.parse(this.value,Lc);return e[""]=t,e}}p4.NAME="Subject Key Identifier";class KV extends Oi{constructor(...e){he.isBufferSource(e[0])?super(e[0]):super(iz,e[1],new Xp(e[0]||[]).rawData)}onInit(e){super.onInit(e);const t=le.parse(e.extnValue,NS);this.names=new Xp(t)}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.names.toTextObject();for(const n in t)e[n]=t[n];return e}}KV.NAME="Subject Alternative Name";class Li{static register(e,t){this.items.set(e,t)}static create(e){const t=new Oi(e),n=this.items.get(t.type);return n?new n(e):t}}Li.items=new Map;class jV extends Oi{constructor(...e){var t;if(he.isBufferSource(e[0])){super(e[0]);const n=le.parse(this.value,hw);this.policies=n.map(i=>i.policyIdentifier)}else{const n=e[0],i=(t=e[1])!==null&&t!==void 0?t:!1,s=new hw(n.map(o=>new dw({policyIdentifier:o})));super(GF,i,le.serialize(s)),this.policies=n}}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Policy=this.policies.map(t=>new at("",{},zc.toString(t))),e}}jV.NAME="Certificate Policies",Li.register(GF,jV);class HV extends Oi{constructor(...e){var t;if(he.isBufferSource(e[0]))super(e[0]);else if(Array.isArray(e[0])&&typeof e[0][0]=="string"){const i=e[0].map(o=>new vh({distributionPoint:new du({fullName:[new Fe({uniformResourceIdentifier:o})]})})),s=new Eh(i);super(ES,e[1],le.serialize(s))}else{const n=new Eh(e[0]);super(ES,e[1],le.serialize(n))}(t=this.distributionPoints)!==null&&t!==void 0||(this.distributionPoints=[])}onInit(e){super.onInit(e);const t=le.parse(e.extnValue,Eh);this.distributionPoints=t}toTextObject(){const e=this.toTextObjectWithoutValue();return e["Distribution Point"]=this.distributionPoints.map(t=>{var n;const i={};return t.distributionPoint&&(i[""]=(n=t.distributionPoint.fullName)===null||n===void 0?void 0:n.map(s=>new jc(s).toString()).join(", ")),t.reasons&&(i.Reasons=t.reasons.toString()),t.cRLIssuer&&(i["CRL Issuer"]=t.cRLIssuer.map(s=>s.toString()).join(", ")),i}),e}}HV.NAME="CRL Distribution Points";class qV extends Oi{constructor(...e){var t,n,i,s;if(he.isBufferSource(e[0]))super(e[0]);else if(e[0]instanceof bh){const o=new bh(e[0]);super(dS,e[1],le.serialize(o))}else{const o=e[0],a=new bh;y4(a,o,VF,"ocsp"),y4(a,o,KF,"caIssuers"),y4(a,o,jF,"timeStamping"),y4(a,o,HF,"caRepository"),super(dS,e[1],le.serialize(a))}(t=this.ocsp)!==null&&t!==void 0||(this.ocsp=[]),(n=this.caIssuers)!==null&&n!==void 0||(this.caIssuers=[]),(i=this.timeStamping)!==null&&i!==void 0||(this.timeStamping=[]),(s=this.caRepository)!==null&&s!==void 0||(this.caRepository=[])}onInit(e){super.onInit(e),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],le.parse(e.extnValue,bh).forEach(n=>{switch(n.accessMethod){case VF:this.ocsp.push(new jc(n.accessLocation));break;case KF:this.caIssuers.push(new jc(n.accessLocation));break;case jF:this.timeStamping.push(new jc(n.accessLocation));break;case HF:this.caRepository.push(new jc(n.accessLocation));break}})}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ocsp.length&&g4(e,"OCSP",this.ocsp),this.caIssuers.length&&g4(e,"CA Issuers",this.caIssuers),this.timeStamping.length&&g4(e,"Time Stamping",this.timeStamping),this.caRepository.length&&g4(e,"CA Repository",this.caRepository),e}}qV.NAME="Authority Info Access";function g4(r,e,t){if(t.length===1)r[e]=t[0].toTextObject();else{const n=new at("");t.forEach((i,s)=>{const o=i.toTextObject(),a=`${o[at.NAME]} ${s+1}`;let c=n[a];Array.isArray(c)||(c=[],n[a]=c),c.push(o)}),r[e]=n}}function y4(r,e,t,n){const i=e[n];i&&(Array.isArray(i)?i:[i]).forEach(o=>{typeof o=="string"&&(o=new jc("url",o)),r.push(new Tp({accessMethod:t,accessLocation:le.parse(o.rawData,Fe)}))})}class Lh extends Vc{constructor(...e){let t;if(he.isBufferSource(e[0]))t=he.toArrayBuffer(e[0]);else{const n=e[0],i=Array.isArray(e[1])?e[1].map(s=>he.toArrayBuffer(s)):[];t=le.serialize(new ta({type:n,values:i}))}super(t,ta)}onInit(e){this.type=e.type,this.values=e.values}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Value=this.values.map(t=>new at("",{"":t})),e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty();return e[at.NAME]===Lh.NAME&&(e[at.NAME]=zc.toString(this.type)),e}}Lh.NAME="Attribute";class WV extends Lh{constructor(...e){var t;if(he.isBufferSource(e[0]))super(e[0]);else{const n=new u4({printableString:e[0]});super(zz,[le.serialize(n)])}(t=this.password)!==null&&t!==void 0||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){const t=le.parse(this.values[0],u4);this.password=t.toString()}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[at.VALUE]=this.password,e}}WV.NAME="Challenge Password";class Qx extends Lh{constructor(...e){var t;if(he.isBufferSource(e[0]))super(e[0]);else{const n=e[0],i=new Bc;for(const s of n)i.push(le.parse(s.rawData,Mi));super($x,[le.serialize(i)])}(t=this.items)!==null&&t!==void 0||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){const t=le.parse(this.values[0],Bc);this.items=t.map(n=>Li.create(le.serialize(n)))}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.items.map(n=>n.toTextObject());for(const n of t)e[n[at.NAME]]=n;return e}}Qx.NAME="Extensions";class m4{static register(e,t){this.items.set(e,t)}static create(e){const t=new Lh(e),n=this.items.get(t.type);return n?new n(e):t}}m4.items=new Map;const r0="crypto.signatureFormatter";class Sve{toAsnSignature(e,t){return he.toArrayBuffer(t)}toWebSignature(e,t){return he.toArrayBuffer(t)}}var w4;let Jx=w4=class{static createPssParams(e,t){const n=w4.getHashAlgorithm(e);return n?new bu({hashAlgorithm:n,maskGenAlgorithm:new me({algorithm:Gw,parameters:le.serialize(n)}),saltLength:t}):null}static getHashAlgorithm(e){const t=Tr.resolve(Eu);return typeof e=="string"?t.toAsnAlgorithm({name:e}):typeof e=="object"&&e&&"name"in e?t.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if("hash"in e){let t;if(typeof e.hash=="string")t=e.hash;else if(e.hash&&typeof e.hash=="object"&&"name"in e.hash&&typeof e.hash.name=="string")t=e.hash.name.toUpperCase();else throw new Error("Cannot get hash algorithm name");switch(t.toLowerCase()){case"sha-1":return new me({algorithm:zw,parameters:null});case"sha-256":return new me({algorithm:px,parameters:null});case"sha-384":return new me({algorithm:Vw,parameters:null});case"sha-512":return new me({algorithm:Kw,parameters:null})}}else return new me({algorithm:mu,parameters:null});break;case"rsa-pss":if("hash"in e){if(!("saltLength"in e&&typeof e.saltLength=="number"))throw new Error("Cannot get 'saltLength' from 'alg' argument");const t=w4.createPssParams(e.hash,e.saltLength);if(!t)throw new Error("Cannot create PSS parameters");return new me({algorithm:qp,parameters:le.serialize(t)})}else return new me({algorithm:qp,parameters:null})}return null}toWebAlgorithm(e){switch(e.algorithm){case mu:return{name:"RSASSA-PKCS1-v1_5"};case zw:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case px:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case Vw:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case Kw:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case qp:if(e.parameters){const t=le.parse(e.parameters,bu);return{name:"RSA-PSS",hash:Tr.resolve(Eu).toWebAlgorithm(t.hashAlgorithm),saltLength:t.saltLength}}else return{name:"RSA-PSS"}}return null}};Jx=w4=_([n4()],Jx),Tr.registerSingleton(Jp,Jx);let Yx=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new me({algorithm:jw});case"sha-256":return new me({algorithm:Hw});case"sha-384":return new me({algorithm:qw});case"sha-512":return new me({algorithm:Ww})}return null}toWebAlgorithm(e){switch(e.algorithm){case jw:return{name:"SHA-1"};case Hw:return{name:"SHA-256"};case qw:return{name:"SHA-384"};case Ww:return{name:"SHA-512"}}return null}};Yx=_([n4()],Yx),Tr.registerSingleton(Jp,Yx);class Bi{addPadding(e,t){const n=he.toUint8Array(t),i=new Uint8Array(e);return i.set(n,e-n.length),i}removePadding(e,t=!1){let n=he.toUint8Array(e);for(let i=0;i<n.length;i++)if(n[i]){n=n.slice(i);break}if(t&&n[0]>127){const i=new Uint8Array(n.length+1);return i.set(n,1),i.buffer}return n.buffer}toAsnSignature(e,t){if(e.name==="ECDSA"){const n=e.namedCurve,i=Bi.namedCurveSize.get(n)||Bi.defaultNamedCurveSize,s=new Fw,o=he.toUint8Array(t);return s.r=this.removePadding(o.slice(0,i),!0),s.s=this.removePadding(o.slice(i,i+i),!0),le.serialize(s)}return null}toWebSignature(e,t){if(e.name==="ECDSA"){const n=le.parse(t,Fw),i=e.namedCurve,s=Bi.namedCurveSize.get(i)||Bi.defaultNamedCurveSize,o=this.addPadding(s,this.removePadding(n.r)),a=this.addPadding(s,this.removePadding(n.s));return d8e(o,a)}return null}}Bi.namedCurveSize=new Map,Bi.defaultNamedCurveSize=32;const Xx="1.3.101.110",GV="1.3.101.111",Zx="1.3.101.112",QV="1.3.101.113";let eA=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"ed25519":t=Zx;break;case"x25519":t=Xx;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t=Zx;break;case"ed448":t=QV;break}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t=Xx;break;case"x448":t=GV;break}}return t?new me({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case Zx:return{name:"Ed25519"};case QV:return{name:"EdDSA",namedCurve:"Ed448"};case Xx:return{name:"X25519"};case GV:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};eA=_([n4()],eA),Tr.registerSingleton(Jp,eA);class xve extends sa{constructor(e){sa.isAsnEncoded(e)?super(e,Qp):super(e),this.tag=fi.CertificateRequestTag}onInit(e){this.tbs=le.serialize(e.certificationRequestInfo),this.publicKey=new ms(e.certificationRequestInfo.subjectPKInfo);const t=Tr.resolve(Eu);this.signatureAlgorithm=t.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signature,this.attributes=e.certificationRequestInfo.attributes.map(i=>m4.create(le.serialize(i)));const n=this.getAttribute($x);this.extensions=[],n instanceof Qx&&(this.extensions=n.items),this.subjectName=new Ri(e.certificationRequestInfo.subject),this.subject=this.subjectName.toString()}getAttribute(e){for(const t of this.attributes)if(t.type===e)return t;return null}getAttributes(e){return this.attributes.filter(t=>t.type===e)}getExtension(e){for(const t of this.extensions)if(t.type===e)return t;return null}getExtensions(e){return this.extensions.filter(t=>t.type===e)}async verify(e=Pr.get()){const t={...this.publicKey.algorithm,...this.signatureAlgorithm},n=await this.publicKey.export(t,["verify"],e),i=Tr.resolveAll(r0).reverse();let s=null;for(const a of i)if(s=a.toWebSignature(t,this.signature),s)break;if(!s)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await e.subtle.verify(this.signatureAlgorithm,n,s,this.tbs)}toTextObject(){const e=this.toTextObjectEmpty(),t=le.parse(this.rawData,Qp),n=t.certificationRequestInfo,i=new at("",{Version:`${hu[n.version]} (${n.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){const s=new at("");for(const o of this.attributes){const a=o.toTextObject();s[a[at.NAME]]=a}i.Attributes=s}return e.Data=i,e.Signature=new at("",{Algorithm:Su.serializeAlgorithm(t.signatureAlgorithm),"":t.signature}),e}}xve.NAME="PKCS#10 Certificate Request";class tA extends sa{constructor(e){sa.isAsnEncoded(e)?super(e,fu):super(e),this.tag=fi.CertificateTag}onInit(e){const t=e.tbsCertificate;this.tbs=le.serialize(t),this.serialNumber=xe.ToHex(t.serialNumber),this.subjectName=new Ri(t.subject),this.subject=new Ri(t.subject).toString(),this.issuerName=new Ri(t.issuer),this.issuer=this.issuerName.toString();const n=Tr.resolve(Eu);this.signatureAlgorithm=n.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signatureValue;const i=t.validity.notBefore.utcTime||t.validity.notBefore.generalTime;if(!i)throw new Error("Cannot get 'notBefore' value");this.notBefore=i;const s=t.validity.notAfter.utcTime||t.validity.notAfter.generalTime;if(!s)throw new Error("Cannot get 'notAfter' value");this.notAfter=s,this.extensions=[],t.extensions&&(this.extensions=t.extensions.map(o=>Li.create(le.serialize(o)))),this.publicKey=new ms(t.subjectPublicKeyInfo)}getExtension(e){for(const t of this.extensions)if(typeof e=="string"){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter(t=>typeof e=="string"?t.type===e:t instanceof e)}async verify(e={},t=Pr.get()){let n,i;const s=e.publicKey;try{if(!s)n={...this.publicKey.algorithm,...this.signatureAlgorithm},i=await this.publicKey.export(n,["verify"],t);else if("publicKey"in s)n={...s.publicKey.algorithm,...this.signatureAlgorithm},i=await s.publicKey.export(n,["verify"],t);else if(s instanceof ms)n={...s.algorithm,...this.signatureAlgorithm},i=await s.export(n,["verify"],t);else if(he.isBufferSource(s)){const l=new ms(s);n={...l.algorithm,...this.signatureAlgorithm},i=await l.export(n,["verify"],t)}else n={...s.algorithm,...this.signatureAlgorithm},i=s}catch{return!1}const o=Tr.resolveAll(r0).reverse();let a=null;for(const l of o)if(a=l.toWebSignature(n,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");const c=await t.subtle.verify(this.signatureAlgorithm,i,a,this.tbs);if(e.signatureOnly)return c;{const d=(e.date||new Date).getTime();return c&&this.notBefore.getTime()<d&&d<this.notAfter.getTime()}}async getThumbprint(...e){let t,n="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(n=e[0]||n,t=e[1])),t??(t=Pr.get()),await t.subtle.digest(n,this.rawData)}async isSelfSigned(e=Pr.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},e)}toTextObject(){const e=this.toTextObjectEmpty(),t=le.parse(this.rawData,fu),n=t.tbsCertificate,i=new at("",{Version:`${hu[n.version]} (${n.version})`,"Serial Number":n.serialNumber,"Signature Algorithm":Su.serializeAlgorithm(n.signature),Issuer:this.issuer,Validity:new at("",{"Not Before":n.validity.notBefore.getTime(),"Not After":n.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(n.issuerUniqueID&&(i["Issuer Unique ID"]=n.issuerUniqueID),n.subjectUniqueID&&(i["Subject Unique ID"]=n.subjectUniqueID),this.extensions.length){const s=new at("");for(const o of this.extensions){const a=o.toTextObject();s[a[at.NAME]]=a}i.Extensions=s}return e.Data=i,e.Signature=new at("",{Algorithm:Su.serializeAlgorithm(t.signatureAlgorithm),"":t.signatureValue}),e}}tA.NAME="Certificate";class Ave{static async createSelfSigned(e,t=Pr.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},t)}static async create(e,t=Pr.get()){var n;let i;e.publicKey instanceof ms?i=e.publicKey.rawData:"publicKey"in e.publicKey?i=e.publicKey.publicKey.rawData:he.isBufferSource(e.publicKey)?i=e.publicKey:i=await t.subtle.exportKey("spki",e.publicKey);const s=e.serialNumber?he.toUint8Array(xe.FromHex(e.serialNumber)):t.getRandomValues(new Uint8Array(16));s[0]>127&&(s[0]&=127),s.length>1&&s[0]===0&&(s[1]|=128);const o=e.notBefore||new Date,a=e.notAfter||new Date(o.getTime()+31536e6),c=new fu({tbsCertificate:new hi({version:hu.v3,serialNumber:s,validity:new $p({notBefore:o,notAfter:a}),extensions:new Bc(((n=e.extensions)===null||n===void 0?void 0:n.map(v=>le.parse(v.rawData,Mi)))||[]),subjectPublicKeyInfo:le.parse(i,gs)})});if(e.subject){const v=e.subject instanceof Ri?e.subject:new Ri(e.subject);c.tbsCertificate.subject=le.parse(v.toArrayBuffer(),Jt)}if(e.issuer){const v=e.issuer instanceof Ri?e.issuer:new Ri(e.issuer);c.tbsCertificate.issuer=le.parse(v.toArrayBuffer(),Jt)}const l={hash:"SHA-256"},d="signingKey"in e?{...l,...e.signingAlgorithm,...e.signingKey.algorithm}:{...l,...e.signingAlgorithm},h=Tr.resolve(Eu);c.tbsCertificate.signature=c.signatureAlgorithm=h.toAsnAlgorithm(d);const p=le.serialize(c.tbsCertificate),b="signingKey"in e?await t.subtle.sign(d,e.signingKey,p):e.signature,f=Tr.resolveAll(r0).reverse();let g=null;for(const v of f)if(g=v.toAsnSignature(d,b),g)break;if(!g)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return c.signatureValue=g,new tA(le.serialize(c))}}var JV;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(JV||(JV={})),Li.register(qF,Gx),Li.register(XF,FV),Li.register(ez,VV),Li.register(oz,p4),Li.register(hS,t0),Li.register(iz,KV),Li.register(ES,HV),Li.register(dS,qV),m4.register(zz,WV),m4.register($x,Qx),Tr.registerSingleton(r0,Sve),Tr.registerSingleton(r0,Bi),Bi.namedCurveSize.set("P-256",32),Bi.namedCurveSize.set("K-256",32),Bi.namedCurveSize.set("P-384",48),Bi.namedCurveSize.set("P-521",66);function YV(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Cve(r){return new TextEncoder().encode(r)}function Ive(r){return new TextDecoder().decode(r)}function kve(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var _ve=kve,Tve=_ve;let Pve=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Dve=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return XV(this,e)}},$ve=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return XV(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function XV(r,e){return new $ve({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Nve=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Pve(e,t,n),this.decoder=new Dve(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function b4({name:r,prefix:e,encode:t,decode:n}){return new Nve(r,e,t,n)}function n0({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Tve(t,r);return b4({prefix:e,name:r,encode:n,decode:s=>YV(i(s))})}function Mve(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Ove(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Dr({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return b4({prefix:e,name:r,encode(i){return Ove(i,n,t)},decode(i){return Mve(i,n,t,r)}})}const Rve=Dr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Lve=Dr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),rA=Dr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Bve=Dr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Uve=Object.freeze(Object.defineProperty({__proto__:null,base64:Rve,base64pad:Lve,base64url:rA,base64urlpad:Bve},Symbol.toStringTag,{value:"Module"}));var Fve=eK,ZV=128,zve=-128,Vve=Math.pow(2,31);function eK(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Vve;)e[t++]=r&255|ZV,r/=128;for(;r&zve;)e[t++]=r&255|ZV,r>>>=7;return e[t]=r|0,eK.bytes=t-n+1,e}var Kve=nA,jve=128,tK=127;function nA(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw nA.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&tK)<<i:(o&tK)*Math.pow(2,i),i+=7}while(o>=jve);return nA.bytes=s-n,t}var Hve=Math.pow(2,7),qve=Math.pow(2,14),Wve=Math.pow(2,21),Gve=Math.pow(2,28),Qve=Math.pow(2,35),Jve=Math.pow(2,42),Yve=Math.pow(2,49),Xve=Math.pow(2,56),Zve=Math.pow(2,63),e7e=function(r){return r<Hve?1:r<qve?2:r<Wve?3:r<Gve?4:r<Qve?5:r<Jve?6:r<Yve?7:r<Xve?8:r<Zve?9:10},t7e={encode:Fve,decode:Kve,encodingLength:e7e},v4=t7e;function rK(r,e=0){return[v4.decode(r,e),v4.decode.bytes]}function nK(r,e,t=0){return v4.encode(r,e,t),e}function iK(r){return v4.encodingLength(r)}function E4(r,e){const t=e.byteLength,n=iK(r),i=n+iK(t),s=new Uint8Array(i+t);return nK(r,s,0),nK(t,s,n),s.set(e,i),new sK(r,t,e,s)}function r7e(r){const e=YV(r),[t,n]=rK(e),[i,s]=rK(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new sK(t,i,o,e)}let sK=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function n7e({name:r,code:e,encode:t}){return new i7e(r,e,t)}let i7e=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?E4(this.code,t):t.then(n=>E4(this.code,n))}else throw Error("Unknown type, must be binary type")}};function s7e(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const iA=n7e({name:"sha2-256",code:18,encode:s7e("SHA-256")});class o7e extends er{async listen(){throw new q6e("WebRTCTransport.createListener")}getAddrs(){return[]}updateAnnounceAddrs(){}async close(){}}const a7e=n0({prefix:"9",name:"base10",alphabet:"0123456789"}),c7e=Object.freeze(Object.defineProperty({__proto__:null,base10:a7e},Symbol.toStringTag,{value:"Module"})),l7e=Dr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),u7e=Dr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),d7e=Object.freeze(Object.defineProperty({__proto__:null,base16:l7e,base16upper:u7e},Symbol.toStringTag,{value:"Module"})),h7e=Dr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),f7e=Object.freeze(Object.defineProperty({__proto__:null,base2:h7e},Symbol.toStringTag,{value:"Module"})),oK=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),p7e=oK.reduce((r,e,t)=>(r[t]=e,r),[]),g7e=oK.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function y7e(r){return r.reduce((e,t)=>(e+=p7e[t],e),"")}function m7e(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const i=g7e[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const w7e=b4({prefix:"🚀",name:"base256emoji",encode:y7e,decode:m7e}),b7e=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:w7e},Symbol.toStringTag,{value:"Module"})),v7e=Dr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),E7e=Dr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),S7e=Dr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),x7e=Dr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),A7e=Dr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),C7e=Dr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),I7e=Dr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),k7e=Dr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),_7e=Dr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),T7e=Object.freeze(Object.defineProperty({__proto__:null,base32:v7e,base32hex:A7e,base32hexpad:I7e,base32hexpadupper:k7e,base32hexupper:C7e,base32pad:S7e,base32padupper:x7e,base32upper:E7e,base32z:_7e},Symbol.toStringTag,{value:"Module"})),P7e=n0({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),D7e=n0({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),$7e=Object.freeze(Object.defineProperty({__proto__:null,base36:P7e,base36upper:D7e},Symbol.toStringTag,{value:"Module"})),N7e=n0({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),M7e=n0({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),O7e=Object.freeze(Object.defineProperty({__proto__:null,base58btc:N7e,base58flickr:M7e},Symbol.toStringTag,{value:"Module"})),R7e=Dr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),L7e=Object.freeze(Object.defineProperty({__proto__:null,base8:R7e},Symbol.toStringTag,{value:"Module"})),B7e=b4({prefix:"\0",name:"identity",encode:r=>Ive(r),decode:r=>Cve(r)}),U7e=Object.freeze(Object.defineProperty({__proto__:null,identity:B7e},Symbol.toStringTag,{value:"Module"}));new TextEncoder,new TextDecoder;const F7e={...U7e,...f7e,...L7e,...c7e,...d7e,...T7e,...$7e,...O7e,...Uve,...b7e},aK=Object.values(F7e).map(r=>r.decoder).reduce((r,e)=>r.or(e)),z7e=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function V7e(r){var t;if(r==null)return;const e=r.match(z7e);return(t=e==null?void 0:e.groups)==null?void 0:t.fingerprint}function cK(r){const t=r.stringTuples().filter(n=>n[0]===g6e).map(n=>n[1])[0];if(t===void 0||t==="")throw new Z(`Couldn't find a certhash component of multiaddr: ${r.toString()}`);return t}function K7e(r){return r7e(aK.decode(r))}function j7e(r){const e=K7e(cK(r)),t=q7e(e.code),n=e.digest.reduce((s,o)=>s+o.toString(16).padStart(2,"0"),""),i=n.match(/.{1,2}/g);if(i==null)throw new H6e(n,r.toString());return`${t} ${i.join(":").toUpperCase()}`}function H7e(r){const e=r.split(":").map(i=>parseInt(i,16)),t=Uint8Array.from(e),n=E4(iA.code,t);return Re(`/certhash/${rA.encode(n.bytes)}`)}function q7e(r){switch(r){case 17:return"sha-1";case 18:return"sha-256";case 19:return"sha-512";default:throw new W6e(r)}}function W7e(r,e){const{host:t,port:n,family:i}=r.toOptions(),s=j7e(r);return{type:"answer",sdp:`v=0
o=- 0 0 IN IP${i} ${t}
s=-
t=0 0
a=ice-lite
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
c=IN IP${i} ${t}
a=mid:0
a=ice-options:ice2
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:${s}
a=setup:passive
a=sctp-port:5000
a=max-message-size:${nw}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function G7e(r,e){const{host:t,port:n,family:i}=r.toOptions();return{type:"offer",sdp:`v=0
o=- 0 0 IN IP${i} ${t}
s=-
c=IN IP${i} ${t}
t=0 0
a=ice-options:ice2,trickle
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:active
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:sha-256 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
a=sctp-port:5000
a=max-message-size:${nw}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function lK(r,e){if(r.sdp===void 0)throw new Z("Can't munge a missing SDP");const t=r.sdp.includes(`\r
`)?`\r
`:`
`;return r.sdp=r.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,`
a=ice-ufrag:`+e+t).replace(/\na=ice-pwd:[^\n]*\n/,`
a=ice-pwd:`+e+t),r}const sA=oe("libp2p-webrtc-noise:");function Q7e(r,e,t){const n=r.trim().toLowerCase().replaceAll(":",""),i=oe(n,"hex"),s=E4(iA.code,i),o=aK.decode(cK(e)),a=sA.byteLength+s.bytes.byteLength+o.byteLength;return or(t==="server"?[sA,o,s.bytes]:[sA,s.bytes,o],a)}const J7e=YE?"iceconnectionstatechange":"connectionstatechange";async function Y7e(r,e,t){var i,s,o;const n=r.createDataChannel("",{negotiated:!0,id:0});try{if(t.role==="client"){t.log.trace("client creating local offer");const f=await r.createOffer();t.log.trace("client created local offer %s",f.sdp);const g=lK(f,e);t.log.trace("client setting local offer %s",g.sdp),await r.setLocalDescription(g);const v=W7e(t.remoteAddr,e);t.log.trace("client setting server description %s",v.sdp),await r.setRemoteDescription(v)}else{const f=G7e(t.remoteAddr,e);t.log.trace("server setting client %s %s",f.type,f.sdp),await r.setRemoteDescription(f),t.log.trace("server creating local answer");const g=await r.createAnswer();t.log.trace("server created local answer");const v=lK(g,e);t.log.trace("server setting local description %s",g.sdp),await r.setLocalDescription(v)}if(n.readyState!=="open"&&(t.log.trace("%s wait for handshake channel to open, starting status %s",t.role,n.readyState),await Ti(n,"open",t.signal)),t.log.trace("%s handshake channel opened",t.role),t.role==="server"){const f=((i=r.remoteFingerprint())==null?void 0:i.value)??"";t.remoteAddr=t.remoteAddr.encapsulate(H7e(f))}const a=V7e((s=r.localDescription)==null?void 0:s.sdp);if(a==null)throw new kp("Could not get fingerprint from local description sdp");t.log.trace("%s performing noise handshake",t.role);const c=Q7e(a,t.remoteAddr,t.role),l=EL({prologueBytes:c})(t),d=iw({channel:n,direction:"outbound",handshake:!0,logger:t.logger,...t.dataChannel??{}}),h=new XE(t,{peerConnection:r,remoteAddr:t.remoteAddr,timeline:{open:Date.now()},metrics:t.events});r.addEventListener(J7e,()=>{switch(r.connectionState){case"failed":case"disconnected":case"closed":h.close().catch(f=>{t.log.error("error closing connection",f),h.abort(f)});break;default:break}}),(o=t.events)==null||o.increment({peer_connection:!0});const p=new ZE(t,{peerConnection:r,metrics:t.events,dataChannelOptions:t.dataChannel});if(t.role==="client")return t.log.trace("%s secure inbound",t.role),await l.secureInbound(d,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0}),t.log.trace("%s upgrade outbound",t.role),await t.upgrader.upgradeOutbound(h,{skipProtection:!0,skipEncryption:!0,muxerFactory:p,signal:t.signal});t.log.trace("%s secure outbound",t.role);const b=await l.secureOutbound(d,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0});h.remoteAddr=h.remoteAddr.encapsulate(`/p2p/${b.remotePeer}`),t.log.trace("%s upgrade inbound",t.role),await t.upgrader.upgradeInbound(h,{skipProtection:!0,skipEncryption:!0,muxerFactory:p,signal:t.signal})}catch(a){throw n.close(),a}}async function X7e(r,e,t,n){n==null&&(n=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"}));const i=typeof t=="function"?await t():t;return new RTCPeerConnection({...i??{},certificates:[n]})}async function Z7e(r){const e=await i$(r),t=await crypto.subtle.exportKey("pkcs8",e.privateKey);return["-----BEGIN PRIVATE KEY-----",...re(new Uint8Array(t),"base64pad").split(/(.{64})/).filter(Boolean),"-----END PRIVATE KEY-----"].join(`
`)}IH=N2,CH=Symbol.toStringTag,AH=dr;class e9e{constructor(e,t={}){u(this,"log");u(this,"metrics");u(this,"components");u(this,"init");u(this,"certificate");u(this,"privateKey");u(this,"emitter");u(this,"renewCertificateTask");u(this,IH,!0);u(this,CH,"@libp2p/webrtc-direct");u(this,AH,["@libp2p/transport"]);if(this.log=e.logger.forComponent("libp2p:webrtc-direct"),this.components=e,this.init=t,this.emitter=new er,t.certificateLifespan!=null&&t.certificateRenewalThreshold!=null&&t.certificateRenewalThreshold>=t.certificateLifespan)throw new Z("Certificate renewal threshold must be less than certificate lifespan");e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}async start(){this.certificate=await this.getCertificate()}async stop(){this.renewCertificateTask!=null&&clearTimeout(this.renewCertificateTask),this.certificate=void 0}async dial(e,t){var a;this.log("dial %a",e),t.signal.throwIfAborted();let n;const i=e.getPeerId();i!=null&&(n=tr(i));const s=z6e(),o=await X7e("client",s,typeof this.init.rtcConfiguration=="function"?await this.init.rtcConfiguration():this.init.rtcConfiguration??{});try{return await Y7e(o,s,{role:"client",log:this.log,logger:this.components.logger,metrics:this.components.metrics,events:(a=this.metrics)==null?void 0:a.dialerEvents,signal:t.signal,remoteAddr:e,dataChannel:this.init.dataChannel,upgrader:t.upgrader,peerId:this.components.peerId,remotePeerId:n,privateKey:this.components.privateKey})}catch(c){throw o.close(),c}}createListener(e){if(this.certificate==null)throw new Dl;return new o7e(this.components,{...this.init,...e,certificate:this.certificate,emitter:this.emitter})}listenFilter(e){return e.filter(q7.exactMatch)}dialFilter(e){return this.listenFilter(e)}async getCertificate(e){if(t9e(this.init.certificate))return this.log("using provided TLS certificate"),this.init.certificate;const t=await this.loadOrCreatePrivateKey(),{pem:n,certhash:i}=await this.loadOrCreateCertificate(t,e);return{privateKey:await Z7e(t),pem:n,certhash:i}}async loadOrCreatePrivateKey(){if(this.privateKey!=null)return this.privateKey;const e=this.init.certificateKeychainName??A6e,t=this.getKeychain();try{if(t==null)throw this.log("no keychain configured - not checking for stored private key"),new Zt;this.log.trace("checking for stored private key"),this.privateKey=await t.exportKey(e)}catch(n){if(n.name!=="NotFoundError")throw n;this.log.trace("generating private key"),this.privateKey=await gy("ECDSA","P-256"),t!=null?(this.log.trace("storing private key"),await t.importKey(e,this.privateKey)):this.log("no keychain configured - not storing private key")}return this.privateKey}async loadOrCreateCertificate(e,t){if(this.certificate!=null&&t!==!0)return this.certificate;let n;const i=new At(this.init.certificateDatastoreKey??x6e),s=await i$(e);try{if(t===!0)throw this.log.trace("forcing renewal of TLS certificate"),new Zt;this.log.trace("checking for stored TLS certificate"),n=await this.loadCertificate(i,s)}catch(a){if(a.name!=="NotFoundError")throw a;this.log.trace("generating new TLS certificate"),n=await this.createCertificate(i,s)}let o=n.notAfter.getTime()-(this.init.certificateRenewalThreshold??CF)-Date.now();return o<0&&(o=100),this.log("will renew TLS certificate after %d ms",o),this.renewCertificateTask=setTimeout(()=>{this.log("renewing TLS certificate"),this.getCertificate(!0).then(a=>{this.certificate=a,this.emitter.safeDispatchEvent("certificate:renew",{detail:a})}).catch(a=>{this.log.error("could not renew certificate - %e",a)})},o),{pem:n.toString("pem"),certhash:rA.encode((await iA.digest(new Uint8Array(n.rawData))).bytes)}}async loadCertificate(e,t){const n=await this.components.datastore.get(e),i=new tA(n),s=i.notAfter.getTime()-(this.init.certificateRenewalThreshold??CF);if(Date.now()>s)throw this.log("stored TLS certificate has expired"),new Zt;this.log("loaded certificate, expires in %d ms",s);const o=await i.publicKey.export(crypto),a=await crypto.subtle.exportKey("raw",o),c=await crypto.subtle.exportKey("raw",t.publicKey);if(!We(new Uint8Array(a,0,a.byteLength),new Uint8Array(c,0,c.byteLength)))throw this.log("stored TLS certificate public key did not match public key from private key"),new Zt;return this.log("loaded certificate, expiry time is %o",s),i}async createCertificate(e,t){const n=new Date,i=new Date(Date.now()+(this.init.certificateLifespan??C6e));n.setMilliseconds(0),i.setMilliseconds(0);const s=await Ave.createSelfSigned({serialNumber:(BigInt(Math.random().toString().replace(".",""))*100000n).toString(16),name:"CN=example.com, C=US, L=CA, O=example, ST=CA",notBefore:n,notAfter:i,keys:t,extensions:[new Gx(!1,void 0,!0)]},crypto);return this.getKeychain()!=null?(this.log.trace("storing TLS certificate"),await this.components.datastore.put(e,oe(s.toString("pem")))):this.log("no keychain is configured so not storing TLS certificate since the private key will not be reused"),s}getKeychain(){try{return this.components.keychain}catch{}}}function t9e(r){return r==null?!1:typeof r.privateKey=="string"&&typeof r.pem=="string"&&typeof r.certhash=="string"}function r9e(r){return e=>new e9e(e,r)}function S4(r){return e=>new Y6e(e,r)}const n9e=async r=>{if(r.readyState>=2)throw new Error("socket closed");r.readyState!==1&&await new Promise((e,t)=>{function n(){r.removeEventListener("open",i),r.removeEventListener("error",s)}function i(){n(),e()}function s(o){n(),t(o.error??new Error(`connect ECONNREFUSED ${r.url}`))}r.addEventListener("open",i),r.addEventListener("error",s)})},i9e=(r,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,async n=>{for await(const i of n){try{await n9e(r)}catch(s){if(s.message==="socket closed")break;throw s}if(r.readyState===r.CLOSING||r.readyState===r.CLOSED)break;r.send(i)}e.closeOnEnd!=null&&r.readyState<=1&&await new Promise((i,s)=>{r.addEventListener("close",o=>{if(o.wasClean||o.code===1006)i();else{const a=Object.assign(new Error("ws error"),{event:o});s(a)}}),setTimeout(()=>{r.close()})})});var x4={},A4={};Object.defineProperty(A4,"__esModule",{value:!0});class s9e{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const t={value:e,done:!1};if(this.pullQueue.length){const n=this.pullQueue.shift();n&&n.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{const t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{const t=this.pushQueue.shift();return t?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((n,i)=>{this.pullQueue.push({resolve:n,reject:i})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}let uK=class{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){const i=new s9e;i.highWaterMark=t,i.lowWaterMark=n,i.removeCallback=e({push:s=>i.push(s),stop:()=>i.stop(),fail:s=>i.fail(s),on:(s,o)=>{i.eventHandlers[s]=o}})||(()=>{}),this[Symbol.asyncIterator]=()=>i[Symbol.asyncIterator](),Object.freeze(this)}};A4.EventIterator=uK,A4.default=uK,Object.defineProperty(x4,"__esModule",{value:!0});const oA=A4;var o9e=x4.EventIterator=oA.EventIterator;function a9e(r,e,t){return new oA.EventIterator(({push:n})=>(this.addEventListener(r,n,e),()=>this.removeEventListener(r,n,e)),t)}x4.subscribe=a9e,x4.default=oA.EventIterator;function dK(r){var e;return r instanceof ArrayBuffer||((e=r==null?void 0:r.constructor)==null?void 0:e.name)==="ArrayBuffer"&&typeof(r==null?void 0:r.byteLength)=="number"}const c9e=r=>{r.binaryType="arraybuffer";const e=async()=>{await new Promise((s,o)=>{if(n){s();return}if(i!=null){o(i);return}const a=d=>{r.removeEventListener("open",c),r.removeEventListener("error",l),d()},c=()=>{a(s)},l=d=>{a(()=>{o(d.error??new Error(`connect ECONNREFUSED ${r.url}`))})};r.addEventListener("open",c),r.addEventListener("error",l)})},t=async function*(){const s=new o9e(({push:o,stop:a,fail:c})=>{const l=h=>{let p=null;typeof h.data=="string"&&(p=oe(h.data)),dK(h.data)&&(p=new Uint8Array(h.data)),h.data instanceof Uint8Array&&(p=h.data),p!=null&&o(p)},d=h=>{c(h.error??new Error("Socket error"))};return r.addEventListener("message",l),r.addEventListener("error",d),r.addEventListener("close",a),()=>{r.removeEventListener("message",l),r.removeEventListener("error",d),r.removeEventListener("close",a)}},{highWaterMark:1/0});await e();for await(const o of s)yield dK(o)?new Uint8Array(o):o}();let n=r.readyState===1,i;return r.addEventListener("open",()=>{n=!0,i=null}),r.addEventListener("close",()=>{n=!1,i=null}),r.addEventListener("error",s=>{n||(i=s.error??new Error(`connect ECONNREFUSED ${r.url}`))}),Object.assign(t,{connected:e})},l9e=(r,e)=>{e=e??{};const t=c9e(r);let n=e.remoteAddress,i=e.remotePort;if(r.url!=null)try{const o=new URL(r.url);n=o.hostname,i=parseInt(o.port,10)}catch{}if(n==null||i==null)throw new Error("Remote connection did not have address and/or port");return{sink:i9e(r,e),source:t,connected:async()=>{await t.connected()},close:async()=>{(r.readyState===r.CONNECTING||r.readyState===r.OPEN)&&await new Promise(o=>{r.addEventListener("close",()=>{o()}),r.close()})},destroy:()=>{r.terminate!=null?r.terminate():r.close()},remoteAddress:n,remotePort:i,socket:r}},u9e=WebSocket,d9e={"http:":"ws:","https:":"wss:"},hK="ws:",h9e=(r,e)=>{if(r.startsWith("//")&&(r=`${(e==null?void 0:e.protocol)??hK}${r}`),r.startsWith("/")&&e!=null){const n=e.protocol??hK,i=e.host,s=e.port!=null&&(i==null?void 0:i.endsWith(`:${e.port}`))!==!0?`:${e.port}`:"";r=`${n}//${i}${s}${r}`}const t=new URL(r);for(const[n,i]of Object.entries(d9e))t.protocol===n&&(t.protocol=i);return t};function f9e(r,e){const t=typeof window>"u"?void 0:window.location;e=e??{};const n=h9e(r,t),i=new u9e(n.toString(),e.websocket);return l9e(i,e)}function p9e(r){return r.filter(e=>wm.exactMatch(e)||Y1.exactMatch(e))}function g9e(){throw new Error("WebSocket Servers can not be created in the browser!")}const y9e=500;function m9e(r,e,t){const n=t.logger.forComponent("libp2p:websockets:maconn"),i=t.metrics,s=t.metricPrefix??"",o={log:n,async sink(a){try{await r.sink(async function*(){for await(const c of a)c instanceof Uint8Array?yield c:yield c.subarray()}())}catch(c){c.type!=="aborted"&&n.error(c)}},source:r.source,remoteAddr:e,timeline:{open:Date.now()},async close(a={}){var d,h;const c=Date.now();if(a.signal==null){const p=AbortSignal.timeout(y9e);a={...a,signal:p}}const l=()=>{const{host:p,port:b}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s after %dms, destroying it manually",p,b,Date.now()-c),this.abort(new Tl("Socket close timeout"))};(d=a.signal)==null||d.addEventListener("abort",l);try{await r.close()}catch(p){n.error("error closing WebSocket gracefully",p),this.abort(p)}finally{(h=a.signal)==null||h.removeEventListener("abort",l),o.timeline.close=Date.now()}},abort(a){const{host:c,port:l}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s due to error",c,l,a),r.destroy(),o.timeline.close=Date.now(),i==null||i.increment({[`${s}error`]:!0})}};return r.socket.addEventListener("close",()=>{i==null||i.increment({[`${s}close`]:!0}),o.timeline.close==null&&(o.timeline.close=Date.now())},{once:!0}),o}TH=N2,_H=Symbol.toStringTag,kH=dr;class w9e{constructor(e,t={}){u(this,"log");u(this,"init");u(this,"logger");u(this,"metrics");u(this,"components");u(this,TH,!0);u(this,_H,"@libp2p/websockets");u(this,kH,["@libp2p/transport"]);this.log=e.logger.forComponent("libp2p:websockets"),this.logger=e.logger,this.components=e,this.init=t,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}async dial(e,t){var o;this.log("dialing %s",e),t=t??{};const n=await this._connect(e,t),i=m9e(n,e,{logger:this.logger,metrics:(o=this.metrics)==null?void 0:o.dialerEvents});this.log("new outbound connection %s",i.remoteAddr);const s=await t.upgrader.upgradeOutbound(i,t);return this.log("outbound connection %s upgraded",i.remoteAddr),s}async _connect(e,t){var o,a,c,l,d;(o=t==null?void 0:t.signal)==null||o.throwIfAborted();const n=e.toOptions();this.log("dialing %s:%s",n.host,n.port);const i=Le(),s=f9e(FO(e),this.init);s.socket.addEventListener("error",()=>{var p;const h=new Nb(`Could not connect to ${e.toString()}`);this.log.error("connection error:",h),(p=this.metrics)==null||p.dialerEvents.increment({error:!0}),i.reject(h)});try{(a=t.onProgress)==null||a.call(t,new _e("websockets:open-connection")),await ln(Promise.race([s.connected(),i.promise]),t.signal)}catch(h){throw(c=t.signal)!=null&&c.aborted&&((l=this.metrics)==null||l.dialerEvents.increment({abort:!0})),s.close().catch(p=>{this.log.error("error closing raw socket",p)}),h}return this.log("connected %s",e),(d=this.metrics)==null||d.dialerEvents.increment({connect:!0}),s}createListener(e){return g9e({logger:this.logger,events:this.components.events,metrics:this.components.metrics},{...this.init,...e})}listenFilter(e){var t,n;return e=Array.isArray(e)?e:[e],((t=this.init)==null?void 0:t.filter)!=null?(n=this.init)==null?void 0:n.filter(e):p9e(e)}dialFilter(e){return this.listenFilter(e)}}function C4(r={}){return e=>new w9e(e,r)}function b9e(r,e){const t=e.map((n,i)=>({record:ip(n),index:i}));return t.sort((n,i)=>{const s=n.record.sequence,o=i.record.sequence;if(s>o)return-1;if(s<o)return 1;if(n.record.validityType===os.ValidityType.EOL&&i.record.validityType===os.ValidityType.EOL){const a=l9.fromString(n.record.validity).toDate(),c=l9.fromString(i.record.validity).toDate();if(a.getTime()>c.getTime())return-1;if(a.getTime()<c.getTime())return 1}return 0}),t[0].index}const fK="2.8.5",pK="js-libp2p";function gK(r,e){return`${r??pK}/${e??fK} browser/${globalThis.navigator.userAgent}`}const v9e="5.3.0",E9e="helia",S9e={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};function x9e(r={}){const e=`${E9e}/${v9e} ${gK()}`;return{privateKey:r.privateKey,dns:r.dns,nodeInfo:{userAgent:e},addresses:{listen:["/p2p-circuit","/webrtc"]},transports:[b3(),S4(),r9e(),C4()],connectionEncrypters:[EL()],streamMuxers:[pye(),i6e()],peerDiscovery:[u3(S9e)],services:{autoNAT:Qye(),dcutr:E3e(),delegatedRouting:()=>u0e("https://delegated-ipfs.dev",H0e()),dht:i5e({clientMode:!0,validators:{ipns:dR},selectors:{ipns:b9e}}),identify:x3(),identifyPush:M3e(),keychain:yF(r.keychain),ping:h6e()}}}async function A9e(r,e={}){const t=e.selfKey??"self",n=yF(e)({datastore:r,logger:Uy()});let i;return await r.has(new At(`/pkcs8/${t}`))?i=await n.exportKey(t):(i=await gy(e.keyType??"Ed25519"),await n.importKey(t,i)),i}const C9e=32,{code:I9e}=Ve("dnsaddr");class k9e extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}}const yK=async function(e,t={}){const n=t.maxRecursiveDepth??C9e;if(n===0)throw new k9e("Max recursive depth reached");const[,i]=e.stringTuples().find(([l])=>l===I9e)??[],o=await((t==null?void 0:t.dns)??_N()).query(`_dnsaddr.${i}`,{signal:t==null?void 0:t.signal,types:[pc.TXT]}),a=e.getPeerId(),c=[];for(const l of o.Answer){const d=l.data.replace(/["']/g,"").trim().split("=")[1];if(d==null||a!=null&&!d.includes(a))continue;const h=Re(d);if(d.startsWith("/dnsaddr")){const p=await h.resolve({...t,maxRecursiveDepth:n-1});c.push(...p.map(b=>b.toString()))}else c.push(h.toString())}return c},_9e={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:r=>r},connectionManager:{resolvers:{dnsaddr:yK}},transportManager:{faultTolerance:Ga.FATAL_ALL}};async function T9e(r){var t,n;const e=xE(_9e,r);if(e.connectionProtector===null&&((n=(t=globalThis.process)==null?void 0:t.env)==null?void 0:n.LIBP2P_FORCE_PNET)!=null)throw new Z("Private network is enforced, but no protector was provided");return e}function P9e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function aA(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function D9e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var A=f[y],k=0,x=m-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var T=c.repeat(g);I<m;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&m[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=m[x++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var $9e=D9e,N9e=$9e;class M9e{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class O9e{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return mK(this,e)}}class R9e{constructor(e){u(this,"decoders");this.decoders=e}or(e){return mK(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function mK(r,e){return new R9e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}class L9e{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new M9e(e,t,n),this.decoder=new O9e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function wK({name:r,prefix:e,encode:t,decode:n}){return new L9e(r,e,t,n)}function I4({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=N9e(t,r);return wK({prefix:e,name:r,encode:n,decode:s=>aA(i(s))})}function B9e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function U9e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function oa({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return wK({prefix:e,name:r,encode(i){return U9e(i,n,t)},decode(i){return B9e(i,n,t,r)}})}const i0=oa({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});oa({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),oa({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),oa({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),oa({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),oa({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),oa({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),oa({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),oa({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const cA=I4({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});I4({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const aa=I4({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});I4({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var F9e=vK,bK=128,z9e=-128,V9e=Math.pow(2,31);function vK(r,e,t){e=e||[],t=t||0;for(var n=t;r>=V9e;)e[t++]=r&255|bK,r/=128;for(;r&z9e;)e[t++]=r&255|bK,r>>>=7;return e[t]=r|0,vK.bytes=t-n+1,e}var K9e=lA,j9e=128,EK=127;function lA(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw lA.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&EK)<<i:(o&EK)*Math.pow(2,i),i+=7}while(o>=j9e);return lA.bytes=s-n,t}var H9e=Math.pow(2,7),q9e=Math.pow(2,14),W9e=Math.pow(2,21),G9e=Math.pow(2,28),Q9e=Math.pow(2,35),J9e=Math.pow(2,42),Y9e=Math.pow(2,49),X9e=Math.pow(2,56),Z9e=Math.pow(2,63),eEe=function(r){return r<H9e?1:r<q9e?2:r<W9e?3:r<G9e?4:r<Q9e?5:r<J9e?6:r<Y9e?7:r<X9e?8:r<Z9e?9:10},tEe={encode:F9e,decode:K9e,encodingLength:eEe},k4=tEe;function uA(r,e=0){return[k4.decode(r,e),k4.decode.bytes]}function _4(r,e,t=0){return k4.encode(r,e,t),e}function T4(r){return k4.encodingLength(r)}function rEe(r,e){const t=e.byteLength,n=T4(r),i=n+T4(t),s=new Uint8Array(i+t);return _4(r,s,0),_4(t,s,n),s.set(e,i),new dA(r,t,e,s)}function SK(r){const e=aA(r),[t,n]=uA(e),[i,s]=uA(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new dA(t,i,o,e)}function nEe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&P9e(r.bytes,t.bytes)}}let dA=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function xK(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return sEe(t,hA(r),e??aa.encoder);default:return oEe(t,hA(r),e??i0.encoder)}}const AK=new WeakMap;function hA(r){const e=AK.get(r);if(e==null){const t=new Map;return AK.set(r,t),t}return e}class $r{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,PH,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==s0)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==aEe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return $r.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=rEe(e,t);return $r.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return $r.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&nEe(e.multihash,n.multihash)}toString(e){return xK(this,e)}toJSON(){return{"/":xK(this)}}link(){return this}[(PH=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof $r)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new $r(n,i,s,o??CK(n,i,s.bytes))}else if(t[cEe]===!0){const{version:n,multihash:i,code:s}=t,o=SK(i);return $r.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==s0)throw new Error(`Version 0 CID must use dag-pb (code: ${s0}) block encoding`);return new $r(e,t,n,n.bytes)}case 1:{const i=CK(e,t,n.bytes);return new $r(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return $r.create(0,s0,e)}static createV1(e,t){return $r.create(1,e,t)}static decode(e){const[t,n]=$r.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=$r.inspectBytes(e),n=t.size-t.multihashSize,i=aA(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new dA(t.multihashCode,t.digestSize,s,i);return[t.version===0?$r.createV0(o):$r.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=uA(e.subarray(t));return t+=p,h};let i=n(),s=s0;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=iEe(e,t),s=$r.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return hA(s).set(n,e),s}}function iEe(r,e){switch(r[0]){case"Q":{const t=e??aa;return[aa.prefix,t.decode(`${aa.prefix}${r}`)]}case aa.prefix:{const t=e??aa;return[aa.prefix,t.decode(r)]}case i0.prefix:{const t=e??i0;return[i0.prefix,t.decode(r)]}case cA.prefix:{const t=e??cA;return[cA.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function sEe(r,e,t){const{prefix:n}=t;if(n!==aa.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function oEe(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const s0=112,aEe=18;function CK(r,e,t){const n=T4(r),i=n+T4(e),s=new Uint8Array(i+t.byteLength);return _4(r,s,0),_4(e,s,n),s.set(t,i),s}const cEe=Symbol.for("@ipld/js-cid/CID"),lEe=36e5,uEe=216e5;var xu;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.key!=null&&i.key!==""&&(s.uint32(10),s.string(i.key)),i.value!=null&&i.value.byteLength>0&&(s.uint32(18),s.bytes(i.value)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={key:"",value:Ge(0)},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.key=i.string();break}case 2:{a.value=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)})(r.Peer$metadataEntry||(r.Peer$metadataEntry={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.key!=null&&i.key!==""&&(s.uint32(10),s.string(i.key)),i.value!=null&&(s.uint32(18),D4.codec().encode(i.value,s)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={key:""},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:{a.key=i.string();break}case 2:{a.value=D4.codec().decode(i,i.uint32(),{limits:(l=o.limits)==null?void 0:l.value});break}default:{i.skipType(d&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.Peer$tagsEntry||(r.Peer$tagsEntry={}));let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.addresses!=null)for(const s of t.addresses)n.uint32(10),P4.codec().encode(s,n);if(t.protocols!=null)for(const s of t.protocols)n.uint32(18),n.string(s);if(t.publicKey!=null&&(n.uint32(34),n.bytes(t.publicKey)),t.peerRecordEnvelope!=null&&(n.uint32(42),n.bytes(t.peerRecordEnvelope)),t.metadata!=null&&t.metadata.size!==0)for(const[s,o]of t.metadata.entries())n.uint32(50),r.Peer$metadataEntry.codec().encode({key:s,value:o},n);if(t.tags!=null&&t.tags.size!==0)for(const[s,o]of t.tags.entries())n.uint32(58),r.Peer$tagsEntry.codec().encode({key:s,value:o},n);t.updated!=null&&(n.uint32(64),n.uint64Number(t.updated)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,d,h,p;const s={addresses:[],protocols:[],metadata:new Map,tags:new Map},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const b=t.uint32();switch(b>>>3){case 1:{if(((a=i.limits)==null?void 0:a.addresses)!=null&&s.addresses.length===i.limits.addresses)throw new mt('Decode error - map field "addresses" had too many elements');s.addresses.push(P4.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.addresses$}));break}case 2:{if(((l=i.limits)==null?void 0:l.protocols)!=null&&s.protocols.length===i.limits.protocols)throw new mt('Decode error - map field "protocols" had too many elements');s.protocols.push(t.string());break}case 4:{s.publicKey=t.bytes();break}case 5:{s.peerRecordEnvelope=t.bytes();break}case 6:{if(((d=i.limits)==null?void 0:d.metadata)!=null&&s.metadata.size===i.limits.metadata)throw new TD('Decode error - map field "metadata" had too many elements');const f=r.Peer$metadataEntry.codec().decode(t,t.uint32());s.metadata.set(f.key,f.value);break}case 7:{if(((h=i.limits)==null?void 0:h.tags)!=null&&s.tags.size===i.limits.tags)throw new TD('Decode error - map field "tags" had too many elements');const f=r.Peer$tagsEntry.codec().decode(t,t.uint32(),{limits:{value:(p=i.limits)==null?void 0:p.tags$value}});s.tags.set(f.key,f.value);break}case 8:{s.updated=t.uint64Number();break}default:{t.skipType(b&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(xu||(xu={}));var P4;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(n.uint32(10),n.bytes(t.multiaddr)),t.isCertified!=null&&(n.uint32(16),n.bool(t.isCertified)),t.observed!=null&&(n.uint32(24),n.uint64Number(t.observed)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={multiaddr:Ge(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.multiaddr=t.bytes();break}case 2:{s.isCertified=t.bool();break}case 3:{s.observed=t.uint64Number();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(P4||(P4={}));var D4;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.value!=null&&t.value!==0&&(n.uint32(8),n.uint32(t.value)),t.expiry!=null&&(n.uint32(16),n.uint64(t.expiry)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={value:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.value=t.uint32();break}case 2:{s.expiry=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(D4||(D4={}));function dEe(r,e){if(r.publicKey!=null||e.publicKey==null)return r;let t;if(r.type==="RSA"){const i=aa.decode(`z${r}`);t=SK(i)}const n=_n(e.publicKey,t);return zd(n)}function fA(r,e,t){const n=xu.decode(e);return pA(r,n,t)}function pA(r,e,t){const n=new Map,i=BigInt(Date.now());for(const[s,o]of e.tags.entries())o.expiry!=null&&o.expiry<i||n.set(s,o);return{...e,id:dEe(r,e),addresses:e.addresses.filter(({observed:s})=>s!=null&&s>Date.now()-t).map(({multiaddr:s,isCertified:o})=>({multiaddr:Re(s),isCertified:o??!1})),metadata:e.metadata,peerRecordEnvelope:e.peerRecordEnvelope??void 0,tags:n}}function hEe(r,e){return fEe(r.addresses,e.addresses)&&pEe(r.protocols,e.protocols)&&gEe(r.publicKey,e.publicKey)&&yEe(r.peerRecordEnvelope,e.peerRecordEnvelope)&&mEe(r.metadata,e.metadata)&&wEe(r.tags,e.tags)}function fEe(r,e){return kK(r,e,(t,n)=>!(t.isCertified!==n.isCertified||!We(t.multiaddr,n.multiaddr)))}function pEe(r,e){return kK(r,e,(t,n)=>t===n)}function gEe(r,e){return IK(r,e)}function yEe(r,e){return IK(r,e)}function mEe(r,e){return _K(r,e,(t,n)=>We(t,n))}function wEe(r,e){return _K(r,e,(t,n)=>t.value===n.value&&t.expiry===n.expiry)}function IK(r,e){return r==null&&e==null?!0:r!=null&&e!=null?We(r,e):!1}function kK(r,e,t){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!t(r[n],e[n]))return!1;return!0}function _K(r,e,t){if(r.size!==e.size)return!1;for(const[n,i]of r.entries()){const s=e.get(n);if(s==null||!t(i,s))return!1}return!0}const TK="/peers/";function $4(r){if(!fP(r)||r.type==null)throw new Z("Invalid PeerId");const e=r.toCID().toString();return new At(`${TK}${e}`)}async function bEe(r,e,t,n){const i=new Map;for(const s of t){if(s==null)continue;if(s.multiaddr instanceof Uint8Array&&(s.multiaddr=Re(s.multiaddr)),!Cm(s.multiaddr))throw new Z("Multiaddr was invalid");if(!await e(r,s.multiaddr))continue;const o=s.isCertified??!1,a=s.multiaddr.toString(),c=i.get(a);c!=null?s.isCertified=c.isCertified||o:i.set(a,{multiaddr:s.multiaddr,isCertified:o})}return[...i.values()].sort((s,o)=>s.multiaddr.toString().localeCompare(o.multiaddr.toString())).map(({isCertified:s,multiaddr:o})=>({isCertified:s,multiaddr:o.bytes}))}async function gA(r,e,t,n){var p,b;if(e==null)throw new Z("Invalid PeerData");if(e.publicKey!=null&&r.publicKey!=null&&!e.publicKey.equals(r.publicKey))throw new Z("publicKey bytes do not match peer id publicKey bytes");const i=(p=n.existingPeer)==null?void 0:p.peer;if(i!=null&&!r.equals(i.id))throw new Z("peer id did not match existing peer id");let s=(i==null?void 0:i.addresses)??[],o=new Set((i==null?void 0:i.protocols)??[]),a=(i==null?void 0:i.metadata)??new Map,c=(i==null?void 0:i.tags)??new Map,l=i==null?void 0:i.peerRecordEnvelope;if(t==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(s=[],e.multiaddrs!=null&&s.push(...e.multiaddrs.map(f=>({isCertified:!1,multiaddr:f}))),e.addresses!=null&&s.push(...e.addresses)),e.protocols!=null&&(o=new Set(e.protocols)),e.metadata!=null){const f=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);a=N4(f,{validate:PK})}if(e.tags!=null){const f=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);c=N4(f,{validate:DK,map:$K})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}if(t==="merge"){if(e.multiaddrs!=null&&s.push(...e.multiaddrs.map(f=>({isCertified:!1,multiaddr:f}))),e.addresses!=null&&s.push(...e.addresses),e.protocols!=null&&(o=new Set([...o,...e.protocols])),e.metadata!=null){const f=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(const[g,v]of f)v==null?a.delete(g):a.set(g,v);a=N4([...a.entries()],{validate:PK})}if(e.tags!=null){const f=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),g=new Map(c);for(const[v,y]of f)y==null?g.delete(v):g.set(v,y);c=N4([...g.entries()],{validate:DK,map:$K})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}let d;(i==null?void 0:i.id.publicKey)!=null?d=_i(i.id.publicKey):e.publicKey!=null?d=_i(e.publicKey):r.publicKey!=null&&(d=_i(r.publicKey));const h={addresses:await bEe(r,n.addressFilter??(async()=>!0),s,(b=n.existingPeer)==null?void 0:b.peerPB.addresses),protocols:[...o.values()].sort((f,g)=>f.localeCompare(g)),metadata:a,tags:c,publicKey:d,peerRecordEnvelope:l};return h.addresses.forEach(f=>{var g,v,y;f.observed=((y=(v=(g=n.existingPeer)==null?void 0:g.peerPB.addresses)==null?void 0:v.find(w=>We(w.multiaddr,w.multiaddr)))==null?void 0:y.observed)??Date.now()}),r.type!=="RSA"&&delete h.publicKey,h}function N4(r,e){var n;const t=new Map;for(const[i,s]of r)s!=null&&e.validate(i,s);for(const[i,s]of r.sort(([o],[a])=>o.localeCompare(a)))s!=null&&t.set(i,((n=e.map)==null?void 0:n.call(e,i,s))??s);return t}function PK(r,e){if(typeof r!="string")throw new Z("Metadata key must be a string");if(!(e instanceof Uint8Array))throw new Z("Metadata value must be a Uint8Array")}function DK(r,e){if(typeof r!="string")throw new Z("Tag name must be a string");if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new Z("Tag value must be an integer");if(e.value<0||e.value>100)throw new Z("Tag value must be between 0-100")}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new Z("Tag ttl must be an integer");if(e.ttl<0)throw new Z("Tag ttl must be between greater than 0")}}function $K(r,e){let t;return e.expiry!=null&&(t=e.expiry),e.ttl!=null&&(t=BigInt(Date.now()+Number(e.ttl))),{value:e.value??0,expiry:t}}function NK(r){const e=r.toString().split("/")[2],t=$r.parse(e,i0);return Vd(t)}function yA(r,e,t){const n=NK(r);return fA(n,e,t)}function vEe(r,e){return{prefix:TK,filters:(r.filters??[]).map(t=>({key:n,value:i})=>t(yA(n,i,e))),orders:(r.orders??[]).map(t=>(n,i)=>t(yA(n.key,n.value,e),yA(i.key,i.value,e)))}}class EEe{constructor(e,t={}){Ye(this,Vn);u(this,"peerId");u(this,"datastore");u(this,"lock");u(this,"addressFilter");u(this,"log");u(this,"maxAddressAge");u(this,"maxPeerAge");this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.lock=E7({name:"peer-store",singleProcess:!0}),this.maxAddressAge=t.maxAddressAge??lEe,this.maxPeerAge=t.maxPeerAge??uEe}async has(e){try{return await this.load(e),!0}catch(t){if(t.name!=="NotFoundError")throw t}return!1}async delete(e){this.peerId.equals(e)||await this.datastore.delete($4(e))}async load(e){const t=$4(e),n=await this.datastore.get(t),i=xu.decode(n);if(Ie(this,Vn,X4).call(this,e,i))throw await this.datastore.delete(t),new Zt;return pA(e,i,this.peerId.equals(e)?1/0:this.maxAddressAge)}async save(e,t){const n=await Ie(this,Vn,J4).call(this,e),i=await gA(e,t,"patch",{addressFilter:this.addressFilter});return Ie(this,Vn,Y4).call(this,e,i,n)}async patch(e,t){const n=await Ie(this,Vn,J4).call(this,e),i=await gA(e,t,"patch",{addressFilter:this.addressFilter,existingPeer:n});return Ie(this,Vn,Y4).call(this,e,i,n)}async merge(e,t){const n=await Ie(this,Vn,J4).call(this,e),i=await gA(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:n});return Ie(this,Vn,Y4).call(this,e,i,n)}async*all(e){for await(const{key:t,value:n}of this.datastore.query(vEe(e??{},this.maxAddressAge))){const i=NK(t);if(i.equals(this.peerId))continue;const s=xu.decode(n);if(Ie(this,Vn,X4).call(this,i,s)){await this.datastore.delete(t);continue}yield pA(i,s,this.peerId.equals(i)?1/0:this.maxAddressAge)}}}Vn=new WeakSet,J4=async function(e){try{const t=$4(e),n=await this.datastore.get(t),i=xu.decode(n);if(Ie(this,Vn,X4).call(this,e,i))throw await this.datastore.delete(t),new Zt;return{peerPB:i,peer:fA(e,n,this.maxAddressAge)}}catch(t){t.name!=="NotFoundError"&&this.log.error("invalid peer data found in peer store - %e",t)}},Y4=async function(e,t,n){t.updated=Date.now();const i=xu.encode(t);return await this.datastore.put($4(e),i),{peer:fA(e,i,this.maxAddressAge),previous:n==null?void 0:n.peer,updated:n==null||!hEe(t,n.peerPB)}},X4=function(e,t){if(t.updated==null)return!0;if(this.peerId.equals(e))return!1;const n=t.updated<Date.now()-this.maxPeerAge,i=Date.now()-this.maxAddressAge,s=t.addresses.filter(o=>o.observed!=null&&o.observed>i);return n&&s.length===0},DH=Symbol.toStringTag;class SEe{constructor(e,t={}){Ye(this,tf);u(this,"store");u(this,"events");u(this,"peerId");u(this,"log");u(this,DH,"@libp2p/peer-store");this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new EEe(e,t)}async forEach(e,t){this.log.trace("forEach await read lock");const n=await this.store.lock.readLock();this.log.trace("forEach got read lock");try{for await(const i of this.store.all(t))e(i)}finally{this.log.trace("forEach release read lock"),n()}}async all(e){this.log.trace("all await read lock");const t=await this.store.lock.readLock();this.log.trace("all got read lock");try{return await Xm(this.store.all(e))}finally{this.log.trace("all release read lock"),t()}}async delete(e){this.log.trace("delete await write lock");const t=await this.store.lock.writeLock();this.log.trace("delete got write lock");try{await this.store.delete(e)}finally{this.log.trace("delete release write lock"),t()}}async has(e){this.log.trace("has await read lock");const t=await this.store.lock.readLock();this.log.trace("has got read lock");try{return await this.store.has(e)}finally{this.log.trace("has release read lock"),t()}}async get(e){this.log.trace("get await read lock");const t=await this.store.lock.readLock();this.log.trace("get got read lock");try{return await this.store.load(e)}finally{this.log.trace("get release read lock"),t()}}async save(e,t){this.log.trace("save await write lock");const n=await this.store.lock.writeLock();this.log.trace("save got write lock");try{const i=await this.store.save(e,t);return Ie(this,tf,Z4).call(this,e,i),i.peer}finally{this.log.trace("save release write lock"),n()}}async patch(e,t){this.log.trace("patch await write lock");const n=await this.store.lock.writeLock();this.log.trace("patch got write lock");try{const i=await this.store.patch(e,t);return Ie(this,tf,Z4).call(this,e,i),i.peer}finally{this.log.trace("patch release write lock"),n()}}async merge(e,t){this.log.trace("merge await write lock");const n=await this.store.lock.writeLock();this.log.trace("merge got write lock");try{const i=await this.store.merge(e,t);return Ie(this,tf,Z4).call(this,e,i),i.peer}finally{this.log.trace("merge release write lock"),n()}}async consumePeerRecord(e,t){const n=await Dc.openAndCertify(e,js.DOMAIN),i=Vd(n.publicKey.toCID());if((t==null?void 0:t.equals(i))===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",t,i),!1;const s=js.createFromProtobuf(n.payload);let o;try{o=await this.get(i)}catch(a){if(a.name!=="NotFoundError")throw a}if((o==null?void 0:o.peerRecordEnvelope)!=null){const a=await Dc.createFromProtobuf(o.peerRecordEnvelope),c=js.createFromProtobuf(a.payload);if(c.seqNumber>=s.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",c.seqNumber,s.seqNumber),!1}return await this.patch(s.peerId,{peerRecordEnvelope:e,addresses:s.multiaddrs.map(a=>({isCertified:!0,multiaddr:a}))}),!0}}tf=new WeakSet,Z4=function(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))};function xEe(r,e={}){return new SEe(r,e)}function AEe(r,e){let t;const n=function(){const i=function(){t=void 0,r()};clearTimeout(t),t=setTimeout(i,e)};return n.start=()=>{},n.stop=()=>{clearTimeout(t)},n}const MK=864e13,CEe=448,mA=449,IEe=53,kEe=54,_Ee=55,TEe=56;class PEe{constructor(e,t={}){u(this,"log");u(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=new Map}has(e){const t=this.findHost(e);for(const n of this.mappings.values())if(n.domain===t)return!0;return!1}add(e,t){t.forEach(n=>{this.log("add DNS mapping %s to %s",n,e);const i=vc(n)===!0;this.mappings.set(n,{domain:e,verified:i,expires:i?MK-Date.now():0,lastVerified:i?MK-Date.now():void 0})})}remove(e){const t=this.findHost(e);let n=!1;for(const[i,s]of this.mappings.entries())s.domain===t&&(this.log("removing %s to %s DNS mapping %e",i,s.domain,new Error("where")),this.mappings.delete(i),n=n||s.verified);return n}getAll(e){const t=[];for(let n=0;n<e.length;n++){const s=e[n].multiaddr.stringTuples(),o=s[0][1];if(o!=null)for(const[a,c]of this.mappings.entries()){if(o!==a)continue;this.maybeAddSNITuple(s,c.domain)&&(e.splice(n,1),n--,t.push({multiaddr:Re(`/${s.map(d=>[Ve(d[0]).name,d[1]].join("/")).join("/")}`),verified:c.verified,type:"dns-mapping",expires:c.expires,lastVerified:c.lastVerified}))}}return t}maybeAddSNITuple(e,t){var n;for(let i=0;i<e.length;i++)if(e[i][0]===CEe&&((n=e[i+1])==null?void 0:n[0])!==mA)return e.splice(i+1,0,[mA,t]),!0;return!1}confirm(e,t){const n=this.findHost(e);let i=!1;for(const[s,o]of this.mappings.entries())o.domain===n&&(this.log("marking %s to %s DNS mapping as verified",s,o.domain),i=o.verified,o.verified=!0,o.expires=Date.now()+t,o.lastVerified=Date.now());return i}unconfirm(e,t){const n=this.findHost(e);let i=!1;for(const[s,o]of this.mappings.entries())o.domain===n&&(this.log("removing verification of %s to %s DNS mapping",s,o.domain),i=i||o.verified,o.verified=!1,o.expires=Date.now()+t);return i}findHost(e){for(const t of e.stringTuples())if(t[0]===mA||t[0]===IEe||t[0]===kEe||t[0]===_Ee||t[0]===TEe)return t[1]}}const wA=4,bA=41,vA=6,DEe=273;class $Ee{constructor(e,t={}){u(this,"log");u(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=new Map}has(e){const t=e.stringTuples();for(const n of this.mappings.values())for(const i of n)if(i.externalIp===t[0][1])return!0;return!1}add(e,t,n,i=t,s="tcp"){const o=`${e}-${t}-${s}`,a=this.mappings.get(o)??[],c={internalIp:e,internalPort:t,externalIp:n,externalPort:i,externalFamily:Yd(n)?4:6,protocol:s,verified:!1,expires:0};a.push(c),this.mappings.set(o,a)}remove(e){const t=e.stringTuples(),n=t[0][1]??"",i=t[1][0]===vA?"tcp":"udp",s=parseInt(t[1][1]??"0");let o=!1;for(const[a,c]of this.mappings.entries()){for(let l=0;l<c.length;l++){const d=c[l];d.externalIp===n&&d.externalPort===s&&d.protocol===i&&(this.log("removing %s:%s to %s:%s %s IP mapping",d.externalIp,d.externalPort,n,s,i),o=o||d.verified,c.splice(l,1),l--)}c.length===0&&this.mappings.delete(a)}return o}getAll(e){const t=[];for(const{multiaddr:n}of e){const i=n.stringTuples();let s;if((i[0][0]===wA||i[0][0]===bA)&&i[1][0]===vA?s=`${i[0][1]}-${i[1][1]}-tcp`:(i[0][0]===wA||i[0][0]===bA)&&i[1][0]===DEe&&(s=`${i[0][1]}-${i[1][1]}-udp`),s==null)continue;const o=this.mappings.get(s);if(o!=null)for(const a of o)i[0][0]=a.externalFamily===4?wA:bA,i[0][1]=a.externalIp,i[1][1]=`${a.externalPort}`,t.push({multiaddr:Re(`/${i.map(c=>[Ve(c[0]).name,c[1]].join("/")).join("/")}`),verified:a.verified,type:"ip-mapping",expires:a.expires,lastVerified:a.lastVerified})}return t}confirm(e,t){const i=e.stringTuples()[0][1];let s=!1;for(const o of this.mappings.values())for(const a of o)a.externalIp===i&&(this.log("marking %s to %s IP mapping as verified",a.internalIp,a.externalIp),s=a.verified,a.verified=!0,a.expires=Date.now()+t,a.lastVerified=Date.now());return s}unconfirm(e,t){const n=e.stringTuples(),i=n[0][1]??"",s=n[1][0]===vA?"tcp":"udp",o=parseInt(n[1][1]??"0");let a=!1;for(const c of this.mappings.values())for(let l=0;l<c.length;l++){const d=c[l];d.externalIp===i&&d.externalPort===o&&d.protocol===s&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",d.externalIp,d.externalPort,i,o,s),a=a||d.verified,d.verified=!1,d.expires=Date.now()+t)}return a}}const NEe=4,MEe=41;function OEe(r){try{const[[e,t]]=r.stringTuples();if(t==null)return!1;if(e===NEe)return t.startsWith("169.254.");if(e===MEe)return t.toLowerCase().startsWith("fe80")}catch{}return!1}const REe={maxObservedAddresses:10};class LEe{constructor(e,t={}){u(this,"log");u(this,"addresses");u(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??REe.maxObservedAddresses}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(const t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&(Yl(e)||OEe(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:Re(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){var n;const t=((n=this.addresses.get(e.toString()))==null?void 0:n.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){const n=e.toString(),i=this.addresses.get(n)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},s=i.verified;return i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now(),this.log("marking observed address %a as verified",n),this.addresses.set(n,i),s}}const BEe=[4,41,53,54,55,56];function OK(r){try{const[[e]]=r.stringTuples();return BEe.includes(e)}catch{}return!1}const UEe={maxObservedAddresses:10};class FEe{constructor(e,t={}){u(this,"log");u(this,"addresses");u(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??UEe.maxObservedAddresses}get(e,t){if(Yl(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};const n=this.toKey(e);let i=this.addresses.get(n);return i==null&&(i={verified:!OK(e),expires:0},this.addresses.set(n,i)),{multiaddr:e,verified:i.verified,type:"transport",expires:i.expires,lastVerified:i.lastVerified}}has(e){const t=this.toKey(e);return this.addresses.has(t)}remove(e){var i;const t=this.toKey(e),n=((i=this.addresses.get(t))==null?void 0:i.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),n}confirm(e,t){const n=this.toKey(e),i=this.addresses.get(n)??{verified:!1,expires:0,lastVerified:0},s=i.verified;return i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now(),this.addresses.set(n,i),s}unconfirm(e,t){const n=this.toKey(e),i=this.addresses.get(n)??{verified:!1,expires:0},s=i.verified;return i.verified=!1,i.expires=Date.now()+t,this.addresses.set(n,i),s}toKey(e){if(OK(e)){const t=e.toOptions();return`${t.host}-${t.port}-${t.transport}`}return e.toString()}}const RK=6e4,LK={addressVerificationTTL:RK*10,addressVerificationRetry:RK*5},zEe=r=>r;function EA(r,e){const t=r.getPeerId();return t!=null&&tr(t).equals(e)&&(r=r.decapsulate(Re(`/p2p/${e.toString()}`))),r}$H=Symbol.toStringTag;class VEe{constructor(e,t={}){u(this,"log");u(this,"components");u(this,"listen");u(this,"announce");u(this,"appendAnnounce");u(this,"announceFilter");u(this,"observed");u(this,"dnsMappings");u(this,"ipMappings");u(this,"transportAddresses");u(this,"observedAddressFilter");u(this,"addressVerificationTTL");u(this,"addressVerificationRetry");u(this,$H,"@libp2p/address-manager");const{listen:n=[],announce:i=[],appendAnnounce:s=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=n.map(o=>o.toString()),this.announce=new Set(i.map(o=>o.toString())),this.appendAnnounce=new Set(s.map(o=>o.toString())),this.observed=new LEe(e,t),this.dnsMappings=new PEe(e,t),this.ipMappings=new $Ee(e,t),this.transportAddresses=new FEe(e,t),this.announceFilter=t.announceFilter??zEe,this.observedAddressFilter=Vl(1024),this.addressVerificationTTL=t.addressVerificationTTL??LK.addressVerificationTTL,this.addressVerificationRetry=t.addressVerificationRetry??LK.addressVerificationRetry,this._updatePeerStoreAddresses=AEe(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}_updatePeerStoreAddresses(){const e=this.getAddresses().map(t=>t.getPeerId()===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(t=>{this.log.error("error updating addresses",t)})}getListenAddrs(){return Array.from(this.listen).map(e=>Re(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>Re(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>Re(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){const t=e.stringTuples(),n=`${t[0][1]}:${t[1][1]}`;this.observedAddressFilter.has(n)||(this.observedAddressFilter.add(n),e=EA(e,this.components.peerId),!this.ipMappings.has(e)&&(this.dnsMappings.has(e)||this.observed.add(e)))}confirmObservedAddr(e,t){e=EA(e,this.components.peerId);let n=!0;((t==null?void 0:t.type)==="transport"||this.transportAddresses.has(e))&&!this.transportAddresses.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="dns-mapping"||this.dnsMappings.has(e))&&!this.dnsMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="ip-mapping"||this.ipMappings.has(e))&&!this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="observed"||this.observed.has(e))&&(this.maybeUpgradeToIPMapping(e)?(this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL),n=!1):!this.observed.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1)),n||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=EA(e,this.components.peerId),this.observed.has(e)&&this.observed.remove(e),this.transportAddresses.has(e)&&this.transportAddresses.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.dnsMappings.has(e)&&this.dnsMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.ipMappings.has(e)&&this.ipMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry)}getAddresses(){const e=new Set,t=this.getAddressesWithMetadata().filter(n=>{if(!n.verified)return!1;const i=n.multiaddr.toString();return e.has(i)?!1:(e.add(i),!0)}).map(n=>n.multiaddr);return this.announceFilter(t.map(n=>{var s;const i=Re(n);return((s=i.protos().pop())==null?void 0:s.path)===!0||i.getPeerId()===this.components.peerId.toString()?i:i.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){const e=this.getAnnounceAddrs();if(e.length>0)return this.components.transportManager.getListeners().forEach(i=>{i.updateAnnounceAddrs(e)}),e.map(i=>({multiaddr:i,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];t=t.concat(this.components.transportManager.getAddrs().map(i=>this.transportAddresses.get(i,this.addressVerificationTTL)));const n=this.getAppendAnnounceAddrs();return n.length>0&&(this.components.transportManager.getListeners().forEach(i=>{i.updateAnnounceAddrs(n)}),t=t.concat(n.map(i=>({multiaddr:i,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),t=t.concat(this.observed.getAll()),t=t.concat(this.ipMappings.getAll(t)),t=t.concat(this.dnsMappings.getAll(t)),t}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove(Re(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,n,i=t,s="tcp"){this.ipMappings.add(e,t,n,i,s),this.observed.removePrefixed(`/ip${Yd(n)?4:6}/${n}/${s}/${i}`)}removePublicAddressMapping(e,t,n,i=t,s="tcp"){this.ipMappings.remove(Re(`/ip${Yd(n)?4:6}/${n}/${s}/${i}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(e){if(this.ipMappings.has(e))return!1;const t=e.toOptions();if(t.family===6||t.host==="127.0.0.1"||vc(t.host)===!0)return!1;const n=this.components.transportManager.getListeners(),i=[s=>Y1.exactMatch(s)||wm.exactMatch(s),s=>ym.exactMatch(s),s=>vhe.exactMatch(s)];for(const s of i){if(!s(e))continue;const o=n.filter(l=>l.getAddrs().filter(d=>d.toOptions().family===4&&s(d)).length>0);if(o.length!==1)continue;const a=o[0].getAddrs().filter(l=>l.toOptions().host!=="127.0.0.1").pop();if(a==null)continue;const c=a.toOptions();return this.observed.remove(e),this.ipMappings.add(c.host,c.port,t.host,t.port,t.transport),!0}return!1}}var BK;(function(r){r.NOT_STARTED_YET="The libp2p node is not started yet",r.NOT_FOUND="Not found"})(BK||(BK={}));class KEe extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}}class jEe extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}}class SA extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}}class UK extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}}class HEe extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}}class qEe extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}}class WEe extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}}class FK extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}}class GEe extends Error{constructor(e="No transport was configured to listen on this address"){super(e),this.name="UnsupportedListenAddressError"}}class QEe extends Error{constructor(e="Configured listen addresses could not be listened on"){super(e),this.name="UnsupportedListenAddressesError"}}class JEe extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}}class YEe extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}}class XEe extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}}class M4 extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}}class O4 extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}}class ZEe extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}}class eSe{constructor(e={}){u(this,"components",{});u(this,"_started",!1);this.components={};for(const[t,n]of Object.entries(e))this.components[t]=n;this.components.logger==null&&(this.components.logger=Uy())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(t=>Rb(t)).map(async t=>{var n;await((n=t[e])==null?void 0:n.call(t))}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const tSe=["metrics","connectionProtector","dns"],rSe=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function nSe(r={}){const e=new eSe(r);return new Proxy(e,{get(n,i,s){if(typeof i=="string"&&!rSe.includes(i)){const o=e.components[i];if(o==null&&!tSe.includes(i))throw new KEe(`${i} not set`);return o}return Reflect.get(n,i,s)},set(n,i,s){return typeof i=="string"?e.components[i]=s:Reflect.set(n,i,s),!0}})}function iSe(r){const e={};for(const t of Object.values(r.components))for(const n of sSe(t))e[n]=!0;for(const t of Object.values(r.components))for(const n of oSe(t))if(e[n]!==!0)throw new jEe(`Service "${aSe(t)}" required capability "${n}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function sSe(r){return Array.isArray(r==null?void 0:r[dr])?r[dr]:[]}function oSe(r){return Array.isArray(r==null?void 0:r[Ja])?r[Ja]:[]}function aSe(r){return(r==null?void 0:r[Symbol.toStringTag])??(r==null?void 0:r.toString())??"unknown"}const cSe=4,lSe=41;function uSe(r={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{if(Y1.matches(e))return!1;const t=e.stringTuples();return t[0][0]===cSe||t[0][0]===lSe?!!vc(`${t[0][1]}`):!1},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...r}}function zK(r){if(fP(r))return{peerId:r,multiaddrs:[]};let e=Array.isArray(r)?r:[r],t;if(e.length>0){const n=e[0].getPeerId();t=n==null?void 0:tr(n),e.forEach(i=>{if(!Cm(i))throw new O2("Invalid multiaddr");const s=i.getPeerId();if(s==null){if(t!=null)throw new Z("Multiaddrs must all have the same peer id or have no peer id")}else{const o=tr(s);if((t==null?void 0:t.equals(o))!==!0)throw new Z("Multiaddrs must all have the same peer id or have no peer id")}})}return e=e.filter(n=>!yhe.exactMatch(n)),{peerId:t,multiaddrs:e}}const dSe=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function hSe(r,e){var i;const t=((i=r==null?void 0:r.streams)==null?void 0:i.map(s=>s.protocol))??[],n=(e==null?void 0:e.closableProtocols)??dSe;if(!(t.filter(s=>s!=null&&!n.includes(s)).length>0))try{await(r==null?void 0:r.close(e))}catch(s){r==null||r.abort(s)}}const VK=1e4,fSe=1e4,KK=1e4,jK=25,pSe=5,gSe=10,ySe=5,mSe="last-dial-failure",wSe="last-dial-success",HK=500,qK=100,WK=50;async function bSe(r,e){let t=!1;for(const i of c9.keys())if(t=r.protoNames().includes(i),t)break;if(!t)return[r];const n=await r.resolve(e);return e.log("resolved %s to",r,n.map(i=>i.toString())),n}function xA(r){try{let e;if(typeof r=="string"?e=Re(r):e=r,!e.protoNames().includes("ipcidr")){const n=e.protoNames().includes("ip6")?"/ipcidr/128":"/ipcidr/32";e=e.encapsulate(n)}return o1e(e)}catch{throw new Error(`Can't convert to IpNet, Invalid multiaddr format: ${r}`)}}const vSe={maxConnections:qK};class ESe{constructor(e,t={}){u(this,"maxConnections");u(this,"connectionManager");u(this,"peerStore");u(this,"allow");u(this,"events");u(this,"log");this.maxConnections=t.maxConnections??vSe.maxConnections,this.allow=(t.allow??[]).map(n=>xA(n)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections %e",e)})}async _maybePruneConnections(){const e=this.connectionManager.getConnections(),t=e.length;if(this.log("checking max connections limit %d/%d",t,this.maxConnections),t<=this.maxConnections)return;const n=new dc;for(const a of e){const c=a.remotePeer;if(!n.has(c)){n.set(c,0);try{const l=await this.peerStore.get(c);n.set(c,[...l.tags.values()].reduce((d,h)=>d+h.value,0))}catch(l){l.name!=="NotFoundError"&&this.log.error("error loading peer tags",l)}}}const i=this.sortConnections(e,n),s=Math.max(t-this.maxConnections,0),o=[];for(const a of i)if(this.log("too many connections open - closing a connection to %p",a.remotePeer),this.allow.some(l=>l.contains(a.remoteAddr.nodeAddress().address))||o.push(a),o.length===s)break;await Promise.all(o.map(async a=>{await hSe(a,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:o})}sortConnections(e,t){return e.sort((n,i)=>{const s=n.timeline.open,o=i.timeline.open;return s<o?1:s>o?-1:0}).sort((n,i)=>n.direction==="outbound"&&i.direction==="inbound"?1:n.direction==="inbound"&&i.direction==="outbound"?-1:0).sort((n,i)=>n.streams.length>i.streams.length?1:n.streams.length<i.streams.length?-1:0).sort((n,i)=>{const s=t.get(n.remotePeer)??0,o=t.get(i.remotePeer)??0;return s>o?1:s<o?-1:0})}}class SSe extends Ul{constructor(e={}){super({...e,sort:(t,n)=>t.options.priority>n.options.priority?-1:t.options.priority<n.options.priority?1:0})}}function xSe(r){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r)||/^::1$/.test(r)}function GK(r){if(!$L(r))return!1;const{address:e}=r.nodeAddress();return xSe(e)}function ASe(r,e){const t=ym.exactMatch(r.multiaddr),n=ym.exactMatch(e.multiaddr);if(t&&!n)return-1;if(!t&&n)return 1;const i=wm.exactMatch(r.multiaddr),s=wm.exactMatch(e.multiaddr);if(i&&!s)return-1;if(!i&&s)return 1;const o=Y1.exactMatch(r.multiaddr),a=Y1.exactMatch(e.multiaddr);if(o&&!a)return-1;if(!o&&a)return 1;const c=W7.exactMatch(r.multiaddr),l=W7.exactMatch(e.multiaddr);if(c&&!l)return-1;if(!c&&l)return 1;const d=q7.exactMatch(r.multiaddr),h=q7.exactMatch(e.multiaddr);if(d&&!h)return-1;if(!d&&h)return 1;const p=uO.exactMatch(r.multiaddr),b=uO.exactMatch(e.multiaddr);return p&&!b?-1:!p&&b?1:0}function CSe(r,e){const t=GK(r.multiaddr),n=GK(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function ISe(r,e){const t=Yl(r.multiaddr),n=Yl(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function kSe(r,e){return r.isCertified&&!e.isCertified?-1:!r.isCertified&&e.isCertified?1:0}function _Se(r,e){const t=Ec.exactMatch(r.multiaddr),n=Ec.exactMatch(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function TSe(r){return r.sort(ASe).sort(kSe).sort(_Se).sort(ISe).sort(CSe)}const R4={maxParallelDials:WK,maxDialQueueLength:HK,maxPeerAddrsToDial:jK,dialTimeout:VK};class PSe{constructor(e,t={}){u(this,"queue");u(this,"components");u(this,"addressSorter");u(this,"maxPeerAddrsToDial");u(this,"maxDialQueueLength");u(this,"dialTimeout");u(this,"shutDownController");u(this,"connections");u(this,"log");this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??R4.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??R4.maxDialQueueLength,this.dialTimeout=t.dialTimeout??R4.dialTimeout,this.connections=t.connections??new dc,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.shutDownController=new AbortController,this.shutDownController.signal;for(const[n,i]of Object.entries(t.resolvers??{}))c9.set(n,i);this.queue=new SSe({concurrency:t.maxParallelDials??R4.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",n=>{var i;((i=n.detail)==null?void 0:i.name)!==Tl.name&&this.log.error("error in dial queue - %e",n.detail)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e,t={}){var a,c,l;const{peerId:n,multiaddrs:i}=zK(e),s=Array.from(this.connections.values()).flat().find(d=>t.force===!0?!1:d.remotePeer.equals(n)?!0:i.find(h=>h.equals(d.remoteAddr)));if((s==null?void 0:s.status)==="open")return this.log("already connected to %a",s.remoteAddr),(a=t.onProgress)==null||a.call(t,new _e("dial-queue:already-connected")),s;const o=this.queue.queue.find(d=>{if((n==null?void 0:n.equals(d.options.peerId))===!0)return!0;const h=d.options.multiaddrs;if(h==null)return!1;for(const p of i)if(h.has(p.toString()))return!0;return!1});if(o!=null){this.log("joining existing dial target for %p",n);for(const d of i)o.options.multiaddrs.add(d.toString());return(c=t.onProgress)==null||c.call(t,new _e("dial-queue:already-in-dial-queue")),o.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new Ad("Dial queue is full");return this.log("creating dial target for %p",n,i.map(d=>d.toString())),(l=t.onProgress)==null||l.call(t,new _e("dial-queue:add-to-dial-queue")),this.queue.add(async d=>{var p;(p=d.onProgress)==null||p.call(d,new _e("dial-queue:start-dial"));const h=pt([this.shutDownController.signal,d.signal]);try{return await this.dialPeer(d,h)}finally{h.clear()}},{peerId:n,priority:t.priority??XK,multiaddrs:new Set(i.map(d=>d.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})}async dialPeer(e,t){var d;const n=e.peerId,i=e.multiaddrs,s=new Set;let o=e.multiaddrs.size===0,a=0,c=0;const l=[];for(this.log("starting dial to %p",n);o||i.size>0;){c++,o=!1;const h=[],p=new Set(e.multiaddrs);i.clear(),this.log("calculating addrs to dial %p from %s",n,[...p]);const b=await this.calculateMultiaddrs(n,p,{...e,signal:t});for(const f of b){if(s.has(f.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",f.multiaddr,n);continue}h.push(f)}this.log("%s dial to %p with %s",c===1?"starting":"continuing",n,h.map(f=>f.multiaddr.toString())),(d=e==null?void 0:e.onProgress)==null||d.call(e,new _e("dial-queue:calculated-addresses",h));for(const f of h){if(a===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",a,e.peerId),new Ad("Peer had more than maxPeerAddrsToDial");a++;try{const g=await this.components.transportManager.dial(f.multiaddr,{...e,signal:t});this.log("dial to %a succeeded",f.multiaddr);try{await this.components.peerStore.merge(g.remotePeer,{multiaddrs:[g.remoteAddr],metadata:{[wSe]:oe(Date.now().toString())}})}catch(v){this.log.error("could not update last dial failure key for %p",n,v)}return g}catch(g){if(this.log.error("dial failed to %a",f.multiaddr,g),s.add(f.multiaddr.toString()),n!=null)try{await this.components.peerStore.merge(n,{metadata:{[mSe]:oe(Date.now().toString())}})}catch(v){this.log.error("could not update last dial failure key for %p",n,v)}if(t.aborted)throw new y1(g.message);l.push(g)}}}throw l.length===1?l[0]:new AggregateError(l,"All multiaddr dials failed")}async calculateMultiaddrs(e,t=new Set,n={}){var h,p;const i=[...t].map(b=>({multiaddr:Re(b),isCertified:!1}));if(e!=null){if(this.components.peerId.equals(e))throw new Ad("Tried to dial self");if(await((p=(h=this.components.connectionGater).denyDialPeer)==null?void 0:p.call(h,e))===!0)throw new FK("The dial request is blocked by gater.allowDialPeer");if(i.length===0){this.log("loading multiaddrs for %p",e);try{const b=await this.components.peerStore.get(e);i.push(...b.addresses),this.log("loaded multiaddrs for %p",e,i.map(({multiaddr:f})=>f.toString()))}catch(b){if(b.name!=="NotFoundError")throw b}}if(i.length===0){this.log("looking up multiaddrs for %p in the peer routing",e);try{const b=await this.components.peerRouting.findPeer(e,n);this.log("found multiaddrs for %p in the peer routing",e,i.map(({multiaddr:f})=>f.toString())),i.push(...b.multiaddrs.map(f=>({multiaddr:f,isCertified:!1})))}catch(b){b.name==="NoPeerRoutersError"?this.log("no peer routers configured",e):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",e,b)}}}let s=(await Promise.all(i.map(async b=>{const f=await bSe(b.multiaddr,{dns:this.components.dns,...n,log:this.log});return f.length===1&&f[0].equals(b.multiaddr)?b:f.map(g=>({multiaddr:g,isCertified:!1}))}))).flat();if(e!=null){const b=`/p2p/${e.toString()}`;s=s.map(f=>{const g=f.multiaddr.protos().pop();return(g==null?void 0:g.path)===!0?f:f.multiaddr.getPeerId()==null?{multiaddr:f.multiaddr.encapsulate(b),isCertified:f.isCertified}:f})}const o=s.filter(b=>{if(this.components.transportManager.dialTransportForMultiaddr(b.multiaddr)==null)return!1;const f=b.multiaddr.getPeerId();return e!=null&&f!=null?e.equals(f):!0}),a=new Map;for(const b of o){const f=b.multiaddr.toString(),g=a.get(f);if(g!=null){g.isCertified=g.isCertified||b.isCertified||!1;continue}a.set(f,b)}const c=[...a.values()];if(c.length===0)throw new JEe("The dial request has no valid addresses");const l=[];for(const b of c)this.components.connectionGater.denyDialMultiaddr!=null&&await this.components.connectionGater.denyDialMultiaddr(b.multiaddr)||l.push(b);const d=this.addressSorter==null?TSe(l):l.sort(this.addressSorter);if(d.length===0)throw new FK("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",s.map(({multiaddr:b})=>b.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",d.map(({multiaddr:b})=>b.toString())),d}async isDialable(e,t={}){Array.isArray(e)||(e=[e]);try{const n=await this.calculateMultiaddrs(void 0,new Set(e.map(i=>i.toString())),t);return t.runOnLimitedConnection===!1?n.find(i=>!Ec.matches(i.multiaddr))!=null:!0}catch(n){this.log.trace("error calculating if multiaddr(s) were dialable",n)}return!1}}var QK={};function Ui(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var DSe=Ui;Ui.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},Ui.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},Ui.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0},Ui.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},Ui.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)},Ui.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)},Ui.prototype.start=Ui.prototype.try,Ui.prototype.errors=function(){return this._errors},Ui.prototype.attempts=function(){return this._attempts},Ui.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var i=this._errors[n],s=i.message,o=(r[s]||0)+1;r[s]=o,o>=t&&(e=i,t=o)}return e},function(r){var e=DSe;r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in t)n[i]=t[i];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],o=0;o<n.retries;o++)s.push(this.createTimeout(o,n));return t&&t.forever&&!s.length&&s.push(this.createTimeout(o,n)),s.sort(function(a,c){return a-c}),s},r.createTimeout=function(t,n){var i=n.randomize?Math.random()+1:1,s=Math.round(i*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return s=Math.min(s,n.maxTimeout),s},r.wrap=function(t,n,i){if(n instanceof Array&&(i=n,n=null),!i){i=[];for(var s in t)typeof t[s]=="function"&&i.push(s)}for(var o=0;o<i.length;o++){var a=i[o],c=t[a];t[a]=(function(d){var h=r.operation(n),p=Array.prototype.slice.call(arguments,1),b=p.pop();p.push(function(f){h.retry(f)||(f&&(arguments[0]=h.mainError()),b.apply(this,arguments))}),h.attempt(function(){d.apply(t,p)})}).bind(t,c),t[a].options=n}}}(QK);var $Se=QK;const NSe=Xe($Se),MSe=Object.prototype.toString,OSe=r=>MSe.call(r)==="[object Error]",RSe=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function LSe(r){return r&&OSe(r)&&r.name==="TypeError"&&typeof r.message=="string"?r.message==="Load failed"?r.stack===void 0:RSe.has(r.message):!1}class BSe extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const JK=(r,e,t)=>{const n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r};async function USe(r,e){return new Promise((t,n)=>{e={...e},e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.retries??(e.retries=10);const i=NSe.operation(e),s=()=>{var a;i.stop(),n((a=e.signal)==null?void 0:a.reason)};e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",s,{once:!0});const o=()=>{var a;(a=e.signal)==null||a.removeEventListener("abort",s),i.stop()};i.attempt(async a=>{try{const c=await r(a);o(),t(c)}catch(c){try{if(!(c instanceof Error))throw new TypeError(`Non-error was thrown: "${c}". You should only throw errors.`);if(c instanceof BSe)throw c.originalError;if(c instanceof TypeError&&!LSe(c))throw c;if(JK(c,a,e),await e.shouldRetry(c)||(i.stop(),n(c)),await e.onFailedAttempt(c),!i.retry(c))throw i.mainError()}catch(l){JK(l,a,e),o(),n(l)}}})})}class FSe{constructor(e,t={}){u(this,"log");u(this,"queue");u(this,"started");u(this,"peerStore");u(this,"retries");u(this,"retryInterval");u(this,"backoffFactor");u(this,"connectionManager");u(this,"events");this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new uc({concurrency:t.maxParallelReconnects??ySe,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",n=>{this.maybeReconnect(n.detail).catch(i=>{this.log.error("failed to maybe reconnect to %p - %e",n.detail,i)})})}async maybeReconnect(e){if(!this.started)return;const t=await this.peerStore.get(e);YK(t)&&(this.queue.has(e)||this.queue.add(async n=>{await USe(async i=>{if(this.started)try{await this.connectionManager.openConnection(e,{signal:n==null?void 0:n.signal})}catch(s){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,i,this.retries,s),s}},{signal:n==null?void 0:n.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:e}).catch(async n=>{this.log.error("failed to reconnect to %p - %e",e,n);const i={};[...t.tags.keys()].forEach(s=>{s.startsWith(D2)&&(i[s]=void 0)}),await this.peerStore.merge(e,{tags:i}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})}).catch(async n=>{this.log.error("failed to remove keep-alive tag from %p - %e",e,n)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[t=>YK(t)]});await Promise.all(e.map(async t=>{await this.connectionManager.openConnection(t.id).catch(n=>{this.log.error(n)})}))}).catch(e=>{this.log.error(e)})}stop(){this.started=!1,this.queue.abort()}}function YK(r){for(const e of r.tags.keys())if(e.startsWith(D2))return!0;return!1}const XK=50,AA={maxConnections:qK,inboundConnectionThreshold:pSe,maxIncomingPendingConnections:gSe};NH=Symbol.toStringTag;class zSe{constructor(e,t={}){u(this,"started");u(this,"connections");u(this,"allow");u(this,"deny");u(this,"maxIncomingPendingConnections");u(this,"incomingPendingConnections");u(this,"outboundPendingConnections");u(this,"maxConnections");u(this,"dialQueue");u(this,"reconnectQueue");u(this,"connectionPruner");u(this,"inboundConnectionRateLimiter");u(this,"peerStore");u(this,"metrics");u(this,"events");u(this,"log");u(this,"peerId");u(this,NH,"@libp2p/connection-manager");var n;if(this.maxConnections=t.maxConnections??AA.maxConnections,this.maxConnections<1)throw new Z("Connection Manager maxConnections must be greater than 0");this.connections=new dc,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(i=>xA(i)),this.deny=(t.deny??[]).map(i=>xA(i)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??AA.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new mF({points:t.inboundConnectionThreshold??AA.inboundConnectionThreshold,duration:1}),this.connectionPruner=new ESe({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{maxConnections:this.maxConnections,allow:(n=t.allow)==null?void 0:n.map(i=>Re(i))}),this.dialQueue=new PSe(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??WK,maxDialQueueLength:t.maxDialQueueLength??HK,maxPeerAddrsToDial:t.maxPeerAddrsToDial??jK,dialTimeout:t.dialTimeout??VK,resolvers:t.resolvers??{dnsaddr:yK},connections:this.connections}),this.reconnectQueue=new FSe({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}async start(){var e,t,n;(e=this.metrics)==null||e.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const i={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(const s of this.connections.values())for(const o of s)i[o.direction]++;return i}}),(t=this.metrics)==null||t.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const i={};for(const s of this.connections.values())for(const o of s)for(const a of o.streams){const c=`${a.direction} ${a.protocol??"unnegotiated"}`;i[c]=(i[c]??0)+1}return i}}),(n=this.metrics)==null||n.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const i={};for(const o of this.connections.values())for(const a of o){const c={};for(const l of a.streams){const d=`${l.direction} ${l.protocol??"unnegotiated"}`;c[d]=(c[d]??0)+1}for(const[l,d]of Object.entries(c))i[l]=i[l]??[],i[l].push(d)}const s={};for(let[o,a]of Object.entries(i)){a=a.sort((l,d)=>l-d);const c=Math.floor(a.length*.9);s[o]=a[c]}return s}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await Io(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await Qa(this.reconnectQueue,this.dialQueue,this.connectionPruner);const e=[];for(const t of this.connections.values())for(const n of t)e.push((async()=>{try{await n.close()}catch(i){this.log.error(i)}})());this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}onConnect(e){this._onConnect(e).catch(t=>{this.log.error(t)})}async _onConnect(e){const{detail:t}=e;if(!this.started){await t.close();return}if(t.status!=="open")return;const n=t.remotePeer,i=!this.connections.has(n),s=this.connections.get(n)??[];s.push(t),this.connections.set(n,s),n.publicKey!=null&&n.type==="RSA"&&await this.peerStore.patch(n,{publicKey:n.publicKey}),i&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){const{detail:t}=e,n=t.remotePeer,s=(this.connections.get(n)??[]).filter(o=>o.id!==t.id);this.connections.set(n,s),s.length===0&&(this.log("onDisconnect remove all connections for peer %p",n),this.connections.delete(n),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let t=[];for(const n of this.connections.values())t=t.concat(n);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){var n,i;if(!this.started)throw new Dl("Not started");this.outboundPendingConnections++;try{(n=t.signal)==null||n.throwIfAborted();const{peerId:s}=zK(e);if(this.peerId.equals(s))throw new Mb("Can not dial self");if(s!=null&&t.force!==!0){this.log("dial %p",s);const l=this.getConnections(s).find(d=>d.limits==null);if(l!=null)return this.log("had an existing non-limited connection to %p",s),(i=t.onProgress)==null||i.call(t,new _e("dial-queue:already-connected")),l}const o=await this.dialQueue.dial(e,{...t,priority:t.priority??XK});if(o.status!=="open")throw new $b("Remote closed connection during opening");let a=this.connections.get(o.remotePeer);a==null&&(a=[],this.connections.set(o.remotePeer,a));let c=!1;for(const l of a)if(l.id===o.id&&(c=!0),t.force!==!0&&l.id!==o.id&&l.remoteAddr.equals(o.remoteAddr))return o.abort(new O2("Duplicate multiaddr connection")),l;return c||a.push(o),o}finally{this.outboundPendingConnections--}}async closeConnections(e,t={}){const n=this.connections.get(e)??[];await Promise.all(n.map(async i=>{try{await i.close(t)}catch(s){i.abort(s)}}))}async acceptIncomingConnection(e){if(this.deny.some(i=>i.contains(e.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(i=>i.contains(e.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const i=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(i,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,i),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(n=>Re(n))}))}async isDialable(e,t={}){return this.dialQueue.isDialable(e,t)}}const VSe=1e4,KSe="1.0.0",jSe="ping",HSe="ipfs",ZK=32,qSe=!0;OH=Symbol.toStringTag,MH=dr;class WSe{constructor(e,t={}){u(this,"protocol");u(this,"components");u(this,"log");u(this,"heartbeatInterval");u(this,"pingIntervalMs");u(this,"abortController");u(this,"timeout");u(this,"abortConnectionOnPingFailure");u(this,OH,"@libp2p/connection-monitor");u(this,MH,["@libp2p/connection-monitor"]);this.components=e,this.protocol=`/${t.protocolPrefix??HSe}/${jSe}/${KSe}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??VSe,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??qSe,this.timeout=new mp({...t.pingTimeout??{},metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(async()=>{var n;let t=Date.now();try{const i=this.timeout.getTimeoutSignal({signal:(n=this.abortController)==null?void 0:n.signal}),s=await e.newStream(this.protocol,{signal:i,runOnLimitedConnection:!0}),o=Zm(s);t=Date.now(),await Promise.all([o.write(sc(ZK),{signal:i}),o.read({bytes:ZK,signal:i})]),e.rtt=Date.now()-t,await o.unwrap().close({signal:i})}catch(i){if(i.name!=="UnsupportedProtocolError")throw i;e.rtt=(Date.now()-t)/2}}).catch(t=>{this.log.error("error during heartbeat",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){var e;(e=this.abortController)==null||e.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}}RH=Symbol.toStringTag;class GSe{constructor(e,t){u(this,"routers");u(this,"started");u(this,"components");u(this,RH,"@libp2p/content-routing");var n,i,s,o,a;this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()}),getAttributesFromYieldedValue:(c,l)=>({...l,providers:[...Array.isArray(l.providers)?l.providers:[],c.id.toString()]})}))??this.findProviders,this.provide=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.provide,this.cancelReprovide=((s=e.metrics)==null?void 0:s.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.cancelReprovide,this.put=((o=e.metrics)==null?void 0:o.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([c])=>({key:re(c,"base36")})}))??this.put,this.get=((a=e.metrics)==null?void 0:a.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([c])=>({key:re(c,"base36")})}))??this.get}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw new SA("No content routers available");const n=this,i=new rs;for await(const s of Oa(...n.routers.map(o=>o.findProviders(e,t))))s!=null&&(s.multiaddrs.length>0&&await this.components.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),!i.has(s.id)&&(i.add(s.id),yield s))}async provide(e,t={}){if(this.routers.length===0)throw new SA("No content routers available");await Promise.all(this.routers.map(async n=>{await n.provide(e,t)}))}async cancelReprovide(e,t={}){if(this.routers.length===0)throw new SA("No content routers available");await Promise.all(this.routers.map(async n=>{await n.cancelReprovide(e,t)}))}async put(e,t,n){if(!this.isStarted())throw new Dl;await Promise.all(this.routers.map(async i=>{await i.put(e,t,n)}))}async get(e,t){if(!this.isStarted())throw new Dl;return Promise.any(this.routers.map(async n=>n.get(e,t)))}}LH=Symbol.toStringTag;class QSe{constructor(e,t={}){u(this,"log");u(this,"peerId");u(this,"peerStore");u(this,"routers");u(this,LH,"@libp2p/peer-routing");var n,i;this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([s],o)=>({...o,peer:s.toString()})}))??this.findPeer,this.getClosestPeers=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([s],o)=>({...o,key:re(s,"base36")}),getAttributesFromYieldedValue:(s,o)=>({...o,peers:[...Array.isArray(o.peers)?o.peers:[],s.id.toString()]})}))??this.getClosestPeers}async findPeer(e,t){if(this.routers.length===0)throw new UK("No peer routers available");if(e.toString()===this.peerId.toString())throw new HEe("Should not try to find self");const n=this,i=Oa(...this.routers.map(s=>async function*(){try{yield await s.findPeer(e,t)}catch(o){n.log.error(o)}}()));for await(const s of i)if(s!=null)return s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),s;throw new Zt}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new UK("No peer routers available");const n=this,i=Vl(1024);for await(const s of hp(async function*(){const o=Oa(...n.routers.map(a=>a.getClosestPeers(e,t)));for await(let a of o)yield async()=>{if(a.multiaddrs.length===0)try{a=await n.findPeer(a.id,{...t,useCache:!1})}catch(c){n.log.error("could not find peer multiaddrs",c);return}return a}}()))s!=null&&(s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),!i.has(s.id.toMultihash().bytes)&&(i.add(s.id.toMultihash().bytes),yield s))}}class JSe extends(UH=er,BH=Symbol.toStringTag,UH){constructor(t){super();u(this,"peerRouting");u(this,"log");u(this,"walking");u(this,"walkers");u(this,"shutdownController");u(this,"walkController");u(this,"needNext");u(this,BH,"@libp2p/random-walk");this.log=t.logger.forComponent("libp2p:random-walk"),this.peerRouting=t.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}async*walk(t){var i,s;this.walking||this.startWalk(),this.walkers++;const n=pt([this.shutdownController.signal,t==null?void 0:t.signal]);try{for(;;)(i=this.needNext)==null||i.resolve(),this.needNext=Le(),yield(await Ti(this,"walk:peer",n,{errorEvent:"walk:error"})).detail}finally{n.clear(),this.walkers--,this.walkers===0&&((s=this.walkController)==null||s.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;const t=pt([this.walkController.signal,this.shutdownController.signal]),n=Date.now();let i=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const s=sc(32);let o=Date.now();for await(const a of this.peerRouting.getClosestPeers(s,{signal:t}))t.aborted&&this.log("aborting walk"),t.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",a.id,Date.now()-o,this.walkers),i++,this.safeDispatchEvent("walk:peer",{detail:a}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),await ln(this.needNext.promise,t)),o=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",s,this.walkers,i)}catch(s){this.log.error("random walk errored",s),this.safeDispatchEvent("walk:error",{detail:s})}this.log("no walkers left, ended walk")}).catch(s=>{this.log.error("random walk errored",s)}).finally(()=>{this.log("finished walk, found %d peers after %dms",i,Date.now()-n),this.walking=!1})}}const ej=32,tj=64;FH=Symbol.toStringTag;class YSe{constructor(e){u(this,"log");u(this,"topologies");u(this,"handlers");u(this,"components");u(this,FH,"@libp2p/registrar");this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(t==null)throw new qEe(`No handler registered for protocol ${e}`);return t}getTopologies(e){const t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,n){if(this.handlers.has(e)&&(n==null?void 0:n.force)!==!0)throw new WEe(`Handler already registered for protocol ${e}`);const i=xE.bind({ignoreUndefined:!0})({maxInboundStreams:ej,maxOutboundStreams:tj},n);this.handlers.set(e,{handler:t,options:i}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]})}async unhandle(e){(Array.isArray(e)?e:[e]).forEach(n=>{this.handlers.delete(n)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(e,t){if(t==null)throw new Z("invalid topology");const n=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let i=this.topologies.get(e);return i==null&&(i=new Map,this.topologies.set(e,i)),i.set(n,t),n}unregister(e){for(const[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),n.size===0&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail;this.components.peerStore.get(t).then(n=>{var i,s,o;for(const a of n.protocols){const c=this.topologies.get(a);if(c!=null)for(const l of c.values())((i=l.filter)==null?void 0:i.has(t))!==!1&&((s=l.filter)==null||s.remove(t),(o=l.onDisconnect)==null||o.call(l,t))}}).catch(n=>{n.name!=="NotFoundError"&&this.log.error("could not inform topologies of disconnecting peer %p",t,n)})}_onPeerUpdate(e){var s,o,a;const{peer:t,previous:n}=e.detail,i=((n==null?void 0:n.protocols)??[]).filter(c=>!t.protocols.includes(c));for(const c of i){const l=this.topologies.get(c);if(l!=null)for(const d of l.values())((s=d.filter)==null?void 0:s.has(t.id))!==!1&&((o=d.filter)==null||o.remove(t.id),(a=d.onDisconnect)==null||a.call(d,t.id))}}_onPeerIdentify(e){var s,o,a;const t=e.detail.protocols,n=e.detail.connection,i=e.detail.peerId;for(const c of t){const l=this.topologies.get(c);if(l!=null)for(const d of l.values())n.limits!=null&&d.notifyOnLimitedConnection!==!0||((s=d.filter)==null?void 0:s.has(i))!==!0&&((o=d.filter)==null||o.add(i),(a=d.onConnect)==null||a.call(d,i,n))}}}zH=Symbol.toStringTag;class XSe{constructor(e,t={}){u(this,"log");u(this,"components");u(this,"transports");u(this,"listeners");u(this,"faultTolerance");u(this,"started");u(this,zH,"@libp2p/transport-manager");this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=new Map,this.listeners=HM({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??Ga.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(t==null)throw new Z("Transport must have a valid tag");if(this.transports.has(t))throw new Z(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[t,n]of this.listeners)for(this.log("closing listeners for %s",t);n.length>0;){const i=n.pop();i!=null&&e.push(i.close())}await Promise.all(e),this.log("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){var i;const n=this.dialTransportForMultiaddr(e);if(n==null)throw new ZEe(`No transport available for address ${String(e)}`);return(i=t==null?void 0:t.onProgress)==null||i.call(t,new _e("transport-manager:selected-transport",n[Symbol.toStringTag])),n.dial(e,{...t,upgrader:this.components.upgrader})}getAddrs(){let e=[];for(const t of this.listeners.values())for(const n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(const t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(const t of this.transports.values())if(t.listenFilter([e]).length>0)return t}async listen(e){if(!this.isStarted())throw new Dl("Not started");if(e==null||e.length===0){this.log("no addresses were provided for listening, this node is dial only");return}const t={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};e.forEach(s=>{t.errors.set(s.toString(),new GEe)});const n=[];for(const[s,o]of this.transports.entries()){const a=o.listenFilter(e);for(const c of a){this.log("creating listener for %s on %a",s,c);const l=o.createListener({upgrader:this.components.upgrader});let d=this.listeners.get(s)??[];d==null&&(d=[],this.listeners.set(s,d)),d.push(l),l.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:l})}),l.addEventListener("close",()=>{const h=d.findIndex(p=>p===l);d.splice(h,1),this.components.events.safeDispatchEvent("transport:close",{detail:l})}),iO.matches(c)?t.ipv4.attempts++:sO.matches(c)&&t.ipv6.attempts++,n.push(l.listen(c).then(()=>{t.errors.delete(c.toString()),iO.matches(c)&&t.ipv4.success++,sO.matches(c)&&t.ipv6.success++},h=>{throw this.log.error("transport %s could not listen on address %a - %e",s,c,h),t.errors.set(c.toString(),h),h}))}}const i=await Promise.allSettled(n);if(!(i.length>0&&i.every(s=>s.status==="fulfilled"))){if(this.ipv6Unsupported(t)){this.log("all IPv4 addresses succeed but all IPv6 failed");return}if(this.faultTolerance===Ga.NO_FATAL){this.log("failed to listen on any address but fault tolerance allows this");return}throw new QEe(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...t.errors.entries()].map(([s,o])=>`
  ${s}: ${`${o.stack??o}`.split(`
`).join(`
  `)}
`).join("")}`)}}ipv6Unsupported(e){if(e.ipv4.attempts===0||e.ipv6.attempts===0)return!1;const t=e.ipv4.attempts===e.ipv4.success,n=e.ipv6.success===0;return t&&n}async remove(e){const t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);const n=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){const i=t.pop();i!=null&&n.push(i.close())}await Promise.all(n),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}const Rn="/multistream/1.0.0",CA=1024,ZSe=oe(`
`);async function o0(r,e,t){await r.write(e,t)}async function exe(r,e,t){await r.writeV(e,t)}async function txe(r,e){const t=await r.read(e);if(t.byteLength===0||t.get(t.byteLength-1)!==ZSe[0])throw e.log.error("Invalid mss message - missing newline",t),new St("Missing newline");return t.sublist(0,-1)}async function Bh(r,e){const t=await txe(r,e);return re(t.subarray())}async function IA(r,e,t){if(e=Array.isArray(e)?[...e]:[e],e.length===1&&t.negotiateFully===!1)return rxe(r,e[0],t);const n=Zd(r,{...t,maxDataLength:CA}),i=e.shift();if(i==null)throw new Error("At least one protocol must be specified");t.log.trace('select: write ["%s", "%s"]',Rn,i);const s=oe(`${Rn}
`),o=oe(`${i}
`);await exe(n,[s,o],t),t.log.trace("select: reading multistream-select header");let a=await Bh(n,t);if(t.log.trace('select: read "%s"',a),a===Rn&&(t.log.trace("select: reading protocol response"),a=await Bh(n,t),t.log.trace('select: read "%s"',a)),a===i)return{stream:n.unwrap(),protocol:i};for(const c of e){t.log.trace('select: write "%s"',c),await o0(n,oe(`${c}
`),t),t.log.trace("select: reading protocol response");const l=await Bh(n,t);if(t.log.trace('select: read "%s" for "%s"',l,c),l===c)return{stream:n.unwrap(),protocol:c}}throw new g1("protocol selection failed")}function rxe(r,e,t){const n=r.sink.bind(r),i=r.source;let s=!1,o=!1;const a=Le();let c=!1,l=!1;const d=Le();let h=!1,p=!1;const b=Le(),f=Zd({sink:n,source:i},{...t,maxDataLength:CA});r.sink=async w=>{const{sink:m}=f.unwrap();await m(async function*(){let E=!1;for await(const A of w){if(l&&await d.promise,c)yield A;else{l=!0,t.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',Rn,e,A.byteLength);const k=`${e}
`;yield new Ue(Uint8Array.from([19]),oe(`${Rn}
`),Sr(k.length),oe(k),A).subarray(),t.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',Rn,e,A.byteLength),c=!0,l=!1,d.resolve(),g().catch(x=>{t.log.error("could not finish optimistic protocol negotiation of %s",e,x)})}E=!0}E||await g()}())};async function g(){if(o){t.log.trace("optimistic: already negotiating %s stream",e),await a.promise;return}o=!0;try{c||(t.log.trace("optimistic: doing send protocol for %s stream",e),await v()),h||(t.log.trace("optimistic: doing read protocol for %s stream",e),await y())}finally{o=!1,s=!0,a.resolve()}}async function v(){if(l){await d.promise;return}l=!0;try{t.log.trace('optimistic: write ["%s", "%s", data] in source',Rn,e),await f.writeV([oe(`${Rn}
`),oe(`${e}
`)]),t.log.trace('optimistic: wrote ["%s", "%s", data] in source',Rn,e)}finally{c=!0,l=!1,d.resolve()}}async function y(){if(p){await b.promise;return}p=!0;try{t.log.trace("optimistic: reading multistream select header");let w=await Bh(f,t);if(t.log.trace('optimistic: read multistream select header "%s"',w),w===Rn&&(w=await Bh(f,t)),t.log.trace('optimistic: read protocol "%s", expecting "%s"',w,e),w!==e)throw new g1("protocol selection failed")}finally{h=!0,p=!1,b.resolve()}}if(r.source=async function*(){await g(),t.log.trace('optimistic: reading data from "%s" stream',e),yield*f.unwrap().source}(),r.closeRead!=null){const w=r.closeRead.bind(r);r.closeRead=async m=>{s||await g().catch(E=>{t.log.error("could not negotiate protocol before close read",E)}),await w(m)}}if(r.closeWrite!=null){const w=r.closeWrite.bind(r);r.closeWrite=async m=>{s||await g().catch(E=>{t.log.error("could not negotiate protocol before close write",E)}),await w(m)}}if(r.close!=null){const w=r.close.bind(r);r.close=async m=>{const E=[];l&&E.push(d.promise),p&&E.push(b.promise),E.length>0?await ln(Promise.all(E),m==null?void 0:m.signal):(s=!0,o=!1,a.resolve()),await w(m)}}return{stream:r,protocol:e}}async function kA(r,e,t){e=Array.isArray(e)?e:[e],t.log.trace("handle: available protocols %s",e);const n=Zd(r,{...t,maxDataLength:CA,maxLengthLength:2});for(;;){t.log.trace("handle: reading incoming string");const i=await Bh(n,t);if(t.log.trace('handle: read "%s"',i),i===Rn){t.log.trace('handle: respond with "%s" for "%s"',Rn,i),await o0(n,oe(`${Rn}
`),t),t.log.trace('handle: responded with "%s" for "%s"',Rn,i);continue}if(e.includes(i))return t.log.trace('handle: respond with "%s" for "%s"',i,i),await o0(n,oe(`${i}
`),t),t.log.trace('handle: responded with "%s" for "%s"',i,i),{stream:n.unwrap(),protocol:i};if(i==="ls"){const s=new Ue(...e.map(o=>Bd.single(oe(`${o}
`))),oe(`
`));t.log.trace('handle: respond with "%s" for %s',e,i),await o0(n,s,t),t.log.trace('handle: responded with "%s" for %s',e,i);continue}t.log.trace('handle: respond with "na" for "%s"',i),await o0(n,oe(`na
`),t),t.log('handle: responded with "na" for "%s"',i)}}const nxe=500;KH=Symbol.toStringTag,VH=OZ;class ixe{constructor(e){u(this,"id");u(this,"remoteAddr");u(this,"remotePeer");u(this,"direction");u(this,"timeline");u(this,"multiplexer");u(this,"encryption");u(this,"status");u(this,"limits");u(this,"log");u(this,"tags");u(this,"_newStream");u(this,"_close");u(this,"_abort");u(this,"_getStreams");u(this,KH,"Connection");u(this,VH,!0);const{remoteAddr:t,remotePeer:n,newStream:i,close:s,abort:o,getStreams:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=n,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.limits=e.limits,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=i,this._close=s,this._abort=o,this._getStreams=a,this.tags=[]}get streams(){return this._getStreams()}async newStream(e,t){if(this.status==="closing")throw new gP("the connection is being closed");if(this.status==="closed")throw new $b("the connection is closed");if(Array.isArray(e)||(e=[e]),this.limits!=null&&(t==null?void 0:t.runOnLimitedConnection)!==!0)throw new Ob("Cannot open protocol stream on limited connection");const n=await this._newStream(e,t);return n.direction="outbound",n}async close(e={}){if(!(this.status==="closed"||this.status==="closing")){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",e.signal==null){const t=AbortSignal.timeout(nxe);e={...e,signal:t}}try{this.log.trace("closing underlying transport"),await this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(t){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,t),this.abort(t)}}}abort(e){this.status!=="closed"&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this._abort(e),this.status="closed",this.timeline.close=Date.now())}}function sxe(r){return new ixe(r)}function oxe(r,e){try{const{options:t}=e.getHandler(r);return t.maxInboundStreams}catch(t){if(t.name!=="UnhandledProtocolError")throw t}return ej}function axe(r,e,t={}){try{const{options:n}=e.getHandler(r);if(n.maxOutboundStreams!=null)return n.maxOutboundStreams}catch(n){if(n.name!=="UnhandledProtocolError")throw n}return t.maxOutboundStreams??tj}function rj(r,e,t){let n=0;return t.streams.forEach(i=>{i.direction===e&&i.protocol===r&&n++}),n}jH=Symbol.toStringTag;class cxe{constructor(e,t){u(this,"components");u(this,"connectionEncrypters");u(this,"streamMuxers");u(this,"inboundUpgradeTimeout");u(this,"inboundStreamProtocolNegotiationTimeout");u(this,"outboundStreamProtocolNegotiationTimeout");u(this,"events");u(this,"metrics");u(this,jH,"@libp2p/upgrader");var n,i;this.components=e,this.connectionEncrypters=new Map,t.connectionEncrypters.forEach(s=>{this.connectionEncrypters.set(s.protocol,s)}),this.streamMuxers=new Map,t.streamMuxers.forEach(s=>{this.streamMuxers.set(s.protocol,s)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??fSe,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??KK,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??KK,this.events=e.events,this.metrics={dials:(n=e.metrics)==null?void 0:n.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:(i=e.metrics)==null?void 0:i.registerCounterGroup("libp2p_connection_manager_dial_errors_total")}}async shouldBlockConnection(e,...t){const n=this.components.connectionGater[e];if(n==null)return;if(await n.apply(this.components.connectionGater,t)===!0)throw new YEe(`The multiaddr connection is blocked by gater.${e}`)}createInboundAbortSignal(e){return pt([AbortSignal.timeout(this.inboundUpgradeTimeout),e])}async upgradeInbound(e,t){var s,o;let n=!1;const i=this.createInboundAbortSignal(t.signal);try{if((s=this.metrics.dials)==null||s.increment({inbound:!0}),n=await this.components.connectionManager.acceptIncomingConnection(e),!n)throw new XEe("Connection denied");await this.shouldBlockConnection("denyInboundConnection",e),await this._performUpgrade(e,"inbound",{...t,signal:i})}catch(a){throw(o=this.metrics.errors)==null||o.increment({inbound:!0}),a}finally{i.clear(),n&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){var n,i;try{(n=this.metrics.dials)==null||n.increment({outbound:!0});const s=e.remoteAddr.getPeerId();let o;s!=null&&(o=tr(s),await this.shouldBlockConnection("denyOutboundConnection",o,e));let a="outbound";return t.initiator===!1&&(a="inbound"),await this._performUpgrade(e,a,t)}catch(s){throw(i=this.metrics.errors)==null||i.increment({outbound:!0}),s}}async _performUpgrade(e,t,n){var d,h,p;let i,s,o,a,c;(d=this.components.metrics)==null||d.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t);let l=e;if((n==null?void 0:n.skipProtection)!==!0){const b=this.components.connectionProtector;b!=null&&(e.log("protecting the %s connection",t),l=await b.protect(e,n))}try{if(i=l,(n==null?void 0:n.skipEncryption)!==!0){(h=n==null?void 0:n.onProgress)==null||h.call(n,new _e(`upgrader:encrypt-${t}-connection`)),{conn:i,remotePeer:s,protocol:c,streamMuxer:a}=await(t==="inbound"?this._encryptInbound(l,n):this._encryptOutbound(l,n));const b={...l,...i};await this.shouldBlockConnection(t==="inbound"?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",s,b)}else{const b=e.remoteAddr.getPeerId();if(b==null)throw new O2(`${t} connection that skipped encryption must have a peer id`);const f=tr(b);c="native",s=f}if(s.equals(this.components.peerId)){const b=new Mb("Can not dial self");throw e.abort(b),b}if(o=i,(n==null?void 0:n.muxerFactory)!=null)a=n.muxerFactory;else if(a==null&&this.streamMuxers.size>0){(p=n==null?void 0:n.onProgress)==null||p.call(n,new _e(`upgrader:multiplex-${t}-connection`));const b=await(t==="inbound"?this._multiplexInbound({...l,...i},this.streamMuxers,n):this._multiplexOutbound({...l,...i},this.streamMuxers,n));a=b.muxerFactory,o=b.stream}}catch(b){throw e.log.error("failed to upgrade inbound connection %s %a - %e",t==="inbound"?"from":"to",e.remoteAddr,b),b}return await this.shouldBlockConnection(t==="inbound"?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",s,e),e.log("successfully upgraded %s connection",t),this._createConnection({cryptoProtocol:c,direction:t,maConn:e,upgradedConn:o,muxerFactory:a,remotePeer:s,limits:n==null?void 0:n.limits})}_createConnection(e){const{cryptoProtocol:t,direction:n,maConn:i,upgradedConn:s,remotePeer:o,muxerFactory:a,limits:c}=e;let l,d,h;a!=null&&(l=a.createStreamMuxer({direction:n,onIncomingStream:f=>{h!=null&&Promise.resolve().then(async()=>{var A;const g=this.components.registrar.getProtocols(),v=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout),{stream:y,protocol:w}=await kA(f,g,{signal:v,log:f.log,yieldBytes:!1});if(h==null)return;h.log("incoming stream opened on %s",w);const m=oxe(w,this.components.registrar);if(rj(w,"inbound",h)===m){const k=new bP(`Too many inbound protocol streams for protocol "${w}" - limit ${m}`);throw f.abort(k),k}f.source=y.source,f.sink=y.sink,f.protocol=w,y.closeWrite!=null&&(f.closeWrite=y.closeWrite),y.closeRead!=null&&(f.closeRead=y.closeRead),y.close!=null&&(f.close=y.close),await this.components.peerStore.merge(o,{protocols:[w]}),(A=this.components.metrics)==null||A.trackProtocolStream(f,h),this._onStream({connection:h,stream:f,protocol:w})}).catch(async g=>{h.log.error("error handling incoming stream id %s - %e",f.id,g),f.timeline.close==null&&await f.close()})}}),d=async(f,g={})=>{var y;if(l==null)throw new M4("Connection is not multiplexed");h.log.trace("starting new stream for protocols %s",f);const v=await l.newStream();h.log.trace("started new stream %s for protocols %s",v.id,f);try{if(g.signal==null){v.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",f);const k=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);g={...g,signal:k}}v.log.trace("selecting protocol from protocols %s",f);const{stream:w,protocol:m}=await IA(v,f,{...g,log:v.log,yieldBytes:!0});v.log.trace("selected protocol %s",m);const E=axe(m,this.components.registrar,g),A=rj(m,"outbound",h);if(A>=E){const k=new B2(`Too many outbound protocol streams for protocol "${m}" - ${A}/${E}`);throw v.abort(k),k}return await this.components.peerStore.merge(o,{protocols:[m]}),v.source=w.source,v.sink=w.sink,v.protocol=m,w.closeWrite!=null&&(v.closeWrite=w.closeWrite),w.closeRead!=null&&(v.closeRead=w.closeRead),w.close!=null&&(v.close=w.close),(y=this.components.metrics)==null||y.trackProtocolStream(v,h),v}catch(w){throw h.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e",n==="inbound"?"from":"to",e.maConn.remoteAddr,f,w),v.timeline.close==null&&v.abort(w),w}},Promise.all([l.sink(s.source),s.sink(l.source)]).catch(f=>{h.log.error("error piping data through muxer - %e",f)}));const p=i.timeline;i.timeline=new Proxy(p,{set:(...f)=>(f[1]==="close"&&f[2]!=null&&p.close==null&&(async()=>{try{h.status==="open"&&await h.close()}catch(g){h.log.error("error closing connection after timeline close %e",g)}finally{this.events.safeDispatchEvent("connection:close",{detail:h})}})().catch(g=>{h.log.error("error thrown while dispatching connection:close event %e",g)}),Reflect.set(...f))}),i.timeline.upgraded=Date.now();const b=()=>{throw new M4("Connection is not multiplexed")};return h=sxe({remoteAddr:i.remoteAddr,remotePeer:o,status:"open",direction:n,timeline:i.timeline,multiplexer:l==null?void 0:l.protocol,encryption:t,limits:c,logger:this.components.logger,newStream:d??b,getStreams:()=>(l==null?void 0:l.streams)??[],close:async f=>{await(l==null?void 0:l.close(f)),await i.close(f)},abort:f=>{i.abort(f),l==null||l.abort(f)}}),this.events.safeDispatchEvent("connection:open",{detail:h}),h.__maConnTimeline=p,h}_onStream(e){const{connection:t,stream:n,protocol:i}=e,{handler:s,options:o}=this.components.registrar.getHandler(i);if(t.limits!=null&&o.runOnLimitedConnection!==!0)throw new Ob("Cannot open protocol stream on limited connection");s({connection:t,stream:n})}async _encryptInbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{const{stream:i,protocol:s}=await kA(e,n,{...t,log:e.log}),o=this.connectionEncrypters.get(s);if(o==null)throw new O4(`no crypto module found for ${s}`);return e.log("encrypting inbound connection to %a using %s",e.remoteAddr,s),{...await o.secureInbound(i,t),protocol:s}}catch(i){throw e.log.error("encrypting inbound connection from %a failed",e.remoteAddr,i),new O4(i.message)}}async _encryptOutbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",n);const{stream:i,protocol:s}=await IA(e,n,{...t,log:e.log,yieldBytes:!0}),o=this.connectionEncrypters.get(s);if(o==null)throw new O4(`no crypto module found for ${s}`);return e.log("encrypting outbound connection to %a using %s",e.remoteAddr,s),{...await o.secureOutbound(i,t),protocol:s}}catch(i){throw e.log.error("encrypting outbound connection to %a failed",e.remoteAddr,i),new O4(i.message)}}async _multiplexOutbound(e,t,n){const i=Array.from(t.keys());e.log("outbound selecting muxer %s",i);try{e.log.trace("selecting stream muxer from %s",i);const{stream:s,protocol:o}=await IA(e,i,{...n,log:e.log,yieldBytes:!0});e.log("selected %s as muxer protocol",o);const a=t.get(o);return{stream:s,muxerFactory:a}}catch(s){throw e.log.error("error multiplexing outbound connection",s),new M4(String(s))}}async _multiplexInbound(e,t,n){const i=Array.from(t.keys());e.log("inbound handling muxers %s",i);try{const{stream:s,protocol:o}=await kA(e,i,{...n,log:e.log}),a=t.get(o);return{stream:s,muxerFactory:a}}catch(s){throw e.log.error("error multiplexing inbound connection",s),new M4(String(s))}}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}}class lxe extends er{constructor(t){var d,h,p,b,f,g,v,y,w,m,E,A;super();Ye(this,y0);u(this,"peerId");u(this,"peerStore");u(this,"contentRouting");u(this,"peerRouting");u(this,"metrics");u(this,"services");u(this,"logger");u(this,"status");u(this,"components");u(this,"log");this.status="stopped";const n=new er,i=n.dispatchEvent.bind(n);n.dispatchEvent=k=>{const x=i(k),I=this.dispatchEvent(new CustomEvent(k.type,{detail:k.detail}));return x||I},this.peerId=t.peerId,this.logger=t.logger??Uy(),this.log=this.logger.forComponent("libp2p"),this.services={};const s=((d=t.nodeInfo)==null?void 0:d.name)??pK,o=((h=t.nodeInfo)==null?void 0:h.version)??fK,a=this.components=nSe({peerId:t.peerId,privateKey:t.privateKey,nodeInfo:{name:s,version:o,userAgent:((p=t.nodeInfo)==null?void 0:p.userAgent)??gK(s,o)},logger:this.logger,events:n,datastore:t.datastore??new YR,connectionGater:uSe(t.connectionGater),dns:t.dns});this.peerStore=this.configureComponent("peerStore",xEe(a,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...t.peerStore})),t.metrics!=null&&(this.metrics=this.configureComponent("metrics",t.metrics(this.components))),a.events.addEventListener("peer:update",k=>{if(k.detail.previous==null){const x={id:k.detail.peer.id,multiaddrs:k.detail.peer.addresses.map(I=>I.multiaddr)};a.events.safeDispatchEvent("peer:discovery",{detail:x})}}),t.connectionProtector!=null&&this.configureComponent("connectionProtector",t.connectionProtector(a)),this.components.upgrader=new cxe(this.components,{connectionEncrypters:(t.connectionEncrypters??[]).map((k,x)=>this.configureComponent(`connection-encryption-${x}`,k(this.components))),streamMuxers:(t.streamMuxers??[]).map((k,x)=>this.configureComponent(`stream-muxers-${x}`,k(this.components))),inboundUpgradeTimeout:(b=t.connectionManager)==null?void 0:b.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:((f=t.connectionManager)==null?void 0:f.inboundStreamProtocolNegotiationTimeout)??((g=t.connectionManager)==null?void 0:g.protocolNegotiationTimeout),outboundStreamProtocolNegotiationTimeout:((v=t.connectionManager)==null?void 0:v.outboundStreamProtocolNegotiationTimeout)??((y=t.connectionManager)==null?void 0:y.protocolNegotiationTimeout)}),this.configureComponent("transportManager",new XSe(this.components,t.transportManager)),this.configureComponent("connectionManager",new zSe(this.components,t.connectionManager)),((w=t.connectionMonitor)==null?void 0:w.enabled)!==!1&&this.configureComponent("connectionMonitor",new WSe(this.components,t.connectionMonitor)),this.configureComponent("registrar",new YSe(this.components)),this.configureComponent("addressManager",new VEe(this.components,t.addresses));const c=(t.peerRouters??[]).map((k,x)=>this.configureComponent(`peer-router-${x}`,k(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new QSe(this.components,{routers:c}));const l=(t.contentRouters??[]).map((k,x)=>this.configureComponent(`content-router-${x}`,k(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new GSe(this.components,{routers:l})),this.configureComponent("randomWalk",new JSe(this.components)),(t.peerDiscovery??[]).forEach((k,x)=>{this.configureComponent(`peer-discovery-${x}`,k(this.components)).addEventListener("peer",T=>{Ie(this,y0,QA).call(this,T)})}),(m=t.transports)==null||m.forEach((k,x)=>{this.components.transportManager.add(this.configureComponent(`transport-${x}`,k(this.components)))}),t.services!=null)for(const k of Object.keys(t.services)){const x=t.services[k],I=x(this.components);if(I==null){this.log.error("service factory %s returned null or undefined instance",k);continue}this.services[k]=I,this.configureComponent(k,I),I[Sd]!=null&&(this.log("registering service %s for content routing",k),l.push(I[Sd])),I[xd]!=null&&(this.log("registering service %s for peer routing",k),c.push(I[xd])),I[P2]!=null&&(this.log("registering service %s for peer discovery",k),(A=(E=I[P2]).addEventListener)==null||A.call(E,"peer",T=>{Ie(this,y0,QA).call(this,T)}))}iSe(a)}configureComponent(t,n){return n==null&&this.log.error("component %s was null or undefined",t),this.components[t]=n,n}async start(){var t,n,i,s;if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{await((n=(t=this.components).beforeStart)==null?void 0:n.call(t)),await this.components.start(),await((s=(i=this.components).afterStart)==null?void 0:s.call(i)),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(o){throw this.log.error("An error occurred starting libp2p",o),this.status="started",await this.stop(),o}}}async stop(){var t,n,i,s;this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",await((n=(t=this.components).beforeStop)==null?void 0:n.call(t)),await this.components.stop(),await((s=(i=this.components).afterStop)==null?void 0:s.call(i)),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(t){return this.components.connectionManager.getConnections(t)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const t=new rs;for(const n of this.components.connectionManager.getConnections())t.add(n.remotePeer);return Array.from(t)}async dial(t,n={}){return this.components.connectionManager.openConnection(t,{priority:75,...n})}async dialProtocol(t,n,i={}){if(n==null)throw new Z("no protocols were provided to open a stream");if(n=Array.isArray(n)?n:[n],n.length===0)throw new Z("no protocols were provided to open a stream");return(await this.dial(t,i)).newStream(n,i)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(t,n={}){Cm(t)&&(t=tr(t.getPeerId()??"")),await this.components.connectionManager.closeConnections(t,n)}async getPublicKey(t,n={}){if(this.log("getPublicKey %p",t),t.publicKey!=null)return t.publicKey;try{const a=await this.peerStore.get(t);if(a.id.publicKey!=null)return a.id.publicKey}catch(a){if(a.name!=="NotFoundError")throw a}const i=or([oe("/pk/"),t.toMultihash().bytes]),s=await this.contentRouting.get(i,n),o=_n(s);return await this.peerStore.patch(t,{publicKey:o}),o}async handle(t,n,i){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async s=>{await this.components.registrar.handle(s,n,i)}))}async unhandle(t){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async n=>{await this.components.registrar.unhandle(n)}))}async register(t,n){return this.components.registrar.register(t,n)}unregister(t){this.components.registrar.unregister(t)}async isDialable(t,n={}){return this.components.connectionManager.isDialable(t,n)}}y0=new WeakSet,QA=function(t){const{detail:n}=t;if(n.id.toString()===this.peerId.toString()){this.log.error("peer discovery mechanism discovered self");return}this.components.peerStore.merge(n.id,{multiaddrs:n.multiaddrs}).catch(i=>{this.log.error(i)})};async function uxe(r={}){r.privateKey??(r.privateKey=await gy("Ed25519"));const e=new lxe({...await T9e(r),peerId:noe(r.privateKey)});return r.start!==!1&&await e.start(),e}async function dxe(r){const e=r.libp2p??{};e.privateKey==null&&r.datastore!=null&&(e.privateKey=await A9e(r.datastore,r.keychain));const t=x9e(e);return t.datastore=t.datastore??r.datastore,await uxe({...t,...e,start:!1})}async function _A(r={}){const e=r.datastore??new YR,t=r.blockstore??new t2e;let n;hxe(r.libp2p)?n=r.libp2p:n=await dxe({...r,libp2p:{dns:r.dns,...r.libp2p,start:void 0},datastore:e});const i=new o2e({...r,libp2p:n,datastore:e,blockstore:t,blockBrokers:r.blockBrokers??[M1e(),Wde()],routers:r.routers??[bge(n),mge()],metrics:n.metrics});return r.start!==!1&&await i.start(),i}function hxe(r){return r==null?!1:["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"].every(t=>typeof r[t]=="function")}function nj(r){return r[Symbol.asyncIterator]!=null}const L4=r=>{const e=yt(r),t=In(e);return Sr(r,t),L4.bytes=e,t};L4.bytes=0;function TA(r,e){e=e??{};const t=e.lengthEncoder??L4;function*n(i){const s=t(i.byteLength);s instanceof Uint8Array?yield s:yield*s,i instanceof Uint8Array?yield i:yield*i}return nj(r)?async function*(){for await(const i of r)yield*n(i)}():function*(){for(const i of r)yield*n(i)}()}TA.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??L4;return new Ue(t(r.byteLength),r)};class fxe extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}}class pxe extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}}class gxe extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}}class ij extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}}const yxe=8,mxe=1024*1024*4;var Au;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(Au||(Au={}));const PA=r=>{const e=es(r);return PA.bytes=yt(e),e};PA.bytes=0;function DA(r,e){const t=new Ue;let n=Au.LENGTH,i=-1;const s=(e==null?void 0:e.lengthDecoder)??PA,o=(e==null?void 0:e.maxLengthLength)??yxe,a=(e==null?void 0:e.maxDataLength)??mxe;function*c(){for(;t.byteLength>0;){if(n===Au.LENGTH)try{if(i=s(t),i<0)throw new fxe("Invalid message length");if(i>a)throw new pxe("Message length too long");const l=s.bytes;t.consume(l),(e==null?void 0:e.onLength)!=null&&e.onLength(i),n=Au.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>o)throw new gxe("Message length length too long");break}throw l}if(n===Au.DATA){if(t.byteLength<i)break;const l=t.sublist(0,i);t.consume(i),(e==null?void 0:e.onData)!=null&&e.onData(l),yield l,n=Au.LENGTH}}}return nj(r)?async function*(){for await(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new ij("Unexpected end of input")}():function*(){for(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new ij("Unexpected end of input")}()}DA.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:s,value:o}=await r.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return DA(n,{...e??{},onLength:s=>{t=s}})};function wxe(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var bxe=oj,sj=128,vxe=-128,Exe=Math.pow(2,31);function oj(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Exe;)e[t++]=r&255|sj,r/=128;for(;r&vxe;)e[t++]=r&255|sj,r>>>=7;return e[t]=r|0,oj.bytes=t-n+1,e}var Sxe=$A,xxe=128,aj=127;function $A(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw $A.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&aj)<<i:(o&aj)*Math.pow(2,i),i+=7}while(o>=xxe);return $A.bytes=s-n,t}var Axe=Math.pow(2,7),Cxe=Math.pow(2,14),Ixe=Math.pow(2,21),kxe=Math.pow(2,28),_xe=Math.pow(2,35),Txe=Math.pow(2,42),Pxe=Math.pow(2,49),Dxe=Math.pow(2,56),$xe=Math.pow(2,63),Nxe=function(r){return r<Axe?1:r<Cxe?2:r<Ixe?3:r<kxe?4:r<_xe?5:r<Txe?6:r<Pxe?7:r<Dxe?8:r<$xe?9:10},Mxe={encode:bxe,decode:Sxe,encodingLength:Nxe},B4=Mxe;function cj(r,e=0){return[B4.decode(r,e),B4.decode.bytes]}function lj(r,e,t=0){return B4.encode(r,e,t),e}function uj(r){return B4.encodingLength(r)}function dj(r,e){const t=e.byteLength,n=uj(r),i=n+uj(t),s=new Uint8Array(i+t);return lj(r,s,0),lj(t,s,n),s.set(e,i),new fj(r,t,e,s)}function hj(r){const e=wxe(r),[t,n]=cj(e),[i,s]=cj(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new fj(t,i,o,e)}class fj{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}}const Uh=1e3,NA=60*Uh,pj="/floodsub/1.0.0",gj="/meshsub/1.0.0",Oxe="/meshsub/1.1.0",MA="/meshsub/1.2.0",Rxe=6,Lxe=4,Bxe=12,Uxe=4,Fxe=2,zxe=5,Vxe=3,Kxe=6,jxe=.25,Hxe=3,yj=100,qxe=Uh,Wxe=NA,Gxe=16,Qxe=NA,Jxe=10*Uh,Yxe=15,Xxe=300,Zxe=Uh,eAe=60,tAe=2,rAe=10*Uh,Fh=5e3,nAe=10,iAe=3*Uh,sAe=2*NA,oAe=120*1e3,aAe="ERR_TOPIC_VALIDATOR_REJECT",cAe="ERR_TOPIC_VALIDATOR_IGNORE",lAe=0,uAe=128,dAe=1e3,hAe=1e3,fAe=1,pAe=512,gAe=512,yAe={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxIdontwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};var Cu;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.subscribe!=null&&(s.uint32(8),s.bool(i.subscribe)),i.topic!=null&&(s.uint32(18),s.string(i.topic)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.subscribe=i.bool();break}case 2:{a.topic=i.string();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)})(r.SubOpts||(r.SubOpts={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.from!=null&&(s.uint32(10),s.bytes(i.from)),i.data!=null&&(s.uint32(18),s.bytes(i.data)),i.seqno!=null&&(s.uint32(26),s.bytes(i.seqno)),i.topic!=null&&i.topic!==""&&(s.uint32(34),s.string(i.topic)),i.signature!=null&&(s.uint32(42),s.bytes(i.signature)),i.key!=null&&(s.uint32(50),s.bytes(i.key)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={topic:""},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.from=i.bytes();break}case 2:{a.data=i.bytes();break}case 3:{a.seqno=i.bytes();break}case 4:{a.topic=i.string();break}case 5:{a.signature=i.bytes();break}case 6:{a.key=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.Message||(r.Message={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.ihave!=null)for(const a of i.ihave)s.uint32(10),r.ControlIHave.codec().encode(a,s);if(i.iwant!=null)for(const a of i.iwant)s.uint32(18),r.ControlIWant.codec().encode(a,s);if(i.graft!=null)for(const a of i.graft)s.uint32(26),r.ControlGraft.codec().encode(a,s);if(i.prune!=null)for(const a of i.prune)s.uint32(34),r.ControlPrune.codec().encode(a,s);if(i.idontwant!=null)for(const a of i.idontwant)s.uint32(42),r.ControlIDontWant.codec().encode(a,s);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l,d,h,p,b,f,g,v,y,w;const a={ihave:[],iwant:[],graft:[],prune:[],idontwant:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const m=i.uint32();switch(m>>>3){case 1:{if(((l=o.limits)==null?void 0:l.ihave)!=null&&a.ihave.length===o.limits.ihave)throw new mt('Decode error - map field "ihave" had too many elements');a.ihave.push(r.ControlIHave.codec().decode(i,i.uint32(),{limits:(d=o.limits)==null?void 0:d.ihave$}));break}case 2:{if(((h=o.limits)==null?void 0:h.iwant)!=null&&a.iwant.length===o.limits.iwant)throw new mt('Decode error - map field "iwant" had too many elements');a.iwant.push(r.ControlIWant.codec().decode(i,i.uint32(),{limits:(p=o.limits)==null?void 0:p.iwant$}));break}case 3:{if(((b=o.limits)==null?void 0:b.graft)!=null&&a.graft.length===o.limits.graft)throw new mt('Decode error - map field "graft" had too many elements');a.graft.push(r.ControlGraft.codec().decode(i,i.uint32(),{limits:(f=o.limits)==null?void 0:f.graft$}));break}case 4:{if(((g=o.limits)==null?void 0:g.prune)!=null&&a.prune.length===o.limits.prune)throw new mt('Decode error - map field "prune" had too many elements');a.prune.push(r.ControlPrune.codec().decode(i,i.uint32(),{limits:(v=o.limits)==null?void 0:v.prune$}));break}case 5:{if(((y=o.limits)==null?void 0:y.idontwant)!=null&&a.idontwant.length===o.limits.idontwant)throw new mt('Decode error - map field "idontwant" had too many elements');a.idontwant.push(r.ControlIDontWant.codec().decode(i,i.uint32(),{limits:(w=o.limits)==null?void 0:w.idontwant$}));break}default:{i.skipType(m&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.ControlMessage||(r.ControlMessage={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.topicID!=null&&(s.uint32(10),s.string(i.topicID)),i.messageIDs!=null)for(const a of i.messageIDs)s.uint32(18),s.bytes(a);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={messageIDs:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:{a.topicID=i.string();break}case 2:{if(((l=o.limits)==null?void 0:l.messageIDs)!=null&&a.messageIDs.length===o.limits.messageIDs)throw new mt('Decode error - map field "messageIDs" had too many elements');a.messageIDs.push(i.bytes());break}default:{i.skipType(d&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.ControlIHave||(r.ControlIHave={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.messageIDs!=null)for(const a of i.messageIDs)s.uint32(10),s.bytes(a);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={messageIDs:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:{if(((l=o.limits)==null?void 0:l.messageIDs)!=null&&a.messageIDs.length===o.limits.messageIDs)throw new mt('Decode error - map field "messageIDs" had too many elements');a.messageIDs.push(i.bytes());break}default:{i.skipType(d&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.ControlIWant||(r.ControlIWant={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.topicID!=null&&(s.uint32(10),s.string(i.topicID)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.topicID=i.string();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.ControlGraft||(r.ControlGraft={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.topicID!=null&&(s.uint32(10),s.string(i.topicID)),i.peers!=null)for(const a of i.peers)s.uint32(18),r.PeerInfo.codec().encode(a,s);i.backoff!=null&&(s.uint32(24),s.uint64Number(i.backoff)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l,d;const a={peers:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const h=i.uint32();switch(h>>>3){case 1:{a.topicID=i.string();break}case 2:{if(((l=o.limits)==null?void 0:l.peers)!=null&&a.peers.length===o.limits.peers)throw new mt('Decode error - map field "peers" had too many elements');a.peers.push(r.PeerInfo.codec().decode(i,i.uint32(),{limits:(d=o.limits)==null?void 0:d.peers$}));break}case 3:{a.backoff=i.uint64Number();break}default:{i.skipType(h&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.ControlPrune||(r.ControlPrune={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.peerID!=null&&(s.uint32(10),s.bytes(i.peerID)),i.signedPeerRecord!=null&&(s.uint32(18),s.bytes(i.signedPeerRecord)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.peerID=i.bytes();break}case 2:{a.signedPeerRecord=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.PeerInfo||(r.PeerInfo={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.messageIDs!=null)for(const a of i.messageIDs)s.uint32(10),s.bytes(a);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={messageIDs:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:{if(((l=o.limits)==null?void 0:l.messageIDs)!=null&&a.messageIDs.length===o.limits.messageIDs)throw new mt('Decode error - map field "messageIDs" had too many elements');a.messageIDs.push(i.bytes());break}default:{i.skipType(d&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.ControlIDontWant||(r.ControlIDontWant={}));let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.subscriptions!=null)for(const s of t.subscriptions)n.uint32(10),r.SubOpts.codec().encode(s,n);if(t.messages!=null)for(const s of t.messages)n.uint32(18),r.Message.codec().encode(s,n);t.control!=null&&(n.uint32(26),r.ControlMessage.codec().encode(t.control,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,d,h;const s={subscriptions:[],messages:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const p=t.uint32();switch(p>>>3){case 1:{if(((a=i.limits)==null?void 0:a.subscriptions)!=null&&s.subscriptions.length===i.limits.subscriptions)throw new mt('Decode error - map field "subscriptions" had too many elements');s.subscriptions.push(r.SubOpts.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.subscriptions$}));break}case 2:{if(((l=i.limits)==null?void 0:l.messages)!=null&&s.messages.length===i.limits.messages)throw new mt('Decode error - map field "messages" had too many elements');s.messages.push(r.Message.codec().decode(t,t.uint32(),{limits:(d=i.limits)==null?void 0:d.messages$}));break}case 3:{s.control=r.ControlMessage.codec().decode(t,t.uint32(),{limits:(h=i.limits)==null?void 0:h.control});break}default:{t.skipType(p&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(Cu||(Cu={}));class mAe{constructor(e,t,n){u(this,"gossip");u(this,"msgs",new Map);u(this,"msgIdToStrFn");u(this,"history",[]);u(this,"notValidatedCount",0);this.gossip=e,this.msgIdToStrFn=n;for(let i=0;i<t;i++)this.history[i]=[]}get size(){return this.msgs.size}put(e,t,n=!1){const{msgIdStr:i}=e;return this.msgs.has(i)?!1:(this.msgs.set(i,{message:t,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),n||this.notValidatedCount++,!0)}observeDuplicate(e,t){const n=this.msgs.get(e);n!=null&&!n.validated&&n.originatingPeers.add(t)}get(e){var t;return(t=this.msgs.get(this.msgIdToStrFn(e)))==null?void 0:t.message}getWithIWantCount(e,t){const n=this.msgs.get(e);if(n==null)return null;const i=(n.iwantCounts.get(t)??0)+1;return n.iwantCounts.set(t,i),{msg:n.message,count:i}}getGossipIDs(e){const t=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach(i=>{const s=this.msgs.get(i.msgIdStr);if(((s==null?void 0:s.validated)??!1)&&e.has(i.topic)){let o=t.get(i.topic);o==null&&(o=[],t.set(i.topic,o)),o.push(i.msgId)}});return t}validate(e){const t=this.msgs.get(e);if(t==null)return null;t.validated||this.notValidatedCount--;const{message:n,originatingPeers:i}=t;return t.validated=!0,t.originatingPeers=new Set,{message:n,originatingPeers:i}}shift(){this.history[this.history.length-1].forEach(t=>{const n=this.msgs.get(t.msgIdStr);n!=null&&(this.msgs.delete(t.msgIdStr),n.validated||this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(e){const t=this.msgs.get(e);return t==null?null:(this.msgs.delete(e),t)}}var mj;(function(r){r.StrictSign="StrictSign",r.StrictNoSign="StrictNoSign"})(mj||(mj={}));var zh;(function(r){r[r.Signing=0]="Signing",r[r.Anonymous=1]="Anonymous"})(zh||(zh={}));var ws;(function(r){r.Error="error",r.Ignore="ignore",r.Reject="reject",r.Blacklisted="blacklisted"})(ws||(ws={}));var Ln;(function(r){r.InvalidSignature="invalid_signature",r.InvalidSeqno="invalid_seqno",r.InvalidPeerId="invalid_peerid",r.SignaturePresent="signature_present",r.SeqnoPresent="seqno_present",r.FromPresent="from_present",r.TransformFailed="transform_failed"})(Ln||(Ln={}));var Bn;(function(r){r.duplicate="duplicate",r.invalid="invalid",r.valid="valid"})(Bn||(Bn={}));function wj(r){switch(r){case Ii.Ignore:return ws.Ignore;case Ii.Reject:return ws.Reject;default:throw new Error("Unreachable")}}var bj;(function(r){r.forward="forward",r.publish="publish"})(bj||(bj={}));var Un;(function(r){r.Fanout="fanout",r.Random="random",r.Subscribed="subscribed",r.Outbound="outbound",r.NotEnough="not_enough",r.Opportunistic="opportunistic"})(Un||(Un={}));var Ys;(function(r){r.Dc="disconnected",r.BadScore="bad_score",r.Prune="prune",r.Excess="excess"})(Ys||(Ys={}));var a0;(function(r){r.GraftBackoff="graft_backoff",r.BrokenPromise="broken_promise",r.MessageDeficit="message_deficit",r.IPColocation="IP_colocation"})(a0||(a0={}));var c0;(function(r){r.LowScore="low_score",r.MaxIhave="max_ihave",r.MaxIasked="max_iasked"})(c0||(c0={}));var Vh;(function(r){r.graylist="graylist",r.publish="publish",r.gossip="gossip",r.mesh="mesh"})(Vh||(Vh={}));function wAe(r,e,t){return{protocolsEnabled:r.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:r.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:r.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:r.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEventsFanout:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_fanout_total",help:"Number of times we include peers in a topic mesh for fanout reasons",labelNames:["topic"]}),meshPeerInclusionEventsRandom:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_random_total",help:"Number of times we include peers in a topic mesh for random reasons",labelNames:["topic"]}),meshPeerInclusionEventsSubscribed:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_subscribed_total",help:"Number of times we include peers in a topic mesh for subscribed reasons",labelNames:["topic"]}),meshPeerInclusionEventsOutbound:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_outbound_total",help:"Number of times we include peers in a topic mesh for outbound reasons",labelNames:["topic"]}),meshPeerInclusionEventsNotEnough:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_not_enough_total",help:"Number of times we include peers in a topic mesh for not_enough reasons",labelNames:["topic"]}),meshPeerInclusionEventsOpportunistic:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_opportunistic_total",help:"Number of times we include peers in a topic mesh for opportunistic reasons",labelNames:["topic"]}),meshPeerInclusionEventsUnknown:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_unknown_total",help:"Number of times we include peers in a topic mesh for unknown reasons",labelNames:["topic"]}),meshPeerChurnEventsDisconnected:r.gauge({name:"gossipsub_peer_churn_events_disconnected_total",help:"Number of times we remove peers in a topic mesh for disconnected reasons",labelNames:["topic"]}),meshPeerChurnEventsBadScore:r.gauge({name:"gossipsub_peer_churn_events_bad_score_total",help:"Number of times we remove peers in a topic mesh for bad_score reasons",labelNames:["topic"]}),meshPeerChurnEventsPrune:r.gauge({name:"gossipsub_peer_churn_events_prune_total",help:"Number of times we remove peers in a topic mesh for prune reasons",labelNames:["topic"]}),meshPeerChurnEventsExcess:r.gauge({name:"gossipsub_peer_churn_events_excess_total",help:"Number of times we remove peers in a topic mesh for excess reasons",labelNames:["topic"]}),meshPeerChurnEventsUnknown:r.gauge({name:"gossipsub_peer_churn_events_unknown_total",help:"Number of times we remove peers in a topic mesh for unknown reasons",labelNames:["topic"]}),peersPerProtocol:r.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:r.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:r.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),acceptedMessagesTotal:r.gauge({name:"gossipsub_accepted_messages_total",help:"Total accepted messages for each topic",labelNames:["topic"]}),ignoredMessagesTotal:r.gauge({name:"gossipsub_ignored_messages_total",help:"Total ignored messages for each topic",labelNames:["topic"]}),rejectedMessagesTotal:r.gauge({name:"gossipsub_rejected_messages_total",help:"Total rejected messages for each topic",labelNames:["topic"]}),unknownValidationResultsTotal:r.gauge({name:"gossipsub_unknown_validation_results_total",help:"Total unknown validation results for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:r.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),asyncValidationDelayFromFirstSeenSec:r.histogram({name:"gossipsub_async_validation_delay_from_first_seen",help:"Async validation report delay from first seen in second",buckets:[.01,.03,.1,.3,1,3,10]}),asyncValidationUnknownFirstSeen:r.gauge({name:"gossipsub_async_validation_unknown_first_seen_count_total",help:"Async validation report unknown first seen value for message"}),peerReadStreamError:r.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:r.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:r.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:r.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:r.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:r.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:r.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:r.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:r.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:r.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:r.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:r.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:r.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:r.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:r.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:r.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:r.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:r.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:r.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:r.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:r.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:r.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),rpcSentIDontWant:r.gauge({name:"gossipsub_rpc_sent_idontwant_total",help:"RPC sent"}),msgPublishCount:r.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:r.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),directPeersPublishedTotal:r.gauge({name:"gossipsub_direct_peers_published_total",help:"Total direct peers that we publish a msg to",labelNames:["topic"]}),floodsubPeersPublishedTotal:r.gauge({name:"gossipsub_floodsub_peers_published_total",help:"Total floodsub peers that we publish a msg to",labelNames:["topic"]}),meshPeersPublishedTotal:r.gauge({name:"gossipsub_mesh_peers_published_total",help:"Total mesh peers that we publish a msg to",labelNames:["topic"]}),fanoutPeersPublishedTotal:r.gauge({name:"gossipsub_fanout_peers_published_total",help:"Total fanout peers that we publish a msg to",labelNames:["topic"]}),msgPublishBytes:r.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgPublishTime:r.histogram({name:"gossipsub_msg_publish_seconds",help:"Total time in seconds to publish a message",buckets:[.001,.002,.005,.01,.1,.5,1],labelNames:["topic"]}),msgForwardCount:r.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:r.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:r.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:r.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),prevalidationInvalidTotal:r.gauge({name:"gossipsub_pre_validation_invalid_total",help:"Total count of invalid messages received",labelNames:["topic"]}),prevalidationValidTotal:r.gauge({name:"gossipsub_pre_validation_valid_total",help:"Total count of valid messages received",labelNames:["topic"]}),prevalidationDuplicateTotal:r.gauge({name:"gossipsub_pre_validation_duplicate_total",help:"Total count of duplicate messages received",labelNames:["topic"]}),prevalidationUnknownTotal:r.gauge({name:"gossipsub_pre_validation_unknown_status_total",help:"Total count of unknown_status messages received",labelNames:["topic"]}),msgReceivedInvalid:r.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:r.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:r.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*t.maxMeshMessageDeliveriesWindowSec,.5*t.maxMeshMessageDeliveriesWindowSec,Number(t.maxMeshMessageDeliveriesWindowSec),2*t.maxMeshMessageDeliveriesWindowSec,4*t.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:r.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:r.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:r.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:r.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:r.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:r.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:r.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:r.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:r.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:r.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:r.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*t.behaviourPenaltyThreshold,.5*t.behaviourPenaltyThreshold,Number(t.behaviourPenaltyThreshold),2*t.behaviourPenaltyThreshold,4*t.behaviourPenaltyThreshold]}),ihaveRcvIgnored:r.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:r.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:r.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:r.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:r.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),idontwantRcvMsgids:r.gauge({name:"gossipsub_idontwant_rcv_msgids_total",help:"Total received IDONTWANT messages"}),idontwantRcvDonthaveMsgids:r.gauge({name:"gossipsub_idontwant_rcv_dont_have_msgids_total",help:"Total received IDONTWANT messageIDs that we do not have in mcache"}),iwantPromiseStarted:r.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:r.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:r.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:r.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:r.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:r.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:r.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*t.gossipPromiseExpireSec,Number(t.gossipPromiseExpireSec),2*t.gossipPromiseExpireSec,4*t.gossipPromiseExpireSec]}),iwantPromiseUntracked:r.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),connectedPeersBackoffSec:r.histogram({name:"gossipsub_connected_peers_backoff_seconds",help:"Backoff time in seconds",buckets:[1,2,4,10,20,60,120]}),cacheSize:r.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:r.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:r.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:r.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:r.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:e,toTopic(n){return this.topicStrToLabel.get(n)??n},onJoin(n){this.topicSubscriptionStatus.set({topicStr:n},1),this.meshPeerCounts.set({topicStr:n},0)},onLeave(n){this.topicSubscriptionStatus.set({topicStr:n},0),this.meshPeerCounts.set({topicStr:n},0)},onAddToMesh(n,i,s){const o=this.toTopic(n);switch(i){case Un.Fanout:this.meshPeerInclusionEventsFanout.inc({topic:o},s);break;case Un.Random:this.meshPeerInclusionEventsRandom.inc({topic:o},s);break;case Un.Subscribed:this.meshPeerInclusionEventsSubscribed.inc({topic:o},s);break;case Un.Outbound:this.meshPeerInclusionEventsOutbound.inc({topic:o},s);break;case Un.NotEnough:this.meshPeerInclusionEventsNotEnough.inc({topic:o},s);break;case Un.Opportunistic:this.meshPeerInclusionEventsOpportunistic.inc({topic:o},s);break;default:this.meshPeerInclusionEventsUnknown.inc({topic:o},s);break}},onRemoveFromMesh(n,i,s){const o=this.toTopic(n);switch(i){case Ys.Dc:this.meshPeerChurnEventsDisconnected.inc({topic:o},s);break;case Ys.BadScore:this.meshPeerChurnEventsBadScore.inc({topic:o},s);break;case Ys.Prune:this.meshPeerChurnEventsPrune.inc({topic:o},s);break;case Ys.Excess:this.meshPeerChurnEventsExcess.inc({topic:o},s);break;default:this.meshPeerChurnEventsUnknown.inc({topic:o},s);break}},onReportValidation(n,i,s){if(this.asyncValidationMcacheHit.inc({hit:n!=null?"hit":"miss"}),n!=null){const o=this.toTopic(n.message.topic);switch(i){case Ii.Accept:this.acceptedMessagesTotal.inc({topic:o});break;case Ii.Ignore:this.ignoredMessagesTotal.inc({topic:o});break;case Ii.Reject:this.rejectedMessagesTotal.inc({topic:o});break;default:this.unknownValidationResultsTotal.inc({topic:o});break}}s!=null?this.asyncValidationDelayFromFirstSeenSec.observe((Date.now()-s)/1e3):this.asyncValidationUnknownFirstSeen.inc()},onScorePenalty(n){this.scoringPenalties.inc({penalty:n},1)},onIhaveRcv(n,i,s){const o=this.toTopic(n);this.ihaveRcvMsgids.inc({topic:o},i),this.ihaveRcvNotSeenMsgids.inc({topic:o},s)},onIwantRcv(n,i){for(const[s,o]of n){const a=this.toTopic(s);this.iwantRcvMsgids.inc({topic:a},o)}this.iwantRcvDonthaveMsgids.inc(i)},onIdontwantRcv(n,i){this.idontwantRcvMsgids.inc(n),this.idontwantRcvDonthaveMsgids.inc(i)},onForwardMsg(n,i){const s=this.toTopic(n);this.msgForwardCount.inc({topic:s},1),this.msgForwardPeers.inc({topic:s},i)},onPublishMsg(n,i,s,o,a){const c=this.toTopic(n);this.msgPublishCount.inc({topic:c},1),this.msgPublishBytes.inc({topic:c},s*o),this.msgPublishPeersByTopic.inc({topic:c},s),this.directPeersPublishedTotal.inc({topic:c},i.direct),this.floodsubPeersPublishedTotal.inc({topic:c},i.floodsub),this.meshPeersPublishedTotal.inc({topic:c},i.mesh),this.fanoutPeersPublishedTotal.inc({topic:c},i.fanout),this.msgPublishTime.observe({topic:c},a/1e3)},onMsgRecvPreValidation(n){const i=this.toTopic(n);this.msgReceivedPreValidation.inc({topic:i},1)},onMsgRecvError(n){const i=this.toTopic(n);this.msgReceivedError.inc({topic:i},1)},onPrevalidationResult(n,i){const s=this.toTopic(n);switch(i){case Bn.duplicate:this.prevalidationDuplicateTotal.inc({topic:s});break;case Bn.invalid:this.prevalidationInvalidTotal.inc({topic:s});break;case Bn.valid:this.prevalidationValidTotal.inc({topic:s});break;default:this.prevalidationUnknownTotal.inc({topic:s});break}},onMsgRecvInvalid(n,i){const s=this.toTopic(n),o=i.reason===ws.Error?i.error:i.reason;this.msgReceivedInvalid.inc({error:o},1),this.msgReceivedInvalidByTopic.inc({topic:s},1)},onDuplicateMsgDelivery(n,i,s){const o=this.toTopic(n);this.duplicateMsgDeliveryDelay.observe({topic:o},i/1e3),s&&this.duplicateMsgLateDelivery.inc({topic:o},1)},onPublishDuplicateMsg(n){const i=this.toTopic(n);this.duplicateMsgIgnored.inc({topic:i},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(n,i){this.rpcRecvBytes.inc(i),this.rpcRecvCount.inc(1),n.subscriptions!=null&&this.rpcRecvSubscription.inc(n.subscriptions.length),n.messages!=null&&this.rpcRecvMessage.inc(n.messages.length),n.control!=null&&(this.rpcRecvControl.inc(1),n.control.ihave!=null&&this.rpcRecvIHave.inc(n.control.ihave.length),n.control.iwant!=null&&this.rpcRecvIWant.inc(n.control.iwant.length),n.control.graft!=null&&this.rpcRecvGraft.inc(n.control.graft.length),n.control.prune!=null&&this.rpcRecvPrune.inc(n.control.prune.length))},onRpcSent(n,i){var s,o,a,c,l;if(this.rpcSentBytes.inc(i),this.rpcSentCount.inc(1),n.subscriptions!=null&&this.rpcSentSubscription.inc(n.subscriptions.length),n.messages!=null&&this.rpcSentMessage.inc(n.messages.length),n.control!=null){const d=((s=n.control.ihave)==null?void 0:s.length)??0,h=((o=n.control.iwant)==null?void 0:o.length)??0,p=((a=n.control.graft)==null?void 0:a.length)??0,b=((c=n.control.prune)==null?void 0:c.length)??0,f=((l=n.control.idontwant)==null?void 0:l.length)??0;d>0&&this.rpcSentIHave.inc(d),h>0&&this.rpcSentIWant.inc(h),p>0&&this.rpcSentGraft.inc(p),b>0&&this.rpcSentPrune.inc(b),f>0&&this.rpcSentIDontWant.inc(f),(d>0||h>0||p>0||b>0||f>0)&&this.rpcSentControl.inc(1)}},registerScores(n,i){let s=0,o=0,a=0,c=0;for(const l of n)l>=i.graylistThreshold&&s++,l>=i.publishThreshold&&o++,l>=i.gossipThreshold&&a++,l>=0&&c++;this.peersByScoreThreshold.set({threshold:Vh.graylist},s),this.peersByScoreThreshold.set({threshold:Vh.publish},o),this.peersByScoreThreshold.set({threshold:Vh.gossip},a),this.peersByScoreThreshold.set({threshold:Vh.mesh},c),this.score.set(n)},registerScoreWeights(n){for(const[i,s]of n.byTopic)this.scoreWeights.set({topic:i,p:"p1"},s.p1w),this.scoreWeights.set({topic:i,p:"p2"},s.p2w),this.scoreWeights.set({topic:i,p:"p3"},s.p3w),this.scoreWeights.set({topic:i,p:"p3b"},s.p3bw),this.scoreWeights.set({topic:i,p:"p4"},s.p4w);this.scoreWeights.set({p:"p5"},n.p5w),this.scoreWeights.set({p:"p6"},n.p6w),this.scoreWeights.set({p:"p7"},n.p7w)},registerScorePerMesh(n,i){const s=new Map;n.forEach((o,a)=>{const c=this.topicStrToLabel.get(a)??"unknown";let l=s.get(c);l==null&&(l=new Set,s.set(c,l)),o.forEach(d=>l==null?void 0:l.add(d))});for(const[o,a]of s){const c=[];a.forEach(l=>{c.push(i.get(l)??0)}),this.scorePerMesh.set({topic:o},c)}}}}class bt extends Error{constructor(e="Invalid peer score params"){super(e),this.name="InvalidPeerScoreParamsError"}}u(bt,"name","InvalidPeerScoreParamsError");const bAe={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},vAe={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function EAe(r={}){return{...bAe,...r,topics:r.topics!=null?Object.entries(r.topics).reduce((e,[t,n])=>(e[t]=SAe(n),e),{}):{}}}function SAe(r={}){return{...vAe,...r}}function xAe(r){for(const[e,t]of Object.entries(r.topics))try{AAe(t)}catch(n){throw new bt(`invalid score parameters for topic ${e}: ${n.message}`)}if(r.topicScoreCap<0)throw new bt("invalid topic score cap; must be positive (or 0 for no cap)");if(r.appSpecificScore===null||r.appSpecificScore===void 0)throw new bt("missing application specific score function");if(r.IPColocationFactorWeight>0)throw new bt("invalid IPColocationFactorWeight; must be negative (or 0 to disable)");if(r.IPColocationFactorWeight!==0&&r.IPColocationFactorThreshold<1)throw new bt("invalid IPColocationFactorThreshold; must be at least 1");if(r.behaviourPenaltyWeight>0)throw new bt("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)");if(r.behaviourPenaltyWeight!==0&&(r.behaviourPenaltyDecay<=0||r.behaviourPenaltyDecay>=1))throw new bt("invalid BehaviourPenaltyDecay; must be between 0 and 1");if(r.decayInterval<1e3)throw new bt("invalid DecayInterval; must be at least 1s");if(r.decayToZero<=0||r.decayToZero>=1)throw new bt("invalid DecayToZero; must be between 0 and 1")}function AAe(r){if(r.topicWeight<0)throw new bt("invalid topic weight; must be >= 0");if(r.timeInMeshQuantum===0)throw new bt("invalid TimeInMeshQuantum; must be non zero");if(r.timeInMeshWeight<0)throw new bt("invalid TimeInMeshWeight; must be positive (or 0 to disable)");if(r.timeInMeshWeight!==0&&r.timeInMeshQuantum<=0)throw new bt("invalid TimeInMeshQuantum; must be positive");if(r.timeInMeshWeight!==0&&r.timeInMeshCap<=0)throw new bt("invalid TimeInMeshCap; must be positive");if(r.firstMessageDeliveriesWeight<0)throw new bt("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)");if(r.firstMessageDeliveriesWeight!==0&&(r.firstMessageDeliveriesDecay<=0||r.firstMessageDeliveriesDecay>=1))throw new bt("invalid FirstMessageDeliveriesDecay; must be between 0 and 1");if(r.firstMessageDeliveriesWeight!==0&&r.firstMessageDeliveriesCap<=0)throw new bt("invalid FirstMessageDeliveriesCap; must be positive");if(r.meshMessageDeliveriesWeight>0)throw new bt("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)");if(r.meshMessageDeliveriesWeight!==0&&(r.meshMessageDeliveriesDecay<=0||r.meshMessageDeliveriesDecay>=1))throw new bt("invalid MeshMessageDeliveriesDecay; must be between 0 and 1");if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesCap<=0)throw new bt("invalid MeshMessageDeliveriesCap; must be positive");if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesThreshold<=0)throw new bt("invalid MeshMessageDeliveriesThreshold; must be positive");if(r.meshMessageDeliveriesWindow<0)throw new bt("invalid MeshMessageDeliveriesWindow; must be non-negative");if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesActivation<1e3)throw new bt("invalid MeshMessageDeliveriesActivation; must be at least 1s");if(r.meshFailurePenaltyWeight>0)throw new bt("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)");if(r.meshFailurePenaltyWeight!==0&&(r.meshFailurePenaltyDecay<=0||r.meshFailurePenaltyDecay>=1))throw new bt("invalid MeshFailurePenaltyDecay; must be between 0 and 1");if(r.invalidMessageDeliveriesWeight>0)throw new bt("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)");if(r.invalidMessageDeliveriesDecay<=0||r.invalidMessageDeliveriesDecay>=1)throw new bt("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1")}const CAe={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function IAe(r={}){return{...CAe,...r}}function OA(r,e,t=()=>!0){const n=new Set;if(e<=0)return n;for(const i of r){if(n.size>=e)break;t(i)&&(n.add(i),r.delete(i))}return n}function kAe(r,e){return OA(r,e,()=>!0)}class _Ae extends Map{constructor(t){super();u(this,"getDefault");this.getDefault=t}getOrDefault(t){let n=super.get(t);return n===void 0&&(n=this.getDefault(),this.set(t,n)),n}}function TAe(r,e,t,n){let i=0;Object.entries(e.topics).forEach(([o,a])=>{const c=t.topics[o];if(c===void 0)return;let l=0;if(a.inMesh){let b=a.meshTime/c.timeInMeshQuantum;b>c.timeInMeshCap&&(b=c.timeInMeshCap),l+=b*c.timeInMeshWeight}let d=a.firstMessageDeliveries;if(d>c.firstMessageDeliveriesCap&&(d=c.firstMessageDeliveriesCap),l+=d*c.firstMessageDeliveriesWeight,a.meshMessageDeliveriesActive&&a.meshMessageDeliveries<c.meshMessageDeliveriesThreshold){const b=c.meshMessageDeliveriesThreshold-a.meshMessageDeliveries,f=b*b;l+=f*c.meshMessageDeliveriesWeight}const h=a.meshFailurePenalty;l+=h*c.meshFailurePenaltyWeight;const p=a.invalidMessageDeliveries*a.invalidMessageDeliveries;l+=p*c.invalidMessageDeliveriesWeight,i+=l*c.topicWeight}),t.topicScoreCap>0&&i>t.topicScoreCap&&(i=t.topicScoreCap);const s=t.appSpecificScore(r);if(i+=s*t.appSpecificWeight,e.knownIPs.forEach(o=>{if(t.IPColocationFactorWhitelist.has(o))return;const a=n.get(o),c=a!=null?a.size:0;if(c>t.IPColocationFactorThreshold){const l=c-t.IPColocationFactorThreshold,d=l*l;i+=d*t.IPColocationFactorWeight}}),e.behaviourPenalty>t.behaviourPenaltyThreshold){const o=e.behaviourPenalty-t.behaviourPenaltyThreshold,a=o*o;i+=a*t.behaviourPenaltyWeight}return i}function Kt(r,t){var t=t||{};this._capacity=t.capacity,this._head=0,this._tail=0,Array.isArray(r)?this._fromArray(r):(this._capacityMask=3,this._list=new Array(4))}Kt.prototype.peekAt=function(e){var t=e;if(t===(t|0)){var n=this.size();if(!(t>=n||t<-n))return t<0&&(t+=n),t=this._head+t&this._capacityMask,this._list[t]}},Kt.prototype.get=function(e){return this.peekAt(e)},Kt.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},Kt.prototype.peekFront=function(){return this.peek()},Kt.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(Kt.prototype,"length",{get:function(){return this.size()}}),Kt.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},Kt.prototype.unshift=function(e){if(arguments.length===0)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},Kt.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}},Kt.prototype.push=function(e){if(arguments.length===0)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},Kt.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),n}},Kt.prototype.removeOne=function(e){var t=e;if(t===(t|0)&&this._head!==this._tail){var n=this.size(),i=this._list.length;if(!(t>=n||t<-n)){t<0&&(t+=n),t=this._head+t&this._capacityMask;var s=this._list[t],o;if(e<n/2){for(o=e;o>0;o--)this._list[t]=this._list[t=t-1+i&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(o=n-1-e;o>0;o--)this._list[t]=this._list[t=t+1+i&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+i&this._capacityMask}return s}}},Kt.prototype.remove=function(e,t){var n=e,i,s=t;if(n===(n|0)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(n>=o||n<-o||t<1)){if(n<0&&(n+=o),t===1||!t)return i=new Array(1),i[0]=this.removeOne(n),i;if(n===0&&n+t>=o)return i=this.toArray(),this.clear(),i;n+t>o&&(t=o-n);var c;for(i=new Array(t),c=0;c<t;c++)i[c]=this._list[this._head+n+c&this._capacityMask];if(n=this._head+n&this._capacityMask,e+t===o){for(this._tail=this._tail-t+a&this._capacityMask,c=t;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(e===0){for(this._head=this._head+t+a&this._capacityMask,c=t-1;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(n<o/2){for(this._head=this._head+e+t+a&this._capacityMask,c=e;c>0;c--)this.unshift(this._list[n=n-1+a&this._capacityMask]);for(n=this._head-1+a&this._capacityMask;s>0;)this._list[n=n-1+a&this._capacityMask]=void 0,s--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+t+a&this._capacityMask,c=o-(t+e);c>0;c--)this.push(this._list[n++]);for(n=this._tail;s>0;)this._list[n=n+1+a&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),i}}},Kt.prototype.splice=function(e,t){var n=e;if(n===(n|0)){var i=this.size();if(n<0&&(n+=i),!(n>i))if(arguments.length>2){var s,o,a,c=arguments.length,l=this._list.length,d=2;if(!i||n<i/2){for(o=new Array(n),s=0;s<n;s++)o[s]=this._list[this._head+s&this._capacityMask];for(t===0?(a=[],n>0&&(this._head=this._head+n+l&this._capacityMask)):(a=this.remove(n,t),this._head=this._head+n+l&this._capacityMask);c>d;)this.unshift(arguments[--c]);for(s=n;s>0;s--)this.unshift(o[s-1])}else{o=new Array(i-(n+t));var h=o.length;for(s=0;s<h;s++)o[s]=this._list[this._head+n+t+s&this._capacityMask];for(t===0?(a=[],n!=i&&(this._tail=this._head+n+l&this._capacityMask)):(a=this.remove(n,t),this._tail=this._tail-h+l&this._capacityMask);d<c;)this.push(arguments[d++]);for(s=0;s<h;s++)this.push(o[s])}return a}else return this.remove(n,t)}},Kt.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0},Kt.prototype.isEmpty=function(){return this._head===this._tail},Kt.prototype.toArray=function(){return this._copyArray(!1)},Kt.prototype._fromArray=function(e){var t=e.length,n=this._nextPowerOf2(t);this._list=new Array(n),this._capacityMask=n-1,this._tail=t;for(var i=0;i<t;i++)this._list[i]=e[i]},Kt.prototype._copyArray=function(e,t){var n=this._list,i=n.length,s=this.length;if(t=t|s,t==s&&this._head<this._tail)return this._list.slice(this._head,this._tail);var o=new Array(t),a=0,c;if(e||this._head>this._tail){for(c=this._head;c<i;c++)o[a++]=n[c];for(c=0;c<this._tail;c++)o[a++]=n[c]}else for(c=this._head;c<this._tail;c++)o[a++]=n[c];return o},Kt.prototype._growArray=function(){if(this._head!=0){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1},Kt.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},Kt.prototype._nextPowerOf2=function(e){var t=Math.log(e)/Math.log(2),n=1<<t+1;return Math.max(n,4)};var PAe=Kt;const DAe=Xe(PAe);var Fn;(function(r){r[r.unknown=0]="unknown",r[r.valid=1]="valid",r[r.invalid=2]="invalid",r[r.ignored=3]="ignored"})(Fn||(Fn={}));class $Ae{constructor(){u(this,"records");u(this,"queue");this.records=new Map,this.queue=new DAe}getRecord(e){return this.records.get(e)}ensureRecord(e){let t=this.records.get(e);if(t!=null)return t;t={status:Fn.unknown,firstSeenTsMs:Date.now(),validated:0,peers:new Set},this.records.set(e,t);const n={msgId:e,expire:Date.now()+oAe};return this.queue.push(n),t}gc(){const e=Date.now();let t=this.queue.peekFront();for(;t!=null&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}class NAe{constructor(e,t,n,i){u(this,"params");u(this,"metrics");u(this,"peerStats",new Map);u(this,"peerIPs",new _Ae(()=>new Set));u(this,"scoreCache",new Map);u(this,"deliveryRecords",new $Ae);u(this,"_backgroundInterval");u(this,"scoreCacheValidityMs");u(this,"computeScore");u(this,"log");this.params=e,this.metrics=t,xAe(e),this.scoreCacheValidityMs=i.scoreCacheValidityMs,this.computeScore=i.computeScore??TAe,this.log=n.forComponent("libp2p:gossipsub:score")}get size(){return this.peerStats.size}start(){if(this._backgroundInterval!=null){this.log("Peer score already running");return}this._backgroundInterval=setInterval(()=>{this.background()},this.params.decayInterval),this.log("started")}stop(){if(this._backgroundInterval==null){this.log("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),this.log("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,t])=>[e,t]))}messageFirstSeenTimestampMs(e){const t=this.deliveryRecords.getRecord(e);return t!=null?t.firstSeenTsMs:null}refreshScores(){const e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach((n,i)=>{if(!n.connected){e>n.expire&&(this.removeIPsForPeer(i,n.knownIPs),this.peerStats.delete(i),this.scoreCache.delete(i));return}Object.entries(n.topics).forEach(([s,o])=>{const a=this.params.topics[s];a!==void 0&&(o.firstMessageDeliveries*=a.firstMessageDeliveriesDecay,o.firstMessageDeliveries<t&&(o.firstMessageDeliveries=0),o.meshMessageDeliveries*=a.meshMessageDeliveriesDecay,o.meshMessageDeliveries<t&&(o.meshMessageDeliveries=0),o.meshFailurePenalty*=a.meshFailurePenaltyDecay,o.meshFailurePenalty<t&&(o.meshFailurePenalty=0),o.invalidMessageDeliveries*=a.invalidMessageDeliveriesDecay,o.invalidMessageDeliveries<t&&(o.invalidMessageDeliveries=0),o.inMesh&&(o.meshTime=e-o.graftTime,o.meshTime>a.meshMessageDeliveriesActivation&&(o.meshMessageDeliveriesActive=!0)))}),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<t&&(n.behaviourPenalty=0)})}score(e){var a,c,l;(a=this.metrics)==null||a.scoreFnCalls.inc();const t=this.peerStats.get(e);if(t==null)return 0;const n=Date.now(),i=this.scoreCache.get(e);if(i!=null&&i.cacheUntil>n)return i.score;(c=this.metrics)==null||c.scoreFnRuns.inc();const s=this.computeScore(e,t,this.params,this.peerIPs),o=n+this.scoreCacheValidityMs;return i!=null?((l=this.metrics)==null||l.scoreCachedDelta.observe(Math.abs(s-i.score)),i.score=s,i.cacheUntil=o):this.scoreCache.set(e,{score:s,cacheUntil:o}),s}addPenalty(e,t,n){var s;const i=this.peerStats.get(e);i!=null&&(i.behaviourPenalty+=t,(s=this.metrics)==null||s.onScorePenalty(n))}addPeer(e){const t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){const n=this.peerStats.get(e);n!=null&&n.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){const n=this.peerStats.get(e);n!=null&&n.knownIPs.delete(t);const i=this.peerIPs.get(t);i!=null&&(i.delete(e),i.size===0&&this.peerIPs.delete(t))}removePeer(e){const t=this.peerStats.get(e);if(t!=null){if(this.score(e)>0){this.removeIPsForPeer(e,t.knownIPs),this.peerStats.delete(e);return}Object.entries(t.topics).forEach(([n,i])=>{i.firstMessageDeliveries=0;const s=this.params.topics[n].meshMessageDeliveriesThreshold;if(i.inMesh&&i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<s){const o=s-i.meshMessageDeliveries;i.meshFailurePenalty+=o*o}i.inMesh=!1,i.meshMessageDeliveriesActive=!1}),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){const n=this.peerStats.get(e);if(n!=null){const i=this.getPtopicStats(n,t);i!=null&&(i.inMesh=!0,i.graftTime=Date.now(),i.meshTime=0,i.meshMessageDeliveriesActive=!1)}}prune(e,t){const n=this.peerStats.get(e);if(n!=null){const i=this.getPtopicStats(n,t);if(i!=null){const s=this.params.topics[t].meshMessageDeliveriesThreshold;if(i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<s){const o=s-i.meshMessageDeliveries;i.meshFailurePenalty+=o*o}i.meshMessageDeliveriesActive=!1,i.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,n){this.markFirstMessageDelivery(e,n);const i=this.deliveryRecords.ensureRecord(t),s=Date.now();if(i.status!==Fn.unknown){this.log("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,s-i.firstSeenTsMs,Fn[i.status]);return}i.status=Fn.valid,i.validated=s,i.peers.forEach(o=>{o!==e.toString()&&this.markDuplicateMessageDelivery(o,n)})}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,n,i){switch(i){case ws.Error:this.markInvalidMessageDelivery(e,n);return;case ws.Blacklisted:return}const s=this.deliveryRecords.ensureRecord(t);if(s.status!==Fn.unknown){this.log("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-s.firstSeenTsMs,Fn[s.status]);return}if(i===ws.Ignore){s.status=Fn.ignored,s.peers.clear();return}s.status=Fn.invalid,this.markInvalidMessageDelivery(e,n),s.peers.forEach(o=>{this.markInvalidMessageDelivery(o,n)}),s.peers.clear()}duplicateMessage(e,t,n){const i=this.deliveryRecords.ensureRecord(t);if(!i.peers.has(e))switch(i.status){case Fn.unknown:i.peers.add(e);break;case Fn.valid:i.peers.add(e),this.markDuplicateMessageDelivery(e,n,i.validated);break;case Fn.invalid:this.markInvalidMessageDelivery(e,n);break;case Fn.ignored:break}}markInvalidMessageDelivery(e,t){const n=this.peerStats.get(e);if(n!=null){const i=this.getPtopicStats(n,t);i!=null&&(i.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){const n=this.peerStats.get(e);if(n!=null){const i=this.getPtopicStats(n,t);if(i!=null){let s=this.params.topics[t].firstMessageDeliveriesCap;i.firstMessageDeliveries=Math.min(s,i.firstMessageDeliveries+1),i.inMesh&&(s=this.params.topics[t].meshMessageDeliveriesCap,i.meshMessageDeliveries=Math.min(s,i.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,n){var s;const i=this.peerStats.get(e);if(i!=null){const o=n!==void 0?Date.now():0,a=this.getPtopicStats(i,t);if(a!=null&&a.inMesh){const c=this.params.topics[t];if(n!==void 0){const d=o-n,h=d>c.meshMessageDeliveriesWindow;if((s=this.metrics)==null||s.onDuplicateMsgDelivery(t,d,h),h)return}const l=c.meshMessageDeliveriesCap;a.meshMessageDeliveries=Math.min(l,a.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(const n of t){const i=this.peerIPs.get(n);i!=null&&(i.delete(e),i.size===0&&this.peerIPs.delete(n))}}getPtopicStats(e,t){let n=e.topics[t];return n!==void 0?n:this.params.topics[t]!==void 0?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=n,n):null}}function MAe(r,e,t,n,i){let s=0;const o=new Map;if(Object.entries(e.topics).forEach(([p,b])=>{const f=i.get(p)??"unknown",g=t.topics[p];if(g===void 0)return;let v=o.get(f);v==null&&(v={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(f,v));let y=0,w=0,m=0,E=0,A=0;if(b.inMesh){const T=Math.max(b.meshTime/g.timeInMeshQuantum,g.timeInMeshCap);y+=T*g.timeInMeshWeight}let k=b.firstMessageDeliveries;if(k>g.firstMessageDeliveriesCap&&(k=g.firstMessageDeliveriesCap),w+=k*g.firstMessageDeliveriesWeight,b.meshMessageDeliveriesActive&&b.meshMessageDeliveries<g.meshMessageDeliveriesThreshold){const T=g.meshMessageDeliveriesThreshold-b.meshMessageDeliveries,L=T*T;m+=L*g.meshMessageDeliveriesWeight}const x=b.meshFailurePenalty;E+=x*g.meshFailurePenaltyWeight;const I=b.invalidMessageDeliveries*b.invalidMessageDeliveries;A+=I*g.invalidMessageDeliveriesWeight,s+=(y+w+m+E+A)*g.topicWeight,v.p1w+=y,v.p2w+=w,v.p3w+=m,v.p3bw+=E,v.p4w+=A}),t.topicScoreCap>0&&s>t.topicScoreCap){s=t.topicScoreCap;const p=t.topicScoreCap/s;for(const b of o.values())b.p1w*=p,b.p2w*=p,b.p3w*=p,b.p3bw*=p,b.p4w*=p}let a=0,c=0,l=0;const d=t.appSpecificScore(r);a+=d*t.appSpecificWeight,e.knownIPs.forEach(p=>{if(t.IPColocationFactorWhitelist.has(p))return;const b=n.get(p),f=b!=null?b.size:0;if(f>t.IPColocationFactorThreshold){const g=f-t.IPColocationFactorThreshold,v=g*g;c+=v*t.IPColocationFactorWeight}});const h=e.behaviourPenalty*e.behaviourPenalty;return l+=h*t.behaviourPenaltyWeight,s+=a+c+l,{byTopic:o,p5w:a,p6w:c,p7w:l,score:s}}function OAe(r,e,t,n,i){const s={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const o of r){const a=e.get(o);if(a!=null){const c=MAe(o,a,t,n,i);for(const[l,d]of c.byTopic){let h=s.byTopic.get(l);h==null&&(h={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},s.byTopic.set(l,h)),h.p1w.push(d.p1w),h.p2w.push(d.p2w),h.p3w.push(d.p3w),h.p3bw.push(d.p3bw),h.p4w.push(d.p4w)}s.p5w.push(c.p5w),s.p6w.push(c.p6w),s.p7w.push(c.p7w),s.score.push(c.score)}else s.p5w.push(0),s.p6w.push(0),s.p7w.push(0),s.score.push(0)}return s}class RAe{constructor(e,t,n){u(this,"rawStream");u(this,"pushable");u(this,"closeController");u(this,"maxBufferSize");this.rawStream=e,this.pushable=go(),this.closeController=new AbortController,this.maxBufferSize=n.maxBufferSize??1/0,this.closeController.signal.addEventListener("abort",()=>{e.close().catch(i=>{e.abort(i)})}),un(this.pushable,this.rawStream).catch(t)}get protocol(){return this.rawStream.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(TA.single(e))}pushPrefixed(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}async close(){this.closeController.abort(),await this.pushable.return()}}class LAe{constructor(e,t={}){u(this,"source");u(this,"rawStream");u(this,"closeController");this.rawStream=e,this.closeController=new AbortController,this.closeController.signal.addEventListener("abort",()=>{e.close().catch(n=>{e.abort(n)})}),this.source=un(this.rawStream,n=>DA(n,t))}async close(){this.closeController.abort()}}class BAe{constructor(e,t,n){u(this,"gossipsubIWantFollowupMs");u(this,"msgIdToStrFn");u(this,"metrics");u(this,"promises",new Map);u(this,"requestMsByMsg",new Map);u(this,"requestMsByMsgExpire");this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=n,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){const n=Math.floor(Math.random()*t.length),i=t[n],s=this.msgIdToStrFn(i);let o=this.promises.get(s);o==null&&(o=new Map,this.promises.set(s,o));const a=Date.now();o.has(e)||(o.set(e,a+this.gossipsubIWantFollowupMs),this.metrics!=null&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(s)||this.requestMsByMsg.set(s,a)))}getBrokenPromises(){var i;const e=Date.now(),t=new Map;let n=0;return this.promises.forEach((s,o)=>{s.forEach((a,c)=>{a<e&&(t.set(c,(t.get(c)??0)+1),s.delete(c),n++)}),s.size===0&&this.promises.delete(o)}),(i=this.metrics)==null||i.iwantPromiseBroken.inc(n),t}deliverMessage(e,t=!1){this.trackMessage(e);const n=this.promises.get(e);n!=null&&(this.promises.delete(e),this.metrics!=null&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(n.size)))}rejectMessage(e,t){switch(this.trackMessage(e),t){case ws.Error:return}this.promises.delete(e)}clear(){this.promises.clear()}prune(){var n;const e=Date.now()-this.requestMsByMsgExpire;let t=0;for(const[i,s]of this.requestMsByMsg.entries())if(s<e)this.requestMsByMsg.delete(i),t++;else break;(n=this.metrics)==null||n.iwantMessagePruned.inc(t)}trackMessage(e){if(this.metrics!=null){const t=this.requestMsByMsg.get(e);t!==void 0&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}const vj=oe("libp2p-pubsub:");async function UAe(r,e,t,n){switch(r.type){case zh.Signing:{const i={from:r.author.toMultihash().bytes,data:n,seqno:sc(8),topic:e,signature:void 0,key:void 0},s=or([vj,Cu.Message.encode(i)]);i.signature=await r.privateKey.sign(s),i.key=r.key;const o={type:"signed",from:r.author,data:t,sequenceNumber:BigInt(`0x${re(i.seqno??new Uint8Array(0),"base16")}`),topic:e,signature:i.signature,key:_n(i.key)};return{raw:i,msg:o}}case zh.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:e,signature:void 0,key:void 0},msg:{type:"unsigned",data:t,topic:e}};default:throw new Error("Unreachable")}}async function FAe(r,e){switch(r){case Pb:return e.signature!=null?{valid:!1,error:Ln.SignaturePresent}:e.seqno!=null?{valid:!1,error:Ln.SeqnoPresent}:e.key!=null?{valid:!1,error:Ln.FromPresent}:{valid:!0,message:{type:"unsigned",topic:e.topic,data:e.data??new Uint8Array(0)}};case $2:{if(e.seqno==null)return{valid:!1,error:Ln.InvalidSeqno};if(e.seqno.length!==8)return{valid:!1,error:Ln.InvalidSeqno};if(e.signature==null)return{valid:!1,error:Ln.InvalidSignature};if(e.from==null)return{valid:!1,error:Ln.InvalidPeerId};let t;try{t=ti(hj(e.from))}catch{return{valid:!1,error:Ln.InvalidPeerId}}let n;if(e.key!=null){if(n=_n(e.key),t.publicKey!==void 0&&!n.equals(t.publicKey))return{valid:!1,error:Ln.InvalidPeerId}}else{if(t.publicKey==null)return{valid:!1,error:Ln.InvalidPeerId};n=t.publicKey}const i={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},s=or([vj,Cu.Message.encode(i)]);return await n.verify(s,e.signature)?{valid:!0,message:{type:"signed",from:t,data:e.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${re(e.seqno,"base16")}`),topic:e.topic,signature:e.signature,key:e.key!=null?_n(e.key):n}}:{valid:!1,error:Ln.InvalidSignature}}default:throw new Error("Unreachable")}}function Xs(r=[],e){return{subscriptions:[],messages:r,control:e!==void 0?{graft:e.graft??[],prune:e.prune??[],ihave:e.ihave??[],iwant:e.iwant??[],idontwant:e.idontwant??[]}:void 0}}function Ej(r){return r.control===void 0&&(r.control={graft:[],prune:[],ihave:[],iwant:[],idontwant:[]}),r}function ca(r){if(r.length<=1)return r;const e=()=>Math.floor(Math.random()*Math.floor(r.length));for(let t=0;t<r.length;t++){const n=e(),i=r[t];r[t]=r[n],r[n]=i}return r}function zAe(r){return re(r,"base64")}function VAe(r,e,t){switch(r){case $2:return{type:zh.Signing,author:e,key:_i(t.publicKey),privateKey:t};case Pb:return{type:zh.Anonymous};default:throw new Error(`Unknown signature policy "${r}"`)}}const KAe=(r,e)=>{const t=oe(e.toString(16).padStart(16,"0"),"base16"),n=_i(r),i=new Uint8Array(n.byteLength+t.length);return i.set(n,0),i.set(t,n.byteLength),i};function jAe({name:r,code:e,encode:t}){return new HAe(r,e,t)}class HAe{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?dj(this.code,t):t.then(n=>dj(this.code,n))}else throw Error("Unknown type, must be binary type")}}function qAe(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const WAe=jAe({name:"sha2-256",code:18,encode:qAe("SHA-256")});function GAe(r){if(r.type!=="signed")throw new Error("expected signed message type");if(r.sequenceNumber==null)throw Error("missing seqno field");return KAe(r.from.publicKey??r.key,r.sequenceNumber)}async function QAe(r){return WAe.encode(r.data)}var U4;(function(r){r[r.ip4=4]="ip4",r[r.ip6=41]="ip6"})(U4||(U4={}));function JAe(r){for(const e of r.tuples())switch(e[0]){case U4.ip4:case U4.ip6:return e9(e[0],e[1])}return null}class RA{constructor(e){u(this,"entries",new Map);u(this,"validityMs");this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return this.entries.has(e)?!0:(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){const e=Date.now();for(const[t,n]of this.entries.entries())if(n.validUntilMs<e)this.entries.delete(t);else break}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);return t!=null&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}var pi;(function(r){r[r.started=0]="started",r[r.stopped=1]="stopped"})(pi||(pi={}));class Sj extends(GH=er,WH=Symbol.toStringTag,qH=dr,HH=Ja,GH){constructor(t,n={}){super();u(this,"globalSignaturePolicy");u(this,"multicodecs",[MA,Oxe,gj]);u(this,"publishConfig");u(this,"dataTransform");u(this,"peers",new Map);u(this,"streamsInbound",new Map);u(this,"streamsOutbound",new Map);u(this,"outboundInflightQueue",go({objectMode:!0}));u(this,"direct",new Set);u(this,"floodsubPeers",new Set);u(this,"seenCache");u(this,"acceptFromWhitelist",new Map);u(this,"topics",new Map);u(this,"subscriptions",new Set);u(this,"mesh",new Map);u(this,"fanout",new Map);u(this,"fanoutLastpub",new Map);u(this,"gossip",new Map);u(this,"control",new Map);u(this,"peerhave",new Map);u(this,"iasked",new Map);u(this,"backoff",new Map);u(this,"outbound",new Map);u(this,"msgIdFn");u(this,"fastMsgIdFn");u(this,"msgIdToStrFn");u(this,"fastMsgIdCache");u(this,"publishedMessageIds");u(this,"mcache");u(this,"score");u(this,"topicValidators",new Map);u(this,"log");u(this,"heartbeatTicks",0);u(this,"gossipTracer");u(this,"idontwantCounts",new Map);u(this,"idontwants",new Map);u(this,"components");u(this,"directPeerInitial",null);u(this,"opts");u(this,"decodeRpcLimits");u(this,"metrics");u(this,"status",{code:pi.stopped});u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"runOnLimitedConnection");u(this,"allowedTopics");u(this,"heartbeatTimer",null);u(this,WH,"@chainsafe/libp2p-gossipsub");u(this,qH,["@libp2p/pubsub"]);u(this,HH,["@libp2p/identify"]);u(this,"runHeartbeat",()=>{var n;const t=(n=this.metrics)==null?void 0:n.heartbeatDuration.startTimer();this.heartbeat().catch(i=>{this.log("Error running heartbeat",i)}).finally(()=>{var i;if(t!=null&&t(),this.status.code===pi.started){clearTimeout(this.status.heartbeatTimeout);let s=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;s<this.opts.heartbeatInterval*.25&&(s+=this.opts.heartbeatInterval,(i=this.metrics)==null||i.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,s)}})});u(this,"tagMeshPeer",t=>{const{peerId:n,topic:i}=t.detail;this.components.peerStore.merge(this.peers.get(n)??tr(n),{tags:{[i]:{value:100}}}).catch(s=>{this.log.error("Error tagging peer %s with topic %s",n,i,s)})});u(this,"untagMeshPeer",t=>{const{peerId:n,topic:i}=t.detail;this.components.peerStore.merge(this.peers.get(n)??tr(n),{tags:{[i]:void 0}}).catch(s=>{this.log.error("Error untagging peer %s with topic %s",n,i,s)})});const i={fallbackToFloodsub:!0,floodPublish:!0,batchPublish:!1,tagMeshPeers:!0,doPX:!1,directPeers:[],D:Rxe,Dlo:Lxe,Dhi:Bxe,Dscore:Uxe,Dout:Fxe,Dlazy:Kxe,heartbeatInterval:qxe,fanoutTTL:Wxe,mcacheLength:zxe,mcacheGossip:Vxe,seenTTL:sAe,gossipsubIWantFollowupMs:iAe,prunePeers:Gxe,pruneBackoff:Qxe,unsubcribeBackoff:Jxe,graftFloodThreshold:rAe,opportunisticGraftPeers:tAe,opportunisticGraftTicks:eAe,directConnectTicks:Xxe,gossipFactor:jxe,idontwantMinDataSize:pAe,idontwantMaxMessages:gAe,...n,scoreParams:EAe(n.scoreParams),scoreThresholds:IAe(n.scoreThresholds)};if(this.components=t,this.decodeRpcLimits=i.decodeRpcLimits??yAe,this.globalSignaturePolicy=i.globalSignaturePolicy??$2,i.fallbackToFloodsub&&this.multicodecs.push(pj),this.log=t.logger.forComponent(i.debugName??"libp2p:gossipsub"),this.opts=i,this.direct=new Set(i.directPeers.map(s=>s.id.toString())),this.seenCache=new RA({validityMs:i.seenTTL}),this.publishedMessageIds=new RA({validityMs:i.seenTTL}),n.msgIdFn!=null)this.msgIdFn=n.msgIdFn;else switch(this.globalSignaturePolicy){case $2:this.msgIdFn=GAe;break;case Pb:this.msgIdFn=QAe;break;default:throw new Error(`Invalid globalSignaturePolicy: ${this.globalSignaturePolicy}`)}if(n.fastMsgIdFn!=null&&(this.fastMsgIdFn=n.fastMsgIdFn,this.fastMsgIdCache=new RA({validityMs:i.seenTTL})),this.msgIdToStrFn=n.msgIdToStrFn??zAe,this.mcache=n.messageCache??new mAe(i.mcacheGossip,i.mcacheLength,this.msgIdToStrFn),n.dataTransform!=null&&(this.dataTransform=n.dataTransform),n.metricsRegister!=null){if(n.metricsTopicStrToLabel==null)throw Error("Must set metricsTopicStrToLabel with metrics");const s=Math.max(...Object.values(i.scoreParams.topics).map(a=>a.meshMessageDeliveriesWindow),hAe),o=wAe(n.metricsRegister,n.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:i.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:s/1e3});o.mcacheSize.addCollect(()=>{this.onScrapeMetrics(o)});for(const a of this.multicodecs)o.protocolsEnabled.set({protocol:a},1);this.metrics=o}else this.metrics=null;this.gossipTracer=new BAe(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new NAe(this.opts.scoreParams,this.metrics,this.components.logger,{scoreCacheValidityMs:i.heartbeatInterval}),this.maxInboundStreams=n.maxInboundStreams,this.maxOutboundStreams=n.maxOutboundStreams,this.runOnLimitedConnection=n.runOnLimitedConnection,this.allowedTopics=i.allowedTopics!=null?new Set(i.allowedTopics):null}getPeers(){return[...this.peers.values()]}isStarted(){return this.status.code===pi.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=VAe(this.globalSignaturePolicy,this.components.peerId,this.components.privateKey),this.outboundInflightQueue=go({objectMode:!0}),un(this.outboundInflightQueue,async o=>{for await(const{peerId:a,connection:c}of o)await this.createOutboundStream(a,c)}).catch(o=>{this.log.error("outbound inflight queue error",o)}),await Promise.all(this.opts.directPeers.map(async o=>{await this.components.peerStore.merge(o.id,{multiaddrs:o.addrs})}));const t=this.components.registrar;await Promise.all(this.multicodecs.map(async o=>t.handle(o,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection})));const n={onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this),notifyOnLimitedConnection:this.runOnLimitedConnection},i=await Promise.all(this.multicodecs.map(async o=>t.register(o,n))),s=setTimeout(this.runHeartbeat,yj);this.status={code:pi.started,registrarTopologyIds:i,heartbeatTimeout:s,hearbeatStartMs:Date.now()+yj},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async o=>this.connect(o)))}).catch(o=>{this.log(o)})},Zxe),this.opts.tagMeshPeers&&(this.addEventListener("gossipsub:graft",this.tagMeshPeer),this.addEventListener("gossipsub:prune",this.untagMeshPeer)),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==pi.started)return;const{registrarTopologyIds:t}=this.status;this.status={code:pi.stopped},this.opts.tagMeshPeers&&(this.removeEventListener("gossipsub:graft",this.tagMeshPeer),this.removeEventListener("gossipsub:prune",this.untagMeshPeer));const n=this.components.registrar;await Promise.all(this.multicodecs.map(async s=>n.unhandle(s))),t.forEach(s=>{n.unregister(s)}),this.outboundInflightQueue.end();const i=[];for(const s of this.streamsOutbound.values())i.push(s.close());this.streamsOutbound.clear();for(const s of this.streamsInbound.values())i.push(s.close());this.streamsInbound.clear(),await Promise.all(i),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer!=null&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache!=null&&this.fastMsgIdCache.clear(),this.directPeerInitial!=null&&clearTimeout(this.directPeerInitial),this.idontwantCounts.clear(),this.idontwants.clear(),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:t,connection:n}){if(!this.isStarted())return;const i=n.remotePeer;this.addPeer(i,n.direction,n.remoteAddr),this.createInboundStream(i,t),this.outboundInflightQueue.push({peerId:i,connection:n})}onPeerConnected(t,n){var i;(i=this.metrics)==null||i.newConnectionCount.inc({status:n.status}),!(!this.isStarted()||n.status!=="open")&&(this.addPeer(t,n.direction,n.remoteAddr),this.outboundInflightQueue.push({peerId:t,connection:n}))}onPeerDisconnected(t){this.log("connection ended %p",t),this.removePeer(t)}async createOutboundStream(t,n){var s;if(!this.isStarted())return;const i=t.toString();if(this.peers.has(i)&&!this.streamsOutbound.has(i))try{const o=new RAe(await n.newStream(this.multicodecs,{runOnLimitedConnection:this.runOnLimitedConnection}),c=>{this.log.error("outbound pipe error",c)},{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",t),this.streamsOutbound.set(i,o);const a=o.protocol;a===pj&&this.floodsubPeers.add(i),(s=this.metrics)==null||s.peersPerProtocol.inc({protocol:a},1),this.subscriptions.size>0&&(this.log("send subscriptions to",i),this.sendSubscriptions(i,Array.from(this.subscriptions),!0))}catch(o){this.log.error("createOutboundStream error",o)}}createInboundStream(t,n){if(!this.isStarted())return;const i=t.toString();if(!this.peers.has(i))return;const s=this.streamsInbound.get(i);s!==void 0&&(this.log("replacing existing inbound steam %s",i),s.close().catch(a=>{this.log.error(a)})),this.log("create inbound stream %s",i);const o=new LAe(n,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(i,o),this.pipePeerReadStream(t,o.source).catch(a=>{this.log(a)})}addPeer(t,n,i){const s=t.toString();if(!this.peers.has(s)){this.log("new peer %p",t),this.peers.set(s,t),this.score.addPeer(s);const o=JAe(i);o!==null?this.score.addIP(s,o):this.log("Added peer has no IP in current address %s %s",s,i.toString()),this.outbound.has(s)||this.outbound.set(s,n==="outbound")}}removePeer(t){var o,a;const n=t.toString();if(!this.peers.has(n))return;this.log("delete peer %p",t),this.peers.delete(n);const i=this.streamsOutbound.get(n),s=this.streamsInbound.get(n);i!=null&&((o=this.metrics)==null||o.peersPerProtocol.inc({protocol:i.protocol},-1)),i==null||i.close().catch(c=>{this.log.error(c)}),s==null||s.close().catch(c=>{this.log.error(c)}),this.streamsOutbound.delete(n),this.streamsInbound.delete(n);for(const c of this.topics.values())c.delete(n);for(const[c,l]of this.mesh)l.delete(n)&&((a=this.metrics)==null||a.onRemoveFromMesh(c,Ys.Dc,1));for(const c of this.fanout.values())c.delete(n);this.floodsubPeers.delete(n),this.gossip.delete(n),this.control.delete(n),this.outbound.delete(n),this.idontwantCounts.delete(n),this.idontwants.delete(n),this.score.removePeer(n),this.acceptFromWhitelist.delete(n)}get started(){return this.status.code===pi.started}getMeshPeers(t){const n=this.mesh.get(t);return n!=null?Array.from(n):[]}getSubscribers(t){const n=this.topics.get(t);return(n!=null?Array.from(n):[]).map(i=>this.peers.get(i)??tr(i))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(t,n){var i;try{await un(n,async s=>{var o,a,c;for await(const l of s)try{const d=l.subarray(),h=Cu.decode(d,{limits:{subscriptions:this.decodeRpcLimits.maxSubscriptions,messages:this.decodeRpcLimits.maxMessages,control$:{ihave:this.decodeRpcLimits.maxIhaveMessageIDs,iwant:this.decodeRpcLimits.maxIwantMessageIDs,graft:this.decodeRpcLimits.maxControlMessages,prune:this.decodeRpcLimits.maxControlMessages,prune$:{peers:this.decodeRpcLimits.maxPeerInfos},idontwant:this.decodeRpcLimits.maxControlMessages,idontwant$:{messageIDs:this.decodeRpcLimits.maxIdontwantMessageIDs}}}});if((o=this.metrics)==null||o.onRpcRecv(h,d.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(t,h)}catch(p){(a=this.metrics)==null||a.onRpcRecvError(),this.log(p)}else this.handleReceivedRpc(t,h).catch(p=>{var b;(b=this.metrics)==null||b.onRpcRecvError(),this.log(p)})}catch(d){(c=this.metrics)==null||c.onRpcDataError(),this.log(d)}})}catch(s){(i=this.metrics)==null||i.onPeerReadStreamError(),this.handlePeerReadStreamError(s,t)}}handlePeerReadStreamError(t,n){this.log.error(t),this.onPeerDisconnected(n)}async handleReceivedRpc(t,n){var d;if(!this.acceptFrom(t.toString())){this.log("received message from unacceptable peer %p",t),(d=this.metrics)==null||d.rpcRecvNotAccepted.inc();return}const i=n.subscriptions!=null?n.subscriptions.length:0,s=n.messages!=null?n.messages.length:0;let o=0,a=0,c=0,l=0;if(n.control!=null&&(n.control.ihave!=null&&(o=n.control.ihave.length),n.control.iwant!=null&&(a=n.control.iwant.length),n.control.graft!=null&&(c=n.control.graft.length),n.control.prune!=null&&(l=n.control.prune.length)),this.log(`rpc.from ${t.toString()} subscriptions ${i} messages ${s} ihave ${o} iwant ${a} graft ${c} prune ${l}`),n.subscriptions!=null&&n.subscriptions.length>0){const h=[];n.subscriptions.forEach(p=>{const b=p.topic,f=p.subscribe===!0;if(b!=null){if(this.allowedTopics!=null&&!this.allowedTopics.has(b))return;this.handleReceivedSubscription(t,b,f),h.push({topic:b,subscribe:f})}}),this.safeDispatchEvent("subscription-change",{detail:{peerId:t,subscriptions:h}})}for(const h of n.messages){if(this.allowedTopics!=null&&!this.allowedTopics.has(h.topic))continue;const p=this.handleReceivedMessage(t,h).catch(b=>{var f;(f=this.metrics)==null||f.onMsgRecvError(h.topic),this.log(b)});this.opts.awaitRpcMessageHandler&&await p}n.control!=null&&await this.handleControlMessage(t.toString(),n.control)}handleReceivedSubscription(t,n,i){this.log("subscription update from %p topic %s",t,n);let s=this.topics.get(n);s==null&&(s=new Set,this.topics.set(n,s)),i?s.add(t.toString()):s.delete(t.toString())}async handleReceivedMessage(t,n){var o,a,c;(o=this.metrics)==null||o.onMsgRecvPreValidation(n.topic);const i=await this.validateReceivedMessage(t,n);(a=this.metrics)==null||a.onPrevalidationResult(n.topic,i.code);const s=i.code;switch(s){case Bn.duplicate:this.score.duplicateMessage(t.toString(),i.msgIdStr,n.topic),this.gossipTracer.deliverMessage(i.msgIdStr,!0),this.mcache.observeDuplicate(i.msgIdStr,t.toString());return;case Bn.invalid:if(i.msgIdStr!=null){const l=i.msgIdStr;this.score.rejectMessage(t.toString(),l,n.topic,i.reason),this.gossipTracer.rejectMessage(l,i.reason)}else this.score.rejectInvalidMessage(t.toString(),n.topic);(c=this.metrics)==null||c.onMsgRecvInvalid(n.topic,i);return;case Bn.valid:this.score.validateMessage(i.messageId.msgIdStr),this.gossipTracer.deliverMessage(i.messageId.msgIdStr),this.mcache.put(i.messageId,n,!this.opts.asyncValidation),this.subscriptions.has(n.topic)&&(!this.components.peerId.equals(t)||this.opts.emitSelf)&&(super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:t,msgId:i.messageId.msgIdStr,msg:i.msg}})),super.dispatchEvent(new CustomEvent("message",{detail:i.msg}))),this.opts.asyncValidation||this.forwardMessage(i.messageId.msgIdStr,n,t.toString());break;default:throw new Error(`Invalid validation result: ${s}`)}}async validateReceivedMessage(t,n){var p,b,f,g;const i=(p=this.fastMsgIdFn)==null?void 0:p.call(this,n),s=i!==void 0?(b=this.fastMsgIdCache)==null?void 0:b.get(i):void 0;if(s!=null)return{code:Bn.duplicate,msgIdStr:s};const o=await FAe(this.globalSignaturePolicy,n);if(!o.valid)return{code:Bn.invalid,reason:ws.Error,error:o.error};const a=o.message;try{this.dataTransform!=null&&(a.data=this.dataTransform.inboundTransform(n.topic,a.data))}catch(v){return this.log("Invalid message, transform failed",v),{code:Bn.invalid,reason:ws.Error,error:Ln.TransformFailed}}const c=await this.msgIdFn(a),l=this.msgIdToStrFn(c),d={msgId:c,msgIdStr:l};if(i!==void 0&&this.fastMsgIdCache!=null&&this.fastMsgIdCache.put(i,l)&&((f=this.metrics)==null||f.fastMsgIdCacheCollision.inc()),this.seenCache.has(l))return{code:Bn.duplicate,msgIdStr:l};this.seenCache.put(l),(((g=n.data)==null?void 0:g.length)??0)>=this.opts.idontwantMinDataSize&&this.sendIDontWants(c,n.topic,t.toString());const h=this.topicValidators.get(n.topic);if(h!=null){let v;try{v=await h(t,a)}catch(y){const w=y.code;w===cAe&&(v=Ii.Ignore),w===aAe?v=Ii.Reject:v=Ii.Ignore}if(v!==Ii.Accept)return{code:Bn.invalid,reason:wj(v),msgIdStr:l}}return{code:Bn.valid,messageId:d,msg:a}}getScore(t){return this.score.score(t)}sendSubscriptions(t,n,i){this.sendRpc(t,{subscriptions:n.map(s=>({topic:s,subscribe:i})),messages:[]})}async handleControlMessage(t,n){var l,d,h,p,b,f,g;if(n===void 0)return;const i=((l=n.ihave)==null?void 0:l.length)>0?this.handleIHave(t,n.ihave):[],s=((d=n.iwant)==null?void 0:d.length)>0?this.handleIWant(t,n.iwant):[],o=((h=n.graft)==null?void 0:h.length)>0?await this.handleGraft(t,n.graft):[];if(((p=n.prune)==null?void 0:p.length)>0&&await this.handlePrune(t,n.prune),((b=n.idontwant)==null?void 0:b.length)>0&&this.handleIdontwant(t,n.idontwant),i.length===0&&s.length===0&&o.length===0)return;const a=this.sendRpc(t,Xs(s,{iwant:i,prune:o})),c=(f=i[0])==null?void 0:f.messageIDs;c!=null&&(a?this.gossipTracer.addPromise(t,c):(g=this.metrics)==null||g.iwantPromiseUntracked.inc(1))}acceptFrom(t){if(this.direct.has(t))return!0;const n=Date.now(),i=this.acceptFromWhitelist.get(t);if(i!=null&&i.messagesAccepted<uAe&&i.acceptUntil>=n)return i.messagesAccepted+=1,!0;const s=this.score.score(t);return s>=lAe?this.acceptFromWhitelist.set(t,{messagesAccepted:0,acceptUntil:n+dAe}):this.acceptFromWhitelist.delete(t),s>=this.opts.scoreThresholds.graylistThreshold}handleIHave(t,n){var d,h,p;if(n.length===0)return[];const i=this.score.score(t);if(i<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",t,i),(d=this.metrics)==null||d.ihaveRcvIgnored.inc({reason:c0.LowScore}),[];const s=(this.peerhave.get(t)??0)+1;if(this.peerhave.set(t,s),s>nAe)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",t,s),(h=this.metrics)==null||h.ihaveRcvIgnored.inc({reason:c0.MaxIhave}),[];const o=this.iasked.get(t)??0;if(o>=Fh)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",t,o),(p=this.metrics)==null||p.ihaveRcvIgnored.inc({reason:c0.MaxIasked}),[];const a=new Map;if(n.forEach(({topicID:b,messageIDs:f})=>{var v;if(b==null||f==null||!this.mesh.has(b))return;let g=0;f.forEach(y=>{const w=this.msgIdToStrFn(y);this.seenCache.has(w)||(a.set(w,y),g++)}),(v=this.metrics)==null||v.onIhaveRcv(b,f.length,g)}),a.size===0)return[];let c=a.size;c+o>Fh&&(c=Fh-o),this.log("IHAVE: Asking for %d out of %d messages from %s",c,a.size,t);let l=Array.from(a.values());return ca(l),l=l.slice(0,c),this.iasked.set(t,o+c),[{messageIDs:l}]}handleIWant(t,n){var c;if(n.length===0)return[];const i=this.score.score(t);if(i<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",t,i),[];const s=new Map,o=new Map;let a=0;return n.forEach(({messageIDs:l})=>{l==null||l.forEach(d=>{const h=this.msgIdToStrFn(d),p=this.mcache.getWithIWantCount(h,t);if(p==null){a++;return}if(o.set(p.msg.topic,1+(o.get(p.msg.topic)??0)),p.count>Hxe){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",t,d);return}s.set(h,p.msg)})}),(c=this.metrics)==null||c.onIwantRcv(o,a),s.size===0?(this.log("IWANT: Could not provide any wanted messages to %s",t),[]):(this.log("IWANT: Sending %d messages to %s",s.size,t),Array.from(s.values()))}async handleGraft(t,n){const i=[],s=this.score.score(t),o=Date.now();let a=this.opts.doPX;if(n.forEach(({topicID:l})=>{var p,b;if(l==null)return;const d=this.mesh.get(l);if(d==null){a=!1;return}if(d.has(t))return;const h=(p=this.backoff.get(l))==null?void 0:p.get(t);if(this.direct.has(t))this.log("GRAFT: ignoring request from direct peer %s",t),i.push(l),a=!1;else if(typeof h=="number"&&o<h){this.log("GRAFT: ignoring backed off peer %s",t),this.score.addPenalty(t,1,a0.GraftBackoff),a=!1;const f=h+this.opts.graftFloodThreshold-this.opts.pruneBackoff;o<f&&this.score.addPenalty(t,1,a0.GraftBackoff),this.addBackoff(t,l),i.push(l)}else s<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",t,s,l),i.push(l),a=!1,this.addBackoff(t,l)):d.size>=this.opts.Dhi&&!(this.outbound.get(t)??!1)?(i.push(l),this.addBackoff(t,l)):(this.log("GRAFT: Add mesh link from %s in %s",t,l),this.score.graft(t,l),d.add(t),(b=this.metrics)==null||b.onAddToMesh(l,Un.Subscribed,1));this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:t,topic:l,direction:"inbound"}})}),i.length===0)return[];const c=!1;return Promise.all(i.map(async l=>this.makePrune(t,l,a,c)))}async handlePrune(t,n){var s;const i=this.score.score(t);for(const{topicID:o,backoff:a,peers:c}of n){if(o==null)continue;const l=this.mesh.get(o);if(l==null)return;this.log("PRUNE: Remove mesh link to %s in %s",t,o),this.score.prune(t,o),l.has(t)&&(l.delete(t),(s=this.metrics)==null||s.onRemoveFromMesh(o,Ys.Prune,1)),typeof a=="number"&&a>0?this.doAddBackoff(t,o,a*1e3):this.addBackoff(t,o),c!=null&&c.length>0&&(i<this.opts.scoreThresholds.acceptPXThreshold?this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",t,i,o):await this.pxConnect(c)),this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:t,topic:o,direction:"inbound"}})}}handleIdontwant(t,n){var l;let i=this.idontwantCounts.get(t)??0;if(i>=this.opts.idontwantMaxMessages)return;const s=i;let o=this.idontwants.get(t);o==null&&(o=new Map,this.idontwants.set(t,o));let a=0;e:for(const{messageIDs:d}of n)for(const h of d){if(i>=this.opts.idontwantMaxMessages)break e;i++;const p=this.msgIdToStrFn(h);o.set(p,this.heartbeatTicks),this.mcache.msgs.has(p)||a++}this.idontwantCounts.set(t,i);const c=i-s;(l=this.metrics)==null||l.onIdontwantRcv(c,a)}addBackoff(t,n){this.doAddBackoff(t,n,this.opts.pruneBackoff)}doAddBackoff(t,n,i){let s=this.backoff.get(n);s==null&&(s=new Map,this.backoff.set(n,s));const o=Date.now()+i;(s.get(t)??0)<o&&s.set(t,o)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((t,n)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",n,t),this.score.addPenalty(n,t,a0.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%Yxe!==0)return;const t=Date.now();this.backoff.forEach((n,i)=>{n.forEach((s,o)=>{s+fAe*this.opts.heartbeatInterval<t&&n.delete(o)}),n.size===0&&this.backoff.delete(i)})}async directConnect(){const t=[];this.direct.forEach(n=>{this.streamsOutbound.has(n)||t.push(n)}),await Promise.all(t.map(async n=>this.connect(n)))}async pxConnect(t){t.length>this.opts.prunePeers&&(ca(t),t=t.slice(0,this.opts.prunePeers));const n=[];await Promise.all(t.map(async i=>{if(i.peerID==null)return;const s=ti(hj(i.peerID)),o=s.toString();if(!this.peers.has(o)){if(i.signedPeerRecord==null){n.push(o);return}try{if(!await this.components.peerStore.consumePeerRecord(i.signedPeerRecord,s)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}n.push(o)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),n.length!==0&&await Promise.all(n.map(async i=>this.connect(i)))}async connect(t){var s;this.log("Initiating connection with %s",t);const n=tr(t),i=await this.components.connectionManager.openConnection(n);for(const o of this.multicodecs)for(const a of this.components.registrar.getTopologies(o))(s=a.onConnect)==null||s.call(a,n,i)}subscribe(t){if(this.status.code!==pi.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(t)){this.subscriptions.add(t);for(const n of this.peers.keys())this.sendSubscriptions(n,[t],!0)}this.join(t)}unsubscribe(t){if(this.status.code!==pi.started)throw new Error("Pubsub is not started");const n=this.subscriptions.delete(t);if(this.log("unsubscribe from %s - am subscribed %s",t,n),n)for(const i of this.peers.keys())this.sendSubscriptions(i,[t],!1);this.leave(t)}join(t){var o,a,c;if(this.status.code!==pi.started)throw new Error("Gossipsub has not started");if(this.mesh.has(t))return;this.log("JOIN %s",t),(o=this.metrics)==null||o.onJoin(t);const n=new Set,i=this.backoff.get(t),s=this.fanout.get(t);if(s!=null&&(this.fanout.delete(t),this.fanoutLastpub.delete(t),s.forEach(l=>{!this.direct.has(l)&&this.score.score(l)>=0&&(i==null?void 0:i.has(l))!==!0&&n.add(l)}),(a=this.metrics)==null||a.onAddToMesh(t,Un.Fanout,n.size)),n.size<this.opts.D){const l=n.size;this.getRandomGossipPeers(t,this.opts.D,h=>!n.has(h)&&!this.direct.has(h)&&this.score.score(h)>=0&&(i==null?void 0:i.has(h))!==!0).forEach(h=>{n.add(h)}),(c=this.metrics)==null||c.onAddToMesh(t,Un.Random,n.size-l)}this.mesh.set(t,n),n.forEach(l=>{this.log("JOIN: Add mesh link to %s in %s",l,t),this.sendGraft(l,t)})}leave(t){var i;if(this.status.code!==pi.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",t),(i=this.metrics)==null||i.onLeave(t);const n=this.mesh.get(t);n!=null&&(Promise.all(Array.from(n).map(async s=>{this.log("LEAVE: Remove mesh link to %s in %s",s,t),await this.sendPrune(s,t)})).catch(s=>{this.log("Error sending prunes to mesh peers",s)}),this.mesh.delete(t))}selectPeersToForward(t,n,i){const s=new Set,o=this.topics.get(t);o!=null&&(this.direct.forEach(c=>{o.has(c)&&n!==c&&!((i==null?void 0:i.has(c))??!1)&&s.add(c)}),this.floodsubPeers.forEach(c=>{o.has(c)&&n!==c&&!((i==null?void 0:i.has(c))??!1)&&this.score.score(c)>=this.opts.scoreThresholds.publishThreshold&&s.add(c)}));const a=this.mesh.get(t);return a!=null&&a.size>0&&a.forEach(c=>{n!==c&&!((i==null?void 0:i.has(c))??!1)&&s.add(c)}),s}selectPeersToPublish(t){const n=new Set,i={direct:0,floodsub:0,mesh:0,fanout:0},s=this.topics.get(t);if(s!=null)if(this.opts.floodPublish)s.forEach(o=>{this.direct.has(o)?(n.add(o),i.direct++):this.score.score(o)>=this.opts.scoreThresholds.publishThreshold&&(n.add(o),i.floodsub++)});else{this.direct.forEach(a=>{s.has(a)&&(n.add(a),i.direct++)}),this.floodsubPeers.forEach(a=>{s.has(a)&&this.score.score(a)>=this.opts.scoreThresholds.publishThreshold&&(n.add(a),i.floodsub++)});const o=this.mesh.get(t);if(o!=null&&o.size>0)o.forEach(a=>{n.add(a),i.mesh++}),o.size<this.opts.D&&this.getRandomGossipPeers(t,this.opts.D-o.size,c=>!o.has(c)&&!this.direct.has(c)&&!this.floodsubPeers.has(c)&&this.score.score(c)>=this.opts.scoreThresholds.publishThreshold).forEach(c=>{n.add(c),i.mesh++});else{const a=this.fanout.get(t);if(a!=null&&a.size>0)a.forEach(c=>{n.add(c),i.fanout++});else{const c=this.getRandomGossipPeers(t,this.opts.D,l=>this.score.score(l)>=this.opts.scoreThresholds.publishThreshold);c.size>0&&(this.fanout.set(t,c),c.forEach(l=>{n.add(l),i.fanout++}))}this.fanoutLastpub.set(t,Date.now())}}return{tosend:n,tosendCount:i}}forwardMessage(t,n,i,s){var a;i!=null&&this.score.deliverMessage(i,t,n.topic);const o=this.selectPeersToForward(n.topic,i,s);o.forEach(c=>{this.sendRpc(c,Xs([n]))}),(a=this.metrics)==null||a.onForwardMsg(n.topic,o.size)}async publish(t,n,i){var m,E;const s=Date.now(),o=this.dataTransform!=null?this.dataTransform.outboundTransform(t,n):n;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");const{raw:a,msg:c}=await UAe(this.publishConfig,t,n,o),l=await this.msgIdFn(c),d=this.msgIdToStrFn(l),h=(i==null?void 0:i.ignoreDuplicatePublishError)??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(d)){if(h)return(m=this.metrics)==null||m.onPublishDuplicateMsg(t),{recipients:[]};throw Error("PublishError.Duplicate")}const{tosend:p,tosendCount:b}=this.selectPeersToPublish(t),f=this.opts.emitSelf&&this.subscriptions.has(t),g=(i==null?void 0:i.allowPublishToZeroTopicPeers)??this.opts.allowPublishToZeroTopicPeers;if(p.size===0&&!g&&!f)throw Error("PublishError.NoPeersSubscribedToTopic");this.seenCache.put(d),this.mcache.put({msgId:l,msgIdStr:d},a,!0),this.publishedMessageIds.put(d);const v=(i==null?void 0:i.batchPublish)??this.opts.batchPublish,y=Xs([a]);if(v)this.sendRpcInBatch(p,y);else for(const A of p)this.sendRpc(A,y)||p.delete(A);const w=Date.now()-s;return(E=this.metrics)==null||E.onPublishMsg(t,b,p.size,a.data!=null?a.data.length:0,w),f&&(p.add(this.components.peerId.toString()),super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:d,msg:c}})),super.dispatchEvent(new CustomEvent("message",{detail:c}))),{recipients:Array.from(p.values()).map(A=>this.peers.get(A)??tr(A))}}sendRpcInBatch(t,n){var o;const i=Cu.encode(n),s=TA.single(i);for(const a of t){const c=this.streamsOutbound.get(a);if(c==null){this.log(`Cannot send RPC to ${a} as there is no open stream to it available`),t.delete(a);continue}try{c.pushPrefixed(s)}catch(l){t.delete(a),this.log.error(`Cannot send rpc to ${a}`,l)}(o=this.metrics)==null||o.onRpcSent(n,i.length)}}reportMessageValidationResult(t,n,i){var a;let s;if(i===Ii.Accept){if(s=this.mcache.validate(t),s!=null){const{message:c,originatingPeers:l}=s;this.score.deliverMessage(n,t,c.topic),this.forwardMessage(t,s.message,n,l)}}else if(s=this.mcache.remove(t),s!=null){const c=wj(i),{message:l,originatingPeers:d}=s;this.score.rejectMessage(n,t,l.topic,c);for(const h of d)this.score.rejectMessage(h,t,l.topic,c)}const o=this.score.messageFirstSeenTimestampMs(t);(a=this.metrics)==null||a.onReportValidation(s,i,o)}sendGraft(t,n){const s=Xs([],{graft:[{topicID:n}]});this.sendRpc(t,s)}async sendPrune(t,n){const s=[await this.makePrune(t,n,this.opts.doPX,!0)],o=Xs([],{prune:s});this.sendRpc(t,o)}sendIDontWants(t,n,i){var c;const s=this.mesh.get(n);if(s==null)return;const o=new Set(s);o.delete(i);for(const l of o)((c=this.streamsOutbound.get(l))==null?void 0:c.protocol)!==MA&&o.delete(l);const a=Xs([],{idontwant:[{messageIDs:[t]}]});this.sendRpcInBatch(o,a)}sendRpc(t,n){var c,l,d,h,p;const i=this.streamsOutbound.get(t);if(i==null)return this.log(`Cannot send RPC to ${t} as there is no open stream to it available`),!1;const s=this.control.get(t);s!=null&&(this.piggybackControl(t,n,s),this.control.delete(t));const o=this.gossip.get(t);o!=null&&(this.piggybackGossip(t,n,o),this.gossip.delete(t));const a=Cu.encode(n);try{i.push(a)}catch(b){return this.log.error(`Cannot send rpc to ${t}`,b),s!=null&&this.control.set(t,s),o!=null&&this.gossip.set(t,o),!1}if((c=this.metrics)==null||c.onRpcSent(n,a.length),((l=n.control)==null?void 0:l.graft)!=null)for(const b of(d=n.control)==null?void 0:d.graft)b.topicID!=null&&this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:t,topic:b.topicID,direction:"outbound"}});if(((h=n.control)==null?void 0:h.prune)!=null)for(const b of(p=n.control)==null?void 0:p.prune)b.topicID!=null&&this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:t,topic:b.topicID,direction:"outbound"}});return!0}piggybackControl(t,n,i){var o,a;const s=Ej(n);for(const c of i.graft)c.topicID!=null&&(((o=this.mesh.get(c.topicID))==null?void 0:o.has(t))??!1)&&s.control.graft.push(c);for(const c of i.prune)c.topicID!=null&&!(((a=this.mesh.get(c.topicID))==null?void 0:a.has(t))??!1)&&s.control.prune.push(c)}piggybackGossip(t,n,i){const s=Ej(n);s.control.ihave=i}async sendGraftPrune(t,n,i){const s=this.opts.doPX,o=!1;for(const[a,c]of t){const l=c.map(p=>({topicID:p}));let d=[];const h=n.get(a);h!=null&&(d=await Promise.all(h.map(async p=>this.makePrune(a,p,s&&!(i.get(a)??!1),o))),n.delete(a)),this.sendRpc(a,Xs([],{graft:l,prune:d}))}for(const[a,c]of n){const l=await Promise.all(c.map(async d=>this.makePrune(a,d,s&&!(i.get(a)??!1),o)));this.sendRpc(a,Xs([],{prune:l}))}}emitGossip(t){const n=this.mcache.getGossipIDs(new Set(t.keys()));for(const[i,s]of t)this.doEmitGossip(i,s,n.get(i)??[])}doEmitGossip(t,n,i){if(i.length===0||(ca(i),i.length>Fh&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",i.length),n.size===0))return;let s=this.opts.Dlazy;const a=this.opts.gossipFactor*n.size;let c=n;a>s&&(s=a),s>c.size?s=c.size:c=ca(Array.from(c)).slice(0,s),c.forEach(l=>{let d=i;i.length>Fh&&(d=ca(d.slice()).slice(0,Fh)),this.pushGossip(l,{topicID:t,messageIDs:d})})}flush(){for(const[t,n]of this.gossip.entries())this.gossip.delete(t),this.sendRpc(t,Xs([],{ihave:n}));for(const[t,n]of this.control.entries()){this.control.delete(t);const i=Xs([],{graft:n.graft,prune:n.prune});this.sendRpc(t,i)}}pushGossip(t,n){this.log("Add gossip to %s",t);const i=this.gossip.get(t)??[];this.gossip.set(t,i.concat(n))}async makePrune(t,n,i,s){var d;if(this.score.prune(t,n),((d=this.streamsOutbound.get(t))==null?void 0:d.protocol)===gj)return{topicID:n,peers:[]};const o=s?this.opts.unsubcribeBackoff:this.opts.pruneBackoff,a=o/1e3;if(this.doAddBackoff(t,n,o),!i)return{topicID:n,peers:[],backoff:a};const c=this.getRandomGossipPeers(n,this.opts.prunePeers,h=>h!==t&&this.score.score(h)>=0),l=await Promise.all(Array.from(c).map(async h=>{const p=this.peers.get(h)??tr(h);let b;try{b=await this.components.peerStore.get(p)}catch(f){if(f.name!=="NotFoundError")throw f}return{peerID:p.toMultihash().bytes,signedPeerRecord:b==null?void 0:b.peerRecordEnvelope}}));return{topicID:n,peers:l,backoff:a}}async heartbeat(){var g,v;const{D:t,Dlo:n,Dhi:i,Dscore:s,Dout:o,fanoutTTL:a}=this.opts;this.heartbeatTicks++;const c=new Map,l=y=>{let w=c.get(y);return w===void 0&&(w=this.score.score(y),c.set(y,w)),w},d=new Map,h=new Map,p=new Map;this.clearBackoff(),this.peerhave.clear(),(g=this.metrics)==null||g.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.idontwantCounts.clear();for(const y of this.idontwants.values())for(const[w,m]of y)this.heartbeatTicks-m>=this.opts.mcacheLength&&y.delete(w);this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),(v=this.fastMsgIdCache)==null||v.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const b=new Map;this.mesh.forEach((y,w)=>{const m=this.topics.get(w),E=new Set,A=new Set;if(b.set(w,A),m!=null){const I=ca(Array.from(m)),T=this.backoff.get(w);for(const L of I){const z=this.streamsOutbound.get(L);if(z!=null&&this.multicodecs.includes(z.protocol)&&!y.has(L)&&!this.direct.has(L)){const B=l(L);(T==null?void 0:T.has(L))!==!0&&B>=0&&E.add(L),B>=this.opts.scoreThresholds.gossipThreshold&&A.add(L)}}}const k=(I,T)=>{var z;this.log("HEARTBEAT: Remove mesh link to %s in %s",I,w),this.addBackoff(I,w),y.delete(I),l(I)>=this.opts.scoreThresholds.gossipThreshold&&A.add(I),(z=this.metrics)==null||z.onRemoveFromMesh(w,T,1);const L=h.get(I);L==null?h.set(I,[w]):L.push(w)},x=(I,T)=>{var z;this.log("HEARTBEAT: Add mesh link to %s in %s",I,w),this.score.graft(I,w),y.add(I),A.delete(I),(z=this.metrics)==null||z.onAddToMesh(w,T,1);const L=d.get(I);L==null?d.set(I,[w]):L.push(w)};if(y.forEach(I=>{const T=l(I);T<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",I,T,w),k(I,Ys.BadScore),p.set(I,!0))}),y.size<n){const I=t-y.size;kAe(E,I).forEach(L=>{x(L,Un.NotEnough)})}if(y.size>i){let I=Array.from(y);I.sort((L,z)=>l(z)-l(L)),I=I.slice(0,s).concat(ca(I.slice(s)));let T=0;if(I.slice(0,t).forEach(L=>{(this.outbound.get(L)??!1)&&T++}),T<o){const L=B=>{const G=I[B];for(let j=B;j>0;j--)I[j]=I[j-1];I[0]=G};if(T>0){let B=T;for(let G=1;G<t&&B>0;G++)(this.outbound.get(I[G])??!1)&&(L(G),B--)}let z=t-T;for(let B=t;B<I.length&&z>0;B++)(this.outbound.get(I[B])??!1)&&(L(B),z--)}I.slice(t).forEach(L=>{k(L,Ys.Excess)})}if(y.size>=n){let I=0;if(y.forEach(T=>{(this.outbound.get(T)??!1)&&I++}),I<o){const T=o-I;OA(E,T,z=>this.outbound.get(z)===!0).forEach(z=>{x(z,Un.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&y.size>1){const I=Array.from(y).sort((z,B)=>l(z)-l(B)),T=Math.floor(y.size/2),L=l(I[T]);if(L<this.opts.scoreThresholds.opportunisticGraftThreshold){const z=this.opts.opportunisticGraftPeers,B=OA(E,z,G=>l(G)>L);for(const G of B)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",G,w),x(G,Un.Opportunistic)}}});const f=Date.now();this.fanoutLastpub.forEach((y,w)=>{y+a<f&&(this.fanout.delete(w),this.fanoutLastpub.delete(w))}),this.fanout.forEach((y,w)=>{const m=this.topics.get(w);y.forEach(x=>{(!((m==null?void 0:m.has(x))??!1)||l(x)<this.opts.scoreThresholds.publishThreshold)&&y.delete(x)});const E=this.topics.get(w),A=[],k=new Set;if(b.set(w,k),E!=null){const x=ca(Array.from(E));for(const I of x){const T=this.streamsOutbound.get(I);if(T!=null&&this.multicodecs.includes(T.protocol)&&!y.has(I)&&!this.direct.has(I)){const L=l(I);L>=this.opts.scoreThresholds.publishThreshold&&A.push(I),L>=this.opts.scoreThresholds.gossipThreshold&&k.add(I)}}}if(y.size<t){const x=t-y.size;A.slice(0,x).forEach(I=>{y.add(I),k==null||k.delete(I)})}}),this.emitGossip(b),await this.sendGraftPrune(d,h,p),this.flush(),this.mcache.shift(),this.dispatchEvent(new CustomEvent("gossipsub:heartbeat"))}getRandomGossipPeers(t,n,i=()=>!0){const s=this.topics.get(t);if(s==null)return new Set;let o=[];return s.forEach(a=>{const c=this.streamsOutbound.get(a);c!=null&&this.multicodecs.includes(c.protocol)&&i(a)&&o.push(a)}),o=ca(o),n>0&&o.length>n&&(o=o.slice(0,n)),new Set(o)}onScrapeMetrics(t){var l,d;t.mcacheSize.set(this.mcache.size),t.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),t.cacheSize.set({cache:"direct"},this.direct.size),t.cacheSize.set({cache:"seenCache"},this.seenCache.size),t.cacheSize.set({cache:"fastMsgIdCache"},((l=this.fastMsgIdCache)==null?void 0:l.size)??0),t.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),t.cacheSize.set({cache:"mcache"},this.mcache.size),t.cacheSize.set({cache:"score"},this.score.size),t.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),t.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),t.cacheSize.set({cache:"topics"},this.topics.size),t.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),t.cacheSize.set({cache:"mesh"},this.mesh.size),t.cacheSize.set({cache:"fanout"},this.fanout.size),t.cacheSize.set({cache:"peers"},this.peers.size),t.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),t.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),t.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),t.cacheSize.set({cache:"gossip"},this.gossip.size),t.cacheSize.set({cache:"control"},this.control.size),t.cacheSize.set({cache:"peerhave"},this.peerhave.size),t.cacheSize.set({cache:"outbound"},this.outbound.size);let n=0;const i=Date.now();t.connectedPeersBackoffSec.reset();for(const h of this.backoff.values()){n+=h.size;for(const[p,b]of h.entries())this.peers.has(p)&&t.connectedPeersBackoffSec.observe(Math.max(0,b-i)/1e3)}t.cacheSize.set({cache:"backoff"},n);let s=0;for(const h of this.idontwants.values())s+=h.size;t.cacheSize.set({cache:"idontwants"},s);for(const[h,p]of this.topics)t.topicPeersCount.set({topicStr:h},p.size);for(const[h,p]of this.mesh)t.meshPeerCounts.set({topicStr:h},p.size);const o=[],a=new Map;t.behaviourPenalty.reset();for(const h of this.peers.keys()){const p=this.score.score(h);o.push(p),a.set(h,p),t.behaviourPenalty.observe(((d=this.score.peerStats.get(h))==null?void 0:d.behaviourPenalty)??0)}t.registerScores(o,this.opts.scoreThresholds),t.registerScorePerMesh(this.mesh,a);const c=OAe(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,t.topicStrToLabel);t.registerScoreWeights(c)}}u(Sj,"multicodec",MA);function LA(r={}){return e=>new Sj(e,r)}const BA=["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPAeL4N3XUjZx4j4vJqJ5gMhW8f1z2W9z5pQ","/dnsaddr/bootstrap.libp2p.io/p2p/QmZa1sAx2BN6eJ2B2kB4fTdhFVvNx2jdhqWvT9nHmtjNx","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2Ec7tF1R8h6b9XyXzH6j8N2uD4v6q5Z9kM7uR5vM"],YAe=r=>{const[e,t]=Be.useState(null),[n,i]=Be.useState(null),[s,o]=Be.useState(!1);return Be.useEffect(()=>{async function a(){try{console.log("Starting OrbitDB initialization for",r);let c;try{c=await _A({libp2p:{transports:[C4(),S4(),b3()],transportManager:{faultTolerance:Ga.NO_FATAL},peerDiscovery:[u3({list:BA})],services:{identify:x3(),pubsub:LA()}}}),c.libp2p.addEventListener("peer:connect",p=>{console.log("Connected to peer:",p.detail.toString())}),c.libp2p.addEventListener("peer:disconnect",p=>{console.log("Disconnected from peer:",p.detail.toString())}),c.libp2p.addEventListener("peer:discovery",p=>{console.log("Discovered peer:",p.detail.id.toString())})}catch(p){throw console.error("Failed to initialize Helia:",p),new Error("IPFS initialization failed")}if(console.log("IPFS initialized:",c),!c)throw new Error("IPFS instance is undefined");const l=await Uv({ipfs:c});console.log("OrbitDB instance created:",l);const d=await l.open("citizenx-annotations",{type:"documents"});d.events.on("ready",()=>{console.log("Database ready:",d),o(!0)}),d.events.on("load.progress",(p,b,f,g,v)=>{console.log("Database load progress:",{address:p,hash:b,progress:g,total:v})}),d.events.on("replicated",()=>{console.log("Database replicated:",d)}),console.log("Setting db immediately after open:",d),t(d);const h=setTimeout(()=>{console.log("Database open timeout reached, assuming ready:",d),o(!0)},5e3);d.events.on("ready",()=>{clearTimeout(h)})}catch(c){console.error("OrbitDB initialization failed:",c),i("Failed to initialize decentralized storage"),o(!0)}}return a(),()=>{e&&e.close()}},[r]),{db:e,error:n,isReady:s}},la="citizenx-pending-annotations",XAe=(r,e,t,n)=>{const[i,s]=Be.useState([]),[o,a]=Be.useState(null);return Be.useEffect(()=>{(()=>{const p=localStorage.getItem(la);if(p){const b=JSON.parse(p),f=r.split("?")[0],g=b.filter(v=>v.url===f).map(v=>({...v,source:"local",comments:(v.comments||[]).map(y=>({...y,source:"local"}))}));s(g)}else s([])})()},[r]),Be.useEffect(()=>{async function h(){if(!(!e||!n))try{const p=r.split("?")[0],f=(await e.all()).filter(m=>m.value.url===p).map(m=>({...m.value,source:"orbitdb",comments:(m.value.comments||[]).map(E=>({...E,source:"orbitdb"}))})),g=localStorage.getItem(la)||"[]",v=JSON.parse(g),y=v.filter(m=>m.url===p).map(m=>({...m,source:"local",comments:(m.comments||[]).map(E=>({...E,source:"local"}))})),w=[...f,...y.filter(m=>!f.some(E=>E._id===m._id))];if(s(w),v.length>0)for(const m of y)try{const{source:E,comments:A,...k}=m;k.comments=A.map(({source:I,...T})=>T),await e.put(k);const x=v.filter(I=>I._id!==m._id);localStorage.setItem(la,JSON.stringify(x)),s(I=>I.map(T=>T._id===m._id?{...T,source:"orbitdb",comments:T.comments.map(L=>({...L,source:"orbitdb"}))}:T))}catch(E){console.warn("Failed to publish pending annotation:",E)}}catch(p){console.error("Failed to load annotations:",p),a("Failed to load annotations");const b=localStorage.getItem(la)||"[]",f=JSON.parse(b),g=r.split("?")[0],v=f.filter(y=>y.url===g).map(y=>({...y,source:"local",comments:(y.comments||[]).map(w=>({...w,source:"local"}))}));s(v)}}h(),e&&n&&e.events.on("update",async()=>{try{const p=r.split("?")[0],f=(await e.all()).filter(m=>m.value.url===p).map(m=>({...m.value,source:"orbitdb",comments:(m.value.comments||[]).map(E=>({...E,source:"orbitdb"}))})),g=localStorage.getItem(la)||"[]",y=JSON.parse(g).filter(m=>m.url===p).map(m=>({...m,source:"local",comments:(m.comments||[]).map(E=>({...E,source:"local"}))})),w=[...f,...y.filter(m=>!f.some(E=>E._id===m._id))];s(w)}catch(p){console.error("Failed to update annotations:",p),a("Failed to update annotations")}})},[e,r,n]),{annotations:i,error:o,handleSaveAnnotation:async h=>{if(!t)throw new Error("User not authenticated");if(!e||!n)throw new Error("Database not initialized");const p={_id:`${t}-${Date.now()}`,url:r.split("?")[0],text:h,timestamp:Date.now(),did:t,comments:[],source:"local"};try{await e.put(p),s(b=>[...b,{...p,source:"orbitdb"}])}catch(b){if(console.error("Failed to save annotation:",b),b.message.includes("NoPeersSubscribedToTopic")){const f=localStorage.getItem(la)||"[]",g=JSON.parse(f);g.push(p),localStorage.setItem(la,JSON.stringify(g)),s(v=>[...v,p]),a("No peers available, annotation saved locally. It will sync when peers are available.")}else throw a("Failed to save annotation"),b}},handleDeleteAnnotation:async h=>{if(!e||!n)throw new Error("Database not initialized");try{await e.del(h),s(p=>p.filter(b=>b._id!==h))}catch(p){console.error("Failed to delete annotation:",p),a("Failed to delete annotation")}},handleSaveComment:async(h,p)=>{if(!t)throw new Error("User not authenticated");if(!e||!n)throw new Error("Database not initialized");try{const b=i.find(m=>m._id===h);if(!b)throw new Error("Annotation not found");const f={_id:`${t}-${Date.now()}`,text:p,timestamp:Date.now(),did:t,source:"local"},g={...b,comments:[...b.comments||[],f]},{source:v,comments:y,...w}=g;w.comments=y.map(({source:m,...E})=>E),await e.put(w),s(m=>m.map(E=>E._id===h?{...g,source:"orbitdb",comments:g.comments.map(A=>({...A,source:"orbitdb"}))}:E))}catch(b){if(console.error("Failed to save comment:",b),b.message.includes("NoPeersSubscribedToTopic")){const f=localStorage.getItem(la)||"[]";let g=JSON.parse(f);const v=g.findIndex(w=>w._id===h),y={_id:`${t}-${Date.now()}`,text:p,timestamp:Date.now(),did:t,source:"local"};if(v!==-1)g[v].comments=[...g[v].comments||[],y];else{const w=i.find(m=>m._id===h);if(w){const m={...w,comments:[...w.comments||[],y]};g.push(m)}}localStorage.setItem(la,JSON.stringify(g)),s(w=>w.map(m=>m._id===h?{...m,comments:[...m.comments||[],y]}:m)),a("No peers available, comment saved locally. It will sync when peers are available.")}else throw a("Failed to save comment"),b}}}},ZAe=r=>{const[e,t]=Be.useState({}),[n,i]=Be.useState(null),[s,o]=Be.useState(null),a=async()=>{try{console.log("useUserProfiles: Current DID:",r);const c=localStorage.getItem("citizenx-profiles");console.log("useUserProfiles: Raw localStorage profiles:",c);const l=c?JSON.parse(c):[];console.log("useUserProfiles: Parsed localStorage profiles:",l);let d=[];if(s){console.log("Fetching all documents from OrbitDB...");try{const f=await s.all();console.log("Result of database.all():",f),console.log("Is iterator?",typeof f[Symbol.asyncIterator]=="function");for await(const g of f)console.log("OrbitDB document:",g),d.push(g.value)}catch(f){console.error("Failed to iterate over database.all():",f);const g=await s.get("");d.push(...g.map(v=>v.value))}console.log("useUserProfiles: OrbitDB profiles:",d)}const h=[...l,...d],b=Array.from(new Map(h.map(f=>[f._id,f])).values()).reduce((f,g)=>(f[g._id]={handle:g.handle,profilePicture:g.profilePicture},f),{});console.log("useUserProfiles: Combined profiles map:",b),t(b)}catch(c){console.error("useUserProfiles: Failed to load profiles:",c),i("Failed to load user profiles")}};return Be.useEffect(()=>{async function c(){try{console.log("Initializing user profiles database...");const l=await _A({libp2p:{transports:[C4(),S4(),b3()],transportManager:{faultTolerance:Ga.NO_FATAL},peerDiscovery:[u3({list:BA})],services:{identify:x3(),pubsub:LA()}}});console.log("IPFS initialized for user profiles:",l);const h=await(await Uv({ipfs:l})).open("citizenx-profiles",{type:"documents"});console.log("User profiles database opened:",h),await new Promise(p=>{h.events.on("ready",()=>{console.log("Database ready:",h),p()})}),o(h),await a()}catch(l){console.error("useUserProfiles: Failed to initialize user profiles database:",l),i("Failed to initialize user profiles database"),await a()}}return c(),()=>{s&&s.close()}},[]),Be.useEffect(()=>{r&&a()},[r]),Be.useEffect(()=>{const c=setInterval(()=>{console.log("useUserProfiles: Polling localStorage for profile updates..."),a()},5e3);return()=>clearInterval(c)},[s]),Be.useEffect(()=>{s&&s.events.on("update",async()=>{console.log("useUserProfiles: Database update event triggered"),await a()})},[s]),{profiles:e,error:n}};for(var Kh="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l0=typeof Uint8Array>"u"?[]:new Uint8Array(256),F4=0;F4<Kh.length;F4++)l0[Kh.charCodeAt(F4)]=F4;var z4=function(r){var e=new Uint8Array(r),t,n=e.length,i="";for(t=0;t<n;t+=3)i+=Kh[e[t]>>2],i+=Kh[(e[t]&3)<<4|e[t+1]>>4],i+=Kh[(e[t+1]&15)<<2|e[t+2]>>6],i+=Kh[e[t+2]&63];return n%3===2?i=i.substring(0,i.length-1)+"=":n%3===1&&(i=i.substring(0,i.length-2)+"=="),i},UA=function(r){var e=r.length*.75,t=r.length,n,i=0,s,o,a,c;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);var l=new ArrayBuffer(e),d=new Uint8Array(l);for(n=0;n<t;n+=4)s=l0[r.charCodeAt(n)],o=l0[r.charCodeAt(n+1)],a=l0[r.charCodeAt(n+2)],c=l0[r.charCodeAt(n+3)],d[i++]=s<<2|o>>4,d[i++]=(o&15)<<4|a>>2,d[i++]=(a&3)<<6|c&63;return l};function FA(r){return new TextEncoder().encode(r).buffer}function eCe(r){return new TextDecoder().decode(r)}async function tCe(){try{const r=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]),e=await crypto.subtle.exportKey("spki",r.publicKey),n=`did:key:${z4(e)}`,i=await crypto.subtle.exportKey("jwk",r.privateKey),s=JSON.stringify(i);return{did:n,privateKey:s}}catch(r){throw console.error("Failed to generate key pair:",r),new Error("Failed to generate key pair")}}async function rCe(r,e,t){try{const n=await crypto.subtle.importKey("raw",FA(t),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]),i=crypto.getRandomValues(new Uint8Array(16)),s=await crypto.subtle.deriveKey({name:"PBKDF2",salt:i,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt"]),o=crypto.getRandomValues(new Uint8Array(12)),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:o},s,FA(e)),c={salt:z4(i),iv:z4(o),encryptedPrivateKey:z4(a),did:r};return JSON.stringify(c)}catch(n){throw console.error("Failed to export key pair:",n),new Error("Failed to export key pair")}}async function nCe(r,e){try{const t=JSON.parse(r),{salt:n,iv:i,encryptedPrivateKey:s,did:o}=t,a=await crypto.subtle.importKey("raw",FA(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]),c=await crypto.subtle.deriveKey({name:"PBKDF2",salt:UA(n),iterations:1e5,hash:"SHA-256"},a,{name:"AES-GCM",length:256},!1,["decrypt"]),l=await crypto.subtle.decrypt({name:"AES-GCM",iv:UA(i)},c,UA(s)),d=eCe(l);return{did:o,privateKey:d}}catch(t){throw console.error("Failed to import key pair:",t),new Error("Failed to import key pair")}}function iCe(){const[r,e]=Be.useState(null),[t,n]=Be.useState(null),[i,s]=Be.useState([]),[o,a]=Be.useState(!0),[c,l]=Be.useState(null),[d,h]=Be.useState(null);Be.useEffect(()=>{async function w(){try{const m=await _A({libp2p:{transports:[C4(),S4(),b3()],transportManager:{faultTolerance:Ga.NO_FATAL},peerDiscovery:[u3({list:BA})],services:{identify:x3(),pubsub:LA()}}}),A=await(await Uv({ipfs:m})).open("citizenx-profiles",{type:"documents"});console.log("User profiles database opened:",A),h(A);const k=localStorage.getItem("citizenx-profiles");console.log("useAuth: Raw localStorage profiles:",k);const x=k?JSON.parse(k):[];console.log("useAuth: Parsed localStorage profiles:",x),s(x),console.log("useAuth: Initial profiles loaded:",x),chrome.storage.local.get(["did","privateKey"],async z=>{if(z.did&&z.privateKey){console.log("useAuth: Initial DID from storage:",z.did),e(z.did),console.log("useAuth: Checking localStorage profiles for DID mismatch:",x);const B=x.find(G=>G._id===z.did);B&&(console.log("useAuth: Comparing DID",z.did,"with profile _id",B._id),console.log("useAuth: Setting initial profile from localStorage:",B),n(B))}console.log("useAuth: Finished loading DID and profile"),a(!1)});const I=[];try{const z=await A.all();for await(const B of z)I.push(B.value)}catch(z){console.error("useAuth: Failed to iterate over database.all():",z);const B=await A.get("");I.push(...B.map(G=>G.value))}const T=[...x,...I],L=Array.from(new Map(T.map(z=>[z._id,z])).values());s(L)}catch(m){console.error("Failed to initialize auth:",m),l("Failed to initialize authentication"),a(!1)}}return w(),()=>{d&&d.close()}},[]),Be.useEffect(()=>{d&&d.events.on("update",async()=>{const w=[];try{const A=await d.all();for await(const k of A)w.push(k.value)}catch(A){console.error("useAuth: Failed to iterate over database.all() in update:",A);const k=await d.get("");w.push(...k.map(x=>x.value))}const m=[...i,...w],E=Array.from(new Map(m.map(A=>[A._id,A])).values());if(s(E),localStorage.setItem("citizenx-profiles",JSON.stringify(E)),console.log("Profiles after refresh:",E),r){const A=E.find(k=>k._id===r);console.log("useAuth: Profile for DID",r,":",A),n(A||null)}})},[d,r]);const p=async()=>{try{a(!0);const{did:w,privateKey:m}=await tCe();await chrome.storage.local.set({did:w,privateKey:m}),console.log("useAuth: Key pair stored in chrome.storage.local"),console.log("useAuth: New authenticated DID:",w),e(w),a(!1)}catch(w){console.error("Authentication failed:",w),l("Authentication failed"),a(!1)}},b=async()=>{const w=localStorage.getItem("citizenx-profiles");let m=w?JSON.parse(w):[];m=m.filter(E=>E._id!==r),console.log("useAuth: Updated profiles after sign-out:",m),localStorage.setItem("citizenx-profiles",JSON.stringify(m)),s(m),n(null),console.log("useAuth: Cleared DID and private key from chrome.storage.local"),await chrome.storage.local.remove(["did","privateKey"]),e(null),console.log("useAuth: Loading profiles, loading:",o,"profiles:",m)},f=async w=>{const m=await chrome.storage.local.get(["did","privateKey"]);if(!m.did||!m.privateKey)throw new Error("No identity found to export");return await rCe(m.did,m.privateKey,w)},g=async(w,m)=>{const{did:E,privateKey:A}=await nCe(w,m);await chrome.storage.local.set({did:E,privateKey:A}),e(E);const k=localStorage.getItem("citizenx-profiles"),I=(k?JSON.parse(k):[]).find(T=>T._id===E);I&&n(I)},v=async(w,m)=>{if(!r||!d)throw new Error("User not authenticated or database not initialized");const E={_id:r,handle:w,profilePicture:m};try{await d.put(E),n(E);const A=[...i,E];s(A),localStorage.setItem("citizenx-profiles",JSON.stringify(A)),console.log("Profiles after local save:",A)}catch{console.log("No peers subscribed, saving profile to localStorage:",E);const k=[...i,E];s(k),localStorage.setItem("citizenx-profiles",JSON.stringify(k)),console.log("Profiles after local save:",k),n(E)}},y=async(w,m)=>{if(!r||!d)throw new Error("User not authenticated or database not initialized");const E={_id:r,handle:w,profilePicture:m};try{await d.put(E),n(E);const A=i.map(k=>k._id===r?E:k);s(A),localStorage.setItem("citizenx-profiles",JSON.stringify(A))}catch{console.log("No peers subscribed, saving profile to localStorage:",E);const k=i.map(x=>x._id===r?E:x);s(k),localStorage.setItem("citizenx-profiles",JSON.stringify(k)),n(E)}};return console.log("useAuth: Loading profiles, loading:",o,"profiles:",i),{did:r,profile:t,loading:o,authenticate:p,signOut:b,exportIdentity:f,importIdentity:g,createProfile:v,updateProfile:y,error:c}}const sCe=({comment:r,profiles:e})=>{console.log(`Comment: Looking up DID ${r.did} for comment ${r._id}`),console.log("Comment: Profiles available:",e);const t=e[r.did]||{handle:"Unknown",profilePicture:""};return ne.jsxs("div",{style:{marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.profilePicture&&ne.jsx("img",{src:t.profilePicture,alt:"Profile",style:{width:"1.25rem",height:"1.25rem",borderRadius:"50%"}}),ne.jsxs("p",{style:{margin:"0",fontSize:"0.8rem",color:"#666"},children:[t.handle," • ",new Date(r.timestamp).toLocaleString()]}),ne.jsx("span",{title:r.source==="orbitdb"?"Stored in OrbitDB":"Stored in Local Storage",children:r.source==="orbitdb"?ne.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"0.8rem",height:"0.8rem",viewBox:"0 0 24 24",fill:"none",stroke:"#2c7a7b",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[ne.jsx("path",{d:"M2 17h2a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2H2"}),ne.jsx("path",{d:"M20 17h2a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2"}),ne.jsx("path",{d:"M9 17h6"}),ne.jsx("rect",{x:"6",y:"3",width:"12",height:"4",rx:"2"}),ne.jsx("rect",{x:"6",y:"17",width:"12",height:"4",rx:"2"})]}):ne.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"0.8rem",height:"0.8rem",viewBox:"0 0 24 24",fill:"none",stroke:"#f97316",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[ne.jsx("path",{d:"M6 2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2"}),ne.jsx("path",{d:"M12 2v4"}),ne.jsx("path",{d:"M12 18v4"}),ne.jsx("path",{d:"M12 10v4"})]})}),ne.jsx("p",{style:{margin:"0 0 0 0.5rem",fontSize:"0.8rem",color:"#333"},children:r.text})]})},oCe=({annotations:r,profiles:e,onDelete:t,onSaveComment:n})=>{const[i,s]=Eq.useState({}),o=(c,l)=>{s(d=>({...d,[c]:l}))},a=async c=>{!n||!i[c]||(await n(c,i[c]),s(l=>({...l,[c]:""})))};return console.log("AnnotationList: Profiles available:",e),console.log("AnnotationList: Annotations:",r),ne.jsx("div",{style:{marginTop:"1rem"},children:r.map(c=>{console.log(`AnnotationList: Looking up DID ${c.did} for annotation ${c._id}`);const l=e[c.did]||{handle:"Unknown",profilePicture:""};return ne.jsxs("div",{style:{background:"#fff",padding:"0.5rem",marginBottom:"0.5rem",borderRadius:"5px",border:"1px solid #e5e7eb"},children:[ne.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.5rem",gap:"0.5rem"},children:[l.profilePicture&&ne.jsx("img",{src:l.profilePicture,alt:"Profile",style:{width:"1.5rem",height:"1.5rem",borderRadius:"50%"}}),ne.jsxs("p",{style:{margin:"0",fontSize:"0.8rem",color:"#666"},children:[l.handle," • ",new Date(c.timestamp).toLocaleString()]}),ne.jsx("span",{title:c.source==="orbitdb"?"Stored in OrbitDB":"Stored in Local Storage",children:c.source==="orbitdb"?ne.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",viewBox:"0 0 24 24",fill:"none",stroke:"#2c7a7b",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[ne.jsx("path",{d:"M2 17h2a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2H2"}),ne.jsx("path",{d:"M20 17h2a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2"}),ne.jsx("path",{d:"M9 17h6"}),ne.jsx("rect",{x:"6",y:"3",width:"12",height:"4",rx:"2"}),ne.jsx("rect",{x:"6",y:"17",width:"12",height:"4",rx:"2"})]}):ne.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",viewBox:"0 0 24 24",fill:"none",stroke:"#f97316",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[ne.jsx("path",{d:"M6 2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2"}),ne.jsx("path",{d:"M12 2v4"}),ne.jsx("path",{d:"M12 18v4"}),ne.jsx("path",{d:"M12 10v4"})]})})]}),ne.jsx("p",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#333"},children:c.text}),ne.jsx("button",{onClick:()=>t(c._id),style:{padding:"0.25rem 0.5rem",background:"#f97316",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",fontSize:"0.8rem"},onMouseEnter:d=>d.currentTarget.style.backgroundColor="#fb923c",onMouseLeave:d=>d.currentTarget.style.backgroundColor="#f97316",children:"Delete"}),c.comments&&c.comments.length>0&&ne.jsx("div",{style:{marginTop:"0.5rem",paddingLeft:"1rem",borderLeft:"2px solid #e5e7eb"},children:c.comments.map(d=>ne.jsx(sCe,{comment:d,profiles:e},d._id))}),n&&ne.jsxs("div",{style:{marginTop:"0.5rem"},children:[ne.jsx("textarea",{value:i[c._id]||"",onChange:d=>o(c._id,d.target.value),placeholder:"Add a comment...",style:{width:"100%",height:"2.5rem",marginBottom:"0.5rem",fontSize:"0.8rem",border:"1px solid #e5e7eb",borderRadius:"5px",padding:"0.5rem",color:"#333",backgroundColor:"#fff"}}),ne.jsx("button",{onClick:()=>a(c._id),disabled:!i[c._id],style:{padding:"0.25rem 0.5rem",background:i[c._id]?"#2c7a7b":"#d1d5db",color:"#fff",border:"none",borderRadius:"5px",cursor:i[c._id]?"pointer":"not-allowed",fontSize:"0.8rem"},onMouseEnter:d=>i[c._id]&&(d.currentTarget.style.backgroundColor="#4a999a"),onMouseLeave:d=>i[c._id]&&(d.currentTarget.style.backgroundColor="#2c7a7b"),children:"Add Comment"})]})]},c._id)})})},aCe=({url:r})=>{const[e,t]=Be.useState(""),{did:n,profile:i,loading:s,authenticate:o,signOut:a,exportIdentity:c,importIdentity:l,createProfile:d,updateProfile:h,error:p}=iCe(),{profiles:b,error:f}=ZAe(n),[g,v]=Be.useState(""),[y,w]=Be.useState(""),[m,E]=Be.useState(""),[A,k]=Be.useState(""),[x,I]=Be.useState(""),[T,L]=Be.useState(""),[z,B]=Be.useState(!1),[G,j]=Be.useState(!1),[q,Q]=Be.useState(""),[K,O]=Be.useState(""),[U,W]=Be.useState(!1),J=Be.useRef(null),H=r.startsWith("chrome-extension://"),{db:se,error:we,isReady:ce}=H?{db:null,error:null,isReady:!0}:YAe(r),{annotations:de,error:Ne,handleSaveAnnotation:Me,handleDeleteAnnotation:Ze,handleSaveComment:lt}=H?{annotations:[],error:null,handleSaveAnnotation:async()=>{},handleDeleteAnnotation:async()=>{},handleSaveComment:async()=>{}}:XAe(r,se,n,ce),vt=p||we||Ne||f;Be.useEffect(()=>{console.log("AnnotationUI: Checking profile modal conditions - loading:",s,"did:",n,"profile:",i),!s&&n&&!i&&(console.log("AnnotationUI: Opening Update Profile modal"),B(!0))},[n,i,s]),Be.useEffect(()=>{const fe=Ki=>{J.current&&!J.current.contains(Ki.target)&&W(!1)};return document.addEventListener("mousedown",fe),()=>{document.removeEventListener("mousedown",fe)}},[]);const kt=async()=>{try{await Me(e),t("")}catch(fe){console.error("Failed to save annotation in AnnotationUI:",fe)}},$t=async()=>{try{if(!m){L("Please enter a passphrase to export your identity");return}const fe=await c(m);v(fe),L("")}catch(fe){L(fe.message)}},nr=async()=>{try{if(!y||!A){I("Please enter the identity data and passphrase");return}await l(y,A),w(""),k(""),I(""),v("")}catch(fe){I(fe.message)}},Nr=async()=>{try{if(!q||!K){L("Please provide a handle and profile picture");return}i?await h(q,K):await d(q,K),B(!1),Q(""),O(""),W(!1)}catch(fe){L(fe.message)}},fa=fe=>{var bs;const Ki=(bs=fe.target.files)==null?void 0:bs[0];if(Ki){const bn=new FileReader;bn.onload=Qc=>{var rf;(rf=Qc.target)!=null&&rf.result&&O(Qc.target.result)},bn.readAsDataURL(Ki)}},eo=()=>{W(fe=>!fe)},Gc=()=>{W(!1),j(!0),E(""),v(""),L("")};return ne.jsxs("div",{style:{padding:"1rem",width:"100%",backgroundColor:"#f5f7fa",minHeight:"100vh",fontFamily:"Arial, sans-serif"},children:[n?ne.jsx("div",{style:{marginBottom:"1rem",backgroundColor:"#fff",padding:"0.5rem",borderRadius:"5px",border:"1px solid #e5e7eb"},children:ne.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},children:[ne.jsxs("div",{style:{display:"flex",alignItems:"center",flexShrink:0},children:[i&&i.profilePicture&&ne.jsx("img",{src:i.profilePicture,alt:"Profile",style:{width:"2rem",height:"2rem",borderRadius:"50%",marginRight:"0.5rem"}}),ne.jsxs("p",{style:{margin:"0",fontSize:"0.9rem",color:"#333",whiteSpace:"nowrap"},children:["Connected: ",(i==null?void 0:i.handle)||"Set your handle"]})]}),ne.jsxs("div",{style:{position:"relative",flexShrink:0},children:[ne.jsx("button",{onClick:eo,style:{padding:"0.25rem",background:"none",border:"none",cursor:"pointer"},"aria-label":"Settings",children:ne.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.25rem",height:"1.25rem",viewBox:"0 0 24 24",fill:"none",stroke:"#2c7a7b",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[ne.jsx("circle",{cx:"12",cy:"12",r:"3"}),ne.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l-.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h-.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l-.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v-.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l-.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})}),U&&ne.jsxs("div",{ref:J,style:{position:"absolute",right:0,top:"100%",background:"#fff",border:"1px solid #e5e7eb",borderRadius:"5px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",zIndex:1e3},children:[ne.jsx("button",{onClick:()=>B(!0),style:{display:"block",padding:"0.5rem 1rem",background:"none",border:"none",width:"100%",textAlign:"left",cursor:"pointer",color:"#333",fontSize:"0.9rem"},onMouseEnter:fe=>fe.currentTarget.style.backgroundColor="#f5f7fa",onMouseLeave:fe=>fe.currentTarget.style.backgroundColor="transparent",children:"Edit Profile"}),ne.jsx("button",{onClick:Gc,style:{display:"block",padding:"0.5rem 1rem",background:"none",border:"none",width:"100%",textAlign:"left",cursor:"pointer",color:"#333",fontSize:"0.9rem"},onMouseEnter:fe=>fe.currentTarget.style.backgroundColor="#f5f7fa",onMouseLeave:fe=>fe.currentTarget.style.backgroundColor="transparent",children:"Export Identity"}),ne.jsx("button",{onClick:a,style:{display:"block",padding:"0.5rem 1rem",background:"none",border:"none",width:"100%",textAlign:"left",cursor:"pointer",color:"#f97316",fontSize:"0.9rem"},onMouseEnter:fe=>fe.currentTarget.style.backgroundColor="#f5f7fa",onMouseLeave:fe=>fe.currentTarget.style.backgroundColor="transparent",children:"Sign Out"})]})]})]})}):ne.jsxs("div",{style:{marginBottom:"1rem"},children:[ne.jsx("button",{onClick:o,style:{padding:"0.5rem 1rem",background:"#2c7a7b",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",width:"100%",fontSize:"0.9rem"},onMouseEnter:fe=>fe.currentTarget.style.backgroundColor="#4a999a",onMouseLeave:fe=>fe.currentTarget.style.backgroundColor="#2c7a7b",children:"Authenticate"}),ne.jsxs("div",{style:{marginTop:"0.5rem"},children:[ne.jsx("textarea",{value:y,onChange:fe=>w(fe.target.value),placeholder:"Paste your exported identity here...",style:{width:"100%",height:"3.75rem",marginBottom:"0.5rem",fontSize:"0.8rem",border:"1px solid #e5e7eb",borderRadius:"5px",padding:"0.5rem",color:"#333",backgroundColor:"#fff"}}),ne.jsx("input",{type:"password",placeholder:"Enter passphrase to import",value:A,onChange:fe=>k(fe.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem",border:"1px solid #e5e7eb",borderRadius:"5px",fontSize:"0.9rem",color:"#333",backgroundColor:"#fff"}}),ne.jsx("button",{onClick:nr,style:{padding:"0.5rem 1rem",background:"#2c7a7b",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",width:"100%",fontSize:"0.9rem"},onMouseEnter:fe=>fe.currentTarget.style.backgroundColor="#4a999a",onMouseLeave:fe=>fe.currentTarget.style.backgroundColor="#2c7a7b",children:"Import Identity"}),x&&ne.jsx("p",{style:{color:"#e11d48",margin:"0.25rem 0 0 0",fontSize:"0.8rem"},children:x})]})]}),z&&ne.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"#fff",padding:"1rem",borderRadius:"5px",boxShadow:"0 0 10px rgba(0,0,0,0.3)",zIndex:1e3,width:"90%",maxWidth:"400px"},children:[ne.jsx("h2",{style:{fontSize:"1.2rem",margin:"0 0 0.5rem 0",color:"#333"},children:i?"Update Profile":"Set Profile"}),ne.jsx("input",{type:"text",placeholder:"Enter your handle",value:q,onChange:fe=>Q(fe.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem",border:"1px solid #e5e7eb",borderRadius:"5px",fontSize:"0.9rem",color:"#333",backgroundColor:"#fff"}}),ne.jsx("input",{type:"file",accept:"image/*",onChange:fa,style:{width:"100%",marginBottom:"0.5rem"}}),K&&ne.jsx("img",{src:K,alt:"Preview",style:{width:"3.125rem",height:"3.125rem",borderRadius:"50%",marginBottom:"0.5rem"}}),ne.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[ne.jsx("button",{onClick:Nr,style:{padding:"0.5rem 1rem",background:"#2c7a7b",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",fontSize:"0.9rem",flex:1},onMouseEnter:fe=>fe.currentTarget.style.backgroundColor="#4a999a",onMouseLeave:fe=>fe.currentTarget.style.backgroundColor="#2c7a7b",children:"Save"}),ne.jsx("button",{onClick:()=>B(!1),style:{padding:"0.5rem 1rem",background:"#f97316",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",fontSize:"0.9rem",flex:1},onMouseEnter:fe=>fe.currentTarget.style.backgroundColor="#fb923c",onMouseLeave:fe=>fe.currentTarget.style.backgroundColor="#f97316",children:"Cancel"})]})]}),G&&ne.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"#fff",padding:"1rem",borderRadius:"5px",boxShadow:"0 0 10px rgba(0,0,0,0.3)",zIndex:1e3,width:"90%",maxWidth:"400px"},children:[ne.jsx("h2",{style:{fontSize:"1.2rem",margin:"0 0 0.5rem 0",color:"#333"},children:"Export Identity"}),ne.jsx("input",{type:"password",placeholder:"Enter passphrase to export",value:m,onChange:fe=>E(fe.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem",border:"1px solid #e5e7eb",borderRadius:"5px",fontSize:"0.9rem",color:"#333",backgroundColor:"#fff"}}),ne.jsx("button",{onClick:$t,style:{padding:"0.5rem 1rem",background:"#2c7a7b",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",width:"100%",fontSize:"0.9rem",marginBottom:"0.5rem"},onMouseEnter:fe=>fe.currentTarget.style.backgroundColor="#4a999a",onMouseLeave:fe=>fe.currentTarget.style.backgroundColor="#2c7a7b",children:"Export"}),T&&ne.jsx("p",{style:{color:"#e11d48",margin:"0.25rem 0 0.5rem 0",fontSize:"0.8rem"},children:T}),g&&ne.jsx("textarea",{value:g,readOnly:!0,style:{width:"100%",height:"3.75rem",marginBottom:"0.5rem",fontSize:"0.8rem",border:"1px solid #e5e7eb",borderRadius:"5px",padding:"0.5rem",color:"#333",backgroundColor:"#fff"}}),ne.jsx("button",{onClick:()=>j(!1),style:{padding:"0.5rem 1rem",background:"#f97316",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",width:"100%",fontSize:"0.9rem"},onMouseEnter:fe=>fe.currentTarget.style.backgroundColor="#fb923c",onMouseLeave:fe=>fe.currentTarget.style.backgroundColor="#f97316",children:"Close"})]}),vt&&ne.jsx("p",{style:{color:"#e11d48",margin:"0 0 0.5rem 0",fontSize:"0.8rem"},children:vt}),ne.jsx("textarea",{value:e,onChange:fe=>t(fe.target.value),placeholder:"Enter annotation...",style:{width:"100%",height:"5rem",marginBottom:"0.5rem",fontSize:"0.9rem",border:"1px solid #e5e7eb",borderRadius:"5px",padding:"0.5rem",color:"#333",backgroundColor:"#fff"}}),ne.jsx("button",{onClick:kt,disabled:!n||!se||!ce,style:{padding:"0.5rem 1rem",background:n&&se&&ce?"#2c7a7b":"#d1d5db",color:"#fff",border:"none",borderRadius:"5px",cursor:n&&se&&ce?"pointer":"not-allowed",marginBottom:"1rem",width:"100%",fontSize:"0.9rem"},onMouseEnter:fe=>n&&se&&ce&&(fe.currentTarget.style.backgroundColor="#4a999a"),onMouseLeave:fe=>n&&se&&ce&&(fe.currentTarget.style.backgroundColor="#2c7a7b"),children:"Save"}),ne.jsx(oCe,{annotations:de,profiles:b,onDelete:Ze,onSaveComment:n&&se&&ce?lt:void 0})]})},cCe=()=>{const[r,e]=Be.useState(null);return Be.useEffect(()=>{const t=()=>{chrome.tabs.query({active:!0,currentWindow:!0},s=>{var o;(o=s[0])!=null&&o.url?e(s[0].url):(console.error("Failed to get current tab URL"),e(""))})};t();const n=(s,o,a)=>{o.url&&a.active&&e(o.url)};chrome.tabs.onUpdated.addListener(n);const i=()=>{t()};return chrome.tabs.onActivated.addListener(i),()=>{chrome.tabs.onUpdated.removeListener(n),chrome.tabs.onActivated.removeListener(i)}},[]),r===null?ne.jsx("div",{children:"Loading..."}):ne.jsx(aCe,{url:r})},xj=document.getElementById("root");xj?p_(xj).render(ne.jsx(cCe,{})):console.error("Root element not found")})();
