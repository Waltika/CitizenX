var nCe=Object.defineProperty;var HH=it=>{throw TypeError(it)};var iCe=(it,Ze,jt)=>Ze in it?nCe(it,Ze,{enumerable:!0,configurable:!0,writable:!0,value:jt}):it[Ze]=jt;var u=(it,Ze,jt)=>iCe(it,typeof Ze!="symbol"?Ze+"":Ze,jt),NA=(it,Ze,jt)=>Ze.has(it)||HH("Cannot "+jt);var oe=(it,Ze,jt)=>(NA(it,Ze,"read from private field"),jt?jt.call(it):Ze.get(it)),Je=(it,Ze,jt)=>Ze.has(it)?HH("Cannot add the same private member more than once"):Ze instanceof WeakSet?Ze.add(it):Ze.set(it,jt),_t=(it,Ze,jt,io)=>(NA(it,Ze,"write to private field"),io?io.call(it,jt):Ze.set(it,jt),jt),Ie=(it,Ze,jt)=>(NA(it,Ze,"access private method"),jt);var no=(it,Ze,jt,io)=>({set _(m0){_t(it,Ze,m0,jt)},get _(){return oe(it,Ze,io)}});(function(){"use strict";var Fi,bj,Vh,Kh,jc,o0,jh,a0,zi,Hh,mn,c0,Vi,qh,ua,l0,D4,lt,qH,WH,GH,QH,YH,M4,MA,OA,O4,JH,R4,vj,TA,PA,DA,Zs,Ej,Sj,xj,Aj,Cj,Ij,kj,_j,da,L4,RA,Tj,Pj,Dj,$j,Gh,Hc,u0,d0,Cu,Iu,Yh,Jh,ku,$4,XH,Nj,Mj,wn,f0,LA,p0,Oj,Rj,Lj,Bj,Uj,Fj,zj,Vj,Kj,jj,Hj,qj,Wj,Gj,zn,ZH,g0,y0,Qj,Yj,Jj,Xj,Zj,eH,tH,rH,nH,iH,sH,oH,aH,cH,lH,uH,dH,hH,fH,pH,Xh,B4,gH,yH,mH,wH,bH,vH,EH,SH,xH,AH,CH,Vn,U4,F4,z4,IH,Zh,V4,kH,_H,TH,PH,DH,$H,NH,MH,OH,RH,LH,BH,UH,h0,BA,FH,zH,VH,KH;var it=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ze(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var jt={exports:{}},io={},m0={exports:{}},je={};/**
* @license React
* react.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var ef=Symbol.for("react.element"),tq=Symbol.for("react.portal"),rq=Symbol.for("react.fragment"),nq=Symbol.for("react.strict_mode"),iq=Symbol.for("react.profiler"),sq=Symbol.for("react.provider"),oq=Symbol.for("react.context"),aq=Symbol.for("react.forward_ref"),cq=Symbol.for("react.suspense"),lq=Symbol.for("react.memo"),uq=Symbol.for("react.lazy"),UA=Symbol.iterator;function dq(r){return r===null||typeof r!="object"?null:(r=UA&&r[UA]||r["@@iterator"],typeof r=="function"?r:null)}var FA={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},zA=Object.assign,VA={};function Tu(r,e,t){this.props=r,this.context=e,this.refs=VA,this.updater=t||FA}Tu.prototype.isReactComponent={},Tu.prototype.setState=function(r,e){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,e,"setState")},Tu.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function KA(){}KA.prototype=Tu.prototype;function K4(r,e,t){this.props=r,this.context=e,this.refs=VA,this.updater=t||FA}var j4=K4.prototype=new KA;j4.constructor=K4,zA(j4,Tu.prototype),j4.isPureReactComponent=!0;var jA=Array.isArray,HA=Object.prototype.hasOwnProperty,H4={current:null},qA={key:!0,ref:!0,__self:!0,__source:!0};function WA(r,e,t){var n,i={},s=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)HA.call(e,n)&&!qA.hasOwnProperty(n)&&(i[n]=e[n]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(r&&r.defaultProps)for(n in a=r.defaultProps,a)i[n]===void 0&&(i[n]=a[n]);return{$$typeof:ef,type:r,key:s,ref:o,props:i,_owner:H4.current}}function hq(r,e){return{$$typeof:ef,type:r.type,key:e,ref:r.ref,props:r.props,_owner:r._owner}}function q4(r){return typeof r=="object"&&r!==null&&r.$$typeof===ef}function fq(r){var e={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(t){return e[t]})}var GA=/\/+/g;function W4(r,e){return typeof r=="object"&&r!==null&&r.key!=null?fq(""+r.key):e.toString(36)}function w0(r,e,t,n,i){var s=typeof r;(s==="undefined"||s==="boolean")&&(r=null);var o=!1;if(r===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(r.$$typeof){case ef:case tq:o=!0}}if(o)return o=r,i=i(o),r=n===""?"."+W4(o,0):n,jA(i)?(t="",r!=null&&(t=r.replace(GA,"$&/")+"/"),w0(i,e,t,"",function(l){return l})):i!=null&&(q4(i)&&(i=hq(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(GA,"$&/")+"/")+r)),e.push(i)),1;if(o=0,n=n===""?".":n+":",jA(r))for(var a=0;a<r.length;a++){s=r[a];var c=n+W4(s,a);o+=w0(s,e,t,c,i)}else if(c=dq(r),typeof c=="function")for(r=c.call(r),a=0;!(s=r.next()).done;)s=s.value,c=n+W4(s,a++),o+=w0(s,e,t,c,i);else if(s==="object")throw e=String(r),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function b0(r,e,t){if(r==null)return r;var n=[],i=0;return w0(r,n,"","",function(s){return e.call(t,s,i++)}),n}function pq(r){if(r._status===-1){var e=r._result;e=e(),e.then(function(t){(r._status===0||r._status===-1)&&(r._status=1,r._result=t)},function(t){(r._status===0||r._status===-1)&&(r._status=2,r._result=t)}),r._status===-1&&(r._status=0,r._result=e)}if(r._status===1)return r._result.default;throw r._result}var sn={current:null},v0={transition:null},gq={ReactCurrentDispatcher:sn,ReactCurrentBatchConfig:v0,ReactCurrentOwner:H4};function QA(){throw Error("act(...) is not supported in production builds of React.")}je.Children={map:b0,forEach:function(r,e,t){b0(r,function(){e.apply(this,arguments)},t)},count:function(r){var e=0;return b0(r,function(){e++}),e},toArray:function(r){return b0(r,function(e){return e})||[]},only:function(r){if(!q4(r))throw Error("React.Children.only expected to receive a single React element child.");return r}},je.Component=Tu,je.Fragment=rq,je.Profiler=iq,je.PureComponent=K4,je.StrictMode=nq,je.Suspense=cq,je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=gq,je.act=QA,je.cloneElement=function(r,e,t){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var n=zA({},r.props),i=r.key,s=r.ref,o=r._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=H4.current),e.key!==void 0&&(i=""+e.key),r.type&&r.type.defaultProps)var a=r.type.defaultProps;for(c in e)HA.call(e,c)&&!qA.hasOwnProperty(c)&&(n[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)n.children=t;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];n.children=a}return{$$typeof:ef,type:r.type,key:i,ref:s,props:n,_owner:o}},je.createContext=function(r){return r={$$typeof:oq,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:sq,_context:r},r.Consumer=r},je.createElement=WA,je.createFactory=function(r){var e=WA.bind(null,r);return e.type=r,e},je.createRef=function(){return{current:null}},je.forwardRef=function(r){return{$$typeof:aq,render:r}},je.isValidElement=q4,je.lazy=function(r){return{$$typeof:uq,_payload:{_status:-1,_result:r},_init:pq}},je.memo=function(r,e){return{$$typeof:lq,type:r,compare:e===void 0?null:e}},je.startTransition=function(r){var e=v0.transition;v0.transition={};try{r()}finally{v0.transition=e}},je.unstable_act=QA,je.useCallback=function(r,e){return sn.current.useCallback(r,e)},je.useContext=function(r){return sn.current.useContext(r)},je.useDebugValue=function(){},je.useDeferredValue=function(r){return sn.current.useDeferredValue(r)},je.useEffect=function(r,e){return sn.current.useEffect(r,e)},je.useId=function(){return sn.current.useId()},je.useImperativeHandle=function(r,e,t){return sn.current.useImperativeHandle(r,e,t)},je.useInsertionEffect=function(r,e){return sn.current.useInsertionEffect(r,e)},je.useLayoutEffect=function(r,e){return sn.current.useLayoutEffect(r,e)},je.useMemo=function(r,e){return sn.current.useMemo(r,e)},je.useReducer=function(r,e,t){return sn.current.useReducer(r,e,t)},je.useRef=function(r){return sn.current.useRef(r)},je.useState=function(r){return sn.current.useState(r)},je.useSyncExternalStore=function(r,e,t){return sn.current.useSyncExternalStore(r,e,t)},je.useTransition=function(){return sn.current.useTransition()},je.version="18.3.1",m0.exports=je;var We=m0.exports;/**
* @license React
* react-jsx-runtime.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var yq=We,mq=Symbol.for("react.element"),wq=Symbol.for("react.fragment"),bq=Object.prototype.hasOwnProperty,vq=yq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Eq={key:!0,ref:!0,__self:!0,__source:!0};function YA(r,e,t){var n,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)bq.call(e,n)&&!Eq.hasOwnProperty(n)&&(i[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)i[n]===void 0&&(i[n]=e[n]);return{$$typeof:mq,type:r,key:s,ref:o,props:i,_owner:vq.current}}io.Fragment=wq,io.jsx=YA,io.jsxs=YA,jt.exports=io;var Ae=jt.exports,JA={exports:{}},Kn={},XA={exports:{}},ZA={};/**
* @license React
* scheduler.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/(function(r){function e(O,U){var W=O.length;O.push(U);e:for(;0<W;){var Y=W-1>>>1,H=O[Y];if(0<i(H,U))O[Y]=U,O[W]=H,W=Y;else break e}}function t(O){return O.length===0?null:O[0]}function n(O){if(O.length===0)return null;var U=O[0],W=O.pop();if(W!==U){O[0]=W;e:for(var Y=0,H=O.length,ie=H>>>1;Y<ie;){var me=2*(Y+1)-1,de=O[me],le=me+1,Ne=O[le];if(0>i(de,W))le<H&&0>i(Ne,de)?(O[Y]=Ne,O[le]=W,Y=le):(O[Y]=de,O[me]=W,Y=me);else if(le<H&&0>i(Ne,W))O[Y]=Ne,O[le]=W,Y=le;else break e}}return U}function i(O,U){var W=O.sortIndex-U.sortIndex;return W!==0?W:O.id-U.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();r.unstable_now=function(){return o.now()-a}}var c=[],l=[],d=1,h=null,p=3,m=!1,f=!1,g=!1,v=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(O){for(var U=t(l);U!==null;){if(U.callback===null)n(l);else if(U.startTime<=O)n(l),U.sortIndex=U.expirationTime,e(c,U);else break;U=t(l)}}function E(O){if(g=!1,b(O),!f)if(t(c)!==null)f=!0,Q(A);else{var U=t(l);U!==null&&K(E,U.startTime-O)}}function A(O,U){f=!1,g&&(g=!1,y(I),I=-1),m=!0;var W=p;try{for(b(U),h=t(c);h!==null&&(!(h.expirationTime>U)||O&&!z());){var Y=h.callback;if(typeof Y=="function"){h.callback=null,p=h.priorityLevel;var H=Y(h.expirationTime<=U);U=r.unstable_now(),typeof H=="function"?h.callback=H:h===t(c)&&n(c),b(U)}else n(c);h=t(c)}if(h!==null)var ie=!0;else{var me=t(l);me!==null&&K(E,me.startTime-U),ie=!1}return ie}finally{h=null,p=W,m=!1}}var k=!1,x=null,I=-1,T=5,L=-1;function z(){return!(r.unstable_now()-L<T)}function B(){if(x!==null){var O=r.unstable_now();L=O;var U=!0;try{U=x(!0,O)}finally{U?G():(k=!1,x=null)}}else k=!1}var G;if(typeof w=="function")G=function(){w(B)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,q=j.port2;j.port1.onmessage=B,G=function(){q.postMessage(null)}}else G=function(){v(B,0)};function Q(O){x=O,k||(k=!0,G())}function K(O,U){I=v(function(){O(r.unstable_now())},U)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(O){O.callback=null},r.unstable_continueExecution=function(){f||m||(f=!0,Q(A))},r.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<O?Math.floor(1e3/O):5},r.unstable_getCurrentPriorityLevel=function(){return p},r.unstable_getFirstCallbackNode=function(){return t(c)},r.unstable_next=function(O){switch(p){case 1:case 2:case 3:var U=3;break;default:U=p}var W=p;p=U;try{return O()}finally{p=W}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(O,U){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var W=p;p=O;try{return U()}finally{p=W}},r.unstable_scheduleCallback=function(O,U,W){var Y=r.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?Y+W:Y):W=Y,O){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=W+H,O={id:d++,callback:U,priorityLevel:O,startTime:W,expirationTime:H,sortIndex:-1},W>Y?(O.sortIndex=W,e(l,O),t(c)===null&&O===t(l)&&(g?(y(I),I=-1):g=!0,K(E,W-Y))):(O.sortIndex=H,e(c,O),f||m||(f=!0,Q(A))),O},r.unstable_shouldYield=z,r.unstable_wrapCallback=function(O){var U=p;return function(){var W=p;p=U;try{return O.apply(this,arguments)}finally{p=W}}}})(ZA),XA.exports=ZA;var Sq=XA.exports;/**
* @license React
* react-dom.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var xq=We,jn=Sq;function ee(r){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+r,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+r+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var eC=new Set,tf={};function Gc(r,e){Pu(r,e),Pu(r+"Capture",e)}function Pu(r,e){for(tf[r]=e,r=0;r<e.length;r++)eC.add(e[r])}var so=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),G4=Object.prototype.hasOwnProperty,Aq=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,tC={},rC={};function Cq(r){return G4.call(rC,r)?!0:G4.call(tC,r)?!1:Aq.test(r)?rC[r]=!0:(tC[r]=!0,!1)}function Iq(r,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function kq(r,e,t,n){if(e===null||typeof e>"u"||Iq(r,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function on(r,e,t,n,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=r,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var mr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){mr[r]=new on(r,0,!1,r,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var e=r[0];mr[e]=new on(e,1,!1,r[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(r){mr[r]=new on(r,2,!1,r.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){mr[r]=new on(r,2,!1,r,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){mr[r]=new on(r,3,!1,r.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(r){mr[r]=new on(r,3,!0,r,null,!1,!1)}),["capture","download"].forEach(function(r){mr[r]=new on(r,4,!1,r,null,!1,!1)}),["cols","rows","size","span"].forEach(function(r){mr[r]=new on(r,6,!1,r,null,!1,!1)}),["rowSpan","start"].forEach(function(r){mr[r]=new on(r,5,!1,r.toLowerCase(),null,!1,!1)});var Q4=/[\-:]([a-z])/g;function Y4(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var e=r.replace(Q4,Y4);mr[e]=new on(e,1,!1,r,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var e=r.replace(Q4,Y4);mr[e]=new on(e,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(r){var e=r.replace(Q4,Y4);mr[e]=new on(e,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(r){mr[r]=new on(r,1,!1,r.toLowerCase(),null,!1,!1)}),mr.xlinkHref=new on("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(r){mr[r]=new on(r,1,!1,r.toLowerCase(),null,!0,!0)});function J4(r,e,t,n){var i=mr.hasOwnProperty(e)?mr[e]:null;(i!==null?i.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(kq(e,t,i,n)&&(t=null),n||i===null?Cq(e)&&(t===null?r.removeAttribute(e):r.setAttribute(e,""+t)):i.mustUseProperty?r[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,n=i.attributeNamespace,t===null?r.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,n?r.setAttributeNS(n,e,t):r.setAttribute(e,t))))}var oo=xq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,E0=Symbol.for("react.element"),Du=Symbol.for("react.portal"),$u=Symbol.for("react.fragment"),X4=Symbol.for("react.strict_mode"),Z4=Symbol.for("react.profiler"),nC=Symbol.for("react.provider"),iC=Symbol.for("react.context"),e5=Symbol.for("react.forward_ref"),t5=Symbol.for("react.suspense"),r5=Symbol.for("react.suspense_list"),n5=Symbol.for("react.memo"),pa=Symbol.for("react.lazy"),sC=Symbol.for("react.offscreen"),oC=Symbol.iterator;function rf(r){return r===null||typeof r!="object"?null:(r=oC&&r[oC]||r["@@iterator"],typeof r=="function"?r:null)}var Lt=Object.assign,i5;function nf(r){if(i5===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);i5=e&&e[1]||""}return`
`+i5+r}var s5=!1;function o5(r,e){if(!r||s5)return"";s5=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var n=l}Reflect.construct(r,[],e)}else{try{e.call()}catch(l){n=l}r.call(e.prototype)}else{try{throw Error()}catch(l){n=l}r()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),s=n.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var c=`
`+i[o].replace(" at new "," at ");return r.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",r.displayName)),c}while(1<=o&&0<=a);break}}}finally{s5=!1,Error.prepareStackTrace=t}return(r=r?r.displayName||r.name:"")?nf(r):""}function _q(r){switch(r.tag){case 5:return nf(r.type);case 16:return nf("Lazy");case 13:return nf("Suspense");case 19:return nf("SuspenseList");case 0:case 2:case 15:return r=o5(r.type,!1),r;case 11:return r=o5(r.type.render,!1),r;case 1:return r=o5(r.type,!0),r;default:return""}}function a5(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case $u:return"Fragment";case Du:return"Portal";case Z4:return"Profiler";case X4:return"StrictMode";case t5:return"Suspense";case r5:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case iC:return(r.displayName||"Context")+".Consumer";case nC:return(r._context.displayName||"Context")+".Provider";case e5:var e=r.render;return r=r.displayName,r||(r=e.displayName||e.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case n5:return e=r.displayName||null,e!==null?e:a5(r.type)||"Memo";case pa:e=r._payload,r=r._init;try{return a5(r(e))}catch{}}return null}function Tq(r){var e=r.type;switch(r.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=e.render,r=r.displayName||r.name||"",e.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return a5(e);case 8:return e===X4?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ga(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function aC(r){var e=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Pq(r){var e=aC(r)?"checked":"value",t=Object.getOwnPropertyDescriptor(r.constructor.prototype,e),n=""+r[e];if(!r.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(r,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){n=""+o,s.call(this,o)}}),Object.defineProperty(r,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){r._valueTracker=null,delete r[e]}}}}function S0(r){r._valueTracker||(r._valueTracker=Pq(r))}function cC(r){if(!r)return!1;var e=r._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return r&&(n=aC(r)?r.checked?"true":"false":r.value),r=n,r!==t?(e.setValue(r),!0):!1}function x0(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function c5(r,e){var t=e.checked;return Lt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??r._wrapperState.initialChecked})}function lC(r,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=ga(e.value!=null?e.value:t),r._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function uC(r,e){e=e.checked,e!=null&&J4(r,"checked",e,!1)}function l5(r,e){uC(r,e);var t=ga(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&r.value===""||r.value!=t)&&(r.value=""+t):r.value!==""+t&&(r.value=""+t);else if(n==="submit"||n==="reset"){r.removeAttribute("value");return}e.hasOwnProperty("value")?u5(r,e.type,t):e.hasOwnProperty("defaultValue")&&u5(r,e.type,ga(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(r.defaultChecked=!!e.defaultChecked)}function dC(r,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+r._wrapperState.initialValue,t||e===r.value||(r.value=e),r.defaultValue=e}t=r.name,t!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,t!==""&&(r.name=t)}function u5(r,e,t){(e!=="number"||x0(r.ownerDocument)!==r)&&(t==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+t&&(r.defaultValue=""+t))}var sf=Array.isArray;function Nu(r,e,t,n){if(r=r.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<r.length;t++)i=e.hasOwnProperty("$"+r[t].value),r[t].selected!==i&&(r[t].selected=i),i&&n&&(r[t].defaultSelected=!0)}else{for(t=""+ga(t),e=null,i=0;i<r.length;i++){if(r[i].value===t){r[i].selected=!0,n&&(r[i].defaultSelected=!0);return}e!==null||r[i].disabled||(e=r[i])}e!==null&&(e.selected=!0)}}function d5(r,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ee(91));return Lt({},e,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function hC(r,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(ee(92));if(sf(t)){if(1<t.length)throw Error(ee(93));t=t[0]}e=t}e==null&&(e=""),t=e}r._wrapperState={initialValue:ga(t)}}function fC(r,e){var t=ga(e.value),n=ga(e.defaultValue);t!=null&&(t=""+t,t!==r.value&&(r.value=t),e.defaultValue==null&&r.defaultValue!==t&&(r.defaultValue=t)),n!=null&&(r.defaultValue=""+n)}function pC(r){var e=r.textContent;e===r._wrapperState.initialValue&&e!==""&&e!==null&&(r.value=e)}function gC(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function h5(r,e){return r==null||r==="http://www.w3.org/1999/xhtml"?gC(e):r==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var A0,yC=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return r(e,t,n,i)})}:r}(function(r,e){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=e;else{for(A0=A0||document.createElement("div"),A0.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=A0.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;e.firstChild;)r.appendChild(e.firstChild)}});function of(r,e){if(e){var t=r.firstChild;if(t&&t===r.lastChild&&t.nodeType===3){t.nodeValue=e;return}}r.textContent=e}var af={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Dq=["Webkit","ms","Moz","O"];Object.keys(af).forEach(function(r){Dq.forEach(function(e){e=e+r.charAt(0).toUpperCase()+r.substring(1),af[e]=af[r]})});function mC(r,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||af.hasOwnProperty(r)&&af[r]?(""+e).trim():e+"px"}function wC(r,e){r=r.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,i=mC(t,e[t],n);t==="float"&&(t="cssFloat"),n?r.setProperty(t,i):r[t]=i}}var $q=Lt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function f5(r,e){if(e){if($q[r]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ee(137,r));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ee(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ee(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ee(62))}}function p5(r,e){if(r.indexOf("-")===-1)return typeof e.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var g5=null;function y5(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var m5=null,Mu=null,Ou=null;function bC(r){if(r=Tf(r)){if(typeof m5!="function")throw Error(ee(280));var e=r.stateNode;e&&(e=W0(e),m5(r.stateNode,r.type,e))}}function vC(r){Mu?Ou?Ou.push(r):Ou=[r]:Mu=r}function EC(){if(Mu){var r=Mu,e=Ou;if(Ou=Mu=null,bC(r),e)for(r=0;r<e.length;r++)bC(e[r])}}function SC(r,e){return r(e)}function xC(){}var w5=!1;function AC(r,e,t){if(w5)return r(e,t);w5=!0;try{return SC(r,e,t)}finally{w5=!1,(Mu!==null||Ou!==null)&&(xC(),EC())}}function cf(r,e){var t=r.stateNode;if(t===null)return null;var n=W0(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(r=r.type,n=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!n;break e;default:r=!1}if(r)return null;if(t&&typeof t!="function")throw Error(ee(231,e,typeof t));return t}var b5=!1;if(so)try{var lf={};Object.defineProperty(lf,"passive",{get:function(){b5=!0}}),window.addEventListener("test",lf,lf),window.removeEventListener("test",lf,lf)}catch{b5=!1}function Nq(r,e,t,n,i,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(d){this.onError(d)}}var uf=!1,C0=null,I0=!1,v5=null,Mq={onError:function(r){uf=!0,C0=r}};function Oq(r,e,t,n,i,s,o,a,c){uf=!1,C0=null,Nq.apply(Mq,arguments)}function Rq(r,e,t,n,i,s,o,a,c){if(Oq.apply(this,arguments),uf){if(uf){var l=C0;uf=!1,C0=null}else throw Error(ee(198));I0||(I0=!0,v5=l)}}function Qc(r){var e=r,t=r;if(r.alternate)for(;e.return;)e=e.return;else{r=e;do e=r,e.flags&4098&&(t=e.return),r=e.return;while(r)}return e.tag===3?t:null}function CC(r){if(r.tag===13){var e=r.memoizedState;if(e===null&&(r=r.alternate,r!==null&&(e=r.memoizedState)),e!==null)return e.dehydrated}return null}function IC(r){if(Qc(r)!==r)throw Error(ee(188))}function Lq(r){var e=r.alternate;if(!e){if(e=Qc(r),e===null)throw Error(ee(188));return e!==r?null:r}for(var t=r,n=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(n=i.return,n!==null){t=n;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return IC(i),r;if(s===n)return IC(i),e;s=s.sibling}throw Error(ee(188))}if(t.return!==n.return)t=i,n=s;else{for(var o=!1,a=i.child;a;){if(a===t){o=!0,t=i,n=s;break}if(a===n){o=!0,n=i,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,n=i;break}if(a===n){o=!0,n=s,t=i;break}a=a.sibling}if(!o)throw Error(ee(189))}}if(t.alternate!==n)throw Error(ee(190))}if(t.tag!==3)throw Error(ee(188));return t.stateNode.current===t?r:e}function kC(r){return r=Lq(r),r!==null?_C(r):null}function _C(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var e=_C(r);if(e!==null)return e;r=r.sibling}return null}var TC=jn.unstable_scheduleCallback,PC=jn.unstable_cancelCallback,Bq=jn.unstable_shouldYield,Uq=jn.unstable_requestPaint,Gt=jn.unstable_now,Fq=jn.unstable_getCurrentPriorityLevel,E5=jn.unstable_ImmediatePriority,DC=jn.unstable_UserBlockingPriority,k0=jn.unstable_NormalPriority,zq=jn.unstable_LowPriority,$C=jn.unstable_IdlePriority,_0=null,Es=null;function Vq(r){if(Es&&typeof Es.onCommitFiberRoot=="function")try{Es.onCommitFiberRoot(_0,r,void 0,(r.current.flags&128)===128)}catch{}}var Ki=Math.clz32?Math.clz32:Hq,Kq=Math.log,jq=Math.LN2;function Hq(r){return r>>>=0,r===0?32:31-(Kq(r)/jq|0)|0}var T0=64,P0=4194304;function df(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function D0(r,e){var t=r.pendingLanes;if(t===0)return 0;var n=0,i=r.suspendedLanes,s=r.pingedLanes,o=t&268435455;if(o!==0){var a=o&~i;a!==0?n=df(a):(s&=o,s!==0&&(n=df(s)))}else o=t&~i,o!==0?n=df(o):s!==0&&(n=df(s));if(n===0)return 0;if(e!==0&&e!==n&&!(e&i)&&(i=n&-n,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(n&4&&(n|=t&16),e=r.entangledLanes,e!==0)for(r=r.entanglements,e&=n;0<e;)t=31-Ki(e),i=1<<t,n|=r[t],e&=~i;return n}function qq(r,e){switch(r){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Wq(r,e){for(var t=r.suspendedLanes,n=r.pingedLanes,i=r.expirationTimes,s=r.pendingLanes;0<s;){var o=31-Ki(s),a=1<<o,c=i[o];c===-1?(!(a&t)||a&n)&&(i[o]=qq(a,e)):c<=e&&(r.expiredLanes|=a),s&=~a}}function S5(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function NC(){var r=T0;return T0<<=1,!(T0&4194240)&&(T0=64),r}function x5(r){for(var e=[],t=0;31>t;t++)e.push(r);return e}function hf(r,e,t){r.pendingLanes|=e,e!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,e=31-Ki(e),r[e]=t}function Gq(r,e){var t=r.pendingLanes&~e;r.pendingLanes=e,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=e,r.mutableReadLanes&=e,r.entangledLanes&=e,e=r.entanglements;var n=r.eventTimes;for(r=r.expirationTimes;0<t;){var i=31-Ki(t),s=1<<i;e[i]=0,n[i]=-1,r[i]=-1,t&=~s}}function A5(r,e){var t=r.entangledLanes|=e;for(r=r.entanglements;t;){var n=31-Ki(t),i=1<<n;i&e|r[n]&e&&(r[n]|=e),t&=~i}}var ft=0;function MC(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var OC,C5,RC,LC,BC,I5=!1,$0=[],ya=null,ma=null,wa=null,ff=new Map,pf=new Map,ba=[],Qq="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function UC(r,e){switch(r){case"focusin":case"focusout":ya=null;break;case"dragenter":case"dragleave":ma=null;break;case"mouseover":case"mouseout":wa=null;break;case"pointerover":case"pointerout":ff.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":pf.delete(e.pointerId)}}function gf(r,e,t,n,i,s){return r===null||r.nativeEvent!==s?(r={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Tf(e),e!==null&&C5(e)),r):(r.eventSystemFlags|=n,e=r.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),r)}function Yq(r,e,t,n,i){switch(e){case"focusin":return ya=gf(ya,r,e,t,n,i),!0;case"dragenter":return ma=gf(ma,r,e,t,n,i),!0;case"mouseover":return wa=gf(wa,r,e,t,n,i),!0;case"pointerover":var s=i.pointerId;return ff.set(s,gf(ff.get(s)||null,r,e,t,n,i)),!0;case"gotpointercapture":return s=i.pointerId,pf.set(s,gf(pf.get(s)||null,r,e,t,n,i)),!0}return!1}function FC(r){var e=Yc(r.target);if(e!==null){var t=Qc(e);if(t!==null){if(e=t.tag,e===13){if(e=CC(t),e!==null){r.blockedOn=e,BC(r.priority,function(){RC(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){r.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}r.blockedOn=null}function N0(r){if(r.blockedOn!==null)return!1;for(var e=r.targetContainers;0<e.length;){var t=_5(r.domEventName,r.eventSystemFlags,e[0],r.nativeEvent);if(t===null){t=r.nativeEvent;var n=new t.constructor(t.type,t);g5=n,t.target.dispatchEvent(n),g5=null}else return e=Tf(t),e!==null&&C5(e),r.blockedOn=t,!1;e.shift()}return!0}function zC(r,e,t){N0(r)&&t.delete(e)}function Jq(){I5=!1,ya!==null&&N0(ya)&&(ya=null),ma!==null&&N0(ma)&&(ma=null),wa!==null&&N0(wa)&&(wa=null),ff.forEach(zC),pf.forEach(zC)}function yf(r,e){r.blockedOn===e&&(r.blockedOn=null,I5||(I5=!0,jn.unstable_scheduleCallback(jn.unstable_NormalPriority,Jq)))}function mf(r){function e(i){return yf(i,r)}if(0<$0.length){yf($0[0],r);for(var t=1;t<$0.length;t++){var n=$0[t];n.blockedOn===r&&(n.blockedOn=null)}}for(ya!==null&&yf(ya,r),ma!==null&&yf(ma,r),wa!==null&&yf(wa,r),ff.forEach(e),pf.forEach(e),t=0;t<ba.length;t++)n=ba[t],n.blockedOn===r&&(n.blockedOn=null);for(;0<ba.length&&(t=ba[0],t.blockedOn===null);)FC(t),t.blockedOn===null&&ba.shift()}var Ru=oo.ReactCurrentBatchConfig,M0=!0;function Xq(r,e,t,n){var i=ft,s=Ru.transition;Ru.transition=null;try{ft=1,k5(r,e,t,n)}finally{ft=i,Ru.transition=s}}function Zq(r,e,t,n){var i=ft,s=Ru.transition;Ru.transition=null;try{ft=4,k5(r,e,t,n)}finally{ft=i,Ru.transition=s}}function k5(r,e,t,n){if(M0){var i=_5(r,e,t,n);if(i===null)H5(r,e,n,O0,t),UC(r,n);else if(Yq(i,r,e,t,n))n.stopPropagation();else if(UC(r,n),e&4&&-1<Qq.indexOf(r)){for(;i!==null;){var s=Tf(i);if(s!==null&&OC(s),s=_5(r,e,t,n),s===null&&H5(r,e,n,O0,t),s===i)break;i=s}i!==null&&n.stopPropagation()}else H5(r,e,n,null,t)}}var O0=null;function _5(r,e,t,n){if(O0=null,r=y5(n),r=Yc(r),r!==null)if(e=Qc(r),e===null)r=null;else if(t=e.tag,t===13){if(r=CC(e),r!==null)return r;r=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;r=null}else e!==r&&(r=null);return O0=r,null}function VC(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Fq()){case E5:return 1;case DC:return 4;case k0:case zq:return 16;case $C:return 536870912;default:return 16}default:return 16}}var va=null,T5=null,R0=null;function KC(){if(R0)return R0;var r,e=T5,t=e.length,n,i="value"in va?va.value:va.textContent,s=i.length;for(r=0;r<t&&e[r]===i[r];r++);var o=t-r;for(n=1;n<=o&&e[t-n]===i[s-n];n++);return R0=i.slice(r,1<n?1-n:void 0)}function L0(r){var e=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&e===13&&(r=13)):r=e,r===10&&(r=13),32<=r||r===13?r:0}function B0(){return!0}function jC(){return!1}function Hn(r){function e(t,n,i,s,o){this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in r)r.hasOwnProperty(a)&&(t=r[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?B0:jC,this.isPropagationStopped=jC,this}return Lt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=B0)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=B0)},persist:function(){},isPersistent:B0}),e}var Lu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},P5=Hn(Lu),wf=Lt({},Lu,{view:0,detail:0}),eW=Hn(wf),D5,$5,bf,U0=Lt({},wf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:M5,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==bf&&(bf&&r.type==="mousemove"?(D5=r.screenX-bf.screenX,$5=r.screenY-bf.screenY):$5=D5=0,bf=r),D5)},movementY:function(r){return"movementY"in r?r.movementY:$5}}),HC=Hn(U0),tW=Lt({},U0,{dataTransfer:0}),rW=Hn(tW),nW=Lt({},wf,{relatedTarget:0}),N5=Hn(nW),iW=Lt({},Lu,{animationName:0,elapsedTime:0,pseudoElement:0}),sW=Hn(iW),oW=Lt({},Lu,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),aW=Hn(oW),cW=Lt({},Lu,{data:0}),qC=Hn(cW),lW={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},uW={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dW={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function hW(r){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(r):(r=dW[r])?!!e[r]:!1}function M5(){return hW}var fW=Lt({},wf,{key:function(r){if(r.key){var e=lW[r.key]||r.key;if(e!=="Unidentified")return e}return r.type==="keypress"?(r=L0(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?uW[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:M5,charCode:function(r){return r.type==="keypress"?L0(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?L0(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),pW=Hn(fW),gW=Lt({},U0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),WC=Hn(gW),yW=Lt({},wf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:M5}),mW=Hn(yW),wW=Lt({},Lu,{propertyName:0,elapsedTime:0,pseudoElement:0}),bW=Hn(wW),vW=Lt({},U0,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),EW=Hn(vW),SW=[9,13,27,32],O5=so&&"CompositionEvent"in window,vf=null;so&&"documentMode"in document&&(vf=document.documentMode);var xW=so&&"TextEvent"in window&&!vf,GC=so&&(!O5||vf&&8<vf&&11>=vf),QC=" ",YC=!1;function JC(r,e){switch(r){case"keyup":return SW.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function XC(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Bu=!1;function AW(r,e){switch(r){case"compositionend":return XC(e);case"keypress":return e.which!==32?null:(YC=!0,QC);case"textInput":return r=e.data,r===QC&&YC?null:r;default:return null}}function CW(r,e){if(Bu)return r==="compositionend"||!O5&&JC(r,e)?(r=KC(),R0=T5=va=null,Bu=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return GC&&e.locale!=="ko"?null:e.data;default:return null}}var IW={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ZC(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e==="input"?!!IW[r.type]:e==="textarea"}function eI(r,e,t,n){vC(n),e=j0(e,"onChange"),0<e.length&&(t=new P5("onChange","change",null,t,n),r.push({event:t,listeners:e}))}var Ef=null,Sf=null;function kW(r){wI(r,0)}function F0(r){var e=Ku(r);if(cC(e))return r}function _W(r,e){if(r==="change")return e}var tI=!1;if(so){var R5;if(so){var L5="oninput"in document;if(!L5){var rI=document.createElement("div");rI.setAttribute("oninput","return;"),L5=typeof rI.oninput=="function"}R5=L5}else R5=!1;tI=R5&&(!document.documentMode||9<document.documentMode)}function nI(){Ef&&(Ef.detachEvent("onpropertychange",iI),Sf=Ef=null)}function iI(r){if(r.propertyName==="value"&&F0(Sf)){var e=[];eI(e,Sf,r,y5(r)),AC(kW,e)}}function TW(r,e,t){r==="focusin"?(nI(),Ef=e,Sf=t,Ef.attachEvent("onpropertychange",iI)):r==="focusout"&&nI()}function PW(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return F0(Sf)}function DW(r,e){if(r==="click")return F0(e)}function $W(r,e){if(r==="input"||r==="change")return F0(e)}function NW(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var ji=typeof Object.is=="function"?Object.is:NW;function xf(r,e){if(ji(r,e))return!0;if(typeof r!="object"||r===null||typeof e!="object"||e===null)return!1;var t=Object.keys(r),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var i=t[n];if(!G4.call(e,i)||!ji(r[i],e[i]))return!1}return!0}function sI(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function oI(r,e){var t=sI(r);r=0;for(var n;t;){if(t.nodeType===3){if(n=r+t.textContent.length,r<=e&&n>=e)return{node:t,offset:e-r};r=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=sI(t)}}function aI(r,e){return r&&e?r===e?!0:r&&r.nodeType===3?!1:e&&e.nodeType===3?aI(r,e.parentNode):"contains"in r?r.contains(e):r.compareDocumentPosition?!!(r.compareDocumentPosition(e)&16):!1:!1}function cI(){for(var r=window,e=x0();e instanceof r.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)r=e.contentWindow;else break;e=x0(r.document)}return e}function B5(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e&&(e==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||e==="textarea"||r.contentEditable==="true")}function MW(r){var e=cI(),t=r.focusedElem,n=r.selectionRange;if(e!==t&&t&&t.ownerDocument&&aI(t.ownerDocument.documentElement,t)){if(n!==null&&B5(t)){if(e=n.start,r=n.end,r===void 0&&(r=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(r,t.value.length);else if(r=(e=t.ownerDocument||document)&&e.defaultView||window,r.getSelection){r=r.getSelection();var i=t.textContent.length,s=Math.min(n.start,i);n=n.end===void 0?s:Math.min(n.end,i),!r.extend&&s>n&&(i=n,n=s,s=i),i=oI(t,s);var o=oI(t,n);i&&o&&(r.rangeCount!==1||r.anchorNode!==i.node||r.anchorOffset!==i.offset||r.focusNode!==o.node||r.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),r.removeAllRanges(),s>n?(r.addRange(e),r.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),r.addRange(e)))}}for(e=[],r=t;r=r.parentNode;)r.nodeType===1&&e.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)r=e[t],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var OW=so&&"documentMode"in document&&11>=document.documentMode,Uu=null,U5=null,Af=null,F5=!1;function lI(r,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;F5||Uu==null||Uu!==x0(n)||(n=Uu,"selectionStart"in n&&B5(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Af&&xf(Af,n)||(Af=n,n=j0(U5,"onSelect"),0<n.length&&(e=new P5("onSelect","select",null,e,t),r.push({event:e,listeners:n}),e.target=Uu)))}function z0(r,e){var t={};return t[r.toLowerCase()]=e.toLowerCase(),t["Webkit"+r]="webkit"+e,t["Moz"+r]="moz"+e,t}var Fu={animationend:z0("Animation","AnimationEnd"),animationiteration:z0("Animation","AnimationIteration"),animationstart:z0("Animation","AnimationStart"),transitionend:z0("Transition","TransitionEnd")},z5={},uI={};so&&(uI=document.createElement("div").style,"AnimationEvent"in window||(delete Fu.animationend.animation,delete Fu.animationiteration.animation,delete Fu.animationstart.animation),"TransitionEvent"in window||delete Fu.transitionend.transition);function V0(r){if(z5[r])return z5[r];if(!Fu[r])return r;var e=Fu[r],t;for(t in e)if(e.hasOwnProperty(t)&&t in uI)return z5[r]=e[t];return r}var dI=V0("animationend"),hI=V0("animationiteration"),fI=V0("animationstart"),pI=V0("transitionend"),gI=new Map,yI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ea(r,e){gI.set(r,e),Gc(e,[r])}for(var V5=0;V5<yI.length;V5++){var K5=yI[V5],RW=K5.toLowerCase(),LW=K5[0].toUpperCase()+K5.slice(1);Ea(RW,"on"+LW)}Ea(dI,"onAnimationEnd"),Ea(hI,"onAnimationIteration"),Ea(fI,"onAnimationStart"),Ea("dblclick","onDoubleClick"),Ea("focusin","onFocus"),Ea("focusout","onBlur"),Ea(pI,"onTransitionEnd"),Pu("onMouseEnter",["mouseout","mouseover"]),Pu("onMouseLeave",["mouseout","mouseover"]),Pu("onPointerEnter",["pointerout","pointerover"]),Pu("onPointerLeave",["pointerout","pointerover"]),Gc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Gc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Gc("onBeforeInput",["compositionend","keypress","textInput","paste"]),Gc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Gc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Gc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Cf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),BW=new Set("cancel close invalid load scroll toggle".split(" ").concat(Cf));function mI(r,e,t){var n=r.type||"unknown-event";r.currentTarget=t,Rq(n,e,void 0,r),r.currentTarget=null}function wI(r,e){e=(e&4)!==0;for(var t=0;t<r.length;t++){var n=r[t],i=n.event;n=n.listeners;e:{var s=void 0;if(e)for(var o=n.length-1;0<=o;o--){var a=n[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&i.isPropagationStopped())break e;mI(i,a,l),s=c}else for(o=0;o<n.length;o++){if(a=n[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&i.isPropagationStopped())break e;mI(i,a,l),s=c}}}if(I0)throw r=v5,I0=!1,v5=null,r}function Tt(r,e){var t=e[J5];t===void 0&&(t=e[J5]=new Set);var n=r+"__bubble";t.has(n)||(bI(e,r,2,!1),t.add(n))}function j5(r,e,t){var n=0;e&&(n|=4),bI(t,r,n,e)}var K0="_reactListening"+Math.random().toString(36).slice(2);function If(r){if(!r[K0]){r[K0]=!0,eC.forEach(function(t){t!=="selectionchange"&&(BW.has(t)||j5(t,!1,r),j5(t,!0,r))});var e=r.nodeType===9?r:r.ownerDocument;e===null||e[K0]||(e[K0]=!0,j5("selectionchange",!1,e))}}function bI(r,e,t,n){switch(VC(e)){case 1:var i=Xq;break;case 4:i=Zq;break;default:i=k5}t=i.bind(null,e,t,r),i=void 0,!b5||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),n?i!==void 0?r.addEventListener(e,t,{capture:!0,passive:i}):r.addEventListener(e,t,!0):i!==void 0?r.addEventListener(e,t,{passive:i}):r.addEventListener(e,t,!1)}function H5(r,e,t,n,i){var s=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var a=n.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=n.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Yc(a),o===null)return;if(c=o.tag,c===5||c===6){n=s=o;continue e}a=a.parentNode}}n=n.return}AC(function(){var l=s,d=y5(t),h=[];e:{var p=gI.get(r);if(p!==void 0){var m=P5,f=r;switch(r){case"keypress":if(L0(t)===0)break e;case"keydown":case"keyup":m=pW;break;case"focusin":f="focus",m=N5;break;case"focusout":f="blur",m=N5;break;case"beforeblur":case"afterblur":m=N5;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=HC;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=rW;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=mW;break;case dI:case hI:case fI:m=sW;break;case pI:m=bW;break;case"scroll":m=eW;break;case"wheel":m=EW;break;case"copy":case"cut":case"paste":m=aW;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=WC}var g=(e&4)!==0,v=!g&&r==="scroll",y=g?p!==null?p+"Capture":null:p;g=[];for(var w=l,b;w!==null;){b=w;var E=b.stateNode;if(b.tag===5&&E!==null&&(b=E,y!==null&&(E=cf(w,y),E!=null&&g.push(kf(w,E,b)))),v)break;w=w.return}0<g.length&&(p=new m(p,f,null,t,d),h.push({event:p,listeners:g}))}}if(!(e&7)){e:{if(p=r==="mouseover"||r==="pointerover",m=r==="mouseout"||r==="pointerout",p&&t!==g5&&(f=t.relatedTarget||t.fromElement)&&(Yc(f)||f[ao]))break e;if((m||p)&&(p=d.window===d?d:(p=d.ownerDocument)?p.defaultView||p.parentWindow:window,m?(f=t.relatedTarget||t.toElement,m=l,f=f?Yc(f):null,f!==null&&(v=Qc(f),f!==v||f.tag!==5&&f.tag!==6)&&(f=null)):(m=null,f=l),m!==f)){if(g=HC,E="onMouseLeave",y="onMouseEnter",w="mouse",(r==="pointerout"||r==="pointerover")&&(g=WC,E="onPointerLeave",y="onPointerEnter",w="pointer"),v=m==null?p:Ku(m),b=f==null?p:Ku(f),p=new g(E,w+"leave",m,t,d),p.target=v,p.relatedTarget=b,E=null,Yc(d)===l&&(g=new g(y,w+"enter",f,t,d),g.target=b,g.relatedTarget=v,E=g),v=E,m&&f)t:{for(g=m,y=f,w=0,b=g;b;b=zu(b))w++;for(b=0,E=y;E;E=zu(E))b++;for(;0<w-b;)g=zu(g),w--;for(;0<b-w;)y=zu(y),b--;for(;w--;){if(g===y||y!==null&&g===y.alternate)break t;g=zu(g),y=zu(y)}g=null}else g=null;m!==null&&vI(h,p,m,g,!1),f!==null&&v!==null&&vI(h,v,f,g,!0)}}e:{if(p=l?Ku(l):window,m=p.nodeName&&p.nodeName.toLowerCase(),m==="select"||m==="input"&&p.type==="file")var A=_W;else if(ZC(p))if(tI)A=$W;else{A=PW;var k=TW}else(m=p.nodeName)&&m.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(A=DW);if(A&&(A=A(r,l))){eI(h,A,t,d);break e}k&&k(r,p,l),r==="focusout"&&(k=p._wrapperState)&&k.controlled&&p.type==="number"&&u5(p,"number",p.value)}switch(k=l?Ku(l):window,r){case"focusin":(ZC(k)||k.contentEditable==="true")&&(Uu=k,U5=l,Af=null);break;case"focusout":Af=U5=Uu=null;break;case"mousedown":F5=!0;break;case"contextmenu":case"mouseup":case"dragend":F5=!1,lI(h,t,d);break;case"selectionchange":if(OW)break;case"keydown":case"keyup":lI(h,t,d)}var x;if(O5)e:{switch(r){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else Bu?JC(r,t)&&(I="onCompositionEnd"):r==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(GC&&t.locale!=="ko"&&(Bu||I!=="onCompositionStart"?I==="onCompositionEnd"&&Bu&&(x=KC()):(va=d,T5="value"in va?va.value:va.textContent,Bu=!0)),k=j0(l,I),0<k.length&&(I=new qC(I,r,null,t,d),h.push({event:I,listeners:k}),x?I.data=x:(x=XC(t),x!==null&&(I.data=x)))),(x=xW?AW(r,t):CW(r,t))&&(l=j0(l,"onBeforeInput"),0<l.length&&(d=new qC("onBeforeInput","beforeinput",null,t,d),h.push({event:d,listeners:l}),d.data=x))}wI(h,e)})}function kf(r,e,t){return{instance:r,listener:e,currentTarget:t}}function j0(r,e){for(var t=e+"Capture",n=[];r!==null;){var i=r,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=cf(r,t),s!=null&&n.unshift(kf(r,s,i)),s=cf(r,e),s!=null&&n.push(kf(r,s,i))),r=r.return}return n}function zu(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function vI(r,e,t,n,i){for(var s=e._reactName,o=[];t!==null&&t!==n;){var a=t,c=a.alternate,l=a.stateNode;if(c!==null&&c===n)break;a.tag===5&&l!==null&&(a=l,i?(c=cf(t,s),c!=null&&o.unshift(kf(t,c,a))):i||(c=cf(t,s),c!=null&&o.push(kf(t,c,a)))),t=t.return}o.length!==0&&r.push({event:e,listeners:o})}var UW=/\r\n?/g,FW=/\u0000|\uFFFD/g;function EI(r){return(typeof r=="string"?r:""+r).replace(UW,`
`).replace(FW,"")}function H0(r,e,t){if(e=EI(e),EI(r)!==e&&t)throw Error(ee(425))}function q0(){}var q5=null,W5=null;function G5(r,e){return r==="textarea"||r==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Q5=typeof setTimeout=="function"?setTimeout:void 0,zW=typeof clearTimeout=="function"?clearTimeout:void 0,SI=typeof Promise=="function"?Promise:void 0,VW=typeof queueMicrotask=="function"?queueMicrotask:typeof SI<"u"?function(r){return SI.resolve(null).then(r).catch(KW)}:Q5;function KW(r){setTimeout(function(){throw r})}function Y5(r,e){var t=e,n=0;do{var i=t.nextSibling;if(r.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(n===0){r.removeChild(i),mf(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=i}while(t);mf(e)}function Sa(r){for(;r!=null;r=r.nextSibling){var e=r.nodeType;if(e===1||e===3)break;if(e===8){if(e=r.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return r}function xI(r){r=r.previousSibling;for(var e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return r;e--}else t==="/$"&&e++}r=r.previousSibling}return null}var Vu=Math.random().toString(36).slice(2),Ss="__reactFiber$"+Vu,_f="__reactProps$"+Vu,ao="__reactContainer$"+Vu,J5="__reactEvents$"+Vu,jW="__reactListeners$"+Vu,HW="__reactHandles$"+Vu;function Yc(r){var e=r[Ss];if(e)return e;for(var t=r.parentNode;t;){if(e=t[ao]||t[Ss]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(r=xI(r);r!==null;){if(t=r[Ss])return t;r=xI(r)}return e}r=t,t=r.parentNode}return null}function Tf(r){return r=r[Ss]||r[ao],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Ku(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(ee(33))}function W0(r){return r[_f]||null}var X5=[],ju=-1;function xa(r){return{current:r}}function Pt(r){0>ju||(r.current=X5[ju],X5[ju]=null,ju--)}function vt(r,e){ju++,X5[ju]=r.current,r.current=e}var Aa={},Mr=xa(Aa),vn=xa(!1),Jc=Aa;function Hu(r,e){var t=r.type.contextTypes;if(!t)return Aa;var n=r.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=e,r.__reactInternalMemoizedMaskedChildContext=i),i}function En(r){return r=r.childContextTypes,r!=null}function G0(){Pt(vn),Pt(Mr)}function AI(r,e,t){if(Mr.current!==Aa)throw Error(ee(168));vt(Mr,e),vt(vn,t)}function CI(r,e,t){var n=r.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var i in n)if(!(i in e))throw Error(ee(108,Tq(r)||"Unknown",i));return Lt({},t,n)}function Q0(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Aa,Jc=Mr.current,vt(Mr,r),vt(vn,vn.current),!0}function II(r,e,t){var n=r.stateNode;if(!n)throw Error(ee(169));t?(r=CI(r,e,Jc),n.__reactInternalMemoizedMergedChildContext=r,Pt(vn),Pt(Mr),vt(Mr,r)):Pt(vn),vt(vn,t)}var co=null,Y0=!1,Z5=!1;function kI(r){co===null?co=[r]:co.push(r)}function qW(r){Y0=!0,kI(r)}function Ca(){if(!Z5&&co!==null){Z5=!0;var r=0,e=ft;try{var t=co;for(ft=1;r<t.length;r++){var n=t[r];do n=n(!0);while(n!==null)}co=null,Y0=!1}catch(i){throw co!==null&&(co=co.slice(r+1)),TC(E5,Ca),i}finally{ft=e,Z5=!1}}return null}var qu=[],Wu=0,J0=null,X0=0,gi=[],yi=0,Xc=null,lo=1,uo="";function Zc(r,e){qu[Wu++]=X0,qu[Wu++]=J0,J0=r,X0=e}function _I(r,e,t){gi[yi++]=lo,gi[yi++]=uo,gi[yi++]=Xc,Xc=r;var n=lo;r=uo;var i=32-Ki(n)-1;n&=~(1<<i),t+=1;var s=32-Ki(e)+i;if(30<s){var o=i-i%5;s=(n&(1<<o)-1).toString(32),n>>=o,i-=o,lo=1<<32-Ki(e)+i|t<<i|n,uo=s+r}else lo=1<<s|t<<i|n,uo=r}function e8(r){r.return!==null&&(Zc(r,1),_I(r,1,0))}function t8(r){for(;r===J0;)J0=qu[--Wu],qu[Wu]=null,X0=qu[--Wu],qu[Wu]=null;for(;r===Xc;)Xc=gi[--yi],gi[yi]=null,uo=gi[--yi],gi[yi]=null,lo=gi[--yi],gi[yi]=null}var qn=null,Wn=null,Mt=!1,Hi=null;function TI(r,e){var t=vi(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=r,e=r.deletions,e===null?(r.deletions=[t],r.flags|=16):e.push(t)}function PI(r,e){switch(r.tag){case 5:var t=r.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(r.stateNode=e,qn=r,Wn=Sa(e.firstChild),!0):!1;case 6:return e=r.pendingProps===""||e.nodeType!==3?null:e,e!==null?(r.stateNode=e,qn=r,Wn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Xc!==null?{id:lo,overflow:uo}:null,r.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=vi(18,null,null,0),t.stateNode=e,t.return=r,r.child=t,qn=r,Wn=null,!0):!1;default:return!1}}function r8(r){return(r.mode&1)!==0&&(r.flags&128)===0}function n8(r){if(Mt){var e=Wn;if(e){var t=e;if(!PI(r,e)){if(r8(r))throw Error(ee(418));e=Sa(t.nextSibling);var n=qn;e&&PI(r,e)?TI(n,t):(r.flags=r.flags&-4097|2,Mt=!1,qn=r)}}else{if(r8(r))throw Error(ee(418));r.flags=r.flags&-4097|2,Mt=!1,qn=r}}}function DI(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;qn=r}function Z0(r){if(r!==qn)return!1;if(!Mt)return DI(r),Mt=!0,!1;var e;if((e=r.tag!==3)&&!(e=r.tag!==5)&&(e=r.type,e=e!=="head"&&e!=="body"&&!G5(r.type,r.memoizedProps)),e&&(e=Wn)){if(r8(r))throw $I(),Error(ee(418));for(;e;)TI(r,e),e=Sa(e.nextSibling)}if(DI(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(ee(317));e:{for(r=r.nextSibling,e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="/$"){if(e===0){Wn=Sa(r.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}r=r.nextSibling}Wn=null}}else Wn=qn?Sa(r.stateNode.nextSibling):null;return!0}function $I(){for(var r=Wn;r;)r=Sa(r.nextSibling)}function Gu(){Wn=qn=null,Mt=!1}function i8(r){Hi===null?Hi=[r]:Hi.push(r)}var WW=oo.ReactCurrentBatchConfig;function Pf(r,e,t){if(r=t.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(ee(309));var n=t.stateNode}if(!n)throw Error(ee(147,r));var i=n,s=""+r;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof r!="string")throw Error(ee(284));if(!t._owner)throw Error(ee(290,r))}return r}function eg(r,e){throw r=Object.prototype.toString.call(e),Error(ee(31,r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r))}function NI(r){var e=r._init;return e(r._payload)}function MI(r){function e(y,w){if(r){var b=y.deletions;b===null?(y.deletions=[w],y.flags|=16):b.push(w)}}function t(y,w){if(!r)return null;for(;w!==null;)e(y,w),w=w.sibling;return null}function n(y,w){for(y=new Map;w!==null;)w.key!==null?y.set(w.key,w):y.set(w.index,w),w=w.sibling;return y}function i(y,w){return y=Na(y,w),y.index=0,y.sibling=null,y}function s(y,w,b){return y.index=b,r?(b=y.alternate,b!==null?(b=b.index,b<w?(y.flags|=2,w):b):(y.flags|=2,w)):(y.flags|=1048576,w)}function o(y){return r&&y.alternate===null&&(y.flags|=2),y}function a(y,w,b,E){return w===null||w.tag!==6?(w=Q8(b,y.mode,E),w.return=y,w):(w=i(w,b),w.return=y,w)}function c(y,w,b,E){var A=b.type;return A===$u?d(y,w,b.props.children,E,b.key):w!==null&&(w.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===pa&&NI(A)===w.type)?(E=i(w,b.props),E.ref=Pf(y,w,b),E.return=y,E):(E=Ag(b.type,b.key,b.props,null,y.mode,E),E.ref=Pf(y,w,b),E.return=y,E)}function l(y,w,b,E){return w===null||w.tag!==4||w.stateNode.containerInfo!==b.containerInfo||w.stateNode.implementation!==b.implementation?(w=Y8(b,y.mode,E),w.return=y,w):(w=i(w,b.children||[]),w.return=y,w)}function d(y,w,b,E,A){return w===null||w.tag!==7?(w=al(b,y.mode,E,A),w.return=y,w):(w=i(w,b),w.return=y,w)}function h(y,w,b){if(typeof w=="string"&&w!==""||typeof w=="number")return w=Q8(""+w,y.mode,b),w.return=y,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case E0:return b=Ag(w.type,w.key,w.props,null,y.mode,b),b.ref=Pf(y,null,w),b.return=y,b;case Du:return w=Y8(w,y.mode,b),w.return=y,w;case pa:var E=w._init;return h(y,E(w._payload),b)}if(sf(w)||rf(w))return w=al(w,y.mode,b,null),w.return=y,w;eg(y,w)}return null}function p(y,w,b,E){var A=w!==null?w.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return A!==null?null:a(y,w,""+b,E);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case E0:return b.key===A?c(y,w,b,E):null;case Du:return b.key===A?l(y,w,b,E):null;case pa:return A=b._init,p(y,w,A(b._payload),E)}if(sf(b)||rf(b))return A!==null?null:d(y,w,b,E,null);eg(y,b)}return null}function m(y,w,b,E,A){if(typeof E=="string"&&E!==""||typeof E=="number")return y=y.get(b)||null,a(w,y,""+E,A);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case E0:return y=y.get(E.key===null?b:E.key)||null,c(w,y,E,A);case Du:return y=y.get(E.key===null?b:E.key)||null,l(w,y,E,A);case pa:var k=E._init;return m(y,w,b,k(E._payload),A)}if(sf(E)||rf(E))return y=y.get(b)||null,d(w,y,E,A,null);eg(w,E)}return null}function f(y,w,b,E){for(var A=null,k=null,x=w,I=w=0,T=null;x!==null&&I<b.length;I++){x.index>I?(T=x,x=null):T=x.sibling;var L=p(y,x,b[I],E);if(L===null){x===null&&(x=T);break}r&&x&&L.alternate===null&&e(y,x),w=s(L,w,I),k===null?A=L:k.sibling=L,k=L,x=T}if(I===b.length)return t(y,x),Mt&&Zc(y,I),A;if(x===null){for(;I<b.length;I++)x=h(y,b[I],E),x!==null&&(w=s(x,w,I),k===null?A=x:k.sibling=x,k=x);return Mt&&Zc(y,I),A}for(x=n(y,x);I<b.length;I++)T=m(x,y,I,b[I],E),T!==null&&(r&&T.alternate!==null&&x.delete(T.key===null?I:T.key),w=s(T,w,I),k===null?A=T:k.sibling=T,k=T);return r&&x.forEach(function(z){return e(y,z)}),Mt&&Zc(y,I),A}function g(y,w,b,E){var A=rf(b);if(typeof A!="function")throw Error(ee(150));if(b=A.call(b),b==null)throw Error(ee(151));for(var k=A=null,x=w,I=w=0,T=null,L=b.next();x!==null&&!L.done;I++,L=b.next()){x.index>I?(T=x,x=null):T=x.sibling;var z=p(y,x,L.value,E);if(z===null){x===null&&(x=T);break}r&&x&&z.alternate===null&&e(y,x),w=s(z,w,I),k===null?A=z:k.sibling=z,k=z,x=T}if(L.done)return t(y,x),Mt&&Zc(y,I),A;if(x===null){for(;!L.done;I++,L=b.next())L=h(y,L.value,E),L!==null&&(w=s(L,w,I),k===null?A=L:k.sibling=L,k=L);return Mt&&Zc(y,I),A}for(x=n(y,x);!L.done;I++,L=b.next())L=m(x,y,I,L.value,E),L!==null&&(r&&L.alternate!==null&&x.delete(L.key===null?I:L.key),w=s(L,w,I),k===null?A=L:k.sibling=L,k=L);return r&&x.forEach(function(B){return e(y,B)}),Mt&&Zc(y,I),A}function v(y,w,b,E){if(typeof b=="object"&&b!==null&&b.type===$u&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case E0:e:{for(var A=b.key,k=w;k!==null;){if(k.key===A){if(A=b.type,A===$u){if(k.tag===7){t(y,k.sibling),w=i(k,b.props.children),w.return=y,y=w;break e}}else if(k.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===pa&&NI(A)===k.type){t(y,k.sibling),w=i(k,b.props),w.ref=Pf(y,k,b),w.return=y,y=w;break e}t(y,k);break}else e(y,k);k=k.sibling}b.type===$u?(w=al(b.props.children,y.mode,E,b.key),w.return=y,y=w):(E=Ag(b.type,b.key,b.props,null,y.mode,E),E.ref=Pf(y,w,b),E.return=y,y=E)}return o(y);case Du:e:{for(k=b.key;w!==null;){if(w.key===k)if(w.tag===4&&w.stateNode.containerInfo===b.containerInfo&&w.stateNode.implementation===b.implementation){t(y,w.sibling),w=i(w,b.children||[]),w.return=y,y=w;break e}else{t(y,w);break}else e(y,w);w=w.sibling}w=Y8(b,y.mode,E),w.return=y,y=w}return o(y);case pa:return k=b._init,v(y,w,k(b._payload),E)}if(sf(b))return f(y,w,b,E);if(rf(b))return g(y,w,b,E);eg(y,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,w!==null&&w.tag===6?(t(y,w.sibling),w=i(w,b),w.return=y,y=w):(t(y,w),w=Q8(b,y.mode,E),w.return=y,y=w),o(y)):t(y,w)}return v}var Qu=MI(!0),OI=MI(!1),tg=xa(null),rg=null,Yu=null,s8=null;function o8(){s8=Yu=rg=null}function a8(r){var e=tg.current;Pt(tg),r._currentValue=e}function c8(r,e,t){for(;r!==null;){var n=r.alternate;if((r.childLanes&e)!==e?(r.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),r===t)break;r=r.return}}function Ju(r,e){rg=r,s8=Yu=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&e&&(Sn=!0),r.firstContext=null)}function mi(r){var e=r._currentValue;if(s8!==r)if(r={context:r,memoizedValue:e,next:null},Yu===null){if(rg===null)throw Error(ee(308));Yu=r,rg.dependencies={lanes:0,firstContext:r}}else Yu=Yu.next=r;return e}var el=null;function l8(r){el===null?el=[r]:el.push(r)}function RI(r,e,t,n){var i=e.interleaved;return i===null?(t.next=t,l8(e)):(t.next=i.next,i.next=t),e.interleaved=t,ho(r,n)}function ho(r,e){r.lanes|=e;var t=r.alternate;for(t!==null&&(t.lanes|=e),t=r,r=r.return;r!==null;)r.childLanes|=e,t=r.alternate,t!==null&&(t.childLanes|=e),t=r,r=r.return;return t.tag===3?t.stateNode:null}var Ia=!1;function u8(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function LI(r,e){r=r.updateQueue,e.updateQueue===r&&(e.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function fo(r,e){return{eventTime:r,lane:e,tag:0,payload:null,callback:null,next:null}}function ka(r,e,t){var n=r.updateQueue;if(n===null)return null;if(n=n.shared,rt&2){var i=n.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),n.pending=e,ho(r,t)}return i=n.interleaved,i===null?(e.next=e,l8(n)):(e.next=i.next,i.next=e),n.interleaved=e,ho(r,t)}function ng(r,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,A5(r,t)}}function BI(r,e){var t=r.updateQueue,n=r.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:n.shared,effects:n.effects},r.updateQueue=t;return}r=t.lastBaseUpdate,r===null?t.firstBaseUpdate=e:r.next=e,t.lastBaseUpdate=e}function ig(r,e,t,n){var i=r.updateQueue;Ia=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var d=r.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=l:a.next=l,d.lastBaseUpdate=c))}if(s!==null){var h=i.baseState;o=0,d=l=c=null,a=s;do{var p=a.lane,m=a.eventTime;if((n&p)===p){d!==null&&(d=d.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=r,g=a;switch(p=e,m=t,g.tag){case 1:if(f=g.payload,typeof f=="function"){h=f.call(m,h,p);break e}h=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=g.payload,p=typeof f=="function"?f.call(m,h,p):f,p==null)break e;h=Lt({},h,p);break e;case 2:Ia=!0}}a.callback!==null&&a.lane!==0&&(r.flags|=64,p=i.effects,p===null?i.effects=[a]:p.push(a))}else m={eventTime:m,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(l=d=m,c=h):d=d.next=m,o|=p;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;p=a,a=p.next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}while(!0);if(d===null&&(c=h),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=d,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);nl|=o,r.lanes=o,r.memoizedState=h}}function UI(r,e,t){if(r=e.effects,e.effects=null,r!==null)for(e=0;e<r.length;e++){var n=r[e],i=n.callback;if(i!==null){if(n.callback=null,n=t,typeof i!="function")throw Error(ee(191,i));i.call(n)}}}var Df={},xs=xa(Df),$f=xa(Df),Nf=xa(Df);function tl(r){if(r===Df)throw Error(ee(174));return r}function d8(r,e){switch(vt(Nf,e),vt($f,r),vt(xs,Df),r=e.nodeType,r){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:h5(null,"");break;default:r=r===8?e.parentNode:e,e=r.namespaceURI||null,r=r.tagName,e=h5(e,r)}Pt(xs),vt(xs,e)}function Xu(){Pt(xs),Pt($f),Pt(Nf)}function FI(r){tl(Nf.current);var e=tl(xs.current),t=h5(e,r.type);e!==t&&(vt($f,r),vt(xs,t))}function h8(r){$f.current===r&&(Pt(xs),Pt($f))}var Bt=xa(0);function sg(r){for(var e=r;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var f8=[];function p8(){for(var r=0;r<f8.length;r++)f8[r]._workInProgressVersionPrimary=null;f8.length=0}var og=oo.ReactCurrentDispatcher,g8=oo.ReactCurrentBatchConfig,rl=0,Ut=null,ir=null,lr=null,ag=!1,Mf=!1,Of=0,GW=0;function Or(){throw Error(ee(321))}function y8(r,e){if(e===null)return!1;for(var t=0;t<e.length&&t<r.length;t++)if(!ji(r[t],e[t]))return!1;return!0}function m8(r,e,t,n,i,s){if(rl=s,Ut=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,og.current=r===null||r.memoizedState===null?XW:ZW,r=t(n,i),Mf){s=0;do{if(Mf=!1,Of=0,25<=s)throw Error(ee(301));s+=1,lr=ir=null,e.updateQueue=null,og.current=eG,r=t(n,i)}while(Mf)}if(og.current=ug,e=ir!==null&&ir.next!==null,rl=0,lr=ir=Ut=null,ag=!1,e)throw Error(ee(300));return r}function w8(){var r=Of!==0;return Of=0,r}function As(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return lr===null?Ut.memoizedState=lr=r:lr=lr.next=r,lr}function wi(){if(ir===null){var r=Ut.alternate;r=r!==null?r.memoizedState:null}else r=ir.next;var e=lr===null?Ut.memoizedState:lr.next;if(e!==null)lr=e,ir=r;else{if(r===null)throw Error(ee(310));ir=r,r={memoizedState:ir.memoizedState,baseState:ir.baseState,baseQueue:ir.baseQueue,queue:ir.queue,next:null},lr===null?Ut.memoizedState=lr=r:lr=lr.next=r}return lr}function Rf(r,e){return typeof e=="function"?e(r):e}function b8(r){var e=wi(),t=e.queue;if(t===null)throw Error(ee(311));t.lastRenderedReducer=r;var n=ir,i=n.baseQueue,s=t.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}n.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,n=n.baseState;var a=o=null,c=null,l=s;do{var d=l.lane;if((rl&d)===d)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:r(n,l.action);else{var h={lane:d,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=h,o=n):c=c.next=h,Ut.lanes|=d,nl|=d}l=l.next}while(l!==null&&l!==s);c===null?o=n:c.next=a,ji(n,e.memoizedState)||(Sn=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=c,t.lastRenderedState=n}if(r=t.interleaved,r!==null){i=r;do s=i.lane,Ut.lanes|=s,nl|=s,i=i.next;while(i!==r)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function v8(r){var e=wi(),t=e.queue;if(t===null)throw Error(ee(311));t.lastRenderedReducer=r;var n=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do s=r(s,o.action),o=o.next;while(o!==i);ji(s,e.memoizedState)||(Sn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,n]}function zI(){}function VI(r,e){var t=Ut,n=wi(),i=e(),s=!ji(n.memoizedState,i);if(s&&(n.memoizedState=i,Sn=!0),n=n.queue,E8(HI.bind(null,t,n,r),[r]),n.getSnapshot!==e||s||lr!==null&&lr.memoizedState.tag&1){if(t.flags|=2048,Lf(9,jI.bind(null,t,n,i,e),void 0,null),ur===null)throw Error(ee(349));rl&30||KI(t,e,i)}return i}function KI(r,e,t){r.flags|=16384,r={getSnapshot:e,value:t},e=Ut.updateQueue,e===null?(e={lastEffect:null,stores:null},Ut.updateQueue=e,e.stores=[r]):(t=e.stores,t===null?e.stores=[r]:t.push(r))}function jI(r,e,t,n){e.value=t,e.getSnapshot=n,qI(e)&&WI(r)}function HI(r,e,t){return t(function(){qI(e)&&WI(r)})}function qI(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!ji(r,t)}catch{return!0}}function WI(r){var e=ho(r,1);e!==null&&Qi(e,r,1,-1)}function GI(r){var e=As();return typeof r=="function"&&(r=r()),e.memoizedState=e.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Rf,lastRenderedState:r},e.queue=r,r=r.dispatch=JW.bind(null,Ut,r),[e.memoizedState,r]}function Lf(r,e,t,n){return r={tag:r,create:e,destroy:t,deps:n,next:null},e=Ut.updateQueue,e===null?(e={lastEffect:null,stores:null},Ut.updateQueue=e,e.lastEffect=r.next=r):(t=e.lastEffect,t===null?e.lastEffect=r.next=r:(n=t.next,t.next=r,r.next=n,e.lastEffect=r)),r}function QI(){return wi().memoizedState}function cg(r,e,t,n){var i=As();Ut.flags|=r,i.memoizedState=Lf(1|e,t,void 0,n===void 0?null:n)}function lg(r,e,t,n){var i=wi();n=n===void 0?null:n;var s=void 0;if(ir!==null){var o=ir.memoizedState;if(s=o.destroy,n!==null&&y8(n,o.deps)){i.memoizedState=Lf(e,t,s,n);return}}Ut.flags|=r,i.memoizedState=Lf(1|e,t,s,n)}function YI(r,e){return cg(8390656,8,r,e)}function E8(r,e){return lg(2048,8,r,e)}function JI(r,e){return lg(4,2,r,e)}function XI(r,e){return lg(4,4,r,e)}function ZI(r,e){if(typeof e=="function")return r=r(),e(r),function(){e(null)};if(e!=null)return r=r(),e.current=r,function(){e.current=null}}function ek(r,e,t){return t=t!=null?t.concat([r]):null,lg(4,4,ZI.bind(null,e,r),t)}function S8(){}function tk(r,e){var t=wi();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&y8(e,n[1])?n[0]:(t.memoizedState=[r,e],r)}function rk(r,e){var t=wi();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&y8(e,n[1])?n[0]:(r=r(),t.memoizedState=[r,e],r)}function nk(r,e,t){return rl&21?(ji(t,e)||(t=NC(),Ut.lanes|=t,nl|=t,r.baseState=!0),e):(r.baseState&&(r.baseState=!1,Sn=!0),r.memoizedState=t)}function QW(r,e){var t=ft;ft=t!==0&&4>t?t:4,r(!0);var n=g8.transition;g8.transition={};try{r(!1),e()}finally{ft=t,g8.transition=n}}function ik(){return wi().memoizedState}function YW(r,e,t){var n=Da(r);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},sk(r))ok(e,t);else if(t=RI(r,e,t,n),t!==null){var i=cn();Qi(t,r,n,i),ak(t,e,n)}}function JW(r,e,t){var n=Da(r),i={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(sk(r))ok(e,i);else{var s=r.alternate;if(r.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(i.hasEagerState=!0,i.eagerState=a,ji(a,o)){var c=e.interleaved;c===null?(i.next=i,l8(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}t=RI(r,e,i,n),t!==null&&(i=cn(),Qi(t,r,n,i),ak(t,e,n))}}function sk(r){var e=r.alternate;return r===Ut||e!==null&&e===Ut}function ok(r,e){Mf=ag=!0;var t=r.pending;t===null?e.next=e:(e.next=t.next,t.next=e),r.pending=e}function ak(r,e,t){if(t&4194240){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,A5(r,t)}}var ug={readContext:mi,useCallback:Or,useContext:Or,useEffect:Or,useImperativeHandle:Or,useInsertionEffect:Or,useLayoutEffect:Or,useMemo:Or,useReducer:Or,useRef:Or,useState:Or,useDebugValue:Or,useDeferredValue:Or,useTransition:Or,useMutableSource:Or,useSyncExternalStore:Or,useId:Or,unstable_isNewReconciler:!1},XW={readContext:mi,useCallback:function(r,e){return As().memoizedState=[r,e===void 0?null:e],r},useContext:mi,useEffect:YI,useImperativeHandle:function(r,e,t){return t=t!=null?t.concat([r]):null,cg(4194308,4,ZI.bind(null,e,r),t)},useLayoutEffect:function(r,e){return cg(4194308,4,r,e)},useInsertionEffect:function(r,e){return cg(4,2,r,e)},useMemo:function(r,e){var t=As();return e=e===void 0?null:e,r=r(),t.memoizedState=[r,e],r},useReducer:function(r,e,t){var n=As();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:e},n.queue=r,r=r.dispatch=YW.bind(null,Ut,r),[n.memoizedState,r]},useRef:function(r){var e=As();return r={current:r},e.memoizedState=r},useState:GI,useDebugValue:S8,useDeferredValue:function(r){return As().memoizedState=r},useTransition:function(){var r=GI(!1),e=r[0];return r=QW.bind(null,r[1]),As().memoizedState=r,[e,r]},useMutableSource:function(){},useSyncExternalStore:function(r,e,t){var n=Ut,i=As();if(Mt){if(t===void 0)throw Error(ee(407));t=t()}else{if(t=e(),ur===null)throw Error(ee(349));rl&30||KI(n,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,YI(HI.bind(null,n,s,r),[r]),n.flags|=2048,Lf(9,jI.bind(null,n,s,t,e),void 0,null),t},useId:function(){var r=As(),e=ur.identifierPrefix;if(Mt){var t=uo,n=lo;t=(n&~(1<<32-Ki(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=Of++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=GW++,e=":"+e+"r"+t.toString(32)+":";return r.memoizedState=e},unstable_isNewReconciler:!1},ZW={readContext:mi,useCallback:tk,useContext:mi,useEffect:E8,useImperativeHandle:ek,useInsertionEffect:JI,useLayoutEffect:XI,useMemo:rk,useReducer:b8,useRef:QI,useState:function(){return b8(Rf)},useDebugValue:S8,useDeferredValue:function(r){var e=wi();return nk(e,ir.memoizedState,r)},useTransition:function(){var r=b8(Rf)[0],e=wi().memoizedState;return[r,e]},useMutableSource:zI,useSyncExternalStore:VI,useId:ik,unstable_isNewReconciler:!1},eG={readContext:mi,useCallback:tk,useContext:mi,useEffect:E8,useImperativeHandle:ek,useInsertionEffect:JI,useLayoutEffect:XI,useMemo:rk,useReducer:v8,useRef:QI,useState:function(){return v8(Rf)},useDebugValue:S8,useDeferredValue:function(r){var e=wi();return ir===null?e.memoizedState=r:nk(e,ir.memoizedState,r)},useTransition:function(){var r=v8(Rf)[0],e=wi().memoizedState;return[r,e]},useMutableSource:zI,useSyncExternalStore:VI,useId:ik,unstable_isNewReconciler:!1};function qi(r,e){if(r&&r.defaultProps){e=Lt({},e),r=r.defaultProps;for(var t in r)e[t]===void 0&&(e[t]=r[t]);return e}return e}function x8(r,e,t,n){e=r.memoizedState,t=t(n,e),t=t==null?e:Lt({},e,t),r.memoizedState=t,r.lanes===0&&(r.updateQueue.baseState=t)}var dg={isMounted:function(r){return(r=r._reactInternals)?Qc(r)===r:!1},enqueueSetState:function(r,e,t){r=r._reactInternals;var n=cn(),i=Da(r),s=fo(n,i);s.payload=e,t!=null&&(s.callback=t),e=ka(r,s,i),e!==null&&(Qi(e,r,i,n),ng(e,r,i))},enqueueReplaceState:function(r,e,t){r=r._reactInternals;var n=cn(),i=Da(r),s=fo(n,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=ka(r,s,i),e!==null&&(Qi(e,r,i,n),ng(e,r,i))},enqueueForceUpdate:function(r,e){r=r._reactInternals;var t=cn(),n=Da(r),i=fo(t,n);i.tag=2,e!=null&&(i.callback=e),e=ka(r,i,n),e!==null&&(Qi(e,r,n,t),ng(e,r,n))}};function ck(r,e,t,n,i,s,o){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(n,s,o):e.prototype&&e.prototype.isPureReactComponent?!xf(t,n)||!xf(i,s):!0}function lk(r,e,t){var n=!1,i=Aa,s=e.contextType;return typeof s=="object"&&s!==null?s=mi(s):(i=En(e)?Jc:Mr.current,n=e.contextTypes,s=(n=n!=null)?Hu(r,i):Aa),e=new e(t,s),r.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=dg,r.stateNode=e,e._reactInternals=r,n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=i,r.__reactInternalMemoizedMaskedChildContext=s),e}function uk(r,e,t,n){r=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==r&&dg.enqueueReplaceState(e,e.state,null)}function A8(r,e,t,n){var i=r.stateNode;i.props=t,i.state=r.memoizedState,i.refs={},u8(r);var s=e.contextType;typeof s=="object"&&s!==null?i.context=mi(s):(s=En(e)?Jc:Mr.current,i.context=Hu(r,s)),i.state=r.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(x8(r,e,s,t),i.state=r.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&dg.enqueueReplaceState(i,i.state,null),ig(r,t,i,n),i.state=r.memoizedState),typeof i.componentDidMount=="function"&&(r.flags|=4194308)}function Zu(r,e){try{var t="",n=e;do t+=_q(n),n=n.return;while(n);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:r,source:e,stack:i,digest:null}}function C8(r,e,t){return{value:r,source:null,stack:t??null,digest:e??null}}function I8(r,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var tG=typeof WeakMap=="function"?WeakMap:Map;function dk(r,e,t){t=fo(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){wg||(wg=!0,z8=n),I8(r,e)},t}function hk(r,e,t){t=fo(-1,t),t.tag=3;var n=r.type.getDerivedStateFromError;if(typeof n=="function"){var i=e.value;t.payload=function(){return n(i)},t.callback=function(){I8(r,e)}}var s=r.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){I8(r,e),typeof n!="function"&&(Ta===null?Ta=new Set([this]):Ta.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function fk(r,e,t){var n=r.pingCache;if(n===null){n=r.pingCache=new tG;var i=new Set;n.set(e,i)}else i=n.get(e),i===void 0&&(i=new Set,n.set(e,i));i.has(t)||(i.add(t),r=gG.bind(null,r,e,t),e.then(r,r))}function pk(r){do{var e;if((e=r.tag===13)&&(e=r.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return r;r=r.return}while(r!==null);return null}function gk(r,e,t,n,i){return r.mode&1?(r.flags|=65536,r.lanes=i,r):(r===e?r.flags|=65536:(r.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=fo(-1,1),e.tag=2,ka(t,e,1))),t.lanes|=1),r)}var rG=oo.ReactCurrentOwner,Sn=!1;function an(r,e,t,n){e.child=r===null?OI(e,null,t,n):Qu(e,r.child,t,n)}function yk(r,e,t,n,i){t=t.render;var s=e.ref;return Ju(e,i),n=m8(r,e,t,n,s,i),t=w8(),r!==null&&!Sn?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~i,po(r,e,i)):(Mt&&t&&e8(e),e.flags|=1,an(r,e,n,i),e.child)}function mk(r,e,t,n,i){if(r===null){var s=t.type;return typeof s=="function"&&!G8(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,wk(r,e,s,n,i)):(r=Ag(t.type,null,n,e,e.mode,i),r.ref=e.ref,r.return=e,e.child=r)}if(s=r.child,!(r.lanes&i)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:xf,t(o,n)&&r.ref===e.ref)return po(r,e,i)}return e.flags|=1,r=Na(s,n),r.ref=e.ref,r.return=e,e.child=r}function wk(r,e,t,n,i){if(r!==null){var s=r.memoizedProps;if(xf(s,n)&&r.ref===e.ref)if(Sn=!1,e.pendingProps=n=s,(r.lanes&i)!==0)r.flags&131072&&(Sn=!0);else return e.lanes=r.lanes,po(r,e,i)}return k8(r,e,t,n,i)}function bk(r,e,t){var n=e.pendingProps,i=n.children,s=r!==null?r.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},vt(td,Gn),Gn|=t;else{if(!(t&1073741824))return r=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:r,cachePool:null,transitions:null},e.updateQueue=null,vt(td,Gn),Gn|=r,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:t,vt(td,Gn),Gn|=n}else s!==null?(n=s.baseLanes|t,e.memoizedState=null):n=t,vt(td,Gn),Gn|=n;return an(r,e,i,t),e.child}function vk(r,e){var t=e.ref;(r===null&&t!==null||r!==null&&r.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function k8(r,e,t,n,i){var s=En(t)?Jc:Mr.current;return s=Hu(e,s),Ju(e,i),t=m8(r,e,t,n,s,i),n=w8(),r!==null&&!Sn?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~i,po(r,e,i)):(Mt&&n&&e8(e),e.flags|=1,an(r,e,t,i),e.child)}function Ek(r,e,t,n,i){if(En(t)){var s=!0;Q0(e)}else s=!1;if(Ju(e,i),e.stateNode===null)fg(r,e),lk(e,t,n),A8(e,t,n,i),n=!0;else if(r===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=t.contextType;typeof l=="object"&&l!==null?l=mi(l):(l=En(t)?Jc:Mr.current,l=Hu(e,l));var d=t.getDerivedStateFromProps,h=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==n||c!==l)&&uk(e,o,n,l),Ia=!1;var p=e.memoizedState;o.state=p,ig(e,n,o,i),c=e.memoizedState,a!==n||p!==c||vn.current||Ia?(typeof d=="function"&&(x8(e,t,d,n),c=e.memoizedState),(a=Ia||ck(e,t,a,n,p,c,l))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=c),o.props=n,o.state=c,o.context=l,n=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,LI(r,e),a=e.memoizedProps,l=e.type===e.elementType?a:qi(e.type,a),o.props=l,h=e.pendingProps,p=o.context,c=t.contextType,typeof c=="object"&&c!==null?c=mi(c):(c=En(t)?Jc:Mr.current,c=Hu(e,c));var m=t.getDerivedStateFromProps;(d=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||p!==c)&&uk(e,o,n,c),Ia=!1,p=e.memoizedState,o.state=p,ig(e,n,o,i);var f=e.memoizedState;a!==h||p!==f||vn.current||Ia?(typeof m=="function"&&(x8(e,t,m,n),f=e.memoizedState),(l=Ia||ck(e,t,l,n,p,f,c)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,f,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,f,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=f),o.props=n,o.state=f,o.context=c,n=l):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=1024),n=!1)}return _8(r,e,t,n,s,i)}function _8(r,e,t,n,i,s){vk(r,e);var o=(e.flags&128)!==0;if(!n&&!o)return i&&II(e,t,!1),po(r,e,s);n=e.stateNode,rG.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,r!==null&&o?(e.child=Qu(e,r.child,null,s),e.child=Qu(e,null,a,s)):an(r,e,a,s),e.memoizedState=n.state,i&&II(e,t,!0),e.child}function Sk(r){var e=r.stateNode;e.pendingContext?AI(r,e.pendingContext,e.pendingContext!==e.context):e.context&&AI(r,e.context,!1),d8(r,e.containerInfo)}function xk(r,e,t,n,i){return Gu(),i8(i),e.flags|=256,an(r,e,t,n),e.child}var T8={dehydrated:null,treeContext:null,retryLane:0};function P8(r){return{baseLanes:r,cachePool:null,transitions:null}}function Ak(r,e,t){var n=e.pendingProps,i=Bt.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=r!==null&&r.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(r===null||r.memoizedState!==null)&&(i|=1),vt(Bt,i&1),r===null)return n8(e),r=e.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(e.mode&1?r.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,r=n.fallback,s?(n=e.mode,s=e.child,o={mode:"hidden",children:o},!(n&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Cg(o,n,0,null),r=al(r,n,t,null),s.return=e,r.return=e,s.sibling=r,e.child=s,e.child.memoizedState=P8(t),e.memoizedState=T8,r):D8(e,o));if(i=r.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return nG(r,e,o,n,a,i,t);if(s){s=n.fallback,o=e.mode,i=r.child,a=i.sibling;var c={mode:"hidden",children:n.children};return!(o&1)&&e.child!==i?(n=e.child,n.childLanes=0,n.pendingProps=c,e.deletions=null):(n=Na(i,c),n.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Na(a,s):(s=al(s,o,t,null),s.flags|=2),s.return=e,n.return=e,n.sibling=s,e.child=n,n=s,s=e.child,o=r.child.memoizedState,o=o===null?P8(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=r.childLanes&~t,e.memoizedState=T8,n}return s=r.child,r=s.sibling,n=Na(s,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,r!==null&&(t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)),e.child=n,e.memoizedState=null,n}function D8(r,e){return e=Cg({mode:"visible",children:e},r.mode,0,null),e.return=r,r.child=e}function hg(r,e,t,n){return n!==null&&i8(n),Qu(e,r.child,null,t),r=D8(e,e.pendingProps.children),r.flags|=2,e.memoizedState=null,r}function nG(r,e,t,n,i,s,o){if(t)return e.flags&256?(e.flags&=-257,n=C8(Error(ee(422))),hg(r,e,o,n)):e.memoizedState!==null?(e.child=r.child,e.flags|=128,null):(s=n.fallback,i=e.mode,n=Cg({mode:"visible",children:n.children},i,0,null),s=al(s,i,o,null),s.flags|=2,n.return=e,s.return=e,n.sibling=s,e.child=n,e.mode&1&&Qu(e,r.child,null,o),e.child.memoizedState=P8(o),e.memoizedState=T8,s);if(!(e.mode&1))return hg(r,e,o,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var a=n.dgst;return n=a,s=Error(ee(419)),n=C8(s,n,void 0),hg(r,e,o,n)}if(a=(o&r.childLanes)!==0,Sn||a){if(n=ur,n!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,ho(r,i),Qi(n,r,i,-1))}return W8(),n=C8(Error(ee(421))),hg(r,e,o,n)}return i.data==="$?"?(e.flags|=128,e.child=r.child,e=yG.bind(null,r),i._reactRetry=e,null):(r=s.treeContext,Wn=Sa(i.nextSibling),qn=e,Mt=!0,Hi=null,r!==null&&(gi[yi++]=lo,gi[yi++]=uo,gi[yi++]=Xc,lo=r.id,uo=r.overflow,Xc=e),e=D8(e,n.children),e.flags|=4096,e)}function Ck(r,e,t){r.lanes|=e;var n=r.alternate;n!==null&&(n.lanes|=e),c8(r.return,e,t)}function $8(r,e,t,n,i){var s=r.memoizedState;s===null?r.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=t,s.tailMode=i)}function Ik(r,e,t){var n=e.pendingProps,i=n.revealOrder,s=n.tail;if(an(r,e,n.children,t),n=Bt.current,n&2)n=n&1|2,e.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=e.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Ck(r,t,e);else if(r.tag===19)Ck(r,t,e);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}n&=1}if(vt(Bt,n),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)r=t.alternate,r!==null&&sg(r)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),$8(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(r=i.alternate,r!==null&&sg(r)===null){e.child=i;break}r=i.sibling,i.sibling=t,t=i,i=r}$8(e,!0,t,null,s);break;case"together":$8(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function fg(r,e){!(e.mode&1)&&r!==null&&(r.alternate=null,e.alternate=null,e.flags|=2)}function po(r,e,t){if(r!==null&&(e.dependencies=r.dependencies),nl|=e.lanes,!(t&e.childLanes))return null;if(r!==null&&e.child!==r.child)throw Error(ee(153));if(e.child!==null){for(r=e.child,t=Na(r,r.pendingProps),e.child=t,t.return=e;r.sibling!==null;)r=r.sibling,t=t.sibling=Na(r,r.pendingProps),t.return=e;t.sibling=null}return e.child}function iG(r,e,t){switch(e.tag){case 3:Sk(e),Gu();break;case 5:FI(e);break;case 1:En(e.type)&&Q0(e);break;case 4:d8(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,i=e.memoizedProps.value;vt(tg,n._currentValue),n._currentValue=i;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(vt(Bt,Bt.current&1),e.flags|=128,null):t&e.child.childLanes?Ak(r,e,t):(vt(Bt,Bt.current&1),r=po(r,e,t),r!==null?r.sibling:null);vt(Bt,Bt.current&1);break;case 19:if(n=(t&e.childLanes)!==0,r.flags&128){if(n)return Ik(r,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),vt(Bt,Bt.current),n)break;return null;case 22:case 23:return e.lanes=0,bk(r,e,t)}return po(r,e,t)}var kk,N8,_k,Tk;kk=function(r,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)r.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}},N8=function(){},_k=function(r,e,t,n){var i=r.memoizedProps;if(i!==n){r=e.stateNode,tl(xs.current);var s=null;switch(t){case"input":i=c5(r,i),n=c5(r,n),s=[];break;case"select":i=Lt({},i,{value:void 0}),n=Lt({},n,{value:void 0}),s=[];break;case"textarea":i=d5(r,i),n=d5(r,n),s=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(r.onclick=q0)}f5(t,n);var o;t=null;for(l in i)if(!n.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var a=i[l];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(tf.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in n){var c=n[l];if(a=i!=null?i[l]:void 0,n.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(s||(s=[]),s.push(l,t)),t=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(tf.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&Tt("scroll",r),s||a===c||(s=[])):(s=s||[]).push(l,c))}t&&(s=s||[]).push("style",t);var l=s;(e.updateQueue=l)&&(e.flags|=4)}},Tk=function(r,e,t,n){t!==n&&(e.flags|=4)};function Bf(r,e){if(!Mt)switch(r.tailMode){case"hidden":e=r.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?r.tail=null:t.sibling=null;break;case"collapsed":t=r.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||r.tail===null?r.tail=null:r.tail.sibling=null:n.sibling=null}}function Rr(r){var e=r.alternate!==null&&r.alternate.child===r.child,t=0,n=0;if(e)for(var i=r.child;i!==null;)t|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=r,i=i.sibling;else for(i=r.child;i!==null;)t|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=r,i=i.sibling;return r.subtreeFlags|=n,r.childLanes=t,e}function sG(r,e,t){var n=e.pendingProps;switch(t8(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rr(e),null;case 1:return En(e.type)&&G0(),Rr(e),null;case 3:return n=e.stateNode,Xu(),Pt(vn),Pt(Mr),p8(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(r===null||r.child===null)&&(Z0(e)?e.flags|=4:r===null||r.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Hi!==null&&(j8(Hi),Hi=null))),N8(r,e),Rr(e),null;case 5:h8(e);var i=tl(Nf.current);if(t=e.type,r!==null&&e.stateNode!=null)_k(r,e,t,n,i),r.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(ee(166));return Rr(e),null}if(r=tl(xs.current),Z0(e)){n=e.stateNode,t=e.type;var s=e.memoizedProps;switch(n[Ss]=e,n[_f]=s,r=(e.mode&1)!==0,t){case"dialog":Tt("cancel",n),Tt("close",n);break;case"iframe":case"object":case"embed":Tt("load",n);break;case"video":case"audio":for(i=0;i<Cf.length;i++)Tt(Cf[i],n);break;case"source":Tt("error",n);break;case"img":case"image":case"link":Tt("error",n),Tt("load",n);break;case"details":Tt("toggle",n);break;case"input":lC(n,s),Tt("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},Tt("invalid",n);break;case"textarea":hC(n,s),Tt("invalid",n)}f5(t,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?n.textContent!==a&&(s.suppressHydrationWarning!==!0&&H0(n.textContent,a,r),i=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&H0(n.textContent,a,r),i=["children",""+a]):tf.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Tt("scroll",n)}switch(t){case"input":S0(n),dC(n,s,!0);break;case"textarea":S0(n),pC(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=q0)}n=i,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=gC(t)),r==="http://www.w3.org/1999/xhtml"?t==="script"?(r=o.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof n.is=="string"?r=o.createElement(t,{is:n.is}):(r=o.createElement(t),t==="select"&&(o=r,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):r=o.createElementNS(r,t),r[Ss]=e,r[_f]=n,kk(r,e,!1,!1),e.stateNode=r;e:{switch(o=p5(t,n),t){case"dialog":Tt("cancel",r),Tt("close",r),i=n;break;case"iframe":case"object":case"embed":Tt("load",r),i=n;break;case"video":case"audio":for(i=0;i<Cf.length;i++)Tt(Cf[i],r);i=n;break;case"source":Tt("error",r),i=n;break;case"img":case"image":case"link":Tt("error",r),Tt("load",r),i=n;break;case"details":Tt("toggle",r),i=n;break;case"input":lC(r,n),i=c5(r,n),Tt("invalid",r);break;case"option":i=n;break;case"select":r._wrapperState={wasMultiple:!!n.multiple},i=Lt({},n,{value:void 0}),Tt("invalid",r);break;case"textarea":hC(r,n),i=d5(r,n),Tt("invalid",r);break;default:i=n}f5(t,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?wC(r,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&yC(r,c)):s==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&of(r,c):typeof c=="number"&&of(r,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(tf.hasOwnProperty(s)?c!=null&&s==="onScroll"&&Tt("scroll",r):c!=null&&J4(r,s,c,o))}switch(t){case"input":S0(r),dC(r,n,!1);break;case"textarea":S0(r),pC(r);break;case"option":n.value!=null&&r.setAttribute("value",""+ga(n.value));break;case"select":r.multiple=!!n.multiple,s=n.value,s!=null?Nu(r,!!n.multiple,s,!1):n.defaultValue!=null&&Nu(r,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(r.onclick=q0)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Rr(e),null;case 6:if(r&&e.stateNode!=null)Tk(r,e,r.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(ee(166));if(t=tl(Nf.current),tl(xs.current),Z0(e)){if(n=e.stateNode,t=e.memoizedProps,n[Ss]=e,(s=n.nodeValue!==t)&&(r=qn,r!==null))switch(r.tag){case 3:H0(n.nodeValue,t,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&H0(n.nodeValue,t,(r.mode&1)!==0)}s&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[Ss]=e,e.stateNode=n}return Rr(e),null;case 13:if(Pt(Bt),n=e.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(Mt&&Wn!==null&&e.mode&1&&!(e.flags&128))$I(),Gu(),e.flags|=98560,s=!1;else if(s=Z0(e),n!==null&&n.dehydrated!==null){if(r===null){if(!s)throw Error(ee(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ee(317));s[Ss]=e}else Gu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Rr(e),s=!1}else Hi!==null&&(j8(Hi),Hi=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(r!==null&&r.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(r===null||Bt.current&1?sr===0&&(sr=3):W8())),e.updateQueue!==null&&(e.flags|=4),Rr(e),null);case 4:return Xu(),N8(r,e),r===null&&If(e.stateNode.containerInfo),Rr(e),null;case 10:return a8(e.type._context),Rr(e),null;case 17:return En(e.type)&&G0(),Rr(e),null;case 19:if(Pt(Bt),s=e.memoizedState,s===null)return Rr(e),null;if(n=(e.flags&128)!==0,o=s.rendering,o===null)if(n)Bf(s,!1);else{if(sr!==0||r!==null&&r.flags&128)for(r=e.child;r!==null;){if(o=sg(r),o!==null){for(e.flags|=128,Bf(s,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)s=t,r=n,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=r,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,r=o.dependencies,s.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t=t.sibling;return vt(Bt,Bt.current&1|2),e.child}r=r.sibling}s.tail!==null&&Gt()>rd&&(e.flags|=128,n=!0,Bf(s,!1),e.lanes=4194304)}else{if(!n)if(r=sg(o),r!==null){if(e.flags|=128,n=!0,t=r.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Bf(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Mt)return Rr(e),null}else 2*Gt()-s.renderingStartTime>rd&&t!==1073741824&&(e.flags|=128,n=!0,Bf(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Gt(),e.sibling=null,t=Bt.current,vt(Bt,n?t&1|2:t&1),e):(Rr(e),null);case 22:case 23:return q8(),n=e.memoizedState!==null,r!==null&&r.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Gn&1073741824&&(Rr(e),e.subtreeFlags&6&&(e.flags|=8192)):Rr(e),null;case 24:return null;case 25:return null}throw Error(ee(156,e.tag))}function oG(r,e){switch(t8(e),e.tag){case 1:return En(e.type)&&G0(),r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 3:return Xu(),Pt(vn),Pt(Mr),p8(),r=e.flags,r&65536&&!(r&128)?(e.flags=r&-65537|128,e):null;case 5:return h8(e),null;case 13:if(Pt(Bt),r=e.memoizedState,r!==null&&r.dehydrated!==null){if(e.alternate===null)throw Error(ee(340));Gu()}return r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 19:return Pt(Bt),null;case 4:return Xu(),null;case 10:return a8(e.type._context),null;case 22:case 23:return q8(),null;case 24:return null;default:return null}}var pg=!1,Lr=!1,aG=typeof WeakSet=="function"?WeakSet:Set,be=null;function ed(r,e){var t=r.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){Ht(r,e,n)}else t.current=null}function M8(r,e,t){try{t()}catch(n){Ht(r,e,n)}}var Pk=!1;function cG(r,e){if(q5=M0,r=cI(),B5(r)){if("selectionStart"in r)var t={start:r.selectionStart,end:r.selectionEnd};else e:{t=(t=r.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var i=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,c=-1,l=0,d=0,h=r,p=null;t:for(;;){for(var m;h!==t||i!==0&&h.nodeType!==3||(a=o+i),h!==s||n!==0&&h.nodeType!==3||(c=o+n),h.nodeType===3&&(o+=h.nodeValue.length),(m=h.firstChild)!==null;)p=h,h=m;for(;;){if(h===r)break t;if(p===t&&++l===i&&(a=o),p===s&&++d===n&&(c=o),(m=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=m}t=a===-1||c===-1?null:{start:a,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(W5={focusedElem:r,selectionRange:t},M0=!1,be=e;be!==null;)if(e=be,r=e.child,(e.subtreeFlags&1028)!==0&&r!==null)r.return=e,be=r;else for(;be!==null;){e=be;try{var f=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var g=f.memoizedProps,v=f.memoizedState,y=e.stateNode,w=y.getSnapshotBeforeUpdate(e.elementType===e.type?g:qi(e.type,g),v);y.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ee(163))}}catch(E){Ht(e,e.return,E)}if(r=e.sibling,r!==null){r.return=e.return,be=r;break}be=e.return}return f=Pk,Pk=!1,f}function Uf(r,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&r)===r){var s=i.destroy;i.destroy=void 0,s!==void 0&&M8(e,t,s)}i=i.next}while(i!==n)}}function gg(r,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&r)===r){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function O8(r){var e=r.ref;if(e!==null){var t=r.stateNode;switch(r.tag){case 5:r=t;break;default:r=t}typeof e=="function"?e(r):e.current=r}}function Dk(r){var e=r.alternate;e!==null&&(r.alternate=null,Dk(e)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(e=r.stateNode,e!==null&&(delete e[Ss],delete e[_f],delete e[J5],delete e[jW],delete e[HW])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function $k(r){return r.tag===5||r.tag===3||r.tag===4}function Nk(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||$k(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function R8(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(r,e):t.insertBefore(r,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(r,t)):(e=t,e.appendChild(r)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=q0));else if(n!==4&&(r=r.child,r!==null))for(R8(r,e,t),r=r.sibling;r!==null;)R8(r,e,t),r=r.sibling}function L8(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.insertBefore(r,e):t.appendChild(r);else if(n!==4&&(r=r.child,r!==null))for(L8(r,e,t),r=r.sibling;r!==null;)L8(r,e,t),r=r.sibling}var wr=null,Wi=!1;function _a(r,e,t){for(t=t.child;t!==null;)Mk(r,e,t),t=t.sibling}function Mk(r,e,t){if(Es&&typeof Es.onCommitFiberUnmount=="function")try{Es.onCommitFiberUnmount(_0,t)}catch{}switch(t.tag){case 5:Lr||ed(t,e);case 6:var n=wr,i=Wi;wr=null,_a(r,e,t),wr=n,Wi=i,wr!==null&&(Wi?(r=wr,t=t.stateNode,r.nodeType===8?r.parentNode.removeChild(t):r.removeChild(t)):wr.removeChild(t.stateNode));break;case 18:wr!==null&&(Wi?(r=wr,t=t.stateNode,r.nodeType===8?Y5(r.parentNode,t):r.nodeType===1&&Y5(r,t),mf(r)):Y5(wr,t.stateNode));break;case 4:n=wr,i=Wi,wr=t.stateNode.containerInfo,Wi=!0,_a(r,e,t),wr=n,Wi=i;break;case 0:case 11:case 14:case 15:if(!Lr&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&M8(t,e,o),i=i.next}while(i!==n)}_a(r,e,t);break;case 1:if(!Lr&&(ed(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(a){Ht(t,e,a)}_a(r,e,t);break;case 21:_a(r,e,t);break;case 22:t.mode&1?(Lr=(n=Lr)||t.memoizedState!==null,_a(r,e,t),Lr=n):_a(r,e,t);break;default:_a(r,e,t)}}function Ok(r){var e=r.updateQueue;if(e!==null){r.updateQueue=null;var t=r.stateNode;t===null&&(t=r.stateNode=new aG),e.forEach(function(n){var i=mG.bind(null,r,n);t.has(n)||(t.add(n),n.then(i,i))})}}function Gi(r,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var i=t[n];try{var s=r,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:wr=a.stateNode,Wi=!1;break e;case 3:wr=a.stateNode.containerInfo,Wi=!0;break e;case 4:wr=a.stateNode.containerInfo,Wi=!0;break e}a=a.return}if(wr===null)throw Error(ee(160));Mk(s,o,i),wr=null,Wi=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(l){Ht(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Rk(e,r),e=e.sibling}function Rk(r,e){var t=r.alternate,n=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Gi(e,r),Cs(r),n&4){try{Uf(3,r,r.return),gg(3,r)}catch(g){Ht(r,r.return,g)}try{Uf(5,r,r.return)}catch(g){Ht(r,r.return,g)}}break;case 1:Gi(e,r),Cs(r),n&512&&t!==null&&ed(t,t.return);break;case 5:if(Gi(e,r),Cs(r),n&512&&t!==null&&ed(t,t.return),r.flags&32){var i=r.stateNode;try{of(i,"")}catch(g){Ht(r,r.return,g)}}if(n&4&&(i=r.stateNode,i!=null)){var s=r.memoizedProps,o=t!==null?t.memoizedProps:s,a=r.type,c=r.updateQueue;if(r.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&uC(i,s),p5(a,o);var l=p5(a,s);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];d==="style"?wC(i,h):d==="dangerouslySetInnerHTML"?yC(i,h):d==="children"?of(i,h):J4(i,d,h,l)}switch(a){case"input":l5(i,s);break;case"textarea":fC(i,s);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?Nu(i,!!s.multiple,m,!1):p!==!!s.multiple&&(s.defaultValue!=null?Nu(i,!!s.multiple,s.defaultValue,!0):Nu(i,!!s.multiple,s.multiple?[]:"",!1))}i[_f]=s}catch(g){Ht(r,r.return,g)}}break;case 6:if(Gi(e,r),Cs(r),n&4){if(r.stateNode===null)throw Error(ee(162));i=r.stateNode,s=r.memoizedProps;try{i.nodeValue=s}catch(g){Ht(r,r.return,g)}}break;case 3:if(Gi(e,r),Cs(r),n&4&&t!==null&&t.memoizedState.isDehydrated)try{mf(e.containerInfo)}catch(g){Ht(r,r.return,g)}break;case 4:Gi(e,r),Cs(r);break;case 13:Gi(e,r),Cs(r),i=r.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(F8=Gt())),n&4&&Ok(r);break;case 22:if(d=t!==null&&t.memoizedState!==null,r.mode&1?(Lr=(l=Lr)||d,Gi(e,r),Lr=l):Gi(e,r),Cs(r),n&8192){if(l=r.memoizedState!==null,(r.stateNode.isHidden=l)&&!d&&r.mode&1)for(be=r,d=r.child;d!==null;){for(h=be=d;be!==null;){switch(p=be,m=p.child,p.tag){case 0:case 11:case 14:case 15:Uf(4,p,p.return);break;case 1:ed(p,p.return);var f=p.stateNode;if(typeof f.componentWillUnmount=="function"){n=p,t=p.return;try{e=n,f.props=e.memoizedProps,f.state=e.memoizedState,f.componentWillUnmount()}catch(g){Ht(n,t,g)}}break;case 5:ed(p,p.return);break;case 22:if(p.memoizedState!==null){Uk(h);continue}}m!==null?(m.return=p,be=m):Uk(h)}d=d.sibling}e:for(d=null,h=r;;){if(h.tag===5){if(d===null){d=h;try{i=h.stateNode,l?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=mC("display",o))}catch(g){Ht(r,r.return,g)}}}else if(h.tag===6){if(d===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(g){Ht(r,r.return,g)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===r)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===r)break e;for(;h.sibling===null;){if(h.return===null||h.return===r)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Gi(e,r),Cs(r),n&4&&Ok(r);break;case 21:break;default:Gi(e,r),Cs(r)}}function Cs(r){var e=r.flags;if(e&2){try{e:{for(var t=r.return;t!==null;){if($k(t)){var n=t;break e}t=t.return}throw Error(ee(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(of(i,""),n.flags&=-33);var s=Nk(r);L8(r,s,i);break;case 3:case 4:var o=n.stateNode.containerInfo,a=Nk(r);R8(r,a,o);break;default:throw Error(ee(161))}}catch(c){Ht(r,r.return,c)}r.flags&=-3}e&4096&&(r.flags&=-4097)}function lG(r,e,t){be=r,Lk(r)}function Lk(r,e,t){for(var n=(r.mode&1)!==0;be!==null;){var i=be,s=i.child;if(i.tag===22&&n){var o=i.memoizedState!==null||pg;if(!o){var a=i.alternate,c=a!==null&&a.memoizedState!==null||Lr;a=pg;var l=Lr;if(pg=o,(Lr=c)&&!l)for(be=i;be!==null;)o=be,c=o.child,o.tag===22&&o.memoizedState!==null?Fk(i):c!==null?(c.return=o,be=c):Fk(i);for(;s!==null;)be=s,Lk(s),s=s.sibling;be=i,pg=a,Lr=l}Bk(r)}else i.subtreeFlags&8772&&s!==null?(s.return=i,be=s):Bk(r)}}function Bk(r){for(;be!==null;){var e=be;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Lr||gg(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Lr)if(t===null)n.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:qi(e.type,t.memoizedProps);n.componentDidUpdate(i,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&UI(e,s,n);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}UI(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var d=l.memoizedState;if(d!==null){var h=d.dehydrated;h!==null&&mf(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ee(163))}Lr||e.flags&512&&O8(e)}catch(p){Ht(e,e.return,p)}}if(e===r){be=null;break}if(t=e.sibling,t!==null){t.return=e.return,be=t;break}be=e.return}}function Uk(r){for(;be!==null;){var e=be;if(e===r){be=null;break}var t=e.sibling;if(t!==null){t.return=e.return,be=t;break}be=e.return}}function Fk(r){for(;be!==null;){var e=be;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{gg(4,e)}catch(c){Ht(e,t,c)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var i=e.return;try{n.componentDidMount()}catch(c){Ht(e,i,c)}}var s=e.return;try{O8(e)}catch(c){Ht(e,s,c)}break;case 5:var o=e.return;try{O8(e)}catch(c){Ht(e,o,c)}}}catch(c){Ht(e,e.return,c)}if(e===r){be=null;break}var a=e.sibling;if(a!==null){a.return=e.return,be=a;break}be=e.return}}var uG=Math.ceil,yg=oo.ReactCurrentDispatcher,B8=oo.ReactCurrentOwner,bi=oo.ReactCurrentBatchConfig,rt=0,ur=null,Xt=null,br=0,Gn=0,td=xa(0),sr=0,Ff=null,nl=0,mg=0,U8=0,zf=null,xn=null,F8=0,rd=1/0,go=null,wg=!1,z8=null,Ta=null,bg=!1,Pa=null,vg=0,Vf=0,V8=null,Eg=-1,Sg=0;function cn(){return rt&6?Gt():Eg!==-1?Eg:Eg=Gt()}function Da(r){return r.mode&1?rt&2&&br!==0?br&-br:WW.transition!==null?(Sg===0&&(Sg=NC()),Sg):(r=ft,r!==0||(r=window.event,r=r===void 0?16:VC(r.type)),r):1}function Qi(r,e,t,n){if(50<Vf)throw Vf=0,V8=null,Error(ee(185));hf(r,t,n),(!(rt&2)||r!==ur)&&(r===ur&&(!(rt&2)&&(mg|=t),sr===4&&$a(r,br)),An(r,n),t===1&&rt===0&&!(e.mode&1)&&(rd=Gt()+500,Y0&&Ca()))}function An(r,e){var t=r.callbackNode;Wq(r,e);var n=D0(r,r===ur?br:0);if(n===0)t!==null&&PC(t),r.callbackNode=null,r.callbackPriority=0;else if(e=n&-n,r.callbackPriority!==e){if(t!=null&&PC(t),e===1)r.tag===0?qW(Vk.bind(null,r)):kI(Vk.bind(null,r)),VW(function(){!(rt&6)&&Ca()}),t=null;else{switch(MC(n)){case 1:t=E5;break;case 4:t=DC;break;case 16:t=k0;break;case 536870912:t=$C;break;default:t=k0}t=Yk(t,zk.bind(null,r))}r.callbackPriority=e,r.callbackNode=t}}function zk(r,e){if(Eg=-1,Sg=0,rt&6)throw Error(ee(327));var t=r.callbackNode;if(nd()&&r.callbackNode!==t)return null;var n=D0(r,r===ur?br:0);if(n===0)return null;if(n&30||n&r.expiredLanes||e)e=xg(r,n);else{e=n;var i=rt;rt|=2;var s=jk();(ur!==r||br!==e)&&(go=null,rd=Gt()+500,sl(r,e));do try{fG();break}catch(a){Kk(r,a)}while(!0);o8(),yg.current=s,rt=i,Xt!==null?e=0:(ur=null,br=0,e=sr)}if(e!==0){if(e===2&&(i=S5(r),i!==0&&(n=i,e=K8(r,i))),e===1)throw t=Ff,sl(r,0),$a(r,n),An(r,Gt()),t;if(e===6)$a(r,n);else{if(i=r.current.alternate,!(n&30)&&!dG(i)&&(e=xg(r,n),e===2&&(s=S5(r),s!==0&&(n=s,e=K8(r,s))),e===1))throw t=Ff,sl(r,0),$a(r,n),An(r,Gt()),t;switch(r.finishedWork=i,r.finishedLanes=n,e){case 0:case 1:throw Error(ee(345));case 2:ol(r,xn,go);break;case 3:if($a(r,n),(n&130023424)===n&&(e=F8+500-Gt(),10<e)){if(D0(r,0)!==0)break;if(i=r.suspendedLanes,(i&n)!==n){cn(),r.pingedLanes|=r.suspendedLanes&i;break}r.timeoutHandle=Q5(ol.bind(null,r,xn,go),e);break}ol(r,xn,go);break;case 4:if($a(r,n),(n&4194240)===n)break;for(e=r.eventTimes,i=-1;0<n;){var o=31-Ki(n);s=1<<o,o=e[o],o>i&&(i=o),n&=~s}if(n=i,n=Gt()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*uG(n/1960))-n,10<n){r.timeoutHandle=Q5(ol.bind(null,r,xn,go),n);break}ol(r,xn,go);break;case 5:ol(r,xn,go);break;default:throw Error(ee(329))}}}return An(r,Gt()),r.callbackNode===t?zk.bind(null,r):null}function K8(r,e){var t=zf;return r.current.memoizedState.isDehydrated&&(sl(r,e).flags|=256),r=xg(r,e),r!==2&&(e=xn,xn=t,e!==null&&j8(e)),r}function j8(r){xn===null?xn=r:xn.push.apply(xn,r)}function dG(r){for(var e=r;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var i=t[n],s=i.getSnapshot;i=i.value;try{if(!ji(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function $a(r,e){for(e&=~U8,e&=~mg,r.suspendedLanes|=e,r.pingedLanes&=~e,r=r.expirationTimes;0<e;){var t=31-Ki(e),n=1<<t;r[t]=-1,e&=~n}}function Vk(r){if(rt&6)throw Error(ee(327));nd();var e=D0(r,0);if(!(e&1))return An(r,Gt()),null;var t=xg(r,e);if(r.tag!==0&&t===2){var n=S5(r);n!==0&&(e=n,t=K8(r,n))}if(t===1)throw t=Ff,sl(r,0),$a(r,e),An(r,Gt()),t;if(t===6)throw Error(ee(345));return r.finishedWork=r.current.alternate,r.finishedLanes=e,ol(r,xn,go),An(r,Gt()),null}function H8(r,e){var t=rt;rt|=1;try{return r(e)}finally{rt=t,rt===0&&(rd=Gt()+500,Y0&&Ca())}}function il(r){Pa!==null&&Pa.tag===0&&!(rt&6)&&nd();var e=rt;rt|=1;var t=bi.transition,n=ft;try{if(bi.transition=null,ft=1,r)return r()}finally{ft=n,bi.transition=t,rt=e,!(rt&6)&&Ca()}}function q8(){Gn=td.current,Pt(td)}function sl(r,e){r.finishedWork=null,r.finishedLanes=0;var t=r.timeoutHandle;if(t!==-1&&(r.timeoutHandle=-1,zW(t)),Xt!==null)for(t=Xt.return;t!==null;){var n=t;switch(t8(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&G0();break;case 3:Xu(),Pt(vn),Pt(Mr),p8();break;case 5:h8(n);break;case 4:Xu();break;case 13:Pt(Bt);break;case 19:Pt(Bt);break;case 10:a8(n.type._context);break;case 22:case 23:q8()}t=t.return}if(ur=r,Xt=r=Na(r.current,null),br=Gn=e,sr=0,Ff=null,U8=mg=nl=0,xn=zf=null,el!==null){for(e=0;e<el.length;e++)if(t=el[e],n=t.interleaved,n!==null){t.interleaved=null;var i=n.next,s=t.pending;if(s!==null){var o=s.next;s.next=i,n.next=o}t.pending=n}el=null}return r}function Kk(r,e){do{var t=Xt;try{if(o8(),og.current=ug,ag){for(var n=Ut.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}ag=!1}if(rl=0,lr=ir=Ut=null,Mf=!1,Of=0,B8.current=null,t===null||t.return===null){sr=1,Ff=e,Xt=null;break}e:{var s=r,o=t.return,a=t,c=e;if(e=br,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,d=a,h=d.tag;if(!(d.mode&1)&&(h===0||h===11||h===15)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var m=pk(o);if(m!==null){m.flags&=-257,gk(m,o,a,s,e),m.mode&1&&fk(s,l,e),e=m,c=l;var f=e.updateQueue;if(f===null){var g=new Set;g.add(c),e.updateQueue=g}else f.add(c);break e}else{if(!(e&1)){fk(s,l,e),W8();break e}c=Error(ee(426))}}else if(Mt&&a.mode&1){var v=pk(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),gk(v,o,a,s,e),i8(Zu(c,a));break e}}s=c=Zu(c,a),sr!==4&&(sr=2),zf===null?zf=[s]:zf.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var y=dk(s,c,e);BI(s,y);break e;case 1:a=c;var w=s.type,b=s.stateNode;if(!(s.flags&128)&&(typeof w.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Ta===null||!Ta.has(b)))){s.flags|=65536,e&=-e,s.lanes|=e;var E=hk(s,a,e);BI(s,E);break e}}s=s.return}while(s!==null)}qk(t)}catch(A){e=A,Xt===t&&t!==null&&(Xt=t=t.return);continue}break}while(!0)}function jk(){var r=yg.current;return yg.current=ug,r===null?ug:r}function W8(){(sr===0||sr===3||sr===2)&&(sr=4),ur===null||!(nl&268435455)&&!(mg&268435455)||$a(ur,br)}function xg(r,e){var t=rt;rt|=2;var n=jk();(ur!==r||br!==e)&&(go=null,sl(r,e));do try{hG();break}catch(i){Kk(r,i)}while(!0);if(o8(),rt=t,yg.current=n,Xt!==null)throw Error(ee(261));return ur=null,br=0,sr}function hG(){for(;Xt!==null;)Hk(Xt)}function fG(){for(;Xt!==null&&!Bq();)Hk(Xt)}function Hk(r){var e=Qk(r.alternate,r,Gn);r.memoizedProps=r.pendingProps,e===null?qk(r):Xt=e,B8.current=null}function qk(r){var e=r;do{var t=e.alternate;if(r=e.return,e.flags&32768){if(t=oG(t,e),t!==null){t.flags&=32767,Xt=t;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{sr=6,Xt=null;return}}else if(t=sG(t,e,Gn),t!==null){Xt=t;return}if(e=e.sibling,e!==null){Xt=e;return}Xt=e=r}while(e!==null);sr===0&&(sr=5)}function ol(r,e,t){var n=ft,i=bi.transition;try{bi.transition=null,ft=1,pG(r,e,t,n)}finally{bi.transition=i,ft=n}return null}function pG(r,e,t,n){do nd();while(Pa!==null);if(rt&6)throw Error(ee(327));t=r.finishedWork;var i=r.finishedLanes;if(t===null)return null;if(r.finishedWork=null,r.finishedLanes=0,t===r.current)throw Error(ee(177));r.callbackNode=null,r.callbackPriority=0;var s=t.lanes|t.childLanes;if(Gq(r,s),r===ur&&(Xt=ur=null,br=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||bg||(bg=!0,Yk(k0,function(){return nd(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=bi.transition,bi.transition=null;var o=ft;ft=1;var a=rt;rt|=4,B8.current=null,cG(r,t),Rk(t,r),MW(W5),M0=!!q5,W5=q5=null,r.current=t,lG(t),Uq(),rt=a,ft=o,bi.transition=s}else r.current=t;if(bg&&(bg=!1,Pa=r,vg=i),s=r.pendingLanes,s===0&&(Ta=null),Vq(t.stateNode),An(r,Gt()),e!==null)for(n=r.onRecoverableError,t=0;t<e.length;t++)i=e[t],n(i.value,{componentStack:i.stack,digest:i.digest});if(wg)throw wg=!1,r=z8,z8=null,r;return vg&1&&r.tag!==0&&nd(),s=r.pendingLanes,s&1?r===V8?Vf++:(Vf=0,V8=r):Vf=0,Ca(),null}function nd(){if(Pa!==null){var r=MC(vg),e=bi.transition,t=ft;try{if(bi.transition=null,ft=16>r?16:r,Pa===null)var n=!1;else{if(r=Pa,Pa=null,vg=0,rt&6)throw Error(ee(331));var i=rt;for(rt|=4,be=r.current;be!==null;){var s=be,o=s.child;if(be.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(be=l;be!==null;){var d=be;switch(d.tag){case 0:case 11:case 15:Uf(8,d,s)}var h=d.child;if(h!==null)h.return=d,be=h;else for(;be!==null;){d=be;var p=d.sibling,m=d.return;if(Dk(d),d===l){be=null;break}if(p!==null){p.return=m,be=p;break}be=m}}}var f=s.alternate;if(f!==null){var g=f.child;if(g!==null){f.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(g!==null)}}be=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,be=o;else e:for(;be!==null;){if(s=be,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Uf(9,s,s.return)}var y=s.sibling;if(y!==null){y.return=s.return,be=y;break e}be=s.return}}var w=r.current;for(be=w;be!==null;){o=be;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,be=b;else e:for(o=w;be!==null;){if(a=be,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:gg(9,a)}}catch(A){Ht(a,a.return,A)}if(a===o){be=null;break e}var E=a.sibling;if(E!==null){E.return=a.return,be=E;break e}be=a.return}}if(rt=i,Ca(),Es&&typeof Es.onPostCommitFiberRoot=="function")try{Es.onPostCommitFiberRoot(_0,r)}catch{}n=!0}return n}finally{ft=t,bi.transition=e}}return!1}function Wk(r,e,t){e=Zu(t,e),e=dk(r,e,1),r=ka(r,e,1),e=cn(),r!==null&&(hf(r,1,e),An(r,e))}function Ht(r,e,t){if(r.tag===3)Wk(r,r,t);else for(;e!==null;){if(e.tag===3){Wk(e,r,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Ta===null||!Ta.has(n))){r=Zu(t,r),r=hk(e,r,1),e=ka(e,r,1),r=cn(),e!==null&&(hf(e,1,r),An(e,r));break}}e=e.return}}function gG(r,e,t){var n=r.pingCache;n!==null&&n.delete(e),e=cn(),r.pingedLanes|=r.suspendedLanes&t,ur===r&&(br&t)===t&&(sr===4||sr===3&&(br&130023424)===br&&500>Gt()-F8?sl(r,0):U8|=t),An(r,e)}function Gk(r,e){e===0&&(r.mode&1?(e=P0,P0<<=1,!(P0&130023424)&&(P0=4194304)):e=1);var t=cn();r=ho(r,e),r!==null&&(hf(r,e,t),An(r,t))}function yG(r){var e=r.memoizedState,t=0;e!==null&&(t=e.retryLane),Gk(r,t)}function mG(r,e){var t=0;switch(r.tag){case 13:var n=r.stateNode,i=r.memoizedState;i!==null&&(t=i.retryLane);break;case 19:n=r.stateNode;break;default:throw Error(ee(314))}n!==null&&n.delete(e),Gk(r,t)}var Qk;Qk=function(r,e,t){if(r!==null)if(r.memoizedProps!==e.pendingProps||vn.current)Sn=!0;else{if(!(r.lanes&t)&&!(e.flags&128))return Sn=!1,iG(r,e,t);Sn=!!(r.flags&131072)}else Sn=!1,Mt&&e.flags&1048576&&_I(e,X0,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;fg(r,e),r=e.pendingProps;var i=Hu(e,Mr.current);Ju(e,t),i=m8(null,e,n,r,i,t);var s=w8();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,En(n)?(s=!0,Q0(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,u8(e),i.updater=dg,e.stateNode=i,i._reactInternals=e,A8(e,n,r,t),e=_8(null,e,n,!0,s,t)):(e.tag=0,Mt&&s&&e8(e),an(null,e,i,t),e=e.child),e;case 16:n=e.elementType;e:{switch(fg(r,e),r=e.pendingProps,i=n._init,n=i(n._payload),e.type=n,i=e.tag=bG(n),r=qi(n,r),i){case 0:e=k8(null,e,n,r,t);break e;case 1:e=Ek(null,e,n,r,t);break e;case 11:e=yk(null,e,n,r,t);break e;case 14:e=mk(null,e,n,qi(n.type,r),t);break e}throw Error(ee(306,n,""))}return e;case 0:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:qi(n,i),k8(r,e,n,i,t);case 1:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:qi(n,i),Ek(r,e,n,i,t);case 3:e:{if(Sk(e),r===null)throw Error(ee(387));n=e.pendingProps,s=e.memoizedState,i=s.element,LI(r,e),ig(e,n,null,t);var o=e.memoizedState;if(n=o.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Zu(Error(ee(423)),e),e=xk(r,e,n,t,i);break e}else if(n!==i){i=Zu(Error(ee(424)),e),e=xk(r,e,n,t,i);break e}else for(Wn=Sa(e.stateNode.containerInfo.firstChild),qn=e,Mt=!0,Hi=null,t=OI(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Gu(),n===i){e=po(r,e,t);break e}an(r,e,n,t)}e=e.child}return e;case 5:return FI(e),r===null&&n8(e),n=e.type,i=e.pendingProps,s=r!==null?r.memoizedProps:null,o=i.children,G5(n,i)?o=null:s!==null&&G5(n,s)&&(e.flags|=32),vk(r,e),an(r,e,o,t),e.child;case 6:return r===null&&n8(e),null;case 13:return Ak(r,e,t);case 4:return d8(e,e.stateNode.containerInfo),n=e.pendingProps,r===null?e.child=Qu(e,null,n,t):an(r,e,n,t),e.child;case 11:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:qi(n,i),yk(r,e,n,i,t);case 7:return an(r,e,e.pendingProps,t),e.child;case 8:return an(r,e,e.pendingProps.children,t),e.child;case 12:return an(r,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,vt(tg,n._currentValue),n._currentValue=o,s!==null)if(ji(s.value,o)){if(s.children===i.children&&!vn.current){e=po(r,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===n){if(s.tag===1){c=fo(-1,t&-t),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var d=l.pending;d===null?c.next=c:(c.next=d.next,d.next=c),l.pending=c}}s.lanes|=t,c=s.alternate,c!==null&&(c.lanes|=t),c8(s.return,t,e),a.lanes|=t;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(ee(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),c8(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}an(r,e,i.children,t),e=e.child}return e;case 9:return i=e.type,n=e.pendingProps.children,Ju(e,t),i=mi(i),n=n(i),e.flags|=1,an(r,e,n,t),e.child;case 14:return n=e.type,i=qi(n,e.pendingProps),i=qi(n.type,i),mk(r,e,n,i,t);case 15:return wk(r,e,e.type,e.pendingProps,t);case 17:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:qi(n,i),fg(r,e),e.tag=1,En(n)?(r=!0,Q0(e)):r=!1,Ju(e,t),lk(e,n,i),A8(e,n,i,t),_8(null,e,n,!0,r,t);case 19:return Ik(r,e,t);case 22:return bk(r,e,t)}throw Error(ee(156,e.tag))};function Yk(r,e){return TC(r,e)}function wG(r,e,t,n){this.tag=r,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vi(r,e,t,n){return new wG(r,e,t,n)}function G8(r){return r=r.prototype,!(!r||!r.isReactComponent)}function bG(r){if(typeof r=="function")return G8(r)?1:0;if(r!=null){if(r=r.$$typeof,r===e5)return 11;if(r===n5)return 14}return 2}function Na(r,e){var t=r.alternate;return t===null?(t=vi(r.tag,e,r.key,r.mode),t.elementType=r.elementType,t.type=r.type,t.stateNode=r.stateNode,t.alternate=r,r.alternate=t):(t.pendingProps=e,t.type=r.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=r.flags&14680064,t.childLanes=r.childLanes,t.lanes=r.lanes,t.child=r.child,t.memoizedProps=r.memoizedProps,t.memoizedState=r.memoizedState,t.updateQueue=r.updateQueue,e=r.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=r.sibling,t.index=r.index,t.ref=r.ref,t}function Ag(r,e,t,n,i,s){var o=2;if(n=r,typeof r=="function")G8(r)&&(o=1);else if(typeof r=="string")o=5;else e:switch(r){case $u:return al(t.children,i,s,e);case X4:o=8,i|=8;break;case Z4:return r=vi(12,t,e,i|2),r.elementType=Z4,r.lanes=s,r;case t5:return r=vi(13,t,e,i),r.elementType=t5,r.lanes=s,r;case r5:return r=vi(19,t,e,i),r.elementType=r5,r.lanes=s,r;case sC:return Cg(t,i,s,e);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case nC:o=10;break e;case iC:o=9;break e;case e5:o=11;break e;case n5:o=14;break e;case pa:o=16,n=null;break e}throw Error(ee(130,r==null?r:typeof r,""))}return e=vi(o,t,e,i),e.elementType=r,e.type=n,e.lanes=s,e}function al(r,e,t,n){return r=vi(7,r,n,e),r.lanes=t,r}function Cg(r,e,t,n){return r=vi(22,r,n,e),r.elementType=sC,r.lanes=t,r.stateNode={isHidden:!1},r}function Q8(r,e,t){return r=vi(6,r,null,e),r.lanes=t,r}function Y8(r,e,t){return e=vi(4,r.children!==null?r.children:[],r.key,e),e.lanes=t,e.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},e}function vG(r,e,t,n,i){this.tag=e,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=x5(0),this.expirationTimes=x5(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=x5(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function J8(r,e,t,n,i,s,o,a,c){return r=new vG(r,e,t,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=vi(3,null,null,e),r.current=s,s.stateNode=r,s.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},u8(s),r}function EG(r,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Du,key:n==null?null:""+n,children:r,containerInfo:e,implementation:t}}function Jk(r){if(!r)return Aa;r=r._reactInternals;e:{if(Qc(r)!==r||r.tag!==1)throw Error(ee(170));var e=r;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(En(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ee(171))}if(r.tag===1){var t=r.type;if(En(t))return CI(r,t,e)}return e}function Xk(r,e,t,n,i,s,o,a,c){return r=J8(t,n,!0,r,i,s,o,a,c),r.context=Jk(null),t=r.current,n=cn(),i=Da(t),s=fo(n,i),s.callback=e??null,ka(t,s,i),r.current.lanes=i,hf(r,i,n),An(r,n),r}function Ig(r,e,t,n){var i=e.current,s=cn(),o=Da(i);return t=Jk(t),e.context===null?e.context=t:e.pendingContext=t,e=fo(s,o),e.payload={element:r},n=n===void 0?null:n,n!==null&&(e.callback=n),r=ka(i,e,o),r!==null&&(Qi(r,i,o,s),ng(r,i,o)),o}function kg(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function Zk(r,e){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var t=r.retryLane;r.retryLane=t!==0&&t<e?t:e}}function X8(r,e){Zk(r,e),(r=r.alternate)&&Zk(r,e)}function SG(){return null}var e_=typeof reportError=="function"?reportError:function(r){console.error(r)};function Z8(r){this._internalRoot=r}_g.prototype.render=Z8.prototype.render=function(r){var e=this._internalRoot;if(e===null)throw Error(ee(409));Ig(r,e,null,null)},_g.prototype.unmount=Z8.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var e=r.containerInfo;il(function(){Ig(null,r,null,null)}),e[ao]=null}};function _g(r){this._internalRoot=r}_g.prototype.unstable_scheduleHydration=function(r){if(r){var e=LC();r={blockedOn:null,target:r,priority:e};for(var t=0;t<ba.length&&e!==0&&e<ba[t].priority;t++);ba.splice(t,0,r),t===0&&FC(r)}};function e6(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Tg(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function t_(){}function xG(r,e,t,n,i){if(i){if(typeof n=="function"){var s=n;n=function(){var l=kg(o);s.call(l)}}var o=Xk(e,n,r,0,null,!1,!1,"",t_);return r._reactRootContainer=o,r[ao]=o.current,If(r.nodeType===8?r.parentNode:r),il(),o}for(;i=r.lastChild;)r.removeChild(i);if(typeof n=="function"){var a=n;n=function(){var l=kg(c);a.call(l)}}var c=J8(r,0,!1,null,null,!1,!1,"",t_);return r._reactRootContainer=c,r[ao]=c.current,If(r.nodeType===8?r.parentNode:r),il(function(){Ig(e,c,t,n)}),c}function Pg(r,e,t,n,i){var s=t._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var c=kg(o);a.call(c)}}Ig(e,o,r,i)}else o=xG(t,e,r,i,n);return kg(o)}OC=function(r){switch(r.tag){case 3:var e=r.stateNode;if(e.current.memoizedState.isDehydrated){var t=df(e.pendingLanes);t!==0&&(A5(e,t|1),An(e,Gt()),!(rt&6)&&(rd=Gt()+500,Ca()))}break;case 13:il(function(){var n=ho(r,1);if(n!==null){var i=cn();Qi(n,r,1,i)}}),X8(r,1)}},C5=function(r){if(r.tag===13){var e=ho(r,134217728);if(e!==null){var t=cn();Qi(e,r,134217728,t)}X8(r,134217728)}},RC=function(r){if(r.tag===13){var e=Da(r),t=ho(r,e);if(t!==null){var n=cn();Qi(t,r,e,n)}X8(r,e)}},LC=function(){return ft},BC=function(r,e){var t=ft;try{return ft=r,e()}finally{ft=t}},m5=function(r,e,t){switch(e){case"input":if(l5(r,t),e=t.name,t.type==="radio"&&e!=null){for(t=r;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==r&&n.form===r.form){var i=W0(n);if(!i)throw Error(ee(90));cC(n),l5(n,i)}}}break;case"textarea":fC(r,t);break;case"select":e=t.value,e!=null&&Nu(r,!!t.multiple,e,!1)}},SC=H8,xC=il;var AG={usingClientEntryPoint:!1,Events:[Tf,Ku,W0,vC,EC,H8]},Kf={findFiberByHostInstance:Yc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},CG={bundleType:Kf.bundleType,version:Kf.version,rendererPackageName:Kf.rendererPackageName,rendererConfig:Kf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:oo.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=kC(r),r===null?null:r.stateNode},findFiberByHostInstance:Kf.findFiberByHostInstance||SG,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Dg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Dg.isDisabled&&Dg.supportsFiber)try{_0=Dg.inject(CG),Es=Dg}catch{}}Kn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=AG,Kn.createPortal=function(r,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!e6(e))throw Error(ee(200));return EG(r,e,null,t)},Kn.createRoot=function(r,e){if(!e6(r))throw Error(ee(299));var t=!1,n="",i=e_;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=J8(r,1,!1,null,null,t,!1,n,i),r[ao]=e.current,If(r.nodeType===8?r.parentNode:r),new Z8(e)},Kn.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var e=r._reactInternals;if(e===void 0)throw typeof r.render=="function"?Error(ee(188)):(r=Object.keys(r).join(","),Error(ee(268,r)));return r=kC(e),r=r===null?null:r.stateNode,r},Kn.flushSync=function(r){return il(r)},Kn.hydrate=function(r,e,t){if(!Tg(e))throw Error(ee(200));return Pg(null,r,e,!0,t)},Kn.hydrateRoot=function(r,e,t){if(!e6(r))throw Error(ee(405));var n=t!=null&&t.hydratedSources||null,i=!1,s="",o=e_;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=Xk(e,null,r,1,t??null,i,!1,s,o),r[ao]=e.current,If(r),n)for(r=0;r<n.length;r++)t=n[r],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new _g(e)},Kn.render=function(r,e,t){if(!Tg(e))throw Error(ee(200));return Pg(null,r,e,!1,t)},Kn.unmountComponentAtNode=function(r){if(!Tg(r))throw Error(ee(40));return r._reactRootContainer?(il(function(){Pg(null,null,r,!1,function(){r._reactRootContainer=null,r[ao]=null})}),!0):!1},Kn.unstable_batchedUpdates=H8,Kn.unstable_renderSubtreeIntoContainer=function(r,e,t,n){if(!Tg(t))throw Error(ee(200));if(r==null||r._reactInternals===void 0)throw Error(ee(38));return Pg(r,e,t,!1,n)},Kn.version="18.3.1-next-f1338f8080-20240426";function r_(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r_)}catch(r){console.error(r)}}r_(),JA.exports=Kn;var IG=JA.exports,n_,i_=IG;n_=i_.createRoot,i_.hydrateRoot;var t6={exports:{}},id=typeof Reflect=="object"?Reflect:null,s_=id&&typeof id.apply=="function"?id.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},$g;id&&typeof id.ownKeys=="function"?$g=id.ownKeys:Object.getOwnPropertySymbols?$g=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:$g=function(e){return Object.getOwnPropertyNames(e)};function kG(r){console&&console.warn&&console.warn(r)}var o_=Number.isNaN||function(e){return e!==e};function gt(){gt.init.call(this)}t6.exports=gt,t6.exports.once=DG,gt.EventEmitter=gt,gt.prototype._events=void 0,gt.prototype._eventsCount=0,gt.prototype._maxListeners=void 0;var a_=10;function Ng(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(gt,"defaultMaxListeners",{enumerable:!0,get:function(){return a_},set:function(r){if(typeof r!="number"||r<0||o_(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");a_=r}}),gt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},gt.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||o_(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function c_(r){return r._maxListeners===void 0?gt.defaultMaxListeners:r._maxListeners}gt.prototype.getMaxListeners=function(){return c_(this)},gt.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")s_(c,this,t);else for(var l=c.length,d=f_(c,l),n=0;n<l;++n)s_(d[n],this,t);return!0};function l_(r,e,t,n){var i,s,o;if(Ng(t),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),s=r._events),o=s[e]),o===void 0)o=s[e]=t,++r._eventsCount;else if(typeof o=="function"?o=s[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),i=c_(r),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=o.length,kG(a)}return r}gt.prototype.addListener=function(e,t){return l_(this,e,t,!1)},gt.prototype.on=gt.prototype.addListener,gt.prototype.prependListener=function(e,t){return l_(this,e,t,!0)};function _G(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u_(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=_G.bind(n);return i.listener=t,n.wrapFn=i,i}gt.prototype.once=function(e,t){return Ng(t),this.on(e,u_(this,e,t)),this},gt.prototype.prependOnceListener=function(e,t){return Ng(t),this.prependListener(e,u_(this,e,t)),this},gt.prototype.removeListener=function(e,t){var n,i,s,o,a;if(Ng(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():TG(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this},gt.prototype.off=gt.prototype.removeListener,gt.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function d_(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?PG(i):f_(i,i.length)}gt.prototype.listeners=function(e){return d_(this,e,!0)},gt.prototype.rawListeners=function(e){return d_(this,e,!1)},gt.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):h_.call(r,e)},gt.prototype.listenerCount=h_;function h_(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}gt.prototype.eventNames=function(){return this._eventsCount>0?$g(this._events):[]};function f_(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function TG(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function PG(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function DG(r,e){return new Promise(function(t,n){function i(o){r.removeListener(e,s),n(o)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}p_(r,e,s,{once:!0}),e!=="error"&&$G(r,i,{once:!0})})}function $G(r,e,t){typeof r.on=="function"&&p_(r,"error",e,t)}function p_(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(s){n.once&&r.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var Mg=t6.exports,g_={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(c,l,d){this.fn=c,this.context=l,this.once=d||!1}function s(c,l,d,h,p){if(typeof d!="function")throw new TypeError("The listener must be a function");var m=new i(d,h||c,p),f=t?t+l:l;return c._events[f]?c._events[f].fn?c._events[f]=[c._events[f],m]:c._events[f].push(m):(c._events[f]=m,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new n:delete c._events[l]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],d,h;if(this._eventsCount===0)return l;for(h in d=this._events)e.call(d,h)&&l.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},a.prototype.listeners=function(l){var d=t?t+l:l,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var p=0,m=h.length,f=new Array(m);p<m;p++)f[p]=h[p].fn;return f},a.prototype.listenerCount=function(l){var d=t?t+l:l,h=this._events[d];return h?h.fn?1:h.length:0},a.prototype.emit=function(l,d,h,p,m,f){var g=t?t+l:l;if(!this._events[g])return!1;var v=this._events[g],y=arguments.length,w,b;if(v.fn){switch(v.once&&this.removeListener(l,v.fn,void 0,!0),y){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,d),!0;case 3:return v.fn.call(v.context,d,h),!0;case 4:return v.fn.call(v.context,d,h,p),!0;case 5:return v.fn.call(v.context,d,h,p,m),!0;case 6:return v.fn.call(v.context,d,h,p,m,f),!0}for(b=1,w=new Array(y-1);b<y;b++)w[b-1]=arguments[b];v.fn.apply(v.context,w)}else{var E=v.length,A;for(b=0;b<E;b++)switch(v[b].once&&this.removeListener(l,v[b].fn,void 0,!0),y){case 1:v[b].fn.call(v[b].context);break;case 2:v[b].fn.call(v[b].context,d);break;case 3:v[b].fn.call(v[b].context,d,h);break;case 4:v[b].fn.call(v[b].context,d,h,p);break;default:if(!w)for(A=1,w=new Array(y-1);A<y;A++)w[A-1]=arguments[A];v[b].fn.apply(v[b].context,w)}}return!0},a.prototype.on=function(l,d,h){return s(this,l,d,h,!1)},a.prototype.once=function(l,d,h){return s(this,l,d,h,!0)},a.prototype.removeListener=function(l,d,h,p){var m=t?t+l:l;if(!this._events[m])return this;if(!d)return o(this,m),this;var f=this._events[m];if(f.fn)f.fn===d&&(!p||f.once)&&(!h||f.context===h)&&o(this,m);else{for(var g=0,v=[],y=f.length;g<y;g++)(f[g].fn!==d||p&&!f[g].once||h&&f[g].context!==h)&&v.push(f[g]);v.length?this._events[m]=v.length===1?v[0]:v:o(this,m)}return this},a.prototype.removeAllListeners=function(l){var d;return l?(d=t?t+l:l,this._events[d]&&o(this,d)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a})(g_);var NG=g_.exports;const MG=Ze(NG);let y_=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},OG=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const m_=r=>globalThis.DOMException===void 0?new OG(r):new DOMException(r),w_=r=>{const e=r.reason===void 0?m_("This operation was aborted."):r.reason;return e instanceof Error?e:m_(e)};function jf(r,e){const{milliseconds:t,fallback:n,message:i,customTimers:s={setTimeout,clearTimeout}}=e;let o,a;const l=new Promise((d,h)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:m}=e;m.aborted&&h(w_(m)),a=()=>{h(w_(m))},m.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){r.then(d,h);return}const p=new y_;o=s.setTimeout.call(void 0,()=>{if(n){try{d(n())}catch(m){h(m)}return}typeof r.cancel=="function"&&r.cancel(),i===!1?d():i instanceof Error?h(i):(p.message=i??`Promise timed out after ${t} milliseconds`,h(p))},t),(async()=>{try{d(await r)}catch(m){h(m)}})()}).finally(()=>{l.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return l.clear=()=>{s.clearTimeout.call(void 0,o),o=void 0},l}function RG(r,e,t){let n=0,i=r.length;for(;i>0;){const s=Math.trunc(i/2);let o=n+s;t(r[o],e)<=0?(n=++o,i-=s+1):i=s}return n}let LG=(bj=class{constructor(){Je(this,Fi,[])}enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,id:t.id,run:e};if(this.size===0||oe(this,Fi)[this.size-1].priority>=t.priority){oe(this,Fi).push(n);return}const i=RG(oe(this,Fi),n,(s,o)=>o.priority-s.priority);oe(this,Fi).splice(i,0,n)}setPriority(e,t){const n=oe(this,Fi).findIndex(s=>s.id===e);if(n===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[i]=oe(this,Fi).splice(n,1);this.enqueue(i.run,{priority:t,id:e})}dequeue(){const e=oe(this,Fi).shift();return e==null?void 0:e.run}filter(e){return oe(this,Fi).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return oe(this,Fi).length}},Fi=new WeakMap,bj);class Ma extends MG{constructor(t){var n,i;super();Je(this,lt);Je(this,Vh);Je(this,Kh);Je(this,jc,0);Je(this,o0);Je(this,jh);Je(this,a0,0);Je(this,zi);Je(this,Hh);Je(this,mn);Je(this,c0);Je(this,Vi,0);Je(this,qh);Je(this,ua);Je(this,l0);Je(this,D4,1n);u(this,"timeout");if(t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:LG,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((n=t.intervalCap)==null?void 0:n.toString())??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((i=t.interval)==null?void 0:i.toString())??""}\` (${typeof t.interval})`);_t(this,Vh,t.carryoverConcurrencyCount),_t(this,Kh,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),_t(this,o0,t.intervalCap),_t(this,jh,t.interval),_t(this,mn,new t.queueClass),_t(this,c0,t.queueClass),this.concurrency=t.concurrency,this.timeout=t.timeout,_t(this,l0,t.throwOnTimeout===!0),_t(this,ua,t.autoStart===!1)}get concurrency(){return oe(this,qh)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);_t(this,qh,t),Ie(this,lt,O4).call(this)}setPriority(t,n){oe(this,mn).setPriority(t,n)}async add(t,n={}){return n.id??(n.id=(no(this,D4)._++).toString()),n={timeout:this.timeout,throwOnTimeout:oe(this,l0),...n},new Promise((i,s)=>{oe(this,mn).enqueue(async()=>{var o;no(this,Vi)._++,no(this,jc)._++;try{(o=n.signal)==null||o.throwIfAborted();let a=t({signal:n.signal});n.timeout&&(a=jf(Promise.resolve(a),{milliseconds:n.timeout})),n.signal&&(a=Promise.race([a,Ie(this,lt,JH).call(this,n.signal)]));const c=await a;i(c),this.emit("completed",c)}catch(a){if(a instanceof y_&&!n.throwOnTimeout){i();return}s(a),this.emit("error",a)}finally{Ie(this,lt,GH).call(this)}},n),this.emit("add"),Ie(this,lt,M4).call(this)})}async addAll(t,n){return Promise.all(t.map(async i=>this.add(i,n)))}start(){return oe(this,ua)?(_t(this,ua,!1),Ie(this,lt,O4).call(this),this):this}pause(){_t(this,ua,!0)}clear(){_t(this,mn,new(oe(this,c0)))}async onEmpty(){oe(this,mn).size!==0&&await Ie(this,lt,R4).call(this,"empty")}async onSizeLessThan(t){oe(this,mn).size<t||await Ie(this,lt,R4).call(this,"next",()=>oe(this,mn).size<t)}async onIdle(){oe(this,Vi)===0&&oe(this,mn).size===0||await Ie(this,lt,R4).call(this,"idle")}get size(){return oe(this,mn).size}sizeBy(t){return oe(this,mn).filter(t).length}get pending(){return oe(this,Vi)}get isPaused(){return oe(this,ua)}}Vh=new WeakMap,Kh=new WeakMap,jc=new WeakMap,o0=new WeakMap,jh=new WeakMap,a0=new WeakMap,zi=new WeakMap,Hh=new WeakMap,mn=new WeakMap,c0=new WeakMap,Vi=new WeakMap,qh=new WeakMap,ua=new WeakMap,l0=new WeakMap,D4=new WeakMap,lt=new WeakSet,qH=function(){return oe(this,Kh)||oe(this,jc)<oe(this,o0)},WH=function(){return oe(this,Vi)<oe(this,qh)},GH=function(){no(this,Vi)._--,Ie(this,lt,M4).call(this),this.emit("next")},QH=function(){Ie(this,lt,OA).call(this),Ie(this,lt,MA).call(this),_t(this,Hh,void 0)},YH=function(){const t=Date.now();if(oe(this,zi)===void 0){const n=oe(this,a0)-t;if(n<0)_t(this,jc,oe(this,Vh)?oe(this,Vi):0);else return oe(this,Hh)===void 0&&_t(this,Hh,setTimeout(()=>{Ie(this,lt,QH).call(this)},n)),!0}return!1},M4=function(){if(oe(this,mn).size===0)return oe(this,zi)&&clearInterval(oe(this,zi)),_t(this,zi,void 0),this.emit("empty"),oe(this,Vi)===0&&this.emit("idle"),!1;if(!oe(this,ua)){const t=!oe(this,lt,YH);if(oe(this,lt,qH)&&oe(this,lt,WH)){const n=oe(this,mn).dequeue();return n?(this.emit("active"),n(),t&&Ie(this,lt,MA).call(this),!0):!1}}return!1},MA=function(){oe(this,Kh)||oe(this,zi)!==void 0||(_t(this,zi,setInterval(()=>{Ie(this,lt,OA).call(this)},oe(this,jh))),_t(this,a0,Date.now()+oe(this,jh)))},OA=function(){oe(this,jc)===0&&oe(this,Vi)===0&&oe(this,zi)&&(clearInterval(oe(this,zi)),_t(this,zi,void 0)),_t(this,jc,oe(this,Vh)?oe(this,Vi):0),Ie(this,lt,O4).call(this)},O4=function(){for(;Ie(this,lt,M4).call(this););},JH=async function(t){return new Promise((n,i)=>{t.addEventListener("abort",()=>{i(t.reason)},{once:!0})})},R4=async function(t,n){return new Promise(i=>{const s=()=>{n&&!n()||(this.off(t,s),i())};this.on(t,s)})};function Le(){const r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}class b_{constructor(e){u(this,"buffer");u(this,"mask");u(this,"top");u(this,"btm");u(this,"next");if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class r6{constructor(e={}){u(this,"size");u(this,"hwm");u(this,"head");u(this,"tail");this.hwm=e.splitLimit??16,this.head=new b_(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new b_(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let BG=class extends Error{constructor(t,n){super(t??"The operation was aborted");u(this,"type");u(this,"code");this.type="aborted",this.code=n??"ABORT_ERR"}};function yo(r={}){return UG(t=>{const n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function UG(r,e){e=e??{};let t=e.onEnd,n=new r6,i,s,o,a=Le();const c=async()=>{try{return n.isEmpty()?o?{done:!0}:await new Promise((v,y)=>{s=w=>{s=null,n.push(w);try{v(r(n))}catch(b){y(b)}return i}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=Le()})}},l=v=>s!=null?s(v):(n.push(v),i),d=v=>(n=new r6,s!=null?s({error:v}):(n.push({error:v}),i)),h=v=>{if(o)return i;if((e==null?void 0:e.objectMode)!==!0&&(v==null?void 0:v.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:v})},p=v=>o?i:(o=!0,v!=null?d(v):l({done:!0})),m=()=>(n=new r6,p(),{done:!0}),f=v=>(p(v),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:c,return:m,throw:f,push:h,end:p,get readableLength(){return n.size},onEmpty:async v=>{const y=v==null?void 0:v.signal;if(y==null||y.throwIfAborted(),n.isEmpty())return;let w,b;y!=null&&(w=new Promise((E,A)=>{b=()=>{A(new BG)},y.addEventListener("abort",b)}));try{await Promise.race([a.promise,w])}finally{b!=null&&y!=null&&(y==null||y.removeEventListener("abort",b))}}},t==null)return i;const g=i;return i={[Symbol.asyncIterator](){return this},next(){return g.next()},throw(v){return g.throw(v),t!=null&&(t(v),t=void 0),{done:!0}},return(){return g.return(),t!=null&&(t(),t=void 0),{done:!0}},push:h,end(v){return g.end(v),t!=null&&(t(v),t=void 0),i},get readableLength(){return g.readableLength},onEmpty:v=>g.onEmpty(v)},i}let v_=class extends Error{constructor(t,n,i){super(t??"The operation was aborted");u(this,"type");u(this,"code");this.type="aborted",this.name=i??"AbortError",this.code=n??"ABORT_ERR"}};async function ln(r,e,t){if(e==null)return r;if(e.aborted)return r.catch(()=>{}),Promise.reject(new v_(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName));let n;const i=new v_(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName);try{return await Promise.race([r,new Promise((s,o)=>{n=()=>{o(i)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}}let FG=class{constructor(){u(this,"readNext");u(this,"haveNext");u(this,"ended");u(this,"nextResult");u(this,"error");this.ended=!1,this.readNext=Le(),this.haveNext=Le()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Le(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Le(),await ln(this.readNext.promise,t==null?void 0:t.signal,t)}};function zG(){return new FG}function VG(r){return r[Symbol.asyncIterator]!=null}async function KG(r,e){try{await Promise.all(r.map(async t=>{for await(const n of t)await e.push(n)})),await e.end()}catch(t){await e.end(t).catch(()=>{})}}async function*jG(r){const e=zG();KG(r,e).catch(()=>{}),yield*e}function*HG(r){for(const e of r)yield*e}function Oa(...r){const e=[];for(const t of r)VG(t)||e.push(t);return e.length===r.length?HG(e):jG(r)}function un(r,...e){if(r==null)throw new Error("Empty pipeline");if(n6(r)){const n=r;r=()=>n.source}else if(S_(r)||E_(r)){const n=r;r=()=>n}const t=[r,...e];if(t.length>1&&n6(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)n6(t[n])&&(t[n]=WG(t[n]));return qG(...t)}const qG=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},E_=r=>(r==null?void 0:r[Symbol.asyncIterator])!=null,S_=r=>(r==null?void 0:r[Symbol.iterator])!=null,n6=r=>r==null?!1:r.sink!=null&&r.source!=null,WG=r=>e=>{const t=r.sink(e);if((t==null?void 0:t.then)!=null){const n=yo({objectMode:!0});t.then(()=>{n.end()},o=>{n.end(o)});let i;const s=r.source;if(E_(s))i=async function*(){yield*s,n.end()};else if(S_(s))i=function*(){yield*s,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return Oa(n,i())}return r.source};var GG=function(){return Date.now()};const Og=GG;class QG{constructor(e,t,n){const i=this;this._started=Og(),this._rescheduled=0,this._scheduled=t,this._args=n,this._triggered=!1,this._timerWrapper=()=>{i._rescheduled>0?(i._scheduled=i._rescheduled-(Og()-i._started),i._schedule(i._scheduled)):(i._triggered=!0,e.apply(null,i._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);const t=Og();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=Og(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}}function YG(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("timeout needed");let r;if(arguments.length>0){r=new Array(arguments.length-2);for(var e=0;e<r.length;e++)r[e]=arguments[e+2]}return new QG(arguments[0],arguments[1],r)}var JG=YG;const{AbortController:XG}=globalThis,x_=JG;class i6 extends XG{constructor(e){super(),this._ms=e,this._timer=x_(()=>this.abort(),e),Object.setPrototypeOf(this,i6.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=x_(()=>this.abort(),this._ms)}}var s6={TimeoutController:i6};const Ra=(...r)=>r.join("/").replace(new RegExp("((?<=\\/)\\/+)|(^\\.\\/)|((?<=\\/)\\.\\/)","g"),"")||".",ZG=3e4,eQ=async({ipfs:r,log:e,events:t,onSynced:n,start:i,timeout:s})=>{if(!r)throw new Error("An instance of ipfs is required.");if(!e)throw new Error("An instance of log is required.");const o=r.libp2p,a=r.libp2p.services.pubsub,c=e.id,l=Ra("/orbitdb/heads/",c),d=new Ma({concurrency:1}),h=new Set;t=t||new Mg.EventEmitter,s=s||ZG;let p=!1;const m=async x=>{const I=await e.heads();t.emit("join",x,I)},f=x=>async function*(){const I=await e.heads();for await(const{bytes:T}of I)yield T}(),g=x=>async I=>{for await(const T of I){const L=T.subarray();L&&n&&await n(L)}p&&await m(x)},v=async({connection:x,stream:I})=>{const T=String(x.remotePeer);try{h.add(T),await un(I,g(T),f,I)}catch(L){h.delete(T),t.emit("error",L)}},y=async x=>{const I=async()=>{const{peerId:T,subscriptions:L}=x.detail,z=String(T),B=L.find(G=>G.topic===c);if(B)if(B.subscribe){if(h.has(z))return;const G=new s6.TimeoutController(s),{signal:j}=G;try{h.add(z);const q=await o.dialProtocol(T,l,{signal:j});await un(f,q,g(z))}catch(q){h.delete(z),q.name==="UnsupportedProtocolError"||t.emit("error",q)}finally{G&&G.clear()}}else h.delete(z),t.emit("leave",z)};d.add(I)},w=async x=>{const{topic:I,data:T}=x.detail,L=async()=>{try{T&&n&&await n(T)}catch(z){t.emit("error",z)}};I===c&&d.add(L)},b=async x=>{h.delete(x.detail.toString())},E=async x=>{p&&await a.publish(c,x.bytes)},A=async()=>{p&&(p=!1,await d.onIdle(),a.removeEventListener("subscription-change",y),a.removeEventListener("message",w),await o.unhandle(l),await a.unsubscribe(c),o.removeEventListener("peer:disconnect",b),h.clear())},k=async()=>{p||(await o.handle(l,v),a.addEventListener("subscription-change",y),a.addEventListener("message",w),await a.subscribe(c),o.addEventListener("peer:disconnect",b),p=!0)};return i!==!1&&await k(),{add:E,stop:A,start:k,events:t,peers:h}};var o6={exports:{}};typeof Object.create=="function"?o6.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:o6.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}};var tQ=o6.exports,A_=Mg,rQ=tQ,nQ=Qn;function Qn(r){if(!(this instanceof Qn))return new Qn(r);typeof r=="number"&&(r={max:r}),r||(r={}),A_.EventEmitter.call(this),this.cache={},this.head=this.tail=null,this.length=0,this.max=r.max||1e3,this.maxAge=r.maxAge||0}rQ(Qn,A_.EventEmitter),Object.defineProperty(Qn.prototype,"keys",{get:function(){return Object.keys(this.cache)}}),Qn.prototype.clear=function(){this.cache={},this.head=this.tail=null,this.length=0},Qn.prototype.remove=function(r){if(typeof r!="string"&&(r=""+r),!!this.cache.hasOwnProperty(r)){var e=this.cache[r];return delete this.cache[r],this._unlink(r,e.prev,e.next),e.value}},Qn.prototype._unlink=function(r,e,t){this.length--,this.length===0?this.head=this.tail=null:this.head===r?(this.head=e,this.cache[this.head].next=null):this.tail===r?(this.tail=t,this.cache[this.tail].prev=null):(this.cache[e].next=t,this.cache[t].prev=e)},Qn.prototype.peek=function(r){if(this.cache.hasOwnProperty(r)){var e=this.cache[r];if(this._checkAge(r,e))return e.value}},Qn.prototype.set=function(r,e){typeof r!="string"&&(r=""+r);var t;if(this.cache.hasOwnProperty(r)){if(t=this.cache[r],t.value=e,this.maxAge&&(t.modified=Date.now()),r===this.head)return e;this._unlink(r,t.prev,t.next)}else t={value:e,modified:0,next:null,prev:null},this.maxAge&&(t.modified=Date.now()),this.cache[r]=t,this.length===this.max&&this.evict();return this.length++,t.next=null,t.prev=this.head,this.head&&(this.cache[this.head].next=r),this.head=r,this.tail||(this.tail=r),e},Qn.prototype._checkAge=function(r,e){return this.maxAge&&Date.now()-e.modified>this.maxAge?(this.remove(r),this.emit("evict",{key:r,value:e.value}),!1):!0},Qn.prototype.get=function(r){if(typeof r!="string"&&(r=""+r),!!this.cache.hasOwnProperty(r)){var e=this.cache[r];if(this._checkAge(r,e))return this.head!==r&&(r===this.tail?(this.tail=e.next,this.cache[this.tail].prev=null):this.cache[e.prev].next=e.next,this.cache[e.next].prev=e.prev,this.cache[this.head].next=r,e.prev=this.head,e.next=null,this.head=r),e.value}},Qn.prototype.evict=function(){if(this.tail){var r=this.tail,e=this.remove(this.tail);this.emit("evict",{key:r,value:e})}};const a6=Ze(nQ),iQ=(r,e)=>{const t=r.time-e.time;return t===0&&r.id!==e.id?r.id<e.id?-1:1:t},sQ=r=>Rg(r.id,++r.time),Rg=(r,e)=>(e=e||0,{id:r,time:e}),oQ=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},c6=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};function aQ(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var cQ=aQ,lQ=cQ;let uQ=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},dQ=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return C_(this,e)}},hQ=class{constructor(e){this.decoders=e}or(e){return C_(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const C_=(r,e)=>new hQ({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let fQ=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new uQ(e,t,n),this.decoder=new dQ(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const I_=({name:r,prefix:e,encode:t,decode:n})=>new fQ(r,e,t,n),k_=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:i}=lQ(t,e);return I_({prefix:r,name:e,encode:n,decode:s=>c6(i(s))})},pQ=(r,e,t,n)=>{const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},gQ=(r,e,t)=>{const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s},mo=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>I_({prefix:e,name:r,encode(i){return gQ(i,n,t)},decode(i){return pQ(i,n,t,r)}}),Lg=mo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});mo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),mo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),mo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),mo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),mo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),mo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),mo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),mo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const dn=k_({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});k_({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var yQ=T_,__=128,mQ=-128,wQ=Math.pow(2,31);function T_(r,e,t){e=e||[],t=t||0;for(var n=t;r>=wQ;)e[t++]=r&255|__,r/=128;for(;r&mQ;)e[t++]=r&255|__,r>>>=7;return e[t]=r|0,T_.bytes=t-n+1,e}var bQ=l6,vQ=128,P_=127;function l6(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw l6.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&P_)<<i:(o&P_)*Math.pow(2,i),i+=7}while(o>=vQ);return l6.bytes=s-n,t}var EQ=Math.pow(2,7),SQ=Math.pow(2,14),xQ=Math.pow(2,21),AQ=Math.pow(2,28),CQ=Math.pow(2,35),IQ=Math.pow(2,42),kQ=Math.pow(2,49),_Q=Math.pow(2,56),TQ=Math.pow(2,63),PQ=function(r){return r<EQ?1:r<SQ?2:r<xQ?3:r<AQ?4:r<CQ?5:r<IQ?6:r<kQ?7:r<_Q?8:r<TQ?9:10},DQ={encode:yQ,decode:bQ,encodingLength:PQ},Bg=DQ;const u6=(r,e=0)=>[Bg.decode(r,e),Bg.decode.bytes],Ug=(r,e,t=0)=>(Bg.encode(r,e,t),e),Fg=r=>Bg.encodingLength(r),d6=(r,e)=>{const t=e.byteLength,n=Fg(r),i=n+Fg(t),s=new Uint8Array(i+t);return Ug(r,s,0),Ug(t,s,n),s.set(e,i),new h6(r,t,e,s)},$Q=r=>{const e=c6(r),[t,n]=u6(e),[i,s]=u6(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new h6(t,i,o,e)},NQ=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&oQ(r.bytes,t.bytes)}};let h6=class{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}};const D_=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return OQ(t,f6(r),e||dn.encoder);default:return RQ(t,f6(r),e||Lg.encoder)}},$_=new WeakMap,f6=r=>{const e=$_.get(r);if(e==null){const t=new Map;return $_.set(r,t),t}return e};let Yi=class jr{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Hf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==LQ)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return jr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=d6(e,t);return jr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return jr.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&NQ(e.multihash,n.multihash)}toString(e){return D_(this,e)}toJSON(){return{"/":D_(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof jr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new jr(n,i,s,o||N_(n,i,s.bytes))}else if(t[BQ]===!0){const{version:n,multihash:i,code:s}=t,o=$Q(i);return jr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Hf)throw new Error(`Version 0 CID must use dag-pb (code: ${Hf}) block encoding`);return new jr(e,t,n,n.bytes)}case 1:{const i=N_(e,t,n.bytes);return new jr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return jr.create(0,Hf,e)}static createV1(e,t){return jr.create(1,e,t)}static decode(e){const[t,n]=jr.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=jr.inspectBytes(e),n=t.size-t.multihashSize,i=c6(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new h6(t.multihashCode,t.digestSize,s,i);return[t.version===0?jr.createV0(o):jr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=u6(e.subarray(t));return t+=p,h};let i=n(),s=Hf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=MQ(e,t),s=jr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return f6(s).set(n,e),s}};const MQ=(r,e)=>{switch(r[0]){case"Q":{const t=e||dn;return[dn.prefix,t.decode(`${dn.prefix}${r}`)]}case dn.prefix:{const t=e||dn;return[dn.prefix,t.decode(r)]}case Lg.prefix:{const t=e||Lg;return[Lg.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},OQ=(r,e,t)=>{const{prefix:n}=t;if(n!==dn.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i},RQ=(r,e,t)=>{const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i},Hf=112,LQ=18,N_=(r,e,t)=>{const n=Fg(r),i=n+Fg(e),s=new Uint8Array(i+t.byteLength);return Ug(r,s,0),Ug(e,s,n),s.set(t,i),s},BQ=Symbol.for("@ipld/js-cid/CID"),UQ=({name:r,code:e,encode:t})=>new FQ(r,e,t);let FQ=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?d6(this.code,t):t.then(n=>d6(this.code,n))}else throw Error("Unknown type, must be binary type")}};function zg({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*zQ(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t],s=Yi.asCID(n);s?yield[i.join("/"),s]:typeof n=="object"&&(yield*p6(n,i))}else{const t=Yi.asCID(e);t?yield[r.join("/"),t]:yield*p6(e,r)}}function*p6(r,e){if(r==null||r instanceof Uint8Array)return;const t=Yi.asCID(r);t&&(yield[e.join("/"),t]);for(const[n,i]of Object.entries(r)){const s=[...e,n];yield*zQ(s,i)}}function*VQ(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t];yield i.join("/"),typeof n=="object"&&!Yi.asCID(n)&&(yield*g6(n,i))}else yield*g6(e,r)}function*g6(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const i=[...e,t];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!Yi.asCID(n)&&(yield*VQ(i,n))}}function KQ(r,e){let t=r;for(const[n,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);const s=Yi.asCID(t);if(s)return{value:s,remaining:e.slice(n+1).join("/")}}return{value:t}}let M_=class{constructor({cid:e,bytes:t,value:n}){if(!e||!t||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:zg(),bytes:zg(),value:zg(),asBlock:zg()})}links(){return p6(this.value,[])}tree(){return g6(this.value,[])}get(e="/"){return KQ(this.value,e.split("/").filter(Boolean))}};async function sd({value:r,codec:e,hasher:t}){if(typeof r>"u")throw new Error('Missing required argument "value"');if(!e||!t)throw new Error("Missing required argument: codec or hasher");const n=e.encode(r),i=await t.digest(n),s=Yi.create(1,e.code,i);return new M_({value:r,bytes:n,cid:s})}async function Vg({bytes:r,codec:e,hasher:t}){if(!r)throw new Error('Missing required argument "bytes"');if(!e||!t)throw new Error("Missing required argument: codec or hasher");const n=e.decode(r),i=await t.digest(r),s=Yi.create(1,e.code,i);return new M_({value:n,bytes:r,cid:s})}const jQ=["string","number","bigint","symbol"],HQ=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function qQ(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";const e=typeof r;if(jQ.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(WQ(r))return"Buffer";const t=GQ(r);return t||"Object"}function WQ(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function GQ(r){const e=Object.prototype.toString.call(r).slice(8,-1);if(HQ.includes(e))return e}class V{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}V.uint=new V(0,"uint",!0),V.negint=new V(1,"negint",!0),V.bytes=new V(2,"bytes",!0),V.string=new V(3,"string",!0),V.array=new V(4,"array",!1),V.map=new V(5,"map",!1),V.tag=new V(6,"tag",!1),V.float=new V(7,"float",!0),V.false=new V(7,"false",!0),V.true=new V(7,"true",!0),V.null=new V(7,"null",!0),V.undefined=new V(7,"undefined",!0),V.break=new V(7,"break",!0);class ne{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const od=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",QQ=new TextDecoder,YQ=new TextEncoder;function Kg(r){return od&&globalThis.Buffer.isBuffer(r)}function y6(r){return r instanceof Uint8Array?Kg(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}const JQ=od?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):L_(r,e,t):(r,e,t)=>t-e>64?QQ.decode(r.subarray(e,t)):L_(r,e,t),O_=od?r=>r.length>64?globalThis.Buffer.from(r):R_(r):r=>r.length>64?YQ.encode(r):R_(r),wo=r=>Uint8Array.from(r),m6=od?(r,e,t)=>Kg(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),XQ=od?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),y6(globalThis.Buffer.concat(r,e))):(r,e)=>{const t=new Uint8Array(e);let n=0;for(let i of r)n+i.length>t.length&&(i=i.subarray(0,t.length-n)),t.set(i,n),n+=i.length;return t},ZQ=od?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function eY(r,e){if(Kg(r)&&Kg(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function R_(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e}function L_(r,e,t){const n=[];for(;e<t;){const i=r[e];let s=null,o=i>239?4:i>223?3:i>191?2:1;if(e+o<=t){let a,c,l,d;switch(o){case 1:i<128&&(s=i);break;case 2:a=r[e+1],(a&192)===128&&(d=(i&31)<<6|a&63,d>127&&(s=d));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(d=(i&15)<<12|(a&63)<<6|c&63,d>2047&&(d<55296||d>57343)&&(s=d));break;case 4:a=r[e+1],c=r[e+2],l=r[e+3],(a&192)===128&&(c&192)===128&&(l&192)===128&&(d=(i&15)<<18|(a&63)<<12|(c&63)<<6|l&63,d>65535&&d<1114112&&(s=d))}}s===null?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|s&1023),n.push(s),e+=o}return U_(n)}const B_=4096;function U_(r){const e=r.length;if(e<=B_)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=B_));return t}const tY=256;class F_{constructor(e=tY){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const i=t.length-(this.maxCursor-this.cursor)-1;t.set(e,i)}else{if(t){const i=t.length-(this.maxCursor-this.cursor)-1;i<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,i),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=ZQ(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=m6(n,0,this.cursor)}else t=XQ(this.chunks,this.cursor);return e&&this.reset(),t}}const ke="CBOR decode error:",cl="CBOR encode error:";function ad(r,e,t){if(r.length-e<t)throw new Error(`${ke} not enough data for type`)}const vr=[24,256,65536,4294967296,BigInt("18446744073709551616")];function ll(r,e,t){ad(r,e,1);const n=r[e];if(t.strict===!0&&n<vr[0])throw new Error(`${ke} integer encoded in more bytes than necessary (strict decode)`);return n}function ul(r,e,t){ad(r,e,2);const n=r[e]<<8|r[e+1];if(t.strict===!0&&n<vr[1])throw new Error(`${ke} integer encoded in more bytes than necessary (strict decode)`);return n}function dl(r,e,t){ad(r,e,4);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<vr[2])throw new Error(`${ke} integer encoded in more bytes than necessary (strict decode)`);return n}function hl(r,e,t){ad(r,e,8);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],i=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],s=(BigInt(n)<<BigInt(32))+BigInt(i);if(t.strict===!0&&s<vr[3])throw new Error(`${ke} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(t.allowBigInt===!0)return s;throw new Error(`${ke} integers outside of the safe integer range are not supported`)}function rY(r,e,t,n){return new ne(V.uint,ll(r,e+1,n),2)}function nY(r,e,t,n){return new ne(V.uint,ul(r,e+1,n),3)}function iY(r,e,t,n){return new ne(V.uint,dl(r,e+1,n),5)}function sY(r,e,t,n){return new ne(V.uint,hl(r,e+1,n),9)}function fl(r,e){return Ei(r,0,e.value)}function Ei(r,e,t){if(t<vr[0]){const n=Number(t);r.push([e|n])}else if(t<vr[1]){const n=Number(t);r.push([e|24,n])}else if(t<vr[2]){const n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<vr[3]){const n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{const n=BigInt(t);if(n<vr[4]){const i=[e|27,0,0,0,0,0,0,0];let s=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=s&255,s=s>>8,i[7]=s&255,s=s>>8,i[6]=s&255,s=s>>8,i[5]=s&255,i[4]=o&255,o=o>>8,i[3]=o&255,o=o>>8,i[2]=o&255,o=o>>8,i[1]=o&255,r.push(i)}else throw new Error(`${ke} encountered BigInt larger than allowable range`)}}fl.encodedSize=function(e){return Ei.encodedSize(e.value)},Ei.encodedSize=function(e){return e<vr[0]?1:e<vr[1]?2:e<vr[2]?3:e<vr[3]?5:9},fl.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function oY(r,e,t,n){return new ne(V.negint,-1-ll(r,e+1,n),2)}function aY(r,e,t,n){return new ne(V.negint,-1-ul(r,e+1,n),3)}function cY(r,e,t,n){return new ne(V.negint,-1-dl(r,e+1,n),5)}const w6=BigInt(-1),z_=BigInt(1);function lY(r,e,t,n){const i=hl(r,e+1,n);if(typeof i!="bigint"){const s=-1-i;if(s>=Number.MIN_SAFE_INTEGER)return new ne(V.negint,s,9)}if(n.allowBigInt!==!0)throw new Error(`${ke} integers outside of the safe integer range are not supported`);return new ne(V.negint,w6-BigInt(i),9)}function b6(r,e){const t=e.value,n=typeof t=="bigint"?t*w6-z_:t*-1-1;Ei(r,e.type.majorEncoded,n)}b6.encodedSize=function(e){const t=e.value,n=typeof t=="bigint"?t*w6-z_:t*-1-1;return n<vr[0]?1:n<vr[1]?2:n<vr[2]?3:n<vr[3]?5:9},b6.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function qf(r,e,t,n){ad(r,e,t+n);const i=m6(r,e+t,e+t+n);return new ne(V.bytes,i,t+n)}function uY(r,e,t,n){return qf(r,e,1,t)}function dY(r,e,t,n){return qf(r,e,2,ll(r,e+1,n))}function hY(r,e,t,n){return qf(r,e,3,ul(r,e+1,n))}function fY(r,e,t,n){return qf(r,e,5,dl(r,e+1,n))}function pY(r,e,t,n){const i=hl(r,e+1,n);if(typeof i=="bigint")throw new Error(`${ke} 64-bit integer bytes lengths not supported`);return qf(r,e,9,i)}function jg(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===V.string?O_(r.value):r.value),r.encodedBytes}function Hg(r,e){const t=jg(e);Ei(r,e.type.majorEncoded,t.length),r.push(t)}Hg.encodedSize=function(e){const t=jg(e);return Ei.encodedSize(t.length)+t.length},Hg.compareTokens=function(e,t){return gY(jg(e),jg(t))};function gY(r,e){return r.length<e.length?-1:r.length>e.length?1:eY(r,e)}function Wf(r,e,t,n,i){const s=t+n;ad(r,e,s);const o=new ne(V.string,JQ(r,e+t,e+s),s);return i.retainStringBytes===!0&&(o.byteValue=m6(r,e+t,e+s)),o}function yY(r,e,t,n){return Wf(r,e,1,t,n)}function mY(r,e,t,n){return Wf(r,e,2,ll(r,e+1,n),n)}function wY(r,e,t,n){return Wf(r,e,3,ul(r,e+1,n),n)}function bY(r,e,t,n){return Wf(r,e,5,dl(r,e+1,n),n)}function vY(r,e,t,n){const i=hl(r,e+1,n);if(typeof i=="bigint")throw new Error(`${ke} 64-bit integer string lengths not supported`);return Wf(r,e,9,i,n)}const EY=Hg;function cd(r,e,t,n){return new ne(V.array,n,t)}function SY(r,e,t,n){return cd(r,e,1,t)}function xY(r,e,t,n){return cd(r,e,2,ll(r,e+1,n))}function AY(r,e,t,n){return cd(r,e,3,ul(r,e+1,n))}function CY(r,e,t,n){return cd(r,e,5,dl(r,e+1,n))}function IY(r,e,t,n){const i=hl(r,e+1,n);if(typeof i=="bigint")throw new Error(`${ke} 64-bit integer array lengths not supported`);return cd(r,e,9,i)}function kY(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${ke} indefinite length items not allowed`);return cd(r,e,1,1/0)}function v6(r,e){Ei(r,V.array.majorEncoded,e.value)}v6.compareTokens=fl.compareTokens,v6.encodedSize=function(e){return Ei.encodedSize(e.value)};function ld(r,e,t,n){return new ne(V.map,n,t)}function _Y(r,e,t,n){return ld(r,e,1,t)}function TY(r,e,t,n){return ld(r,e,2,ll(r,e+1,n))}function PY(r,e,t,n){return ld(r,e,3,ul(r,e+1,n))}function DY(r,e,t,n){return ld(r,e,5,dl(r,e+1,n))}function $Y(r,e,t,n){const i=hl(r,e+1,n);if(typeof i=="bigint")throw new Error(`${ke} 64-bit integer map lengths not supported`);return ld(r,e,9,i)}function NY(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${ke} indefinite length items not allowed`);return ld(r,e,1,1/0)}function E6(r,e){Ei(r,V.map.majorEncoded,e.value)}E6.compareTokens=fl.compareTokens,E6.encodedSize=function(e){return Ei.encodedSize(e.value)};function MY(r,e,t,n){return new ne(V.tag,t,1)}function OY(r,e,t,n){return new ne(V.tag,ll(r,e+1,n),2)}function RY(r,e,t,n){return new ne(V.tag,ul(r,e+1,n),3)}function LY(r,e,t,n){return new ne(V.tag,dl(r,e+1,n),5)}function BY(r,e,t,n){return new ne(V.tag,hl(r,e+1,n),9)}function S6(r,e){Ei(r,V.tag.majorEncoded,e.value)}S6.compareTokens=fl.compareTokens,S6.encodedSize=function(e){return Ei.encodedSize(e.value)};const UY=20,FY=21,zY=22,VY=23;function KY(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${ke} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new ne(V.null,null,1):new ne(V.undefined,void 0,1)}function jY(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${ke} indefinite length items not allowed`);return new ne(V.break,void 0,1)}function x6(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${ke} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${ke} Infinity values are not supported`)}return new ne(V.float,r,e)}function HY(r,e,t,n){return x6(C6(r,e+1),3,n)}function qY(r,e,t,n){return x6(I6(r,e+1),5,n)}function WY(r,e,t,n){return x6(H_(r,e+1),9,n)}function A6(r,e,t){const n=e.value;if(n===!1)r.push([V.float.majorEncoded|UY]);else if(n===!0)r.push([V.float.majorEncoded|FY]);else if(n===null)r.push([V.float.majorEncoded|zY]);else if(n===void 0)r.push([V.float.majorEncoded|VY]);else{let i,s=!1;(!t||t.float64!==!0)&&(K_(n),i=C6(Ji,1),n===i||Number.isNaN(n)?(Ji[0]=249,r.push(Ji.slice(0,3)),s=!0):(j_(n),i=I6(Ji,1),n===i&&(Ji[0]=250,r.push(Ji.slice(0,5)),s=!0))),s||(GY(n),i=H_(Ji,1),Ji[0]=251,r.push(Ji.slice(0,9)))}}A6.encodedSize=function(e,t){const n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){K_(n);let i=C6(Ji,1);if(n===i||Number.isNaN(n))return 3;if(j_(n),i=I6(Ji,1),n===i)return 5}return 9};const V_=new ArrayBuffer(9),Si=new DataView(V_,1),Ji=new Uint8Array(V_,0);function K_(r){if(r===1/0)Si.setUint16(0,31744,!1);else if(r===-1/0)Si.setUint16(0,64512,!1);else if(Number.isNaN(r))Si.setUint16(0,32256,!1);else{Si.setFloat32(0,r);const e=Si.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)Si.setUint16(0,31744,!1);else if(t===0)Si.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{const i=t-127;i<-24?Si.setUint16(0,0):i<-14?Si.setUint16(0,(e&2147483648)>>16|1<<24+i,!1):Si.setUint16(0,(e&2147483648)>>16|i+15<<10|n>>13,!1)}}}function C6(r,e){if(r.length-e<2)throw new Error(`${ke} not enough data for float16`);const t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const n=t>>10&31,i=t&1023;let s;return n===0?s=i*2**-24:n!==31?s=(i+1024)*2**(n-25):s=i===0?1/0:NaN,t&32768?-s:s}function j_(r){Si.setFloat32(0,r,!1)}function I6(r,e){if(r.length-e<4)throw new Error(`${ke} not enough data for float32`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function GY(r){Si.setFloat64(0,r,!1)}function H_(r,e){if(r.length-e<8)throw new Error(`${ke} not enough data for float64`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}A6.compareTokens=fl.compareTokens;function st(r,e,t){throw new Error(`${ke} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function qg(r){return()=>{throw new Error(`${ke} ${r}`)}}const ce=[];for(let r=0;r<=23;r++)ce[r]=st;ce[24]=rY,ce[25]=nY,ce[26]=iY,ce[27]=sY,ce[28]=st,ce[29]=st,ce[30]=st,ce[31]=st;for(let r=32;r<=55;r++)ce[r]=st;ce[56]=oY,ce[57]=aY,ce[58]=cY,ce[59]=lY,ce[60]=st,ce[61]=st,ce[62]=st,ce[63]=st;for(let r=64;r<=87;r++)ce[r]=uY;ce[88]=dY,ce[89]=hY,ce[90]=fY,ce[91]=pY,ce[92]=st,ce[93]=st,ce[94]=st,ce[95]=qg("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)ce[r]=yY;ce[120]=mY,ce[121]=wY,ce[122]=bY,ce[123]=vY,ce[124]=st,ce[125]=st,ce[126]=st,ce[127]=qg("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)ce[r]=SY;ce[152]=xY,ce[153]=AY,ce[154]=CY,ce[155]=IY,ce[156]=st,ce[157]=st,ce[158]=st,ce[159]=kY;for(let r=160;r<=183;r++)ce[r]=_Y;ce[184]=TY,ce[185]=PY,ce[186]=DY,ce[187]=$Y,ce[188]=st,ce[189]=st,ce[190]=st,ce[191]=NY;for(let r=192;r<=215;r++)ce[r]=MY;ce[216]=OY,ce[217]=RY,ce[218]=LY,ce[219]=BY,ce[220]=st,ce[221]=st,ce[222]=st,ce[223]=st;for(let r=224;r<=243;r++)ce[r]=qg("simple values are not supported");ce[244]=st,ce[245]=st,ce[246]=st,ce[247]=KY,ce[248]=qg("simple values are not supported"),ce[249]=HY,ce[250]=qY,ce[251]=WY,ce[252]=st,ce[253]=st,ce[254]=st,ce[255]=jY;const Is=[];for(let r=0;r<24;r++)Is[r]=new ne(V.uint,r,1);for(let r=-1;r>=-24;r--)Is[31-r]=new ne(V.negint,r,1);Is[64]=new ne(V.bytes,new Uint8Array(0),1),Is[96]=new ne(V.string,"",1),Is[128]=new ne(V.array,0,1),Is[160]=new ne(V.map,0,1),Is[244]=new ne(V.false,!1,1),Is[245]=new ne(V.true,!0,1),Is[246]=new ne(V.null,null,1);function QY(r){switch(r.type){case V.false:return wo([244]);case V.true:return wo([245]);case V.null:return wo([246]);case V.bytes:return r.value.length?void 0:wo([64]);case V.string:return r.value===""?wo([96]):void 0;case V.array:return r.value===0?wo([128]):void 0;case V.map:return r.value===0?wo([160]):void 0;case V.uint:return r.value<24?wo([Number(r.value)]):void 0;case V.negint:if(r.value>=-24)return wo([31-Number(r.value)])}}const YY={float64:!1,mapSorter:ZY,quickEncodeToken:QY};function JY(){const r=[];return r[V.uint.major]=fl,r[V.negint.major]=b6,r[V.bytes.major]=Hg,r[V.string.major]=EY,r[V.array.major]=v6,r[V.map.major]=E6,r[V.tag.major]=S6,r[V.float.major]=A6,r}const q_=JY(),k6=new F_;class Wg{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${cl} object contains circular references`);return new Wg(t,e)}}const La={null:new ne(V.null,null),undefined:new ne(V.undefined,void 0),true:new ne(V.true,!0),false:new ne(V.false,!1),emptyArray:new ne(V.array,0),emptyMap:new ne(V.map,0)},Ba={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new ne(V.float,r):r>=0?new ne(V.uint,r):new ne(V.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new ne(V.uint,r):new ne(V.negint,r)},Uint8Array(r,e,t,n){return new ne(V.bytes,r)},string(r,e,t,n){return new ne(V.string,r)},boolean(r,e,t,n){return r?La.true:La.false},null(r,e,t,n){return La.null},undefined(r,e,t,n){return La.undefined},ArrayBuffer(r,e,t,n){return new ne(V.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new ne(V.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[La.emptyArray,new ne(V.break)]:La.emptyArray;n=Wg.createCheck(n,r);const i=[];let s=0;for(const o of r)i[s++]=Gg(o,t,n);return t.addBreakTokens?[new ne(V.array,r.length),i,new ne(V.break)]:[new ne(V.array,r.length),i]},Object(r,e,t,n){const i=e!=="Object",s=i?r.keys():Object.keys(r),o=i?r.size:s.length;if(!o)return t.addBreakTokens===!0?[La.emptyMap,new ne(V.break)]:La.emptyMap;n=Wg.createCheck(n,r);const a=[];let c=0;for(const l of s)a[c++]=[Gg(l,t,n),Gg(i?r.get(l):r[l],t,n)];return XY(a,t),t.addBreakTokens?[new ne(V.map,o),a,new ne(V.break)]:[new ne(V.map,o),a]}};Ba.Map=Ba.Object,Ba.Buffer=Ba.Uint8Array;for(const r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Ba[`${r}Array`]=Ba.DataView;function Gg(r,e={},t){const n=qQ(r),i=e&&e.typeEncoders&&e.typeEncoders[n]||Ba[n];if(typeof i=="function"){const o=i(r,n,e,t);if(o!=null)return o}const s=Ba[n];if(!s)throw new Error(`${cl} unsupported type: ${n}`);return s(r,n,e,t)}function XY(r,e){e.mapSorter&&r.sort(e.mapSorter)}function ZY(r,e){const t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);const i=t.type.major,s=q_[i].compareTokens(t,n);return s===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),s}function W_(r,e,t,n){if(Array.isArray(e))for(const i of e)W_(r,i,t,n);else t[e.type.major](r,e,n)}function G_(r,e,t){const n=Gg(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){const i=t.quickEncodeToken(n);if(i)return i;const s=e[n.type.major];if(s.encodedSize){const o=s.encodedSize(n,t),a=new F_(o);if(s(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return y6(a.chunks[0])}}return k6.reset(),W_(k6,n,e,t),k6.toBytes(!0)}function Qg(r,e){return e=Object.assign({},YY,e),G_(r,q_,e)}const eJ={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class tJ{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=Is[e];if(t===void 0){const n=ce[e];if(!n)throw new Error(`${ke} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const i=e&31;t=n(this.data,this._pos,i,this.options)}return this._pos+=t.encodedLength,t}}const Gf=Symbol.for("DONE"),Yg=Symbol.for("BREAK");function rJ(r,e,t){const n=[];for(let i=0;i<r.value;i++){const s=Qf(e,t);if(s===Yg){if(r.value===1/0)break;throw new Error(`${ke} got unexpected break to lengthed array`)}if(s===Gf)throw new Error(`${ke} found array but not enough entries (got ${i}, expected ${r.value})`);n[i]=s}return n}function nJ(r,e,t){const n=t.useMaps===!0,i=n?void 0:{},s=n?new Map:void 0;for(let o=0;o<r.value;o++){const a=Qf(e,t);if(a===Yg){if(r.value===1/0)break;throw new Error(`${ke} got unexpected break to lengthed map`)}if(a===Gf)throw new Error(`${ke} found map but not enough entries (got ${o} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${ke} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&s.has(a)||!n&&a in i))throw new Error(`${ke} found repeat map key "${a}"`);const c=Qf(e,t);if(c===Gf)throw new Error(`${ke} found map but not enough entries (got ${o} [no value], expected ${r.value})`);n?s.set(a,c):i[a]=c}return n?s:i}function Qf(r,e){if(r.done())return Gf;const t=r.next();if(t.type===V.break)return Yg;if(t.type.terminal)return t.value;if(t.type===V.array)return rJ(t,r,e);if(t.type===V.map)return nJ(t,r,e);if(t.type===V.tag){if(e.tags&&typeof e.tags[t.value]=="function"){const n=Qf(r,e);return e.tags[t.value](n)}throw new Error(`${ke} tag not supported (${t.value})`)}throw new Error("unsupported")}function iJ(r,e){if(!(r instanceof Uint8Array))throw new Error(`${ke} data to decode must be a Uint8Array`);e=Object.assign({},eJ,e);const t=e.tokenizer||new tJ(r,e),n=Qf(t,e);if(n===Gf)throw new Error(`${ke} did not find any content to decode`);if(n===Yg)throw new Error(`${ke} got unexpected break`);return[n,r.subarray(t.pos())]}function Ua(r,e){const[t,n]=iJ(r,e);if(n.length>0)throw new Error(`${ke} too many terminals, data makes no sense`);return t}function sJ(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function _6(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function oJ(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var aJ=oJ,cJ=aJ;let lJ=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},uJ=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Q_(this,e)}},dJ=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return Q_(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Q_(r,e){return new dJ({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let hJ=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new lJ(e,t,n),this.decoder=new uJ(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Y_({name:r,prefix:e,encode:t,decode:n}){return new hJ(r,e,t,n)}function Jg({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=cJ(t,r);return Y_({prefix:e,name:r,encode:n,decode:s=>_6(i(s))})}function fJ(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function pJ(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function bo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return Y_({prefix:e,name:r,encode(i){return pJ(i,n,t)},decode(i){return fJ(i,n,t,r)}})}const Xg=bo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});bo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),bo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),bo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),bo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),bo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),bo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),bo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),bo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const T6=Jg({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Jg({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Fa=Jg({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Jg({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var gJ=X_,J_=128,yJ=-128,mJ=Math.pow(2,31);function X_(r,e,t){e=e||[],t=t||0;for(var n=t;r>=mJ;)e[t++]=r&255|J_,r/=128;for(;r&yJ;)e[t++]=r&255|J_,r>>>=7;return e[t]=r|0,X_.bytes=t-n+1,e}var wJ=P6,bJ=128,Z_=127;function P6(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw P6.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&Z_)<<i:(o&Z_)*Math.pow(2,i),i+=7}while(o>=bJ);return P6.bytes=s-n,t}var vJ=Math.pow(2,7),EJ=Math.pow(2,14),SJ=Math.pow(2,21),xJ=Math.pow(2,28),AJ=Math.pow(2,35),CJ=Math.pow(2,42),IJ=Math.pow(2,49),kJ=Math.pow(2,56),_J=Math.pow(2,63),TJ=function(r){return r<vJ?1:r<EJ?2:r<SJ?3:r<xJ?4:r<AJ?5:r<CJ?6:r<IJ?7:r<kJ?8:r<_J?9:10},PJ={encode:gJ,decode:wJ,encodingLength:TJ},Zg=PJ;function D6(r,e=0){return[Zg.decode(r,e),Zg.decode.bytes]}function e2(r,e,t=0){return Zg.encode(r,e,t),e}function t2(r){return Zg.encodingLength(r)}function DJ(r,e){const t=e.byteLength,n=t2(r),i=n+t2(t),s=new Uint8Array(i+t);return e2(r,s,0),e2(t,s,n),s.set(e,i),new $6(r,t,e,s)}function $J(r){const e=_6(r),[t,n]=D6(e),[i,s]=D6(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new $6(t,i,o,e)}function NJ(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&sJ(r.bytes,t.bytes)}}let $6=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function eT(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return OJ(t,N6(r),e??Fa.encoder);default:return RJ(t,N6(r),e??Xg.encoder)}}const tT=new WeakMap;function N6(r){const e=tT.get(r);if(e==null){const t=new Map;return tT.set(r,t),t}return e}let rT=class Hr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,vj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Yf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==LJ)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Hr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=DJ(e,t);return Hr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Hr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&NJ(e.multihash,n.multihash)}toString(e){return eT(this,e)}toJSON(){return{"/":eT(this)}}link(){return this}[(vj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Hr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Hr(n,i,s,o??nT(n,i,s.bytes))}else if(t[BJ]===!0){const{version:n,multihash:i,code:s}=t,o=$J(i);return Hr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Yf)throw new Error(`Version 0 CID must use dag-pb (code: ${Yf}) block encoding`);return new Hr(e,t,n,n.bytes)}case 1:{const i=nT(e,t,n.bytes);return new Hr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Hr.create(0,Yf,e)}static createV1(e,t){return Hr.create(1,e,t)}static decode(e){const[t,n]=Hr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Hr.inspectBytes(e),n=t.size-t.multihashSize,i=_6(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new $6(t.multihashCode,t.digestSize,s,i);return[t.version===0?Hr.createV0(o):Hr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=D6(e.subarray(t));return t+=p,h};let i=n(),s=Yf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=MJ(e,t),s=Hr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return N6(s).set(n,e),s}};function MJ(r,e){switch(r[0]){case"Q":{const t=e??Fa;return[Fa.prefix,t.decode(`${Fa.prefix}${r}`)]}case Fa.prefix:{const t=e??Fa;return[Fa.prefix,t.decode(r)]}case Xg.prefix:{const t=e??Xg;return[Xg.prefix,t.decode(r)]}case T6.prefix:{const t=e??T6;return[T6.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function OJ(r,e,t){const{prefix:n}=t;if(n!==Fa.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function RJ(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Yf=112,LJ=18;function nT(r,e,t){const n=t2(r),i=n+t2(e),s=new Uint8Array(i+t.byteLength);return e2(r,s,0),e2(e,s,n),s.set(t,i),s}const BJ=Symbol.for("@ipld/js-cid/CID"),iT=42;function sT(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function UJ(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=rT.asCID(r);if(!e)return null;const t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new ne(V.tag,iT),new ne(V.bytes,t)]}function FJ(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function zJ(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const M6={float64:!0,typeEncoders:{Object:UJ,undefined:FJ,number:zJ}},VJ={...M6,typeEncoders:{...M6.typeEncoders}};function KJ(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return rT.decode(r.subarray(1))}const r2={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};r2.tags[iT]=KJ;const jJ={...r2,tags:r2.tags.slice()},HJ="dag-cbor",oT=113,Jf=Object.freeze(Object.defineProperty({__proto__:null,code:oT,decode:r=>Ua(sT(r),r2),decodeOptions:jJ,encode:r=>Qg(r,M6),encodeOptions:VJ,name:HJ,toByteView:sT},Symbol.toStringTag,{value:"Module"})),n2=UQ({name:"sha2-256",code:18,encode:(r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)))("SHA-256")}),i2=Jf,s2=n2,aT=dn,qJ=async(r,e,t,n=null,i=[],s=[])=>{if(r==null)throw new Error("Identity is required, cannot create entry");if(e==null)throw new Error("Entry requires an id");if(t==null)throw new Error("Entry requires a payload");if(i==null||!Array.isArray(i))throw new Error("'next' argument is not an array");n=n||Rg(r.publicKey);const o={id:e,payload:t,next:i,refs:s,clock:n,v:2},{bytes:a}=await sd({value:o,codec:i2,hasher:s2}),c=await r.sign(r,a);return o.key=r.publicKey,o.identity=r.hash,o.sig=c,lT(o)},WJ=async(r,e)=>{if(!r)throw new Error("Identities is required, cannot verify entry");if(!cT(e))throw new Error("Invalid Log entry");if(!e.key)throw new Error("Entry doesn't have a key");if(!e.sig)throw new Error("Entry doesn't have a signature");const t={id:e.id,payload:e.payload,next:e.next,refs:e.refs,clock:e.clock,v:e.v},{bytes:n}=await sd({value:t,codec:i2,hasher:s2});return r.verify(e.sig,e.key,n)},cT=r=>r&&r.id!==void 0&&r.next!==void 0&&r.payload!==void 0&&r.v!==void 0&&r.clock!==void 0&&r.refs!==void 0,GJ=(r,e)=>r&&e&&r.hash===e.hash,QJ=async r=>{const{cid:e,value:t}=await Vg({bytes:r,codec:i2,hasher:s2}),n=e.toString(aT);return{...t,hash:n,bytes:r}},lT=async r=>{const{cid:e,bytes:t}=await sd({value:r,codec:i2,hasher:s2}),n=e.toString(aT),i=Rg(r.clock.id,r.clock.time);return{...r,clock:i,hash:n,bytes:t}},vo={create:qJ,verify:WJ,decode:QJ,encode:lT,isEntry:cT,isEqual:GJ},O6=async()=>{let r={};const e=async(c,l)=>{r[c]=l};return{put:e,del:async c=>{delete r[c]},get:async c=>r[c],iterator:async function*(){for await(const[c,l]of Object.entries(r))yield[c,l]},merge:async c=>{if(c)for await(const[l,d]of c.iterator())e(l,d)},clear:async()=>{r={}},close:async()=>{}}},YJ=O6,JJ=async({storage:r,heads:e})=>{r=r||await YJ();const t=async d=>{d=uT(d);for(const h of d)await r.put(h.hash,h.bytes)},n=async d=>{await r.clear(),await t(d)},i=async d=>{const h=await a();if(h.find(m=>vo.isEqual(m,d)))return;const p=uT([...h,d]);return await n(p),p},s=async d=>{const p=(await a()).filter(m=>m.hash!==d);await n(p)},o=async function*(){const d=r.iterator();for await(const[,h]of d)yield await vo.decode(h)},a=async()=>{const d=[];for await(const h of o())d.push(h);return d},c=async()=>{await r.clear()},l=async()=>{await r.close()};return await t(e||[]),{put:t,set:n,add:i,remove:s,iterator:o,all:a,clear:c,close:l}},uT=r=>{r=new Set(r);const e={};for(const n of r)for(const i of n.next)e[i]=n.hash;const t=[];for(const n of r)e[n.hash]||t.push(n);return t};function XJ(r,e){const t=(s,o)=>s,n=(s,o)=>eX(s,o,t);return((s,o)=>ZJ(s,o,n))(r,e)}function ZJ(r,e,t){const n=iQ(r.clock,e.clock);return n===0?t(r,e):n}function eX(r,e,t){return r.clock.id===e.clock.id?t(r,e):r.clock.id<e.clock.id?-1:1}function tX(r){const e=`Your log's tiebreaker function, ${r.name}, has returned zero and therefore cannot be`;return(n,i)=>{const s=r(n,i);if(s===0)throw Error(e);return s}}const rX={LastWriteWins:XJ,NoZeroes:tX},{LastWriteWins:nX,NoZeroes:iX}=rX,sX=()=>new Date().getTime().toString(),oX=(r,e)=>Math.max(r,e.clock.time),R6=O6,aX=async()=>({canAppend:async r=>!0}),cX=async(r,{logId:e,logHeads:t,access:n,entryStorage:i,headsStorage:s,indexStorage:o,sortFn:a}={})=>{if(r==null)throw new Error("Identity is required");if(t!=null&&!Array.isArray(t))throw new Error("'logHeads' argument must be an array");const c=e||sX();n=n||await aX();const l=i||await R6(),d=o||await R6();s=s||await R6();const h=await JJ({storage:s,heads:t});a=iX(a||nX);const p=new Ma({concurrency:1}),m=new Ma({concurrency:1}),f=async()=>{const B=Math.max(0,(await g()).reduce(oX,0));return Rg(r.publicKey,B)},g=async()=>(await h.all()).sort(a).reverse(),v=async()=>{const B=[];for await(const G of k())B.unshift(G);return B},y=async B=>{const G=await l.get(B);if(G)return await vo.decode(G)},w=async B=>await d.get(B)!=null,b=async(B,G={referencesCount:0})=>{const j=async()=>{const q=await g(),Q=q.map(W=>W.hash),K=await z(q,G.referencesCount+q.length),O=await vo.create(r,c,B,sQ(await f()),Q,K);if(!await n.canAppend(O))throw new Error(`Could not append entry:
Key "${r.hash}" is not allowed to write to the log`);return await h.set([O]),await l.put(O.hash,O.bytes),await d.put(O.hash,!0),O};return p.add(j)},E=async B=>{if(!B)throw new Error("Log instance not defined");if(!L(B))throw new Error("Given argument is not an instance of Log");l.merge&&await l.merge(B.storage);const G=await B.heads();for(const j of G)await A(j)},A=async B=>{const G=async()=>{if(await w(B.hash))return!1;const q=async Y=>{if(Y.id!==c)throw new Error(`Entry's id (${Y.id}) doesn't match the log's id (${c}).`);if(!await n.canAppend(Y))throw new Error(`Could not append entry:
Key "${Y.identity}" is not allowed to write to the log`);if(!await vo.verify(r,Y))throw new Error(`Could not validate signature for entry "${Y.hash}"`)};await q(B);const Q=(await g()).map(Y=>Y.hash),K=new Set([B.hash]),O=new Set([...B.next,...B.refs]),U=new Set,W=async()=>{const Y=Array.from(O.values()).filter(w).map(y),H=await Promise.all(Y);for(const ie of H){O.delete(ie.hash),await q(ie),K.add(ie.hash);for(const me of[...ie.next,...ie.refs])!await w(me)&&!K.has(me)?O.add(me):Q.includes(me)&&U.add(me)}O.size>0&&await W()};await W();for(const Y of K.values())await d.put(Y,!0);for(const Y of U.values())await h.remove(Y);return await l.put(B.hash,B.bytes),await h.add(B),!0};return m.add(G)},k=async function*(B,G){G=G||(()=>!1),B=B||await g();let q=B.sort(a);const Q={};let K=[];const O={},U=Y=>!(Q[Y]||O[Y]);let W;for(;q.length>0;)if(q=q.sort(a),W=q.pop(),W){const{hash:Y,next:H}=W;if(!Q[Y]){if(yield W,await G(W)===!0)break;Q[Y]=!0,O[Y]=!0,K=[...K,...H].filter(U);const me=le=>{if(!Q[le]&&!O[le])return O[le]=!0,y(le)},de=await Promise.all(K.map(me));K=de.filter(le=>le!=null).reduce((le,Ne)=>Array.from(new Set([...le,...Ne.next])),[]).filter(U),q=[...de,...q]}}},x=async function*({amount:B=-1,gt:G,gte:j,lt:q,lte:Q}={}){if(B===0)return;if(typeof Q=="string"&&(Q=[await y(Q)]),typeof q=="string"){const le=await y(q);q=await Promise.all(le.next.map(Me=>y(Me)))}if(q!=null&&!Array.isArray(q))throw new Error("lt must be a string or an array of Entries");if(Q!=null&&!Array.isArray(Q))throw new Error("lte must be a string or an array of Entries");const K=(q||Q||await g()).filter(le=>le!=null),O=G||j?await y(G||j):null,U=O||B===-1?-1:B;let W=0;const Y=async le=>(W++,le?!!(W>=U&&U!==-1||O&&vo.isEqual(le,O)):!1),H=O&&B!==-1&&!q&&!Q,ie=H?new a6(B+2):null;let me=0;const de=k(K,Y);for await(const le of de){const Ne=q&&vo.isEqual(le,K),Me=G&&vo.isEqual(le,O);Ne||Me||(H?ie.set(me++,le.hash):yield le)}if(H){const le=ie.keys.length,Ne=le>B?le-B:0,Me=ie.keys.slice(Ne,le);for(const Xe of Me){const nt=ie.get(Xe);yield await y(nt)}}},I=async()=>{await d.clear(),await h.clear(),await l.clear()},T=async()=>{await d.close(),await h.close(),await l.close()},L=B=>B&&B.id!==void 0&&B.clock!==void 0&&B.heads!==void 0&&B.values!==void 0&&B.access!==void 0&&B.identity!==void 0&&B.storage!==void 0,z=async(B,G=0)=>{let j=[];const q=async Q=>j.length>=G&&G!==-1;for await(const{hash:Q}of k(B,q))j.push(Q);return j=j.slice(B.length+1,G),j};return{id:c,clock:f,heads:g,values:v,all:v,get:y,has:w,append:b,join:E,joinEntry:A,traverse:k,iterator:x,clear:I,close:T,access:n,identity:r,storage:l}},pl=async(r,e)=>({put:async(l,d)=>{await r.put(l,d),await e.put(l,d)},get:async l=>{let d=await r.get(l);return d||(d=await e.get(l),d&&await r.put(l,d)),d},del:async l=>{await r.del(l),await e.del(l)},iterator:async function*({amount:l,reverse:d}={}){const h=[],p={amount:l||-1,reverse:d||!1};for(const m of[r,e])for await(const[f,g]of m.iterator(p))h[f]||(h[f]=!0,yield[f,g])},merge:async l=>{await r.merge(l),await e.merge(l),await l.merge(r),await l.merge(e)},clear:async()=>{await r.clear(),await e.clear()},close:async()=>{await r.close(),await e.close()}});function lX(r){return r[Symbol.asyncIterator]!=null}function Eo(r){if(lX(r))return(async()=>{for await(const e of r);})();for(const e of r);}const dT=3e4,o2=async({ipfs:r,pin:e,timeout:t}={})=>{if(!r)throw new Error("An instance of ipfs is required.");return{put:async(d,h)=>{const p=Yi.parse(d,dn),{signal:m}=new s6.TimeoutController(t||dT);await r.blockstore.put(p,h,{signal:m}),e&&!await r.pins.isPinned(p)&&await Eo(r.pins.add(p))},del:async d=>{},get:async d=>{const h=Yi.parse(d,dn),{signal:p}=new s6.TimeoutController(t||dT),m=await r.blockstore.get(h,{signal:p});if(m)return m},iterator:async function*(){},merge:async d=>{},clear:async()=>{},close:async()=>{}}};var hT={},za={},a2={},fT={};fT.supports=function(...e){const t=e.reduce((n,i)=>Object.assign(n,i),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})};var pT={},ks=class extends Error{constructor(e,t){super(e||""),typeof t=="object"&&t!==null&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},gl={},c2={},l2={};l2.byteLength=hX,l2.toByteArray=pX,l2.fromByteArray=mX;for(var _s=[],xi=[],uX=typeof Uint8Array<"u"?Uint8Array:Array,L6="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ud=0,dX=L6.length;ud<dX;++ud)_s[ud]=L6[ud],xi[L6.charCodeAt(ud)]=ud;xi[45]=62,xi[95]=63;function gT(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function hX(r){var e=gT(r),t=e[0],n=e[1];return(t+n)*3/4-n}function fX(r,e,t){return(e+t)*3/4-t}function pX(r){var e,t=gT(r),n=t[0],i=t[1],s=new uX(fX(r,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=xi[r.charCodeAt(c)]<<18|xi[r.charCodeAt(c+1)]<<12|xi[r.charCodeAt(c+2)]<<6|xi[r.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=xi[r.charCodeAt(c)]<<2|xi[r.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=xi[r.charCodeAt(c)]<<10|xi[r.charCodeAt(c+1)]<<4|xi[r.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function gX(r){return _s[r>>18&63]+_s[r>>12&63]+_s[r>>6&63]+_s[r&63]}function yX(r,e,t){for(var n,i=[],s=e;s<t;s+=3)n=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),i.push(gX(n));return i.join("")}function mX(r){for(var e,t=r.length,n=t%3,i=[],s=16383,o=0,a=t-n;o<a;o+=s)i.push(yX(r,o,o+s>a?a:o+s));return n===1?(e=r[t-1],i.push(_s[e>>2]+_s[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],i.push(_s[e>>10]+_s[e>>4&63]+_s[e<<2&63]+"=")),i.join("")}var B6={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */B6.read=function(r,e,t,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,l=c>>1,d=-7,h=t?i-1:0,p=t?-1:1,m=r[e+h];for(h+=p,s=m&(1<<-d)-1,m>>=-d,d+=a;d>0;s=s*256+r[e+h],h+=p,d-=8);for(o=s&(1<<-d)-1,s>>=-d,d+=n;d>0;o=o*256+r[e+h],h+=p,d-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(m?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-l}return(m?-1:1)*o*Math.pow(2,s-n)},B6.write=function(r,e,t,n,i,s){var o,a,c,l=s*8-i-1,d=(1<<l)-1,h=d>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=n?0:s-1,f=n?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=d):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?e+=p/c:e+=p*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=d?(a=0,o=d):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;r[t+m]=a&255,m+=f,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;r[t+m]=o&255,m+=f,o/=256,l-=8);r[t+m-f]|=g*128};/*!
* The buffer module from node.js, for the browser.
*
* @author   Feross Aboukhadijeh <https://feross.org>
* @license  MIT
*/(function(r){const e=l2,t=B6,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=a,r.SlowBuffer=w,r.INSPECT_MAX_BYTES=50;const i=2147483647;r.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const D=new Uint8Array(1),S={foo:function(){return 42}};return Object.setPrototypeOf(S,Uint8Array.prototype),Object.setPrototypeOf(D,S),D.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(D){if(D>i)throw new RangeError('The value "'+D+'" is invalid for option "size"');const S=new Uint8Array(D);return Object.setPrototypeOf(S,a.prototype),S}function a(D,S,C){if(typeof D=="number"){if(typeof S=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return h(D)}return c(D,S,C)}a.poolSize=8192;function c(D,S,C){if(typeof D=="string")return p(D,S);if(ArrayBuffer.isView(D))return f(D);if(D==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof D);if(bn(D,ArrayBuffer)||D&&bn(D.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(bn(D,SharedArrayBuffer)||D&&bn(D.buffer,SharedArrayBuffer)))return g(D,S,C);if(typeof D=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const M=D.valueOf&&D.valueOf();if(M!=null&&M!==D)return a.from(M,S,C);const P=v(D);if(P)return P;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof D[Symbol.toPrimitive]=="function")return a.from(D[Symbol.toPrimitive]("string"),S,C);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof D)}a.from=function(D,S,C){return c(D,S,C)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function l(D){if(typeof D!="number")throw new TypeError('"size" argument must be of type number');if(D<0)throw new RangeError('The value "'+D+'" is invalid for option "size"')}function d(D,S,C){return l(D),D<=0?o(D):S!==void 0?typeof C=="string"?o(D).fill(S,C):o(D).fill(S):o(D)}a.alloc=function(D,S,C){return d(D,S,C)};function h(D){return l(D),o(D<0?0:y(D)|0)}a.allocUnsafe=function(D){return h(D)},a.allocUnsafeSlow=function(D){return h(D)};function p(D,S){if((typeof S!="string"||S==="")&&(S="utf8"),!a.isEncoding(S))throw new TypeError("Unknown encoding: "+S);const C=b(D,S)|0;let M=o(C);const P=M.write(D,S);return P!==C&&(M=M.slice(0,P)),M}function m(D){const S=D.length<0?0:y(D.length)|0,C=o(S);for(let M=0;M<S;M+=1)C[M]=D[M]&255;return C}function f(D){if(bn(D,Uint8Array)){const S=new Uint8Array(D);return g(S.buffer,S.byteOffset,S.byteLength)}return m(D)}function g(D,S,C){if(S<0||D.byteLength<S)throw new RangeError('"offset" is outside of buffer bounds');if(D.byteLength<S+(C||0))throw new RangeError('"length" is outside of buffer bounds');let M;return S===void 0&&C===void 0?M=new Uint8Array(D):C===void 0?M=new Uint8Array(D,S):M=new Uint8Array(D,S,C),Object.setPrototypeOf(M,a.prototype),M}function v(D){if(a.isBuffer(D)){const S=y(D.length)|0,C=o(S);return C.length===0||D.copy(C,0,0,S),C}if(D.length!==void 0)return typeof D.length!="number"||Wc(D.length)?o(0):m(D);if(D.type==="Buffer"&&Array.isArray(D.data))return m(D.data)}function y(D){if(D>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return D|0}function w(D){return+D!=D&&(D=0),a.alloc(+D)}a.isBuffer=function(S){return S!=null&&S._isBuffer===!0&&S!==a.prototype},a.compare=function(S,C){if(bn(S,Uint8Array)&&(S=a.from(S,S.offset,S.byteLength)),bn(C,Uint8Array)&&(C=a.from(C,C.offset,C.byteLength)),!a.isBuffer(S)||!a.isBuffer(C))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(S===C)return 0;let M=S.length,P=C.length;for(let N=0,R=Math.min(M,P);N<R;++N)if(S[N]!==C[N]){M=S[N],P=C[N];break}return M<P?-1:P<M?1:0},a.isEncoding=function(S){switch(String(S).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(S,C){if(!Array.isArray(S))throw new TypeError('"list" argument must be an Array of Buffers');if(S.length===0)return a.alloc(0);let M;if(C===void 0)for(C=0,M=0;M<S.length;++M)C+=S[M].length;const P=a.allocUnsafe(C);let N=0;for(M=0;M<S.length;++M){let R=S[M];if(bn(R,Uint8Array))N+R.length>P.length?(a.isBuffer(R)||(R=a.from(R)),R.copy(P,N)):Uint8Array.prototype.set.call(P,R,N);else if(a.isBuffer(R))R.copy(P,N);else throw new TypeError('"list" argument must be an Array of Buffers');N+=R.length}return P};function b(D,S){if(a.isBuffer(D))return D.length;if(ArrayBuffer.isView(D)||bn(D,ArrayBuffer))return D.byteLength;if(typeof D!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof D);const C=D.length,M=arguments.length>2&&arguments[2]===!0;if(!M&&C===0)return 0;let P=!1;for(;;)switch(S){case"ascii":case"latin1":case"binary":return C;case"utf8":case"utf-8":return eo(D).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C*2;case"hex":return C>>>1;case"base64":return to(D).length;default:if(P)return M?-1:eo(D).length;S=(""+S).toLowerCase(),P=!0}}a.byteLength=b;function E(D,S,C){let M=!1;if((S===void 0||S<0)&&(S=0),S>this.length||((C===void 0||C>this.length)&&(C=this.length),C<=0)||(C>>>=0,S>>>=0,C<=S))return"";for(D||(D="utf8");;)switch(D){case"hex":return U(this,S,C);case"utf8":case"utf-8":return j(this,S,C);case"ascii":return K(this,S,C);case"latin1":case"binary":return O(this,S,C);case"base64":return G(this,S,C);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return W(this,S,C);default:if(M)throw new TypeError("Unknown encoding: "+D);D=(D+"").toLowerCase(),M=!0}}a.prototype._isBuffer=!0;function A(D,S,C){const M=D[S];D[S]=D[C],D[C]=M}a.prototype.swap16=function(){const S=this.length;if(S%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let C=0;C<S;C+=2)A(this,C,C+1);return this},a.prototype.swap32=function(){const S=this.length;if(S%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let C=0;C<S;C+=4)A(this,C,C+3),A(this,C+1,C+2);return this},a.prototype.swap64=function(){const S=this.length;if(S%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let C=0;C<S;C+=8)A(this,C,C+7),A(this,C+1,C+6),A(this,C+2,C+5),A(this,C+3,C+4);return this},a.prototype.toString=function(){const S=this.length;return S===0?"":arguments.length===0?j(this,0,S):E.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(S){if(!a.isBuffer(S))throw new TypeError("Argument must be a Buffer");return this===S?!0:a.compare(this,S)===0},a.prototype.inspect=function(){let S="";const C=r.INSPECT_MAX_BYTES;return S=this.toString("hex",0,C).replace(/(.{2})/g,"$1 ").trim(),this.length>C&&(S+=" ... "),"<Buffer "+S+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(S,C,M,P,N){if(bn(S,Uint8Array)&&(S=a.from(S,S.offset,S.byteLength)),!a.isBuffer(S))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof S);if(C===void 0&&(C=0),M===void 0&&(M=S?S.length:0),P===void 0&&(P=0),N===void 0&&(N=this.length),C<0||M>S.length||P<0||N>this.length)throw new RangeError("out of range index");if(P>=N&&C>=M)return 0;if(P>=N)return-1;if(C>=M)return 1;if(C>>>=0,M>>>=0,P>>>=0,N>>>=0,this===S)return 0;let R=N-P,J=M-C;const he=Math.min(R,J),Oe=this.slice(P,N),Fe=S.slice(C,M);for(let Ee=0;Ee<he;++Ee)if(Oe[Ee]!==Fe[Ee]){R=Oe[Ee],J=Fe[Ee];break}return R<J?-1:J<R?1:0};function k(D,S,C,M,P){if(D.length===0)return-1;if(typeof C=="string"?(M=C,C=0):C>2147483647?C=2147483647:C<-2147483648&&(C=-2147483648),C=+C,Wc(C)&&(C=P?0:D.length-1),C<0&&(C=D.length+C),C>=D.length){if(P)return-1;C=D.length-1}else if(C<0)if(P)C=0;else return-1;if(typeof S=="string"&&(S=a.from(S,M)),a.isBuffer(S))return S.length===0?-1:x(D,S,C,M,P);if(typeof S=="number")return S=S&255,typeof Uint8Array.prototype.indexOf=="function"?P?Uint8Array.prototype.indexOf.call(D,S,C):Uint8Array.prototype.lastIndexOf.call(D,S,C):x(D,[S],C,M,P);throw new TypeError("val must be string, number or Buffer")}function x(D,S,C,M,P){let N=1,R=D.length,J=S.length;if(M!==void 0&&(M=String(M).toLowerCase(),M==="ucs2"||M==="ucs-2"||M==="utf16le"||M==="utf-16le")){if(D.length<2||S.length<2)return-1;N=2,R/=2,J/=2,C/=2}function he(Fe,Ee){return N===1?Fe[Ee]:Fe.readUInt16BE(Ee*N)}let Oe;if(P){let Fe=-1;for(Oe=C;Oe<R;Oe++)if(he(D,Oe)===he(S,Fe===-1?0:Oe-Fe)){if(Fe===-1&&(Fe=Oe),Oe-Fe+1===J)return Fe*N}else Fe!==-1&&(Oe-=Oe-Fe),Fe=-1}else for(C+J>R&&(C=R-J),Oe=C;Oe>=0;Oe--){let Fe=!0;for(let Ee=0;Ee<J;Ee++)if(he(D,Oe+Ee)!==he(S,Ee)){Fe=!1;break}if(Fe)return Oe}return-1}a.prototype.includes=function(S,C,M){return this.indexOf(S,C,M)!==-1},a.prototype.indexOf=function(S,C,M){return k(this,S,C,M,!0)},a.prototype.lastIndexOf=function(S,C,M){return k(this,S,C,M,!1)};function I(D,S,C,M){C=Number(C)||0;const P=D.length-C;M?(M=Number(M),M>P&&(M=P)):M=P;const N=S.length;M>N/2&&(M=N/2);let R;for(R=0;R<M;++R){const J=parseInt(S.substr(R*2,2),16);if(Wc(J))return R;D[C+R]=J}return R}function T(D,S,C,M){return bs(eo(S,D.length-C),D,C,M)}function L(D,S,C,M){return bs(pe(S),D,C,M)}function z(D,S,C,M){return bs(to(S),D,C,M)}function B(D,S,C,M){return bs(ws(S,D.length-C),D,C,M)}a.prototype.write=function(S,C,M,P){if(C===void 0)P="utf8",M=this.length,C=0;else if(M===void 0&&typeof C=="string")P=C,M=this.length,C=0;else if(isFinite(C))C=C>>>0,isFinite(M)?(M=M>>>0,P===void 0&&(P="utf8")):(P=M,M=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const N=this.length-C;if((M===void 0||M>N)&&(M=N),S.length>0&&(M<0||C<0)||C>this.length)throw new RangeError("Attempt to write outside buffer bounds");P||(P="utf8");let R=!1;for(;;)switch(P){case"hex":return I(this,S,C,M);case"utf8":case"utf-8":return T(this,S,C,M);case"ascii":case"latin1":case"binary":return L(this,S,C,M);case"base64":return z(this,S,C,M);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,S,C,M);default:if(R)throw new TypeError("Unknown encoding: "+P);P=(""+P).toLowerCase(),R=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function G(D,S,C){return S===0&&C===D.length?e.fromByteArray(D):e.fromByteArray(D.slice(S,C))}function j(D,S,C){C=Math.min(D.length,C);const M=[];let P=S;for(;P<C;){const N=D[P];let R=null,J=N>239?4:N>223?3:N>191?2:1;if(P+J<=C){let he,Oe,Fe,Ee;switch(J){case 1:N<128&&(R=N);break;case 2:he=D[P+1],(he&192)===128&&(Ee=(N&31)<<6|he&63,Ee>127&&(R=Ee));break;case 3:he=D[P+1],Oe=D[P+2],(he&192)===128&&(Oe&192)===128&&(Ee=(N&15)<<12|(he&63)<<6|Oe&63,Ee>2047&&(Ee<55296||Ee>57343)&&(R=Ee));break;case 4:he=D[P+1],Oe=D[P+2],Fe=D[P+3],(he&192)===128&&(Oe&192)===128&&(Fe&192)===128&&(Ee=(N&15)<<18|(he&63)<<12|(Oe&63)<<6|Fe&63,Ee>65535&&Ee<1114112&&(R=Ee))}}R===null?(R=65533,J=1):R>65535&&(R-=65536,M.push(R>>>10&1023|55296),R=56320|R&1023),M.push(R),P+=J}return Q(M)}const q=4096;function Q(D){const S=D.length;if(S<=q)return String.fromCharCode.apply(String,D);let C="",M=0;for(;M<S;)C+=String.fromCharCode.apply(String,D.slice(M,M+=q));return C}function K(D,S,C){let M="";C=Math.min(D.length,C);for(let P=S;P<C;++P)M+=String.fromCharCode(D[P]&127);return M}function O(D,S,C){let M="";C=Math.min(D.length,C);for(let P=S;P<C;++P)M+=String.fromCharCode(D[P]);return M}function U(D,S,C){const M=D.length;(!S||S<0)&&(S=0),(!C||C<0||C>M)&&(C=M);let P="";for(let N=S;N<C;++N)P+=$A[D[N]];return P}function W(D,S,C){const M=D.slice(S,C);let P="";for(let N=0;N<M.length-1;N+=2)P+=String.fromCharCode(M[N]+M[N+1]*256);return P}a.prototype.slice=function(S,C){const M=this.length;S=~~S,C=C===void 0?M:~~C,S<0?(S+=M,S<0&&(S=0)):S>M&&(S=M),C<0?(C+=M,C<0&&(C=0)):C>M&&(C=M),C<S&&(C=S);const P=this.subarray(S,C);return Object.setPrototypeOf(P,a.prototype),P};function Y(D,S,C){if(D%1!==0||D<0)throw new RangeError("offset is not uint");if(D+S>C)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(S,C,M){S=S>>>0,C=C>>>0,M||Y(S,C,this.length);let P=this[S],N=1,R=0;for(;++R<C&&(N*=256);)P+=this[S+R]*N;return P},a.prototype.readUintBE=a.prototype.readUIntBE=function(S,C,M){S=S>>>0,C=C>>>0,M||Y(S,C,this.length);let P=this[S+--C],N=1;for(;C>0&&(N*=256);)P+=this[S+--C]*N;return P},a.prototype.readUint8=a.prototype.readUInt8=function(S,C){return S=S>>>0,C||Y(S,1,this.length),this[S]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(S,C){return S=S>>>0,C||Y(S,2,this.length),this[S]|this[S+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(S,C){return S=S>>>0,C||Y(S,2,this.length),this[S]<<8|this[S+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(S,C){return S=S>>>0,C||Y(S,4,this.length),(this[S]|this[S+1]<<8|this[S+2]<<16)+this[S+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(S,C){return S=S>>>0,C||Y(S,4,this.length),this[S]*16777216+(this[S+1]<<16|this[S+2]<<8|this[S+3])},a.prototype.readBigUInt64LE=ro(function(S){S=S>>>0,$t(S,"offset");const C=this[S],M=this[S+7];(C===void 0||M===void 0)&&nr(S,this.length-8);const P=C+this[++S]*2**8+this[++S]*2**16+this[++S]*2**24,N=this[++S]+this[++S]*2**8+this[++S]*2**16+M*2**24;return BigInt(P)+(BigInt(N)<<BigInt(32))}),a.prototype.readBigUInt64BE=ro(function(S){S=S>>>0,$t(S,"offset");const C=this[S],M=this[S+7];(C===void 0||M===void 0)&&nr(S,this.length-8);const P=C*2**24+this[++S]*2**16+this[++S]*2**8+this[++S],N=this[++S]*2**24+this[++S]*2**16+this[++S]*2**8+M;return(BigInt(P)<<BigInt(32))+BigInt(N)}),a.prototype.readIntLE=function(S,C,M){S=S>>>0,C=C>>>0,M||Y(S,C,this.length);let P=this[S],N=1,R=0;for(;++R<C&&(N*=256);)P+=this[S+R]*N;return N*=128,P>=N&&(P-=Math.pow(2,8*C)),P},a.prototype.readIntBE=function(S,C,M){S=S>>>0,C=C>>>0,M||Y(S,C,this.length);let P=C,N=1,R=this[S+--P];for(;P>0&&(N*=256);)R+=this[S+--P]*N;return N*=128,R>=N&&(R-=Math.pow(2,8*C)),R},a.prototype.readInt8=function(S,C){return S=S>>>0,C||Y(S,1,this.length),this[S]&128?(255-this[S]+1)*-1:this[S]},a.prototype.readInt16LE=function(S,C){S=S>>>0,C||Y(S,2,this.length);const M=this[S]|this[S+1]<<8;return M&32768?M|4294901760:M},a.prototype.readInt16BE=function(S,C){S=S>>>0,C||Y(S,2,this.length);const M=this[S+1]|this[S]<<8;return M&32768?M|4294901760:M},a.prototype.readInt32LE=function(S,C){return S=S>>>0,C||Y(S,4,this.length),this[S]|this[S+1]<<8|this[S+2]<<16|this[S+3]<<24},a.prototype.readInt32BE=function(S,C){return S=S>>>0,C||Y(S,4,this.length),this[S]<<24|this[S+1]<<16|this[S+2]<<8|this[S+3]},a.prototype.readBigInt64LE=ro(function(S){S=S>>>0,$t(S,"offset");const C=this[S],M=this[S+7];(C===void 0||M===void 0)&&nr(S,this.length-8);const P=this[S+4]+this[S+5]*2**8+this[S+6]*2**16+(M<<24);return(BigInt(P)<<BigInt(32))+BigInt(C+this[++S]*2**8+this[++S]*2**16+this[++S]*2**24)}),a.prototype.readBigInt64BE=ro(function(S){S=S>>>0,$t(S,"offset");const C=this[S],M=this[S+7];(C===void 0||M===void 0)&&nr(S,this.length-8);const P=(C<<24)+this[++S]*2**16+this[++S]*2**8+this[++S];return(BigInt(P)<<BigInt(32))+BigInt(this[++S]*2**24+this[++S]*2**16+this[++S]*2**8+M)}),a.prototype.readFloatLE=function(S,C){return S=S>>>0,C||Y(S,4,this.length),t.read(this,S,!0,23,4)},a.prototype.readFloatBE=function(S,C){return S=S>>>0,C||Y(S,4,this.length),t.read(this,S,!1,23,4)},a.prototype.readDoubleLE=function(S,C){return S=S>>>0,C||Y(S,8,this.length),t.read(this,S,!0,52,8)},a.prototype.readDoubleBE=function(S,C){return S=S>>>0,C||Y(S,8,this.length),t.read(this,S,!1,52,8)};function H(D,S,C,M,P,N){if(!a.isBuffer(D))throw new TypeError('"buffer" argument must be a Buffer instance');if(S>P||S<N)throw new RangeError('"value" argument is out of bounds');if(C+M>D.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(S,C,M,P){if(S=+S,C=C>>>0,M=M>>>0,!P){const J=Math.pow(2,8*M)-1;H(this,S,C,M,J,0)}let N=1,R=0;for(this[C]=S&255;++R<M&&(N*=256);)this[C+R]=S/N&255;return C+M},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(S,C,M,P){if(S=+S,C=C>>>0,M=M>>>0,!P){const J=Math.pow(2,8*M)-1;H(this,S,C,M,J,0)}let N=M-1,R=1;for(this[C+N]=S&255;--N>=0&&(R*=256);)this[C+N]=S/R&255;return C+M},a.prototype.writeUint8=a.prototype.writeUInt8=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,1,255,0),this[C]=S&255,C+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,2,65535,0),this[C]=S&255,this[C+1]=S>>>8,C+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,2,65535,0),this[C]=S>>>8,this[C+1]=S&255,C+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,4,4294967295,0),this[C+3]=S>>>24,this[C+2]=S>>>16,this[C+1]=S>>>8,this[C]=S&255,C+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,4,4294967295,0),this[C]=S>>>24,this[C+1]=S>>>16,this[C+2]=S>>>8,this[C+3]=S&255,C+4};function ie(D,S,C,M,P){kt(S,M,P,D,C,7);let N=Number(S&BigInt(4294967295));D[C++]=N,N=N>>8,D[C++]=N,N=N>>8,D[C++]=N,N=N>>8,D[C++]=N;let R=Number(S>>BigInt(32)&BigInt(4294967295));return D[C++]=R,R=R>>8,D[C++]=R,R=R>>8,D[C++]=R,R=R>>8,D[C++]=R,C}function me(D,S,C,M,P){kt(S,M,P,D,C,7);let N=Number(S&BigInt(4294967295));D[C+7]=N,N=N>>8,D[C+6]=N,N=N>>8,D[C+5]=N,N=N>>8,D[C+4]=N;let R=Number(S>>BigInt(32)&BigInt(4294967295));return D[C+3]=R,R=R>>8,D[C+2]=R,R=R>>8,D[C+1]=R,R=R>>8,D[C]=R,C+8}a.prototype.writeBigUInt64LE=ro(function(S,C=0){return ie(this,S,C,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=ro(function(S,C=0){return me(this,S,C,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(S,C,M,P){if(S=+S,C=C>>>0,!P){const he=Math.pow(2,8*M-1);H(this,S,C,M,he-1,-he)}let N=0,R=1,J=0;for(this[C]=S&255;++N<M&&(R*=256);)S<0&&J===0&&this[C+N-1]!==0&&(J=1),this[C+N]=(S/R>>0)-J&255;return C+M},a.prototype.writeIntBE=function(S,C,M,P){if(S=+S,C=C>>>0,!P){const he=Math.pow(2,8*M-1);H(this,S,C,M,he-1,-he)}let N=M-1,R=1,J=0;for(this[C+N]=S&255;--N>=0&&(R*=256);)S<0&&J===0&&this[C+N+1]!==0&&(J=1),this[C+N]=(S/R>>0)-J&255;return C+M},a.prototype.writeInt8=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,1,127,-128),S<0&&(S=255+S+1),this[C]=S&255,C+1},a.prototype.writeInt16LE=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,2,32767,-32768),this[C]=S&255,this[C+1]=S>>>8,C+2},a.prototype.writeInt16BE=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,2,32767,-32768),this[C]=S>>>8,this[C+1]=S&255,C+2},a.prototype.writeInt32LE=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,4,2147483647,-2147483648),this[C]=S&255,this[C+1]=S>>>8,this[C+2]=S>>>16,this[C+3]=S>>>24,C+4},a.prototype.writeInt32BE=function(S,C,M){return S=+S,C=C>>>0,M||H(this,S,C,4,2147483647,-2147483648),S<0&&(S=4294967295+S+1),this[C]=S>>>24,this[C+1]=S>>>16,this[C+2]=S>>>8,this[C+3]=S&255,C+4},a.prototype.writeBigInt64LE=ro(function(S,C=0){return ie(this,S,C,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=ro(function(S,C=0){return me(this,S,C,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function de(D,S,C,M,P,N){if(C+M>D.length)throw new RangeError("Index out of range");if(C<0)throw new RangeError("Index out of range")}function le(D,S,C,M,P){return S=+S,C=C>>>0,P||de(D,S,C,4),t.write(D,S,C,M,23,4),C+4}a.prototype.writeFloatLE=function(S,C,M){return le(this,S,C,!0,M)},a.prototype.writeFloatBE=function(S,C,M){return le(this,S,C,!1,M)};function Ne(D,S,C,M,P){return S=+S,C=C>>>0,P||de(D,S,C,8),t.write(D,S,C,M,52,8),C+8}a.prototype.writeDoubleLE=function(S,C,M){return Ne(this,S,C,!0,M)},a.prototype.writeDoubleBE=function(S,C,M){return Ne(this,S,C,!1,M)},a.prototype.copy=function(S,C,M,P){if(!a.isBuffer(S))throw new TypeError("argument should be a Buffer");if(M||(M=0),!P&&P!==0&&(P=this.length),C>=S.length&&(C=S.length),C||(C=0),P>0&&P<M&&(P=M),P===M||S.length===0||this.length===0)return 0;if(C<0)throw new RangeError("targetStart out of bounds");if(M<0||M>=this.length)throw new RangeError("Index out of range");if(P<0)throw new RangeError("sourceEnd out of bounds");P>this.length&&(P=this.length),S.length-C<P-M&&(P=S.length-C+M);const N=P-M;return this===S&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(C,M,P):Uint8Array.prototype.set.call(S,this.subarray(M,P),C),N},a.prototype.fill=function(S,C,M,P){if(typeof S=="string"){if(typeof C=="string"?(P=C,C=0,M=this.length):typeof M=="string"&&(P=M,M=this.length),P!==void 0&&typeof P!="string")throw new TypeError("encoding must be a string");if(typeof P=="string"&&!a.isEncoding(P))throw new TypeError("Unknown encoding: "+P);if(S.length===1){const R=S.charCodeAt(0);(P==="utf8"&&R<128||P==="latin1")&&(S=R)}}else typeof S=="number"?S=S&255:typeof S=="boolean"&&(S=Number(S));if(C<0||this.length<C||this.length<M)throw new RangeError("Out of range index");if(M<=C)return this;C=C>>>0,M=M===void 0?this.length:M>>>0,S||(S=0);let N;if(typeof S=="number")for(N=C;N<M;++N)this[N]=S;else{const R=a.isBuffer(S)?S:a.from(S,P),J=R.length;if(J===0)throw new TypeError('The value "'+S+'" is invalid for argument "value"');for(N=0;N<M-C;++N)this[N+C]=R[N%J]}return this};const Me={};function Xe(D,S,C){Me[D]=class extends C{constructor(){super(),Object.defineProperty(this,"message",{value:S.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${D}]`,this.stack,delete this.name}get code(){return D}set code(P){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:P,writable:!0})}toString(){return`${this.name} [${D}]: ${this.message}`}}}Xe("ERR_BUFFER_OUT_OF_BOUNDS",function(D){return D?`${D} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Xe("ERR_INVALID_ARG_TYPE",function(D,S){return`The "${D}" argument must be of type number. Received type ${typeof S}`},TypeError),Xe("ERR_OUT_OF_RANGE",function(D,S,C){let M=`The value of "${D}" is out of range.`,P=C;return Number.isInteger(C)&&Math.abs(C)>2**32?P=nt(String(C)):typeof C=="bigint"&&(P=String(C),(C>BigInt(2)**BigInt(32)||C<-(BigInt(2)**BigInt(32)))&&(P=nt(P)),P+="n"),M+=` It must be ${S}. Received ${P}`,M},RangeError);function nt(D){let S="",C=D.length;const M=D[0]==="-"?1:0;for(;C>=M+4;C-=3)S=`_${D.slice(C-3,C)}${S}`;return`${D.slice(0,C)}${S}`}function It(D,S,C){$t(S,"offset"),(D[S]===void 0||D[S+C]===void 0)&&nr(S,D.length-(C+1))}function kt(D,S,C,M,P,N){if(D>C||D<S){const R=typeof S=="bigint"?"n":"";let J;throw S===0||S===BigInt(0)?J=`>= 0${R} and < 2${R} ** ${(N+1)*8}${R}`:J=`>= -(2${R} ** ${(N+1)*8-1}${R}) and < 2 ** ${(N+1)*8-1}${R}`,new Me.ERR_OUT_OF_RANGE("value",J,D)}It(M,P,N)}function $t(D,S){if(typeof D!="number")throw new Me.ERR_INVALID_ARG_TYPE(S,"number",D)}function nr(D,S,C){throw Math.floor(D)!==D?($t(D,C),new Me.ERR_OUT_OF_RANGE("offset","an integer",D)):S<0?new Me.ERR_BUFFER_OUT_OF_BOUNDS:new Me.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${S}`,D)}const Nr=/[^+/0-9A-Za-z-_]/g;function fa(D){if(D=D.split("=")[0],D=D.trim().replace(Nr,""),D.length<2)return"";for(;D.length%4!==0;)D=D+"=";return D}function eo(D,S){S=S||1/0;let C;const M=D.length;let P=null;const N=[];for(let R=0;R<M;++R){if(C=D.charCodeAt(R),C>55295&&C<57344){if(!P){if(C>56319){(S-=3)>-1&&N.push(239,191,189);continue}else if(R+1===M){(S-=3)>-1&&N.push(239,191,189);continue}P=C;continue}if(C<56320){(S-=3)>-1&&N.push(239,191,189),P=C;continue}C=(P-55296<<10|C-56320)+65536}else P&&(S-=3)>-1&&N.push(239,191,189);if(P=null,C<128){if((S-=1)<0)break;N.push(C)}else if(C<2048){if((S-=2)<0)break;N.push(C>>6|192,C&63|128)}else if(C<65536){if((S-=3)<0)break;N.push(C>>12|224,C>>6&63|128,C&63|128)}else if(C<1114112){if((S-=4)<0)break;N.push(C>>18|240,C>>12&63|128,C>>6&63|128,C&63|128)}else throw new Error("Invalid code point")}return N}function pe(D){const S=[];for(let C=0;C<D.length;++C)S.push(D.charCodeAt(C)&255);return S}function ws(D,S){let C,M,P;const N=[];for(let R=0;R<D.length&&!((S-=2)<0);++R)C=D.charCodeAt(R),M=C>>8,P=C%256,N.push(P),N.push(M);return N}function to(D){return e.toByteArray(fa(D))}function bs(D,S,C,M){let P;for(P=0;P<M&&!(P+C>=S.length||P>=D.length);++P)S[P+C]=D[P];return P}function bn(D,S){return D instanceof S||D!=null&&D.constructor!=null&&D.constructor.name!=null&&D.constructor.name===S.name}function Wc(D){return D!==D}const $A=function(){const D="0123456789abcdef",S=new Array(256);for(let C=0;C<16;++C){const M=C*16;for(let P=0;P<16;++P)S[M+P]=D[C]+D[P]}return S}();function ro(D){return typeof BigInt>"u"?_u:D}function _u(){throw new Error("BigInt not supported")}})(c2);let U6=null;var yT=function(){return U6===null&&(U6={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),U6},Xf={},F6={};const z6=ks,wX=new Set(["buffer","view","utf8"]);let bX=class{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!wX.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new z6(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new z6(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new z6(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};F6.Encoding=bX;const{Buffer:V6}=c2||{},{Encoding:K6}=F6,vX=yT;let j6=class extends K6{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new H6({encode:this.encode,decode:e=>this.decode(V6.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},H6=class extends K6{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new j6({encode:e=>{const t=this.encode(e);return V6.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},EX=class extends K6{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new j6({encode:e=>V6.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){const{textEncoder:e,textDecoder:t}=vX();return new H6({encode:n=>e.encode(this.encode(n)),decode:n=>this.decode(t.decode(n)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};Xf.BufferFormat=j6,Xf.ViewFormat=H6,Xf.UTF8Format=EX;const{Buffer:Br}=c2||{Buffer:{isBuffer:()=>!1}},{textEncoder:mT,textDecoder:wT}=yT(),{BufferFormat:Zf,ViewFormat:q6,UTF8Format:bT}=Xf,u2=r=>r;gl.utf8=new bT({encode:function(r){return Br.isBuffer(r)?r.toString("utf8"):ArrayBuffer.isView(r)?wT.decode(r):String(r)},decode:u2,name:"utf8",createViewTranscoder(){return new q6({encode:function(r){return ArrayBuffer.isView(r)?r:mT.encode(r)},decode:function(r){return wT.decode(r)},name:`${this.name}+view`})},createBufferTranscoder(){return new Zf({encode:function(r){return Br.isBuffer(r)?r:ArrayBuffer.isView(r)?Br.from(r.buffer,r.byteOffset,r.byteLength):Br.from(String(r),"utf8")},decode:function(r){return r.toString("utf8")},name:`${this.name}+buffer`})}}),gl.json=new bT({encode:JSON.stringify,decode:JSON.parse,name:"json"}),gl.buffer=new Zf({encode:function(r){return Br.isBuffer(r)?r:ArrayBuffer.isView(r)?Br.from(r.buffer,r.byteOffset,r.byteLength):Br.from(String(r),"utf8")},decode:u2,name:"buffer",createViewTranscoder(){return new q6({encode:function(r){return ArrayBuffer.isView(r)?r:Br.from(String(r),"utf8")},decode:function(r){return Br.from(r.buffer,r.byteOffset,r.byteLength)},name:`${this.name}+view`})}}),gl.view=new q6({encode:function(r){return ArrayBuffer.isView(r)?r:mT.encode(r)},decode:u2,name:"view",createBufferTranscoder(){return new Zf({encode:function(r){return Br.isBuffer(r)?r:ArrayBuffer.isView(r)?Br.from(r.buffer,r.byteOffset,r.byteLength):Br.from(String(r),"utf8")},decode:u2,name:`${this.name}+buffer`})}}),gl.hex=new Zf({encode:function(r){return Br.isBuffer(r)?r:Br.from(String(r),"hex")},decode:function(r){return r.toString("hex")},name:"hex"}),gl.base64=new Zf({encode:function(r){return Br.isBuffer(r)?r:Br.from(String(r),"base64")},decode:function(r){return r.toString("base64")},name:"base64"});const vT=ks,d2=gl,{Encoding:SX}=F6,{BufferFormat:xX,ViewFormat:AX,UTF8Format:CX}=Xf,e1=Symbol("formats"),h2=Symbol("encodings"),IX=new Set(["buffer","view","utf8"]);let kX=class{constructor(e){if(Array.isArray(e)){if(!e.every(t=>IX.has(t)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[h2]=new Map,this[e1]=new Set(e);for(const t in d2)try{this.encoding(t)}catch(n){if(n.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw n}}encodings(){return Array.from(new Set(this[h2].values()))}encoding(e){let t=this[h2].get(e);if(t===void 0){if(typeof e=="string"&&e!==""){if(t=DX[e],!t)throw new vT(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof e!="object"||e===null)throw new TypeError("First argument 'encoding' must be a string or object");t=_X(e)}const{name:n,format:i}=t;if(!this[e1].has(i))if(this[e1].has("view"))t=t.createViewTranscoder();else if(this[e1].has("buffer"))t=t.createBufferTranscoder();else if(this[e1].has("utf8"))t=t.createUTF8Transcoder();else throw new vT(`Encoding '${n}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(const s of[e,n,t.name,t.commonName])this[h2].set(s,t)}return t}};pT.Transcoder=kX;function _X(r){if(r instanceof SX)return r;const e="type"in r&&typeof r.type=="string"?r.type:void 0,t=r.name||e||`anonymous-${$X++}`;switch(TX(r)){case"view":return new AX({...r,name:t});case"utf8":return new CX({...r,name:t});case"buffer":return new xX({...r,name:t});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function TX(r){return"format"in r&&r.format!==void 0?r.format:"buffer"in r&&typeof r.buffer=="boolean"?r.buffer?"buffer":"utf8":"code"in r&&Number.isInteger(r.code)?"view":"buffer"}const PX={binary:d2.buffer,"utf-8":d2.utf8},DX={...d2,...PX};let $X=0;var dd={},NX=typeof queueMicrotask=="function"?queueMicrotask:r=>Promise.resolve().then(r),ET=NX;dd.fromCallback=function(r,e){if(r===void 0){var t=new Promise(function(n,i){r=function(s,o){s?i(s):n(o)}});r[e!==void 0?e:"promise"]=t}else if(typeof r!="function")throw new TypeError("Callback must be a function");return r},dd.fromPromise=function(r,e){if(e===void 0)return r;r.then(function(t){ET(()=>e(null,t))}).catch(function(t){ET(()=>e(t))})};var Ts={},t1={};t1.getCallback=function(r,e){return typeof r=="function"?r:e},t1.getOptions=function(r,e){return typeof r=="object"&&r!==null?r:e!==void 0?e:{}};const{fromCallback:W6}=dd,Yn=ks,{getOptions:G6,getCallback:ST}=t1,yl=Symbol("promise"),hd=Symbol("callback"),Ps=Symbol("working"),ml=Symbol("handleOne"),So=Symbol("handleMany"),Q6=Symbol("autoClose"),Va=Symbol("finishWork"),Ds=Symbol("returnMany"),Ka=Symbol("closing"),r1=Symbol("handleClose"),f2=Symbol("closed"),n1=Symbol("closeCallbacks"),ja=Symbol("keyEncoding"),wl=Symbol("valueEncoding"),Y6=Symbol("abortOnClose"),p2=Symbol("legacy"),J6=Symbol("keys"),X6=Symbol("values"),Ha=Symbol("limit"),Ai=Symbol("count"),g2=Object.freeze({}),MX=()=>{};let xT=!1;class Z6{constructor(e,t,n){if(typeof e!="object"||e===null){const i=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${i}`)}if(typeof t!="object"||t===null)throw new TypeError("The second argument must be an options object");this[f2]=!1,this[n1]=[],this[Ps]=!1,this[Ka]=!1,this[Q6]=!1,this[hd]=null,this[ml]=this[ml].bind(this),this[So]=this[So].bind(this),this[r1]=this[r1].bind(this),this[ja]=t[ja],this[wl]=t[wl],this[p2]=n,this[Ha]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[Ai]=0,this[Y6]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[Ai]}get limit(){return this[Ha]}next(e){let t;if(e===void 0)t=new Promise((n,i)=>{e=(s,o,a)=>{s?i(s):this[p2]?o===void 0&&a===void 0?n():n([o,a]):n(o)}});else if(typeof e!="function")throw new TypeError("Callback must be a function");return this[Ka]?this.nextTick(e,new Yn("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Ps]?this.nextTick(e,new Yn("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[Ps]=!0,this[hd]=e,this[Ai]>=this[Ha]?this.nextTick(this[ml],null):this._next(this[ml])),t}_next(e){this.nextTick(e)}nextv(e,t,n){return n=ST(t,n),n=W6(n,yl),t=G6(t,g2),Number.isInteger(e)?(this[Ka]?this.nextTick(n,new Yn("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Ps]?this.nextTick(n,new Yn("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[Ha]<1/0&&(e=Math.min(e,this[Ha]-this[Ai])),this[Ps]=!0,this[hd]=n,e<=0?this.nextTick(this[So],null,[]):this._nextv(e,t,this[So])),n[yl]):(this.nextTick(n,new TypeError("The first argument 'size' must be an integer")),n[yl])}_nextv(e,t,n){const i=[],s=(o,a,c)=>{if(o)return n(o);if(this[p2]?a===void 0&&c===void 0:a===void 0)return n(null,i);i.push(this[p2]?[a,c]:a),i.length===e?n(null,i):this._next(s)};this._next(s)}all(e,t){return t=ST(e,t),t=W6(t,yl),e=G6(e,g2),this[Ka]?this.nextTick(t,new Yn("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Ps]?this.nextTick(t,new Yn("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[Ps]=!0,this[hd]=t,this[Q6]=!0,this[Ai]>=this[Ha]?this.nextTick(this[So],null,[]):this._all(e,this[So])),t[yl]}_all(e,t){let n=this[Ai];const i=[],s=()=>{const a=this[Ha]<1/0?Math.min(1e3,this[Ha]-n):1e3;a<=0?this.nextTick(t,null,i):this._nextv(a,g2,o)},o=(a,c)=>{a?t(a):c.length===0?t(null,i):(i.push.apply(i,c),n+=c.length,s())};s()}[Va](){const e=this[hd];return this[Y6]&&e===null?MX:(this[Ps]=!1,this[hd]=null,this[Ka]&&this._close(this[r1]),e)}[Ds](e,t,n){this[Q6]?this.close(e.bind(null,t,n)):e(t,n)}seek(e,t){if(t=G6(t,g2),!this[Ka]){if(this[Ps])throw new Yn("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const n=this.db.keyEncoding(t.keyEncoding||this[ja]),i=n.format;t.keyEncoding!==i&&(t={...t,keyEncoding:i});const s=this.db.prefixKey(n.encode(e),i);this._seek(s,t)}}}_seek(e,t){throw new Yn("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){return e=W6(e,yl),this[f2]?this.nextTick(e):this[Ka]?this[n1].push(e):(this[Ka]=!0,this[n1].push(e),this[Ps]?this[Y6]&&this[Va]()(new Yn("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[r1])),e[yl]}_close(e){this.nextTick(e)}[r1](){this[f2]=!0,this.db.detachResource(this);const e=this[n1];this[n1]=[];for(const t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;(e=await this.next())!==void 0;)yield e}finally{this[f2]||await this.close()}}}let y2=class extends Z6{constructor(e,t){super(e,t,!0),this[J6]=t.keys!==!1,this[X6]=t.values!==!1}[ml](e,t,n){const i=this[Va]();if(e)return i(e);try{t=this[J6]&&t!==void 0?this[ja].decode(t):void 0,n=this[X6]&&n!==void 0?this[wl].decode(n):void 0}catch(s){return i(new fd("entry",s))}t===void 0&&n===void 0||this[Ai]++,i(null,t,n)}[So](e,t){const n=this[Va]();if(e)return this[Ds](n,e);try{for(const i of t){const s=i[0],o=i[1];i[0]=this[J6]&&s!==void 0?this[ja].decode(s):void 0,i[1]=this[X6]&&o!==void 0?this[wl].decode(o):void 0}}catch(i){return this[Ds](n,new fd("entries",i))}this[Ai]+=t.length,this[Ds](n,null,t)}end(e){return!xT&&typeof console<"u"&&(xT=!0,console.warn(new Yn("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}},OX=class extends Z6{constructor(e,t){super(e,t,!1)}[ml](e,t){const n=this[Va]();if(e)return n(e);try{t=t!==void 0?this[ja].decode(t):void 0}catch(i){return n(new fd("key",i))}t!==void 0&&this[Ai]++,n(null,t)}[So](e,t){const n=this[Va]();if(e)return this[Ds](n,e);try{for(let i=0;i<t.length;i++){const s=t[i];t[i]=s!==void 0?this[ja].decode(s):void 0}}catch(i){return this[Ds](n,new fd("keys",i))}this[Ai]+=t.length,this[Ds](n,null,t)}},RX=class extends Z6{constructor(e,t){super(e,t,!1)}[ml](e,t){const n=this[Va]();if(e)return n(e);try{t=t!==void 0?this[wl].decode(t):void 0}catch(i){return n(new fd("value",i))}t!==void 0&&this[Ai]++,n(null,t)}[So](e,t){const n=this[Va]();if(e)return this[Ds](n,e);try{for(let i=0;i<t.length;i++){const s=t[i];t[i]=s!==void 0?this[wl].decode(s):void 0}}catch(i){return this[Ds](n,new fd("values",i))}this[Ai]+=t.length,this[Ds](n,null,t)}};class fd extends Yn{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}}for(const r of["_ended property","_nexting property","_end method"])Object.defineProperty(y2.prototype,r.split(" ")[0],{get(){throw new Yn(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new Yn(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})}});y2.keyEncoding=ja,y2.valueEncoding=wl,Ts.AbstractIterator=y2,Ts.AbstractKeyIterator=OX,Ts.AbstractValueIterator=RX;var eb={};const{AbstractKeyIterator:LX,AbstractValueIterator:BX}=Ts,bl=Symbol("iterator"),i1=Symbol("callback"),pd=Symbol("handleOne"),vl=Symbol("handleMany");let tb=class extends LX{constructor(e,t){super(e,t),this[bl]=e.iterator({...t,keys:!0,values:!1}),this[pd]=this[pd].bind(this),this[vl]=this[vl].bind(this)}},AT=class extends BX{constructor(e,t){super(e,t),this[bl]=e.iterator({...t,keys:!1,values:!0}),this[pd]=this[pd].bind(this),this[vl]=this[vl].bind(this)}};for(const r of[tb,AT]){const e=r===tb,t=e?n=>n[0]:n=>n[1];r.prototype._next=function(n){this[i1]=n,this[bl].next(this[pd])},r.prototype[pd]=function(n,i,s){const o=this[i1];n?o(n):o(null,e?i:s)},r.prototype._nextv=function(n,i,s){this[i1]=s,this[bl].nextv(n,i,this[vl])},r.prototype._all=function(n,i){this[i1]=i,this[bl].all(n,this[vl])},r.prototype[vl]=function(n,i){const s=this[i1];n?s(n):s(null,i.map(t))},r.prototype._seek=function(n,i){this[bl].seek(n,i)},r.prototype._close=function(n){this[bl].close(n)}}eb.DefaultKeyIterator=tb,eb.DefaultValueIterator=AT;var m2={};const{AbstractIterator:UX,AbstractKeyIterator:FX,AbstractValueIterator:zX}=Ts,rb=ks,Cn=Symbol("nut"),w2=Symbol("undefer"),b2=Symbol("factory");let CT=class extends UX{constructor(e,t){super(e,t),this[Cn]=null,this[b2]=()=>e.iterator(t),this.db.defer(()=>this[w2]())}},IT=class extends FX{constructor(e,t){super(e,t),this[Cn]=null,this[b2]=()=>e.keys(t),this.db.defer(()=>this[w2]())}},kT=class extends zX{constructor(e,t){super(e,t),this[Cn]=null,this[b2]=()=>e.values(t),this.db.defer(()=>this[w2]())}};for(const r of[CT,IT,kT])r.prototype[w2]=function(){this.db.status==="open"&&(this[Cn]=this[b2]())},r.prototype._next=function(e){this[Cn]!==null?this[Cn].next(e):this.db.status==="opening"?this.db.defer(()=>this._next(e)):this.nextTick(e,new rb("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._nextv=function(e,t,n){this[Cn]!==null?this[Cn].nextv(e,t,n):this.db.status==="opening"?this.db.defer(()=>this._nextv(e,t,n)):this.nextTick(n,new rb("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._all=function(e,t){this[Cn]!==null?this[Cn].all(t):this.db.status==="opening"?this.db.defer(()=>this._all(e,t)):this.nextTick(t,new rb("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._seek=function(e,t){this[Cn]!==null?this[Cn]._seek(e,t):this.db.status==="opening"&&this.db.defer(()=>this._seek(e,t))},r.prototype._close=function(e){this[Cn]!==null?this[Cn].close(e):this.db.status==="opening"?this.db.defer(()=>this._close(e)):this.nextTick(e)};m2.DeferredIterator=CT,m2.DeferredKeyIterator=IT,m2.DeferredValueIterator=kT;var _T={},nb={};const{fromCallback:TT}=dd,v2=ks,{getCallback:VX,getOptions:KX}=t1,E2=Symbol("promise"),Ci=Symbol("status"),gd=Symbol("operations"),s1=Symbol("finishClose"),yd=Symbol("closeCallbacks");let jX=class{constructor(e){if(typeof e!="object"||e===null){const t=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${t}`)}this[gd]=[],this[yd]=[],this[Ci]="open",this[s1]=this[s1].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[gd].length}put(e,t,n){if(this[Ci]!=="open")throw new v2("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const i=this.db._checkKey(e)||this.db._checkValue(t);if(i)throw i;const s=n&&n.sublevel!=null?n.sublevel:this.db,o=n,a=s.keyEncoding(n&&n.keyEncoding),c=s.valueEncoding(n&&n.valueEncoding),l=a.format;n={...n,keyEncoding:l,valueEncoding:c.format},s!==this.db&&(n.sublevel=null);const d=s.prefixKey(a.encode(e),l),h=c.encode(t);return this._put(d,h,n),this[gd].push({...o,type:"put",key:e,value:t}),this}_put(e,t,n){}del(e,t){if(this[Ci]!=="open")throw new v2("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const n=this.db._checkKey(e);if(n)throw n;const i=t&&t.sublevel!=null?t.sublevel:this.db,s=t,o=i.keyEncoding(t&&t.keyEncoding),a=o.format;return t={...t,keyEncoding:a},i!==this.db&&(t.sublevel=null),this._del(i.prefixKey(o.encode(e),a),t),this[gd].push({...s,type:"del",key:e}),this}_del(e,t){}clear(){if(this[Ci]!=="open")throw new v2("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[gd]=[],this}_clear(){}write(e,t){return t=VX(e,t),t=TT(t,E2),e=KX(e),this[Ci]!=="open"?this.nextTick(t,new v2("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(t):(this[Ci]="writing",this._write(e,n=>{this[Ci]="closing",this[yd].push(()=>t(n)),n||this.db.emit("batch",this[gd]),this._close(this[s1])})),t[E2]}_write(e,t){}close(e){return e=TT(e,E2),this[Ci]==="closing"?this[yd].push(e):this[Ci]==="closed"?this.nextTick(e):(this[yd].push(e),this[Ci]!=="writing"&&(this[Ci]="closing",this._close(this[s1]))),e[E2]}_close(e){this.nextTick(e)}[s1](){this[Ci]="closed",this.db.detachResource(this);const e=this[yd];this[yd]=[];for(const t of e)t()}};nb.AbstractChainedBatch=jX;const{AbstractChainedBatch:HX}=nb,qX=ks,md=Symbol("encoded");let WX=class extends HX{constructor(e){super(e),this[md]=[]}_put(e,t,n){this[md].push({...n,type:"put",key:e,value:t})}_del(e,t){this[md].push({...t,type:"del",key:e})}_clear(){this[md]=[]}_write(e,t){this.db.status==="opening"?this.db.defer(()=>this._write(e,t)):this.db.status==="open"?this[md].length===0?this.nextTick(t):this.db._batch(this[md],e,t):this.nextTick(t,new qX("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};_T.DefaultChainedBatch=WX;const PT=ks,GX=Object.prototype.hasOwnProperty,QX=new Set(["lt","lte","gt","gte"]);var YX=function(r,e){const t={};for(const n in r)if(GX.call(r,n)&&!(n==="keyEncoding"||n==="valueEncoding")){if(n==="start"||n==="end")throw new PT(`The legacy range option '${n}' has been removed`,{code:"LEVEL_LEGACY"});if(n==="encoding")throw new PT("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});QX.has(n)?t[n]=e.encode(r[n]):t[n]=r[n]}return t.reverse=!!t.reverse,t.limit=Number.isInteger(t.limit)&&t.limit>=0?t.limit:-1,t};/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let DT;var $T=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:it):r=>(DT||(DT=Promise.resolve())).then(r).catch(e=>setTimeout(()=>{throw e},0)),ib,NT;function JX(){if(NT)return ib;NT=1;const r=$T;return ib=function(e,...t){t.length===0?r(e):r(()=>e(...t))},ib}var o1={},MT;function XX(){if(MT)return o1;MT=1;const{AbstractIterator:r,AbstractKeyIterator:e,AbstractValueIterator:t}=Ts,n=Symbol("unfix"),i=Symbol("iterator"),s=Symbol("handleOne"),o=Symbol("handleMany"),a=Symbol("callback");class c extends r{constructor(p,m,f,g){super(p,m),this[i]=f,this[n]=g,this[s]=this[s].bind(this),this[o]=this[o].bind(this),this[a]=null}[s](p,m,f){const g=this[a];if(p)return g(p);m!==void 0&&(m=this[n](m)),g(p,m,f)}[o](p,m){const f=this[a];if(p)return f(p);for(const g of m){const v=g[0];v!==void 0&&(g[0]=this[n](v))}f(p,m)}}class l extends e{constructor(p,m,f,g){super(p,m),this[i]=f,this[n]=g,this[s]=this[s].bind(this),this[o]=this[o].bind(this),this[a]=null}[s](p,m){const f=this[a];if(p)return f(p);m!==void 0&&(m=this[n](m)),f(p,m)}[o](p,m){const f=this[a];if(p)return f(p);for(let g=0;g<m.length;g++){const v=m[g];v!==void 0&&(m[g]=this[n](v))}f(p,m)}}class d extends t{constructor(p,m,f){super(p,m),this[i]=f}}for(const h of[c,l])h.prototype._next=function(p){this[a]=p,this[i].next(this[s])},h.prototype._nextv=function(p,m,f){this[a]=f,this[i].nextv(p,m,this[o])},h.prototype._all=function(p,m){this[a]=m,this[i].all(p,this[o])};for(const h of[d])h.prototype._next=function(p){this[i].next(p)},h.prototype._nextv=function(p,m,f){this[i].nextv(p,m,f)},h.prototype._all=function(p,m){this[i].all(p,m)};for(const h of[c,l,d])h.prototype._seek=function(p,m){this[i].seek(p,m)},h.prototype._close=function(p){this[i].close(p)};return o1.AbstractSublevelIterator=c,o1.AbstractSublevelKeyIterator=l,o1.AbstractSublevelValueIterator=d,o1}var sb,OT;function ZX(){if(OT)return sb;OT=1;const r=ks,{Buffer:e}=c2||{},{AbstractSublevelIterator:t,AbstractSublevelKeyIterator:n,AbstractSublevelValueIterator:i}=XX(),s=Symbol("prefix"),o=Symbol("upperBound"),a=Symbol("prefixRange"),c=Symbol("parent"),l=Symbol("unfix"),d=new TextEncoder,h={separator:"!"};sb=function({AbstractLevel:y}){class w extends y{static defaults(E){if(typeof E=="string")throw new r("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(E&&E.open)throw new r("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return E==null?h:E.separator?E:{...E,separator:"!"}}constructor(E,A,k){const{separator:x,manifest:I,...T}=w.defaults(k);A=v(A,x);const L=x.charCodeAt(0)+1,z=E[c]||E;if(!d.encode(A).every(j=>j>L&&j<127))throw new r(`Prefix must use bytes > ${L} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(p(z,I),T);const B=(E.prefix||"")+x+A+x,G=B.slice(0,-1)+String.fromCharCode(L);this[c]=z,this[s]=new f(B),this[o]=new f(G),this[l]=new g,this.nextTick=z.nextTick}prefixKey(E,A){if(A==="utf8")return this[s].utf8+E;if(E.byteLength===0)return this[s][A];if(A==="view"){const k=this[s].view,x=new Uint8Array(k.byteLength+E.byteLength);return x.set(k,0),x.set(E,k.byteLength),x}else{const k=this[s].buffer;return e.concat([k,E],k.byteLength+E.byteLength)}}[a](E,A){E.gte!==void 0?E.gte=this.prefixKey(E.gte,A):E.gt!==void 0?E.gt=this.prefixKey(E.gt,A):E.gte=this[s][A],E.lte!==void 0?E.lte=this.prefixKey(E.lte,A):E.lt!==void 0?E.lt=this.prefixKey(E.lt,A):E.lte=this[o][A]}get prefix(){return this[s].utf8}get db(){return this[c]}_open(E,A){this[c].open({passive:!0},A)}_put(E,A,k,x){this[c].put(E,A,k,x)}_get(E,A,k){this[c].get(E,A,k)}_getMany(E,A,k){this[c].getMany(E,A,k)}_del(E,A,k){this[c].del(E,A,k)}_batch(E,A,k){this[c].batch(E,A,k)}_clear(E,A){this[a](E,E.keyEncoding),this[c].clear(E,A)}_iterator(E){this[a](E,E.keyEncoding);const A=this[c].iterator(E),k=this[l].get(this[s].utf8.length,E.keyEncoding);return new t(this,E,A,k)}_keys(E){this[a](E,E.keyEncoding);const A=this[c].keys(E),k=this[l].get(this[s].utf8.length,E.keyEncoding);return new n(this,E,A,k)}_values(E){this[a](E,E.keyEncoding);const A=this[c].values(E);return new i(this,E,A)}}return{AbstractSublevel:w}};const p=function(y,w){return{...y.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...w,encodings:{utf8:m(y,"utf8"),buffer:m(y,"buffer"),view:m(y,"view")}}},m=function(y,w){return y.supports.encodings[w]?y.keyEncoding(w).name===w:!1};class f{constructor(w){this.utf8=w,this.view=d.encode(w),this.buffer=e?e.from(this.view.buffer,0,this.view.byteLength):{}}}class g{constructor(){this.cache=new Map}get(w,b){let E=this.cache.get(b);return E===void 0&&(b==="view"?E=(function(A,k){return k.subarray(A)}).bind(null,w):E=(function(A,k){return k.slice(A)}).bind(null,w),this.cache.set(b,E)),E}}const v=function(y,w){let b=0,E=y.length;for(;b<E&&y[b]===w;)b++;for(;E>b&&y[E-1]===w;)E--;return y.slice(b,E)};return sb}const{supports:eZ}=fT,{Transcoder:tZ}=pT,{EventEmitter:rZ}=Mg,{fromCallback:qa}=dd,Xi=ks,{AbstractIterator:El}=Ts,{DefaultKeyIterator:nZ,DefaultValueIterator:iZ}=eb,{DeferredIterator:sZ,DeferredKeyIterator:oZ,DeferredValueIterator:aZ}=m2,{DefaultChainedBatch:RT}=_T,{getCallback:Sl,getOptions:Wa}=t1,S2=YX,Ve=Symbol("promise"),xo=Symbol("landed"),xl=Symbol("resources"),ob=Symbol("closeResources"),a1=Symbol("operations"),c1=Symbol("undefer"),x2=Symbol("deferOpen"),LT=Symbol("options"),He=Symbol("status"),Al=Symbol("defaultOptions"),wd=Symbol("transcoder"),A2=Symbol("keyEncoding"),ab=Symbol("valueEncoding"),cZ=()=>{};let cb=class extends rZ{constructor(e,t){if(super(),typeof e!="object"||e===null)throw new TypeError("The first argument 'manifest' must be an object");t=Wa(t);const{keyEncoding:n,valueEncoding:i,passive:s,...o}=t;this[xl]=new Set,this[a1]=[],this[x2]=!0,this[LT]=o,this[He]="opening",this.supports=eZ(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:e.snapshots!==!1,permanence:e.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[wd]=new tZ(lZ(this)),this[A2]=this[wd].encoding(n||"utf8"),this[ab]=this[wd].encoding(i||"utf8");for(const a of this[wd].encodings())this.supports.encodings[a.commonName]||(this.supports.encodings[a.commonName]=!0);this[Al]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[A2].commonName,valueEncoding:this[ab].commonName}),key:Object.freeze({keyEncoding:this[A2].commonName})},this.nextTick(()=>{this[x2]&&this.open({passive:!1},cZ)})}get status(){return this[He]}keyEncoding(e){return this[wd].encoding(e??this[A2])}valueEncoding(e){return this[wd].encoding(e??this[ab])}open(e,t){t=Sl(e,t),t=qa(t,Ve),e={...this[LT],...Wa(e)},e.createIfMissing=e.createIfMissing!==!1,e.errorIfExists=!!e.errorIfExists;const n=i=>{this[He]==="closing"||this[He]==="opening"?this.once(xo,i?()=>n(i):n):this[He]!=="open"?t(new Xi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:i})):t()};return e.passive?this[He]==="opening"?this.once(xo,n):this.nextTick(n):this[He]==="closed"||this[x2]?(this[x2]=!1,this[He]="opening",this.emit("opening"),this._open(e,i=>{if(i){this[He]="closed",this[ob](()=>{this.emit(xo),n(i)}),this[c1]();return}this[He]="open",this[c1](),this.emit(xo),this[He]==="open"&&this.emit("open"),this[He]==="open"&&this.emit("ready"),n()})):this[He]==="open"?this.nextTick(n):this.once(xo,()=>this.open(e,t)),t[Ve]}_open(e,t){this.nextTick(t)}close(e){e=qa(e,Ve);const t=n=>{this[He]==="opening"||this[He]==="closing"?this.once(xo,n?t(n):t):this[He]!=="closed"?e(new Xi("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:n})):e()};if(this[He]==="open"){this[He]="closing",this.emit("closing");const n=i=>{this[He]="open",this[c1](),this.emit(xo),t(i)};this[ob](()=>{this._close(i=>{if(i)return n(i);this[He]="closed",this[c1](),this.emit(xo),this[He]==="closed"&&this.emit("closed"),t()})})}else this[He]==="closed"?this.nextTick(t):this.once(xo,()=>this.close(e));return e[Ve]}[ob](e){if(this[xl].size===0)return this.nextTick(e);let t=this[xl].size,n=!0;const i=()=>{--t===0&&(n?this.nextTick(e):e())};for(const s of this[xl])s.close(i);n=!1,this[xl].clear()}_close(e){this.nextTick(e)}get(e,t,n){if(n=Sl(t,n),n=qa(n,Ve),t=Wa(t,this[Al].entry),this[He]==="opening")return this.defer(()=>this.get(e,t,n)),n[Ve];if(bd(this,n))return n[Ve];const i=this._checkKey(e);if(i)return this.nextTick(n,i),n[Ve];const s=this.keyEncoding(t.keyEncoding),o=this.valueEncoding(t.valueEncoding),a=s.format,c=o.format;return(t.keyEncoding!==a||t.valueEncoding!==c)&&(t=Object.assign({},t,{keyEncoding:a,valueEncoding:c})),this._get(this.prefixKey(s.encode(e),a),t,(l,d)=>{if(l)return(l.code==="LEVEL_NOT_FOUND"||l.notFound||/NotFound/i.test(l))&&(l.code||(l.code="LEVEL_NOT_FOUND"),l.notFound||(l.notFound=!0),l.status||(l.status=404)),n(l);try{d=o.decode(d)}catch(h){return n(new Xi("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:h}))}n(null,d)}),n[Ve]}_get(e,t,n){this.nextTick(n,new Error("NotFound"))}getMany(e,t,n){if(n=Sl(t,n),n=qa(n,Ve),t=Wa(t,this[Al].entry),this[He]==="opening")return this.defer(()=>this.getMany(e,t,n)),n[Ve];if(bd(this,n))return n[Ve];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'keys' must be an array")),n[Ve];if(e.length===0)return this.nextTick(n,null,[]),n[Ve];const i=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),o=i.format,a=s.format;(t.keyEncoding!==o||t.valueEncoding!==a)&&(t=Object.assign({},t,{keyEncoding:o,valueEncoding:a}));const c=new Array(e.length);for(let l=0;l<e.length;l++){const d=e[l],h=this._checkKey(d);if(h)return this.nextTick(n,h),n[Ve];c[l]=this.prefixKey(i.encode(d),o)}return this._getMany(c,t,(l,d)=>{if(l)return n(l);try{for(let h=0;h<d.length;h++)d[h]!==void 0&&(d[h]=s.decode(d[h]))}catch(h){return n(new Xi(`Could not decode one or more of ${d.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:h}))}n(null,d)}),n[Ve]}_getMany(e,t,n){this.nextTick(n,null,new Array(e.length).fill(void 0))}put(e,t,n,i){if(i=Sl(n,i),i=qa(i,Ve),n=Wa(n,this[Al].entry),this[He]==="opening")return this.defer(()=>this.put(e,t,n,i)),i[Ve];if(bd(this,i))return i[Ve];const s=this._checkKey(e)||this._checkValue(t);if(s)return this.nextTick(i,s),i[Ve];const o=this.keyEncoding(n.keyEncoding),a=this.valueEncoding(n.valueEncoding),c=o.format,l=a.format;(n.keyEncoding!==c||n.valueEncoding!==l)&&(n=Object.assign({},n,{keyEncoding:c,valueEncoding:l}));const d=this.prefixKey(o.encode(e),c),h=a.encode(t);return this._put(d,h,n,p=>{if(p)return i(p);this.emit("put",e,t),i()}),i[Ve]}_put(e,t,n,i){this.nextTick(i)}del(e,t,n){if(n=Sl(t,n),n=qa(n,Ve),t=Wa(t,this[Al].key),this[He]==="opening")return this.defer(()=>this.del(e,t,n)),n[Ve];if(bd(this,n))return n[Ve];const i=this._checkKey(e);if(i)return this.nextTick(n,i),n[Ve];const s=this.keyEncoding(t.keyEncoding),o=s.format;return t.keyEncoding!==o&&(t=Object.assign({},t,{keyEncoding:o})),this._del(this.prefixKey(s.encode(e),o),t,a=>{if(a)return n(a);this.emit("del",e),n()}),n[Ve]}_del(e,t,n){this.nextTick(n)}batch(e,t,n){if(!arguments.length){if(this[He]==="opening")return new RT(this);if(this[He]!=="open")throw new Xi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof e=="function"?n=e:n=Sl(t,n),n=qa(n,Ve),t=Wa(t,this[Al].empty),this[He]==="opening")return this.defer(()=>this.batch(e,t,n)),n[Ve];if(bd(this,n))return n[Ve];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'operations' must be an array")),n[Ve];if(e.length===0)return this.nextTick(n),n[Ve];const i=new Array(e.length),{keyEncoding:s,valueEncoding:o,...a}=t;for(let c=0;c<e.length;c++){if(typeof e[c]!="object"||e[c]===null)return this.nextTick(n,new TypeError("A batch operation must be an object")),n[Ve];const l=Object.assign({},e[c]);if(l.type!=="put"&&l.type!=="del")return this.nextTick(n,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),n[Ve];const d=this._checkKey(l.key);if(d)return this.nextTick(n,d),n[Ve];const h=l.sublevel!=null?l.sublevel:this,p=h.keyEncoding(l.keyEncoding||s),m=p.format;if(l.key=h.prefixKey(p.encode(l.key),m),l.keyEncoding=m,l.type==="put"){const f=this._checkValue(l.value);if(f)return this.nextTick(n,f),n[Ve];const g=h.valueEncoding(l.valueEncoding||o);l.value=g.encode(l.value),l.valueEncoding=g.format}h!==this&&(l.sublevel=null),i[c]=l}return this._batch(i,a,c=>{if(c)return n(c);this.emit("batch",e),n()}),n[Ve]}_batch(e,t,n){this.nextTick(n)}sublevel(e,t){return this._sublevel(e,lb.defaults(t))}_sublevel(e,t){return new lb(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=Sl(e,t),t=qa(t,Ve),e=Wa(e,this[Al].empty),this[He]==="opening")return this.defer(()=>this.clear(e,t)),t[Ve];if(bd(this,t))return t[Ve];const n=e,i=this.keyEncoding(e.keyEncoding);return e=S2(e,i),e.keyEncoding=i.format,e.limit===0?this.nextTick(t):this._clear(e,s=>{if(s)return t(s);this.emit("clear",n),t()}),t[Ve]}_clear(e,t){this.nextTick(t)}iterator(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=S2(e,t),e.keys=e.keys!==!1,e.values=e.values!==!1,e[El.keyEncoding]=t,e[El.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[He]==="opening")return new sZ(this,e);if(this[He]!=="open")throw new Xi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new El(this,e)}keys(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=S2(e,t),e[El.keyEncoding]=t,e[El.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[He]==="opening")return new oZ(this,e);if(this[He]!=="open")throw new Xi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new nZ(this,e)}values(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=S2(e,t),e[El.keyEncoding]=t,e[El.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[He]==="opening")return new aZ(this,e);if(this[He]!=="open")throw new Xi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new iZ(this,e)}defer(e){if(typeof e!="function")throw new TypeError("The first argument must be a function");this[a1].push(e)}[c1](){if(this[a1].length===0)return;const e=this[a1];this[a1]=[];for(const t of e)t()}attachResource(e){if(typeof e!="object"||e===null||typeof e.close!="function")throw new TypeError("The first argument must be a resource object");this[xl].add(e)}detachResource(e){this[xl].delete(e)}_chainedBatch(){return new RT(this)}_checkKey(e){if(e==null)return new Xi("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(e==null)return new Xi("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};cb.prototype.nextTick=JX();const{AbstractSublevel:lb}=ZX()({AbstractLevel:cb});a2.AbstractLevel=cb,a2.AbstractSublevel=lb;const bd=function(r,e){return r[He]!=="open"?(r.nextTick(e,new Xi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},lZ=function(r){return Object.keys(r.supports.encodings).filter(e=>!!r.supports.encodings[e])};za.AbstractLevel=a2.AbstractLevel,za.AbstractSublevel=a2.AbstractSublevel,za.AbstractIterator=Ts.AbstractIterator,za.AbstractKeyIterator=Ts.AbstractKeyIterator,za.AbstractValueIterator=Ts.AbstractValueIterator,za.AbstractChainedBatch=nb.AbstractChainedBatch;/*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var uZ=hZ;const dZ=$T;function hZ(r,e,t){if(typeof e!="number")throw new Error("second argument must be a Number");let n,i,s,o,a,c=!0,l;Array.isArray(r)?(n=[],s=i=r.length):(o=Object.keys(r),n={},s=i=o.length);function d(p){function m(){t&&t(p,n),t=null}c?dZ(m):m()}function h(p,m,f){if(n[p]=f,m&&(a=!0),--s===0||m)d(m);else if(!a&&l<i){let g;o?(g=o[l],l+=1,r[g](function(v,y){h(g,v,y)})):(g=l,l+=1,r[g](function(v,y){h(g,v,y)}))}}l=e,s?o?o.some(function(p,m){return r[p](function(f,g){h(p,f,g)}),m===e-1}):r.some(function(p,m){return p(function(f,g){h(m,f,g)}),m===e-1}):d(null),c=!1}var BT={},UT=function(e){const t=e.gte!==void 0?e.gte:e.gt!==void 0?e.gt:void 0,n=e.lte!==void 0?e.lte:e.lt!==void 0?e.lt:void 0,i=e.gte===void 0,s=e.lte===void 0;return t!==void 0&&n!==void 0?IDBKeyRange.bound(t,n,i,s):t!==void 0?IDBKeyRange.lowerBound(t,i):n!==void 0?IDBKeyRange.upperBound(n,s):null};const fZ=new TextEncoder;var FT=function(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):fZ.encode(r)};const{AbstractIterator:pZ}=za,zT=UT,C2=FT,$s=Symbol("cache"),Ao=Symbol("finished"),Jn=Symbol("options"),Co=Symbol("currentOptions"),Cl=Symbol("position"),ub=Symbol("location"),vd=Symbol("first"),VT={};let gZ=class extends pZ{constructor(e,t,n){super(e,n),this[$s]=[],this[Ao]=this.limit===0,this[Jn]=n,this[Co]={...n},this[Cl]=void 0,this[ub]=t,this[vd]=!0}_nextv(e,t,n){if(this[vd]=!1,this[Ao])return this.nextTick(n,null,[]);if(this[$s].length>0)return e=Math.min(e,this[$s].length),this.nextTick(n,null,this[$s].splice(0,e));this[Cl]!==void 0&&(this[Jn].reverse?(this[Co].lt=this[Cl],this[Co].lte=void 0):(this[Co].gt=this[Cl],this[Co].gte=void 0));let i;try{i=zT(this[Co])}catch{return this[Ao]=!0,this.nextTick(n,null,[])}const s=this.db.db.transaction([this[ub]],"readonly"),o=s.objectStore(this[ub]),a=[];if(this[Jn].reverse){const c=!this[Jn].values&&o.openKeyCursor?"openKeyCursor":"openCursor";o[c](i,"prev").onsuccess=l=>{const d=l.target.result;if(d){const{key:h,value:p}=d;this[Cl]=h,a.push([this[Jn].keys&&h!==void 0?C2(h):void 0,this[Jn].values&&p!==void 0?C2(p):void 0]),a.length<e?d.continue():KT(s)}else this[Ao]=!0}}else{let c,l;const d=()=>{if(c===void 0||l===void 0)return;const h=Math.max(c.length,l.length);h===0||e===1/0?this[Ao]=!0:this[Cl]=c[h-1],a.length=h;for(let p=0;p<h;p++){const m=c[p],f=l[p];a[p]=[this[Jn].keys&&m!==void 0?C2(m):void 0,this[Jn].values&&f!==void 0?C2(f):void 0]}KT(s)};this[Jn].keys||e<1/0?o.getAllKeys(i,e<1/0?e:void 0).onsuccess=h=>{c=h.target.result,d()}:(c=[],this.nextTick(d)),this[Jn].values?o.getAll(i,e<1/0?e:void 0).onsuccess=h=>{l=h.target.result,d()}:(l=[],this.nextTick(d))}s.onabort=()=>{n(s.error||new Error("aborted by user")),n=null},s.oncomplete=()=>{n(null,a),n=null}}_next(e){if(this[$s].length>0){const[t,n]=this[$s].shift();this.nextTick(e,null,t,n)}else if(this[Ao])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[vd]&&(this[vd]=!1,t=1),this._nextv(t,VT,(n,i)=>{if(n)return e(n);this[$s]=i,this._next(e)})}}_all(e,t){this[vd]=!1;const n=this[$s].splice(0,this[$s].length),i=this.limit-this.count-n.length;if(i<=0)return this.nextTick(t,null,n);this._nextv(i,VT,(s,o)=>{if(s)return t(s);n.length>0&&(o=n.concat(o)),t(null,o)})}_seek(e,t){this[vd]=!0,this[$s]=[],this[Ao]=!1,this[Cl]=void 0,this[Co]={...this[Jn]};let n;try{n=zT(this[Jn])}catch{this[Ao]=!0;return}n!==null&&!n.includes(e)?this[Ao]=!0:this[Jn].reverse?this[Co].lte=e:this[Co].gte=e}};BT.Iterator=gZ;function KT(r){typeof r.commit=="function"&&r.commit()}var yZ=function(e,t,n,i,s){if(i.limit===0)return e.nextTick(s);const o=e.db.transaction([t],"readwrite"),a=o.objectStore(t);let c=0;o.oncomplete=function(){s()},o.onabort=function(){s(o.error||new Error("aborted by user"))};const l=a.openKeyCursor?"openKeyCursor":"openCursor",d=i.reverse?"prev":"next";a[l](n,d).onsuccess=function(h){const p=h.target.result;p&&(a.delete(p.key).onsuccess=function(){(i.limit<=0||++c<i.limit)&&p.continue()})}};const{AbstractLevel:mZ}=za,jT=ks,wZ=uZ,{fromCallback:bZ}=dd,{Iterator:vZ}=BT,HT=FT,EZ=yZ,SZ=UT,qT="level-js-",l1=Symbol("idb"),db=Symbol("namePrefix"),Io=Symbol("location"),hb=Symbol("version"),Il=Symbol("store"),u1=Symbol("onComplete"),WT=Symbol("promise");class GT extends mZ{constructor(e,t,n){if(typeof t=="function"||typeof n=="function")throw new jT("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:i,version:s,...o}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),typeof e!="string")throw new Error("constructor requires a location string argument");this[Io]=e,this[db]=i??qT,this[hb]=parseInt(s||1,10),this[l1]=null}get location(){return this[Io]}get namePrefix(){return this[db]}get version(){return this[hb]}get db(){return this[l1]}get type(){return"browser-level"}_open(e,t){const n=indexedDB.open(this[db]+this[Io],this[hb]);n.onerror=function(){t(n.error||new Error("unknown error"))},n.onsuccess=()=>{this[l1]=n.result,t()},n.onupgradeneeded=i=>{const s=i.target.result;s.objectStoreNames.contains(this[Io])||s.createObjectStore(this[Io])}}[Il](e){return this[l1].transaction([this[Io]],e).objectStore(this[Io])}[u1](e,t){const n=e.transaction;n.onabort=function(){t(n.error||new Error("aborted by user"))},n.oncomplete=function(){t(null,e.result)}}_get(e,t,n){const i=this[Il]("readonly");let s;try{s=i.get(e)}catch(o){return this.nextTick(n,o)}this[u1](s,function(o,a){if(o)return n(o);if(a===void 0)return n(new jT("Entry not found",{code:"LEVEL_NOT_FOUND"}));n(null,HT(a))})}_getMany(e,t,n){const i=this[Il]("readonly"),s=e.map(o=>a=>{let c;try{c=i.get(o)}catch(l){return a(l)}c.onsuccess=()=>{const l=c.result;a(null,l===void 0?l:HT(l))},c.onerror=l=>{l.stopPropagation(),a(c.error)}});wZ(s,16,n)}_del(e,t,n){const i=this[Il]("readwrite");let s;try{s=i.delete(e)}catch(o){return this.nextTick(n,o)}this[u1](s,n)}_put(e,t,n,i){const s=this[Il]("readwrite");let o;try{o=s.put(t,e)}catch(a){return this.nextTick(i,a)}this[u1](o,i)}_iterator(e){return new vZ(this,this[Io],e)}_batch(e,t,n){const i=this[Il]("readwrite"),s=i.transaction;let o=0,a;s.onabort=function(){n(a||s.error||new Error("aborted by user"))},s.oncomplete=function(){n()};function c(){const l=e[o++],d=l.key;let h;try{h=l.type==="del"?i.delete(d):i.put(l.value,d)}catch(p){a=p,s.abort();return}o<e.length?h.onsuccess=c:typeof s.commit=="function"&&s.commit()}c()}_clear(e,t){let n,i;try{n=SZ(e)}catch{return this.nextTick(t)}if(e.limit>=0)return EZ(this,this[Io],n,e,t);try{const s=this[Il]("readwrite");i=n?s.delete(n):s.clear()}catch(s){return this.nextTick(t,s)}this[u1](i,t)}_close(e){this[l1].close(),this.nextTick(e)}}GT.destroy=function(r,e,t){typeof e=="function"&&(t=e,e=qT),t=bZ(t,WT);const n=indexedDB.deleteDatabase(e+r);return n.onsuccess=function(){t()},n.onerror=function(i){t(i)},t[WT]},hT.BrowserLevel=GT;var xZ=hT.BrowserLevel;const AZ="./level",CZ="view",fb=async({path:r,valueEncoding:e}={})=>{r=r||AZ,e=e||CZ;const t=new xZ(r,{valueEncoding:e,passive:!0});return await t.open(),{put:async(d,h)=>{await t.put(d,h)},del:async d=>{await t.del(d)},get:async d=>{try{const h=await t.get(d);if(h)return h}catch{}},iterator:async function*({amount:d,reverse:h}={}){const p={limit:d||-1,reverse:h||!1};for await(const[m,f]of t.iterator(p))yield[m,f]},merge:async d=>{},clear:async()=>{await t.clear()},close:async()=>{await t.close()}}},QT=1e6,Ns=async({size:r}={})=>{let e=new a6(r||QT);return{put:async(l,d)=>{e.set(l,d)},del:async l=>{e.remove(l)},get:async l=>e.get(l),iterator:async function*(){for await(const l of e.keys){const d=e.get(l);yield[l,d]}},merge:async l=>{if(l)for await(const[d,h]of l.iterator())e.set(d,h)},clear:async()=>{e=new a6(r||QT)},close:async()=>{}}},IZ=16,pb=1e3,gb=async({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p})=>{s=Ra(s||"./orbitdb",`./${t}/`),o=o||{},d=Number(d)>-1?d:IZ,c=c||await pl(await Ns({size:pb}),await o2({ipfs:r,pin:!0})),a=a||await pl(await Ns({size:pb}),await fb({path:Ra(s,"/log/_heads/")})),l=l||await pl(await Ns({size:pb}),await fb({path:Ra(s,"/log/_index/")}));const m=await cX(e,{logId:t,access:i,entryStorage:c,headsStorage:a,indexStorage:l}),f=new Mg.EventEmitter,g=new Ma({concurrency:1}),v=async A=>{const k=async()=>{const I=await m.append(A,{referencesCount:d});return await E.add(I),p&&await p(m,I),f.emit("update",I),I.hash},x=await g.add(k);return await g.onIdle(),x},y=async A=>{const k=async()=>{const x=await vo.decode(A);x&&await m.joinEntry(x)&&(p&&await p(m,x),f.emit("update",x))};await g.add(k)},w=async()=>{await E.stop(),await g.onIdle(),await m.close(),i&&i.close&&await i.close(),f.emit("close")},b=async()=>{await g.onIdle(),await m.clear(),i&&i.drop&&await i.drop(),f.emit("drop")},E=await eQ({ipfs:r,log:m,events:f,onSynced:y,start:h});return{address:t,name:n,identity:e,meta:o,close:w,drop:b,addOperation:v,log:m,sync:E,peers:E.peers,events:f,access:i}},YT="documents",kZ={indexBy:"_id"},JT=({indexBy:r}=kZ)=>async({ipfs:e,identity:t,address:n,name:i,access:s,directory:o,meta:a,headsStorage:c,entryStorage:l,indexStorage:d,referencesCount:h,syncAutomatically:p,onUpdate:m})=>{const f=await gb({ipfs:e,identity:t,address:n,name:i,access:s,directory:o,meta:a,headsStorage:c,entryStorage:l,indexStorage:d,referencesCount:h,syncAutomatically:p}),{addOperation:g,log:v}=f,y=async x=>{const I=x[r];if(!I)throw new Error(`The provided document doesn't contain field '${r}'`);return g({op:"PUT",key:I,value:x})},w=async x=>{if(!await b(x))throw new Error(`No document with key '${x}' in the database`);return g({op:"DEL",key:x,value:null})},b=async x=>{for await(const I of A())if(x===I.key)return I},E=async x=>{const I=[];for await(const T of A())x(T.value)&&I.push(T.value);return I},A=async function*({amount:x}={}){const I={};let T=0;for await(const L of v.iterator()){const{op:z,key:B,value:G}=L.payload;if(z==="PUT"&&!I[B]?(I[B]=!0,T++,yield{hash:L.hash,key:B,value:G}):z==="DEL"&&!I[B]&&(I[B]=!0),T>=x)break}};return{...f,type:YT,put:y,del:w,get:b,iterator:A,query:E,indexBy:r,all:async()=>{const x=[];for await(const I of A())x.unshift(I);return x}}};JT.type=YT;const XT="events",ZT=()=>async({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p})=>{const m=await gb({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p}),{addOperation:f,log:g}=m,v=async E=>f({op:"ADD",key:null,value:E}),y=async E=>(await g.get(E)).payload.value,w=async function*({gt:E,gte:A,lt:k,lte:x,amount:I}={}){const T=g.iterator({gt:E,gte:A,lt:k,lte:x,amount:I});for await(const L of T){const z=L.hash,B=L.payload.value;yield{hash:z,value:B}}};return{...m,type:XT,add:v,get:y,iterator:w,all:async()=>{const E=[];for await(const A of w())E.unshift(A);return E}}};ZT.type=XT;const eP="keyvalue",tP=()=>async({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p})=>{const m=await gb({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p}),{addOperation:f,log:g}=m,v=async(A,k)=>f({op:"PUT",key:A,value:k}),y=async A=>f({op:"DEL",key:A,value:null}),w=async A=>{for await(const k of g.traverse()){const{op:x,key:I,value:T}=k.payload;if(x==="PUT"&&I===A)return T;if(x==="DEL"&&I===A)return}},b=async function*({amount:A}={}){const k={};let x=0;for await(const I of g.traverse()){const{op:T,key:L,value:z}=I.payload;if(T==="PUT"&&!k[L]){k[L]=!0,x++;const B=I.hash;yield{key:L,value:z,hash:B}}else T==="DEL"&&!k[L]&&(k[L]=!0);if(x>=A)break}};return{...m,type:eP,put:v,set:v,del:y,get:w,iterator:b,all:async()=>{const A=[];for await(const k of b())A.unshift(k);return A}}};tP.type=eP;const yb={},mb=r=>{if(!r.type)throw new Error("Database type does not contain required field 'type'.");yb[r.type]=r},_Z=r=>{if(!r)throw new Error("Type not specified");if(!yb[r])throw new Error(`Unsupported database type: '${r}'`);return yb[r]};mb(ZT),mb(JT),mb(tP);const TZ=Symbol.for("@libp2p/connection"),Ed=Symbol.for("@libp2p/content-routing"),I2=Symbol.for("@libp2p/peer-discovery"),wb=Symbol.for("@libp2p/peer-id");function rP(r){return!!(r!=null&&r[wb])}const Sd=Symbol.for("@libp2p/peer-routing"),k2="keep-alive",_2="StrictSign",bb="StrictNoSign";var Ii;(function(r){r.Accept="accept",r.Ignore="ignore",r.Reject="reject"})(Ii||(Ii={}));const T2=Symbol.for("@libp2p/transport");var kl;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(kl||(kl={}));let _l=(TA=class extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}},u(TA,"name","AbortError"),TA);class nP extends Error{constructor(e="Unexpected Peer"){super(e),this.name="UnexpectedPeerError"}}u(nP,"name","UnexpectedPeerError");let PZ=(PA=class extends Error{constructor(e="Invalid crypto exchange"){super(e),this.name="InvalidCryptoExchangeError"}},u(PA,"name","InvalidCryptoExchangeError"),PA);class Z extends Error{constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}}u(Z,"name","InvalidParametersError");class d1 extends Error{constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}u(d1,"name","InvalidPublicKeyError");class vb extends Error{constructor(e="Invalid private key"){super(e),this.name="InvalidPrivateKeyError"}}u(vb,"name","InvalidPrivateKeyError");class iP extends Error{constructor(e="The connection is closing"){super(e),this.name="ConnectionClosingError"}}u(iP,"name","ConnectionClosingError");class Eb extends Error{constructor(e="The connection is closed"){super(e),this.name="ConnectionClosedError"}}u(Eb,"name","ConnectionClosedError");class Sb extends Error{constructor(e="Connection failed"){super(e),this.name="ConnectionFailedError"}}u(Sb,"name","ConnectionFailedError");class Tl extends Error{constructor(e="The muxer is closed"){super(e),this.name="MuxerClosedError"}}u(Tl,"name","MuxerClosedError");class sP extends Error{constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}}u(sP,"name","StreamResetError");class P2 extends Error{constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}}u(P2,"name","StreamStateError");let Zt=(DA=class extends Error{constructor(e="Not found"){super(e),this.name="NotFoundError"}},u(DA,"name","NotFoundError"),DA);class xb extends Error{constructor(e="Invalid PeerID"){super(e),this.name="InvalidPeerIdError"}}u(xb,"name","InvalidPeerIdError");class D2 extends Error{constructor(e="Invalid multiaddr"){super(e),this.name="InvalidMultiaddrError"}}u(D2,"name","InvalidMultiaddrError");class oP extends Error{constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}u(oP,"name","InvalidCIDError");class $2 extends Error{constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}u($2,"name","InvalidMultihashError");class h1 extends Error{constructor(e="Unsupported protocol error"){super(e),this.name="UnsupportedProtocolError"}}u(h1,"name","UnsupportedProtocolError");class Et extends Error{constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}}u(Et,"name","InvalidMessageError");class aP extends Error{constructor(e="Protocol error"){super(e),this.name="ProtocolError"}}u(aP,"name","ProtocolError");class f1 extends Error{constructor(e="Timed out"){super(e),this.name="TimeoutError"}}u(f1,"name","TimeoutError");class Pl extends Error{constructor(e="Not started"){super(e),this.name="NotStartedError"}}u(Pl,"name","NotStartedError");class xd extends Error{constructor(e="Dial error"){super(e),this.name="DialError"}}u(xd,"name","DialError");class N2 extends Error{constructor(e="Listen error"){super(e),this.name="ListenError"}}u(N2,"name","ListenError");class Ab extends Error{constructor(e="Limited connection"){super(e),this.name="LimitedConnectionError"}}u(Ab,"name","LimitedConnectionError");class cP extends Error{constructor(e="Too many inbound protocol streams"){super(e),this.name="TooManyInboundProtocolStreamsError"}}u(cP,"name","TooManyInboundProtocolStreamsError");class M2 extends Error{constructor(e="Too many outbound protocol streams"){super(e),this.name="TooManyOutboundProtocolStreamsError"}}u(M2,"name","TooManyOutboundProtocolStreamsError");class Dl extends Error{constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}u(Dl,"name","UnsupportedKeyTypeError");function cCe(){}class er extends EventTarget{constructor(){super();Je(this,Zs,new Map)}listenerCount(t){const n=oe(this,Zs).get(t);return n==null?0:n.length}addEventListener(t,n,i){super.addEventListener(t,n,i);let s=oe(this,Zs).get(t);s==null&&(s=[],oe(this,Zs).set(t,s)),s.push({callback:n,once:(i!==!0&&i!==!1&&(i==null?void 0:i.once))??!1})}removeEventListener(t,n,i){super.removeEventListener(t.toString(),n??null,i);let s=oe(this,Zs).get(t);s!=null&&(s=s.filter(({callback:o})=>o!==n),oe(this,Zs).set(t,s))}dispatchEvent(t){const n=super.dispatchEvent(t);let i=oe(this,Zs).get(t.type);return i==null||(i=i.filter(({once:s})=>!s),oe(this,Zs).set(t.type,i)),n}safeDispatchEvent(t,n={}){return this.dispatchEvent(new CustomEvent(t,n))}}Zs=new WeakMap;function Cb(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}async function ko(...r){const e=[];for(const t of r)Cb(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStart!=null&&await t.beforeStart()})),await Promise.all(e.map(async t=>{await t.start()})),await Promise.all(e.map(async t=>{t.afterStart!=null&&await t.afterStart()}))}async function Ga(...r){const e=[];for(const t of r)Cb(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStop!=null&&await t.beforeStop()})),await Promise.all(e.map(async t=>{await t.stop()})),await Promise.all(e.map(async t=>{t.afterStop!=null&&await t.afterStop()}))}const dr=Symbol.for("@libp2p/service-capabilities"),Qa=Symbol.for("@libp2p/service-dependencies");function DZ(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function O2(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function $Z(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var NZ=$Z,MZ=NZ;let OZ=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},RZ=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return lP(this,e)}},LZ=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return lP(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function lP(r,e){return new LZ({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let BZ=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new OZ(e,t,n),this.decoder=new RZ(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function uP({name:r,prefix:e,encode:t,decode:n}){return new BZ(r,e,t,n)}function R2({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=MZ(t,r);return uP({prefix:e,name:r,encode:n,decode:s=>O2(i(s))})}function UZ(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function FZ(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Xn({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return uP({prefix:e,name:r,encode(i){return FZ(i,n,t)},decode(i){return UZ(i,n,t,r)}})}const ki=R2({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});R2({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const L2=Xn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Xn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Xn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Xn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Xn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Xn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Xn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Xn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Xn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Ib=R2({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});R2({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var zZ=hP,dP=128,VZ=-128,KZ=Math.pow(2,31);function hP(r,e,t){e=e||[],t=t||0;for(var n=t;r>=KZ;)e[t++]=r&255|dP,r/=128;for(;r&VZ;)e[t++]=r&255|dP,r>>>=7;return e[t]=r|0,hP.bytes=t-n+1,e}var jZ=kb,HZ=128,fP=127;function kb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw kb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&fP)<<i:(o&fP)*Math.pow(2,i),i+=7}while(o>=HZ);return kb.bytes=s-n,t}var qZ=Math.pow(2,7),WZ=Math.pow(2,14),GZ=Math.pow(2,21),QZ=Math.pow(2,28),YZ=Math.pow(2,35),JZ=Math.pow(2,42),XZ=Math.pow(2,49),ZZ=Math.pow(2,56),eee=Math.pow(2,63),tee=function(r){return r<qZ?1:r<WZ?2:r<GZ?3:r<QZ?4:r<YZ?5:r<JZ?6:r<XZ?7:r<ZZ?8:r<eee?9:10},ree={encode:zZ,decode:jZ,encodingLength:tee},B2=ree;function _b(r,e=0){return[B2.decode(r,e),B2.decode.bytes]}function U2(r,e,t=0){return B2.encode(r,e,t),e}function F2(r){return B2.encodingLength(r)}function $l(r,e){const t=e.byteLength,n=F2(r),i=n+F2(t),s=new Uint8Array(i+t);return U2(r,s,0),U2(t,s,n),s.set(e,i),new Tb(r,t,e,s)}function nee(r){const e=O2(r),[t,n]=_b(e),[i,s]=_b(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Tb(t,i,o,e)}function iee(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&DZ(r.bytes,t.bytes)}}let Tb=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function pP(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return oee(t,Pb(r),e??ki.encoder);default:return aee(t,Pb(r),e??L2.encoder)}}const gP=new WeakMap;function Pb(r){const e=gP.get(r);if(e==null){const t=new Map;return gP.set(r,t),t}return e}let z2=class qr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Ej,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==p1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==cee)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return qr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=$l(e,t);return qr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return qr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&iee(e.multihash,n.multihash)}toString(e){return pP(this,e)}toJSON(){return{"/":pP(this)}}link(){return this}[(Ej=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof qr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new qr(n,i,s,o??yP(n,i,s.bytes))}else if(t[lee]===!0){const{version:n,multihash:i,code:s}=t,o=nee(i);return qr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==p1)throw new Error(`Version 0 CID must use dag-pb (code: ${p1}) block encoding`);return new qr(e,t,n,n.bytes)}case 1:{const i=yP(e,t,n.bytes);return new qr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return qr.create(0,p1,e)}static createV1(e,t){return qr.create(1,e,t)}static decode(e){const[t,n]=qr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=qr.inspectBytes(e),n=t.size-t.multihashSize,i=O2(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new Tb(t.multihashCode,t.digestSize,s,i);return[t.version===0?qr.createV0(o):qr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=_b(e.subarray(t));return t+=p,h};let i=n(),s=p1;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=see(e,t),s=qr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Pb(s).set(n,e),s}};function see(r,e){switch(r[0]){case"Q":{const t=e??ki;return[ki.prefix,t.decode(`${ki.prefix}${r}`)]}case ki.prefix:{const t=e??ki;return[ki.prefix,t.decode(r)]}case L2.prefix:{const t=e??L2;return[L2.prefix,t.decode(r)]}case Ib.prefix:{const t=e??Ib;return[Ib.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function oee(r,e,t){const{prefix:n}=t;if(n!==ki.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function aee(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const p1=112,cee=18;function yP(r,e,t){const n=F2(r),i=n+F2(e),s=new Uint8Array(i+t.byteLength);return U2(r,s,0),U2(e,s,n),s.set(t,i),s}const lee=Symbol.for("@ipld/js-cid/CID"),mP=0,uee="identity",wP=O2;function dee(r){return $l(mP,wP(r))}const Db={code:mP,name:uee,encode:wP,digest:dee};function qe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Ge(r=0){return new Uint8Array(r)}function In(r=0){return new Uint8Array(r)}function lCe(r){return r}function or(r,e){e==null&&(e=r.reduce((i,s)=>i+s.length,0));const t=In(e);let n=0;for(const i of r)t.set(i,n),n+=i.length;return t}const bP=Symbol.for("@achingbrain/uint8arraylist");function vP(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(const n of r){const i=t+n.byteLength;if(e<i)return{buf:n,index:e-t};t=i}throw new RangeError("index is out of bounds")}function g1(r){return!!(r!=null&&r[bP])}class Be{constructor(...e){u(this,"bufs");u(this,"length");u(this,Sj,!0);this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[(Sj=bP,Symbol.iterator)](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(g1(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(g1(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){const t=vP(this.bufs,e);return t.buf[t.index]}set(e,t){const n=vP(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(g1(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){const{bufs:n,length:i}=this._subList(e,t);return or(n,i)}subarray(e,t){const{bufs:n,length:i}=this._subList(e,t);return n.length===1?n[0]:or(n,i)}sublist(e,t){const{bufs:n,length:i}=this._subList(e,t),s=new Be;return s.length=i,s.bufs=[...n],s}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};const n=[];let i=0;for(let s=0;s<this.bufs.length;s++){const o=this.bufs[s],a=i,c=a+o.byteLength;if(i=c,e>=c)continue;const l=e>=a&&e<c,d=t>a&&t<=c;if(l&&d){if(e===a&&t===c){n.push(o);break}const h=e-a;n.push(o.subarray(h,h+(t-e)));break}if(l){if(e===0){n.push(o);continue}n.push(o.subarray(e-a));continue}if(d){if(t===c){n.push(o);break}n.push(o.subarray(0,t-a));break}n.push(o)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!g1(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const i=n.byteLength;if(i===0)throw new TypeError("search must be at least 1 byte long");const s=256,o=new Int32Array(s);for(let h=0;h<s;h++)o[h]=-1;for(let h=0;h<i;h++)o[n[h]]=h;const a=o,c=this.byteLength-n.byteLength,l=n.byteLength-1;let d;for(let h=t;h<=c;h+=d){d=0;for(let p=l;p>=0;p--){const m=this.get(h+p);if(n[p]!==m){d=Math.max(1,p-a[m]);break}}if(d===0)return h}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const n=In(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){const i=Ge(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,t,n),this.write(i,e)}getInt32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){const i=Ge(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,t,n),this.write(i,e)}getBigInt64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){const i=Ge(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,t,n),this.write(i,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const n=In(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){const i=Ge(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,t,n),this.write(i,e)}getUint32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){const i=Ge(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,t,n),this.write(i,e)}getBigUint64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){const i=Ge(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,t,n),this.write(i,e)}getFloat32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){const i=Ge(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,t,n),this.write(i,e)}getFloat64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){const i=Ge(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,t,n),this.write(i,e)}equals(e){if(e==null||!(e instanceof Be)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!qe(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const n=new Be;return n.bufs=e,t==null&&(t=e.reduce((i,s)=>i+s.byteLength,0)),n.length=t,n}}function hee(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function fee(r){return new TextEncoder().encode(r)}function pee(r){return new TextDecoder().decode(r)}function gee(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var yee=gee,mee=yee;let wee=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},bee=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return EP(this,e)}},vee=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return EP(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function EP(r,e){return new vee({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Eee=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new wee(e,t,n),this.decoder=new bee(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function V2({name:r,prefix:e,encode:t,decode:n}){return new Eee(r,e,t,n)}function y1({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=mee(t,r);return V2({prefix:e,name:r,encode:n,decode:s=>hee(i(s))})}function See(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function xee(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Er({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return V2({prefix:e,name:r,encode(i){return xee(i,n,t)},decode(i){return See(i,n,t,r)}})}const Aee=y1({prefix:"9",name:"base10",alphabet:"0123456789"}),Cee=Object.freeze(Object.defineProperty({__proto__:null,base10:Aee},Symbol.toStringTag,{value:"Module"})),Iee=Er({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),kee=Er({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),_ee=Object.freeze(Object.defineProperty({__proto__:null,base16:Iee,base16upper:kee},Symbol.toStringTag,{value:"Module"})),Tee=Er({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Pee=Object.freeze(Object.defineProperty({__proto__:null,base2:Tee},Symbol.toStringTag,{value:"Module"})),SP=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Dee=SP.reduce((r,e,t)=>(r[t]=e,r),[]),$ee=SP.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function Nee(r){return r.reduce((e,t)=>(e+=Dee[t],e),"")}function Mee(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const i=$ee[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const Oee=V2({prefix:"🚀",name:"base256emoji",encode:Nee,decode:Mee}),Ree=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Oee},Symbol.toStringTag,{value:"Module"})),Lee=Er({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Bee=Er({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Uee=Er({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Fee=Er({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),zee=Er({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Vee=Er({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Kee=Er({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),jee=Er({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Hee=Er({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),qee=Object.freeze(Object.defineProperty({__proto__:null,base32:Lee,base32hex:zee,base32hexpad:Kee,base32hexpadupper:jee,base32hexupper:Vee,base32pad:Uee,base32padupper:Fee,base32upper:Bee,base32z:Hee},Symbol.toStringTag,{value:"Module"})),Wee=y1({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Gee=y1({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Qee=Object.freeze(Object.defineProperty({__proto__:null,base36:Wee,base36upper:Gee},Symbol.toStringTag,{value:"Module"})),Yee=y1({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Jee=y1({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Xee=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Yee,base58flickr:Jee},Symbol.toStringTag,{value:"Module"})),Zee=Er({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ete=Er({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),tte=Er({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),rte=Er({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),nte=Object.freeze(Object.defineProperty({__proto__:null,base64:Zee,base64pad:ete,base64url:tte,base64urlpad:rte},Symbol.toStringTag,{value:"Module"})),ite=Er({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),ste=Object.freeze(Object.defineProperty({__proto__:null,base8:ite},Symbol.toStringTag,{value:"Module"})),ote=V2({prefix:"\0",name:"identity",encode:r=>pee(r),decode:r=>fee(r)}),ate=Object.freeze(Object.defineProperty({__proto__:null,identity:ote},Symbol.toStringTag,{value:"Module"}));new TextEncoder,new TextDecoder;const xP={...ate,...Pee,...ste,...Cee,..._ee,...qee,...Qee,...Xee,...nte,...Ree};function AP(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const CP=AP("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),$b=AP("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=In(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),IP={utf8:CP,"utf-8":CP,hex:xP.base16,latin1:$b,ascii:$b,binary:$b,...xP};function se(r,e="utf8"){const t=IP[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}function re(r,e="utf8"){const t=IP[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}const cte=parseInt("11111",2),Nb=parseInt("10000000",2),lte=parseInt("01111111",2),kP={0:w1,1:w1,2:ute,3:fte,4:pte,5:hte,6:dte,16:w1,22:w1,48:w1};function Ya(r,e={offset:0}){const t=r[e.offset]&cte;if(e.offset++,kP[t]!=null)return kP[t](r,e);throw new Error("No decoder for tag "+t)}function m1(r,e){let t=0;if((r[e.offset]&Nb)===Nb){const n=r[e.offset]&lte;let i="0x";e.offset++;for(let s=0;s<n;s++,e.offset++)i+=r[e.offset].toString(16).padStart(2,"0");t=parseInt(i,16)}else t=r[e.offset],e.offset++;return t}function w1(r,e){m1(r,e);const t=[];for(;!(e.offset>=r.byteLength);){const n=Ya(r,e);if(n===null)break;t.push(n)}return t}function ute(r,e){const t=m1(r,e),n=e.offset,i=e.offset+t,s=[];for(let o=n;o<i;o++)o===n&&r[o]===0||s.push(r[o]);return e.offset+=t,Uint8Array.from(s)}function dte(r,e){const t=m1(r,e),n=e.offset+t,i=r[e.offset];e.offset++;let s=0,o=0;i<40?(s=0,o=i):i<80?(s=1,o=i-40):(s=2,o=i-80);let a=`${s}.${o}`,c=[];for(;e.offset<n;){const l=r[e.offset];if(e.offset++,c.push(l&127),l<128){c.reverse();let d=0;for(let h=0;h<c.length;h++)d+=c[h]<<h*7;a+=`.${d}`,c=[]}}return a}function hte(r,e){return e.offset++,null}function fte(r,e){const t=m1(r,e),n=r[e.offset];e.offset++;const i=r.subarray(e.offset,e.offset+t-1);if(e.offset+=t,n!==0)throw new Error("Unused bits in bit string is unimplemented");return i}function pte(r,e){const t=m1(r,e),n=r.subarray(e.offset,e.offset+t);return e.offset+=t,n}function gte(r){let e=r.toString(16);e.length%2===1&&(e="0"+e);const t=new Be;for(let n=0;n<e.length;n+=2)t.append(Uint8Array.from([parseInt(`${e[n]}${e[n+1]}`,16)]));return t}function K2(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);const e=gte(r.byteLength);return new Be(Uint8Array.from([e.byteLength|Nb]),e)}function Zn(r){const e=new Be,t=128;return(r.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(r),new Be(Uint8Array.from([2]),K2(e),e)}function Mb(r){const e=Uint8Array.from([0]),t=new Be(e,r);return new Be(Uint8Array.from([3]),K2(t),t)}function yte(r){return new Be(Uint8Array.from([4]),K2(r),r)}function _o(r,e=48){const t=new Be;for(const n of r)t.append(n);return new Be(Uint8Array.from([e]),K2(t),t)}const _P="1.2.840.10045.3.1.7",TP="1.3.132.0.34",PP="1.3.132.0.35";async function mte(r="P-256"){const e=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:r},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",e.publicKey),privateKey:await crypto.subtle.exportKey("jwk",e.privateKey)}}async function wte(r,e){const t=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["sign"]),n=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},t,e.subarray());return new Uint8Array(n,0,n.byteLength)}async function bte(r,e,t){const n=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["verify"]);return crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},n,e,t.subarray())}const vte=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),Ete=Uint8Array.from([6,5,43,129,4,0,34]),Ste=Uint8Array.from([6,5,43,129,4,0,35]),DP={ext:!0,kty:"EC",crv:"P-256"},$P={ext:!0,kty:"EC",crv:"P-384"},NP={ext:!0,kty:"EC",crv:"P-521"},Ad=32,Cd=48,Id=66;function xte(r){const e=Ya(r);return MP(e)}function MP(r){const e=r[1],t=re(e,"base64url"),n=r[2][1][0],i=1;let s,o;if(e.byteLength===Ad)return s=re(n.subarray(i,i+Ad),"base64url"),o=re(n.subarray(i+Ad),"base64url"),new H2({...DP,key_ops:["sign"],d:t,x:s,y:o});if(e.byteLength===Cd)return s=re(n.subarray(i,i+Cd),"base64url"),o=re(n.subarray(i+Cd),"base64url"),new H2({...$P,key_ops:["sign"],d:t,x:s,y:o});if(e.byteLength===Id)return s=re(n.subarray(i,i+Id),"base64url"),o=re(n.subarray(i+Id),"base64url"),new H2({...NP,key_ops:["sign"],d:t,x:s,y:o});throw new Z(`Private key length was wrong length, got ${e.byteLength}, expected 32, 48 or 66`)}function OP(r){const e=Ya(r);return RP(e)}function RP(r){const e=r[1][1][0],t=1;let n,i;if(e.byteLength===Ad*2+1)return n=re(e.subarray(t,t+Ad),"base64url"),i=re(e.subarray(t+Ad),"base64url"),new j2({...DP,key_ops:["verify"],x:n,y:i});if(e.byteLength===Cd*2+1)return n=re(e.subarray(t,t+Cd),"base64url"),i=re(e.subarray(t+Cd),"base64url"),new j2({...$P,key_ops:["verify"],x:n,y:i});if(e.byteLength===Id*2+1)return n=re(e.subarray(t,t+Id),"base64url"),i=re(e.subarray(t+Id),"base64url"),new j2({...NP,key_ops:["verify"],x:n,y:i});throw new Z(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function Ate(r){return _o([Zn(Uint8Array.from([1])),yte(se(r.d??"","base64url")),_o([LP(r.crv)],160),_o([Mb(new Be(Uint8Array.from([4]),se(r.x??"","base64url"),se(r.y??"","base64url")))],161)]).subarray()}function Cte(r){return _o([Zn(Uint8Array.from([1])),_o([LP(r.crv)],160),_o([Mb(new Be(Uint8Array.from([4]),se(r.x??"","base64url"),se(r.y??"","base64url")))],161)]).subarray()}function LP(r){if(r==="P-256")return vte;if(r==="P-384")return Ete;if(r==="P-521")return Ste;throw new Z(`Invalid curve ${r}`)}async function Ite(r="P-256"){const e=await mte(r);return new H2(e.privateKey)}class j2{constructor(e){u(this,"type","ECDSA");u(this,"jwk");u(this,"_raw");this.jwk=e}get raw(){return this._raw==null&&(this._raw=Cte(this.jwk)),this._raw}toMultihash(){return Db.digest(_i(this))}toCID(){return z2.createV1(114,this.toMultihash())}toString(){return ki.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:qe(this.raw,e.raw)}async verify(e,t){return bte(this.jwk,t,e)}}class H2{constructor(e){u(this,"type","ECDSA");u(this,"jwk");u(this,"publicKey");u(this,"_raw");this.jwk=e,this.publicKey=new j2({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){return this._raw==null&&(this._raw=Ate(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:qe(this.raw,e.raw)}async sign(e){return wte(this.jwk,e)}}function BP(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function kte(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function q2(r,...e){if(!kte(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function _te(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");BP(r.outputLen),BP(r.blockLen)}function W2(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Tte(r,e){q2(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const kd=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ob(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function Ms(r,e){return r<<32-e|r>>>e}typeof Uint8Array.from([]).toHex=="function"&&Uint8Array.fromHex;function Pte(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function Rb(r){return typeof r=="string"&&(r=Pte(r)),q2(r),r}function Dte(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];q2(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const s=r[n];t.set(s,i),i+=s.length}return t}let UP=class{clone(){return this._cloneInto()}};function FP(r){const e=n=>r().update(Rb(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Lb(r=32){if(kd&&typeof kd.getRandomValues=="function")return kd.getRandomValues(new Uint8Array(r));if(kd&&typeof kd.randomBytes=="function")return Uint8Array.from(kd.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function $te(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function Nte(r,e,t){return r&e^~r&t}function Mte(r,e,t){return r&e^r&t^e&t}let zP=class extends UP{constructor(e,t,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Ob(this.buffer)}update(e){W2(this);const{view:t,buffer:n,blockLen:i}=this;e=Rb(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Ob(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){W2(this),Tte(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)t[h]=0;$te(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Ob(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,d[h],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%t&&e.buffer.set(n),e}};const Ote=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ja=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Xa=new Uint32Array(64);let Rte=class extends zP{constructor(e=32){super(64,e,8,!1),this.A=Ja[0]|0,this.B=Ja[1]|0,this.C=Ja[2]|0,this.D=Ja[3]|0,this.E=Ja[4]|0,this.F=Ja[5]|0,this.G=Ja[6]|0,this.H=Ja[7]|0}get(){const{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)Xa[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const p=Xa[h-15],m=Xa[h-2],f=Ms(p,7)^Ms(p,18)^p>>>3,g=Ms(m,17)^Ms(m,19)^m>>>10;Xa[h]=g+Xa[h-7]+f+Xa[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:l,H:d}=this;for(let h=0;h<64;h++){const p=Ms(a,6)^Ms(a,11)^Ms(a,25),m=d+p+Nte(a,c,l)+Ote[h]+Xa[h]|0,g=(Ms(n,2)^Ms(n,13)^Ms(n,22))+Mte(n,i,s)|0;d=l,l=c,c=a,a=o+m|0,o=s,s=i,i=n,n=m+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(n,i,s,o,a,c,l,d)}roundClean(){Xa.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Lte=FP(()=>new Rte),G2=BigInt(2**32-1),Bb=BigInt(32);function VP(r,e=!1){return e?{h:Number(r&G2),l:Number(r>>Bb&G2)}:{h:Number(r>>Bb&G2)|0,l:Number(r&G2)|0}}function Bte(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let i=0;i<r.length;i++){const{h:s,l:o}=VP(r[i],e);[t[i],n[i]]=[s,o]}return[t,n]}const Ute=(r,e)=>BigInt(r>>>0)<<Bb|BigInt(e>>>0),Fte=(r,e,t)=>r>>>t,zte=(r,e,t)=>r<<32-t|e>>>t,Vte=(r,e,t)=>r>>>t|e<<32-t,Kte=(r,e,t)=>r<<32-t|e>>>t,jte=(r,e,t)=>r<<64-t|e>>>t-32,Hte=(r,e,t)=>r>>>t-32|e<<64-t,qte=(r,e)=>e,Wte=(r,e)=>r,Gte=(r,e,t)=>r<<t|e>>>32-t,Qte=(r,e,t)=>e<<t|r>>>32-t,Yte=(r,e,t)=>e<<t-32|r>>>64-t,Jte=(r,e,t)=>r<<t-32|e>>>64-t;function Xte(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}const Ke={fromBig:VP,split:Bte,toBig:Ute,shrSH:Fte,shrSL:zte,rotrSH:Vte,rotrSL:Kte,rotrBH:jte,rotrBL:Hte,rotr32H:qte,rotr32L:Wte,rotlSH:Gte,rotlSL:Qte,rotlBH:Yte,rotlBL:Jte,add:Xte,add3L:(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),add3H:(r,e,t,n)=>e+t+n+(r/2**32|0)|0,add4L:(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),add4H:(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,add5H:(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0,add5L:(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0)},[Zte,ere]=Ke.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Za=new Uint32Array(80),ec=new Uint32Array(80);let tre=class extends zP{constructor(e=64){super(128,e,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:d,Fh:h,Fl:p,Gh:m,Gl:f,Hh:g,Hl:v}=this;return[e,t,n,i,s,o,a,c,l,d,h,p,m,f,g,v]}set(e,t,n,i,s,o,a,c,l,d,h,p,m,f,g,v){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=d|0,this.Fh=h|0,this.Fl=p|0,this.Gh=m|0,this.Gl=f|0,this.Hh=g|0,this.Hl=v|0}process(e,t){for(let b=0;b<16;b++,t+=4)Za[b]=e.getUint32(t),ec[b]=e.getUint32(t+=4);for(let b=16;b<80;b++){const E=Za[b-15]|0,A=ec[b-15]|0,k=Ke.rotrSH(E,A,1)^Ke.rotrSH(E,A,8)^Ke.shrSH(E,A,7),x=Ke.rotrSL(E,A,1)^Ke.rotrSL(E,A,8)^Ke.shrSL(E,A,7),I=Za[b-2]|0,T=ec[b-2]|0,L=Ke.rotrSH(I,T,19)^Ke.rotrBH(I,T,61)^Ke.shrSH(I,T,6),z=Ke.rotrSL(I,T,19)^Ke.rotrBL(I,T,61)^Ke.shrSL(I,T,6),B=Ke.add4L(x,z,ec[b-7],ec[b-16]),G=Ke.add4H(B,k,L,Za[b-7],Za[b-16]);Za[b]=G|0,ec[b]=B|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:d,Eh:h,El:p,Fh:m,Fl:f,Gh:g,Gl:v,Hh:y,Hl:w}=this;for(let b=0;b<80;b++){const E=Ke.rotrSH(h,p,14)^Ke.rotrSH(h,p,18)^Ke.rotrBH(h,p,41),A=Ke.rotrSL(h,p,14)^Ke.rotrSL(h,p,18)^Ke.rotrBL(h,p,41),k=h&m^~h&g,x=p&f^~p&v,I=Ke.add5L(w,A,x,ere[b],ec[b]),T=Ke.add5H(I,y,E,k,Zte[b],Za[b]),L=I|0,z=Ke.rotrSH(n,i,28)^Ke.rotrBH(n,i,34)^Ke.rotrBH(n,i,39),B=Ke.rotrSL(n,i,28)^Ke.rotrBL(n,i,34)^Ke.rotrBL(n,i,39),G=n&s^n&a^s&a,j=i&o^i&c^o&c;y=g|0,w=v|0,g=m|0,v=f|0,m=h|0,f=p|0,{h,l:p}=Ke.add(l|0,d|0,T|0,L|0),l=a|0,d=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const q=Ke.add3L(L,B,j);n=Ke.add3H(q,T,z,G),i=q|0}({h:n,l:i}=Ke.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=Ke.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Ke.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:d}=Ke.add(this.Dh|0,this.Dl|0,l|0,d|0),{h,l:p}=Ke.add(this.Eh|0,this.El|0,h|0,p|0),{h:m,l:f}=Ke.add(this.Fh|0,this.Fl|0,m|0,f|0),{h:g,l:v}=Ke.add(this.Gh|0,this.Gl|0,g|0,v|0),{h:y,l:w}=Ke.add(this.Hh|0,this.Hl|0,y|0,w|0),this.set(n,i,s,o,a,c,l,d,h,p,m,f,g,v,y,w)}roundClean(){Za.fill(0),ec.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const rre=FP(()=>new tre);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ub=BigInt(0),Fb=BigInt(1);function _d(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function zb(r){if(!_d(r))throw new Error("Uint8Array expected")}function tc(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}function Q2(r){const e=r.toString(16);return e.length&1?"0"+e:e}function KP(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Ub:BigInt("0x"+r)}const jP=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",nre=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Td(r){if(zb(r),jP)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=nre[r[t]];return e}const To={_0:48,_9:57,A:65,F:70,a:97,f:102};function HP(r){if(r>=To._0&&r<=To._9)return r-To._0;if(r>=To.A&&r<=To.F)return r-(To.A-10);if(r>=To.a&&r<=To.f)return r-(To.a-10)}function Y2(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(jP)return Uint8Array.fromHex(r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let i=0,s=0;i<t;i++,s+=2){const o=HP(r.charCodeAt(s)),a=HP(r.charCodeAt(s+1));if(o===void 0||a===void 0){const c=r[s]+r[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function Nl(r){return KP(Td(r))}function Ml(r){return zb(r),KP(Td(Uint8Array.from(r).reverse()))}function b1(r,e){return Y2(r.toString(16).padStart(e*2,"0"))}function v1(r,e){return b1(r,e).reverse()}function qt(r,e,t){let n;if(typeof e=="string")try{n=Y2(e)}catch(s){throw new Error(r+" must be hex string or Uint8Array, cause: "+s)}else if(_d(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const i=n.length;if(typeof t=="number"&&i!==t)throw new Error(r+" of length "+t+" expected, got "+i);return n}function Pd(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];zb(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const s=r[n];t.set(s,i),i+=s.length}return t}const Vb=r=>typeof r=="bigint"&&Ub<=r;function Kb(r,e,t){return Vb(r)&&Vb(e)&&Vb(t)&&e<=r&&r<t}function ei(r,e,t,n){if(!Kb(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function ire(r){let e;for(e=0;r>Ub;r>>=Fb,e+=1);return e}const J2=r=>(Fb<<BigInt(r))-Fb,jb=r=>new Uint8Array(r),qP=r=>Uint8Array.from(r);function sre(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=jb(r),i=jb(r),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...h)=>t(i,n,...h),c=(h=jb(0))=>{i=a(qP([0]),h),n=a(),h.length!==0&&(i=a(qP([1]),h),n=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const p=[];for(;h<e;){n=a();const m=n.slice();p.push(m),h+=n.length}return Pd(...p)};return(h,p)=>{o(),c(h);let m;for(;!(m=p(l()));)c();return o(),m}}const ore={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||_d(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function Dd(r,e,t={}){const n=(i,s,o)=>{const a=ore[s];if(typeof a!="function")throw new Error("invalid validator function");const c=r[i];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(t))n(i,s,!0);return r}function X2(r){const e=new WeakMap;return(t,...n)=>{const i=e.get(t);if(i!==void 0)return i;const s=r(t,...n);return e.set(t,s),s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const hr=BigInt(0),Ft=BigInt(1),Ol=BigInt(2),are=BigInt(3),Hb=BigInt(4),WP=BigInt(5),GP=BigInt(8);function St(r,e){const t=r%e;return t>=hr?t:e+t}function QP(r,e,t){if(e<hr)throw new Error("invalid exponent, negatives unsupported");if(t<=hr)throw new Error("invalid modulus");if(t===Ft)return hr;let n=Ft;for(;e>hr;)e&Ft&&(n=n*r%t),r=r*r%t,e>>=Ft;return n}function zt(r,e,t){let n=r;for(;e-- >hr;)n*=n,n%=t;return n}function qb(r,e){if(r===hr)throw new Error("invert: expected non-zero number");if(e<=hr)throw new Error("invert: expected positive modulus, got "+e);let t=St(r,e),n=e,i=hr,s=Ft;for(;t!==hr;){const a=n/t,c=n%t,l=i-s*a;n=t,t=c,i=s,s=l}if(n!==Ft)throw new Error("invert: does not exist");return St(i,e)}function cre(r){const e=(r-Ft)/Ol;let t,n,i;for(t=r-Ft,n=0;t%Ol===hr;t/=Ol,n++);for(i=Ol;i<r&&QP(i,e,r)!==r-Ft;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(r+Ft)/Hb;return function(c,l){const d=c.pow(l,o);if(!c.eql(c.sqr(d),l))throw new Error("Cannot find square root");return d}}const s=(t+Ft)/Ol;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=n,d=a.pow(a.mul(a.ONE,i),t),h=a.pow(c,s),p=a.pow(c,t);for(;!a.eql(p,a.ONE);){if(a.eql(p,a.ZERO))return a.ZERO;let m=1;for(let g=a.sqr(p);m<l&&!a.eql(g,a.ONE);m++)g=a.sqr(g);const f=a.pow(d,Ft<<BigInt(l-m-1));d=a.sqr(f),h=a.mul(h,f),p=a.mul(p,d),l=m}return h}}function lre(r){if(r%Hb===are){const e=(r+Ft)/Hb;return function(n,i){const s=n.pow(i,e);if(!n.eql(n.sqr(s),i))throw new Error("Cannot find square root");return s}}if(r%GP===WP){const e=(r-WP)/GP;return function(n,i){const s=n.mul(i,Ol),o=n.pow(s,e),a=n.mul(i,o),c=n.mul(n.mul(a,Ol),o),l=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(l),i))throw new Error("Cannot find square root");return l}}return cre(r)}const ure=(r,e)=>(St(r,e)&Ft)===Ft,dre=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function hre(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=dre.reduce((n,i)=>(n[i]="function",n),e);return Dd(r,t)}function fre(r,e,t){if(t<hr)throw new Error("invalid exponent, negatives unsupported");if(t===hr)return r.ONE;if(t===Ft)return e;let n=r.ONE,i=e;for(;t>hr;)t&Ft&&(n=r.mul(n,i)),i=r.sqr(i),t>>=Ft;return n}function pre(r,e){const t=new Array(e.length),n=e.reduce((s,o,a)=>r.is0(o)?s:(t[a]=s,r.mul(s,o)),r.ONE),i=r.inv(n);return e.reduceRight((s,o,a)=>r.is0(o)?s:(t[a]=r.mul(s,t[a]),r.mul(s,o)),i),t}function YP(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function Z2(r,e,t=!1,n={}){if(r<=hr)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:i,nByteLength:s}=YP(r,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:r,isLE:t,BITS:i,BYTES:s,MASK:J2(i),ZERO:hr,ONE:Ft,create:c=>St(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return hr<=c&&c<r},is0:c=>c===hr,isOdd:c=>(c&Ft)===Ft,neg:c=>St(-c,r),eql:(c,l)=>c===l,sqr:c=>St(c*c,r),add:(c,l)=>St(c+l,r),sub:(c,l)=>St(c-l,r),mul:(c,l)=>St(c*l,r),pow:(c,l)=>fre(a,c,l),div:(c,l)=>St(c*qb(l,r),r),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>qb(c,r),sqrt:n.sqrt||(c=>(o||(o=lre(r)),o(a,c))),invertBatch:c=>pre(a,c),cmov:(c,l,d)=>d?l:c,toBytes:c=>t?v1(c,s):b1(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return t?Ml(c):Nl(c)}});return Object.freeze(a)}function JP(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function XP(r){const e=JP(r);return e+Math.ceil(e/2)}function gre(r,e,t=!1){const n=r.length,i=JP(e),s=XP(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=t?Ml(r):Nl(r),a=St(o,e-Ft)+Ft;return t?v1(a,i):b1(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ZP=BigInt(0),Wb=BigInt(1);function Gb(r,e){const t=e.negate();return r?t:e}function eD(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Qb(r,e){eD(r,e);const t=Math.ceil(e/r)+1,n=2**(r-1),i=2**r,s=J2(r),o=BigInt(r);return{windows:t,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function tD(r,e,t){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=t;let a=Number(r&i),c=r>>o;a>n&&(a-=s,c+=Wb);const l=e*n,d=l+Math.abs(a)-1,h=a===0,p=a<0,m=e%2!==0;return{nextN:c,offset:d,isZero:h,isNeg:p,isNegF:m,offsetF:l}}function yre(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function mre(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}const Yb=new WeakMap,rD=new WeakMap;function Jb(r){return rD.get(r)||1}function nD(r,e){return{constTimeNegate:Gb,hasPrecomputes(t){return Jb(t)!==1},unsafeLadder(t,n,i=r.ZERO){let s=t;for(;n>ZP;)n&Wb&&(i=i.add(s)),s=s.double(),n>>=Wb;return i},precomputeWindow(t,n){const{windows:i,windowSize:s}=Qb(n,e),o=[];let a=t,c=a;for(let l=0;l<i;l++){c=a,o.push(c);for(let d=1;d<s;d++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,n,i){let s=r.ZERO,o=r.BASE;const a=Qb(t,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:d,isZero:h,isNeg:p,isNegF:m,offsetF:f}=tD(i,c,a);i=l,h?o=o.add(Gb(m,n[f])):s=s.add(Gb(p,n[d]))}return{p:s,f:o}},wNAFUnsafe(t,n,i,s=r.ZERO){const o=Qb(t,e);for(let a=0;a<o.windows&&i!==ZP;a++){const{nextN:c,offset:l,isZero:d,isNeg:h}=tD(i,a,o);if(i=c,!d){const p=n[l];s=s.add(h?p.negate():p)}}return s},getPrecomputes(t,n,i){let s=Yb.get(n);return s||(s=this.precomputeWindow(n,t),t!==1&&Yb.set(n,i(s))),s},wNAFCached(t,n,i){const s=Jb(t);return this.wNAF(s,this.getPrecomputes(s,t,i),n)},wNAFCachedUnsafe(t,n,i,s){const o=Jb(t);return o===1?this.unsafeLadder(t,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,t,i),n,s)},setWindowSize(t,n){eD(n,e),rD.set(t,n),Yb.delete(t)}}}function iD(r,e,t,n){if(yre(t,r),mre(n,e),t.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=r.ZERO,s=ire(BigInt(t.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=J2(o),c=new Array(Number(a)+1).fill(i),l=Math.floor((e.BITS-1)/o)*o;let d=i;for(let h=l;h>=0;h-=o){c.fill(i);for(let m=0;m<n.length;m++){const f=n[m],g=Number(f>>BigInt(h)&a);c[g]=c[g].add(t[m])}let p=i;for(let m=c.length-1,f=i;m>0;m--)f=f.add(c[m]),p=p.add(f);if(d=d.add(p),h!==0)for(let m=0;m<o;m++)d=d.double()}return d}function Xb(r){return hre(r.Fp),Dd(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...YP(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Os=BigInt(0),hn=BigInt(1),sD=BigInt(2),wre=BigInt(8),bre={zip215:!0};function vre(r){const e=Xb(r);return Dd(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Ere(r){const e=vre(r),{Fp:t,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,l=sD<<BigInt(a*8)-hn,d=t.create,h=Z2(e.n,e.nBitLength),p=e.uvRatio||((K,O)=>{try{return{isValid:!0,value:t.sqrt(K*t.inv(O))}}catch{return{isValid:!1,value:Os}}}),m=e.adjustScalarBytes||(K=>K),f=e.domain||((K,O,U)=>{if(tc("phflag",U),O.length||U)throw new Error("Contexts/pre-hash are not supported");return K});function g(K,O,U=!1){const W=U?hn:Os;ei("coordinate "+K,O,W,l)}function v(K){if(!(K instanceof b))throw new Error("ExtendedPoint expected")}const y=X2((K,O)=>{const{ex:U,ey:W,ez:Y}=K,H=K.is0();O==null&&(O=H?wre:t.inv(Y));const ie=d(U*O),me=d(W*O),de=d(Y*O);if(H)return{x:Os,y:hn};if(de!==hn)throw new Error("invZ was invalid");return{x:ie,y:me}}),w=X2(K=>{const{a:O,d:U}=e;if(K.is0())throw new Error("bad point: ZERO");const{ex:W,ey:Y,ez:H,et:ie}=K,me=d(W*W),de=d(Y*Y),le=d(H*H),Ne=d(le*le),Me=d(me*O),Xe=d(le*d(Me+de)),nt=d(Ne+d(U*d(me*de)));if(Xe!==nt)throw new Error("bad point: equation left != right (1)");const It=d(W*Y),kt=d(H*ie);if(It!==kt)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(O,U,W,Y){g("x",O),g("y",U),g("z",W,!0),g("t",Y),this.ex=O,this.ey=U,this.ez=W,this.et=Y,Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(O){if(O instanceof b)throw new Error("extended point not allowed");const{x:U,y:W}=O||{};return g("x",U),g("y",W),new b(U,W,hn,d(U*W))}static normalizeZ(O){const U=t.invertBatch(O.map(W=>W.ez));return O.map((W,Y)=>W.toAffine(U[Y])).map(b.fromAffine)}static msm(O,U){return iD(b,h,O,U)}_setWindowSize(O){k.setWindowSize(this,O)}assertValidity(){w(this)}equals(O){v(O);const{ex:U,ey:W,ez:Y}=this,{ex:H,ey:ie,ez:me}=O,de=d(U*me),le=d(H*Y),Ne=d(W*me),Me=d(ie*Y);return de===le&&Ne===Me}is0(){return this.equals(b.ZERO)}negate(){return new b(d(-this.ex),this.ey,this.ez,d(-this.et))}double(){const{a:O}=e,{ex:U,ey:W,ez:Y}=this,H=d(U*U),ie=d(W*W),me=d(sD*d(Y*Y)),de=d(O*H),le=U+W,Ne=d(d(le*le)-H-ie),Me=de+ie,Xe=Me-me,nt=de-ie,It=d(Ne*Xe),kt=d(Me*nt),$t=d(Ne*nt),nr=d(Xe*Me);return new b(It,kt,nr,$t)}add(O){v(O);const{a:U,d:W}=e,{ex:Y,ey:H,ez:ie,et:me}=this,{ex:de,ey:le,ez:Ne,et:Me}=O,Xe=d(Y*de),nt=d(H*le),It=d(me*W*Me),kt=d(ie*Ne),$t=d((Y+H)*(de+le)-Xe-nt),nr=kt-It,Nr=kt+It,fa=d(nt-U*Xe),eo=d($t*nr),pe=d(Nr*fa),ws=d($t*fa),to=d(nr*Nr);return new b(eo,pe,to,ws)}subtract(O){return this.add(O.negate())}wNAF(O){return k.wNAFCached(this,O,b.normalizeZ)}multiply(O){const U=O;ei("scalar",U,hn,n);const{p:W,f:Y}=this.wNAF(U);return b.normalizeZ([W,Y])[0]}multiplyUnsafe(O,U=b.ZERO){const W=O;return ei("scalar",W,Os,n),W===Os?A:this.is0()||W===hn?this:k.wNAFCachedUnsafe(this,W,b.normalizeZ,U)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return k.unsafeLadder(this,n).is0()}toAffine(O){return y(this,O)}clearCofactor(){const{h:O}=e;return O===hn?this:this.multiplyUnsafe(O)}static fromHex(O,U=!1){const{d:W,a:Y}=e,H=t.BYTES;O=qt("pointHex",O,H),tc("zip215",U);const ie=O.slice(),me=O[H-1];ie[H-1]=me&-129;const de=Ml(ie),le=U?l:t.ORDER;ei("pointHex.y",de,Os,le);const Ne=d(de*de),Me=d(Ne-hn),Xe=d(W*Ne-Y);let{isValid:nt,value:It}=p(Me,Xe);if(!nt)throw new Error("Point.fromHex: invalid y coordinate");const kt=(It&hn)===hn,$t=(me&128)!==0;if(!U&&It===Os&&$t)throw new Error("Point.fromHex: x=0 and x_0=1");return $t!==kt&&(It=d(-It)),b.fromAffine({x:It,y:de})}static fromPrivateKey(O){const{scalar:U}=T(O);return E.multiply(U)}toRawBytes(){const{x:O,y:U}=this.toAffine(),W=v1(U,t.BYTES);return W[W.length-1]|=O&hn?128:0,W}toHex(){return Td(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,hn,d(e.Gx*e.Gy)),b.ZERO=new b(Os,hn,hn,Os);const{BASE:E,ZERO:A}=b,k=nD(b,a*8);function x(K){return St(K,n)}function I(K){return x(Ml(K))}function T(K){const O=t.BYTES;K=qt("private key",K,O);const U=qt("hashed private key",s(K),2*O),W=m(U.slice(0,O)),Y=U.slice(O,2*O),H=I(W);return{head:W,prefix:Y,scalar:H}}function L(K){const{head:O,prefix:U,scalar:W}=T(K),Y=E.multiply(W),H=Y.toRawBytes();return{head:O,prefix:U,scalar:W,point:Y,pointBytes:H}}function z(K){return L(K).pointBytes}function B(K=new Uint8Array,...O){const U=Pd(...O);return I(s(f(U,qt("context",K),!!i)))}function G(K,O,U={}){K=qt("message",K),i&&(K=i(K));const{prefix:W,scalar:Y,pointBytes:H}=L(O),ie=B(U.context,W,K),me=E.multiply(ie).toRawBytes(),de=B(U.context,me,H,K),le=x(ie+de*Y);ei("signature.s",le,Os,n);const Ne=Pd(me,v1(le,t.BYTES));return qt("result",Ne,t.BYTES*2)}const j=bre;function q(K,O,U,W=j){const{context:Y,zip215:H}=W,ie=t.BYTES;K=qt("signature",K,2*ie),O=qt("message",O),U=qt("publicKey",U,ie),H!==void 0&&tc("zip215",H),i&&(O=i(O));const me=Ml(K.slice(ie,2*ie));let de,le,Ne;try{de=b.fromHex(U,H),le=b.fromHex(K.slice(0,ie),H),Ne=E.multiplyUnsafe(me)}catch{return!1}if(!H&&de.isSmallOrder())return!1;const Me=B(Y,le.toRawBytes(),de.toRawBytes(),O);return le.add(de.multiplyUnsafe(Me)).subtract(Ne).clearCofactor().equals(b.ZERO)}return E._setWindowSize(8),{CURVE:e,getPublicKey:z,sign:G,verify:q,ExtendedPoint:b,utils:{getExtendedPublicKey:L,randomPrivateKey:()=>o(t.BYTES),precompute(K=8,O=b.BASE){return O._setWindowSize(K),O.multiply(BigInt(3)),O}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const $d=BigInt(0),Zb=BigInt(1);function Sre(r){return Dd(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function xre(r){const e=Sre(r),{P:t}=e,n=w=>St(w,t),i=e.montgomeryBits,s=Math.ceil(i/8),o=e.nByteLength,a=e.adjustScalarBytes||(w=>w),c=e.powPminus2||(w=>QP(w,t-BigInt(2),t));function l(w,b,E){const A=n(w*(b-E));return b=n(b-A),E=n(E+A),[b,E]}const d=(e.a-BigInt(2))/BigInt(4);function h(w,b){ei("u",w,$d,t),ei("scalar",b,$d,t);const E=b,A=w;let k=Zb,x=$d,I=w,T=Zb,L=$d,z;for(let G=BigInt(i-1);G>=$d;G--){const j=E>>G&Zb;L^=j,z=l(L,k,I),k=z[0],I=z[1],z=l(L,x,T),x=z[0],T=z[1],L=j;const q=k+x,Q=n(q*q),K=k-x,O=n(K*K),U=Q-O,W=I+T,Y=I-T,H=n(Y*q),ie=n(W*K),me=H+ie,de=H-ie;I=n(me*me),T=n(A*n(de*de)),k=n(Q*O),x=n(U*(Q+n(d*U)))}z=l(L,k,I),k=z[0],I=z[1],z=l(L,x,T),x=z[0],T=z[1];const B=c(x);return n(k*B)}function p(w){return v1(n(w),s)}function m(w){const b=qt("u coordinate",w,s);return o===32&&(b[31]&=127),Ml(b)}function f(w){const b=qt("scalar",w),E=b.length;if(E!==s&&E!==o){let A=""+s+" or "+o;throw new Error("invalid scalar, expected "+A+" bytes, got "+E)}return Ml(a(b))}function g(w,b){const E=m(b),A=f(w),k=h(E,A);if(k===$d)throw new Error("invalid private or public key received");return p(k)}const v=p(e.Gu);function y(w){return g(w,v)}return{scalarMult:g,scalarMultBase:y,getSharedSecret:(w,b)=>g(w,b),getPublicKey:w=>y(w),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:v}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const E1=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),oD=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Are=BigInt(1),aD=BigInt(2),Cre=BigInt(3),Ire=BigInt(5),kre=BigInt(8);function cD(r){const e=BigInt(10),t=BigInt(20),n=BigInt(40),i=BigInt(80),s=E1,a=r*r%s*r%s,c=zt(a,aD,s)*a%s,l=zt(c,Are,s)*r%s,d=zt(l,Ire,s)*l%s,h=zt(d,e,s)*d%s,p=zt(h,t,s)*h%s,m=zt(p,n,s)*p%s,f=zt(m,i,s)*m%s,g=zt(f,i,s)*m%s,v=zt(g,e,s)*d%s;return{pow_p_5_8:zt(v,aD,s)*r%s,b2:a}}function lD(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function _re(r,e){const t=E1,n=St(e*e*e,t),i=St(n*n*e,t),s=cD(r*i).pow_p_5_8;let o=St(r*n*s,t);const a=St(e*o*o,t),c=o,l=St(o*oD,t),d=a===r,h=a===St(-r,t),p=a===St(-r*oD,t);return d&&(o=c),(h||p)&&(o=l),ure(o,t)&&(o=St(-o,t)),{isValid:d||h,value:o}}const uD=Z2(E1,void 0,!0),Tre={a:uD.create(BigInt(-1)),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:uD,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:kre,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:rre,randomBytes:Lb,adjustScalarBytes:lD,uvRatio:_re},ey=Ere(Tre),ty=xre({P:E1,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{const e=E1,{pow_p_5_8:t,b2:n}=cD(r);return St(zt(t,Cre,e)*n,e)},adjustScalarBytes:lD,randomBytes:Lb}),S1=32,Po=64,ev=32;function Pre(){const r=ey.utils.randomPrivateKey(),e=ey.getPublicKey(r);return{privateKey:Nre(r,e),publicKey:e}}function Dre(r,e){const t=r.subarray(0,ev);return ey.sign(e instanceof Uint8Array?e:e.subarray(),t)}function $re(r,e,t){return ey.verify(e,t instanceof Uint8Array?t:t.subarray(),r)}function Nre(r,e){const t=new Uint8Array(Po);for(let n=0;n<ev;n++)t[n]=r[n],t[ev+n]=e[n];return t}class dD{constructor(e){u(this,"type","Ed25519");u(this,"raw");this.raw=x1(e,S1)}toMultihash(){return Db.digest(_i(this))}toCID(){return z2.createV1(114,this.toMultihash())}toString(){return ki.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:qe(this.raw,e.raw)}verify(e,t){return $re(this.raw,t,e)}}class tv{constructor(e,t){u(this,"type","Ed25519");u(this,"raw");u(this,"publicKey");this.raw=x1(e,Po),this.publicKey=new dD(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:qe(this.raw,e.raw)}sign(e){return Dre(this.raw,e)}}function hD(r){if(r.length>Po){r=x1(r,Po+S1);const n=r.subarray(0,Po),i=r.subarray(Po,r.length);return new tv(n,i)}r=x1(r,Po);const e=r.subarray(0,Po),t=r.subarray(S1);return new tv(e,t)}function rv(r){return r=x1(r,S1),new dD(r)}async function Mre(){const{privateKey:r,publicKey:e}=Pre();return new tv(r,e)}function x1(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new Z(`Key must be a Uint8Array of length ${e}, got ${r.length}`);return r}const Ore=Math.pow(2,7),Rre=Math.pow(2,14),Lre=Math.pow(2,21),nv=Math.pow(2,28),iv=Math.pow(2,35),sv=Math.pow(2,42),ov=Math.pow(2,49),ut=128,Ur=127;function yt(r){if(r<Ore)return 1;if(r<Rre)return 2;if(r<Lre)return 3;if(r<nv)return 4;if(r<iv)return 5;if(r<sv)return 6;if(r<ov)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function fD(r,e,t=0){switch(yt(r)){case 8:e[t++]=r&255|ut,r/=128;case 7:e[t++]=r&255|ut,r/=128;case 6:e[t++]=r&255|ut,r/=128;case 5:e[t++]=r&255|ut,r/=128;case 4:e[t++]=r&255|ut,r>>>=7;case 3:e[t++]=r&255|ut,r>>>=7;case 2:e[t++]=r&255|ut,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function Bre(r,e,t=0){switch(yt(r)){case 8:e.set(t++,r&255|ut),r/=128;case 7:e.set(t++,r&255|ut),r/=128;case 6:e.set(t++,r&255|ut),r/=128;case 5:e.set(t++,r&255|ut),r/=128;case 4:e.set(t++,r&255|ut),r>>>=7;case 3:e.set(t++,r&255|ut),r>>>=7;case 2:e.set(t++,r&255|ut),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function pD(r,e){let t=r[e],n=0;if(n+=t&Ur,t<ut||(t=r[e+1],n+=(t&Ur)<<7,t<ut)||(t=r[e+2],n+=(t&Ur)<<14,t<ut)||(t=r[e+3],n+=(t&Ur)<<21,t<ut)||(t=r[e+4],n+=(t&Ur)*nv,t<ut)||(t=r[e+5],n+=(t&Ur)*iv,t<ut)||(t=r[e+6],n+=(t&Ur)*sv,t<ut)||(t=r[e+7],n+=(t&Ur)*ov,t<ut))return n;throw new RangeError("Could not decode varint")}function Ure(r,e){let t=r.get(e),n=0;if(n+=t&Ur,t<ut||(t=r.get(e+1),n+=(t&Ur)<<7,t<ut)||(t=r.get(e+2),n+=(t&Ur)<<14,t<ut)||(t=r.get(e+3),n+=(t&Ur)<<21,t<ut)||(t=r.get(e+4),n+=(t&Ur)*nv,t<ut)||(t=r.get(e+5),n+=(t&Ur)*iv,t<ut)||(t=r.get(e+6),n+=(t&Ur)*sv,t<ut)||(t=r.get(e+7),n+=(t&Ur)*ov,t<ut))return n;throw new RangeError("Could not decode varint")}function Sr(r,e,t=0){return e==null&&(e=In(yt(r))),e instanceof Uint8Array?fD(r,e,t):Bre(r,e,t)}function Zi(r,e=0){return r instanceof Uint8Array?pD(r,e):Ure(r,e)}const av=new Float32Array([-0]),rc=new Uint8Array(av.buffer);function Fre(r,e,t){av[0]=r,e[t]=rc[0],e[t+1]=rc[1],e[t+2]=rc[2],e[t+3]=rc[3]}function zre(r,e){return rc[0]=r[e],rc[1]=r[e+1],rc[2]=r[e+2],rc[3]=r[e+3],av[0]}const cv=new Float64Array([-0]),Fr=new Uint8Array(cv.buffer);function Vre(r,e,t){cv[0]=r,e[t]=Fr[0],e[t+1]=Fr[1],e[t+2]=Fr[2],e[t+3]=Fr[3],e[t+4]=Fr[4],e[t+5]=Fr[5],e[t+6]=Fr[6],e[t+7]=Fr[7]}function Kre(r,e){return Fr[0]=r[e],Fr[1]=r[e+1],Fr[2]=r[e+2],Fr[3]=r[e+3],Fr[4]=r[e+4],Fr[5]=r[e+5],Fr[6]=r[e+6],Fr[7]=r[e+7],cv[0]}const jre=BigInt(Number.MAX_SAFE_INTEGER),Hre=BigInt(Number.MIN_SAFE_INTEGER);class zr{constructor(e,t){u(this,"lo");u(this,"hi");this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return Rl;if(e<jre&&e>Hre)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let n=e>>32n,i=e-(n<<32n);return t&&(n=~n|0n,i=~i|0n,++i>gD&&(i=0n,++n>gD&&(n=0n))),new zr(Number(i),Number(n))}static fromNumber(e){if(e===0)return Rl;const t=e<0;t&&(e=-e);let n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new zr(n,i)}static from(e){return typeof e=="number"?zr.fromNumber(e):typeof e=="bigint"?zr.fromBigInt(e):typeof e=="string"?zr.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new zr(e.low>>>0,e.high>>>0):Rl}}const Rl=new zr(0,0);Rl.toBigInt=function(){return 0n},Rl.zzEncode=Rl.zzDecode=function(){return this},Rl.length=function(){return 1};const gD=4294967296n;function qre(r){let e=0,t=0;for(let n=0;n<r.length;++n)t=r.charCodeAt(n),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function Wre(r,e,t){if(t-e<1)return"";let i;const s=[];let o=0,a;for(;e<t;)a=r[e++],a<128?s[o++]=a:a>191&&a<224?s[o++]=(a&31)<<6|r[e++]&63:a>239&&a<365?(a=((a&7)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,s[o++]=55296+(a>>10),s[o++]=56320+(a&1023)):s[o++]=(a&15)<<12|(r[e++]&63)<<6|r[e++]&63,o>8191&&((i??(i=[])).push(String.fromCharCode.apply(String,s)),o=0);return i!=null?(o>0&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))}function yD(r,e,t){const n=t;let i,s;for(let o=0;o<r.length;++o)i=r.charCodeAt(o),i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&((s=r.charCodeAt(o+1))&64512)===56320?(i=65536+((i&1023)<<10)+(s&1023),++o,e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128);return t-n}function es(r,e){return RangeError(`index out of range: ${r.pos} + ${e??1} > ${r.len}`)}function ry(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}class Gre{constructor(e){u(this,"buf");u(this,"pos");u(this,"len");u(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,es(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw es(this,4);return ry(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw es(this,4);return ry(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw es(this,4);const e=zre(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw es(this,4);const e=Kre(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw es(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){const e=this.bytes();return Wre(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw es(this,e);this.pos+=e}else do if(this.pos>=this.len)throw es(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new zr(0,0);let t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw es(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw es(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw es(this,8);const e=ry(this.buf,this.pos+=4),t=ry(this.buf,this.pos+=4);return new zr(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=pD(this.buf,this.pos);return this.pos+=yt(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function Qre(r){return new Gre(r instanceof Uint8Array?r:r.subarray())}function Pe(r,e,t){const n=Qre(r);return e.decode(n,void 0,t)}function Yre(r){let n,i=8192;return function(o){if(o<1||o>4096)return In(o);i+o>8192&&(n=In(8192),i=0);const a=n.subarray(i,i+=o);return i&7&&(i=(i|7)+1),a}}class A1{constructor(e,t,n){u(this,"fn");u(this,"len");u(this,"next");u(this,"val");this.fn=e,this.len=t,this.next=void 0,this.val=n}}function lv(){}class Jre{constructor(e){u(this,"head");u(this,"tail");u(this,"len");u(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const Xre=Yre();function Zre(r){return globalThis.Buffer!=null?In(r):Xre(r)}class uv{constructor(){u(this,"len");u(this,"head");u(this,"tail");u(this,"states");this.len=0,this.head=new A1(lv,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new A1(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new tne((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(ny,10,zr.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=zr.fromBigInt(e);return this._push(ny,t.length(),t)}uint64Number(e){return this._push(fD,yt(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=zr.fromBigInt(e).zzEncode();return this._push(ny,t.length(),t)}sint64Number(e){const t=zr.fromNumber(e).zzEncode();return this._push(ny,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(dv,1,e?1:0)}fixed32(e){return this._push(C1,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=zr.fromBigInt(e);return this._push(C1,4,t.lo)._push(C1,4,t.hi)}fixed64Number(e){const t=zr.fromNumber(e);return this._push(C1,4,t.lo)._push(C1,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(Fre,4,e)}double(e){return this._push(Vre,8,e)}bytes(e){const t=e.length>>>0;return t===0?this._push(dv,1,0):this.uint32(t)._push(rne,t,e)}string(e){const t=qre(e);return t!==0?this.uint32(t)._push(yD,t,e):this._push(dv,1,0)}fork(){return this.states=new Jre(this),this.head=this.tail=new A1(lv,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new A1(lv,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next;const t=Zre(this.len);let n=0;for(;e!=null;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}}function dv(r,e,t){e[t]=r&255}function ene(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}class tne extends A1{constructor(t,n){super(ene,t,n);u(this,"next");this.next=void 0}}function ny(r,e,t){for(;r.hi!==0;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}function C1(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function rne(r,e,t){e.set(r,t)}globalThis.Buffer!=null&&(uv.prototype.bytes=function(r){const e=r.length>>>0;return this.uint32(e),e>0&&this._push(nne,e,r),this},uv.prototype.string=function(r){const e=globalThis.Buffer.byteLength(r);return this.uint32(e),e>0&&this._push(ine,e,r),this});function nne(r,e,t){e.set(r,t)}function ine(r,e,t){r.length<40?yD(r,e,t):e.utf8Write!=null?e.utf8Write(r,t):e.set(se(r),t)}function sne(){return new uv}function De(r,e){const t=sne();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var iy;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(iy||(iy={}));function mD(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function kn(r){function e(i){if(r[i.toString()]==null)throw new Error("Invalid enum value");return r[i]}const t=function(s,o){const a=e(s);o.int32(a)},n=function(s){const o=s.int32();return e(o)};return mD("enum",iy.VARINT,t,n)}function $e(r,e){return mD("message",iy.LENGTH_DELIMITED,r,e)}class mt extends Error{constructor(){super(...arguments);u(this,"code","ERR_MAX_LENGTH");u(this,"name","MaxLengthError")}}class wD extends Error{constructor(){super(...arguments);u(this,"code","ERR_MAX_SIZE");u(this,"name","MaxSizeError")}}var Ot;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.ECDSA="ECDSA"})(Ot||(Ot={}));var hv;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1",r[r.ECDSA=3]="ECDSA"})(hv||(hv={})),function(r){r.codec=()=>kn(hv)}(Ot||(Ot={}));var nc;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Ot.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=Ot.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(nc||(nc={}));var sy;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Ot.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=Ot.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(sy||(sy={}));const Nd=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function one(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Md(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function I1(r,...e){if(!one(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function oy(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Md(r.outputLen),Md(r.blockLen)}function ay(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function ane(r,e){I1(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Rs(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function k1(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function Ls(r,e){return r<<32-e|r>>>e}function fv(r,e){return r<<e|r>>>32-e>>>0}const cne=async()=>{};async function lne(r,e,t){let n=Date.now();for(let i=0;i<r;i++){t(i);const s=Date.now()-n;s>=0&&s<e||(await cne(),n+=s)}}function bD(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function _1(r){return typeof r=="string"&&(r=bD(r)),I1(r),r}function vD(r){return typeof r=="string"&&(r=bD(r)),I1(r),r}function une(r,e){if(e!==void 0&&{}.toString.call(e)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(r,e)}class ED{}function pv(r){const e=n=>r().update(_1(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function dne(r=32){if(Nd&&typeof Nd.getRandomValues=="function")return Nd.getRandomValues(new Uint8Array(r));if(Nd&&typeof Nd.randomBytes=="function")return Uint8Array.from(Nd.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function ic(r){if(isNaN(r)||r<=0)throw new Z("random bytes length must be a Number bigger than 0");return dne(r)}class SD extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}}class xD extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class hne extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}const Bs={get(r=globalThis){const e=r.crypto;if((e==null?void 0:e.subtle)==null)throw new hne("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}};function fne(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function AD(r,e,t){return r&e^~r&t}function CD(r,e,t){return r&e^r&t^e&t}class gv extends ED{constructor(e,t,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=k1(this.buffer)}update(e){ay(this),e=_1(e),I1(e);const{view:t,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=k1(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ay(this),ane(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,Rs(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)t[h]=0;fne(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=k1(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,d[h],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const sc=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Vr=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),cy=BigInt(2**32-1),ID=BigInt(32);function pne(r,e=!1){return e?{h:Number(r&cy),l:Number(r>>ID&cy)}:{h:Number(r>>ID&cy)|0,l:Number(r&cy)|0}}function gne(r,e=!1){const t=r.length;let n=new Uint32Array(t),i=new Uint32Array(t);for(let s=0;s<t;s++){const{h:o,l:a}=pne(r[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const kD=(r,e,t)=>r>>>t,_D=(r,e,t)=>r<<32-t|e>>>t,Od=(r,e,t)=>r>>>t|e<<32-t,Rd=(r,e,t)=>r<<32-t|e>>>t,ly=(r,e,t)=>r<<64-t|e>>>t-32,uy=(r,e,t)=>r>>>t-32|e<<64-t;function Do(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}const yne=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),mne=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,wne=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),bne=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,vne=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0),Ene=(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0,Sne=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),oc=new Uint32Array(64);class xne extends gv{constructor(e=32){super(64,e,8,!1),this.A=sc[0]|0,this.B=sc[1]|0,this.C=sc[2]|0,this.D=sc[3]|0,this.E=sc[4]|0,this.F=sc[5]|0,this.G=sc[6]|0,this.H=sc[7]|0}get(){const{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)oc[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const p=oc[h-15],m=oc[h-2],f=Ls(p,7)^Ls(p,18)^p>>>3,g=Ls(m,17)^Ls(m,19)^m>>>10;oc[h]=g+oc[h-7]+f+oc[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:l,H:d}=this;for(let h=0;h<64;h++){const p=Ls(a,6)^Ls(a,11)^Ls(a,25),m=d+p+AD(a,c,l)+Sne[h]+oc[h]|0,g=(Ls(n,2)^Ls(n,13)^Ls(n,22))+CD(n,i,s)|0;d=l,l=c,c=a,a=o+m|0,o=s,s=i,i=n,n=m+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(n,i,s,o,a,c,l,d)}roundClean(){Rs(oc)}destroy(){this.set(0,0,0,0,0,0,0,0),Rs(this.buffer)}}const TD=gne(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Ane=TD[0],Cne=TD[1],ac=new Uint32Array(80),cc=new Uint32Array(80);class Ine extends gv{constructor(e=64){super(128,e,16,!1),this.Ah=Vr[0]|0,this.Al=Vr[1]|0,this.Bh=Vr[2]|0,this.Bl=Vr[3]|0,this.Ch=Vr[4]|0,this.Cl=Vr[5]|0,this.Dh=Vr[6]|0,this.Dl=Vr[7]|0,this.Eh=Vr[8]|0,this.El=Vr[9]|0,this.Fh=Vr[10]|0,this.Fl=Vr[11]|0,this.Gh=Vr[12]|0,this.Gl=Vr[13]|0,this.Hh=Vr[14]|0,this.Hl=Vr[15]|0}get(){const{Ah:e,Al:t,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:d,Fh:h,Fl:p,Gh:m,Gl:f,Hh:g,Hl:v}=this;return[e,t,n,i,s,o,a,c,l,d,h,p,m,f,g,v]}set(e,t,n,i,s,o,a,c,l,d,h,p,m,f,g,v){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=d|0,this.Fh=h|0,this.Fl=p|0,this.Gh=m|0,this.Gl=f|0,this.Hh=g|0,this.Hl=v|0}process(e,t){for(let b=0;b<16;b++,t+=4)ac[b]=e.getUint32(t),cc[b]=e.getUint32(t+=4);for(let b=16;b<80;b++){const E=ac[b-15]|0,A=cc[b-15]|0,k=Od(E,A,1)^Od(E,A,8)^kD(E,A,7),x=Rd(E,A,1)^Rd(E,A,8)^_D(E,A,7),I=ac[b-2]|0,T=cc[b-2]|0,L=Od(I,T,19)^ly(I,T,61)^kD(I,T,6),z=Rd(I,T,19)^uy(I,T,61)^_D(I,T,6),B=wne(x,z,cc[b-7],cc[b-16]),G=bne(B,k,L,ac[b-7],ac[b-16]);ac[b]=G|0,cc[b]=B|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:d,Eh:h,El:p,Fh:m,Fl:f,Gh:g,Gl:v,Hh:y,Hl:w}=this;for(let b=0;b<80;b++){const E=Od(h,p,14)^Od(h,p,18)^ly(h,p,41),A=Rd(h,p,14)^Rd(h,p,18)^uy(h,p,41),k=h&m^~h&g,x=p&f^~p&v,I=vne(w,A,x,Cne[b],cc[b]),T=Ene(I,y,E,k,Ane[b],ac[b]),L=I|0,z=Od(n,i,28)^ly(n,i,34)^ly(n,i,39),B=Rd(n,i,28)^uy(n,i,34)^uy(n,i,39),G=n&s^n&a^s&a,j=i&o^i&c^o&c;y=g|0,w=v|0,g=m|0,v=f|0,m=h|0,f=p|0,{h,l:p}=Do(l|0,d|0,T|0,L|0),l=a|0,d=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const q=yne(L,B,j);n=mne(q,T,z,G),i=q|0}({h:n,l:i}=Do(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=Do(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Do(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:d}=Do(this.Dh|0,this.Dl|0,l|0,d|0),{h,l:p}=Do(this.Eh|0,this.El|0,h|0,p|0),{h:m,l:f}=Do(this.Fh|0,this.Fl|0,m|0,f|0),{h:g,l:v}=Do(this.Gh|0,this.Gl|0,g|0,v|0),{h:y,l:w}=Do(this.Hh|0,this.Hl|0,y|0,w|0),this.set(n,i,s,o,a,c,l,d,h,p,m,f,g,v,y,w)}roundClean(){Rs(ac,cc)}destroy(){Rs(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const kne=pv(()=>new xne),_ne=pv(()=>new Ine),Ll=kne;let yv=class{constructor(e,t){u(this,"type","RSA");u(this,"jwk");u(this,"_raw");u(this,"_multihash");this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=wv(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return z2.createV1(114,this._multihash)}toString(){return ki.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:qe(this.raw,e.raw)}verify(e,t){return Vne(this.jwk,t,e)}},PD=class{constructor(e,t){u(this,"type","RSA");u(this,"jwk");u(this,"_raw");u(this,"publicKey");this.jwk=e,this.publicKey=t}get raw(){return this._raw==null&&(this._raw=$ne(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:qe(this.raw,e.raw)}sign(e){return zne(this.jwk,e)}};const DD=8192,mv=18,Tne=1062,Pne=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function Dne(r){return{n:re(r[1],"base64url"),e:re(r[2],"base64url"),d:re(r[3],"base64url"),p:re(r[4],"base64url"),q:re(r[5],"base64url"),dp:re(r[6],"base64url"),dq:re(r[7],"base64url"),qi:re(r[8],"base64url"),kty:"RSA"}}function $ne(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new Z("JWK was missing components");return _o([Zn(Uint8Array.from([0])),Zn(se(r.n,"base64url")),Zn(se(r.e,"base64url")),Zn(se(r.d,"base64url")),Zn(se(r.p,"base64url")),Zn(se(r.q,"base64url")),Zn(se(r.dp,"base64url")),Zn(se(r.dq,"base64url")),Zn(se(r.qi,"base64url"))]).subarray()}function Nne(r){const e=Ya(r[1],{offset:0});return{kty:"RSA",n:re(e[0],"base64url"),e:re(e[1],"base64url")}}function wv(r){if(r.n==null||r.e==null)throw new Z("JWK was missing components");return _o([Pne,Mb(_o([Zn(se(r.n,"base64url")),Zn(se(r.e,"base64url"))]))]).subarray()}function Mne(r){const e=Ya(r);return $D(e)}function $D(r){const e=Dne(r);return Rne(e)}function One(r,e){if(r.byteLength>=Tne)throw new d1("Key size is too large");const t=Ya(r,{offset:0});return ND(t,r,e)}function ND(r,e,t){const n=Nne(r);if(t==null){const i=Ll(nc.encode({Type:Ot.RSA,Data:e}));t=$l(mv,i)}return new yv(n,t)}function Rne(r){if(jne(r)>DD)throw new Z("Key size is too large");const e=Bne(r),t=Ll(nc.encode({Type:Ot.RSA,Data:wv(e.publicKey)})),n=$l(mv,t);return new PD(e.privateKey,new yv(e.publicKey,n))}async function Lne(r){if(r>DD)throw new Z("Key size is too large");const e=await Fne(r),t=Ll(nc.encode({Type:Ot.RSA,Data:wv(e.publicKey)})),n=$l(mv,t);return new PD(e.privateKey,new yv(e.publicKey,n))}function Bne(r){if(r==null)throw new Z("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}const Une="1.2.840.113549.1.1.1";async function Fne(r){const e=await Bs.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await Kne(e);return{privateKey:t[0],publicKey:t[1]}}async function zne(r,e){const t=await Bs.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Bs.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(n,0,n.byteLength)}async function Vne(r,e,t){const n=await Bs.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Bs.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,t instanceof Uint8Array?t:t.subarray())}async function Kne(r){if(r.privateKey==null||r.publicKey==null)throw new Z("Private and public key are required");return Promise.all([Bs.get().subtle.exportKey("jwk",r.privateKey),Bs.get().subtle.exportKey("jwk",r.publicKey)])}function jne(r){if(r.kty!=="RSA")throw new Z("invalid key type");if(r.n==null)throw new Z("invalid key modulus");return se(r.n,"base64url").length*8}let MD=class extends UP{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,_te(e);const n=Rb(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return W2(this),this.iHash.update(e),this}digestInto(e){W2(this),q2(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const OD=(r,e,t)=>new MD(r,e).update(t).digest();OD.create=(r,e)=>new MD(r,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function RD(r){r.lowS!==void 0&&tc("lowS",r.lowS),r.prehash!==void 0&&tc("prehash",r.prehash)}function Hne(r){const e=Xb(r);Dd(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:n,a:i}=e;if(t){if(!n.eql(i,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}class qne extends Error{constructor(e=""){super(e)}}const $o={Err:qne,_tlv:{encode:(r,e)=>{const{Err:t}=$o;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const n=e.length/2,i=Q2(n);if(i.length/2&128)throw new t("tlv.encode: long form length too big");const s=n>127?Q2(i.length/2|128):"";return Q2(r)+s+i+e},decode(r,e){const{Err:t}=$o;let n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const d of l)o=o<<8|d;if(n+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(r){const{Err:e}=$o;if(r<No)throw new e("integer: negative integers are not allowed");let t=Q2(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=$o;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Nl(r)}},toSig(r){const{Err:e,_int:t,_tlv:n}=$o,i=qt("signature",r),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:l,l:d}=n.decode(2,c);if(d.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(r){const{_tlv:e,_int:t}=$o,n=e.encode(2,t.encode(r.r)),i=e.encode(2,t.encode(r.s)),s=n+i;return e.encode(48,s)}},No=BigInt(0),fr=BigInt(1);BigInt(2);const LD=BigInt(3);BigInt(4);function Wne(r){const e=Hne(r),{Fp:t}=e,n=Z2(e.n,e.nBitLength),i=e.toBytes||((g,v,y)=>{const w=v.toAffine();return Pd(Uint8Array.from([4]),t.toBytes(w.x),t.toBytes(w.y))}),s=e.fromBytes||(g=>{const v=g.subarray(1),y=t.fromBytes(v.subarray(0,t.BYTES)),w=t.fromBytes(v.subarray(t.BYTES,2*t.BYTES));return{x:y,y:w}});function o(g){const{a:v,b:y}=e,w=t.sqr(g),b=t.mul(w,g);return t.add(t.add(b,t.mul(g,v)),y)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(g){return Kb(g,fr,e.n)}function c(g){const{allowedPrivateKeyLengths:v,nByteLength:y,wrapPrivateKey:w,n:b}=e;if(v&&typeof g!="bigint"){if(_d(g)&&(g=Td(g)),typeof g!="string"||!v.includes(g.length))throw new Error("invalid private key");g=g.padStart(y*2,"0")}let E;try{E=typeof g=="bigint"?g:Nl(qt("private key",g,y))}catch{throw new Error("invalid private key, expected hex or "+y+" bytes, got "+typeof g)}return w&&(E=St(E,b)),ei("private key",E,fr,b),E}function l(g){if(!(g instanceof p))throw new Error("ProjectivePoint expected")}const d=X2((g,v)=>{const{px:y,py:w,pz:b}=g;if(t.eql(b,t.ONE))return{x:y,y:w};const E=g.is0();v==null&&(v=E?t.ONE:t.inv(b));const A=t.mul(y,v),k=t.mul(w,v),x=t.mul(b,v);if(E)return{x:t.ZERO,y:t.ZERO};if(!t.eql(x,t.ONE))throw new Error("invZ was invalid");return{x:A,y:k}}),h=X2(g=>{if(g.is0()){if(e.allowInfinityPoint&&!t.is0(g.py))return;throw new Error("bad point: ZERO")}const{x:v,y}=g.toAffine();if(!t.isValid(v)||!t.isValid(y))throw new Error("bad point: x or y not FE");const w=t.sqr(y),b=o(v);if(!t.eql(w,b))throw new Error("bad point: equation left != right");if(!g.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class p{constructor(v,y,w){if(v==null||!t.isValid(v))throw new Error("x required");if(y==null||!t.isValid(y))throw new Error("y required");if(w==null||!t.isValid(w))throw new Error("z required");this.px=v,this.py=y,this.pz=w,Object.freeze(this)}static fromAffine(v){const{x:y,y:w}=v||{};if(!v||!t.isValid(y)||!t.isValid(w))throw new Error("invalid affine point");if(v instanceof p)throw new Error("projective point not allowed");const b=E=>t.eql(E,t.ZERO);return b(y)&&b(w)?p.ZERO:new p(y,w,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(v){const y=t.invertBatch(v.map(w=>w.pz));return v.map((w,b)=>w.toAffine(y[b])).map(p.fromAffine)}static fromHex(v){const y=p.fromAffine(s(qt("pointHex",v)));return y.assertValidity(),y}static fromPrivateKey(v){return p.BASE.multiply(c(v))}static msm(v,y){return iD(p,n,v,y)}_setWindowSize(v){f.setWindowSize(this,v)}assertValidity(){h(this)}hasEvenY(){const{y:v}=this.toAffine();if(t.isOdd)return!t.isOdd(v);throw new Error("Field doesn't support isOdd")}equals(v){l(v);const{px:y,py:w,pz:b}=this,{px:E,py:A,pz:k}=v,x=t.eql(t.mul(y,k),t.mul(E,b)),I=t.eql(t.mul(w,k),t.mul(A,b));return x&&I}negate(){return new p(this.px,t.neg(this.py),this.pz)}double(){const{a:v,b:y}=e,w=t.mul(y,LD),{px:b,py:E,pz:A}=this;let k=t.ZERO,x=t.ZERO,I=t.ZERO,T=t.mul(b,b),L=t.mul(E,E),z=t.mul(A,A),B=t.mul(b,E);return B=t.add(B,B),I=t.mul(b,A),I=t.add(I,I),k=t.mul(v,I),x=t.mul(w,z),x=t.add(k,x),k=t.sub(L,x),x=t.add(L,x),x=t.mul(k,x),k=t.mul(B,k),I=t.mul(w,I),z=t.mul(v,z),B=t.sub(T,z),B=t.mul(v,B),B=t.add(B,I),I=t.add(T,T),T=t.add(I,T),T=t.add(T,z),T=t.mul(T,B),x=t.add(x,T),z=t.mul(E,A),z=t.add(z,z),T=t.mul(z,B),k=t.sub(k,T),I=t.mul(z,L),I=t.add(I,I),I=t.add(I,I),new p(k,x,I)}add(v){l(v);const{px:y,py:w,pz:b}=this,{px:E,py:A,pz:k}=v;let x=t.ZERO,I=t.ZERO,T=t.ZERO;const L=e.a,z=t.mul(e.b,LD);let B=t.mul(y,E),G=t.mul(w,A),j=t.mul(b,k),q=t.add(y,w),Q=t.add(E,A);q=t.mul(q,Q),Q=t.add(B,G),q=t.sub(q,Q),Q=t.add(y,b);let K=t.add(E,k);return Q=t.mul(Q,K),K=t.add(B,j),Q=t.sub(Q,K),K=t.add(w,b),x=t.add(A,k),K=t.mul(K,x),x=t.add(G,j),K=t.sub(K,x),T=t.mul(L,Q),x=t.mul(z,j),T=t.add(x,T),x=t.sub(G,T),T=t.add(G,T),I=t.mul(x,T),G=t.add(B,B),G=t.add(G,B),j=t.mul(L,j),Q=t.mul(z,Q),G=t.add(G,j),j=t.sub(B,j),j=t.mul(L,j),Q=t.add(Q,j),B=t.mul(G,Q),I=t.add(I,B),B=t.mul(K,Q),x=t.mul(q,x),x=t.sub(x,B),B=t.mul(q,G),T=t.mul(K,T),T=t.add(T,B),new p(x,I,T)}subtract(v){return this.add(v.negate())}is0(){return this.equals(p.ZERO)}wNAF(v){return f.wNAFCached(this,v,p.normalizeZ)}multiplyUnsafe(v){const{endo:y,n:w}=e;ei("scalar",v,No,w);const b=p.ZERO;if(v===No)return b;if(this.is0()||v===fr)return this;if(!y||f.hasPrecomputes(this))return f.wNAFCachedUnsafe(this,v,p.normalizeZ);let{k1neg:E,k1:A,k2neg:k,k2:x}=y.splitScalar(v),I=b,T=b,L=this;for(;A>No||x>No;)A&fr&&(I=I.add(L)),x&fr&&(T=T.add(L)),L=L.double(),A>>=fr,x>>=fr;return E&&(I=I.negate()),k&&(T=T.negate()),T=new p(t.mul(T.px,y.beta),T.py,T.pz),I.add(T)}multiply(v){const{endo:y,n:w}=e;ei("scalar",v,fr,w);let b,E;if(y){const{k1neg:A,k1:k,k2neg:x,k2:I}=y.splitScalar(v);let{p:T,f:L}=this.wNAF(k),{p:z,f:B}=this.wNAF(I);T=f.constTimeNegate(A,T),z=f.constTimeNegate(x,z),z=new p(t.mul(z.px,y.beta),z.py,z.pz),b=T.add(z),E=L.add(B)}else{const{p:A,f:k}=this.wNAF(v);b=A,E=k}return p.normalizeZ([b,E])[0]}multiplyAndAddUnsafe(v,y,w){const b=p.BASE,E=(k,x)=>x===No||x===fr||!k.equals(b)?k.multiplyUnsafe(x):k.multiply(x),A=E(this,y).add(E(v,w));return A.is0()?void 0:A}toAffine(v){return d(this,v)}isTorsionFree(){const{h:v,isTorsionFree:y}=e;if(v===fr)return!0;if(y)return y(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:v,clearCofactor:y}=e;return v===fr?this:y?y(p,this):this.multiplyUnsafe(e.h)}toRawBytes(v=!0){return tc("isCompressed",v),this.assertValidity(),i(p,this,v)}toHex(v=!0){return tc("isCompressed",v),Td(this.toRawBytes(v))}}p.BASE=new p(e.Gx,e.Gy,t.ONE),p.ZERO=new p(t.ZERO,t.ONE,t.ZERO);const m=e.nBitLength,f=nD(p,e.endo?Math.ceil(m/2):m);return{CURVE:e,ProjectivePoint:p,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function Gne(r){const e=Xb(r);return Dd(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Qne(r){const e=Gne(r),{Fp:t,n}=e,i=t.BYTES+1,s=2*t.BYTES+1;function o(j){return St(j,n)}function a(j){return qb(j,n)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:d,isWithinCurveOrder:h}=Wne({...e,toBytes(j,q,Q){const K=q.toAffine(),O=t.toBytes(K.x),U=Pd;return tc("isCompressed",Q),Q?U(Uint8Array.from([q.hasEvenY()?2:3]),O):U(Uint8Array.from([4]),O,t.toBytes(K.y))},fromBytes(j){const q=j.length,Q=j[0],K=j.subarray(1);if(q===i&&(Q===2||Q===3)){const O=Nl(K);if(!Kb(O,fr,t.ORDER))throw new Error("Point is not on curve");const U=d(O);let W;try{W=t.sqrt(U)}catch(ie){const me=ie instanceof Error?": "+ie.message:"";throw new Error("Point is not on curve"+me)}const Y=(W&fr)===fr;return(Q&1)===1!==Y&&(W=t.neg(W)),{x:O,y:W}}else if(q===s&&Q===4){const O=t.fromBytes(K.subarray(0,t.BYTES)),U=t.fromBytes(K.subarray(t.BYTES,2*t.BYTES));return{x:O,y:U}}else{const O=i,U=s;throw new Error("invalid Point, expected length of "+O+", or uncompressed "+U+", got "+q)}}}),p=j=>Td(b1(j,e.nByteLength));function m(j){const q=n>>fr;return j>q}function f(j){return m(j)?o(-j):j}const g=(j,q,Q)=>Nl(j.slice(q,Q));class v{constructor(q,Q,K){ei("r",q,fr,n),ei("s",Q,fr,n),this.r=q,this.s=Q,K!=null&&(this.recovery=K),Object.freeze(this)}static fromCompact(q){const Q=e.nByteLength;return q=qt("compactSignature",q,Q*2),new v(g(q,0,Q),g(q,Q,2*Q))}static fromDER(q){const{r:Q,s:K}=$o.toSig(qt("DER",q));return new v(Q,K)}assertValidity(){}addRecoveryBit(q){return new v(this.r,this.s,q)}recoverPublicKey(q){const{r:Q,s:K,recovery:O}=this,U=k(qt("msgHash",q));if(O==null||![0,1,2,3].includes(O))throw new Error("recovery id invalid");const W=O===2||O===3?Q+e.n:Q;if(W>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const Y=O&1?"03":"02",H=c.fromHex(Y+p(W)),ie=a(W),me=o(-U*ie),de=o(K*ie),le=c.BASE.multiplyAndAddUnsafe(H,me,de);if(!le)throw new Error("point at infinify");return le.assertValidity(),le}hasHighS(){return m(this.s)}normalizeS(){return this.hasHighS()?new v(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Y2(this.toDERHex())}toDERHex(){return $o.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Y2(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}}const y={isValidPrivateKey(j){try{return l(j),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const j=XP(e.n);return gre(e.randomBytes(j),e.n)},precompute(j=8,q=c.BASE){return q._setWindowSize(j),q.multiply(BigInt(3)),q}};function w(j,q=!0){return c.fromPrivateKey(j).toRawBytes(q)}function b(j){const q=_d(j),Q=typeof j=="string",K=(q||Q)&&j.length;return q?K===i||K===s:Q?K===2*i||K===2*s:j instanceof c}function E(j,q,Q=!0){if(b(j))throw new Error("first arg must be private key");if(!b(q))throw new Error("second arg must be public key");return c.fromHex(q).multiply(l(j)).toRawBytes(Q)}const A=e.bits2int||function(j){if(j.length>8192)throw new Error("input is too large");const q=Nl(j),Q=j.length*8-e.nBitLength;return Q>0?q>>BigInt(Q):q},k=e.bits2int_modN||function(j){return o(A(j))},x=J2(e.nBitLength);function I(j){return ei("num < 2^"+e.nBitLength,j,No,x),b1(j,e.nByteLength)}function T(j,q,Q=L){if(["recovered","canonical"].some(Me=>Me in Q))throw new Error("sign() legacy options not supported");const{hash:K,randomBytes:O}=e;let{lowS:U,prehash:W,extraEntropy:Y}=Q;U==null&&(U=!0),j=qt("msgHash",j),RD(Q),W&&(j=qt("prehashed msgHash",K(j)));const H=k(j),ie=l(q),me=[I(ie),I(H)];if(Y!=null&&Y!==!1){const Me=Y===!0?O(t.BYTES):Y;me.push(qt("extraEntropy",Me))}const de=Pd(...me),le=H;function Ne(Me){const Xe=A(Me);if(!h(Xe))return;const nt=a(Xe),It=c.BASE.multiply(Xe).toAffine(),kt=o(It.x);if(kt===No)return;const $t=o(nt*o(le+kt*ie));if($t===No)return;let nr=(It.x===kt?0:2)|Number(It.y&fr),Nr=$t;return U&&m($t)&&(Nr=f($t),nr^=1),new v(kt,Nr,nr)}return{seed:de,k2sig:Ne}}const L={lowS:e.lowS,prehash:!1},z={lowS:e.lowS,prehash:!1};function B(j,q,Q=L){const{seed:K,k2sig:O}=T(j,q,Q),U=e;return sre(U.hash.outputLen,U.nByteLength,U.hmac)(K,O)}c.BASE._setWindowSize(8);function G(j,q,Q,K=z){var nr;const O=j;q=qt("msgHash",q),Q=qt("publicKey",Q);const{lowS:U,prehash:W,format:Y}=K;if(RD(K),"strict"in K)throw new Error("options.strict was renamed to lowS");if(Y!==void 0&&Y!=="compact"&&Y!=="der")throw new Error("format must be compact or der");const H=typeof O=="string"||_d(O),ie=!H&&!Y&&typeof O=="object"&&O!==null&&typeof O.r=="bigint"&&typeof O.s=="bigint";if(!H&&!ie)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let me,de;try{if(ie&&(me=new v(O.r,O.s)),H){try{Y!=="compact"&&(me=v.fromDER(O))}catch(Nr){if(!(Nr instanceof $o.Err))throw Nr}!me&&Y!=="der"&&(me=v.fromCompact(O))}de=c.fromHex(Q)}catch{return!1}if(!me||U&&me.hasHighS())return!1;W&&(q=e.hash(q));const{r:le,s:Ne}=me,Me=k(q),Xe=a(Ne),nt=o(Me*Xe),It=o(le*Xe),kt=(nr=c.BASE.multiplyAndAddUnsafe(de,nt,It))==null?void 0:nr.toAffine();return kt?o(kt.x)===le:!1}return{CURVE:e,getPublicKey:w,getSharedSecret:E,sign:B,verify:G,ProjectivePoint:c,Signature:v,utils:y}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Yne(r){return{hash:r,hmac:(e,...t)=>OD(r,e,Dte(...t)),randomBytes:Lb}}function Jne(r,e){const t=n=>Qne({...r,...Yne(n)});return{...t(e),create:t}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const BD=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),UD=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Xne=BigInt(1),bv=BigInt(2),FD=(r,e)=>(r+e/bv)/e;function Zne(r){const e=BD,t=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=r*r*r%e,d=l*l*r%e,h=zt(d,t,e)*d%e,p=zt(h,t,e)*d%e,m=zt(p,bv,e)*l%e,f=zt(m,i,e)*m%e,g=zt(f,s,e)*f%e,v=zt(g,a,e)*g%e,y=zt(v,c,e)*v%e,w=zt(y,a,e)*g%e,b=zt(w,t,e)*d%e,E=zt(b,o,e)*f%e,A=zt(E,n,e)*l%e,k=zt(A,bv,e);if(!vv.eql(vv.sqr(k),r))throw new Error("Cannot find square root");return k}const vv=Z2(BD,void 0,void 0,{sqrt:Zne}),Us=Jne({a:BigInt(0),b:BigInt(7),Fp:vv,n:UD,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const e=UD,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Xne*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=t,o=BigInt("0x100000000000000000000000000000000"),a=FD(s*r,e),c=FD(-n*r,e);let l=St(r-a*t-c*i,e),d=St(-a*n-c*s,e);const h=l>o,p=d>o;if(h&&(l=e-l),p&&(d=e-d),l>o||d>o)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:h,k1:l,k2neg:p,k2:d}}}},Lte);BigInt(0),Us.ProjectivePoint;function eie({name:r,code:e,encode:t}){return new tie(r,e,t)}let tie=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?$l(this.code,t):t.then(n=>$l(this.code,n))}else throw Error("Unknown type, must be binary type")}};function rie(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const zD=eie({name:"sha2-256",code:18,encode:rie("SHA-256")});function VD(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}const nie=33,iie=32;function sie(r,e){const t=zD.digest(e instanceof Uint8Array?e:e.subarray());if(VD(t))return t.then(({digest:n})=>Us.sign(n,r).toDERRawBytes()).catch(n=>{throw new SD(String(n))});try{return Us.sign(t.digest,r).toDERRawBytes()}catch(n){throw new SD(String(n))}}function oie(r,e,t){const n=zD.digest(t instanceof Uint8Array?t:t.subarray());if(VD(n))return n.then(({digest:i})=>Us.verify(e,i,r)).catch(i=>{throw new xD(String(i))});try{return Us.verify(e,n.digest,r)}catch(i){throw new xD(String(i))}}class KD{constructor(e){u(this,"type","secp256k1");u(this,"raw");u(this,"_key");this._key=uie(e),this.raw=cie(this._key)}toMultihash(){return Db.digest(_i(this))}toCID(){return z2.createV1(114,this.toMultihash())}toString(){return ki.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:qe(this.raw,e.raw)}verify(e,t){return oie(this._key,t,e)}}class jD{constructor(e,t){u(this,"type","secp256k1");u(this,"raw");u(this,"publicKey");this.raw=lie(e),this.publicKey=new KD(t??die(e))}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:qe(this.raw,e.raw)}sign(e){return sie(this.raw,e)}}function HD(r){return new jD(r)}function Ev(r){return new KD(r)}async function aie(){const r=hie();return new jD(r)}function cie(r){return Us.ProjectivePoint.fromHex(r).toRawBytes(!0)}function lie(r){try{return Us.getPublicKey(r,!0),r}catch(e){throw new vb(String(e))}}function uie(r){try{return Us.ProjectivePoint.fromHex(r),r}catch(e){throw new d1(String(e))}}function die(r){try{return Us.getPublicKey(r,!0)}catch(e){throw new vb(String(e))}}function hie(){return Us.utils.randomPrivateKey()}async function dy(r,e){if(r==="Ed25519")return Mre();if(r==="secp256k1")return aie();if(r==="RSA")return Lne(gie(e));if(r==="ECDSA")return Ite(yie(e));throw new Dl}function _n(r,e){const{Type:t,Data:n}=nc.decode(r),i=n??new Uint8Array;switch(t){case Ot.RSA:return One(i,e);case Ot.Ed25519:return rv(i);case Ot.secp256k1:return Ev(i);case Ot.ECDSA:return OP(i);default:throw new Dl}}function fie(r){var n,i;if(r.byteLength===S1)return rv(r);if(r.byteLength===nie)return Ev(r);const e=Ya(r),t=(n=e[1])==null?void 0:n[0];if(t===_P||t===TP||t===PP)return RP(e);if(((i=e[0])==null?void 0:i[0])===Une)return ND(e,r);throw new Z("Could not extract public key from raw bytes")}function qD(r){const{Type:e,Data:t}=nc.decode(r.digest),n=t??new Uint8Array;switch(e){case Ot.Ed25519:return rv(n);case Ot.secp256k1:return Ev(n);case Ot.ECDSA:return OP(n);default:throw new Dl}}function _i(r){return nc.encode({Type:Ot[r.type],Data:r.raw})}function pie(r){const e=sy.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case Ot.RSA:return Mne(t);case Ot.Ed25519:return hD(t);case Ot.secp256k1:return HD(t);case Ot.ECDSA:return xte(t);default:throw new Dl}}function Sv(r){var n;if(r.byteLength===Po)return hD(r);if(r.byteLength===iie)return HD(r);const e=Ya(r),t=(n=e[2])==null?void 0:n[0];if(t===_P||t===TP||t===PP)return MP(e);if(e.length>8)return $D(e);throw new Z("Could not extract private key from raw bytes")}function T1(r){return sy.encode({Type:Ot[r.type],Data:r.raw})}function gie(r){return r==null?2048:parseInt(r,10)}function yie(r){if(r==="P-256"||r==null)return"P-256";if(r==="P-384")return"P-384";if(r==="P-521")return"P-521";throw new Z("Unsupported curve, should be P-256, P-384 or P-521")}async function WD(r){if(r.type==="RSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if(r.type==="ECDSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"ECDSA",namedCurve:r.jwk.crv??"P-256"},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"ECDSA",namedCurve:r.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new Z("Only RSA and ECDSA keys are supported")}function mie(r,e){for(let t=0;t<r.byteLength;t++){if(r[t]<e[t])return-1;if(r[t]>e[t])return 1}return r.byteLength>e.byteLength?1:r.byteLength<e.byteLength?-1:0}const wie=async(r,e,t)=>{if(!r)throw new Error("No signature given");if(!e)throw new Error("Given publicKey was undefined");if(!t)throw new Error("Given input data was undefined");t instanceof Uint8Array||(t=typeof t=="string"?se(t):new Uint8Array(t));const n=(s,o,a)=>s.verify(o,a);let i=!1;try{const s=fie(se(e,"base16"));i=await n(s,t,se(r,"base16"))}catch{}return Promise.resolve(i)},xv=async(r,e)=>{if(!r)throw new Error("No signing key given");if(!e)throw new Error("Given input data was undefined");return e instanceof Uint8Array||(e=typeof e=="string"?se(e):new Uint8Array(e)),re(await r.sign(e),"base16")},bie=Ns({size:1e3}),GD=async(r,e,t)=>{const n=await bie,i=await n.get(r);let s=!1;if(i){const o=(a,c)=>c instanceof Uint8Array?mie(a,c)===0:a.toString()===c.toString();s=i.publicKey===e&&o(i.data,t)}else{const o=await wie(r,e,t);s=o,o&&await n.put(r,{publicKey:e,data:t})}return s},vie="./keystore",QD=async({storage:r,path:e}={})=>{r=r||await pl(await Ns({size:1e3}),await fb({path:e||vie}));const t=await Ns({size:1e3}),n=async()=>{await r.close(),await t.close()},i=async()=>{await r.clear(),await t.clear()},s=async d=>{if(!d)throw new Error("id needed to check a key");let h=!1,p=await t.get(d);if(p)h=!0;else try{p=await r.get("private_"+d),h=p!=null}catch{console.error("Error: ENOENT: no such file or directory")}return h},o=async(d,h)=>{const{privateKey:p}=h;await r.put("private_"+d,p);const m=Sv(p);await t.put(d,m)};return{clear:i,close:n,hasKey:s,addKey:o,createKey:async d=>{if(!d)throw new Error("id needed to create a key");const h=await dy("secp256k1"),p={publicKey:h.publicKey.raw,privateKey:h.raw};return await o(d,p),h},getKey:async d=>{if(!d)throw new Error("id needed to get a key");let h=await t.get(d);if(!h){let p;try{p=await r.get("private_"+d)}catch{}if(!p)return;h=Sv(p),await t.put(d,h)}return h},getPublic:(d,h={})=>{const p=["hex","buffer"],m=h.format||"hex";if(p.indexOf(m)===-1)throw new Error("Supported formats are `hex` and `buffer`");const f=d.publicKey.raw;return m==="buffer"?f:re(f,"base16")}}},YD=Jf,JD=n2,Eie=dn,XD=async({id:r,publicKey:e,signatures:t,type:n,sign:i,verify:s}={})=>{if(!r)throw new Error("Identity id is required");if(!e)throw new Error("Invalid public key");if(!t)throw new Error("Signatures object is required");if(!t.id)throw new Error("Signature of id is required");if(!t.publicKey)throw new Error("Signature of publicKey+id is required");if(!n)throw new Error("Identity type is required");t=Object.assign({},t);const o={id:r,publicKey:e,signatures:t,type:n,sign:i,verify:s},{hash:a,bytes:c}=await Sie(o);return o.hash=a,o.bytes=c,o},Sie=async r=>{const{id:e,publicKey:t,signatures:n,type:i}=r,s={id:e,publicKey:t,signatures:n,type:i},{cid:o,bytes:a}=await sd({value:s,codec:YD,hasher:JD});return{hash:o.toString(Eie),bytes:Uint8Array.from(a)}},xie=async r=>{const{value:e}=await Vg({bytes:r,codec:YD,hasher:JD});return XD({...e})},Aie=r=>!!(r.id&&r.hash&&r.bytes&&r.publicKey&&r.signatures&&r.signatures.id&&r.signatures.publicKey&&r.type),Cie=(r,e)=>r.id===e.id&&r.hash===e.hash&&r.type===e.type&&r.publicKey===e.publicKey&&r.signatures.id===e.signatures.id&&r.signatures.publicKey===e.signatures.publicKey,ZD="publickey",Iie=async r=>{const{id:e,publicKey:t,signatures:n}=r;return GD(n.publicKey,e,t+n.id)},Av=({keystore:r})=>async()=>{if(!r)throw new Error("PublicKeyIdentityProvider requires a keystore parameter");return{type:ZD,getId:async({id:n}={})=>{if(!n)throw new Error("id is required");const i=await r.getKey(n)||await r.createKey(n);return re(i.publicKey.raw,"base16")},signIdentity:async(n,{id:i}={})=>{if(!i)throw new Error("id is required");const s=await r.getKey(i);if(!s)throw new Error(`Signing key for '${i}' not found`);return xv(s,n)}}};Av.verifyIdentity=Iie,Av.type=ZD;const Cv={},kie=r=>Object.keys(Cv).includes(r),Iv=r=>{if(!kie(r))throw new Error(`IdentityProvider type '${r}' is not supported`);return Cv[r]};(r=>{if(!r.type||typeof r.type!="string")throw new Error("Given IdentityProvider doesn't have a field 'type'.");if(!r.verifyIdentity)throw new Error("Given IdentityProvider doesn't have a function 'verifyIdentity'.");Cv[r.type]=r})(Av);const _ie=Ra("./orbitdb","identities"),Tie=async({keystore:r,path:e,storage:t,ipfs:n}={})=>{r=r||await QD({path:e||_ie}),t||(t=n?await pl(await Ns({size:1e3}),await o2({ipfs:n,pin:!0})):await O6());const i=await Ns({size:1e3}),s=async d=>{const h=await t.get(d);if(h)return xie(h)},o=async(d={})=>{d.keystore=r;const h=Iv("publickey"),m=await(d.provider||h({keystore:r}))();if(!Iv(m.type))throw new Error("Identity provider is unknown. Use useIdentityProvider(provider) to register the identity provider");const f=await m.getId(d),g=await r.getKey(f)||await r.createKey(f),v=r.getPublic(g),y=await xv(g,f),w=await m.signIdentity(v+y,d),E=await XD({id:f,publicKey:v,signatures:{id:y,publicKey:w},type:m.type,sign:c,verify:l});return await t.put(E.hash,E.bytes),E},a=async d=>{if(!Aie(d))return!1;const{id:h,publicKey:p,signatures:m}=d;if(!await l(m.id,p,h))return!1;const g=await i.get(m.id);if(g)return Cie(d,g);const y=await Iv(d.type).verifyIdentity(d);return y&&await i.put(m.id,d),y},c=async(d,h)=>{const p=await r.getKey(d.id);if(!p)throw new Error("Private signing key not found from KeyStore");return await xv(p,h)},l=async(d,h,p)=>await GD(d,h,p);return{createIdentity:o,verifyIdentity:a,getIdentity:s,sign:c,verify:l,keystore:r}},Pie=r=>{if(r=r.toString(),!r.startsWith("/orbitdb")&&!r.startsWith("\\orbitdb"))return!1;r=r.replaceAll("/orbitdb/",""),r=r.replaceAll("\\orbitdb\\",""),r=r.replaceAll("/",""),r=r.replaceAll("\\","");let e;try{e=Yi.parse(r,dn)}catch{return!1}return e!==void 0},e$=r=>{if(r&&r.protocol==="orbitdb"&&r.hash)return r;const e="orbitdb",t=r.replace("/orbitdb/","").replace("\\orbitdb\\","");return{protocol:e,hash:t,address:r,toString:()=>Ra("/",e,t)}},t$=Jf,r$=n2,Die=dn,$ie=async({ipfs:r,storage:e}={})=>(e=e||await pl(await Ns({size:1e5}),await o2({ipfs:r,pin:!0})),{get:async s=>{const o=await e.get(s),{value:a}=await Vg({bytes:o,codec:t$,hasher:r$});return a&&await e.put(s,o),a},create:async({name:s,type:o,accessController:a,meta:c})=>{if(!s)throw new Error("name is required");if(!o)throw new Error("type is required");if(!a)throw new Error("accessController is required");const l=Object.assign({name:s,type:o,accessController:a},c!==void 0?{meta:c}:{}),{cid:d,bytes:h}=await sd({value:l,codec:t$,hasher:r$}),p=d.toString(Die);return await e.put(p,h),{hash:p,manifest:l}},close:async()=>{await e.close()}}),n$=async(r=32)=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="",n=0;for(;n<r;)t+=e.charAt(Math.floor(Math.random()*e.length)),n+=1;return t},i$=Jf,s$=n2,Nie=dn,Mie=async({storage:r,type:e,params:t})=>{const n={type:e,...t},{cid:i,bytes:s}=await sd({value:n,codec:i$,hasher:s$}),o=i.toString(Nie);return await r.put(o,s),o},hy="ipfs",fy=({write:r,storage:e}={})=>async({orbitdb:t,identities:n,address:i})=>{if(e=e||await pl(await Ns({size:1e3}),await o2({ipfs:t.ipfs,pin:!0})),r=r||[t.identity.id],i){const o=await e.get(i.replaceAll("/ipfs/","")),{value:a}=await Vg({bytes:o,codec:i$,hasher:s$});r=a.write}else i=await Mie({storage:e,type:hy,params:{write:r}}),i=Ra("/",hy,i);return{type:hy,address:i,write:r,canAppend:async o=>{const a=await n.getIdentity(o.identity);if(!a)return!1;const{id:c}=a;return r.includes(c)||r.includes("*")?await n.verifyIdentity(a):!1}}};fy.type=hy;const o$="orbitdb",a$=({write:r}={})=>async({orbitdb:e,identities:t,address:n,name:i})=>{n=n||i||await n$(64),r=r||[e.identity.id];const s=await e.open(n,{type:"keyvalue",AccessController:fy({write:r})});n=s.address;const o=async f=>{const g=await t.getIdentity(f.identity);if(!g)return!1;const{id:v}=g;return await h("write",v)||await h("admin",v)?await t.verifyIdentity(g):!1},a=async()=>{const f=[];for await(const v of s.iterator())f[v.key]=v.value;const g=v=>{const y=v[0];f[y]=new Set([...f[y]||[],...v[1]])};return Object.entries({...f,admin:new Set([...f.admin||[],...s.access.write])}).forEach(g),f},c=async f=>(await a())[f]||new Set([]),l=async()=>{await s.close()},d=async()=>{await s.drop()},h=async(f,g)=>{const v=new Set(await c(f));return v.has(g)||v.has("*")};return{type:o$,address:n,write:r,canAppend:o,capabilities:a,get:c,grant:async(f,g)=>{const v=new Set([...await s.get(f)||[],g]);await s.put(f,Array.from(v.values()))},revoke:async(f,g)=>{const v=new Set(await s.get(f)||[]);v.delete(g),v.size>0?await s.put(f,Array.from(v.values())):await s.del(f)},close:l,drop:d,events:s.events}};a$.type=o$;const kv={},Oie=r=>{if(!kv[r])throw new Error(`AccessController type '${r}' is not supported`);return kv[r]},c$=r=>{if(!r.type)throw new Error("AccessController does not contain required field 'type'.");kv[r.type]=r};c$(fy),c$(a$);const Rie="events",Lie=fy,l$=async({ipfs:r,id:e,identity:t,identities:n,directory:i}={})=>{if(r==null)throw new Error("IPFS instance is a required argument.");e=e||await n$();const s=r.libp2p.peerId;i=i||"./orbitdb";let o;n?o=n.keystore:(o=await QD({path:Ra(i,"./keystore")}),n=await Tie({ipfs:r,keystore:o})),t?t.provider&&(t=await n.createIdentity({...t})):t=await n.createIdentity({id:e});const a=await $ie({ipfs:r});let c={};const l=async(p,{type:m,meta:f,sync:g,Database:v,AccessController:y,headsStorage:w,entryStorage:b,indexStorage:E,referencesCount:A}={})=>{let k,x,I;if(c[p])return c[p];if(Pie(p)){const L=e$(p);x=await a.get(L.hash);const z=x.accessController.split("/",2).pop();y=Oie(z)(),I=await y({orbitdb:{open:l,identity:t,ipfs:r},identities:n,address:x.accessController}),k=x.name,m=m||x.type,f=x.meta}else{m=m||Rie,y=y||Lie(),I=await y({orbitdb:{open:l,identity:t,ipfs:r},identities:n,name:p});const L=await a.create({name:p,type:m,accessController:I.address,meta:f});if(x=L.manifest,p=e$(L.hash),k=x.name,f=x.meta,c[p])return c[p]}if(v=v||_Z(m)(),!v)throw new Error(`Unsupported database type: '${m}'`);p=p.toString();const T=await v({ipfs:r,identity:t,address:p,name:k,access:I,directory:i,meta:f,syncAutomatically:g,headsStorage:w,entryStorage:b,indexStorage:E,referencesCount:A});return T.events.on("close",d(p)),c[p]=T,T},d=p=>()=>{delete c[p]};return{id:e,open:l,stop:async()=>{for(const p of Object.values(c))await p.close();o&&await o.close(),a&&await a.close(),c={}},ipfs:r,directory:i,keystore:o,identities:n,identity:t,peerId:s}};function pt(r){const e=new globalThis.AbortController;function t(){e.abort();for(const s of r)(s==null?void 0:s.removeEventListener)!=null&&s.removeEventListener("abort",t)}for(const s of r){if((s==null?void 0:s.aborted)===!0){t();break}(s==null?void 0:s.addEventListener)!=null&&s.addEventListener("abort",t)}function n(){for(const s of r)(s==null?void 0:s.removeEventListener)!=null&&s.removeEventListener("abort",t)}const i=e.signal;return i.clear=n,i}let Bie=class extends Error{constructor(t,n){super(t??"The operation was aborted");u(this,"type");u(this,"code");this.type="aborted",this.name="AbortError",this.code=n??"ABORT_ERR"}};async function Ti(r,e,t,n){const i=new Bie(n==null?void 0:n.errorMessage,n==null?void 0:n.errorCode);return(t==null?void 0:t.aborted)===!0?Promise.reject(i):new Promise((s,o)=>{function a(){t==null||t.removeEventListener("abort",d),r.removeEventListener(e,c),(n==null?void 0:n.errorEvent)!=null&&r.removeEventListener(n.errorEvent,l)}const c=h=>{var p;try{if(((p=n==null?void 0:n.filter)==null?void 0:p.call(n,h))===!1)return}catch(m){a(),o(m);return}a(),s(h)},l=h=>{a(),o(h.detail)},d=()=>{a(),o(i)};t==null||t.addEventListener("abort",d),r.addEventListener(e,c),(n==null?void 0:n.errorEvent)!=null&&r.addEventListener(n.errorEvent,l)})}class Uie extends Error{constructor(t="Rate limit exceeded",n){super(t);u(this,"remainingPoints");u(this,"msBeforeNext");u(this,"consumedPoints");u(this,"isFirstInDuration");this.name="RateLimitError",this.remainingPoints=n.remainingPoints,this.msBeforeNext=n.msBeforeNext,this.consumedPoints=n.consumedPoints,this.isFirstInDuration=n.isFirstInDuration}}class u$ extends Error{constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}u(u$,"name","QueueFullError");class Fie{constructor(e){u(this,"deferred");u(this,"signal");var t;this.signal=e,this.deferred=Le(),this.onAbort=this.onAbort.bind(this),(t=this.signal)==null||t.addEventListener("abort",this.onAbort)}onAbort(){var e;this.deferred.reject(((e=this.signal)==null?void 0:e.reason)??new _l)}cleanup(){var e;(e=this.signal)==null||e.removeEventListener("abort",this.onAbort)}}function zie(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}class Vie{constructor(e,t){u(this,"id");u(this,"fn");u(this,"options");u(this,"recipients");u(this,"status");u(this,"timeline");u(this,"controller");this.id=zie(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,n)=>{var i;return t&&((i=n.signal)==null?void 0:i.aborted)===!0},!0)&&(this.controller.abort(new _l),this.cleanup())}async join(e={}){var n;const t=new Fie(e.signal);return this.recipients.push(t),(n=e.signal)==null||n.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await ln(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{var t;e.cleanup(),(t=e.signal)==null||t.removeEventListener("abort",this.onAbort)})}}class Bl extends er{constructor(t={}){var n;super();u(this,"concurrency");u(this,"maxSize");u(this,"queue");u(this,"pending");u(this,"sort");this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.maxSize=t.maxSize??Number.POSITIVE_INFINITY,this.pending=0,t.metricName!=null&&((n=t.metrics)==null||n.registerMetricGroup(t.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})})),this.sort=t.sort,this.queue=[]}tryToStartAnother(){if(this.size===0)return queueMicrotask(()=>{this.safeDispatchEvent("empty")}),this.running===0&&queueMicrotask(()=>{this.safeDispatchEvent("idle")}),!1;if(this.pending<this.concurrency){let t;for(const n of this.queue)if(n.status==="queued"){t=n;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let n=0;n<this.queue.length;n++)if(this.queue[n]===t){this.queue.splice(n,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(t){this.queue.push(t),this.sort!=null&&this.queue.sort(this.sort)}async add(t,n){var s;if((s=n==null?void 0:n.signal)==null||s.throwIfAborted(),this.size===this.maxSize)throw new u$;const i=new Vie(t,n);return this.enqueue(i),this.safeDispatchEvent("add"),this.tryToStartAnother(),i.join(n).then(o=>(this.safeDispatchEvent("completed",{detail:o}),this.safeDispatchEvent("success",{detail:{job:i,result:o}}),o)).catch(o=>{if(i.status==="queued"){for(let a=0;a<this.queue.length;a++)if(this.queue[a]===i){this.queue.splice(a,1);break}}throw this.safeDispatchEvent("error",{detail:o}),this.safeDispatchEvent("failure",{detail:{job:i,error:o}}),o})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new _l)}),this.clear()}async onEmpty(t){this.size!==0&&await Ti(this,"empty",t==null?void 0:t.signal)}async onSizeLessThan(t,n){this.size<t||await Ti(this,"next",n==null?void 0:n.signal,{filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await Ti(this,"idle",t==null?void 0:t.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){var l,d,h;(l=t==null?void 0:t.signal)==null||l.throwIfAborted();const n=yo({objectMode:!0}),i=p=>{p!=null?this.abort():this.clear(),n.end(p)},s=p=>{p.detail!=null&&n.push(p.detail)},o=p=>{i(p.detail)},a=()=>{i()},c=()=>{i(new _l("Queue aborted"))};this.addEventListener("completed",s),this.addEventListener("error",o),this.addEventListener("idle",a),(d=t==null?void 0:t.signal)==null||d.addEventListener("abort",c);try{yield*n}finally{this.removeEventListener("completed",s),this.removeEventListener("error",o),this.removeEventListener("idle",a),(h=t==null?void 0:t.signal)==null||h.removeEventListener("abort",c),i()}}}class lc extends Bl{has(e){return this.find(e)!=null}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}const Kie=8,_v=1024*1024*4;let jie=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}},d$=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}},Hie=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}},h$=class extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}};function f$(r){return r[Symbol.asyncIterator]!=null}function p$(r,e){if(r.byteLength>e)throw new d$("Message length too long")}const py=r=>{const e=yt(r),t=In(e);return Sr(r,t),py.bytes=e,t};py.bytes=0;function Ld(r,e){e=e??{};const t=e.lengthEncoder??py,n=(e==null?void 0:e.maxDataLength)??_v;function*i(s){p$(s,n);const o=t(s.byteLength);o instanceof Uint8Array?yield o:yield*o,s instanceof Uint8Array?yield s:yield*s}return f$(r)?async function*(){for await(const s of r)yield*i(s)}():function*(){for(const s of r)yield*i(s)}()}Ld.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??py,n=(e==null?void 0:e.maxDataLength)??_v;return p$(r,n),new Be(t(r.byteLength),r)};var Ul;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(Ul||(Ul={}));const Tv=r=>{const e=Zi(r);return Tv.bytes=yt(e),e};Tv.bytes=0;function Bd(r,e){const t=new Be;let n=Ul.LENGTH,i=-1;const s=(e==null?void 0:e.lengthDecoder)??Tv,o=(e==null?void 0:e.maxLengthLength)??Kie,a=(e==null?void 0:e.maxDataLength)??_v;function*c(){for(;t.byteLength>0;){if(n===Ul.LENGTH)try{if(i=s(t),i<0)throw new jie("Invalid message length");if(i>a)throw new d$("Message length too long");const l=s.bytes;t.consume(l),(e==null?void 0:e.onLength)!=null&&e.onLength(i),n=Ul.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>o)throw new Hie("Message length length too long");break}throw l}if(n===Ul.DATA){if(t.byteLength<i)break;const l=t.sublist(0,i);t.consume(i),(e==null?void 0:e.onData)!=null&&e.onData(l),yield l,n=Ul.LENGTH}}}return f$(r)?async function*(){for await(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new h$("Unexpected end of input")}():function*(){for(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new h$("Unexpected end of input")}()}Bd.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:s,value:o}=await r.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return Bd(n,{...e??{},onLength:s=>{t=s}})};function Pv(r){const[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:i=>{n.push(i)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}function qie(r){return r[Symbol.asyncIterator]!=null}function Ud(r,e){let t=0;if(qie(r))return async function*(){for await(const c of r)yield e(c,t++)}();const n=Pv(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof o.then=="function")return async function*(){yield await o;for await(const c of n)yield e(c,t++)}();const a=e;return function*(){yield o;for(const c of n)yield a(c,t++)}()}function Wie(r){return r[Symbol.asyncIterator]!=null}function gy(r,e){return Wie(r)?async function*(){let t=0;if(!(e<1)){for await(const n of r)if(yield n,t++,t===e)return}}():function*(){let t=0;if(!(e<1)){for(const n of r)if(yield n,t++,t===e)return}}()}class _e extends Event{constructor(t,n){super(t);u(this,"type");u(this,"detail");this.type=t,this.detail=n}}const yy="/ipfs/bitswap/1.2.0",Gie=1024,Qie=1024,Yie=1024,Jie=5e3,Xie=10,Zie=50,ese=!1,tse=3,g$=1024*1024*4,rse=g$;var pr;(function(r){r.WantBlock="WantBlock",r.WantHave="WantHave"})(pr||(pr={}));var Dv;(function(r){r[r.WantBlock=0]="WantBlock",r[r.WantHave=1]="WantHave"})(Dv||(Dv={})),function(r){r.codec=()=>kn(Dv)}(pr||(pr={}));var P1;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.priority!=null&&t.priority!==0&&(n.uint32(16),n.int32(t.priority)),t.cancel!=null&&(n.uint32(24),n.bool(t.cancel)),t.wantType!=null&&(n.uint32(32),pr.codec().encode(t.wantType,n)),t.sendDontHave!=null&&(n.uint32(40),n.bool(t.sendDontHave)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={cid:Ge(0),priority:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.cid=t.bytes();break}case 2:{s.priority=t.int32();break}case 3:{s.cancel=t.bool();break}case 4:{s.wantType=pr.codec().decode(t);break}case 5:{s.sendDontHave=t.bool();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(P1||(P1={}));var my;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.entries!=null)for(const s of t.entries)n.uint32(10),P1.codec().encode(s,n);t.full!=null&&(n.uint32(16),n.bool(t.full)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={entries:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{if(((a=i.limits)==null?void 0:a.entries)!=null&&s.entries.length===i.limits.entries)throw new mt('Decode error - map field "entries" had too many elements');s.entries.push(P1.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.entries$}));break}case 2:{s.full=t.bool();break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(my||(my={}));var D1;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.prefix!=null&&t.prefix.byteLength>0&&(n.uint32(10),n.bytes(t.prefix)),t.data!=null&&t.data.byteLength>0&&(n.uint32(18),n.bytes(t.data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={prefix:Ge(0),data:Ge(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.prefix=t.bytes();break}case 2:{s.data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(D1||(D1={}));var Fs;(function(r){r.HaveBlock="HaveBlock",r.DoNotHaveBlock="DoNotHaveBlock"})(Fs||(Fs={}));var wy;(function(r){r[r.HaveBlock=0]="HaveBlock",r[r.DoNotHaveBlock=1]="DoNotHaveBlock"})(wy||(wy={})),function(r){r.codec=()=>kn(wy)}(Fs||(Fs={}));var $1;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.type!=null&&wy[t.type]!==0&&(n.uint32(16),Fs.codec().encode(t.type,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={cid:Ge(0),type:Fs.HaveBlock},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.cid=t.bytes();break}case 2:{s.type=Fs.codec().decode(t);break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})($1||($1={}));var N1;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.wantlist!=null&&(n.uint32(10),my.codec().encode(t.wantlist,n)),t.blocks!=null)for(const s of t.blocks)n.uint32(26),D1.codec().encode(s,n);if(t.blockPresences!=null)for(const s of t.blockPresences)n.uint32(34),$1.codec().encode(s,n);t.pendingBytes!=null&&t.pendingBytes!==0&&(n.uint32(40),n.int32(t.pendingBytes)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,d,h;const s={blocks:[],blockPresences:[],pendingBytes:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const p=t.uint32();switch(p>>>3){case 1:{s.wantlist=my.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.wantlist});break}case 3:{if(((c=i.limits)==null?void 0:c.blocks)!=null&&s.blocks.length===i.limits.blocks)throw new mt('Decode error - map field "blocks" had too many elements');s.blocks.push(D1.codec().decode(t,t.uint32(),{limits:(l=i.limits)==null?void 0:l.blocks$}));break}case 4:{if(((d=i.limits)==null?void 0:d.blockPresences)!=null&&s.blockPresences.length===i.limits.blockPresences)throw new mt('Decode error - map field "blockPresences" had too many elements');s.blockPresences.push($1.codec().decode(t,t.uint32(),{limits:(h=i.limits)==null?void 0:h.blockPresences$}));break}case 5:{s.pendingBytes=t.int32();break}default:{t.skipType(p&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(N1||(N1={}));function nse(r,e){for(const[t,n]of e.wantlist.entries()){const i=r.wantlist.get(t);i!=null&&(i.priority>n.priority&&(n.priority=i.priority),n.cancel=n.cancel??i.cancel,n.wantType=n.wantType??i.wantType,n.sendDontHave=n.sendDontHave??i.sendDontHave),r.wantlist.set(t,n)}for(const[t,n]of e.blockPresences.entries())r.blockPresences.set(t,n);for(const[t,n]of e.blocks.entries())r.blocks.set(t,n);return e.full&&!r.full&&(r.full=!0),r}class y$ extends Error{constructor(e="Block too large"){super(e),this.name="BlockTooLargeError"}}u(y$,"name","BlockTooLargeError");const ise=4193648+16;function*sse(r,e){const t=[...r.wantlist.values()],n=[...r.blockPresences.values()],i=[...r.blocks.values()];let s=0,o=0,a=0,c=!1;for(;;){const l={wantlist:{full:r.full??!1,entries:[]},blockPresences:[],blocks:[],pendingBytes:0};let d=N1.encode(l).byteLength,{added:h,hasMore:p,newSize:m}=$v(i,l.blocks,a,e,d,ose);a+=h,d=m;const f=p;({added:h,hasMore:p,newSize:m}=$v(n,l.blockPresences,o,e,d,ase)),o+=h,d=m;const g=p;if({added:h,hasMore:p,newSize:m}=$v(t,l.wantlist.entries,s,e,d,cse),s+=h,d=m,c=!f&&!g&&!p,c||(l.wantlist.full=!1),yield N1.encode(l),c)break}}function $v(r,e,t,n,i,s){let o=0,a=!1;for(let c=t;c<r.length;c++){const l=r[c],d=s(l);if(d>ise)throw new y$("Cannot send block as after encoding it is over the max message size");const h=i+d;if(h>n){a=!0;break}e.push(l),o++,i=h}return{hasMore:a,added:o,newSize:i}}function ose(r){return Nv(3,D1.encode(r))}function ase(r){return Nv(4,$1.encode(r))}function cse(r){return Nv(1,P1.encode(r))}function Nv(r,e){const t=yt(r),n=yt(e.byteLength);return t+n+e.byteLength}let lse=class extends er{constructor(t,n={}){var i,s;super();u(this,"log");u(this,"libp2p");u(this,"routing");u(this,"protocols");u(this,"running");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"messageReceiveTimeout");u(this,"registrarIds");u(this,"metrics");u(this,"sendQueue");u(this,"runOnLimitedConnections");u(this,"maxOutgoingMessageSize");u(this,"maxIncomingMessageSize");this.log=t.logger.forComponent("helia:bitswap:network"),this.libp2p=t.libp2p,this.routing=t.routing,this.protocols=n.protocols??[yy],this.registrarIds=[],this.running=!1,this._onStream=this._onStream.bind(this),this.maxInboundStreams=n.maxInboundStreams??Qie,this.maxOutboundStreams=n.maxOutboundStreams??Yie,this.messageReceiveTimeout=n.messageReceiveTimeout??Jie,this.runOnLimitedConnections=n.runOnLimitedConnections??ese,this.maxIncomingMessageSize=n.maxIncomingMessageSize??g$,this.maxOutgoingMessageSize=n.maxOutgoingMessageSize??n.maxIncomingMessageSize??rse,this.metrics={blocksSent:(i=t.metrics)==null?void 0:i.registerCounter("helia_bitswap_sent_blocks_total"),dataSent:(s=t.metrics)==null?void 0:s.registerCounter("helia_bitswap_sent_data_bytes_total")},this.sendQueue=new lc({concurrency:n.messageSendConcurrency??Zie,metrics:t.metrics,metricName:"helia_bitswap_message_send_queue"}),this.sendQueue.addEventListener("error",o=>{this.log.error("error sending wantlist to peer",o.detail)})}async start(){if(this.running)return;this.running=!0,await this.libp2p.handle(this.protocols,this._onStream,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnections});const t={onConnect:n=>{this.safeDispatchEvent("peer:connected",{detail:n})},onDisconnect:n=>{this.safeDispatchEvent("peer:disconnected",{detail:n})}};this.registrarIds=[];for(const n of this.protocols)this.registrarIds.push(await this.libp2p.register(n,t));this.libp2p.getConnections().forEach(n=>{this.safeDispatchEvent("peer:connected",{detail:n.remotePeer})})}async stop(){if(this.running=!1,await this.libp2p.unhandle(this.protocols),this.registrarIds!=null){for(const t of this.registrarIds)this.libp2p.unregister(t);this.registrarIds=[]}}_onStream(t){if(!this.running)return;const{stream:n,connection:i}=t;Promise.resolve().then(async()=>{this.log("incoming new bitswap %s stream from %p",n.protocol,i.remotePeer);const s=()=>{n.status==="open"?n.abort(new f1(`Incoming Bitswap stream timed out after ${this.messageReceiveTimeout}ms`)):this.log("stream aborted with status %s",n.status)};let o=AbortSignal.timeout(this.messageReceiveTimeout);o.addEventListener("abort",s),await n.closeWrite(),await un(n,a=>Bd(a,{maxDataLength:this.maxIncomingMessageSize}),async a=>{for await(const c of a)try{const l=N1.decode(c);this.log("incoming new bitswap %s message from %p on stream",n.protocol,i.remotePeer,n.id),this.safeDispatchEvent("bitswap:message",{detail:{peer:i.remotePeer,message:l}}),o.removeEventListener("abort",s),o=AbortSignal.timeout(this.messageReceiveTimeout),o.addEventListener("abort",s)}catch(l){this.log.error("error reading incoming bitswap message from %p on stream",i.remotePeer,n.id,l),n.abort(l);break}})}).catch(s=>{this.log.error("error handling incoming stream from %p",i.remotePeer,s),n.abort(s)})}async*findProviders(t,n){var i;(i=n==null?void 0:n.onProgress)==null||i.call(n,new _e("bitswap:network:find-providers",t));for await(const s of this.routing.findProviders(t,n))await this.libp2p.isDialable(s.multiaddrs,{runOnLimitedConnection:this.runOnLimitedConnections})&&(yield s)}async findAndConnect(t,n){await Eo(Ud(gy(this.findProviders(t,n),(n==null?void 0:n.maxProviders)??tse),async i=>this.connectTo(i.id,n))).catch(i=>{this.log.error(i)})}async sendMessage(t,n,i){if(!this.running)throw new Error("network isn't running");const s=this.sendQueue.queue.find(o=>t.equals(o.options.peerId)&&o.status==="queued");if(s!=null){s.options.message=nse(s.options.message,n),await s.join({signal:i==null?void 0:i.signal});return}await this.sendQueue.add(async o=>{var l,d;const a=o==null?void 0:o.message;if(a==null)throw new Z("No message to send");this.log("sendMessage to %p",t),(l=o==null?void 0:o.onProgress)==null||l.call(o,new _e("bitswap:network:send-wantlist",t));const c=await this.libp2p.dialProtocol(t,yy,o);await c.closeRead();try{await un(sse(a,this.maxOutgoingMessageSize),h=>Ld(h),c),await c.close(o)}catch(h){(d=o==null?void 0:o.onProgress)==null||d.call(o,new _e("bitswap:network:send-wantlist:error",{peer:t,error:h})),this.log.error("error sending message to %p",t,h),c.abort(h)}this._updateSentStats(a.blocks)},{peerId:t,signal:i==null?void 0:i.signal,message:n})}async connectTo(t,n){var s;if(!this.running)throw new Pl("Network isn't running");(s=n==null?void 0:n.onProgress)==null||s.call(n,new _e("bitswap:network:dial",t));const[i]=await Promise.all([this.libp2p.dial(t,n),Ti(this.libp2p,"peer:identify",n==null?void 0:n.signal,{filter:o=>{if(!o.detail.peerId.equals(t))return!1;if(o.detail.protocols.includes(yy))return!0;throw new h1(`${t} did not support ${yy}`)}})]);return i}_updateSentStats(t){var i,s;let n=0;for(const o of t.values())n+=o.data.byteLength;(i=this.metrics.dataSent)==null||i.increment(n),(s=this.metrics.blocksSent)==null||s.increment(t.size)}};function use(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function by(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function dse(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var hse=dse,fse=hse;let pse=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},gse=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return m$(this,e)}},yse=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return m$(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function m$(r,e){return new yse({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let mse=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new pse(e,t,n),this.decoder=new gse(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function w$({name:r,prefix:e,encode:t,decode:n}){return new mse(r,e,t,n)}function vy({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=fse(t,r);return w$({prefix:e,name:r,encode:n,decode:s=>by(i(s))})}function wse(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function bse(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Mo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return w$({prefix:e,name:r,encode(i){return bse(i,n,t)},decode(i){return wse(i,n,t,r)}})}const zs=vy({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});vy({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const Ey=Mo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Mo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Mo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Mo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Mo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Mo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Mo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Mo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Mo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Mv=vy({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});vy({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var vse=v$,b$=128,Ese=-128,Sse=Math.pow(2,31);function v$(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Sse;)e[t++]=r&255|b$,r/=128;for(;r&Ese;)e[t++]=r&255|b$,r>>>=7;return e[t]=r|0,v$.bytes=t-n+1,e}var xse=Ov,Ase=128,E$=127;function Ov(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Ov.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&E$)<<i:(o&E$)*Math.pow(2,i),i+=7}while(o>=Ase);return Ov.bytes=s-n,t}var Cse=Math.pow(2,7),Ise=Math.pow(2,14),kse=Math.pow(2,21),_se=Math.pow(2,28),Tse=Math.pow(2,35),Pse=Math.pow(2,42),Dse=Math.pow(2,49),$se=Math.pow(2,56),Nse=Math.pow(2,63),Mse=function(r){return r<Cse?1:r<Ise?2:r<kse?3:r<_se?4:r<Tse?5:r<Pse?6:r<Dse?7:r<$se?8:r<Nse?9:10},Ose={encode:vse,decode:xse,encodingLength:Mse},Sy=Ose;function Rv(r,e=0){return[Sy.decode(r,e),Sy.decode.bytes]}function xy(r,e,t=0){return Sy.encode(r,e,t),e}function Ay(r){return Sy.encodingLength(r)}function Cy(r,e){const t=e.byteLength,n=Ay(r),i=n+Ay(t),s=new Uint8Array(i+t);return xy(r,s,0),xy(t,s,n),s.set(e,i),new Lv(r,t,e,s)}function S$(r){const e=by(r),[t,n]=Rv(e),[i,s]=Rv(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Lv(t,i,o,e)}function Rse(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&use(r.bytes,t.bytes)}}let Lv=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function x$(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Bse(t,Bv(r),e??zs.encoder);default:return Use(t,Bv(r),e??Ey.encoder)}}const A$=new WeakMap;function Bv(r){const e=A$.get(r);if(e==null){const t=new Map;return A$.set(r,t),t}return e}let Uv=class Wr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,xj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==M1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Fse)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Wr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Cy(e,t);return Wr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Wr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Rse(e.multihash,n.multihash)}toString(e){return x$(this,e)}toJSON(){return{"/":x$(this)}}link(){return this}[(xj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Wr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Wr(n,i,s,o??C$(n,i,s.bytes))}else if(t[zse]===!0){const{version:n,multihash:i,code:s}=t,o=S$(i);return Wr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==M1)throw new Error(`Version 0 CID must use dag-pb (code: ${M1}) block encoding`);return new Wr(e,t,n,n.bytes)}case 1:{const i=C$(e,t,n.bytes);return new Wr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Wr.create(0,M1,e)}static createV1(e,t){return Wr.create(1,e,t)}static decode(e){const[t,n]=Wr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Wr.inspectBytes(e),n=t.size-t.multihashSize,i=by(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new Lv(t.multihashCode,t.digestSize,s,i);return[t.version===0?Wr.createV0(o):Wr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=Rv(e.subarray(t));return t+=p,h};let i=n(),s=M1;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Lse(e,t),s=Wr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Bv(s).set(n,e),s}};function Lse(r,e){switch(r[0]){case"Q":{const t=e??zs;return[zs.prefix,t.decode(`${zs.prefix}${r}`)]}case zs.prefix:{const t=e??zs;return[zs.prefix,t.decode(r)]}case Ey.prefix:{const t=e??Ey;return[Ey.prefix,t.decode(r)]}case Mv.prefix:{const t=e??Mv;return[Mv.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Bse(r,e,t){const{prefix:n}=t;if(n!==zs.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Use(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const M1=112,Fse=18;function C$(r,e,t){const n=Ay(r),i=n+Ay(e),s=new Uint8Array(i+t.byteLength);return xy(r,s,0),xy(e,s,n),s.set(t,i),s}const zse=Symbol.for("@ipld/js-cid/CID"),I$=0,Vse="identity",k$=by;function Kse(r){return Cy(I$,k$(r))}const _$={code:I$,name:Vse,encode:k$,digest:Kse};function jse({name:r,code:e,encode:t}){return new Hse(r,e,t)}let Hse=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Cy(this.code,t):t.then(n=>Cy(this.code,n))}else throw Error("Unknown type, must be binary type")}};function qse(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const Wse=jse({name:"sha2-256",code:18,encode:qse("SHA-256")}),T$=Symbol.for("nodejs.util.inspect.custom"),Gse=114;class Fv{constructor(e){u(this,"type");u(this,"multihash");u(this,"publicKey");u(this,"string");u(this,Aj,!0);this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=zs.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return Uv.createV1(Gse,this.multihash)}toJSON(){return this.toString()}equals(e){var t;if(e==null)return!1;if(e instanceof Uint8Array)return qe(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(((t=e==null?void 0:e.toMultihash())==null?void 0:t.bytes)!=null)return qe(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[(Aj=wb,T$)](){return`PeerId(${this.toString()})`}}class P$ extends Fv{constructor(t){super({...t,type:"RSA"});u(this,"type","RSA");u(this,"publicKey");this.publicKey=t.publicKey}}class D$ extends Fv{constructor(t){super({...t,type:"Ed25519"});u(this,"type","Ed25519");u(this,"publicKey");this.publicKey=t.publicKey}}class $$ extends Fv{constructor(t){super({...t,type:"secp256k1"});u(this,"type","secp256k1");u(this,"publicKey");this.publicKey=t.publicKey}}const Qse=2336;class N${constructor(e){u(this,"type","url");u(this,"multihash");u(this,"publicKey");u(this,"url");u(this,Cj,!0);this.url=e.toString(),this.multihash=_$.digest(se(this.url))}[(Ij=T$,Cj=wb,Ij)](){return`PeerId(${this.url})`}toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return Uv.createV1(Qse,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=re(e)),e.toString()===this.toString())}}const Yse=114,M$=2336;function tr(r,e){let t;if(r.charAt(0)==="1"||r.charAt(0)==="Q")t=S$(zs.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return zd(Uv.parse(r));throw new Z('Please pass a multibase decoder for strings that do not start with "1" or "Q"')}return ti(t)}function Fd(r){if(r.type==="Ed25519")return new D$({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new $$({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new P$({multihash:r.toCID().multihash,publicKey:r});throw new Dl}function Jse(r){return Fd(r.publicKey)}function ti(r){if(Zse(r))return new P$({multihash:r});if(Xse(r))try{const e=qD(r);if(e.type==="Ed25519")return new D$({multihash:r,publicKey:e});if(e.type==="secp256k1")return new $$({multihash:r,publicKey:e})}catch{const t=re(r.digest);return new N$(new URL(t))}throw new $2("Supplied PeerID Multihash is invalid")}function zd(r){if((r==null?void 0:r.multihash)==null||r.version==null||r.version===1&&r.code!==Yse&&r.code!==M$)throw new oP("Supplied PeerID CID is invalid");if(r.code===M$){const e=re(r.multihash.digest);return new N$(new URL(e))}return ti(r.multihash)}function Xse(r){return r.code===_$.code}function Zse(r){return r.code===Wse.code}function O$(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function eoe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var toe=eoe,roe=toe;let noe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ioe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return R$(this,e)}},soe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return R$(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function R$(r,e){return new soe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let ooe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new noe(e,t,n),this.decoder=new ioe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function aoe({name:r,prefix:e,encode:t,decode:n}){return new ooe(r,e,t,n)}function L$({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=roe(t,r);return aoe({prefix:e,name:r,encode:n,decode:s=>O$(i(s))})}const coe=L$({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});L$({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var loe=U$,B$=128,uoe=-128,doe=Math.pow(2,31);function U$(r,e,t){e=e||[],t=t||0;for(var n=t;r>=doe;)e[t++]=r&255|B$,r/=128;for(;r&uoe;)e[t++]=r&255|B$,r>>>=7;return e[t]=r|0,U$.bytes=t-n+1,e}var hoe=zv,foe=128,F$=127;function zv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw zv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&F$)<<i:(o&F$)*Math.pow(2,i),i+=7}while(o>=foe);return zv.bytes=s-n,t}var poe=Math.pow(2,7),goe=Math.pow(2,14),yoe=Math.pow(2,21),moe=Math.pow(2,28),woe=Math.pow(2,35),boe=Math.pow(2,42),voe=Math.pow(2,49),Eoe=Math.pow(2,56),Soe=Math.pow(2,63),xoe=function(r){return r<poe?1:r<goe?2:r<yoe?3:r<moe?4:r<woe?5:r<boe?6:r<voe?7:r<Eoe?8:r<Soe?9:10},Aoe={encode:loe,decode:hoe,encodingLength:xoe},z$=Aoe;function V$(r,e=0){return[z$.decode(r,e),z$.decode.bytes]}function Coe(r){const e=O$(r),[t,n]=V$(e),[i,s]=V$(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Ioe(t,i,o,e)}let Ioe=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function O1(r,e){const t={[Symbol.iterator]:()=>t,next:()=>{const n=r.next(),i=n.value;return n.done===!0||i==null?{done:!0,value:void 0}:{done:!1,value:e(i)}}};return t}function Vv(r){const e=Coe(coe.decode(`z${r}`));return ti(e)}class uc{constructor(e){u(this,"map");if(this.map=new Map,e!=null)for(const[t,n]of e.entries())this.map.set(t.toString(),{key:t,value:n})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return O1(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,n)=>{e(t.value,t.key,this)})}get(e){var t;return(t=this.map.get(e.toString()))==null?void 0:t.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return O1(this.map.values(),e=>e.key)}values(){return O1(this.map.values(),e=>e.value)}get size(){return this.map.size}}class ts{constructor(e){u(this,"set");if(this.set=new Set,e!=null)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return O1(this.set.entries(),e=>{const t=Vv(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{const n=Vv(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return O1(this.set.values(),e=>Vv(e))}intersection(e){const t=new ts;for(const n of e)this.has(n)&&t.add(n);return t}difference(e){const t=new ts;for(const n of this)e.has(n)||t.add(n);return t}union(e){const t=new ts;for(const n of e)t.add(n);for(const n of this)t.add(n);return t}}function koe(){return new ts}class K$ extends ED{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,oy(e);const n=_1(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Rs(s)}update(e){return ay(this),this.iHash.update(e),this}digestInto(e){ay(this),I1(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Iy=(r,e,t)=>new K$(r,e).update(t).digest();Iy.create=(r,e)=>new K$(r,e);function j$(r,e,t,n){oy(r);const i=une({dkLen:32,asyncTick:10},n),{c:s,dkLen:o,asyncTick:a}=i;if(Md(s),Md(o),Md(a),s<1)throw new Error("iterations (c) should be >= 1");const c=vD(e),l=vD(t),d=new Uint8Array(o),h=Iy.create(r,c),p=h._cloneInto().update(l);return{c:s,dkLen:o,asyncTick:a,DK:d,PRF:h,PRFSalt:p}}function H$(r,e,t,n,i){return r.destroy(),e.destroy(),n&&n.destroy(),Rs(i),t}function _oe(r,e,t,n){const{c:i,dkLen:s,DK:o,PRF:a,PRFSalt:c}=j$(r,e,t,n);let l;const d=new Uint8Array(4),h=k1(d),p=new Uint8Array(a.outputLen);for(let m=1,f=0;f<s;m++,f+=a.outputLen){const g=o.subarray(f,f+a.outputLen);h.setInt32(0,m,!1),(l=c._cloneInto(l)).update(d).digestInto(p),g.set(p.subarray(0,g.length));for(let v=1;v<i;v++){a._cloneInto(l).update(p).digestInto(p);for(let y=0;y<g.length;y++)g[y]^=p[y]}}return H$(a,c,o,l,p)}async function q$(r,e,t,n){const{c:i,dkLen:s,asyncTick:o,DK:a,PRF:c,PRFSalt:l}=j$(r,e,t,n);let d;const h=new Uint8Array(4),p=k1(h),m=new Uint8Array(c.outputLen);for(let f=1,g=0;g<s;f++,g+=c.outputLen){const v=a.subarray(g,g+c.outputLen);p.setInt32(0,f,!1),(d=l._cloneInto(d)).update(h).digestInto(m),v.set(m.subarray(0,v.length)),await lne(i-1,o,()=>{c._cloneInto(d).update(m).digestInto(m);for(let y=0;y<v.length;y++)v[y]^=m[y]})}return H$(c,l,a,d,m)}const R1=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),dc=new Uint32Array(80);class Toe extends gv{constructor(){super(64,20,8,!1),this.A=R1[0]|0,this.B=R1[1]|0,this.C=R1[2]|0,this.D=R1[3]|0,this.E=R1[4]|0}get(){const{A:e,B:t,C:n,D:i,E:s}=this;return[e,t,n,i,s]}set(e,t,n,i,s){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0}process(e,t){for(let c=0;c<16;c++,t+=4)dc[c]=e.getUint32(t,!1);for(let c=16;c<80;c++)dc[c]=fv(dc[c-3]^dc[c-8]^dc[c-14]^dc[c-16],1);let{A:n,B:i,C:s,D:o,E:a}=this;for(let c=0;c<80;c++){let l,d;c<20?(l=AD(i,s,o),d=1518500249):c<40?(l=i^s^o,d=1859775393):c<60?(l=CD(i,s,o),d=2400959708):(l=i^s^o,d=3395469782);const h=fv(n,5)+l+a+d+dc[c]|0;a=o,o=s,s=fv(i,30),i=n,n=h}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,this.set(n,i,s,o,a)}roundClean(){Rs(dc)}destroy(){this.set(0,0,0,0,0),Rs(this.buffer)}}const Poe=pv(()=>new Toe),Kv=_ne,Doe=Xn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Xn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Xn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Xn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const W$={sha1:Poe,"sha2-256":Ll,"sha2-512":Kv};function G$(r,e,t,n,i){if(i!=="sha1"&&i!=="sha2-256"&&i!=="sha2-512"){const a=Object.keys(W$).join(" / ");throw new Z(`Hash '${i}' is unknown or not supported. Must be ${a}`)}const s=W$[i],o=_oe(s,r,e,{c:t,dkLen:n});return Doe.encode(o).substring(1)}const jv={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},Q$={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},Y$=new globalThis.TextEncoder;function $oe(r,e){const t=jv[e];let n=Q$[e];for(let i=0;i<r.length;i++)n^=BigInt(r[i]),n=BigInt.asUintN(e,n*t);return n}function Noe(r,e,t){if(t.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");const n=jv[e];let i=Q$[e],s=r;for(;s.length>0;){const o=Y$.encodeInto(s,t);s=s.slice(o.read);for(let a=0;a<o.written;a++)i^=BigInt(t[a]),i=BigInt.asUintN(e,i*n)}return i}function Moe(r,{size:e=32,utf8Buffer:t}={}){if(!jv[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof r=="string"){if(t)return Noe(r,e,t);r=Y$.encode(r)}return $oe(r,e)}const Hv={hash:r=>Number(Moe(r,{size:32})),hashV:(r,e)=>Ooe(Hv.hash(r,e))};function Ooe(r){let e=r.toString(16);return e.length%2===1&&(e=`0${e}`),se(e,"base16")}const J$=64;class Fl{constructor(e,t,n,i=2){u(this,"fp");u(this,"h");u(this,"seed");if(i>J$)throw new TypeError("Invalid Fingerprint Size");const s=t.hashV(e,n),o=Ge(i);for(let a=0;a<o.length;a++)o[a]=s[a];o.length===0&&(o[0]=7),this.fp=o,this.h=t,this.seed=n}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return(e==null?void 0:e.fp)instanceof Uint8Array?qe(this.fp,e.fp):!1}}function ky(r,e){return Math.floor(Math.random()*(e-r))+r}class _y{constructor(e){u(this,"contents");this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof Fl))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof Fl))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof Fl))throw new TypeError("Invalid Fingerprint");const t=ky(0,this.contents.length-1),n=this.contents[t];return this.contents[t]=e,n}remove(e){if(!(e instanceof Fl))throw new TypeError("Invalid Fingerprint");const t=this.contents.findIndex(n=>e.equals(n));return t>-1?(this.contents[t]=null,!0):!1}}const Roe=500;class X${constructor(e){u(this,"bucketSize");u(this,"filterSize");u(this,"fingerprintSize");u(this,"buckets");u(this,"count");u(this,"hash");u(this,"seed");this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??Hv,this.seed=e.seed??ky(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=se(e));const t=new Fl(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=(n^t.hash())%this.filterSize;if(this.buckets[n]==null&&(this.buckets[n]=new _y(this.bucketSize)),this.buckets[i]==null&&(this.buckets[i]=new _y(this.bucketSize)),this.buckets[n].add(t)||this.buckets[i].add(t))return this.count++,!0;const s=[n,i];let o=s[ky(0,s.length-1)];this.buckets[o]==null&&(this.buckets[o]=new _y(this.bucketSize));for(let a=0;a<Roe;a++){const c=this.buckets[o].swap(t);if(c!=null&&(o=(o^c.hash())%this.filterSize,this.buckets[o]==null&&(this.buckets[o]=new _y(this.bucketSize)),this.buckets[o].add(c)))return this.count++,!0}return!1}has(e){var o,a;typeof e=="string"&&(e=se(e));const t=new Fl(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=((o=this.buckets[n])==null?void 0:o.has(t))??!1;if(i)return i;const s=(n^t.hash())%this.filterSize;return((a=this.buckets[s])==null?void 0:a.has(t))??!1}remove(e){var a,c;typeof e=="string"&&(e=se(e));const t=new Fl(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=((a=this.buckets[n])==null?void 0:a.remove(t))??!1;if(i)return this.count--,i;const s=(n^t.hash())%this.filterSize,o=((c=this.buckets[s])==null?void 0:c.remove(t))??!1;return o&&this.count--,o}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}}const Loe={1:.5,2:.84,4:.95,8:.98};function Boe(r=.001){return r>.002?2:r>1e-5?4:8}function Uoe(r,e=.001){const t=Boe(e),n=Loe[t],i=Math.round(r/n),s=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),J$);return{filterSize:i,bucketSize:t,fingerprintSize:s}}class Foe{constructor(e){u(this,"filterSize");u(this,"bucketSize");u(this,"fingerprintSize");u(this,"scale");u(this,"filterSeries");u(this,"hash");u(this,"seed");this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??Hv,this.seed=e.seed??ky(0,Math.pow(2,10)),this.filterSeries=[new X$({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=se(e)),this.has(e))return!0;let t=this.filterSeries.find(n=>n.reliable);if(t==null){const n=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new X$({filterSize:n,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=se(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=se(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}function zl(r,e=.001,t){return new Foe({...Uoe(r,e)})}class zoe{constructor(e,t){u(this,"filter");this.filter=zl(e,t)}has(e){return this.filter.has(e.toMultihash().bytes)}add(e){this.filter.add(e.toMultihash().bytes)}remove(e){var t,n;(n=(t=this.filter).remove)==null||n.call(t,e.toMultihash().bytes)}}function Voe(r,e=.001){return new zoe(r,e)}class Koe extends uc{constructor(t){super();u(this,"metric");const{name:n,metrics:i}=t;this.metric=i.registerMetric(n),this.updateComponentMetric()}set(t,n){return super.set(t,n),this.updateComponentMetric(),this}delete(t){const n=super.delete(t);return this.updateComponentMetric(),n}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function Z$(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new Koe({name:e,metrics:t}):n=new uc,n}function joe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function qv(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Hoe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var qoe=Hoe,Woe=qoe;let Goe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Qoe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return eN(this,e)}},Yoe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return eN(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function eN(r,e){return new Yoe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Joe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Goe(e,t,n),this.decoder=new Qoe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function tN({name:r,prefix:e,encode:t,decode:n}){return new Joe(r,e,t,n)}function Ty({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Woe(t,r);return tN({prefix:e,name:r,encode:n,decode:s=>qv(i(s))})}function Xoe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Zoe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function ri({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return tN({prefix:e,name:r,encode(i){return Zoe(i,n,t)},decode(i){return Xoe(i,n,t,r)}})}const Py=ri({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ri({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ri({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ri({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ri({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ri({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ri({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ri({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ri({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Wv=Ty({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Ty({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const hc=Ty({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Ty({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var eae=nN,rN=128,tae=-128,rae=Math.pow(2,31);function nN(r,e,t){e=e||[],t=t||0;for(var n=t;r>=rae;)e[t++]=r&255|rN,r/=128;for(;r&tae;)e[t++]=r&255|rN,r>>>=7;return e[t]=r|0,nN.bytes=t-n+1,e}var nae=Gv,iae=128,iN=127;function Gv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Gv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&iN)<<i:(o&iN)*Math.pow(2,i),i+=7}while(o>=iae);return Gv.bytes=s-n,t}var sae=Math.pow(2,7),oae=Math.pow(2,14),aae=Math.pow(2,21),cae=Math.pow(2,28),lae=Math.pow(2,35),uae=Math.pow(2,42),dae=Math.pow(2,49),hae=Math.pow(2,56),fae=Math.pow(2,63),pae=function(r){return r<sae?1:r<oae?2:r<aae?3:r<cae?4:r<lae?5:r<uae?6:r<dae?7:r<hae?8:r<fae?9:10},gae={encode:eae,decode:nae,encodingLength:pae},Dy=gae;function Qv(r,e=0){return[Dy.decode(r,e),Dy.decode.bytes]}function $y(r,e,t=0){return Dy.encode(r,e,t),e}function Ny(r){return Dy.encodingLength(r)}function Yv(r,e){const t=e.byteLength,n=Ny(r),i=n+Ny(t),s=new Uint8Array(i+t);return $y(r,s,0),$y(t,s,n),s.set(e,i),new Jv(r,t,e,s)}function yae(r){const e=qv(r),[t,n]=Qv(e),[i,s]=Qv(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Jv(t,i,o,e)}function mae(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&joe(r.bytes,t.bytes)}}let Jv=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function sN(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return bae(t,Xv(r),e??hc.encoder);default:return vae(t,Xv(r),e??Py.encoder)}}const oN=new WeakMap;function Xv(r){const e=oN.get(r);if(e==null){const t=new Map;return oN.set(r,t),t}return e}let Zv=class Gr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,kj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==L1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Eae)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Gr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Yv(e,t);return Gr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Gr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&mae(e.multihash,n.multihash)}toString(e){return sN(this,e)}toJSON(){return{"/":sN(this)}}link(){return this}[(kj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Gr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Gr(n,i,s,o??aN(n,i,s.bytes))}else if(t[Sae]===!0){const{version:n,multihash:i,code:s}=t,o=yae(i);return Gr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==L1)throw new Error(`Version 0 CID must use dag-pb (code: ${L1}) block encoding`);return new Gr(e,t,n,n.bytes)}case 1:{const i=aN(e,t,n.bytes);return new Gr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Gr.create(0,L1,e)}static createV1(e,t){return Gr.create(1,e,t)}static decode(e){const[t,n]=Gr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Gr.inspectBytes(e),n=t.size-t.multihashSize,i=qv(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new Jv(t.multihashCode,t.digestSize,s,i);return[t.version===0?Gr.createV0(o):Gr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=Qv(e.subarray(t));return t+=p,h};let i=n(),s=L1;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=wae(e,t),s=Gr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Xv(s).set(n,e),s}};function wae(r,e){switch(r[0]){case"Q":{const t=e??hc;return[hc.prefix,t.decode(`${hc.prefix}${r}`)]}case hc.prefix:{const t=e??hc;return[hc.prefix,t.decode(r)]}case Py.prefix:{const t=e??Py;return[Py.prefix,t.decode(r)]}case Wv.prefix:{const t=e??Wv;return[Wv.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function bae(r,e,t){const{prefix:n}=t;if(n!==hc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function vae(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const L1=112,Eae=18;function aN(r,e,t){const n=Ny(r),i=n+Ny(e),s=new Uint8Array(i+t.byteLength);return $y(r,s,0),$y(e,s,n),s.set(t,i),s}const Sae=Symbol.for("@ipld/js-cid/CID"),e7=ri({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});ri({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ri({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ri({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});class B1{constructor(e=!1,t=0){u(this,"full");u(this,"pendingBytes");u(this,"wantlist");u(this,"blocks");u(this,"blockPresences");this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}addWantlistEntry(e,t){const n=e7.encode(e.multihash.bytes);this.wantlist.set(n,t)}addBlockPresence(e,t){const n=e7.encode(e.multihash.bytes);this.blockPresences.set(n,t)}addBlock(e,t){const n=e7.encode(e.multihash.bytes);this.blocks.set(n,t)}}function xae(r){let e=new Uint8Array(r.reduce((n,i)=>n+yt(i),0)),t=0;for(const n of r)e=Sr(n,e,t),t+=yt(n);return e}function cN(r){return xae([r.version,r.code,r.multihash.code,r.multihash.digest.byteLength])}class Aae{constructor(e,t){u(this,"peerId");u(this,"blockstore");u(this,"network");u(this,"wants");u(this,"exchangeCount");u(this,"bytesSent");u(this,"bytesReceived");u(this,"lastExchange");u(this,"maxSizeReplaceHasWithBlock");u(this,"log");this.peerId=e.peerId,this.blockstore=e.blockstore,this.network=e.network,this.wants=new Map,this.log=e.logger.forComponent(`helia:bitswap:ledger:${e.peerId}`),this.exchangeCount=0,this.bytesSent=0,this.bytesReceived=0,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock??Gie}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesReceived+=e}debtRatio(){return this.bytesSent/(this.bytesReceived+1)}async sendBlocksToPeer(e){const t=new B1,n=new Set;for(const[i,s]of this.wants.entries())try{const o=await this.blockstore.get(s.cid,e);s.wantType===pr.WantHave?o.byteLength<this.maxSizeReplaceHasWithBlock?(this.log("sending have and block for %c",s.cid),n.add(i),t.addBlock(s.cid,{data:o,prefix:cN(s.cid)})):(this.log("sending have for %c",s.cid),t.addBlockPresence(s.cid,{cid:s.cid.bytes,type:Fs.HaveBlock})):(this.log("sending block for %c",s.cid),n.add(i),t.addBlock(s.cid,{data:o,prefix:cN(s.cid)}))}catch(o){if(o.name!=="NotFoundError")throw o;if(this.log("do not have block for %c",s.cid),!s.sendDontHave||s.sentDoNotHave===!0)continue;s.sentDoNotHave=!0,t.addBlockPresence(s.cid,{cid:s.cid.bytes,type:Fs.DoNotHaveBlock})}if(t.blocks.size>0||t.blockPresences.size>0){this.log("sending message"),await this.network.sendMessage(this.peerId,t,e),this.log("sent message"),this.sentBytes([...t.blocks.values()].reduce((i,s)=>i+s.data.byteLength,0));for(const i of n)this.wants.delete(i)}}}class Cae{constructor(e,t={}){u(this,"blockstore");u(this,"network");u(this,"ledgerMap");u(this,"maxSizeReplaceHasWithBlock");u(this,"log");u(this,"logger");this.blockstore=e.blockstore,this.network=e.network,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock,this.log=e.logger.forComponent("helia:bitswap:peer-want-lists"),this.logger=e.logger,this.ledgerMap=Z$({name:"helia_bitswap_ledger_map",metrics:e.metrics}),this.network.addEventListener("bitswap:message",n=>{this.receiveMessage(n.detail.peer,n.detail.message).catch(i=>{this.log.error("error receiving bitswap message from %p",n.detail.peer,i)})}),this.network.addEventListener("peer:disconnected",n=>{this.peerDisconnected(n.detail)})}ledgerForPeer(e){const t=this.ledgerMap.get(e);if(t!=null)return{peer:t.peerId,value:t.debtRatio(),sent:t.bytesSent,received:t.bytesReceived,exchanged:t.exchangeCount}}wantListForPeer(e){const t=this.ledgerMap.get(e);if(t!=null)return[...t.wants.values()]}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.peerId)}async receiveMessage(e,t){var i;let n=this.ledgerMap.get(e);if(n==null&&(n=new Aae({peerId:e,blockstore:this.blockstore,network:this.network,logger:this.logger},{maxSizeReplaceHasWithBlock:this.maxSizeReplaceHasWithBlock}),this.ledgerMap.set(e,n)),n.receivedBytes(((i=t.blocks)==null?void 0:i.reduce((s,o)=>s+o.data.byteLength,0))??0),t.wantlist!=null){t.wantlist.full===!0&&n.wants.clear();for(const s of t.wantlist.entries){const o=Zv.decode(s.cid),a=re(o.multihash.bytes,"base64");s.cancel===!0?(this.log("peer %p cancelled want of block for %c",e,o),n.wants.delete(a)):(s.wantType===pr.WantHave?this.log("peer %p wanted block presence for %c",e,o):this.log("peer %p wanted block for %c",e,o),n.wants.set(a,{cid:o,priority:s.priority,wantType:s.wantType??pr.WantBlock,sendDontHave:s.sendDontHave??!1}))}}this.log("send blocks to peer"),await n.sendBlocksToPeer()}async receivedBlock(e,t){const n=re(e.multihash.bytes,"base64"),i=[];for(const s of this.ledgerMap.values())s.wants.has(n)&&i.push(s);await Promise.all(i.map(async s=>s.sendBlocksToPeer(t)))}peerDisconnected(e){this.ledgerMap.delete(e)}}function Iae(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function kae(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var _ae=kae,Tae=_ae;let Pae=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Dae=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return lN(this,e)}},$ae=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return lN(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function lN(r,e){return new $ae({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Nae=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Pae(e,t,n),this.decoder=new Dae(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function uN({name:r,prefix:e,encode:t,decode:n}){return new Nae(r,e,t,n)}function dN({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Tae(t,r);return uN({prefix:e,name:r,encode:n,decode:s=>Iae(i(s))})}function Mae(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Oae(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function ni({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return uN({prefix:e,name:r,encode(i){return Oae(i,n,t)},decode(i){return Mae(i,n,t,r)}})}const Rae=ni({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ni({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ni({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ni({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ni({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ni({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ni({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ni({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ni({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Lae=dN({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});dN({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const Bae=ni({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});ni({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ni({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ni({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const Vd=1e3,Kd=Vd*60,jd=Kd*60,Vl=jd*24,Uae=Vl*7,Fae=Vl*365.25;function hN(r,e){try{if(typeof r=="string"&&r.length>0)return zae(r);if(typeof r=="number"&&isFinite(r))return e!=null&&e.long?Kae(r):Vae(r);throw new Error("Value is not a string or number.")}catch(t){const n=jae(t)?`${t.message}. value=${JSON.stringify(r)}`:"An unknown error has occured.";throw new Error(n)}}function zae(r){if(r=String(r),r.length>100)throw new Error("Value exceeds the maximum length of 100 characters.");const e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!e)return NaN;const t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*Fae;case"weeks":case"week":case"w":return t*Uae;case"days":case"day":case"d":return t*Vl;case"hours":case"hour":case"hrs":case"hr":case"h":return t*jd;case"minutes":case"minute":case"mins":case"min":case"m":return t*Kd;case"seconds":case"second":case"secs":case"sec":case"s":return t*Vd;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:throw new Error(`The unit ${n} was matched, but no matching case exists.`)}}function Vae(r){const e=Math.abs(r);return e>=Vl?`${Math.round(r/Vl)}d`:e>=jd?`${Math.round(r/jd)}h`:e>=Kd?`${Math.round(r/Kd)}m`:e>=Vd?`${Math.round(r/Vd)}s`:`${r}ms`}function Kae(r){const e=Math.abs(r);return e>=Vl?My(r,e,Vl,"day"):e>=jd?My(r,e,jd,"hour"):e>=Kd?My(r,e,Kd,"minute"):e>=Vd?My(r,e,Vd,"second"):`${r} ms`}function My(r,e,t,n){const i=e>=t*1.5;return`${Math.round(r/t)} ${n}${i?"s":""}`}function jae(r){return typeof r=="object"&&r!==null&&"message"in r}function Hae(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=i,t.enabled=o,t.humanize=hN,t.destroy=l,Object.keys(r).forEach(d=>{t[d]=r[d]}),t.names=[],t.skips=[],t.formatters={};function e(d){let h=0;for(let p=0;p<d.length;p++)h=(h<<5)-h+d.charCodeAt(p),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=e;function t(d){let h,p=null,m,f;function g(...v){if(!g.enabled)return;const y=g,w=Number(new Date),b=w-(h||w);y.diff=b,y.prev=h,y.curr=w,h=w,v[0]=t.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let E=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(k,x)=>{if(k==="%%")return"%";E++;const I=t.formatters[x];if(typeof I=="function"){const T=v[E];k=I.call(y,T),v.splice(E,1),E--}return k}),t.formatArgs.call(y,v),(y.log||t.log).apply(y,v)}return g.namespace=d,g.useColors=t.useColors(),g.color=t.selectColor(d),g.extend=n,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(m!==t.namespaces&&(m=t.namespaces,f=t.enabled(d)),f),set:v=>{p=v}}),typeof t.init=="function"&&t.init(g),g}function n(d,h){const p=t(this.namespace+(typeof h>"u"?":":h)+d);return p.log=this.log,p}function i(d){t.save(d),t.namespaces=d,t.names=[],t.skips=[];let h;const p=(typeof d=="string"?d:"").split(/[\s,]+/),m=p.length;for(h=0;h<m;h++)p[h]&&(d=p[h].replace(/\*/g,".*?"),d[0]==="-"?t.skips.push(new RegExp("^"+d.substr(1)+"$")):t.names.push(new RegExp("^"+d+"$")))}function s(){const d=[...t.names.map(a),...t.skips.map(a).map(h=>"-"+h)].join(",");return t.enable(""),d}function o(d){if(d[d.length-1]==="*")return!0;let h,p;for(h=0,p=t.skips.length;h<p;h++)if(t.skips[h].test(d))return!1;for(h=0,p=t.names.length;h<p;h++)if(t.names[h].test(d))return!0;return!1}function a(d){return d.toString().substring(2,d.toString().length-2).replace(/\.\*\?$/,"*")}function c(d){return d instanceof Error?d.stack??d.message:d}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.setupFormatters(t.formatters),t.enable(t.load()),t}var qae={};const Vs=Zae(),Wae=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Gae(){var r,e,t,n,i;return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&((r=navigator.userAgent)==null?void 0:r.toLowerCase().match(/(edge|trident)\/(\d+)/))!=null?!1:typeof document<"u"&&((t=(e=document.documentElement)==null?void 0:e.style)==null?void 0:t.WebkitAppearance)||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&((n=navigator.userAgent)==null?void 0:n.toLowerCase().match(/firefox\/(\d+)/))!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&((i=navigator.userAgent)==null?void 0:i.toLowerCase().match(/applewebkit\/(\d+)/))}function Qae(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+hN(this.diff),!this.useColors)return;const e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}const Yae=console.debug??console.log??(()=>{});function Jae(r){try{r?Vs==null||Vs.setItem("debug",r):Vs==null||Vs.removeItem("debug")}catch{}}function Xae(){let r;try{r=Vs==null?void 0:Vs.getItem("debug")}catch{}return!r&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(r=qae.DEBUG),r}function Zae(){try{return localStorage}catch{}}function ece(r){r.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}const ii=Hae({formatArgs:Qae,save:Jae,load:Xae,useColors:Gae,setupFormatters:ece,colors:Wae,storage:Vs,log:Yae});ii.formatters.b=r=>r==null?"undefined":Lae.baseEncode(r),ii.formatters.t=r=>r==null?"undefined":Rae.baseEncode(r),ii.formatters.m=r=>r==null?"undefined":Bae.baseEncode(r),ii.formatters.p=r=>r==null?"undefined":r.toString(),ii.formatters.c=r=>r==null?"undefined":r.toString(),ii.formatters.k=r=>r==null?"undefined":r.toString(),ii.formatters.a=r=>r==null?"undefined":r.toString(),ii.formatters.e=r=>r==null?"undefined":fN(r.stack)??fN(r.message)??r.toString();function tce(r){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function Oy(){return{forComponent(r){return Hd(r)}}}function Hd(r){let e=tce(`${r}:trace`);return ii.enabled(`${r}:trace`)&&ii.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=ii(`${r}:trace`)),Object.assign(ii(r),{error:ii(`${r}:error`),trace:e})}function fN(r){if(r!=null&&(r=r.trim(),r.length!==0))return r}function pN(r){const e=[fc.A];return r==null?e:Array.isArray(r)?r.length===0?e:r:[r]}const gN=60;function yN(r){return{Status:r.Status??0,TC:r.TC??r.flag_tc??!1,RD:r.RD??r.flag_rd??!1,RA:r.RA??r.flag_ra??!1,AD:r.AD??r.flag_ad??!1,CD:r.CD??r.flag_cd??!1,Question:(r.Question??r.questions??[]).map(e=>({name:e.name,type:fc[e.type]})),Answer:(r.Answer??r.answers??[]).map(e=>({name:e.name,type:fc[e.type],TTL:e.TTL??e.ttl??gN,data:e.data instanceof Uint8Array?re(e.data):e.data}))}}const rce=4;function mN(r,e={}){const t=new Ma({concurrency:e.queryConcurrency??rce});return async(n,i={})=>{var a;const s=new URLSearchParams;s.set("name",n),pN(i.types).forEach(c=>{s.append("type",fc[c])}),(a=i.onProgress)==null||a.call(i,new _e("dns:query",{detail:n}));const o=await t.add(async()=>{var d;const c=await fetch(`${r}?${s}`,{headers:{accept:"application/dns-json"},signal:i==null?void 0:i.signal});if(c.status!==200)throw new Error(`Unexpected HTTP status: ${c.status} - ${c.statusText}`);const l=yN(await c.json());return(d=i.onProgress)==null||d.call(i,new _e("dns:response",{detail:l})),l},{signal:i.signal});if(o==null)throw new Error("No DNS response received");return o}}function nce(){return[mN("https://cloudflare-dns.com/dns-query"),mN("https://dns.google/resolve")]}var ice=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),n=Object.create(null);function i(s,o){t[s]=o,e++,e>=r&&(e=0,n=t,t=Object.create(null))}return{has:function(s){return t[s]!==void 0||n[s]!==void 0},remove:function(s){t[s]!==void 0&&(t[s]=void 0),n[s]!==void 0&&(n[s]=void 0)},get:function(s){var o=t[s];if(o!==void 0)return o;if((o=n[s])!==void 0)return i(s,o),o},set:function(s,o){t[s]!==void 0?t[s]=o:i(s,o)},clear:function(){t=Object.create(null),n=Object.create(null)}}};const sce=Ze(ice);class oce{constructor(e){u(this,"lru");this.lru=sce(e)}get(e,t){let n=!0;const i=[];for(const s of t){const o=this.getAnswers(e,s);if(o.length===0){n=!1;break}i.push(...o)}if(n)return yN({answers:i})}getAnswers(e,t){const n=`${e.toLowerCase()}-${t}`,i=this.lru.get(n);if(i!=null){const s=i.filter(o=>o.expires>Date.now()).map(({expires:o,value:a})=>({...a,TTL:Math.round((o-Date.now())/1e3),type:fc[a.type]}));return s.length===0&&this.lru.remove(n),s}return[]}add(e,t){const n=`${e.toLowerCase()}-${t.type}`,i=this.lru.get(n)??[];i.push({expires:Date.now()+(t.TTL??gN)*1e3,value:t}),this.lru.set(n,i)}remove(e,t){const n=`${e.toLowerCase()}-${t}`;this.lru.remove(n)}clear(){this.lru.clear()}}function ace(r){return new oce(r)}const cce=1e3;let lce=class{constructor(e){u(this,"resolvers");u(this,"cache");this.resolvers={},this.cache=ace(e.cacheSize??cce),Object.entries(e.resolvers??{}).forEach(([t,n])=>{Array.isArray(n)||(n=[n]),t.endsWith(".")||(t=`${t}.`),this.resolvers[t]=n}),this.resolvers["."]==null&&(this.resolvers["."]=nce())}async query(e,t={}){var c,l,d;const n=pN(t.types),i=t.cached!==!1?this.cache.get(e,n):void 0;if(i!=null)return(c=t.onProgress)==null||c.call(t,new _e("dns:cache",{detail:i})),i;const s=`${e.split(".").pop()}.`,o=(this.resolvers[s]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),a=[];for(const h of o){if(((l=t.signal)==null?void 0:l.aborted)===!0)break;try{const p=await h(e,{...t,types:n});for(const m of p.Answer)this.cache.add(e,m);return p}catch(p){a.push(p),(d=t.onProgress)==null||d.call(t,new _e("dns:error",{detail:p}))}}throw a.length===1?a[0]:new AggregateError(a,`DNS lookup of ${e} ${n} failed`)}};var fc;(function(r){r[r.A=1]="A",r[r.CNAME=5]="CNAME",r[r.TXT=16]="TXT",r[r.AAAA=28]="AAAA"})(fc||(fc={}));function wN(r={}){return new lce(r)}const Oo="/",bN=new TextEncoder().encode(Oo),Ry=bN[0];class xt{constructor(e,t){u(this,"_buf");if(typeof e=="string")this._buf=se(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==Ry)throw new Error("Invalid key")}toString(e="utf8"){return re(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new xt(e.join(Oo))}static random(){return new xt(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new xt(e):typeof e.uint8Array=="function"?new xt(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=bN),this._buf[0]!==Ry){const e=new Uint8Array(this._buf.byteLength+1);e.fill(Ry,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Ry;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;const s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return xt.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Oo).slice(1)}type(){return uce(this.baseNamespace())}name(){return dce(this.baseNamespace())}instance(e){return new xt(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Oo)||(e+=Oo),e+=this.type(),new xt(e)}parent(){const e=this.list();return e.length===1?new xt(Oo):new xt(e.slice(0,-1).join(Oo))}child(e){return this.toString()===Oo?e:e.toString()===Oo?this:new xt(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return xt.withNamespaces([...this.namespaces(),...hce(e.map(t=>t.namespaces()))])}}function uce(r){const e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function dce(r){const e=r.split(":");return e[e.length-1]}function hce(r){return[].concat(...r)}function fce(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function qd(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function pce(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var gce=pce,yce=gce;let mce=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},wce=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return vN(this,e)}},bce=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return vN(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function vN(r,e){return new bce({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let vce=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new mce(e,t,n),this.decoder=new wce(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function EN({name:r,prefix:e,encode:t,decode:n}){return new vce(r,e,t,n)}function Ly({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=yce(t,r);return EN({prefix:e,name:r,encode:n,decode:s=>qd(i(s))})}function Ece(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Sce(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function si({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return EN({prefix:e,name:r,encode(i){return Sce(i,n,t)},decode(i){return Ece(i,n,t,r)}})}const Wd=Ly({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Ly({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const By=si({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});si({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),si({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),si({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),si({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),si({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),si({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),si({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),si({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const pc=Ly({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Ly({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var xce=xN,SN=128,Ace=-128,Cce=Math.pow(2,31);function xN(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Cce;)e[t++]=r&255|SN,r/=128;for(;r&Ace;)e[t++]=r&255|SN,r>>>=7;return e[t]=r|0,xN.bytes=t-n+1,e}var Ice=t7,kce=128,AN=127;function t7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw t7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&AN)<<i:(o&AN)*Math.pow(2,i),i+=7}while(o>=kce);return t7.bytes=s-n,t}var _ce=Math.pow(2,7),Tce=Math.pow(2,14),Pce=Math.pow(2,21),Dce=Math.pow(2,28),$ce=Math.pow(2,35),Nce=Math.pow(2,42),Mce=Math.pow(2,49),Oce=Math.pow(2,56),Rce=Math.pow(2,63),Lce=function(r){return r<_ce?1:r<Tce?2:r<Pce?3:r<Dce?4:r<$ce?5:r<Nce?6:r<Mce?7:r<Oce?8:r<Rce?9:10},Bce={encode:xce,decode:Ice,encodingLength:Lce},Uy=Bce;function r7(r,e=0){return[Uy.decode(r,e),Uy.decode.bytes]}function Fy(r,e,t=0){return Uy.encode(r,e,t),e}function zy(r){return Uy.encodingLength(r)}function Vy(r,e){const t=e.byteLength,n=zy(r),i=n+zy(t),s=new Uint8Array(i+t);return Fy(r,s,0),Fy(t,s,n),s.set(e,i),new n7(r,t,e,s)}function Uce(r){const e=qd(r),[t,n]=r7(e),[i,s]=r7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new n7(t,i,o,e)}function Fce(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&fce(r.bytes,t.bytes)}}let n7=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function CN(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Vce(t,i7(r),e??pc.encoder);default:return Kce(t,i7(r),e??By.encoder)}}const IN=new WeakMap;function i7(r){const e=IN.get(r);if(e==null){const t=new Map;return IN.set(r,t),t}return e}let Kl=class Qr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,_j,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==U1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==jce)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Qr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Vy(e,t);return Qr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Qr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Fce(e.multihash,n.multihash)}toString(e){return CN(this,e)}toJSON(){return{"/":CN(this)}}link(){return this}[(_j=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Qr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Qr(n,i,s,o??kN(n,i,s.bytes))}else if(t[Hce]===!0){const{version:n,multihash:i,code:s}=t,o=Uce(i);return Qr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==U1)throw new Error(`Version 0 CID must use dag-pb (code: ${U1}) block encoding`);return new Qr(e,t,n,n.bytes)}case 1:{const i=kN(e,t,n.bytes);return new Qr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Qr.create(0,U1,e)}static createV1(e,t){return Qr.create(1,e,t)}static decode(e){const[t,n]=Qr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Qr.inspectBytes(e),n=t.size-t.multihashSize,i=qd(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new n7(t.multihashCode,t.digestSize,s,i);return[t.version===0?Qr.createV0(o):Qr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=r7(e.subarray(t));return t+=p,h};let i=n(),s=U1;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=zce(e,t),s=Qr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return i7(s).set(n,e),s}};function zce(r,e){switch(r[0]){case"Q":{const t=e??pc;return[pc.prefix,t.decode(`${pc.prefix}${r}`)]}case pc.prefix:{const t=e??pc;return[pc.prefix,t.decode(r)]}case By.prefix:{const t=e??By;return[By.prefix,t.decode(r)]}case Wd.prefix:{const t=e??Wd;return[Wd.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Vce(r,e,t){const{prefix:n}=t;if(n!==pc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Kce(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const U1=112,jce=18;function kN(r,e,t){const n=zy(r),i=n+zy(e),s=new Uint8Array(i+t.byteLength);return Fy(r,s,0),Fy(e,s,n),s.set(t,i),s}const Hce=Symbol.for("@ipld/js-cid/CID");function _N({name:r,code:e,encode:t}){return new qce(r,e,t)}let qce=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Vy(this.code,t):t.then(n=>Vy(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Ky({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*Wce(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t],s=Kl.asCID(n);s!=null?yield[i.join("/"),s]:typeof n=="object"&&(yield*s7(n,i))}else{const t=Kl.asCID(e);t!=null?yield[r.join("/"),t]:yield*s7(e,r)}}function*s7(r,e){if(r==null||r instanceof Uint8Array)return;const t=Kl.asCID(r);t!=null&&(yield[e.join("/"),t]);for(const[n,i]of Object.entries(r)){const s=[...e,n];yield*Wce(s,i)}}function*Gce(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t];yield i.join("/"),typeof n=="object"&&Kl.asCID(n)==null&&(yield*o7(n,i))}else yield*o7(e,r)}function*o7(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const i=[...e,t];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&Kl.asCID(n)==null&&(yield*Gce(i,n))}}function Qce(r,e){let t=r;for(const[n,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);const s=Kl.asCID(t);if(s!=null)return{value:s,remaining:e.slice(n+1).join("/")}}return{value:t}}class Yce{constructor({cid:e,bytes:t,value:n}){u(this,"cid");u(this,"bytes");u(this,"value");u(this,"asBlock");if(e==null||t==null||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:Ky(),bytes:Ky(),value:Ky(),asBlock:Ky()})}links(){return s7(this.value,[])}tree(){return o7(this.value,[])}get(e="/"){return Qce(this.value,e.split("/").filter(Boolean))}}function Jce({bytes:r,cid:e,value:t,codec:n}){const i=t!==void 0?t:n==null?void 0:n.decode(r);if(i===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new Yce({cid:e,bytes:r,value:i})}const TN="/pin/",PN="/pinned-block/",a7=Wd,DN=1;function jy(r){return r.version===0&&(r=r.toV1()),new xt(`${TN}${r.toString(a7)}`)}class Xce{constructor(e,t,n){Je(this,da);u(this,"datastore");u(this,"blockstore");u(this,"getCodec");this.datastore=e,this.blockstore=t,this.getCodec=n}async*add(e,t={}){const n=jy(e);if(await this.datastore.has(n))throw new Error("Already pinned");const i=Math.round(t.depth??1/0);if(i<0)throw new Error("Depth must be greater than or equal to 0");const s=new Bl({concurrency:DN});for await(const a of Ie(this,da,L4).call(this,e,s,{...t,depth:i}))await Ie(this,da,RA).call(this,a,c=>c.pinnedBy.find(l=>qe(l,e.bytes))!=null?!1:(c.pinCount++,c.pinnedBy.push(e.bytes),!0),t),yield a;const o={depth:i,metadata:t.metadata??{}};await this.datastore.put(n,Qg(o),t)}async*rm(e,t={}){const n=jy(e),i=await this.datastore.get(n,t),s=Ua(i);await this.datastore.delete(n,t);const o=new Bl({concurrency:DN});for await(const a of Ie(this,da,L4).call(this,e,o,{...t,depth:s.depth}))await Ie(this,da,RA).call(this,a,c=>(c.pinCount--,c.pinnedBy=c.pinnedBy.filter(l=>qe(l,e.bytes)),!0),{...t,depth:s.depth}),yield a}async*ls(e={}){for await(const{key:t,value:n}of this.datastore.query({prefix:TN+(e.cid!=null?`${e.cid.toString(Wd)}`:"")},e)){const i=Kl.parse(t.toString().substring(5),Wd),s=Ua(n);yield{cid:i,...s}}}async isPinned(e,t={}){const n=new xt(`${PN}${a7.encode(e.multihash.bytes)}`);return this.datastore.has(n,t)}async get(e,t){const n=jy(e),i=await this.datastore.get(n,t);return Ua(i)}async setMetadata(e,t,n){const i=jy(e),s=await this.datastore.get(i,n),o=Ua(s);o.metadata=t??{},await this.datastore.put(i,Qg(o),n)}}da=new WeakSet,L4=async function*(e,t,n){if(n.depth===-1)return;const i=await this.getCodec(e.code),s=await this.blockstore.get(e,n),o=Jce({bytes:s,cid:e,codec:i});yield e;for await(const[,a]of o.links())yield*await t.add(async()=>Ie(this,da,L4).call(this,a,t,{...n,depth:n.depth-1}))},RA=async function(e,t,n){var a;const i=new xt(`${PN}${a7.encode(e.multihash.bytes)}`);let s={pinCount:0,pinnedBy:[]};try{s=Ua(await this.datastore.get(i,n))}catch(c){if(c.name!=="NotFoundError")throw c}if(t(s)){if(s.pinCount===0&&await this.datastore.has(i)){await this.datastore.delete(i);return}await this.datastore.put(i,Qg(s),n),(a=n.onProgress)==null||a.call(n,new _e("helia:pin:add",e))}};const Zce=1,ele=5;class $N extends Error{constructor(e="Insufficient providers found"){super(e),this.name="InsufficientProvidersError"}}u($N,"name","InsufficientProvidersError");class F1 extends Error{constructor(e="No routers available"){super(e),this.name="NoRoutersAvailableError"}}u(F1,"name","NoRoutersAvailableError");class NN extends Error{constructor(e="Unknown hash algorithm"){super(e),this.name="UnknownHashAlgorithmError"}}u(NN,"name","UnknownHashAlgorithmError");class MN extends Error{constructor(e="Unknown codec"){super(e),this.name="UnknownCodecError"}}u(MN,"name","UnknownCodecError");const tle=5;class rle{constructor(e,t){u(this,"log");u(this,"routers");u(this,"providerLookupConcurrency");var n,i,s,o,a,c,l;this.log=e.logger.forComponent("helia:routing"),this.routers=t.routers??[],this.providerLookupConcurrency=t.providerLookupConcurrency??tle,this.findProviders=((n=e.metrics)==null?void 0:n.traceFunction("helia.routing.findProviders",this.findProviders.bind(this),{optionsIndex:1}))??this.findProviders,this.provide=((i=e.metrics)==null?void 0:i.traceFunction("helia.routing.provide",this.provide.bind(this),{optionsIndex:1}))??this.provide,this.cancelReprovide=((s=e.metrics)==null?void 0:s.traceFunction("helia.routing.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1}))??this.cancelReprovide,this.put=((o=e.metrics)==null?void 0:o.traceFunction("helia.routing.put",this.put.bind(this),{optionsIndex:2}))??this.put,this.get=((a=e.metrics)==null?void 0:a.traceFunction("helia.routing.get",this.get.bind(this),{optionsIndex:1}))??this.get,this.findPeer=((c=e.metrics)==null?void 0:c.traceFunction("helia.routing.findPeer",this.findPeer.bind(this),{optionsIndex:1}))??this.findPeer,this.getClosestPeers=((l=e.metrics)==null?void 0:l.traceFunction("helia.routing.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1}))??this.getClosestPeers}async start(){await ko(...this.routers)}async stop(){await Ga(...this.routers)}async*findProviders(e,t={}){if(this.routers.length===0)throw new F1("No content routers available");const n=new lc({concurrency:this.providerLookupConcurrency});n.addEventListener("error",()=>{});for await(const i of Oa(n.toGenerator(),...jl(this.routers,"findProviders").map(s=>s.findProviders(e,t))))if(i!=null){if(i.multiaddrs.length===0){if(n.find(i.id)!=null)continue;n.add(async()=>{try{const s=await this.findPeer(i.id,t);return s.multiaddrs.length===0?null:s}catch(s){return this.log.error("could not load multiaddrs for peer %p",i.id,s),null}},{peerId:i.id,signal:t.signal}).catch(s=>{this.log.error("could not load multiaddrs for peer %p",i.id,s)})}yield i}}async provide(e,t={}){if(this.routers.length===0)throw new F1("No content routers available");await Promise.all(jl(this.routers,"provide").map(async n=>{await n.provide(e,t)}))}async cancelReprovide(e,t={}){await Promise.all(jl(this.routers,"cancelReprovide").map(async n=>{await n.cancelReprovide(e,t)}))}async put(e,t,n){await Promise.all(jl(this.routers,"put").map(async i=>{await i.put(e,t,n)}))}async get(e,t){return Promise.any(jl(this.routers,"get").map(async n=>n.get(e,t)))}async findPeer(e,t){if(this.routers.length===0)throw new F1("No peer routers available");const n=this,i=Oa(...jl(this.routers,"findPeer").map(s=>async function*(){try{yield await s.findPeer(e,t)}catch(o){n.log.error(o)}}()));for await(const s of i)if(s!=null)return s;throw new Zt("Could not find peer in routing")}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new F1("No peer routers available");for await(const n of Oa(...jl(this.routers,"getClosestPeers").map(i=>i.getClosestPeers(e,t))))n!=null&&(yield n)}}function jl(r,e){return r.filter(t=>t[e]!=null)}const gc={},Hl=r=>{r.addEventListener("message",e=>{Hl.dispatchEvent("message",r,e)}),r.port!=null&&r.port.addEventListener("message",e=>{Hl.dispatchEvent("message",r,e)})};Hl.addEventListener=(r,e)=>{gc[r]==null&&(gc[r]=[]),gc[r].push(e)},Hl.removeEventListener=(r,e)=>{gc[r]!=null&&(gc[r]=gc[r].filter(t=>t===e))},Hl.dispatchEvent=function(r,e,t){gc[r]!=null&&gc[r].forEach(n=>n(e,t))};const ON="lock:worker:request-read",RN="lock:worker:release-read",LN="lock:master:grant-read",BN="lock:worker:request-write",UN="lock:worker:release-write",FN="lock:master:grant-write",nle=(r=21)=>Math.random().toString().substring(2),zN=(r,e,t,n,i)=>(s,o)=>{if(o.data.type!==t)return;const a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};r.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>{s.postMessage({type:i,name:a.name,identifier:a.identifier}),await new Promise(c=>{const l=d=>{if((d==null?void 0:d.data)==null)return;const h={type:d.data.type,name:d.data.name,identifier:d.data.identifier};h.type===n&&h.identifier===a.identifier&&(s.removeEventListener("message",l),c())};s.addEventListener("message",l)})}}}))},VN=(r,e,t,n)=>async()=>{const i=nle();return globalThis.postMessage({type:e,identifier:i,name:r}),new Promise(s=>{const o=a=>{if((a==null?void 0:a.data)==null)return;const c={type:a.data.type,identifier:a.data.identifier};c.type===t&&c.identifier===i&&(globalThis.removeEventListener("message",o),s(()=>{globalThis.postMessage({type:n,identifier:i,name:r})}))};globalThis.addEventListener("message",o)})},ile={singleProcess:!1},sle=r=>{if(r=Object.assign({},ile,r),!!globalThis.document||r.singleProcess){const t=new EventTarget;return Hl.addEventListener("message",zN(t,"requestReadLock",ON,RN,LN)),Hl.addEventListener("message",zN(t,"requestWriteLock",BN,UN,FN)),t}return{isWorker:!0,readLock:t=>VN(t,ON,LN,RN),writeLock:t=>VN(t,BN,FN,UN)}},ql={};let yc;async function c7(r,e){let t;const n=new Promise(i=>{t=i});return r.add(async()=>jf((async()=>{await new Promise(i=>{t(()=>{i()})})})(),{milliseconds:e.timeout})),n}const ole=(r,e)=>{if(yc.isWorker===!0)return{readLock:yc.readLock(r,e),writeLock:yc.writeLock(r,e)};const t=new Ma({concurrency:1});let n;return{async readLock(){if(n!=null)return c7(n,e);n=new Ma({concurrency:e.concurrency,autoStart:!1});const i=n,s=c7(n,e);return t.add(async()=>{i.start(),await i.onIdle().then(()=>{n===i&&(n=null)})}),s},async writeLock(){return n=null,c7(t,e)}}},ale={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function l7(r){const e=Object.assign({},ale,r);return yc==null&&(yc=sle(e),yc.isWorker!==!0&&(yc.addEventListener("requestReadLock",t=>{ql[t.data.name]!=null&&ql[t.data.name].readLock().then(async n=>t.data.handler().finally(()=>{n()}))}),yc.addEventListener("requestWriteLock",async t=>{ql[t.data.name]!=null&&ql[t.data.name].writeLock().then(async n=>t.data.handler().finally(()=>{n()}))}))),ql[e.name]==null&&(ql[e.name]=ole(e.name,e)),ql[e.name]}class cle{constructor(e,t,n={}){u(this,"lock");u(this,"child");u(this,"pins");u(this,"started");this.child=e,this.pins=t,this.lock=l7({singleProcess:n.holdGcLock}),this.started=!1}isStarted(){return this.started}async start(){await ko(this.child),this.started=!0}async stop(){await Ga(this.child),this.started=!1}unwrap(){return this.child}async put(e,t,n={}){var s;(s=n==null?void 0:n.signal)==null||s.throwIfAborted();const i=await this.lock.readLock();try{return await this.child.put(e,t,n)}finally{i()}}async*putMany(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.putMany(e,t)}finally{n()}}async get(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{return await this.child.get(e,t)}finally{n()}}async*getMany(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.getMany(e,t)}finally{n()}}async delete(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.writeLock();try{if(await this.pins.isPinned(e))throw new Error("CID was pinned");await this.child.delete(e,t)}finally{n()}}async*deleteMany(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.writeLock();try{const s=this;yield*this.child.deleteMany(async function*(){for await(const o of e){if(await s.pins.isPinned(o))throw new Error("CID was pinned");yield o}}(),t)}finally{n()}}async has(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{return await this.child.has(e,t)}finally{n()}}async*getAll(e={}){var n;(n=e==null?void 0:e.signal)==null||n.throwIfAborted();const t=await this.lock.readLock();try{yield*this.child.getAll(e)}finally{t()}}createSession(e,t){var n;return(n=t==null?void 0:t.signal)==null||n.throwIfAborted(),this.child.createSession(e,t)}}const u7=new xt("/version"),KN=1;async function lle(r){if(!await r.has(u7)){await r.put(u7,se(`${KN}`));return}const e=await r.get(u7),t=re(e);if(parseInt(t,10)!==KN)throw new Error("Unknown datastore version, a datastore migration may be required")}class ule extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===V.array&&(t.elements++,t.elements!==1&&e.push([44])),t.type===V.map&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[V.uint.major](e,t){this.prefix(e);const n=String(t.value),i=[];for(let s=0;s<n.length;s++)i[s]=n.charCodeAt(s);e.push(i)}[V.negint.major](e,t){this[V.uint.major](e,t)}[V.bytes.major](e,t){throw new Error(`${cl} unsupported type: Uint8Array`)}[V.string.major](e,t){this.prefix(e);const n=O_(JSON.stringify(t.value));e.push(n.length>32?y6(n):n)}[V.array.major](e,t){this.prefix(e),this.inRecursive.push({type:V.array,elements:0}),e.push([91])}[V.map.major](e,t){this.prefix(e),this.inRecursive.push({type:V.map,elements:0}),e.push([123])}[V.tag.major](e,t){}[V.float.major](e,t){if(t.type.name==="break"){const o=this.inRecursive.pop();if(o){if(o.type===V.array)e.push([93]);else if(o.type===V.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${cl} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}const n=String(t.value),i=[];let s=!1;for(let o=0;o<n.length;o++)i[o]=n.charCodeAt(o),!s&&(i[o]===46||i[o]===101||i[o]===69)&&(s=!0);s||(i.push(46),i.push(48)),e.push(i)}}function dle(r,e){if(Array.isArray(r[0])||Array.isArray(e[0]))throw new Error(`${cl} complex map keys are not supported`);const t=r[0],n=e[0];if(t.type!==V.string||n.type!==V.string)throw new Error(`${cl} non-string map keys are not supported`);if(t<n)return-1;if(t>n)return 1;throw new Error(`${cl} unexpected duplicate map keys, this is not supported`)}const hle={addBreakTokens:!0,mapSorter:dle};function fle(r,e){return e=Object.assign({},hle,e),G_(r,new ule,e)}class jN{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error(`${ke} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw new Error(`${ke} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this._pos;let t=!1,n=!1;const i=a=>{for(;!this.done();){const c=this.ch();if(a.includes(c))this._pos++;else break}};if(this.ch()===45&&(t=!0,this._pos++),this.ch()===48)if(this._pos++,this.ch()===46)this._pos++,n=!0;else return new ne(V.uint,0,this._pos-e);if(i([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw new Error(`${ke} unexpected token at position ${this._pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${ke} unexpected token at position ${this._pos}`);n=!0,this._pos++,i([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this._pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this._pos++,i([48,49,50,51,52,53,54,55,56,57]));const s=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),o=parseFloat(s);return n?new ne(V.float,o,this._pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(o)?new ne(o>=0?V.uint:V.negint,o,this._pos-e):new ne(o>=0?V.uint:V.negint,BigInt(s),this._pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${ke} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let s=this._pos,o=0;s<this.data.length&&o<65536;s++,o++){const a=this.data[s];if(a===92||a<32||a>=128)break;if(a===34){const c=String.fromCharCode.apply(null,this.data.subarray(this._pos,s));return this._pos=s+1,new ne(V.string,c,o)}}const e=this._pos,t=[],n=()=>{if(this._pos+4>=this.data.length)throw new Error(`${ke} unexpected end of unicode escape sequence at position ${this._pos}`);let s=0;for(let o=0;o<4;o++){let a=this.ch();if(a>=48&&a<=57)a-=48;else if(a>=97&&a<=102)a=a-97+10;else if(a>=65&&a<=70)a=a-65+10;else throw new Error(`${ke} unexpected unicode escape character at position ${this._pos}`);s=s*16+a,this._pos++}return s},i=()=>{const s=this.ch();let o=null,a=s>239?4:s>223?3:s>191?2:1;if(this._pos+a>this.data.length)throw new Error(`${ke} unexpected unicode sequence at position ${this._pos}`);let c,l,d,h;switch(a){case 1:s<128&&(o=s);break;case 2:c=this.data[this._pos+1],(c&192)===128&&(h=(s&31)<<6|c&63,h>127&&(o=h));break;case 3:c=this.data[this._pos+1],l=this.data[this._pos+2],(c&192)===128&&(l&192)===128&&(h=(s&15)<<12|(c&63)<<6|l&63,h>2047&&(h<55296||h>57343)&&(o=h));break;case 4:c=this.data[this._pos+1],l=this.data[this._pos+2],d=this.data[this._pos+3],(c&192)===128&&(l&192)===128&&(d&192)===128&&(h=(s&15)<<18|(c&63)<<12|(l&63)<<6|d&63,h>65535&&h<1114112&&(o=h))}o===null?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|o&1023),t.push(o),this._pos+=a};for(;!this.done();){const s=this.ch();let o;switch(s){case 92:if(this._pos++,this.done())throw new Error(`${ke} unexpected string termination at position ${this._pos}`);switch(o=this.ch(),this._pos++,o){case 34:case 39:case 92:case 47:t.push(o);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${ke} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new ne(V.string,U_(t),this._pos-e);default:if(s<32)throw new Error(`${ke} invalid control character at position ${this._pos}`);s<128?(t.push(s),this._pos++):i()}}throw new Error(`${ke} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new ne(V.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new ne(V.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new ne(V.null,null,4);case 102:return this.expect([102,97,108,115,101]),new ne(V.false,!1,5);case 116:return this.expect([116,114,117,101]),new ne(V.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${ke} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this._pos++,this.skipWhitespace(),new ne(V.break,void 0,1);if(this.ch()!==44)throw new Error(`${ke} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this._pos++,this.skipWhitespace(),new ne(V.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new ne(V.break,void 0,1);if(this.ch()!==44)throw new Error(`${ke} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this._pos++,this.skipWhitespace(),new ne(V.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${ke} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${ke} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}}function ple(r,e){return e=Object.assign({tokenizer:new jN(r,e)},e),Ua(r,e)}function gle(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function d7(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function yle(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var mle=yle,wle=mle;let ble=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},vle=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return HN(this,e)}},Ele=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return HN(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function HN(r,e){return new Ele({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Sle=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new ble(e,t,n),this.decoder=new vle(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function qN({name:r,prefix:e,encode:t,decode:n}){return new Sle(r,e,t,n)}function Hy({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=wle(t,r);return qN({prefix:e,name:r,encode:n,decode:s=>d7(i(s))})}function xle(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Ale(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function oi({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return qN({prefix:e,name:r,encode(i){return Ale(i,n,t)},decode(i){return xle(i,n,t,r)}})}const qy=oi({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});oi({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),oi({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),oi({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),oi({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),oi({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),oi({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),oi({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),oi({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const h7=Hy({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Hy({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const mc=Hy({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Hy({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Cle=GN,WN=128,Ile=-128,kle=Math.pow(2,31);function GN(r,e,t){e=e||[],t=t||0;for(var n=t;r>=kle;)e[t++]=r&255|WN,r/=128;for(;r&Ile;)e[t++]=r&255|WN,r>>>=7;return e[t]=r|0,GN.bytes=t-n+1,e}var _le=f7,Tle=128,QN=127;function f7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw f7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&QN)<<i:(o&QN)*Math.pow(2,i),i+=7}while(o>=Tle);return f7.bytes=s-n,t}var Ple=Math.pow(2,7),Dle=Math.pow(2,14),$le=Math.pow(2,21),Nle=Math.pow(2,28),Mle=Math.pow(2,35),Ole=Math.pow(2,42),Rle=Math.pow(2,49),Lle=Math.pow(2,56),Ble=Math.pow(2,63),Ule=function(r){return r<Ple?1:r<Dle?2:r<$le?3:r<Nle?4:r<Mle?5:r<Ole?6:r<Rle?7:r<Lle?8:r<Ble?9:10},Fle={encode:Cle,decode:_le,encodingLength:Ule},Wy=Fle;function p7(r,e=0){return[Wy.decode(r,e),Wy.decode.bytes]}function Gy(r,e,t=0){return Wy.encode(r,e,t),e}function Qy(r){return Wy.encodingLength(r)}function zle(r,e){const t=e.byteLength,n=Qy(r),i=n+Qy(t),s=new Uint8Array(i+t);return Gy(r,s,0),Gy(t,s,n),s.set(e,i),new g7(r,t,e,s)}function Vle(r){const e=d7(r),[t,n]=p7(e),[i,s]=p7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new g7(t,i,o,e)}function Kle(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&gle(r.bytes,t.bytes)}}let g7=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function YN(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Hle(t,y7(r),e??mc.encoder);default:return qle(t,y7(r),e??qy.encoder)}}const JN=new WeakMap;function y7(r){const e=JN.get(r);if(e==null){const t=new Map;return JN.set(r,t),t}return e}let XN=class Yr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Tj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==z1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Wle)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Yr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=zle(e,t);return Yr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Yr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Kle(e.multihash,n.multihash)}toString(e){return YN(this,e)}toJSON(){return{"/":YN(this)}}link(){return this}[(Tj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Yr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Yr(n,i,s,o??ZN(n,i,s.bytes))}else if(t[Gle]===!0){const{version:n,multihash:i,code:s}=t,o=Vle(i);return Yr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==z1)throw new Error(`Version 0 CID must use dag-pb (code: ${z1}) block encoding`);return new Yr(e,t,n,n.bytes)}case 1:{const i=ZN(e,t,n.bytes);return new Yr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Yr.create(0,z1,e)}static createV1(e,t){return Yr.create(1,e,t)}static decode(e){const[t,n]=Yr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Yr.inspectBytes(e),n=t.size-t.multihashSize,i=d7(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new g7(t.multihashCode,t.digestSize,s,i);return[t.version===0?Yr.createV0(o):Yr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=p7(e.subarray(t));return t+=p,h};let i=n(),s=z1;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=jle(e,t),s=Yr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return y7(s).set(n,e),s}};function jle(r,e){switch(r[0]){case"Q":{const t=e??mc;return[mc.prefix,t.decode(`${mc.prefix}${r}`)]}case mc.prefix:{const t=e??mc;return[mc.prefix,t.decode(r)]}case qy.prefix:{const t=e??qy;return[qy.prefix,t.decode(r)]}case h7.prefix:{const t=e??h7;return[h7.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Hle(r,e,t){const{prefix:n}=t;if(n!==mc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function qle(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const z1=112,Wle=18;function ZN(r,e,t){const n=Qy(r),i=n+Qy(e),s=new Uint8Array(i+t.byteLength);return Gy(r,s,0),Gy(e,s,n),s.set(t,i),s}const Gle=Symbol.for("@ipld/js-cid/CID"),eM=oi({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});oi({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),oi({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),oi({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function Qle(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function Yle(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=XN.asCID(r);if(!e)return null;const t=e.toString();return[new ne(V.map,1/0,1),new ne(V.string,"/",1),new ne(V.string,t,t.length),new ne(V.break,void 0,1)]}function Yy(r){const e=eM.encode(r).slice(1);return[new ne(V.map,1/0,1),new ne(V.string,"/",1),new ne(V.map,1/0,1),new ne(V.string,"bytes",5),new ne(V.string,e,e.length),new ne(V.break,void 0,1),new ne(V.break,void 0,1)]}function rs(r){return Yy(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}function Jle(r){return Yy(new Uint8Array(r))}function Xle(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function Zle(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const eue={typeEncoders:{Object:Yle,Buffer:Yy,Uint8Array:Yy,Int8Array:rs,Uint16Array:rs,Int16Array:rs,Uint32Array:rs,Int32Array:rs,Float32Array:rs,Float64Array:rs,Uint8ClampedArray:rs,BigInt64Array:rs,BigUint64Array:rs,DataView:rs,ArrayBuffer:Jle,undefined:Xle,number:Zle}};class tue extends jN{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(e.type===V.map){const t=this._next();if(t.type===V.string&&t.value==="/"){const n=this._next();if(n.type===V.string){if(this._next().type!==V.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new ne(V.tag,42,0)}if(n.type===V.map){const i=this._next();if(i.type===V.string&&i.value==="bytes"){const s=this._next();if(s.type===V.string){for(let a=0;a<2;a++)if(this._next().type!==V.break)throw new Error("Invalid encoded Bytes form");const o=eM.decode(`m${s.value}`);return new ne(V.bytes,o,s.value.length)}this.tokenBuffer.push(s)}this.tokenBuffer.push(i)}this.tokenBuffer.push(n)}this.tokenBuffer.push(t)}return e}}const m7={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};m7.tags[42]=XN.parse;const rue="dag-json",tM=297,rM=r=>fle(r,eue),nM=r=>{const e=Qle(r),t=Object.assign(m7,{tokenizer:new tue(e,m7)});return ple(e,t)},iM=r=>nue.decode(rM(r)),nue=new TextDecoder,iue=r=>nM(sue.encode(r)),sue=new TextEncoder,oue=Object.freeze(Object.defineProperty({__proto__:null,code:tM,decode:nM,encode:rM,format:iM,name:rue,parse:iue,stringify:iM},Symbol.toStringTag,{value:"Module"}));function aue(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function w7(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function cue(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var lue=cue,uue=lue;let due=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},hue=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return sM(this,e)}},fue=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return sM(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function sM(r,e){return new fue({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let pue=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new due(e,t,n),this.decoder=new hue(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function oM({name:r,prefix:e,encode:t,decode:n}){return new pue(r,e,t,n)}function Jy({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=uue(t,r);return oM({prefix:e,name:r,encode:n,decode:s=>w7(i(s))})}function gue(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function yue(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Ro({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return oM({prefix:e,name:r,encode(i){return yue(i,n,t)},decode(i){return gue(i,n,t,r)}})}const Xy=Ro({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Ro({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ro({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ro({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ro({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ro({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ro({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ro({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Ro({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const b7=Jy({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Jy({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const wc=Jy({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Jy({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var mue=cM,aM=128,wue=-128,bue=Math.pow(2,31);function cM(r,e,t){e=e||[],t=t||0;for(var n=t;r>=bue;)e[t++]=r&255|aM,r/=128;for(;r&wue;)e[t++]=r&255|aM,r>>>=7;return e[t]=r|0,cM.bytes=t-n+1,e}var vue=v7,Eue=128,lM=127;function v7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw v7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&lM)<<i:(o&lM)*Math.pow(2,i),i+=7}while(o>=Eue);return v7.bytes=s-n,t}var Sue=Math.pow(2,7),xue=Math.pow(2,14),Aue=Math.pow(2,21),Cue=Math.pow(2,28),Iue=Math.pow(2,35),kue=Math.pow(2,42),_ue=Math.pow(2,49),Tue=Math.pow(2,56),Pue=Math.pow(2,63),Due=function(r){return r<Sue?1:r<xue?2:r<Aue?3:r<Cue?4:r<Iue?5:r<kue?6:r<_ue?7:r<Tue?8:r<Pue?9:10},$ue={encode:mue,decode:vue,encodingLength:Due},Zy=$ue;function E7(r,e=0){return[Zy.decode(r,e),Zy.decode.bytes]}function em(r,e,t=0){return Zy.encode(r,e,t),e}function tm(r){return Zy.encodingLength(r)}function Nue(r,e){const t=e.byteLength,n=tm(r),i=n+tm(t),s=new Uint8Array(i+t);return em(r,s,0),em(t,s,n),s.set(e,i),new S7(r,t,e,s)}function Mue(r){const e=w7(r),[t,n]=E7(e),[i,s]=E7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new S7(t,i,o,e)}function Oue(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&aue(r.bytes,t.bytes)}}let S7=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function uM(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Lue(t,x7(r),e??wc.encoder);default:return Bue(t,x7(r),e??Xy.encoder)}}const dM=new WeakMap;function x7(r){const e=dM.get(r);if(e==null){const t=new Map;return dM.set(r,t),t}return e}let V1=class Jr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Pj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==K1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Uue)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Jr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Nue(e,t);return Jr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Jr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Oue(e.multihash,n.multihash)}toString(e){return uM(this,e)}toJSON(){return{"/":uM(this)}}link(){return this}[(Pj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Jr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Jr(n,i,s,o??hM(n,i,s.bytes))}else if(t[Fue]===!0){const{version:n,multihash:i,code:s}=t,o=Mue(i);return Jr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==K1)throw new Error(`Version 0 CID must use dag-pb (code: ${K1}) block encoding`);return new Jr(e,t,n,n.bytes)}case 1:{const i=hM(e,t,n.bytes);return new Jr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Jr.create(0,K1,e)}static createV1(e,t){return Jr.create(1,e,t)}static decode(e){const[t,n]=Jr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Jr.inspectBytes(e),n=t.size-t.multihashSize,i=w7(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new S7(t.multihashCode,t.digestSize,s,i);return[t.version===0?Jr.createV0(o):Jr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=E7(e.subarray(t));return t+=p,h};let i=n(),s=K1;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Rue(e,t),s=Jr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return x7(s).set(n,e),s}};function Rue(r,e){switch(r[0]){case"Q":{const t=e??wc;return[wc.prefix,t.decode(`${wc.prefix}${r}`)]}case wc.prefix:{const t=e??wc;return[wc.prefix,t.decode(r)]}case Xy.prefix:{const t=e??Xy;return[Xy.prefix,t.decode(r)]}case b7.prefix:{const t=e??b7;return[b7.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Lue(r,e,t){const{prefix:n}=t;if(n!==wc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Bue(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const K1=112,Uue=18;function hM(r,e,t){const n=tm(r),i=n+tm(e),s=new Uint8Array(i+t.byteLength);return em(r,s,0),em(e,s,n),s.set(t,i),s}const Fue=Symbol.for("@ipld/js-cid/CID"),zue=new TextDecoder;function A7(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");const i=r[e++];if(t+=n<28?(i&127)<<n:(i&127)*2**n,i<128)break}return[t,e]}function rm(r,e){let t;[t,e]=A7(r,e);const n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function fM(r,e){let t;return[t,e]=A7(r,e),[t&7,t>>3,e]}function Vue(r){const e={},t=r.length;let n=0;for(;n<t;){let i,s;if([i,s,n]=fM(r,n),s===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=rm(r,n)}else if(s===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=rm(r,n),e.Name=zue.decode(o)}else if(s===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(i!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Tsize`);[e.Tsize,n]=A7(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${s}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function Kue(r){const e=r.length;let t=0,n,i=!1,s;for(;t<e;){let a,c;if([a,c,t]=fM(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(s)throw new Error("protobuf: (PBNode) duplicate Data section");[s,t]=rm(r,t),n&&(i=!0)}else if(c===2){if(i)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let l;[l,t]=rm(r,t),n.push(Vue(l))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");const o={};return s&&(o.Data=s),o.Links=n||[],o}const pM=new TextEncoder,gM=2**32,jue=2**31;function Hue(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=j1(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){const n=pM.encode(r.Name);t-=n.length,e.set(n,t),t=j1(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=j1(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function que(r){const e=Gue(r),t=new Uint8Array(e);let n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=j1(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let i=r.Links.length-1;i>=0;i--){const s=Hue(r.Links[i],t.subarray(0,n));n-=s,n=j1(t,n,s)-1,t[n]=18}return t}function Wue(r){let e=0;if(r.Hash){const t=r.Hash.length;e+=1+t+Gd(t)}if(typeof r.Name=="string"){const t=pM.encode(r.Name).length;e+=1+t+Gd(t)}return typeof r.Tsize=="number"&&(e+=1+Gd(r.Tsize)),e}function Gue(r){let e=0;if(r.Data){const t=r.Data.length;e+=1+t+Gd(t)}if(r.Links)for(const t of r.Links){const n=Wue(t);e+=1+n+Gd(n)}return e}function j1(r,e,t){e-=Gd(t);const n=e;for(;t>=jue;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function Gd(r){return r%2===0&&r++,Math.floor((Que(r)+6)/7)}function Que(r){let e=0;return r>=gM&&(r=Math.floor(r/gM),e=32),r>=65536&&(r>>>=16,e+=16),r>=256&&(r>>>=8,e+=8),e+Yue[r]}const Yue=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],Jue=["Data","Links"],Xue=["Hash","Name","Tsize"],C7=new TextEncoder;function yM(r,e){if(r===e)return 0;const t=r.Name?C7.encode(r.Name):[],n=e.Name?C7.encode(e.Name):[];let i=t.length,s=n.length;for(let o=0,a=Math.min(i,s);o<a;++o)if(t[o]!==n[o]){i=t[o],s=n[o];break}return i<s?-1:s<i?1:0}function mM(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function wM(r){if(typeof r.asCID=="object"){const t=V1.asCID(r);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Hash){let t=V1.asCID(r.Hash);try{t||(typeof r.Hash=="string"?t=V1.parse(r.Hash):r.Hash instanceof Uint8Array&&(t=V1.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(e.Name=r.Name),typeof r.Tsize=="number"&&(e.Tsize=r.Tsize),e}function bM(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Data!==void 0)if(typeof r.Data=="string")e.Data=C7.encode(r.Data);else if(r.Data instanceof Uint8Array)e.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))e.Links=r.Links.map(wM),e.Links.sort(yM);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function vM(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!mM(r,Jue))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<r.Links.length;e++){const t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!mM(t,Xue))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash==null||!t.Hash["/"]||t.Hash["/"]!==t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0){if(typeof t.Tsize!="number"||t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&yM(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function Zue(r,e=[]){return bM({Data:r,Links:e})}function ede(r,e,t){return wM({Hash:t,Name:r,Tsize:e})}function tde(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}const rde="dag-pb",EM=112;function nde(r){vM(r);const e={};return r.Links&&(e.Links=r.Links.map(t=>{const n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),que(e)}function ide(r){const e=tde(r),t=Kue(e),n={};return t.Data&&(n.Data=t.Data),t.Links&&(n.Links=t.Links.map(i=>{const s={};try{s.Hash=V1.decode(i.Hash)}catch{}if(!s.Hash)throw new Error("Invalid Hash field found in link, expected CID");return i.Name!==void 0&&(s.Name=i.Name),i.Tsize!==void 0&&(s.Tsize=i.Tsize),s})),n}const sde=Object.freeze(Object.defineProperty({__proto__:null,code:EM,createLink:ede,createNode:Zue,decode:ide,encode:nde,name:rde,prepare:bM,validate:vM},Symbol.toStringTag,{value:"Module"})),ode=new TextEncoder,ade=new TextDecoder,cde="json",SM=512;function lde(r){return ode.encode(JSON.stringify(r))}function ude(r){return JSON.parse(ade.decode(r))}const dde=Object.freeze(Object.defineProperty({__proto__:null,code:SM,decode:ude,encode:lde,name:cde},Symbol.toStringTag,{value:"Module"})),hde="raw",xM=85;function fde(r){return qd(r)}function pde(r){return qd(r)}const gde=Object.freeze(Object.defineProperty({__proto__:null,code:xM,decode:pde,encode:fde,name:hde},Symbol.toStringTag,{value:"Module"}));function I7(r){return(r==null?void 0:r.then)!=null}function yde(r=[],e){const t={[EM]:sde,[xM]:gde,[oT]:Jf,[tM]:oue,[SM]:dde};return r.forEach(n=>{t[n.code]=n}),async n=>{let i=t[n];if(i==null&&e!=null){const s=e(n);I7(s)?i=await s:i=s,t[i.code]=i}if(i!=null)return i;throw new MN(`Could not load codec for ${n}`)}}const AM=0,mde="identity",CM=qd;function wde(r){return Vy(AM,CM(r))}const IM={code:AM,name:mde,encode:CM,digest:wde};function kM(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const _M=_N({name:"sha2-256",code:18,encode:kM("SHA-256")}),TM=_N({name:"sha2-512",code:19,encode:kM("SHA-512")});function bde(r=[],e){const t={[_M.code]:_M,[TM.code]:TM,[IM.code]:IM};return r.forEach(n=>{t[n.code]=n}),async n=>{let i=t[n];if(i==null&&e!=null){const s=e(n);I7(s)?i=await s:i=s,t[i.code]=i}if(i!=null)return i;throw new NN(`No hasher configured for multihash code 0x${n.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)}}const Wh=class Wh extends Error{constructor(t="Not Found"){super(t);u(this,"name",Wh.name);u(this,"code",Wh.code)}};u(Wh,"name","NotFoundError"),u(Wh,"code","ERR_NOT_FOUND");let H1=Wh;class PM{has(e,t){return Promise.reject(new Error(".has is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}async*putMany(e,t){for await(const{cid:n,block:i}of e)await this.put(n,i,t),yield n}get(e,t){return Promise.reject(new Error(".get is not implemented"))}async*getMany(e,t){for await(const n of e)yield{cid:n,block:await this.get(n,t)}}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(e,t){for await(const n of e)await this.delete(n,t),yield n}async*getAll(e){throw new Error(".getAll is not implemented")}}const nm=0;class vde extends PM{constructor(t){super();u(this,"child");this.child=t}put(t,n){return t.multihash.code===nm||this.child==null?t:this.child.put(t,n)}get(t){if(t.multihash.code===nm)return t.multihash.digest;if(this.child==null)throw new H1;return this.child.get(t)}has(t){return t.multihash.code===nm?!0:this.child==null?!1:this.child.has(t)}delete(t){if(t.code!==nm&&this.child!=null)return this.child.delete(t)}getAll(t){return this.child!=null?this.child.getAll(t):[]}}function Ede(r){return r[Symbol.asyncIterator]!=null}function Wl(r,e){let t=0;if(Ede(r))return async function*(){for await(const c of r)await e(c,t++)&&(yield c)}();const n=Pv(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof o.then=="function")return async function*(){await o&&(yield i);for await(const c of n)await e(c,t++)&&(yield c)}();const a=e;return function*(){o===!0&&(yield i);for(const c of n)a(c,t++)&&(yield c)}()}function Sde(r){return r[Symbol.asyncIterator]!=null}function DM(r){return(r==null?void 0:r.then)!=null}function im(r,e){let t=0;if(Sde(r))return async function*(){for await(const c of r){const l=e(c,t++);DM(l)&&await l,yield c}}();const n=Pv(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof(o==null?void 0:o.then)=="function")return async function*(){yield i;for await(const c of n){const l=e(c,t++);DM(l)&&await l,yield c}}();const a=e;return function*(){yield i;for(const c of n)a(c,t++),yield c}()}class $M{constructor(e){u(this,"child");u(this,"getHasher");u(this,"log");u(this,"logger");u(this,"components");this.log=e.logger.forComponent("helia:networked-storage"),this.logger=e.logger,this.components=e,this.child=new vde(e.blockstore),this.getHasher=e.getHasher}async put(e,t,n={}){var i,s,o;return await this.child.has(e,n)?((i=n.onProgress)==null||i.call(n,new _e("blocks:put:duplicate",e)),e):((s=n.onProgress)==null||s.call(n,new _e("blocks:put:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async a=>{var c;return(c=a.announce)==null?void 0:c.call(a,e,t,n)})),(o=n.onProgress)==null||o.call(n,new _e("blocks:put:blockstore:put",e)),this.child.put(e,t,n))}async*putMany(e,t={}){var s;const n=Wl(e,async({cid:o})=>{var c;const a=await this.child.has(o,t);return a&&((c=t.onProgress)==null||c.call(t,new _e("blocks:put-many:duplicate",o))),!a}),i=im(n,async({cid:o,block:a})=>{var c;(c=t.onProgress)==null||c.call(t,new _e("blocks:put-many:providers:notify",o)),await Promise.all(this.components.blockBrokers.map(async l=>{var d;return(d=l.announce)==null?void 0:d.call(l,o,a,t)}))});(s=t.onProgress)==null||s.call(t,new _e("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(i,t)}async get(e,t={}){var n,i,s,o;if(t.offline!==!0&&!await this.child.has(e,t)){const a=await this.getHasher(e.multihash.code);(n=t.onProgress)==null||n.call(t,new _e("blocks:get:providers:get",e));const c=await NM(e,this.components.blockBrokers,a,{...t,log:this.log});return(i=t.onProgress)==null||i.call(t,new _e("blocks:get:blockstore:put",e)),await this.child.put(e,c,t),(s=t.onProgress)==null||s.call(t,new _e("blocks:get:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async l=>{var d;return(d=l.announce)==null?void 0:d.call(l,e,c,t)})),c}return(o=t.onProgress)==null||o.call(t,new _e("blocks:get:blockstore:get",e)),this.child.get(e,t)}async*getMany(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new _e("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(im(e,async i=>{var s,o,a;if(t.offline!==!0&&!await this.child.has(i,t)){const c=await this.getHasher(i.multihash.code);(s=t.onProgress)==null||s.call(t,new _e("blocks:get-many:providers:get",i));const l=await NM(i,this.components.blockBrokers,c,{...t,log:this.log});(o=t.onProgress)==null||o.call(t,new _e("blocks:get-many:blockstore:put",i)),await this.child.put(i,l,t),(a=t.onProgress)==null||a.call(t,new _e("blocks:get-many:providers:notify",i)),await Promise.all(this.components.blockBrokers.map(async d=>{var h;return(h=d.announce)==null?void 0:h.call(d,i,l,t)}))}}))}async delete(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new _e("blocks:delete:blockstore:delete",e)),await this.child.delete(e,t)}async*deleteMany(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new _e("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(const i of e)yield i}(),t)}async has(e,t={}){return this.child.has(e,t)}async*getAll(e={}){var t;(t=e.onProgress)==null||t.call(e,new _e("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(e)}}class xde extends $M{constructor(t){super(t);u(this,"started");this.started=!1}isStarted(){return this.started}async start(){await ko(this.child,...this.components.blockBrokers),this.started=!0}async stop(){await Ga(this.child,...this.components.blockBrokers),this.started=!1}unwrap(){return this.child}createSession(t,n){const i=this.components.blockBrokers.map(s=>s.createSession==null?s:s.createSession(n));return new Ade({blockstore:this.child,blockBrokers:i,getHasher:this.getHasher,logger:this.logger},{root:t})}}class Ade extends $M{constructor(t,n){super(t);u(this,"closeController");this.closeController=new AbortController,this.closeController.signal,this.log=t.logger.forComponent(`helia:session-storage:${n.root}`)}close(){this.closeController.abort()}async put(t,n,i={}){const s=pt([this.closeController.signal,i.signal]);try{return await super.put(t,n,{...i,signal:s})}finally{s.clear()}}async*putMany(t,n={}){const i=pt([this.closeController.signal,n.signal]);try{yield*super.putMany(t,{...n,signal:i})}finally{i.clear()}}async get(t,n={}){const i=pt([this.closeController.signal,n.signal]);try{return await super.get(t,{...n,signal:i})}finally{i.clear()}}async*getMany(t,n={}){const i=pt([this.closeController.signal,n.signal]);try{yield*super.getMany(t,{...n,signal:i})}finally{i.clear()}}async delete(t,n={}){const i=pt([this.closeController.signal,n.signal]);try{await super.delete(t,{...n,signal:i})}finally{i.clear()}}async*deleteMany(t,n={}){const i=pt([this.closeController.signal,n.signal]);try{yield*super.deleteMany(t,{...n,signal:i})}finally{i.clear()}}async has(t,n={}){const i=pt([this.closeController.signal,n.signal]);try{return await super.has(t,{...n,signal:i})}finally{i.clear()}}async*getAll(t={}){const n=pt([this.closeController.signal,t.signal]);try{yield*super.getAll({...t,signal:n})}finally{n.clear()}}}function Cde(r){return typeof r.retrieve=="function"}const Ide=(r,e)=>{if(e==null)throw new Z(`No hasher configured for multihash code 0x${r.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`);return async t=>{let n;const i=e.digest(t);if(I7(i)?n=await i:n=i,!qe(n.digest,r.multihash.digest))throw new $2("Hash of downloaded block did not match multihash from passed CID")}};async function NM(r,e,t,n){const i=Ide(r,t),s=new AbortController,o=pt([s.signal,n.signal]);s.signal;const a=[];for(const c of e)Cde(c)&&a.push(c);try{return await Promise.any(a.map(async c=>{try{let l=!1;const d=await c.retrieve(r,{...n,signal:o,validateFn:async h=>{await i(h),l=!0}});return l||await i(d),d}catch(l){throw n.log.error("could not retrieve verified block for %c",r,l),l}}))}finally{s.abort(),o.clear()}}const kde=si({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});si({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),si({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),si({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});class MM extends er{constructor(t,n){super();u(this,"initialPeerSearchComplete");u(this,"requests");u(this,"name");u(this,"log");u(this,"logger");u(this,"minProviders");u(this,"maxProviders");u(this,"providers");u(this,"evictionFilter");this.name=n.name,this.logger=t.logger,this.log=t.logger.forComponent(this.name),this.requests=new Map,this.minProviders=n.minProviders??Zce,this.maxProviders=n.maxProviders??ele,this.providers=[],this.evictionFilter=zl(this.maxProviders)}async retrieve(t,n={}){const i=kde.encode(t.multihash.bytes),s=this.requests.get(i);if(s!=null)return this.log("join existing request for %c",t),s;const o=Le();if(this.requests.set(i,o.promise),this.providers.length===0){let d=!1;this.initialPeerSearchComplete==null&&(d=!0,this.log=this.logger.forComponent(`${this.name}:${t}`),this.initialPeerSearchComplete=this.findProviders(t,this.minProviders,n)),await this.initialPeerSearchComplete,d&&this.log("found initial session peers for %c",t)}let a=!1;const c=new Bl({concurrency:this.maxProviders});c.addEventListener("error",()=>{}),c.addEventListener("failure",d=>{this.log.error("error querying provider %o, evicting from session",d.detail.job.options.provider,d.detail.error),this.evict(d.detail.job.options.provider)}),c.addEventListener("success",d=>{a=!0,o.resolve(d.detail.result)}),c.addEventListener("idle",()=>{var d;a||((d=n.signal)==null?void 0:d.aborted)===!0||Promise.resolve().then(async()=>{this.log("no session peers had block for for %c, finding new providers",t);for(let h=0;h<this.minProviders&&this.providers.length!==0;h++){const p=this.providers[Math.floor(Math.random()*this.providers.length)];this.evict(p)}await this.findProviders(t,this.minProviders,n),this.log("found new providers re-retrieving %c",t),this.requests.delete(i),o.resolve(await this.retrieve(t,n))}).catch(h=>{this.log.error("could not find new providers for %c",t,h),o.reject(h)})});const l=d=>{c.add(async()=>this.queryProvider(t,d.detail,n),{provider:d.detail}).catch(h=>{var p;((p=n.signal)==null?void 0:p.aborted)!==!0&&this.log.error("error retrieving session block for %c",t,h)})};this.addEventListener("provider",l),Promise.all([...this.providers].map(async d=>c.add(async()=>this.queryProvider(t,d,n),{provider:d}))).catch(d=>{var h;((h=n.signal)==null?void 0:h.aborted)!==!0&&this.log.error("error retrieving session block for %c",t,d)});try{return await o.promise}finally{this.removeEventListener("provider",l),c.clear(),this.requests.delete(i)}}evict(t){this.evictionFilter.add(this.toEvictionKey(t));const n=this.providers.findIndex(i=>this.equals(i,t));n!==-1&&this.providers.splice(n,1)}isEvicted(t){return this.evictionFilter.has(this.toEvictionKey(t))}hasProvider(t){return!!(this.providers.find(n=>this.equals(n,t))!=null||this.isEvicted(t))}async findProviders(t,n,i){const s=Le();let o=0;return Promise.resolve().then(async()=>{var a;this.log("finding %d-%d new provider(s) for %c",n,this.maxProviders,t);for await(const c of this.findNewProviders(t,i)){if(o===this.maxProviders||((a=i.signal)==null?void 0:a.aborted)===!0)break;if(!this.hasProvider(c)&&(this.log("found %d/%d new providers",o,this.maxProviders),this.providers.push(c),this.safeDispatchEvent("provider",{detail:c}),o++,o===n&&(this.log("session is ready"),s.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",o);break}}if(this.log("found %d/%d new session peers",o,this.maxProviders),o<n)throw new $N(`Found ${o} of ${n} ${this.name} providers for ${t}`)}).catch(a=>{this.log.error("error searching routing for potential session peers for %c",t,a.errors??a),s.reject(a)}),s.promise}}class _de{constructor(e){u(this,"blockstore");u(this,"datastore");u(this,"pins");u(this,"logger");u(this,"routing");u(this,"getCodec");u(this,"getHasher");u(this,"dns");u(this,"metrics");u(this,"log");this.logger=e.logger??Oy(),this.log=this.logger.forComponent("helia"),this.getHasher=bde(e.hashers,e.loadHasher),this.getCodec=yde(e.codecs,e.loadCodec),this.dns=e.dns??wN(),this.metrics=e.metrics;const t={blockstore:e.blockstore,datastore:e.datastore,logger:this.logger,blockBrokers:[],getHasher:this.getHasher,getCodec:this.getCodec,dns:this.dns,metrics:this.metrics,...e.components??{}};this.routing=t.routing=new rle(t,{routers:(e.routers??[]).flatMap(i=>{const s=[i];return i[Ed]!=null&&s.push(i[Ed]),i[Sd]!=null&&s.push(i[Sd]),s}),providerLookupConcurrency:e.providerLookupConcurrency});const n=new xde(t);this.pins=new Xce(e.datastore,n,this.getCodec),this.blockstore=new cle(n,this.pins,{holdGcLock:e.holdGcLock??!0}),this.datastore=e.datastore,t.blockBrokers=e.blockBrokers.map(i=>i(t))}async start(){await lle(this.datastore),await ko(this.blockstore,this.datastore,this.routing)}async stop(){await Ga(this.blockstore,this.datastore,this.routing)}async gc(e={}){const t=await this.blockstore.lock.writeLock();try{const n=this,i=this.blockstore.unwrap();this.log("gc start"),await Eo(i.deleteMany(async function*(){var s,o;for await(const{cid:a}of i.getAll())try{if(await n.pins.isPinned(a,e))continue;yield a,(s=e.onProgress)==null||s.call(e,new _e("helia:gc:deleted",a))}catch(c){n.log.error("Error during gc",c),(o=e.onProgress)==null||o.call(e,new _e("helia:gc:error",c))}}()))}finally{t()}this.log("gc finished")}}class Tde extends MM{constructor(t,n){super(t,{...n,name:"helia:bitswap:session"});u(this,"wantList");u(this,"network");this.wantList=t.wantList,this.network=t.network}async queryProvider(t,n,i){this.log("sending WANT-BLOCK for %c to %p",t,n);const s=await this.wantList.wantSessionBlock(t,n,i);if(this.log("%p %s %c",n,s.has?"has":"does not have",t),s.has&&s.block!=null)return s.block;throw new Error("Provider did not have block")}async*findNewProviders(t,n={}){for await(const i of this.network.findProviders(t,n))yield i.id}toEvictionKey(t){return t.toMultihash().bytes}equals(t,n){return t.equals(n)}}function Pde(r,e){return new Tde(r,e)}class Dde{constructor(e){u(this,"blocksReceived");u(this,"duplicateBlocksReceived");u(this,"dataReceived");u(this,"duplicateDataReceived");var t,n,i,s;this.blocksReceived=(t=e.metrics)==null?void 0:t.registerMetricGroup("helia_bitswap_received_blocks"),this.duplicateBlocksReceived=(n=e.metrics)==null?void 0:n.registerMetricGroup("helia_bitswap_duplicate_received_blocks"),this.dataReceived=(i=e.metrics)==null?void 0:i.registerMetricGroup("helia_bitswap_data_received_bytes"),this.duplicateDataReceived=(s=e.metrics)==null?void 0:s.registerMetricGroup("helia_bitswap_duplicate_data_received_bytes")}updateBlocksReceived(e=1,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.blocksReceived)==null||i.increment(n)}updateDuplicateBlocksReceived(e=1,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.duplicateBlocksReceived)==null||i.increment(n)}updateDataReceived(e,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.dataReceived)==null||i.increment(n)}updateDuplicateDataReceived(e,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.duplicateDataReceived)==null||i.increment(n)}}class $de extends Map{constructor(t){super();u(this,"metric");const{name:n,metrics:i}=t;this.metric=i.registerMetric(n),this.updateComponentMetric()}set(t,n){return super.set(t,n),this.updateComponentMetric(),this}delete(t){const n=super.delete(t);return this.updateComponentMetric(),n}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function OM(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new $de({name:e,metrics:t}):n=new Map,n}function Nde({name:r,code:e,encode:t}){return new Mde(r,e,t)}let Mde=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Yv(this.code,t):t.then(n=>Yv(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Ode(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const RM=Nde({name:"sha2-256",code:18,encode:Ode("SHA-256")});function Rde(r){if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");const e=[];for(;r.length>0;){const t=Zi(r);e.push(t),r=r.slice(yt(t))}return e}class Lde extends er{constructor(t,n={}){super();u(this,"peers");u(this,"wants");u(this,"network");u(this,"log");u(this,"sendMessagesDelay");u(this,"sendMessagesTimeout");u(this,"hashLoader");u(this,"sendingMessages");this.peers=Z$({name:"helia_bitswap_peers",metrics:t.metrics}),this.wants=OM({name:"helia_bitswap_wantlist",metrics:t.metrics}),this.network=t.network,this.sendMessagesDelay=n.sendMessagesDelay??Xie,this.log=t.logger.forComponent("helia:bitswap:wantlist"),this.hashLoader=n.hashLoader,this.network.addEventListener("bitswap:message",i=>{this.receiveMessage(i.detail.peer,i.detail.message).catch(s=>{this.log.error("error receiving bitswap message from %p",i.detail.peer,s)})}),this.network.addEventListener("peer:connected",i=>{this.peerConnected(i.detail).catch(s=>{this.log.error("error processing newly connected bitswap peer %p",i.detail,s)})}),this.network.addEventListener("peer:disconnected",i=>{this.peerDisconnected(i.detail)})}async addEntry(t,n){var o;const i=re(t.multihash.bytes,"base64");let s=this.wants.get(i);s==null&&(s={cid:t,priority:n.priority??1,wantType:n.wantType??pr.WantBlock,cancel:!1,sendDontHave:!0},this.wants.set(i,s)),s.wantType===pr.WantHave&&n.wantType===pr.WantBlock&&(s.wantType=pr.WantBlock),await this.sendMessagesDebounced();try{return n.wantType===pr.WantBlock?(await Ti(this,"block",n==null?void 0:n.signal,{filter:l=>qe(t.multihash.digest,l.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail:(await Ti(this,"presence",n==null?void 0:n.signal,{filter:c=>qe(t.multihash.digest,c.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail}finally{((o=n.signal)==null?void 0:o.aborted)===!0&&(this.log("want for %c was aborted, cancelling want",t),s.cancel=!0,await this.sendMessagesDebounced())}}async sendMessagesDebounced(){var t;await((t=this.sendingMessages)==null?void 0:t.promise),clearTimeout(this.sendMessagesTimeout),this.sendMessagesTimeout=setTimeout(()=>{this.sendMessages().catch(n=>{this.log("error sending messages to peers",n)})},this.sendMessagesDelay)}async sendMessages(){this.sendingMessages=Le(),await Promise.all([...this.peers.entries()].map(async([t,n])=>{const i=new Set,s=new B1;for(const[o,a]of this.wants.entries())n.has(o)||a.cancel||(i.add(o),s.addWantlistEntry(a.cid,{cid:a.cid.bytes,priority:a.priority,wantType:a.wantType,cancel:a.cancel,sendDontHave:a.sendDontHave}));if(s.wantlist.size!==0)try{await this.network.sendMessage(t,s);for(const o of i)n.add(o)}catch(o){this.log.error("error sending full wantlist to new peer",o)}})).catch(t=>{this.log.error("error sending messages",t)});for(const[t,n]of this.wants)if(n.cancel){this.wants.delete(t);for(const i of this.peers.values())i.delete(t)}this.sendingMessages.resolve()}has(t){const n=re(t.multihash.bytes,"base64");return this.wants.has(n)}async wantSessionPresence(t,n,i={}){const s=new B1;return s.addWantlistEntry(t,{cid:t.bytes,sendDontHave:!0,wantType:pr.WantHave,priority:1}),await this.network.sendMessage(n,s),(await Ti(this,"presence",i.signal,{filter:a=>n.equals(a.detail.sender)&&qe(t.multihash.digest,a.detail.cid.multihash.digest)})).detail}async wantBlock(t,n={}){return this.addEntry(t,{...n,wantType:pr.WantBlock})}async wantSessionBlock(t,n,i={}){const s=new B1;return s.addWantlistEntry(t,{cid:t.bytes,sendDontHave:!0,wantType:pr.WantBlock,priority:1}),await this.network.sendMessage(n,s),(await Ti(this,"presence",i.signal,{filter:a=>n.equals(a.detail.sender)&&qe(t.multihash.digest,a.detail.cid.multihash.digest)})).detail}async receivedBlock(t,n){const i=re(t.multihash.bytes,"base64"),s=this.wants.get(i);s!=null&&(s.cancel=!0,await this.sendMessagesDebounced())}async receiveMessage(t,n){var s;this.log("received message from %p with %d blocks",t,n.blocks.length);let i=!1;for(const o of n.blocks){if(o.prefix==null||o.data==null)continue;const a=Rde(o.prefix),c=a[0],l=a[1],d=a[2],h=d===RM.code?RM:await((s=this.hashLoader)==null?void 0:s.getHasher(d));if(h==null){this.log.error("unknown hash algorithm",d);continue}let p=h.digest(o.data);p.then!=null&&(p=await p);const m=Zv.create(c===0?0:1,l,p);this.log("received block from %p for %c",t,m),this.safeDispatchEvent("block",{detail:{sender:t,cid:m,block:o.data}}),this.safeDispatchEvent("presence",{detail:{sender:t,cid:m,has:!0,block:o.data}});const f=re(m.multihash.bytes,"base64"),g=this.wants.get(f);g!=null&&(g.cancel=!0,i=!0)}for(const{cid:o,type:a}of n.blockPresences){const c=Zv.decode(o);this.log("received %s from %p for %c",a,t,c),this.safeDispatchEvent("presence",{detail:{sender:t,cid:c,has:a===Fs.HaveBlock}})}i&&await this.sendMessagesDebounced()}async peerConnected(t){const n=new Set,i=new B1(!0);for(const[s,o]of this.wants.entries())o.cancel||(n.add(s),i.addWantlistEntry(o.cid,{cid:o.cid.bytes,priority:1,wantType:pr.WantBlock,cancel:!1,sendDontHave:!1}));if(i.wantlist.size===0){this.peers.set(t,n);return}try{await this.network.sendMessage(t,i),this.peers.set(t,n)}catch(s){this.log.error("error sending full wantlist to new peer %p",t,s)}}peerDisconnected(t){this.peers.delete(t)}start(){}stop(){this.peers.clear(),clearTimeout(this.sendMessagesTimeout)}}class Bde{constructor(e,t={}){u(this,"log");u(this,"logger");u(this,"stats");u(this,"network");u(this,"blockstore");u(this,"peerWantLists");u(this,"wantList");this.logger=e.logger,this.log=e.logger.forComponent("helia:bitswap"),this.blockstore=e.blockstore,this.stats=new Dde(e),this.network=new lse(e,t),this.peerWantLists=new Cae({...e,network:this.network},t),this.wantList=new Lde({...e,network:this.network},t)}createSession(e={}){return Pde({wantList:this.wantList,network:this.network,logger:this.logger},e)}async want(e,t={}){const n=new AbortController,i=pt([n.signal,t.signal]);n.signal,this.network.findAndConnect(e,{...t,signal:i}).catch(s=>{n.signal.aborted||this.log.error("error during finding and connect for cid %c",e,s)});try{return(await this.wantList.wantBlock(e,{...t,signal:i})).block}finally{n.abort(),i.clear()}}async notify(e,t,n={}){await Promise.all([this.peerWantLists.receivedBlock(e,n),this.wantList.receivedBlock(e,n)])}getWantlist(){return[...this.wantList.wants.values()].filter(e=>!e.cancel).map(e=>({cid:e.cid,priority:e.priority,wantType:e.wantType}))}getPeerWantlist(e){return this.peerWantLists.wantListForPeer(e)}async start(){this.wantList.start(),await this.network.start()}async stop(){this.wantList.stop(),await this.network.stop()}}const Ude=(r,e={})=>new Bde(r,e);class Fde{constructor(e,t={}){u(this,"bitswap");u(this,"started");const{getHasher:n}=e;this.bitswap=Ude(e,{hashLoader:{getHasher:async i=>n(i)},...t}),this.started=!1}isStarted(){return this.started}async start(){await this.bitswap.start(),this.started=!0}async stop(){await this.bitswap.stop(),this.started=!1}async announce(e,t,n){await this.bitswap.notify(e,t,n)}async retrieve(e,t={}){return this.bitswap.want(e,t)}createSession(e){const t=this.bitswap.createSession(e);return{announce:async(n,i,s)=>{await this.bitswap.notify(n,i,s)},retrieve:async(n,i)=>t.retrieve(n,i)}}}function zde(r={}){return e=>new Fde(e,r)}class Vde{constructor(){u(this,"index",0);u(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,i){return this.readAtomically(()=>{let s=0,o=0;const a=this.peekChar();if(a===void 0)return;const c=a==="0",l=2**(8*i)-1;for(;;){const d=this.readAtomically(()=>{const h=this.readChar();if(h===void 0)return;const p=Number.parseInt(h,e);if(!Number.isNaN(p))return p});if(d===void 0)break;if(s*=e,s+=d,s>l||(o+=1,t!==void 0&&o>t))return}if(o!==0)return!n&&c&&o>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){const e=t=>{for(let n=0;n<t.length/2;n++){const i=n*2;if(n<t.length-3){const o=this.readSeparator(":",n,()=>this.readIPv4Addr());if(o!==void 0)return t[i]=o[0],t[i+1]=o[1],t[i+2]=o[2],t[i+3]=o[3],[i+4,!0]}const s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[i,!1];t[i]=s>>8,t[i+1]=s&255}return[t.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[n,i]=e(t);if(n===16)return t;if(i||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const s=new Uint8Array(14),o=16-(n+2),[a]=e(s.subarray(0,o));return t.set(s.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const LM=45,Kde=15,Qd=new Vde;function BM(r){if(!(r.length>Kde))return Qd.new(r).parseWith(()=>Qd.readIPv4Addr())}function UM(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>LM))return Qd.new(r).parseWith(()=>Qd.readIPv6Addr())}function sm(r,e=!1){if(r.includes("%")&&(r=r.split("%")[0]),r.length>LM)return;const t=Qd.new(r).parseWith(()=>Qd.readIPAddr());if(t)return e&&t.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,t[0],t[1],t[2],t[3]]):t}function Yd(r){return!!BM(r)}function k7(r){return!!UM(r)}function FM(r){return!!sm(r)}var zM;(function(){var r,e,t,n,i,s,o,a;a=function(c){var l,d,h,p;return l=(c&255<<24)>>>24,d=(c&255<<16)>>>16,h=(c&65280)>>>8,p=c&255,[l,d,h,p].join(".")},o=function(c){var l,d,h,p,m,f;for(l=[],h=p=0;p<=3&&c.length!==0;h=++p){if(h>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}f=e(c),m=f[0],d=f[1],c=c.substring(d),l.push(m)}if(c.length!==0)throw new Error("Invalid IP");switch(l.length){case 1:if(l[0]>4294967295)throw new Error("Invalid IP");return l[0]>>>0;case 2:if(l[0]>255||l[1]>16777215)throw new Error("Invalid IP");return(l[0]<<24|l[1])>>>0;case 3:if(l[0]>255||l[1]>255||l[2]>65535)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2])>>>0;case 4:if(l[0]>255||l[1]>255||l[2]>255||l[3]>255)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2]<<8|l[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},n=t("0"),s=t("a"),i=t("A"),e=function(c){var l,d,h,p,m;for(p=0,l=10,d="9",h=0,c.length>1&&c[h]==="0"&&(c[h+1]==="x"||c[h+1]==="X"?(h+=2,l=16):"0"<=c[h+1]&&c[h+1]<="9"&&(h++,l=8,d="7")),m=h;h<c.length;){if("0"<=c[h]&&c[h]<=d)p=p*l+(t(c[h])-n)>>>0;else if(l===16)if("a"<=c[h]&&c[h]<="f")p=p*l+(10+t(c[h])-s)>>>0;else if("A"<=c[h]&&c[h]<="F")p=p*l+(10+t(c[h])-i)>>>0;else break;else break;if(p>4294967295)throw new Error("too large");h++}if(h===m)throw new Error("empty octet");return[p,h]},r=function(){function c(l,d){var h,p,m;if(typeof l!="string")throw new Error("Missing `net' parameter");if(d||(m=l.split("/",2),l=m[0],d=m[1]),d||(d=32),typeof d=="string"&&d.indexOf(".")>-1){try{this.maskLong=o(d)}catch{throw new Error("Invalid mask: "+d)}for(h=p=32;p>=0;h=--p)if(this.maskLong===4294967295<<32-h>>>0){this.bitmask=h;break}}else if(d||d===0)this.bitmask=parseInt(d,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(o(l)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+l)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+d);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(l){return typeof l=="string"&&(l.indexOf("/")>0||l.split(".").length!==4)&&(l=new c(l)),l instanceof c?this.contains(l.base)&&this.contains(l.broadcast||l.last):(o(l)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(l){return l==null&&(l=1),new c(a(this.netLong+this.size*l),this.mask)},c.prototype.forEach=function(l){var d,h,p;for(p=o(this.first),h=o(this.last),d=0;p<=h;)l(a(p),p,d),d++,p++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),zM=r}).call(it);const jde=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"].map(r=>new zM(r));function _7(r){for(const e of jde)if(e.contains(r))return!0;return!1}function Hde(r){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(r)}function qde(r){const e=r.split(":");if(e.length<2)return!1;const t=e[e.length-1].padStart(4,"0"),n=e[e.length-2].padStart(4,"0"),i=`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(t.substring(0,2),16)}.${parseInt(t.substring(2),16)}`;return _7(i)}function Wde(r){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)}function Gde(r){const e=r.split(":"),t=e[e.length-1];return _7(t)}function Qde(r){return/^::$/.test(r)||/^::1$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}function bc(r){return Yd(r)?_7(r):Hde(r)?qde(r):Wde(r)?Gde(r):k7(r)?Qde(r):void 0}function Yde(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Jde(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var Xde=Jde,Zde=Xde;let ehe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},the=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return VM(this,e)}},rhe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return VM(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function VM(r,e){return new rhe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let nhe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new ehe(e,t,n),this.decoder=new the(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function KM({name:r,prefix:e,encode:t,decode:n}){return new nhe(r,e,t,n)}function jM({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Zde(t,r);return KM({prefix:e,name:r,encode:n,decode:s=>Yde(i(s))})}function ihe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function she(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function om({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return KM({prefix:e,name:r,encode(i){return she(i,n,t)},decode(i){return ihe(i,n,t,r)}})}const ohe=jM({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});jM({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),om({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),om({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});const ahe=om({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});om({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const che=r=>r.toString().split("/").slice(1),q1=r=>({match:e=>e.length<1?!1:r(e[0])?e.slice(1):!1,pattern:"fn"}),Qe=r=>({match:e=>q1(t=>t===r).match(e),pattern:r}),Jd=()=>({match:r=>q1(e=>typeof e=="string").match(r),pattern:"{string}"}),am=()=>({match:r=>q1(e=>!isNaN(parseInt(e))).match(r),pattern:"{number}"}),wt=()=>({match:r=>{if(r.length<2||r[0]!=="p2p"&&r[0]!=="ipfs")return!1;if(r[1].startsWith("Q")||r[1].startsWith("1"))try{ohe.decode(`z${r[1]}`)}catch{return!1}else return!1;return r.slice(2)},pattern:"/p2p/{peerid}"}),cm=()=>({match:r=>{if(r.length<2||r[0]!=="certhash")return!1;try{ahe.decode(r[1])}catch{return!1}return r.slice(2)},pattern:"/certhash/{certhash}"}),dt=r=>({match:e=>{const t=r.match(e);return t===!1?e:t},pattern:`optional(${r.pattern})`}),fn=(...r)=>({match:e=>{let t;for(const n of r){const i=n.match(e);i!==!1&&(t==null||i.length<t.length)&&(t=i)}return t??!1},pattern:`or(${r.map(e=>e.pattern).join(", ")})`}),et=(...r)=>({match:e=>{for(const t of r){const n=t.match(e);if(n===!1)return!1;e=n}return e},pattern:`and(${r.map(e=>e.pattern).join(", ")})`});function At(...r){function e(i){let s=che(i);for(const o of r){const a=o.match(s);if(a===!1)return!1;s=a}return s}function t(i){return e(i)!==!1}function n(i){const s=e(i);return s===!1?!1:s.length===0}return{matchers:r,matches:t,exactMatch:n}}const lhe=wt(),uhe=At(lhe),lm=et(Qe("dns4"),Jd()),um=et(Qe("dns6"),Jd()),dm=et(Qe("dnsaddr"),Jd()),T7=et(Qe("dns"),Jd());At(lm,dt(wt())),At(um,dt(wt())),At(dm,dt(wt()));const HM=At(fn(T7,dm,lm,um),dt(wt())),qM=et(Qe("ip4"),q1(Yd)),WM=et(Qe("ip6"),q1(k7)),P7=fn(qM,WM),Lo=fn(P7,T7,lm,um,dm),dhe=At(fn(P7,et(fn(T7,dm,lm,um),dt(wt())))),GM=At(qM),QM=At(WM),hhe=At(P7),D7=et(Lo,Qe("tcp"),am()),W1=et(Lo,Qe("udp"),am()),hm=At(et(D7,dt(wt())));At(W1);const $7=et(W1,Qe("quic"),dt(wt())),fm=et(W1,Qe("quic-v1"),dt(wt())),fhe=fn($7,fm);At($7);const phe=At(fm),N7=fn(Lo,D7,W1,$7,fm),YM=fn(et(N7,Qe("ws"),dt(wt()))),G1=At(YM),JM=fn(et(N7,Qe("wss"),dt(wt())),et(N7,Qe("tls"),dt(et(Qe("sni"),Jd())),Qe("ws"),dt(wt()))),pm=At(JM),XM=et(W1,Qe("webrtc-direct"),dt(cm()),dt(cm()),dt(wt())),M7=At(XM),ZM=et(fm,Qe("webtransport"),dt(cm()),dt(cm()),dt(wt())),eO=At(ZM),gm=fn(YM,JM,et(D7,dt(wt())),et(fhe,dt(wt())),et(Lo,dt(wt())),XM,ZM,wt()),tO=At(gm),ghe=et(gm,Qe("p2p-circuit"),wt()),vc=At(ghe),yhe=fn(et(gm,Qe("p2p-circuit"),Qe("webrtc"),dt(wt())),et(gm,Qe("webrtc"),dt(wt())),et(Qe("webrtc"),dt(wt()))),O7=At(yhe),mhe=fn(et(Lo,Qe("tcp"),am(),Qe("http"),dt(wt())),et(Lo,Qe("http"),dt(wt()))),whe=At(mhe),bhe=fn(et(Lo,Qe("tcp"),fn(et(Qe("443"),Qe("http")),et(am(),Qe("https"))),dt(wt())),et(Lo,Qe("tls"),Qe("http"),dt(wt())),et(Lo,Qe("https"),dt(wt()))),vhe=At(bhe),Ehe=fn(et(Qe("memory"),Jd(),dt(wt())));At(Ehe);function She(r,e,t){let n=0;for(const i of r)if(!(n<e)){if(n>t)break;if(i!==255)return!1;n++}return!0}function xhe(r,e,t,n){let i=0;for(const s of r)if(!(i<t)){if(i>n)break;if(s!==e[i])return!1;i++}return!0}function Ahe(r){switch(r.length){case Q1:return r.join(".");case Y1:{const e=[];for(let t=0;t<r.length;t++)t%2===0&&e.push(r[t].toString(16).padStart(2,"0")+r[t+1].toString(16).padStart(2,"0"));return e.join(":")}default:throw new Error("Invalid ip length")}}function Che(r){let e=0;for(let[t,n]of r.entries()){if(n===255){e+=8;continue}for(;n&128;)e++,n=n<<1;if(n&128)return-1;for(let i=t+1;i<r.length;i++)if(r[i]!=0)return-1;break}return e}function Ihe(r){let e="0x";for(const t of r)e+=(t>>4).toString(16)+(t&15).toString(16);return e}const Q1=4,Y1=16,khe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function rO(r,e){e.length===Y1&&r.length===Q1&&She(e,0,11)&&(e=e.slice(12)),e.length===Q1&&r.length===Y1&&xhe(r,khe,0,11)&&(r=r.slice(12));const t=r.length;if(t!=e.length)throw new Error("Failed to mask ip");const n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=r[i]&e[i];return n}function _he(r,e){if(typeof e=="string"&&(e=sm(e)),e==null)throw new Error("Invalid ip");if(e.length!==r.network.length)return!1;for(let t=0;t<e.length;t++)if((r.network[t]&r.mask[t])!==(e[t]&r.mask[t]))return!1;return!0}function The(r){const[e,t]=r.split("/");if(!e||!t)throw new Error("Failed to parse given CIDR: "+r);let n=Q1,i=BM(e);if(i==null&&(n=Y1,i=UM(e),i==null))throw new Error("Failed to parse given CIDR: "+r);const s=parseInt(t,10);if(Number.isNaN(s)||String(s).length!==t.length||s<0||s>n*8)throw new Error("Failed to parse given CIDR: "+r);const o=nO(s,8*n);return{network:rO(i,o),mask:o}}function nO(r,e){if(e!==8*Q1&&e!==8*Y1)throw new Error("Invalid CIDR mask");if(r<0||r>e)throw new Error("Invalid CIDR mask");const t=e/8,n=new Uint8Array(t);for(let i=0;i<t;i++){if(r>=8){n[i]=255,r-=8;continue}n[i]=255-(255>>r),r=0}return n}class iO{constructor(e,t){if(t==null)({network:this.network,mask:this.mask}=The(e));else{const n=sm(e);if(n==null)throw new Error("Failed to parse network");t=String(t);const i=parseInt(t,10);if(Number.isNaN(i)||String(i).length!==t.length||i<0||i>n.length*8){const s=sm(t);if(s==null)throw new Error("Failed to parse mask");this.mask=s}else this.mask=nO(i,8*n.length);this.network=rO(n,this.mask)}}contains(e){return _he({network:this.network,mask:this.mask},e)}toString(){const e=Che(this.mask),t=e!==-1?String(e):Ihe(this.mask);return Ahe(this.network)+"/"+t}}function Phe(r,e){return new iO(r).contains(e)}function Dhe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function R7(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function $he(r){return new TextEncoder().encode(r)}function Nhe(r){return new TextDecoder().decode(r)}function Mhe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var Ohe=Mhe,Rhe=Ohe;let Lhe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Bhe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return sO(this,e)}},Uhe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return sO(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function sO(r,e){return new Uhe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Fhe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Lhe(e,t,n),this.decoder=new Bhe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function ym({name:r,prefix:e,encode:t,decode:n}){return new Fhe(r,e,t,n)}function J1({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Rhe(t,r);return ym({prefix:e,name:r,encode:n,decode:s=>R7(i(s))})}function zhe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Vhe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function xr({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return ym({prefix:e,name:r,encode(i){return Vhe(i,n,t)},decode(i){return zhe(i,n,t,r)}})}const Gl=xr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Khe=xr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),jhe=xr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Hhe=xr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),qhe=xr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Whe=xr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ghe=xr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Qhe=xr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Yhe=xr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Jhe=Object.freeze(Object.defineProperty({__proto__:null,base32:Gl,base32hex:qhe,base32hexpad:Ghe,base32hexpadupper:Qhe,base32hexupper:Whe,base32pad:jhe,base32padupper:Hhe,base32upper:Khe,base32z:Yhe},Symbol.toStringTag,{value:"Module"})),ns=J1({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Xhe=J1({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Zhe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:ns,base58flickr:Xhe},Symbol.toStringTag,{value:"Module"})),efe=J1({prefix:"9",name:"base10",alphabet:"0123456789"}),tfe=Object.freeze(Object.defineProperty({__proto__:null,base10:efe},Symbol.toStringTag,{value:"Module"})),rfe=xr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),nfe=xr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),ife=Object.freeze(Object.defineProperty({__proto__:null,base16:rfe,base16upper:nfe},Symbol.toStringTag,{value:"Module"})),sfe=xr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),ofe=Object.freeze(Object.defineProperty({__proto__:null,base2:sfe},Symbol.toStringTag,{value:"Module"})),oO=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),afe=oO.reduce((r,e,t)=>(r[t]=e,r),[]),cfe=oO.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function lfe(r){return r.reduce((e,t)=>(e+=afe[t],e),"")}function ufe(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const i=cfe[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const dfe=ym({prefix:"🚀",name:"base256emoji",encode:lfe,decode:ufe}),hfe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:dfe},Symbol.toStringTag,{value:"Module"})),mm=J1({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ffe=J1({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),pfe=Object.freeze(Object.defineProperty({__proto__:null,base36:mm,base36upper:ffe},Symbol.toStringTag,{value:"Module"})),gfe=xr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),yfe=xr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),mfe=xr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),wfe=xr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),bfe=Object.freeze(Object.defineProperty({__proto__:null,base64:gfe,base64pad:yfe,base64url:mfe,base64urlpad:wfe},Symbol.toStringTag,{value:"Module"})),vfe=xr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Efe=Object.freeze(Object.defineProperty({__proto__:null,base8:vfe},Symbol.toStringTag,{value:"Module"})),Sfe=ym({prefix:"\0",name:"identity",encode:r=>Nhe(r),decode:r=>$he(r)}),xfe=Object.freeze(Object.defineProperty({__proto__:null,identity:Sfe},Symbol.toStringTag,{value:"Module"}));new TextEncoder,new TextDecoder;var Afe=cO,aO=128,Cfe=-128,Ife=Math.pow(2,31);function cO(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Ife;)e[t++]=r&255|aO,r/=128;for(;r&Cfe;)e[t++]=r&255|aO,r>>>=7;return e[t]=r|0,cO.bytes=t-n+1,e}var kfe=L7,_fe=128,lO=127;function L7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw L7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&lO)<<i:(o&lO)*Math.pow(2,i),i+=7}while(o>=_fe);return L7.bytes=s-n,t}var Tfe=Math.pow(2,7),Pfe=Math.pow(2,14),Dfe=Math.pow(2,21),$fe=Math.pow(2,28),Nfe=Math.pow(2,35),Mfe=Math.pow(2,42),Ofe=Math.pow(2,49),Rfe=Math.pow(2,56),Lfe=Math.pow(2,63),Bfe=function(r){return r<Tfe?1:r<Pfe?2:r<Dfe?3:r<$fe?4:r<Nfe?5:r<Mfe?6:r<Ofe?7:r<Rfe?8:r<Lfe?9:10},Ufe={encode:Afe,decode:kfe,encodingLength:Bfe},wm=Ufe;function B7(r,e=0){return[wm.decode(r,e),wm.decode.bytes]}function bm(r,e,t=0){return wm.encode(r,e,t),e}function vm(r){return wm.encodingLength(r)}function Ffe(r,e){const t=e.byteLength,n=vm(r),i=n+vm(t),s=new Uint8Array(i+t);return bm(r,s,0),bm(t,s,n),s.set(e,i),new U7(r,t,e,s)}function uO(r){const e=R7(r),[t,n]=B7(e),[i,s]=B7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new U7(t,i,o,e)}function zfe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Dhe(r.bytes,t.bytes)}}let U7=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function dO(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Kfe(t,F7(r),e??ns.encoder);default:return jfe(t,F7(r),e??Gl.encoder)}}const hO=new WeakMap;function F7(r){const e=hO.get(r);if(e==null){const t=new Map;return hO.set(r,t),t}return e}let fO=class Xr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Dj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==X1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Hfe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Xr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Ffe(e,t);return Xr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Xr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&zfe(e.multihash,n.multihash)}toString(e){return dO(this,e)}toJSON(){return{"/":dO(this)}}link(){return this}[(Dj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Xr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Xr(n,i,s,o??pO(n,i,s.bytes))}else if(t[qfe]===!0){const{version:n,multihash:i,code:s}=t,o=uO(i);return Xr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==X1)throw new Error(`Version 0 CID must use dag-pb (code: ${X1}) block encoding`);return new Xr(e,t,n,n.bytes)}case 1:{const i=pO(e,t,n.bytes);return new Xr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Xr.create(0,X1,e)}static createV1(e,t){return Xr.create(1,e,t)}static decode(e){const[t,n]=Xr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Xr.inspectBytes(e),n=t.size-t.multihashSize,i=R7(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new U7(t.multihashCode,t.digestSize,s,i);return[t.version===0?Xr.createV0(o):Xr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=B7(e.subarray(t));return t+=p,h};let i=n(),s=X1;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Vfe(e,t),s=Xr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return F7(s).set(n,e),s}};function Vfe(r,e){switch(r[0]){case"Q":{const t=e??ns;return[ns.prefix,t.decode(`${ns.prefix}${r}`)]}case ns.prefix:{const t=e??ns;return[ns.prefix,t.decode(r)]}case Gl.prefix:{const t=e??Gl;return[Gl.prefix,t.decode(r)]}case mm.prefix:{const t=e??mm;return[mm.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Kfe(r,e,t){const{prefix:n}=t;if(n!==ns.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function jfe(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const X1=112,Hfe=18;function pO(r,e,t){const n=vm(r),i=n+vm(e),s=new Uint8Array(i+t.byteLength);return bm(r,s,0),bm(e,s,n),s.set(t,i),s}const qfe=Symbol.for("@ipld/js-cid/CID"),Wfe={...xfe,...ofe,...Efe,...tfe,...ife,...Jhe,...pfe,...Zhe,...bfe,...hfe},gO=Yd,Gfe=k7,yO=function(r){let e=0;if(r=r.toString().trim(),gO(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(Gfe(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const s=gO(t[n]);let o;s&&(o=yO(t[n]),t[n]=re(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,re(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const s=[n,1];for(n=9-t.length;n>0;n--)s.push("0");t.splice.apply(t,s)}const i=new Uint8Array(e+16);for(n=0;n<t.length;n++){const s=parseInt(t[n],16);i[e++]=s>>8&255,i[e++]=s&255}return i}throw new Error("invalid ip address")},Qfe=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const i=[];for(let s=0;s<t;s++)i.push(r[e+s]);return i.join(".")}if(t===16){const i=[];for(let s=0;s<t;s+=2)i.push(n.getUint16(e+s).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},ai=-1,Z1={},z7={};[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,ai,"ip6zone"],[43,8,"ipcidr"],[53,ai,"dns",!0],[54,ai,"dns4",!0],[55,ai,"dns6",!0],[56,ai,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,ai,"unix",!1,!0],[421,ai,"ipfs"],[421,ai,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,ai,"garlic64"],[448,0,"tls"],[449,ai,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,ai,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,ai,"http-path"],[777,ai,"memory"]].forEach(r=>{const e=Yfe(...r);z7[e.code]=e,Z1[e.name]=e});function Yfe(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:!!n,path:!!i}}function ze(r){if(typeof r=="number"){if(z7[r]!=null)return z7[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(Z1[r]!=null)return Z1[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}const Jfe=ze("ip4"),Xfe=ze("ip6"),Zfe=ze("ipcidr");function V7(r,e){switch(ze(r).code){case 4:case 41:return r1e(e);case 42:return q7(e);case 43:return re(e,"base10");case 6:case 273:case 33:case 132:return bO(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return q7(e);case 421:return o1e(e);case 444:return vO(e);case 445:return vO(e);case 466:return s1e(e);case 481:return globalThis.encodeURIComponent(q7(e));default:return re(e,"base16")}}function mO(r,e){switch(ze(r).code){case 4:return wO(e);case 41:return wO(e);case 42:return H7(e);case 43:return se(e,"base10");case 6:case 273:case 33:case 132:return j7(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return H7(e);case 421:return n1e(e);case 444:return a1e(e);case 445:return c1e(e);case 466:return i1e(e);case 481:return H7(globalThis.decodeURIComponent(e));default:return se(e,"base16")}}function e1e(r){let e,t;if(r.stringTuples().forEach(([n,i])=>{(n===Jfe.code||n===Xfe.code)&&(t=i),n===Zfe.code&&(e=i)}),e==null||t==null)throw new Error("Invalid multiaddr");return new iO(t,e)}const K7=Object.values(Wfe).map(r=>r.decoder),t1e=function(){let r=K7[0].or(K7[1]);return K7.slice(2).forEach(e=>r=r.or(e)),r}();function wO(r){if(!FM(r))throw new Error("invalid ip address");return yO(r)}function r1e(r){const e=Qfe(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!FM(e))throw new Error("invalid ip address");return e}function j7(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function bO(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function H7(r){const e=se(r),t=Uint8Array.from(Sr(e.length));return or([t,e],t.length+e.length)}function q7(r){const e=Zi(r);if(r=r.slice(yt(e)),r.length!==e)throw new Error("inconsistent lengths");return re(r)}function n1e(r){let e;r[0]==="Q"||r[0]==="1"?e=uO(ns.decode(`z${r}`)).bytes:e=fO.parse(r).multihash.bytes;const t=Uint8Array.from(Sr(e.length));return or([t,e],t.length+e.length)}function i1e(r){const e=t1e.decode(r),t=Uint8Array.from(Sr(e.length));return or([t,e],t.length+e.length)}function s1e(r){const e=Zi(r),t=r.slice(yt(e));if(t.length!==e)throw new Error("inconsistent lengths");return"u"+re(t,"base64url")}function o1e(r){const e=Zi(r),t=r.slice(yt(e));if(t.length!==e)throw new Error("inconsistent lengths");return re(t,"base58btc")}function a1e(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Gl.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=j7(n);return or([t,i],t.length+i.length)}function c1e(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=Gl.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=j7(n);return or([t,i],t.length+i.length)}function vO(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=re(e,"base32"),i=bO(t);return`${n}:${i}`}function l1e(r){r=W7(r);const e=[],t=[];let n=null;const i=r.split("/").slice(1);if(i.length===1&&i[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<i.length;s++){const o=i[s],a=ze(o);if(a.size===0){e.push([a.code]),t.push([a.code]);continue}if(s++,s>=i.length)throw new G7("invalid address: "+r);if(a.path===!0){n=W7(i.slice(s).join("/")),e.push([a.code,mO(a.code,n)]),t.push([a.code,n]);break}const c=mO(a.code,i[s]);e.push([a.code,c]),t.push([a.code,V7(a.code,c)])}return{string:SO(t),bytes:xO(e),tuples:e,stringTuples:t,path:n}}function EO(r){const e=[],t=[];let n=null,i=0;for(;i<r.length;){const s=Zi(r,i),o=yt(s),a=ze(s),c=u1e(a,r.slice(i+o));if(c===0){e.push([s]),t.push([s]),i+=o;continue}const l=r.slice(i+o,i+o+c);if(i+=c+o,i>r.length)throw new G7("Invalid address Uint8Array: "+re(r,"base16"));e.push([s,l]);const d=V7(s,l);if(t.push([s,d]),a.path===!0){n=d;break}}return{bytes:Uint8Array.from(r),string:SO(t),tuples:e,stringTuples:t,path:n}}function SO(r){const e=[];return r.map(t=>{const n=ze(t[0]);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),W7(e.join("/"))}function xO(r){return or(r.map(e=>{const t=ze(e[0]);let n=Uint8Array.from(Sr(t.code));return e.length>1&&e[1]!=null&&(n=or([n,e[1]])),n}))}function u1e(r,e){if(r.size>0)return r.size/8;if(r.size===0)return 0;{const t=Zi(e instanceof Uint8Array?e:Uint8Array.from(e));return t+yt(t)}}function W7(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}class G7 extends Error{constructor(t){super(`Error parsing address: ${t}`);u(this,"name","ParseError")}}u(G7,"name","ParseError");const d1e=Symbol.for("nodejs.util.inspect.custom"),AO=Symbol.for("@multiformats/js-multiaddr/multiaddr"),h1e=[ze("dns").code,ze("dns4").code,ze("dns6").code,ze("dnsaddr").code];class f1e extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}const Qh=class Qh{constructor(e){u(this,"bytes");Je(this,Gh);Je(this,Hc);Je(this,u0);Je(this,d0);u(this,$j,!0);e==null&&(e="");let t;if(e instanceof Uint8Array)t=EO(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=l1e(e)}else if(Em(e))t=EO(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,_t(this,Gh,t.string),_t(this,Hc,t.tuples),_t(this,u0,t.stringTuples),_t(this,d0,t.path)}toString(){return oe(this,Gh)}toJSON(){return this.toString()}toOptions(){let e,t,n,i,s="";const o=ze("tcp"),a=ze("udp"),c=ze("ip4"),l=ze("ip6"),d=ze("dns6"),h=ze("ip6zone");for(const[m,f]of this.stringTuples())m===h.code&&(s=`%${f??""}`),h1e.includes(m)&&(t=o.name==="tcp"?"tcp":"udp",i=443,n=`${f??""}${s}`,e=m===d.code?6:4),(m===o.code||m===a.code)&&(t=ze(m).name==="tcp"?"tcp":"udp",i=parseInt(f??"")),(m===c.code||m===l.code)&&(t=ze(m).name==="tcp"?"tcp":"udp",n=`${f??""}${s}`,e=m===l.code?6:4);if(e==null||t==null||n==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:i}}protos(){return oe(this,Hc).map(([e])=>Object.assign({},ze(e)))}protoCodes(){return oe(this,Hc).map(([e])=>e)}protoNames(){return oe(this,Hc).map(([e])=>ze(e).name)}tuples(){return oe(this,Hc).map(([e,t])=>t==null?[e]:[e,t])}stringTuples(){return oe(this,u0).map(([e,t])=>t==null?[e]:[e,t])}encapsulate(e){return e=new Qh(e),new Qh(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Qh(n.slice(0,i))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new Qh(xO(t.slice(0,n)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([n,i])=>{n===Z1.p2p.code&&e.push([n,i]),n===Z1["p2p-circuit"].code&&(e=[])});const t=e.pop();if((t==null?void 0:t[1])!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?re(ns.decode(`z${n}`),"base58btc"):re(fO.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return oe(this,d0)}equals(e){return qe(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(s=>s.resolvable);if(t==null)return[this];const n=Y7.get(t.name);if(n==null)throw new f1e(`no available resolver for ${t.name}`);return(await n(this,e)).map(s=>Re(s))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[($j=AO,d1e)](){return`Multiaddr(${oe(this,Gh)})`}};Gh=new WeakMap,Hc=new WeakMap,u0=new WeakMap,d0=new WeakMap;let Q7=Qh;const Y7=new Map;function Em(r){return!!(r!=null&&r[AO])}function Re(r){return new Q7(r)}const p1e=[ze("tcp").code,ze("dns").code,ze("dnsaddr").code,ze("dns4").code,ze("dns6").code];function CO(r){var e;return(e=kO("sni",r))==null?void 0:e[1]}function IO(r){var t;const e=(t=kO("tcp",r))==null?void 0:t[1];return e==null?"":`:${e}`}function kO(r,e){let t;try{t=ze(r).code}catch{return}for(const[n,i]of e)if(n===t&&i!=null)return[n,i]}function _O(r){return r.some(([e,t])=>e===ze("tls").code)}function is(r,e,t){const n=TO[ze(r).name];if(n==null)throw new Error(`Can't interpret protocol ${ze(r).name}`);const i=n(e,t);return r===ze("ip6").code?`[${i}]`:i}const TO={ip4:(r,e)=>r,ip6:(r,e)=>e.length===0?r:`[${r}]`,tcp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`tcp://${is(t[0],t[1]??"",e)}:${r}`},udp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`udp://${is(t[0],t[1]??"",e)}:${r}`},dnsaddr:(r,e)=>r,dns4:(r,e)=>r,dns6:(r,e)=>r,dns:(r,e)=>r,ipfs:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${is(t[0],t[1]??"",e)}`},p2p:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${is(t[0],t[1]??"",e)}`},http:(r,e)=>{const t=_O(e),n=CO(e),i=IO(e);if(t&&n!=null)return`https://${n}${i}`;const s=t?"https://":"http://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=is(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${s}${a}`},"http-path":(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");const n=is(t[0],t[1]??"",e),i=decodeURIComponent(r);return`${n}/${i}`},tls:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return is(t[0],t[1]??"",e)},sni:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return is(t[0],t[1]??"",e)},https:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=is(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`https://${n}`},ws:(r,e)=>{const t=_O(e),n=CO(e),i=IO(e);if(t&&n!=null)return`wss://${n}${i}`;const s=t?"wss://":"ws://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=is(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${s}${a}`},wss:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=is(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`wss://${n}`}};function PO(r,e){const n=Re(r).stringTuples(),i=n.pop();if(i==null)throw new Error("Unexpected end of multiaddr");const s=ze(i[0]),o=TO[s.name];if(o==null)throw new Error(`No interpreter found for ${s.name}`);let a=o(i[1]??"",n);return p1e.includes(i[0])&&(a=a.replace(/^.*:\/\//,""),i[1]==="443"?a=`https://${a}`:a=`http://${a}`),(a.startsWith("http://")||a.startsWith("https://")||a.startsWith("ws://")||a.startsWith("wss://"))&&(a=new URL(a).toString(),a.endsWith("/")&&(a=a.substring(0,a.length-1))),a}let g1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},y1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return DO(this,e)}},m1e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return DO(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function DO(r,e){return new m1e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let w1e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new g1e(e,t,n),this.decoder=new y1e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function b1e({name:r,prefix:e,encode:t,decode:n}){return new w1e(r,e,t,n)}function v1e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function E1e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Sm({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return b1e({prefix:e,name:r,encode(i){return E1e(i,n,t)},decode(i){return v1e(i,n,t,r)}})}const S1e=Sm({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Sm({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Sm({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Sm({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});class x1e{constructor(e,{logger:t,transformRequestInit:n}){Je(this,$4);u(this,"url");Je(this,Cu,0);Je(this,Iu,0);Je(this,Yh,0);Je(this,Jh,0);Je(this,ku,new Map);u(this,"log");u(this,"transformRequestInit");this.url=e instanceof URL?e:new URL(e),this.transformRequestInit=n,this.log=t.forComponent(`helia:trustless-gateway-block-broker:${this.url.hostname}`)}async getRawBlock(e,t){const n=new URL(this.url.toString());if(n.pathname=`/ipfs/${e.toString()}`,n.search="?format=raw",(t==null?void 0:t.aborted)===!0)throw new Error(`Signal to fetch raw block for CID ${e} from gateway ${this.url} was aborted prior to fetch`);const i=Ie(this,$4,XH).call(this,e),s=new AbortController,o=()=>{s.abort()};t==null||t.addEventListener("abort",o);try{let a=oe(this,ku).get(i);if(a==null){no(this,Cu)._++;const c={signal:s.signal,headers:{Accept:"application/vnd.ipld.raw"},cache:"force-cache"},l=this.transformRequestInit!=null?await this.transformRequestInit(c):c;a=fetch(n.toString(),l).then(async d=>{if(this.log("GET %s %d",n,d.status),!d.ok)throw no(this,Iu)._++,new Error(`unable to fetch raw block for CID ${e} from gateway ${this.url}`);return no(this,Jh)._++,new Uint8Array(await d.arrayBuffer())}),oe(this,ku).set(i,a)}return await a}catch{throw(t==null?void 0:t.aborted)===!0?new Error(`fetching raw block for CID ${e} from gateway ${this.url} was aborted`):(no(this,Iu)._++,new Error(`unable to fetch raw block for CID ${e}`))}finally{t==null||t.removeEventListener("abort",o),oe(this,ku).delete(i)}}reliability(){return oe(this,Cu)===0?1:oe(this,Yh)>0?-1/0:oe(this,Jh)/(oe(this,Cu)+oe(this,Iu)*3)}incrementInvalidBlocks(){no(this,Yh)._++}getStats(){return{attempts:oe(this,Cu),errors:oe(this,Iu),invalidBlocks:oe(this,Yh),successes:oe(this,Jh),pendingResponses:oe(this,ku).size}}}Cu=new WeakMap,Iu=new WeakMap,Yh=new WeakMap,Jh=new WeakMap,ku=new WeakMap,$4=new WeakSet,XH=function(e){const t=e.multihash.bytes;return S1e.encode(t)};function A1e(r,e,t){return r.filter(n=>{if(vhe.matches(n)||e&&whe.matches(n))return t||HM.matches(n)?!0:bc(n.toOptions().host)===!1;if(!e&&t){const{host:i}=n.toOptions();if(i==="127.0.0.1"||i==="localhost"||i.endsWith(".localhost"))return!0}return!1})}async function*$O(r,e,t,n,i,s={}){for await(const o of e.findProviders(r,s)){const a=A1e(o.multiaddrs,n,i);if(a.length===0)continue;const c=PO(a[0]);yield new x1e(c,{logger:t,transformRequestInit:s.transformRequestInit})}}class C1e extends MM{constructor(t,n){super(t,{...n,name:"helia:trustless-gateway:session"});u(this,"routing");u(this,"allowInsecure");u(this,"allowLocal");u(this,"transformRequestInit");this.routing=t.routing,this.allowInsecure=n.allowInsecure??NO,this.allowLocal=n.allowLocal??MO,this.transformRequestInit=n.transformRequestInit}async queryProvider(t,n,i){var o;this.log("fetching BLOCK for %c from %s",t,n.url);const s=await n.getRawBlock(t,i.signal);return this.log.trace("got block for %c from %s",t,n.url),await((o=i.validateFn)==null?void 0:o.call(i,s)),s}async*findNewProviders(t,n={}){yield*$O(t,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...n,transformRequestInit:this.transformRequestInit})}toEvictionKey(t){return t.url.toString()}equals(t,n){return t.url.toString()===n.url.toString()}}function I1e(r,e){return new C1e(r,e)}class k1e{constructor(e,t={}){u(this,"allowInsecure");u(this,"allowLocal");u(this,"transformRequestInit");u(this,"routing");u(this,"log");u(this,"logger");this.log=e.logger.forComponent("helia:trustless-gateway-block-broker"),this.logger=e.logger,this.routing=e.routing,this.allowInsecure=t.allowInsecure??NO,this.allowLocal=t.allowLocal??MO,this.transformRequestInit=t.transformRequestInit}async retrieve(e,t={}){var i,s;const n=[];for await(const o of $O(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...t,transformRequestInit:this.transformRequestInit})){this.log("getting block for %c from %s",e,o.url);try{const a=await o.getRawBlock(e,t.signal);this.log.trace("got block for %c from %s",e,o.url);try{await((i=t.validateFn)==null?void 0:i.call(t,a))}catch(c){this.log.error("failed to validate block for %c from %s",e,o.url,c);continue}return a}catch(a){if(this.log.error("failed to get block for %c from %s",e,o.url,a),a instanceof Error?n.push(a):n.push(new Error(`Unable to fetch raw block for CID ${e} from gateway ${o.url}`)),((s=t.signal)==null?void 0:s.aborted)===!0){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",e,o.url);break}}}throw n.length>0?new AggregateError(n,`Unable to fetch raw block for CID ${e} from any gateway`):new Error(`Unable to fetch raw block for CID ${e} from any gateway`)}createSession(e={}){return I1e({logger:this.logger,routing:this.routing},{...e,allowLocal:this.allowLocal,allowInsecure:this.allowInsecure,transformRequestInit:this.transformRequestInit})}}const NO=!1,MO=!1;function _1e(r={}){return e=>new k1e(e,r)}async function*OO(r,e={}){const t=r.getReader();try{for(;;){const n=await t.read();if(n.done)return;yield n.value}}finally{e.preventCancel!==!0&&await t.cancel(),t.releaseLock()}}var RO={exports:{}};(function(r){(function(){r.exports=v;var e=86400,t=3200,n=146097*t/400,i=e*n,s=1e3*i,o=864e13,a=4294967296,c=1e6,l="000000000",d=Math.trunc||function(T){var L=T-T%1;return L==0&&(T<0||T===0&&1/T!=1/0)?-0:L},h=v.prototype,p=(v.fromDate=function(T){return new v(+T)},v.fromInt64BE=A(0,1,2,3,0,4),v.fromInt64LE=A(3,2,1,0,4,0),v.fromString=function(B){var L,z=new v,B=(B+="").replace(/^\s*[+\-]?\d+/,function(j){var j=+j,q=1970+(j-1970)%400;return z.year=j-q,q}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(G,j,q){return j<0&&(q*=-1),L=6e4*(60*+j+ +q),""}).replace(/\.\d+$/,function(G){return z.nano=+(G+l).substr(1,9),""}).split(/\D+/);if(1<B.length?B[1]--:B[1]=0,z.time=L=Date.UTC.apply(Date,B)-(L||0),isNaN(L))throw new TypeError("Invalid Date");return y(z)},v.fromTimeT=function(T){return b(T,0)},h.year=0,h.time=0,h.nano=0,h.addNano=function(T){return this.nano+=+T||0,this},h.getNano=function(){var T=y(this);return(T.time%1e3*c+ +T.nano+1e9)%1e9},h.getTimeT=function(){var L=y(this),T=Math.floor(L.time/1e3),L=L.year;return L&&(T+=L*n*e/t),T},h.getYear=function(){return this.toDate().getUTCFullYear()+this.year},h.toDate=function(){return w(y(this).time)},h.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},h.toString=function(T){var L=this,z=L.toDate(),B={H:function(){return x(z.getUTCHours())},L:function(){return I(z.getUTCMilliseconds(),3)},M:function(){return x(z.getUTCMinutes())},N:function(){return I(L.getNano(),9)},S:function(){return x(z.getUTCSeconds())},Y:function(){var G=L.getYear();return 999999<G?"+"+G:9999<G?"+"+I(G,6):0<=G?I(G,4):-999999<=G?"-"+I(-G,6):G},a:function(){return f[z.getUTCDay()]},b:function(){return m[z.getUTCMonth()]},d:function(){return x(z.getUTCDate())},e:function(){return function(G){return(9<G?"":" ")+(0|G)}(z.getUTCDate())},m:function(){return x(z.getUTCMonth()+1)}};return function G(j){return j.replace(/%./g,function(q){var K=q[1],Q=g[K],K=B[K];return Q?G(Q):K?K():q})}(T||p)},h.writeInt64BE=E(0,1,2,3,0,4),h.writeInt64LE=E(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),m=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return v;function v(T,L,z){var B=this;if(!(B instanceof v))return new v(T,L,z);B.time=+T||0,B.nano=+L||0,B.year=+z||0,y(B)}function y(T){var L,z,B,G=T.year,j=T.time,q=T.nano,Q=((q<0||c<=q)&&(q-=(z=Math.floor(q/c))*c,j+=z,z=1),G%t);return(j<-864e13||o<j||Q)&&((L=d(j/s))&&(G+=L*t,j-=L*s),(B=w(j)).setUTCFullYear(Q+B.getUTCFullYear()),B=(j=+B)+(L=d((G-=Q)/t))*s,L&&-864e13<=B&&B<=o&&(G-=L*t,j=B),z=1),z&&(T.year=G,T.time=j,T.nano=q),T}function w(T){var L=new Date(0);return L.setTime(T),L}function b(G,B){G=+G||0;var z=d((B=(B|0)*a)/i)+d(G/i),B=B%i+G%i,G=d(B/i);return G&&(z+=G,B-=G*i),new v(1e3*B,0,z*t)}function E(T,L,z,B,G,j){return function(Q,K){var U=y(this);Q=Q||new Array(8),k(Q,K|=0);var W=Math.floor(U.time/1e3),U=U.year*(n*e/t),O=d(U/a)+d(W/a),U=U%a+W%a,W=Math.floor(U/a);return W&&(O+=W,U-=W*a),q(Q,K+G,O),q(Q,K+j,U),Q};function q(Q,K,O){Q[K+T]=O>>24&255,Q[K+L]=O>>16&255,Q[K+z]=O>>8&255,Q[K+B]=255&O}}function A(T,L,z,B,G,j){return function(Q,K){k(Q,K|=0);var O=q(Q,K+G);return b(q(Q,K+j),O)};function q(Q,K){return 16777216*Q[K+T]+(Q[K+L]<<16|Q[K+z]<<8|Q[K+B])}}function k(T,L){if(T=T&&T.length,T==null)throw new TypeError("Invalid Buffer");if(T<L+8)throw new RangeError("Out of range")}function x(T){return(9<T?"":"0")+(0|T)}function I(T,L){return(l+(0|T)).substr(-L)}})()})(RO);var T1e=RO.exports;const J7=Ze(T1e);class Ec extends Error{constructor(e="Record signature verification failed"){super(e),this.name="SignatureVerificationError"}}u(Ec,"name","SignatureVerificationError");class LO extends Error{constructor(e="Record has expired"){super(e),this.name="RecordExpiredError"}}u(LO,"name","RecordExpiredError");class X7 extends Error{constructor(e="The validity type is unsupported"){super(e),this.name="UnsupportedValidityError"}}u(X7,"name","UnsupportedValidityError");class BO extends Error{constructor(e="The record is too large"){super(e),this.name="RecordTooLargeError"}}u(BO,"name","RecordTooLargeError");class UO extends Error{constructor(e="Value must be a valid content path starting with /"){super(e),this.name="InvalidValueError"}}u(UO,"name","InvalidValueError");class FO extends Error{constructor(e="Invalid record data"){super(e),this.name="InvalidRecordDataError"}}u(FO,"name","InvalidRecordDataError");class Z7 extends Error{constructor(e="Invalid embedded public key"){super(e),this.name="InvalidEmbeddedPublicKeyError"}}u(Z7,"name","InvalidEmbeddedPublicKeyError");var ss;(function(r){(function(n){n.EOL="EOL"})(r.ValidityType||(r.ValidityType={}));let e;(function(n){n[n.EOL=0]="EOL"})(e||(e={})),function(n){n.codec=()=>kn(e)}(r.ValidityType||(r.ValidityType={}));let t;r.codec=()=>(t==null&&(t=$e((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.value!=null&&(i.uint32(10),i.bytes(n.value)),n.signatureV1!=null&&(i.uint32(18),i.bytes(n.signatureV1)),n.validityType!=null&&(i.uint32(24),r.ValidityType.codec().encode(n.validityType,i)),n.validity!=null&&(i.uint32(34),i.bytes(n.validity)),n.sequence!=null&&(i.uint32(40),i.uint64(n.sequence)),n.ttl!=null&&(i.uint32(48),i.uint64(n.ttl)),n.pubKey!=null&&(i.uint32(58),i.bytes(n.pubKey)),n.signatureV2!=null&&(i.uint32(66),i.bytes(n.signatureV2)),n.data!=null&&(i.uint32(74),i.bytes(n.data)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.value=n.bytes();break}case 2:{o.signatureV1=n.bytes();break}case 3:{o.validityType=r.ValidityType.codec().decode(n);break}case 4:{o.validity=n.bytes();break}case 5:{o.sequence=n.uint64();break}case 6:{o.ttl=n.uint64();break}case 7:{o.pubKey=n.bytes();break}case 8:{o.signatureV2=n.bytes();break}case 9:{o.data=n.bytes();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>De(n,r.codec()),r.decode=(n,i)=>Pe(n,r.codec(),i)})(ss||(ss={}));function P1e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function e9(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function D1e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var $1e=D1e,N1e=$1e;let M1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},O1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return zO(this,e)}},R1e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return zO(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function zO(r,e){return new R1e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let L1e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new M1e(e,t,n),this.decoder=new O1e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function VO({name:r,prefix:e,encode:t,decode:n}){return new L1e(r,e,t,n)}function xm({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=N1e(t,r);return VO({prefix:e,name:r,encode:n,decode:s=>e9(i(s))})}function B1e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function U1e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Bo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return VO({prefix:e,name:r,encode(i){return U1e(i,n,t)},decode(i){return B1e(i,n,t,r)}})}const t9=xm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});xm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Am=Bo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Bo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Bo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Bo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Bo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Bo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Bo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Bo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Bo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Sc=xm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});xm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var F1e=jO,KO=128,z1e=-128,V1e=Math.pow(2,31);function jO(r,e,t){e=e||[],t=t||0;for(var n=t;r>=V1e;)e[t++]=r&255|KO,r/=128;for(;r&z1e;)e[t++]=r&255|KO,r>>>=7;return e[t]=r|0,jO.bytes=t-n+1,e}var K1e=r9,j1e=128,HO=127;function r9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw r9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&HO)<<i:(o&HO)*Math.pow(2,i),i+=7}while(o>=j1e);return r9.bytes=s-n,t}var H1e=Math.pow(2,7),q1e=Math.pow(2,14),W1e=Math.pow(2,21),G1e=Math.pow(2,28),Q1e=Math.pow(2,35),Y1e=Math.pow(2,42),J1e=Math.pow(2,49),X1e=Math.pow(2,56),Z1e=Math.pow(2,63),epe=function(r){return r<H1e?1:r<q1e?2:r<W1e?3:r<G1e?4:r<Q1e?5:r<Y1e?6:r<J1e?7:r<X1e?8:r<Z1e?9:10},tpe={encode:F1e,decode:K1e,encodingLength:epe},Cm=tpe;function n9(r,e=0){return[Cm.decode(r,e),Cm.decode.bytes]}function Im(r,e,t=0){return Cm.encode(r,e,t),e}function km(r){return Cm.encodingLength(r)}function rpe(r,e){const t=e.byteLength,n=km(r),i=n+km(t),s=new Uint8Array(i+t);return Im(r,s,0),Im(t,s,n),s.set(e,i),new i9(r,t,e,s)}function qO(r){const e=e9(r),[t,n]=n9(e),[i,s]=n9(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new i9(t,i,o,e)}function npe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&P1e(r.bytes,t.bytes)}}let i9=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function WO(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return spe(t,s9(r),e??Sc.encoder);default:return ope(t,s9(r),e??Am.encoder)}}const GO=new WeakMap;function s9(r){const e=GO.get(r);if(e==null){const t=new Map;return GO.set(r,t),t}return e}let QO=class Zr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Nj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==ep)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==ape)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Zr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=rpe(e,t);return Zr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Zr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&npe(e.multihash,n.multihash)}toString(e){return WO(this,e)}toJSON(){return{"/":WO(this)}}link(){return this}[(Nj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Zr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Zr(n,i,s,o??YO(n,i,s.bytes))}else if(t[cpe]===!0){const{version:n,multihash:i,code:s}=t,o=qO(i);return Zr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==ep)throw new Error(`Version 0 CID must use dag-pb (code: ${ep}) block encoding`);return new Zr(e,t,n,n.bytes)}case 1:{const i=YO(e,t,n.bytes);return new Zr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Zr.create(0,ep,e)}static createV1(e,t){return Zr.create(1,e,t)}static decode(e){const[t,n]=Zr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Zr.inspectBytes(e),n=t.size-t.multihashSize,i=e9(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new i9(t.multihashCode,t.digestSize,s,i);return[t.version===0?Zr.createV0(o):Zr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=n9(e.subarray(t));return t+=p,h};let i=n(),s=ep;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=ipe(e,t),s=Zr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return s9(s).set(n,e),s}};function ipe(r,e){switch(r[0]){case"Q":{const t=e??Sc;return[Sc.prefix,t.decode(`${Sc.prefix}${r}`)]}case Sc.prefix:{const t=e??Sc;return[Sc.prefix,t.decode(r)]}case Am.prefix:{const t=e??Am;return[Am.prefix,t.decode(r)]}case t9.prefix:{const t=e??t9;return[t9.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function spe(r,e,t){const{prefix:n}=t;if(n!==Sc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function ope(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const ep=112,ape=18;function YO(r,e,t){const n=km(r),i=n+km(e),s=new Uint8Array(i+t.byteLength);return Im(r,s,0),Im(e,s,n),s.set(t,i),s}const cpe=Symbol.for("@ipld/js-cid/CID"),lpe=Hd("ipns:utils"),JO=se("/ipns/"),upe=0,dpe=18;function hpe(r){let e;if(r.pubKey!=null)try{e=_n(r.pubKey)}catch(t){throw lpe.error(t),t}if(e!=null)return e}function fpe(r){const e=se("ipns-signature:");return or([e,r])}function XO(r){return"signatureV1"in r?ss.encode({value:se(r.value),signatureV1:r.signatureV1,validityType:r.validityType,validity:se(r.validity),sequence:r.sequence,ttl:r.ttl,pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data}):ss.encode({pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data})}function tp(r){const e=ss.decode(r);if(e.sequence!=null&&(e.sequence=BigInt(e.sequence)),e.ttl!=null&&(e.ttl=BigInt(e.ttl)),e.signatureV2==null||e.data==null)throw new Ec("Missing data or signatureV2");const t=eR(e.data),n=ppe(t.Value),i=re(t.Validity);if(e.value!=null&&e.signatureV1!=null)return gpe(e),{value:n,validityType:ss.ValidityType.EOL,validity:i,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV1:e.signatureV1,signatureV2:e.signatureV2,data:e.data};if(e.signatureV2!=null)return{value:n,validityType:ss.ValidityType.EOL,validity:i,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}function ZO(r){return or([JO,r.bytes])}function o9(r){const e=qO(r.slice(JO.length));if(!a9(e,upe)&&!a9(e,dpe))throw new $2("Multihash in IPNS key was not identity or sha2-256");return e}function eR(r){const e=Ua(r);if(e.ValidityType===0)e.ValidityType=ss.ValidityType.EOL;else throw new X7("The validity type is unsupported");return Number.isInteger(e.Sequence)&&(e.Sequence=BigInt(e.Sequence)),Number.isInteger(e.TTL)&&(e.TTL=BigInt(e.TTL)),e}function ppe(r){const e=re(r).trim();if(e.startsWith("/"))return e;try{return`/ipfs/${QO.decode(r).toV1().toString()}`}catch{}try{return`/ipfs/${QO.parse(e).toV1().toString()}`}catch{}throw new UO("Value must be a valid content path starting with /")}function gpe(r){if(r.data==null)throw new FO("Record data is missing");const e=eR(r.data);if(!qe(e.Value,r.value??new Uint8Array(0)))throw new Ec('Field "value" did not match between protobuf and CBOR');if(!qe(e.Validity,r.validity??new Uint8Array(0)))throw new Ec('Field "validity" did not match between protobuf and CBOR');if(e.ValidityType!==r.validityType)throw new Ec('Field "validityType" did not match between protobuf and CBOR');if(e.Sequence!==r.sequence)throw new Ec('Field "sequence" did not match between protobuf and CBOR');if(e.TTL!==r.ttl)throw new Ec('Field "ttl" did not match between protobuf and CBOR')}function a9(r,e){return r.code===e}const _m=Hd("ipns:validator"),ype=1024*10,mpe=async(r,e)=>{const t=tp(e);let n;try{const i=fpe(t.data);n=await r.verify(i,t.signatureV2)}catch{n=!1}if(!n)throw _m.error("record signature verification failed"),new Ec("Record signature verification failed");if(t.validityType===ss.ValidityType.EOL){if(J7.fromString(t.validity).toDate().getTime()<Date.now())throw _m.error("record has expired"),new LO("record has expired")}else if(t.validityType!=null)throw _m.error("the validity type is unsupported"),new X7("The validity type is unsupported");_m("ipns record for %s is valid",t.value)};async function tR(r,e){if(e.byteLength>ype)throw new BO("The record is too large");const t=o9(r);let n;a9(t,0)&&(n=qD(t));const i=tp(e),s=hpe(i)??n;if(s==null)throw new Z7("Could not extract public key from IPNS record or routing key");const o=ZO(s.toMultihash());if(!qe(o,r))throw new Z7("Embedded public key did not match routing key");await mpe(s,e)}let wpe=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MESSAGE_LENGTH")}};async function*rR(r,e={}){const t=/\r?\n/,n=new TextDecoder("utf8");let i="";for await(let s of r){if(typeof s=="string"&&(s=new TextEncoder().encode(s)),g1(s)&&(s=s.subarray()),i+=n.decode(s,{stream:!0}),i.length>((e==null?void 0:e.maxMessageLength)??i.length))throw new wpe("Incoming message too long");const o=i.split(t);i=o.pop()??"";for(let a=0;a<o.length;a++)yield JSON.parse(o[a])}i+=n.decode(),i!==""&&(yield JSON.parse(i))}class Tm extends Error{constructor(e="Invalid request"){super(e),this.name="InvalidRequestError"}}u(Tm,"name","InvalidRequestError");class Uo extends Error{constructor(e="Bad response"){super(e),this.name="BadResponseError"}}u(Uo,"name","BadResponseError");function bpe(r){return r[Symbol.asyncIterator]!=null}function vpe(r){if(bpe(r))return(async()=>{for await(const e of r)return e})();for(const e of r)return e}function Epe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function c9(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Spe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var xpe=Spe,Ape=xpe;let Cpe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Ipe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return nR(this,e)}},kpe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return nR(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function nR(r,e){return new kpe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let _pe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Cpe(e,t,n),this.decoder=new Ipe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function iR({name:r,prefix:e,encode:t,decode:n}){return new _pe(r,e,t,n)}function Pm({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Ape(t,r);return iR({prefix:e,name:r,encode:n,decode:s=>c9(i(s))})}function Tpe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Ppe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Fo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return iR({prefix:e,name:r,encode(i){return Ppe(i,n,t)},decode(i){return Tpe(i,n,t,r)}})}const Dm=Fo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Fo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Fo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Fo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Fo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Fo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Fo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Fo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Fo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const l9=Pm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Pm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const xc=Pm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Pm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Dpe=oR,sR=128,$pe=-128,Npe=Math.pow(2,31);function oR(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Npe;)e[t++]=r&255|sR,r/=128;for(;r&$pe;)e[t++]=r&255|sR,r>>>=7;return e[t]=r|0,oR.bytes=t-n+1,e}var Mpe=u9,Ope=128,aR=127;function u9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw u9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&aR)<<i:(o&aR)*Math.pow(2,i),i+=7}while(o>=Ope);return u9.bytes=s-n,t}var Rpe=Math.pow(2,7),Lpe=Math.pow(2,14),Bpe=Math.pow(2,21),Upe=Math.pow(2,28),Fpe=Math.pow(2,35),zpe=Math.pow(2,42),Vpe=Math.pow(2,49),Kpe=Math.pow(2,56),jpe=Math.pow(2,63),Hpe=function(r){return r<Rpe?1:r<Lpe?2:r<Bpe?3:r<Upe?4:r<Fpe?5:r<zpe?6:r<Vpe?7:r<Kpe?8:r<jpe?9:10},qpe={encode:Dpe,decode:Mpe,encodingLength:Hpe},$m=qpe;function d9(r,e=0){return[$m.decode(r,e),$m.decode.bytes]}function Nm(r,e,t=0){return $m.encode(r,e,t),e}function Mm(r){return $m.encodingLength(r)}function Wpe(r,e){const t=e.byteLength,n=Mm(r),i=n+Mm(t),s=new Uint8Array(i+t);return Nm(r,s,0),Nm(t,s,n),s.set(e,i),new h9(r,t,e,s)}function Gpe(r){const e=c9(r),[t,n]=d9(e),[i,s]=d9(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new h9(t,i,o,e)}function Qpe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Epe(r.bytes,t.bytes)}}let h9=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function cR(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Jpe(t,f9(r),e??xc.encoder);default:return Xpe(t,f9(r),e??Dm.encoder)}}const lR=new WeakMap;function f9(r){const e=lR.get(r);if(e==null){const t=new Map;return lR.set(r,t),t}return e}let uR=class en{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Mj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==rp)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Zpe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return en.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Wpe(e,t);return en.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return en.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Qpe(e.multihash,n.multihash)}toString(e){return cR(this,e)}toJSON(){return{"/":cR(this)}}link(){return this}[(Mj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof en)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new en(n,i,s,o??dR(n,i,s.bytes))}else if(t[e0e]===!0){const{version:n,multihash:i,code:s}=t,o=Gpe(i);return en.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==rp)throw new Error(`Version 0 CID must use dag-pb (code: ${rp}) block encoding`);return new en(e,t,n,n.bytes)}case 1:{const i=dR(e,t,n.bytes);return new en(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return en.create(0,rp,e)}static createV1(e,t){return en.create(1,e,t)}static decode(e){const[t,n]=en.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=en.inspectBytes(e),n=t.size-t.multihashSize,i=c9(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new h9(t.multihashCode,t.digestSize,s,i);return[t.version===0?en.createV0(o):en.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=d9(e.subarray(t));return t+=p,h};let i=n(),s=rp;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Ype(e,t),s=en.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return f9(s).set(n,e),s}};function Ype(r,e){switch(r[0]){case"Q":{const t=e??xc;return[xc.prefix,t.decode(`${xc.prefix}${r}`)]}case xc.prefix:{const t=e??xc;return[xc.prefix,t.decode(r)]}case Dm.prefix:{const t=e??Dm;return[Dm.prefix,t.decode(r)]}case l9.prefix:{const t=e??l9;return[l9.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Jpe(r,e,t){const{prefix:n}=t;if(n!==xc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Xpe(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const rp=112,Zpe=18;function dR(r,e,t){const n=Mm(r),i=n+Mm(e),s=new Uint8Array(i+t.byteLength);return Nm(r,s,0),Nm(e,s,n),s.set(t,i),s}const e0e=Symbol.for("@ipld/js-cid/CID"),hR=se("/ipns/");function fR(r){return qe(r.subarray(0,hR.byteLength),hR)}class t0e{constructor(e){u(this,"client");this.client=e}async*findProviders(e,t={}){yield*Ud(this.client.getProviders(e,t),n=>({id:n.ID,multiaddrs:n.Addrs??[]}))}async provide(){}async cancelReprovide(){}async put(e,t,n){if(!fR(e))return;const i=o9(e),s=uR.createV1(114,i),o=tp(t);await this.client.putIPNS(s,o,n)}async get(e,t){if(!fR(e))throw new Zt("Not found");const n=o9(e),i=uR.createV1(114,n);try{const s=await this.client.getIPNS(i,t);return XO(s)}catch(s){throw s.name==="BadResponseError"?new Zt("Not found"):s}}}class r0e{constructor(e){u(this,"client");this.client=e}async findPeer(e,t={}){const n=await vpe(this.client.getPeers(e,t));if(n!=null)return{id:n.ID,multiaddrs:n.Addrs??[]};throw new Zt("Not found")}async*getClosestPeers(e,t={}){}}const gr=Hd("delegated-routing-v1-http-api-client"),Om={concurrentRequests:4,timeout:3e4,cacheTTL:5*60*1e3,cacheName:"delegated-routing-v1-cache"};class n0e{constructor(e,t={}){Je(this,wn);u(this,"started");u(this,"httpQueue");u(this,"shutDownController");u(this,"clientUrl");u(this,"timeout");u(this,"contentRouting");u(this,"peerRouting");u(this,"filterAddrs");u(this,"filterProtocols");u(this,"inFlightRequests");u(this,"cacheName");u(this,"cache");u(this,"cacheTTL");this.started=!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.httpQueue=new Ma({concurrency:t.concurrentRequests??Om.concurrentRequests}),this.inFlightRequests=new Map,this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=t.timeout??Om.timeout,this.filterAddrs=t.filterAddrs,this.filterProtocols=t.filterProtocols,this.contentRouting=new t0e(this),this.peerRouting=new r0e(this),this.cacheName=t.cacheName??Om.cacheName,this.cacheTTL=t.cacheTTL??Om.cacheTTL}get[Ed](){return this.contentRouting}get[Sd](){return this.peerRouting}isStarted(){return this.started}async start(){var e;this.started||(this.started=!0,this.cacheTTL>0&&(this.cache=await((e=globalThis.caches)==null?void 0:e.open(this.cacheName)),this.cache!=null&&gr("cache enabled with ttl %d",this.cacheTTL)))}async stop(){var e;this.httpQueue.clear(),this.shutDownController.abort(),await((e=globalThis.caches)==null?void 0:e.delete(this.cacheName)),this.started=!1}async*getProviders(e,t={}){gr("getProviders starts: %c",e);const n=AbortSignal.timeout(this.timeout),i=pt([this.shutDownController.signal,n,t.signal]),s=Le(),o=Le();this.httpQueue.add(async()=>(s.resolve(),o.promise));try{await s.promise;const a=new URL(`${this.clientUrl}routing/v1/providers/${e.toString()}`);Ie(this,wn,LA).call(this,a,t.filterAddrs,t.filterProtocols);const c={headers:{Accept:"application/x-ndjson"},signal:i},l=await Ie(this,wn,p0).call(this,a.toString(),c);if(l==null)throw new Uo("No response received");if(!l.ok)throw l.status===404?new Zt("No matching records found"):l.status===422?new Tm("Request does not conform to schema or semantic constraints"):new Uo(`Unexpected status code: ${l.status}`);if(l.body==null)throw new Uo("Routing response had no body");const d=l.headers.get("Content-Type");if(d==null)throw new Uo("No Content-Type header received");if(d!=null&&d.startsWith("application/json")){const h=await l.json();for(const p of h.Providers){const m=Ie(this,wn,f0).call(this,p);m!=null&&(yield m)}}else if(d.includes("application/x-ndjson"))for await(const h of rR(OO(l.body))){const p=Ie(this,wn,f0).call(this,h);p!=null&&(yield p)}else throw new Uo(`Unsupported Content-Type: ${d}`)}catch(a){gr.error("getProviders errored:",a)}finally{i.clear(),o.resolve(),gr("getProviders finished: %c",e)}}async*getPeers(e,t={}){gr("getPeers starts: %c",e);const n=AbortSignal.timeout(this.timeout),i=pt([this.shutDownController.signal,n,t.signal]),s=Le(),o=Le();this.httpQueue.add(async()=>(s.resolve(),o.promise));try{await s.promise;const a=new URL(`${this.clientUrl}routing/v1/peers/${e.toCID().toString()}`);Ie(this,wn,LA).call(this,a,t.filterAddrs,t.filterProtocols);const c={headers:{Accept:"application/x-ndjson"},signal:i},l=await Ie(this,wn,p0).call(this,a.toString(),c);if(l.status===404)throw new Zt("No matching records found");if(l.status===422)throw new Tm("Request does not conform to schema or semantic constraints");if(l.body==null)throw new Uo("Routing response had no body");if(l.headers.get("Content-Type")==="application/json"){const h=await l.json();for(const p of h.Peers){const m=Ie(this,wn,f0).call(this,p);m!=null&&(yield m)}}else for await(const h of rR(OO(l.body))){const p=Ie(this,wn,f0).call(this,h);p!=null&&(yield p)}}catch(a){gr.error("getPeers errored:",a)}finally{i.clear(),o.resolve(),gr("getPeers finished: %c",e)}}async getIPNS(e,t={}){gr("getIPNS starts: %s",e);const n=AbortSignal.timeout(this.timeout),i=pt([this.shutDownController.signal,n,t.signal]),s=Le(),o=Le();this.httpQueue.add(async()=>(s.resolve(),o.promise));const a=`${this.clientUrl}routing/v1/ipns/${e}`;try{await s.promise;const c={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:i},l=await Ie(this,wn,p0).call(this,a,c);if(gr("getIPNS GET %s %d",a,l.status),l.status===404)throw new Zt("No matching records found");if(l.status===422)throw new Tm("Request does not conform to schema or semantic constraints");if(l.body==null)throw new Uo("GET ipns response had no body");const d=await l.arrayBuffer(),h=new Uint8Array(d,0,d.byteLength);return t.validate!==!1&&await tR(ZO(e.multihash),h),tp(h)}catch(c){throw gr.error("getIPNS GET %s error:",a,c),c}finally{i.clear(),o.resolve(),gr("getIPNS finished: %s",e)}}async putIPNS(e,t,n={}){gr("putIPNS starts: %c",e);const i=AbortSignal.timeout(this.timeout),s=pt([this.shutDownController.signal,i,n.signal]),o=Le(),a=Le();this.httpQueue.add(async()=>(o.resolve(),a.promise));const c=`${this.clientUrl}routing/v1/ipns/${e}`;try{await o.promise;const l=XO(t),d={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:l,signal:s},h=await Ie(this,wn,p0).call(this,c,d);if(gr("putIPNS PUT %s %d",c,h.status),h.status!==200)throw new Uo("PUT ipns response had status other than 200")}catch(l){throw gr.error("putIPNS PUT %s error:",c,l.stack),l}finally{s.clear(),a.resolve(),gr("putIPNS finished: %c",e)}}}wn=new WeakSet,f0=function(e){var t;try{const n=[],i=((t=e.Addrs)==null?void 0:t.map(Re))??[];return e.Protocols!=null&&n.push(...e.Protocols),e.Protocol!=null&&(n.push(e.Protocol),delete e.Protocol),{...e,Schema:"peer",ID:tr(e.ID),Addrs:i,Protocols:n}}catch(n){gr.error("could not conform record to peer schema",n)}},LA=function(e,t,n){var i,s;if(t!=null||this.filterAddrs!=null){const o=(t==null?void 0:t.join(","))??((i=this.filterAddrs)==null?void 0:i.join(","))??"";o!==""&&e.searchParams.set("filter-addrs",o)}if(n!=null||this.filterProtocols!=null){const o=(n==null?void 0:n.join(","))??((s=this.filterProtocols)==null?void 0:s.join(","))??"";o!==""&&e.searchParams.set("filter-protocols",o)}},p0=async function(e,t){var c,l;const n=t.method??"GET",i=`${n}-${e}`;if(n==="GET"){const d=await((c=this.cache)==null?void 0:c.match(e));if(d!=null){if(parseInt(d.headers.get("x-cache-expires")??"0",10)>Date.now())return gr("returning cached response for %s",i),d;await((l=this.cache)==null?void 0:l.delete(e))}}const s=this.inFlightRequests.get(i);if(s!=null){const d=await s;return gr("deduplicating outgoing request for %s",i),d.clone()}const o=fetch(e,t).then(async d=>{if(this.cache!=null&&d.ok&&n==="GET"){const h=Date.now()+this.cacheTTL,p=new Headers(d.headers);p.set("x-cache-expires",h.toString());const m=new Response(d.clone().body,{status:d.status,statusText:d.statusText,headers:p});await this.cache.put(e,m)}return d}).finally(()=>{this.inFlightRequests.delete(i)});return this.inFlightRequests.set(i,o),await o};function i0e(r,e={}){return new n0e(new URL(r),e)}function s0e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Rm(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function o0e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var a0e=o0e,c0e=a0e;let l0e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},u0e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return pR(this,e)}},d0e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return pR(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function pR(r,e){return new d0e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let h0e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new l0e(e,t,n),this.decoder=new u0e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function gR({name:r,prefix:e,encode:t,decode:n}){return new h0e(r,e,t,n)}function Lm({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=c0e(t,r);return gR({prefix:e,name:r,encode:n,decode:s=>Rm(i(s))})}function f0e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function p0e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function zo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return gR({prefix:e,name:r,encode(i){return p0e(i,n,t)},decode(i){return f0e(i,n,t,r)}})}const Bm=zo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});zo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),zo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),zo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),zo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),zo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),zo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),zo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),zo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const p9=Lm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Lm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Ac=Lm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Lm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var g0e=mR,yR=128,y0e=-128,m0e=Math.pow(2,31);function mR(r,e,t){e=e||[],t=t||0;for(var n=t;r>=m0e;)e[t++]=r&255|yR,r/=128;for(;r&y0e;)e[t++]=r&255|yR,r>>>=7;return e[t]=r|0,mR.bytes=t-n+1,e}var w0e=g9,b0e=128,wR=127;function g9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw g9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&wR)<<i:(o&wR)*Math.pow(2,i),i+=7}while(o>=b0e);return g9.bytes=s-n,t}var v0e=Math.pow(2,7),E0e=Math.pow(2,14),S0e=Math.pow(2,21),x0e=Math.pow(2,28),A0e=Math.pow(2,35),C0e=Math.pow(2,42),I0e=Math.pow(2,49),k0e=Math.pow(2,56),_0e=Math.pow(2,63),T0e=function(r){return r<v0e?1:r<E0e?2:r<S0e?3:r<x0e?4:r<A0e?5:r<C0e?6:r<I0e?7:r<k0e?8:r<_0e?9:10},P0e={encode:g0e,decode:w0e,encodingLength:T0e},Um=P0e;function y9(r,e=0){return[Um.decode(r,e),Um.decode.bytes]}function Fm(r,e,t=0){return Um.encode(r,e,t),e}function zm(r){return Um.encodingLength(r)}function bR(r,e){const t=e.byteLength,n=zm(r),i=n+zm(t),s=new Uint8Array(i+t);return Fm(r,s,0),Fm(t,s,n),s.set(e,i),new m9(r,t,e,s)}function D0e(r){const e=Rm(r),[t,n]=y9(e),[i,s]=y9(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new m9(t,i,o,e)}function $0e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&s0e(r.bytes,t.bytes)}}let m9=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function vR(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return O0e(t,w9(r),e??Ac.encoder);default:return R0e(t,w9(r),e??Bm.encoder)}}const ER=new WeakMap;function w9(r){const e=ER.get(r);if(e==null){const t=new Map;return ER.set(r,t),t}return e}let N0e=class tn{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Oj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==np)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==L0e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return tn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=bR(e,t);return tn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return tn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&$0e(e.multihash,n.multihash)}toString(e){return vR(this,e)}toJSON(){return{"/":vR(this)}}link(){return this}[(Oj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof tn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new tn(n,i,s,o??SR(n,i,s.bytes))}else if(t[B0e]===!0){const{version:n,multihash:i,code:s}=t,o=D0e(i);return tn.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==np)throw new Error(`Version 0 CID must use dag-pb (code: ${np}) block encoding`);return new tn(e,t,n,n.bytes)}case 1:{const i=SR(e,t,n.bytes);return new tn(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return tn.create(0,np,e)}static createV1(e,t){return tn.create(1,e,t)}static decode(e){const[t,n]=tn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=tn.inspectBytes(e),n=t.size-t.multihashSize,i=Rm(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new m9(t.multihashCode,t.digestSize,s,i);return[t.version===0?tn.createV0(o):tn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=y9(e.subarray(t));return t+=p,h};let i=n(),s=np;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=M0e(e,t),s=tn.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return w9(s).set(n,e),s}};function M0e(r,e){switch(r[0]){case"Q":{const t=e??Ac;return[Ac.prefix,t.decode(`${Ac.prefix}${r}`)]}case Ac.prefix:{const t=e??Ac;return[Ac.prefix,t.decode(r)]}case Bm.prefix:{const t=e??Bm;return[Bm.prefix,t.decode(r)]}case p9.prefix:{const t=e??p9;return[p9.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function O0e(r,e,t){const{prefix:n}=t;if(n!==Ac.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function R0e(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const np=112,L0e=18;function SR(r,e,t){const n=zm(r),i=n+zm(e),s=new Uint8Array(i+t.byteLength);return Fm(r,s,0),Fm(e,s,n),s.set(t,i),s}const B0e=Symbol.for("@ipld/js-cid/CID");function U0e(){return{filterProtocols:["unknown","transport-bitswap","transport-ipfs-gateway-http"],filterAddrs:["https","webtransport","webrtc","webrtc-direct","wss","tls"]}}const xR="[a-fA-F\\d:]",Cc=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${xR})|(?<=${xR})(?=\\s|$))`:"",os="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",rr="[a-fA-F\\d]{1,4}",Vm=`
(?:
(?:${rr}:){7}(?:${rr}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${rr}:){6}(?:${os}|:${rr}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${rr}:){5}(?::${os}|(?::${rr}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${rr}:){4}(?:(?::${rr}){0,1}:${os}|(?::${rr}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${rr}:){3}(?:(?::${rr}){0,2}:${os}|(?::${rr}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${rr}:){2}(?:(?::${rr}){0,3}:${os}|(?::${rr}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${rr}:){1}(?:(?::${rr}){0,4}:${os}|(?::${rr}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${rr}){0,5}:${os}|(?::${rr}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),F0e=new RegExp(`(?:^${os}$)|(?:^${Vm}$)`),z0e=new RegExp(`^${os}$`),V0e=new RegExp(`^${Vm}$`),Km=r=>r&&r.exact?F0e:new RegExp(`(?:${Cc(r)}${os}${Cc(r)})|(?:${Cc(r)}${Vm}${Cc(r)})`,"g");Km.v4=r=>r&&r.exact?z0e:new RegExp(`${Cc(r)}${os}${Cc(r)}`,"g"),Km.v6=r=>r&&r.exact?V0e:new RegExp(`${Cc(r)}${Vm}${Cc(r)}`,"g");function K0e(r){const e=(...t)=>r(...t);return Object.defineProperty(e,"name",{value:`functionTimeout(${r.name||"<anonymous>"})`,configurable:!0}),e}const{toString:j0e}=Object.prototype;function H0e(r){return j0e.call(r)==="[object RegExp]"}const AR={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function q0e(r,e={}){if(!H0e(r))throw new TypeError("Expected a RegExp instance");const t=Object.keys(AR).map(i=>(typeof e[i]=="boolean"?e[i]:r[i])?AR[i]:"").join(""),n=new RegExp(e.source||r.source,t);return n.lastIndex=typeof e.lastIndex=="number"?e.lastIndex:r.lastIndex,n}function CR(r,e,{timeout:t}={}){try{return K0e(()=>q0e(r).test(e),{timeout:t})()}catch(n){throw n}}const W0e=15,G0e=45,IR={timeout:400};function kR(r){return r.length>G0e?!1:CR(Km.v6({exact:!0}),r,IR)}function Q0e(r){return r.length>W0e?!1:CR(Km.v4({exact:!0}),r,IR)}const _R={http:"80",https:"443",ws:"80",wss:"443"},Y0e=["http","https","ws","wss"];function J0e(r,e){e=e??{};const t=e.defaultDnsType??"dns4",{scheme:n,hostname:i,port:s,path:o}=X0e(r),a=[Z0e(i,t),ege(s,n),tge(n)];o!=null&&a.push(rge(o));const c="/"+a.filter(l=>!!l).reduce((l,d)=>l.concat(d),[]).join("/");return Re(c)}function X0e(r){const[e]=r.split(":");Y0e.includes(e)||(r="http"+r.substring(e.length));let{protocol:t,hostname:n,port:i,pathname:s,search:o}=new URL(r);if(i==null||i===""){const c=nge(e);c!=null&&(i=c),c==null&&t==="http:"&&(i="80")}let a;return s!=null&&s!==""&&s!=="/"&&(s.startsWith("/")&&(s=s.substring(1)),a=s),o!=null&&o!==""&&(a=a??"",a+=o),{scheme:e,hostname:n,port:i,path:a}}function Z0e(r,e){if(!(r==null||r==="")){if(Q0e(r))return["ip4",r];if(kR(r))return["ip6",r];if(r[0]==="["){const t=r.substring(1,r.length-1);if(kR(t))return["ip6",t]}return[e,r]}}function ege(r,e){if(!(r==null||r===""))return e==="udp"?["udp",r]:["tcp",r]}function tge(r){if(r.match(/^tcp$|^udp$/)==null)return[r]}function rge(r){if(!(r==null||r===""))return["http-path",encodeURIComponent(r)]}function nge(r){if(!(r==null||r===""||_R[r]==null))return _R[r]}const TR=0,ige="identity",PR=Rm;function sge(r){return bR(TR,PR(r))}const oge={code:TR,name:ige,encode:PR,digest:sge},age=["https://trustless-gateway.link","https://4everland.io"],cge=2336;function lge(r){return r=r.toString(),{id:zd(N0e.createV1(cge,oge.digest(se(r)))),multiaddrs:[J0e(r)]}}class uge{constructor(e={}){u(this,"gateways");this.gateways=(e.gateways??age).map(t=>lge(t))}async*findProviders(e,t){yield*this.gateways.toSorted(()=>Math.random()>.5?1:-1).map(n=>({...n,protocols:["transport-ipfs-gateway-http"]}))}}function dge(r={}){return new uge(r)}class hge{constructor(e){u(this,"libp2p");this.libp2p=e}async provide(e,t){await this.libp2p.contentRouting.provide(e,t)}async cancelReprovide(e,t){await this.libp2p.contentRouting.cancelReprovide(e,t)}async*findProviders(e,t){yield*this.libp2p.contentRouting.findProviders(e,t)}async put(e,t,n){await this.libp2p.contentRouting.put(e,t,n)}async get(e,t){return this.libp2p.contentRouting.get(e,t)}async findPeer(e,t){return this.libp2p.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t){yield*this.libp2p.peerRouting.getClosestPeers(e,t)}}function fge(r){return new hge(r)}function pge(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function b9(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function gge(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var yge=gge,mge=yge;let wge=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},bge=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return DR(this,e)}},vge=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return DR(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function DR(r,e){return new vge({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Ege=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new wge(e,t,n),this.decoder=new bge(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function $R({name:r,prefix:e,encode:t,decode:n}){return new Ege(r,e,t,n)}function jm({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=mge(t,r);return $R({prefix:e,name:r,encode:n,decode:s=>b9(i(s))})}function Sge(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function xge(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Vo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return $R({prefix:e,name:r,encode(i){return xge(i,n,t)},decode(i){return Sge(i,n,t,r)}})}const Ko=Vo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Vo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Vo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Vo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Vo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Vo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Vo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Vo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Vo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const v9=jm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});jm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Ic=jm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});jm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Age=MR,NR=128,Cge=-128,Ige=Math.pow(2,31);function MR(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Ige;)e[t++]=r&255|NR,r/=128;for(;r&Cge;)e[t++]=r&255|NR,r>>>=7;return e[t]=r|0,MR.bytes=t-n+1,e}var kge=E9,_ge=128,OR=127;function E9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw E9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&OR)<<i:(o&OR)*Math.pow(2,i),i+=7}while(o>=_ge);return E9.bytes=s-n,t}var Tge=Math.pow(2,7),Pge=Math.pow(2,14),Dge=Math.pow(2,21),$ge=Math.pow(2,28),Nge=Math.pow(2,35),Mge=Math.pow(2,42),Oge=Math.pow(2,49),Rge=Math.pow(2,56),Lge=Math.pow(2,63),Bge=function(r){return r<Tge?1:r<Pge?2:r<Dge?3:r<$ge?4:r<Nge?5:r<Mge?6:r<Oge?7:r<Rge?8:r<Lge?9:10},Uge={encode:Age,decode:kge,encodingLength:Bge},Hm=Uge;function S9(r,e=0){return[Hm.decode(r,e),Hm.decode.bytes]}function qm(r,e,t=0){return Hm.encode(r,e,t),e}function Wm(r){return Hm.encodingLength(r)}function Fge(r,e){const t=e.byteLength,n=Wm(r),i=n+Wm(t),s=new Uint8Array(i+t);return qm(r,s,0),qm(t,s,n),s.set(e,i),new x9(r,t,e,s)}function RR(r){const e=b9(r),[t,n]=S9(e),[i,s]=S9(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new x9(t,i,o,e)}function zge(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&pge(r.bytes,t.bytes)}}let x9=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function LR(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return jge(t,A9(r),e??Ic.encoder);default:return Hge(t,A9(r),e??Ko.encoder)}}const BR=new WeakMap;function A9(r){const e=BR.get(r);if(e==null){const t=new Map;return BR.set(r,t),t}return e}let Vge=class rn{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Rj,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==ip)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==qge)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return rn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Fge(e,t);return rn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return rn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&zge(e.multihash,n.multihash)}toString(e){return LR(this,e)}toJSON(){return{"/":LR(this)}}link(){return this}[(Rj=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof rn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new rn(n,i,s,o??UR(n,i,s.bytes))}else if(t[Wge]===!0){const{version:n,multihash:i,code:s}=t,o=RR(i);return rn.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==ip)throw new Error(`Version 0 CID must use dag-pb (code: ${ip}) block encoding`);return new rn(e,t,n,n.bytes)}case 1:{const i=UR(e,t,n.bytes);return new rn(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return rn.create(0,ip,e)}static createV1(e,t){return rn.create(1,e,t)}static decode(e){const[t,n]=rn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=rn.inspectBytes(e),n=t.size-t.multihashSize,i=b9(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new x9(t.multihashCode,t.digestSize,s,i);return[t.version===0?rn.createV0(o):rn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=S9(e.subarray(t));return t+=p,h};let i=n(),s=ip;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Kge(e,t),s=rn.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return A9(s).set(n,e),s}};function Kge(r,e){switch(r[0]){case"Q":{const t=e??Ic;return[Ic.prefix,t.decode(`${Ic.prefix}${r}`)]}case Ic.prefix:{const t=e??Ic;return[Ic.prefix,t.decode(r)]}case Ko.prefix:{const t=e??Ko;return[Ko.prefix,t.decode(r)]}case v9.prefix:{const t=e??v9;return[v9.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function jge(r,e,t){const{prefix:n}=t;if(n!==Ic.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Hge(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const ip=112,qge=18;function UR(r,e,t){const n=Wm(r),i=n+Wm(e),s=new Uint8Array(i+t.byteLength);return qm(r,s,0),qm(e,s,n),s.set(t,i),s}const Wge=Symbol.for("@ipld/js-cid/CID"),Gge=85;class Qge extends PM{constructor(){super();u(this,"data");this.data=new Map}put(t,n){return this.data.set(Ko.encode(t.multihash.bytes),n),t}get(t){const n=this.data.get(Ko.encode(t.multihash.bytes));if(n==null)throw new H1;return n}has(t){return this.data.has(Ko.encode(t.multihash.bytes))}async delete(t){this.data.delete(Ko.encode(t.multihash.bytes))}async*getAll(){for(const[t,n]of this.data.entries())yield{cid:Vge.createV1(Gge,RR(Ko.decode(t))),block:n}}}Hd("blockstore:core:tiered");const Yge="SHARDING";function Jge(r){return r[Symbol.asyncIterator]!=null}function Gm(r){if(Jge(r))return(async()=>{const t=[];for await(const n of r)t.push(n);return t})();const e=[];for(const t of r)e.push(t);return e}function Xge(r){return r[Symbol.asyncIterator]!=null}function FR(r,e){return Xge(r)?async function*(){yield*(await Gm(r)).sort(e)}():function*(){yield*Gm(r).sort(e)}()}class Zge{put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:i}of e)await this.put(n,i,t),yield n}async*getMany(e,t={}){for await(const n of e)yield{key:n,value:await this.get(n,t)}}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await Eo(this.putMany(e,n)),e=[],await Eo(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null){const i=e.prefix;n=Wl(n,s=>s.key.toString().startsWith(i))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>Wl(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>FR(i,s),n)),e.offset!=null){let i=0;const s=e.offset;n=Wl(n,()=>i++>=s)}return e.limit!=null&&(n=gy(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null){const i=e.prefix;n=Wl(n,s=>s.toString().startsWith(i))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>Wl(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>FR(i,s),n)),e.offset!=null){const i=e.offset;let s=0;n=Wl(n,()=>s++>=i)}return e.limit!=null&&(n=gy(n,e.limit)),n}}class zR extends Zge{constructor(){super();u(this,"data");this.data=new Map}put(t,n){return this.data.set(t.toString(),n),t}get(t){const n=this.data.get(t.toString());if(n==null)throw new H1;return n}has(t){return this.data.has(t.toString())}delete(t){this.data.delete(t.toString())}*_all(){for(const[t,n]of this.data.entries())yield{key:new xt(t),value:n}}*_allKeys(){for(const t of this.data.keys())yield new xt(t)}}new xt(Yge),Hd("datastore:core:tiered");class e2e extends _de{constructor(t){super({...t,components:{libp2p:t.libp2p}});u(this,"libp2p");this.libp2p=t.libp2p}async start(){await super.start(),await this.libp2p.start()}async stop(){await super.stop(),await this.libp2p.stop()}}let t2e=class{constructor(){u(this,"readNext");u(this,"haveNext");u(this,"ended");u(this,"nextResult");u(this,"error");this.ended=!1,this.readNext=Le(),this.haveNext=Le()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Le(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Le(),await ln(this.readNext.promise,t==null?void 0:t.signal,t)}};function r2e(){return new t2e}let n2e=class extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}};function Qm(r,e){const t=r2e();r.sink(t).catch(async o=>{await t.end(o)}),r.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());const i=new Be;return{read:async o=>{var c;if((c=o==null?void 0:o.signal)==null||c.throwIfAborted(),(o==null?void 0:o.bytes)==null){const{done:l,value:d}=await ln(n.next(),o==null?void 0:o.signal);return l===!0?null:d}for(;i.byteLength<o.bytes;){const{value:l,done:d}=await ln(n.next(),o==null?void 0:o.signal);if(d===!0)throw new n2e("unexpected end of input");i.append(l)}const a=i.sublist(0,o.bytes);return i.consume(o.bytes),a},write:async(o,a)=>{var c;(c=a==null?void 0:a.signal)==null||c.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(i.byteLength>0){const o=r.source;r.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield i:yield*i,yield*o}()}return r}}}let i2e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}},s2e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}},o2e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}};function Xd(r,e={}){const t=Qm(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=yt(e.maxDataLength));const n=(e==null?void 0:e.lengthDecoder)??Zi,i=(e==null?void 0:e.lengthEncoder)??Sr;return{read:async o=>{let a=-1;const c=new Be;for(;;){c.append(await t.read({...o,bytes:1}));try{a=n(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new i2e("Invalid message length");if((e==null?void 0:e.maxLengthLength)!=null&&c.byteLength>e.maxLengthLength)throw new o2e("message length length too long");if(a>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&a>e.maxDataLength)throw new s2e("message length too long");return t.read({...o,bytes:a})},write:async(o,a)=>{await t.write(new Be(i(o.byteLength),o),a)},writeV:async(o,a)=>{const c=new Be(...o.flatMap(l=>[i(l.byteLength),l]));await t.write(c,a)},unwrap:()=>t.unwrap()}}function VR(){const r=Le();let e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,r.resolve(t)},source:async function*(){yield*await r.promise}()}}function a2e(){const r=VR(),e=VR();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}const sp=65535,KR=sp-16,op=!!((Bj=(Lj=globalThis.process)==null?void 0:Lj.env)!=null&&Bj.DUMP_SESSION_KEYS);function C9(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function jR(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function ci(r,...e){if(!jR(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function HR(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function c2e(r,e){ci(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function qR(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const kc=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),l2e=r=>new DataView(r.buffer,r.byteOffset,r.byteLength);if(!(new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68))throw new Error("Non little-endian hardware is not supported");function u2e(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function I9(r){if(typeof r=="string")r=u2e(r);else if(jR(r))r=k9(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function d2e(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function h2e(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}const f2e=(r,e)=>{function t(n,...i){if(ci(n),r.nonceLength!==void 0){const d=i[0];if(!d)throw new Error("nonce / iv required");r.varSizeNonce?ci(d):ci(d,r.nonceLength)}const s=r.tagLength;s&&i[1]!==void 0&&ci(i[1]);const o=e(n,...i),a=(d,h)=>{if(h!==void 0){if(d!==2)throw new Error("cipher output not supported");ci(h)}};let c=!1;return{encrypt(d,h){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,ci(d),a(o.encrypt.length,h),o.encrypt(d,h)},decrypt(d,h){if(ci(d),s&&d.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,h),o.decrypt(d,h)}}}return Object.assign(t,r),t};function WR(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!p2e(e))throw new Error("invalid output, must be aligned");return e}function GR(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=4,l=0;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function p2e(r){return r.byteOffset%4===0}function k9(r){return Uint8Array.from(r)}function Zd(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}const QR=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),g2e=QR("expand 16-byte k"),y2e=QR("expand 32-byte k"),m2e=kc(g2e),w2e=kc(y2e);function ot(r,e){return r<<e|r>>>32-e}function _9(r){return r.byteOffset%4===0}const Ym=64,b2e=16,YR=2**32-1,JR=new Uint32Array;function v2e(r,e,t,n,i,s,o,a){const c=i.length,l=new Uint8Array(Ym),d=kc(l),h=_9(i)&&_9(s),p=h?kc(i):JR,m=h?kc(s):JR;for(let f=0;f<c;o++){if(r(e,t,n,d,o,a),o>=YR)throw new Error("arx: counter overflow");const g=Math.min(Ym,c-f);if(h&&g===Ym){const v=f/4;if(f%4!==0)throw new Error("arx: invalid block position");for(let y=0,w;y<b2e;y++)w=v+y,m[w]=p[w]^d[y];f+=Ym;continue}for(let v=0,y;v<g;v++)y=f+v,s[y]=i[y]^l[v];f+=g}}function E2e(r,e){const{allowShortKeys:t,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=d2e({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return C9(i),C9(o),qR(s),qR(t),(a,c,l,d,h=0)=>{ci(a),ci(c),ci(l);const p=l.length;if(d===void 0&&(d=new Uint8Array(p)),ci(d),C9(h),h<0||h>=YR)throw new Error("arx: counter overflow");if(d.length<p)throw new Error(`arx: output (${d.length}) is shorter than data (${p})`);const m=[];let f=a.length,g,v;if(f===32)m.push(g=k9(a)),v=w2e;else if(f===16&&t)g=new Uint8Array(32),g.set(a),g.set(a,16),v=m2e,m.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${f}`);_9(c)||m.push(c=k9(c));const y=kc(g);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(v,y,kc(c.subarray(0,16)),y),c=c.subarray(16)}const w=16-i;if(w!==c.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(w!==12){const E=new Uint8Array(12);E.set(c,s?0:12-c.length),c=E,m.push(c)}const b=kc(c);return v2e(r,v,y,b,l,d,h,o),Zd(...m),d}}const Ar=(r,e)=>r[e++]&255|(r[e++]&255)<<8;class S2e{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=I9(e),ci(e,32);const t=Ar(e,0),n=Ar(e,2),i=Ar(e,4),s=Ar(e,6),o=Ar(e,8),a=Ar(e,10),c=Ar(e,12),l=Ar(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let d=0;d<8;d++)this.pad[d]=Ar(e,16+2*d)}process(e,t,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],l=o[2],d=o[3],h=o[4],p=o[5],m=o[6],f=o[7],g=o[8],v=o[9],y=Ar(e,t+0),w=Ar(e,t+2),b=Ar(e,t+4),E=Ar(e,t+6),A=Ar(e,t+8),k=Ar(e,t+10),x=Ar(e,t+12),I=Ar(e,t+14);let T=s[0]+(y&8191),L=s[1]+((y>>>13|w<<3)&8191),z=s[2]+((w>>>10|b<<6)&8191),B=s[3]+((b>>>7|E<<9)&8191),G=s[4]+((E>>>4|A<<12)&8191),j=s[5]+(A>>>1&8191),q=s[6]+((A>>>14|k<<2)&8191),Q=s[7]+((k>>>11|x<<5)&8191),K=s[8]+((x>>>8|I<<8)&8191),O=s[9]+(I>>>5|i),U=0,W=U+T*a+L*(5*v)+z*(5*g)+B*(5*f)+G*(5*m);U=W>>>13,W&=8191,W+=j*(5*p)+q*(5*h)+Q*(5*d)+K*(5*l)+O*(5*c),U+=W>>>13,W&=8191;let Y=U+T*c+L*a+z*(5*v)+B*(5*g)+G*(5*f);U=Y>>>13,Y&=8191,Y+=j*(5*m)+q*(5*p)+Q*(5*h)+K*(5*d)+O*(5*l),U+=Y>>>13,Y&=8191;let H=U+T*l+L*c+z*a+B*(5*v)+G*(5*g);U=H>>>13,H&=8191,H+=j*(5*f)+q*(5*m)+Q*(5*p)+K*(5*h)+O*(5*d),U+=H>>>13,H&=8191;let ie=U+T*d+L*l+z*c+B*a+G*(5*v);U=ie>>>13,ie&=8191,ie+=j*(5*g)+q*(5*f)+Q*(5*m)+K*(5*p)+O*(5*h),U+=ie>>>13,ie&=8191;let me=U+T*h+L*d+z*l+B*c+G*a;U=me>>>13,me&=8191,me+=j*(5*v)+q*(5*g)+Q*(5*f)+K*(5*m)+O*(5*p),U+=me>>>13,me&=8191;let de=U+T*p+L*h+z*d+B*l+G*c;U=de>>>13,de&=8191,de+=j*a+q*(5*v)+Q*(5*g)+K*(5*f)+O*(5*m),U+=de>>>13,de&=8191;let le=U+T*m+L*p+z*h+B*d+G*l;U=le>>>13,le&=8191,le+=j*c+q*a+Q*(5*v)+K*(5*g)+O*(5*f),U+=le>>>13,le&=8191;let Ne=U+T*f+L*m+z*p+B*h+G*d;U=Ne>>>13,Ne&=8191,Ne+=j*l+q*c+Q*a+K*(5*v)+O*(5*g),U+=Ne>>>13,Ne&=8191;let Me=U+T*g+L*f+z*m+B*p+G*h;U=Me>>>13,Me&=8191,Me+=j*d+q*l+Q*c+K*a+O*(5*v),U+=Me>>>13,Me&=8191;let Xe=U+T*v+L*g+z*f+B*m+G*p;U=Xe>>>13,Xe&=8191,Xe+=j*h+q*d+Q*l+K*c+O*a,U+=Xe>>>13,Xe&=8191,U=(U<<2)+U|0,U=U+W|0,W=U&8191,U=U>>>13,Y+=U,s[0]=W,s[1]=Y,s[2]=H,s[3]=ie,s[4]=me,s[5]=de,s[6]=le,s[7]=Ne,s[8]=Me,s[9]=Xe}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;Zd(n)}update(e){HR(this);const{buffer:t,blockLen:n}=this;e=I9(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}t.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Zd(this.h,this.r,this.buffer,this.pad)}digestInto(e){HR(this),c2e(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}function x2e(r){const e=(n,i)=>r(i).update(I9(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}const A2e=x2e(r=>new S2e(r));function C2e(r,e,t,n,i,s=20){let o=r[0],a=r[1],c=r[2],l=r[3],d=e[0],h=e[1],p=e[2],m=e[3],f=e[4],g=e[5],v=e[6],y=e[7],w=i,b=t[0],E=t[1],A=t[2],k=o,x=a,I=c,T=l,L=d,z=h,B=p,G=m,j=f,q=g,Q=v,K=y,O=w,U=b,W=E,Y=A;for(let ie=0;ie<s;ie+=2)k=k+L|0,O=ot(O^k,16),j=j+O|0,L=ot(L^j,12),k=k+L|0,O=ot(O^k,8),j=j+O|0,L=ot(L^j,7),x=x+z|0,U=ot(U^x,16),q=q+U|0,z=ot(z^q,12),x=x+z|0,U=ot(U^x,8),q=q+U|0,z=ot(z^q,7),I=I+B|0,W=ot(W^I,16),Q=Q+W|0,B=ot(B^Q,12),I=I+B|0,W=ot(W^I,8),Q=Q+W|0,B=ot(B^Q,7),T=T+G|0,Y=ot(Y^T,16),K=K+Y|0,G=ot(G^K,12),T=T+G|0,Y=ot(Y^T,8),K=K+Y|0,G=ot(G^K,7),k=k+z|0,Y=ot(Y^k,16),Q=Q+Y|0,z=ot(z^Q,12),k=k+z|0,Y=ot(Y^k,8),Q=Q+Y|0,z=ot(z^Q,7),x=x+B|0,O=ot(O^x,16),K=K+O|0,B=ot(B^K,12),x=x+B|0,O=ot(O^x,8),K=K+O|0,B=ot(B^K,7),I=I+G|0,U=ot(U^I,16),j=j+U|0,G=ot(G^j,12),I=I+G|0,U=ot(U^I,8),j=j+U|0,G=ot(G^j,7),T=T+L|0,W=ot(W^T,16),q=q+W|0,L=ot(L^q,12),T=T+L|0,W=ot(W^T,8),q=q+W|0,L=ot(L^q,7);let H=0;n[H++]=o+k|0,n[H++]=a+x|0,n[H++]=c+I|0,n[H++]=l+T|0,n[H++]=d+L|0,n[H++]=h+z|0,n[H++]=p+B|0,n[H++]=m+G|0,n[H++]=f+j|0,n[H++]=g+q|0,n[H++]=v+Q|0,n[H++]=y+K|0,n[H++]=w+O|0,n[H++]=b+U|0,n[H++]=E+W|0,n[H++]=A+Y|0}const I2e=E2e(C2e,{counterRight:!1,counterLength:4,allowShortKeys:!1}),k2e=new Uint8Array(16),XR=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(k2e.subarray(t))},_2e=new Uint8Array(32);function ZR(r,e,t,n,i){const s=r(e,t,_2e),o=A2e.create(s);i&&XR(o,i),XR(o,n);const a=new Uint8Array(16),c=l2e(a);GR(c,0,BigInt(i?i.length:0),!0),GR(c,8,BigInt(n.length),!0),o.update(a);const l=o.digest();return Zd(s,a),l}const eL=f2e({blockSize:64,nonceLength:12,tagLength:16},(r=>(e,t,n)=>({encrypt(s,o){const a=s.length;o=WR(a+16,o,!1),o.set(s);const c=o.subarray(0,-16);r(e,t,c,c,1);const l=ZR(r,e,t,c,n);return o.set(l,a),Zd(l),o},decrypt(s,o){o=WR(s.length-16,o,!1);const a=s.subarray(0,-16),c=s.subarray(-16),l=ZR(r,e,t,a,n);if(!h2e(c,l))throw new Error("invalid tag");return o.set(s.subarray(0,-16)),r(e,t,o,o,1),Zd(l),o}}))(I2e));function T2e(r,e,t){return oy(r),t===void 0&&(t=new Uint8Array(r.outputLen)),Iy(r,_1(t),_1(e))}const T9=Uint8Array.from([0]),tL=Uint8Array.of();function P2e(r,e,t,n=32){oy(r),Md(n);const i=r.outputLen;if(n>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(n/i);t===void 0&&(t=tL);const o=new Uint8Array(s*i),a=Iy.create(r,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let d=0;d<s;d++)T9[0]=d+1,c.update(d===0?tL:l).update(t).update(T9).digestInto(l),o.set(l,i*d),a._cloneInto(c);return a.destroy(),c.destroy(),Rs(l,T9),o.slice(0,n)}const D2e={hashSHA256(r){return Ll(r.subarray())},getHKDF(r,e){const t=T2e(Ll,e,r),i=P2e(Ll,t,void 0,96),s=i.subarray(0,32),o=i.subarray(32,64),a=i.subarray(64,96);return[s,o,a]},generateX25519KeyPair(){const r=ty.utils.randomPrivateKey();return{publicKey:ty.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:ty.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,e){return ty.getSharedSecret(r.subarray(),e.subarray())},chaCha20Poly1305Encrypt(r,e,t,n){return eL(n,e,t).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,e,t,n,i){return eL(n,e,t).decrypt(r.subarray(),i)}};function $2e(r){return{generateKeypair:r.generateX25519KeyPair,dh:(e,t)=>r.generateX25519SharedKey(e.privateKey,t).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}const Jm=r=>{const e=In(2);return e[0]=r>>8,e[1]=r,e};Jm.bytes=2;const Xm=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let e=0;return e+=r[0]<<8,e+=r[1],e}return r.getUint16(0)};Xm.bytes=2;function N2e(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function rL(r,e){!e.enabled||!op||(r?(e(`LOCAL_STATIC_PUBLIC_KEY ${re(r.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${re(r.privateKey,"hex")}`)):e("Missing local static keys."))}function nL(r,e){!e.enabled||!op||(r?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${re(r.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${re(r.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function M2e(r,e){!e.enabled||!op||e(r?`REMOTE_STATIC_PUBLIC_KEY ${re(r.subarray(),"hex")}`:"Missing remote static public key.")}function iL(r,e){!e.enabled||!op||e(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${re(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function sL(r,e,t){!t.enabled||!op||(t(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&re(r.k,"hex")}`),t(`CIPHER_STATE_2 ${e.n.getUint64()} ${e.k&&re(e.k,"hex")}`))}function _c(r,e){if(r.length!==e.length)throw new Error("Inputs should have the same length");const t=In(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return t}const N4=class N4 extends Error{constructor(t="Invalid crypto exchange"){super(t);u(this,"code");this.code=N4.code}};u(N4,"code","ERR_INVALID_CRYPTO_EXCHANGE");let ap=N4;const O2e=0,R2e=4294967295,L2e="Cipherstate has reached maximum n, a new handshake must be performed";class B2e{constructor(e=O2e){u(this,"n");u(this,"bytes");u(this,"view");this.n=e,this.bytes=Ge(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>R2e)throw new Error(L2e)}}const eh=Ge(0);class Zm{constructor(e,t=void 0,n=0){u(this,"k");u(this,"n");u(this,"crypto");this.crypto=e,this.k=t,this.n=new B2e(n)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();const n=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),n}decryptWithAd(e,t,n){if(!this.hasKey())return t;this.n.assertValue();const i=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,n);return this.n.increment(),i}}class U2e{constructor(e,t){u(this,"cs");u(this,"ck");u(this,"h");u(this,"crypto");this.crypto=e;const n=se(t,"utf-8");this.h=z2e(e,n),this.ck=this.h,this.cs=new Zm(e)}mixKey(e){const[t,n]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new Zm(this.crypto,n)}mixHash(e){this.h=this.crypto.hash(new Be(this.h,e))}encryptAndHash(e){const t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){const t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){const[e,t]=this.crypto.hkdf(this.ck,eh);return[new Zm(this.crypto,e),new Zm(this.crypto,t)]}}class F2e{constructor(e){u(this,"ss");u(this,"s");u(this,"e");u(this,"rs");u(this,"re");u(this,"initiator");u(this,"crypto");const{crypto:t,protocolName:n,prologue:i,initiator:s,s:o,e:a,rs:c,re:l}=e;this.crypto=t,this.ss=new U2e(t,n),this.ss.mixHash(i),this.initiator=s,this.s=o,this.e=a,this.rs=c,this.re=l}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");const e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw new Error("remote static public key is already set");const n=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+n)throw new Error("message is not long enough");const i=e.sublist(t,t+n);return this.rs=this.ss.decryptAndHash(i),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class oL extends F2e{writeMessageA(e){return new Be(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){const t=this.writeE();this.writeEE();const n=this.writeS();return this.writeES(),new Be(t,n,this.ss.encryptAndHash(e))}writeMessageC(e){const t=this.writeS();return this.writeSE(),new Be(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(t){throw new ap(`handshake stage 0 validation fail: ${t.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();const t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(t){throw new ap(`handshake stage 1 validation fail: ${t.message}`)}}readMessageC(e){try{const t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(t){throw new ap(`handshake stage 2 validation fail: ${t.message}`)}}}function z2e(r,e){if(e.length<=32){const t=Ge(32);return t.set(e),t}else return r.hash(e)}var e3;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(const s of t.webtransportCerthashes)n.uint32(10),n.bytes(s);if(t.streamMuxers!=null)for(const s of t.streamMuxers)n.uint32(18),n.string(s);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={webtransportCerthashes:[],streamMuxers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{if(((a=i.limits)==null?void 0:a.webtransportCerthashes)!=null&&s.webtransportCerthashes.length===i.limits.webtransportCerthashes)throw new mt('Decode error - map field "webtransportCerthashes" had too many elements');s.webtransportCerthashes.push(t.bytes());break}case 2:{if(((c=i.limits)==null?void 0:c.streamMuxers)!=null&&s.streamMuxers.length===i.limits.streamMuxers)throw new mt('Decode error - map field "streamMuxers" had too many elements');s.streamMuxers.push(t.string());break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(e3||(e3={}));var t3;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.identityKey!=null&&t.identityKey.byteLength>0&&(n.uint32(10),n.bytes(t.identityKey)),t.identitySig!=null&&t.identitySig.byteLength>0&&(n.uint32(18),n.bytes(t.identitySig)),t.extensions!=null&&(n.uint32(34),e3.codec().encode(t.extensions,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={identityKey:Ge(0),identitySig:Ge(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.identityKey=t.bytes();break}case 2:{s.identitySig=t.bytes();break}case 4:{s.extensions=e3.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.extensions});break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(t3||(t3={}));async function aL(r,e,t){const n=await r.sign(lL(e));return t3.encode({identityKey:_i(r.publicKey),identitySig:n,extensions:t})}async function cL(r,e,t){try{const n=t3.decode(r),i=_n(n.identityKey);if((t==null?void 0:t.equals(i))===!1)throw new Error(`Payload identity key ${i} does not match expected remote identity key ${t}`);if(!e)throw new Error("Remote static does not exist");const s=lL(e);if(!await i.verify(s,n.identitySig))throw new Error("Invalid payload signature");return n}catch(n){throw new nP(n.message)}}function lL(r){const e=se("noise-libp2p-static-key:");return r instanceof Uint8Array?or([e,r],e.length+r.length):(r.prepend(e),r)}async function V2e(r,e){const{log:t,connection:n,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=r,d=await aL(s,a.publicKey,l),h=new oL({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:o,s:a});rL(h.s,t),t.trace("Stage 0 - Initiator starting to send first message."),await n.write(h.writeMessageA(eh),e),t.trace("Stage 0 - Initiator finished sending first message."),nL(h.e,t),t.trace("Stage 1 - Initiator waiting to receive first message from responder...");const p=h.readMessageB(await n.read(e));t.trace("Stage 1 - Initiator received the message."),iL(h.re,t),M2e(h.rs,t),t.trace("Initiator going to check remote's signature...");const m=await cL(p,h.rs,c);t.trace("All good with the signature!"),t.trace("Stage 2 - Initiator sending third handshake message."),await n.write(h.writeMessageC(d),e),t.trace("Stage 2 - Initiator sent message with signed payload.");const[f,g]=h.ss.split();return sL(f,g,t),{payload:m,encrypt:v=>f.encryptWithAd(eh,v),decrypt:(v,y)=>g.decryptWithAd(eh,v,y)}}async function K2e(r,e){const{log:t,connection:n,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=r,d=await aL(s,a.publicKey,l),h=new oL({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:o,s:a});rL(h.s,t),t.trace("Stage 0 - Responder waiting to receive first message."),h.readMessageA(await n.read(e)),t.trace("Stage 0 - Responder received first message."),iL(h.re,t),t.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(h.writeMessageB(d),e),t.trace("Stage 1 - Responder sent the second handshake message with signed payload."),nL(h.e,t),t.trace("Stage 2 - Responder waiting for third handshake message...");const p=h.readMessageC(await n.read(e));t.trace("Stage 2 - Responder received the message, finished handshake.");const m=await cL(p,h.rs,c),[f,g]=h.ss.split();return sL(f,g,t),{payload:m,encrypt:v=>g.encryptWithAd(eh,v),decrypt:(v,y)=>f.decryptWithAd(eh,v,y)}}const uL=16;function j2e(r,e){return async function*(t){for await(const n of t)for(let i=0;i<n.length;i+=KR){let s=i+KR;s>n.length&&(s=n.length);let o;n instanceof Uint8Array?o=r.encrypt(n.subarray(i,s)):o=r.encrypt(n.sublist(i,s)),e==null||e.encryptedPackets.increment(),yield new Be(Jm(o.byteLength),o)}}}function H2e(r,e){return async function*(t){for await(const n of t)for(let i=0;i<n.length;i+=sp){let s=i+sp;if(s>n.length&&(s=n.length),s-uL<i)throw new Error("Invalid chunk");const o=n.sublist(i,s),a=n.subarray(i,s-uL);try{const c=r.decrypt(o,a);e==null||e.decryptedPackets.increment(),yield c}catch(c){throw e==null||e.decryptErrors.increment(),c}}}}Fj=Symbol.toStringTag,Uj=dr;class q2e{constructor(e,t={}){u(this,"protocol","/noise");u(this,"crypto");u(this,"prologue");u(this,"staticKey");u(this,"extensions");u(this,"metrics");u(this,"components");u(this,Fj,"@chainsafe/libp2p-noise");u(this,Uj,["@libp2p/connection-encryption","@chainsafe/libp2p-noise"]);const{staticNoiseKey:n,extensions:i,crypto:s,prologueBytes:o}=t,{metrics:a}=e;this.components=e;const c=s??D2e;this.crypto=$2e(c),this.extensions={webtransportCerthashes:[],...i},this.metrics=a?N2e(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=o??Ge(0)}async secureOutbound(e,t){var a,c;const n=Xd(e,{lengthEncoder:Jm,lengthDecoder:Xm,maxDataLength:sp}),i=await this.performHandshakeInitiator(n,this.components.privateKey,(a=t==null?void 0:t.remotePeer)==null?void 0:a.publicKey,t),s=await this.createSecureConnection(n,i);e.source=s.source,e.sink=s.sink;const o=_n(i.payload.identityKey);return{conn:e,remoteExtensions:i.payload.extensions,remotePeer:Fd(o),streamMuxer:this.getStreamMuxer((c=i.payload.extensions)==null?void 0:c.streamMuxers)}}getStreamMuxer(e){if(e==null)return;const t=this.components.upgrader.getStreamMuxers();if(t!=null)for(const n of e){const i=t.get(n);if(i!=null)return i}if(e.length)throw new PZ("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(e,t){var a,c;const n=Xd(e,{lengthEncoder:Jm,lengthDecoder:Xm,maxDataLength:sp}),i=await this.performHandshakeResponder(n,this.components.privateKey,(a=t==null?void 0:t.remotePeer)==null?void 0:a.publicKey,t),s=await this.createSecureConnection(n,i);e.source=s.source,e.sink=s.sink;const o=_n(i.payload.identityKey);return{conn:e,remoteExtensions:i.payload.extensions,remotePeer:Fd(o),streamMuxer:this.getStreamMuxer((c=i.payload.extensions)==null?void 0:c.streamMuxers)}}async performHandshakeInitiator(e,t,n,i){var o,a;let s;try{s=await V2e({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},i),(o=this.metrics)==null||o.xxHandshakeSuccesses.increment()}catch(c){throw(a=this.metrics)==null||a.xxHandshakeErrors.increment(),c}return s}async performHandshakeResponder(e,t,n,i){var o,a;let s;try{s=await K2e({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},i),(o=this.metrics)==null||o.xxHandshakeSuccesses.increment()}catch(c){throw(a=this.metrics)==null||a.xxHandshakeErrors.increment(),c}return s}async createSecureConnection(e,t){const[n,i]=a2e(),s=e.unwrap();return await un(n,j2e(t,this.metrics),s,o=>Bd(o,{lengthDecoder:Xm}),H2e(t,this.metrics),n),i}}function dL(r={}){return e=>new q2e(e,r)}function hL(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}class Ql extends Error{constructor(e="The frame was invalid"){super(e),this.name="InvalidFrameError"}}u(Ql,"name","InvalidFrameError");class P9 extends Error{constructor(e="Unrequested ping error"){super(e),this.name="UnrequestedPingError"}}u(P9,"name","UnrequestedPingError");class D9 extends Error{constructor(e="Unrequested ping error"){super(e),this.name="NotMatchingPingError"}}u(D9,"name","NotMatchingPingError");class fL extends Error{constructor(e="Invalid state"){super(e),this.name="InvalidStateError"}}u(fL,"name","InvalidStateError");class pL extends Error{constructor(e="Strean already exists"){super(e),this.name="StreamAlreadyExistsError"}}u(pL,"name","StreamAlreadyExistsError");class gL extends Error{constructor(e="Decode invalid version"){super(e),this.name="DecodeInvalidVersionError"}}u(gL,"name","DecodeInvalidVersionError");class yL extends Error{constructor(e="Both clients"){super(e),this.name="BothClientsError"}}u(yL,"name","BothClientsError");class $9 extends Error{constructor(e="Receive window exceeded"){super(e),this.name="ReceiveWindowExceededError"}}u($9,"name","ReceiveWindowExceededError");const W2e=new Set([Ql.name,P9.name,D9.name,pL.name,gL.name,yL.name,$9.name]),N9=256*1024,G2e=16*1024*1024,Q2e={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:N9,maxStreamWindowSize:G2e,maxMessageSize:64*1024};function Y2e(r){if(r.keepAliveInterval<=0)throw new Z("keep-alive interval must be positive");if(r.maxInboundStreams<0)throw new Z("max inbound streams must be larger or equal 0");if(r.maxOutboundStreams<0)throw new Z("max outbound streams must be larger or equal 0");if(r.initialStreamWindowSize<N9)throw new Z("InitialStreamWindowSize must be larger or equal 256 kB");if(r.maxStreamWindowSize<r.initialStreamWindowSize)throw new Z("MaxStreamWindowSize must be larger than the InitialStreamWindowSize");if(r.maxStreamWindowSize>2**32-1)throw new Z("MaxStreamWindowSize must be less than equal MAX_UINT32");if(r.maxMessageSize<1024)throw new Z("MaxMessageSize must be greater than a kilobyte")}var ar;(function(r){r[r.Data=0]="Data",r[r.WindowUpdate=1]="WindowUpdate",r[r.Ping=2]="Ping",r[r.GoAway=3]="GoAway"})(ar||(ar={}));var Wt;(function(r){r[r.SYN=1]="SYN",r[r.ACK=2]="ACK",r[r.FIN=4]="FIN",r[r.RST=8]="RST"})(Wt||(Wt={})),Object.values(Wt).filter(r=>typeof r!="string");const J2e=0;var Ks;(function(r){r[r.NormalTermination=0]="NormalTermination",r[r.ProtocolError=1]="ProtocolError",r[r.InternalError=2]="InternalError"})(Ks||(Ks={}));const cp=12,mL=2**24;function X2e(r){if(r[0]!==J2e)throw new Ql("Invalid frame version");return{type:r[1],flag:(r[2]<<8)+r[3],streamID:r[4]*mL+(r[5]<<16)+(r[6]<<8)+r[7],length:r[8]*mL+(r[9]<<16)+(r[10]<<8)+r[11]}}let Z2e=class{constructor(e){u(this,"source");u(this,"buffer");u(this,"frameInProgress");this.source=eye(e),this.buffer=new Be,this.frameInProgress=!1}async*emitFrames(){for await(const e of this.source)for(this.buffer.append(e);;){const t=this.readHeader();if(t===void 0)break;const{type:n,length:i}=t;n===ar.Data?(this.frameInProgress=!0,yield{header:t,readData:this.readBytes.bind(this,i)}):yield{header:t}}}readHeader(){if(this.frameInProgress)throw new fL("decoding frame already in progress");if(this.buffer.length<cp)return;const e=X2e(this.buffer.subarray(0,cp));return this.buffer.consume(cp),e}async readBytes(e){if(this.buffer.length<e){for await(const n of this.source)if(this.buffer.append(n),this.buffer.length>=e)break}const t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}};function eye(r){if(r[Symbol.iterator]!==void 0){const e=r[Symbol.iterator]();return e.return=void 0,{[Symbol.iterator](){return e}}}else if(r[Symbol.asyncIterator]!==void 0){const e=r[Symbol.asyncIterator]();return e.return=void 0,{[Symbol.asyncIterator](){return e}}}else throw new Error("a source must be either an iterable or an async iterable")}function wL(r){const e=new Uint8Array(cp);return e[1]=r.type,e[2]=r.flag>>>8,e[3]=r.flag,e[4]=r.streamID>>>24,e[5]=r.streamID>>>16,e[6]=r.streamID>>>8,e[7]=r.streamID,e[8]=r.length>>>24,e[9]=r.length>>>16,e[10]=r.length>>>8,e[11]=r.length,e}function tye(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function bL(r,e){var n,i;const t=(i=(n=hL(r)).return)==null?void 0:i.call(n);tye(t)&&t.catch(s=>{e.error("could not cause iterator to return",s)})}const rye=5e3;function M9(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}class O9{constructor(e){u(this,"id");u(this,"direction");u(this,"timeline");u(this,"protocol");u(this,"metadata");u(this,"source");u(this,"status");u(this,"readStatus");u(this,"writeStatus");u(this,"log");u(this,"sinkController");u(this,"sinkEnd");u(this,"closed");u(this,"endErr");u(this,"streamSource");u(this,"onEnd");u(this,"onCloseRead");u(this,"onCloseWrite");u(this,"onReset");u(this,"onAbort");u(this,"sendCloseWriteTimeout");u(this,"sendingData");this.sinkController=new AbortController,this.sinkEnd=Le(),this.closed=Le(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??rye,this.onEnd=e.onEnd,this.onCloseRead=e==null?void 0:e.onCloseRead,this.onCloseWrite=e==null?void 0:e.onCloseWrite,this.onReset=e==null?void 0:e.onReset,this.onAbort=e==null?void 0:e.onAbort,this.source=this.streamSource=yo({onEnd:t=>{t!=null?this.log.trace("source ended with error",t):this.log.trace("source ended"),this.onSourceEnd(t)}}),this.sink=this.sink.bind(this)}async sink(e){if(this.writeStatus!=="ready")throw new P2(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";const t={signal:this.sinkController.signal};if(this.direction==="outbound"){const i=this.sendNewStream(t);M9(i)&&await i}const n=()=>{bL(e,this.log)};try{this.sinkController.signal.addEventListener("abort",n),this.log.trace("sink reading from source");for await(let i of e){i=i instanceof Uint8Array?new Be(i):i;const s=this.sendData(i,t);M9(s)&&(this.sendingData=Le(),await s,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",n)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(t){throw this.log.trace("sink ended with error, calling abort with error",t),this.abort(t),t}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){var t;this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(t=this.onCloseRead)==null||t.call(this),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){var t;this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(t=this.onCloseWrite)==null||t.call(this),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.status==="open"&&(this.log.trace("closing gracefully"),this.status="closing",await ln(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e==null?void 0:e.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(e={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const t=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),t==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(e={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),await ln(this.sink([]),e.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&await ln(this.sendingData.promise,e.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await ln(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){var n;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",e),this.log("try to send reset to remote");const t=this.sendReset();M9(t)&&t.catch(i=>{this.log.error("error sending reset message",i)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),(n=this.onAbort)==null||n.call(this,e)}reset(){var t;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;const e=new sP("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),(t=this.onReset)==null||t.call(this)}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}var as;(function(r){r[r.Init=0]="Init",r[r.SYNSent=1]="SYNSent",r[r.SYNReceived=2]="SYNReceived",r[r.Established=3]="Established",r[r.Finished=4]="Finished"})(as||(as={}));class nye extends O9{constructor(t){super({...t,onEnd:n=>{var i;this.state=as.Finished,(i=t.onEnd)==null||i.call(t,n)}});u(this,"name");u(this,"state");u(this,"config");u(this,"_id");u(this,"sendWindowCapacity");u(this,"sendWindowCapacityUpdate");u(this,"recvWindow");u(this,"recvWindowCapacity");u(this,"epochStart");u(this,"getRTT");u(this,"sendFrame");this.config=t.config,this._id=parseInt(t.id,10),this.name=t.name,this.state=t.state,this.sendWindowCapacity=N9,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=t.getRTT,this.sendFrame=t.sendFrame,this.source=im(this.source,()=>{this.sendWindowUpdate()})}async sendNewStream(){}async sendData(t,n={}){var i,s;for(t=t.sublist();t.byteLength!==0;){if(this.sendWindowCapacity===0&&((i=this.log)==null||i.trace("wait for send window capacity, status %s",this.status),await this.waitForSendWindowCapacity(n),this.status==="closed"||this.status==="aborted"||this.status==="reset")){(s=this.log)==null||s.trace("%s while waiting for send window capacity",this.status);return}const o=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-cp,t.length),a=this.getSendFlags();this.sendFrame({type:ar.Data,flag:a,streamID:this._id,length:o},t.sublist(0,o)),this.sendWindowCapacity-=o,t.consume(o)}}async sendReset(){this.sendFrame({type:ar.WindowUpdate,flag:Wt.RST,streamID:this._id,length:0})}async sendCloseWrite(){const t=this.getSendFlags()|Wt.FIN;this.sendFrame({type:ar.WindowUpdate,flag:t,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(t={}){var o,a;if(this.sendWindowCapacity>0)return;let n,i;const s=()=>{this.status==="open"||this.status==="closing"?i(new _l("Stream aborted")):n()};(o=t.signal)==null||o.addEventListener("abort",s);try{await new Promise((c,l)=>{this.sendWindowCapacityUpdate=()=>{c()},i=l,n=c})}finally{(a=t.signal)==null||a.removeEventListener("abort",s)}}handleWindowUpdate(t){var i,s;(i=this.log)==null||i.trace("stream received window update id=%s",this._id),this.processFlags(t.flag);const n=this.sendWindowCapacity;this.sendWindowCapacity+=t.length,n===0&&t.length>0&&((s=this.sendWindowCapacityUpdate)==null||s.call(this))}async handleData(t,n){var s;if((s=this.log)==null||s.trace("stream received data id=%s",this._id),this.processFlags(t.flag),this.recvWindowCapacity<t.length)throw new $9("Receive window exceeded");const i=await n();this.recvWindowCapacity-=t.length,this.sourcePush(i)}processFlags(t){(t&Wt.ACK)===Wt.ACK&&this.state===as.SYNSent&&(this.state=as.Established),(t&Wt.FIN)===Wt.FIN&&this.remoteCloseWrite(),(t&Wt.RST)===Wt.RST&&this.reset()}getSendFlags(){switch(this.state){case as.Init:return this.state=as.SYNSent,Wt.SYN;case as.SYNReceived:return this.state=as.Established,Wt.ACK;default:return 0}}sendWindowUpdate(){const t=this.getSendFlags(),n=Date.now(),i=this.getRTT();if(t===0&&i>-1&&n-this.epochStart<i*4&&(this.recvWindow=Math.min(this.recvWindow*2,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&t===0)return;const s=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=n,this.sendFrame({type:ar.WindowUpdate,flag:t,streamID:this._id,length:s})}}const vL="/yamux/1.0.0",iye=500;Vj=Symbol.toStringTag,zj=dr;class sye{constructor(e,t={}){u(this,"protocol",vL);u(this,"_components");u(this,"_init");u(this,Vj,"@chainsafe/libp2p-yamux");u(this,zj,["@libp2p/stream-multiplexing"]);this._components=e,this._init=t}createStreamMuxer(e){return new oye(this._components,{...this._init,...e})}}class oye{constructor(e,t){u(this,"protocol",vL);u(this,"source");u(this,"sink");u(this,"config");u(this,"log");u(this,"logger");u(this,"closeController");u(this,"nextStreamID");u(this,"_streams");u(this,"nextPingID");u(this,"activePing");u(this,"rtt");u(this,"client");u(this,"localGoAway");u(this,"remoteGoAway");u(this,"numInboundStreams");u(this,"numOutboundStreams");u(this,"onIncomingStream");u(this,"onStreamEnd");var n;this.client=t.direction==="outbound",this.config={...Q2e,...t},this.logger=e.logger,this.log=this.logger.forComponent("libp2p:yamux"),Y2e(this.config),this.closeController=new AbortController,this.closeController.signal,this.onIncomingStream=t.onIncomingStream,this.onStreamEnd=t.onStreamEnd,this._streams=new Map,this.source=yo({onEnd:()=>{var i;(i=this.log)==null||i.trace("muxer source ended"),this._streams.forEach(s=>{s.destroy()})}}),this.sink=async i=>{var c,l,d;const s=()=>{const h=hL(i);if(h.return!=null){const p=h.return();aye(p)&&p.catch(m=>{var f;(f=this.log)==null||f.call(this,"could not cause sink source to return",m)})}};let o,a;try{const h=new Z2e(i);try{this.closeController.signal.addEventListener("abort",s);for await(const p of h.emitFrames())await this.handleFrame(p.header,p.readData)}finally{this.closeController.signal.removeEventListener("abort",s)}o=Ks.NormalTermination}catch(h){W2e.has(h.name)?((c=this.log)==null||c.error("protocol error in sink",h),o=Ks.ProtocolError):((l=this.log)==null||l.error("internal error in sink",h),o=Ks.InternalError),a=h}(d=this.log)==null||d.trace("muxer sink ended"),a!=null?this.abort(a,o):await this.close({reason:o})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,(n=this.log)==null||n.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("keepalive error: %s",i)}),this.ping().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("ping error: %s",i)})}get streams(){return Array.from(this._streams.values())}newStream(e){var i;if(this.remoteGoAway!==void 0)throw new Tl("Muxer closed remotely");if(this.localGoAway!==void 0)throw new Tl("Muxer closed locally");const t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new M2("max outbound streams exceeded");(i=this.log)==null||i.trace("new outgoing stream id=%s",t);const n=this._newStream(t,e,as.Init,"outbound");return this._streams.set(t,n),this.numOutboundStreams++,n.sendWindowUpdate(),n}async ping(){if(this.remoteGoAway!==void 0)throw new Tl("Muxer closed remotely");if(this.localGoAway!==void 0)throw new Tl("Muxer closed locally");if(this.activePing===void 0){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((i,s)=>{const o=()=>{s(new Tl("Muxer closed locally"))};this.closeController.signal.addEventListener("abort",o,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",o),i()}}),resolve:e};const t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const n=Date.now();this.rtt=n-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(e={}){var n;if(this.closeController.signal.aborted)return;const t=(e==null?void 0:e.reason)??Ks.NormalTermination;if((n=this.log)==null||n.trace("muxer close reason=%s",t),e.signal==null){const i=AbortSignal.timeout(iye);e={...e,signal:i}}try{await Promise.all([...this._streams.values()].map(async i=>i.close(e))),this.sendGoAway(t),this._closeMuxer()}catch(i){this.abort(i)}}abort(e,t){var n;if(!this.closeController.signal.aborted){t=t??Ks.InternalError,(n=this.log)==null||n.error("muxer abort reason=%s error=%s",t,e);for(const i of this._streams.values())i.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,n,i){if(this._streams.get(e)!=null)throw new Z("Stream already exists with that id");const s=new nye({id:e.toString(),name:t,state:n,direction:i,sendFrame:this.sendFrame.bind(this),onEnd:()=>{var o;this.closeStream(e),(o=this.onStreamEnd)==null||o.call(this,s)},log:this.logger.forComponent(`libp2p:yamux:${i}:${e}`),config:this.config,getRTT:this.getRTT.bind(this)});return s}closeStream(e){this.client===(e%2===0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){var t;const e=new Promise((n,i)=>{this.closeController.signal.addEventListener("abort",i,{once:!0})});for((t=this.log)==null||t.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let n;try{await Promise.race([e,new Promise(i=>{n=setTimeout(i,this.config.keepAliveInterval)})]),this.ping().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("ping error: %s",i)})}catch{clearInterval(n);return}}}async handleFrame(e,t){var o;const{streamID:n,type:i,length:s}=e;if((o=this.log)==null||o.trace("received frame %o",e),n===0)switch(i){case ar.Ping:{this.handlePing(e);return}case ar.GoAway:{this.handleGoAway(s);return}default:throw new Ql("Invalid frame type")}else switch(e.type){case ar.Data:case ar.WindowUpdate:{await this.handleStreamMessage(e,t);return}default:throw new Ql("Invalid frame type")}}handlePing(e){var t,n;if(e.flag===Wt.SYN)(t=this.log)==null||t.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,Wt.ACK);else if(e.flag===Wt.ACK)(n=this.log)==null||n.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length);else throw new Ql("Invalid frame flag")}handlePingResponse(e){if(this.activePing===void 0)throw new P9("ping not requested");if(this.activePing.id!==e)throw new D9("ping doesn't match our id");this.activePing.resolve()}handleGoAway(e){var t;(t=this.log)==null||t.trace("received GoAway reason=%s",Ks[e]??"unknown"),this.remoteGoAway=e;for(const n of this._streams.values())n.reset();this._closeMuxer()}async handleStreamMessage(e,t){var a,c;const{streamID:n,flag:i,type:s}=e;(i&Wt.SYN)===Wt.SYN&&this.incomingStream(n);const o=this._streams.get(n);if(o===void 0){if(s===ar.Data){if((a=this.log)==null||a.call(this,"discarding data for stream id=%s",n),t===void 0)throw new Error("unreachable");await t()}else(c=this.log)==null||c.trace("frame for missing stream id=%s",n);return}switch(s){case ar.WindowUpdate:{o.handleWindowUpdate(e);return}case ar.Data:{if(t===void 0)throw new Error("unreachable");await o.handleData(e,t);return}default:throw new Error("unreachable")}}incomingStream(e){var n,i,s;if(this.client!==(e%2===0))throw new Z("Both endpoints are clients");if(this._streams.has(e))return;if((n=this.log)==null||n.trace("new incoming stream id=%s",e),this.localGoAway!==void 0){this.sendFrame({type:ar.WindowUpdate,flag:Wt.RST,streamID:e,length:0});return}if(this.numInboundStreams>=this.config.maxInboundStreams){(i=this.log)==null||i.call(this,"maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:ar.WindowUpdate,flag:Wt.RST,streamID:e,length:0});return}const t=this._newStream(e,void 0,as.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),(s=this.onIncomingStream)==null||s.call(this,t)}sendFrame(e,t){var n;if((n=this.log)==null||n.trace("sending frame %o",e),e.type===ar.Data){if(t===void 0)throw new Ql("Invalid frame");this.source.push(new Be(wL(e),t))}else this.source.push(wL(e))}sendPing(e,t=Wt.SYN){var n,i;t===Wt.SYN?(n=this.log)==null||n.trace("sending ping request pingId=%s",e):(i=this.log)==null||i.trace("sending ping response pingId=%s",e),this.sendFrame({type:ar.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=Ks.NormalTermination){var t;(t=this.log)==null||t.call(this,"sending GoAway reason=%s",Ks[e]),this.localGoAway=e,this.sendFrame({type:ar.GoAway,flag:0,streamID:0,length:e})}}function aye(r){return r!=null&&typeof r.then=="function"}function cye(r={}){return e=>new sye(e,r)}const lye=41;function EL(r){try{const[[e,t]]=r.stringTuples();if(t==null)return!1;if(e===lye)return Phe("2000::/3",t)}catch{}return!1}const uye=4,dye=41;function SL(r){try{const[[e]]=r.stringTuples();return e===uye||e===dye}catch{}return!1}function Yl(r){try{if(!SL(r))return!1;const[[,e]]=r.stringTuples();return e==null?!1:bc(e)??!1}catch{}return!0}function hye(r,e,t){let n,i;function s(){const a={signal:i.signal};if((t==null?void 0:t.timeout)!=null){const c=pt([i.signal,AbortSignal.timeout(t.timeout)]);a.signal=c}Promise.resolve().then(async()=>{await r(a)}).catch(()=>{}).finally(()=>{i.signal.aborted||(n=setTimeout(s,e))})}let o=!1;return{setInterval:a=>{e=a,n!=null&&(clearTimeout(n),n=setTimeout(s,e))},setTimeout:a=>{t==null&&(t={}),t.timeout=a},start:()=>{o||(o=!0,i=new AbortController,i.signal,(t==null?void 0:t.runImmediately)===!0?queueMicrotask(()=>{s()}):n=setTimeout(s,e))},stop:()=>{clearTimeout(n),i==null||i.abort(),o=!1}}}function li(r,e){const t=Xd(r,e),n={read:async(i,s)=>{const o=await t.read(s);return i.decode(o)},write:async(i,s,o)=>{await t.write(s.encode(i),o)},writeV:async(i,s,o)=>{await t.writeV(i.map(a=>s.encode(a)),o)},pb:i=>({read:async s=>n.read(i,s),write:async(s,o)=>n.write(s,i,o),writeV:async(s,o)=>n.writeV(s,i,o),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}function fye(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var pye=AL,xL=128,gye=-128,yye=Math.pow(2,31);function AL(r,e,t){e=e||[],t=t||0;for(var n=t;r>=yye;)e[t++]=r&255|xL,r/=128;for(;r&gye;)e[t++]=r&255|xL,r>>>=7;return e[t]=r|0,AL.bytes=t-n+1,e}var mye=R9,wye=128,CL=127;function R9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw R9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&CL)<<i:(o&CL)*Math.pow(2,i),i+=7}while(o>=wye);return R9.bytes=s-n,t}var bye=Math.pow(2,7),vye=Math.pow(2,14),Eye=Math.pow(2,21),Sye=Math.pow(2,28),xye=Math.pow(2,35),Aye=Math.pow(2,42),Cye=Math.pow(2,49),Iye=Math.pow(2,56),kye=Math.pow(2,63),_ye=function(r){return r<bye?1:r<vye?2:r<Eye?3:r<Sye?4:r<xye?5:r<Aye?6:r<Cye?7:r<Iye?8:r<kye?9:10},Tye={encode:pye,decode:mye,encodingLength:_ye},IL=Tye;function kL(r,e=0){return[IL.decode(r,e),IL.decode.bytes]}function Pye(r){const e=fye(r),[t,n]=kL(e),[i,s]=kL(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Dye(t,i,o,e)}let Dye=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};const $ye="libp2p",Nye="autonat",Mye="1.0.0",Oye=3e4,Rye=2,Lye=20,Bye=80,Uye=8192;var Rt;(function(r){(function(i){i.DIAL="DIAL",i.DIAL_RESPONSE="DIAL_RESPONSE"})(r.MessageType||(r.MessageType={}));let e;(function(i){i[i.DIAL=0]="DIAL",i[i.DIAL_RESPONSE=1]="DIAL_RESPONSE"})(e||(e={})),function(i){i.codec=()=>kn(e)}(r.MessageType||(r.MessageType={})),function(i){i.OK="OK",i.E_DIAL_ERROR="E_DIAL_ERROR",i.E_DIAL_REFUSED="E_DIAL_REFUSED",i.E_BAD_REQUEST="E_BAD_REQUEST",i.E_INTERNAL_ERROR="E_INTERNAL_ERROR"}(r.ResponseStatus||(r.ResponseStatus={}));let t;(function(i){i[i.OK=0]="OK",i[i.E_DIAL_ERROR=100]="E_DIAL_ERROR",i[i.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",i[i.E_BAD_REQUEST=200]="E_BAD_REQUEST",i[i.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"})(t||(t={})),function(i){i.codec=()=>kn(t)}(r.ResponseStatus||(r.ResponseStatus={})),function(i){let s;i.codec=()=>(s==null&&(s=$e((o,a,c={})=>{if(c.lengthDelimited!==!1&&a.fork(),o.id!=null&&(a.uint32(10),a.bytes(o.id)),o.addrs!=null)for(const l of o.addrs)a.uint32(18),a.bytes(l);c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{var h;const l={addrs:[]},d=a==null?o.len:o.pos+a;for(;o.pos<d;){const p=o.uint32();switch(p>>>3){case 1:{l.id=o.bytes();break}case 2:{if(((h=c.limits)==null?void 0:h.addrs)!=null&&l.addrs.length===c.limits.addrs)throw new mt('Decode error - map field "addrs" had too many elements');l.addrs.push(o.bytes());break}default:{o.skipType(p&7);break}}}return l})),s),i.encode=o=>De(o,i.codec()),i.decode=(o,a)=>Pe(o,i.codec(),a)}(r.PeerInfo||(r.PeerInfo={})),function(i){let s;i.codec=()=>(s==null&&(s=$e((o,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),o.peer!=null&&(a.uint32(10),r.PeerInfo.codec().encode(o.peer,a)),c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{var h;const l={},d=a==null?o.len:o.pos+a;for(;o.pos<d;){const p=o.uint32();switch(p>>>3){case 1:{l.peer=r.PeerInfo.codec().decode(o,o.uint32(),{limits:(h=c.limits)==null?void 0:h.peer});break}default:{o.skipType(p&7);break}}}return l})),s),i.encode=o=>De(o,i.codec()),i.decode=(o,a)=>Pe(o,i.codec(),a)}(r.Dial||(r.Dial={})),function(i){let s;i.codec=()=>(s==null&&(s=$e((o,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),o.status!=null&&(a.uint32(8),r.ResponseStatus.codec().encode(o.status,a)),o.statusText!=null&&(a.uint32(18),a.string(o.statusText)),o.addr!=null&&(a.uint32(26),a.bytes(o.addr)),c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{const l={},d=a==null?o.len:o.pos+a;for(;o.pos<d;){const h=o.uint32();switch(h>>>3){case 1:{l.status=r.ResponseStatus.codec().decode(o);break}case 2:{l.statusText=o.string();break}case 3:{l.addr=o.bytes();break}default:{o.skipType(h&7);break}}}return l})),s),i.encode=o=>De(o,i.codec()),i.decode=(o,a)=>Pe(o,i.codec(),a)}(r.DialResponse||(r.DialResponse={}));let n;r.codec=()=>(n==null&&(n=$e((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.type!=null&&(s.uint32(8),r.MessageType.codec().encode(i.type,s)),i.dial!=null&&(s.uint32(18),r.Dial.codec().encode(i.dial,s)),i.dialResponse!=null&&(s.uint32(26),r.DialResponse.codec().encode(i.dialResponse,s)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l,d;const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const h=i.uint32();switch(h>>>3){case 1:{a.type=r.MessageType.codec().decode(i);break}case 2:{a.dial=r.Dial.codec().decode(i,i.uint32(),{limits:(l=o.limits)==null?void 0:l.dial});break}case 3:{a.dialResponse=r.DialResponse.codec().decode(i,i.uint32(),{limits:(d=o.limits)==null?void 0:d.dialResponse});break}default:{i.skipType(h&7);break}}}return a})),n),r.encode=i=>De(i,r.codec()),r.decode=(i,s)=>Pe(i,r.codec(),s)})(Rt||(Rt={}));const Fye=4,zye=8;class Vye{constructor(e,t){u(this,"components");u(this,"protocol");u(this,"timeout");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"maxMessageSize");u(this,"started");u(this,"log");u(this,"topologyId");u(this,"dialResults");u(this,"findPeers");u(this,"addressFilter");u(this,"connectionThreshold");u(this,jj,"@libp2p/autonat");u(this,Kj,["@libp2p/autonat"]);this.components=e,this.log=e.logger.forComponent("libp2p:auto-nat"),this.started=!1,this.protocol=`/${t.protocolPrefix??$ye}/${Nye}/${Mye}`,this.timeout=t.timeout??Oye,this.maxInboundStreams=t.maxInboundStreams??Rye,this.maxOutboundStreams=t.maxOutboundStreams??Lye,this.connectionThreshold=t.connectionThreshold??Bye,this.maxMessageSize=t.maxMessageSize??Uye,this.dialResults=new Map,this.findPeers=hye(this.findRandomPeers.bind(this),6e4),this.addressFilter=zl(1024)}get[(jj=Symbol.toStringTag,Kj=dr,Qa)](){return["@libp2p/identify"]}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,e=>{this.handleIncomingAutonatStream(e).catch(t=>{this.log.error("error handling incoming autonat stream - %e",t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.topologyId=await this.components.registrar.register(this.protocol,{onConnect:(e,t)=>{this.verifyExternalAddresses(t).catch(n=>{this.log.error("could not verify addresses - %e",n)})}}),this.findPeers.start(),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),this.topologyId!=null&&await this.components.registrar.unhandle(this.topologyId),this.dialResults.clear(),this.findPeers.stop(),this.started=!1}allAddressesAreVerified(){return this.components.addressManager.getAddressesWithMetadata().every(e=>e.expires>Date.now()?!0:e.verified)}async findRandomPeers(e){if(this.allAddressesAreVerified())return;const t=pt([AbortSignal.timeout(1e4),e==null?void 0:e.signal]);try{this.log("starting random walk to find peers to run AutoNAT");for await(const n of this.components.randomWalk.walk({signal:t})){if(!await this.components.connectionManager.isDialable(n.multiaddrs)){this.log.trace("random peer %p was not dialable %s",n.id,n.multiaddrs.map(i=>i.toString()).join(", "));continue}try{this.log.trace("dial random peer %p",n.id),await this.components.connectionManager.openConnection(n.multiaddrs,{signal:t})}catch{}if(this.allAddressesAreVerified()){this.log("stopping random walk, all addresses are verified");return}if(!this.hasConnectionCapacity()){this.log("stopping random walk, too close to max connections");return}}}catch{}}async handleIncomingAutonatStream(e){const t=AbortSignal.timeout(this.timeout),n=li(e.stream,{maxDataLength:this.maxMessageSize}).pb(Rt);try{const i=await n.read({signal:t}),s=await this.handleAutonatMessage(i,e.connection,{signal:t});await n.write(s,{signal:t}),await n.unwrap().unwrap().close({signal:t})}catch(i){this.log.error("error handling incoming autonat stream - %e",i),e.stream.abort(i)}}async handleAutonatMessage(e,t,n){const i=this.components.addressManager.getAddresses().map(h=>h.toOptions().host),s=e.dial;if(s==null)return this.log.error("dial was missing from message"),{type:Rt.MessageType.DIAL_RESPONSE,dialResponse:{status:Rt.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}};let o;const a=s.peer;if((a==null?void 0:a.id)==null)return this.log.error("PeerId missing from message"),{type:Rt.MessageType.DIAL_RESPONSE,dialResponse:{status:Rt.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}};try{const h=Pye(a.id);o=ti(h)}catch(h){return this.log.error("invalid PeerId - %e",h),{type:Rt.MessageType.DIAL_RESPONSE,dialResponse:{status:Rt.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}}if(this.log("incoming request from %p",o),!t.remotePeer.equals(o))return this.log("target peer %p did not equal sending peer %p",o,t.remotePeer),{type:Rt.MessageType.DIAL_RESPONSE,dialResponse:{status:Rt.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}};const c=a.addrs.map(h=>Re(h)).filter(h=>{const p=h.toOptions();return Yl(h)?!1:p.host!==t.remoteAddr.toOptions().host?(this.log.trace("not dialing %a - target host did not match remote host %a",h,t.remoteAddr),!1):i.includes(p.host)?!1:this.components.transportManager.dialTransportForMultiaddr(h)==null?(this.log.trace("not dialing %a - transport unsupported",h),!1):!0}).map(h=>(h.getPeerId()==null&&(h=h.encapsulate(`/p2p/${o.toString()}`)),h));if(c.length===0)return this.log("refused to dial all multiaddrs for %p from message",o),{type:Rt.MessageType.DIAL_RESPONSE,dialResponse:{status:Rt.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}};this.log("dial multiaddrs %s for peer %p",c.map(h=>h.toString()).join(", "),o);let l="",d=c[0];for await(const h of c){let p;d=h;try{if(p=await this.components.connectionManager.openConnection(h,n),!p.remoteAddr.equals(h))throw this.log.error("tried to dial %a but dialed %a",h,p.remoteAddr),new Error("Unexpected remote address");return this.log("successfully dialed %p via %a",o,h),{type:Rt.MessageType.DIAL_RESPONSE,dialResponse:{status:Rt.ResponseStatus.OK,addr:p.remoteAddr.decapsulateCode(ze("p2p").code).bytes}}}catch(m){this.log.error("could not dial %p - %e",o,m),l=m.message}finally{p!=null&&await p.close()}}return{type:Rt.MessageType.DIAL_RESPONSE,dialResponse:{status:Rt.ResponseStatus.E_DIAL_ERROR,statusText:l,addr:d.bytes}}}getFirstUnverifiedMultiaddr(e,t){var i,s;const n=this.components.addressManager.getAddressesWithMetadata().sort((o,a)=>o.type==="observed"&&a.type!=="observed"?1:a.type==="observed"&&o.type!=="observed"?-1:0).filter(o=>!(!(o.expires<Date.now())||o.multiaddr.toOptions().family===6&&(!t||!EL(o.multiaddr))||Yl(o.multiaddr)));for(const o of n){const a=o.multiaddr.toString();let c=this.dialResults.get(a);if(c!=null){if(c.networkSegments.includes(e)){this.log.trace("%a already has a network segment result from %s",c.multiaddr,e);continue}if(c.queue.size>10){this.log.trace("%a already has enough peers queued",c.multiaddr);continue}}if(c==null){const l=o.expires<Date.now();if(l&&((s=(i=this.addressFilter).remove)==null||s.call(i,a)),this.addressFilter.has(a))continue;this.addressFilter.add(a),this.log.trace("creating dial result %s %s",l?"to revalidate":"for",a),c={multiaddr:o.multiaddr,success:0,failure:0,networkSegments:[],verifyingPeers:koe(),queue:new lc({concurrency:3,maxSize:50}),type:o.type,lastVerified:o.lastVerified},this.dialResults.set(a,c)}return c}}removeOutdatedMultiaddrResults(){const e=new Set(this.components.addressManager.getAddressesWithMetadata().filter(({expires:t})=>t<Date.now()).map(({multiaddr:t})=>t.toString()));for(const t of this.dialResults.keys())e.has(t)||(this.log.trace("remove results for %a",t),this.dialResults.delete(t))}async verifyExternalAddresses(e){if(!this.isStarted())return;this.removeOutdatedMultiaddrResults();const n=(await this.components.peerStore.get(e.remotePeer)).addresses.some(({multiaddr:o})=>o.toOptions().family===6),i=this.getNetworkSegment(e.remoteAddr),s=this.getFirstUnverifiedMultiaddr(i,n);if(s==null){this.log.trace("no unverified public addresses found for peer %p to verify, not requesting verification",e.remotePeer);return}if(!this.hasConnectionCapacity()){s.lastVerified!=null?(this.log("automatically re-verifying %a because we are too close to the connection limit",s.multiaddr),this.confirmAddress(s)):this.log("skipping verifying %a because we are too close to the connection limit",s.multiaddr);return}s.queue.add(async o=>{await this.askPeerToVerify(e,i,o)},{peerId:e.remotePeer,multiaddr:s.multiaddr}).catch(o=>{(s==null?void 0:s.result)==null&&this.log.error("error from %p verifying address %a - %e",e.remotePeer,s==null?void 0:s.multiaddr,o)})}async askPeerToVerify(e,t,n){let i=this.dialResults.get(n.multiaddr.toString());if(i==null){this.log("%a was verified while %p was queued",n.multiaddr,e.remotePeer);return}const s=AbortSignal.timeout(this.timeout);this.log.trace("asking %p to verify multiaddr %s",e.remotePeer,n.multiaddr);const o=await e.newStream(this.protocol,{signal:s});try{const a=li(o).pb(Rt),[,c]=await Promise.all([a.write({type:Rt.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toMultihash().bytes,addrs:[n.multiaddr.bytes]}}},{signal:s}),a.read({signal:s})]);if(c.type!==Rt.MessageType.DIAL_RESPONSE||c.dialResponse==null){this.log("invalid autonat response from %p - %j",e.remotePeer,c);return}const l=c.dialResponse.status;if(this.log.trace("autonat response from %p for %a is %s",e.remotePeer,n.multiaddr,l),l!==Rt.ResponseStatus.OK&&l!==Rt.ResponseStatus.E_DIAL_ERROR)return;if(i=this.dialResults.get(n.multiaddr.toString()),i==null){this.log.trace("peer reported %a as %s but there is no result object",n.multiaddr,c.dialResponse.status);return}if(i.networkSegments.includes(t)){this.log.trace("%a results included network segment %s",n.multiaddr,t);return}if(i.result!=null){this.log.trace("already resolved result for %a, ignoring response from",n.multiaddr,e.remotePeer);return}if(i.verifyingPeers.has(e.remotePeer)){this.log.trace("peer %p has already verified %a, ignoring response",e.remotePeer,n.multiaddr);return}if(i.verifyingPeers.add(e.remotePeer),i.networkSegments.push(t),l===Rt.ResponseStatus.OK){if(i.success++,i.type!=="observed"){this.confirmAddress(i);return}}else l===Rt.ResponseStatus.E_DIAL_ERROR&&i.failure++;this.log("%a success %d failure %d",i.multiaddr,i.success,i.failure),i.success===Fye&&this.confirmAddress(i),i.failure===zye&&this.unconfirmAddress(i)}finally{try{await o.close({signal:s})}catch(a){o.abort(a)}}}hasConnectionCapacity(){const t=this.components.connectionManager.getConnections().length,n=this.components.connectionManager.getMaxConnections();return t/n*100<this.connectionThreshold}confirmAddress(e){this.log("%s address %a is externally dialable",e.type,e.multiaddr),this.components.addressManager.confirmObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!0,e.queue.abort()}unconfirmAddress(e){this.log("%s address %a is not externally dialable",e.type,e.multiaddr),this.components.addressManager.removeObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!1,e.queue.abort()}getNetworkSegment(e){const t=e.toOptions();return t.family===4?t.host.split(".")[0].padStart(3,"0"):t.host.split(":")[0].padStart(4,"0")}}function Kye(r={}){return e=>new Vye(e,r)}const jye=fe("dns4"),Hye=fe("dns6"),qye=fe("dnsaddr"),Jl=Qt(fe("dns"),qye,jye,Hye),r3=Qt(fe("ip4"),fe("ip6")),th=Qt(Te(r3,fe("tcp")),Te(Jl,fe("tcp"))),n3=Te(r3,fe("udp")),Wye=Te(n3,fe("utp")),Gye=Te(n3,fe("quic")),Qye=Te(n3,fe("quic-v1")),L9=Qt(Te(th,fe("ws")),Te(Jl,fe("ws"))),i3=Qt(Te(L9,fe("p2p")),L9),B9=Qt(Te(th,fe("wss")),Te(Jl,fe("wss")),Te(th,fe("tls"),fe("ws")),Te(Jl,fe("tls"),fe("ws"))),s3=Qt(Te(B9,fe("p2p")),B9),U9=Qt(Te(th,fe("http")),Te(r3,fe("http")),Te(Jl,fe("http"))),F9=Qt(Te(th,fe("https")),Te(r3,fe("https")),Te(Jl,fe("https"))),_L=Te(n3,fe("webrtc-direct"),fe("certhash")),TL=Qt(Te(_L,fe("p2p")),_L),PL=Te(Qye,fe("webtransport"),fe("certhash"),fe("certhash")),DL=Qt(Te(PL,fe("p2p")),PL),$L=Qt(Te(i3,fe("p2p-webrtc-star"),fe("p2p")),Te(s3,fe("p2p-webrtc-star"),fe("p2p")),Te(i3,fe("p2p-webrtc-star")),Te(s3,fe("p2p-webrtc-star")));Qt(Te(i3,fe("p2p-websocket-star"),fe("p2p")),Te(s3,fe("p2p-websocket-star"),fe("p2p")),Te(i3,fe("p2p-websocket-star")),Te(s3,fe("p2p-websocket-star")));const NL=Qt(Te(U9,fe("p2p-webrtc-direct"),fe("p2p")),Te(F9,fe("p2p-webrtc-direct"),fe("p2p")),Te(U9,fe("p2p-webrtc-direct")),Te(F9,fe("p2p-webrtc-direct"))),Xl=Qt(L9,B9,U9,F9,$L,NL,th,Wye,Gye,Jl,TL,DL);Qt(Te(Xl,fe("p2p-stardust"),fe("p2p")),Te(Xl,fe("p2p-stardust")));const Tc=Qt(Te(Xl,fe("p2p")),$L,NL,TL,DL,fe("p2p")),ML=Qt(Te(Tc,fe("p2p-circuit"),Tc),Te(Tc,fe("p2p-circuit")),Te(fe("p2p-circuit"),Tc),Te(Xl,fe("p2p-circuit")),Te(fe("p2p-circuit"),Xl),fe("p2p-circuit")),OL=()=>Qt(Te(ML,OL),ML),Zl=OL(),Yye=Qt(Te(Zl,Tc,Zl),Te(Tc,Zl),Te(Zl,Tc),Zl,Tc);Qt(Te(Zl,fe("webrtc"),fe("p2p")),Te(Zl,fe("webrtc")),Te(Xl,fe("webrtc"),fe("p2p")),Te(Xl,fe("webrtc")),fe("webrtc"));function RL(r){function e(t){let n;try{n=Re(t)}catch{return!1}const i=r(n.protoNames());return i===null?!1:i===!0||i===!1?i:i.length===0}return e}function Te(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(i=>(n=typeof i=="function"?i().partialMatch(t):i.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:RL(e),partialMatch:e}}function Qt(...r){function e(n){let i=null;return r.some(s=>{const o=typeof s=="function"?s().partialMatch(n):s.partialMatch(n);return o!=null?(i=o,!0):!1}),i}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:RL(e),partialMatch:e}}function fe(r){const e=r;function t(i){let s;try{s=Re(i)}catch{return!1}const o=s.protoNames();return o.length===1&&o[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}const Jye="bootstrap",Xye=50,Zye=1e3;class LL extends(Gj=er,Wj=I2,qj=Symbol.toStringTag,Hj=dr,Gj){constructor(t,n={list:[]}){if(n.list==null||n.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super();u(this,"log");u(this,"timer");u(this,"list");u(this,"timeout");u(this,"components");u(this,"_init");u(this,Wj,this);u(this,qj,"@libp2p/bootstrap");u(this,Hj,["@libp2p/peer-discovery"]);this.components=t,this.log=t.logger.forComponent("libp2p:bootstrap"),this.timeout=n.timeout??Zye,this.list=[];for(const i of n.list){if(!Yye.matches(i)){this.log.error("Invalid multiaddr");continue}const s=Re(i),o=s.getPeerId();if(o==null){this.log.error("Invalid bootstrap multiaddr without peer id");continue}const a={id:tr(o),multiaddrs:[s]};this.list.push(a)}this._init=n}isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(t=>{this.log.error(t)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(const t of this.list){if(await this.components.peerStore.merge(t.id,{tags:{[this._init.tagName??Jye]:{value:this._init.tagValue??Xye,ttl:this._init.tagTTL}},multiaddrs:t.multiaddrs}),this.timer==null)return;this.safeDispatchEvent("peer",{detail:t}),this.components.connectionManager.openConnection(t.id).catch(n=>{this.log.error("could not dial bootstrap peer %p",t.id,n)})}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}}u(LL,"tag","bootstrap");function z9(r){return e=>new LL(e,r)}var o3;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(n.uint32(26),n.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={publicKey:Ge(0),payloadType:Ge(0),payload:Ge(0),signature:Ge(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.publicKey=t.bytes();break}case 2:{s.payloadType=t.bytes();break}case 3:{s.payload=t.bytes();break}case 5:{s.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(o3||(o3={}));class eme extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}}const qc=class qc{constructor(e){u(this,"publicKey");u(this,"payloadType");u(this,"payload");u(this,"signature");u(this,"marshaled");const{publicKey:t,payloadType:n,payload:i,signature:s}=e;this.publicKey=t,this.payloadType=n,this.payload=i,this.signature=s}marshal(){return this.marshaled==null&&(this.marshaled=o3.encode({publicKey:_i(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return qe(this.marshal(),e.marshal())}async validate(e){const t=BL(e,this.payloadType,this.payload);return this.publicKey.verify(t.subarray(),this.signature)}};u(qc,"createFromProtobuf",async e=>{const t=o3.decode(e),n=_n(t.publicKey);return new qc({publicKey:n,payloadType:t.payloadType,payload:t.payload,signature:t.signature})}),u(qc,"seal",async(e,t)=>{if(t==null)throw new Error("Missing private key");const n=e.domain,i=e.codec,s=e.marshal(),o=BL(n,i,s),a=await t.sign(o.subarray());return new qc({publicKey:t.publicKey,payloadType:i,payload:s,signature:a})}),u(qc,"openAndCertify",async(e,t)=>{const n=await qc.createFromProtobuf(e);if(!await n.validate(t))throw new eme("Envelope signature is not valid for the given domain");return n});let Pc=qc;const BL=(r,e,t)=>{const n=se(r),i=Sr(n.byteLength),s=Sr(e.length),o=Sr(t.length);return new Be(i,n,s,e,o,t)};function tme(r,e){const t=(n,i)=>n.toString().localeCompare(i.toString());return r.length!==e.length?!1:(e.sort(t),r.sort(t).every((n,i)=>e[i].equals(n)))}function rme(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var nme=FL,UL=128,ime=-128,sme=Math.pow(2,31);function FL(r,e,t){e=e||[],t=t||0;for(var n=t;r>=sme;)e[t++]=r&255|UL,r/=128;for(;r&ime;)e[t++]=r&255|UL,r>>>=7;return e[t]=r|0,FL.bytes=t-n+1,e}var ome=V9,ame=128,zL=127;function V9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw V9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&zL)<<i:(o&zL)*Math.pow(2,i),i+=7}while(o>=ame);return V9.bytes=s-n,t}var cme=Math.pow(2,7),lme=Math.pow(2,14),ume=Math.pow(2,21),dme=Math.pow(2,28),hme=Math.pow(2,35),fme=Math.pow(2,42),pme=Math.pow(2,49),gme=Math.pow(2,56),yme=Math.pow(2,63),mme=function(r){return r<cme?1:r<lme?2:r<ume?3:r<dme?4:r<hme?5:r<fme?6:r<pme?7:r<gme?8:r<yme?9:10},wme={encode:nme,decode:ome,encodingLength:mme},VL=wme;function KL(r,e=0){return[VL.decode(r,e),VL.decode.bytes]}function bme(r){const e=rme(r),[t,n]=KL(e),[i,s]=KL(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new vme(t,i,o,e)}let vme=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};const Eme="libp2p-peer-record",Sme=Uint8Array.from([3,1]);var a3;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.multiaddr!=null&&i.multiaddr.byteLength>0&&(s.uint32(10),s.bytes(i.multiaddr)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={multiaddr:Ge(0)},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.multiaddr=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)})(r.AddressInfo||(r.AddressInfo={}));let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.peerId!=null&&t.peerId.byteLength>0&&(n.uint32(10),n.bytes(t.peerId)),t.seq!=null&&t.seq!==0n&&(n.uint32(16),n.uint64(t.seq)),t.addresses!=null)for(const s of t.addresses)n.uint32(26),r.AddressInfo.codec().encode(s,n);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={peerId:Ge(0),seq:0n,addresses:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.peerId=t.bytes();break}case 2:{s.seq=t.uint64();break}case 3:{if(((a=i.limits)==null?void 0:a.addresses)!=null&&s.addresses.length===i.limits.addresses)throw new mt('Decode error - map field "addresses" had too many elements');s.addresses.push(r.AddressInfo.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.addresses$}));break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(a3||(a3={}));const ha=class ha{constructor(e){u(this,"peerId");u(this,"multiaddrs");u(this,"seqNumber");u(this,"domain",ha.DOMAIN);u(this,"codec",ha.CODEC);u(this,"marshaled");const{peerId:t,multiaddrs:n,seqNumber:i}=e;this.peerId=t,this.multiaddrs=n??[],this.seqNumber=i??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=a3.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof ha)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!tme(this.multiaddrs,e.multiaddrs))}};u(ha,"createFromProtobuf",e=>{const t=a3.decode(e),n=ti(bme(t.peerId)),i=(t.addresses??[]).map(o=>Re(o.multiaddr)),s=t.seq;return new ha({peerId:n,multiaddrs:i,seqNumber:s})}),u(ha,"DOMAIN",Eme),u(ha,"CODEC",Sme);let js=ha;function jL(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var xme=qL,HL=128,Ame=-128,Cme=Math.pow(2,31);function qL(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Cme;)e[t++]=r&255|HL,r/=128;for(;r&Ame;)e[t++]=r&255|HL,r>>>=7;return e[t]=r|0,qL.bytes=t-n+1,e}var Ime=K9,kme=128,WL=127;function K9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw K9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&WL)<<i:(o&WL)*Math.pow(2,i),i+=7}while(o>=kme);return K9.bytes=s-n,t}var _me=Math.pow(2,7),Tme=Math.pow(2,14),Pme=Math.pow(2,21),Dme=Math.pow(2,28),$me=Math.pow(2,35),Nme=Math.pow(2,42),Mme=Math.pow(2,49),Ome=Math.pow(2,56),Rme=Math.pow(2,63),Lme=function(r){return r<_me?1:r<Tme?2:r<Pme?3:r<Dme?4:r<$me?5:r<Nme?6:r<Mme?7:r<Ome?8:r<Rme?9:10},Bme={encode:xme,decode:Ime,encodingLength:Lme},GL=Bme;function QL(r,e=0){return[GL.decode(r,e),GL.decode.bytes]}function Ume(r){const e=jL(r),[t,n]=QL(e),[i,s]=QL(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Fme(t,i,o,e)}let Fme=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};const zme=290,Vme=1,YL=2e3,Kme=100,c3=`${k2}-circuit-relay`;BigInt(1<<17);const l3="/libp2p/circuit/relay/0.2.0/hop",JL="/libp2p/circuit/relay/0.2.0/stop",XL=300,jme=4096,Hme=.001;var rh;(function(r){(function(n){n.RESERVE="RESERVE",n.CONNECT="CONNECT",n.STATUS="STATUS"})(r.Type||(r.Type={}));let e;(function(n){n[n.RESERVE=0]="RESERVE",n[n.CONNECT=1]="CONNECT",n[n.STATUS=2]="STATUS"})(e||(e={})),function(n){n.codec=()=>kn(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=$e((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.peer!=null&&(i.uint32(18),nh.codec().encode(n.peer,i)),n.reservation!=null&&(i.uint32(26),u3.codec().encode(n.reservation,i)),n.limit!=null&&(i.uint32(34),ih.codec().encode(n.limit,i)),n.status!=null&&(i.uint32(40),pn.codec().encode(n.status,i)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{var c,l,d;const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const h=n.uint32();switch(h>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.peer=nh.codec().decode(n,n.uint32(),{limits:(c=s.limits)==null?void 0:c.peer});break}case 3:{o.reservation=u3.codec().decode(n,n.uint32(),{limits:(l=s.limits)==null?void 0:l.reservation});break}case 4:{o.limit=ih.codec().decode(n,n.uint32(),{limits:(d=s.limits)==null?void 0:d.limit});break}case 5:{o.status=pn.codec().decode(n);break}default:{n.skipType(h&7);break}}}return o})),t),r.encode=n=>De(n,r.codec()),r.decode=(n,i)=>Pe(n,r.codec(),i)})(rh||(rh={}));var jo;(function(r){(function(n){n.CONNECT="CONNECT",n.STATUS="STATUS"})(r.Type||(r.Type={}));let e;(function(n){n[n.CONNECT=0]="CONNECT",n[n.STATUS=1]="STATUS"})(e||(e={})),function(n){n.codec=()=>kn(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=$e((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.peer!=null&&(i.uint32(18),nh.codec().encode(n.peer,i)),n.limit!=null&&(i.uint32(26),ih.codec().encode(n.limit,i)),n.status!=null&&(i.uint32(32),pn.codec().encode(n.status,i)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{var c,l;const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const d=n.uint32();switch(d>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.peer=nh.codec().decode(n,n.uint32(),{limits:(c=s.limits)==null?void 0:c.peer});break}case 3:{o.limit=ih.codec().decode(n,n.uint32(),{limits:(l=s.limits)==null?void 0:l.limit});break}case 4:{o.status=pn.codec().decode(n);break}default:{n.skipType(d&7);break}}}return o})),t),r.encode=n=>De(n,r.codec()),r.decode=(n,i)=>Pe(n,r.codec(),i)})(jo||(jo={}));var nh;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.addrs!=null)for(const s of t.addrs)n.uint32(18),n.bytes(s);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={id:Ge(0),addrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.id=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.addrs)!=null&&s.addrs.length===i.limits.addrs)throw new mt('Decode error - map field "addrs" had too many elements');s.addrs.push(t.bytes());break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(nh||(nh={}));var u3;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.expire!=null&&t.expire!==0n&&(n.uint32(8),n.uint64(t.expire)),t.addrs!=null)for(const s of t.addrs)n.uint32(18),n.bytes(s);t.voucher!=null&&(n.uint32(26),h3.codec().encode(t.voucher,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={expire:0n,addrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.expire=t.uint64();break}case 2:{if(((a=i.limits)==null?void 0:a.addrs)!=null&&s.addrs.length===i.limits.addrs)throw new mt('Decode error - map field "addrs" had too many elements');s.addrs.push(t.bytes());break}case 3:{s.voucher=h3.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.voucher});break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(u3||(u3={}));var ih;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.duration!=null&&(n.uint32(8),n.uint32(t.duration)),t.data!=null&&(n.uint32(16),n.uint64(t.data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.duration=t.uint32();break}case 2:{s.data=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(ih||(ih={}));var pn;(function(r){r.UNUSED="UNUSED",r.OK="OK",r.RESERVATION_REFUSED="RESERVATION_REFUSED",r.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONNECTION_FAILED="CONNECTION_FAILED",r.NO_RESERVATION="NO_RESERVATION",r.MALFORMED_MESSAGE="MALFORMED_MESSAGE",r.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"})(pn||(pn={}));var j9;(function(r){r[r.UNUSED=0]="UNUSED",r[r.OK=100]="OK",r[r.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",r[r.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",r[r.PERMISSION_DENIED=202]="PERMISSION_DENIED",r[r.CONNECTION_FAILED=203]="CONNECTION_FAILED",r[r.NO_RESERVATION=204]="NO_RESERVATION",r[r.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",r[r.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"})(j9||(j9={})),function(r){r.codec=()=>kn(j9)}(pn||(pn={}));var d3;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.relay!=null&&t.relay.byteLength>0&&(n.uint32(10),n.bytes(t.relay)),t.peer!=null&&t.peer.byteLength>0&&(n.uint32(18),n.bytes(t.peer)),t.expiration!=null&&t.expiration!==0n&&(n.uint32(24),n.uint64(t.expiration)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={relay:Ge(0),peer:Ge(0),expiration:0n},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.relay=t.bytes();break}case 2:{s.peer=t.bytes();break}case 3:{s.expiration=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(d3||(d3={}));var h3;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&(n.uint32(26),d3.codec().encode(t.payload,n)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={publicKey:Ge(0),payloadType:Ge(0),signature:Ge(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.publicKey=t.bytes();break}case 2:{s.payloadType=t.bytes();break}case 3:{s.payload=d3.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.payload});break}case 5:{s.signature=t.bytes();break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(h3||(h3={}));function qme(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var Wme=qme,Gme=Wme;let Qme=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Yme=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ZL(this,e)}},Jme=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return ZL(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function ZL(r,e){return new Jme({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Xme=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Qme(e,t,n),this.decoder=new Yme(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function eB({name:r,prefix:e,encode:t,decode:n}){return new Xme(r,e,t,n)}function f3({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Gme(t,r);return eB({prefix:e,name:r,encode:n,decode:s=>jL(i(s))})}function Zme(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function e3e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Ho({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return eB({prefix:e,name:r,encode(i){return e3e(i,n,t)},decode(i){return Zme(i,n,t,r)}})}Ho({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ho({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ho({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ho({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ho({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ho({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ho({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ho({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Ho({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),f3({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),f3({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),f3({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),f3({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});class H9 extends Error{constructor(){super(...arguments);u(this,"name","HadEnoughRelaysError")}}u(H9,"name","HadEnoughRelaysError");class tB extends Error{constructor(){super(...arguments);u(this,"name","DoubleRelayError")}}u(tB,"name","DoubleRelayError");class rB extends Error{constructor(){super(...arguments);u(this,"name","RelayQueueFullError")}}u(rB,"name","RelayQueueFullError");function nB(r){const e=r*BigInt(1e3),t=new Date().getTime();return Number(e-BigInt(t))}class iB{constructor(e){u(this,"expires");u(this,"bytes");(e==null?void 0:e.duration)!=null&&(e==null?void 0:e.duration)!==0&&(this.expires=Date.now()+e.duration*1e3),this.bytes=e==null?void 0:e.data,this.bytes===0n&&(this.bytes=void 0),this.onData=this.onData.bind(this)}onData(e){this.bytes!=null&&(this.bytes-=BigInt(e.byteLength),this.bytes<0n&&(this.bytes=0n))}getLimits(){if(this.expires==null&&this.bytes==null)return;const e={};if(this.bytes!=null){const t=this;Object.defineProperty(e,"bytes",{get(){return t.bytes}})}if(this.expires!=null){const t=this;Object.defineProperty(e,"seconds",{get(){return Math.round(((t.expires??0)-Date.now())/1e3)}})}return e}}const sB=At(et(tO.matchers[0],Qe("p2p-circuit"))),oB=At(Qe("p2p-circuit"));function aB(r){const{stream:e,remoteAddr:t,logger:n,onDataRead:i,onDataWrite:s}=r,o=n.forComponent("libp2p:stream:converter");let a=!1,c=!1;const l=e.close.bind(e);e.close=async f=>{await l(f),m(!0)};const d=e.abort.bind(e);e.abort=f=>{d(f),m(!0)};const h=e.sink.bind(e);e.sink=async f=>{try{await h(un(f,g=>im(g,v=>s==null?void 0:s(v))))}catch(g){g.type!=="aborted"&&o.error("%s error in sink",t,g)}finally{c=!0,m()}};const p={log:o,sink:e.sink,source:async function*(){try{for await(const f of e.source)i==null||i(f),yield f}finally{a=!0,m()}}(),remoteAddr:t,timeline:{open:Date.now(),close:void 0},close:e.close,abort:e.abort};function m(f){f===!0&&(a=!0,c=!0),a&&c&&p.timeline.close==null&&(p.timeline.close=Date.now())}return p}class t3e extends er{constructor(t,n={}){super();u(this,"peerStore");u(this,"registrar");u(this,"connectionManager");u(this,"randomWalk");u(this,"started");u(this,"running");u(this,"topologyId");u(this,"log");u(this,"discoveryController");u(this,"filter");u(this,"queue");this.log=t.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.started=!1,this.running=!1,this.peerStore=t.peerStore,this.registrar=t.registrar,this.connectionManager=t.connectionManager,this.randomWalk=t.randomWalk,this.filter=n.filter,this.discoveryController=new AbortController,this.discoveryController.signal}isStarted(){return this.started}async start(){this.topologyId=await this.registrar.register(l3,{filter:this.filter,onConnect:t=>{var n,i;this.log.trace("discovered relay %p queue (length: %d, active %d)",t,(n=this.queue)==null?void 0:n.size,(i=this.queue)==null?void 0:i.running),this.safeDispatchEvent("relay:discover",{detail:t})}}),this.started=!0}stop(){var t;this.topologyId!=null&&this.registrar.unregister(this.topologyId),(t=this.discoveryController)==null||t.abort(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,this.discoveryController.signal,Promise.resolve().then(async()=>{var i;this.log("searching peer store for relays");const t=await this.peerStore.all({filters:[s=>s.protocols.includes(l3)],orders:[()=>Math.random()<.5?1:-1,(s,o)=>{const a=cB(s),c=cB(o);return a>c?-1:c>a?1:0}]});for(const s of t)this.log.trace("found relay peer %p in peer store",s.id),this.safeDispatchEvent("relay:discover",{detail:s.id});this.log("found %d relay peers in peer store",t.length);const n=this.queue=new lc({concurrency:5});this.log("start random walk");for await(const s of this.randomWalk.walk({signal:this.discoveryController.signal})){if(this.log.trace("found random peer %p",s.id),n.has(s.id)){this.log.trace("random peer %p was already in queue",s.id);continue}if(((i=this.connectionManager.getConnections(s.id))==null?void 0:i.length)>0){this.log.trace("random peer %p was already connected",s.id);continue}if(!await this.connectionManager.isDialable(s.multiaddrs)){this.log.trace("random peer %p was not dialable",s.id,s.multiaddrs.map(o=>o.toString()));continue}n.queued>10&&(this.log.trace("wait for space in queue for %p",s.id),await n.onSizeLessThan(10,{signal:this.discoveryController.signal})),this.log("adding random peer %p to dial queue (length: %d, active %d)",s.id,n.size,n.running),n.add(async()=>{const o=pt([this.discoveryController.signal,AbortSignal.timeout(5e3)]);try{await this.connectionManager.openConnection(s.id,{signal:o})}finally{o.clear()}},{peerId:s.id,signal:this.discoveryController.signal}).catch(o=>{this.log.error("error opening connection to random peer %p",s.id,o)})}this.log("stop random walk"),await n.onIdle()}).catch(t=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network",t)}))}stopDiscovery(){var t;this.log("stop discovery"),this.running=!1,(t=this.discoveryController)==null||t.abort()}}function cB(r){const e=r.metadata.get("last-dial-success");return e==null?0:new Date(re(e)).getTime()}class r3e extends er{constructor(t,n={}){super();u(this,"connectionManager");u(this,"addressManager");u(this,"reservationStore");u(this,"listeningAddrs");u(this,"log");u(this,"listenTimeout");u(this,"reservationId");u(this,"relay");u(this,"_onRemoveRelayPeer",t=>{var n,i;this.log("relay removed %p our relay %p",t.detail.relay,this.relay,(n=this.relay)==null?void 0:n.equals(t.detail.relay)),((i=this.relay)==null?void 0:i.equals(t.detail.relay))===!0&&(this.log("relay peer removed %p",t.detail.relay),this.listeningAddrs.forEach(s=>{this.addressManager.removeObservedAddr(s)}),this.listeningAddrs=[],this.safeDispatchEvent("listening"))});u(this,"_onAddRelayPeer",t=>{const{details:n}=t.detail;n.type!=="configured"&&n.id===this.reservationId&&this.addedRelay(t.detail)});this.log=t.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=t.connectionManager,this.addressManager=t.addressManager,this.reservationStore=t.reservationStore,this.listeningAddrs=[],this.listenTimeout=n.listenTimeout??YL,this.reservationStore.addEventListener("relay:removed",this._onRemoveRelayPeer),this.reservationStore.addEventListener("relay:created-reservation",this._onAddRelayPeer)}async listen(t){if(oB.exactMatch(t))this.log("searching for circuit relay servers"),this.reservationId=this.reservationStore.reserveRelay();else if(sB.exactMatch(t)){this.log("listen on specific relay server %a",t);const n=AbortSignal.timeout(this.listenTimeout),i=t.decapsulate("/p2p-circuit"),s=await this.connectionManager.openConnection(i,{signal:n});if(!this.reservationStore.hasReservation(s.remotePeer)){this.log("making reservation on peer %p",s.remotePeer);const o=await this.reservationStore.addRelay(s.remotePeer,"configured");this.addedRelay(o)}}else throw new N2(`Could not listen on p2p-circuit address "${t}"`)}getAddrs(){return[...this.listeningAddrs.values()].flat()}updateAnnounceAddrs(){}async close(){this.reservationStore.cancelReservations(),this.listeningAddrs=[],this.reservationStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),queueMicrotask(()=>{this.safeDispatchEvent("close")})}addedRelay(t){this.log("relay peer added %p",t.relay),this.relay=t.relay,this.listeningAddrs=t.details.reservation.addrs.map(n=>Re(n).encapsulate("/p2p-circuit")),this.listeningAddrs.forEach(n=>{this.addressManager.confirmObservedAddr(n,{type:"transport"})}),queueMicrotask(()=>{this.safeDispatchEvent("listening")})}}function n3e(r){return new r3e(r)}const i3e="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let s3e=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=i3e[t[r]&63];return e};const o3e=60*1e3*10,a3e=60*1e3*5,c3e=30*1e3;class l3e extends er{constructor(t,n){super();Je(this,zn);u(this,"peerId");u(this,"connectionManager");u(this,"peerStore");u(this,"events");u(this,"reserveQueue");u(this,"reservations");u(this,"pendingReservations");u(this,"maxReservationQueueLength");u(this,"reservationCompletionTimeout");u(this,"started");u(this,"log");u(this,"relayFilter");this.log=t.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=t.peerId,this.connectionManager=t.connectionManager,this.peerStore=t.peerStore,this.events=t.events,this.reservations=new uc,this.pendingReservations=[],this.maxReservationQueueLength=(n==null?void 0:n.maxReservationQueueLength)??Kme,this.reservationCompletionTimeout=(n==null?void 0:n.reservationCompletionTimeout)??YL,this.started=!1,this.relayFilter=zl(100),this.reserveQueue=new lc({concurrency:(n==null?void 0:n.reservationConcurrency)??Vme,metricName:"libp2p_relay_reservation_queue",metrics:t.metrics}),this.events.addEventListener("connection:close",i=>{[...this.reservations.values()].find(o=>o.connection===i.detail.id)!=null&&Ie(this,zn,g0).call(this,i.detail.remotePeer).catch(o=>{this.log("could not remove relay %p - %e",i.detail,o)})})}isStarted(){return this.started}start(){this.started=!0}afterStart(){Promise.resolve().then(async()=>{const t=await this.peerStore.all({filters:[n=>n.tags.has(c3)]});this.log("removing tag from %d old relays",t.length),await Promise.all(t.map(async n=>{await this.peerStore.merge(n.id,{tags:{[c3]:void 0}})})),this.log("redialing %d old relays",t.length),await Promise.all(t.map(async n=>this.addRelay(n.id,"discovered"))),Ie(this,zn,y0).call(this)}).catch(t=>{this.log.error(t)})}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:t})=>{clearTimeout(t)}),this.reservations.clear(),this.started=!1}reserveRelay(){const t=s3e();return this.pendingReservations.push(t),Ie(this,zn,y0).call(this),t}async addRelay(t,n){if(this.peerId.equals(t))throw this.log.trace("not trying to use self as relay"),new N2("Cannot use self as relay");if(this.reserveQueue.size>this.maxReservationQueueLength)throw new rB("The reservation queue is full");const i=this.reserveQueue.find(t);if(i!=null)return this.log.trace("potential relay peer %p is already in the reservation queue",t),i.join();if(this.relayFilter.has(t.toMultihash().bytes))throw new N2("The relay was previously invalid");return this.log.trace("try to reserve relay slot with %p",t),this.reserveQueue.add(async()=>{const s=Date.now();try{const o=this.reservations.get(t);if(o!=null){const g=this.connectionManager.getConnections(t);let v=!1;if(g.length===0&&this.log("already have relay reservation with %p but we are no longer connected",t),g.map(y=>y.id).includes(o.connection)&&(this.log("already have relay reservation with %p and the original connection is still open",t),v=!0),v&&nB(o.reservation.expire)>o3e)return this.log("already have relay reservation with %p but we are still connected and it does not expire soon",t),{relay:t,details:o};await Ie(this,zn,g0).call(this,t)}if(n==="discovered"&&this.pendingReservations.length===0)throw new H9("Not making reservation on discovered relay because we do not need any more relays");const a=AbortSignal.timeout(this.reservationCompletionTimeout);const c=await this.connectionManager.openConnection(t,{signal:a});if(vc.matches(c.remoteAddr))throw new tB("not creating reservation over relayed connection");const l=await Ie(this,zn,ZH).call(this,c,{signal:a}),d=nB(l.expire);this.log("created reservation on relay peer %p, expiry date is %s",t,new Date(Date.now()+d).toString());const h=Math.min(Math.max(d-a3e,c3e),Math.pow(2,31)-1),p=setTimeout(()=>{this.log("refresh reservation to relay %p",t),this.addRelay(t,n).catch(async g=>{this.log.error("could not refresh reservation to relay %p - %e",t,g),await Ie(this,zn,g0).call(this,t)}).catch(g=>{this.log.error("could not remove expired reservation to relay %p - %e",t,g)})},h);let m;if(n==="discovered"){const g=this.pendingReservations.pop();if(g==null)throw new H9("Made reservation on relay but did not need any more discovered relays");m={timeout:p,reservation:l,type:n,connection:c.id,id:g}}else m={timeout:p,reservation:l,type:n,connection:c.id};this.reservations.set(t,m),await this.peerStore.merge(t,{tags:{[c3]:{value:1,ttl:d}}}),Ie(this,zn,y0).call(this);const f={relay:t,details:m};return this.safeDispatchEvent("relay:created-reservation",{detail:f}),f}catch(o){throw n==="discovered"&&o.name==="HadEnoughRelaysError"||this.log.error("could not reserve slot on %p after %dms - %e",t,Date.now()-s,o),(o.name==="DialError"||o.name==="UnsupportedProtocolError")&&this.relayFilter.add(t.toMultihash().bytes),Ie(this,zn,g0).call(this,t).catch(a=>{this.log.error("could not remove reservation on %p after reserving slot failed - %e",t,a)}),o}},{peerId:t})}hasReservation(t){return this.reservations.has(t)}getReservation(t){var n;return(n=this.reservations.get(t))==null?void 0:n.reservation}reservationCount(t){return t==null?this.reservations.size:[...this.reservations.values()].reduce((n,i)=>(i.type===t&&n++,n),0)}cancelReservations(){[...this.reservations.values()].forEach(t=>{clearTimeout(t.timeout)}),this.reservations.clear()}}zn=new WeakSet,ZH=async function(t,n){var l;(l=n.signal)==null||l.throwIfAborted(),this.log("requesting reservation from %p",t.remotePeer);const i=await t.newStream(l3,n),o=li(i).pb(rh);this.log.trace("send RESERVE to %p",t.remotePeer),await o.write({type:rh.Type.RESERVE},n);let a;try{this.log.trace("reading response from %p",t.remotePeer),a=await o.read(n)}catch(d){throw i.abort(d),d}finally{i.status!=="closed"&&await i.close(n)}if(this.log.trace("read response %o",a),a.status===pn.OK&&a.reservation!=null){const d=new Set;d.add(t.remoteAddr.toString());for(const h of a.reservation.addrs){let p=Re(h);p.getPeerId()==null&&(p=p.encapsulate(`/p2p/${t.remotePeer}`)),p=Re(p.toString().replace(`/p2p/${t.remotePeer}/p2p/${t.remotePeer}`,`/p2p/${t.remotePeer}`)),d.add(p.toString())}return a.reservation.addrs=[...d].map(h=>Re(h).bytes),a.reservation}const c=`reservation failed with status ${a.status??"undefined"}`;throw this.log.error(c),new Error(c)},g0=async function(t){const n=this.reservations.get(t);n!=null&&(this.log("removing relay reservation with %p from local store",t),clearTimeout(n.timeout),this.reservations.delete(t),n.type==="discovered"&&this.pendingReservations.push(n.id),await this.peerStore.merge(t,{tags:{[c3]:void 0}}),this.safeDispatchEvent("relay:removed",{detail:{relay:t,details:n}}),Ie(this,zn,y0).call(this))},y0=function(){if(this.pendingReservations.length===0){this.log.trace("have discovered enough relays"),this.reserveQueue.clear(),this.safeDispatchEvent("relay:found-enough-relays");return}this.relayFilter=zl(100),this.log("not discovered enough relays %d/%d",this.reservations.size,this.pendingReservations.length),this.safeDispatchEvent("relay:not-enough-relays")};const u3e=r=>{if(r.peer==null)return!1;try{r.peer.addrs.forEach(Re)}catch{return!1}return!0},lB={maxInboundStopStreams:XL,maxOutboundStopStreams:XL};class d3e{constructor(e,t={}){u(this,"discovery");u(this,"registrar");u(this,"peerStore");u(this,"connectionManager");u(this,"transportManager");u(this,"peerId");u(this,"upgrader");u(this,"addressManager");u(this,"connectionGater");u(this,"reservationStore");u(this,"logger");u(this,"maxInboundStopStreams");u(this,"maxOutboundStopStreams");u(this,"started");u(this,"log");u(this,"shutdownController");u(this,Xj,"@libp2p/circuit-relay-v2-transport");u(this,Jj,["@libp2p/transport","@libp2p/circuit-relay-v2-transport"]);u(this,Qj,!0);this.log=e.logger.forComponent("libp2p:circuit-relay:transport"),this.registrar=e.registrar,this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.logger=e.logger,this.peerId=e.peerId,this.upgrader=e.upgrader,this.addressManager=e.addressManager,this.connectionGater=e.connectionGater,this.maxInboundStopStreams=t.maxInboundStopStreams??lB.maxInboundStopStreams,this.maxOutboundStopStreams=t.maxOutboundStopStreams??lB.maxOutboundStopStreams,this.shutdownController=new AbortController,this.discovery=new t3e(e,{filter:t.discoveryFilter??Voe(jme,Hme)}),this.discovery.addEventListener("relay:discover",n=>{this.reservationStore.addRelay(n.detail,"discovered").catch(i=>{i.name!=="HadEnoughRelaysError"&&i.name!=="RelayQueueFullError"&&this.log.error("could not add discovered relay %p",n.detail,i)})}),this.reservationStore=new l3e(e,t),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{var n;(n=this.discovery)==null||n.startDiscovery()}),this.reservationStore.addEventListener("relay:found-enough-relays",()=>{var n;(n=this.discovery)==null||n.stopDiscovery()}),this.started=!1}get[(Xj=Symbol.toStringTag,Jj=dr,Yj=Qa,Qj=T2,Yj)](){return this.discovery!=null?["@libp2p/identify"]:[]}isStarted(){return this.started}async start(){this.shutdownController=new AbortController,await this.registrar.handle(JL,e=>{const t=this.upgrader.createInboundAbortSignal(this.shutdownController.signal);this.onStop(e,t).catch(n=>{this.log.error("error while handling STOP protocol",n),e.stream.abort(n)}).finally(()=>{t.clear()})},{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0}),await ko(this.discovery,this.reservationStore),this.started=!0}async stop(){this.shutdownController.abort(),await Ga(this.discovery,this.reservationStore),await this.registrar.unhandle(JL),this.started=!1}async dial(e,t){var m,f,g,v,y,w;if(e.protoCodes().filter(b=>b===zme).length!==1){const b="Invalid circuit relay address";throw this.log.error(b,e),new xd(b)}const n=e.toString().split("/p2p-circuit"),i=Re(n[0]),s=Re(n[n.length-1]),o=i.getPeerId(),a=s.getPeerId();if(o==null||a==null){const b=`ircuit relay dial to ${e.toString()} failed as address did not have both relay and destination PeerIDs`;throw this.log.error(`c${b}`),new xd(`C${b}`)}const c=tr(o),l=tr(a);let h=this.connectionManager.getConnections(c)[0];h==null?(await this.peerStore.merge(c,{multiaddrs:[i]}),(m=t.onProgress)==null||m.call(t,new _e("circuit-relay:open-connection")),h=await this.connectionManager.openConnection(c,t)):(f=t.onProgress)==null||f.call(t,new _e("circuit-relay:reuse-connection"));let p;try{(g=t.onProgress)==null||g.call(t,new _e("circuit-relay:open-hop-stream")),p=await h.newStream(l3,t);const b=li(p),E=b.pb(rh);(v=t.onProgress)==null||v.call(t,new _e("circuit-relay:write-connect-message")),await E.write({type:rh.Type.CONNECT,peer:{id:l.toMultihash().bytes,addrs:[Re(s).bytes]}},t),(y=t.onProgress)==null||y.call(t,new _e("circuit-relay:read-connect-response"));const A=await E.read(t);if(A.status!==pn.OK)throw new Et(`failed to connect via relay with status ${((w=A==null?void 0:A.status)==null?void 0:w.toString())??"undefined"}`);const k=new iB(A.limit),x=aB({stream:b.unwrap(),remoteAddr:e,localAddr:i.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`),logger:this.logger,onDataRead:k.onData,onDataWrite:k.onData});return this.log("new outbound relayed connection %a",x.remoteAddr),await this.upgrader.upgradeOutbound(x,{...t,limits:k.getLimits()})}catch(b){throw this.log.error("circuit relay dial to destination %p via relay %p failed",l,c,b),p==null||p.abort(b),b}}createListener(e){return n3e({peerId:this.peerId,connectionManager:this.connectionManager,addressManager:this.addressManager,reservationStore:this.reservationStore,logger:this.logger})}listenFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>sB.exactMatch(t)||oB.exactMatch(t))}dialFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>vc.exactMatch(t))}async onStop({connection:e,stream:t},n){var d,h;if(!this.reservationStore.hasReservation(e.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.transportManager.listen([e.remoteAddr.encapsulate("/p2p-circuit")])}catch(p){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on",p)}const i=li(t).pb(jo),s=await i.read({signal:n});if(this.log("new circuit relay v2 stop stream from %p with type %s",e.remotePeer,s.type),(s==null?void 0:s.type)===void 0){this.log.error("type was missing from circuit v2 stop protocol request from %s",e.remotePeer),await i.write({type:jo.Type.STATUS,status:pn.MALFORMED_MESSAGE},{signal:n}),await t.close();return}if(s.type!==jo.Type.CONNECT){this.log.error("invalid stop connect request via peer %p",e.remotePeer),await i.write({type:jo.Type.STATUS,status:pn.UNEXPECTED_MESSAGE},{signal:n}),await t.close();return}if(!u3e(s)){this.log.error("invalid stop connect request via peer %p",e.remotePeer),await i.write({type:jo.Type.STATUS,status:pn.MALFORMED_MESSAGE},{signal:n}),await t.close({signal:n});return}const o=ti(Ume(s.peer.id));if(await((h=(d=this.connectionGater).denyInboundRelayedConnection)==null?void 0:h.call(d,e.remotePeer,o))===!0){this.log.error("connection gater denied inbound relayed connection from %p",e.remotePeer),await i.write({type:jo.Type.STATUS,status:pn.PERMISSION_DENIED},{signal:n}),await t.close({signal:n});return}this.log.trace("sending success response to %p",e.remotePeer),await i.write({type:jo.Type.STATUS,status:pn.OK},{signal:n});const a=new iB(s.limit),c=e.remoteAddr.encapsulate(`/p2p-circuit/p2p/${o.toString()}`);this.addressManager.getAddresses()[0];const l=aB({stream:i.unwrap().unwrap(),remoteAddr:c,logger:this.logger,onDataRead:a.onData,onDataWrite:a.onData});this.log("new inbound relayed connection %a",l.remoteAddr),await this.upgrader.upgradeInbound(l,{limits:a.getLimits(),signal:n}),this.log("%s connection %a upgraded","inbound",l.remoteAddr)}}function q9(r={}){return e=>new d3e(e,r)}const uB=()=>{const r=new Error("Delay aborted");return r.name="AbortError",r},h3e=new WeakMap;function f3e({clearTimeout:r,setTimeout:e}={}){return(t,{value:n,signal:i}={})=>{if(i!=null&&i.aborted)return Promise.reject(uB());let s,o,a;const c=r??clearTimeout,l=()=>{c(s),a(uB())},d=()=>{i&&i.removeEventListener("abort",l)},h=new Promise((p,m)=>{o=()=>{d(),p(n)},a=m,s=(e??setTimeout)(o,t)});return i&&i.addEventListener("abort",l,{once:!0}),h3e.set(h,()=>{c(s),s=null,o()}),h}}const dB=f3e();var Hs;(function(r){(function(n){n.UNUSED="UNUSED",n.CONNECT="CONNECT",n.SYNC="SYNC"})(r.Type||(r.Type={}));let e;(function(n){n[n.UNUSED=0]="UNUSED",n[n.CONNECT=100]="CONNECT",n[n.SYNC=300]="SYNC"})(e||(e={})),function(n){n.codec=()=>kn(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=$e((n,i,s={})=>{if(s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.observedAddresses!=null)for(const o of n.observedAddresses)i.uint32(18),i.bytes(o);s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{var c;const o={observedAddresses:[]},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const l=n.uint32();switch(l>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{if(((c=s.limits)==null?void 0:c.observedAddresses)!=null&&o.observedAddresses.length===s.limits.observedAddresses)throw new mt('Decode error - map field "observedAddresses" had too many elements');o.observedAddresses.push(n.bytes());break}default:{n.skipType(l&7);break}}}return o})),t),r.encode=n=>De(n,r.codec()),r.decode=(n,i)=>Pe(n,r.codec(),i)})(Hs||(Hs={}));function hB(r,e){return vc.matches(r)||e.dialTransportForMultiaddr(r)==null?!1:HM.matches(r)?!0:hhe.matches(r)?bc(r.toOptions().host)===!1:!1}const fB=1024*4,pB=100,p3={timeout:5e3,retries:3,maxInboundStreams:1,maxOutboundStreams:1};eH=Symbol.toStringTag,Zj=Qa;class p3e{constructor(e,t){u(this,"started");u(this,"timeout");u(this,"retries");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"peerStore");u(this,"registrar");u(this,"connectionManager");u(this,"addressManager");u(this,"transportManager");u(this,"topologyId");u(this,"log");u(this,eH,"@libp2p/dcutr");u(this,Zj,["@libp2p/identify"]);this.log=e.logger.forComponent("libp2p:dcutr"),this.started=!1,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.timeout=t.timeout??p3.timeout,this.retries=t.retries??p3.retries,this.maxInboundStreams=t.maxInboundStreams??p3.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??p3.maxOutboundStreams}isStarted(){return this.started}async start(){this.started||(this.topologyId=await this.registrar.register(g3,{notifyOnLimitedConnection:!0,onConnect:(e,t)=>{vc.exactMatch(t.remoteAddr)&&t.direction==="inbound"&&this.upgradeInbound(t).catch(n=>{this.log.error("error during outgoing DCUtR attempt",n)})}}),await this.registrar.handle(g3,e=>{this.handleIncomingUpgrade(e.stream,e.connection).catch(t=>{this.log.error("error during incoming DCUtR attempt",t),e.stream.abort(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:!0}),this.started=!0)}async stop(){await this.registrar.unhandle(g3),this.topologyId!=null&&this.registrar.unregister(this.topologyId),this.started=!1}async upgradeInbound(e){if(await this.attemptUnilateralConnectionUpgrade(e))return;let t;for(let n=0;n<this.retries;n++){const i={signal:AbortSignal.timeout(this.timeout)};try{t=await e.newStream([g3],{signal:i.signal,runOnLimitedConnection:!0});const s=li(t,{maxDataLength:fB}).pb(Hs);this.log("B sending connect to %p",e.remotePeer);const o=Date.now();await s.write({type:Hs.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(h=>h.bytes)},i),this.log("B receiving connect from %p",e.remotePeer);const a=await s.read(i);if(a.type!==Hs.Type.CONNECT)throw this.log("A sent wrong message type"),new Et("DCUtR message type was incorrect");const c=this.getDialableMultiaddrs(a.observedAddresses);if(c.length===0)throw this.log("A did not have any dialable multiaddrs"),new Et("DCUtR connect message had no multiaddrs");const l=Date.now()-o;this.log("A sending sync, rtt %dms",l),await s.write({type:Hs.Type.SYNC,observedAddresses:[]},i),this.log("A waiting for half RTT"),await dB(l/2),this.log("B dialing",c);const d=await this.connectionManager.openConnection(c,{signal:i.signal,priority:pB,force:!0,initiator:!1});this.log("DCUtR to %p succeeded to address %a, closing relayed connection",e.remotePeer,d.remoteAddr),await e.close(i);break}catch(s){if(this.log.error("error while attempting DCUtR on attempt %d of %d",n+1,this.retries,s),t==null||t.abort(s),n===this.retries)throw s}finally{t!=null&&await t.close(i)}}}async attemptUnilateralConnectionUpgrade(e){const n=(await this.peerStore.get(e.remotePeer)).addresses.map(i=>{const s=i.multiaddr;return s.getPeerId()==null?s.encapsulate(`/p2p/${e.remotePeer}`):s}).filter(i=>hB(i,this.transportManager));if(n.length>0){const i=AbortSignal.timeout(this.timeout);try{this.log("attempting unilateral connection upgrade to %a",n);const s=await this.connectionManager.openConnection(n,{signal:i,force:!0});if(vc.exactMatch(s.remoteAddr))throw new Error("Could not open a new, non-limited, connection");return this.log("unilateral connection upgrade to %p succeeded via %a, closing relayed connection",e.remotePeer,s.remoteAddr),await e.close({signal:i}),!0}catch(s){this.log.error("unilateral connection upgrade to %p on addresses %a failed",e.remotePeer,n,s)}}else this.log("peer %p has no public addresses, not attempting unilateral connection upgrade",e.remotePeer);return!1}async handleIncomingUpgrade(e,t){const n={signal:AbortSignal.timeout(this.timeout)};try{const i=li(e,{maxDataLength:fB}).pb(Hs);this.log("A receiving connect");const s=await i.read(n);if(s.type!==Hs.Type.CONNECT)throw this.log("B sent wrong message type"),new Et("DCUtR message type was incorrect");if(s.observedAddresses.length===0)throw this.log("B sent no multiaddrs"),new Et("DCUtR connect message had no multiaddrs");const o=this.getDialableMultiaddrs(s.observedAddresses);if(o.length===0)throw this.log("B had no dialable multiaddrs"),new Et("DCUtR connect message had no dialable multiaddrs");if(this.log("A sending connect"),await i.write({type:Hs.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(l=>l.bytes)}),this.log("A receiving sync"),(await i.read(n)).type!==Hs.Type.SYNC)throw new Et("DCUtR message type was incorrect");this.log("A dialing",o);const c=await this.connectionManager.openConnection(o,{signal:n.signal,priority:pB,force:!0});this.log("DCUtR to %p succeeded via %a, closing relayed connection",t.remotePeer,c.remoteAddr),await t.close(n)}catch(i){this.log.error("incoming DCUtR from %p failed",t.remotePeer,i),e.abort(i)}finally{await e.close(n)}}getDialableMultiaddrs(e){const t=[];for(const n of e)if(!(n==null||n.length===0))try{const i=Re(n);if(!hB(i,this.transportManager))continue;t.push(i)}catch{}return t}}const g3="/libp2p/dcutr";function g3e(r={}){return e=>new p3e(e,r)}const y3=globalThis.CustomEvent??Event;async function*lp(r,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);const n=e.ordered??!1,i=new EventTarget,s=[];let o=Le(),a=Le(),c=!1,l,d=!1;i.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(const f of r){if(s.length===t&&(o=Le(),await o.promise),d)break;const g={done:!1};s.push(g),f().then(v=>{g.done=!0,g.ok=!0,g.value=v,i.dispatchEvent(new y3("task-complete"))},v=>{g.done=!0,g.err=v,i.dispatchEvent(new y3("task-complete"))})}c=!0,i.dispatchEvent(new y3("task-complete"))}catch(f){l=f,i.dispatchEvent(new y3("task-complete"))}});function h(){var f;return n?(f=s[0])==null?void 0:f.done:!!s.find(g=>g.done)}function*p(){for(;s.length>0&&s[0].done;){const f=s[0];if(s.shift(),f.ok)yield f.value;else throw d=!0,o.resolve(),f.err;o.resolve()}}function*m(){for(;h();)for(let f=0;f<s.length;f++)if(s[f].done){const g=s[f];if(s.splice(f,1),f--,g.ok)yield g.value;else throw d=!0,o.resolve(),g.err;o.resolve()}}for(;;){if(h()||(a=Le(),await a.promise),l!=null)throw l;if(n?yield*p():yield*m(),c&&s.length===0)break}}const y3e="0.1.0",m3e="id",w3e="id/push",b3e="1.0.0",v3e="1.0.0",E3e=1024*8,S3e=32;var sh;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.protocolVersion!=null&&(n.uint32(42),n.string(t.protocolVersion)),t.agentVersion!=null&&(n.uint32(50),n.string(t.agentVersion)),t.publicKey!=null&&(n.uint32(10),n.bytes(t.publicKey)),t.listenAddrs!=null)for(const s of t.listenAddrs)n.uint32(18),n.bytes(s);if(t.observedAddr!=null&&(n.uint32(34),n.bytes(t.observedAddr)),t.protocols!=null)for(const s of t.protocols)n.uint32(26),n.string(s);t.signedPeerRecord!=null&&(n.uint32(66),n.bytes(t.signedPeerRecord)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={listenAddrs:[],protocols:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 5:{s.protocolVersion=t.string();break}case 6:{s.agentVersion=t.string();break}case 1:{s.publicKey=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.listenAddrs)!=null&&s.listenAddrs.length===i.limits.listenAddrs)throw new mt('Decode error - map field "listenAddrs" had too many elements');s.listenAddrs.push(t.bytes());break}case 4:{s.observedAddr=t.bytes();break}case 3:{if(((c=i.limits)==null?void 0:c.protocols)!=null&&s.protocols.length===i.limits.protocols)throw new mt('Decode error - map field "protocols" had too many elements');s.protocols.push(t.string());break}case 8:{s.signedPeerRecord=t.bytes();break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(sh||(sh={}));const Pi={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:E3e,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnLimitedConnection:!0,concurrency:S3e};function x3e(r){if(r!=null&&r.length>0)try{return Re(r)}catch{}}function A3e(r,e){return e??r.userAgent}async function gB(r,e,t,n,i){if(t("received identify from %p",n.remotePeer),i==null)throw new Et("message was null or undefined");const s={};if(i.listenAddrs.length>0&&(s.addresses=i.listenAddrs.map(c=>({isCertified:!1,multiaddr:Re(c)}))),i.protocols.length>0&&(s.protocols=i.protocols),i.publicKey!=null){const c=_n(i.publicKey);if(!Fd(c).equals(n.remotePeer))throw new Et("public key did not match remote PeerId");s.publicKey=c}let o;if(i.signedPeerRecord!=null){t.trace("received signedPeerRecord from %p",n.remotePeer);let c=i.signedPeerRecord;const l=await Pc.openAndCertify(c,js.DOMAIN);let d=js.createFromProtobuf(l.payload);const h=zd(l.publicKey.toCID());if(!d.peerId.equals(h))throw new Et("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(d.peerId))throw new Et("signing key does not match remote PeerId");let p;try{p=await r.get(d.peerId)}catch(m){if(m.name!=="NotFoundError")throw m}if(p!=null&&(s.metadata=p.metadata,p.peerRecordEnvelope!=null)){const m=await Pc.createFromProtobuf(p.peerRecordEnvelope),f=js.createFromProtobuf(m.payload);f.seqNumber>=d.seqNumber&&(t("sequence number was lower or equal to existing sequence number - stored: %d received: %d",f.seqNumber,d.seqNumber),d=f,c=p.peerRecordEnvelope)}s.peerRecordEnvelope=c,s.addresses=d.multiaddrs.map(m=>({isCertified:!0,multiaddr:m})),o={seq:d.seqNumber,addresses:d.multiaddrs}}else t("%p did not send a signed peer record",n.remotePeer);if(t.trace("patching %p with",n.remotePeer,s),await r.patch(n.remotePeer,s),i.agentVersion!=null||i.protocolVersion!=null){const c={};i.agentVersion!=null&&(c.AgentVersion=se(i.agentVersion)),i.protocolVersion!=null&&(c.ProtocolVersion=se(i.protocolVersion)),t.trace("merging %p metadata",n.remotePeer,c),await r.merge(n.remotePeer,{metadata:c})}const a={peerId:n.remotePeer,protocolVersion:i.protocolVersion,agentVersion:i.agentVersion,publicKey:i.publicKey,listenAddrs:i.listenAddrs.map(c=>Re(c)),observedAddr:i.observedAddr==null?void 0:Re(i.observedAddr),protocols:i.protocols,signedPeerRecord:o,connection:n};return e.safeDispatchEvent("peer:identify",{detail:a}),a}class yB{constructor(e,t){u(this,"host");u(this,"protocol");u(this,"started");u(this,"timeout");u(this,"peerId");u(this,"privateKey");u(this,"peerStore");u(this,"registrar");u(this,"addressManager");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"maxMessageSize");u(this,"maxObservedAddresses");u(this,"events");u(this,"runOnLimitedConnection");u(this,"log");this.protocol=t.protocol,this.started=!1,this.peerId=e.peerId,this.privateKey=e.privateKey,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.events=e.events,this.log=t.log,this.timeout=t.timeout??Pi.timeout,this.maxInboundStreams=t.maxInboundStreams??Pi.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??Pi.maxOutboundStreams,this.maxMessageSize=t.maxMessageSize??Pi.maxMessageSize,this.maxObservedAddresses=t.maxObservedAddresses??Pi.maxObservedAddresses,this.runOnLimitedConnection=t.runOnLimitedConnection??Pi.runOnLimitedConnection,this.host={protocolVersion:`${t.protocolPrefix??Pi.protocolPrefix}/${y3e}`,agentVersion:A3e(e.nodeInfo,t.agentVersion)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:se(this.host.agentVersion),ProtocolVersion:se(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,e=>{this.handleProtocol(e).catch(t=>{this.log.error(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}}class C3e extends(rH=yB,tH=dr,rH){constructor(t,n={}){super(t,{...n,protocol:`/${n.protocolPrefix??Pi.protocolPrefix}/${w3e}/${v3e}`,log:t.logger.forComponent("libp2p:identify-push")});u(this,"connectionManager");u(this,"concurrency");u(this,tH,["@libp2p/identify-push"]);this.connectionManager=t.connectionManager,this.concurrency=n.concurrency??Pi.concurrency,(n.runOnSelfUpdate??Pi.runOnSelfUpdate)&&t.events.addEventListener("self:peer:update",i=>{this.push().catch(s=>{this.log.error(s)})})}async push(){if(!this.isStarted())return;const t=this.addressManager.getAddresses().map(h=>h.decapsulateCode(ze("p2p").code)),n=new js({peerId:this.peerId,multiaddrs:t}),i=await Pc.seal(n,this.privateKey),s=this.registrar.getProtocols(),o=await this.peerStore.get(this.peerId),a=re(o.metadata.get("AgentVersion")??se(this.host.agentVersion)),c=re(o.metadata.get("ProtocolVersion")??se(this.host.protocolVersion)),l=this;async function*d(){for(const h of l.connectionManager.getConnections())(await l.peerStore.get(h.remotePeer)).protocols.includes(l.protocol)&&(yield async()=>{let m;const f=AbortSignal.timeout(l.timeout);try{m=await h.newStream(l.protocol,{signal:f,runOnLimitedConnection:l.runOnLimitedConnection}),await li(m,{maxDataLength:l.maxMessageSize}).pb(sh).write({listenAddrs:t.map(v=>v.bytes),signedPeerRecord:i.marshal(),protocols:s,agentVersion:a,protocolVersion:c},{signal:f}),await m.close({signal:f})}catch(g){l.log.error("could not push identify update to peer",g),m==null||m.abort(g)}})}await Eo(lp(d(),{concurrency:this.concurrency}))}async handleProtocol(t){const{connection:n,stream:i}=t;try{if(this.peerId.equals(n.remotePeer))throw new Error("received push from ourselves?");const s={signal:AbortSignal.timeout(this.timeout)},a=await li(i,{maxDataLength:this.maxMessageSize}).pb(sh).read(s);await i.close(s),await gB(this.peerStore,this.events,this.log,n,a)}catch(s){this.log.error("received invalid message",s),i.abort(s);return}this.log.trace("handled push from %p",n.remotePeer)}}const I3e=41;class k3e extends(iH=yB,nH=dr,iH){constructor(t,n={}){super(t,{...n,protocol:`/${n.protocolPrefix??Pi.protocolPrefix}/${m3e}/${b3e}`,log:t.logger.forComponent("libp2p:identify")});u(this,nH,["@libp2p/identify"]);(n.runOnConnectionOpen??Pi.runOnConnectionOpen)&&t.events.addEventListener("connection:open",i=>{const s=i.detail;this.identify(s).catch(o=>{o.name!==h1.name&&this.log.error("error during identify trigged by connection:open",o)})})}async _identify(t,n={}){let i;if(n.signal==null){const s=AbortSignal.timeout(this.timeout);n={...n,signal:s}}try{i=await t.newStream(this.protocol,{...n,runOnLimitedConnection:this.runOnLimitedConnection});const o=await li(i,{maxDataLength:this.maxMessageSize}).pb(sh).read(n);return await i.close(n),o}catch(s){throw i==null||i.abort(s),s}}async identify(t,n={}){const i=await this._identify(t,n),{publicKey:s,protocols:o,observedAddr:a}=i;if(s==null)throw new Et("public key was missing from identify message");const c=_n(s),l=zd(c.toCID());if(!t.remotePeer.equals(l))throw new Et("identified peer does not match the expected peer");if(this.peerId.equals(l))throw new Et("identified peer is our own peer id?");return this.maybeAddObservedAddress(a),this.log("identify completed for peer %p and protocols %o",l,o),gB(this.peerStore,this.events,this.log,t,i)}maybeAddObservedAddress(t){const n=x3e(t);if(n==null)return;if(this.log.trace("our observed address was %a",n),Yl(n)){this.log.trace("our observed address was private");return}if(n.stringTuples()[0][0]===I3e&&!EL(n)){this.log.trace("our observed address was IPv6 but not a global unicast address");return}hm.exactMatch(n)||(this.log.trace("storing the observed address"),this.addressManager.addObservedAddr(n))}async handleProtocol(t){const{connection:n,stream:i}=t,s=AbortSignal.timeout(this.timeout);try{const o=await this.peerStore.get(this.peerId),a=this.addressManager.getAddresses().map(h=>h.decapsulateCode(ze("p2p").code));let c=o.peerRecordEnvelope;if(a.length>0&&c==null){const h=new js({peerId:this.peerId,multiaddrs:a});c=(await Pc.seal(h,this.privateKey)).marshal().subarray()}let l=n.remoteAddr.bytes;dhe.matches(n.remoteAddr)||(l=void 0),await li(i).pb(sh).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:_i(this.privateKey.publicKey),listenAddrs:a.map(h=>h.bytes),signedPeerRecord:c,observedAddr:l,protocols:o.protocols},{signal:s}),await i.close({signal:s})}catch(o){this.log.error("could not respond to identify request",o),i.abort(o)}}}function W9(r={}){return e=>new k3e(e,r)}function _3e(r={}){return e=>new C3e(e,r)}const up=1e3,G9=60*up,m3=60*G9,T3e=36*m3,P3e="/ipfs/kad/1.0.0",D3e=48*m3,$3e=24*m3,N3e=10,M3e=16384,O3e=m3,mB=20,Q9=3,R3e=5*G9,L3e=up,B3e=5*up,U3e=5*G9,F3e=30*up,z3e=180*up,wB=`${k2}-kad-dht`;var w3;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key.byteLength>0&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={key:Ge(0),value:Ge(0),timeReceived:""},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.key=t.bytes();break}case 2:{s.value=t.bytes();break}case 5:{s.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(w3||(w3={}));function V3e(r){const e=r.getUTCFullYear(),t=String(r.getUTCMonth()+1).padStart(2,"0"),n=String(r.getUTCDate()).padStart(2,"0"),i=String(r.getUTCHours()).padStart(2,"0"),s=String(r.getUTCMinutes()).padStart(2,"0"),o=String(r.getUTCSeconds()).padStart(2,"0"),a=r.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${n}T${i}:${s}:${o}.${c}Z`}function K3e(r){const e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");const n=parseInt(t[1],10),i=parseInt(t[2],10)-1,s=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),l=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,i,s,o,a,c,l))}class Di{constructor(e,t,n){u(this,"key");u(this,"value");u(this,"timeReceived");if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return w3.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:V3e(this.timeReceived)}}static deserialize(e){const t=w3.decode(e);return new Di(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=K3e(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new Di(e.key,e.value,t)}}class b3 extends Error{constructor(e="Query error"){super(e),this.name="QueryError"}}class j3e extends Error{constructor(e="Query aborted"){super(e),this.name="QueryAbortedError"}}class H3e extends Error{constructor(e="Invalid record"){super(e),this.name="InvalidRecordError"}}class q3e extends Error{constructor(e="No selector function configured for prefix"){super(e),this.name="MissingSelectorError"}}var bB;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&(n.uint32(18),n.bytes(t.value)),t.author!=null&&(n.uint32(26),n.bytes(t.author)),t.signature!=null&&(n.uint32(34),n.bytes(t.signature)),t.timeReceived!=null&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.key=t.bytes();break}case 2:{s.value=t.bytes();break}case 3:{s.author=t.bytes();break}case 4:{s.signature=t.bytes();break}case 5:{s.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(bB||(bB={}));var Ct;(function(r){r.PUT_VALUE="PUT_VALUE",r.GET_VALUE="GET_VALUE",r.ADD_PROVIDER="ADD_PROVIDER",r.GET_PROVIDERS="GET_PROVIDERS",r.FIND_NODE="FIND_NODE",r.PING="PING"})(Ct||(Ct={}));var v3;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(v3||(v3={})),function(r){r.codec=()=>kn(v3)}(Ct||(Ct={}));var oh;(function(r){r.NOT_CONNECTED="NOT_CONNECTED",r.CONNECTED="CONNECTED",r.CAN_CONNECT="CAN_CONNECT",r.CANNOT_CONNECT="CANNOT_CONNECT"})(oh||(oh={}));var Y9;(function(r){r[r.NOT_CONNECTED=0]="NOT_CONNECTED",r[r.CONNECTED=1]="CONNECTED",r[r.CAN_CONNECT=2]="CAN_CONNECT",r[r.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(Y9||(Y9={})),function(r){r.codec=()=>kn(Y9)}(oh||(oh={}));var ah;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.multiaddrs!=null)for(const s of t.multiaddrs)n.uint32(18),n.bytes(s);t.connection!=null&&(n.uint32(24),oh.codec().encode(t.connection,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={id:Ge(0),multiaddrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.id=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.multiaddrs)!=null&&s.multiaddrs.length===i.limits.multiaddrs)throw new mt('Decode error - map field "multiaddrs" had too many elements');s.multiaddrs.push(t.bytes());break}case 3:{s.connection=oh.codec().decode(t);break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(ah||(ah={}));var eu;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.type!=null&&v3[t.type]!==0&&(n.uint32(8),Ct.codec().encode(t.type,n)),t.clusterLevel!=null&&(n.uint32(80),n.int32(t.clusterLevel)),t.key!=null&&(n.uint32(18),n.bytes(t.key)),t.record!=null&&(n.uint32(26),n.bytes(t.record)),t.closer!=null)for(const s of t.closer)n.uint32(66),ah.codec().encode(s,n);if(t.providers!=null)for(const s of t.providers)n.uint32(74),ah.codec().encode(s,n);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,d;const s={type:Ct.PUT_VALUE,closer:[],providers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const h=t.uint32();switch(h>>>3){case 1:{s.type=Ct.codec().decode(t);break}case 10:{s.clusterLevel=t.int32();break}case 2:{s.key=t.bytes();break}case 3:{s.record=t.bytes();break}case 8:{if(((a=i.limits)==null?void 0:a.closer)!=null&&s.closer.length===i.limits.closer)throw new mt('Decode error - map field "closer" had too many elements');s.closer.push(ah.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.closer$}));break}case 9:{if(((l=i.limits)==null?void 0:l.providers)!=null&&s.providers.length===i.limits.providers)throw new mt('Decode error - map field "providers" had too many elements');s.providers.push(ah.codec().decode(t,t.uint32(),{limits:(d=i.limits)==null?void 0:d.providers$}));break}default:{t.skipType(h&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(eu||(eu={}));function vB(r,e={}){var n;const t={...r,name:"SEND_QUERY",type:0,messageName:r.type,messageType:r.type};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:send-query",{detail:t})),t}function J9(r,e={}){var n;const t={...r,name:"PEER_RESPONSE",type:1,messageName:r.messageType,closer:r.closer??[],providers:r.providers??[]};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:peer-response",{detail:t})),t}function X9(r,e={}){var n;const t={...r,name:"FINAL_PEER",type:2};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:final-peer",{detail:t})),t}function Dc(r,e={}){var n;const t={...r,name:"QUERY_ERROR",type:3};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:query-error",{detail:t})),t}function EB(r,e={}){var n;const t={...r,name:"PROVIDER",type:4};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:provider",{detail:t})),t}function Z9(r,e={}){var n;const t={...r,name:"VALUE",type:5};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:value",{detail:t})),t}function SB(r,e={}){var n;const t={...r,name:"DIAL_PEER",type:7};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:dial-peer",{detail:t})),t}function W3e(r,e,t){if(t.length===0)throw new Z("No records given");const i=re(e).split("/");if(i.length<3)throw new Z("Record key does not have a selector function");const s=r[i[1].toString()];if(s==null)throw new q3e(`No selector function configured for key type "${i[1]}"`);return t.length===1?0:s(e,t)}function G3e(r,e){return 0}const Q3e={pk:G3e};async function eE(r,e){const t=e.key,i=re(t).split("/");if(i.length<3)return;const s=r[i[1].toString()];if(s==null)throw new Z(`No validator available for key type "${i[1]}"`);await s(t,e.value)}const Y3e={pk:async(r,e)=>{if(!(r instanceof Uint8Array))throw new Z('"key" must be a Uint8Array');if(r.byteLength<5)throw new Z("Invalid public key record");if(re(r.subarray(0,4))!=="/pk/")throw new Z("key was not prefixed with /pk/");const n=_n(e),i=r.slice(4);if(!qe(i,n.toMultihash().bytes))throw new Z("public key does not match passed in key")}};function J3e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function tE(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function X3e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var Z3e=X3e,ewe=Z3e;let twe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},rwe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return xB(this,e)}},nwe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return xB(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function xB(r,e){return new nwe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let iwe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new twe(e,t,n),this.decoder=new rwe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function AB({name:r,prefix:e,encode:t,decode:n}){return new iwe(r,e,t,n)}function E3({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=ewe(t,r);return AB({prefix:e,name:r,encode:n,decode:s=>tE(i(s))})}function swe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function owe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function qo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return AB({prefix:e,name:r,encode(i){return owe(i,n,t)},decode(i){return swe(i,n,t,r)}})}const S3=qo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});qo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),qo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),qo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),qo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),qo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),qo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),qo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),qo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const rE=E3({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});E3({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const $c=E3({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});E3({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var awe=IB,CB=128,cwe=-128,lwe=Math.pow(2,31);function IB(r,e,t){e=e||[],t=t||0;for(var n=t;r>=lwe;)e[t++]=r&255|CB,r/=128;for(;r&cwe;)e[t++]=r&255|CB,r>>>=7;return e[t]=r|0,IB.bytes=t-n+1,e}var uwe=nE,dwe=128,kB=127;function nE(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw nE.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&kB)<<i:(o&kB)*Math.pow(2,i),i+=7}while(o>=dwe);return nE.bytes=s-n,t}var hwe=Math.pow(2,7),fwe=Math.pow(2,14),pwe=Math.pow(2,21),gwe=Math.pow(2,28),ywe=Math.pow(2,35),mwe=Math.pow(2,42),wwe=Math.pow(2,49),bwe=Math.pow(2,56),vwe=Math.pow(2,63),Ewe=function(r){return r<hwe?1:r<fwe?2:r<pwe?3:r<gwe?4:r<ywe?5:r<mwe?6:r<wwe?7:r<bwe?8:r<vwe?9:10},Swe={encode:awe,decode:uwe,encodingLength:Ewe},x3=Swe;function iE(r,e=0){return[x3.decode(r,e),x3.decode.bytes]}function A3(r,e,t=0){return x3.encode(r,e,t),e}function C3(r){return x3.encodingLength(r)}function sE(r,e){const t=e.byteLength,n=C3(r),i=n+C3(t),s=new Uint8Array(i+t);return A3(r,s,0),A3(t,s,n),s.set(e,i),new oE(r,t,e,s)}function tu(r){const e=tE(r),[t,n]=iE(e),[i,s]=iE(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new oE(t,i,o,e)}function xwe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&J3e(r.bytes,t.bytes)}}let oE=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function _B(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Cwe(t,aE(r),e??$c.encoder);default:return Iwe(t,aE(r),e??S3.encoder)}}const TB=new WeakMap;function aE(r){const e=TB.get(r);if(e==null){const t=new Map;return TB.set(r,t),t}return e}let cE=class nn{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,sH,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==dp)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==kwe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return nn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=sE(e,t);return nn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return nn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&xwe(e.multihash,n.multihash)}toString(e){return _B(this,e)}toJSON(){return{"/":_B(this)}}link(){return this}[(sH=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof nn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new nn(n,i,s,o??PB(n,i,s.bytes))}else if(t[_we]===!0){const{version:n,multihash:i,code:s}=t,o=tu(i);return nn.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==dp)throw new Error(`Version 0 CID must use dag-pb (code: ${dp}) block encoding`);return new nn(e,t,n,n.bytes)}case 1:{const i=PB(e,t,n.bytes);return new nn(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return nn.create(0,dp,e)}static createV1(e,t){return nn.create(1,e,t)}static decode(e){const[t,n]=nn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=nn.inspectBytes(e),n=t.size-t.multihashSize,i=tE(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new oE(t.multihashCode,t.digestSize,s,i);return[t.version===0?nn.createV0(o):nn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=iE(e.subarray(t));return t+=p,h};let i=n(),s=dp;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Awe(e,t),s=nn.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return aE(s).set(n,e),s}};function Awe(r,e){switch(r[0]){case"Q":{const t=e??$c;return[$c.prefix,t.decode(`${$c.prefix}${r}`)]}case $c.prefix:{const t=e??$c;return[$c.prefix,t.decode(r)]}case S3.prefix:{const t=e??S3;return[S3.prefix,t.decode(r)]}case rE.prefix:{const t=e??rE;return[rE.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Cwe(r,e,t){const{prefix:n}=t;if(n!==$c.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Iwe(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const dp=112,kwe=18;function PB(r,e,t){const n=C3(r),i=n+C3(e),s=new Uint8Array(i+t.byteLength);return A3(r,s,0),A3(e,s,n),s.set(t,i),s}const _we=Symbol.for("@ipld/js-cid/CID"),Twe=85;function Pwe({name:r,code:e,encode:t}){return new Dwe(r,e,t)}let Dwe=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?sE(this.code,t):t.then(n=>sE(this.code,n))}else throw Error("Unknown type, must be binary type")}};function $we(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const DB=Pwe({name:"sha2-256",code:18,encode:$we("SHA-256")}),Nwe=se("/pk/");function Mwe(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{const[[t,n]]=e.stringTuples();if(t===53||t===54||t===55)return n!=="localhost";if(t!==4&&t!==6||n==null)return!1;const i=bc(n);return i==null?!0:!i})}}async function hp(r){return(await DB.digest(r)).digest}async function cs(r){return hp(r.toMultihash().bytes)}function fp(r,e){return new xt(`${r}/${re(e,"base32")}`,!1)}function Owe(r){return or([Nwe,r.toMultihash().bytes])}function Rwe(r){return re(r.subarray(0,4))==="/pk/"}function Lwe(r){const e=tu(r.subarray(4));return ti(e)}function $B(r,e){const t=new Date;return new Di(r,e,t).serialize()}const Bwe=290,Uwe=54,Fwe=55,zwe=56,Vwe=4,Kwe=41;function jwe(r){const e=r.stringTuples();for(const t of e)if(t[0]===Bwe)return!1;if(e[0][0]===Uwe||e[0][0]===Fwe||e[0][0]===zwe)return!0;if(e[0][0]===Vwe||e[0][0]===Kwe){const t=bc(`${e[0][1]}`);return t==null||!t}return!1}function NB(r){const e=r.toString().split("/"),t=e.pop(),n=e.pop();if(t==null||n==null)throw new Error(`incorrectly formatted provider entry key in datastore: ${r.toString()}`);return{cid:cE.createV1(Twe,tu(se(n,"base32"))),peerId:tr(t)}}function lE(r,e,t){const n=typeof e=="string"?e:re(e.multihash.bytes,"base32"),i=[r,n];return t!=null&&i.push(t.toString()),new xt(i.join("/"))}function MB(r){return new Date(Zi(r))}function ch(r,e,t){return async function*(...n){var a,c,l,d,h;const i=(a=e.queryTime)==null?void 0:a.timer(t),s=(c=e.errorTime)==null?void 0:c.timer(t);let o=!1;try{(l=e.queries)==null||l.increment({[t]:!0}),yield*r(...n)}catch(p){throw o=!0,s==null||s(),(d=e.errors)==null||d.increment({[t]:!0}),p}finally{(h=e.queries)==null||h.decrement({[t]:!0}),o||i==null||i()}}}function OB(r,e,t){return async function(...n){var a,c,l,d,h;const i=(a=e==null?void 0:e.queryTime)==null?void 0:a.timer(t),s=(c=e==null?void 0:e.errorTime)==null?void 0:c.timer(t);let o=!1;try{return(l=e.queries)==null||l.increment({[t]:!0}),await r(...n)}catch(p){throw o=!0,s==null||s(),(d=e.errors)==null||d.increment({[t]:!0}),p}finally{(h=e.queries)==null||h.decrement({[t]:!0}),o||i==null||i()}}}class Hwe{constructor(e,t){u(this,"log");u(this,"components");u(this,"validators");u(this,"selectors");u(this,"peerRouting");u(this,"queryManager");u(this,"network");u(this,"datastorePrefix");var l,d;const{validators:n,selectors:i,peerRouting:s,queryManager:o,network:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-fetching`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n,this.selectors=i,this.peerRouting=s,this.queryManager=o,this.network=a,this.get=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.get",this.get.bind(this),{optionsIndex:1}))??this.get,this.put=((d=e.metrics)==null?void 0:d.traceFunction("libp2p.kadDHT.put",this.put.bind(this),{optionsIndex:2}))??this.put}async getLocal(e){this.log("getLocal %b",e);const t=fp(this.datastorePrefix,e);this.log("fetching record for key %k",t);const n=await this.components.datastore.get(t);this.log("found %k in local datastore",t);const i=Di.deserialize(n);return await eE(this.validators,i),i}async*sendCorrectionRecord(e,t,n,i={}){this.log("sendCorrection for %b",e);const s=$B(e,n);for(const{value:o,from:a}of t){if(qe(o,n)){this.log("record was ok");continue}if(this.components.peerId.equals(a)){try{const d=fp(this.datastorePrefix,e);this.log(`Storing corrected record for key ${d.toString()}`),await this.components.datastore.put(d,s.subarray())}catch(d){this.log.error("Failed error correcting self",d)}continue}let c=!1;const l={type:Ct.PUT_VALUE,key:e,record:s};for await(const d of this.network.sendRequest(a,l,i))d.name==="PEER_RESPONSE"&&d.record!=null&&qe(d.record.value,Di.deserialize(s).value)&&(c=!0),yield d;c||(yield Dc({from:a,error:new b3("Value not put correctly")},i)),this.log.error("Failed error correcting entry")}}async*put(e,t,n={}){this.log("put key %b value %b",e,t);const i=$B(e,t),s=fp(this.datastorePrefix,e);this.log(`storing record for key ${s.toString()}`),await this.components.datastore.put(s,i.subarray()),yield*un(this.peerRouting.getClosestPeers(e,{...n,signal:n.signal}),o=>Ud(o,a=>async()=>{if(a.name!=="FINAL_PEER")return[a];const c=[],l={type:Ct.PUT_VALUE,key:e,record:i};this.log("send put to %p",a.peer.id);for await(const d of this.network.sendRequest(a.peer.id,l,n))c.push(d),d.name==="PEER_RESPONSE"&&(d.record!=null&&qe(d.record.value,Di.deserialize(i).value)||c.push(Dc({from:a.peer.id,error:new b3("Value not put correctly")},n)));return c}),o=>lp(o,{ordered:!1,concurrency:Q9}),async function*(o){for await(const a of o)yield*a})}async*get(e,t={}){this.log("get %b",e);const n=[];for await(const a of this.getMany(e,t))a.name==="VALUE"&&n.push(a),yield a;if(n.length===0)return;const i=n.map(a=>a.value);let s=0;try{s=W3e(this.selectors,e,i)}catch(a){if(a.name!=="InvalidParametersError")throw a}const o=i[s];if(this.log("GetValue %b %b",e,o),o==null)throw new Zt("Best value was not found");yield*this.sendCorrectionRecord(e,n,o,t),yield n[s]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{const s=await this.getLocal(e);yield Z9({value:s.value,from:this.components.peerId},t)}catch(s){this.log("error getting local value for %b",e,s)}const n=this,i=async function*({peer:s,signal:o}){for await(const a of n.peerRouting.getValueOrPeers(s,e,{...t,signal:o}))yield a,a.name==="PEER_RESPONSE"&&a.record!=null&&(yield Z9({from:s,value:a.record.value},t))};yield*this.queryManager.run(e,i,t)}}function qwe(r,e){return{id:r.id.toMultihash().bytes,multiaddrs:(r.multiaddrs??[]).map(n=>n.bytes),connection:e}}function I3(r){if(r.id==null)throw new Error("Invalid peer in message");const e=tu(r.id);return{id:ti(e),multiaddrs:(r.multiaddrs??[]).map(t=>Re(t))}}class Wwe{constructor(e,t){u(this,"log");u(this,"components");u(this,"network");u(this,"peerRouting");u(this,"queryManager");u(this,"routingTable");u(this,"providers");var l,d;const{network:n,peerRouting:i,queryManager:s,routingTable:o,providers:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-routing`),this.network=n,this.peerRouting=i,this.queryManager=s,this.routingTable=o,this.providers=a,this.findProviders=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(h,p)=>(h.name==="PROVIDER"&&(p.providers??(p.providers=[]),p.providers.push(...h.providers.map(m=>m.id.toString()))),p)}))??this.findProviders,this.provide=((d=e.metrics)==null?void 0:d.traceFunction("libp2p.kadDHT.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(h,p)=>(h.name==="PEER_RESPONSE"&&h.messageName==="ADD_PROVIDER"&&(p.providers??(p.providers=[]),p.providers.push(h.from.toString())),p)}))??this.provide}async*provide(e,t,n={}){this.log("provide %s",e);const i=e.multihash.bytes;await this.providers.addProvider(e,this.components.peerId);const s={type:Ct.ADD_PROVIDER,key:i,providers:[qwe({id:this.components.peerId,multiaddrs:t})]};let o=0;const a=c=>async()=>{if(c.name!=="FINAL_PEER")return[c];const l=[];this.log("putProvider %s to %p",e,c.peer.id);try{this.log("sending provider record for %s to %p",e,c.peer.id);for await(const d of this.network.sendMessage(c.peer.id,s,n))d.name==="PEER_RESPONSE"&&(this.log("sent provider record for %s to %p",e,c.peer.id),o++),l.push(d)}catch(d){this.log.error("error sending provide record to peer %p",c.peer.id,d),l.push(Dc({from:c.peer.id,error:d},n))}return l};yield*un(this.peerRouting.getClosestPeers(i,n),c=>Ud(c,l=>a(l)),c=>lp(c,{ordered:!1,concurrency:Q9}),async function*(c){for await(const l of c)yield*l}),this.log("sent provider records to %d peers",o)}async*findProviders(e,t){const n=this.routingTable.kBucketSize;let i=0;const s=e.multihash.bytes,o=this;this.log("findProviders %c",e);const a=await this.providers.getProviders(e);if(a.length>0){const d=[];for(const h of a.slice(0,n))try{const p=await this.components.peerStore.get(h);d.push({id:h,multiaddrs:p.addresses.map(({multiaddr:m})=>m)})}catch(p){if(p.name!=="NotFoundError")throw p;this.log("no peer store entry for %p",h)}if(yield J9({from:this.components.peerId,messageType:Ct.GET_PROVIDERS,providers:d},t),yield EB({from:this.components.peerId,providers:d},t),i+=d.length,i>=n)return}const c=async function*({peer:d,signal:h}){const p={type:Ct.GET_PROVIDERS,key:s};yield*o.network.sendRequest(d,p,{...t,signal:h})},l=new ts(a);for await(const d of this.queryManager.run(s,c,t))if(yield d,d.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",d.providers.length,e,d.closer.length);const h=[];for(const p of d.providers)l.has(p.id)||(l.add(p.id),h.push(p));if(h.length>0&&(yield EB({from:d.from,providers:h},t),i+=h.length,i>=n))return}}}class uE{constructor(e){u(this,"movingAverage");u(this,"variance");u(this,"deviation");u(this,"forecast");u(this,"timeSpan");u(this,"previousTime");this.timeSpan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timeSpan)}push(e,t=Date.now()){if(this.previousTime!=null){const n=this.alpha(t,this.previousTime),i=e-this.movingAverage,s=n*i;this.movingAverage=n*e+(1-n)*this.movingAverage,this.variance=(1-n)*(this.variance+i*s),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+n*i}else this.movingAverage=e;this.previousTime=t}}const Gwe=1.2,Qwe=2,Ywe=2e3;class pp{constructor(e={}){u(this,"success");u(this,"failure");u(this,"next");u(this,"metric");u(this,"timeoutMultiplier");u(this,"failureMultiplier");u(this,"minTimeout");var t;this.success=new uE(e.interval??5e3),this.failure=new uE(e.interval??5e3),this.next=new uE(e.interval??5e3),this.failureMultiplier=e.failureMultiplier??Qwe,this.timeoutMultiplier=e.timeoutMultiplier??Gwe,this.minTimeout=e.minTimeout??Ywe,e.metricName!=null&&(this.metric=(t=e.metrics)==null?void 0:t.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){const t=Math.max(Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier)),this.minTimeout),n=AbortSignal.timeout(t),i=pt([e.signal,n]);return i.start=Date.now(),i.timeout=t,i}cleanUp(e){var n,i;const t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),(n=this.metric)==null||n.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),(i=this.metric)==null||i.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}}class Jwe{constructor(){u(this,"readNext");u(this,"haveNext");u(this,"ended");u(this,"nextResult");this.ended=!1,this.readNext=Le(),this.haveNext=Le()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Le(),e}async throw(e){return this.ended=!0,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Le(),await ln(this.readNext.promise,t==null?void 0:t.signal,t)}}function Xwe(){return new Jwe}let Zwe=class extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}};class e4e extends Error{constructor(t,n){super(t);u(this,"code");this.code=n}}let t4e=class extends e4e{constructor(t){super(t,"ABORT_ERR");u(this,"type");this.type="aborted",this.name="AbortError"}};function r4e(r,e){const t=Xwe();r.sink(t).catch(async o=>{await t.end(o)}),r.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());const i=new Be;return{read:async(o,a)=>{var d,h;(d=a==null?void 0:a.signal)==null||d.throwIfAborted();let c;const l=new Promise((p,m)=>{var f;c=()=>{m(new t4e("Read aborted"))},(f=a==null?void 0:a.signal)==null||f.addEventListener("abort",c)});try{if(o==null){const{done:m,value:f}=await Promise.race([n.next(),l]);return m===!0?new Be:f}for(;i.byteLength<o;){const{value:m,done:f}=await Promise.race([n.next(),l]);if(f===!0)throw new Zwe("unexpected end of input");i.append(m)}const p=i.sublist(0,o);return i.consume(o),p}finally{c!=null&&((h=a==null?void 0:a.signal)==null||h.removeEventListener("abort",c))}},write:async(o,a)=>{var c;(c=a==null?void 0:a.signal)==null||c.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(i.byteLength>0){const o=r.source;r.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield i:yield*i,yield*o}()}return r}}}let n4e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}},i4e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}},s4e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}};function o4e(r,e={}){const t=r4e(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=yt(e.maxDataLength));const n=(e==null?void 0:e.lengthDecoder)??Zi,i=(e==null?void 0:e.lengthEncoder)??Sr;return{read:async o=>{let a=-1;const c=new Be;for(;;){c.append(await t.read(1,o));try{a=n(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new n4e("Invalid message length");if((e==null?void 0:e.maxLengthLength)!=null&&c.byteLength>e.maxLengthLength)throw new s4e("message length length too long");if(a>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&a>e.maxDataLength)throw new i4e("message length too long");return t.read(a,o)},write:async(o,a)=>{await t.write(new Be(i(o.byteLength),o),a)},writeV:async(o,a)=>{const c=new Be(...o.flatMap(l=>[i(l.byteLength),l]));await t.write(c,a)},unwrap:()=>t.unwrap()}}function RB(r,e){const t=o4e(r,e),n={read:async(i,s)=>{const o=await t.read(s);return i.decode(o)},write:async(i,s,o)=>{await t.write(s.encode(i),o)},writeV:async(i,s,o)=>{await t.writeV(i.map(a=>s.encode(a)),o)},pb:i=>({read:async s=>n.read(i,s),write:async(s,o)=>n.write(s,i,o),writeV:async(s,o)=>n.writeV(s,i,o),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}class a4e extends er{constructor(t,n){var i,s,o,a;super();u(this,"log");u(this,"protocol");u(this,"running");u(this,"components");u(this,"timeout");u(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${n.logPrefix}:network`),this.running=!1,this.protocol=n.protocol,this.timeout=new pp({...n.timeout??{},metrics:t.metrics,metricName:`${n.metricsPrefix}_network_message_send_times_milliseconds`}),this.metrics={operations:(i=t.metrics)==null?void 0:i.registerCounterGroup(`${n.metricsPrefix}_outbound_rpc_requests_total`),errors:(s=t.metrics)==null?void 0:s.registerCounterGroup(`${n.metricsPrefix}_outbound_rpc_errors_total`)},this.sendRequest=((o=t.metrics)==null?void 0:o.traceFunction("libp2p.kadDHT.sendRequest",this.sendRequest.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],d){return{...d,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((d,h)=>{l[`providers-${h}`]=d.id.toString()}),c.closer.length>0&&c.closer.forEach((d,h)=>{l[`closer-${h}`]=d.id.toString()})),l)}))??this.sendRequest,this.sendMessage=((a=t.metrics)==null?void 0:a.traceFunction("libp2p.kadDHT.sendMessage",this.sendMessage.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],d){return{...d,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((d,h)=>{l[`providers-${h}`]=d.id.toString()}),c.closer.length>0&&c.closer.forEach((d,h)=>{l[`closer-${h}`]=d.id.toString()})),l)}))??this.sendMessage}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(t,n,i={}){var c,l,d;if(!this.running)return;const s=n.type;if(s==null)throw new Z("Message type was missing");this.log("sending %s to %p",n.type,t),yield SB({peer:t},i),yield vB({to:t,type:s},i);let o;const a=this.timeout.getTimeoutSignal(i);i={...i,signal:a};try{(c=this.metrics.operations)==null||c.increment({[s]:!0}),o=await(await this.components.connectionManager.openConnection(t,i)).newStream(this.protocol,i);const p=await this._writeReadMessage(o,n,i);o.close(i).catch(m=>{this.log.error("error closing stream to %p",t,m),o==null||o.abort(m)}),yield J9({from:t,messageType:p.type,closer:p.closer.map(I3),providers:p.providers.map(I3),record:p.record==null?void 0:Di.deserialize(p.record)},i)}catch(h){(l=this.metrics.errors)==null||l.increment({[s]:!0}),o==null||o.abort(h),((d=i.signal)==null?void 0:d.aborted)!==!0&&this.log.error("could not send %s to %p - %e",n.type,t,h),yield Dc({from:t,error:h},i)}finally{this.timeout.cleanUp(a)}}async*sendMessage(t,n,i={}){var c,l;if(!this.running)return;const s=n.type;if(s==null)throw new Z("Message type was missing");this.log("sending %s to %p",n.type,t),yield SB({peer:t},i),yield vB({to:t,type:s},i);let o;const a=this.timeout.getTimeoutSignal(i);i={...i,signal:a};try{(c=this.metrics.operations)==null||c.increment({[s]:!0}),o=await(await this.components.connectionManager.openConnection(t,i)).newStream(this.protocol,i),await this._writeMessage(o,n,i),o.close(i).catch(h=>{this.log.error("error closing stream to %p",t,h),o==null||o.abort(h)}),yield J9({from:t,messageType:s},i)}catch(d){(l=this.metrics.errors)==null||l.increment({[s]:!0}),o==null||o.abort(d),yield Dc({from:t,error:d},i)}finally{this.timeout.cleanUp(a)}}async _writeMessage(t,n,i){await RB(t).write(n,eu,i)}async _writeReadMessage(t,n,i){const s=RB(t);await s.write(n,eu,i);const o=await s.read(eu,i);return o.closer.forEach(a=>{this.safeDispatchEvent("peer",{detail:I3(a)})}),o.providers.forEach(a=>{this.safeDispatchEvent("peer",{detail:I3(a)})}),o}}function gp(r,e){if(r.byteLength!==e.byteLength)throw new Error("Inputs should have the same length");for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}class dE{constructor(e,t){u(this,"originDhtKey");u(this,"capacity");u(this,"peerDistances");this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peer)}async add(e){const t=await cs(e.id);this.addWithKadId(e,t)}addWithKadId(e,t){if(this.peerDistances.find(s=>s.peer.id.equals(e.id))!=null)return;const n={peer:e,distance:_c(this.originDhtKey,t)};let i=!1;for(let s=0;s<this.peerDistances.length;s++){const o=gp(this.peerDistances[s].distance,n.distance);if(o===0||o===1){i=!0,this.peerDistances.splice(s,0,n);break}}i||this.peerDistances.push(n),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async isCloser(e){if(this.length===0)return!0;const t=await cs(e),n=_c(t,this.originDhtKey),i=this.peerDistances[this.peerDistances.length-1].distance;return gp(n,i)===-1}async anyCloser(e){return e.length===0?!1:Promise.any(e.map(async t=>this.isCloser(t)))}}class c4e{constructor(e,t){u(this,"log");u(this,"routingTable");u(this,"network");u(this,"validators");u(this,"queryManager");u(this,"peerStore");u(this,"peerId");var n,i;this.routingTable=t.routingTable,this.network=t.network,this.validators=t.validators,this.queryManager=t.queryManager,this.peerStore=e.peerStore,this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:peer-routing`),this.findPeer=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.kadDHT.findPeer",this.findPeer.bind(this),{optionsIndex:1}))??this.findPeer,this.getClosestPeers=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.kadDHT.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1}))??this.getClosestPeers}async findPeerLocal(e){let t;const n=await this.routingTable.find(e);if(n!=null){this.log("findPeerLocal found %p in routing table",e);try{t=await this.peerStore.get(n)}catch(i){if(i.name!=="NotFoundError")throw i}}if(t==null)try{t=await this.peerStore.get(e)}catch(i){if(i.name!=="NotFoundError")throw i}if(t!=null)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(i=>i.multiaddr)}}async*_getValueSingle(e,t,n={}){const i={type:Ct.GET_VALUE,key:t};yield*this.network.sendRequest(e,i,n)}async*getPublicKeyFromNode(e,t={}){const n=Owe(e);for await(const i of this._getValueSingle(e,n,t))if(yield i,i.name==="PEER_RESPONSE"&&i.record!=null){const s=_n(i.record.value),o=Fd(s);if(!o.equals(e))throw new d1("public key does not match id");if(o.publicKey==null)throw new d1("public key missing");yield Z9({from:e,value:i.record.value},t)}throw new b3(`Node not responding with its public key: ${e.toString()}`)}async*findPeer(e,t={}){if(this.log("findPeer %p",e),t.useCache!==!1){const i=await this.findPeerLocal(e);if(i!=null){this.log("found local"),yield X9({from:this.peerId,peer:i},t);return}}let n=!1;if(t.useNetwork!==!1){const i=this,s=async function*({peer:o,signal:a}){const c={type:Ct.FIND_NODE,key:e.toMultihash().bytes};for await(const l of i.network.sendRequest(o,c,{...t,signal:a}))if(yield l,l.name==="PEER_RESPONSE"){const d=l.closer.find(h=>h.id.equals(e));d!=null&&(yield X9({from:l.from,peer:d},t))}};for await(const o of this.queryManager.run(e.toMultihash().bytes,s,t))o.name==="FINAL_PEER"&&(n=!0),yield o}n||(yield Dc({from:this.peerId,error:new Zt("Not found")},t))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);const n=await hp(e),i=this.routingTable.closestPeers(n),s=this,o=new dE(n,this.routingTable.kBucketSize);await Promise.all(i.map(async c=>{await o.add({id:c,multiaddrs:[]})}));const a=async function*({peer:c,signal:l}){s.log("closerPeersSingle %s from %p",re(e,"base32"),c);const d={type:Ct.FIND_NODE,key:e};yield*s.network.sendRequest(c,d,{...t,signal:l})};for await(const c of this.queryManager.run(e,a,t))c.name==="PEER_RESPONSE"&&await Promise.all(c.closer.map(async l=>{await o.add(l)})),yield c;this.log("found %d peers close to %b",o.length,e);for(const c of o.peers)yield X9({from:this.peerId,peer:c},t)}async*getValueOrPeers(e,t,n={}){for await(const i of this._getValueSingle(e,t,n)){if(i.name==="PEER_RESPONSE"&&i.record!=null)try{await this._verifyRecordOnline(i.record)}catch{const o="invalid record received, discarded";this.log(o),yield Dc({from:i.from,error:new b3(o)},n);continue}yield i}}async _verifyRecordOnline(e){if(e.timeReceived==null)throw new H3e("invalid record received");await eE(this.validators,new Di(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){const n=[];try{const c=tu(e),l=ti(c),d=await this.peerStore.get(l);n.push({id:d.id,multiaddrs:d.addresses.map(({multiaddr:h})=>h)})}catch{}const i=await hp(e),s=this.routingTable.closestPeers(i),o=await cs(t),a=_c(o,i);for(const c of s){const l=await cs(c),d=_c(l,i);if(gp(d,a)===-1)try{const h=await this.peerStore.get(c);n.push({id:c,multiaddrs:h.addresses.map(({multiaddr:p})=>p)})}catch(h){if(h.name!=="NotFoundError")throw h}}return n.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",n.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p with %d peers in the routing table",e,t,this.routingTable.size),n}}class l4e{constructor(e,t){u(this,"log");u(this,"datastore");u(this,"datastorePrefix");u(this,"lock");this.log=e.logger.forComponent(`${t.logPrefix}:providers`),this.datastorePrefix=`${t.datastorePrefix}/provider`,this.datastore=e.datastore,this.lock=t.lock}async addProvider(e,t){const n=await this.lock.readLock();try{this.log("%p provides %s",t,e),await this.writeProviderEntry(e,t)}finally{n()}}async removeProvider(e,t){const n=await this.lock.writeLock();try{const i=lE(this.datastorePrefix,e,t);this.log("%p no longer provides %s",t,e),await this.datastore.delete(i)}finally{n()}}async getProviders(e){const t=await this.lock.readLock();try{this.log("get providers for %c",e);const n=await this.loadProviders(e);return this.log("got %d providers for %c",n.size,e),[...n.keys()]}finally{t()}}async writeProviderEntry(e,t,n=new Date){const i=lE(this.datastorePrefix,e,t),s=Sr(n.getTime());await this.datastore.put(i,s)}async loadProviders(e){const t=new uc,n=lE(this.datastorePrefix,e);for await(const i of this.datastore.query({prefix:n.toString()})){const{peerId:s}=NB(i.key);t.set(s,MB(i.value))}return t}}async function*u4e(r){const{key:e,startingPeer:t,ourPeerId:n,signal:i,query:s,alpha:o,pathIndex:a,numPaths:c,queryFuncTimeout:l,log:d,peersSeen:h,connectionManager:p}=r,m=new Bl({concurrency:o,sort:(v,y)=>gp(v.options.distance,y.options.distance)}),f=await hp(e);function g(v,y){if(v==null)return;h.add(v);const w=_c(y,f);m.add(async()=>{const b=[i];l!=null&&b.push(AbortSignal.timeout(l));const E=pt(b);try{for await(const A of s({...r,key:e,peer:v,signal:E,pathIndex:a,numPaths:c})){if(E.aborted)return;if(A.name==="PEER_RESPONSE")for(const k of A.closer){if(h.has(k.id)){d.trace("already seen %p in query",k.id);continue}if(n.equals(k.id)){d("not querying ourselves");continue}if(!await p.isDialable(k.multiaddrs)){d("not querying undialable peer");continue}const x=await cs(k.id),I=_c(x,f);if(gp(I,w)!==-1){d.trace("skipping %p as they are not closer to %b than %p",k.id,e,v);continue}d.trace("querying closer peer %p",k.id),g(k.id,x)}m.safeDispatchEvent("completed",{detail:A})}}catch(A){if(!i.aborted)return Dc({from:v,error:A},r)}finally{E.clear()}},{distance:w}).catch(b=>{d.error(b)})}g(t,await cs(t));try{for await(const v of m.toGenerator({signal:i}))v!=null&&(yield v)}catch(v){throw i.aborted?new j3e("Query aborted"):v}}class d4e{constructor(e,t){u(this,"disjointPaths");u(this,"alpha");u(this,"shutDownController");u(this,"running");u(this,"logger");u(this,"peerId");u(this,"connectionManager");u(this,"routingTable");u(this,"initialQuerySelfHasRun");u(this,"logPrefix");this.logPrefix=t.logPrefix,this.disjointPaths=t.disjointPaths??mB,this.alpha=t.alpha??Q9,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.shutDownController=new AbortController,this.shutDownController.signal,this.running=!1}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutDownController=new AbortController,this.shutDownController.signal,void 0)}async stop(){this.running=!1,this.shutDownController.abort()}async*run(e,t,n={}){if(!this.running)throw new Error("QueryManager not started");if(n.signal==null){const c=AbortSignal.timeout(z3e);n={...n,signal:c}}const i=new AbortController,s=pt([this.shutDownController.signal,i.signal,n.signal]);i.signal;const o=this.logger.forComponent(`${this.logPrefix}:query:`+re(e,"base58btc"));let a=!1;try{n.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(o("waiting for initial query-self query before continuing"),await ln(this.initialQuerySelfHasRun.promise,s),this.initialQuerySelfHasRun=void 0),o("query:start");const c=await hp(e),l=this.routingTable.closestPeers(c),d=l.slice(0,Math.min(this.disjointPaths,l.length));if(l.length===0){o.error("Running query with no peers");return}const h=new ts,p=d.map((m,f)=>u4e({...n,key:e,startingPeer:m,ourPeerId:this.peerId,signal:s,query:t,pathIndex:f,numPaths:d.length,alpha:this.alpha,queryFuncTimeout:n.queryFuncTimeout,log:o,peersSeen:h,onProgress:n.onProgress,connectionManager:this.connectionManager}));for await(const m of Oa(...p)){if(m.name==="QUERY_ERROR"&&o.error("query error",m.error),m.name==="PEER_RESPONSE")for(const f of[...m.closer,...m.providers])await this.connectionManager.isDialable(f.multiaddrs)&&await this.routingTable.add(f.id);yield m}a=!0}catch(c){if(!(!this.running&&c.name==="QueryAbortedError"))throw c}finally{a||(o("query exited early"),i.abort()),s.clear(),o("query:done")}}}function h4e(r){return r[Symbol.asyncIterator]!=null}function LB(r){if(h4e(r))return(async()=>{let e=0;for await(const t of r)e++;return e})();{let e=0;for(const t of r)e++;return e}}const f4e=r=>{const e=r.addEventListener||r.on||r.addListener,t=r.removeEventListener||r.off||r.removeListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function p4e(r,e,t){let n;const i=new Promise((s,o)=>{var m;if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");(m=t.signal)==null||m.throwIfAborted();const a=[e].flat(),c=[],{addListener:l,removeListener:d}=f4e(r),h=(...f)=>{const g=t.multiArgs?f:f[0];t.filter&&!t.filter(g)||(c.push(g),t.count===c.length&&(n(),s(c)))},p=f=>{n(),o(f)};n=()=>{for(const f of a)d(f,h);for(const f of t.rejectionEvents)d(f,p)};for(const f of a)l(f,h);for(const f of t.rejectionEvents)l(f,p);t.signal&&t.signal.addEventListener("abort",()=>{p(t.signal.reason)},{once:!0}),t.resolveImmediately&&s(c)});if(i.cancel=n,typeof t.timeout=="number"){const s=jf(i,{milliseconds:t.timeout});return s.cancel=n,s}return i}function g4e(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};const n=p4e(r,e,t),i=n.then(s=>s[0]);return i.cancel=n.cancel,i}class y4e{constructor(e,t){u(this,"log");u(this,"peerId");u(this,"peerRouting");u(this,"routingTable");u(this,"count");u(this,"interval");u(this,"initialInterval");u(this,"queryTimeout");u(this,"running");u(this,"timeoutId");u(this,"controller");u(this,"initialQuerySelfHasRun");u(this,"querySelfPromise");this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:query-self`),this.running=!1,this.peerRouting=t.peerRouting,this.routingTable=t.routingTable,this.count=t.count??mB,this.interval=t.interval??R3e,this.initialInterval=t.initialInterval??L3e,this.queryTimeout=t.queryTimeout??B3e,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.querySelf=OB(this.querySelf.bind(this),t.operationMetrics,"SELF_QUERY")}isStarted(){return this.running}start(){this.running||(this.running=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.initialInterval))}stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}async querySelf(){if(!this.running){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=Le(),this.running){this.controller=new AbortController;const e=[this.controller.signal];if(this.initialQuerySelfHasRun==null){const n=AbortSignal.timeout(this.queryTimeout);e.push(n)}const t=pt(e);this.controller.signal;try{this.routingTable.size===0&&(this.log("routing table was empty, waiting for some peers before running query"),await g4e(this.routingTable,"peer:add",{signal:t,filter:s=>!this.peerId.equals(s.detail)}),this.log("routing table has peers, continuing with query")),this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);const n=Date.now(),i=await un(this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes,{signal:t,isSelfQuery:!0}),s=>gy(s,this.count),async s=>LB(s));this.log("self-query found %d peers in %dms",i,Date.now()-n)}catch(n){this.log.error("self-query error",n)}finally{t.clear(),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.running&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.interval))}}class m4e extends er{constructor(t,n){super();u(this,"log");u(this,"reprovideQueue");u(this,"maxQueueSize");u(this,"datastore");u(this,"timeout");u(this,"reprovideTimeout");u(this,"running");u(this,"shutdownController");u(this,"reprovideThreshold");u(this,"contentRouting");u(this,"datastorePrefix");u(this,"addressManager");u(this,"validity");u(this,"interval");u(this,"lock");u(this,"peerId");this.log=t.logger.forComponent(`${n.logPrefix}:reprovider`),this.peerId=t.peerId,this.reprovideQueue=new Bl({concurrency:n.concurrency??N3e,metrics:t.metrics,metricName:`${n.metricsPrefix}_reprovide_queue`}),this.reprovideTimeout=new pp({...n.timeout??{},metrics:t.metrics,metricName:`${n.metricsPrefix}_reprovide_timeout_milliseconds`}),this.datastore=t.datastore,this.addressManager=t.addressManager,this.datastorePrefix=`${n.datastorePrefix}/provider`,this.reprovideThreshold=n.threshold??$3e,this.maxQueueSize=n.maxQueueSize??M3e,this.validity=n.validity??D3e,this.interval=n.interval??O3e,this.contentRouting=n.contentRouting,this.lock=n.lock,this.running=!1,this.reprovide=OB(this.reprovide.bind(this),n.operationMetrics,"PROVIDE")}start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,this.timeout=setTimeout(()=>{this.cleanUp().catch(t=>{this.log.error("error running reprovide/cleanup - %e",t)})},this.interval))}stop(){var t;this.running=!1,this.reprovideQueue.clear(),clearTimeout(this.timeout),(t=this.shutdownController)==null||t.abort()}async cleanUp(){const t=await this.lock.writeLock();try{this.safeDispatchEvent("reprovide:start");for await(const n of this.datastore.query({prefix:this.datastorePrefix}))try{const{cid:i,peerId:s}=NB(n.key),o=MB(n.value).getTime(),a=o+this.validity,c=Date.now(),l=c>a;this.log.trace("comparing: %d < %d = %s %s",o,c-this.validity,l,l?"(expired)":""),l&&await this.datastore.delete(n.key),this.peerId.equals(s)&&c-a<this.reprovideThreshold&&this.queueReprovide(i).catch(d=>{this.log.error("could not reprovide %c - %e",i,d)})}catch(i){this.log.error("error processing datastore key %s - %e",n.key,i.message)}this.log("reprovide/cleanup successful")}finally{t(),this.safeDispatchEvent("reprovide:end"),this.running&&(this.timeout=setTimeout(()=>{this.cleanUp().catch(n=>{this.log.error("error running re-provide - %e",n)})},this.interval))}}async queueReprovide(t){var i;if(!this.running)return;this.log.trace("waiting for queue capacity before adding %c to re-provide queue",t),await this.reprovideQueue.onSizeLessThan(this.maxQueueSize);const n=this.reprovideQueue.queue.find(s=>s.options.cid.equals(t));if(n!=null)return this.log.trace("not adding %c to re-provide queue - already in queue",t),n.join();this.log.trace("adding %c to re-provide queue",t),this.reprovideQueue.add(async s=>{var a;if((a=s.signal)==null||a.throwIfAborted(),!this.running)return;this.log.trace("re-providing %c",t);const o=this.reprovideTimeout.getTimeoutSignal(s);try{await this.reprovide(s.cid,s)}finally{this.reprovideTimeout.cleanUp(o)}this.log.trace("re-provided %c",t)},{signal:(i=this.shutdownController)==null?void 0:i.signal,cid:t}).catch(s=>{this.log.error("could not re-provide key %c - %e",t,s)})}async reprovide(t,n){await Eo(this.contentRouting.provide(t,this.addressManager.getAddresses(),n))}}const w4e=20,b4e=5e3,v4e="kad-close",E4e=50;class S4e{constructor(e,t){u(this,"routingTable");u(this,"components");u(this,"closestPeers");u(this,"newPeers");u(this,"refreshInterval");u(this,"peerSetSize");u(this,"timeout");u(this,"closeTagName");u(this,"closeTagValue");u(this,"log");u(this,"running");this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.routingTable=t.routingTable,this.refreshInterval=t.refreshInterval??b4e,this.peerSetSize=t.peerSetSize??w4e,this.closeTagName=t.closeTagName??v4e,this.closeTagValue=t.closeTagValue??E4e,this.closestPeers=new ts,this.onPeerPing=this.onPeerPing.bind(this),this.running=!1}async start(){if(this.running)return;this.running=!0;const e=await cs(this.components.peerId);this.newPeers=new dE(e,this.peerSetSize),this.routingTable.addEventListener("peer:ping",this.onPeerPing),this.timeout=setInterval(()=>{this.updatePeerTags().catch(t=>{this.log.error("error updating peer tags - %e",t)})},this.refreshInterval)}stop(){this.running=!1,this.routingTable.removeEventListener("peer:ping",this.onPeerPing),clearTimeout(this.timeout)}onPeerPing(e){var t;(t=this.newPeers)==null||t.add({id:e.detail,multiaddrs:[]}).catch(n=>{this.log.error("error adding peer to distance list - %e",n)})}async updatePeerTags(){var i;const e=new ts((i=this.newPeers)==null?void 0:i.peers.map(s=>s.id)),t=e.difference(this.closestPeers),n=this.closestPeers.difference(e);this.closestPeers=e,await Promise.all([...[...t].map(async s=>{await this.components.peerStore.merge(s,{tags:{[this.closeTagName]:{value:this.closeTagValue},[wB]:{value:1}}})}),...[...n].map(async s=>{await this.components.peerStore.merge(s,{tags:{[this.closeTagName]:void 0,[wB]:void 0}})})])}}function k3(r){return Array.isArray(r==null?void 0:r.peers)}class x4e{constructor(e){u(this,"root");u(this,"localPeer");u(this,"prefixLength");u(this,"splitThreshold");u(this,"kBucketSize");u(this,"numberOfNodesToPing");u(this,"lastPingThreshold");u(this,"ping");u(this,"verify");u(this,"onAdd");u(this,"onRemove");u(this,"onMove");u(this,"addingPeerMap");this.prefixLength=e.prefixLength??I4e,this.kBucketSize=e.kBucketSize??BB,this.splitThreshold=e.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=e.numberOfOldContactsToPing??T4e,this.lastPingThreshold=e.lastPingThreshold??N4e,this.ping=e.ping,this.verify=e.verify,this.onAdd=e.onAdd,this.onRemove=e.onRemove,this.addingPeerMap=new uc,this.root={prefix:"",depth:0,peers:[]}}async addSelfPeer(e){this.localPeer={peerId:e,kadId:await cs(e),lastPing:Date.now()}}async add(e,t){const n={peerId:e,kadId:await cs(e),lastPing:0},i=this.addingPeerMap.get(e);if(i!=null)return i;try{const s=this._add(n,t);this.addingPeerMap.set(e,s),await s}finally{this.addingPeerMap.delete(e)}}async _add(e,t){var o;const n=this._determineBucket(e.kadId);if(this._indexOf(n,e.kadId)>-1)return;if(n.peers.length===this.splitThreshold&&n.depth<this.prefixLength){await this._split(n),await this._add(e,t);return}if(n.peers.length<this.kBucketSize){if(!C4e(e,this.lastPingThreshold)){n.peers.push(e),await((o=this.onAdd)==null?void 0:o.call(this,e,n));return}await this.verify(e,t)&&(e.lastPing=Date.now(),await this._add(e,t));return}const i=n.peers.filter(a=>{var c;return!(a.peerId.equals((c=this.localPeer)==null?void 0:c.peerId)||a.lastPing>Date.now()-this.lastPingThreshold)}).sort((a,c)=>a.lastPing<c.lastPing?-1:a.lastPing>c.lastPing?1:0).slice(0,this.numberOfNodesToPing);let s=!1;for await(const a of this.ping(i,t))s=!0,await this.remove(a.kadId);s&&await this._add(e,t)}*closest(e,t=this.kBucketSize){const n=new dE(e,t);for(const i of this.toIterable())n.addWithKadId({id:i.peerId,multiaddrs:[]},i.kadId);yield*Ud(n.peers,i=>i.id)}count(){function e(t){if(k3(t))return t.peers.length;let n=0;return t.left!=null&&(n+=e(t.left)),t.right!=null&&(n+=e(t.right)),n}return e(this.root)}get(e){const t=this._determineBucket(e),n=this._indexOf(t,e);return t.peers[n]}async remove(e){var i;const t=this._determineBucket(e),n=this._indexOf(t,e);if(n>-1){const s=t.peers.splice(n,1)[0];await((i=this.onRemove)==null?void 0:i.call(this,s,t))}}*toIterable(){function*e(t){if(k3(t)){yield*t.peers;return}yield*e(t.left),yield*e(t.right)}yield*e(this.root)}distance(e,t){return BigInt("0x"+re(_c(e,t),"base16"))}_determineBucket(e){const t=re(e,"base2");function n(i,s=0){return k3(i)?i:t[s]==="0"?n(i.left,s+1):n(i.right,s+1)}return n(this.root)}_indexOf(e,t){return e.peers.findIndex(n=>qe(n.kadId,t))}async _split(e){var i,s;const t={prefix:"0",depth:e.depth+1,peers:[]},n={prefix:"1",depth:e.depth+1,peers:[]};for(const o of e.peers)re(o.kadId,"base2")[e.depth]==="0"?(t.peers.push(o),await((i=this.onMove)==null?void 0:i.call(this,o,e,t))):(n.peers.push(o),await((s=this.onMove)==null?void 0:s.call(this,o,e,n)));A4e(e,t,n)}}function A4e(r,e,t){return delete r.peers,r.left=e,r.right=t,r.prefix===""&&(delete r.depth,delete r.prefix),!0}function C4e(r,e){return r.lastPing<Date.now()-e}const BB=20,I4e=6,k4e=20,_4e=100,T4e=3,P4e=20,D4e=100,UB="kad-peer",$4e=1,N4e=6e5,M4e=!0,O4e=1e3;class R4e extends er{constructor(t,n){super();u(this,"kBucketSize");u(this,"kb");u(this,"network");u(this,"closestPeerTagger");u(this,"log");u(this,"components");u(this,"running");u(this,"pingNewContactTimeout");u(this,"pingNewContactQueue");u(this,"pingOldContactTimeout");u(this,"pingOldContactQueue");u(this,"populateFromDatastoreOnStart");u(this,"populateFromDatastoreLimit");u(this,"protocol");u(this,"peerTagName");u(this,"peerTagValue");u(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${n.logPrefix}:routing-table`),this.kBucketSize=n.kBucketSize??BB,this.running=!1,this.protocol=n.protocol,this.network=n.network,this.peerTagName=n.peerTagName??UB,this.peerTagValue=n.peerTagValue??$4e,this.pingOldContacts=this.pingOldContacts.bind(this),this.verifyNewContact=this.verifyNewContact.bind(this),this.peerAdded=this.peerAdded.bind(this),this.peerRemoved=this.peerRemoved.bind(this),this.populateFromDatastoreOnStart=n.populateFromDatastoreOnStart??M4e,this.populateFromDatastoreLimit=n.populateFromDatastoreLimit??O4e,this.pingOldContactQueue=new lc({concurrency:n.pingOldContactConcurrency??P4e,metricName:`${n.metricsPrefix}_ping_old_contact_queue`,metrics:this.components.metrics,maxSize:n.pingOldContactMaxQueueSize??D4e}),this.pingOldContactTimeout=new pp({...n.pingOldContactTimeout??{},metrics:this.components.metrics,metricName:`${n.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`}),this.pingNewContactQueue=new lc({concurrency:n.pingNewContactConcurrency??k4e,metricName:`${n.metricsPrefix}_ping_new_contact_queue`,metrics:this.components.metrics,maxSize:n.pingNewContactMaxQueueSize??_4e}),this.pingNewContactTimeout=new pp({...n.pingNewContactTimeout??{},metrics:this.components.metrics,metricName:`${n.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`}),this.kb=new x4e({kBucketSize:n.kBucketSize,prefixLength:n.prefixLength,splitThreshold:n.splitThreshold,numberOfOldContactsToPing:n.numberOfOldContactsToPing,lastPingThreshold:n.lastPingThreshold,ping:this.pingOldContacts,verify:this.verifyNewContact,onAdd:this.peerAdded,onRemove:this.peerRemoved}),this.closestPeerTagger=new S4e(this.components,{logPrefix:n.logPrefix,routingTable:this,peerSetSize:n.closestPeerSetSize,refreshInterval:n.closestPeerSetRefreshInterval,closeTagName:n.closeTagName,closeTagValue:n.closeTagValue}),this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMinOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),routingTableKadBucketMaxOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_max_depth`),kadBucketEvents:this.components.metrics.registerCounterGroup(`${n.metricsPrefix}_kad_bucket_events_total`)})}isStarted(){return this.running}async start(){this.running||(this.running=!0,await ko(this.closestPeerTagger),await this.kb.addSelfPeer(this.components.peerId))}async afterStart(){Promise.resolve().then(async()=>{if(!this.populateFromDatastoreOnStart)return;let t=0;for(const n of await this.components.peerStore.all({filters:[i=>i.protocols.includes(this.protocol)&&i.tags.has(UB)],limit:this.populateFromDatastoreLimit})){if(!this.running)return;try{await this.add(n.id),t++}catch{this.log("failed to add peer %p to routing table, removing kad-dht peer tags - %e"),await this.components.peerStore.merge(n.id,{tags:{[this.peerTagName]:void 0}})}}this.log("added %d peer store peers to the routing table",t)}).catch(t=>{this.log.error("error adding peer store peers to the routing table %e",t)})}async stop(){this.running=!1,await Ga(this.closestPeerTagger),this.pingOldContactQueue.abort(),this.pingNewContactQueue.abort()}async peerAdded(t,n){var i;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:{value:this.peerTagValue}}}),this.updateMetrics(),(i=this.metrics)==null||i.kadBucketEvents.increment({peer_added:!0}),this.safeDispatchEvent("peer:add",{detail:t.peerId})}async peerRemoved(t,n){var i;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:void 0}}),this.updateMetrics(),(i=this.metrics)==null||i.kadBucketEvents.increment({peer_removed:!0}),this.safeDispatchEvent("peer:remove",{detail:t.peerId})}async*pingOldContacts(t,n){var s;if(!this.running)return;const i=[];for(const o of t){if(this.kb.get(o.kadId)==null){this.log("asked to ping contact %p that was not in routing table",o.peerId);continue}(s=this.metrics)==null||s.kadBucketEvents.increment({ping_old_contact:!0}),i.push(async()=>{const a=this.pingOldContactQueue.find(o.peerId);if(a!=null)return this.log("asked to ping contact %p was already being pinged",o.peerId),await a.join(n)?void 0:o;if(!await this.pingOldContactQueue.add(async l=>{var p;const d=this.pingOldContactTimeout.getTimeoutSignal(),h=pt([d,l==null?void 0:l.signal]);try{return await this.pingContact(o,l)}catch{return(p=this.metrics)==null||p.kadBucketEvents.increment({ping_old_contact_error:!0}),!0}finally{this.pingOldContactTimeout.cleanUp(d),h.clear()}},{peerId:o.peerId,signal:n==null?void 0:n.signal}))return o})}for await(const o of lp(i))o!=null&&(yield o)}async verifyNewContact(t,n){var o;const i=this.pingNewContactTimeout.getTimeoutSignal(),s=pt([i,n==null?void 0:n.signal]);try{const a=this.pingNewContactQueue.find(t.peerId);return a!=null?(this.log("joining existing ping to add new peer %p to routing table",t.peerId),await a.join({signal:s})):await this.pingNewContactQueue.add(async c=>{var l;return(l=this.metrics)==null||l.kadBucketEvents.increment({ping_new_contact:!0}),this.log("pinging new peer %p before adding to routing table",t.peerId),this.pingContact(t,c)},{peerId:t.peerId,signal:s})}catch{return this.log.trace("tried to add peer %p but they were not online",t.peerId),(o=this.metrics)==null||o.kadBucketEvents.increment({ping_new_contact_error:!0}),!1}finally{this.pingNewContactTimeout.cleanUp(i),s.clear()}}async pingContact(t,n){try{this.log("pinging contact %p",t.peerId);for await(const i of this.network.sendRequest(t.peerId,{type:Ct.PING},n))if(i.type===hE.PEER_RESPONSE)return i.messageType===Ct.PING?(this.log("contact %p ping ok",t.peerId),this.safeDispatchEvent("peer:ping",{detail:t.peerId}),!0):!1;return!1}catch(i){return this.log("error pinging old contact %p - %e",t.peerId,i),!1}}get size(){return this.kb==null?0:this.kb.count()}async find(t){var i;const n=await cs(t);return(i=this.kb.get(n))==null?void 0:i.peerId}closestPeer(t){const n=this.closestPeers(t,1);if(n.length>0)return n[0]}closestPeers(t,n=this.kBucketSize){return this.kb==null?[]:[...this.kb.closest(t,n)]}async add(t,n){if(this.kb==null)throw new Error("RoutingTable is not started");await this.kb.add(t,n)}async remove(t){if(this.kb==null)throw new Error("RoutingTable is not started");const n=await cs(t);await this.kb.remove(n)}updateMetrics(){if(this.metrics==null||this.kb==null)return;let t=0,n=0,i=0,s=20,o=0;function a(c){if(k3(c)){c.depth>i&&(i=c.depth),n++,t+=c.peers.length,c.peers.length<s&&(s=c.peers.length),c.peers.length>o&&(o=c.peers.length);return}a(c.left),a(c.right)}a(this.kb.root),this.metrics.routingTableSize.update(t),this.metrics.routingTableKadBucketTotal.update(n),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(t/n)),this.metrics.routingTableKadBucketMinOccupancy.update(s),this.metrics.routingTableKadBucketMaxOccupancy.update(o),this.metrics.routingTableKadBucketMaxDepth.update(i)}}const L4e=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],_3=15;class B4e{constructor(e,t){u(this,"log");u(this,"peerRouting");u(this,"routingTable");u(this,"refreshInterval");u(this,"refreshQueryTimeout");u(this,"commonPrefixLengthRefreshedAt");u(this,"refreshTimeoutId");const{peerRouting:n,routingTable:i,refreshInterval:s,refreshQueryTimeout:o,logPrefix:a}=t;this.log=e.logger.forComponent(`${a}:routing-table:refresh`),this.peerRouting=n,this.routingTable=i,this.refreshInterval=s??U3e,this.refreshQueryTimeout=o??F3e,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async afterStart(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");const t=this._maxCommonPrefix(),n=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${n.map(i=>i.toISOString()).join(", ")} ]`),Promise.all(n.map(async(i,s)=>{try{if(await this._refreshCommonPrefixLength(s,i,e),this._numPeersForCpl(t)===0){const o=Math.min(2*(s+1),n.length-1);for(let a=s+1;a<o+1;a++)try{await this._refreshCommonPrefixLength(a,i,e)}catch(c){this.log.error(c)}}}catch(o){this.log.error(o)}})).catch(i=>{this.log.error(i)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(i=>{this.log.error(i)})}async _refreshCommonPrefixLength(e,t,n){if(!n&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}const i=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,i,this.routingTable.size);const s=AbortSignal.timeout(this.refreshQueryTimeout),o=await LB(this.peerRouting.getClosestPeers(i.toMultihash().bytes,{signal:s}));this.log(`found ${o} peers that were close to imaginary peer %p`,i),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,i,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(e){e>_3&&(e=_3);const t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}async _generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");if(this.routingTable.kb.localPeer==null)throw new Error("Local peer not set");const t=ic(2),n=(t[1]<<8)+t[0],i=await this._makePeerId(this.routingTable.kb.localPeer.kadId,n,e),s=tu(i);return ti(s)}async _makePeerId(e,t,n){if(n>_3)throw new Error(`Cannot generate peer ID for common prefix length greater than ${_3}`);const o=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>n,a=65535<<16-(n+1),c=o&a|t&~a,l=L4e[c],d=new ArrayBuffer(34),h=new DataView(d,0,d.byteLength);return h.setUint8(0,DB.code),h.setUint8(1,32),h.setUint32(2,l,!1),new Uint8Array(h.buffer,h.byteOffset,h.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){var e;if(((e=this.routingTable.kb)==null?void 0:e.localPeer)!=null)for(const{kadId:t}of this.routingTable.kb.toIterable()){const n=_c(this.routingTable.kb.localPeer.kadId,t);let i=0;for(const s of n)if(s===0)i++;else break;yield i}}}class U4e{constructor(e,t){u(this,"peerId");u(this,"providers");u(this,"peerStore");u(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:add-provider`),this.peerId=e.peerId,this.providers=t.providers,this.peerStore=e.peerStore}async handle(e,t){if(t.key==null||t.key.length===0)throw new Et("Missing key");let n;try{n=cE.decode(t.key)}catch{throw new Et("Invalid CID")}(t.providers==null||t.providers.length===0)&&this.log.error("no providers found in message"),this.log("%p asked us, %p to store provider record for for %c",e,this.peerId,n),await Promise.all(t.providers.map(async i=>{const s=tu(i.id),o=ti(s),a=i.multiaddrs.map(c=>Re(c));if(!e.equals(o)){this.log("invalid provider peer %p from %p",i.id,e);return}if(i.multiaddrs.length<1){this.log("no valid addresses for provider %p. Ignore",e);return}this.log.trace("received provider %p for %s (addrs %s)",e,n,a),await this.providers.addProvider(n,o),await this.peerStore.merge(o,{multiaddrs:a})}))}}class F4e{constructor(e,t){u(this,"peerRouting");u(this,"peerInfoMapper");u(this,"peerId");u(this,"addressManager");u(this,"log");const{peerRouting:n,logPrefix:i}=t;this.log=e.logger.forComponent(`${i}:rpc:handlers:find-node`),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=n,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(this.log("incoming request from %p for peers closer to %b",e,t.key),t.key==null)throw new Et("Invalid FIND_NODE message received - key was missing");const n=await this.peerRouting.getCloserPeersOffline(t.key,e);qe(this.peerId.toMultihash().bytes,t.key)&&n.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(s=>s.decapsulateCode(ze("p2p").code))});const i={type:Ct.FIND_NODE,clusterLevel:t.clusterLevel,closer:n.map(this.peerInfoMapper).filter(({multiaddrs:s})=>s.length).map(s=>({id:s.id.toMultihash().bytes,multiaddrs:s.multiaddrs.map(o=>o.bytes)})),providers:[]};return i.closer.length===0&&this.log("could not find any peers closer to %b than %p",t.key,e),i}}class z4e{constructor(e,t){u(this,"peerId");u(this,"peerRouting");u(this,"providers");u(this,"peerStore");u(this,"peerInfoMapper");u(this,"log");const{peerRouting:n,providers:i,logPrefix:s}=t;this.log=e.logger.forComponent(`${s}:rpc:handlers:get-providers`),this.peerId=e.peerId,this.peerStore=e.peerStore,this.peerRouting=n,this.providers=i,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(t.key==null)throw new Et("Invalid GET_PROVIDERS message received - key was missing");let n;try{n=cE.decode(t.key)}catch{throw new Et("Invalid CID")}this.log("%p asking for providers for %s",e,n);const[i,s]=await Promise.all([Gm(Ud(await this.providers.getProviders(n),async a=>{const c=await this.peerStore.get(a);return{id:c.id,multiaddrs:c.addresses.map(({multiaddr:d})=>d)}})),this.peerRouting.getCloserPeersOffline(t.key,this.peerId)]),o={type:Ct.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:s.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)})),providers:i.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))};return this.log("got %s providers %s closerPeers",o.providers.length,o.closer.length),o}async _getAddresses(e){return[]}}class V4e{constructor(e,t){u(this,"peerStore");u(this,"datastore");u(this,"peerRouting");u(this,"log");u(this,"datastorePrefix");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:get-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}async handle(e,t){const n=t.key;if(this.log("%p asked for key %b",e,n),n==null||n.length===0)throw new Et("Invalid key");const i={type:Ct.GET_VALUE,key:n,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(Rwe(n)){this.log("is public key");const a=Lwe(n);let c;try{const l=await this.peerStore.get(a);if(l.id.publicKey==null)throw new Zt("No public key found in key book");c=_i(l.id.publicKey)}catch(l){if(l.name!=="NotFoundError")throw l}if(c!=null)return this.log("returning found public key"),i.record=new Di(n,c,new Date).serialize(),i}const[s,o]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getCloserPeersOffline(n,e)]);return s!=null&&(this.log("had record for %b in local datastore",n),i.record=s.serialize()),o.length>0&&(this.log("had %s closer peers in routing table",o.length),i.closer=o.map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))),i}async _checkLocalDatastore(e){this.log("checkLocalDatastore looking for %b",e);const t=fp(this.datastorePrefix,e);let n;try{n=await this.datastore.get(t)}catch(s){if(s.name==="NotFoundError")return;throw s}const i=Di.deserialize(n);if(i.timeReceived==null||Date.now()-i.timeReceived.getTime()>T3e){await this.datastore.delete(t);return}return i}}class K4e{constructor(e,t){u(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:ping`)}async handle(e,t){return this.log("ping from %p",e),t}}class j4e{constructor(e,t){u(this,"components");u(this,"validators");u(this,"log");u(this,"datastorePrefix");const{validators:n}=t;this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:put-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n}async handle(e,t){const n=t.key;if(this.log("%p asked us to store value for key %b",e,n),t.record==null){const i=`Empty record from: ${e.toString()}`;throw this.log.error(i),new Et(i)}try{const i=Di.deserialize(t.record);await eE(this.validators,i),i.timeReceived=new Date;const s=fp(this.datastorePrefix,i.key);await this.components.datastore.put(s,i.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,s)}catch(i){this.log("did not put record for key %b into datastore %o",n,i)}return t}}let H4e=class{constructor(e,t){u(this,"handlers");u(this,"routingTable");u(this,"log");u(this,"metrics");var n,i;this.metrics={operations:(n=e.metrics)==null?void 0:n.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_requests_total`),errors:(i=e.metrics)==null?void 0:i.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_errors_total`)},this.log=e.logger.forComponent(`${t.logPrefix}:rpc`),this.routingTable=t.routingTable,this.handlers={[Ct.GET_VALUE.toString()]:new V4e(e,t),[Ct.PUT_VALUE.toString()]:new j4e(e,t),[Ct.FIND_NODE.toString()]:new F4e(e,t),[Ct.ADD_PROVIDER.toString()]:new U4e(e,t),[Ct.GET_PROVIDERS.toString()]:new z4e(e,t),[Ct.PING.toString()]:new K4e(e,t)}}async handleMessage(e,t){var i,s;const n=this.handlers[t.type];if(n==null){this.log.error(`no handler found for message type: ${t.type}`);return}try{return(i=this.metrics.operations)==null||i.increment({[t.type]:!0}),await n.handle(e,t)}catch{(s=this.metrics.errors)==null||s.increment({[t.type]:!0})}}onIncomingStream(e){let t="unknown";Promise.resolve().then(async()=>{const{stream:n,connection:i}=e,s=i.remotePeer,o=this;await un(n,a=>Bd(a),async function*(a){for await(const c of a){const l=eu.decode(c);t=l.type,o.log("incoming %s from %p",l.type,s);const d=await o.handleMessage(s,l);d!=null&&(yield eu.encode(d))}},a=>Ld(a),n)}).catch(n=>{this.log.error("error handling %s RPC message from %p - %e",t,e.connection.remotePeer,n)})}};class q4e extends er{constructor(t,n){super();u(this,"log");u(this,"components");u(this,"protocol");u(this,"running");u(this,"registrarId");const{protocol:i,logPrefix:s}=n;this.components=t,this.log=t.logger.forComponent(`${s}:topology-listener`),this.running=!1,this.protocol=i}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:t=>{this.log("observed peer %p with protocol %s",t,this.protocol),this.dispatchEvent(new CustomEvent("peer",{detail:t}))}}))}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class W4e{constructor(e){u(this,"dht");this.dht=e}async provide(e,t={}){await Eo(this.dht.provide(e,t))}async cancelReprovide(e){await this.dht.cancelReprovide(e)}async*findProviders(e,t={}){for await(const n of this.dht.findProviders(e,t))n.name==="PROVIDER"&&(yield*n.providers)}async put(e,t,n){await Eo(this.dht.put(e,t,n))}async get(e,t){for await(const n of this.dht.get(e,t))if(n.name==="VALUE")return n.value;throw new Zt("Could not find value for key")}}class G4e{constructor(e){u(this,"dht");this.dht=e}async findPeer(e,t={}){for await(const n of this.dht.findPeer(e,t))if(n.name==="FINAL_PEER")return n.peer;throw new Zt("Peer not found")}async*getClosestPeers(e,t={}){for await(const n of this.dht.getClosestPeers(e,t))n.name==="FINAL_PEER"&&(yield n.peer)}}const Q4e=32,Y4e=64;class J4e extends er{constructor(t,n={}){var d,h,p,m;super();u(this,"protocol");u(this,"routingTable");u(this,"providers");u(this,"network");u(this,"peerRouting");u(this,"components");u(this,"log");u(this,"running");u(this,"kBucketSize");u(this,"clientMode");u(this,"validators");u(this,"selectors");u(this,"queryManager");u(this,"contentFetching");u(this,"contentRouting");u(this,"routingTableRefresh");u(this,"rpc");u(this,"topologyListener");u(this,"querySelf");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"dhtContentRouting");u(this,"dhtPeerRouting");u(this,"peerInfoMapper");u(this,"reprovider");u(this,cH,"@libp2p/kad-dht");u(this,aH,["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery"]);u(this,oH,["@libp2p/identify"]);const i=n.logPrefix??"libp2p:kad-dht",s=n.datastorePrefix??"/dht",o=n.metricsPrefix??"libp2p_kad_dht",a={queries:(d=t.metrics)==null?void 0:d.registerMetricGroup(`${o}_operations_total`,{label:"operation"}),errors:(h=t.metrics)==null?void 0:h.registerCounterGroup(`${o}_operation_errors_total`,{label:"operation"}),queryTime:(p=t.metrics)==null?void 0:p.registerMetricGroup(`${o}_operation_time_seconds`,{label:"operation"}),errorTime:(m=t.metrics)==null?void 0:m.registerMetricGroup(`${o}_operation_error_time_seconds`,{label:"operation"})};this.running=!1,this.components=t,this.log=t.logger.forComponent(i),this.protocol=n.protocol??P3e,this.kBucketSize=n.kBucketSize??20,this.clientMode=n.clientMode??!0,this.maxInboundStreams=n.maxInboundStreams??Q4e,this.maxOutboundStreams=n.maxOutboundStreams??Y4e,this.peerInfoMapper=n.peerInfoMapper??Mwe;const c=l7();this.providers=new l4e(t,{...n.providers,logPrefix:i,datastorePrefix:s,lock:c}),this.validators={...Y3e,...n.validators},this.selectors={...Q3e,...n.selectors},this.network=new a4e(t,{protocol:this.protocol,logPrefix:i,metricsPrefix:o}),this.routingTable=new R4e(t,{kBucketSize:n.kBucketSize,pingOldContactTimeout:n.pingOldContactTimeout,pingOldContactConcurrency:n.pingOldContactConcurrency,pingOldContactMaxQueueSize:n.pingOldContactMaxQueueSize,pingNewContactTimeout:n.pingNewContactTimeout,pingNewContactConcurrency:n.pingNewContactConcurrency,pingNewContactMaxQueueSize:n.pingNewContactMaxQueueSize,protocol:this.protocol,logPrefix:i,metricsPrefix:o,prefixLength:n.prefixLength,splitThreshold:n.kBucketSplitThreshold,network:this.network});const l=Le();n.allowQueryWithZeroPeers===!0&&l.resolve(),this.queryManager=new d4e(t,{disjointPaths:Math.ceil(this.kBucketSize/2),logPrefix:i,metricsPrefix:o,initialQuerySelfHasRun:l,routingTable:this.routingTable}),this.peerRouting=new c4e(t,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:i}),this.contentFetching=new Hwe(t,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:i,datastorePrefix:s}),this.contentRouting=new Wwe(t,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:i}),this.routingTableRefresh=new B4e(t,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:i}),this.rpc=new H4e(t,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:i,metricsPrefix:o,datastorePrefix:s,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new q4e(t,{protocol:this.protocol,logPrefix:i}),this.querySelf=new y4e(t,{peerRouting:this.peerRouting,interval:n.querySelfInterval,initialInterval:n.initialQuerySelfInterval,logPrefix:i,initialQuerySelfHasRun:l,routingTable:this.routingTable,operationMetrics:a}),this.reprovider=new m4e(t,{...n.reprovide,logPrefix:i,metricsPrefix:o,datastorePrefix:s,contentRouting:this.contentRouting,lock:c,operationMetrics:a}),this.network.addEventListener("peer",f=>{const g=f.detail;this.onPeerConnect(g).catch(v=>{this.log.error("could not add %p to routing table",g.id,v)}),this.dispatchEvent(new CustomEvent("peer",{detail:g}))}),this.topologyListener.addEventListener("peer",f=>{const g=f.detail;Promise.resolve().then(async()=>{const v=await this.components.peerStore.get(g),y={id:g,multiaddrs:v.addresses.map(({multiaddr:w})=>w),protocols:v.protocols};await this.onPeerConnect(y)}).catch(v=>{this.log.error("could not add %p to routing table - %e",g,v)})}),this.dhtPeerRouting=new G4e(this),this.dhtContentRouting=new W4e(this),n.clientMode==null&&t.events.addEventListener("self:peer:update",f=>{this.log("received update of self-peer info"),Promise.resolve().then(async()=>{const g=f.detail.peer.addresses.some(({multiaddr:y})=>jwe(y)),v=this.getMode();g&&v==="client"?await this.setMode("server"):v==="server"&&!g&&await this.setMode("client")}).catch(g=>{this.log.error("error setting dht server mode",g)})}),this.get=ch(this.get.bind(this),a,"GET_VALUE"),this.findProviders=ch(this.findProviders.bind(this),a,"FIND_PROVIDERS"),this.findPeer=ch(this.findPeer.bind(this),a,"FIND_PEER"),this.getClosestPeers=ch(this.getClosestPeers.bind(this),a,"GET_CLOSEST_PEERS"),this.provide=ch(this.provide.bind(this),a,"PROVIDE"),this.put=ch(this.put.bind(this),a,"PUT_VALUE")}get[(cH=Symbol.toStringTag,aH=dr,oH=Qa,Ed)](){return this.dhtContentRouting}get[Sd](){return this.dhtPeerRouting}get[I2](){return this}async onPeerConnect(t){if(this.log.trace("peer %p connected",t.id),t=this.peerInfoMapper(t),t.multiaddrs.length===0){this.log.trace("ignoring %p as there were no valid addresses in %s after filtering",t.id,t.multiaddrs.map(n=>n.toString()));return}try{await this.routingTable.add(t.id)}catch(n){this.log.error("could not add %p to routing table",t.id,n)}}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(t,n=!1){if(t===this.getMode()&&!n){this.log("already in %s mode",t);return}if(await this.components.registrar.unhandle(this.protocol),t===this.getMode()&&!n){this.log("already in %s mode",t);return}t==="client"?(this.log("enabling client mode while in %s mode",this.getMode()),this.clientMode=!0):(this.log("enabling server mode while in %s mode",this.getMode()),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running||(this.running=!0,await this.setMode(this.clientMode?"client":"server",!0),await ko(this.routingTable,this.queryManager,this.network,this.topologyListener,this.routingTableRefresh,this.reprovider),await ko(this.querySelf))}async stop(){this.running=!1,await Ga(this.querySelf,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener,this.reprovider)}async*put(t,n,i={}){yield*this.contentFetching.put(t,n,i)}async*get(t,n={}){yield*this.contentFetching.get(t,n)}async*provide(t,n={}){yield*this.contentRouting.provide(t,this.components.addressManager.getAddresses(),n)}async cancelReprovide(t){await this.providers.removeProvider(t,this.components.peerId)}async*findProviders(t,n={}){yield*this.contentRouting.findProviders(t,n)}async*findPeer(t,n={}){yield*this.peerRouting.findPeer(t,n)}async*getClosestPeers(t,n={}){yield*this.peerRouting.getClosestPeers(t,n)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}}var hE;(function(r){r[r.SEND_QUERY=0]="SEND_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADD_PEER=6]="ADD_PEER",r[r.DIAL_PEER=7]="DIAL_PEER"})(hE||(hE={}));function X4e(r={}){return e=>new J4e(e,r)}var Z4e=r=>{if(Object.prototype.toString.call(r)!=="[object Object]")return!1;const e=Object.getPrototypeOf(r);return e===null||e===Object.prototype};const T3=Z4e,{hasOwnProperty:FB}=Object.prototype,{propertyIsEnumerable:e5e}=Object,lh=(r,e,t)=>Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),t5e=it,zB={concatArrays:!1,ignoreUndefined:!1},P3=r=>{const e=[];for(const t in r)FB.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){const t=Object.getOwnPropertySymbols(r);for(const n of t)e5e.call(r,n)&&e.push(n)}return e};function uh(r){return Array.isArray(r)?r5e(r):T3(r)?n5e(r):r}function r5e(r){const e=r.slice(0,0);return P3(r).forEach(t=>{lh(e,t,uh(r[t]))}),e}function n5e(r){const e=Object.getPrototypeOf(r)===null?Object.create(null):{};return P3(r).forEach(t=>{lh(e,t,uh(r[t]))}),e}const VB=(r,e,t,n)=>(t.forEach(i=>{typeof e[i]>"u"&&n.ignoreUndefined||(i in r&&r[i]!==Object.getPrototypeOf(r)?lh(r,i,fE(r[i],e[i],n)):lh(r,i,uh(e[i])))}),r),i5e=(r,e,t)=>{let n=r.slice(0,0),i=0;return[r,e].forEach(s=>{const o=[];for(let a=0;a<s.length;a++)FB.call(s,a)&&(o.push(String(a)),s===r?lh(n,i++,s[a]):lh(n,i++,uh(s[a])));n=VB(n,s,P3(s).filter(a=>!o.includes(a)),t)}),n};function fE(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?i5e(r,e,t):!T3(e)||!T3(r)?uh(e):VB(r,e,P3(e),t)}var s5e=function(...r){const e=fE(uh(zB),this!==t5e&&this||{},zB);let t={_:{}};for(const n of r)if(n!==void 0){if(!T3(n))throw new TypeError("`"+n+"` is not an Option Object");t=fE(t,{_:n},e)}return t._};const pE=Ze(s5e);function o5e(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function a5e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var c5e=a5e,l5e=c5e;let u5e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},d5e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return KB(this,e)}},h5e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return KB(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function KB(r,e){return new h5e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let f5e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new u5e(e,t,n),this.decoder=new d5e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function jB({name:r,prefix:e,encode:t,decode:n}){return new f5e(r,e,t,n)}function HB({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=l5e(t,r);return jB({prefix:e,name:r,encode:n,decode:s=>o5e(i(s))})}function p5e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function g5e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function D3({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return jB({prefix:e,name:r,encode(i){return g5e(i,n,t)},decode(i){return p5e(i,n,t,r)}})}const y5e=HB({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});HB({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var m5e=WB,qB=128,w5e=-128,b5e=Math.pow(2,31);function WB(r,e,t){e=e||[],t=t||0;for(var n=t;r>=b5e;)e[t++]=r&255|qB,r/=128;for(;r&w5e;)e[t++]=r&255|qB,r>>>=7;return e[t]=r|0,WB.bytes=t-n+1,e}var v5e=gE,E5e=128,GB=127;function gE(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw gE.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&GB)<<i:(o&GB)*Math.pow(2,i),i+=7}while(o>=E5e);return gE.bytes=s-n,t}var S5e=Math.pow(2,7),x5e=Math.pow(2,14),A5e=Math.pow(2,21),C5e=Math.pow(2,28),I5e=Math.pow(2,35),k5e=Math.pow(2,42),_5e=Math.pow(2,49),T5e=Math.pow(2,56),P5e=Math.pow(2,63),D5e=function(r){return r<S5e?1:r<x5e?2:r<A5e?3:r<C5e?4:r<I5e?5:r<k5e?6:r<_5e?7:r<T5e?8:r<P5e?9:10},$5e={encode:m5e,decode:v5e,encodingLength:D5e},QB=$5e;function YB(r,e,t=0){return QB.encode(r,e,t),e}function JB(r){return QB.encodingLength(r)}function XB(r,e){const t=e.byteLength,n=JB(r),i=n+JB(t),s=new Uint8Array(i+t);return YB(r,s,0),YB(t,s,n),s.set(e,i),new N5e(r,t,e,s)}let N5e=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function M5e({name:r,code:e,encode:t}){return new O5e(r,e,t)}let O5e=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?XB(this.code,t):t.then(n=>XB(this.code,n))}else throw Error("Unknown type, must be binary type")}};function R5e(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const L5e=M5e({name:"sha2-256",code:18,encode:R5e("SHA-256")});function B5e(r){return r>=55296&&r<=56319}function U5e(r){return r>=56320&&r<=57343}var F5e=function(e,t,n){if(typeof t!="string")throw new Error("Input must be string");for(var i=t.length,s=0,o,a,c=0;c<i;c+=1){if(o=t.charCodeAt(c),a=t[c],B5e(o)&&U5e(t.charCodeAt(c+1))&&(c+=1,a+=t[c]),s+=e(a),s===n)return t.slice(0,c+1);if(s>n)return t.slice(0,c-a.length+1)}return t};function z5e(r){return r>=55296&&r<=56319}function V5e(r){return r>=56320&&r<=57343}var K5e=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var t=e.length,n=0,i=null,s=null,o=0;o<t;o++)i=e.charCodeAt(o),V5e(i)?s!=null&&z5e(s)?n+=1:n+=3:i<=127?n+=1:i>=128&&i<=2047?n+=2:i>=2048&&i<=65535&&(n+=3),s=i;return n},j5e=F5e,H5e=K5e,q5e=j5e.bind(null,H5e),W5e=q5e,G5e=/[\/\?<>\\:\*\|"]/g,Q5e=/[\x00-\x1f\x80-\x9f]/g,Y5e=/^\.+$/,J5e=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,X5e=/[\. ]+$/;function ZB(r,e){if(typeof r!="string")throw new Error("Input must be string");var t=r.replace(G5e,e).replace(Q5e,e).replace(Y5e,e).replace(J5e,e).replace(X5e,e);return W5e(t,255)}var Z5e=function(r,e){var t=e&&e.replacement||"",n=ZB(r,t);return t===""?n:ZB(n,"")};const e8e=Ze(Z5e),yE={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function eU(r){const e="AES-GCM";let t=16;const n=12,i="SHA-256",s=16,o=32767,a=Bs.get();t*=8;async function c(h,p){const m=a.getRandomValues(new Uint8Array(s)),f=a.getRandomValues(new Uint8Array(n)),g={name:e,iv:f};typeof p=="string"&&(p=se(p));let v;if(p.length===0){v=await a.subtle.importKey("jwk",yE,{name:"AES-GCM"},!0,["encrypt"]);try{const w={name:"PBKDF2",salt:m,iterations:o,hash:{name:i}},b=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);v=await a.subtle.deriveKey(w,b,{name:e,length:t},!0,["encrypt"])}catch{v=await a.subtle.importKey("jwk",yE,{name:"AES-GCM"},!0,["encrypt"])}}else{const w={name:"PBKDF2",salt:m,iterations:o,hash:{name:i}},b=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);v=await a.subtle.deriveKey(w,b,{name:e,length:t},!0,["encrypt"])}const y=await a.subtle.encrypt(g,v,h);return or([m,g.iv,new Uint8Array(y)])}async function l(h,p){const m=h.subarray(0,s),f=h.subarray(s,s+n),g=h.subarray(s+n),v={name:e,iv:f};typeof p=="string"&&(p=se(p));let y;if(p.length===0)try{const b={name:"PBKDF2",salt:m,iterations:o,hash:{name:i}},E=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(b,E,{name:e,length:t},!0,["decrypt"])}catch{y=await a.subtle.importKey("jwk",yE,{name:"AES-GCM"},!0,["decrypt"])}else{const b={name:"PBKDF2",salt:m,iterations:o,hash:{name:i}},E=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(b,E,{name:e,length:t},!0,["decrypt"])}const w=await a.subtle.decrypt(v,y,g);return new Uint8Array(w)}return{encrypt:c,decrypt:l}}/*!
* MIT License
* 
* Copyright (c) 2017-2024 Peculiar Ventures, LLC
* 
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
* 
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
* 
*/const t8e="[object ArrayBuffer]";class ue{static isArrayBuffer(e){return Object.prototype.toString.call(e)===t8e}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const n=ue.toUint8Array(e),i=ue.toUint8Array(t);if(n.length!==i.byteLength)return!1;for(let s=0;s<n.length;s++)if(n[s]!==i[s])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let n=0;for(const o of t)n+=o.byteLength;const i=new Uint8Array(n);let s=0;for(const o of t){const a=this.toUint8Array(o);i.set(a,s),s+=a.length}return e[e.length-1]instanceof Function?this.toView(i,e[e.length-1]):i.buffer}}const mE="string",r8e=/^[0-9a-f\s]+$/i,n8e=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,i8e=/^[a-zA-Z0-9-_]+$/;class tU{static fromString(e){const t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n.buffer}static toString(e){const t=ue.toUint8Array(e);let n="";for(let s=0;s<t.length;s++)n+=String.fromCharCode(t[s]);return decodeURIComponent(escape(n))}}class qs{static toString(e,t=!1){const n=ue.toArrayBuffer(e),i=new DataView(n);let s="";for(let o=0;o<n.byteLength;o+=2){const a=i.getUint16(o,t);s+=String.fromCharCode(a)}return s}static fromString(e,t=!1){const n=new ArrayBuffer(e.length*2),i=new DataView(n);for(let s=0;s<e.length;s++)i.setUint16(s*2,e.charCodeAt(s),t);return n}}class Se{static isHex(e){return typeof e===mE&&r8e.test(e)}static isBase64(e){return typeof e===mE&&n8e.test(e)}static isBase64Url(e){return typeof e===mE&&i8e.test(e)}static ToString(e,t="utf8"){const n=ue.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return qs.toString(n,!0);case"utf16":case"utf16be":return qs.toString(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return qs.fromString(e,!0);case"utf16":case"utf16be":return qs.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=ue.toUint8Array(e);if(typeof btoa<"u"){const n=this.ToString(t,"binary");return btoa(n)}else return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Se.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Se.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=Se.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return tU.fromString(e);case"utf16":case"utf16be":return qs.fromString(e);case"utf16le":case"usc2":return qs.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=Se.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return tU.toString(e);case"utf16":case"utf16be":return qs.toString(e);case"utf16le":case"usc2":return qs.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);return n.buffer}static ToBinary(e){const t=ue.toUint8Array(e);let n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return n}static ToHex(e){const t=ue.toUint8Array(e);let n="";const i=t.length;for(let s=0;s<i;s++){const o=t[s];o<16&&(n+="0"),n+=o.toString(16)}return n}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Se.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const n=new Uint8Array(t.length/2);for(let i=0;i<t.length;i=i+2){const s=t.slice(i,i+2);n[i/2]=parseInt(s,16)}return n.buffer}static ToUtf16String(e,t=!1){return qs.toString(e,t)}static FromUtf16String(e,t=!1){return qs.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}static formatString(e){return(e==null?void 0:e.replace(/[\n\r\t ]/g,""))||""}}Se.DEFAULT_UTF8_ENCODING="utf8";function s8e(...r){const e=r.map(i=>i.byteLength).reduce((i,s)=>i+s),t=new Uint8Array(e);let n=0;return r.map(i=>new Uint8Array(i)).forEach(i=>{for(const s of i)t[n++]=s}),t.buffer}function rU(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<r.byteLength;i++)if(t[i]!==n[i])return!1;return!0}/*!
 Copyright (c) Peculiar Ventures, LLC
*/function dh(r,e){let t=0;if(r.length===1)return r[0];for(let n=r.length-1;n>=0;n--)t+=r[r.length-1-n]*Math.pow(2,e*n);return t}function ru(r,e,t=-1){const n=t;let i=r,s=0,o=Math.pow(2,e);for(let a=1;a<8;a++){if(r<o){let c;if(n<0)c=new ArrayBuffer(a),s=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),s=n}const l=new Uint8Array(c);for(let d=a-1;d>=0;d--){const h=Math.pow(2,d*e);l[s-d-1]=Math.floor(i/h),i-=l[s-d-1]*h}return c}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function wE(...r){let e=0,t=0;for(const s of r)e+=s.length;const n=new ArrayBuffer(e),i=new Uint8Array(n);for(const s of r)i.set(s,t),t+=s.length;return i}function nU(){const r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const a=r[0]===255&&r[1]&128,c=r[0]===0&&(r[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=r[0]&128;const n=dh(t,8),i=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(i);for(let a=0;a<this.valueHex.byteLength;a++)s[a]=r[a];return s[0]&=127,dh(s,8)-n}function o8e(r){const e=r<0?r*-1:r;let t=128;for(let n=1;n<8;n++){if(e<=t){if(r<0){const o=t-e,a=ru(o,8,n),c=new Uint8Array(a);return c[0]|=128,a}let i=ru(e,8,n),s=new Uint8Array(i);if(s[0]&128){const o=i.slice(0),a=new Uint8Array(o);i=new ArrayBuffer(i.byteLength+1),s=new Uint8Array(i);for(let c=0;c<o.byteLength;c++)s[c+1]=a[c];s[0]=0}return i}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function a8e(r,e){if(r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<t.length;i++)if(t[i]!==n[i])return!1;return!0}function ui(r,e){const t=r.toString(10);if(e<t.length)return"";const n=e-t.length,i=new Array(n);for(let o=0;o<n;o++)i[o]="0";return i.join("").concat(t)}/*!
* Copyright (c) 2014, GMO GlobalSign
* Copyright (c) 2015-2022, Peculiar Ventures
* All rights reserved.
* 
* Author 2014-2019, Yury Strozhevsky
* 
* Redistribution and use in source and binary forms, with or without modification,
* are permitted provided that the following conditions are met:
* 
* * Redistributions of source code must retain the above copyright notice, this
*   list of conditions and the following disclaimer.
* 
* * Redistributions in binary form must reproduce the above copyright notice, this
*   list of conditions and the following disclaimer in the documentation and/or
*   other materials provided with the distribution.
* 
* * Neither the name of the copyright holder nor the names of its
*   contributors may be used to endorse or promote products derived from
*   this software without specific prior written permission.
* 
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
* WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
* DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
* ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
* (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
* LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
* ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* 
*/function $3(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function bE(r){let e=0,t=0;for(let i=0;i<r.length;i++){const s=r[i];e+=s.byteLength}const n=new Uint8Array(e);for(let i=0;i<r.length;i++){const s=r[i];n.set(new Uint8Array(s),t),t+=s.byteLength}return n.buffer}function Wo(r,e,t,n){return e instanceof Uint8Array?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class N3{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return bE(this.items)}}const yp=[new Uint8Array([1])],iU="0123456789",vE="name",sU="valueHexView",c8e="isHexOnly",l8e="idBlock",u8e="tagClass",d8e="tagNumber",h8e="isConstructed",f8e="fromBER",p8e="toBER",g8e="local",Tn="",ls=new ArrayBuffer(0),M3=new Uint8Array(0),mp="EndOfContent",oU="OCTET STRING",aU="BIT STRING";function Ws(r){var e;return e=class extends r{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}constructor(...n){var i;super(...n);const s=n[0]||{};this.isHexOnly=(i=s.isHexOnly)!==null&&i!==void 0?i:!1,this.valueHexView=s.valueHex?ue.toUint8Array(s.valueHex):M3}fromBER(n,i,s){const o=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!Wo(this,o,i,s))return-1;const a=i+s;return this.valueHexView=o.subarray(i,a),this.valueHexView.length?(this.blockLength=s,a):(this.warnings.push("Zero buffer length"),i)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",ls)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:Se.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class nu{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=Tn,warnings:n=[],valueBeforeDecode:i=M3}={}){this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=ue.toUint8Array(i)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Se.ToHex(this.valueBeforeDecodeView)}}}nu.NAME="baseBlock";class gn extends nu{fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}gn.NAME="valueBlock";class cU extends Ws(nu){constructor({idBlock:e={}}={}){var t,n,i,s;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?ue.toUint8Array(e.valueHex):M3,this.tagClass=(n=e.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(i=e.tagNumber)!==null&&i!==void 0?i:-1,this.isConstructed=(s=e.isConstructed)!==null&&s!==void 0?s:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",ls}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const i=new Uint8Array(1);if(!e){let s=this.tagNumber;s&=31,t|=s,i[0]=t}return i.buffer}if(!this.isHexOnly){const i=ru(this.tagNumber,7),s=new Uint8Array(i),o=i.byteLength,a=new Uint8Array(o+1);if(a[0]=t|31,!e){for(let c=0;c<o-1;c++)a[c+1]=s[c]|128;a[o]=s[o-1]}return a.buffer}const n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=t|31,!e){const i=this.valueHexView;for(let s=0;s<i.length-1;s++)n[s+1]=i[s]|128;n[this.valueHexView.byteLength]=i[i.length-1]}return n.buffer}fromBER(e,t,n){const i=ue.toUint8Array(e);if(!Wo(this,i,t,n))return-1;const s=i.subarray(t,t+n);if(s.length===0)return this.error="Zero buffer length",-1;switch(s[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(s[0]&32)===32,this.isHexOnly=!1;const a=s[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,l=this.valueHexView=new Uint8Array(255),d=255;for(;s[c]&128;){if(l[c-1]=s[c]&127,c++,c>=s.length)return this.error="End of input reached before message was fully decoded",-1;if(c===d){d+=255;const p=new Uint8Array(d);for(let m=0;m<l.length;m++)p[m]=l[m];l=this.valueHexView=new Uint8Array(d)}}this.blockLength=c+1,l[c-1]=s[c]&127;const h=new Uint8Array(c);for(let p=0;p<c;p++)h[p]=l[p];l=this.valueHexView=new Uint8Array(c),l.set(h),this.blockLength<=9?this.tagNumber=dh(l,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}cU.NAME="identificationBlock";class lU extends nu{constructor({lenBlock:e={}}={}){var t,n,i;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(n=e.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(i=e.length)!==null&&i!==void 0?i:0}fromBER(e,t,n){const i=ue.toUint8Array(e);if(!Wo(this,i,t,n))return-1;const s=i.subarray(t,t+n);if(s.length===0)return this.error="Zero buffer length",-1;if(s[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=s[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(s[0]&128),this.longFormUsed===!1)return this.length=s[0],this.blockLength=1,t+this.blockLength;const o=s[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>s.length)return this.error="End of input reached before message was fully decoded",-1;const a=t+1,c=i.subarray(a,a+o);return c[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=dh(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(e=!1){let t,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=128),t;if(this.longFormUsed){const i=ru(this.length,8);if(i.byteLength>127)return this.error="Too big length",ls;if(t=new ArrayBuffer(i.byteLength+1),e)return t;const s=new Uint8Array(i);n=new Uint8Array(t),n[0]=i.byteLength|128;for(let o=0;o<i.byteLength;o++)n[o+1]=s[o];return t}return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}lU.NAME="lengthBlock";const we={};class Cr extends nu{constructor({name:e=Tn,optional:t=!1,primitiveSchema:n,...i}={},s){super(i),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new cU(i),this.lenBlock=new lU(i),this.valueBlock=s?new s(i):new gn(i)}fromBER(e,t,n){const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}toBER(e,t){const n=t||new N3;t||uU(this);const i=this.idBlock.toBER(e);if(n.write(i),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{const s=this.valueBlock.toBER(e);this.lenBlock.length=s.byteLength;const o=this.lenBlock.toBER(e);n.write(o),n.write(s)}return t?ls:n.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():Se.ToHex(this.toBER())}onAsciiEncoding(){const e=this.constructor.NAME,t=Se.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),n=e.toBER();return a8e(t,n)}}Cr.NAME="BaseBlock";function uU(r){var e;if(r instanceof we.Constructed)for(const t of r.valueBlock.value)uU(t)&&(r.lenBlock.isIndefiniteForm=!0);return!!(!((e=r.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}class EE extends Cr{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=Tn,...t}={},n){super(t,n),e&&this.fromString(e)}fromBER(e,t,n){const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}EE.NAME="BaseStringBlock";class dU extends Ws(gn){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}dU.NAME="PrimitiveValueBlock";var hU;class wp extends Cr{constructor(e={}){super(e,dU),this.idBlock.isConstructed=!1}}hU=wp,we.Primitive=hU,wp.NAME="PRIMITIVE";function y8e(r,e){if(r instanceof e)return r;const t=new e;return t.idBlock=r.idBlock,t.lenBlock=r.lenBlock,t.warnings=r.warnings,t.valueBeforeDecodeView=r.valueBeforeDecodeView,t}function hh(r,e=0,t=r.length){const n=e;let i=new Cr({},gn);const s=new nu;if(!Wo(s,r,e,t))return i.error=s.error,{offset:-1,result:i};if(!r.subarray(e,e+t).length)return i.error="Zero buffer length",{offset:-1,result:i};let a=i.idBlock.fromBER(r,e,t);if(i.idBlock.warnings.length&&i.warnings.concat(i.idBlock.warnings),a===-1)return i.error=i.idBlock.error,{offset:-1,result:i};if(e=a,t-=i.idBlock.blockLength,a=i.lenBlock.fromBER(r,e,t),i.lenBlock.warnings.length&&i.warnings.concat(i.lenBlock.warnings),a===-1)return i.error=i.lenBlock.error,{offset:-1,result:i};if(e=a,t-=i.lenBlock.blockLength,!i.idBlock.isConstructed&&i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};let c=Cr;switch(i.idBlock.tagClass){case 1:if(i.idBlock.tagNumber>=37&&i.idBlock.isHexOnly===!1)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};c=we.EndOfContent;break;case 1:c=we.Boolean;break;case 2:c=we.Integer;break;case 3:c=we.BitString;break;case 4:c=we.OctetString;break;case 5:c=we.Null;break;case 6:c=we.ObjectIdentifier;break;case 10:c=we.Enumerated;break;case 12:c=we.Utf8String;break;case 13:c=we.RelativeObjectIdentifier;break;case 14:c=we.TIME;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:c=we.Sequence;break;case 17:c=we.Set;break;case 18:c=we.NumericString;break;case 19:c=we.PrintableString;break;case 20:c=we.TeletexString;break;case 21:c=we.VideotexString;break;case 22:c=we.IA5String;break;case 23:c=we.UTCTime;break;case 24:c=we.GeneralizedTime;break;case 25:c=we.GraphicString;break;case 26:c=we.VisibleString;break;case 27:c=we.GeneralString;break;case 28:c=we.UniversalString;break;case 29:c=we.CharacterString;break;case 30:c=we.BmpString;break;case 31:c=we.DATE;break;case 32:c=we.TimeOfDay;break;case 33:c=we.DateTime;break;case 34:c=we.Duration;break;default:{const l=i.idBlock.isConstructed?new we.Constructed:new we.Primitive;l.idBlock=i.idBlock,l.lenBlock=i.lenBlock,l.warnings=i.warnings,i=l}}break;case 2:case 3:case 4:default:c=i.idBlock.isConstructed?we.Constructed:we.Primitive}return i=y8e(i,c),a=i.fromBER(r,e,i.lenBlock.isIndefiniteForm?t:i.lenBlock.length),i.valueBeforeDecodeView=r.subarray(n,n+i.blockLength),{offset:a,result:i}}function Go(r){if(!r.byteLength){const e=new Cr({},gn);return e.error="Input buffer has zero length",{offset:-1,result:e}}return hh(ue.toUint8Array(r).slice(),0,r.byteLength)}function m8e(r,e){return r?1:e}class Nc extends gn{constructor({value:e=[],isIndefiniteForm:t=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){const i=ue.toUint8Array(e);if(!Wo(this,i,t,n))return-1;if(this.valueBeforeDecodeView=i.subarray(t,t+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let s=t;for(;m8e(this.isIndefiniteForm,n)>0;){const o=hh(i,s,n);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(s=o.offset,this.blockLength+=o.result.blockLength,n-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===mp)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===mp?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}toBER(e,t){const n=t||new N3;for(let i=0;i<this.value.length;i++)this.value[i].toBER(e,n);return t?ls:n.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}Nc.NAME="ConstructedValueBlock";var fU;class Pn extends Cr{constructor(e={}){super(e,Nc),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){const e=[];for(const n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(i=>`  ${i}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}fU=Pn,we.Constructed=fU,Pn.NAME="CONSTRUCTED";class pU extends gn{fromBER(e,t,n){return t}toBER(e){return ls}}pU.override="EndOfContentValueBlock";var gU;class SE extends Cr{constructor(e={}){super(e,pU),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}gU=SE,we.EndOfContent=gU,SE.NAME=mp;var yU;class Qo extends Cr{constructor(e={}){super(e,gn),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){const n=new ArrayBuffer(2);if(!e){const i=new Uint8Array(n);i[0]=5,i[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}}yU=Qo,we.Null=yU,Qo.NAME="NULL";class mU extends Ws(gn){get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=ue.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,n){const i=ue.toUint8Array(e);return Wo(this,i,t,n)?(this.valueHexView=i.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,nU.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}mU.NAME="BooleanValueBlock";var wU;let O3=class extends Cr{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,mU),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};wU=O3,we.Boolean=wU,O3.NAME="BOOLEAN";class bU extends Ws(Nc){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,n){let i=0;if(this.isConstructed){if(this.isHexOnly=!1,i=Nc.prototype.fromBER.call(this,e,t,n),i===-1)return i;for(let s=0;s<this.value.length;s++){const o=this.value[s].constructor.NAME;if(o===mp){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==oU)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,i=super.fromBER(e,t,n),this.blockLength=n;return i}toBER(e,t){return this.isConstructed?Nc.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}bU.NAME="OctetStringValueBlock";var xE;let us=class extends Cr{constructor({idBlock:e={},lenBlock:t={},...n}={}){var i,s;(i=n.isConstructed)!==null&&i!==void 0||(n.isConstructed=!!(!((s=n.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},bU),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const s=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(s.byteLength){const o=hh(s,0,s.byteLength);o.offset!==-1&&o.offset===n&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Pn.prototype.onAsciiEncoding.call(this);const e=this.constructor.NAME,t=Se.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof xE&&e.push(t.valueBlock.valueHexView);return ue.concat(e)}};xE=us,we.OctetString=xE,us.NAME=oU;class vU extends Ws(Nc){constructor({unusedBits:e=0,isConstructed:t=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let i=-1;if(this.isConstructed){if(i=Nc.prototype.fromBER.call(this,e,t,n),i===-1)return i;for(const a of this.value){const c=a.constructor.NAME;if(c===mp){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==aU)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const l=a.valueBlock;if(this.unusedBits>0&&l.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=l.unusedBits}return i}const s=ue.toUint8Array(e);if(!Wo(this,s,t,n))return-1;const o=s.subarray(t,t+n);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const a=o.subarray(1);try{if(a.byteLength){const c=hh(a,0,a.byteLength);c.offset!==-1&&c.offset===n-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+n}toBER(e,t){if(this.isConstructed)return Nc.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return ls;const n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}vU.NAME="BitStringValueBlock";var EU;let iu=class extends Cr{constructor({idBlock:e={},lenBlock:t={},...n}={}){var i,s;(i=n.isConstructed)!==null&&i!==void 0||(n.isConstructed=!!(!((s=n.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},vU),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Pn.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const o of t)e.push(o.toString(2).padStart(8,"0"));const n=e.join(""),i=this.constructor.NAME,s=n.substring(0,n.length-this.valueBlock.unusedBits);return`${i} : ${s}`}}};EU=iu,we.BitString=EU,iu.NAME=aU;var SU;function w8e(r,e){const t=new Uint8Array([0]),n=new Uint8Array(r),i=new Uint8Array(e);let s=n.slice(0);const o=s.length-1,a=i.slice(0),c=a.length-1;let l=0;const d=c<o?o:c;let h=0;for(let p=d;p>=0;p--,h++){switch(!0){case h<a.length:l=s[o-h]+a[c-h]+t[0];break;default:l=s[o-h]+t[0]}switch(t[0]=l/10,!0){case h>=s.length:s=wE(new Uint8Array([l%10]),s);break;default:s[o-h]=l%10}}return t[0]>0&&(s=wE(t,s)),s}function xU(r){if(r>=yp.length)for(let e=yp.length;e<=r;e++){const t=new Uint8Array([0]);let n=yp[e-1].slice(0);for(let i=n.length-1;i>=0;i--){const s=new Uint8Array([(n[i]<<1)+t[0]]);t[0]=s[0]/10,n[i]=s[0]%10}t[0]>0&&(n=wE(t,n)),yp.push(n)}return yp[r]}function b8e(r,e){let t=0;const n=new Uint8Array(r),i=new Uint8Array(e),s=n.slice(0),o=s.length-1,a=i.slice(0),c=a.length-1;let l,d=0;for(let h=c;h>=0;h--,d++)switch(l=s[o-d]-a[c-d]-t,!0){case l<0:t=1,s[o-d]=l+10;break;default:t=0,s[o-d]=l}if(t>0)for(let h=o-c+1;h>=0;h--,d++)if(l=s[o-d]-t,l<0)t=1,s[o-d]=l+10;else{t=0,s[o-d]=l;break}return s.slice()}class AE extends Ws(gn){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=nU.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(o8e(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,i=0){const s=this.fromBER(e,t,n);if(s===-1)return s;const o=this.valueHexView;return o[0]===0&&o[1]&128?this.valueHexView=o.subarray(1):i!==0&&o.length<i&&(i-o.length>1&&(i=o.length+1),this.valueHexView=o.subarray(i-o.length)),s}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(t,1),this.valueHexView=n}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,n){const i=super.fromBER(e,t,n);return i===-1||this.setValueHex(),i}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),n=0,i;const s=this.valueHexView;let o="",a=!1;for(let c=s.byteLength-1;c>=0;c--){i=s[c];for(let l=0;l<8;l++){if((i&1)===1)switch(n){case e:t=b8e(xU(n),t),o="-";break;default:t=w8e(t,xU(n))}n++,i>>=1}}for(let c=0;c<t.length;c++)t[c]&&(a=!0),a&&(o+=iU.charAt(t[c]));return a===!1&&(o+=iU.charAt(0)),o}}SU=AE,AE.NAME="IntegerValueBlock",Object.defineProperty(SU.prototype,"valueHex",{set:function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var bp;class Yo extends Cr{constructor(e={}){super(e,AE),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return $3(),BigInt(this.valueBlock.toString())}static fromBigInt(e){$3();const t=BigInt(e),n=new N3,i=t.toString(16).replace(/^-/,""),s=new Uint8Array(Se.FromHex(i));if(t<0){const a=new Uint8Array(s.length+(s[0]&128?1:0));a[0]|=128;const l=BigInt(`0x${Se.ToHex(a)}`)+t,d=ue.toUint8Array(Se.FromHex(l.toString(16)));d[0]|=128,n.write(d)}else s[0]&128&&n.write(new Uint8Array([0])),n.write(s);return new bp({valueHex:n.final()})}convertToDER(){const e=new bp({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new bp({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}bp=Yo,we.Integer=bp,Yo.NAME="INTEGER";var AU;class R3 extends Yo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}AU=R3,we.Enumerated=AU,R3.NAME="ENUMERATED";class CE extends Ws(gn){constructor({valueDec:e=-1,isFirstSid:t=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;const i=ue.toUint8Array(e);if(!Wo(this,i,t,n))return-1;const s=i.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=s[a]&127,this.blockLength++,!!(s[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,s[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=dh(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){$3();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const n=new Uint8Array(t.length/7);for(let i=0;i<n.length;i++)n[i]=parseInt(t.slice(i*7,i*7+7),2)+(i+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=i[o]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}const t=ru(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",ls;const n=new Uint8Array(t.byteLength);if(!e){const i=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)n[o]=i[o]|128;n[s]=i[s]}return n}toString(){let e="";if(this.isHexOnly)e=Se.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}CE.NAME="sidBlock";class CU extends gn{constructor({value:e=Tn,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let i=t;for(;n>0;){const s=new CE;if(i=s.fromBER(e,i,n),i===-1)return this.blockLength=0,this.error=s.error,i;this.value.length===0&&(s.isFirstSid=!0),this.blockLength+=s.blockLength,n-=s.blockLength,this.value.push(s)}return i}toBER(e){const t=[];for(let n=0;n<this.value.length;n++){const i=this.value[n].toBER(e);if(i.byteLength===0)return this.error=this.value[n].error,ls;t.push(i)}return bE(t)}fromString(e){this.value=[];let t=0,n=0,i="",s=!1;do if(n=e.indexOf(".",t),n===-1?i=e.substring(t):i=e.substring(t,n),t=n+1,s){const o=this.value[0];let a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}const c=parseInt(i,10);if(isNaN(c))return;o.valueDec=c+a,s=!1}else{const o=new CE;if(i>Number.MAX_SAFE_INTEGER){$3();const a=BigInt(i);o.valueBigInt=a}else if(o.valueDec=parseInt(i,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,s=!0),this.value.push(o)}while(n!==-1)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let i=this.value[n].toString();n!==0&&(e=`${e}.`),t?(i=`{${i}}`,this.value[n].isFirstSid?e=`2.{${i} - 80}`:e+=i):e+=i}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}CU.NAME="ObjectIdentifierValueBlock";var IU;class Jo extends Cr{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,CU),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}IU=Jo,we.ObjectIdentifier=IU,Jo.NAME="OBJECT IDENTIFIER";class IE extends Ws(nu){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,n){if(n===0)return t;const i=ue.toUint8Array(e);if(!Wo(this,i,t,n))return-1;const s=i.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=s[a]&127,this.blockLength++,!!(s[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,s[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=dh(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=i[o]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}const t=ru(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",ls;const n=new Uint8Array(t.byteLength);if(!e){const i=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)n[o]=i[o]|128;n[s]=i[s]}return n.buffer}toString(){let e="";return this.isHexOnly?e=Se.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}IE.NAME="relativeSidBlock";class kU extends gn{constructor({value:e=Tn,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let i=t;for(;n>0;){const s=new IE;if(i=s.fromBER(e,i,n),i===-1)return this.blockLength=0,this.error=s.error,i;this.blockLength+=s.blockLength,n-=s.blockLength,this.value.push(s)}return i}toBER(e,t){const n=[];for(let i=0;i<this.value.length;i++){const s=this.value[i].toBER(e);if(s.byteLength===0)return this.error=this.value[i].error,ls;n.push(s)}return bE(n)}fromString(e){this.value=[];let t=0,n=0,i="";do{n=e.indexOf(".",t),n===-1?i=e.substring(t):i=e.substring(t,n),t=n+1;const s=new IE;if(s.valueDec=parseInt(i,10),isNaN(s.valueDec))return!0;this.value.push(s)}while(n!==-1);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let i=this.value[n].toString();n!==0&&(e=`${e}.`),t&&(i=`{${i}}`),e+=i}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}kU.NAME="RelativeObjectIdentifierValueBlock";var _U;class kE extends Cr{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,kU),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}_U=kE,we.RelativeObjectIdentifier=_U,kE.NAME="RelativeObjectIdentifier";var TU;class yr extends Pn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}TU=yr,we.Sequence=TU,yr.NAME="SEQUENCE";var PU;let Xo=class extends Pn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};PU=Xo,we.Set=PU,Xo.NAME="SET";class DU extends Ws(gn){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=Tn}toJSON(){return{...super.toJSON(),value:this.value}}}DU.NAME="StringValueBlock";class $U extends DU{}$U.NAME="SimpleStringValueBlock";class di extends EE{constructor({...e}={}){super(e,$U)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,ue.toUint8Array(e))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);this.valueBlock.value=e}}di.NAME="SIMPLE STRING";class NU extends di{fromBuffer(e){this.valueBlock.valueHexView=ue.toUint8Array(e);try{this.valueBlock.value=Se.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=Se.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(Se.FromUtf8String(e)),this.valueBlock.value=e}}NU.NAME="Utf8StringValueBlock";var MU;class Zo extends NU{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}MU=Zo,we.Utf8String=MU,Zo.NAME="UTF8String";class OU extends di{fromBuffer(e){this.valueBlock.value=Se.ToUtf16String(e),this.valueBlock.valueHexView=ue.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(Se.FromUtf16String(e))}}OU.NAME="BmpStringValueBlock";var RU;class L3 extends OU{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}RU=L3,we.BmpString=RU,L3.NAME="BMPString";class LU extends di{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let i=0;i<n.length;i+=4)n[i]=n[i+3],n[i+1]=n[i+2],n[i+2]=0,n[i+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let i=0;i<t;i++){const s=ru(e.charCodeAt(i),8),o=new Uint8Array(s);if(o.length>4)continue;const a=4-o.length;for(let c=o.length-1;c>=0;c--)n[i*4+c+a]=o[c]}this.valueBlock.value=e}}LU.NAME="UniversalStringValueBlock";var BU;class B3 extends LU{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}BU=B3,we.UniversalString=BU,B3.NAME="UniversalString";var UU;class U3 extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}UU=U3,we.NumericString=UU,U3.NAME="NumericString";var FU;class F3 extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}FU=F3,we.PrintableString=FU,F3.NAME="PrintableString";var zU;class z3 extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}zU=z3,we.TeletexString=zU,z3.NAME="TeletexString";var VU;class V3 extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}VU=V3,we.VideotexString=VU,V3.NAME="VideotexString";var KU;class K3 extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}KU=K3,we.IA5String=KU,K3.NAME="IA5String";var jU;class j3 extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}jU=j3,we.GraphicString=jU,j3.NAME="GraphicString";var HU;class vp extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}HU=vp,we.VisibleString=HU,vp.NAME="VisibleString";var qU;class H3 extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}qU=H3,we.GeneralString=qU,H3.NAME="GeneralString";var WU;class q3 extends di{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}WU=q3,we.CharacterString=WU,q3.NAME="CharacterString";var GU;class Ep extends vp{constructor({value:e,valueDate:t,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let i=0;i<e.length;i++)this.valueBlock.valueHexView[i]=e.charCodeAt(i)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,ue.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}const i=parseInt(n[1],10);i>=50?this.year=1900+i:this.year=2e3+i,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=ui(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=ui(this.month,2),t[2]=ui(this.day,2),t[3]=ui(this.hour,2),t[4]=ui(this.minute,2),t[5]=ui(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}GU=Ep,we.UTCTime=GU,Ep.NAME="UTCTime";var QU;class W3 extends Ep{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){const e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,n="",i="",s=0,o,a=0,c=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),t=!0;else{const h=new Number(e[e.length-1]);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(t){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let h=1,p=n.indexOf("+"),m="";if(p===-1&&(p=n.indexOf("-"),h=-1),p!==-1){if(m=n.substring(p+1),n=n.substring(0,p),m.length!==2&&m.length!==4)throw new Error("Wrong input string for conversion");let f=parseInt(m.substring(0,2),10);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");if(a=h*f,m.length===4){if(f=parseInt(m.substring(2,4),10),isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");c=h*f}}}let l=n.indexOf(".");if(l===-1&&(l=n.indexOf(",")),l!==-1){const h=new Number(`0${n.substring(l)}`);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");s=h.valueOf(),i=n.substring(0,l)}else i=n;switch(!0){case i.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,l!==-1)throw new Error("Wrong input string for conversion");break;case i.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let h=60*s;this.minute=Math.floor(h),h=60*(h-this.minute),this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case i.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let h=60*s;this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case i.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){const h=1e3*s;this.millisecond=Math.floor(h)}break;default:throw new Error("Wrong input string for conversion")}const d=o.exec(i);if(d===null)throw new Error("Wrong input string for conversion");for(let h=1;h<d.length;h++)switch(h){case 1:this.year=parseInt(d[h],10);break;case 2:this.month=parseInt(d[h],10);break;case 3:this.day=parseInt(d[h],10);break;case 4:this.hour=parseInt(d[h],10)+a;break;case 5:this.minute=parseInt(d[h],10)+c;break;case 6:this.second=parseInt(d[h],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const h=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=h.getUTCFullYear(),this.month=h.getUTCMonth(),this.day=h.getUTCDay(),this.hour=h.getUTCHours(),this.minute=h.getUTCMinutes(),this.second=h.getUTCSeconds(),this.millisecond=h.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push(ui(this.year,4)),t.push(ui(this.month,2)),t.push(ui(this.day,2)),t.push(ui(this.hour,2)),t.push(ui(this.minute,2)),t.push(ui(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(ui(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}QU=W3,we.GeneralizedTime=QU,W3.NAME="GeneralizedTime";var YU;class _E extends Zo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}YU=_E,we.DATE=YU,_E.NAME="DATE";var JU;class TE extends Zo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}JU=TE,we.TimeOfDay=JU,TE.NAME="TimeOfDay";var XU;class PE extends Zo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}XU=PE,we.DateTime=XU,PE.NAME="DateTime";var ZU;class DE extends Zo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}ZU=DE,we.Duration=ZU,DE.NAME="Duration";var eF;class $E extends Zo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}eF=$E,we.TIME=eF,$E.NAME="TIME";class su{constructor({name:e=Tn,optional:t=!1}={}){this.name=e,this.optional=t}}class NE extends su{constructor({value:e=[],...t}={}){super(t),this.value=e}}class G3 extends su{constructor({value:e=new su,local:t=!1,...n}={}){super(n),this.value=e,this.local=t}}class v8e{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=ue.toUint8Array(e)}constructor({data:e=M3}={}){this.dataView=ue.toUint8Array(e)}fromBER(e,t,n){const i=t+n;return this.dataView=ue.toUint8Array(e).subarray(t,i),i}toBER(e){return this.dataView.slice().buffer}}function ou(r,e,t){if(t instanceof NE){for(const s of t.value)if(ou(r,e,s).verified)return{verified:!0,result:r};{const s={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(vE)&&(s.name=t.name),s}}if(t instanceof su)return t.hasOwnProperty(vE)&&(r[t.name]=e),{verified:!0,result:r};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(l8e in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(f8e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(p8e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const n=t.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(u8e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(d8e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(h8e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:r};if(!(c8e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:r};if(t.idBlock.isHexOnly){if(!(sU in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const s=t.idBlock.valueHexView,o=e.idBlock.valueHexView;if(s.length!==o.length)return{verified:!1,result:r};for(let a=0;a<s.length;a++)if(s[a]!==o[1])return{verified:!1,result:r}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Tn),t.name&&(r[t.name]=e)),t instanceof we.Constructed){let s=0,o={verified:!1,result:{error:"Unknown error"}},a=t.valueBlock.value.length;if(a>0&&t.valueBlock.value[0]instanceof G3&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:r};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let c=!0;for(let l=0;l<t.valueBlock.value.length;l++)c=c&&(t.valueBlock.value[l].optional||!1);return c?{verified:!0,result:r}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Tn),t.name&&delete r[t.name]),r.error="Inconsistent object length",{verified:!1,result:r})}for(let c=0;c<a;c++)if(c-s>=e.valueBlock.value.length){if(t.valueBlock.value[c].optional===!1){const l={verified:!1,result:r};return r.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Tn),t.name&&(delete r[t.name],l.name=t.name)),l}}else if(t.valueBlock.value[0]instanceof G3){if(o=ou(r,e.valueBlock.value[c],t.valueBlock.value[0].value),o.verified===!1)if(t.valueBlock.value[0].optional)s++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Tn),t.name&&delete r[t.name]),o;if(vE in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let l={};g8e in t.valueBlock.value[0]&&t.valueBlock.value[0].local?l=e:l=r,typeof l[t.valueBlock.value[0].name]>"u"&&(l[t.valueBlock.value[0].name]=[]),l[t.valueBlock.value[0].name].push(e.valueBlock.value[c])}}else if(o=ou(r,e.valueBlock.value[c-s],t.valueBlock.value[c]),o.verified===!1)if(t.valueBlock.value[c].optional)s++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Tn),t.name&&delete r[t.name]),o;if(o.verified===!1){const c={verified:!1,result:r};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Tn),t.name&&(delete r[t.name],c.name=t.name)),c}return{verified:!0,result:r}}if(t.primitiveSchema&&sU in e.valueBlock){const s=hh(e.valueBlock.valueHexView);if(s.offset===-1){const o={verified:!1,result:s.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Tn),t.name&&(delete r[t.name],o.name=t.name)),o}return ou(r,s.result,t.primitiveSchema)}return{verified:!0,result:r}}function E8e(r,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};const t=hh(ue.toUint8Array(r));return t.offset===-1?{verified:!1,result:t.result}:ou(t.result,t.result,e)}const tF=Object.freeze(Object.defineProperty({__proto__:null,Any:su,BaseBlock:Cr,BaseStringBlock:EE,BitString:iu,BmpString:L3,Boolean:O3,CharacterString:q3,Choice:NE,Constructed:Pn,DATE:_E,DateTime:PE,Duration:DE,EndOfContent:SE,Enumerated:R3,GeneralString:H3,GeneralizedTime:W3,GraphicString:j3,HexBlock:Ws,IA5String:K3,Integer:Yo,Null:Qo,NumericString:U3,ObjectIdentifier:Jo,OctetString:us,Primitive:wp,PrintableString:F3,RawData:v8e,RelativeObjectIdentifier:kE,Repeated:G3,Sequence:yr,Set:Xo,TIME:$E,TeletexString:z3,TimeOfDay:TE,UTCTime:Ep,UniversalString:B3,Utf8String:Zo,ValueBlock:gn,VideotexString:V3,ViewWriter:N3,VisibleString:vp,compareSchema:ou,fromBER:Go,verifySchema:E8e},Symbol.toStringTag,{value:"Module"})),rF=D3({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});D3({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),D3({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),D3({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const S8e=16,ME=32,OE=1e4;async function Q3(r,e){const n=await eU().encrypt(r,e);return rF.encode(n)}async function nF(r,e,t){if(r.type==="RSA")return I8e(r,e,t);if(r.type==="Ed25519")return x8e(r,e,t);if(r.type==="secp256k1")return A8e(r,e,t);if(r.type==="ECDSA")return C8e(r,e,t);throw new Dl}async function x8e(r,e,t="libp2p-key"){if(t==="libp2p-key")return Q3(T1(r),e);throw new Z(`export format '${t}' is not supported`)}async function A8e(r,e,t="libp2p-key"){if(t==="libp2p-key")return Q3(T1(r),e);throw new Z("Export format is not supported")}async function C8e(r,e,t="libp2p-key"){if(t==="libp2p-key")return Q3(T1(r),e);throw new Z(`export format '${t}' is not supported`)}async function I8e(r,e,t="pkcs-8"){if(t==="pkcs-8")return k8e(r,e);if(t==="libp2p-key")return Q3(T1(r),e);throw new Z("Export format is not supported")}async function k8e(r,e){const t=Bs.get(),i=new yr({value:[new Yo({value:0}),new yr({value:[new Jo({value:"1.2.840.113549.1.1.1"}),new Qo]}),new us({valueHex:r.raw})]}).toBER(),s=new Uint8Array(i,0,i.byteLength),o=ic(S8e),a=await q$(Kv,e,o,{c:OE,dkLen:ME}),c=ic(16),l=await t.subtle.importKey("raw",a,"AES-CBC",!1,["encrypt"]),d=await t.subtle.encrypt({name:"AES-CBC",iv:c},l,s),h=new yr({value:[new us({valueHex:o}),new Yo({value:OE}),new Yo({value:ME}),new yr({value:[new Jo({value:"1.2.840.113549.2.11"}),new Qo]})]}),p=new yr({value:[new Jo({value:"1.2.840.113549.1.5.13"}),new yr({value:[new yr({value:[new Jo({value:"1.2.840.113549.1.5.12"}),h]}),new yr({value:[new Jo({value:"2.16.840.1.101.3.4.1.42"}),new us({valueHex:c})]})]})]}),f=new yr({value:[p,new us({valueHex:d})]}).toBER(),g=new Uint8Array(f,0,f.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...re(g,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join(`
`)}async function iF(r,e){try{const t=await _8e(r,e);return pie(t)}catch{}if(!r.includes("BEGIN"))throw new Z("Encrypted key was not a libp2p-key or a PEM file");return T8e(r,e)}async function _8e(r,e){const t=rF.decode(r);return eU().decrypt(t,e)}async function T8e(r,e){const t=Bs.get();let n;if(r.includes("-----BEGIN ENCRYPTED PRIVATE KEY-----")){const s=se(r.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:o}=Go(s),{iv:a,salt:c,iterations:l,keySize:d,cipherText:h}=P8e(o),p=await q$(Kv,e,c,{c:l,dkLen:d}),m=await t.subtle.importKey("raw",p,"AES-CBC",!1,["decrypt"]),f=Sp(await t.subtle.decrypt({name:"AES-CBC",iv:a},m,h)),{result:g}=Go(f);n=sF(g)}else if(r.includes("-----BEGIN PRIVATE KEY-----")){const s=se(r.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:o}=Go(s);n=sF(o)}else throw new Z("Could not parse private key from PEM data");const i=Sv(n);if(i.type!=="RSA")throw new Z("Could not parse RSA private key from PEM data");return i}function P8e(r){const e=r.valueBlock.value[0];if(e.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.13")throw new Z("Only pkcs5PBES2 encrypted private keys are supported");const n=e.valueBlock.value[1].valueBlock.value[0];if(n.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.12")throw new Z("Only pkcs5PBKDF2 key derivation functions are supported");const s=n.valueBlock.value[1],o=Sp(s.valueBlock.value[0].getValue());let a=OE,c=ME;if(s.valueBlock.value.length===3)a=Number(s.valueBlock.value[1].toBigInt()),c=Number(s.valueBlock.value[2].toBigInt());else if(s.valueBlock.value.length===2)throw new Z("Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key");const l=e.valueBlock.value[1].valueBlock.value[1],d=l.valueBlock.value[0].toString();if(d!=="OBJECT IDENTIFIER : 1.2.840.113549.3.7"){if(d!=="OBJECT IDENTIFIER : 1.3.14.3.2.7"){if(d!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2"){if(d!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22"){if(d!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42")throw new Z("Only AES-CBC encryption schemes are supported")}}}}const h=Sp(l.valueBlock.value[1].getValue());return{cipherText:Sp(r.valueBlock.value[1].getValue()),salt:o,iterations:a,keySize:c,iv:h}}function sF(r){return Sp(r.valueBlock.value[2].getValue())}function Sp(r){return new Uint8Array(r,0,r.byteLength)}const D8e="/pkcs8/",RE="/info/",xp=new WeakMap,au={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},LE={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function fh(r){return r==null||typeof r!="string"?!1:r===e8e(r.trim())&&r.length>0}async function Ir(){const t=Math.random()*800+200;await new Promise(n=>setTimeout(n,t))}function cu(r){return new xt(D8e+r)}function ph(r){return new xt(RE+r)}async function $8e(r){const e=T1(r),t=await L5e.digest(e);return y5e.encode(t.bytes).substring(1)}uH=Symbol.toStringTag,lH=dr;class N8e{constructor(e,t){u(this,"components");u(this,"init");u(this,"log");u(this,"self");u(this,uH,"@libp2p/keychain");u(this,lH,["@libp2p/keychain"]);var i,s,o,a,c,l,d,h,p,m;if(this.components=e,this.log=e.logger.forComponent("libp2p:keychain"),this.init=pE(LE,t),this.self=t.selfKey??"self",this.init.pass!=null&&((i=this.init.pass)==null?void 0:i.length)<20)throw new Error("pass must be least 20 characters");if(((s=this.init.dek)==null?void 0:s.keyLength)!=null&&this.init.dek.keyLength<au.minKeyLength)throw new Error(`dek.keyLength must be least ${au.minKeyLength} bytes`);if(((a=(o=this.init.dek)==null?void 0:o.salt)==null?void 0:a.length)!=null&&this.init.dek.salt.length<au.minSaltLength)throw new Error(`dek.saltLength must be least ${au.minSaltLength} bytes`);if(((c=this.init.dek)==null?void 0:c.iterationCount)!=null&&this.init.dek.iterationCount<au.minIterationCount)throw new Error(`dek.iterationCount must be least ${au.minIterationCount}`);const n=this.init.pass!=null&&((l=this.init.dek)==null?void 0:l.salt)!=null?G$(this.init.pass,(d=this.init.dek)==null?void 0:d.salt,(h=this.init.dek)==null?void 0:h.iterationCount,(p=this.init.dek)==null?void 0:p.keyLength,(m=this.init.dek)==null?void 0:m.hash):"";xp.set(this,{dek:n})}static generateOptions(){const e=Object.assign({},LE),t=Math.ceil(au.minSaltLength/3)*3;return e.dek.salt=re(ic(t),"base64"),e}static get options(){return LE}async findKeyByName(e){if(!fh(e))throw await Ir(),new Z(`Invalid key name '${e}'`);const t=ph(e);try{const n=await this.components.datastore.get(t);return JSON.parse(re(n))}catch(n){throw await Ir(),this.log.error(n),new Zt(`Key '${e}' does not exist.`)}}async findKeyById(e){try{const t={prefix:RE};for await(const n of this.components.datastore.query(t)){const i=JSON.parse(re(n.value));if(i.id===e)return i}throw new Z(`Key with id '${e}' does not exist.`)}catch(t){throw await Ir(),t}}async importKey(e,t){if(!fh(e))throw await Ir(),new Z(`Invalid key name '${e}'`);if(t==null)throw await Ir(),new Z("Key is required");const n=cu(e);if(await this.components.datastore.has(n))throw await Ir(),new Z(`Key '${e}' already exists`);let s,o;try{s=await $8e(t);const l=xp.get(this);if(l==null)throw new Z("dek missing");const d=l.dek;o=await nF(t,d,t.type==="RSA"?"pkcs-8":"libp2p-key")}catch(l){throw await Ir(),l}const a={name:e,id:s},c=this.components.datastore.batch();return c.put(n,se(o)),c.put(ph(e),se(JSON.stringify(a))),await c.commit(),a}async exportKey(e){if(!fh(e))throw await Ir(),new Z(`Invalid key name '${e}'`);const t=cu(e);try{const n=await this.components.datastore.get(t),i=re(n),s=xp.get(this);if(s==null)throw new Z("dek missing");const o=s.dek;return await iF(i,o)}catch(n){throw await Ir(),n}}async removeKey(e){if(!fh(e)||e===this.self)throw await Ir(),new Z(`Invalid key name '${e}'`);const t=cu(e),n=await this.findKeyByName(e),i=this.components.datastore.batch();return i.delete(t),i.delete(ph(e)),await i.commit(),n}async listKeys(){const e={prefix:RE},t=[];for await(const n of this.components.datastore.query(e))t.push(JSON.parse(re(n.value)));return t}async renameKey(e,t){if(!fh(e)||e===this.self)throw await Ir(),new Z(`Invalid old key name '${e}'`);if(!fh(t)||t===this.self)throw await Ir(),new Z(`Invalid new key name '${t}'`);const n=cu(e),i=cu(t),s=ph(e),o=ph(t);if(await this.components.datastore.has(i))throw await Ir(),new Z(`Key '${t}' already exists`);try{const c=await this.components.datastore.get(n),l=await this.components.datastore.get(s),d=JSON.parse(re(l));d.name=t;const h=this.components.datastore.batch();return h.put(i,c),h.put(o,se(JSON.stringify(d))),h.delete(n),h.delete(s),await h.commit(),d}catch(c){throw await Ir(),c}}async rotateKeychainPass(e,t){var a,c,l,d;if(typeof e!="string")throw await Ir(),new Z(`Invalid old pass type '${typeof e}'`);if(typeof t!="string")throw await Ir(),new Z(`Invalid new pass type '${typeof t}'`);if(t.length<20)throw await Ir(),new Z(`Invalid pass length ${t.length}`);this.log("recreating keychain");const n=xp.get(this);if(n==null)throw new Z("dek missing");const i=n.dek;this.init.pass=t;const s=t!=null&&((a=this.init.dek)==null?void 0:a.salt)!=null?G$(t,this.init.dek.salt,(c=this.init.dek)==null?void 0:c.iterationCount,(l=this.init.dek)==null?void 0:l.keyLength,(d=this.init.dek)==null?void 0:d.hash):"";xp.set(this,{dek:s});const o=await this.listKeys();for(const h of o){const p=await this.components.datastore.get(cu(h.name)),m=re(p),f=await iF(m,i),g=s.toString(),v=await nF(f,g,f.type==="RSA"?"pkcs-8":"libp2p-key"),y=this.components.datastore.batch(),w={name:h.name,id:h.id};y.put(cu(h.name),se(v)),y.put(ph(h.name),se(JSON.stringify(w))),await y.commit()}this.log("keychain reconstructed")}}function oF(r={}){return e=>new N8e(e,r)}class aF{constructor(e={}){u(this,"memoryStorage");u(this,"points");u(this,"duration");u(this,"blockDuration");u(this,"execEvenly");u(this,"execEvenlyMinDelayMs");u(this,"keyPrefix");this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??this.duration*1e3/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new M8e}async consume(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n);let o=this.memoryStorage.incrby(i,t,s);if(o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.consumedPoints>this.points)throw this.blockDuration>0&&o.consumedPoints<=this.points+t&&(o=this.memoryStorage.set(i,o.consumedPoints,this.blockDuration)),new Uie("Rate limit exceeded",o);if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let a=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));a<this.execEvenlyMinDelayMs&&(a=o.consumedPoints*this.execEvenlyMinDelayMs),await dB(a)}return o}penalty(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n),o=this.memoryStorage.incrby(i,t,s);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}reward(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n),o=this.memoryStorage.incrby(i,-t,s);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}block(e,t){const n=t*1e3,i=this.points+1;return this.memoryStorage.set(this.getKey(e),i,t),{remainingPoints:0,msBeforeNext:n===0?-1:n,consumedPoints:i,isFirstInDuration:!1}}set(e,t,n=0){const i=(n>=0?n:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,n),{remainingPoints:0,msBeforeNext:i===0?-1:i,consumedPoints:t,isFirstInDuration:!1}}get(e){const t=this.memoryStorage.get(this.getKey(e));return t!=null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return(e==null?void 0:e.customDuration)!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}}class M8e{constructor(){u(this,"storage");this.storage=new Map}incrby(e,t,n){const i=this.storage.get(e);if(i!=null){const s=i.expiresAt!=null?i.expiresAt.getTime()-new Date().getTime():-1;return i.expiresAt==null||s>0?(i.value+=t,{remainingPoints:0,msBeforeNext:s,consumedPoints:i.value,isFirstInDuration:!1}):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){const i=n*1e3,s=this.storage.get(e);s!=null&&clearTimeout(s.timeoutId);const o={value:t,expiresAt:i>0?new Date(Date.now()+i):void 0};return this.storage.set(e,o),i>0&&(o.timeoutId=setTimeout(()=>{this.storage.delete(e)},i),o.timeoutId.unref!=null&&o.timeoutId.unref()),{remainingPoints:0,msBeforeNext:i===0?-1:i,consumedPoints:o.value,isFirstInDuration:!0}}get(e){const t=this.storage.get(e);if(t!=null)return{remainingPoints:0,msBeforeNext:t.expiresAt!=null?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){const t=this.storage.get(e);return t!=null?(t.timeoutId!=null&&clearTimeout(t.timeoutId),this.storage.delete(e),!0):!1}}var at;(function(r){r[r.NEW_STREAM=0]="NEW_STREAM",r[r.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",r[r.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",r[r.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",r[r.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",r[r.RESET_RECEIVER=5]="RESET_RECEIVER",r[r.RESET_INITIATOR=6]="RESET_INITIATOR"})(at||(at={}));const BE=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),cF=Object.freeze({NEW_STREAM:at.NEW_STREAM,MESSAGE:at.MESSAGE_INITIATOR,CLOSE:at.CLOSE_INITIATOR,RESET:at.RESET_INITIATOR}),O8e=Object.freeze({MESSAGE:at.MESSAGE_RECEIVER,CLOSE:at.CLOSE_RECEIVER,RESET:at.RESET_RECEIVER}),lF=1<<20,R8e=4<<20;let L8e=class{constructor(e=lF,t=R8e){u(this,"_buffer");u(this,"_headerInfo");u(this,"_maxMessageSize");u(this,"_maxUnprocessedMessageQueueSize");this._buffer=new Be,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw new Et("Unprocessed message queue size too large!");const t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(l){if(l.name==="InvalidMessageError")throw l;break}const{id:n,type:i,length:s,offset:o}=this._headerInfo;if(this._buffer.length-o<s)break;const c={id:n,type:i};(i===at.NEW_STREAM||i===at.MESSAGE_INITIATOR||i===at.MESSAGE_RECEIVER)&&(c.data=this._buffer.sublist(o,o+s)),t.push(c),this._buffer.consume(o+s),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:n}=dF(e),{value:i,offset:s}=dF(e,n),o=t&7;if(BE[o]==null)throw new Error(`Invalid type received: ${o}`);if(i>this._maxMessageSize)throw new Et("Message size too large");return{id:t>>3,type:o,offset:n+s,length:i}}};const B8e=128,uF=127;function dF(r,e=0){let t=0,n=0,i=e,s;const o=r.length;do{if(i>=o||n>49)throw e=0,new RangeError("Could not decode varint");s=r.get(i++),t+=n<28?(s&uF)<<n:(s&uF)*Math.pow(2,n),n+=7}while(s>=B8e);return e=i-e,{value:t,offset:e}}const UE=10*1024;let U8e=class{constructor(){u(this,"_pool");u(this,"_poolOffset");this._pool=In(UE),this._poolOffset=0}write(e,t){const n=this._pool;let i=this._poolOffset;Sr(e.id<<3|e.type,n,i),i+=yt(e.id<<3|e.type),(e.type===at.NEW_STREAM||e.type===at.MESSAGE_INITIATOR||e.type===at.MESSAGE_RECEIVER)&&e.data!=null?(Sr(e.data.length,n,i),i+=yt(e.data.length)):(Sr(0,n,i),i+=yt(0));const s=n.subarray(this._poolOffset,i);UE-i<100?(this._pool=In(UE),this._poolOffset=0):this._poolOffset=i,t.append(s),(e.type===at.NEW_STREAM||e.type===at.MESSAGE_INITIATOR||e.type===at.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}};const F8e=new U8e;async function*z8e(r){for await(const e of r){const t=new Be;F8e.write(e,t),yield t}}class V8e extends Error{constructor(e="Stream input buffer error"){super(e),this.name="StreamInputBufferError"}}class K8e extends O9{constructor(t){super(t);u(this,"name");u(this,"streamId");u(this,"send");u(this,"types");u(this,"maxDataSize");this.types=t.direction==="outbound"?cF:O8e,this.send=t.send,this.name=t.name,this.streamId=t.streamId,this.maxDataSize=t.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:cF.NEW_STREAM,data:new Be(se(this.name))})}async sendData(t){for(t=t.sublist();t.byteLength>0;){const n=Math.min(t.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:t.sublist(0,n)}),t.consume(n)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}function j8e(r){const{id:e,name:t,send:n,onEnd:i,type:s="initiator",maxMsgSize:o=lF}=r;return new K8e({id:s==="initiator"?`i${e}`:`r${e}`,streamId:e,name:`${t??e}`,direction:s==="initiator"?"outbound":"inbound",maxDataSize:o,onEnd:i,send:n,log:r.logger.forComponent(`libp2p:mplex:stream:${s}:${e}`)})}const H8e=1024,q8e=1024,W8e=1024*1024*4,G8e=5,Q8e=500;function hF(r){const e={...r,type:`${BE[r.type]} (${r.type})`};return r.type===at.NEW_STREAM&&(e.data=re(r.data instanceof Uint8Array?r.data:r.data.subarray())),(r.type===at.MESSAGE_INITIATOR||r.type===at.MESSAGE_RECEIVER)&&(e.data=re(r.data instanceof Uint8Array?r.data:r.data.subarray(),"base16")),e}class Y8e{constructor(e,t){u(this,"protocol","/mplex/6.7.0");u(this,"sink");u(this,"source");u(this,"log");u(this,"_streamId");u(this,"_streams");u(this,"_init");u(this,"_source");u(this,"closeController");u(this,"rateLimiter");u(this,"closeTimeout");u(this,"logger");t=t??{},this.log=e.logger.forComponent("libp2p:mplex"),this.logger=e.logger,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=t,this.closeTimeout=t.closeTimeout??Q8e,this.sink=this._createSink(),this._source=yo({objectMode:!0,onEnd:()=>{for(const n of this._streams.initiators.values())n.destroy();for(const n of this._streams.receivers.values())n.destroy()}}),this.source=un(this._source,n=>z8e(n)),this.closeController=new AbortController,this.rateLimiter=new aF({points:t.disconnectThreshold??G8e,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Tl("Muxer already closed");const t=this._streamId++;e=e==null?t.toString():e.toString();const n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}async close(e){if(this.closeController.signal.aborted)return;const t=(e==null?void 0:e.signal)??AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map(async n=>n.close({signal:t}))),this._source.end(),await this._source.onEmpty({signal:t}),this.closeController.abort()}catch(n){this.abort(n)}}abort(e){this.closeController.signal.aborted||(this.streams.forEach(t=>{t.abort(e)}),this.closeController.abort(e))}_newReceiverStream(e){const{id:t,name:n}=e,i=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:i})}_newStream(e){const{id:t,name:n,type:i,registry:s}=e;if(this.log("new %s stream %s",i,t),i==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??q8e))throw new M2("Too many outbound streams open");if(s.has(t))throw new Error(`${i} stream ${t} already exists!`);const c=j8e({id:t,name:n,send:async l=>{this.log.enabled&&this.log.trace("%s stream %s send",i,t,hF(l)),this._source.push(l)},type:i,onEnd:()=>{this.log("%s stream with id %s and protocol %s ended",i,t,c.protocol),s.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(c)},maxMsgSize:this._init.maxMsgSize,logger:this.logger});return s.set(t,c),c}_createSink(){return async t=>{const n=()=>{bL(t,this.log)};this.closeController.signal.addEventListener("abort",n);try{const i=new L8e(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const s of t)for(const o of i.write(s))await this._handleIncoming(o);this._source.end()}catch(i){this.log("error in sink",i),this._source.end(i)}finally{this.closeController.signal.removeEventListener("abort",n)}}}async _handleIncoming(e){const{id:t,type:n}=e;if(this.log.enabled&&this.log.trace("incoming message",hF(e)),e.type===at.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??H8e)){this.log("too many inbound streams open"),this._source.push({id:t,type:at.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(new Error("Too many open streams"));return}return}const a=this._newReceiverStream({id:t,name:re(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(a);return}const s=((n&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(s==null){this.log("missing stream %s for message type %s",t,BE[n]);try{await this.rateLimiter.consume("missing-stream",1)}catch{this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(new Error("Too many messages for missing streams"));return}return}const o=this._init.maxStreamBufferSize??W8e;try{switch(n){case at.MESSAGE_INITIATOR:case at.MESSAGE_RECEIVER:if(s.sourceReadableLength()>o)throw this._source.push({id:e.id,type:n===at.MESSAGE_INITIATOR?at.RESET_RECEIVER:at.RESET_INITIATOR}),new V8e("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers");s.sourcePush(e.data);break;case at.CLOSE_INITIATOR:case at.CLOSE_RECEIVER:s.remoteCloseWrite();break;case at.RESET_INITIATOR:case at.RESET_RECEIVER:s.reset();break;default:this.log("unknown message type %s",n)}}catch(a){this.log.error("error while processing message",a),s.abort(a)}}}hH=Symbol.toStringTag,dH=dr;class J8e{constructor(e,t={}){u(this,"protocol","/mplex/6.7.0");u(this,"_init");u(this,"components");u(this,hH,"@libp2p/mplex");u(this,dH,["@libp2p/stream-multiplexing"]);this.components=e,this._init=t}createStreamMuxer(e={}){return new Y8e(this.components,{...e,...this._init})}}function X8e(r={}){return e=>new J8e(e,r)}const FE=32,Z8e="1.0.0",e6e="ping",t6e="ipfs",r6e=1e4,n6e=2,i6e=1;pH=Symbol.toStringTag,fH=dr;class s6e{constructor(e,t={}){u(this,"protocol");u(this,"components");u(this,"started");u(this,"timeout");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"runOnLimitedConnection");u(this,"log");u(this,pH,"@libp2p/ping");u(this,fH,["@libp2p/ping"]);this.components=e,this.log=e.logger.forComponent("libp2p:ping"),this.started=!1,this.protocol=`/${t.protocolPrefix??t6e}/${e6e}/${Z8e}`,this.timeout=t.timeout??r6e,this.maxInboundStreams=t.maxInboundStreams??n6e,this.maxOutboundStreams=t.maxOutboundStreams??i6e,this.runOnLimitedConnection=t.runOnLimitedConnection??!0,this.handleMessage=this.handleMessage.bind(this)}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){this.log("incoming ping from %p",e.connection.remotePeer);const{stream:t}=e,n=Date.now(),i=Qm(t);let s=!1;Promise.resolve().then(async()=>{for(;;){const o=AbortSignal.timeout(this.timeout);o.addEventListener("abort",()=>{t==null||t.abort(new f1("ping timeout"))});const a=await i.read({bytes:FE,signal:o});await i.write(a,{signal:o}),s=!0}}).catch(o=>{s&&o.name==="UnexpectedEOFError"&&t.readStatus!=="ready"||(this.log.error("incoming ping from %p failed with error - %e",e.connection.remotePeer,o),t==null||t.abort(o))}).finally(()=>{const o=Date.now()-n;this.log("incoming ping from %p complete in %dms",e.connection.remotePeer,o);const a=AbortSignal.timeout(this.timeout);t.close({signal:a}).catch(c=>{this.log.error("error closing ping stream from %p - %e",e.connection.remotePeer,c),t==null||t.abort(c)})})}async ping(e,t={}){this.log("pinging %p",e);const n=Date.now(),i=ic(FE),s=await this.components.connectionManager.openConnection(e,t);let o;if(t.signal==null){const a=AbortSignal.timeout(this.timeout);t={...t,signal:a}}try{o=await s.newStream(this.protocol,{...t,runOnLimitedConnection:this.runOnLimitedConnection});const a=Qm(o),[,c]=await Promise.all([a.write(i,t),a.read({...t,bytes:FE})]),l=Date.now()-n;if(!qe(i,c.subarray()))throw new aP(`Received wrong ping ack after ${l}ms`);return this.log("ping %p complete in %dms",s.remotePeer,l),l}catch(a){throw this.log.error("error while pinging %p",s.remotePeer,a),o==null||o.abort(a),a}finally{o!=null&&await o.close(t)}}}function o6e(r={}){return e=>new s6e(e,r)}var Dn;(function(r){(function(n){n.FIN="FIN",n.STOP_SENDING="STOP_SENDING",n.RESET="RESET",n.FIN_ACK="FIN_ACK"})(r.Flag||(r.Flag={}));let e;(function(n){n[n.FIN=0]="FIN",n[n.STOP_SENDING=1]="STOP_SENDING",n[n.RESET=2]="RESET",n[n.FIN_ACK=3]="FIN_ACK"})(e||(e={})),function(n){n.codec=()=>kn(e)}(r.Flag||(r.Flag={}));let t;r.codec=()=>(t==null&&(t=$e((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.flag!=null&&(i.uint32(8),r.Flag.codec().encode(n.flag,i)),n.message!=null&&(i.uint32(18),i.bytes(n.message)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.flag=r.Flag.codec().decode(n);break}case 2:{o.message=n.bytes();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>De(n,r.codec()),r.decode=(n,i)=>Pe(n,r.codec(),i)})(Dn||(Dn={}));const a6e=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],fF=Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),c6e="libp2p+webrtc+v1/",l6e=466,u6e=2*1024*1024,d6e=30*1e3,Y3=16*1024;function h6e(r=Y3){const e=yt(r-yt(r)),t=1+yt(Object.keys(Dn.Flag).length-1),n=1,i=r-e-t-n,s=yt(i);return e+t+n+s}const f6e=h6e(),p6e=5e3,g6e=5e3,y6e=3e4,pF="/webrtc",zE="/webrtc-signaling/0.0.1",m6e="/libp2p/webrtc-direct/certificate",w6e="webrtc-direct-certificate-private-key",b6e=12096e5,gF=864e5;var yF=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||Array.prototype.slice.call(e))},v6e=function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r}(),E6e=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}(),S6e=function(){function r(e,t,n,i){this.name=e,this.version=t,this.os=n,this.bot=i,this.type="bot-device"}return r}(),x6e=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),A6e=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),C6e=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,I6e=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,mF=3,k6e=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",C6e]],wF=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function _6e(r){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new A6e:typeof navigator<"u"?P6e(navigator.userAgent):$6e()}function T6e(r){return r!==""&&k6e.reduce(function(e,t){var n=t[0],i=t[1];if(e)return e;var s=i.exec(r);return!!s&&[n,s]},!1)}function P6e(r){var e=T6e(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new x6e;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<mF&&(i=yF(yF([],i,!0),N6e(mF-i.length),!0)):i=[];var s=i.join("."),o=D6e(r),a=I6e.exec(r);return a&&a[1]?new S6e(t,s,o,a[1]):new v6e(t,s,o)}function D6e(r){for(var e=0,t=wF.length;e<t;e++){var n=wF[e],i=n[0],s=n[1],o=s.exec(r);if(o)return i}return null}function $6e(){var r=typeof process<"u"&&process.version;return r?new E6e(process.version.slice(1)):null}function N6e(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}const bF=_6e(),VE=bF!=null&&bF.name==="firefox",vF=async function*(){},EF=async r=>{};function M6e(r,e,t=y6e,n){r.readyState==="open"&&Promise.resolve().then(async()=>{if(r.bufferedAmount>0){n.log("%s drain channel with %d buffered bytes",e,r.bufferedAmount);const i=Le();let s=!1;r.bufferedAmountLowThreshold=0;const o=()=>{s||(n.log("%s drain channel closed before drain",e),i.resolve())};r.addEventListener("close",o,{once:!0}),r.addEventListener("bufferedamountlow",()=>{s=!0,r.removeEventListener("close",o),i.resolve()}),await jf(i.promise,{milliseconds:t})}}).then(async()=>{r.readyState==="open"&&r.close()}).catch(i=>{n.log.error("error closing outbound stream",i)})}async function SF(r){return r=r??{},typeof r=="function"&&(r=await r()),r.iceServers=r.iceServers??a6e.map(e=>({urls:[e]})),r}const O6e=(r=32)=>c6e+[...Array(r)].map(()=>fF.at(Math.floor(Math.random()*fF.length))).join("");class KE{constructor(e,t){u(this,"log");u(this,"peerConnection");u(this,"remoteAddr");u(this,"timeline");u(this,"metrics");u(this,"source",vF());u(this,"sink",EF);this.log=e.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=t.remoteAddr,this.timeline=t.timeline,this.peerConnection=t.peerConnection;const n=this.peerConnection,i=n.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",n.connectionState,"initial state",i),(n.connectionState==="disconnected"||n.connectionState==="failed"||n.connectionState==="closed")&&(this.timeline.close=Date.now())}}async close(e){var t;this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),(t=this.metrics)==null||t.increment({close:!0})}abort(e){var t;this.log.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),(t=this.metrics)==null||t.increment({abort:!0})}}class R6e extends O9{constructor(t){const n=t.onEnd;t.onEnd=s=>{this.log.trace('readable and writeable ends closed with status "%s"',this.status),Promise.resolve(async()=>{if(!(this.timeline.abort!=null||this.timeline.reset!==null))try{await jf(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(o){this.log.error("error receiving FIN_ACK",o)}}).then(()=>{this.incomingData.end(),n==null||n(s)}).catch(o=>{this.log.error("error ending stream",o)}).finally(()=>{this.channel.close()})};super(t);u(this,"channel");u(this,"incomingData");u(this,"maxBufferedAmount");u(this,"bufferedAmountLowEventTimeout");u(this,"maxMessageSize");u(this,"receiveFinAck");u(this,"finAckTimeout");u(this,"openTimeout");u(this,"closeController");switch(this.channel=t.channel,this.channel.binaryType="arraybuffer",this.incomingData=yo(),this.bufferedAmountLowEventTimeout=t.bufferedAmountLowEventTimeout??d6e,this.maxBufferedAmount=t.maxBufferedAmount??u6e,this.maxMessageSize=(t.maxMessageSize??Y3)-f6e,this.receiveFinAck=Le(),this.finAckTimeout=t.closeTimeout??p6e,this.openTimeout=t.openTimeout??g6e,this.closeController=new AbortController,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(this.timeline.close===void 0||this.timeline.close===0)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new P2("Unknown datachannel state")}this.channel.onopen=s=>{this.timeline.open=new Date().getTime()},this.channel.onclose=s=>{this.log.trace("received onclose event"),this.closeController.abort(),this.receiveFinAck.resolve(),this.close().catch(o=>{this.log.error("error closing stream after channel closed",o)})},this.channel.onerror=s=>{this.log.trace("received onerror event"),this.closeController.abort();const o=s.error;this.abort(o)},this.channel.onmessage=async s=>{const{data:o}=s;o===null||o.byteLength===0||this.incomingData.push(new Uint8Array(o,0,o.byteLength))};const i=this;Promise.resolve().then(async()=>{for await(const s of Bd(this.incomingData)){const o=i.processIncomingProtobuf(s);o!=null&&i.sourcePush(new Be(o))}}).catch(s=>{this.log.error("error processing incoming data channel messages",s)})}sendNewStream(){}async _sendMessage(t,n=!0){if(this.channel.readyState==="closed"||this.channel.readyState==="closing")throw new P2(`Invalid datachannel state - ${this.channel.readyState}`);if(this.channel.readyState!=="open"){const i=AbortSignal.timeout(this.openTimeout),s=pt([this.closeController.signal,i]);try{this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await Ti(this.channel,"open",s)}finally{s.clear()}this.log('channel state is now "%s", sending data',this.channel.readyState)}if(n&&this.channel.bufferedAmount>this.maxBufferedAmount){const i=AbortSignal.timeout(this.bufferedAmountLowEventTimeout),s=pt([this.closeController.signal,i]);try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await Ti(this.channel,"bufferedamountlow",s)}catch(o){throw i.aborted?new f1(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`):o}finally{s.clear()}}try{this.log.trace('sending message, channel state "%s"',this.channel.readyState),this.channel.send(t.subarray())}catch(i){this.log.error("error while sending message",i)}}async sendData(t){const n=t.byteLength;for(t=t.sublist();t.byteLength>0;){const i=Math.min(t.byteLength,this.maxMessageSize),s=t.subarray(0,i),o=Dn.encode({message:s}),a=Ld.single(o);this.log.trace("sending %d/%d bytes on channel",s.byteLength,n),await this._sendMessage(a),t.consume(i)}this.log.trace('finished sending data, channel state "%s"',this.channel.readyState)}async sendReset(){try{await this._sendFlag(Dn.Flag.RESET)}catch(t){this.log.error("failed to send reset - %e",t)}finally{this.channel.close()}}async sendCloseWrite(t){if(this.channel.readyState!=="open"){this.receiveFinAck.resolve();return}if(await this._sendFlag(Dn.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await ln(this.receiveFinAck.promise,t==null?void 0:t.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorName:"FinAckNotReceivedError"})}catch(i){this.log.error("failed to await FIN_ACK",i)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){this.channel.readyState==="open"&&await this._sendFlag(Dn.Flag.STOP_SENDING)}processIncomingProtobuf(t){const n=Dn.decode(t);if(n.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',n.flag,this.writeStatus,this.readStatus),n.flag===Dn.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(Dn.Flag.FIN_ACK).catch(i=>{this.log.error("error sending FIN_ACK immediately",i)})),n.flag===Dn.Flag.RESET&&this.reset(),n.flag===Dn.Flag.STOP_SENDING&&this.remoteCloseRead(),n.flag===Dn.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),this.readStatus==="ready")return n.message}async _sendFlag(t){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',t.toString(),this.channel.readyState),!1;this.log.trace("sending flag %s",t.toString());const n=Dn.encode({flag:t}),i=Ld.single(n);try{return await this._sendMessage(i,!1),!0}catch(s){this.log.error("could not send flag %s - %e",t.toString(),s)}return!1}}function J3(r){const{channel:e,direction:t,handshake:n}=r;return new R6e({id:`${e.id}`,log:r.logger.forComponent(`libp2p:webrtc:stream:${n===!0?"handshake":t}:${e.id}`),...r})}class jE{constructor(e,t){u(this,"protocol");u(this,"peerConnection");u(this,"bufferedStreams",[]);u(this,"metrics");u(this,"dataChannelOptions");u(this,"components");u(this,"log");this.components=e,this.peerConnection=t.peerConnection,this.metrics=t.metrics,this.protocol=t.protocol??pF,this.dataChannelOptions=t.dataChannelOptions??{},this.log=e.logger.forComponent("libp2p:webrtc:muxerfactory"),this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',n.id),n.label==="init"){this.log.trace("closing early init channel"),n.close();return}const i={},s=J3({channel:n,direction:"inbound",onEnd:o=>{i.onEnd(o)},logger:e.logger,...this.dataChannelOptions});i.stream=s,i.channel=n,i.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(o=>o.stream.id!==s.id)},this.bufferedStreams.push(i)}}createStreamMuxer(e){return new L6e(this.components,{...e,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}}class L6e{constructor(e,t){Je(this,Xh);u(this,"init");u(this,"streams");u(this,"protocol");u(this,"log");u(this,"peerConnection");u(this,"dataChannelOptions");u(this,"metrics");u(this,"logger");u(this,"source",vF());u(this,"sink",EF);this.init=t,this.log=e.logger.forComponent("libp2p:webrtc:muxer"),this.logger=e.logger,this.streams=t.streams.map(n=>n.stream),this.peerConnection=t.peerConnection,this.protocol=t.protocol??pF,this.metrics=t.metrics,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:n})=>{var o,a;if(this.log.trace("incoming datachannel with channel id %d",n.id),n.label==="init"){this.log.trace("closing init channel"),n.close();return}const i=n.id,s=J3({channel:n,direction:"inbound",onEnd:()=>{Ie(this,Xh,B4).call(this,s,n),this.log("incoming channel %s ended",i)},logger:this.logger,...this.dataChannelOptions});this.streams.push(s),(o=this.metrics)==null||o.increment({incoming_stream:!0}),(a=t==null?void 0:t.onIncomingStream)==null||a.call(t,s)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(n=>{var i,s,o;n.onEnd=()=>{this.log("incoming early channel %s ended with state %s",n.channel.id,n.channel.readyState),Ie(this,Xh,B4).call(this,n.stream,n.channel)},(i=this.metrics)==null||i.increment({incoming_stream:!0}),(o=(s=this.init)==null?void 0:s.onIncomingStream)==null||o.call(s,n.stream)})})}async close(e){try{await Promise.all(this.streams.map(async t=>t.close(e)))}catch(t){this.abort(t)}}abort(e){for(const t of this.streams)t.abort(e)}newStream(){var i;const e=this.peerConnection.createDataChannel(""),t=e.id;this.log.trace("opened outgoing datachannel with channel id %s",t);const n=J3({channel:e,direction:"outbound",onEnd:()=>{Ie(this,Xh,B4).call(this,n,e),this.log("outgoing channel %s ended",t)},logger:this.logger,...this.dataChannelOptions});return this.streams.push(n),(i=this.metrics)==null||i.increment({outgoing_stream:!0}),n}}Xh=new WeakSet,B4=function(e,t){var n,i,s;this.log.trace("stream %s %s %s onEnd",e.direction,e.id,e.protocol),M6e(t,`${e.direction} ${e.id} ${e.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(o=>o.id!==e.id),(n=this.metrics)==null||n.increment({stream_end:!0}),(s=(i=this.init)==null?void 0:i.onStreamEnd)==null||s.call(i,e)};const xF=globalThis.RTCPeerConnection,AF=globalThis.RTCSessionDescription,B6e=globalThis.RTCIceCandidate;class Ap extends Error{constructor(e){super(`WebRTC transport error: ${e}`),this.name="WebRTCTransportError"}}class Mc extends Ap{constructor(e="SDP handshake failed"){super(e),this.name="SDPHandshakeFailedError"}}class U6e extends Ap{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`),this.name="WebRTC/InvalidFingerprintError"}}class F6e extends Ap{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}}class z6e extends Ap{constructor(e){super(`unsupported hash algorithm code: ${e} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}}var ds;(function(r){(function(n){n.SDP_OFFER="SDP_OFFER",n.SDP_ANSWER="SDP_ANSWER",n.ICE_CANDIDATE="ICE_CANDIDATE"})(r.Type||(r.Type={}));let e;(function(n){n[n.SDP_OFFER=0]="SDP_OFFER",n[n.SDP_ANSWER=1]="SDP_ANSWER",n[n.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(e||(e={})),function(n){n.codec=()=>kn(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=$e((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.data!=null&&(i.uint32(18),i.string(n.data)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.data=n.string();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>De(n,r.codec()),r.decode=(n,i)=>Pe(n,r.codec(),i)})(ds||(ds={}));const CF=async(r,e,t)=>{var n,i,s,o;try{const a=Le();for(V6e(r,a);;){const c=await Promise.race([a.promise,e.read({signal:t.signal}).catch(()=>{})]);if(c==null){(n=t.signal)==null||n.throwIfAborted();break}if(c.type!==ds.Type.ICE_CANDIDATE)throw new Et("ICE candidate message expected");const l=JSON.parse(c.data??"null");if(l===""||l===null){(i=t.onProgress)==null||i.call(t,new _e("webrtc:end-of-ice-candidates")),t.log.trace("end-of-candidates received");continue}const d=new B6e(l);t.log.trace("%s received new ICE candidate %o",t.direction,l);try{(s=t.onProgress)==null||s.call(t,new _e("webrtc:add-ice-candidate",d.candidate)),await r.addIceCandidate(d)}catch(h){t.log.error("%s bad candidate received",t.direction,l,h)}}}catch(a){if(t.log.error("%s error parsing ICE candidate",t.direction,a),((o=t.signal)==null?void 0:o.aborted)===!0&&HE(r)!=="connected")throw a}};function HE(r){return VE?r.iceConnectionState:r.connectionState}function V6e(r,e){r[VE?"oniceconnectionstatechange":"onconnectionstatechange"]=t=>{switch(HE(r)){case"connected":e.resolve();break;case"failed":case"disconnected":case"closed":e.reject(new Sb("RTCPeerConnection was closed"));break}}}async function K6e({rtcConfiguration:r,dataChannel:e,signal:t,metrics:n,multiaddr:i,connectionManager:s,transportManager:o,log:a,logger:c,onProgress:l}){const{baseAddr:d}=q6e(i);n==null||n.dialerEvents.increment({open:!0}),a.trace("dialing base address: %a",d);const h=d.getPeerId();if(h==null)throw new Z("Relay peer was missing");const p=s.getConnections(tr(h));let m,f=!1;p.length===0?(l==null||l(new _e("webrtc:dial-relay")),m=await o.dial(d,{signal:t,onProgress:l}),f=!0):(l==null||l(new _e("webrtc:reuse-relay-connection")),m=p[0]);try{l==null||l(new _e("webrtc:open-signaling-stream"));const g=await m.newStream(zE,{signal:t,runOnLimitedConnection:!0}),v=li(g).pb(ds),y=new xF(r),w=new jE({logger:c},{peerConnection:y,dataChannelOptions:e});try{const b=y.createDataChannel("init");y.onicecandidate=({candidate:x})=>{const I=JSON.stringify((x==null?void 0:x.toJSON())??null);a.trace("initiator sending ICE candidate %o",x),v.write({type:ds.Type.ICE_CANDIDATE,data:I},{signal:t}).catch(T=>{a.error("error sending ICE candidate",T)})},y.onicecandidateerror=x=>{a.error("initiator ICE candidate error",x)};const E=await y.createOffer().catch(x=>{throw a.error("could not execute createOffer",x),new Mc("Failed to set createOffer")});a.trace("initiator send SDP offer %s",E.sdp),l==null||l(new _e("webrtc:send-sdp-offer")),await v.write({type:ds.Type.SDP_OFFER,data:E.sdp},{signal:t}),await y.setLocalDescription(E).catch(x=>{throw a.error("could not execute setLocalDescription",x),new Mc("Failed to set localDescription")}),l==null||l(new _e("webrtc:read-sdp-answer")),a.trace("initiator read SDP answer");const A=await v.read({signal:t});if(A.type!==ds.Type.SDP_ANSWER)throw new Mc("Remote should send an SDP answer");a.trace("initiator received SDP answer %s",A.data);const k=new AF({type:"answer",sdp:A.data});return await y.setRemoteDescription(k).catch(x=>{throw a.error("could not execute setRemoteDescription",x),new Mc("Failed to set remoteDescription")}),a.trace("initiator read candidates until connected"),l==null||l(new _e("webrtc:read-ice-candidates")),await CF(y,v,{direction:"initiator",signal:t,log:a,onProgress:l}),a.trace("initiator connected, closing init channel"),b.close(),l==null||l(new _e("webrtc:close-signaling-stream")),a.trace("closing signaling channel"),await g.close({signal:t}),a.trace("initiator connected to remote address %s",i),{remoteAddress:i,peerConnection:y,muxerFactory:w}}catch(b){throw a.error("outgoing signaling error",b),y.close(),g.abort(b),b}finally{y.onicecandidate=null,y.onicecandidateerror=null}}finally{if(f)try{await m.close({signal:t})}catch(g){m.abort(g)}}}const IF=At(tO.matchers[0],Qe("p2p-circuit"));class qE extends er{constructor(t,n){super();u(this,"transportManager");u(this,"shutdownController");u(this,"events");this.transportManager=t.transportManager,this.events=t.events,this.shutdownController=n.shutdownController,this.onTransportListening=this.onTransportListening.bind(this)}async listen(){this.events.addEventListener("transport:listening",this.onTransportListening)}onTransportListening(t){t.detail.getAddrs().filter(i=>IF.exactMatch(i)).map(i=>i.encapsulate("/webrtc")).length>0&&this.safeDispatchEvent("listening")}getAddrs(){return this.transportManager.getListeners().filter(t=>!(t instanceof qE)).map(t=>t.getAddrs().filter(n=>IF.exactMatch(n)).map(n=>n.encapsulate("/webrtc"))).flat()}updateAnnounceAddrs(){}async close(){this.events.removeEventListener("transport:listening",this.onTransportListening),this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})}}async function j6e({peerConnection:r,stream:e,signal:t,connection:n,log:i}){i.trace("new inbound signaling stream");const s=li(e).pb(ds);try{r.onicecandidate=({candidate:d})=>{const h=JSON.stringify((d==null?void 0:d.toJSON())??null);i.trace("recipient sending ICE candidate %s",h),s.write({type:ds.Type.ICE_CANDIDATE,data:h},{signal:t}).catch(p=>{i.error("error sending ICE candidate",p)})},i.trace("recipient read SDP offer");const a=await s.read({signal:t});if(a.type!==ds.Type.SDP_OFFER)throw new Mc(`expected message type SDP_OFFER, received: ${a.type??"undefined"} `);i.trace("recipient received SDP offer %s",a.data);const c=new AF({type:"offer",sdp:a.data});await r.setRemoteDescription(c).catch(d=>{throw i.error("could not execute setRemoteDescription",d),new Mc("Failed to set remoteDescription")});const l=await r.createAnswer().catch(d=>{throw i.error("could not execute createAnswer",d),new Mc("Failed to create answer")});i.trace("recipient send SDP answer %s",l.sdp),await s.write({type:ds.Type.SDP_ANSWER,data:l.sdp},{signal:t}),await r.setLocalDescription(l).catch(d=>{throw i.error("could not execute setLocalDescription",d),new Mc("Failed to set localDescription")}),i.trace("recipient read candidates until connected"),await CF(r,s,{direction:"recipient",signal:t,log:i})}catch(a){if(HE(r)!=="connected")throw i.error("error while handling signaling stream from peer %a",n.remoteAddr,a),r.close(),a;i("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",n.remoteAddr,a)}const o=Re(`/webrtc/p2p/${n.remoteAddr.getPeerId()}`);return i.trace("recipient connected to remote address %s",o),{remoteAddress:o}}wH=T2,mH=Symbol.toStringTag,yH=dr,gH=Qa;class H6e{constructor(e,t={}){u(this,"components");u(this,"init");u(this,"log");u(this,"_started",!1);u(this,"metrics");u(this,"shutdownController");u(this,wH,!0);u(this,mH,"@libp2p/webrtc");u(this,yH,["@libp2p/transport"]);u(this,gH,["@libp2p/identify","@libp2p/circuit-relay-v2-transport"]);this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}isStarted(){return this._started}async start(){await this.components.registrar.handle(zE,e=>{const t=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);this._onProtocol(e,t).catch(n=>{this.log.error("failed to handle incoming connect from %p",e.connection.remotePeer,n)}).finally(()=>{t.clear()})},{runOnLimitedConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(zE),this._started=!1}createListener(e){return new qE(this.components,{shutdownController:this.shutdownController})}listenFilter(e){return e.filter(O7.exactMatch)}dialFilter(e){return this.listenFilter(e)}async dial(e,t){var c;this.log.trace("dialing address: %a",e);const{remoteAddress:n,peerConnection:i,muxerFactory:s}=await K6e({rtcConfiguration:await SF(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:t.onProgress}),o=new KE(this.components,{peerConnection:i,timeline:{open:Date.now()},remoteAddr:n,metrics:(c=this.metrics)==null?void 0:c.dialerEvents}),a=await t.upgrader.upgradeOutbound(o,{skipProtection:!0,skipEncryption:!0,muxerFactory:s,onProgress:t.onProgress,signal:t.signal});return this._closeOnShutdown(i,o),a}async _onProtocol({connection:e,stream:t},n){var o;const i=new xF(await SF(this.init.rtcConfiguration)),s=new jE(this.components,{peerConnection:i,dataChannelOptions:this.init.dataChannel});try{const{remoteAddress:a}=await j6e({peerConnection:i,connection:e,stream:t,signal:n,log:this.log});await t.close({signal:n});const c=new KE(this.components,{peerConnection:i,timeline:{open:new Date().getTime()},remoteAddr:a,metrics:(o=this.metrics)==null?void 0:o.listenerEvents});await this.components.upgrader.upgradeInbound(c,{skipEncryption:!0,skipProtection:!0,muxerFactory:s,signal:n}),this._closeOnShutdown(i,c)}catch(a){throw this.log.error("incoming signaling error",a),i.close(),t.abort(a),a}}_closeOnShutdown(e,t){const n=()=>{t.close().catch(i=>{this.log.error("could not close WebRTCMultiaddrConnection",i)})};this.shutdownController.signal.addEventListener("abort",n),e.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",n)})}}function q6e(r){const e=r.toString().split("/webrtc/");if(e.length!==2)throw new Z("webrtc protocol was not present in multiaddr");if(!e[0].includes("/p2p-circuit"))throw new Z("p2p-circuit protocol was not present in multiaddr");let t=Re(e[0]);const i=Re("/"+e[1]).getPeerId();if(i==null)throw new Z("destination peer id was missing");const s=t.protos().pop();if(s===void 0)throw new Z("invalid multiaddr");return s.name!=="p2p"&&(t=t.encapsulate(`/p2p/${i}`)),{baseAddr:t,peerId:tr(i)}}/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var kF;(function(r){(function(e){var t=typeof globalThis=="object"?globalThis:typeof it=="object"?it:typeof self=="object"?self:typeof this=="object"?this:a(),n=i(r);typeof t.Reflect<"u"&&(n=i(t.Reflect,n)),e(n,t),typeof t.Reflect>"u"&&(t.Reflect=r);function i(c,l){return function(d,h){Object.defineProperty(c,d,{configurable:!0,writable:!0,value:h}),l&&l(d,h)}}function s(){try{return Function("return this;")()}catch{}}function o(){try{return(0,eval)("(function() { return this; })()")}catch{}}function a(){return s()||o()}})(function(e,t){var n=Object.prototype.hasOwnProperty,i=typeof Symbol=="function",s=i&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=i&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",c={__proto__:[]}instanceof Array,l=!a&&!c,d={create:a?function(){return M(Object.create(null))}:c?function(){return M({__proto__:null})}:function(){return M({})},has:l?function(P,N){return n.call(P,N)}:function(P,N){return N in P},get:l?function(P,N){return n.call(P,N)?P[N]:void 0}:function(P,N){return P[N]}},h=Object.getPrototypeOf(Function),p=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:D(),m=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:S(),f=typeof WeakMap=="function"?WeakMap:C(),g=i?Symbol.for("@reflect-metadata:registry"):void 0,v=Wc(),y=$A(v);function w(P,N,R,J){if(H(R)){if(!It(P))throw new TypeError;if(!$t(N))throw new TypeError;return B(P,N)}else{if(!It(P))throw new TypeError;if(!de(N))throw new TypeError;if(!de(J)&&!H(J)&&!ie(J))throw new TypeError;return ie(J)&&(J=void 0),R=nt(R),G(P,N,R,J)}}e("decorate",w);function b(P,N){function R(J,he){if(!de(J))throw new TypeError;if(!H(he)&&!nr(he))throw new TypeError;O(P,N,J,he)}return R}e("metadata",b);function E(P,N,R,J){if(!de(R))throw new TypeError;return H(J)||(J=nt(J)),O(P,N,R,J)}e("defineMetadata",E);function A(P,N,R){if(!de(N))throw new TypeError;return H(R)||(R=nt(R)),j(P,N,R)}e("hasMetadata",A);function k(P,N,R){if(!de(N))throw new TypeError;return H(R)||(R=nt(R)),q(P,N,R)}e("hasOwnMetadata",k);function x(P,N,R){if(!de(N))throw new TypeError;return H(R)||(R=nt(R)),Q(P,N,R)}e("getMetadata",x);function I(P,N,R){if(!de(N))throw new TypeError;return H(R)||(R=nt(R)),K(P,N,R)}e("getOwnMetadata",I);function T(P,N){if(!de(P))throw new TypeError;return H(N)||(N=nt(N)),U(P,N)}e("getMetadataKeys",T);function L(P,N){if(!de(P))throw new TypeError;return H(N)||(N=nt(N)),W(P,N)}e("getOwnMetadataKeys",L);function z(P,N,R){if(!de(N))throw new TypeError;if(H(R)||(R=nt(R)),!de(N))throw new TypeError;H(R)||(R=nt(R));var J=_u(N,R,!1);return H(J)?!1:J.OrdinaryDeleteMetadata(P,N,R)}e("deleteMetadata",z);function B(P,N){for(var R=P.length-1;R>=0;--R){var J=P[R],he=J(N);if(!H(he)&&!ie(he)){if(!$t(he))throw new TypeError;N=he}}return N}function G(P,N,R,J){for(var he=P.length-1;he>=0;--he){var Oe=P[he],Fe=Oe(N,R,J);if(!H(Fe)&&!ie(Fe)){if(!de(Fe))throw new TypeError;J=Fe}}return J}function j(P,N,R){var J=q(P,N,R);if(J)return!0;var he=bs(N);return ie(he)?!1:j(P,he,R)}function q(P,N,R){var J=_u(N,R,!1);return H(J)?!1:Me(J.OrdinaryHasOwnMetadata(P,N,R))}function Q(P,N,R){var J=q(P,N,R);if(J)return K(P,N,R);var he=bs(N);if(!ie(he))return Q(P,he,R)}function K(P,N,R){var J=_u(N,R,!1);if(!H(J))return J.OrdinaryGetOwnMetadata(P,N,R)}function O(P,N,R,J){var he=_u(R,J,!0);he.OrdinaryDefineOwnMetadata(P,N,R,J)}function U(P,N){var R=W(P,N),J=bs(P);if(J===null)return R;var he=U(J,N);if(he.length<=0)return R;if(R.length<=0)return he;for(var Oe=new m,Fe=[],Ee=0,ge=R;Ee<ge.length;Ee++){var ve=ge[Ee],xe=Oe.has(ve);xe||(Oe.add(ve),Fe.push(ve))}for(var Ce=0,Ye=he;Ce<Ye.length;Ce++){var ve=Ye[Ce],xe=Oe.has(ve);xe||(Oe.add(ve),Fe.push(ve))}return Fe}function W(P,N){var R=_u(P,N,!1);return R?R.OrdinaryOwnMetadataKeys(P,N):[]}function Y(P){if(P===null)return 1;switch(typeof P){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return P===null?1:6;default:return 6}}function H(P){return P===void 0}function ie(P){return P===null}function me(P){return typeof P=="symbol"}function de(P){return typeof P=="object"?P!==null:typeof P=="function"}function le(P,N){switch(Y(P)){case 0:return P;case 1:return P;case 2:return P;case 3:return P;case 4:return P;case 5:return P}var R="string",J=fa(P,s);if(J!==void 0){var he=J.call(P,R);if(de(he))throw new TypeError;return he}return Ne(P)}function Ne(P,N){var R,J,he;{var Oe=P.toString;if(kt(Oe)){var J=Oe.call(P);if(!de(J))return J}var R=P.valueOf;if(kt(R)){var J=R.call(P);if(!de(J))return J}}throw new TypeError}function Me(P){return!!P}function Xe(P){return""+P}function nt(P){var N=le(P);return me(N)?N:Xe(N)}function It(P){return Array.isArray?Array.isArray(P):P instanceof Object?P instanceof Array:Object.prototype.toString.call(P)==="[object Array]"}function kt(P){return typeof P=="function"}function $t(P){return typeof P=="function"}function nr(P){switch(Y(P)){case 3:return!0;case 4:return!0;default:return!1}}function Nr(P,N){return P===N||P!==P&&N!==N}function fa(P,N){var R=P[N];if(R!=null){if(!kt(R))throw new TypeError;return R}}function eo(P){var N=fa(P,o);if(!kt(N))throw new TypeError;var R=N.call(P);if(!de(R))throw new TypeError;return R}function pe(P){return P.value}function ws(P){var N=P.next();return N.done?!1:N}function to(P){var N=P.return;N&&N.call(P)}function bs(P){var N=Object.getPrototypeOf(P);if(typeof P!="function"||P===h||N!==h)return N;var R=P.prototype,J=R&&Object.getPrototypeOf(R);if(J==null||J===Object.prototype)return N;var he=J.constructor;return typeof he!="function"||he===P?N:he}function bn(){var P;!H(g)&&typeof t.Reflect<"u"&&!(g in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&(P=ro(t.Reflect));var N,R,J,he=new f,Oe={registerProvider:Fe,getProvider:ge,setProvider:xe};return Oe;function Fe(Ce){if(!Object.isExtensible(Oe))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case P===Ce:break;case H(N):N=Ce;break;case N===Ce:break;case H(R):R=Ce;break;case R===Ce:break;default:J===void 0&&(J=new m),J.add(Ce);break}}function Ee(Ce,Ye){if(!H(N)){if(N.isProviderFor(Ce,Ye))return N;if(!H(R)){if(R.isProviderFor(Ce,Ye))return N;if(!H(J))for(var Nt=eo(J);;){var Jt=ws(Nt);if(!Jt)return;var vs=pe(Jt);if(vs.isProviderFor(Ce,Ye))return to(Nt),vs}}}if(!H(P)&&P.isProviderFor(Ce,Ye))return P}function ge(Ce,Ye){var Nt=he.get(Ce),Jt;return H(Nt)||(Jt=Nt.get(Ye)),H(Jt)&&(Jt=Ee(Ce,Ye),H(Jt)||(H(Nt)&&(Nt=new p,he.set(Ce,Nt)),Nt.set(Ye,Jt))),Jt}function ve(Ce){if(H(Ce))throw new TypeError;return N===Ce||R===Ce||!H(J)&&J.has(Ce)}function xe(Ce,Ye,Nt){if(!ve(Nt))throw new Error("Metadata provider not registered.");var Jt=ge(Ce,Ye);if(Jt!==Nt){if(!H(Jt))return!1;var vs=he.get(Ce);H(vs)&&(vs=new p,he.set(Ce,vs)),vs.set(Ye,Nt)}return!0}}function Wc(){var P;return!H(g)&&de(t.Reflect)&&Object.isExtensible(t.Reflect)&&(P=t.Reflect[g]),H(P)&&(P=bn()),!H(g)&&de(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,g,{enumerable:!1,configurable:!1,writable:!1,value:P}),P}function $A(P){var N=new f,R={isProviderFor:function(ve,xe){var Ce=N.get(ve);return H(Ce)?!1:Ce.has(xe)},OrdinaryDefineOwnMetadata:Fe,OrdinaryHasOwnMetadata:he,OrdinaryGetOwnMetadata:Oe,OrdinaryOwnMetadataKeys:Ee,OrdinaryDeleteMetadata:ge};return v.registerProvider(R),R;function J(ve,xe,Ce){var Ye=N.get(ve),Nt=!1;if(H(Ye)){if(!Ce)return;Ye=new p,N.set(ve,Ye),Nt=!0}var Jt=Ye.get(xe);if(H(Jt)){if(!Ce)return;if(Jt=new p,Ye.set(xe,Jt),!P.setProvider(ve,xe,R))throw Ye.delete(xe),Nt&&N.delete(ve),new Error("Wrong provider for target.")}return Jt}function he(ve,xe,Ce){var Ye=J(xe,Ce,!1);return H(Ye)?!1:Me(Ye.has(ve))}function Oe(ve,xe,Ce){var Ye=J(xe,Ce,!1);if(!H(Ye))return Ye.get(ve)}function Fe(ve,xe,Ce,Ye){var Nt=J(Ce,Ye,!0);Nt.set(ve,xe)}function Ee(ve,xe){var Ce=[],Ye=J(ve,xe,!1);if(H(Ye))return Ce;for(var Nt=Ye.keys(),Jt=eo(Nt),vs=0;;){var jH=ws(Jt);if(!jH)return Ce.length=vs,Ce;var tCe=pe(jH);try{Ce[vs]=tCe}catch(rCe){try{to(Jt)}finally{throw rCe}}vs++}}function ge(ve,xe,Ce){var Ye=J(xe,Ce,!1);if(H(Ye)||!Ye.delete(ve))return!1;if(Ye.size===0){var Nt=N.get(xe);H(Nt)||(Nt.delete(Ce),Nt.size===0&&N.delete(Nt))}return!0}}function ro(P){var N=P.defineMetadata,R=P.hasOwnMetadata,J=P.getOwnMetadata,he=P.getOwnMetadataKeys,Oe=P.deleteMetadata,Fe=new f,Ee={isProviderFor:function(ge,ve){var xe=Fe.get(ge);return!H(xe)&&xe.has(ve)?!0:he(ge,ve).length?(H(xe)&&(xe=new m,Fe.set(ge,xe)),xe.add(ve),!0):!1},OrdinaryDefineOwnMetadata:N,OrdinaryHasOwnMetadata:R,OrdinaryGetOwnMetadata:J,OrdinaryOwnMetadataKeys:he,OrdinaryDeleteMetadata:Oe};return Ee}function _u(P,N,R){var J=v.getProvider(P,N);if(!H(J))return J;if(R){if(v.setProvider(P,N,y))return y;throw new Error("Illegal state.")}}function D(){var P={},N=[],R=function(){function Ee(ge,ve,xe){this._index=0,this._keys=ge,this._values=ve,this._selector=xe}return Ee.prototype["@@iterator"]=function(){return this},Ee.prototype[o]=function(){return this},Ee.prototype.next=function(){var ge=this._index;if(ge>=0&&ge<this._keys.length){var ve=this._selector(this._keys[ge],this._values[ge]);return ge+1>=this._keys.length?(this._index=-1,this._keys=N,this._values=N):this._index++,{value:ve,done:!1}}return{value:void 0,done:!0}},Ee.prototype.throw=function(ge){throw this._index>=0&&(this._index=-1,this._keys=N,this._values=N),ge},Ee.prototype.return=function(ge){return this._index>=0&&(this._index=-1,this._keys=N,this._values=N),{value:ge,done:!0}},Ee}(),J=function(){function Ee(){this._keys=[],this._values=[],this._cacheKey=P,this._cacheIndex=-2}return Object.defineProperty(Ee.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Ee.prototype.has=function(ge){return this._find(ge,!1)>=0},Ee.prototype.get=function(ge){var ve=this._find(ge,!1);return ve>=0?this._values[ve]:void 0},Ee.prototype.set=function(ge,ve){var xe=this._find(ge,!0);return this._values[xe]=ve,this},Ee.prototype.delete=function(ge){var ve=this._find(ge,!1);if(ve>=0){for(var xe=this._keys.length,Ce=ve+1;Ce<xe;Ce++)this._keys[Ce-1]=this._keys[Ce],this._values[Ce-1]=this._values[Ce];return this._keys.length--,this._values.length--,Nr(ge,this._cacheKey)&&(this._cacheKey=P,this._cacheIndex=-2),!0}return!1},Ee.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=P,this._cacheIndex=-2},Ee.prototype.keys=function(){return new R(this._keys,this._values,he)},Ee.prototype.values=function(){return new R(this._keys,this._values,Oe)},Ee.prototype.entries=function(){return new R(this._keys,this._values,Fe)},Ee.prototype["@@iterator"]=function(){return this.entries()},Ee.prototype[o]=function(){return this.entries()},Ee.prototype._find=function(ge,ve){if(!Nr(this._cacheKey,ge)){this._cacheIndex=-1;for(var xe=0;xe<this._keys.length;xe++)if(Nr(this._keys[xe],ge)){this._cacheIndex=xe;break}}return this._cacheIndex<0&&ve&&(this._cacheIndex=this._keys.length,this._keys.push(ge),this._values.push(void 0)),this._cacheIndex},Ee}();return J;function he(Ee,ge){return Ee}function Oe(Ee,ge){return ge}function Fe(Ee,ge){return[Ee,ge]}}function S(){var P=function(){function N(){this._map=new p}return Object.defineProperty(N.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),N.prototype.has=function(R){return this._map.has(R)},N.prototype.add=function(R){return this._map.set(R,R),this},N.prototype.delete=function(R){return this._map.delete(R)},N.prototype.clear=function(){this._map.clear()},N.prototype.keys=function(){return this._map.keys()},N.prototype.values=function(){return this._map.keys()},N.prototype.entries=function(){return this._map.entries()},N.prototype["@@iterator"]=function(){return this.keys()},N.prototype[o]=function(){return this.keys()},N}();return P}function C(){var P=16,N=d.create(),R=J();return function(){function ge(){this._key=J()}return ge.prototype.has=function(ve){var xe=he(ve,!1);return xe!==void 0?d.has(xe,this._key):!1},ge.prototype.get=function(ve){var xe=he(ve,!1);return xe!==void 0?d.get(xe,this._key):void 0},ge.prototype.set=function(ve,xe){var Ce=he(ve,!0);return Ce[this._key]=xe,this},ge.prototype.delete=function(ve){var xe=he(ve,!1);return xe!==void 0?delete xe[this._key]:!1},ge.prototype.clear=function(){this._key=J()},ge}();function J(){var ge;do ge="@@WeakMap@@"+Ee();while(d.has(N,ge));return N[ge]=!0,ge}function he(ge,ve){if(!n.call(ge,R)){if(!ve)return;Object.defineProperty(ge,R,{value:d.create()})}return ge[R]}function Oe(ge,ve){for(var xe=0;xe<ve;++xe)ge[xe]=Math.random()*255|0;return ge}function Fe(ge){if(typeof Uint8Array=="function"){var ve=new Uint8Array(ge);return typeof crypto<"u"?crypto.getRandomValues(ve):typeof msCrypto<"u"?msCrypto.getRandomValues(ve):Oe(ve,ge),ve}return Oe(new Array(ge),ge)}function Ee(){var ge=Fe(P);ge[6]=ge[6]&79|64,ge[8]=ge[8]&191|128;for(var ve="",xe=0;xe<P;++xe){var Ce=ge[xe];(xe===4||xe===6||xe===8)&&(ve+="-"),Ce<16&&(ve+="0"),ve+=Ce.toString(16).toLowerCase()}return ve}}function M(P){return P.__=void 0,delete P.__,P}})})(kF||(kF={}));var X;(function(r){r[r.Sequence=0]="Sequence",r[r.Set=1]="Set",r[r.Choice=2]="Choice"})(X||(X={}));var F;(function(r){r[r.Any=1]="Any",r[r.Boolean=2]="Boolean",r[r.OctetString=3]="OctetString",r[r.BitString=4]="BitString",r[r.Integer=5]="Integer",r[r.Enumerated=6]="Enumerated",r[r.ObjectIdentifier=7]="ObjectIdentifier",r[r.Utf8String=8]="Utf8String",r[r.BmpString=9]="BmpString",r[r.UniversalString=10]="UniversalString",r[r.NumericString=11]="NumericString",r[r.PrintableString=12]="PrintableString",r[r.TeletexString=13]="TeletexString",r[r.VideotexString=14]="VideotexString",r[r.IA5String=15]="IA5String",r[r.GraphicString=16]="GraphicString",r[r.VisibleString=17]="VisibleString",r[r.GeneralString=18]="GeneralString",r[r.CharacterString=19]="CharacterString",r[r.UTCTime=20]="UTCTime",r[r.GeneralizedTime=21]="GeneralizedTime",r[r.DATE=22]="DATE",r[r.TimeOfDay=23]="TimeOfDay",r[r.DateTime=24]="DateTime",r[r.Duration=25]="Duration",r[r.TIME=26]="TIME",r[r.Null=27]="Null"})(F||(F={}));class X3{constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if(typeof e=="number")this.fromNumber(e);else if(ue.isBufferSource(e))this.unusedBits=t,this.value=ue.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof iu))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new iu({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new iu({name:e})}toNumber(){let e="";const t=new Uint8Array(this.value);for(const n of t)e+=n.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2);const n=t.length+7>>3;this.unusedBits=(n<<3)-t.length;const i=new Uint8Array(n);t=t.padStart(n<<3,"0").split("").reverse().join("");let s=0;for(;s<n;)i[s]=parseInt(t.slice(s<<3,(s<<3)+8),2),s++;this.value=i.buffer}}class tt{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){typeof e=="number"?this.buffer=new ArrayBuffer(e):ue.isBufferSource(e)?this.buffer=ue.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof us))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new us({valueHex:this.buffer})}toSchema(e){return new us({name:e})}}const W6e={fromASN:r=>r instanceof Qo?null:r.valueBeforeDecodeView,toASN:r=>{if(r===null)return new Qo;const e=Go(r);if(e.result.error)throw new Error(e.result.error);return e.result}},G6e={fromASN:r=>r.valueBlock.valueHexView.byteLength>=4?r.valueBlock.toString():r.valueBlock.valueDec,toASN:r=>new Yo({value:+r})},Q6e={fromASN:r=>r.valueBlock.valueDec,toASN:r=>new R3({value:r})},Dt={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Yo({valueHex:r})},Y6e={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new iu({valueHex:r})},J6e={fromASN:r=>r.valueBlock.toString(),toASN:r=>new Jo({value:r})},X6e={fromASN:r=>r.valueBlock.value,toASN:r=>new O3({value:r})},Z3={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new us({valueHex:r})},Z6e={fromASN:r=>new tt(r.getValue()),toASN:r=>r.toASN()};function $i(r){return{fromASN:e=>e.valueBlock.value,toASN:e=>new r({value:e})}}const _F=$i(Zo),ebe=$i(L3),tbe=$i(B3),rbe=$i(U3),nbe=$i(F3),ibe=$i(z3),sbe=$i(V3),obe=$i(K3),abe=$i(j3),cbe=$i(vp),lbe=$i(H3),ube=$i(q3),dbe={fromASN:r=>r.toDate(),toASN:r=>new Ep({valueDate:r})},hbe={fromASN:r=>r.toDate(),toASN:r=>new W3({valueDate:r})},fbe={fromASN:()=>null,toASN:()=>new Qo};function WE(r){switch(r){case F.Any:return W6e;case F.BitString:return Y6e;case F.BmpString:return ebe;case F.Boolean:return X6e;case F.CharacterString:return ube;case F.Enumerated:return Q6e;case F.GeneralString:return lbe;case F.GeneralizedTime:return hbe;case F.GraphicString:return abe;case F.IA5String:return obe;case F.Integer:return G6e;case F.Null:return fbe;case F.NumericString:return rbe;case F.ObjectIdentifier:return J6e;case F.OctetString:return Z3;case F.PrintableString:return nbe;case F.TeletexString:return ibe;case F.UTCTime:return dbe;case F.UniversalString:return tbe;case F.Utf8String:return _F;case F.VideotexString:return sbe;case F.VisibleString:return cbe;default:return null}}function ea(r){return typeof r=="function"&&r.prototype?r.prototype.toASN&&r.prototype.fromASN?!0:ea(r.prototype):!!(r&&typeof r=="object"&&"toASN"in r&&"fromASN"in r)}function TF(r){var e;if(r){const t=Object.getPrototypeOf(r);return((e=t==null?void 0:t.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:TF(t)}return!1}function pbe(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<r.byteLength;i++)if(t[i]!==n[i])return!1;return!0}class gbe{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){const n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!n.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return n}cache(e){const t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){const t={type:X.Sequence,items:{}},n=this.findParentSchema(e);return n&&(Object.assign(t,n),t.items=Object.assign({},t.items,n.items)),t}create(e,t){const n=this.items.get(e)||this.createDefault(e),i=[];for(const s in n.items){const o=n.items[s],a=t?s:"";let c;if(typeof o.type=="number"){const d=F[o.type],h=tF[d];if(!h)throw new Error(`Cannot get ASN1 class by name '${d}'`);c=new h({name:a})}else ea(o.type)?c=new o.type().toSchema(a):o.optional?this.get(o.type).type===X.Choice?c=new su({name:a}):(c=this.create(o.type,!1),c.name=a):c=new su({name:a});const l=!!o.optional||o.defaultValue!==void 0;if(o.repeated){c.name="";const d=o.repeated==="set"?Xo:yr;c=new d({name:"",value:[new G3({name:a,value:c})]})}if(o.context!==null&&o.context!==void 0)if(o.implicit)if(typeof o.type=="number"||ea(o.type)){const d=o.repeated?Pn:wp;i.push(new d({name:a,optional:l,idBlock:{tagClass:3,tagNumber:o.context}}))}else{this.cache(o.type);const d=!!o.repeated;let h=d?c:this.get(o.type,!0).schema;h="valueBlock"in h?h.valueBlock.value:h.value,i.push(new Pn({name:d?"":a,optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:h}))}else i.push(new Pn({optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:[c]}));else c.optional=l,i.push(c)}switch(n.type){case X.Sequence:return new yr({value:i,name:""});case X.Set:return new Xo({value:i,name:""});case X.Choice:return new NE({value:i,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){const t=Object.getPrototypeOf(e);return t?this.items.get(t)||this.findParentSchema(t):null}}const Ni=new gbe,te=r=>e=>{let t;Ni.has(e)?t=Ni.get(e):(t=Ni.createDefault(e),Ni.set(e,t)),Object.assign(t,r)},$=r=>(e,t)=>{let n;Ni.has(e.constructor)?n=Ni.get(e.constructor):(n=Ni.createDefault(e.constructor),Ni.set(e.constructor,n));const i=Object.assign({},r);if(typeof i.type=="number"&&!i.converter){const s=WE(r.type);if(!s)throw new Error(`Cannot get default converter for property '${t}' of ${e.constructor.name}`);i.converter=s}n.items[t]=i};class PF extends Error{constructor(){super(...arguments),this.schemas=[]}}class ybe{static parse(e,t){const n=Go(e);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,t)}static fromASN(e,t){var n;try{if(ea(t))return new t().fromASN(e);const i=Ni.get(t);Ni.cache(t);let s=i.schema;if(e.constructor===Pn&&i.type!==X.Choice){s=new Pn({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:i.schema.valueBlock.value});for(const c in i.items)delete e[c]}const o=ou({},e,s);if(!o.verified)throw new PF(`Data does not match to ${t.name} ASN1 schema. ${o.result.error}`);const a=new t;if(TF(t)){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const c=i.itemType;if(typeof c=="number"){const l=WE(c);if(!l)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);return t.from(e.valueBlock.value,d=>l.fromASN(d))}else return t.from(e.valueBlock.value,l=>this.fromASN(l,c))}for(const c in i.items){const l=o.result[c];if(!l)continue;const d=i.items[c],h=d.type;if(typeof h=="number"||ea(h)){const p=(n=d.converter)!==null&&n!==void 0?n:ea(h)?new h:null;if(!p)throw new Error("Converter is empty");if(d.repeated)if(d.implicit){const m=d.repeated==="sequence"?yr:Xo,f=new m;f.valueBlock=l.valueBlock;const g=Go(f.toBER(!1));if(g.offset===-1)throw new Error(`Cannot parse the child item. ${g.result.error}`);if(!("value"in g.result.valueBlock&&Array.isArray(g.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const v=g.result.valueBlock.value;a[c]=Array.from(v,y=>p.fromASN(y))}else a[c]=Array.from(l,m=>p.fromASN(m));else{let m=l;if(d.implicit){let f;if(ea(h))f=new h().toSchema("");else{const g=F[h],v=tF[g];if(!v)throw new Error(`Cannot get '${g}' class from asn1js module`);f=new v}f.valueBlock=m.valueBlock,m=Go(f.toBER(!1)).result}a[c]=p.fromASN(m)}}else if(d.repeated){if(!Array.isArray(l))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");a[c]=Array.from(l,p=>this.fromASN(p,h))}else a[c]=this.fromASN(l,h)}return a}catch(i){throw i instanceof PF&&i.schemas.push(t.name),i}}}class GE{static serialize(e){return e instanceof Cr?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&typeof e=="object"&&ea(e))return e.toASN();if(!(e&&typeof e=="object"))throw new TypeError("Parameter 1 should be type of Object.");const t=e.constructor,n=Ni.get(t);Ni.cache(t);let i=[];if(n.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if(typeof n.itemType=="number"){const o=WE(n.itemType);if(!o)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);i=e.map(a=>o.toASN(a))}else i=e.map(o=>this.toAsnItem({type:n.itemType},"[]",t,o))}else for(const o in n.items){const a=n.items[o],c=e[o];if(c===void 0||a.defaultValue===c||typeof a.defaultValue=="object"&&typeof c=="object"&&pbe(this.serialize(a.defaultValue),this.serialize(c)))continue;const l=GE.toAsnItem(a,o,t,c);if(typeof a.context=="number")if(a.implicit)if(!a.repeated&&(typeof a.type=="number"||ea(a.type))){const d={};d.valueHex=l instanceof Qo?l.valueBeforeDecodeView:l.valueBlock.toBER(),i.push(new wp({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},...d}))}else i.push(new Pn({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:l.valueBlock.value}));else i.push(new Pn({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:[l]}));else a.repeated?i=i.concat(l):i.push(l)}let s;switch(n.type){case X.Sequence:s=new yr({value:i});break;case X.Set:s=new Xo({value:i});break;case X.Choice:if(!i[0])throw new Error(`Schema '${t.name}' has wrong data. Choice cannot be empty.`);s=i[0];break}return s}static toAsnItem(e,t,n,i){let s;if(typeof e.type=="number"){const o=e.converter;if(!o)throw new Error(`Property '${t}' doesn't have converter for type ${F[e.type]} in schema '${n.name}'`);if(e.repeated){if(!Array.isArray(i))throw new TypeError("Parameter 'objProp' should be type of Array.");const a=Array.from(i,l=>o.toASN(l)),c=e.repeated==="sequence"?yr:Xo;s=new c({value:a})}else s=o.toASN(i)}else if(e.repeated){if(!Array.isArray(i))throw new TypeError("Parameter 'objProp' should be type of Array.");const o=Array.from(i,c=>this.toASN(c)),a=e.repeated==="sequence"?yr:Xo;s=new a({value:o})}else s=this.toASN(i);return s}}class ht extends Array{constructor(e=[]){if(typeof e=="number")super(e);else{super();for(const t of e)this.push(t)}}}class ae{static serialize(e){return GE.serialize(e)}static parse(e,t){return ybe.parse(e,t)}static toString(e){const t=ue.isBufferSource(e)?ue.toArrayBuffer(e):ae.serialize(e),n=Go(t);if(n.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${n.result.error}`);return n.result.toString()}}function _(r,e,t,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}typeof SuppressedError=="function"&&SuppressedError;class DF{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){const t=e.split(".");if(t.length!==4)throw new Error("Invalid IPv4 address");return t.map(n=>{const i=parseInt(n,10);if(isNaN(i)||i<0||i>255)throw new Error("Invalid IPv4 address part");return i})}static parseIPv6(e){const n=this.expandIPv6(e).split(":");if(n.length!==8)throw new Error("Invalid IPv6 address");return n.reduce((i,s)=>{const o=parseInt(s,16);if(isNaN(o)||o<0||o>65535)throw new Error("Invalid IPv6 address part");return i.push(o>>8&255),i.push(o&255),i},[])}static expandIPv6(e){if(!e.includes("::"))return e;const t=e.split("::");if(t.length>2)throw new Error("Invalid IPv6 address");const n=t[0]?t[0].split(":"):[],i=t[1]?t[1].split(":"):[],s=8-(n.length+i.length);if(s<0)throw new Error("Invalid IPv6 address");return[...n,...Array(s).fill("0"),...i].join(":")}static formatIPv6(e){const t=[];for(let n=0;n<16;n+=2)t.push((e[n]<<8|e[n+1]).toString(16));return this.compressIPv6(t.join(":"))}static compressIPv6(e){const t=e.split(":");let n=-1,i=0,s=-1,o=0;for(let a=0;a<t.length;a++)t[a]==="0"?(s===-1&&(s=a),o++):(o>i&&(n=s,i=o),s=-1,o=0);if(o>i&&(n=s,i=o),i>1){const a=t.slice(0,n).join(":"),c=t.slice(n+i).join(":");return`${a}::${c}`}return e}static parseCIDR(e){const[t,n]=e.split("/"),i=parseInt(n,10);if(this.isIPv4(t)){if(i<0||i>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(t),i]}else{if(i<0||i>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(t),i]}}static decodeIP(e){if(e.length===64&&parseInt(e,16)===0)return"::/0";if(e.length!==16)return e;const t=parseInt(e.slice(8),16).toString(2).split("").reduce((i,s)=>i+ +s,0);let n=e.slice(0,8).replace(/(.{2})/g,i=>`${parseInt(i,16)}.`);return n=n.slice(0,-1),`${n}/${t}`}static toString(e){const t=new Uint8Array(e);if(t.length===4)return Array.from(t).join(".");if(t.length===16)return this.formatIPv6(t);if(t.length===8||t.length===32){const n=t.length/2,i=t.slice(0,n),s=t.slice(n);if(t.every(c=>c===0))return t.length===8?"0.0.0.0/0":"::/0";const a=s.reduce((c,l)=>c+(l.toString(2).match(/1/g)||[]).length,0);return t.length===8?`${Array.from(i).join(".")}/${a}`:`${this.formatIPv6(i)}/${a}`}return this.decodeIP(Se.ToHex(e))}static fromString(e){if(e.includes("/")){const[n,i]=this.parseCIDR(e),s=new Uint8Array(n.length);let o=i;for(let c=0;c<s.length;c++)o>=8?(s[c]=255,o-=8):o>0&&(s[c]=255<<8-o,o=0);const a=new Uint8Array(n.length*2);return a.set(n,0),a.set(s,n.length),a.buffer}const t=this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e);return new Uint8Array(t).buffer}}var QE,YE,JE;let kr=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};_([$({type:F.TeletexString})],kr.prototype,"teletexString",void 0),_([$({type:F.PrintableString})],kr.prototype,"printableString",void 0),_([$({type:F.UniversalString})],kr.prototype,"universalString",void 0),_([$({type:F.Utf8String})],kr.prototype,"utf8String",void 0),_([$({type:F.BmpString})],kr.prototype,"bmpString",void 0),kr=_([te({type:X.Choice})],kr);let gh=class extends kr{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?Se.ToHex(this.anyValue):super.toString())}};_([$({type:F.IA5String})],gh.prototype,"ia5String",void 0),_([$({type:F.Any})],gh.prototype,"anyValue",void 0),gh=_([te({type:X.Choice})],gh);class ew{constructor(e={}){this.type="",this.value=new gh,Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],ew.prototype,"type",void 0),_([$({type:gh})],ew.prototype,"value",void 0);let yh=QE=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,QE.prototype)}};yh=QE=_([te({type:X.Set,itemType:ew})],yh);let XE=YE=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,YE.prototype)}};XE=YE=_([te({type:X.Sequence,itemType:yh})],XE);let Yt=JE=class extends XE{constructor(e){super(e),Object.setPrototypeOf(this,JE.prototype)}};Yt=JE=_([te({type:X.Sequence})],Yt);const mbe={fromASN:r=>DF.toString(Z3.fromASN(r)),toASN:r=>Z3.toASN(DF.fromString(r))};class Cp{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],Cp.prototype,"typeId",void 0),_([$({type:F.Any,context:0})],Cp.prototype,"value",void 0);class ZE{constructor(e={}){this.partyName=new kr,Object.assign(this,e)}}_([$({type:kr,optional:!0,context:0,implicit:!0})],ZE.prototype,"nameAssigner",void 0),_([$({type:kr,context:1,implicit:!0})],ZE.prototype,"partyName",void 0);let Ue=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Cp,context:0,implicit:!0})],Ue.prototype,"otherName",void 0),_([$({type:F.IA5String,context:1,implicit:!0})],Ue.prototype,"rfc822Name",void 0),_([$({type:F.IA5String,context:2,implicit:!0})],Ue.prototype,"dNSName",void 0),_([$({type:F.Any,context:3,implicit:!0})],Ue.prototype,"x400Address",void 0),_([$({type:Yt,context:4,implicit:!1})],Ue.prototype,"directoryName",void 0),_([$({type:ZE,context:5})],Ue.prototype,"ediPartyName",void 0),_([$({type:F.IA5String,context:6,implicit:!0})],Ue.prototype,"uniformResourceIdentifier",void 0),_([$({type:F.OctetString,context:7,implicit:!0,converter:mbe})],Ue.prototype,"iPAddress",void 0),_([$({type:F.ObjectIdentifier,context:8,implicit:!0})],Ue.prototype,"registeredID",void 0),Ue=_([te({type:X.Choice})],Ue);const eS="1.3.6.1.5.5.7",wbe=`${eS}.1`,mh=`${eS}.3`,tw=`${eS}.48`,$F=`${tw}.1`,NF=`${tw}.2`,MF=`${tw}.3`,OF=`${tw}.5`,Oc="2.5.29";var tS;const rS=`${wbe}.1`;class Ip{constructor(e={}){this.accessMethod="",this.accessLocation=new Ue,Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],Ip.prototype,"accessMethod",void 0),_([$({type:Ue})],Ip.prototype,"accessLocation",void 0);let wh=tS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,tS.prototype)}};wh=tS=_([te({type:X.Sequence,itemType:Ip})],wh);const nS=`${Oc}.35`;class iS extends tt{}class lu{constructor(e={}){e&&Object.assign(this,e)}}_([$({type:iS,context:0,optional:!0,implicit:!0})],lu.prototype,"keyIdentifier",void 0),_([$({type:Ue,context:1,optional:!0,implicit:!0,repeated:"sequence"})],lu.prototype,"authorityCertIssuer",void 0),_([$({type:F.Integer,context:2,optional:!0,implicit:!0,converter:Dt})],lu.prototype,"authorityCertSerialNumber",void 0);const RF=`${Oc}.19`;class rw{constructor(e={}){this.cA=!1,Object.assign(this,e)}}_([$({type:F.Boolean,defaultValue:!1})],rw.prototype,"cA",void 0),_([$({type:F.Integer,optional:!0})],rw.prototype,"pathLenConstraint",void 0);var sS;let yn=sS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,sS.prototype)}};yn=sS=_([te({type:X.Sequence,itemType:Ue})],yn);var oS;let LF=oS=class extends yn{constructor(e){super(e),Object.setPrototypeOf(this,oS.prototype)}};LF=oS=_([te({type:X.Sequence})],LF);var aS;const BF=`${Oc}.32`;let ta=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};_([$({type:F.IA5String})],ta.prototype,"ia5String",void 0),_([$({type:F.VisibleString})],ta.prototype,"visibleString",void 0),_([$({type:F.BmpString})],ta.prototype,"bmpString",void 0),_([$({type:F.Utf8String})],ta.prototype,"utf8String",void 0),ta=_([te({type:X.Choice})],ta);class cS{constructor(e={}){this.organization=new ta,this.noticeNumbers=[],Object.assign(this,e)}}_([$({type:ta})],cS.prototype,"organization",void 0),_([$({type:F.Integer,repeated:"sequence"})],cS.prototype,"noticeNumbers",void 0);class lS{constructor(e={}){Object.assign(this,e)}}_([$({type:cS,optional:!0})],lS.prototype,"noticeRef",void 0),_([$({type:ta,optional:!0})],lS.prototype,"explicitText",void 0);let nw=class{constructor(e={}){Object.assign(this,e)}};_([$({type:F.IA5String})],nw.prototype,"cPSuri",void 0),_([$({type:lS})],nw.prototype,"userNotice",void 0),nw=_([te({type:X.Choice})],nw);class uS{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],uS.prototype,"policyQualifierId",void 0),_([$({type:F.Any})],uS.prototype,"qualifier",void 0);class iw{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],iw.prototype,"policyIdentifier",void 0),_([$({type:uS,repeated:"sequence",optional:!0})],iw.prototype,"policyQualifiers",void 0);let sw=aS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,aS.prototype)}};sw=aS=_([te({type:X.Sequence,itemType:iw})],sw);let ow=class{constructor(e=0){this.value=e}};_([$({type:F.Integer})],ow.prototype,"value",void 0),ow=_([te({type:X.Choice})],ow);let UF=class extends ow{};UF=_([te({type:X.Choice})],UF);var dS;const hS=`${Oc}.31`;var hs;(function(r){r[r.unused=1]="unused",r[r.keyCompromise=2]="keyCompromise",r[r.cACompromise=4]="cACompromise",r[r.affiliationChanged=8]="affiliationChanged",r[r.superseded=16]="superseded",r[r.cessationOfOperation=32]="cessationOfOperation",r[r.certificateHold=64]="certificateHold",r[r.privilegeWithdrawn=128]="privilegeWithdrawn",r[r.aACompromise=256]="aACompromise"})(hs||(hs={}));class FF extends X3{toJSON(){const e=[],t=this.toNumber();return t&hs.aACompromise&&e.push("aACompromise"),t&hs.affiliationChanged&&e.push("affiliationChanged"),t&hs.cACompromise&&e.push("cACompromise"),t&hs.certificateHold&&e.push("certificateHold"),t&hs.cessationOfOperation&&e.push("cessationOfOperation"),t&hs.keyCompromise&&e.push("keyCompromise"),t&hs.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&hs.superseded&&e.push("superseded"),t&hs.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}}let uu=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Ue,context:0,repeated:"sequence",implicit:!0})],uu.prototype,"fullName",void 0),_([$({type:yh,context:1,implicit:!0})],uu.prototype,"nameRelativeToCRLIssuer",void 0),uu=_([te({type:X.Choice})],uu);class bh{constructor(e={}){Object.assign(this,e)}}_([$({type:uu,context:0,optional:!0})],bh.prototype,"distributionPoint",void 0),_([$({type:FF,context:1,optional:!0,implicit:!0})],bh.prototype,"reasons",void 0),_([$({type:Ue,context:2,optional:!0,repeated:"sequence",implicit:!0})],bh.prototype,"cRLIssuer",void 0);let vh=dS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,dS.prototype)}};vh=dS=_([te({type:X.Sequence,itemType:bh})],vh);var fS;let zF=fS=class extends vh{constructor(e){super(e),Object.setPrototypeOf(this,fS.prototype)}};zF=fS=_([te({type:X.Sequence,itemType:bh})],zF);class Kr{constructor(e={}){this.onlyContainsUserCerts=Kr.ONLY,this.onlyContainsCACerts=Kr.ONLY,this.indirectCRL=Kr.ONLY,this.onlyContainsAttributeCerts=Kr.ONLY,Object.assign(this,e)}}Kr.ONLY=!1,_([$({type:uu,context:0,optional:!0})],Kr.prototype,"distributionPoint",void 0),_([$({type:F.Boolean,context:1,defaultValue:Kr.ONLY,implicit:!0})],Kr.prototype,"onlyContainsUserCerts",void 0),_([$({type:F.Boolean,context:2,defaultValue:Kr.ONLY,implicit:!0})],Kr.prototype,"onlyContainsCACerts",void 0),_([$({type:FF,context:3,optional:!0,implicit:!0})],Kr.prototype,"onlySomeReasons",void 0),_([$({type:F.Boolean,context:4,defaultValue:Kr.ONLY,implicit:!0})],Kr.prototype,"indirectCRL",void 0),_([$({type:F.Boolean,context:5,defaultValue:Kr.ONLY,implicit:!0})],Kr.prototype,"onlyContainsAttributeCerts",void 0);var kp;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(kp||(kp={}));let pS=class{constructor(e=kp.unspecified){this.reason=kp.unspecified,this.reason=e}toJSON(){return kp[this.reason]}toString(){return this.toJSON()}};_([$({type:F.Enumerated})],pS.prototype,"reason",void 0),pS=_([te({type:X.Choice})],pS);var gS;const VF=`${Oc}.37`;let aw=gS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,gS.prototype)}};aw=gS=_([te({type:X.Sequence,itemType:F.ObjectIdentifier})],aw);const bbe=`${mh}.1`,vbe=`${mh}.2`,Ebe=`${mh}.3`,Sbe=`${mh}.4`,xbe=`${mh}.8`,Abe=`${mh}.9`;let yS=class{constructor(e=new ArrayBuffer(0)){this.value=e}};_([$({type:F.Integer,converter:Dt})],yS.prototype,"value",void 0),yS=_([te({type:X.Choice})],yS);let mS=class{constructor(e){this.value=new Date,e&&(this.value=e)}};_([$({type:F.GeneralizedTime})],mS.prototype,"value",void 0),mS=_([te({type:X.Choice})],mS);var wS;let KF=wS=class extends yn{constructor(e){super(e),Object.setPrototypeOf(this,wS.prototype)}};KF=wS=_([te({type:X.Sequence})],KF);const jF=`${Oc}.15`;var fs;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(fs||(fs={}));class bS extends X3{toJSON(){const e=this.toNumber(),t=[];return e&fs.cRLSign&&t.push("crlSign"),e&fs.dataEncipherment&&t.push("dataEncipherment"),e&fs.decipherOnly&&t.push("decipherOnly"),e&fs.digitalSignature&&t.push("digitalSignature"),e&fs.encipherOnly&&t.push("encipherOnly"),e&fs.keyAgreement&&t.push("keyAgreement"),e&fs.keyCertSign&&t.push("keyCertSign"),e&fs.keyEncipherment&&t.push("keyEncipherment"),e&fs.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}}var vS;class cw{constructor(e={}){this.base=new Ue,this.minimum=0,Object.assign(this,e)}}_([$({type:Ue})],cw.prototype,"base",void 0),_([$({type:F.Integer,context:0,defaultValue:0,implicit:!0})],cw.prototype,"minimum",void 0),_([$({type:F.Integer,context:1,optional:!0,implicit:!0})],cw.prototype,"maximum",void 0);let lw=vS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,vS.prototype)}};lw=vS=_([te({type:X.Sequence,itemType:cw})],lw);class HF{constructor(e={}){Object.assign(this,e)}}_([$({type:lw,context:0,optional:!0,implicit:!0})],HF.prototype,"permittedSubtrees",void 0),_([$({type:lw,context:1,optional:!0,implicit:!0})],HF.prototype,"excludedSubtrees",void 0);class qF{constructor(e={}){Object.assign(this,e)}}_([$({type:F.Integer,context:0,implicit:!0,optional:!0,converter:Dt})],qF.prototype,"requireExplicitPolicy",void 0),_([$({type:F.Integer,context:1,implicit:!0,optional:!0,converter:Dt})],qF.prototype,"inhibitPolicyMapping",void 0);var ES;class SS{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],SS.prototype,"issuerDomainPolicy",void 0),_([$({type:F.ObjectIdentifier})],SS.prototype,"subjectDomainPolicy",void 0);let WF=ES=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,ES.prototype)}};WF=ES=_([te({type:X.Sequence,itemType:SS})],WF);var xS;const GF=`${Oc}.17`;let AS=xS=class extends yn{constructor(e){super(e),Object.setPrototypeOf(this,xS.prototype)}};AS=xS=_([te({type:X.Sequence})],AS);let ra=class{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}};_([$({type:F.ObjectIdentifier})],ra.prototype,"type",void 0),_([$({type:F.Any,repeated:"set"})],ra.prototype,"values",void 0);var CS;let QF=CS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,CS.prototype)}};QF=CS=_([te({type:X.Sequence,itemType:ra})],QF);const YF=`${Oc}.14`;class Rc extends iS{}class JF{constructor(e={}){Object.assign(this,e)}}_([$({type:F.GeneralizedTime,context:0,implicit:!0,optional:!0})],JF.prototype,"notBefore",void 0),_([$({type:F.GeneralizedTime,context:1,implicit:!0,optional:!0})],JF.prototype,"notAfter",void 0);var _p;(function(r){r[r.keyUpdateAllowed=1]="keyUpdateAllowed",r[r.newExtensions=2]="newExtensions",r[r.pKIXCertificate=4]="pKIXCertificate"})(_p||(_p={}));class XF extends X3{toJSON(){const e=[],t=this.toNumber();return t&_p.pKIXCertificate&&e.push("pKIXCertificate"),t&_p.newExtensions&&e.push("newExtensions"),t&_p.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}}class ZF{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new XF,Object.assign(this,e)}}_([$({type:F.GeneralString})],ZF.prototype,"entrustVers",void 0),_([$({type:XF})],ZF.prototype,"entrustInfoFlags",void 0);var IS;let ez=IS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,IS.prototype)}};ez=IS=_([te({type:X.Sequence,itemType:Ip})],ez);class ye{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof ye&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&rU(e.parameters,this.parameters)||e.parameters===this.parameters)}}_([$({type:F.ObjectIdentifier})],ye.prototype,"algorithm",void 0),_([$({type:F.Any,optional:!0})],ye.prototype,"parameters",void 0);class ps{constructor(e={}){this.algorithm=new ye,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:ye})],ps.prototype,"algorithm",void 0),_([$({type:F.BitString})],ps.prototype,"subjectPublicKey",void 0);let _r=class{constructor(e){if(e)if(typeof e=="string"||typeof e=="number"||e instanceof Date){const t=new Date(e);t.getUTCFullYear()>2049?this.generalTime=t:this.utcTime=t}else Object.assign(this,e)}getTime(){const e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};_([$({type:F.UTCTime})],_r.prototype,"utcTime",void 0),_([$({type:F.GeneralizedTime})],_r.prototype,"generalTime",void 0),_r=_([te({type:X.Choice})],_r);class Tp{constructor(e){this.notBefore=new _r(new Date),this.notAfter=new _r(new Date),e&&(this.notBefore=new _r(e.notBefore),this.notAfter=new _r(e.notAfter))}}_([$({type:_r})],Tp.prototype,"notBefore",void 0),_([$({type:_r})],Tp.prototype,"notAfter",void 0);var kS;let Mi=class eq{constructor(e={}){this.extnID="",this.critical=eq.CRITICAL,this.extnValue=new tt,Object.assign(this,e)}};Mi.CRITICAL=!1,_([$({type:F.ObjectIdentifier})],Mi.prototype,"extnID",void 0),_([$({type:F.Boolean,defaultValue:Mi.CRITICAL})],Mi.prototype,"critical",void 0),_([$({type:tt})],Mi.prototype,"extnValue",void 0);let Lc=kS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,kS.prototype)}};Lc=kS=_([te({type:X.Sequence,itemType:Mi})],Lc);var du;(function(r){r[r.v1=0]="v1",r[r.v2=1]="v2",r[r.v3=2]="v3"})(du||(du={}));class hi{constructor(e={}){this.version=du.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new ye,this.issuer=new Yt,this.validity=new Tp,this.subject=new Yt,this.subjectPublicKeyInfo=new ps,Object.assign(this,e)}}_([$({type:F.Integer,context:0,defaultValue:du.v1})],hi.prototype,"version",void 0),_([$({type:F.Integer,converter:Dt})],hi.prototype,"serialNumber",void 0),_([$({type:ye})],hi.prototype,"signature",void 0),_([$({type:Yt})],hi.prototype,"issuer",void 0),_([$({type:Tp})],hi.prototype,"validity",void 0),_([$({type:Yt})],hi.prototype,"subject",void 0),_([$({type:ps})],hi.prototype,"subjectPublicKeyInfo",void 0),_([$({type:F.BitString,context:1,implicit:!0,optional:!0})],hi.prototype,"issuerUniqueID",void 0),_([$({type:F.BitString,context:2,implicit:!0,optional:!0})],hi.prototype,"subjectUniqueID",void 0),_([$({type:Lc,context:3,optional:!0})],hi.prototype,"extensions",void 0);class hu{constructor(e={}){this.tbsCertificate=new hi,this.signatureAlgorithm=new ye,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:hi})],hu.prototype,"tbsCertificate",void 0),_([$({type:ye})],hu.prototype,"signatureAlgorithm",void 0),_([$({type:F.BitString})],hu.prototype,"signatureValue",void 0);class uw{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new _r,Object.assign(this,e)}}_([$({type:F.Integer,converter:Dt})],uw.prototype,"userCertificate",void 0),_([$({type:_r})],uw.prototype,"revocationDate",void 0),_([$({type:Mi,optional:!0,repeated:"sequence"})],uw.prototype,"crlEntryExtensions",void 0);class na{constructor(e={}){this.signature=new ye,this.issuer=new Yt,this.thisUpdate=new _r,Object.assign(this,e)}}_([$({type:F.Integer,optional:!0})],na.prototype,"version",void 0),_([$({type:ye})],na.prototype,"signature",void 0),_([$({type:Yt})],na.prototype,"issuer",void 0),_([$({type:_r})],na.prototype,"thisUpdate",void 0),_([$({type:_r,optional:!0})],na.prototype,"nextUpdate",void 0),_([$({type:uw,repeated:"sequence",optional:!0})],na.prototype,"revokedCertificates",void 0),_([$({type:Mi,optional:!0,context:0,repeated:"sequence"})],na.prototype,"crlExtensions",void 0);class _S{constructor(e={}){this.tbsCertList=new na,this.signatureAlgorithm=new ye,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:na})],_S.prototype,"tbsCertList",void 0),_([$({type:ye})],_S.prototype,"signatureAlgorithm",void 0),_([$({type:F.BitString})],_S.prototype,"signature",void 0);class Eh{constructor(e={}){this.issuer=new Yt,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:Yt})],Eh.prototype,"issuer",void 0),_([$({type:F.Integer,converter:Dt})],Eh.prototype,"serialNumber",void 0);let Sh=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Rc,context:0,implicit:!0})],Sh.prototype,"subjectKeyIdentifier",void 0),_([$({type:Eh})],Sh.prototype,"issuerAndSerialNumber",void 0),Sh=_([te({type:X.Choice})],Sh);var ia;(function(r){r[r.v0=0]="v0",r[r.v1=1]="v1",r[r.v2=2]="v2",r[r.v3=3]="v3",r[r.v4=4]="v4",r[r.v5=5]="v5"})(ia||(ia={}));let Pp=class extends ye{};Pp=_([te({type:X.Sequence})],Pp);let dw=class extends ye{};dw=_([te({type:X.Sequence})],dw);let Gs=class extends ye{};Gs=_([te({type:X.Sequence})],Gs);let hw=class extends ye{};hw=_([te({type:X.Sequence})],hw);let tz=class extends ye{};tz=_([te({type:X.Sequence})],tz);let TS=class extends ye{};TS=_([te({type:X.Sequence})],TS);let xh=class{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}};_([$({type:F.ObjectIdentifier})],xh.prototype,"attrType",void 0),_([$({type:F.Any,repeated:"set"})],xh.prototype,"attrValues",void 0);var PS;class Qs{constructor(e={}){this.version=ia.v0,this.sid=new Sh,this.digestAlgorithm=new Pp,this.signatureAlgorithm=new dw,this.signature=new tt,Object.assign(this,e)}}_([$({type:F.Integer})],Qs.prototype,"version",void 0),_([$({type:Sh})],Qs.prototype,"sid",void 0),_([$({type:Pp})],Qs.prototype,"digestAlgorithm",void 0),_([$({type:xh,repeated:"set",context:0,implicit:!0,optional:!0})],Qs.prototype,"signedAttrs",void 0),_([$({type:dw})],Qs.prototype,"signatureAlgorithm",void 0),_([$({type:tt})],Qs.prototype,"signature",void 0),_([$({type:xh,repeated:"set",context:1,implicit:!0,optional:!0})],Qs.prototype,"unsignedAttrs",void 0);let fw=PS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,PS.prototype)}};fw=PS=_([te({type:X.Set,itemType:Qs})],fw);let rz=class extends _r{};rz=_([te({type:X.Choice})],rz);let nz=class extends Qs{};nz=_([te({type:X.Sequence})],nz);class DS{constructor(e={}){this.acIssuer=new Ue,this.acSerial=0,this.attrs=[],Object.assign(this,e)}}_([$({type:Ue})],DS.prototype,"acIssuer",void 0),_([$({type:F.Integer})],DS.prototype,"acSerial",void 0),_([$({type:ra,repeated:"sequence"})],DS.prototype,"attrs",void 0);var $S;let pw=$S=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,$S.prototype)}};pw=$S=_([te({type:X.Sequence,itemType:F.ObjectIdentifier})],pw);class gw{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}}_([$({type:F.Integer,optional:!0})],gw.prototype,"pathLenConstraint",void 0),_([$({type:pw,implicit:!0,context:0,optional:!0})],gw.prototype,"permittedAttrs",void 0),_([$({type:pw,implicit:!0,context:1,optional:!0})],gw.prototype,"excludedAttrs",void 0),_([$({type:F.Boolean,defaultValue:!0})],gw.prototype,"permitUnSpecified",void 0);class fu{constructor(e={}){this.issuer=new yn,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:yn})],fu.prototype,"issuer",void 0),_([$({type:F.Integer,converter:Dt})],fu.prototype,"serial",void 0),_([$({type:F.BitString,optional:!0})],fu.prototype,"issuerUID",void 0);var NS;(function(r){r[r.publicKey=0]="publicKey",r[r.publicKeyCert=1]="publicKeyCert",r[r.otherObjectTypes=2]="otherObjectTypes"})(NS||(NS={}));class pu{constructor(e={}){this.digestedObjectType=NS.publicKey,this.digestAlgorithm=new ye,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.Enumerated})],pu.prototype,"digestedObjectType",void 0),_([$({type:F.ObjectIdentifier,optional:!0})],pu.prototype,"otherObjectTypeID",void 0),_([$({type:ye})],pu.prototype,"digestAlgorithm",void 0),_([$({type:F.BitString})],pu.prototype,"objectDigest",void 0);class yw{constructor(e={}){Object.assign(this,e)}}_([$({type:yn,optional:!0})],yw.prototype,"issuerName",void 0),_([$({type:fu,context:0,implicit:!0,optional:!0})],yw.prototype,"baseCertificateID",void 0),_([$({type:pu,context:1,implicit:!0,optional:!0})],yw.prototype,"objectDigestInfo",void 0);let Ah=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Ue,repeated:"sequence"})],Ah.prototype,"v1Form",void 0),_([$({type:yw,context:0,implicit:!0})],Ah.prototype,"v2Form",void 0),Ah=_([te({type:X.Choice})],Ah);class mw{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}}_([$({type:F.GeneralizedTime})],mw.prototype,"notBeforeTime",void 0),_([$({type:F.GeneralizedTime})],mw.prototype,"notAfterTime",void 0);class Dp{constructor(e={}){Object.assign(this,e)}}_([$({type:fu,implicit:!0,context:0,optional:!0})],Dp.prototype,"baseCertificateID",void 0),_([$({type:yn,implicit:!0,context:1,optional:!0})],Dp.prototype,"entityName",void 0),_([$({type:pu,implicit:!0,context:2,optional:!0})],Dp.prototype,"objectDigestInfo",void 0);var MS;(function(r){r[r.v2=1]="v2"})(MS||(MS={}));class gs{constructor(e={}){this.version=MS.v2,this.holder=new Dp,this.issuer=new Ah,this.signature=new ye,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new mw,this.attributes=[],Object.assign(this,e)}}_([$({type:F.Integer})],gs.prototype,"version",void 0),_([$({type:Dp})],gs.prototype,"holder",void 0),_([$({type:Ah})],gs.prototype,"issuer",void 0),_([$({type:ye})],gs.prototype,"signature",void 0),_([$({type:F.Integer,converter:Dt})],gs.prototype,"serialNumber",void 0),_([$({type:mw})],gs.prototype,"attrCertValidityPeriod",void 0),_([$({type:ra,repeated:"sequence"})],gs.prototype,"attributes",void 0),_([$({type:F.BitString,optional:!0})],gs.prototype,"issuerUniqueID",void 0),_([$({type:Lc,optional:!0})],gs.prototype,"extensions",void 0);class ww{constructor(e={}){this.acinfo=new gs,this.signatureAlgorithm=new ye,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:gs})],ww.prototype,"acinfo",void 0),_([$({type:ye})],ww.prototype,"signatureAlgorithm",void 0),_([$({type:F.BitString})],ww.prototype,"signatureValue",void 0);var bw;(function(r){r[r.unmarked=1]="unmarked",r[r.unclassified=2]="unclassified",r[r.restricted=4]="restricted",r[r.confidential=8]="confidential",r[r.secret=16]="secret",r[r.topSecret=32]="topSecret"})(bw||(bw={}));class OS extends X3{}class RS{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier,implicit:!0,context:0})],RS.prototype,"type",void 0),_([$({type:F.Any,implicit:!0,context:1})],RS.prototype,"value",void 0);class LS{constructor(e={}){this.policyId="",this.classList=new OS(bw.unclassified),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],LS.prototype,"policyId",void 0),_([$({type:OS,defaultValue:new OS(bw.unclassified)})],LS.prototype,"classList",void 0),_([$({type:RS,repeated:"set"})],LS.prototype,"securityCategories",void 0);class vw{constructor(e={}){Object.assign(this,e)}}_([$({type:tt})],vw.prototype,"cotets",void 0),_([$({type:F.ObjectIdentifier})],vw.prototype,"oid",void 0),_([$({type:F.Utf8String})],vw.prototype,"string",void 0);class iz{constructor(e={}){this.values=[],Object.assign(this,e)}}_([$({type:yn,implicit:!0,context:0,optional:!0})],iz.prototype,"policyAuthority",void 0),_([$({type:vw,repeated:"sequence"})],iz.prototype,"values",void 0);var BS;class Ew{constructor(e={}){this.targetCertificate=new fu,Object.assign(this,e)}}_([$({type:fu})],Ew.prototype,"targetCertificate",void 0),_([$({type:Ue,optional:!0})],Ew.prototype,"targetName",void 0),_([$({type:pu,optional:!0})],Ew.prototype,"certDigestInfo",void 0);let Ch=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Ue,context:0,implicit:!0})],Ch.prototype,"targetName",void 0),_([$({type:Ue,context:1,implicit:!0})],Ch.prototype,"targetGroup",void 0),_([$({type:Ew,context:2,implicit:!0})],Ch.prototype,"targetCert",void 0),Ch=_([te({type:X.Choice})],Ch);let US=BS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,BS.prototype)}};US=BS=_([te({type:X.Sequence,itemType:Ch})],US);var FS;let sz=FS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,FS.prototype)}};sz=FS=_([te({type:X.Sequence,itemType:US})],sz);class oz{constructor(e={}){Object.assign(this,e)}}_([$({type:yn,implicit:!0,context:0,optional:!0})],oz.prototype,"roleAuthority",void 0),_([$({type:Ue,implicit:!0,context:1})],oz.prototype,"roleName",void 0);class zS{constructor(e={}){this.service=new Ue,this.ident=new Ue,Object.assign(this,e)}}_([$({type:Ue})],zS.prototype,"service",void 0),_([$({type:Ue})],zS.prototype,"ident",void 0),_([$({type:tt,optional:!0})],zS.prototype,"authInfo",void 0);var VS;class KS{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],KS.prototype,"otherCertFormat",void 0),_([$({type:F.Any})],KS.prototype,"otherCert",void 0);let Ih=class{constructor(e={}){Object.assign(this,e)}};_([$({type:hu})],Ih.prototype,"certificate",void 0),_([$({type:ww,context:2,implicit:!0})],Ih.prototype,"v2AttrCert",void 0),_([$({type:KS,context:3,implicit:!0})],Ih.prototype,"other",void 0),Ih=_([te({type:X.Choice})],Ih);let Sw=VS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,VS.prototype)}};Sw=VS=_([te({type:X.Set,itemType:Ih})],Sw);class kh{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],kh.prototype,"contentType",void 0),_([$({type:F.Any,context:0})],kh.prototype,"content",void 0);let $p=class{constructor(e={}){Object.assign(this,e)}};_([$({type:tt})],$p.prototype,"single",void 0),_([$({type:F.Any})],$p.prototype,"any",void 0),$p=_([te({type:X.Choice})],$p);class xw{constructor(e={}){this.eContentType="",Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],xw.prototype,"eContentType",void 0),_([$({type:$p,context:0,optional:!0})],xw.prototype,"eContent",void 0);let Np=class{constructor(e={}){Object.assign(this,e)}};_([$({type:tt,context:0,implicit:!0,optional:!0})],Np.prototype,"value",void 0),_([$({type:tt,converter:Z6e,context:0,implicit:!0,optional:!0,repeated:"sequence"})],Np.prototype,"constructedValue",void 0),Np=_([te({type:X.Choice})],Np);class Mp{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new hw,Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],Mp.prototype,"contentType",void 0),_([$({type:hw})],Mp.prototype,"contentEncryptionAlgorithm",void 0),_([$({type:Np,optional:!0})],Mp.prototype,"encryptedContent",void 0);class Aw{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],Aw.prototype,"keyAttrId",void 0),_([$({type:F.Any,optional:!0})],Aw.prototype,"keyAttr",void 0);var jS;class Cw{constructor(e={}){this.subjectKeyIdentifier=new Rc,Object.assign(this,e)}}_([$({type:Rc})],Cw.prototype,"subjectKeyIdentifier",void 0),_([$({type:F.GeneralizedTime,optional:!0})],Cw.prototype,"date",void 0),_([$({type:Aw,optional:!0})],Cw.prototype,"other",void 0);let _h=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Cw,context:0,implicit:!0,optional:!0})],_h.prototype,"rKeyId",void 0),_([$({type:Eh,optional:!0})],_h.prototype,"issuerAndSerialNumber",void 0),_h=_([te({type:X.Choice})],_h);class HS{constructor(e={}){this.rid=new _h,this.encryptedKey=new tt,Object.assign(this,e)}}_([$({type:_h})],HS.prototype,"rid",void 0),_([$({type:tt})],HS.prototype,"encryptedKey",void 0);let Iw=jS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,jS.prototype)}};Iw=jS=_([te({type:X.Sequence,itemType:HS})],Iw);class qS{constructor(e={}){this.algorithm=new ye,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:ye})],qS.prototype,"algorithm",void 0),_([$({type:F.BitString})],qS.prototype,"publicKey",void 0);let gu=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Rc,context:0,implicit:!0,optional:!0})],gu.prototype,"subjectKeyIdentifier",void 0),_([$({type:qS,context:1,implicit:!0,optional:!0})],gu.prototype,"originatorKey",void 0),_([$({type:Eh,optional:!0})],gu.prototype,"issuerAndSerialNumber",void 0),gu=_([te({type:X.Choice})],gu);class Th{constructor(e={}){this.version=ia.v3,this.originator=new gu,this.keyEncryptionAlgorithm=new Gs,this.recipientEncryptedKeys=new Iw,Object.assign(this,e)}}_([$({type:F.Integer})],Th.prototype,"version",void 0),_([$({type:gu,context:0})],Th.prototype,"originator",void 0),_([$({type:tt,context:1,optional:!0})],Th.prototype,"ukm",void 0),_([$({type:Gs})],Th.prototype,"keyEncryptionAlgorithm",void 0),_([$({type:Iw})],Th.prototype,"recipientEncryptedKeys",void 0);let Ph=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Rc,context:0,implicit:!0})],Ph.prototype,"subjectKeyIdentifier",void 0),_([$({type:Eh})],Ph.prototype,"issuerAndSerialNumber",void 0),Ph=_([te({type:X.Choice})],Ph);class Op{constructor(e={}){this.version=ia.v0,this.rid=new Ph,this.keyEncryptionAlgorithm=new Gs,this.encryptedKey=new tt,Object.assign(this,e)}}_([$({type:F.Integer})],Op.prototype,"version",void 0),_([$({type:Ph})],Op.prototype,"rid",void 0),_([$({type:Gs})],Op.prototype,"keyEncryptionAlgorithm",void 0),_([$({type:tt})],Op.prototype,"encryptedKey",void 0);class Rp{constructor(e={}){this.keyIdentifier=new tt,Object.assign(this,e)}}_([$({type:tt})],Rp.prototype,"keyIdentifier",void 0),_([$({type:F.GeneralizedTime,optional:!0})],Rp.prototype,"date",void 0),_([$({type:Aw,optional:!0})],Rp.prototype,"other",void 0);class Lp{constructor(e={}){this.version=ia.v4,this.kekid=new Rp,this.keyEncryptionAlgorithm=new Gs,this.encryptedKey=new tt,Object.assign(this,e)}}_([$({type:F.Integer})],Lp.prototype,"version",void 0),_([$({type:Rp})],Lp.prototype,"kekid",void 0),_([$({type:Gs})],Lp.prototype,"keyEncryptionAlgorithm",void 0),_([$({type:tt})],Lp.prototype,"encryptedKey",void 0);class Bp{constructor(e={}){this.version=ia.v0,this.keyEncryptionAlgorithm=new Gs,this.encryptedKey=new tt,Object.assign(this,e)}}_([$({type:F.Integer})],Bp.prototype,"version",void 0),_([$({type:TS,context:0,optional:!0})],Bp.prototype,"keyDerivationAlgorithm",void 0),_([$({type:Gs})],Bp.prototype,"keyEncryptionAlgorithm",void 0),_([$({type:tt})],Bp.prototype,"encryptedKey",void 0);class WS{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],WS.prototype,"oriType",void 0),_([$({type:F.Any})],WS.prototype,"oriValue",void 0);let Bc=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Op,optional:!0})],Bc.prototype,"ktri",void 0),_([$({type:Th,context:1,implicit:!0,optional:!0})],Bc.prototype,"kari",void 0),_([$({type:Lp,context:2,implicit:!0,optional:!0})],Bc.prototype,"kekri",void 0),_([$({type:Bp,context:3,implicit:!0,optional:!0})],Bc.prototype,"pwri",void 0),_([$({type:WS,context:4,implicit:!0,optional:!0})],Bc.prototype,"ori",void 0),Bc=_([te({type:X.Choice})],Bc);var GS;let kw=GS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,GS.prototype)}};kw=GS=_([te({type:X.Set,itemType:Bc})],kw);var QS;class _w{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],_w.prototype,"otherRevInfoFormat",void 0),_([$({type:F.Any})],_w.prototype,"otherRevInfo",void 0);let Tw=class{constructor(e={}){this.other=new _w,Object.assign(this,e)}};_([$({type:_w,context:1,implicit:!0})],Tw.prototype,"other",void 0),Tw=_([te({type:X.Choice})],Tw);let Pw=QS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,QS.prototype)}};Pw=QS=_([te({type:X.Set,itemType:Tw})],Pw);class YS{constructor(e={}){Object.assign(this,e)}}_([$({type:Sw,context:0,implicit:!0,optional:!0})],YS.prototype,"certs",void 0),_([$({type:Pw,context:1,implicit:!0,optional:!0})],YS.prototype,"crls",void 0);var JS;let XS=JS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,JS.prototype)}};XS=JS=_([te({type:X.Set,itemType:xh})],XS);class Up{constructor(e={}){this.version=ia.v0,this.recipientInfos=new kw,this.encryptedContentInfo=new Mp,Object.assign(this,e)}}_([$({type:F.Integer})],Up.prototype,"version",void 0),_([$({type:YS,context:0,implicit:!0,optional:!0})],Up.prototype,"originatorInfo",void 0),_([$({type:kw})],Up.prototype,"recipientInfos",void 0),_([$({type:Mp})],Up.prototype,"encryptedContentInfo",void 0),_([$({type:XS,context:1,implicit:!0,optional:!0})],Up.prototype,"unprotectedAttrs",void 0);const Cbe="1.2.840.113549.1.7.2";var ZS;let Dw=ZS=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,ZS.prototype)}};Dw=ZS=_([te({type:X.Set,itemType:Pp})],Dw);class Dh{constructor(e={}){this.version=ia.v0,this.digestAlgorithms=new Dw,this.encapContentInfo=new xw,this.signerInfos=new fw,Object.assign(this,e)}}_([$({type:F.Integer})],Dh.prototype,"version",void 0),_([$({type:Dw})],Dh.prototype,"digestAlgorithms",void 0),_([$({type:xw})],Dh.prototype,"encapContentInfo",void 0),_([$({type:Sw,context:0,implicit:!0,optional:!0})],Dh.prototype,"certificates",void 0),_([$({type:Pw,context:1,implicit:!0,optional:!0})],Dh.prototype,"crls",void 0),_([$({type:fw})],Dh.prototype,"signerInfos",void 0);const Fp="1.2.840.10045.2.1",ex="1.2.840.10045.4.1",az="1.2.840.10045.4.3.1",tx="1.2.840.10045.4.3.2",rx="1.2.840.10045.4.3.3",nx="1.2.840.10045.4.3.4",cz="1.2.840.10045.3.1.7",lz="1.3.132.0.34",uz="1.3.132.0.35";function zp(r){return new ye({algorithm:r})}const Ibe=zp(ex);zp(az);const kbe=zp(tx),_be=zp(rx),Tbe=zp(nx);let Vp=class{constructor(e={}){Object.assign(this,e)}};_([$({type:F.ObjectIdentifier})],Vp.prototype,"fieldType",void 0),_([$({type:F.Any})],Vp.prototype,"parameters",void 0),Vp=_([te({type:X.Sequence})],Vp);class Pbe extends tt{}let $h=class{constructor(e={}){Object.assign(this,e)}};_([$({type:F.OctetString})],$h.prototype,"a",void 0),_([$({type:F.OctetString})],$h.prototype,"b",void 0),_([$({type:F.BitString,optional:!0})],$h.prototype,"seed",void 0),$h=_([te({type:X.Sequence})],$h);var ix;(function(r){r[r.ecpVer1=1]="ecpVer1"})(ix||(ix={}));let sa=class{constructor(e={}){this.version=ix.ecpVer1,Object.assign(this,e)}};_([$({type:F.Integer})],sa.prototype,"version",void 0),_([$({type:Vp})],sa.prototype,"fieldID",void 0),_([$({type:$h})],sa.prototype,"curve",void 0),_([$({type:Pbe})],sa.prototype,"base",void 0),_([$({type:F.Integer,converter:Dt})],sa.prototype,"order",void 0),_([$({type:F.Integer,optional:!0})],sa.prototype,"cofactor",void 0),sa=_([te({type:X.Sequence})],sa);let Uc=class{constructor(e={}){Object.assign(this,e)}};_([$({type:F.ObjectIdentifier})],Uc.prototype,"namedCurve",void 0),_([$({type:F.Null})],Uc.prototype,"implicitCurve",void 0),_([$({type:sa})],Uc.prototype,"specifiedCurve",void 0),Uc=_([te({type:X.Choice})],Uc);class $w{constructor(e={}){this.version=1,this.privateKey=new tt,Object.assign(this,e)}}_([$({type:F.Integer})],$w.prototype,"version",void 0),_([$({type:tt})],$w.prototype,"privateKey",void 0),_([$({type:Uc,context:0,optional:!0})],$w.prototype,"parameters",void 0),_([$({type:F.BitString,context:1,optional:!0})],$w.prototype,"publicKey",void 0);class Nw{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.Integer,converter:Dt})],Nw.prototype,"r",void 0),_([$({type:F.Integer,converter:Dt})],Nw.prototype,"s",void 0);const $n="1.2.840.113549.1.1",yu=`${$n}.1`,Dbe=`${$n}.7`,$be=`${$n}.9`,Kp=`${$n}.10`,Nbe=`${$n}.2`,Mbe=`${$n}.4`,Mw=`${$n}.5`,Obe=`${$n}.14`,sx=`${$n}.11`,Ow=`${$n}.12`,Rw=`${$n}.13`,dz=`${$n}.15`,hz=`${$n}.16`,Lw="1.3.14.3.2.26",fz="2.16.840.1.101.3.4.2.4",Bw="2.16.840.1.101.3.4.2.1",Uw="2.16.840.1.101.3.4.2.2",Fw="2.16.840.1.101.3.4.2.3",Rbe="2.16.840.1.101.3.4.2.5",Lbe="2.16.840.1.101.3.4.2.6",Bbe="1.2.840.113549.2.2",Ube="1.2.840.113549.2.5",zw=`${$n}.8`;function cr(r){return new ye({algorithm:r,parameters:null})}cr(Bbe),cr(Ube);const mu=cr(Lw);cr(fz),cr(Bw),cr(Uw),cr(Fw),cr(Rbe),cr(Lbe);const pz=new ye({algorithm:zw,parameters:ae.serialize(mu)}),gz=new ye({algorithm:$be,parameters:ae.serialize(Z3.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))});cr(yu),cr(Nbe),cr(Mbe),cr(Mw),cr(dz),cr(hz),cr(Ow),cr(Rw),cr(dz),cr(hz);class Vw{constructor(e={}){this.hashAlgorithm=new ye(mu),this.maskGenAlgorithm=new ye({algorithm:zw,parameters:ae.serialize(mu)}),this.pSourceAlgorithm=new ye(gz),Object.assign(this,e)}}_([$({type:ye,context:0,defaultValue:mu})],Vw.prototype,"hashAlgorithm",void 0),_([$({type:ye,context:1,defaultValue:pz})],Vw.prototype,"maskGenAlgorithm",void 0),_([$({type:ye,context:2,defaultValue:gz})],Vw.prototype,"pSourceAlgorithm",void 0),new ye({algorithm:Dbe,parameters:ae.serialize(new Vw)});class wu{constructor(e={}){this.hashAlgorithm=new ye(mu),this.maskGenAlgorithm=new ye({algorithm:zw,parameters:ae.serialize(mu)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}}_([$({type:ye,context:0,defaultValue:mu})],wu.prototype,"hashAlgorithm",void 0),_([$({type:ye,context:1,defaultValue:pz})],wu.prototype,"maskGenAlgorithm",void 0),_([$({type:F.Integer,context:2,defaultValue:20})],wu.prototype,"saltLength",void 0),_([$({type:F.Integer,context:3,defaultValue:1})],wu.prototype,"trailerField",void 0),new ye({algorithm:Kp,parameters:ae.serialize(new wu)});class Kw{constructor(e={}){this.digestAlgorithm=new ye,this.digest=new tt,Object.assign(this,e)}}_([$({type:ye})],Kw.prototype,"digestAlgorithm",void 0),_([$({type:tt})],Kw.prototype,"digest",void 0);var ox;class jw{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.Integer,converter:Dt})],jw.prototype,"prime",void 0),_([$({type:F.Integer,converter:Dt})],jw.prototype,"exponent",void 0),_([$({type:F.Integer,converter:Dt})],jw.prototype,"coefficient",void 0);let ax=ox=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,ox.prototype)}};ax=ox=_([te({type:X.Sequence,itemType:jw})],ax);class Ys{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.Integer})],Ys.prototype,"version",void 0),_([$({type:F.Integer,converter:Dt})],Ys.prototype,"modulus",void 0),_([$({type:F.Integer,converter:Dt})],Ys.prototype,"publicExponent",void 0),_([$({type:F.Integer,converter:Dt})],Ys.prototype,"privateExponent",void 0),_([$({type:F.Integer,converter:Dt})],Ys.prototype,"prime1",void 0),_([$({type:F.Integer,converter:Dt})],Ys.prototype,"prime2",void 0),_([$({type:F.Integer,converter:Dt})],Ys.prototype,"exponent1",void 0),_([$({type:F.Integer,converter:Dt})],Ys.prototype,"exponent2",void 0),_([$({type:F.Integer,converter:Dt})],Ys.prototype,"coefficient",void 0),_([$({type:ax,optional:!0})],Ys.prototype,"otherPrimeInfos",void 0);class cx{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.Integer,converter:Dt})],cx.prototype,"modulus",void 0),_([$({type:F.Integer,converter:Dt})],cx.prototype,"publicExponent",void 0);var lx;(function(r){r[r.Transient=0]="Transient",r[r.Singleton=1]="Singleton",r[r.ResolutionScoped=2]="ResolutionScoped",r[r.ContainerScoped=3]="ContainerScoped"})(lx||(lx={}));const Nn=lx;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ux=function(r,e){return ux=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},ux(r,e)};function dx(r,e){ux(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Fbe(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(d){try{l(n.next(d))}catch(h){o(h)}}function c(d){try{l(n.throw(d))}catch(h){o(h)}}function l(d){d.done?s(d.value):i(d.value).then(a,c)}l((n=n.apply(r,[])).next())})}function zbe(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(d){return c([l,d])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(d){l=[6,d],i=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Hw(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function qw(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s}function bu(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(qw(arguments[e]));return r}var Vbe="injectionTokens";function Kbe(r){var e=Reflect.getMetadata("design:paramtypes",r)||[],t=Reflect.getOwnMetadata(Vbe,r)||{};return Object.keys(t).forEach(function(n){e[+n]=t[n]}),e}function yz(r){return!!r.useClass}function hx(r){return!!r.useFactory}var mz=function(){function r(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return r.prototype.createProxy=function(e){var t=this,n={},i=!1,s,o=function(){return i||(s=e(t.wrap()),i=!0),s};return new Proxy(n,this.createHandler(o))},r.prototype.createHandler=function(e){var t={},n=function(i){t[i]=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];s[0]=e();var a=Reflect[i];return a.apply(void 0,bu(s))}};return this.reflectMethods.forEach(n),t},r}();function Nh(r){return typeof r=="string"||typeof r=="symbol"}function jbe(r){return typeof r=="object"&&"token"in r&&"multiple"in r}function wz(r){return typeof r=="object"&&"token"in r&&"transform"in r}function Hbe(r){return typeof r=="function"||r instanceof mz}function Ww(r){return!!r.useToken}function Gw(r){return r.useValue!=null}function qbe(r){return yz(r)||Gw(r)||Ww(r)||hx(r)}var fx=function(){function r(){this._registryMap=new Map}return r.prototype.entries=function(){return this._registryMap.entries()},r.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},r.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},r.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},r.prototype.setAll=function(e,t){this._registryMap.set(e,t)},r.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},r.prototype.clear=function(){this._registryMap.clear()},r.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},r}(),Wbe=function(r){dx(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(fx),Qw=function(){function r(){this.scopedResolutions=new Map}return r}();function Gbe(r,e){if(r===null)return"at position #"+e;var t=r.split(",")[e].trim();return'"'+t+'" at position #'+e}function Qbe(r,e,t){return t===void 0&&(t="    "),bu([r],e.message.split(`
`).map(function(n){return t+n})).join(`
`)}function Ybe(r,e,t){var n=qw(r.toString().match(/constructor\(([\w, ]+)\)/)||[],2),i=n[1],s=i===void 0?null:i,o=Gbe(s,e);return Qbe("Cannot inject the dependency "+o+' of "'+r.name+'" constructor. Reason:',t)}function Jbe(r){if(typeof r.dispose!="function")return!1;var e=r.dispose;return!(e.length>0)}var Xbe=function(r){dx(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(fx),Zbe=function(r){dx(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(fx),eve=function(){function r(){this.preResolution=new Xbe,this.postResolution=new Zbe}return r}(),bz=new Map,tve=function(){function r(e){this.parent=e,this._registry=new Wbe,this.interceptors=new eve,this.disposed=!1,this.disposables=new Set}return r.prototype.register=function(e,t,n){n===void 0&&(n={lifecycle:Nn.Transient}),this.ensureNotDisposed();var i;if(qbe(t)?i=t:i={useClass:t},Ww(i))for(var s=[e],o=i;o!=null;){var a=o.useToken;if(s.includes(a))throw new Error("Token registration cycle detected! "+bu(s,[a]).join(" -> "));s.push(a);var c=this._registry.get(a);c&&Ww(c.provider)?o=c.provider:o=null}if((n.lifecycle===Nn.Singleton||n.lifecycle==Nn.ContainerScoped||n.lifecycle==Nn.ResolutionScoped)&&(Gw(i)||hx(i)))throw new Error('Cannot use lifecycle "'+Nn[n.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:i,options:n}),this},r.prototype.registerType=function(e,t){return this.ensureNotDisposed(),Nh(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},r.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},r.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),Nh(e)){if(Nh(t))return this.register(e,{useToken:t},{lifecycle:Nn.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:Nn.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var n=e;return t&&!Nh(t)&&(n=t),this.register(e,{useClass:n},{lifecycle:Nn.Singleton})},r.prototype.resolve=function(e,t,n){t===void 0&&(t=new Qw),n===void 0&&(n=!1),this.ensureNotDisposed();var i=this.getRegistration(e);if(!i&&Nh(e)){if(n)return;throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"Single"),i){var s=this.resolveRegistration(i,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}if(Hbe(e)){var s=this.construct(e,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},r.prototype.executePreResolutionInterceptor=function(e,t){var n,i;if(this.interceptors.preResolution.has(e)){var s=[];try{for(var o=Hw(this.interceptors.preResolution.getAll(e)),a=o.next();!a.done;a=o.next()){var c=a.value;c.options.frequency!="Once"&&s.push(c),c.callback(e,t)}}catch(l){n={error:l}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}this.interceptors.preResolution.setAll(e,s)}},r.prototype.executePostResolutionInterceptor=function(e,t,n){var i,s;if(this.interceptors.postResolution.has(e)){var o=[];try{for(var a=Hw(this.interceptors.postResolution.getAll(e)),c=a.next();!c.done;c=a.next()){var l=c.value;l.options.frequency!="Once"&&o.push(l),l.callback(e,t,n)}}catch(d){i={error:d}}finally{try{c&&!c.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}this.interceptors.postResolution.setAll(e,o)}},r.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===Nn.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var n=e.options.lifecycle===Nn.Singleton,i=e.options.lifecycle===Nn.ContainerScoped,s=n||i,o;return Gw(e.provider)?o=e.provider.useValue:Ww(e.provider)?o=s?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):yz(e.provider)?o=s?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):hx(e.provider)?o=e.provider.useFactory(this):o=this.construct(e.provider,t),e.options.lifecycle===Nn.ResolutionScoped&&t.scopedResolutions.set(e,o),o},r.prototype.resolveAll=function(e,t,n){var i=this;t===void 0&&(t=new Qw),n===void 0&&(n=!1),this.ensureNotDisposed();var s=this.getAllRegistrations(e);if(!s&&Nh(e)){if(n)return[];throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"All"),s){var o=s.map(function(c){return i.resolveRegistration(c,t)});return this.executePostResolutionInterceptor(e,o,"All"),o}var a=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,a,"All"),a},r.prototype.isRegistered=function(e,t){return t===void 0&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},r.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},r.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var n=Hw(this._registry.entries()),i=n.next();!i.done;i=n.next()){var s=qw(i.value,2),o=s[0],a=s[1];this._registry.setAll(o,a.filter(function(c){return!Gw(c.provider)}).map(function(c){return c.instance=void 0,c}))}}catch(c){e={error:c}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},r.prototype.createChildContainer=function(){var e,t;this.ensureNotDisposed();var n=new r(this);try{for(var i=Hw(this._registry.entries()),s=i.next();!s.done;s=i.next()){var o=qw(s.value,2),a=o[0],c=o[1];c.some(function(l){var d=l.options;return d.lifecycle===Nn.ContainerScoped})&&n._registry.setAll(a,c.map(function(l){return l.options.lifecycle===Nn.ContainerScoped?{provider:l.provider,options:l.options}:l}))}}catch(l){e={error:l}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r.prototype.beforeResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:n})},r.prototype.afterResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:n})},r.prototype.dispose=function(){return Fbe(this,void 0,void 0,function(){var e;return zbe(this,function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach(function(n){var i=n.dispose();i&&e.push(i)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},r.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},r.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},r.prototype.construct=function(e,t){var n=this;if(e instanceof mz)return e.createProxy(function(s){return n.resolve(s,t)});var i=function(){var s=bz.get(e);if(!s||s.length===0){if(e.length===0)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var o=s.map(n.resolveParams(t,e));return new(e.bind.apply(e,bu([void 0],o)))}();return Jbe(i)&&this.disposables.add(i),i},r.prototype.resolveParams=function(e,t){var n=this;return function(i,s){var o,a,c;try{return jbe(i)?wz(i)?i.multiple?(o=n.resolve(i.transform)).transform.apply(o,bu([n.resolveAll(i.token,new Qw,i.isOptional)],i.transformArgs)):(a=n.resolve(i.transform)).transform.apply(a,bu([n.resolve(i.token,e,i.isOptional)],i.transformArgs)):i.multiple?n.resolveAll(i.token,new Qw,i.isOptional):n.resolve(i.token,e,i.isOptional):wz(i)?(c=n.resolve(i.transform,e)).transform.apply(c,bu([n.resolve(i.token,e)],i.transformArgs)):n.resolve(i,e)}catch(l){throw new Error(Ybe(t,s,l))}}},r.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},r}(),Tr=new tve;function Yw(r){return function(e){bz.set(e,Kbe(e))}}if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var px;class Jw{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}}_([$({type:F.ObjectIdentifier})],Jw.prototype,"attrId",void 0),_([$({type:F.Any,repeated:"set"})],Jw.prototype,"attrValues",void 0);let vz=px=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,px.prototype)}};vz=px=_([te({type:X.Sequence,itemType:Jw})],vz);var gx;let Ez=gx=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,gx.prototype)}};Ez=gx=_([te({type:X.Sequence,itemType:kh})],Ez);class Sz{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],Sz.prototype,"certId",void 0),_([$({type:F.Any,context:0})],Sz.prototype,"certValue",void 0);class xz{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],xz.prototype,"crlId",void 0),_([$({type:F.Any,context:0})],xz.prototype,"crltValue",void 0);class Az extends tt{}let Xw=class{constructor(e={}){this.encryptionAlgorithm=new ye,this.encryptedData=new Az,Object.assign(this,e)}};_([$({type:ye})],Xw.prototype,"encryptionAlgorithm",void 0),_([$({type:Az})],Xw.prototype,"encryptedData",void 0);var yx,mx;(function(r){r[r.v1=0]="v1"})(mx||(mx={}));class Cz extends tt{}let wx=yx=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,yx.prototype)}};wx=yx=_([te({type:X.Sequence,itemType:ra})],wx);class jp{constructor(e={}){this.version=mx.v1,this.privateKeyAlgorithm=new ye,this.privateKey=new Cz,Object.assign(this,e)}}_([$({type:F.Integer})],jp.prototype,"version",void 0),_([$({type:ye})],jp.prototype,"privateKeyAlgorithm",void 0),_([$({type:Cz})],jp.prototype,"privateKey",void 0),_([$({type:wx,implicit:!0,context:0,optional:!0})],jp.prototype,"attributes",void 0);let Iz=class extends jp{};Iz=_([te({type:X.Sequence})],Iz);let kz=class extends Xw{};kz=_([te({type:X.Sequence})],kz);class _z{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],_z.prototype,"secretTypeId",void 0),_([$({type:F.Any,context:0})],_z.prototype,"secretValue",void 0);class Hp{constructor(e={}){this.mac=new Kw,this.macSalt=new tt,this.iterations=1,Object.assign(this,e)}}_([$({type:Kw})],Hp.prototype,"mac",void 0),_([$({type:tt})],Hp.prototype,"macSalt",void 0),_([$({type:F.Integer,defaultValue:1})],Hp.prototype,"iterations",void 0);class Zw{constructor(e={}){this.version=3,this.authSafe=new kh,this.macData=new Hp,Object.assign(this,e)}}_([$({type:F.Integer})],Zw.prototype,"version",void 0),_([$({type:kh})],Zw.prototype,"authSafe",void 0),_([$({type:Hp,optional:!0})],Zw.prototype,"macData",void 0);var bx;class e4{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],e4.prototype,"bagId",void 0),_([$({type:F.Any,context:0})],e4.prototype,"bagValue",void 0),_([$({type:Jw,repeated:"set",optional:!0})],e4.prototype,"bagAttributes",void 0);let Tz=bx=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,bx.prototype)}};Tz=bx=_([te({type:X.Sequence,itemType:e4})],Tz);var vx,Ex,Sx;const Pz="1.2.840.113549.1.9",Dz=`${Pz}.7`,xx=`${Pz}.14`;let t4=class extends kr{constructor(e={}){super(e)}toString(){return this.ia5String||super.toString()}};_([$({type:F.IA5String})],t4.prototype,"ia5String",void 0),t4=_([te({type:X.Choice})],t4);let $z=class extends kh{};$z=_([te({type:X.Sequence})],$z);let Nz=class extends Zw{};Nz=_([te({type:X.Sequence})],Nz);let Mz=class extends Xw{};Mz=_([te({type:X.Sequence})],Mz);let Ax=class{constructor(e=""){this.value=e}toString(){return this.value}};_([$({type:F.IA5String})],Ax.prototype,"value",void 0),Ax=_([te({type:X.Choice})],Ax);let Oz=class extends t4{};Oz=_([te({type:X.Choice})],Oz);let Rz=class extends kr{};Rz=_([te({type:X.Choice})],Rz);let Cx=class{constructor(e=new Date){this.value=e}};_([$({type:F.GeneralizedTime})],Cx.prototype,"value",void 0),Cx=_([te({type:X.Choice})],Cx);let Lz=class extends kr{};Lz=_([te({type:X.Choice})],Lz);let Ix=class{constructor(e="M"){this.value=e}toString(){return this.value}};_([$({type:F.PrintableString})],Ix.prototype,"value",void 0),Ix=_([te({type:X.Choice})],Ix);let r4=class{constructor(e=""){this.value=e}toString(){return this.value}};_([$({type:F.PrintableString})],r4.prototype,"value",void 0),r4=_([te({type:X.Choice})],r4);let Bz=class extends r4{};Bz=_([te({type:X.Choice})],Bz);let Uz=class extends kr{};Uz=_([te({type:X.Choice})],Uz);let kx=class{constructor(e=""){this.value=e}toString(){return this.value}};_([$({type:F.ObjectIdentifier})],kx.prototype,"value",void 0),kx=_([te({type:X.Choice})],kx);let Fz=class extends _r{};Fz=_([te({type:X.Choice})],Fz);let _x=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};_([$({type:F.Integer})],_x.prototype,"value",void 0),_x=_([te({type:X.Choice})],_x);let zz=class extends Qs{};zz=_([te({type:X.Sequence})],zz);let n4=class extends kr{};n4=_([te({type:X.Choice})],n4);let Vz=vx=class extends Lc{constructor(e){super(e),Object.setPrototypeOf(this,vx.prototype)}};Vz=vx=_([te({type:X.Sequence})],Vz);let Kz=Ex=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,Ex.prototype)}};Kz=Ex=_([te({type:X.Set,itemType:xh})],Kz);let Tx=class{constructor(e=""){this.value=e}toString(){return this.value}};_([$({type:F.BmpString})],Tx.prototype,"value",void 0),Tx=_([te({type:X.Choice})],Tx);let Px=class extends ye{};Px=_([te({type:X.Sequence})],Px);let jz=Sx=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,Sx.prototype)}};jz=Sx=_([te({type:X.Sequence,itemType:Px})],jz);var Dx;let i4=Dx=class extends ht{constructor(e){super(e),Object.setPrototypeOf(this,Dx.prototype)}};i4=Dx=_([te({type:X.Sequence,itemType:ra})],i4);class Mh{constructor(e={}){this.version=0,this.subject=new Yt,this.subjectPKInfo=new ps,this.attributes=new i4,Object.assign(this,e)}}_([$({type:F.Integer})],Mh.prototype,"version",void 0),_([$({type:Yt})],Mh.prototype,"subject",void 0),_([$({type:ps})],Mh.prototype,"subjectPKInfo",void 0),_([$({type:i4,implicit:!0,context:0})],Mh.prototype,"attributes",void 0);class qp{constructor(e={}){this.certificationRequestInfo=new Mh,this.signatureAlgorithm=new ye,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:Mh})],qp.prototype,"certificationRequestInfo",void 0),_([$({type:ye})],qp.prototype,"signatureAlgorithm",void 0),_([$({type:F.BitString})],qp.prototype,"signature",void 0);/*!
* MIT License
* 
* Copyright (c) Peculiar Ventures. All rights reserved.
* 
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
* 
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
* 
*/const Wp="crypto.algorithm";class rve{getAlgorithms(){return Tr.resolveAll(Wp)}toAsnAlgorithm(e){({...e});for(const t of this.getAlgorithms()){const n=t.toAsnAlgorithm(e);if(n)return n}if(/^[0-9.]+$/.test(e.name)){const t=new ye({algorithm:e.name});if("parameters"in e){const n=e;t.parameters=n.parameters}return t}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(const n of this.getAlgorithms()){const i=n.toWebAlgorithm(e);if(i)return i}return{name:e.algorithm,parameters:e.parameters}}}const vu="crypto.algorithmProvider";Tr.registerSingleton(vu,rve);var s4;const Mn="1.3.36.3.3.2.8.1.1",Hz=`${Mn}.1`,qz=`${Mn}.2`,Wz=`${Mn}.3`,Gz=`${Mn}.4`,Qz=`${Mn}.5`,Yz=`${Mn}.6`,Jz=`${Mn}.7`,Xz=`${Mn}.8`,Zz=`${Mn}.9`,eV=`${Mn}.10`,tV=`${Mn}.11`,rV=`${Mn}.12`,nV=`${Mn}.13`,iV=`${Mn}.14`,sV="brainpoolP160r1",oV="brainpoolP160t1",aV="brainpoolP192r1",cV="brainpoolP192t1",lV="brainpoolP224r1",uV="brainpoolP224t1",dV="brainpoolP256r1",hV="brainpoolP256t1",fV="brainpoolP320r1",pV="brainpoolP320t1",gV="brainpoolP384r1",yV="brainpoolP384t1",mV="brainpoolP512r1",wV="brainpoolP512t1",Vt="ECDSA";let Gp=s4=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case Vt.toLowerCase():if("hash"in e)switch((typeof e.hash=="string"?e.hash:e.hash.name).toLowerCase()){case"sha-1":return Ibe;case"sha-256":return kbe;case"sha-384":return _be;case"sha-512":return Tbe}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t=cz;break;case"K-256":t=s4.SECP256K1;break;case"P-384":t=lz;break;case"P-521":t=uz;break;case sV:t=Hz;break;case oV:t=qz;break;case aV:t=Wz;break;case cV:t=Gz;break;case lV:t=Qz;break;case uV:t=Yz;break;case dV:t=Jz;break;case hV:t=Xz;break;case fV:t=Zz;break;case pV:t=eV;break;case gV:t=tV;break;case yV:t=rV;break;case mV:t=nV;break;case wV:t=iV;break}if(t)return new ye({algorithm:Fp,parameters:ae.serialize(new Uc({namedCurve:t}))})}}return null}toWebAlgorithm(e){switch(e.algorithm){case ex:return{name:Vt,hash:{name:"SHA-1"}};case tx:return{name:Vt,hash:{name:"SHA-256"}};case rx:return{name:Vt,hash:{name:"SHA-384"}};case nx:return{name:Vt,hash:{name:"SHA-512"}};case Fp:{if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(ae.parse(e.parameters,Uc).namedCurve){case cz:return{name:Vt,namedCurve:"P-256"};case s4.SECP256K1:return{name:Vt,namedCurve:"K-256"};case lz:return{name:Vt,namedCurve:"P-384"};case uz:return{name:Vt,namedCurve:"P-521"};case Hz:return{name:Vt,namedCurve:sV};case qz:return{name:Vt,namedCurve:oV};case Wz:return{name:Vt,namedCurve:aV};case Gz:return{name:Vt,namedCurve:cV};case Qz:return{name:Vt,namedCurve:lV};case Yz:return{name:Vt,namedCurve:uV};case Jz:return{name:Vt,namedCurve:dV};case Xz:return{name:Vt,namedCurve:hV};case Zz:return{name:Vt,namedCurve:fV};case eV:return{name:Vt,namedCurve:pV};case tV:return{name:Vt,namedCurve:gV};case rV:return{name:Vt,namedCurve:yV};case nV:return{name:Vt,namedCurve:mV};case iV:return{name:Vt,namedCurve:wV}}}}return null}};Gp.SECP256K1="1.3.132.0.10",Gp=s4=_([Yw()],Gp),Tr.registerSingleton(Wp,Gp);const bV=Symbol("name"),vV=Symbol("value");class ct{constructor(e,t={},n=""){this[bV]=e,this[vV]=n;for(const i in t)this[i]=t[i]}}ct.NAME=bV,ct.VALUE=vV;class nve{static toTextObject(e){const t=new ct("Algorithm Identifier",{},Fc.toString(e.algorithm));if(e.parameters)switch(e.algorithm){case Fp:{const n=new Gp().toWebAlgorithm(e);n&&"namedCurve"in n?t["Named Curve"]=n.namedCurve:t.Parameters=e.parameters;break}default:t.Parameters=e.parameters}return t}}class Fc{static toString(e){const t=this.items[e];return t||e}}Fc.items={[Lw]:"sha1",[fz]:"sha224",[Bw]:"sha256",[Uw]:"sha384",[Fw]:"sha512",[yu]:"rsaEncryption",[Mw]:"sha1WithRSAEncryption",[Obe]:"sha224WithRSAEncryption",[sx]:"sha256WithRSAEncryption",[Ow]:"sha384WithRSAEncryption",[Rw]:"sha512WithRSAEncryption",[Fp]:"ecPublicKey",[ex]:"ecdsaWithSHA1",[az]:"ecdsaWithSHA224",[tx]:"ecdsaWithSHA256",[rx]:"ecdsaWithSHA384",[nx]:"ecdsaWithSHA512",[bbe]:"TLS WWW server authentication",[vbe]:"TLS WWW client authentication",[Ebe]:"Code Signing",[Sbe]:"E-mail Protection",[xbe]:"Time Stamping",[Abe]:"OCSP Signing",[Cbe]:"Signed Data"};class Eu{static serialize(e){return this.serializeObj(e).join(`
`)}static pad(e=0){return"".padStart(2*e," ")}static serializeObj(e,t=0){const n=[];let i=this.pad(t++),s="";const o=e[ct.VALUE];o&&(s=` ${o}`),n.push(`${i}${e[ct.NAME]}:${s}`),i=this.pad(t);for(const a in e){if(typeof a=="symbol")continue;const c=e[a],l=a?`${a}: `:"";if(typeof c=="string"||typeof c=="number"||typeof c=="boolean")n.push(`${i}${l}${c}`);else if(c instanceof Date)n.push(`${i}${l}${c.toUTCString()}`);else if(Array.isArray(c))for(const d of c)d[ct.NAME]=a,n.push(...this.serializeObj(d,t));else if(c instanceof ct)c[ct.NAME]=a,n.push(...this.serializeObj(c,t));else if(ue.isBufferSource(c))a?(n.push(`${i}${l}`),n.push(...this.serializeBufferSource(c,t+1))):n.push(...this.serializeBufferSource(c,t));else if("toTextObject"in c){const d=c.toTextObject();d[ct.NAME]=a,n.push(...this.serializeObj(d,t))}else throw new TypeError("Cannot serialize data in text format. Unsupported type.")}return n}static serializeBufferSource(e,t=0){const n=this.pad(t),i=ue.toUint8Array(e),s=[];for(let o=0;o<i.length;){const a=[];for(let c=0;c<16&&o<i.length;c++){c===8&&a.push("");const l=i[o++].toString(16).padStart(2,"0");a.push(l)}s.push(`${n}${a.join(" ")}`)}return s}static serializeAlgorithm(e){return this.algorithmSerializer.toTextObject(e)}}Eu.oidSerializer=Fc,Eu.algorithmSerializer=nve;class zc{constructor(...e){if(e.length===1){const t=e[0];this.rawData=ae.serialize(t),this.onInit(t)}else{const t=ae.parse(e[0],e[1]);this.rawData=ue.toArrayBuffer(e[0]),this.onInit(t)}}equal(e){return e instanceof zc?rU(e.rawData,this.rawData):!1}toString(e="text"){switch(e){case"asn":return ae.toString(this.rawData);case"text":return Eu.serialize(this.toTextObject());case"hex":return Se.ToHex(this.rawData);case"base64":return Se.ToBase64(this.rawData);case"base64url":return Se.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){const e=this.toTextObjectEmpty();return e[""]=this.rawData,e}toTextObjectEmpty(e){return new ct(this.getTextName(),{},e)}}zc.NAME="ASN";class Oi extends zc{constructor(...e){let t;ue.isBufferSource(e[0])?t=ue.toArrayBuffer(e[0]):t=ae.serialize(new Mi({extnID:e[0],critical:e[1],extnValue:new tt(ue.toArrayBuffer(e[2]))})),super(t,Mi)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[ct.NAME]===Oi.NAME&&(e[ct.NAME]=Fc.toString(this.type)),e}}var EV;class Vc{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&e.extractable!==void 0}constructor(){this.items=new Map,this[EV]="CryptoProvider",typeof self<"u"&&typeof crypto<"u"?this.set(Vc.DEFAULT,crypto):typeof global<"u"&&global.crypto&&global.crypto.subtle&&this.set(Vc.DEFAULT,global.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,t){return this.items.forEach(e,t)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=Vc.DEFAULT){const t=this.items.get(e.toLowerCase());if(!t)throw new Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if(typeof e=="string"){if(!t)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),t)}else this.items.set(Vc.DEFAULT,e);return this}}EV=Symbol.toStringTag,Vc.DEFAULT="default";const Pr=new Vc,ive=/^[0-2](?:\.[1-9][0-9]*)+$/;function sve(r){return new RegExp(ive).test(r)}class SV{constructor(e={}){this.items={};for(const t in e)this.register(t,e[t])}get(e){return this.items[e]||null}findId(e){return sve(e)?e:this.get(e)}register(e,t){this.items[e]=t,this.items[t]=e}}const On=new SV;On.register("CN","2.5.4.3"),On.register("L","2.5.4.7"),On.register("ST","2.5.4.8"),On.register("O","2.5.4.10"),On.register("OU","2.5.4.11"),On.register("C","2.5.4.6"),On.register("DC","0.9.2342.19200300.100.1.25"),On.register("E","1.2.840.113549.1.9.1"),On.register("G","2.5.4.42"),On.register("I","2.5.4.43"),On.register("SN","2.5.4.4"),On.register("T","2.5.4.12");function ove(r,e){return`\\${Se.ToHex(Se.FromUtf8String(e)).toUpperCase()}`}function ave(r){return r.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,ove)}class Ri{static isASCII(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!1;return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,t={}){this.extraNames=new SV,this.asn=new Yt;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const i=t[n];this.extraNames.register(n,i)}typeof e=="string"?this.asn=this.fromString(e):e instanceof Yt?this.asn=e:ue.isBufferSource(e)?this.asn=ae.parse(e,Yt):this.asn=this.fromJSON(e)}getField(e){const t=this.extraNames.findId(e)||On.findId(e),n=[];for(const i of this.asn)for(const s of i)s.type===t&&n.push(s.value.toString());return n}getName(e){return this.extraNames.get(e)||On.get(e)}toString(){return this.asn.map(e=>e.map(t=>{const n=this.getName(t.type)||t.type,i=t.value.anyValue?`#${Se.ToHex(t.value.anyValue)}`:ave(t.value.toString());return`${n}=${i}`}).join("+")).join(", ")}toJSON(){var e;const t=[];for(const n of this.asn){const i={};for(const s of n){const o=this.getName(s.type)||s.type;(e=i[o])!==null&&e!==void 0||(i[o]=[]),i[o].push(s.value.anyValue?`#${Se.ToHex(s.value.anyValue)}`:s.value.toString())}t.push(i)}return t}fromString(e){const t=new Yt,n=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g;let i=null,s=",";for(;i=n.exec(`${e},`);){let[,o,a]=i;const c=a[a.length-1];(c===","||c==="+")&&(a=a.slice(0,a.length-1),i[3]=c);const l=i[3];o=this.getTypeOid(o);const d=this.createAttribute(o,a);s==="+"?t[t.length-1].push(d):t.push(new yh([d])),s=l}return t}fromJSON(e){const t=new Yt;for(const n of e){const i=new yh;for(const s in n){const o=this.getTypeOid(s),a=n[s];for(const c of a){const l=this.createAttribute(o,c);i.push(l)}}t.push(i)}return t}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,t){const n=new ew({type:e});if(typeof t=="object")for(const i in t)switch(i){case"ia5String":n.value.ia5String=t[i];break;case"utf8String":n.value.utf8String=t[i];break;case"universalString":n.value.universalString=t[i];break;case"bmpString":n.value.bmpString=t[i];break;case"printableString":n.value.printableString=t[i];break}else if(t[0]==="#")n.value.anyValue=Se.FromHex(t.slice(1));else{const i=this.processStringValue(t);e===this.getName("E")||e===this.getName("DC")?n.value.ia5String=i:Ri.isPrintableString(i)?n.value.printableString=i:n.value.utf8String=i}return n}processStringValue(e){const t=/"(.*?[^\\])?"/.exec(e);return t&&(e=t[1]),e.replace(/\\0a/ig,`
`).replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return ae.serialize(this.asn)}async getThumbprint(...e){var t;let n,i="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(i=e[0]||i,n=e[1]||Pr.get()):n=e[0]||Pr.get(),await n.subtle.digest(i,this.toArrayBuffer())}}const xV="Cannot initialize GeneralName from ASN.1 data.",AV=`${xV} Unsupported string format in use.`,cve=`${xV} Value doesn't match to GUID regular expression.`,CV=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,IV="1.3.6.1.4.1.311.25.1",kV="1.3.6.1.4.1.311.20.2.3",$x="dns",Nx="dn",Mx="email",Ox="ip",Rx="url",Lx="guid",Bx="upn",o4="id";class Kc extends zc{constructor(...e){let t;if(e.length===2)switch(e[0]){case Nx:{const n=new Ri(e[1]).toArrayBuffer(),i=ae.parse(n,Yt);t=new Ue({directoryName:i});break}case $x:t=new Ue({dNSName:e[1]});break;case Mx:t=new Ue({rfc822Name:e[1]});break;case Lx:{const n=new RegExp(CV,"i").exec(e[1]);if(!n)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");const i=n.slice(1).map((s,o)=>o<3?Se.ToHex(new Uint8Array(Se.FromHex(s)).reverse()):s).join("");t=new Ue({otherName:new Cp({typeId:IV,value:ae.serialize(new tt(Se.FromHex(i)))})});break}case Ox:t=new Ue({iPAddress:e[1]});break;case o4:t=new Ue({registeredID:e[1]});break;case Bx:{t=new Ue({otherName:new Cp({typeId:kV,value:ae.serialize(_F.toASN(e[1]))})});break}case Rx:t=new Ue({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else ue.isBufferSource(e[0])?t=ae.parse(e[0],Ue):t=e[0];super(t)}onInit(e){if(e.dNSName!=null)this.type=$x,this.value=e.dNSName;else if(e.rfc822Name!=null)this.type=Mx,this.value=e.rfc822Name;else if(e.iPAddress!=null)this.type=Ox,this.value=e.iPAddress;else if(e.uniformResourceIdentifier!=null)this.type=Rx,this.value=e.uniformResourceIdentifier;else if(e.registeredID!=null)this.type=o4,this.value=e.registeredID;else if(e.directoryName!=null)this.type=Nx,this.value=new Ri(e.directoryName).toString();else if(e.otherName!=null)if(e.otherName.typeId===IV){this.type=Lx;const t=ae.parse(e.otherName.value,tt),n=new RegExp(CV,"i").exec(Se.ToHex(t));if(!n)throw new Error(cve);this.value=n.slice(1).map((i,s)=>s<3?Se.ToHex(new Uint8Array(Se.FromHex(i)).reverse()):i).join("-")}else if(e.otherName.typeId===kV)this.type=Bx,this.value=ae.parse(e.otherName.value,kr).toString();else throw new Error(AV);else throw new Error(AV)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case Nx:case $x:case Lx:case Ox:case o4:case Bx:case Rx:e=this.type.toUpperCase();break;case Mx:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let t=this.value;return this.type===o4&&(t=Fc.toString(t)),new ct(e,void 0,t)}}class Qp extends zc{constructor(e){let t;if(e instanceof yn)t=e;else if(Array.isArray(e)){const n=[];for(const i of e)if(i instanceof Ue)n.push(i);else{const s=ae.parse(new Kc(i.type,i.value).rawData,Ue);n.push(s)}t=new yn(n)}else if(ue.isBufferSource(e))t=ae.parse(e,yn);else throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(t)}onInit(e){const t=[];for(const n of e){let i=null;try{i=new Kc(n)}catch{continue}t.push(i)}this.items=t}toJSON(){return this.items.map(e=>e.toJSON())}toTextObject(){const e=super.toTextObjectEmpty();for(const t of this.items){const n=t.toTextObject();let i=e[n[ct.NAME]];Array.isArray(i)||(i=[],e[n[ct.NAME]]=i),i.push(n)}return e}}Qp.NAME="GeneralNames";const Yp="-{5}",Jp="\\n",lve=`[^${Jp}]+`,uve=`${Yp}BEGIN (${lve}(?=${Yp}))${Yp}`,dve=`${Yp}END \\1${Yp}`,Oh="\\n",hve=`[^:${Jp}]+`,fve=`(?:[^${Jp}]+${Oh}(?: +[^${Jp}]+${Oh})*)`,pve=`(?:[a-zA-Z0-9=+/]+${Oh})+`,_V=`${uve}${Oh}(?:((?:${hve}: ${fve})+))?${Oh}?(${pve})${dve}`;class fi{static isPem(e){return typeof e=="string"&&new RegExp(_V,"g").test(e)}static decodeWithHeaders(e){e=e.replace(/\r/g,"");const t=new RegExp(_V,"g"),n=[];let i=null;for(;i=t.exec(e);){const s=i[3].replace(new RegExp(`[${Jp}]+`,"g"),""),o={type:i[1],headers:[],rawData:Se.FromBase64(s)},a=i[2];if(a){const c=a.split(new RegExp(Oh,"g"));let l=null;for(const d of c){const[h,p]=d.split(/:(.*)/);if(p===void 0){if(!l)throw new Error("Cannot parse PEM string. Incorrect header value");l.value+=h.trim()}else l&&o.headers.push(l),l={key:h,value:p.trim()}}l&&o.headers.push(l)}n.push(o)}return n}static decode(e){return this.decodeWithHeaders(e).map(n=>n.rawData)}static decodeFirst(e){const t=this.decode(e);if(!t.length)throw new RangeError("PEM string doesn't contain any objects");return t[0]}static encode(e,t){if(Array.isArray(e)){const n=new Array;return t?e.forEach(i=>{if(!ue.isBufferSource(i))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");n.push(this.encodeStruct({type:t,rawData:ue.toArrayBuffer(i)}))}):e.forEach(i=>{if(!("type"in i))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");n.push(this.encodeStruct(i))}),n.join(`
`)}else{if(!t)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:t,rawData:ue.toArrayBuffer(e)})}}static encodeStruct(e){var t;const n=e.type.toLocaleUpperCase(),i=[];if(i.push(`-----BEGIN ${n}-----`),!((t=e.headers)===null||t===void 0)&&t.length){for(const l of e.headers)i.push(`${l.key}: ${l.value}`);i.push("")}const s=Se.ToBase64(e.rawData);let o,a=0;const c=Array();for(;a<s.length&&(s.length-a<64?o=s.substring(a):(o=s.substring(a,a+64),a+=64),o.length!==0);)if(c.push(o),o.length<64)break;return i.push(...c),i.push(`-----END ${n}-----`),i.join(`
`)}}fi.CertificateTag="CERTIFICATE",fi.CrlTag="CRL",fi.CertificateRequestTag="CERTIFICATE REQUEST",fi.PublicKeyTag="PUBLIC KEY",fi.PrivateKeyTag="PRIVATE KEY";class oa extends zc{static isAsnEncoded(e){return ue.isBufferSource(e)||typeof e=="string"}static toArrayBuffer(e){if(typeof e=="string"){if(fi.isPem(e))return fi.decode(e)[0];if(Se.isHex(e))return Se.FromHex(e);if(Se.isBase64(e))return Se.FromBase64(e);if(Se.isBase64Url(e))return Se.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}else{const t=Se.ToBinary(e);return fi.isPem(t)?fi.decode(t)[0]:Se.isHex(t)?Se.FromHex(t):Se.isBase64(t)?Se.FromBase64(t):Se.isBase64Url(t)?Se.FromBase64Url(t):ue.toArrayBuffer(e)}}constructor(...e){oa.isAsnEncoded(e[0])?super(oa.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){switch(e){case"pem":return fi.encode(this.rawData,this.tag);default:return super.toString(e)}}}class ys extends oa{static async create(e,t=Pr.get()){if(e instanceof ys)return e;if(Vc.isCryptoKey(e)){if(e.type!=="public")throw new TypeError("Public key is required");const n=await t.subtle.exportKey("spki",e);return new ys(n)}else{if(e.publicKey)return e.publicKey;if(ue.isBufferSource(e))return new ys(e);throw new TypeError("Unsupported PublicKeyType")}}constructor(e){oa.isAsnEncoded(e)?super(e,ps):super(e),this.tag=fi.PublicKeyTag}async export(...e){let t,n=["verify"],i={hash:"SHA-256",...this.algorithm};e.length>1?(i=e[0]||i,n=e[1]||n,t=e[2]||Pr.get()):t=e[0]||Pr.get();let s=this.rawData;const o=ae.parse(this.rawData,ps);return o.algorithm.algorithm===Kp&&(s=gve(o,s)),t.subtle.importKey("spki",s,i,!0,n)}onInit(e){const t=Tr.resolve(vu),n=this.algorithm=t.toWebAlgorithm(e.algorithm);switch(e.algorithm.algorithm){case yu:{const i=ae.parse(e.subjectPublicKey,cx),s=ue.toUint8Array(i.modulus);n.publicExponent=ue.toUint8Array(i.publicExponent),n.modulusLength=(s[0]?s:s.slice(1)).byteLength<<3;break}}}async getThumbprint(...e){var t;let n,i="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(i=e[0]||i,n=e[1]||Pr.get()):n=e[0]||Pr.get(),await n.subtle.digest(i,this.rawData)}async getKeyIdentifier(...e){let t,n="SHA-1";e.length===1?typeof e[0]=="string"?(n=e[0],t=Pr.get()):t=e[0]:e.length===2?(n=e[0],t=e[1]):t=Pr.get();const i=ae.parse(this.rawData,ps);return await t.subtle.digest(n,i.subjectPublicKey)}toTextObject(){const e=this.toTextObjectEmpty(),t=ae.parse(this.rawData,ps);switch(e.Algorithm=Eu.serializeAlgorithm(t.algorithm),t.algorithm.algorithm){case Fp:e["EC Point"]=t.subjectPublicKey;break;case yu:default:e["Raw Data"]=t.subjectPublicKey}return e}}function gve(r,e){return r.algorithm=new ye({algorithm:yu,parameters:null}),e=ae.serialize(r),e}class Xp extends Oi{static async create(e,t=!1,n=Pr.get()){if("name"in e&&"serialNumber"in e)return new Xp(e,t);const s=await(await ys.create(e,n)).getKeyIdentifier(n);return new Xp(Se.ToHex(s),t)}constructor(...e){if(ue.isBufferSource(e[0]))super(e[0]);else if(typeof e[0]=="string"){const t=new lu({keyIdentifier:new iS(Se.FromHex(e[0]))});super(nS,e[1],ae.serialize(t))}else{const t=e[0],n=t.name instanceof Qp?ae.parse(t.name.rawData,yn):t.name,i=new lu({authorityCertIssuer:n,authorityCertSerialNumber:Se.FromHex(t.serialNumber)});super(nS,e[1],ae.serialize(i))}}onInit(e){super.onInit(e);const t=ae.parse(e.extnValue,lu);t.keyIdentifier&&(this.keyId=Se.ToHex(t.keyIdentifier)),(t.authorityCertIssuer||t.authorityCertSerialNumber)&&(this.certId={name:t.authorityCertIssuer||[],serialNumber:t.authorityCertSerialNumber?Se.ToHex(t.authorityCertSerialNumber):""})}toTextObject(){const e=this.toTextObjectWithoutValue(),t=ae.parse(this.value,lu);return t.authorityCertIssuer&&(e["Authority Issuer"]=new Qp(t.authorityCertIssuer).toTextObject()),t.authorityCertSerialNumber&&(e["Authority Serial Number"]=t.authorityCertSerialNumber),t.keyIdentifier&&(e[""]=t.keyIdentifier),e}}Xp.NAME="Authority Key Identifier";class Ux extends Oi{constructor(...e){if(ue.isBufferSource(e[0])){super(e[0]);const t=ae.parse(this.value,rw);this.ca=t.cA,this.pathLength=t.pathLenConstraint}else{const t=new rw({cA:e[0],pathLenConstraint:e[1]});super(RF,e[2],ae.serialize(t)),this.ca=e[0],this.pathLength=e[1]}}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ca&&(e.CA=this.ca),this.pathLength!==void 0&&(e["Path Length"]=this.pathLength),e}}Ux.NAME="Basic Constraints";var TV;(function(r){r.serverAuth="1.3.6.1.5.5.7.3.1",r.clientAuth="1.3.6.1.5.5.7.3.2",r.codeSigning="1.3.6.1.5.5.7.3.3",r.emailProtection="1.3.6.1.5.5.7.3.4",r.timeStamping="1.3.6.1.5.5.7.3.8",r.ocspSigning="1.3.6.1.5.5.7.3.9"})(TV||(TV={}));class PV extends Oi{constructor(...e){if(ue.isBufferSource(e[0])){super(e[0]);const t=ae.parse(this.value,aw);this.usages=t.map(n=>n)}else{const t=new aw(e[0]);super(VF,e[1],ae.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.usages.map(t=>Fc.toString(t)).join(", "),e}}PV.NAME="Extended Key Usages";var DV;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(DV||(DV={}));class $V extends Oi{constructor(...e){if(ue.isBufferSource(e[0])){super(e[0]);const t=ae.parse(this.value,bS);this.usages=t.toNumber()}else{const t=new bS(e[0]);super(jF,e[1],ae.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=ae.parse(this.value,bS);return e[""]=t.toJSON().join(", "),e}}$V.NAME="Key Usages";class a4 extends Oi{static async create(e,t=!1,n=Pr.get()){const s=await(await ys.create(e,n)).getKeyIdentifier(n);return new a4(Se.ToHex(s),t)}constructor(...e){if(ue.isBufferSource(e[0])){super(e[0]);const t=ae.parse(this.value,Rc);this.keyId=Se.ToHex(t)}else{const t=typeof e[0]=="string"?Se.FromHex(e[0]):e[0],n=new Rc(t);super(YF,e[1],ae.serialize(n)),this.keyId=Se.ToHex(t)}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=ae.parse(this.value,Rc);return e[""]=t,e}}a4.NAME="Subject Key Identifier";class NV extends Oi{constructor(...e){ue.isBufferSource(e[0])?super(e[0]):super(GF,e[1],new Qp(e[0]||[]).rawData)}onInit(e){super.onInit(e);const t=ae.parse(e.extnValue,AS);this.names=new Qp(t)}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.names.toTextObject();for(const n in t)e[n]=t[n];return e}}NV.NAME="Subject Alternative Name";class Li{static register(e,t){this.items.set(e,t)}static create(e){const t=new Oi(e),n=this.items.get(t.type);return n?new n(e):t}}Li.items=new Map;class MV extends Oi{constructor(...e){var t;if(ue.isBufferSource(e[0])){super(e[0]);const n=ae.parse(this.value,sw);this.policies=n.map(i=>i.policyIdentifier)}else{const n=e[0],i=(t=e[1])!==null&&t!==void 0?t:!1,s=new sw(n.map(o=>new iw({policyIdentifier:o})));super(BF,i,ae.serialize(s)),this.policies=n}}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Policy=this.policies.map(t=>new ct("",{},Fc.toString(t))),e}}MV.NAME="Certificate Policies",Li.register(BF,MV);class OV extends Oi{constructor(...e){var t;if(ue.isBufferSource(e[0]))super(e[0]);else if(Array.isArray(e[0])&&typeof e[0][0]=="string"){const i=e[0].map(o=>new bh({distributionPoint:new uu({fullName:[new Ue({uniformResourceIdentifier:o})]})})),s=new vh(i);super(hS,e[1],ae.serialize(s))}else{const n=new vh(e[0]);super(hS,e[1],ae.serialize(n))}(t=this.distributionPoints)!==null&&t!==void 0||(this.distributionPoints=[])}onInit(e){super.onInit(e);const t=ae.parse(e.extnValue,vh);this.distributionPoints=t}toTextObject(){const e=this.toTextObjectWithoutValue();return e["Distribution Point"]=this.distributionPoints.map(t=>{var n;const i={};return t.distributionPoint&&(i[""]=(n=t.distributionPoint.fullName)===null||n===void 0?void 0:n.map(s=>new Kc(s).toString()).join(", ")),t.reasons&&(i.Reasons=t.reasons.toString()),t.cRLIssuer&&(i["CRL Issuer"]=t.cRLIssuer.map(s=>s.toString()).join(", ")),i}),e}}OV.NAME="CRL Distribution Points";class RV extends Oi{constructor(...e){var t,n,i,s;if(ue.isBufferSource(e[0]))super(e[0]);else if(e[0]instanceof wh){const o=new wh(e[0]);super(rS,e[1],ae.serialize(o))}else{const o=e[0],a=new wh;l4(a,o,$F,"ocsp"),l4(a,o,NF,"caIssuers"),l4(a,o,MF,"timeStamping"),l4(a,o,OF,"caRepository"),super(rS,e[1],ae.serialize(a))}(t=this.ocsp)!==null&&t!==void 0||(this.ocsp=[]),(n=this.caIssuers)!==null&&n!==void 0||(this.caIssuers=[]),(i=this.timeStamping)!==null&&i!==void 0||(this.timeStamping=[]),(s=this.caRepository)!==null&&s!==void 0||(this.caRepository=[])}onInit(e){super.onInit(e),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],ae.parse(e.extnValue,wh).forEach(n=>{switch(n.accessMethod){case $F:this.ocsp.push(new Kc(n.accessLocation));break;case NF:this.caIssuers.push(new Kc(n.accessLocation));break;case MF:this.timeStamping.push(new Kc(n.accessLocation));break;case OF:this.caRepository.push(new Kc(n.accessLocation));break}})}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ocsp.length&&c4(e,"OCSP",this.ocsp),this.caIssuers.length&&c4(e,"CA Issuers",this.caIssuers),this.timeStamping.length&&c4(e,"Time Stamping",this.timeStamping),this.caRepository.length&&c4(e,"CA Repository",this.caRepository),e}}RV.NAME="Authority Info Access";function c4(r,e,t){if(t.length===1)r[e]=t[0].toTextObject();else{const n=new ct("");t.forEach((i,s)=>{const o=i.toTextObject(),a=`${o[ct.NAME]} ${s+1}`;let c=n[a];Array.isArray(c)||(c=[],n[a]=c),c.push(o)}),r[e]=n}}function l4(r,e,t,n){const i=e[n];i&&(Array.isArray(i)?i:[i]).forEach(o=>{typeof o=="string"&&(o=new Kc("url",o)),r.push(new Ip({accessMethod:t,accessLocation:ae.parse(o.rawData,Ue)}))})}class Rh extends zc{constructor(...e){let t;if(ue.isBufferSource(e[0]))t=ue.toArrayBuffer(e[0]);else{const n=e[0],i=Array.isArray(e[1])?e[1].map(s=>ue.toArrayBuffer(s)):[];t=ae.serialize(new ra({type:n,values:i}))}super(t,ra)}onInit(e){this.type=e.type,this.values=e.values}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Value=this.values.map(t=>new ct("",{"":t})),e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty();return e[ct.NAME]===Rh.NAME&&(e[ct.NAME]=Fc.toString(this.type)),e}}Rh.NAME="Attribute";class LV extends Rh{constructor(...e){var t;if(ue.isBufferSource(e[0]))super(e[0]);else{const n=new n4({printableString:e[0]});super(Dz,[ae.serialize(n)])}(t=this.password)!==null&&t!==void 0||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){const t=ae.parse(this.values[0],n4);this.password=t.toString()}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[ct.VALUE]=this.password,e}}LV.NAME="Challenge Password";class Fx extends Rh{constructor(...e){var t;if(ue.isBufferSource(e[0]))super(e[0]);else{const n=e[0],i=new Lc;for(const s of n)i.push(ae.parse(s.rawData,Mi));super(xx,[ae.serialize(i)])}(t=this.items)!==null&&t!==void 0||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){const t=ae.parse(this.values[0],Lc);this.items=t.map(n=>Li.create(ae.serialize(n)))}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.items.map(n=>n.toTextObject());for(const n of t)e[n[ct.NAME]]=n;return e}}Fx.NAME="Extensions";class u4{static register(e,t){this.items.set(e,t)}static create(e){const t=new Rh(e),n=this.items.get(t.type);return n?new n(e):t}}u4.items=new Map;const Zp="crypto.signatureFormatter";class yve{toAsnSignature(e,t){return ue.toArrayBuffer(t)}toWebSignature(e,t){return ue.toArrayBuffer(t)}}var d4;let zx=d4=class{static createPssParams(e,t){const n=d4.getHashAlgorithm(e);return n?new wu({hashAlgorithm:n,maskGenAlgorithm:new ye({algorithm:zw,parameters:ae.serialize(n)}),saltLength:t}):null}static getHashAlgorithm(e){const t=Tr.resolve(vu);return typeof e=="string"?t.toAsnAlgorithm({name:e}):typeof e=="object"&&e&&"name"in e?t.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if("hash"in e){let t;if(typeof e.hash=="string")t=e.hash;else if(e.hash&&typeof e.hash=="object"&&"name"in e.hash&&typeof e.hash.name=="string")t=e.hash.name.toUpperCase();else throw new Error("Cannot get hash algorithm name");switch(t.toLowerCase()){case"sha-1":return new ye({algorithm:Mw,parameters:null});case"sha-256":return new ye({algorithm:sx,parameters:null});case"sha-384":return new ye({algorithm:Ow,parameters:null});case"sha-512":return new ye({algorithm:Rw,parameters:null})}}else return new ye({algorithm:yu,parameters:null});break;case"rsa-pss":if("hash"in e){if(!("saltLength"in e&&typeof e.saltLength=="number"))throw new Error("Cannot get 'saltLength' from 'alg' argument");const t=d4.createPssParams(e.hash,e.saltLength);if(!t)throw new Error("Cannot create PSS parameters");return new ye({algorithm:Kp,parameters:ae.serialize(t)})}else return new ye({algorithm:Kp,parameters:null})}return null}toWebAlgorithm(e){switch(e.algorithm){case yu:return{name:"RSASSA-PKCS1-v1_5"};case Mw:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case sx:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case Ow:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case Rw:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case Kp:if(e.parameters){const t=ae.parse(e.parameters,wu);return{name:"RSA-PSS",hash:Tr.resolve(vu).toWebAlgorithm(t.hashAlgorithm),saltLength:t.saltLength}}else return{name:"RSA-PSS"}}return null}};zx=d4=_([Yw()],zx),Tr.registerSingleton(Wp,zx);let Vx=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new ye({algorithm:Lw});case"sha-256":return new ye({algorithm:Bw});case"sha-384":return new ye({algorithm:Uw});case"sha-512":return new ye({algorithm:Fw})}return null}toWebAlgorithm(e){switch(e.algorithm){case Lw:return{name:"SHA-1"};case Bw:return{name:"SHA-256"};case Uw:return{name:"SHA-384"};case Fw:return{name:"SHA-512"}}return null}};Vx=_([Yw()],Vx),Tr.registerSingleton(Wp,Vx);class Bi{addPadding(e,t){const n=ue.toUint8Array(t),i=new Uint8Array(e);return i.set(n,e-n.length),i}removePadding(e,t=!1){let n=ue.toUint8Array(e);for(let i=0;i<n.length;i++)if(n[i]){n=n.slice(i);break}if(t&&n[0]>127){const i=new Uint8Array(n.length+1);return i.set(n,1),i.buffer}return n.buffer}toAsnSignature(e,t){if(e.name==="ECDSA"){const n=e.namedCurve,i=Bi.namedCurveSize.get(n)||Bi.defaultNamedCurveSize,s=new Nw,o=ue.toUint8Array(t);return s.r=this.removePadding(o.slice(0,i),!0),s.s=this.removePadding(o.slice(i,i+i),!0),ae.serialize(s)}return null}toWebSignature(e,t){if(e.name==="ECDSA"){const n=ae.parse(t,Nw),i=e.namedCurve,s=Bi.namedCurveSize.get(i)||Bi.defaultNamedCurveSize,o=this.addPadding(s,this.removePadding(n.r)),a=this.addPadding(s,this.removePadding(n.s));return s8e(o,a)}return null}}Bi.namedCurveSize=new Map,Bi.defaultNamedCurveSize=32;const Kx="1.3.101.110",BV="1.3.101.111",jx="1.3.101.112",UV="1.3.101.113";let Hx=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"ed25519":t=jx;break;case"x25519":t=Kx;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t=jx;break;case"ed448":t=UV;break}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t=Kx;break;case"x448":t=BV;break}}return t?new ye({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case jx:return{name:"Ed25519"};case UV:return{name:"EdDSA",namedCurve:"Ed448"};case Kx:return{name:"X25519"};case BV:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};Hx=_([Yw()],Hx),Tr.registerSingleton(Wp,Hx);class mve extends oa{constructor(e){oa.isAsnEncoded(e)?super(e,qp):super(e),this.tag=fi.CertificateRequestTag}onInit(e){this.tbs=ae.serialize(e.certificationRequestInfo),this.publicKey=new ys(e.certificationRequestInfo.subjectPKInfo);const t=Tr.resolve(vu);this.signatureAlgorithm=t.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signature,this.attributes=e.certificationRequestInfo.attributes.map(i=>u4.create(ae.serialize(i)));const n=this.getAttribute(xx);this.extensions=[],n instanceof Fx&&(this.extensions=n.items),this.subjectName=new Ri(e.certificationRequestInfo.subject),this.subject=this.subjectName.toString()}getAttribute(e){for(const t of this.attributes)if(t.type===e)return t;return null}getAttributes(e){return this.attributes.filter(t=>t.type===e)}getExtension(e){for(const t of this.extensions)if(t.type===e)return t;return null}getExtensions(e){return this.extensions.filter(t=>t.type===e)}async verify(e=Pr.get()){const t={...this.publicKey.algorithm,...this.signatureAlgorithm},n=await this.publicKey.export(t,["verify"],e),i=Tr.resolveAll(Zp).reverse();let s=null;for(const a of i)if(s=a.toWebSignature(t,this.signature),s)break;if(!s)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await e.subtle.verify(this.signatureAlgorithm,n,s,this.tbs)}toTextObject(){const e=this.toTextObjectEmpty(),t=ae.parse(this.rawData,qp),n=t.certificationRequestInfo,i=new ct("",{Version:`${du[n.version]} (${n.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){const s=new ct("");for(const o of this.attributes){const a=o.toTextObject();s[a[ct.NAME]]=a}i.Attributes=s}return e.Data=i,e.Signature=new ct("",{Algorithm:Eu.serializeAlgorithm(t.signatureAlgorithm),"":t.signature}),e}}mve.NAME="PKCS#10 Certificate Request";class qx extends oa{constructor(e){oa.isAsnEncoded(e)?super(e,hu):super(e),this.tag=fi.CertificateTag}onInit(e){const t=e.tbsCertificate;this.tbs=ae.serialize(t),this.serialNumber=Se.ToHex(t.serialNumber),this.subjectName=new Ri(t.subject),this.subject=new Ri(t.subject).toString(),this.issuerName=new Ri(t.issuer),this.issuer=this.issuerName.toString();const n=Tr.resolve(vu);this.signatureAlgorithm=n.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signatureValue;const i=t.validity.notBefore.utcTime||t.validity.notBefore.generalTime;if(!i)throw new Error("Cannot get 'notBefore' value");this.notBefore=i;const s=t.validity.notAfter.utcTime||t.validity.notAfter.generalTime;if(!s)throw new Error("Cannot get 'notAfter' value");this.notAfter=s,this.extensions=[],t.extensions&&(this.extensions=t.extensions.map(o=>Li.create(ae.serialize(o)))),this.publicKey=new ys(t.subjectPublicKeyInfo)}getExtension(e){for(const t of this.extensions)if(typeof e=="string"){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter(t=>typeof e=="string"?t.type===e:t instanceof e)}async verify(e={},t=Pr.get()){let n,i;const s=e.publicKey;try{if(!s)n={...this.publicKey.algorithm,...this.signatureAlgorithm},i=await this.publicKey.export(n,["verify"],t);else if("publicKey"in s)n={...s.publicKey.algorithm,...this.signatureAlgorithm},i=await s.publicKey.export(n,["verify"],t);else if(s instanceof ys)n={...s.algorithm,...this.signatureAlgorithm},i=await s.export(n,["verify"],t);else if(ue.isBufferSource(s)){const l=new ys(s);n={...l.algorithm,...this.signatureAlgorithm},i=await l.export(n,["verify"],t)}else n={...s.algorithm,...this.signatureAlgorithm},i=s}catch{return!1}const o=Tr.resolveAll(Zp).reverse();let a=null;for(const l of o)if(a=l.toWebSignature(n,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");const c=await t.subtle.verify(this.signatureAlgorithm,i,a,this.tbs);if(e.signatureOnly)return c;{const d=(e.date||new Date).getTime();return c&&this.notBefore.getTime()<d&&d<this.notAfter.getTime()}}async getThumbprint(...e){let t,n="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(n=e[0]||n,t=e[1])),t??(t=Pr.get()),await t.subtle.digest(n,this.rawData)}async isSelfSigned(e=Pr.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},e)}toTextObject(){const e=this.toTextObjectEmpty(),t=ae.parse(this.rawData,hu),n=t.tbsCertificate,i=new ct("",{Version:`${du[n.version]} (${n.version})`,"Serial Number":n.serialNumber,"Signature Algorithm":Eu.serializeAlgorithm(n.signature),Issuer:this.issuer,Validity:new ct("",{"Not Before":n.validity.notBefore.getTime(),"Not After":n.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(n.issuerUniqueID&&(i["Issuer Unique ID"]=n.issuerUniqueID),n.subjectUniqueID&&(i["Subject Unique ID"]=n.subjectUniqueID),this.extensions.length){const s=new ct("");for(const o of this.extensions){const a=o.toTextObject();s[a[ct.NAME]]=a}i.Extensions=s}return e.Data=i,e.Signature=new ct("",{Algorithm:Eu.serializeAlgorithm(t.signatureAlgorithm),"":t.signatureValue}),e}}qx.NAME="Certificate";class wve{static async createSelfSigned(e,t=Pr.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},t)}static async create(e,t=Pr.get()){var n;let i;e.publicKey instanceof ys?i=e.publicKey.rawData:"publicKey"in e.publicKey?i=e.publicKey.publicKey.rawData:ue.isBufferSource(e.publicKey)?i=e.publicKey:i=await t.subtle.exportKey("spki",e.publicKey);const s=e.serialNumber?ue.toUint8Array(Se.FromHex(e.serialNumber)):t.getRandomValues(new Uint8Array(16));s[0]>127&&(s[0]&=127),s.length>1&&s[0]===0&&(s[1]|=128);const o=e.notBefore||new Date,a=e.notAfter||new Date(o.getTime()+31536e6),c=new hu({tbsCertificate:new hi({version:du.v3,serialNumber:s,validity:new Tp({notBefore:o,notAfter:a}),extensions:new Lc(((n=e.extensions)===null||n===void 0?void 0:n.map(v=>ae.parse(v.rawData,Mi)))||[]),subjectPublicKeyInfo:ae.parse(i,ps)})});if(e.subject){const v=e.subject instanceof Ri?e.subject:new Ri(e.subject);c.tbsCertificate.subject=ae.parse(v.toArrayBuffer(),Yt)}if(e.issuer){const v=e.issuer instanceof Ri?e.issuer:new Ri(e.issuer);c.tbsCertificate.issuer=ae.parse(v.toArrayBuffer(),Yt)}const l={hash:"SHA-256"},d="signingKey"in e?{...l,...e.signingAlgorithm,...e.signingKey.algorithm}:{...l,...e.signingAlgorithm},h=Tr.resolve(vu);c.tbsCertificate.signature=c.signatureAlgorithm=h.toAsnAlgorithm(d);const p=ae.serialize(c.tbsCertificate),m="signingKey"in e?await t.subtle.sign(d,e.signingKey,p):e.signature,f=Tr.resolveAll(Zp).reverse();let g=null;for(const v of f)if(g=v.toAsnSignature(d,m),g)break;if(!g)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return c.signatureValue=g,new qx(ae.serialize(c))}}var FV;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(FV||(FV={})),Li.register(RF,Ux),Li.register(VF,PV),Li.register(jF,$V),Li.register(YF,a4),Li.register(nS,Xp),Li.register(GF,NV),Li.register(hS,OV),Li.register(rS,RV),u4.register(Dz,LV),u4.register(xx,Fx),Tr.registerSingleton(Zp,yve),Tr.registerSingleton(Zp,Bi),Bi.namedCurveSize.set("P-256",32),Bi.namedCurveSize.set("K-256",32),Bi.namedCurveSize.set("P-384",48),Bi.namedCurveSize.set("P-521",66);function zV(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function bve(r){return new TextEncoder().encode(r)}function vve(r){return new TextDecoder().decode(r)}function Eve(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var Sve=Eve,xve=Sve;let Ave=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Cve=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return VV(this,e)}},Ive=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return VV(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function VV(r,e){return new Ive({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let kve=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Ave(e,t,n),this.decoder=new Cve(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function h4({name:r,prefix:e,encode:t,decode:n}){return new kve(r,e,t,n)}function e0({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=xve(t,r);return h4({prefix:e,name:r,encode:n,decode:s=>zV(i(s))})}function _ve(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Tve(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Dr({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return h4({prefix:e,name:r,encode(i){return Tve(i,n,t)},decode(i){return _ve(i,n,t,r)}})}const Pve=Dr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Dve=Dr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Wx=Dr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),$ve=Dr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Nve=Object.freeze(Object.defineProperty({__proto__:null,base64:Pve,base64pad:Dve,base64url:Wx,base64urlpad:$ve},Symbol.toStringTag,{value:"Module"}));var Mve=jV,KV=128,Ove=-128,Rve=Math.pow(2,31);function jV(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Rve;)e[t++]=r&255|KV,r/=128;for(;r&Ove;)e[t++]=r&255|KV,r>>>=7;return e[t]=r|0,jV.bytes=t-n+1,e}var Lve=Gx,Bve=128,HV=127;function Gx(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Gx.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&HV)<<i:(o&HV)*Math.pow(2,i),i+=7}while(o>=Bve);return Gx.bytes=s-n,t}var Uve=Math.pow(2,7),Fve=Math.pow(2,14),zve=Math.pow(2,21),Vve=Math.pow(2,28),Kve=Math.pow(2,35),jve=Math.pow(2,42),Hve=Math.pow(2,49),qve=Math.pow(2,56),Wve=Math.pow(2,63),Gve=function(r){return r<Uve?1:r<Fve?2:r<zve?3:r<Vve?4:r<Kve?5:r<jve?6:r<Hve?7:r<qve?8:r<Wve?9:10},Qve={encode:Mve,decode:Lve,encodingLength:Gve},f4=Qve;function qV(r,e=0){return[f4.decode(r,e),f4.decode.bytes]}function WV(r,e,t=0){return f4.encode(r,e,t),e}function GV(r){return f4.encodingLength(r)}function p4(r,e){const t=e.byteLength,n=GV(r),i=n+GV(t),s=new Uint8Array(i+t);return WV(r,s,0),WV(t,s,n),s.set(e,i),new QV(r,t,e,s)}function Yve(r){const e=zV(r),[t,n]=qV(e),[i,s]=qV(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new QV(t,i,o,e)}let QV=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function Jve({name:r,code:e,encode:t}){return new Xve(r,e,t)}let Xve=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?p4(this.code,t):t.then(n=>p4(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Zve(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const Qx=Jve({name:"sha2-256",code:18,encode:Zve("SHA-256")});class e7e extends er{async listen(){throw new F6e("WebRTCTransport.createListener")}getAddrs(){return[]}updateAnnounceAddrs(){}async close(){}}const t7e=e0({prefix:"9",name:"base10",alphabet:"0123456789"}),r7e=Object.freeze(Object.defineProperty({__proto__:null,base10:t7e},Symbol.toStringTag,{value:"Module"})),n7e=Dr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),i7e=Dr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),s7e=Object.freeze(Object.defineProperty({__proto__:null,base16:n7e,base16upper:i7e},Symbol.toStringTag,{value:"Module"})),o7e=Dr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),a7e=Object.freeze(Object.defineProperty({__proto__:null,base2:o7e},Symbol.toStringTag,{value:"Module"})),YV=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),c7e=YV.reduce((r,e,t)=>(r[t]=e,r),[]),l7e=YV.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function u7e(r){return r.reduce((e,t)=>(e+=c7e[t],e),"")}function d7e(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const i=l7e[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const h7e=h4({prefix:"🚀",name:"base256emoji",encode:u7e,decode:d7e}),f7e=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:h7e},Symbol.toStringTag,{value:"Module"})),p7e=Dr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),g7e=Dr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),y7e=Dr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),m7e=Dr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),w7e=Dr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),b7e=Dr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),v7e=Dr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),E7e=Dr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),S7e=Dr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),x7e=Object.freeze(Object.defineProperty({__proto__:null,base32:p7e,base32hex:w7e,base32hexpad:v7e,base32hexpadupper:E7e,base32hexupper:b7e,base32pad:y7e,base32padupper:m7e,base32upper:g7e,base32z:S7e},Symbol.toStringTag,{value:"Module"})),A7e=e0({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),C7e=e0({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),I7e=Object.freeze(Object.defineProperty({__proto__:null,base36:A7e,base36upper:C7e},Symbol.toStringTag,{value:"Module"})),k7e=e0({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),_7e=e0({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),T7e=Object.freeze(Object.defineProperty({__proto__:null,base58btc:k7e,base58flickr:_7e},Symbol.toStringTag,{value:"Module"})),P7e=Dr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),D7e=Object.freeze(Object.defineProperty({__proto__:null,base8:P7e},Symbol.toStringTag,{value:"Module"})),$7e=h4({prefix:"\0",name:"identity",encode:r=>vve(r),decode:r=>bve(r)}),N7e=Object.freeze(Object.defineProperty({__proto__:null,identity:$7e},Symbol.toStringTag,{value:"Module"}));new TextEncoder,new TextDecoder;const M7e={...N7e,...a7e,...D7e,...r7e,...s7e,...x7e,...I7e,...T7e,...Nve,...f7e},JV=Object.values(M7e).map(r=>r.decoder).reduce((r,e)=>r.or(e)),O7e=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function R7e(r){var t;if(r==null)return;const e=r.match(O7e);return(t=e==null?void 0:e.groups)==null?void 0:t.fingerprint}function XV(r){const t=r.stringTuples().filter(n=>n[0]===l6e).map(n=>n[1])[0];if(t===void 0||t==="")throw new Z(`Couldn't find a certhash component of multiaddr: ${r.toString()}`);return t}function L7e(r){return Yve(JV.decode(r))}function B7e(r){const e=L7e(XV(r)),t=F7e(e.code),n=e.digest.reduce((s,o)=>s+o.toString(16).padStart(2,"0"),""),i=n.match(/.{1,2}/g);if(i==null)throw new U6e(n,r.toString());return`${t} ${i.join(":").toUpperCase()}`}function U7e(r){const e=r.split(":").map(i=>parseInt(i,16)),t=Uint8Array.from(e),n=p4(Qx.code,t);return Re(`/certhash/${Wx.encode(n.bytes)}`)}function F7e(r){switch(r){case 17:return"sha-1";case 18:return"sha-256";case 19:return"sha-512";default:throw new z6e(r)}}function z7e(r,e){const{host:t,port:n,family:i}=r.toOptions(),s=B7e(r);return{type:"answer",sdp:`v=0
o=- 0 0 IN IP${i} ${t}
s=-
t=0 0
a=ice-lite
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
c=IN IP${i} ${t}
a=mid:0
a=ice-options:ice2
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:${s}
a=setup:passive
a=sctp-port:5000
a=max-message-size:${Y3}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function V7e(r,e){const{host:t,port:n,family:i}=r.toOptions();return{type:"offer",sdp:`v=0
o=- 0 0 IN IP${i} ${t}
s=-
c=IN IP${i} ${t}
t=0 0
a=ice-options:ice2,trickle
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:active
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:sha-256 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
a=sctp-port:5000
a=max-message-size:${Y3}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function ZV(r,e){if(r.sdp===void 0)throw new Z("Can't munge a missing SDP");const t=r.sdp.includes(`\r
`)?`\r
`:`
`;return r.sdp=r.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,`
a=ice-ufrag:`+e+t).replace(/\na=ice-pwd:[^\n]*\n/,`
a=ice-pwd:`+e+t),r}const Yx=se("libp2p-webrtc-noise:");function K7e(r,e,t){const n=r.trim().toLowerCase().replaceAll(":",""),i=se(n,"hex"),s=p4(Qx.code,i),o=JV.decode(XV(e)),a=Yx.byteLength+s.bytes.byteLength+o.byteLength;return or(t==="server"?[Yx,o,s.bytes]:[Yx,s.bytes,o],a)}const j7e=VE?"iceconnectionstatechange":"connectionstatechange";async function H7e(r,e,t){var i,s,o;const n=r.createDataChannel("",{negotiated:!0,id:0});try{if(t.role==="client"){t.log.trace("client creating local offer");const f=await r.createOffer();t.log.trace("client created local offer %s",f.sdp);const g=ZV(f,e);t.log.trace("client setting local offer %s",g.sdp),await r.setLocalDescription(g);const v=z7e(t.remoteAddr,e);t.log.trace("client setting server description %s",v.sdp),await r.setRemoteDescription(v)}else{const f=V7e(t.remoteAddr,e);t.log.trace("server setting client %s %s",f.type,f.sdp),await r.setRemoteDescription(f),t.log.trace("server creating local answer");const g=await r.createAnswer();t.log.trace("server created local answer");const v=ZV(g,e);t.log.trace("server setting local description %s",g.sdp),await r.setLocalDescription(v)}if(n.readyState!=="open"&&(t.log.trace("%s wait for handshake channel to open, starting status %s",t.role,n.readyState),await Ti(n,"open",t.signal)),t.log.trace("%s handshake channel opened",t.role),t.role==="server"){const f=((i=r.remoteFingerprint())==null?void 0:i.value)??"";t.remoteAddr=t.remoteAddr.encapsulate(U7e(f))}const a=R7e((s=r.localDescription)==null?void 0:s.sdp);if(a==null)throw new Ap("Could not get fingerprint from local description sdp");t.log.trace("%s performing noise handshake",t.role);const c=K7e(a,t.remoteAddr,t.role),l=dL({prologueBytes:c})(t),d=J3({channel:n,direction:"outbound",handshake:!0,logger:t.logger,...t.dataChannel??{}}),h=new KE(t,{peerConnection:r,remoteAddr:t.remoteAddr,timeline:{open:Date.now()},metrics:t.events});r.addEventListener(j7e,()=>{switch(r.connectionState){case"failed":case"disconnected":case"closed":h.close().catch(f=>{t.log.error("error closing connection",f),h.abort(f)});break;default:break}}),(o=t.events)==null||o.increment({peer_connection:!0});const p=new jE(t,{peerConnection:r,metrics:t.events,dataChannelOptions:t.dataChannel});if(t.role==="client")return t.log.trace("%s secure inbound",t.role),await l.secureInbound(d,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0}),t.log.trace("%s upgrade outbound",t.role),await t.upgrader.upgradeOutbound(h,{skipProtection:!0,skipEncryption:!0,muxerFactory:p,signal:t.signal});t.log.trace("%s secure outbound",t.role);const m=await l.secureOutbound(d,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0});h.remoteAddr=h.remoteAddr.encapsulate(`/p2p/${m.remotePeer}`),t.log.trace("%s upgrade inbound",t.role),await t.upgrader.upgradeInbound(h,{skipProtection:!0,skipEncryption:!0,muxerFactory:p,signal:t.signal})}catch(a){throw n.close(),a}}async function q7e(r,e,t,n){n==null&&(n=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"}));const i=typeof t=="function"?await t():t;return new RTCPeerConnection({...i??{},certificates:[n]})}async function W7e(r){const e=await WD(r),t=await crypto.subtle.exportKey("pkcs8",e.privateKey);return["-----BEGIN PRIVATE KEY-----",...re(new Uint8Array(t),"base64pad").split(/(.{64})/).filter(Boolean),"-----END PRIVATE KEY-----"].join(`
`)}EH=T2,vH=Symbol.toStringTag,bH=dr;class G7e{constructor(e,t={}){u(this,"log");u(this,"metrics");u(this,"components");u(this,"init");u(this,"certificate");u(this,"privateKey");u(this,"emitter");u(this,"renewCertificateTask");u(this,EH,!0);u(this,vH,"@libp2p/webrtc-direct");u(this,bH,["@libp2p/transport"]);if(this.log=e.logger.forComponent("libp2p:webrtc-direct"),this.components=e,this.init=t,this.emitter=new er,t.certificateLifespan!=null&&t.certificateRenewalThreshold!=null&&t.certificateRenewalThreshold>=t.certificateLifespan)throw new Z("Certificate renewal threshold must be less than certificate lifespan");e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}async start(){this.certificate=await this.getCertificate()}async stop(){this.renewCertificateTask!=null&&clearTimeout(this.renewCertificateTask),this.certificate=void 0}async dial(e,t){var a;this.log("dial %a",e),t.signal.throwIfAborted();let n;const i=e.getPeerId();i!=null&&(n=tr(i));const s=O6e(),o=await q7e("client",s,typeof this.init.rtcConfiguration=="function"?await this.init.rtcConfiguration():this.init.rtcConfiguration??{});try{return await H7e(o,s,{role:"client",log:this.log,logger:this.components.logger,metrics:this.components.metrics,events:(a=this.metrics)==null?void 0:a.dialerEvents,signal:t.signal,remoteAddr:e,dataChannel:this.init.dataChannel,upgrader:t.upgrader,peerId:this.components.peerId,remotePeerId:n,privateKey:this.components.privateKey})}catch(c){throw o.close(),c}}createListener(e){if(this.certificate==null)throw new Pl;return new e7e(this.components,{...this.init,...e,certificate:this.certificate,emitter:this.emitter})}listenFilter(e){return e.filter(M7.exactMatch)}dialFilter(e){return this.listenFilter(e)}async getCertificate(e){if(Q7e(this.init.certificate))return this.log("using provided TLS certificate"),this.init.certificate;const t=await this.loadOrCreatePrivateKey(),{pem:n,certhash:i}=await this.loadOrCreateCertificate(t,e);return{privateKey:await W7e(t),pem:n,certhash:i}}async loadOrCreatePrivateKey(){if(this.privateKey!=null)return this.privateKey;const e=this.init.certificateKeychainName??w6e,t=this.getKeychain();try{if(t==null)throw this.log("no keychain configured - not checking for stored private key"),new Zt;this.log.trace("checking for stored private key"),this.privateKey=await t.exportKey(e)}catch(n){if(n.name!=="NotFoundError")throw n;this.log.trace("generating private key"),this.privateKey=await dy("ECDSA","P-256"),t!=null?(this.log.trace("storing private key"),await t.importKey(e,this.privateKey)):this.log("no keychain configured - not storing private key")}return this.privateKey}async loadOrCreateCertificate(e,t){if(this.certificate!=null&&t!==!0)return this.certificate;let n;const i=new xt(this.init.certificateDatastoreKey??m6e),s=await WD(e);try{if(t===!0)throw this.log.trace("forcing renewal of TLS certificate"),new Zt;this.log.trace("checking for stored TLS certificate"),n=await this.loadCertificate(i,s)}catch(a){if(a.name!=="NotFoundError")throw a;this.log.trace("generating new TLS certificate"),n=await this.createCertificate(i,s)}let o=n.notAfter.getTime()-(this.init.certificateRenewalThreshold??gF)-Date.now();return o<0&&(o=100),this.log("will renew TLS certificate after %d ms",o),this.renewCertificateTask=setTimeout(()=>{this.log("renewing TLS certificate"),this.getCertificate(!0).then(a=>{this.certificate=a,this.emitter.safeDispatchEvent("certificate:renew",{detail:a})}).catch(a=>{this.log.error("could not renew certificate - %e",a)})},o),{pem:n.toString("pem"),certhash:Wx.encode((await Qx.digest(new Uint8Array(n.rawData))).bytes)}}async loadCertificate(e,t){const n=await this.components.datastore.get(e),i=new qx(n),s=i.notAfter.getTime()-(this.init.certificateRenewalThreshold??gF);if(Date.now()>s)throw this.log("stored TLS certificate has expired"),new Zt;this.log("loaded certificate, expires in %d ms",s);const o=await i.publicKey.export(crypto),a=await crypto.subtle.exportKey("raw",o),c=await crypto.subtle.exportKey("raw",t.publicKey);if(!qe(new Uint8Array(a,0,a.byteLength),new Uint8Array(c,0,c.byteLength)))throw this.log("stored TLS certificate public key did not match public key from private key"),new Zt;return this.log("loaded certificate, expiry time is %o",s),i}async createCertificate(e,t){const n=new Date,i=new Date(Date.now()+(this.init.certificateLifespan??b6e));n.setMilliseconds(0),i.setMilliseconds(0);const s=await wve.createSelfSigned({serialNumber:(BigInt(Math.random().toString().replace(".",""))*100000n).toString(16),name:"CN=example.com, C=US, L=CA, O=example, ST=CA",notBefore:n,notAfter:i,keys:t,extensions:[new Ux(!1,void 0,!0)]},crypto);return this.getKeychain()!=null?(this.log.trace("storing TLS certificate"),await this.components.datastore.put(e,se(s.toString("pem")))):this.log("no keychain is configured so not storing TLS certificate since the private key will not be reused"),s}getKeychain(){try{return this.components.keychain}catch{}}}function Q7e(r){return r==null?!1:typeof r.privateKey=="string"&&typeof r.pem=="string"&&typeof r.certhash=="string"}function Y7e(r){return e=>new G7e(e,r)}function Jx(r){return e=>new H6e(e,r)}const J7e=async r=>{if(r.readyState>=2)throw new Error("socket closed");r.readyState!==1&&await new Promise((e,t)=>{function n(){r.removeEventListener("open",i),r.removeEventListener("error",s)}function i(){n(),e()}function s(o){n(),t(o.error??new Error(`connect ECONNREFUSED ${r.url}`))}r.addEventListener("open",i),r.addEventListener("error",s)})},X7e=(r,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,async n=>{for await(const i of n){try{await J7e(r)}catch(s){if(s.message==="socket closed")break;throw s}if(r.readyState===r.CLOSING||r.readyState===r.CLOSED)break;r.send(i)}e.closeOnEnd!=null&&r.readyState<=1&&await new Promise((i,s)=>{r.addEventListener("close",o=>{if(o.wasClean||o.code===1006)i();else{const a=Object.assign(new Error("ws error"),{event:o});s(a)}}),setTimeout(()=>{r.close()})})});var g4={},y4={};Object.defineProperty(y4,"__esModule",{value:!0});class Z7e{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const t={value:e,done:!1};if(this.pullQueue.length){const n=this.pullQueue.shift();n&&n.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{const t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{const t=this.pushQueue.shift();return t?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((n,i)=>{this.pullQueue.push({resolve:n,reject:i})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}let eK=class{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){const i=new Z7e;i.highWaterMark=t,i.lowWaterMark=n,i.removeCallback=e({push:s=>i.push(s),stop:()=>i.stop(),fail:s=>i.fail(s),on:(s,o)=>{i.eventHandlers[s]=o}})||(()=>{}),this[Symbol.asyncIterator]=()=>i[Symbol.asyncIterator](),Object.freeze(this)}};y4.EventIterator=eK,y4.default=eK,Object.defineProperty(g4,"__esModule",{value:!0});const Xx=y4;var e9e=g4.EventIterator=Xx.EventIterator;function t9e(r,e,t){return new Xx.EventIterator(({push:n})=>(this.addEventListener(r,n,e),()=>this.removeEventListener(r,n,e)),t)}g4.subscribe=t9e,g4.default=Xx.EventIterator;function tK(r){var e;return r instanceof ArrayBuffer||((e=r==null?void 0:r.constructor)==null?void 0:e.name)==="ArrayBuffer"&&typeof(r==null?void 0:r.byteLength)=="number"}const r9e=r=>{r.binaryType="arraybuffer";const e=async()=>{await new Promise((s,o)=>{if(n){s();return}if(i!=null){o(i);return}const a=d=>{r.removeEventListener("open",c),r.removeEventListener("error",l),d()},c=()=>{a(s)},l=d=>{a(()=>{o(d.error??new Error(`connect ECONNREFUSED ${r.url}`))})};r.addEventListener("open",c),r.addEventListener("error",l)})},t=async function*(){const s=new e9e(({push:o,stop:a,fail:c})=>{const l=h=>{let p=null;typeof h.data=="string"&&(p=se(h.data)),tK(h.data)&&(p=new Uint8Array(h.data)),h.data instanceof Uint8Array&&(p=h.data),p!=null&&o(p)},d=h=>{c(h.error??new Error("Socket error"))};return r.addEventListener("message",l),r.addEventListener("error",d),r.addEventListener("close",a),()=>{r.removeEventListener("message",l),r.removeEventListener("error",d),r.removeEventListener("close",a)}},{highWaterMark:1/0});await e();for await(const o of s)yield tK(o)?new Uint8Array(o):o}();let n=r.readyState===1,i;return r.addEventListener("open",()=>{n=!0,i=null}),r.addEventListener("close",()=>{n=!1,i=null}),r.addEventListener("error",s=>{n||(i=s.error??new Error(`connect ECONNREFUSED ${r.url}`))}),Object.assign(t,{connected:e})},n9e=(r,e)=>{e=e??{};const t=r9e(r);let n=e.remoteAddress,i=e.remotePort;if(r.url!=null)try{const o=new URL(r.url);n=o.hostname,i=parseInt(o.port,10)}catch{}if(n==null||i==null)throw new Error("Remote connection did not have address and/or port");return{sink:X7e(r,e),source:t,connected:async()=>{await t.connected()},close:async()=>{(r.readyState===r.CONNECTING||r.readyState===r.OPEN)&&await new Promise(o=>{r.addEventListener("close",()=>{o()}),r.close()})},destroy:()=>{r.terminate!=null?r.terminate():r.close()},remoteAddress:n,remotePort:i,socket:r}},i9e=WebSocket,s9e={"http:":"ws:","https:":"wss:"},rK="ws:",o9e=(r,e)=>{if(r.startsWith("//")&&(r=`${(e==null?void 0:e.protocol)??rK}${r}`),r.startsWith("/")&&e!=null){const n=e.protocol??rK,i=e.host,s=e.port!=null&&(i==null?void 0:i.endsWith(`:${e.port}`))!==!0?`:${e.port}`:"";r=`${n}//${i}${s}${r}`}const t=new URL(r);for(const[n,i]of Object.entries(s9e))t.protocol===n&&(t.protocol=i);return t};function a9e(r,e){const t=typeof window>"u"?void 0:window.location;e=e??{};const n=o9e(r,t),i=new i9e(n.toString(),e.websocket);return n9e(i,e)}function c9e(r){return r.filter(e=>pm.exactMatch(e)||G1.exactMatch(e))}function l9e(){throw new Error("WebSocket Servers can not be created in the browser!")}const u9e=500;function d9e(r,e,t){const n=t.logger.forComponent("libp2p:websockets:maconn"),i=t.metrics,s=t.metricPrefix??"",o={log:n,async sink(a){try{await r.sink(async function*(){for await(const c of a)c instanceof Uint8Array?yield c:yield c.subarray()}())}catch(c){c.type!=="aborted"&&n.error(c)}},source:r.source,remoteAddr:e,timeline:{open:Date.now()},async close(a={}){var d,h;const c=Date.now();if(a.signal==null){const p=AbortSignal.timeout(u9e);a={...a,signal:p}}const l=()=>{const{host:p,port:m}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s after %dms, destroying it manually",p,m,Date.now()-c),this.abort(new _l("Socket close timeout"))};(d=a.signal)==null||d.addEventListener("abort",l);try{await r.close()}catch(p){n.error("error closing WebSocket gracefully",p),this.abort(p)}finally{(h=a.signal)==null||h.removeEventListener("abort",l),o.timeline.close=Date.now()}},abort(a){const{host:c,port:l}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s due to error",c,l,a),r.destroy(),o.timeline.close=Date.now(),i==null||i.increment({[`${s}error`]:!0})}};return r.socket.addEventListener("close",()=>{i==null||i.increment({[`${s}close`]:!0}),o.timeline.close==null&&(o.timeline.close=Date.now())},{once:!0}),o}AH=T2,xH=Symbol.toStringTag,SH=dr;class h9e{constructor(e,t={}){u(this,"log");u(this,"init");u(this,"logger");u(this,"metrics");u(this,"components");u(this,AH,!0);u(this,xH,"@libp2p/websockets");u(this,SH,["@libp2p/transport"]);this.log=e.logger.forComponent("libp2p:websockets"),this.logger=e.logger,this.components=e,this.init=t,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}async dial(e,t){var o;this.log("dialing %s",e),t=t??{};const n=await this._connect(e,t),i=d9e(n,e,{logger:this.logger,metrics:(o=this.metrics)==null?void 0:o.dialerEvents});this.log("new outbound connection %s",i.remoteAddr);const s=await t.upgrader.upgradeOutbound(i,t);return this.log("outbound connection %s upgraded",i.remoteAddr),s}async _connect(e,t){var o,a,c,l,d;(o=t==null?void 0:t.signal)==null||o.throwIfAborted();const n=e.toOptions();this.log("dialing %s:%s",n.host,n.port);const i=Le(),s=a9e(PO(e),this.init);s.socket.addEventListener("error",()=>{var p;const h=new Sb(`Could not connect to ${e.toString()}`);this.log.error("connection error:",h),(p=this.metrics)==null||p.dialerEvents.increment({error:!0}),i.reject(h)});try{(a=t.onProgress)==null||a.call(t,new _e("websockets:open-connection")),await ln(Promise.race([s.connected(),i.promise]),t.signal)}catch(h){throw(c=t.signal)!=null&&c.aborted&&((l=this.metrics)==null||l.dialerEvents.increment({abort:!0})),s.close().catch(p=>{this.log.error("error closing raw socket",p)}),h}return this.log("connected %s",e),(d=this.metrics)==null||d.dialerEvents.increment({connect:!0}),s}createListener(e){return l9e({logger:this.logger,events:this.components.events,metrics:this.components.metrics},{...this.init,...e})}listenFilter(e){var t,n;return e=Array.isArray(e)?e:[e],((t=this.init)==null?void 0:t.filter)!=null?(n=this.init)==null?void 0:n.filter(e):c9e(e)}dialFilter(e){return this.listenFilter(e)}}function Zx(r={}){return e=>new h9e(e,r)}function f9e(r,e){const t=e.map((n,i)=>({record:tp(n),index:i}));return t.sort((n,i)=>{const s=n.record.sequence,o=i.record.sequence;if(s>o)return-1;if(s<o)return 1;if(n.record.validityType===ss.ValidityType.EOL&&i.record.validityType===ss.ValidityType.EOL){const a=J7.fromString(n.record.validity).toDate(),c=J7.fromString(i.record.validity).toDate();if(a.getTime()>c.getTime())return-1;if(a.getTime()<c.getTime())return 1}return 0}),t[0].index}const nK="2.8.5",iK="js-libp2p";function sK(r,e){return`${r??iK}/${e??nK} browser/${globalThis.navigator.userAgent}`}const p9e="5.3.0",g9e="helia",y9e={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};function m9e(r={}){const e=`${g9e}/${p9e} ${sK()}`;return{privateKey:r.privateKey,dns:r.dns,nodeInfo:{userAgent:e},addresses:{listen:["/p2p-circuit","/webrtc"]},transports:[q9(),Jx(),Y7e(),Zx()],connectionEncrypters:[dL()],streamMuxers:[cye(),X8e()],peerDiscovery:[z9(y9e)],services:{autoNAT:Kye(),dcutr:g3e(),delegatedRouting:()=>i0e("https://delegated-ipfs.dev",U0e()),dht:X4e({clientMode:!0,validators:{ipns:tR},selectors:{ipns:f9e}}),identify:W9(),identifyPush:_3e(),keychain:oF(r.keychain),ping:o6e()}}}async function w9e(r,e={}){const t=e.selfKey??"self",n=oF(e)({datastore:r,logger:Oy()});let i;return await r.has(new xt(`/pkcs8/${t}`))?i=await n.exportKey(t):(i=await dy(e.keyType??"Ed25519"),await n.importKey(t,i)),i}const b9e=32,{code:v9e}=ze("dnsaddr");class E9e extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}}const oK=async function(e,t={}){const n=t.maxRecursiveDepth??b9e;if(n===0)throw new E9e("Max recursive depth reached");const[,i]=e.stringTuples().find(([l])=>l===v9e)??[],o=await((t==null?void 0:t.dns)??wN()).query(`_dnsaddr.${i}`,{signal:t==null?void 0:t.signal,types:[fc.TXT]}),a=e.getPeerId(),c=[];for(const l of o.Answer){const d=l.data.replace(/["']/g,"").trim().split("=")[1];if(d==null||a!=null&&!d.includes(a))continue;const h=Re(d);if(d.startsWith("/dnsaddr")){const p=await h.resolve({...t,maxRecursiveDepth:n-1});c.push(...p.map(m=>m.toString()))}else c.push(h.toString())}return c},S9e={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:r=>r},connectionManager:{resolvers:{dnsaddr:oK}},transportManager:{faultTolerance:kl.FATAL_ALL}};async function x9e(r){var t,n;const e=pE(S9e,r);if(e.connectionProtector===null&&((n=(t=globalThis.process)==null?void 0:t.env)==null?void 0:n.LIBP2P_FORCE_PNET)!=null)throw new Z("Private network is enforced, but no protector was provided");return e}function A9e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function eA(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function C9e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*d+1>>>0,E=new Uint8Array(b);y!==w;){for(var A=f[y],k=0,x=b-1;(A!==0||k<v)&&x!==-1;x--,k++)A+=256*E[x]>>>0,E[x]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var A=0,k=w-1;(E!==0||A<y)&&k!==-1;k--,A++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=A,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var I9e=C9e,k9e=I9e;class _9e{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class T9e{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return aK(this,e)}}class P9e{constructor(e){u(this,"decoders");this.decoders=e}or(e){return aK(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function aK(r,e){return new P9e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}class D9e{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new _9e(e,t,n),this.decoder=new T9e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function cK({name:r,prefix:e,encode:t,decode:n}){return new D9e(r,e,t,n)}function m4({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=k9e(t,r);return cK({prefix:e,name:r,encode:n,decode:s=>eA(i(s))})}function $9e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function N9e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function aa({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return cK({prefix:e,name:r,encode(i){return N9e(i,n,t)},decode(i){return $9e(i,n,t,r)}})}const t0=aa({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});aa({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),aa({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),aa({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),aa({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),aa({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),aa({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),aa({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),aa({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const tA=m4({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});m4({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const ca=m4({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});m4({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var M9e=uK,lK=128,O9e=-128,R9e=Math.pow(2,31);function uK(r,e,t){e=e||[],t=t||0;for(var n=t;r>=R9e;)e[t++]=r&255|lK,r/=128;for(;r&O9e;)e[t++]=r&255|lK,r>>>=7;return e[t]=r|0,uK.bytes=t-n+1,e}var L9e=rA,B9e=128,dK=127;function rA(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw rA.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&dK)<<i:(o&dK)*Math.pow(2,i),i+=7}while(o>=B9e);return rA.bytes=s-n,t}var U9e=Math.pow(2,7),F9e=Math.pow(2,14),z9e=Math.pow(2,21),V9e=Math.pow(2,28),K9e=Math.pow(2,35),j9e=Math.pow(2,42),H9e=Math.pow(2,49),q9e=Math.pow(2,56),W9e=Math.pow(2,63),G9e=function(r){return r<U9e?1:r<F9e?2:r<z9e?3:r<V9e?4:r<K9e?5:r<j9e?6:r<H9e?7:r<q9e?8:r<W9e?9:10},Q9e={encode:M9e,decode:L9e,encodingLength:G9e},w4=Q9e;function nA(r,e=0){return[w4.decode(r,e),w4.decode.bytes]}function b4(r,e,t=0){return w4.encode(r,e,t),e}function v4(r){return w4.encodingLength(r)}function Y9e(r,e){const t=e.byteLength,n=v4(r),i=n+v4(t),s=new Uint8Array(i+t);return b4(r,s,0),b4(t,s,n),s.set(e,i),new iA(r,t,e,s)}function hK(r){const e=eA(r),[t,n]=nA(e),[i,s]=nA(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new iA(t,i,o,e)}function J9e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&A9e(r.bytes,t.bytes)}}let iA=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function fK(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Z9e(t,sA(r),e??ca.encoder);default:return eEe(t,sA(r),e??t0.encoder)}}const pK=new WeakMap;function sA(r){const e=pK.get(r);if(e==null){const t=new Map;return pK.set(r,t),t}return e}class $r{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,CH,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==r0)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==tEe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return $r.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Y9e(e,t);return $r.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return $r.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&J9e(e.multihash,n.multihash)}toString(e){return fK(this,e)}toJSON(){return{"/":fK(this)}}link(){return this}[(CH=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof $r)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new $r(n,i,s,o??gK(n,i,s.bytes))}else if(t[rEe]===!0){const{version:n,multihash:i,code:s}=t,o=hK(i);return $r.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==r0)throw new Error(`Version 0 CID must use dag-pb (code: ${r0}) block encoding`);return new $r(e,t,n,n.bytes)}case 1:{const i=gK(e,t,n.bytes);return new $r(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return $r.create(0,r0,e)}static createV1(e,t){return $r.create(1,e,t)}static decode(e){const[t,n]=$r.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=$r.inspectBytes(e),n=t.size-t.multihashSize,i=eA(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new iA(t.multihashCode,t.digestSize,s,i);return[t.version===0?$r.createV0(o):$r.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=nA(e.subarray(t));return t+=p,h};let i=n(),s=r0;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=X9e(e,t),s=$r.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return sA(s).set(n,e),s}}function X9e(r,e){switch(r[0]){case"Q":{const t=e??ca;return[ca.prefix,t.decode(`${ca.prefix}${r}`)]}case ca.prefix:{const t=e??ca;return[ca.prefix,t.decode(r)]}case t0.prefix:{const t=e??t0;return[t0.prefix,t.decode(r)]}case tA.prefix:{const t=e??tA;return[tA.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Z9e(r,e,t){const{prefix:n}=t;if(n!==ca.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function eEe(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const r0=112,tEe=18;function gK(r,e,t){const n=v4(r),i=n+v4(e),s=new Uint8Array(i+t.byteLength);return b4(r,s,0),b4(e,s,n),s.set(t,i),s}const rEe=Symbol.for("@ipld/js-cid/CID"),nEe=36e5,iEe=216e5;var Su;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.key!=null&&i.key!==""&&(s.uint32(10),s.string(i.key)),i.value!=null&&i.value.byteLength>0&&(s.uint32(18),s.bytes(i.value)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={key:"",value:Ge(0)},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.key=i.string();break}case 2:{a.value=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)})(r.Peer$metadataEntry||(r.Peer$metadataEntry={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.key!=null&&i.key!==""&&(s.uint32(10),s.string(i.key)),i.value!=null&&(s.uint32(18),S4.codec().encode(i.value,s)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={key:""},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:{a.key=i.string();break}case 2:{a.value=S4.codec().decode(i,i.uint32(),{limits:(l=o.limits)==null?void 0:l.value});break}default:{i.skipType(d&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.Peer$tagsEntry||(r.Peer$tagsEntry={}));let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.addresses!=null)for(const s of t.addresses)n.uint32(10),E4.codec().encode(s,n);if(t.protocols!=null)for(const s of t.protocols)n.uint32(18),n.string(s);if(t.publicKey!=null&&(n.uint32(34),n.bytes(t.publicKey)),t.peerRecordEnvelope!=null&&(n.uint32(42),n.bytes(t.peerRecordEnvelope)),t.metadata!=null&&t.metadata.size!==0)for(const[s,o]of t.metadata.entries())n.uint32(50),r.Peer$metadataEntry.codec().encode({key:s,value:o},n);if(t.tags!=null&&t.tags.size!==0)for(const[s,o]of t.tags.entries())n.uint32(58),r.Peer$tagsEntry.codec().encode({key:s,value:o},n);t.updated!=null&&(n.uint32(64),n.uint64Number(t.updated)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,d,h,p;const s={addresses:[],protocols:[],metadata:new Map,tags:new Map},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const m=t.uint32();switch(m>>>3){case 1:{if(((a=i.limits)==null?void 0:a.addresses)!=null&&s.addresses.length===i.limits.addresses)throw new mt('Decode error - map field "addresses" had too many elements');s.addresses.push(E4.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.addresses$}));break}case 2:{if(((l=i.limits)==null?void 0:l.protocols)!=null&&s.protocols.length===i.limits.protocols)throw new mt('Decode error - map field "protocols" had too many elements');s.protocols.push(t.string());break}case 4:{s.publicKey=t.bytes();break}case 5:{s.peerRecordEnvelope=t.bytes();break}case 6:{if(((d=i.limits)==null?void 0:d.metadata)!=null&&s.metadata.size===i.limits.metadata)throw new wD('Decode error - map field "metadata" had too many elements');const f=r.Peer$metadataEntry.codec().decode(t,t.uint32());s.metadata.set(f.key,f.value);break}case 7:{if(((h=i.limits)==null?void 0:h.tags)!=null&&s.tags.size===i.limits.tags)throw new wD('Decode error - map field "tags" had too many elements');const f=r.Peer$tagsEntry.codec().decode(t,t.uint32(),{limits:{value:(p=i.limits)==null?void 0:p.tags$value}});s.tags.set(f.key,f.value);break}case 8:{s.updated=t.uint64Number();break}default:{t.skipType(m&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(Su||(Su={}));var E4;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(n.uint32(10),n.bytes(t.multiaddr)),t.isCertified!=null&&(n.uint32(16),n.bool(t.isCertified)),t.observed!=null&&(n.uint32(24),n.uint64Number(t.observed)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={multiaddr:Ge(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.multiaddr=t.bytes();break}case 2:{s.isCertified=t.bool();break}case 3:{s.observed=t.uint64Number();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(E4||(E4={}));var S4;(function(r){let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.value!=null&&t.value!==0&&(n.uint32(8),n.uint32(t.value)),t.expiry!=null&&(n.uint32(16),n.uint64(t.expiry)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={value:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.value=t.uint32();break}case 2:{s.expiry=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(S4||(S4={}));function sEe(r,e){if(r.publicKey!=null||e.publicKey==null)return r;let t;if(r.type==="RSA"){const i=ca.decode(`z${r}`);t=hK(i)}const n=_n(e.publicKey,t);return Fd(n)}function oA(r,e,t){const n=Su.decode(e);return aA(r,n,t)}function aA(r,e,t){const n=new Map,i=BigInt(Date.now());for(const[s,o]of e.tags.entries())o.expiry!=null&&o.expiry<i||n.set(s,o);return{...e,id:sEe(r,e),addresses:e.addresses.filter(({observed:s})=>s!=null&&s>Date.now()-t).map(({multiaddr:s,isCertified:o})=>({multiaddr:Re(s),isCertified:o??!1})),metadata:e.metadata,peerRecordEnvelope:e.peerRecordEnvelope??void 0,tags:n}}function oEe(r,e){return aEe(r.addresses,e.addresses)&&cEe(r.protocols,e.protocols)&&lEe(r.publicKey,e.publicKey)&&uEe(r.peerRecordEnvelope,e.peerRecordEnvelope)&&dEe(r.metadata,e.metadata)&&hEe(r.tags,e.tags)}function aEe(r,e){return mK(r,e,(t,n)=>!(t.isCertified!==n.isCertified||!qe(t.multiaddr,n.multiaddr)))}function cEe(r,e){return mK(r,e,(t,n)=>t===n)}function lEe(r,e){return yK(r,e)}function uEe(r,e){return yK(r,e)}function dEe(r,e){return wK(r,e,(t,n)=>qe(t,n))}function hEe(r,e){return wK(r,e,(t,n)=>t.value===n.value&&t.expiry===n.expiry)}function yK(r,e){return r==null&&e==null?!0:r!=null&&e!=null?qe(r,e):!1}function mK(r,e,t){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!t(r[n],e[n]))return!1;return!0}function wK(r,e,t){if(r.size!==e.size)return!1;for(const[n,i]of r.entries()){const s=e.get(n);if(s==null||!t(i,s))return!1}return!0}const bK="/peers/";function x4(r){if(!rP(r)||r.type==null)throw new Z("Invalid PeerId");const e=r.toCID().toString();return new xt(`${bK}${e}`)}async function fEe(r,e,t,n){const i=new Map;for(const s of t){if(s==null)continue;if(s.multiaddr instanceof Uint8Array&&(s.multiaddr=Re(s.multiaddr)),!Em(s.multiaddr))throw new Z("Multiaddr was invalid");if(!await e(r,s.multiaddr))continue;const o=s.isCertified??!1,a=s.multiaddr.toString(),c=i.get(a);c!=null?s.isCertified=c.isCertified||o:i.set(a,{multiaddr:s.multiaddr,isCertified:o})}return[...i.values()].sort((s,o)=>s.multiaddr.toString().localeCompare(o.multiaddr.toString())).map(({isCertified:s,multiaddr:o})=>({isCertified:s,multiaddr:o.bytes}))}async function cA(r,e,t,n){var p,m;if(e==null)throw new Z("Invalid PeerData");if(e.publicKey!=null&&r.publicKey!=null&&!e.publicKey.equals(r.publicKey))throw new Z("publicKey bytes do not match peer id publicKey bytes");const i=(p=n.existingPeer)==null?void 0:p.peer;if(i!=null&&!r.equals(i.id))throw new Z("peer id did not match existing peer id");let s=(i==null?void 0:i.addresses)??[],o=new Set((i==null?void 0:i.protocols)??[]),a=(i==null?void 0:i.metadata)??new Map,c=(i==null?void 0:i.tags)??new Map,l=i==null?void 0:i.peerRecordEnvelope;if(t==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(s=[],e.multiaddrs!=null&&s.push(...e.multiaddrs.map(f=>({isCertified:!1,multiaddr:f}))),e.addresses!=null&&s.push(...e.addresses)),e.protocols!=null&&(o=new Set(e.protocols)),e.metadata!=null){const f=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);a=A4(f,{validate:vK})}if(e.tags!=null){const f=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);c=A4(f,{validate:EK,map:SK})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}if(t==="merge"){if(e.multiaddrs!=null&&s.push(...e.multiaddrs.map(f=>({isCertified:!1,multiaddr:f}))),e.addresses!=null&&s.push(...e.addresses),e.protocols!=null&&(o=new Set([...o,...e.protocols])),e.metadata!=null){const f=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(const[g,v]of f)v==null?a.delete(g):a.set(g,v);a=A4([...a.entries()],{validate:vK})}if(e.tags!=null){const f=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),g=new Map(c);for(const[v,y]of f)y==null?g.delete(v):g.set(v,y);c=A4([...g.entries()],{validate:EK,map:SK})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}let d;(i==null?void 0:i.id.publicKey)!=null?d=_i(i.id.publicKey):e.publicKey!=null?d=_i(e.publicKey):r.publicKey!=null&&(d=_i(r.publicKey));const h={addresses:await fEe(r,n.addressFilter??(async()=>!0),s,(m=n.existingPeer)==null?void 0:m.peerPB.addresses),protocols:[...o.values()].sort((f,g)=>f.localeCompare(g)),metadata:a,tags:c,publicKey:d,peerRecordEnvelope:l};return h.addresses.forEach(f=>{var g,v,y;f.observed=((y=(v=(g=n.existingPeer)==null?void 0:g.peerPB.addresses)==null?void 0:v.find(w=>qe(w.multiaddr,w.multiaddr)))==null?void 0:y.observed)??Date.now()}),r.type!=="RSA"&&delete h.publicKey,h}function A4(r,e){var n;const t=new Map;for(const[i,s]of r)s!=null&&e.validate(i,s);for(const[i,s]of r.sort(([o],[a])=>o.localeCompare(a)))s!=null&&t.set(i,((n=e.map)==null?void 0:n.call(e,i,s))??s);return t}function vK(r,e){if(typeof r!="string")throw new Z("Metadata key must be a string");if(!(e instanceof Uint8Array))throw new Z("Metadata value must be a Uint8Array")}function EK(r,e){if(typeof r!="string")throw new Z("Tag name must be a string");if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new Z("Tag value must be an integer");if(e.value<0||e.value>100)throw new Z("Tag value must be between 0-100")}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new Z("Tag ttl must be an integer");if(e.ttl<0)throw new Z("Tag ttl must be between greater than 0")}}function SK(r,e){let t;return e.expiry!=null&&(t=e.expiry),e.ttl!=null&&(t=BigInt(Date.now()+Number(e.ttl))),{value:e.value??0,expiry:t}}function xK(r){const e=r.toString().split("/")[2],t=$r.parse(e,t0);return zd(t)}function lA(r,e,t){const n=xK(r);return oA(n,e,t)}function pEe(r,e){return{prefix:bK,filters:(r.filters??[]).map(t=>({key:n,value:i})=>t(lA(n,i,e))),orders:(r.orders??[]).map(t=>(n,i)=>t(lA(n.key,n.value,e),lA(i.key,i.value,e)))}}class gEe{constructor(e,t={}){Je(this,Vn);u(this,"peerId");u(this,"datastore");u(this,"lock");u(this,"addressFilter");u(this,"log");u(this,"maxAddressAge");u(this,"maxPeerAge");this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.lock=l7({name:"peer-store",singleProcess:!0}),this.maxAddressAge=t.maxAddressAge??nEe,this.maxPeerAge=t.maxPeerAge??iEe}async has(e){try{return await this.load(e),!0}catch(t){if(t.name!=="NotFoundError")throw t}return!1}async delete(e){this.peerId.equals(e)||await this.datastore.delete(x4(e))}async load(e){const t=x4(e),n=await this.datastore.get(t),i=Su.decode(n);if(Ie(this,Vn,z4).call(this,e,i))throw await this.datastore.delete(t),new Zt;return aA(e,i,this.peerId.equals(e)?1/0:this.maxAddressAge)}async save(e,t){const n=await Ie(this,Vn,U4).call(this,e),i=await cA(e,t,"patch",{addressFilter:this.addressFilter});return Ie(this,Vn,F4).call(this,e,i,n)}async patch(e,t){const n=await Ie(this,Vn,U4).call(this,e),i=await cA(e,t,"patch",{addressFilter:this.addressFilter,existingPeer:n});return Ie(this,Vn,F4).call(this,e,i,n)}async merge(e,t){const n=await Ie(this,Vn,U4).call(this,e),i=await cA(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:n});return Ie(this,Vn,F4).call(this,e,i,n)}async*all(e){for await(const{key:t,value:n}of this.datastore.query(pEe(e??{},this.maxAddressAge))){const i=xK(t);if(i.equals(this.peerId))continue;const s=Su.decode(n);if(Ie(this,Vn,z4).call(this,i,s)){await this.datastore.delete(t);continue}yield aA(i,s,this.peerId.equals(i)?1/0:this.maxAddressAge)}}}Vn=new WeakSet,U4=async function(e){try{const t=x4(e),n=await this.datastore.get(t),i=Su.decode(n);if(Ie(this,Vn,z4).call(this,e,i))throw await this.datastore.delete(t),new Zt;return{peerPB:i,peer:oA(e,n,this.maxAddressAge)}}catch(t){t.name!=="NotFoundError"&&this.log.error("invalid peer data found in peer store - %e",t)}},F4=async function(e,t,n){t.updated=Date.now();const i=Su.encode(t);return await this.datastore.put(x4(e),i),{peer:oA(e,i,this.maxAddressAge),previous:n==null?void 0:n.peer,updated:n==null||!oEe(t,n.peerPB)}},z4=function(e,t){if(t.updated==null)return!0;if(this.peerId.equals(e))return!1;const n=t.updated<Date.now()-this.maxPeerAge,i=Date.now()-this.maxAddressAge,s=t.addresses.filter(o=>o.observed!=null&&o.observed>i);return n&&s.length===0},IH=Symbol.toStringTag;class yEe{constructor(e,t={}){Je(this,Zh);u(this,"store");u(this,"events");u(this,"peerId");u(this,"log");u(this,IH,"@libp2p/peer-store");this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new gEe(e,t)}async forEach(e,t){this.log.trace("forEach await read lock");const n=await this.store.lock.readLock();this.log.trace("forEach got read lock");try{for await(const i of this.store.all(t))e(i)}finally{this.log.trace("forEach release read lock"),n()}}async all(e){this.log.trace("all await read lock");const t=await this.store.lock.readLock();this.log.trace("all got read lock");try{return await Gm(this.store.all(e))}finally{this.log.trace("all release read lock"),t()}}async delete(e){this.log.trace("delete await write lock");const t=await this.store.lock.writeLock();this.log.trace("delete got write lock");try{await this.store.delete(e)}finally{this.log.trace("delete release write lock"),t()}}async has(e){this.log.trace("has await read lock");const t=await this.store.lock.readLock();this.log.trace("has got read lock");try{return await this.store.has(e)}finally{this.log.trace("has release read lock"),t()}}async get(e){this.log.trace("get await read lock");const t=await this.store.lock.readLock();this.log.trace("get got read lock");try{return await this.store.load(e)}finally{this.log.trace("get release read lock"),t()}}async save(e,t){this.log.trace("save await write lock");const n=await this.store.lock.writeLock();this.log.trace("save got write lock");try{const i=await this.store.save(e,t);return Ie(this,Zh,V4).call(this,e,i),i.peer}finally{this.log.trace("save release write lock"),n()}}async patch(e,t){this.log.trace("patch await write lock");const n=await this.store.lock.writeLock();this.log.trace("patch got write lock");try{const i=await this.store.patch(e,t);return Ie(this,Zh,V4).call(this,e,i),i.peer}finally{this.log.trace("patch release write lock"),n()}}async merge(e,t){this.log.trace("merge await write lock");const n=await this.store.lock.writeLock();this.log.trace("merge got write lock");try{const i=await this.store.merge(e,t);return Ie(this,Zh,V4).call(this,e,i),i.peer}finally{this.log.trace("merge release write lock"),n()}}async consumePeerRecord(e,t){const n=await Pc.openAndCertify(e,js.DOMAIN),i=zd(n.publicKey.toCID());if((t==null?void 0:t.equals(i))===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",t,i),!1;const s=js.createFromProtobuf(n.payload);let o;try{o=await this.get(i)}catch(a){if(a.name!=="NotFoundError")throw a}if((o==null?void 0:o.peerRecordEnvelope)!=null){const a=await Pc.createFromProtobuf(o.peerRecordEnvelope),c=js.createFromProtobuf(a.payload);if(c.seqNumber>=s.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",c.seqNumber,s.seqNumber),!1}return await this.patch(s.peerId,{peerRecordEnvelope:e,addresses:s.multiaddrs.map(a=>({isCertified:!0,multiaddr:a}))}),!0}}Zh=new WeakSet,V4=function(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))};function mEe(r,e={}){return new yEe(r,e)}function wEe(r,e){let t;const n=function(){const i=function(){t=void 0,r()};clearTimeout(t),t=setTimeout(i,e)};return n.start=()=>{},n.stop=()=>{clearTimeout(t)},n}const AK=864e13,bEe=448,uA=449,vEe=53,EEe=54,SEe=55,xEe=56;class AEe{constructor(e,t={}){u(this,"log");u(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=new Map}has(e){const t=this.findHost(e);for(const n of this.mappings.values())if(n.domain===t)return!0;return!1}add(e,t){t.forEach(n=>{this.log("add DNS mapping %s to %s",n,e);const i=bc(n)===!0;this.mappings.set(n,{domain:e,verified:i,expires:i?AK-Date.now():0,lastVerified:i?AK-Date.now():void 0})})}remove(e){const t=this.findHost(e);let n=!1;for(const[i,s]of this.mappings.entries())s.domain===t&&(this.log("removing %s to %s DNS mapping %e",i,s.domain,new Error("where")),this.mappings.delete(i),n=n||s.verified);return n}getAll(e){const t=[];for(let n=0;n<e.length;n++){const s=e[n].multiaddr.stringTuples(),o=s[0][1];if(o!=null)for(const[a,c]of this.mappings.entries()){if(o!==a)continue;this.maybeAddSNITuple(s,c.domain)&&(e.splice(n,1),n--,t.push({multiaddr:Re(`/${s.map(d=>[ze(d[0]).name,d[1]].join("/")).join("/")}`),verified:c.verified,type:"dns-mapping",expires:c.expires,lastVerified:c.lastVerified}))}}return t}maybeAddSNITuple(e,t){var n;for(let i=0;i<e.length;i++)if(e[i][0]===bEe&&((n=e[i+1])==null?void 0:n[0])!==uA)return e.splice(i+1,0,[uA,t]),!0;return!1}confirm(e,t){const n=this.findHost(e);let i=!1;for(const[s,o]of this.mappings.entries())o.domain===n&&(this.log("marking %s to %s DNS mapping as verified",s,o.domain),i=o.verified,o.verified=!0,o.expires=Date.now()+t,o.lastVerified=Date.now());return i}unconfirm(e,t){const n=this.findHost(e);let i=!1;for(const[s,o]of this.mappings.entries())o.domain===n&&(this.log("removing verification of %s to %s DNS mapping",s,o.domain),i=i||o.verified,o.verified=!1,o.expires=Date.now()+t);return i}findHost(e){for(const t of e.stringTuples())if(t[0]===uA||t[0]===vEe||t[0]===EEe||t[0]===SEe||t[0]===xEe)return t[1]}}const dA=4,hA=41,fA=6,CEe=273;class IEe{constructor(e,t={}){u(this,"log");u(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=new Map}has(e){const t=e.stringTuples();for(const n of this.mappings.values())for(const i of n)if(i.externalIp===t[0][1])return!0;return!1}add(e,t,n,i=t,s="tcp"){const o=`${e}-${t}-${s}`,a=this.mappings.get(o)??[],c={internalIp:e,internalPort:t,externalIp:n,externalPort:i,externalFamily:Yd(n)?4:6,protocol:s,verified:!1,expires:0};a.push(c),this.mappings.set(o,a)}remove(e){const t=e.stringTuples(),n=t[0][1]??"",i=t[1][0]===fA?"tcp":"udp",s=parseInt(t[1][1]??"0");let o=!1;for(const[a,c]of this.mappings.entries()){for(let l=0;l<c.length;l++){const d=c[l];d.externalIp===n&&d.externalPort===s&&d.protocol===i&&(this.log("removing %s:%s to %s:%s %s IP mapping",d.externalIp,d.externalPort,n,s,i),o=o||d.verified,c.splice(l,1),l--)}c.length===0&&this.mappings.delete(a)}return o}getAll(e){const t=[];for(const{multiaddr:n}of e){const i=n.stringTuples();let s;if((i[0][0]===dA||i[0][0]===hA)&&i[1][0]===fA?s=`${i[0][1]}-${i[1][1]}-tcp`:(i[0][0]===dA||i[0][0]===hA)&&i[1][0]===CEe&&(s=`${i[0][1]}-${i[1][1]}-udp`),s==null)continue;const o=this.mappings.get(s);if(o!=null)for(const a of o)i[0][0]=a.externalFamily===4?dA:hA,i[0][1]=a.externalIp,i[1][1]=`${a.externalPort}`,t.push({multiaddr:Re(`/${i.map(c=>[ze(c[0]).name,c[1]].join("/")).join("/")}`),verified:a.verified,type:"ip-mapping",expires:a.expires,lastVerified:a.lastVerified})}return t}confirm(e,t){const i=e.stringTuples()[0][1];let s=!1;for(const o of this.mappings.values())for(const a of o)a.externalIp===i&&(this.log("marking %s to %s IP mapping as verified",a.internalIp,a.externalIp),s=a.verified,a.verified=!0,a.expires=Date.now()+t,a.lastVerified=Date.now());return s}unconfirm(e,t){const n=e.stringTuples(),i=n[0][1]??"",s=n[1][0]===fA?"tcp":"udp",o=parseInt(n[1][1]??"0");let a=!1;for(const c of this.mappings.values())for(let l=0;l<c.length;l++){const d=c[l];d.externalIp===i&&d.externalPort===o&&d.protocol===s&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",d.externalIp,d.externalPort,i,o,s),a=a||d.verified,d.verified=!1,d.expires=Date.now()+t)}return a}}const kEe=4,_Ee=41;function TEe(r){try{const[[e,t]]=r.stringTuples();if(t==null)return!1;if(e===kEe)return t.startsWith("169.254.");if(e===_Ee)return t.toLowerCase().startsWith("fe80")}catch{}return!1}const PEe={maxObservedAddresses:10};class DEe{constructor(e,t={}){u(this,"log");u(this,"addresses");u(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??PEe.maxObservedAddresses}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(const t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&(Yl(e)||TEe(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:Re(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){var n;const t=((n=this.addresses.get(e.toString()))==null?void 0:n.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){const n=e.toString(),i=this.addresses.get(n)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},s=i.verified;return i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now(),this.log("marking observed address %a as verified",n),this.addresses.set(n,i),s}}const $Ee=[4,41,53,54,55,56];function CK(r){try{const[[e]]=r.stringTuples();return $Ee.includes(e)}catch{}return!1}const NEe={maxObservedAddresses:10};class MEe{constructor(e,t={}){u(this,"log");u(this,"addresses");u(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??NEe.maxObservedAddresses}get(e,t){if(Yl(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};const n=this.toKey(e);let i=this.addresses.get(n);return i==null&&(i={verified:!CK(e),expires:0},this.addresses.set(n,i)),{multiaddr:e,verified:i.verified,type:"transport",expires:i.expires,lastVerified:i.lastVerified}}has(e){const t=this.toKey(e);return this.addresses.has(t)}remove(e){var i;const t=this.toKey(e),n=((i=this.addresses.get(t))==null?void 0:i.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),n}confirm(e,t){const n=this.toKey(e),i=this.addresses.get(n)??{verified:!1,expires:0,lastVerified:0},s=i.verified;return i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now(),this.addresses.set(n,i),s}unconfirm(e,t){const n=this.toKey(e),i=this.addresses.get(n)??{verified:!1,expires:0},s=i.verified;return i.verified=!1,i.expires=Date.now()+t,this.addresses.set(n,i),s}toKey(e){if(CK(e)){const t=e.toOptions();return`${t.host}-${t.port}-${t.transport}`}return e.toString()}}const IK=6e4,kK={addressVerificationTTL:IK*10,addressVerificationRetry:IK*5},OEe=r=>r;function pA(r,e){const t=r.getPeerId();return t!=null&&tr(t).equals(e)&&(r=r.decapsulate(Re(`/p2p/${e.toString()}`))),r}kH=Symbol.toStringTag;class REe{constructor(e,t={}){u(this,"log");u(this,"components");u(this,"listen");u(this,"announce");u(this,"appendAnnounce");u(this,"announceFilter");u(this,"observed");u(this,"dnsMappings");u(this,"ipMappings");u(this,"transportAddresses");u(this,"observedAddressFilter");u(this,"addressVerificationTTL");u(this,"addressVerificationRetry");u(this,kH,"@libp2p/address-manager");const{listen:n=[],announce:i=[],appendAnnounce:s=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=n.map(o=>o.toString()),this.announce=new Set(i.map(o=>o.toString())),this.appendAnnounce=new Set(s.map(o=>o.toString())),this.observed=new DEe(e,t),this.dnsMappings=new AEe(e,t),this.ipMappings=new IEe(e,t),this.transportAddresses=new MEe(e,t),this.announceFilter=t.announceFilter??OEe,this.observedAddressFilter=zl(1024),this.addressVerificationTTL=t.addressVerificationTTL??kK.addressVerificationTTL,this.addressVerificationRetry=t.addressVerificationRetry??kK.addressVerificationRetry,this._updatePeerStoreAddresses=wEe(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}_updatePeerStoreAddresses(){const e=this.getAddresses().map(t=>t.getPeerId()===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(t=>{this.log.error("error updating addresses",t)})}getListenAddrs(){return Array.from(this.listen).map(e=>Re(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>Re(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>Re(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){const t=e.stringTuples(),n=`${t[0][1]}:${t[1][1]}`;this.observedAddressFilter.has(n)||(this.observedAddressFilter.add(n),e=pA(e,this.components.peerId),!this.ipMappings.has(e)&&(this.dnsMappings.has(e)||this.observed.add(e)))}confirmObservedAddr(e,t){e=pA(e,this.components.peerId);let n=!0;((t==null?void 0:t.type)==="transport"||this.transportAddresses.has(e))&&!this.transportAddresses.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="dns-mapping"||this.dnsMappings.has(e))&&!this.dnsMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="ip-mapping"||this.ipMappings.has(e))&&!this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="observed"||this.observed.has(e))&&(this.maybeUpgradeToIPMapping(e)?(this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL),n=!1):!this.observed.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1)),n||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=pA(e,this.components.peerId),this.observed.has(e)&&this.observed.remove(e),this.transportAddresses.has(e)&&this.transportAddresses.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.dnsMappings.has(e)&&this.dnsMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.ipMappings.has(e)&&this.ipMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry)}getAddresses(){const e=new Set,t=this.getAddressesWithMetadata().filter(n=>{if(!n.verified)return!1;const i=n.multiaddr.toString();return e.has(i)?!1:(e.add(i),!0)}).map(n=>n.multiaddr);return this.announceFilter(t.map(n=>{var s;const i=Re(n);return((s=i.protos().pop())==null?void 0:s.path)===!0||i.getPeerId()===this.components.peerId.toString()?i:i.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){const e=this.getAnnounceAddrs();if(e.length>0)return this.components.transportManager.getListeners().forEach(i=>{i.updateAnnounceAddrs(e)}),e.map(i=>({multiaddr:i,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];t=t.concat(this.components.transportManager.getAddrs().map(i=>this.transportAddresses.get(i,this.addressVerificationTTL)));const n=this.getAppendAnnounceAddrs();return n.length>0&&(this.components.transportManager.getListeners().forEach(i=>{i.updateAnnounceAddrs(n)}),t=t.concat(n.map(i=>({multiaddr:i,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),t=t.concat(this.observed.getAll()),t=t.concat(this.ipMappings.getAll(t)),t=t.concat(this.dnsMappings.getAll(t)),t}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove(Re(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,n,i=t,s="tcp"){this.ipMappings.add(e,t,n,i,s),this.observed.removePrefixed(`/ip${Yd(n)?4:6}/${n}/${s}/${i}`)}removePublicAddressMapping(e,t,n,i=t,s="tcp"){this.ipMappings.remove(Re(`/ip${Yd(n)?4:6}/${n}/${s}/${i}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(e){if(this.ipMappings.has(e))return!1;const t=e.toOptions();if(t.family===6||t.host==="127.0.0.1"||bc(t.host)===!0)return!1;const n=this.components.transportManager.getListeners(),i=[s=>G1.exactMatch(s)||pm.exactMatch(s),s=>hm.exactMatch(s),s=>phe.exactMatch(s)];for(const s of i){if(!s(e))continue;const o=n.filter(l=>l.getAddrs().filter(d=>d.toOptions().family===4&&s(d)).length>0);if(o.length!==1)continue;const a=o[0].getAddrs().filter(l=>l.toOptions().host!=="127.0.0.1").pop();if(a==null)continue;const c=a.toOptions();return this.observed.remove(e),this.ipMappings.add(c.host,c.port,t.host,t.port,t.transport),!0}return!1}}var _K;(function(r){r.NOT_STARTED_YET="The libp2p node is not started yet",r.NOT_FOUND="Not found"})(_K||(_K={}));class LEe extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}}class BEe extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}}class gA extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}}class TK extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}}class UEe extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}}class FEe extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}}class zEe extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}}class PK extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}}class VEe extends Error{constructor(e="No transport was configured to listen on this address"){super(e),this.name="UnsupportedListenAddressError"}}class KEe extends Error{constructor(e="Configured listen addresses could not be listened on"){super(e),this.name="UnsupportedListenAddressesError"}}class jEe extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}}class HEe extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}}class qEe extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}}class C4 extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}}class I4 extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}}class WEe extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}}class GEe{constructor(e={}){u(this,"components",{});u(this,"_started",!1);this.components={};for(const[t,n]of Object.entries(e))this.components[t]=n;this.components.logger==null&&(this.components.logger=Oy())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(t=>Cb(t)).map(async t=>{var n;await((n=t[e])==null?void 0:n.call(t))}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const QEe=["metrics","connectionProtector","dns"],YEe=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function JEe(r={}){const e=new GEe(r);return new Proxy(e,{get(n,i,s){if(typeof i=="string"&&!YEe.includes(i)){const o=e.components[i];if(o==null&&!QEe.includes(i))throw new LEe(`${i} not set`);return o}return Reflect.get(n,i,s)},set(n,i,s){return typeof i=="string"?e.components[i]=s:Reflect.set(n,i,s),!0}})}function XEe(r){const e={};for(const t of Object.values(r.components))for(const n of ZEe(t))e[n]=!0;for(const t of Object.values(r.components))for(const n of eSe(t))if(e[n]!==!0)throw new BEe(`Service "${tSe(t)}" required capability "${n}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function ZEe(r){return Array.isArray(r==null?void 0:r[dr])?r[dr]:[]}function eSe(r){return Array.isArray(r==null?void 0:r[Qa])?r[Qa]:[]}function tSe(r){return(r==null?void 0:r[Symbol.toStringTag])??(r==null?void 0:r.toString())??"unknown"}const rSe=4,nSe=41;function iSe(r={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{if(G1.matches(e))return!1;const t=e.stringTuples();return t[0][0]===rSe||t[0][0]===nSe?!!bc(`${t[0][1]}`):!1},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...r}}function DK(r){if(rP(r))return{peerId:r,multiaddrs:[]};let e=Array.isArray(r)?r:[r],t;if(e.length>0){const n=e[0].getPeerId();t=n==null?void 0:tr(n),e.forEach(i=>{if(!Em(i))throw new D2("Invalid multiaddr");const s=i.getPeerId();if(s==null){if(t!=null)throw new Z("Multiaddrs must all have the same peer id or have no peer id")}else{const o=tr(s);if((t==null?void 0:t.equals(o))!==!0)throw new Z("Multiaddrs must all have the same peer id or have no peer id")}})}return e=e.filter(n=>!uhe.exactMatch(n)),{peerId:t,multiaddrs:e}}const sSe=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function oSe(r,e){var i;const t=((i=r==null?void 0:r.streams)==null?void 0:i.map(s=>s.protocol))??[],n=(e==null?void 0:e.closableProtocols)??sSe;if(!(t.filter(s=>s!=null&&!n.includes(s)).length>0))try{await(r==null?void 0:r.close(e))}catch(s){r==null||r.abort(s)}}const $K=1e4,aSe=1e4,NK=1e4,MK=25,cSe=5,lSe=10,uSe=5,dSe="last-dial-failure",hSe="last-dial-success",OK=500,RK=100,LK=50;async function fSe(r,e){let t=!1;for(const i of Y7.keys())if(t=r.protoNames().includes(i),t)break;if(!t)return[r];const n=await r.resolve(e);return e.log("resolved %s to",r,n.map(i=>i.toString())),n}function yA(r){try{let e;if(typeof r=="string"?e=Re(r):e=r,!e.protoNames().includes("ipcidr")){const n=e.protoNames().includes("ip6")?"/ipcidr/128":"/ipcidr/32";e=e.encapsulate(n)}return e1e(e)}catch{throw new Error(`Can't convert to IpNet, Invalid multiaddr format: ${r}`)}}const pSe={maxConnections:RK};class gSe{constructor(e,t={}){u(this,"maxConnections");u(this,"connectionManager");u(this,"peerStore");u(this,"allow");u(this,"events");u(this,"log");this.maxConnections=t.maxConnections??pSe.maxConnections,this.allow=(t.allow??[]).map(n=>yA(n)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections %e",e)})}async _maybePruneConnections(){const e=this.connectionManager.getConnections(),t=e.length;if(this.log("checking max connections limit %d/%d",t,this.maxConnections),t<=this.maxConnections)return;const n=new uc;for(const a of e){const c=a.remotePeer;if(!n.has(c)){n.set(c,0);try{const l=await this.peerStore.get(c);n.set(c,[...l.tags.values()].reduce((d,h)=>d+h.value,0))}catch(l){l.name!=="NotFoundError"&&this.log.error("error loading peer tags",l)}}}const i=this.sortConnections(e,n),s=Math.max(t-this.maxConnections,0),o=[];for(const a of i)if(this.log("too many connections open - closing a connection to %p",a.remotePeer),this.allow.some(l=>l.contains(a.remoteAddr.nodeAddress().address))||o.push(a),o.length===s)break;await Promise.all(o.map(async a=>{await oSe(a,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:o})}sortConnections(e,t){return e.sort((n,i)=>{const s=n.timeline.open,o=i.timeline.open;return s<o?1:s>o?-1:0}).sort((n,i)=>n.direction==="outbound"&&i.direction==="inbound"?1:n.direction==="inbound"&&i.direction==="outbound"?-1:0).sort((n,i)=>n.streams.length>i.streams.length?1:n.streams.length<i.streams.length?-1:0).sort((n,i)=>{const s=t.get(n.remotePeer)??0,o=t.get(i.remotePeer)??0;return s>o?1:s<o?-1:0})}}class ySe extends Bl{constructor(e={}){super({...e,sort:(t,n)=>t.options.priority>n.options.priority?-1:t.options.priority<n.options.priority?1:0})}}function mSe(r){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r)||/^::1$/.test(r)}function BK(r){if(!SL(r))return!1;const{address:e}=r.nodeAddress();return mSe(e)}function wSe(r,e){const t=hm.exactMatch(r.multiaddr),n=hm.exactMatch(e.multiaddr);if(t&&!n)return-1;if(!t&&n)return 1;const i=pm.exactMatch(r.multiaddr),s=pm.exactMatch(e.multiaddr);if(i&&!s)return-1;if(!i&&s)return 1;const o=G1.exactMatch(r.multiaddr),a=G1.exactMatch(e.multiaddr);if(o&&!a)return-1;if(!o&&a)return 1;const c=O7.exactMatch(r.multiaddr),l=O7.exactMatch(e.multiaddr);if(c&&!l)return-1;if(!c&&l)return 1;const d=M7.exactMatch(r.multiaddr),h=M7.exactMatch(e.multiaddr);if(d&&!h)return-1;if(!d&&h)return 1;const p=eO.exactMatch(r.multiaddr),m=eO.exactMatch(e.multiaddr);return p&&!m?-1:!p&&m?1:0}function bSe(r,e){const t=BK(r.multiaddr),n=BK(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function vSe(r,e){const t=Yl(r.multiaddr),n=Yl(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function ESe(r,e){return r.isCertified&&!e.isCertified?-1:!r.isCertified&&e.isCertified?1:0}function SSe(r,e){const t=vc.exactMatch(r.multiaddr),n=vc.exactMatch(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function xSe(r){return r.sort(wSe).sort(ESe).sort(SSe).sort(vSe).sort(bSe)}const k4={maxParallelDials:LK,maxDialQueueLength:OK,maxPeerAddrsToDial:MK,dialTimeout:$K};class ASe{constructor(e,t={}){u(this,"queue");u(this,"components");u(this,"addressSorter");u(this,"maxPeerAddrsToDial");u(this,"maxDialQueueLength");u(this,"dialTimeout");u(this,"shutDownController");u(this,"connections");u(this,"log");this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??k4.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??k4.maxDialQueueLength,this.dialTimeout=t.dialTimeout??k4.dialTimeout,this.connections=t.connections??new uc,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.shutDownController=new AbortController,this.shutDownController.signal;for(const[n,i]of Object.entries(t.resolvers??{}))Y7.set(n,i);this.queue=new ySe({concurrency:t.maxParallelDials??k4.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",n=>{var i;((i=n.detail)==null?void 0:i.name)!==_l.name&&this.log.error("error in dial queue - %e",n.detail)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e,t={}){var a,c,l;const{peerId:n,multiaddrs:i}=DK(e),s=Array.from(this.connections.values()).flat().find(d=>t.force===!0?!1:d.remotePeer.equals(n)?!0:i.find(h=>h.equals(d.remoteAddr)));if((s==null?void 0:s.status)==="open")return this.log("already connected to %a",s.remoteAddr),(a=t.onProgress)==null||a.call(t,new _e("dial-queue:already-connected")),s;const o=this.queue.queue.find(d=>{if((n==null?void 0:n.equals(d.options.peerId))===!0)return!0;const h=d.options.multiaddrs;if(h==null)return!1;for(const p of i)if(h.has(p.toString()))return!0;return!1});if(o!=null){this.log("joining existing dial target for %p",n);for(const d of i)o.options.multiaddrs.add(d.toString());return(c=t.onProgress)==null||c.call(t,new _e("dial-queue:already-in-dial-queue")),o.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new xd("Dial queue is full");return this.log("creating dial target for %p",n,i.map(d=>d.toString())),(l=t.onProgress)==null||l.call(t,new _e("dial-queue:add-to-dial-queue")),this.queue.add(async d=>{var p;(p=d.onProgress)==null||p.call(d,new _e("dial-queue:start-dial"));const h=pt([this.shutDownController.signal,d.signal]);try{return await this.dialPeer(d,h)}finally{h.clear()}},{peerId:n,priority:t.priority??VK,multiaddrs:new Set(i.map(d=>d.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})}async dialPeer(e,t){var d;const n=e.peerId,i=e.multiaddrs,s=new Set;let o=e.multiaddrs.size===0,a=0,c=0;const l=[];for(this.log("starting dial to %p",n);o||i.size>0;){c++,o=!1;const h=[],p=new Set(e.multiaddrs);i.clear(),this.log("calculating addrs to dial %p from %s",n,[...p]);const m=await this.calculateMultiaddrs(n,p,{...e,signal:t});for(const f of m){if(s.has(f.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",f.multiaddr,n);continue}h.push(f)}this.log("%s dial to %p with %s",c===1?"starting":"continuing",n,h.map(f=>f.multiaddr.toString())),(d=e==null?void 0:e.onProgress)==null||d.call(e,new _e("dial-queue:calculated-addresses",h));for(const f of h){if(a===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",a,e.peerId),new xd("Peer had more than maxPeerAddrsToDial");a++;try{const g=await this.components.transportManager.dial(f.multiaddr,{...e,signal:t});this.log("dial to %a succeeded",f.multiaddr);try{await this.components.peerStore.merge(g.remotePeer,{multiaddrs:[g.remoteAddr],metadata:{[hSe]:se(Date.now().toString())}})}catch(v){this.log.error("could not update last dial failure key for %p",n,v)}return g}catch(g){if(this.log.error("dial failed to %a",f.multiaddr,g),s.add(f.multiaddr.toString()),n!=null)try{await this.components.peerStore.merge(n,{metadata:{[dSe]:se(Date.now().toString())}})}catch(v){this.log.error("could not update last dial failure key for %p",n,v)}if(t.aborted)throw new f1(g.message);l.push(g)}}}throw l.length===1?l[0]:new AggregateError(l,"All multiaddr dials failed")}async calculateMultiaddrs(e,t=new Set,n={}){var h,p;const i=[...t].map(m=>({multiaddr:Re(m),isCertified:!1}));if(e!=null){if(this.components.peerId.equals(e))throw new xd("Tried to dial self");if(await((p=(h=this.components.connectionGater).denyDialPeer)==null?void 0:p.call(h,e))===!0)throw new PK("The dial request is blocked by gater.allowDialPeer");if(i.length===0){this.log("loading multiaddrs for %p",e);try{const m=await this.components.peerStore.get(e);i.push(...m.addresses),this.log("loaded multiaddrs for %p",e,i.map(({multiaddr:f})=>f.toString()))}catch(m){if(m.name!=="NotFoundError")throw m}}if(i.length===0){this.log("looking up multiaddrs for %p in the peer routing",e);try{const m=await this.components.peerRouting.findPeer(e,n);this.log("found multiaddrs for %p in the peer routing",e,i.map(({multiaddr:f})=>f.toString())),i.push(...m.multiaddrs.map(f=>({multiaddr:f,isCertified:!1})))}catch(m){m.name==="NoPeerRoutersError"?this.log("no peer routers configured",e):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",e,m)}}}let s=(await Promise.all(i.map(async m=>{const f=await fSe(m.multiaddr,{dns:this.components.dns,...n,log:this.log});return f.length===1&&f[0].equals(m.multiaddr)?m:f.map(g=>({multiaddr:g,isCertified:!1}))}))).flat();if(e!=null){const m=`/p2p/${e.toString()}`;s=s.map(f=>{const g=f.multiaddr.protos().pop();return(g==null?void 0:g.path)===!0?f:f.multiaddr.getPeerId()==null?{multiaddr:f.multiaddr.encapsulate(m),isCertified:f.isCertified}:f})}const o=s.filter(m=>{if(this.components.transportManager.dialTransportForMultiaddr(m.multiaddr)==null)return!1;const f=m.multiaddr.getPeerId();return e!=null&&f!=null?e.equals(f):!0}),a=new Map;for(const m of o){const f=m.multiaddr.toString(),g=a.get(f);if(g!=null){g.isCertified=g.isCertified||m.isCertified||!1;continue}a.set(f,m)}const c=[...a.values()];if(c.length===0)throw new jEe("The dial request has no valid addresses");const l=[];for(const m of c)this.components.connectionGater.denyDialMultiaddr!=null&&await this.components.connectionGater.denyDialMultiaddr(m.multiaddr)||l.push(m);const d=this.addressSorter==null?xSe(l):l.sort(this.addressSorter);if(d.length===0)throw new PK("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",s.map(({multiaddr:m})=>m.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",d.map(({multiaddr:m})=>m.toString())),d}async isDialable(e,t={}){Array.isArray(e)||(e=[e]);try{const n=await this.calculateMultiaddrs(void 0,new Set(e.map(i=>i.toString())),t);return t.runOnLimitedConnection===!1?n.find(i=>!vc.matches(i.multiaddr))!=null:!0}catch(n){this.log.trace("error calculating if multiaddr(s) were dialable",n)}return!1}}var UK={};function Ui(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var CSe=Ui;Ui.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},Ui.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},Ui.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0},Ui.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},Ui.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)},Ui.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)},Ui.prototype.start=Ui.prototype.try,Ui.prototype.errors=function(){return this._errors},Ui.prototype.attempts=function(){return this._attempts},Ui.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var i=this._errors[n],s=i.message,o=(r[s]||0)+1;r[s]=o,o>=t&&(e=i,t=o)}return e},function(r){var e=CSe;r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in t)n[i]=t[i];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],o=0;o<n.retries;o++)s.push(this.createTimeout(o,n));return t&&t.forever&&!s.length&&s.push(this.createTimeout(o,n)),s.sort(function(a,c){return a-c}),s},r.createTimeout=function(t,n){var i=n.randomize?Math.random()+1:1,s=Math.round(i*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return s=Math.min(s,n.maxTimeout),s},r.wrap=function(t,n,i){if(n instanceof Array&&(i=n,n=null),!i){i=[];for(var s in t)typeof t[s]=="function"&&i.push(s)}for(var o=0;o<i.length;o++){var a=i[o],c=t[a];t[a]=(function(d){var h=r.operation(n),p=Array.prototype.slice.call(arguments,1),m=p.pop();p.push(function(f){h.retry(f)||(f&&(arguments[0]=h.mainError()),m.apply(this,arguments))}),h.attempt(function(){d.apply(t,p)})}).bind(t,c),t[a].options=n}}}(UK);var ISe=UK;const kSe=Ze(ISe),_Se=Object.prototype.toString,TSe=r=>_Se.call(r)==="[object Error]",PSe=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function DSe(r){return r&&TSe(r)&&r.name==="TypeError"&&typeof r.message=="string"?r.message==="Load failed"?r.stack===void 0:PSe.has(r.message):!1}class $Se extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const FK=(r,e,t)=>{const n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r};async function NSe(r,e){return new Promise((t,n)=>{e={...e},e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.retries??(e.retries=10);const i=kSe.operation(e),s=()=>{var a;i.stop(),n((a=e.signal)==null?void 0:a.reason)};e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",s,{once:!0});const o=()=>{var a;(a=e.signal)==null||a.removeEventListener("abort",s),i.stop()};i.attempt(async a=>{try{const c=await r(a);o(),t(c)}catch(c){try{if(!(c instanceof Error))throw new TypeError(`Non-error was thrown: "${c}". You should only throw errors.`);if(c instanceof $Se)throw c.originalError;if(c instanceof TypeError&&!DSe(c))throw c;if(FK(c,a,e),await e.shouldRetry(c)||(i.stop(),n(c)),await e.onFailedAttempt(c),!i.retry(c))throw i.mainError()}catch(l){FK(l,a,e),o(),n(l)}}})})}class MSe{constructor(e,t={}){u(this,"log");u(this,"queue");u(this,"started");u(this,"peerStore");u(this,"retries");u(this,"retryInterval");u(this,"backoffFactor");u(this,"connectionManager");u(this,"events");this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new lc({concurrency:t.maxParallelReconnects??uSe,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",n=>{this.maybeReconnect(n.detail).catch(i=>{this.log.error("failed to maybe reconnect to %p - %e",n.detail,i)})})}async maybeReconnect(e){if(!this.started)return;const t=await this.peerStore.get(e);zK(t)&&(this.queue.has(e)||this.queue.add(async n=>{await NSe(async i=>{if(this.started)try{await this.connectionManager.openConnection(e,{signal:n==null?void 0:n.signal})}catch(s){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,i,this.retries,s),s}},{signal:n==null?void 0:n.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:e}).catch(async n=>{this.log.error("failed to reconnect to %p - %e",e,n);const i={};[...t.tags.keys()].forEach(s=>{s.startsWith(k2)&&(i[s]=void 0)}),await this.peerStore.merge(e,{tags:i}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})}).catch(async n=>{this.log.error("failed to remove keep-alive tag from %p - %e",e,n)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[t=>zK(t)]});await Promise.all(e.map(async t=>{await this.connectionManager.openConnection(t.id).catch(n=>{this.log.error(n)})}))}).catch(e=>{this.log.error(e)})}stop(){this.started=!1,this.queue.abort()}}function zK(r){for(const e of r.tags.keys())if(e.startsWith(k2))return!0;return!1}const VK=50,mA={maxConnections:RK,inboundConnectionThreshold:cSe,maxIncomingPendingConnections:lSe};_H=Symbol.toStringTag;class OSe{constructor(e,t={}){u(this,"started");u(this,"connections");u(this,"allow");u(this,"deny");u(this,"maxIncomingPendingConnections");u(this,"incomingPendingConnections");u(this,"outboundPendingConnections");u(this,"maxConnections");u(this,"dialQueue");u(this,"reconnectQueue");u(this,"connectionPruner");u(this,"inboundConnectionRateLimiter");u(this,"peerStore");u(this,"metrics");u(this,"events");u(this,"log");u(this,"peerId");u(this,_H,"@libp2p/connection-manager");var n;if(this.maxConnections=t.maxConnections??mA.maxConnections,this.maxConnections<1)throw new Z("Connection Manager maxConnections must be greater than 0");this.connections=new uc,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(i=>yA(i)),this.deny=(t.deny??[]).map(i=>yA(i)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??mA.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new aF({points:t.inboundConnectionThreshold??mA.inboundConnectionThreshold,duration:1}),this.connectionPruner=new gSe({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{maxConnections:this.maxConnections,allow:(n=t.allow)==null?void 0:n.map(i=>Re(i))}),this.dialQueue=new ASe(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??LK,maxDialQueueLength:t.maxDialQueueLength??OK,maxPeerAddrsToDial:t.maxPeerAddrsToDial??MK,dialTimeout:t.dialTimeout??$K,resolvers:t.resolvers??{dnsaddr:oK},connections:this.connections}),this.reconnectQueue=new MSe({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}async start(){var e,t,n;(e=this.metrics)==null||e.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const i={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(const s of this.connections.values())for(const o of s)i[o.direction]++;return i}}),(t=this.metrics)==null||t.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const i={};for(const s of this.connections.values())for(const o of s)for(const a of o.streams){const c=`${a.direction} ${a.protocol??"unnegotiated"}`;i[c]=(i[c]??0)+1}return i}}),(n=this.metrics)==null||n.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const i={};for(const o of this.connections.values())for(const a of o){const c={};for(const l of a.streams){const d=`${l.direction} ${l.protocol??"unnegotiated"}`;c[d]=(c[d]??0)+1}for(const[l,d]of Object.entries(c))i[l]=i[l]??[],i[l].push(d)}const s={};for(let[o,a]of Object.entries(i)){a=a.sort((l,d)=>l-d);const c=Math.floor(a.length*.9);s[o]=a[c]}return s}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await ko(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await Ga(this.reconnectQueue,this.dialQueue,this.connectionPruner);const e=[];for(const t of this.connections.values())for(const n of t)e.push((async()=>{try{await n.close()}catch(i){this.log.error(i)}})());this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}onConnect(e){this._onConnect(e).catch(t=>{this.log.error(t)})}async _onConnect(e){const{detail:t}=e;if(!this.started){await t.close();return}if(t.status!=="open")return;const n=t.remotePeer,i=!this.connections.has(n),s=this.connections.get(n)??[];s.push(t),this.connections.set(n,s),n.publicKey!=null&&n.type==="RSA"&&await this.peerStore.patch(n,{publicKey:n.publicKey}),i&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){const{detail:t}=e,n=t.remotePeer,s=(this.connections.get(n)??[]).filter(o=>o.id!==t.id);this.connections.set(n,s),s.length===0&&(this.log("onDisconnect remove all connections for peer %p",n),this.connections.delete(n),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let t=[];for(const n of this.connections.values())t=t.concat(n);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){var n,i;if(!this.started)throw new Pl("Not started");this.outboundPendingConnections++;try{(n=t.signal)==null||n.throwIfAborted();const{peerId:s}=DK(e);if(this.peerId.equals(s))throw new xb("Can not dial self");if(s!=null&&t.force!==!0){this.log("dial %p",s);const l=this.getConnections(s).find(d=>d.limits==null);if(l!=null)return this.log("had an existing non-limited connection to %p",s),(i=t.onProgress)==null||i.call(t,new _e("dial-queue:already-connected")),l}const o=await this.dialQueue.dial(e,{...t,priority:t.priority??VK});if(o.status!=="open")throw new Eb("Remote closed connection during opening");let a=this.connections.get(o.remotePeer);a==null&&(a=[],this.connections.set(o.remotePeer,a));let c=!1;for(const l of a)if(l.id===o.id&&(c=!0),t.force!==!0&&l.id!==o.id&&l.remoteAddr.equals(o.remoteAddr))return o.abort(new D2("Duplicate multiaddr connection")),l;return c||a.push(o),o}finally{this.outboundPendingConnections--}}async closeConnections(e,t={}){const n=this.connections.get(e)??[];await Promise.all(n.map(async i=>{try{await i.close(t)}catch(s){i.abort(s)}}))}async acceptIncomingConnection(e){if(this.deny.some(i=>i.contains(e.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(i=>i.contains(e.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const i=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(i,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,i),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(n=>Re(n))}))}async isDialable(e,t={}){return this.dialQueue.isDialable(e,t)}}const RSe=1e4,LSe="1.0.0",BSe="ping",USe="ipfs",KK=32,FSe=!0;PH=Symbol.toStringTag,TH=dr;class zSe{constructor(e,t={}){u(this,"protocol");u(this,"components");u(this,"log");u(this,"heartbeatInterval");u(this,"pingIntervalMs");u(this,"abortController");u(this,"timeout");u(this,"abortConnectionOnPingFailure");u(this,PH,"@libp2p/connection-monitor");u(this,TH,["@libp2p/connection-monitor"]);this.components=e,this.protocol=`/${t.protocolPrefix??USe}/${BSe}/${LSe}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??RSe,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??FSe,this.timeout=new pp({...t.pingTimeout??{},metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(async()=>{var n;let t=Date.now();try{const i=this.timeout.getTimeoutSignal({signal:(n=this.abortController)==null?void 0:n.signal}),s=await e.newStream(this.protocol,{signal:i,runOnLimitedConnection:!0}),o=Qm(s);t=Date.now(),await Promise.all([o.write(ic(KK),{signal:i}),o.read({bytes:KK,signal:i})]),e.rtt=Date.now()-t,await o.unwrap().close({signal:i})}catch(i){if(i.name!=="UnsupportedProtocolError")throw i;e.rtt=(Date.now()-t)/2}}).catch(t=>{this.log.error("error during heartbeat",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){var e;(e=this.abortController)==null||e.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}}DH=Symbol.toStringTag;class VSe{constructor(e,t){u(this,"routers");u(this,"started");u(this,"components");u(this,DH,"@libp2p/content-routing");var n,i,s,o,a;this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()}),getAttributesFromYieldedValue:(c,l)=>({...l,providers:[...Array.isArray(l.providers)?l.providers:[],c.id.toString()]})}))??this.findProviders,this.provide=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.provide,this.cancelReprovide=((s=e.metrics)==null?void 0:s.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.cancelReprovide,this.put=((o=e.metrics)==null?void 0:o.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([c])=>({key:re(c,"base36")})}))??this.put,this.get=((a=e.metrics)==null?void 0:a.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([c])=>({key:re(c,"base36")})}))??this.get}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw new gA("No content routers available");const n=this,i=new ts;for await(const s of Oa(...n.routers.map(o=>o.findProviders(e,t))))s!=null&&(s.multiaddrs.length>0&&await this.components.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),!i.has(s.id)&&(i.add(s.id),yield s))}async provide(e,t={}){if(this.routers.length===0)throw new gA("No content routers available");await Promise.all(this.routers.map(async n=>{await n.provide(e,t)}))}async cancelReprovide(e,t={}){if(this.routers.length===0)throw new gA("No content routers available");await Promise.all(this.routers.map(async n=>{await n.cancelReprovide(e,t)}))}async put(e,t,n){if(!this.isStarted())throw new Pl;await Promise.all(this.routers.map(async i=>{await i.put(e,t,n)}))}async get(e,t){if(!this.isStarted())throw new Pl;return Promise.any(this.routers.map(async n=>n.get(e,t)))}}$H=Symbol.toStringTag;class KSe{constructor(e,t={}){u(this,"log");u(this,"peerId");u(this,"peerStore");u(this,"routers");u(this,$H,"@libp2p/peer-routing");var n,i;this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([s],o)=>({...o,peer:s.toString()})}))??this.findPeer,this.getClosestPeers=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([s],o)=>({...o,key:re(s,"base36")}),getAttributesFromYieldedValue:(s,o)=>({...o,peers:[...Array.isArray(o.peers)?o.peers:[],s.id.toString()]})}))??this.getClosestPeers}async findPeer(e,t){if(this.routers.length===0)throw new TK("No peer routers available");if(e.toString()===this.peerId.toString())throw new UEe("Should not try to find self");const n=this,i=Oa(...this.routers.map(s=>async function*(){try{yield await s.findPeer(e,t)}catch(o){n.log.error(o)}}()));for await(const s of i)if(s!=null)return s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),s;throw new Zt}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new TK("No peer routers available");const n=this,i=zl(1024);for await(const s of lp(async function*(){const o=Oa(...n.routers.map(a=>a.getClosestPeers(e,t)));for await(let a of o)yield async()=>{if(a.multiaddrs.length===0)try{a=await n.findPeer(a.id,{...t,useCache:!1})}catch(c){n.log.error("could not find peer multiaddrs",c);return}return a}}()))s!=null&&(s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),!i.has(s.id.toMultihash().bytes)&&(i.add(s.id.toMultihash().bytes),yield s))}}class jSe extends(MH=er,NH=Symbol.toStringTag,MH){constructor(t){super();u(this,"peerRouting");u(this,"log");u(this,"walking");u(this,"walkers");u(this,"shutdownController");u(this,"walkController");u(this,"needNext");u(this,NH,"@libp2p/random-walk");this.log=t.logger.forComponent("libp2p:random-walk"),this.peerRouting=t.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}async*walk(t){var i,s;this.walking||this.startWalk(),this.walkers++;const n=pt([this.shutdownController.signal,t==null?void 0:t.signal]);try{for(;;)(i=this.needNext)==null||i.resolve(),this.needNext=Le(),yield(await Ti(this,"walk:peer",n,{errorEvent:"walk:error"})).detail}finally{n.clear(),this.walkers--,this.walkers===0&&((s=this.walkController)==null||s.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;const t=pt([this.walkController.signal,this.shutdownController.signal]),n=Date.now();let i=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const s=ic(32);let o=Date.now();for await(const a of this.peerRouting.getClosestPeers(s,{signal:t}))t.aborted&&this.log("aborting walk"),t.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",a.id,Date.now()-o,this.walkers),i++,this.safeDispatchEvent("walk:peer",{detail:a}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),await ln(this.needNext.promise,t)),o=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",s,this.walkers,i)}catch(s){this.log.error("random walk errored",s),this.safeDispatchEvent("walk:error",{detail:s})}this.log("no walkers left, ended walk")}).catch(s=>{this.log.error("random walk errored",s)}).finally(()=>{this.log("finished walk, found %d peers after %dms",i,Date.now()-n),this.walking=!1})}}const jK=32,HK=64;OH=Symbol.toStringTag;class HSe{constructor(e){u(this,"log");u(this,"topologies");u(this,"handlers");u(this,"components");u(this,OH,"@libp2p/registrar");this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(t==null)throw new FEe(`No handler registered for protocol ${e}`);return t}getTopologies(e){const t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,n){if(this.handlers.has(e)&&(n==null?void 0:n.force)!==!0)throw new zEe(`Handler already registered for protocol ${e}`);const i=pE.bind({ignoreUndefined:!0})({maxInboundStreams:jK,maxOutboundStreams:HK},n);this.handlers.set(e,{handler:t,options:i}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]})}async unhandle(e){(Array.isArray(e)?e:[e]).forEach(n=>{this.handlers.delete(n)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(e,t){if(t==null)throw new Z("invalid topology");const n=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let i=this.topologies.get(e);return i==null&&(i=new Map,this.topologies.set(e,i)),i.set(n,t),n}unregister(e){for(const[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),n.size===0&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail;this.components.peerStore.get(t).then(n=>{var i,s,o;for(const a of n.protocols){const c=this.topologies.get(a);if(c!=null)for(const l of c.values())((i=l.filter)==null?void 0:i.has(t))!==!1&&((s=l.filter)==null||s.remove(t),(o=l.onDisconnect)==null||o.call(l,t))}}).catch(n=>{n.name!=="NotFoundError"&&this.log.error("could not inform topologies of disconnecting peer %p",t,n)})}_onPeerUpdate(e){var s,o,a;const{peer:t,previous:n}=e.detail,i=((n==null?void 0:n.protocols)??[]).filter(c=>!t.protocols.includes(c));for(const c of i){const l=this.topologies.get(c);if(l!=null)for(const d of l.values())((s=d.filter)==null?void 0:s.has(t.id))!==!1&&((o=d.filter)==null||o.remove(t.id),(a=d.onDisconnect)==null||a.call(d,t.id))}}_onPeerIdentify(e){var s,o,a;const t=e.detail.protocols,n=e.detail.connection,i=e.detail.peerId;for(const c of t){const l=this.topologies.get(c);if(l!=null)for(const d of l.values())n.limits!=null&&d.notifyOnLimitedConnection!==!0||((s=d.filter)==null?void 0:s.has(i))!==!0&&((o=d.filter)==null||o.add(i),(a=d.onConnect)==null||a.call(d,i,n))}}}RH=Symbol.toStringTag;class qSe{constructor(e,t={}){u(this,"log");u(this,"components");u(this,"transports");u(this,"listeners");u(this,"faultTolerance");u(this,"started");u(this,RH,"@libp2p/transport-manager");this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=new Map,this.listeners=OM({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??kl.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(t==null)throw new Z("Transport must have a valid tag");if(this.transports.has(t))throw new Z(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[t,n]of this.listeners)for(this.log("closing listeners for %s",t);n.length>0;){const i=n.pop();i!=null&&e.push(i.close())}await Promise.all(e),this.log("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){var i;const n=this.dialTransportForMultiaddr(e);if(n==null)throw new WEe(`No transport available for address ${String(e)}`);return(i=t==null?void 0:t.onProgress)==null||i.call(t,new _e("transport-manager:selected-transport",n[Symbol.toStringTag])),n.dial(e,{...t,upgrader:this.components.upgrader})}getAddrs(){let e=[];for(const t of this.listeners.values())for(const n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(const t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(const t of this.transports.values())if(t.listenFilter([e]).length>0)return t}async listen(e){if(!this.isStarted())throw new Pl("Not started");if(e==null||e.length===0){this.log("no addresses were provided for listening, this node is dial only");return}const t={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};e.forEach(s=>{t.errors.set(s.toString(),new VEe)});const n=[];for(const[s,o]of this.transports.entries()){const a=o.listenFilter(e);for(const c of a){this.log("creating listener for %s on %a",s,c);const l=o.createListener({upgrader:this.components.upgrader});let d=this.listeners.get(s)??[];d==null&&(d=[],this.listeners.set(s,d)),d.push(l),l.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:l})}),l.addEventListener("close",()=>{const h=d.findIndex(p=>p===l);d.splice(h,1),this.components.events.safeDispatchEvent("transport:close",{detail:l})}),GM.matches(c)?t.ipv4.attempts++:QM.matches(c)&&t.ipv6.attempts++,n.push(l.listen(c).then(()=>{t.errors.delete(c.toString()),GM.matches(c)&&t.ipv4.success++,QM.matches(c)&&t.ipv6.success++},h=>{throw this.log.error("transport %s could not listen on address %a - %e",s,c,h),t.errors.set(c.toString(),h),h}))}}const i=await Promise.allSettled(n);if(!(i.length>0&&i.every(s=>s.status==="fulfilled"))){if(this.ipv6Unsupported(t)){this.log("all IPv4 addresses succeed but all IPv6 failed");return}if(this.faultTolerance===kl.NO_FATAL){this.log("failed to listen on any address but fault tolerance allows this");return}throw new KEe(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...t.errors.entries()].map(([s,o])=>`
  ${s}: ${`${o.stack??o}`.split(`
`).join(`
  `)}
`).join("")}`)}}ipv6Unsupported(e){if(e.ipv4.attempts===0||e.ipv6.attempts===0)return!1;const t=e.ipv4.attempts===e.ipv4.success,n=e.ipv6.success===0;return t&&n}async remove(e){const t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);const n=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){const i=t.pop();i!=null&&n.push(i.close())}await Promise.all(n),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}const Rn="/multistream/1.0.0",wA=1024,WSe=se(`
`);async function n0(r,e,t){await r.write(e,t)}async function GSe(r,e,t){await r.writeV(e,t)}async function QSe(r,e){const t=await r.read(e);if(t.byteLength===0||t.get(t.byteLength-1)!==WSe[0])throw e.log.error("Invalid mss message - missing newline",t),new Et("Missing newline");return t.sublist(0,-1)}async function Lh(r,e){const t=await QSe(r,e);return re(t.subarray())}async function bA(r,e,t){if(e=Array.isArray(e)?[...e]:[e],e.length===1&&t.negotiateFully===!1)return YSe(r,e[0],t);const n=Xd(r,{...t,maxDataLength:wA}),i=e.shift();if(i==null)throw new Error("At least one protocol must be specified");t.log.trace('select: write ["%s", "%s"]',Rn,i);const s=se(`${Rn}
`),o=se(`${i}
`);await GSe(n,[s,o],t),t.log.trace("select: reading multistream-select header");let a=await Lh(n,t);if(t.log.trace('select: read "%s"',a),a===Rn&&(t.log.trace("select: reading protocol response"),a=await Lh(n,t),t.log.trace('select: read "%s"',a)),a===i)return{stream:n.unwrap(),protocol:i};for(const c of e){t.log.trace('select: write "%s"',c),await n0(n,se(`${c}
`),t),t.log.trace("select: reading protocol response");const l=await Lh(n,t);if(t.log.trace('select: read "%s" for "%s"',l,c),l===c)return{stream:n.unwrap(),protocol:c}}throw new h1("protocol selection failed")}function YSe(r,e,t){const n=r.sink.bind(r),i=r.source;let s=!1,o=!1;const a=Le();let c=!1,l=!1;const d=Le();let h=!1,p=!1;const m=Le(),f=Xd({sink:n,source:i},{...t,maxDataLength:wA});r.sink=async w=>{const{sink:b}=f.unwrap();await b(async function*(){let E=!1;for await(const A of w){if(l&&await d.promise,c)yield A;else{l=!0,t.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',Rn,e,A.byteLength);const k=`${e}
`;yield new Be(Uint8Array.from([19]),se(`${Rn}
`),Sr(k.length),se(k),A).subarray(),t.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',Rn,e,A.byteLength),c=!0,l=!1,d.resolve(),g().catch(x=>{t.log.error("could not finish optimistic protocol negotiation of %s",e,x)})}E=!0}E||await g()}())};async function g(){if(o){t.log.trace("optimistic: already negotiating %s stream",e),await a.promise;return}o=!0;try{c||(t.log.trace("optimistic: doing send protocol for %s stream",e),await v()),h||(t.log.trace("optimistic: doing read protocol for %s stream",e),await y())}finally{o=!1,s=!0,a.resolve()}}async function v(){if(l){await d.promise;return}l=!0;try{t.log.trace('optimistic: write ["%s", "%s", data] in source',Rn,e),await f.writeV([se(`${Rn}
`),se(`${e}
`)]),t.log.trace('optimistic: wrote ["%s", "%s", data] in source',Rn,e)}finally{c=!0,l=!1,d.resolve()}}async function y(){if(p){await m.promise;return}p=!0;try{t.log.trace("optimistic: reading multistream select header");let w=await Lh(f,t);if(t.log.trace('optimistic: read multistream select header "%s"',w),w===Rn&&(w=await Lh(f,t)),t.log.trace('optimistic: read protocol "%s", expecting "%s"',w,e),w!==e)throw new h1("protocol selection failed")}finally{h=!0,p=!1,m.resolve()}}if(r.source=async function*(){await g(),t.log.trace('optimistic: reading data from "%s" stream',e),yield*f.unwrap().source}(),r.closeRead!=null){const w=r.closeRead.bind(r);r.closeRead=async b=>{s||await g().catch(E=>{t.log.error("could not negotiate protocol before close read",E)}),await w(b)}}if(r.closeWrite!=null){const w=r.closeWrite.bind(r);r.closeWrite=async b=>{s||await g().catch(E=>{t.log.error("could not negotiate protocol before close write",E)}),await w(b)}}if(r.close!=null){const w=r.close.bind(r);r.close=async b=>{const E=[];l&&E.push(d.promise),p&&E.push(m.promise),E.length>0?await ln(Promise.all(E),b==null?void 0:b.signal):(s=!0,o=!1,a.resolve()),await w(b)}}return{stream:r,protocol:e}}async function vA(r,e,t){e=Array.isArray(e)?e:[e],t.log.trace("handle: available protocols %s",e);const n=Xd(r,{...t,maxDataLength:wA,maxLengthLength:2});for(;;){t.log.trace("handle: reading incoming string");const i=await Lh(n,t);if(t.log.trace('handle: read "%s"',i),i===Rn){t.log.trace('handle: respond with "%s" for "%s"',Rn,i),await n0(n,se(`${Rn}
`),t),t.log.trace('handle: responded with "%s" for "%s"',Rn,i);continue}if(e.includes(i))return t.log.trace('handle: respond with "%s" for "%s"',i,i),await n0(n,se(`${i}
`),t),t.log.trace('handle: responded with "%s" for "%s"',i,i),{stream:n.unwrap(),protocol:i};if(i==="ls"){const s=new Be(...e.map(o=>Ld.single(se(`${o}
`))),se(`
`));t.log.trace('handle: respond with "%s" for %s',e,i),await n0(n,s,t),t.log.trace('handle: responded with "%s" for %s',e,i);continue}t.log.trace('handle: respond with "na" for "%s"',i),await n0(n,se(`na
`),t),t.log('handle: responded with "na" for "%s"',i)}}const JSe=500;BH=Symbol.toStringTag,LH=TZ;class XSe{constructor(e){u(this,"id");u(this,"remoteAddr");u(this,"remotePeer");u(this,"direction");u(this,"timeline");u(this,"multiplexer");u(this,"encryption");u(this,"status");u(this,"limits");u(this,"log");u(this,"tags");u(this,"_newStream");u(this,"_close");u(this,"_abort");u(this,"_getStreams");u(this,BH,"Connection");u(this,LH,!0);const{remoteAddr:t,remotePeer:n,newStream:i,close:s,abort:o,getStreams:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=n,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.limits=e.limits,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=i,this._close=s,this._abort=o,this._getStreams=a,this.tags=[]}get streams(){return this._getStreams()}async newStream(e,t){if(this.status==="closing")throw new iP("the connection is being closed");if(this.status==="closed")throw new Eb("the connection is closed");if(Array.isArray(e)||(e=[e]),this.limits!=null&&(t==null?void 0:t.runOnLimitedConnection)!==!0)throw new Ab("Cannot open protocol stream on limited connection");const n=await this._newStream(e,t);return n.direction="outbound",n}async close(e={}){if(!(this.status==="closed"||this.status==="closing")){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",e.signal==null){const t=AbortSignal.timeout(JSe);e={...e,signal:t}}try{this.log.trace("closing underlying transport"),await this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(t){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,t),this.abort(t)}}}abort(e){this.status!=="closed"&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this._abort(e),this.status="closed",this.timeline.close=Date.now())}}function ZSe(r){return new XSe(r)}function exe(r,e){try{const{options:t}=e.getHandler(r);return t.maxInboundStreams}catch(t){if(t.name!=="UnhandledProtocolError")throw t}return jK}function txe(r,e,t={}){try{const{options:n}=e.getHandler(r);if(n.maxOutboundStreams!=null)return n.maxOutboundStreams}catch(n){if(n.name!=="UnhandledProtocolError")throw n}return t.maxOutboundStreams??HK}function qK(r,e,t){let n=0;return t.streams.forEach(i=>{i.direction===e&&i.protocol===r&&n++}),n}UH=Symbol.toStringTag;class rxe{constructor(e,t){u(this,"components");u(this,"connectionEncrypters");u(this,"streamMuxers");u(this,"inboundUpgradeTimeout");u(this,"inboundStreamProtocolNegotiationTimeout");u(this,"outboundStreamProtocolNegotiationTimeout");u(this,"events");u(this,"metrics");u(this,UH,"@libp2p/upgrader");var n,i;this.components=e,this.connectionEncrypters=new Map,t.connectionEncrypters.forEach(s=>{this.connectionEncrypters.set(s.protocol,s)}),this.streamMuxers=new Map,t.streamMuxers.forEach(s=>{this.streamMuxers.set(s.protocol,s)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??aSe,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??NK,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??NK,this.events=e.events,this.metrics={dials:(n=e.metrics)==null?void 0:n.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:(i=e.metrics)==null?void 0:i.registerCounterGroup("libp2p_connection_manager_dial_errors_total")}}async shouldBlockConnection(e,...t){const n=this.components.connectionGater[e];if(n==null)return;if(await n.apply(this.components.connectionGater,t)===!0)throw new HEe(`The multiaddr connection is blocked by gater.${e}`)}createInboundAbortSignal(e){return pt([AbortSignal.timeout(this.inboundUpgradeTimeout),e])}async upgradeInbound(e,t){var s,o;let n=!1;const i=this.createInboundAbortSignal(t.signal);try{if((s=this.metrics.dials)==null||s.increment({inbound:!0}),n=await this.components.connectionManager.acceptIncomingConnection(e),!n)throw new qEe("Connection denied");await this.shouldBlockConnection("denyInboundConnection",e),await this._performUpgrade(e,"inbound",{...t,signal:i})}catch(a){throw(o=this.metrics.errors)==null||o.increment({inbound:!0}),a}finally{i.clear(),n&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){var n,i;try{(n=this.metrics.dials)==null||n.increment({outbound:!0});const s=e.remoteAddr.getPeerId();let o;s!=null&&(o=tr(s),await this.shouldBlockConnection("denyOutboundConnection",o,e));let a="outbound";return t.initiator===!1&&(a="inbound"),await this._performUpgrade(e,a,t)}catch(s){throw(i=this.metrics.errors)==null||i.increment({outbound:!0}),s}}async _performUpgrade(e,t,n){var d,h,p;let i,s,o,a,c;(d=this.components.metrics)==null||d.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t);let l=e;if((n==null?void 0:n.skipProtection)!==!0){const m=this.components.connectionProtector;m!=null&&(e.log("protecting the %s connection",t),l=await m.protect(e,n))}try{if(i=l,(n==null?void 0:n.skipEncryption)!==!0){(h=n==null?void 0:n.onProgress)==null||h.call(n,new _e(`upgrader:encrypt-${t}-connection`)),{conn:i,remotePeer:s,protocol:c,streamMuxer:a}=await(t==="inbound"?this._encryptInbound(l,n):this._encryptOutbound(l,n));const m={...l,...i};await this.shouldBlockConnection(t==="inbound"?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",s,m)}else{const m=e.remoteAddr.getPeerId();if(m==null)throw new D2(`${t} connection that skipped encryption must have a peer id`);const f=tr(m);c="native",s=f}if(s.equals(this.components.peerId)){const m=new xb("Can not dial self");throw e.abort(m),m}if(o=i,(n==null?void 0:n.muxerFactory)!=null)a=n.muxerFactory;else if(a==null&&this.streamMuxers.size>0){(p=n==null?void 0:n.onProgress)==null||p.call(n,new _e(`upgrader:multiplex-${t}-connection`));const m=await(t==="inbound"?this._multiplexInbound({...l,...i},this.streamMuxers,n):this._multiplexOutbound({...l,...i},this.streamMuxers,n));a=m.muxerFactory,o=m.stream}}catch(m){throw e.log.error("failed to upgrade inbound connection %s %a - %e",t==="inbound"?"from":"to",e.remoteAddr,m),m}return await this.shouldBlockConnection(t==="inbound"?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",s,e),e.log("successfully upgraded %s connection",t),this._createConnection({cryptoProtocol:c,direction:t,maConn:e,upgradedConn:o,muxerFactory:a,remotePeer:s,limits:n==null?void 0:n.limits})}_createConnection(e){const{cryptoProtocol:t,direction:n,maConn:i,upgradedConn:s,remotePeer:o,muxerFactory:a,limits:c}=e;let l,d,h;a!=null&&(l=a.createStreamMuxer({direction:n,onIncomingStream:f=>{h!=null&&Promise.resolve().then(async()=>{var A;const g=this.components.registrar.getProtocols(),v=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout),{stream:y,protocol:w}=await vA(f,g,{signal:v,log:f.log,yieldBytes:!1});if(h==null)return;h.log("incoming stream opened on %s",w);const b=exe(w,this.components.registrar);if(qK(w,"inbound",h)===b){const k=new cP(`Too many inbound protocol streams for protocol "${w}" - limit ${b}`);throw f.abort(k),k}f.source=y.source,f.sink=y.sink,f.protocol=w,y.closeWrite!=null&&(f.closeWrite=y.closeWrite),y.closeRead!=null&&(f.closeRead=y.closeRead),y.close!=null&&(f.close=y.close),await this.components.peerStore.merge(o,{protocols:[w]}),(A=this.components.metrics)==null||A.trackProtocolStream(f,h),this._onStream({connection:h,stream:f,protocol:w})}).catch(async g=>{h.log.error("error handling incoming stream id %s - %e",f.id,g),f.timeline.close==null&&await f.close()})}}),d=async(f,g={})=>{var y;if(l==null)throw new C4("Connection is not multiplexed");h.log.trace("starting new stream for protocols %s",f);const v=await l.newStream();h.log.trace("started new stream %s for protocols %s",v.id,f);try{if(g.signal==null){v.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",f);const k=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);g={...g,signal:k}}v.log.trace("selecting protocol from protocols %s",f);const{stream:w,protocol:b}=await bA(v,f,{...g,log:v.log,yieldBytes:!0});v.log.trace("selected protocol %s",b);const E=txe(b,this.components.registrar,g),A=qK(b,"outbound",h);if(A>=E){const k=new M2(`Too many outbound protocol streams for protocol "${b}" - ${A}/${E}`);throw v.abort(k),k}return await this.components.peerStore.merge(o,{protocols:[b]}),v.source=w.source,v.sink=w.sink,v.protocol=b,w.closeWrite!=null&&(v.closeWrite=w.closeWrite),w.closeRead!=null&&(v.closeRead=w.closeRead),w.close!=null&&(v.close=w.close),(y=this.components.metrics)==null||y.trackProtocolStream(v,h),v}catch(w){throw h.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e",n==="inbound"?"from":"to",e.maConn.remoteAddr,f,w),v.timeline.close==null&&v.abort(w),w}},Promise.all([l.sink(s.source),s.sink(l.source)]).catch(f=>{h.log.error("error piping data through muxer - %e",f)}));const p=i.timeline;i.timeline=new Proxy(p,{set:(...f)=>(f[1]==="close"&&f[2]!=null&&p.close==null&&(async()=>{try{h.status==="open"&&await h.close()}catch(g){h.log.error("error closing connection after timeline close %e",g)}finally{this.events.safeDispatchEvent("connection:close",{detail:h})}})().catch(g=>{h.log.error("error thrown while dispatching connection:close event %e",g)}),Reflect.set(...f))}),i.timeline.upgraded=Date.now();const m=()=>{throw new C4("Connection is not multiplexed")};return h=ZSe({remoteAddr:i.remoteAddr,remotePeer:o,status:"open",direction:n,timeline:i.timeline,multiplexer:l==null?void 0:l.protocol,encryption:t,limits:c,logger:this.components.logger,newStream:d??m,getStreams:()=>(l==null?void 0:l.streams)??[],close:async f=>{await(l==null?void 0:l.close(f)),await i.close(f)},abort:f=>{i.abort(f),l==null||l.abort(f)}}),this.events.safeDispatchEvent("connection:open",{detail:h}),h.__maConnTimeline=p,h}_onStream(e){const{connection:t,stream:n,protocol:i}=e,{handler:s,options:o}=this.components.registrar.getHandler(i);if(t.limits!=null&&o.runOnLimitedConnection!==!0)throw new Ab("Cannot open protocol stream on limited connection");s({connection:t,stream:n})}async _encryptInbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{const{stream:i,protocol:s}=await vA(e,n,{...t,log:e.log}),o=this.connectionEncrypters.get(s);if(o==null)throw new I4(`no crypto module found for ${s}`);return e.log("encrypting inbound connection to %a using %s",e.remoteAddr,s),{...await o.secureInbound(i,t),protocol:s}}catch(i){throw e.log.error("encrypting inbound connection from %a failed",e.remoteAddr,i),new I4(i.message)}}async _encryptOutbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",n);const{stream:i,protocol:s}=await bA(e,n,{...t,log:e.log,yieldBytes:!0}),o=this.connectionEncrypters.get(s);if(o==null)throw new I4(`no crypto module found for ${s}`);return e.log("encrypting outbound connection to %a using %s",e.remoteAddr,s),{...await o.secureOutbound(i,t),protocol:s}}catch(i){throw e.log.error("encrypting outbound connection to %a failed",e.remoteAddr,i),new I4(i.message)}}async _multiplexOutbound(e,t,n){const i=Array.from(t.keys());e.log("outbound selecting muxer %s",i);try{e.log.trace("selecting stream muxer from %s",i);const{stream:s,protocol:o}=await bA(e,i,{...n,log:e.log,yieldBytes:!0});e.log("selected %s as muxer protocol",o);const a=t.get(o);return{stream:s,muxerFactory:a}}catch(s){throw e.log.error("error multiplexing outbound connection",s),new C4(String(s))}}async _multiplexInbound(e,t,n){const i=Array.from(t.keys());e.log("inbound handling muxers %s",i);try{const{stream:s,protocol:o}=await vA(e,i,{...n,log:e.log}),a=t.get(o);return{stream:s,muxerFactory:a}}catch(s){throw e.log.error("error multiplexing inbound connection",s),new C4(String(s))}}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}}class nxe extends er{constructor(t){var d,h,p,m,f,g,v,y,w,b,E,A;super();Je(this,h0);u(this,"peerId");u(this,"peerStore");u(this,"contentRouting");u(this,"peerRouting");u(this,"metrics");u(this,"services");u(this,"logger");u(this,"status");u(this,"components");u(this,"log");this.status="stopped";const n=new er,i=n.dispatchEvent.bind(n);n.dispatchEvent=k=>{const x=i(k),I=this.dispatchEvent(new CustomEvent(k.type,{detail:k.detail}));return x||I},this.peerId=t.peerId,this.logger=t.logger??Oy(),this.log=this.logger.forComponent("libp2p"),this.services={};const s=((d=t.nodeInfo)==null?void 0:d.name)??iK,o=((h=t.nodeInfo)==null?void 0:h.version)??nK,a=this.components=JEe({peerId:t.peerId,privateKey:t.privateKey,nodeInfo:{name:s,version:o,userAgent:((p=t.nodeInfo)==null?void 0:p.userAgent)??sK(s,o)},logger:this.logger,events:n,datastore:t.datastore??new zR,connectionGater:iSe(t.connectionGater),dns:t.dns});this.peerStore=this.configureComponent("peerStore",mEe(a,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...t.peerStore})),t.metrics!=null&&(this.metrics=this.configureComponent("metrics",t.metrics(this.components))),a.events.addEventListener("peer:update",k=>{if(k.detail.previous==null){const x={id:k.detail.peer.id,multiaddrs:k.detail.peer.addresses.map(I=>I.multiaddr)};a.events.safeDispatchEvent("peer:discovery",{detail:x})}}),t.connectionProtector!=null&&this.configureComponent("connectionProtector",t.connectionProtector(a)),this.components.upgrader=new rxe(this.components,{connectionEncrypters:(t.connectionEncrypters??[]).map((k,x)=>this.configureComponent(`connection-encryption-${x}`,k(this.components))),streamMuxers:(t.streamMuxers??[]).map((k,x)=>this.configureComponent(`stream-muxers-${x}`,k(this.components))),inboundUpgradeTimeout:(m=t.connectionManager)==null?void 0:m.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:((f=t.connectionManager)==null?void 0:f.inboundStreamProtocolNegotiationTimeout)??((g=t.connectionManager)==null?void 0:g.protocolNegotiationTimeout),outboundStreamProtocolNegotiationTimeout:((v=t.connectionManager)==null?void 0:v.outboundStreamProtocolNegotiationTimeout)??((y=t.connectionManager)==null?void 0:y.protocolNegotiationTimeout)}),this.configureComponent("transportManager",new qSe(this.components,t.transportManager)),this.configureComponent("connectionManager",new OSe(this.components,t.connectionManager)),((w=t.connectionMonitor)==null?void 0:w.enabled)!==!1&&this.configureComponent("connectionMonitor",new zSe(this.components,t.connectionMonitor)),this.configureComponent("registrar",new HSe(this.components)),this.configureComponent("addressManager",new REe(this.components,t.addresses));const c=(t.peerRouters??[]).map((k,x)=>this.configureComponent(`peer-router-${x}`,k(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new KSe(this.components,{routers:c}));const l=(t.contentRouters??[]).map((k,x)=>this.configureComponent(`content-router-${x}`,k(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new VSe(this.components,{routers:l})),this.configureComponent("randomWalk",new jSe(this.components)),(t.peerDiscovery??[]).forEach((k,x)=>{this.configureComponent(`peer-discovery-${x}`,k(this.components)).addEventListener("peer",T=>{Ie(this,h0,BA).call(this,T)})}),(b=t.transports)==null||b.forEach((k,x)=>{this.components.transportManager.add(this.configureComponent(`transport-${x}`,k(this.components)))}),t.services!=null)for(const k of Object.keys(t.services)){const x=t.services[k],I=x(this.components);if(I==null){this.log.error("service factory %s returned null or undefined instance",k);continue}this.services[k]=I,this.configureComponent(k,I),I[Ed]!=null&&(this.log("registering service %s for content routing",k),l.push(I[Ed])),I[Sd]!=null&&(this.log("registering service %s for peer routing",k),c.push(I[Sd])),I[I2]!=null&&(this.log("registering service %s for peer discovery",k),(A=(E=I[I2]).addEventListener)==null||A.call(E,"peer",T=>{Ie(this,h0,BA).call(this,T)}))}XEe(a)}configureComponent(t,n){return n==null&&this.log.error("component %s was null or undefined",t),this.components[t]=n,n}async start(){var t,n,i,s;if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{await((n=(t=this.components).beforeStart)==null?void 0:n.call(t)),await this.components.start(),await((s=(i=this.components).afterStart)==null?void 0:s.call(i)),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(o){throw this.log.error("An error occurred starting libp2p",o),this.status="started",await this.stop(),o}}}async stop(){var t,n,i,s;this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",await((n=(t=this.components).beforeStop)==null?void 0:n.call(t)),await this.components.stop(),await((s=(i=this.components).afterStop)==null?void 0:s.call(i)),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(t){return this.components.connectionManager.getConnections(t)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const t=new ts;for(const n of this.components.connectionManager.getConnections())t.add(n.remotePeer);return Array.from(t)}async dial(t,n={}){return this.components.connectionManager.openConnection(t,{priority:75,...n})}async dialProtocol(t,n,i={}){if(n==null)throw new Z("no protocols were provided to open a stream");if(n=Array.isArray(n)?n:[n],n.length===0)throw new Z("no protocols were provided to open a stream");return(await this.dial(t,i)).newStream(n,i)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(t,n={}){Em(t)&&(t=tr(t.getPeerId()??"")),await this.components.connectionManager.closeConnections(t,n)}async getPublicKey(t,n={}){if(this.log("getPublicKey %p",t),t.publicKey!=null)return t.publicKey;try{const a=await this.peerStore.get(t);if(a.id.publicKey!=null)return a.id.publicKey}catch(a){if(a.name!=="NotFoundError")throw a}const i=or([se("/pk/"),t.toMultihash().bytes]),s=await this.contentRouting.get(i,n),o=_n(s);return await this.peerStore.patch(t,{publicKey:o}),o}async handle(t,n,i){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async s=>{await this.components.registrar.handle(s,n,i)}))}async unhandle(t){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async n=>{await this.components.registrar.unhandle(n)}))}async register(t,n){return this.components.registrar.register(t,n)}unregister(t){this.components.registrar.unregister(t)}async isDialable(t,n={}){return this.components.connectionManager.isDialable(t,n)}}h0=new WeakSet,BA=function(t){const{detail:n}=t;if(n.id.toString()===this.peerId.toString()){this.log.error("peer discovery mechanism discovered self");return}this.components.peerStore.merge(n.id,{multiaddrs:n.multiaddrs}).catch(i=>{this.log.error(i)})};async function ixe(r={}){r.privateKey??(r.privateKey=await dy("Ed25519"));const e=new nxe({...await x9e(r),peerId:Jse(r.privateKey)});return r.start!==!1&&await e.start(),e}async function sxe(r){const e=r.libp2p??{};e.privateKey==null&&r.datastore!=null&&(e.privateKey=await w9e(r.datastore,r.keychain));const t=m9e(e);return t.datastore=t.datastore??r.datastore,await ixe({...t,...e,start:!1})}async function WK(r={}){const e=r.datastore??new zR,t=r.blockstore??new Qge;let n;oxe(r.libp2p)?n=r.libp2p:n=await sxe({...r,libp2p:{dns:r.dns,...r.libp2p,start:void 0},datastore:e});const i=new e2e({...r,libp2p:n,datastore:e,blockstore:t,blockBrokers:r.blockBrokers??[_1e(),zde()],routers:r.routers??[fge(n),dge()],metrics:n.metrics});return r.start!==!1&&await i.start(),i}function oxe(r){return r==null?!1:["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"].every(t=>typeof r[t]=="function")}function GK(r){return r[Symbol.asyncIterator]!=null}const _4=r=>{const e=yt(r),t=In(e);return Sr(r,t),_4.bytes=e,t};_4.bytes=0;function EA(r,e){e=e??{};const t=e.lengthEncoder??_4;function*n(i){const s=t(i.byteLength);s instanceof Uint8Array?yield s:yield*s,i instanceof Uint8Array?yield i:yield*i}return GK(r)?async function*(){for await(const i of r)yield*n(i)}():function*(){for(const i of r)yield*n(i)}()}EA.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??_4;return new Be(t(r.byteLength),r)};class axe extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}}class cxe extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}}class lxe extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}}class QK extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}}const uxe=8,dxe=1024*1024*4;var xu;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(xu||(xu={}));const SA=r=>{const e=Zi(r);return SA.bytes=yt(e),e};SA.bytes=0;function xA(r,e){const t=new Be;let n=xu.LENGTH,i=-1;const s=(e==null?void 0:e.lengthDecoder)??SA,o=(e==null?void 0:e.maxLengthLength)??uxe,a=(e==null?void 0:e.maxDataLength)??dxe;function*c(){for(;t.byteLength>0;){if(n===xu.LENGTH)try{if(i=s(t),i<0)throw new axe("Invalid message length");if(i>a)throw new cxe("Message length too long");const l=s.bytes;t.consume(l),(e==null?void 0:e.onLength)!=null&&e.onLength(i),n=xu.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>o)throw new lxe("Message length length too long");break}throw l}if(n===xu.DATA){if(t.byteLength<i)break;const l=t.sublist(0,i);t.consume(i),(e==null?void 0:e.onData)!=null&&e.onData(l),yield l,n=xu.LENGTH}}}return GK(r)?async function*(){for await(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new QK("Unexpected end of input")}():function*(){for(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new QK("Unexpected end of input")}()}xA.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:s,value:o}=await r.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return xA(n,{...e??{},onLength:s=>{t=s}})};function hxe(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var fxe=JK,YK=128,pxe=-128,gxe=Math.pow(2,31);function JK(r,e,t){e=e||[],t=t||0;for(var n=t;r>=gxe;)e[t++]=r&255|YK,r/=128;for(;r&pxe;)e[t++]=r&255|YK,r>>>=7;return e[t]=r|0,JK.bytes=t-n+1,e}var yxe=AA,mxe=128,XK=127;function AA(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw AA.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&XK)<<i:(o&XK)*Math.pow(2,i),i+=7}while(o>=mxe);return AA.bytes=s-n,t}var wxe=Math.pow(2,7),bxe=Math.pow(2,14),vxe=Math.pow(2,21),Exe=Math.pow(2,28),Sxe=Math.pow(2,35),xxe=Math.pow(2,42),Axe=Math.pow(2,49),Cxe=Math.pow(2,56),Ixe=Math.pow(2,63),kxe=function(r){return r<wxe?1:r<bxe?2:r<vxe?3:r<Exe?4:r<Sxe?5:r<xxe?6:r<Axe?7:r<Cxe?8:r<Ixe?9:10},_xe={encode:fxe,decode:yxe,encodingLength:kxe},T4=_xe;function ZK(r,e=0){return[T4.decode(r,e),T4.decode.bytes]}function ej(r,e,t=0){return T4.encode(r,e,t),e}function tj(r){return T4.encodingLength(r)}function rj(r,e){const t=e.byteLength,n=tj(r),i=n+tj(t),s=new Uint8Array(i+t);return ej(r,s,0),ej(t,s,n),s.set(e,i),new ij(r,t,e,s)}function nj(r){const e=hxe(r),[t,n]=ZK(e),[i,s]=ZK(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new ij(t,i,o,e)}class ij{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}}const Bh=1e3,CA=60*Bh,sj="/floodsub/1.0.0",oj="/meshsub/1.0.0",Txe="/meshsub/1.1.0",IA="/meshsub/1.2.0",Pxe=6,Dxe=4,$xe=12,Nxe=4,Mxe=2,Oxe=5,Rxe=3,Lxe=6,Bxe=.25,Uxe=3,aj=100,Fxe=Bh,zxe=CA,Vxe=16,Kxe=CA,jxe=10*Bh,Hxe=15,qxe=300,Wxe=Bh,Gxe=60,Qxe=2,Yxe=10*Bh,Uh=5e3,Jxe=10,Xxe=3*Bh,Zxe=2*CA,eAe=120*1e3,tAe="ERR_TOPIC_VALIDATOR_REJECT",rAe="ERR_TOPIC_VALIDATOR_IGNORE",nAe=0,iAe=128,sAe=1e3,oAe=1e3,aAe=1,cAe=512,lAe=512,uAe={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxIdontwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};var Au;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.subscribe!=null&&(s.uint32(8),s.bool(i.subscribe)),i.topic!=null&&(s.uint32(18),s.string(i.topic)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.subscribe=i.bool();break}case 2:{a.topic=i.string();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)})(r.SubOpts||(r.SubOpts={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.from!=null&&(s.uint32(10),s.bytes(i.from)),i.data!=null&&(s.uint32(18),s.bytes(i.data)),i.seqno!=null&&(s.uint32(26),s.bytes(i.seqno)),i.topic!=null&&i.topic!==""&&(s.uint32(34),s.string(i.topic)),i.signature!=null&&(s.uint32(42),s.bytes(i.signature)),i.key!=null&&(s.uint32(50),s.bytes(i.key)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={topic:""},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.from=i.bytes();break}case 2:{a.data=i.bytes();break}case 3:{a.seqno=i.bytes();break}case 4:{a.topic=i.string();break}case 5:{a.signature=i.bytes();break}case 6:{a.key=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.Message||(r.Message={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.ihave!=null)for(const a of i.ihave)s.uint32(10),r.ControlIHave.codec().encode(a,s);if(i.iwant!=null)for(const a of i.iwant)s.uint32(18),r.ControlIWant.codec().encode(a,s);if(i.graft!=null)for(const a of i.graft)s.uint32(26),r.ControlGraft.codec().encode(a,s);if(i.prune!=null)for(const a of i.prune)s.uint32(34),r.ControlPrune.codec().encode(a,s);if(i.idontwant!=null)for(const a of i.idontwant)s.uint32(42),r.ControlIDontWant.codec().encode(a,s);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l,d,h,p,m,f,g,v,y,w;const a={ihave:[],iwant:[],graft:[],prune:[],idontwant:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const b=i.uint32();switch(b>>>3){case 1:{if(((l=o.limits)==null?void 0:l.ihave)!=null&&a.ihave.length===o.limits.ihave)throw new mt('Decode error - map field "ihave" had too many elements');a.ihave.push(r.ControlIHave.codec().decode(i,i.uint32(),{limits:(d=o.limits)==null?void 0:d.ihave$}));break}case 2:{if(((h=o.limits)==null?void 0:h.iwant)!=null&&a.iwant.length===o.limits.iwant)throw new mt('Decode error - map field "iwant" had too many elements');a.iwant.push(r.ControlIWant.codec().decode(i,i.uint32(),{limits:(p=o.limits)==null?void 0:p.iwant$}));break}case 3:{if(((m=o.limits)==null?void 0:m.graft)!=null&&a.graft.length===o.limits.graft)throw new mt('Decode error - map field "graft" had too many elements');a.graft.push(r.ControlGraft.codec().decode(i,i.uint32(),{limits:(f=o.limits)==null?void 0:f.graft$}));break}case 4:{if(((g=o.limits)==null?void 0:g.prune)!=null&&a.prune.length===o.limits.prune)throw new mt('Decode error - map field "prune" had too many elements');a.prune.push(r.ControlPrune.codec().decode(i,i.uint32(),{limits:(v=o.limits)==null?void 0:v.prune$}));break}case 5:{if(((y=o.limits)==null?void 0:y.idontwant)!=null&&a.idontwant.length===o.limits.idontwant)throw new mt('Decode error - map field "idontwant" had too many elements');a.idontwant.push(r.ControlIDontWant.codec().decode(i,i.uint32(),{limits:(w=o.limits)==null?void 0:w.idontwant$}));break}default:{i.skipType(b&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.ControlMessage||(r.ControlMessage={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.topicID!=null&&(s.uint32(10),s.string(i.topicID)),i.messageIDs!=null)for(const a of i.messageIDs)s.uint32(18),s.bytes(a);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={messageIDs:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:{a.topicID=i.string();break}case 2:{if(((l=o.limits)==null?void 0:l.messageIDs)!=null&&a.messageIDs.length===o.limits.messageIDs)throw new mt('Decode error - map field "messageIDs" had too many elements');a.messageIDs.push(i.bytes());break}default:{i.skipType(d&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.ControlIHave||(r.ControlIHave={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.messageIDs!=null)for(const a of i.messageIDs)s.uint32(10),s.bytes(a);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={messageIDs:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:{if(((l=o.limits)==null?void 0:l.messageIDs)!=null&&a.messageIDs.length===o.limits.messageIDs)throw new mt('Decode error - map field "messageIDs" had too many elements');a.messageIDs.push(i.bytes());break}default:{i.skipType(d&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.ControlIWant||(r.ControlIWant={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.topicID!=null&&(s.uint32(10),s.string(i.topicID)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.topicID=i.string();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.ControlGraft||(r.ControlGraft={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.topicID!=null&&(s.uint32(10),s.string(i.topicID)),i.peers!=null)for(const a of i.peers)s.uint32(18),r.PeerInfo.codec().encode(a,s);i.backoff!=null&&(s.uint32(24),s.uint64Number(i.backoff)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l,d;const a={peers:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const h=i.uint32();switch(h>>>3){case 1:{a.topicID=i.string();break}case 2:{if(((l=o.limits)==null?void 0:l.peers)!=null&&a.peers.length===o.limits.peers)throw new mt('Decode error - map field "peers" had too many elements');a.peers.push(r.PeerInfo.codec().decode(i,i.uint32(),{limits:(d=o.limits)==null?void 0:d.peers$}));break}case 3:{a.backoff=i.uint64Number();break}default:{i.skipType(h&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.ControlPrune||(r.ControlPrune={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.peerID!=null&&(s.uint32(10),s.bytes(i.peerID)),i.signedPeerRecord!=null&&(s.uint32(18),s.bytes(i.signedPeerRecord)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.peerID=i.bytes();break}case 2:{a.signedPeerRecord=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.PeerInfo||(r.PeerInfo={})),function(t){let n;t.codec=()=>(n==null&&(n=$e((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.messageIDs!=null)for(const a of i.messageIDs)s.uint32(10),s.bytes(a);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={messageIDs:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:{if(((l=o.limits)==null?void 0:l.messageIDs)!=null&&a.messageIDs.length===o.limits.messageIDs)throw new mt('Decode error - map field "messageIDs" had too many elements');a.messageIDs.push(i.bytes());break}default:{i.skipType(d&7);break}}}return a})),n),t.encode=i=>De(i,t.codec()),t.decode=(i,s)=>Pe(i,t.codec(),s)}(r.ControlIDontWant||(r.ControlIDontWant={}));let e;r.codec=()=>(e==null&&(e=$e((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.subscriptions!=null)for(const s of t.subscriptions)n.uint32(10),r.SubOpts.codec().encode(s,n);if(t.messages!=null)for(const s of t.messages)n.uint32(18),r.Message.codec().encode(s,n);t.control!=null&&(n.uint32(26),r.ControlMessage.codec().encode(t.control,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,d,h;const s={subscriptions:[],messages:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const p=t.uint32();switch(p>>>3){case 1:{if(((a=i.limits)==null?void 0:a.subscriptions)!=null&&s.subscriptions.length===i.limits.subscriptions)throw new mt('Decode error - map field "subscriptions" had too many elements');s.subscriptions.push(r.SubOpts.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.subscriptions$}));break}case 2:{if(((l=i.limits)==null?void 0:l.messages)!=null&&s.messages.length===i.limits.messages)throw new mt('Decode error - map field "messages" had too many elements');s.messages.push(r.Message.codec().decode(t,t.uint32(),{limits:(d=i.limits)==null?void 0:d.messages$}));break}case 3:{s.control=r.ControlMessage.codec().decode(t,t.uint32(),{limits:(h=i.limits)==null?void 0:h.control});break}default:{t.skipType(p&7);break}}}return s})),e),r.encode=t=>De(t,r.codec()),r.decode=(t,n)=>Pe(t,r.codec(),n)})(Au||(Au={}));class dAe{constructor(e,t,n){u(this,"gossip");u(this,"msgs",new Map);u(this,"msgIdToStrFn");u(this,"history",[]);u(this,"notValidatedCount",0);this.gossip=e,this.msgIdToStrFn=n;for(let i=0;i<t;i++)this.history[i]=[]}get size(){return this.msgs.size}put(e,t,n=!1){const{msgIdStr:i}=e;return this.msgs.has(i)?!1:(this.msgs.set(i,{message:t,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),n||this.notValidatedCount++,!0)}observeDuplicate(e,t){const n=this.msgs.get(e);n!=null&&!n.validated&&n.originatingPeers.add(t)}get(e){var t;return(t=this.msgs.get(this.msgIdToStrFn(e)))==null?void 0:t.message}getWithIWantCount(e,t){const n=this.msgs.get(e);if(n==null)return null;const i=(n.iwantCounts.get(t)??0)+1;return n.iwantCounts.set(t,i),{msg:n.message,count:i}}getGossipIDs(e){const t=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach(i=>{const s=this.msgs.get(i.msgIdStr);if(((s==null?void 0:s.validated)??!1)&&e.has(i.topic)){let o=t.get(i.topic);o==null&&(o=[],t.set(i.topic,o)),o.push(i.msgId)}});return t}validate(e){const t=this.msgs.get(e);if(t==null)return null;t.validated||this.notValidatedCount--;const{message:n,originatingPeers:i}=t;return t.validated=!0,t.originatingPeers=new Set,{message:n,originatingPeers:i}}shift(){this.history[this.history.length-1].forEach(t=>{const n=this.msgs.get(t.msgIdStr);n!=null&&(this.msgs.delete(t.msgIdStr),n.validated||this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(e){const t=this.msgs.get(e);return t==null?null:(this.msgs.delete(e),t)}}var cj;(function(r){r.StrictSign="StrictSign",r.StrictNoSign="StrictNoSign"})(cj||(cj={}));var Fh;(function(r){r[r.Signing=0]="Signing",r[r.Anonymous=1]="Anonymous"})(Fh||(Fh={}));var ms;(function(r){r.Error="error",r.Ignore="ignore",r.Reject="reject",r.Blacklisted="blacklisted"})(ms||(ms={}));var Ln;(function(r){r.InvalidSignature="invalid_signature",r.InvalidSeqno="invalid_seqno",r.InvalidPeerId="invalid_peerid",r.SignaturePresent="signature_present",r.SeqnoPresent="seqno_present",r.FromPresent="from_present",r.TransformFailed="transform_failed"})(Ln||(Ln={}));var Bn;(function(r){r.duplicate="duplicate",r.invalid="invalid",r.valid="valid"})(Bn||(Bn={}));function lj(r){switch(r){case Ii.Ignore:return ms.Ignore;case Ii.Reject:return ms.Reject;default:throw new Error("Unreachable")}}var uj;(function(r){r.forward="forward",r.publish="publish"})(uj||(uj={}));var Un;(function(r){r.Fanout="fanout",r.Random="random",r.Subscribed="subscribed",r.Outbound="outbound",r.NotEnough="not_enough",r.Opportunistic="opportunistic"})(Un||(Un={}));var Js;(function(r){r.Dc="disconnected",r.BadScore="bad_score",r.Prune="prune",r.Excess="excess"})(Js||(Js={}));var i0;(function(r){r.GraftBackoff="graft_backoff",r.BrokenPromise="broken_promise",r.MessageDeficit="message_deficit",r.IPColocation="IP_colocation"})(i0||(i0={}));var s0;(function(r){r.LowScore="low_score",r.MaxIhave="max_ihave",r.MaxIasked="max_iasked"})(s0||(s0={}));var zh;(function(r){r.graylist="graylist",r.publish="publish",r.gossip="gossip",r.mesh="mesh"})(zh||(zh={}));function hAe(r,e,t){return{protocolsEnabled:r.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:r.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:r.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:r.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEventsFanout:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_fanout_total",help:"Number of times we include peers in a topic mesh for fanout reasons",labelNames:["topic"]}),meshPeerInclusionEventsRandom:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_random_total",help:"Number of times we include peers in a topic mesh for random reasons",labelNames:["topic"]}),meshPeerInclusionEventsSubscribed:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_subscribed_total",help:"Number of times we include peers in a topic mesh for subscribed reasons",labelNames:["topic"]}),meshPeerInclusionEventsOutbound:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_outbound_total",help:"Number of times we include peers in a topic mesh for outbound reasons",labelNames:["topic"]}),meshPeerInclusionEventsNotEnough:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_not_enough_total",help:"Number of times we include peers in a topic mesh for not_enough reasons",labelNames:["topic"]}),meshPeerInclusionEventsOpportunistic:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_opportunistic_total",help:"Number of times we include peers in a topic mesh for opportunistic reasons",labelNames:["topic"]}),meshPeerInclusionEventsUnknown:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_unknown_total",help:"Number of times we include peers in a topic mesh for unknown reasons",labelNames:["topic"]}),meshPeerChurnEventsDisconnected:r.gauge({name:"gossipsub_peer_churn_events_disconnected_total",help:"Number of times we remove peers in a topic mesh for disconnected reasons",labelNames:["topic"]}),meshPeerChurnEventsBadScore:r.gauge({name:"gossipsub_peer_churn_events_bad_score_total",help:"Number of times we remove peers in a topic mesh for bad_score reasons",labelNames:["topic"]}),meshPeerChurnEventsPrune:r.gauge({name:"gossipsub_peer_churn_events_prune_total",help:"Number of times we remove peers in a topic mesh for prune reasons",labelNames:["topic"]}),meshPeerChurnEventsExcess:r.gauge({name:"gossipsub_peer_churn_events_excess_total",help:"Number of times we remove peers in a topic mesh for excess reasons",labelNames:["topic"]}),meshPeerChurnEventsUnknown:r.gauge({name:"gossipsub_peer_churn_events_unknown_total",help:"Number of times we remove peers in a topic mesh for unknown reasons",labelNames:["topic"]}),peersPerProtocol:r.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:r.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:r.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),acceptedMessagesTotal:r.gauge({name:"gossipsub_accepted_messages_total",help:"Total accepted messages for each topic",labelNames:["topic"]}),ignoredMessagesTotal:r.gauge({name:"gossipsub_ignored_messages_total",help:"Total ignored messages for each topic",labelNames:["topic"]}),rejectedMessagesTotal:r.gauge({name:"gossipsub_rejected_messages_total",help:"Total rejected messages for each topic",labelNames:["topic"]}),unknownValidationResultsTotal:r.gauge({name:"gossipsub_unknown_validation_results_total",help:"Total unknown validation results for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:r.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),asyncValidationDelayFromFirstSeenSec:r.histogram({name:"gossipsub_async_validation_delay_from_first_seen",help:"Async validation report delay from first seen in second",buckets:[.01,.03,.1,.3,1,3,10]}),asyncValidationUnknownFirstSeen:r.gauge({name:"gossipsub_async_validation_unknown_first_seen_count_total",help:"Async validation report unknown first seen value for message"}),peerReadStreamError:r.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:r.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:r.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:r.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:r.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:r.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:r.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:r.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:r.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:r.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:r.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:r.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:r.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:r.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:r.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:r.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:r.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:r.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:r.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:r.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:r.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:r.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),rpcSentIDontWant:r.gauge({name:"gossipsub_rpc_sent_idontwant_total",help:"RPC sent"}),msgPublishCount:r.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:r.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),directPeersPublishedTotal:r.gauge({name:"gossipsub_direct_peers_published_total",help:"Total direct peers that we publish a msg to",labelNames:["topic"]}),floodsubPeersPublishedTotal:r.gauge({name:"gossipsub_floodsub_peers_published_total",help:"Total floodsub peers that we publish a msg to",labelNames:["topic"]}),meshPeersPublishedTotal:r.gauge({name:"gossipsub_mesh_peers_published_total",help:"Total mesh peers that we publish a msg to",labelNames:["topic"]}),fanoutPeersPublishedTotal:r.gauge({name:"gossipsub_fanout_peers_published_total",help:"Total fanout peers that we publish a msg to",labelNames:["topic"]}),msgPublishBytes:r.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgPublishTime:r.histogram({name:"gossipsub_msg_publish_seconds",help:"Total time in seconds to publish a message",buckets:[.001,.002,.005,.01,.1,.5,1],labelNames:["topic"]}),msgForwardCount:r.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:r.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:r.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:r.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),prevalidationInvalidTotal:r.gauge({name:"gossipsub_pre_validation_invalid_total",help:"Total count of invalid messages received",labelNames:["topic"]}),prevalidationValidTotal:r.gauge({name:"gossipsub_pre_validation_valid_total",help:"Total count of valid messages received",labelNames:["topic"]}),prevalidationDuplicateTotal:r.gauge({name:"gossipsub_pre_validation_duplicate_total",help:"Total count of duplicate messages received",labelNames:["topic"]}),prevalidationUnknownTotal:r.gauge({name:"gossipsub_pre_validation_unknown_status_total",help:"Total count of unknown_status messages received",labelNames:["topic"]}),msgReceivedInvalid:r.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:r.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:r.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*t.maxMeshMessageDeliveriesWindowSec,.5*t.maxMeshMessageDeliveriesWindowSec,Number(t.maxMeshMessageDeliveriesWindowSec),2*t.maxMeshMessageDeliveriesWindowSec,4*t.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:r.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:r.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:r.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:r.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:r.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:r.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:r.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:r.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:r.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:r.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:r.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*t.behaviourPenaltyThreshold,.5*t.behaviourPenaltyThreshold,Number(t.behaviourPenaltyThreshold),2*t.behaviourPenaltyThreshold,4*t.behaviourPenaltyThreshold]}),ihaveRcvIgnored:r.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:r.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:r.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:r.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:r.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),idontwantRcvMsgids:r.gauge({name:"gossipsub_idontwant_rcv_msgids_total",help:"Total received IDONTWANT messages"}),idontwantRcvDonthaveMsgids:r.gauge({name:"gossipsub_idontwant_rcv_dont_have_msgids_total",help:"Total received IDONTWANT messageIDs that we do not have in mcache"}),iwantPromiseStarted:r.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:r.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:r.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:r.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:r.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:r.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:r.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*t.gossipPromiseExpireSec,Number(t.gossipPromiseExpireSec),2*t.gossipPromiseExpireSec,4*t.gossipPromiseExpireSec]}),iwantPromiseUntracked:r.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),connectedPeersBackoffSec:r.histogram({name:"gossipsub_connected_peers_backoff_seconds",help:"Backoff time in seconds",buckets:[1,2,4,10,20,60,120]}),cacheSize:r.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:r.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:r.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:r.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:r.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:e,toTopic(n){return this.topicStrToLabel.get(n)??n},onJoin(n){this.topicSubscriptionStatus.set({topicStr:n},1),this.meshPeerCounts.set({topicStr:n},0)},onLeave(n){this.topicSubscriptionStatus.set({topicStr:n},0),this.meshPeerCounts.set({topicStr:n},0)},onAddToMesh(n,i,s){const o=this.toTopic(n);switch(i){case Un.Fanout:this.meshPeerInclusionEventsFanout.inc({topic:o},s);break;case Un.Random:this.meshPeerInclusionEventsRandom.inc({topic:o},s);break;case Un.Subscribed:this.meshPeerInclusionEventsSubscribed.inc({topic:o},s);break;case Un.Outbound:this.meshPeerInclusionEventsOutbound.inc({topic:o},s);break;case Un.NotEnough:this.meshPeerInclusionEventsNotEnough.inc({topic:o},s);break;case Un.Opportunistic:this.meshPeerInclusionEventsOpportunistic.inc({topic:o},s);break;default:this.meshPeerInclusionEventsUnknown.inc({topic:o},s);break}},onRemoveFromMesh(n,i,s){const o=this.toTopic(n);switch(i){case Js.Dc:this.meshPeerChurnEventsDisconnected.inc({topic:o},s);break;case Js.BadScore:this.meshPeerChurnEventsBadScore.inc({topic:o},s);break;case Js.Prune:this.meshPeerChurnEventsPrune.inc({topic:o},s);break;case Js.Excess:this.meshPeerChurnEventsExcess.inc({topic:o},s);break;default:this.meshPeerChurnEventsUnknown.inc({topic:o},s);break}},onReportValidation(n,i,s){if(this.asyncValidationMcacheHit.inc({hit:n!=null?"hit":"miss"}),n!=null){const o=this.toTopic(n.message.topic);switch(i){case Ii.Accept:this.acceptedMessagesTotal.inc({topic:o});break;case Ii.Ignore:this.ignoredMessagesTotal.inc({topic:o});break;case Ii.Reject:this.rejectedMessagesTotal.inc({topic:o});break;default:this.unknownValidationResultsTotal.inc({topic:o});break}}s!=null?this.asyncValidationDelayFromFirstSeenSec.observe((Date.now()-s)/1e3):this.asyncValidationUnknownFirstSeen.inc()},onScorePenalty(n){this.scoringPenalties.inc({penalty:n},1)},onIhaveRcv(n,i,s){const o=this.toTopic(n);this.ihaveRcvMsgids.inc({topic:o},i),this.ihaveRcvNotSeenMsgids.inc({topic:o},s)},onIwantRcv(n,i){for(const[s,o]of n){const a=this.toTopic(s);this.iwantRcvMsgids.inc({topic:a},o)}this.iwantRcvDonthaveMsgids.inc(i)},onIdontwantRcv(n,i){this.idontwantRcvMsgids.inc(n),this.idontwantRcvDonthaveMsgids.inc(i)},onForwardMsg(n,i){const s=this.toTopic(n);this.msgForwardCount.inc({topic:s},1),this.msgForwardPeers.inc({topic:s},i)},onPublishMsg(n,i,s,o,a){const c=this.toTopic(n);this.msgPublishCount.inc({topic:c},1),this.msgPublishBytes.inc({topic:c},s*o),this.msgPublishPeersByTopic.inc({topic:c},s),this.directPeersPublishedTotal.inc({topic:c},i.direct),this.floodsubPeersPublishedTotal.inc({topic:c},i.floodsub),this.meshPeersPublishedTotal.inc({topic:c},i.mesh),this.fanoutPeersPublishedTotal.inc({topic:c},i.fanout),this.msgPublishTime.observe({topic:c},a/1e3)},onMsgRecvPreValidation(n){const i=this.toTopic(n);this.msgReceivedPreValidation.inc({topic:i},1)},onMsgRecvError(n){const i=this.toTopic(n);this.msgReceivedError.inc({topic:i},1)},onPrevalidationResult(n,i){const s=this.toTopic(n);switch(i){case Bn.duplicate:this.prevalidationDuplicateTotal.inc({topic:s});break;case Bn.invalid:this.prevalidationInvalidTotal.inc({topic:s});break;case Bn.valid:this.prevalidationValidTotal.inc({topic:s});break;default:this.prevalidationUnknownTotal.inc({topic:s});break}},onMsgRecvInvalid(n,i){const s=this.toTopic(n),o=i.reason===ms.Error?i.error:i.reason;this.msgReceivedInvalid.inc({error:o},1),this.msgReceivedInvalidByTopic.inc({topic:s},1)},onDuplicateMsgDelivery(n,i,s){const o=this.toTopic(n);this.duplicateMsgDeliveryDelay.observe({topic:o},i/1e3),s&&this.duplicateMsgLateDelivery.inc({topic:o},1)},onPublishDuplicateMsg(n){const i=this.toTopic(n);this.duplicateMsgIgnored.inc({topic:i},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(n,i){this.rpcRecvBytes.inc(i),this.rpcRecvCount.inc(1),n.subscriptions!=null&&this.rpcRecvSubscription.inc(n.subscriptions.length),n.messages!=null&&this.rpcRecvMessage.inc(n.messages.length),n.control!=null&&(this.rpcRecvControl.inc(1),n.control.ihave!=null&&this.rpcRecvIHave.inc(n.control.ihave.length),n.control.iwant!=null&&this.rpcRecvIWant.inc(n.control.iwant.length),n.control.graft!=null&&this.rpcRecvGraft.inc(n.control.graft.length),n.control.prune!=null&&this.rpcRecvPrune.inc(n.control.prune.length))},onRpcSent(n,i){var s,o,a,c,l;if(this.rpcSentBytes.inc(i),this.rpcSentCount.inc(1),n.subscriptions!=null&&this.rpcSentSubscription.inc(n.subscriptions.length),n.messages!=null&&this.rpcSentMessage.inc(n.messages.length),n.control!=null){const d=((s=n.control.ihave)==null?void 0:s.length)??0,h=((o=n.control.iwant)==null?void 0:o.length)??0,p=((a=n.control.graft)==null?void 0:a.length)??0,m=((c=n.control.prune)==null?void 0:c.length)??0,f=((l=n.control.idontwant)==null?void 0:l.length)??0;d>0&&this.rpcSentIHave.inc(d),h>0&&this.rpcSentIWant.inc(h),p>0&&this.rpcSentGraft.inc(p),m>0&&this.rpcSentPrune.inc(m),f>0&&this.rpcSentIDontWant.inc(f),(d>0||h>0||p>0||m>0||f>0)&&this.rpcSentControl.inc(1)}},registerScores(n,i){let s=0,o=0,a=0,c=0;for(const l of n)l>=i.graylistThreshold&&s++,l>=i.publishThreshold&&o++,l>=i.gossipThreshold&&a++,l>=0&&c++;this.peersByScoreThreshold.set({threshold:zh.graylist},s),this.peersByScoreThreshold.set({threshold:zh.publish},o),this.peersByScoreThreshold.set({threshold:zh.gossip},a),this.peersByScoreThreshold.set({threshold:zh.mesh},c),this.score.set(n)},registerScoreWeights(n){for(const[i,s]of n.byTopic)this.scoreWeights.set({topic:i,p:"p1"},s.p1w),this.scoreWeights.set({topic:i,p:"p2"},s.p2w),this.scoreWeights.set({topic:i,p:"p3"},s.p3w),this.scoreWeights.set({topic:i,p:"p3b"},s.p3bw),this.scoreWeights.set({topic:i,p:"p4"},s.p4w);this.scoreWeights.set({p:"p5"},n.p5w),this.scoreWeights.set({p:"p6"},n.p6w),this.scoreWeights.set({p:"p7"},n.p7w)},registerScorePerMesh(n,i){const s=new Map;n.forEach((o,a)=>{const c=this.topicStrToLabel.get(a)??"unknown";let l=s.get(c);l==null&&(l=new Set,s.set(c,l)),o.forEach(d=>l==null?void 0:l.add(d))});for(const[o,a]of s){const c=[];a.forEach(l=>{c.push(i.get(l)??0)}),this.scorePerMesh.set({topic:o},c)}}}}class bt extends Error{constructor(e="Invalid peer score params"){super(e),this.name="InvalidPeerScoreParamsError"}}u(bt,"name","InvalidPeerScoreParamsError");const fAe={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},pAe={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function gAe(r={}){return{...fAe,...r,topics:r.topics!=null?Object.entries(r.topics).reduce((e,[t,n])=>(e[t]=yAe(n),e),{}):{}}}function yAe(r={}){return{...pAe,...r}}function mAe(r){for(const[e,t]of Object.entries(r.topics))try{wAe(t)}catch(n){throw new bt(`invalid score parameters for topic ${e}: ${n.message}`)}if(r.topicScoreCap<0)throw new bt("invalid topic score cap; must be positive (or 0 for no cap)");if(r.appSpecificScore===null||r.appSpecificScore===void 0)throw new bt("missing application specific score function");if(r.IPColocationFactorWeight>0)throw new bt("invalid IPColocationFactorWeight; must be negative (or 0 to disable)");if(r.IPColocationFactorWeight!==0&&r.IPColocationFactorThreshold<1)throw new bt("invalid IPColocationFactorThreshold; must be at least 1");if(r.behaviourPenaltyWeight>0)throw new bt("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)");if(r.behaviourPenaltyWeight!==0&&(r.behaviourPenaltyDecay<=0||r.behaviourPenaltyDecay>=1))throw new bt("invalid BehaviourPenaltyDecay; must be between 0 and 1");if(r.decayInterval<1e3)throw new bt("invalid DecayInterval; must be at least 1s");if(r.decayToZero<=0||r.decayToZero>=1)throw new bt("invalid DecayToZero; must be between 0 and 1")}function wAe(r){if(r.topicWeight<0)throw new bt("invalid topic weight; must be >= 0");if(r.timeInMeshQuantum===0)throw new bt("invalid TimeInMeshQuantum; must be non zero");if(r.timeInMeshWeight<0)throw new bt("invalid TimeInMeshWeight; must be positive (or 0 to disable)");if(r.timeInMeshWeight!==0&&r.timeInMeshQuantum<=0)throw new bt("invalid TimeInMeshQuantum; must be positive");if(r.timeInMeshWeight!==0&&r.timeInMeshCap<=0)throw new bt("invalid TimeInMeshCap; must be positive");if(r.firstMessageDeliveriesWeight<0)throw new bt("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)");if(r.firstMessageDeliveriesWeight!==0&&(r.firstMessageDeliveriesDecay<=0||r.firstMessageDeliveriesDecay>=1))throw new bt("invalid FirstMessageDeliveriesDecay; must be between 0 and 1");if(r.firstMessageDeliveriesWeight!==0&&r.firstMessageDeliveriesCap<=0)throw new bt("invalid FirstMessageDeliveriesCap; must be positive");if(r.meshMessageDeliveriesWeight>0)throw new bt("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)");if(r.meshMessageDeliveriesWeight!==0&&(r.meshMessageDeliveriesDecay<=0||r.meshMessageDeliveriesDecay>=1))throw new bt("invalid MeshMessageDeliveriesDecay; must be between 0 and 1");if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesCap<=0)throw new bt("invalid MeshMessageDeliveriesCap; must be positive");if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesThreshold<=0)throw new bt("invalid MeshMessageDeliveriesThreshold; must be positive");if(r.meshMessageDeliveriesWindow<0)throw new bt("invalid MeshMessageDeliveriesWindow; must be non-negative");if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesActivation<1e3)throw new bt("invalid MeshMessageDeliveriesActivation; must be at least 1s");if(r.meshFailurePenaltyWeight>0)throw new bt("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)");if(r.meshFailurePenaltyWeight!==0&&(r.meshFailurePenaltyDecay<=0||r.meshFailurePenaltyDecay>=1))throw new bt("invalid MeshFailurePenaltyDecay; must be between 0 and 1");if(r.invalidMessageDeliveriesWeight>0)throw new bt("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)");if(r.invalidMessageDeliveriesDecay<=0||r.invalidMessageDeliveriesDecay>=1)throw new bt("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1")}const bAe={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function vAe(r={}){return{...bAe,...r}}function kA(r,e,t=()=>!0){const n=new Set;if(e<=0)return n;for(const i of r){if(n.size>=e)break;t(i)&&(n.add(i),r.delete(i))}return n}function EAe(r,e){return kA(r,e,()=>!0)}class SAe extends Map{constructor(t){super();u(this,"getDefault");this.getDefault=t}getOrDefault(t){let n=super.get(t);return n===void 0&&(n=this.getDefault(),this.set(t,n)),n}}function xAe(r,e,t,n){let i=0;Object.entries(e.topics).forEach(([o,a])=>{const c=t.topics[o];if(c===void 0)return;let l=0;if(a.inMesh){let m=a.meshTime/c.timeInMeshQuantum;m>c.timeInMeshCap&&(m=c.timeInMeshCap),l+=m*c.timeInMeshWeight}let d=a.firstMessageDeliveries;if(d>c.firstMessageDeliveriesCap&&(d=c.firstMessageDeliveriesCap),l+=d*c.firstMessageDeliveriesWeight,a.meshMessageDeliveriesActive&&a.meshMessageDeliveries<c.meshMessageDeliveriesThreshold){const m=c.meshMessageDeliveriesThreshold-a.meshMessageDeliveries,f=m*m;l+=f*c.meshMessageDeliveriesWeight}const h=a.meshFailurePenalty;l+=h*c.meshFailurePenaltyWeight;const p=a.invalidMessageDeliveries*a.invalidMessageDeliveries;l+=p*c.invalidMessageDeliveriesWeight,i+=l*c.topicWeight}),t.topicScoreCap>0&&i>t.topicScoreCap&&(i=t.topicScoreCap);const s=t.appSpecificScore(r);if(i+=s*t.appSpecificWeight,e.knownIPs.forEach(o=>{if(t.IPColocationFactorWhitelist.has(o))return;const a=n.get(o),c=a!=null?a.size:0;if(c>t.IPColocationFactorThreshold){const l=c-t.IPColocationFactorThreshold,d=l*l;i+=d*t.IPColocationFactorWeight}}),e.behaviourPenalty>t.behaviourPenaltyThreshold){const o=e.behaviourPenalty-t.behaviourPenaltyThreshold,a=o*o;i+=a*t.behaviourPenaltyWeight}return i}function Kt(r,t){var t=t||{};this._capacity=t.capacity,this._head=0,this._tail=0,Array.isArray(r)?this._fromArray(r):(this._capacityMask=3,this._list=new Array(4))}Kt.prototype.peekAt=function(e){var t=e;if(t===(t|0)){var n=this.size();if(!(t>=n||t<-n))return t<0&&(t+=n),t=this._head+t&this._capacityMask,this._list[t]}},Kt.prototype.get=function(e){return this.peekAt(e)},Kt.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},Kt.prototype.peekFront=function(){return this.peek()},Kt.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(Kt.prototype,"length",{get:function(){return this.size()}}),Kt.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},Kt.prototype.unshift=function(e){if(arguments.length===0)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},Kt.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}},Kt.prototype.push=function(e){if(arguments.length===0)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},Kt.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),n}},Kt.prototype.removeOne=function(e){var t=e;if(t===(t|0)&&this._head!==this._tail){var n=this.size(),i=this._list.length;if(!(t>=n||t<-n)){t<0&&(t+=n),t=this._head+t&this._capacityMask;var s=this._list[t],o;if(e<n/2){for(o=e;o>0;o--)this._list[t]=this._list[t=t-1+i&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(o=n-1-e;o>0;o--)this._list[t]=this._list[t=t+1+i&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+i&this._capacityMask}return s}}},Kt.prototype.remove=function(e,t){var n=e,i,s=t;if(n===(n|0)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(n>=o||n<-o||t<1)){if(n<0&&(n+=o),t===1||!t)return i=new Array(1),i[0]=this.removeOne(n),i;if(n===0&&n+t>=o)return i=this.toArray(),this.clear(),i;n+t>o&&(t=o-n);var c;for(i=new Array(t),c=0;c<t;c++)i[c]=this._list[this._head+n+c&this._capacityMask];if(n=this._head+n&this._capacityMask,e+t===o){for(this._tail=this._tail-t+a&this._capacityMask,c=t;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(e===0){for(this._head=this._head+t+a&this._capacityMask,c=t-1;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(n<o/2){for(this._head=this._head+e+t+a&this._capacityMask,c=e;c>0;c--)this.unshift(this._list[n=n-1+a&this._capacityMask]);for(n=this._head-1+a&this._capacityMask;s>0;)this._list[n=n-1+a&this._capacityMask]=void 0,s--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+t+a&this._capacityMask,c=o-(t+e);c>0;c--)this.push(this._list[n++]);for(n=this._tail;s>0;)this._list[n=n+1+a&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),i}}},Kt.prototype.splice=function(e,t){var n=e;if(n===(n|0)){var i=this.size();if(n<0&&(n+=i),!(n>i))if(arguments.length>2){var s,o,a,c=arguments.length,l=this._list.length,d=2;if(!i||n<i/2){for(o=new Array(n),s=0;s<n;s++)o[s]=this._list[this._head+s&this._capacityMask];for(t===0?(a=[],n>0&&(this._head=this._head+n+l&this._capacityMask)):(a=this.remove(n,t),this._head=this._head+n+l&this._capacityMask);c>d;)this.unshift(arguments[--c]);for(s=n;s>0;s--)this.unshift(o[s-1])}else{o=new Array(i-(n+t));var h=o.length;for(s=0;s<h;s++)o[s]=this._list[this._head+n+t+s&this._capacityMask];for(t===0?(a=[],n!=i&&(this._tail=this._head+n+l&this._capacityMask)):(a=this.remove(n,t),this._tail=this._tail-h+l&this._capacityMask);d<c;)this.push(arguments[d++]);for(s=0;s<h;s++)this.push(o[s])}return a}else return this.remove(n,t)}},Kt.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0},Kt.prototype.isEmpty=function(){return this._head===this._tail},Kt.prototype.toArray=function(){return this._copyArray(!1)},Kt.prototype._fromArray=function(e){var t=e.length,n=this._nextPowerOf2(t);this._list=new Array(n),this._capacityMask=n-1,this._tail=t;for(var i=0;i<t;i++)this._list[i]=e[i]},Kt.prototype._copyArray=function(e,t){var n=this._list,i=n.length,s=this.length;if(t=t|s,t==s&&this._head<this._tail)return this._list.slice(this._head,this._tail);var o=new Array(t),a=0,c;if(e||this._head>this._tail){for(c=this._head;c<i;c++)o[a++]=n[c];for(c=0;c<this._tail;c++)o[a++]=n[c]}else for(c=this._head;c<this._tail;c++)o[a++]=n[c];return o},Kt.prototype._growArray=function(){if(this._head!=0){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1},Kt.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},Kt.prototype._nextPowerOf2=function(e){var t=Math.log(e)/Math.log(2),n=1<<t+1;return Math.max(n,4)};var AAe=Kt;const CAe=Ze(AAe);var Fn;(function(r){r[r.unknown=0]="unknown",r[r.valid=1]="valid",r[r.invalid=2]="invalid",r[r.ignored=3]="ignored"})(Fn||(Fn={}));class IAe{constructor(){u(this,"records");u(this,"queue");this.records=new Map,this.queue=new CAe}getRecord(e){return this.records.get(e)}ensureRecord(e){let t=this.records.get(e);if(t!=null)return t;t={status:Fn.unknown,firstSeenTsMs:Date.now(),validated:0,peers:new Set},this.records.set(e,t);const n={msgId:e,expire:Date.now()+eAe};return this.queue.push(n),t}gc(){const e=Date.now();let t=this.queue.peekFront();for(;t!=null&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}class kAe{constructor(e,t,n,i){u(this,"params");u(this,"metrics");u(this,"peerStats",new Map);u(this,"peerIPs",new SAe(()=>new Set));u(this,"scoreCache",new Map);u(this,"deliveryRecords",new IAe);u(this,"_backgroundInterval");u(this,"scoreCacheValidityMs");u(this,"computeScore");u(this,"log");this.params=e,this.metrics=t,mAe(e),this.scoreCacheValidityMs=i.scoreCacheValidityMs,this.computeScore=i.computeScore??xAe,this.log=n.forComponent("libp2p:gossipsub:score")}get size(){return this.peerStats.size}start(){if(this._backgroundInterval!=null){this.log("Peer score already running");return}this._backgroundInterval=setInterval(()=>{this.background()},this.params.decayInterval),this.log("started")}stop(){if(this._backgroundInterval==null){this.log("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),this.log("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,t])=>[e,t]))}messageFirstSeenTimestampMs(e){const t=this.deliveryRecords.getRecord(e);return t!=null?t.firstSeenTsMs:null}refreshScores(){const e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach((n,i)=>{if(!n.connected){e>n.expire&&(this.removeIPsForPeer(i,n.knownIPs),this.peerStats.delete(i),this.scoreCache.delete(i));return}Object.entries(n.topics).forEach(([s,o])=>{const a=this.params.topics[s];a!==void 0&&(o.firstMessageDeliveries*=a.firstMessageDeliveriesDecay,o.firstMessageDeliveries<t&&(o.firstMessageDeliveries=0),o.meshMessageDeliveries*=a.meshMessageDeliveriesDecay,o.meshMessageDeliveries<t&&(o.meshMessageDeliveries=0),o.meshFailurePenalty*=a.meshFailurePenaltyDecay,o.meshFailurePenalty<t&&(o.meshFailurePenalty=0),o.invalidMessageDeliveries*=a.invalidMessageDeliveriesDecay,o.invalidMessageDeliveries<t&&(o.invalidMessageDeliveries=0),o.inMesh&&(o.meshTime=e-o.graftTime,o.meshTime>a.meshMessageDeliveriesActivation&&(o.meshMessageDeliveriesActive=!0)))}),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<t&&(n.behaviourPenalty=0)})}score(e){var a,c,l;(a=this.metrics)==null||a.scoreFnCalls.inc();const t=this.peerStats.get(e);if(t==null)return 0;const n=Date.now(),i=this.scoreCache.get(e);if(i!=null&&i.cacheUntil>n)return i.score;(c=this.metrics)==null||c.scoreFnRuns.inc();const s=this.computeScore(e,t,this.params,this.peerIPs),o=n+this.scoreCacheValidityMs;return i!=null?((l=this.metrics)==null||l.scoreCachedDelta.observe(Math.abs(s-i.score)),i.score=s,i.cacheUntil=o):this.scoreCache.set(e,{score:s,cacheUntil:o}),s}addPenalty(e,t,n){var s;const i=this.peerStats.get(e);i!=null&&(i.behaviourPenalty+=t,(s=this.metrics)==null||s.onScorePenalty(n))}addPeer(e){const t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){const n=this.peerStats.get(e);n!=null&&n.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){const n=this.peerStats.get(e);n!=null&&n.knownIPs.delete(t);const i=this.peerIPs.get(t);i!=null&&(i.delete(e),i.size===0&&this.peerIPs.delete(t))}removePeer(e){const t=this.peerStats.get(e);if(t!=null){if(this.score(e)>0){this.removeIPsForPeer(e,t.knownIPs),this.peerStats.delete(e);return}Object.entries(t.topics).forEach(([n,i])=>{i.firstMessageDeliveries=0;const s=this.params.topics[n].meshMessageDeliveriesThreshold;if(i.inMesh&&i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<s){const o=s-i.meshMessageDeliveries;i.meshFailurePenalty+=o*o}i.inMesh=!1,i.meshMessageDeliveriesActive=!1}),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){const n=this.peerStats.get(e);if(n!=null){const i=this.getPtopicStats(n,t);i!=null&&(i.inMesh=!0,i.graftTime=Date.now(),i.meshTime=0,i.meshMessageDeliveriesActive=!1)}}prune(e,t){const n=this.peerStats.get(e);if(n!=null){const i=this.getPtopicStats(n,t);if(i!=null){const s=this.params.topics[t].meshMessageDeliveriesThreshold;if(i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<s){const o=s-i.meshMessageDeliveries;i.meshFailurePenalty+=o*o}i.meshMessageDeliveriesActive=!1,i.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,n){this.markFirstMessageDelivery(e,n);const i=this.deliveryRecords.ensureRecord(t),s=Date.now();if(i.status!==Fn.unknown){this.log("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,s-i.firstSeenTsMs,Fn[i.status]);return}i.status=Fn.valid,i.validated=s,i.peers.forEach(o=>{o!==e.toString()&&this.markDuplicateMessageDelivery(o,n)})}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,n,i){switch(i){case ms.Error:this.markInvalidMessageDelivery(e,n);return;case ms.Blacklisted:return}const s=this.deliveryRecords.ensureRecord(t);if(s.status!==Fn.unknown){this.log("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-s.firstSeenTsMs,Fn[s.status]);return}if(i===ms.Ignore){s.status=Fn.ignored,s.peers.clear();return}s.status=Fn.invalid,this.markInvalidMessageDelivery(e,n),s.peers.forEach(o=>{this.markInvalidMessageDelivery(o,n)}),s.peers.clear()}duplicateMessage(e,t,n){const i=this.deliveryRecords.ensureRecord(t);if(!i.peers.has(e))switch(i.status){case Fn.unknown:i.peers.add(e);break;case Fn.valid:i.peers.add(e),this.markDuplicateMessageDelivery(e,n,i.validated);break;case Fn.invalid:this.markInvalidMessageDelivery(e,n);break;case Fn.ignored:break}}markInvalidMessageDelivery(e,t){const n=this.peerStats.get(e);if(n!=null){const i=this.getPtopicStats(n,t);i!=null&&(i.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){const n=this.peerStats.get(e);if(n!=null){const i=this.getPtopicStats(n,t);if(i!=null){let s=this.params.topics[t].firstMessageDeliveriesCap;i.firstMessageDeliveries=Math.min(s,i.firstMessageDeliveries+1),i.inMesh&&(s=this.params.topics[t].meshMessageDeliveriesCap,i.meshMessageDeliveries=Math.min(s,i.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,n){var s;const i=this.peerStats.get(e);if(i!=null){const o=n!==void 0?Date.now():0,a=this.getPtopicStats(i,t);if(a!=null&&a.inMesh){const c=this.params.topics[t];if(n!==void 0){const d=o-n,h=d>c.meshMessageDeliveriesWindow;if((s=this.metrics)==null||s.onDuplicateMsgDelivery(t,d,h),h)return}const l=c.meshMessageDeliveriesCap;a.meshMessageDeliveries=Math.min(l,a.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(const n of t){const i=this.peerIPs.get(n);i!=null&&(i.delete(e),i.size===0&&this.peerIPs.delete(n))}}getPtopicStats(e,t){let n=e.topics[t];return n!==void 0?n:this.params.topics[t]!==void 0?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=n,n):null}}function _Ae(r,e,t,n,i){let s=0;const o=new Map;if(Object.entries(e.topics).forEach(([p,m])=>{const f=i.get(p)??"unknown",g=t.topics[p];if(g===void 0)return;let v=o.get(f);v==null&&(v={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(f,v));let y=0,w=0,b=0,E=0,A=0;if(m.inMesh){const T=Math.max(m.meshTime/g.timeInMeshQuantum,g.timeInMeshCap);y+=T*g.timeInMeshWeight}let k=m.firstMessageDeliveries;if(k>g.firstMessageDeliveriesCap&&(k=g.firstMessageDeliveriesCap),w+=k*g.firstMessageDeliveriesWeight,m.meshMessageDeliveriesActive&&m.meshMessageDeliveries<g.meshMessageDeliveriesThreshold){const T=g.meshMessageDeliveriesThreshold-m.meshMessageDeliveries,L=T*T;b+=L*g.meshMessageDeliveriesWeight}const x=m.meshFailurePenalty;E+=x*g.meshFailurePenaltyWeight;const I=m.invalidMessageDeliveries*m.invalidMessageDeliveries;A+=I*g.invalidMessageDeliveriesWeight,s+=(y+w+b+E+A)*g.topicWeight,v.p1w+=y,v.p2w+=w,v.p3w+=b,v.p3bw+=E,v.p4w+=A}),t.topicScoreCap>0&&s>t.topicScoreCap){s=t.topicScoreCap;const p=t.topicScoreCap/s;for(const m of o.values())m.p1w*=p,m.p2w*=p,m.p3w*=p,m.p3bw*=p,m.p4w*=p}let a=0,c=0,l=0;const d=t.appSpecificScore(r);a+=d*t.appSpecificWeight,e.knownIPs.forEach(p=>{if(t.IPColocationFactorWhitelist.has(p))return;const m=n.get(p),f=m!=null?m.size:0;if(f>t.IPColocationFactorThreshold){const g=f-t.IPColocationFactorThreshold,v=g*g;c+=v*t.IPColocationFactorWeight}});const h=e.behaviourPenalty*e.behaviourPenalty;return l+=h*t.behaviourPenaltyWeight,s+=a+c+l,{byTopic:o,p5w:a,p6w:c,p7w:l,score:s}}function TAe(r,e,t,n,i){const s={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const o of r){const a=e.get(o);if(a!=null){const c=_Ae(o,a,t,n,i);for(const[l,d]of c.byTopic){let h=s.byTopic.get(l);h==null&&(h={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},s.byTopic.set(l,h)),h.p1w.push(d.p1w),h.p2w.push(d.p2w),h.p3w.push(d.p3w),h.p3bw.push(d.p3bw),h.p4w.push(d.p4w)}s.p5w.push(c.p5w),s.p6w.push(c.p6w),s.p7w.push(c.p7w),s.score.push(c.score)}else s.p5w.push(0),s.p6w.push(0),s.p7w.push(0),s.score.push(0)}return s}class PAe{constructor(e,t,n){u(this,"rawStream");u(this,"pushable");u(this,"closeController");u(this,"maxBufferSize");this.rawStream=e,this.pushable=yo(),this.closeController=new AbortController,this.maxBufferSize=n.maxBufferSize??1/0,this.closeController.signal.addEventListener("abort",()=>{e.close().catch(i=>{e.abort(i)})}),un(this.pushable,this.rawStream).catch(t)}get protocol(){return this.rawStream.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(EA.single(e))}pushPrefixed(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}async close(){this.closeController.abort(),await this.pushable.return()}}class DAe{constructor(e,t={}){u(this,"source");u(this,"rawStream");u(this,"closeController");this.rawStream=e,this.closeController=new AbortController,this.closeController.signal.addEventListener("abort",()=>{e.close().catch(n=>{e.abort(n)})}),this.source=un(this.rawStream,n=>xA(n,t))}async close(){this.closeController.abort()}}class $Ae{constructor(e,t,n){u(this,"gossipsubIWantFollowupMs");u(this,"msgIdToStrFn");u(this,"metrics");u(this,"promises",new Map);u(this,"requestMsByMsg",new Map);u(this,"requestMsByMsgExpire");this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=n,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){const n=Math.floor(Math.random()*t.length),i=t[n],s=this.msgIdToStrFn(i);let o=this.promises.get(s);o==null&&(o=new Map,this.promises.set(s,o));const a=Date.now();o.has(e)||(o.set(e,a+this.gossipsubIWantFollowupMs),this.metrics!=null&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(s)||this.requestMsByMsg.set(s,a)))}getBrokenPromises(){var i;const e=Date.now(),t=new Map;let n=0;return this.promises.forEach((s,o)=>{s.forEach((a,c)=>{a<e&&(t.set(c,(t.get(c)??0)+1),s.delete(c),n++)}),s.size===0&&this.promises.delete(o)}),(i=this.metrics)==null||i.iwantPromiseBroken.inc(n),t}deliverMessage(e,t=!1){this.trackMessage(e);const n=this.promises.get(e);n!=null&&(this.promises.delete(e),this.metrics!=null&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(n.size)))}rejectMessage(e,t){switch(this.trackMessage(e),t){case ms.Error:return}this.promises.delete(e)}clear(){this.promises.clear()}prune(){var n;const e=Date.now()-this.requestMsByMsgExpire;let t=0;for(const[i,s]of this.requestMsByMsg.entries())if(s<e)this.requestMsByMsg.delete(i),t++;else break;(n=this.metrics)==null||n.iwantMessagePruned.inc(t)}trackMessage(e){if(this.metrics!=null){const t=this.requestMsByMsg.get(e);t!==void 0&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}const dj=se("libp2p-pubsub:");async function NAe(r,e,t,n){switch(r.type){case Fh.Signing:{const i={from:r.author.toMultihash().bytes,data:n,seqno:ic(8),topic:e,signature:void 0,key:void 0},s=or([dj,Au.Message.encode(i)]);i.signature=await r.privateKey.sign(s),i.key=r.key;const o={type:"signed",from:r.author,data:t,sequenceNumber:BigInt(`0x${re(i.seqno??new Uint8Array(0),"base16")}`),topic:e,signature:i.signature,key:_n(i.key)};return{raw:i,msg:o}}case Fh.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:e,signature:void 0,key:void 0},msg:{type:"unsigned",data:t,topic:e}};default:throw new Error("Unreachable")}}async function MAe(r,e){switch(r){case bb:return e.signature!=null?{valid:!1,error:Ln.SignaturePresent}:e.seqno!=null?{valid:!1,error:Ln.SeqnoPresent}:e.key!=null?{valid:!1,error:Ln.FromPresent}:{valid:!0,message:{type:"unsigned",topic:e.topic,data:e.data??new Uint8Array(0)}};case _2:{if(e.seqno==null)return{valid:!1,error:Ln.InvalidSeqno};if(e.seqno.length!==8)return{valid:!1,error:Ln.InvalidSeqno};if(e.signature==null)return{valid:!1,error:Ln.InvalidSignature};if(e.from==null)return{valid:!1,error:Ln.InvalidPeerId};let t;try{t=ti(nj(e.from))}catch{return{valid:!1,error:Ln.InvalidPeerId}}let n;if(e.key!=null){if(n=_n(e.key),t.publicKey!==void 0&&!n.equals(t.publicKey))return{valid:!1,error:Ln.InvalidPeerId}}else{if(t.publicKey==null)return{valid:!1,error:Ln.InvalidPeerId};n=t.publicKey}const i={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},s=or([dj,Au.Message.encode(i)]);return await n.verify(s,e.signature)?{valid:!0,message:{type:"signed",from:t,data:e.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${re(e.seqno,"base16")}`),topic:e.topic,signature:e.signature,key:e.key!=null?_n(e.key):n}}:{valid:!1,error:Ln.InvalidSignature}}default:throw new Error("Unreachable")}}function Xs(r=[],e){return{subscriptions:[],messages:r,control:e!==void 0?{graft:e.graft??[],prune:e.prune??[],ihave:e.ihave??[],iwant:e.iwant??[],idontwant:e.idontwant??[]}:void 0}}function hj(r){return r.control===void 0&&(r.control={graft:[],prune:[],ihave:[],iwant:[],idontwant:[]}),r}function la(r){if(r.length<=1)return r;const e=()=>Math.floor(Math.random()*Math.floor(r.length));for(let t=0;t<r.length;t++){const n=e(),i=r[t];r[t]=r[n],r[n]=i}return r}function OAe(r){return re(r,"base64")}function RAe(r,e,t){switch(r){case _2:return{type:Fh.Signing,author:e,key:_i(t.publicKey),privateKey:t};case bb:return{type:Fh.Anonymous};default:throw new Error(`Unknown signature policy "${r}"`)}}const LAe=(r,e)=>{const t=se(e.toString(16).padStart(16,"0"),"base16"),n=_i(r),i=new Uint8Array(n.byteLength+t.length);return i.set(n,0),i.set(t,n.byteLength),i};function BAe({name:r,code:e,encode:t}){return new UAe(r,e,t)}class UAe{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?rj(this.code,t):t.then(n=>rj(this.code,n))}else throw Error("Unknown type, must be binary type")}}function FAe(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const zAe=BAe({name:"sha2-256",code:18,encode:FAe("SHA-256")});function VAe(r){if(r.type!=="signed")throw new Error("expected signed message type");if(r.sequenceNumber==null)throw Error("missing seqno field");return LAe(r.from.publicKey??r.key,r.sequenceNumber)}async function KAe(r){return zAe.encode(r.data)}var P4;(function(r){r[r.ip4=4]="ip4",r[r.ip6=41]="ip6"})(P4||(P4={}));function jAe(r){for(const e of r.tuples())switch(e[0]){case P4.ip4:case P4.ip6:return V7(e[0],e[1])}return null}class _A{constructor(e){u(this,"entries",new Map);u(this,"validityMs");this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return this.entries.has(e)?!0:(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){const e=Date.now();for(const[t,n]of this.entries.entries())if(n.validUntilMs<e)this.entries.delete(t);else break}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);return t!=null&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}var pi;(function(r){r[r.started=0]="started",r[r.stopped=1]="stopped"})(pi||(pi={}));class fj extends(KH=er,VH=Symbol.toStringTag,zH=dr,FH=Qa,KH){constructor(t,n={}){super();u(this,"globalSignaturePolicy");u(this,"multicodecs",[IA,Txe,oj]);u(this,"publishConfig");u(this,"dataTransform");u(this,"peers",new Map);u(this,"streamsInbound",new Map);u(this,"streamsOutbound",new Map);u(this,"outboundInflightQueue",yo({objectMode:!0}));u(this,"direct",new Set);u(this,"floodsubPeers",new Set);u(this,"seenCache");u(this,"acceptFromWhitelist",new Map);u(this,"topics",new Map);u(this,"subscriptions",new Set);u(this,"mesh",new Map);u(this,"fanout",new Map);u(this,"fanoutLastpub",new Map);u(this,"gossip",new Map);u(this,"control",new Map);u(this,"peerhave",new Map);u(this,"iasked",new Map);u(this,"backoff",new Map);u(this,"outbound",new Map);u(this,"msgIdFn");u(this,"fastMsgIdFn");u(this,"msgIdToStrFn");u(this,"fastMsgIdCache");u(this,"publishedMessageIds");u(this,"mcache");u(this,"score");u(this,"topicValidators",new Map);u(this,"log");u(this,"heartbeatTicks",0);u(this,"gossipTracer");u(this,"idontwantCounts",new Map);u(this,"idontwants",new Map);u(this,"components");u(this,"directPeerInitial",null);u(this,"opts");u(this,"decodeRpcLimits");u(this,"metrics");u(this,"status",{code:pi.stopped});u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"runOnLimitedConnection");u(this,"allowedTopics");u(this,"heartbeatTimer",null);u(this,VH,"@chainsafe/libp2p-gossipsub");u(this,zH,["@libp2p/pubsub"]);u(this,FH,["@libp2p/identify"]);u(this,"runHeartbeat",()=>{var n;const t=(n=this.metrics)==null?void 0:n.heartbeatDuration.startTimer();this.heartbeat().catch(i=>{this.log("Error running heartbeat",i)}).finally(()=>{var i;if(t!=null&&t(),this.status.code===pi.started){clearTimeout(this.status.heartbeatTimeout);let s=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;s<this.opts.heartbeatInterval*.25&&(s+=this.opts.heartbeatInterval,(i=this.metrics)==null||i.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,s)}})});u(this,"tagMeshPeer",t=>{const{peerId:n,topic:i}=t.detail;this.components.peerStore.merge(this.peers.get(n)??tr(n),{tags:{[i]:{value:100}}}).catch(s=>{this.log.error("Error tagging peer %s with topic %s",n,i,s)})});u(this,"untagMeshPeer",t=>{const{peerId:n,topic:i}=t.detail;this.components.peerStore.merge(this.peers.get(n)??tr(n),{tags:{[i]:void 0}}).catch(s=>{this.log.error("Error untagging peer %s with topic %s",n,i,s)})});const i={fallbackToFloodsub:!0,floodPublish:!0,batchPublish:!1,tagMeshPeers:!0,doPX:!1,directPeers:[],D:Pxe,Dlo:Dxe,Dhi:$xe,Dscore:Nxe,Dout:Mxe,Dlazy:Lxe,heartbeatInterval:Fxe,fanoutTTL:zxe,mcacheLength:Oxe,mcacheGossip:Rxe,seenTTL:Zxe,gossipsubIWantFollowupMs:Xxe,prunePeers:Vxe,pruneBackoff:Kxe,unsubcribeBackoff:jxe,graftFloodThreshold:Yxe,opportunisticGraftPeers:Qxe,opportunisticGraftTicks:Gxe,directConnectTicks:qxe,gossipFactor:Bxe,idontwantMinDataSize:cAe,idontwantMaxMessages:lAe,...n,scoreParams:gAe(n.scoreParams),scoreThresholds:vAe(n.scoreThresholds)};if(this.components=t,this.decodeRpcLimits=i.decodeRpcLimits??uAe,this.globalSignaturePolicy=i.globalSignaturePolicy??_2,i.fallbackToFloodsub&&this.multicodecs.push(sj),this.log=t.logger.forComponent(i.debugName??"libp2p:gossipsub"),this.opts=i,this.direct=new Set(i.directPeers.map(s=>s.id.toString())),this.seenCache=new _A({validityMs:i.seenTTL}),this.publishedMessageIds=new _A({validityMs:i.seenTTL}),n.msgIdFn!=null)this.msgIdFn=n.msgIdFn;else switch(this.globalSignaturePolicy){case _2:this.msgIdFn=VAe;break;case bb:this.msgIdFn=KAe;break;default:throw new Error(`Invalid globalSignaturePolicy: ${this.globalSignaturePolicy}`)}if(n.fastMsgIdFn!=null&&(this.fastMsgIdFn=n.fastMsgIdFn,this.fastMsgIdCache=new _A({validityMs:i.seenTTL})),this.msgIdToStrFn=n.msgIdToStrFn??OAe,this.mcache=n.messageCache??new dAe(i.mcacheGossip,i.mcacheLength,this.msgIdToStrFn),n.dataTransform!=null&&(this.dataTransform=n.dataTransform),n.metricsRegister!=null){if(n.metricsTopicStrToLabel==null)throw Error("Must set metricsTopicStrToLabel with metrics");const s=Math.max(...Object.values(i.scoreParams.topics).map(a=>a.meshMessageDeliveriesWindow),oAe),o=hAe(n.metricsRegister,n.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:i.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:s/1e3});o.mcacheSize.addCollect(()=>{this.onScrapeMetrics(o)});for(const a of this.multicodecs)o.protocolsEnabled.set({protocol:a},1);this.metrics=o}else this.metrics=null;this.gossipTracer=new $Ae(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new kAe(this.opts.scoreParams,this.metrics,this.components.logger,{scoreCacheValidityMs:i.heartbeatInterval}),this.maxInboundStreams=n.maxInboundStreams,this.maxOutboundStreams=n.maxOutboundStreams,this.runOnLimitedConnection=n.runOnLimitedConnection,this.allowedTopics=i.allowedTopics!=null?new Set(i.allowedTopics):null}getPeers(){return[...this.peers.values()]}isStarted(){return this.status.code===pi.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=RAe(this.globalSignaturePolicy,this.components.peerId,this.components.privateKey),this.outboundInflightQueue=yo({objectMode:!0}),un(this.outboundInflightQueue,async o=>{for await(const{peerId:a,connection:c}of o)await this.createOutboundStream(a,c)}).catch(o=>{this.log.error("outbound inflight queue error",o)}),await Promise.all(this.opts.directPeers.map(async o=>{await this.components.peerStore.merge(o.id,{multiaddrs:o.addrs})}));const t=this.components.registrar;await Promise.all(this.multicodecs.map(async o=>t.handle(o,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection})));const n={onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this),notifyOnLimitedConnection:this.runOnLimitedConnection},i=await Promise.all(this.multicodecs.map(async o=>t.register(o,n))),s=setTimeout(this.runHeartbeat,aj);this.status={code:pi.started,registrarTopologyIds:i,heartbeatTimeout:s,hearbeatStartMs:Date.now()+aj},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async o=>this.connect(o)))}).catch(o=>{this.log(o)})},Wxe),this.opts.tagMeshPeers&&(this.addEventListener("gossipsub:graft",this.tagMeshPeer),this.addEventListener("gossipsub:prune",this.untagMeshPeer)),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==pi.started)return;const{registrarTopologyIds:t}=this.status;this.status={code:pi.stopped},this.opts.tagMeshPeers&&(this.removeEventListener("gossipsub:graft",this.tagMeshPeer),this.removeEventListener("gossipsub:prune",this.untagMeshPeer));const n=this.components.registrar;await Promise.all(this.multicodecs.map(async s=>n.unhandle(s))),t.forEach(s=>{n.unregister(s)}),this.outboundInflightQueue.end();const i=[];for(const s of this.streamsOutbound.values())i.push(s.close());this.streamsOutbound.clear();for(const s of this.streamsInbound.values())i.push(s.close());this.streamsInbound.clear(),await Promise.all(i),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer!=null&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache!=null&&this.fastMsgIdCache.clear(),this.directPeerInitial!=null&&clearTimeout(this.directPeerInitial),this.idontwantCounts.clear(),this.idontwants.clear(),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:t,connection:n}){if(!this.isStarted())return;const i=n.remotePeer;this.addPeer(i,n.direction,n.remoteAddr),this.createInboundStream(i,t),this.outboundInflightQueue.push({peerId:i,connection:n})}onPeerConnected(t,n){var i;(i=this.metrics)==null||i.newConnectionCount.inc({status:n.status}),!(!this.isStarted()||n.status!=="open")&&(this.addPeer(t,n.direction,n.remoteAddr),this.outboundInflightQueue.push({peerId:t,connection:n}))}onPeerDisconnected(t){this.log("connection ended %p",t),this.removePeer(t)}async createOutboundStream(t,n){var s;if(!this.isStarted())return;const i=t.toString();if(this.peers.has(i)&&!this.streamsOutbound.has(i))try{const o=new PAe(await n.newStream(this.multicodecs,{runOnLimitedConnection:this.runOnLimitedConnection}),c=>{this.log.error("outbound pipe error",c)},{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",t),this.streamsOutbound.set(i,o);const a=o.protocol;a===sj&&this.floodsubPeers.add(i),(s=this.metrics)==null||s.peersPerProtocol.inc({protocol:a},1),this.subscriptions.size>0&&(this.log("send subscriptions to",i),this.sendSubscriptions(i,Array.from(this.subscriptions),!0))}catch(o){this.log.error("createOutboundStream error",o)}}createInboundStream(t,n){if(!this.isStarted())return;const i=t.toString();if(!this.peers.has(i))return;const s=this.streamsInbound.get(i);s!==void 0&&(this.log("replacing existing inbound steam %s",i),s.close().catch(a=>{this.log.error(a)})),this.log("create inbound stream %s",i);const o=new DAe(n,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(i,o),this.pipePeerReadStream(t,o.source).catch(a=>{this.log(a)})}addPeer(t,n,i){const s=t.toString();if(!this.peers.has(s)){this.log("new peer %p",t),this.peers.set(s,t),this.score.addPeer(s);const o=jAe(i);o!==null?this.score.addIP(s,o):this.log("Added peer has no IP in current address %s %s",s,i.toString()),this.outbound.has(s)||this.outbound.set(s,n==="outbound")}}removePeer(t){var o,a;const n=t.toString();if(!this.peers.has(n))return;this.log("delete peer %p",t),this.peers.delete(n);const i=this.streamsOutbound.get(n),s=this.streamsInbound.get(n);i!=null&&((o=this.metrics)==null||o.peersPerProtocol.inc({protocol:i.protocol},-1)),i==null||i.close().catch(c=>{this.log.error(c)}),s==null||s.close().catch(c=>{this.log.error(c)}),this.streamsOutbound.delete(n),this.streamsInbound.delete(n);for(const c of this.topics.values())c.delete(n);for(const[c,l]of this.mesh)l.delete(n)&&((a=this.metrics)==null||a.onRemoveFromMesh(c,Js.Dc,1));for(const c of this.fanout.values())c.delete(n);this.floodsubPeers.delete(n),this.gossip.delete(n),this.control.delete(n),this.outbound.delete(n),this.idontwantCounts.delete(n),this.idontwants.delete(n),this.score.removePeer(n),this.acceptFromWhitelist.delete(n)}get started(){return this.status.code===pi.started}getMeshPeers(t){const n=this.mesh.get(t);return n!=null?Array.from(n):[]}getSubscribers(t){const n=this.topics.get(t);return(n!=null?Array.from(n):[]).map(i=>this.peers.get(i)??tr(i))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(t,n){var i;try{await un(n,async s=>{var o,a,c;for await(const l of s)try{const d=l.subarray(),h=Au.decode(d,{limits:{subscriptions:this.decodeRpcLimits.maxSubscriptions,messages:this.decodeRpcLimits.maxMessages,control$:{ihave:this.decodeRpcLimits.maxIhaveMessageIDs,iwant:this.decodeRpcLimits.maxIwantMessageIDs,graft:this.decodeRpcLimits.maxControlMessages,prune:this.decodeRpcLimits.maxControlMessages,prune$:{peers:this.decodeRpcLimits.maxPeerInfos},idontwant:this.decodeRpcLimits.maxControlMessages,idontwant$:{messageIDs:this.decodeRpcLimits.maxIdontwantMessageIDs}}}});if((o=this.metrics)==null||o.onRpcRecv(h,d.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(t,h)}catch(p){(a=this.metrics)==null||a.onRpcRecvError(),this.log(p)}else this.handleReceivedRpc(t,h).catch(p=>{var m;(m=this.metrics)==null||m.onRpcRecvError(),this.log(p)})}catch(d){(c=this.metrics)==null||c.onRpcDataError(),this.log(d)}})}catch(s){(i=this.metrics)==null||i.onPeerReadStreamError(),this.handlePeerReadStreamError(s,t)}}handlePeerReadStreamError(t,n){this.log.error(t),this.onPeerDisconnected(n)}async handleReceivedRpc(t,n){var d;if(!this.acceptFrom(t.toString())){this.log("received message from unacceptable peer %p",t),(d=this.metrics)==null||d.rpcRecvNotAccepted.inc();return}const i=n.subscriptions!=null?n.subscriptions.length:0,s=n.messages!=null?n.messages.length:0;let o=0,a=0,c=0,l=0;if(n.control!=null&&(n.control.ihave!=null&&(o=n.control.ihave.length),n.control.iwant!=null&&(a=n.control.iwant.length),n.control.graft!=null&&(c=n.control.graft.length),n.control.prune!=null&&(l=n.control.prune.length)),this.log(`rpc.from ${t.toString()} subscriptions ${i} messages ${s} ihave ${o} iwant ${a} graft ${c} prune ${l}`),n.subscriptions!=null&&n.subscriptions.length>0){const h=[];n.subscriptions.forEach(p=>{const m=p.topic,f=p.subscribe===!0;if(m!=null){if(this.allowedTopics!=null&&!this.allowedTopics.has(m))return;this.handleReceivedSubscription(t,m,f),h.push({topic:m,subscribe:f})}}),this.safeDispatchEvent("subscription-change",{detail:{peerId:t,subscriptions:h}})}for(const h of n.messages){if(this.allowedTopics!=null&&!this.allowedTopics.has(h.topic))continue;const p=this.handleReceivedMessage(t,h).catch(m=>{var f;(f=this.metrics)==null||f.onMsgRecvError(h.topic),this.log(m)});this.opts.awaitRpcMessageHandler&&await p}n.control!=null&&await this.handleControlMessage(t.toString(),n.control)}handleReceivedSubscription(t,n,i){this.log("subscription update from %p topic %s",t,n);let s=this.topics.get(n);s==null&&(s=new Set,this.topics.set(n,s)),i?s.add(t.toString()):s.delete(t.toString())}async handleReceivedMessage(t,n){var o,a,c;(o=this.metrics)==null||o.onMsgRecvPreValidation(n.topic);const i=await this.validateReceivedMessage(t,n);(a=this.metrics)==null||a.onPrevalidationResult(n.topic,i.code);const s=i.code;switch(s){case Bn.duplicate:this.score.duplicateMessage(t.toString(),i.msgIdStr,n.topic),this.gossipTracer.deliverMessage(i.msgIdStr,!0),this.mcache.observeDuplicate(i.msgIdStr,t.toString());return;case Bn.invalid:if(i.msgIdStr!=null){const l=i.msgIdStr;this.score.rejectMessage(t.toString(),l,n.topic,i.reason),this.gossipTracer.rejectMessage(l,i.reason)}else this.score.rejectInvalidMessage(t.toString(),n.topic);(c=this.metrics)==null||c.onMsgRecvInvalid(n.topic,i);return;case Bn.valid:this.score.validateMessage(i.messageId.msgIdStr),this.gossipTracer.deliverMessage(i.messageId.msgIdStr),this.mcache.put(i.messageId,n,!this.opts.asyncValidation),this.subscriptions.has(n.topic)&&(!this.components.peerId.equals(t)||this.opts.emitSelf)&&(super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:t,msgId:i.messageId.msgIdStr,msg:i.msg}})),super.dispatchEvent(new CustomEvent("message",{detail:i.msg}))),this.opts.asyncValidation||this.forwardMessage(i.messageId.msgIdStr,n,t.toString());break;default:throw new Error(`Invalid validation result: ${s}`)}}async validateReceivedMessage(t,n){var p,m,f,g;const i=(p=this.fastMsgIdFn)==null?void 0:p.call(this,n),s=i!==void 0?(m=this.fastMsgIdCache)==null?void 0:m.get(i):void 0;if(s!=null)return{code:Bn.duplicate,msgIdStr:s};const o=await MAe(this.globalSignaturePolicy,n);if(!o.valid)return{code:Bn.invalid,reason:ms.Error,error:o.error};const a=o.message;try{this.dataTransform!=null&&(a.data=this.dataTransform.inboundTransform(n.topic,a.data))}catch(v){return this.log("Invalid message, transform failed",v),{code:Bn.invalid,reason:ms.Error,error:Ln.TransformFailed}}const c=await this.msgIdFn(a),l=this.msgIdToStrFn(c),d={msgId:c,msgIdStr:l};if(i!==void 0&&this.fastMsgIdCache!=null&&this.fastMsgIdCache.put(i,l)&&((f=this.metrics)==null||f.fastMsgIdCacheCollision.inc()),this.seenCache.has(l))return{code:Bn.duplicate,msgIdStr:l};this.seenCache.put(l),(((g=n.data)==null?void 0:g.length)??0)>=this.opts.idontwantMinDataSize&&this.sendIDontWants(c,n.topic,t.toString());const h=this.topicValidators.get(n.topic);if(h!=null){let v;try{v=await h(t,a)}catch(y){const w=y.code;w===rAe&&(v=Ii.Ignore),w===tAe?v=Ii.Reject:v=Ii.Ignore}if(v!==Ii.Accept)return{code:Bn.invalid,reason:lj(v),msgIdStr:l}}return{code:Bn.valid,messageId:d,msg:a}}getScore(t){return this.score.score(t)}sendSubscriptions(t,n,i){this.sendRpc(t,{subscriptions:n.map(s=>({topic:s,subscribe:i})),messages:[]})}async handleControlMessage(t,n){var l,d,h,p,m,f,g;if(n===void 0)return;const i=((l=n.ihave)==null?void 0:l.length)>0?this.handleIHave(t,n.ihave):[],s=((d=n.iwant)==null?void 0:d.length)>0?this.handleIWant(t,n.iwant):[],o=((h=n.graft)==null?void 0:h.length)>0?await this.handleGraft(t,n.graft):[];if(((p=n.prune)==null?void 0:p.length)>0&&await this.handlePrune(t,n.prune),((m=n.idontwant)==null?void 0:m.length)>0&&this.handleIdontwant(t,n.idontwant),i.length===0&&s.length===0&&o.length===0)return;const a=this.sendRpc(t,Xs(s,{iwant:i,prune:o})),c=(f=i[0])==null?void 0:f.messageIDs;c!=null&&(a?this.gossipTracer.addPromise(t,c):(g=this.metrics)==null||g.iwantPromiseUntracked.inc(1))}acceptFrom(t){if(this.direct.has(t))return!0;const n=Date.now(),i=this.acceptFromWhitelist.get(t);if(i!=null&&i.messagesAccepted<iAe&&i.acceptUntil>=n)return i.messagesAccepted+=1,!0;const s=this.score.score(t);return s>=nAe?this.acceptFromWhitelist.set(t,{messagesAccepted:0,acceptUntil:n+sAe}):this.acceptFromWhitelist.delete(t),s>=this.opts.scoreThresholds.graylistThreshold}handleIHave(t,n){var d,h,p;if(n.length===0)return[];const i=this.score.score(t);if(i<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",t,i),(d=this.metrics)==null||d.ihaveRcvIgnored.inc({reason:s0.LowScore}),[];const s=(this.peerhave.get(t)??0)+1;if(this.peerhave.set(t,s),s>Jxe)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",t,s),(h=this.metrics)==null||h.ihaveRcvIgnored.inc({reason:s0.MaxIhave}),[];const o=this.iasked.get(t)??0;if(o>=Uh)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",t,o),(p=this.metrics)==null||p.ihaveRcvIgnored.inc({reason:s0.MaxIasked}),[];const a=new Map;if(n.forEach(({topicID:m,messageIDs:f})=>{var v;if(m==null||f==null||!this.mesh.has(m))return;let g=0;f.forEach(y=>{const w=this.msgIdToStrFn(y);this.seenCache.has(w)||(a.set(w,y),g++)}),(v=this.metrics)==null||v.onIhaveRcv(m,f.length,g)}),a.size===0)return[];let c=a.size;c+o>Uh&&(c=Uh-o),this.log("IHAVE: Asking for %d out of %d messages from %s",c,a.size,t);let l=Array.from(a.values());return la(l),l=l.slice(0,c),this.iasked.set(t,o+c),[{messageIDs:l}]}handleIWant(t,n){var c;if(n.length===0)return[];const i=this.score.score(t);if(i<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",t,i),[];const s=new Map,o=new Map;let a=0;return n.forEach(({messageIDs:l})=>{l==null||l.forEach(d=>{const h=this.msgIdToStrFn(d),p=this.mcache.getWithIWantCount(h,t);if(p==null){a++;return}if(o.set(p.msg.topic,1+(o.get(p.msg.topic)??0)),p.count>Uxe){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",t,d);return}s.set(h,p.msg)})}),(c=this.metrics)==null||c.onIwantRcv(o,a),s.size===0?(this.log("IWANT: Could not provide any wanted messages to %s",t),[]):(this.log("IWANT: Sending %d messages to %s",s.size,t),Array.from(s.values()))}async handleGraft(t,n){const i=[],s=this.score.score(t),o=Date.now();let a=this.opts.doPX;if(n.forEach(({topicID:l})=>{var p,m;if(l==null)return;const d=this.mesh.get(l);if(d==null){a=!1;return}if(d.has(t))return;const h=(p=this.backoff.get(l))==null?void 0:p.get(t);if(this.direct.has(t))this.log("GRAFT: ignoring request from direct peer %s",t),i.push(l),a=!1;else if(typeof h=="number"&&o<h){this.log("GRAFT: ignoring backed off peer %s",t),this.score.addPenalty(t,1,i0.GraftBackoff),a=!1;const f=h+this.opts.graftFloodThreshold-this.opts.pruneBackoff;o<f&&this.score.addPenalty(t,1,i0.GraftBackoff),this.addBackoff(t,l),i.push(l)}else s<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",t,s,l),i.push(l),a=!1,this.addBackoff(t,l)):d.size>=this.opts.Dhi&&!(this.outbound.get(t)??!1)?(i.push(l),this.addBackoff(t,l)):(this.log("GRAFT: Add mesh link from %s in %s",t,l),this.score.graft(t,l),d.add(t),(m=this.metrics)==null||m.onAddToMesh(l,Un.Subscribed,1));this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:t,topic:l,direction:"inbound"}})}),i.length===0)return[];const c=!1;return Promise.all(i.map(async l=>this.makePrune(t,l,a,c)))}async handlePrune(t,n){var s;const i=this.score.score(t);for(const{topicID:o,backoff:a,peers:c}of n){if(o==null)continue;const l=this.mesh.get(o);if(l==null)return;this.log("PRUNE: Remove mesh link to %s in %s",t,o),this.score.prune(t,o),l.has(t)&&(l.delete(t),(s=this.metrics)==null||s.onRemoveFromMesh(o,Js.Prune,1)),typeof a=="number"&&a>0?this.doAddBackoff(t,o,a*1e3):this.addBackoff(t,o),c!=null&&c.length>0&&(i<this.opts.scoreThresholds.acceptPXThreshold?this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",t,i,o):await this.pxConnect(c)),this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:t,topic:o,direction:"inbound"}})}}handleIdontwant(t,n){var l;let i=this.idontwantCounts.get(t)??0;if(i>=this.opts.idontwantMaxMessages)return;const s=i;let o=this.idontwants.get(t);o==null&&(o=new Map,this.idontwants.set(t,o));let a=0;e:for(const{messageIDs:d}of n)for(const h of d){if(i>=this.opts.idontwantMaxMessages)break e;i++;const p=this.msgIdToStrFn(h);o.set(p,this.heartbeatTicks),this.mcache.msgs.has(p)||a++}this.idontwantCounts.set(t,i);const c=i-s;(l=this.metrics)==null||l.onIdontwantRcv(c,a)}addBackoff(t,n){this.doAddBackoff(t,n,this.opts.pruneBackoff)}doAddBackoff(t,n,i){let s=this.backoff.get(n);s==null&&(s=new Map,this.backoff.set(n,s));const o=Date.now()+i;(s.get(t)??0)<o&&s.set(t,o)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((t,n)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",n,t),this.score.addPenalty(n,t,i0.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%Hxe!==0)return;const t=Date.now();this.backoff.forEach((n,i)=>{n.forEach((s,o)=>{s+aAe*this.opts.heartbeatInterval<t&&n.delete(o)}),n.size===0&&this.backoff.delete(i)})}async directConnect(){const t=[];this.direct.forEach(n=>{this.streamsOutbound.has(n)||t.push(n)}),await Promise.all(t.map(async n=>this.connect(n)))}async pxConnect(t){t.length>this.opts.prunePeers&&(la(t),t=t.slice(0,this.opts.prunePeers));const n=[];await Promise.all(t.map(async i=>{if(i.peerID==null)return;const s=ti(nj(i.peerID)),o=s.toString();if(!this.peers.has(o)){if(i.signedPeerRecord==null){n.push(o);return}try{if(!await this.components.peerStore.consumePeerRecord(i.signedPeerRecord,s)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}n.push(o)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),n.length!==0&&await Promise.all(n.map(async i=>this.connect(i)))}async connect(t){var s;this.log("Initiating connection with %s",t);const n=tr(t),i=await this.components.connectionManager.openConnection(n);for(const o of this.multicodecs)for(const a of this.components.registrar.getTopologies(o))(s=a.onConnect)==null||s.call(a,n,i)}subscribe(t){if(this.status.code!==pi.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(t)){this.subscriptions.add(t);for(const n of this.peers.keys())this.sendSubscriptions(n,[t],!0)}this.join(t)}unsubscribe(t){if(this.status.code!==pi.started)throw new Error("Pubsub is not started");const n=this.subscriptions.delete(t);if(this.log("unsubscribe from %s - am subscribed %s",t,n),n)for(const i of this.peers.keys())this.sendSubscriptions(i,[t],!1);this.leave(t)}join(t){var o,a,c;if(this.status.code!==pi.started)throw new Error("Gossipsub has not started");if(this.mesh.has(t))return;this.log("JOIN %s",t),(o=this.metrics)==null||o.onJoin(t);const n=new Set,i=this.backoff.get(t),s=this.fanout.get(t);if(s!=null&&(this.fanout.delete(t),this.fanoutLastpub.delete(t),s.forEach(l=>{!this.direct.has(l)&&this.score.score(l)>=0&&(i==null?void 0:i.has(l))!==!0&&n.add(l)}),(a=this.metrics)==null||a.onAddToMesh(t,Un.Fanout,n.size)),n.size<this.opts.D){const l=n.size;this.getRandomGossipPeers(t,this.opts.D,h=>!n.has(h)&&!this.direct.has(h)&&this.score.score(h)>=0&&(i==null?void 0:i.has(h))!==!0).forEach(h=>{n.add(h)}),(c=this.metrics)==null||c.onAddToMesh(t,Un.Random,n.size-l)}this.mesh.set(t,n),n.forEach(l=>{this.log("JOIN: Add mesh link to %s in %s",l,t),this.sendGraft(l,t)})}leave(t){var i;if(this.status.code!==pi.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",t),(i=this.metrics)==null||i.onLeave(t);const n=this.mesh.get(t);n!=null&&(Promise.all(Array.from(n).map(async s=>{this.log("LEAVE: Remove mesh link to %s in %s",s,t),await this.sendPrune(s,t)})).catch(s=>{this.log("Error sending prunes to mesh peers",s)}),this.mesh.delete(t))}selectPeersToForward(t,n,i){const s=new Set,o=this.topics.get(t);o!=null&&(this.direct.forEach(c=>{o.has(c)&&n!==c&&!((i==null?void 0:i.has(c))??!1)&&s.add(c)}),this.floodsubPeers.forEach(c=>{o.has(c)&&n!==c&&!((i==null?void 0:i.has(c))??!1)&&this.score.score(c)>=this.opts.scoreThresholds.publishThreshold&&s.add(c)}));const a=this.mesh.get(t);return a!=null&&a.size>0&&a.forEach(c=>{n!==c&&!((i==null?void 0:i.has(c))??!1)&&s.add(c)}),s}selectPeersToPublish(t){const n=new Set,i={direct:0,floodsub:0,mesh:0,fanout:0},s=this.topics.get(t);if(s!=null)if(this.opts.floodPublish)s.forEach(o=>{this.direct.has(o)?(n.add(o),i.direct++):this.score.score(o)>=this.opts.scoreThresholds.publishThreshold&&(n.add(o),i.floodsub++)});else{this.direct.forEach(a=>{s.has(a)&&(n.add(a),i.direct++)}),this.floodsubPeers.forEach(a=>{s.has(a)&&this.score.score(a)>=this.opts.scoreThresholds.publishThreshold&&(n.add(a),i.floodsub++)});const o=this.mesh.get(t);if(o!=null&&o.size>0)o.forEach(a=>{n.add(a),i.mesh++}),o.size<this.opts.D&&this.getRandomGossipPeers(t,this.opts.D-o.size,c=>!o.has(c)&&!this.direct.has(c)&&!this.floodsubPeers.has(c)&&this.score.score(c)>=this.opts.scoreThresholds.publishThreshold).forEach(c=>{n.add(c),i.mesh++});else{const a=this.fanout.get(t);if(a!=null&&a.size>0)a.forEach(c=>{n.add(c),i.fanout++});else{const c=this.getRandomGossipPeers(t,this.opts.D,l=>this.score.score(l)>=this.opts.scoreThresholds.publishThreshold);c.size>0&&(this.fanout.set(t,c),c.forEach(l=>{n.add(l),i.fanout++}))}this.fanoutLastpub.set(t,Date.now())}}return{tosend:n,tosendCount:i}}forwardMessage(t,n,i,s){var a;i!=null&&this.score.deliverMessage(i,t,n.topic);const o=this.selectPeersToForward(n.topic,i,s);o.forEach(c=>{this.sendRpc(c,Xs([n]))}),(a=this.metrics)==null||a.onForwardMsg(n.topic,o.size)}async publish(t,n,i){var b,E;const s=Date.now(),o=this.dataTransform!=null?this.dataTransform.outboundTransform(t,n):n;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");const{raw:a,msg:c}=await NAe(this.publishConfig,t,n,o),l=await this.msgIdFn(c),d=this.msgIdToStrFn(l),h=(i==null?void 0:i.ignoreDuplicatePublishError)??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(d)){if(h)return(b=this.metrics)==null||b.onPublishDuplicateMsg(t),{recipients:[]};throw Error("PublishError.Duplicate")}const{tosend:p,tosendCount:m}=this.selectPeersToPublish(t),f=this.opts.emitSelf&&this.subscriptions.has(t),g=(i==null?void 0:i.allowPublishToZeroTopicPeers)??this.opts.allowPublishToZeroTopicPeers;if(p.size===0&&!g&&!f)throw Error("PublishError.NoPeersSubscribedToTopic");this.seenCache.put(d),this.mcache.put({msgId:l,msgIdStr:d},a,!0),this.publishedMessageIds.put(d);const v=(i==null?void 0:i.batchPublish)??this.opts.batchPublish,y=Xs([a]);if(v)this.sendRpcInBatch(p,y);else for(const A of p)this.sendRpc(A,y)||p.delete(A);const w=Date.now()-s;return(E=this.metrics)==null||E.onPublishMsg(t,m,p.size,a.data!=null?a.data.length:0,w),f&&(p.add(this.components.peerId.toString()),super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:d,msg:c}})),super.dispatchEvent(new CustomEvent("message",{detail:c}))),{recipients:Array.from(p.values()).map(A=>this.peers.get(A)??tr(A))}}sendRpcInBatch(t,n){var o;const i=Au.encode(n),s=EA.single(i);for(const a of t){const c=this.streamsOutbound.get(a);if(c==null){this.log(`Cannot send RPC to ${a} as there is no open stream to it available`),t.delete(a);continue}try{c.pushPrefixed(s)}catch(l){t.delete(a),this.log.error(`Cannot send rpc to ${a}`,l)}(o=this.metrics)==null||o.onRpcSent(n,i.length)}}reportMessageValidationResult(t,n,i){var a;let s;if(i===Ii.Accept){if(s=this.mcache.validate(t),s!=null){const{message:c,originatingPeers:l}=s;this.score.deliverMessage(n,t,c.topic),this.forwardMessage(t,s.message,n,l)}}else if(s=this.mcache.remove(t),s!=null){const c=lj(i),{message:l,originatingPeers:d}=s;this.score.rejectMessage(n,t,l.topic,c);for(const h of d)this.score.rejectMessage(h,t,l.topic,c)}const o=this.score.messageFirstSeenTimestampMs(t);(a=this.metrics)==null||a.onReportValidation(s,i,o)}sendGraft(t,n){const s=Xs([],{graft:[{topicID:n}]});this.sendRpc(t,s)}async sendPrune(t,n){const s=[await this.makePrune(t,n,this.opts.doPX,!0)],o=Xs([],{prune:s});this.sendRpc(t,o)}sendIDontWants(t,n,i){var c;const s=this.mesh.get(n);if(s==null)return;const o=new Set(s);o.delete(i);for(const l of o)((c=this.streamsOutbound.get(l))==null?void 0:c.protocol)!==IA&&o.delete(l);const a=Xs([],{idontwant:[{messageIDs:[t]}]});this.sendRpcInBatch(o,a)}sendRpc(t,n){var c,l,d,h,p;const i=this.streamsOutbound.get(t);if(i==null)return this.log(`Cannot send RPC to ${t} as there is no open stream to it available`),!1;const s=this.control.get(t);s!=null&&(this.piggybackControl(t,n,s),this.control.delete(t));const o=this.gossip.get(t);o!=null&&(this.piggybackGossip(t,n,o),this.gossip.delete(t));const a=Au.encode(n);try{i.push(a)}catch(m){return this.log.error(`Cannot send rpc to ${t}`,m),s!=null&&this.control.set(t,s),o!=null&&this.gossip.set(t,o),!1}if((c=this.metrics)==null||c.onRpcSent(n,a.length),((l=n.control)==null?void 0:l.graft)!=null)for(const m of(d=n.control)==null?void 0:d.graft)m.topicID!=null&&this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:t,topic:m.topicID,direction:"outbound"}});if(((h=n.control)==null?void 0:h.prune)!=null)for(const m of(p=n.control)==null?void 0:p.prune)m.topicID!=null&&this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:t,topic:m.topicID,direction:"outbound"}});return!0}piggybackControl(t,n,i){var o,a;const s=hj(n);for(const c of i.graft)c.topicID!=null&&(((o=this.mesh.get(c.topicID))==null?void 0:o.has(t))??!1)&&s.control.graft.push(c);for(const c of i.prune)c.topicID!=null&&!(((a=this.mesh.get(c.topicID))==null?void 0:a.has(t))??!1)&&s.control.prune.push(c)}piggybackGossip(t,n,i){const s=hj(n);s.control.ihave=i}async sendGraftPrune(t,n,i){const s=this.opts.doPX,o=!1;for(const[a,c]of t){const l=c.map(p=>({topicID:p}));let d=[];const h=n.get(a);h!=null&&(d=await Promise.all(h.map(async p=>this.makePrune(a,p,s&&!(i.get(a)??!1),o))),n.delete(a)),this.sendRpc(a,Xs([],{graft:l,prune:d}))}for(const[a,c]of n){const l=await Promise.all(c.map(async d=>this.makePrune(a,d,s&&!(i.get(a)??!1),o)));this.sendRpc(a,Xs([],{prune:l}))}}emitGossip(t){const n=this.mcache.getGossipIDs(new Set(t.keys()));for(const[i,s]of t)this.doEmitGossip(i,s,n.get(i)??[])}doEmitGossip(t,n,i){if(i.length===0||(la(i),i.length>Uh&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",i.length),n.size===0))return;let s=this.opts.Dlazy;const a=this.opts.gossipFactor*n.size;let c=n;a>s&&(s=a),s>c.size?s=c.size:c=la(Array.from(c)).slice(0,s),c.forEach(l=>{let d=i;i.length>Uh&&(d=la(d.slice()).slice(0,Uh)),this.pushGossip(l,{topicID:t,messageIDs:d})})}flush(){for(const[t,n]of this.gossip.entries())this.gossip.delete(t),this.sendRpc(t,Xs([],{ihave:n}));for(const[t,n]of this.control.entries()){this.control.delete(t);const i=Xs([],{graft:n.graft,prune:n.prune});this.sendRpc(t,i)}}pushGossip(t,n){this.log("Add gossip to %s",t);const i=this.gossip.get(t)??[];this.gossip.set(t,i.concat(n))}async makePrune(t,n,i,s){var d;if(this.score.prune(t,n),((d=this.streamsOutbound.get(t))==null?void 0:d.protocol)===oj)return{topicID:n,peers:[]};const o=s?this.opts.unsubcribeBackoff:this.opts.pruneBackoff,a=o/1e3;if(this.doAddBackoff(t,n,o),!i)return{topicID:n,peers:[],backoff:a};const c=this.getRandomGossipPeers(n,this.opts.prunePeers,h=>h!==t&&this.score.score(h)>=0),l=await Promise.all(Array.from(c).map(async h=>{const p=this.peers.get(h)??tr(h);let m;try{m=await this.components.peerStore.get(p)}catch(f){if(f.name!=="NotFoundError")throw f}return{peerID:p.toMultihash().bytes,signedPeerRecord:m==null?void 0:m.peerRecordEnvelope}}));return{topicID:n,peers:l,backoff:a}}async heartbeat(){var g,v;const{D:t,Dlo:n,Dhi:i,Dscore:s,Dout:o,fanoutTTL:a}=this.opts;this.heartbeatTicks++;const c=new Map,l=y=>{let w=c.get(y);return w===void 0&&(w=this.score.score(y),c.set(y,w)),w},d=new Map,h=new Map,p=new Map;this.clearBackoff(),this.peerhave.clear(),(g=this.metrics)==null||g.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.idontwantCounts.clear();for(const y of this.idontwants.values())for(const[w,b]of y)this.heartbeatTicks-b>=this.opts.mcacheLength&&y.delete(w);this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),(v=this.fastMsgIdCache)==null||v.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const m=new Map;this.mesh.forEach((y,w)=>{const b=this.topics.get(w),E=new Set,A=new Set;if(m.set(w,A),b!=null){const I=la(Array.from(b)),T=this.backoff.get(w);for(const L of I){const z=this.streamsOutbound.get(L);if(z!=null&&this.multicodecs.includes(z.protocol)&&!y.has(L)&&!this.direct.has(L)){const B=l(L);(T==null?void 0:T.has(L))!==!0&&B>=0&&E.add(L),B>=this.opts.scoreThresholds.gossipThreshold&&A.add(L)}}}const k=(I,T)=>{var z;this.log("HEARTBEAT: Remove mesh link to %s in %s",I,w),this.addBackoff(I,w),y.delete(I),l(I)>=this.opts.scoreThresholds.gossipThreshold&&A.add(I),(z=this.metrics)==null||z.onRemoveFromMesh(w,T,1);const L=h.get(I);L==null?h.set(I,[w]):L.push(w)},x=(I,T)=>{var z;this.log("HEARTBEAT: Add mesh link to %s in %s",I,w),this.score.graft(I,w),y.add(I),A.delete(I),(z=this.metrics)==null||z.onAddToMesh(w,T,1);const L=d.get(I);L==null?d.set(I,[w]):L.push(w)};if(y.forEach(I=>{const T=l(I);T<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",I,T,w),k(I,Js.BadScore),p.set(I,!0))}),y.size<n){const I=t-y.size;EAe(E,I).forEach(L=>{x(L,Un.NotEnough)})}if(y.size>i){let I=Array.from(y);I.sort((L,z)=>l(z)-l(L)),I=I.slice(0,s).concat(la(I.slice(s)));let T=0;if(I.slice(0,t).forEach(L=>{(this.outbound.get(L)??!1)&&T++}),T<o){const L=B=>{const G=I[B];for(let j=B;j>0;j--)I[j]=I[j-1];I[0]=G};if(T>0){let B=T;for(let G=1;G<t&&B>0;G++)(this.outbound.get(I[G])??!1)&&(L(G),B--)}let z=t-T;for(let B=t;B<I.length&&z>0;B++)(this.outbound.get(I[B])??!1)&&(L(B),z--)}I.slice(t).forEach(L=>{k(L,Js.Excess)})}if(y.size>=n){let I=0;if(y.forEach(T=>{(this.outbound.get(T)??!1)&&I++}),I<o){const T=o-I;kA(E,T,z=>this.outbound.get(z)===!0).forEach(z=>{x(z,Un.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&y.size>1){const I=Array.from(y).sort((z,B)=>l(z)-l(B)),T=Math.floor(y.size/2),L=l(I[T]);if(L<this.opts.scoreThresholds.opportunisticGraftThreshold){const z=this.opts.opportunisticGraftPeers,B=kA(E,z,G=>l(G)>L);for(const G of B)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",G,w),x(G,Un.Opportunistic)}}});const f=Date.now();this.fanoutLastpub.forEach((y,w)=>{y+a<f&&(this.fanout.delete(w),this.fanoutLastpub.delete(w))}),this.fanout.forEach((y,w)=>{const b=this.topics.get(w);y.forEach(x=>{(!((b==null?void 0:b.has(x))??!1)||l(x)<this.opts.scoreThresholds.publishThreshold)&&y.delete(x)});const E=this.topics.get(w),A=[],k=new Set;if(m.set(w,k),E!=null){const x=la(Array.from(E));for(const I of x){const T=this.streamsOutbound.get(I);if(T!=null&&this.multicodecs.includes(T.protocol)&&!y.has(I)&&!this.direct.has(I)){const L=l(I);L>=this.opts.scoreThresholds.publishThreshold&&A.push(I),L>=this.opts.scoreThresholds.gossipThreshold&&k.add(I)}}}if(y.size<t){const x=t-y.size;A.slice(0,x).forEach(I=>{y.add(I),k==null||k.delete(I)})}}),this.emitGossip(m),await this.sendGraftPrune(d,h,p),this.flush(),this.mcache.shift(),this.dispatchEvent(new CustomEvent("gossipsub:heartbeat"))}getRandomGossipPeers(t,n,i=()=>!0){const s=this.topics.get(t);if(s==null)return new Set;let o=[];return s.forEach(a=>{const c=this.streamsOutbound.get(a);c!=null&&this.multicodecs.includes(c.protocol)&&i(a)&&o.push(a)}),o=la(o),n>0&&o.length>n&&(o=o.slice(0,n)),new Set(o)}onScrapeMetrics(t){var l,d;t.mcacheSize.set(this.mcache.size),t.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),t.cacheSize.set({cache:"direct"},this.direct.size),t.cacheSize.set({cache:"seenCache"},this.seenCache.size),t.cacheSize.set({cache:"fastMsgIdCache"},((l=this.fastMsgIdCache)==null?void 0:l.size)??0),t.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),t.cacheSize.set({cache:"mcache"},this.mcache.size),t.cacheSize.set({cache:"score"},this.score.size),t.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),t.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),t.cacheSize.set({cache:"topics"},this.topics.size),t.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),t.cacheSize.set({cache:"mesh"},this.mesh.size),t.cacheSize.set({cache:"fanout"},this.fanout.size),t.cacheSize.set({cache:"peers"},this.peers.size),t.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),t.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),t.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),t.cacheSize.set({cache:"gossip"},this.gossip.size),t.cacheSize.set({cache:"control"},this.control.size),t.cacheSize.set({cache:"peerhave"},this.peerhave.size),t.cacheSize.set({cache:"outbound"},this.outbound.size);let n=0;const i=Date.now();t.connectedPeersBackoffSec.reset();for(const h of this.backoff.values()){n+=h.size;for(const[p,m]of h.entries())this.peers.has(p)&&t.connectedPeersBackoffSec.observe(Math.max(0,m-i)/1e3)}t.cacheSize.set({cache:"backoff"},n);let s=0;for(const h of this.idontwants.values())s+=h.size;t.cacheSize.set({cache:"idontwants"},s);for(const[h,p]of this.topics)t.topicPeersCount.set({topicStr:h},p.size);for(const[h,p]of this.mesh)t.meshPeerCounts.set({topicStr:h},p.size);const o=[],a=new Map;t.behaviourPenalty.reset();for(const h of this.peers.keys()){const p=this.score.score(h);o.push(p),a.set(h,p),t.behaviourPenalty.observe(((d=this.score.peerStats.get(h))==null?void 0:d.behaviourPenalty)??0)}t.registerScores(o,this.opts.scoreThresholds),t.registerScorePerMesh(this.mesh,a);const c=TAe(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,t.topicStrToLabel);t.registerScoreWeights(c)}}u(fj,"multicodec",IA);function pj(r={}){return e=>new fj(e,r)}const HAe=r=>{const[e,t]=We.useState(null),[n,i]=We.useState(null);return We.useEffect(()=>{async function s(){try{console.log("Starting OrbitDB initialization for",r);let o;try{o=await WK({libp2p:{transports:[Zx(),Jx(),q9()],transportManager:{faultTolerance:kl.NO_FATAL},peerDiscovery:[z9({list:["/dns4/bootstrap.libp2p.io/tcp/443/wss/p2p/12D3KooWQL1aS4qD3yCjmV7gNmx4F5gP7pNXG1qimV5DXe7tXUn","/dns4/bootstrap.libp2p.io/tcp/443/wss/p2p/12D3KooWAtfLqN4QmgjrZ9eZ9r4L1B7bH7d9eW8fA4n4bBAyKSm","/dns4/relay.libp2p.io/tcp/443/wss/p2p/12D3KooWAdNWhqW6zSMv1tW2aLKNvEfR7f2DubkXq56Y2uLmsdN","/dns4/relay.ipfs.io/tcp/443/wss/p2p/12D3KooWAdNWhqW6zSMv1tW2aLKNvEfR7f2DubkXq56Y2uLmsdN","/dns4/relay.ipfs.io/tcp/443/wss/p2p/12D3KooWAdNWhqW6zSMv1tW2aLKNvEfR7f2DubkXq56Y2uLmsdN"]})],services:{identify:W9(),pubsub:pj()}}}),o.libp2p.addEventListener("peer:connect",l=>{console.log("Connected to peer:",l.detail.toString())}),o.libp2p.addEventListener("peer:disconnect",l=>{console.log("Disconnected from peer:",l.detail.toString())})}catch(l){throw console.error("Failed to initialize Helia:",l),new Error("IPFS initialization failed")}if(console.log("IPFS initialized:",o),!o)throw new Error("IPFS instance is undefined");const a=await l$({ipfs:o});console.log("OrbitDB instance created:",a);const c=await a.open("citizenx-annotations",{type:"documents"});console.log("Database opened:",c),t(c)}catch(o){console.error("OrbitDB initialization failed:",o),i("Failed to initialize decentralized storage")}}s()},[r]),{db:e,error:n}},qAe=(r,e,t)=>{const[n,i]=We.useState([]),[s,o]=We.useState(null);return We.useEffect(()=>{async function d(){if(e)try{const h=r.split("?")[0],m=(await e.all()).filter(f=>f.value.url===h).map(f=>f.value);i(m)}catch(h){console.error("Failed to load annotations:",h),o("Failed to load annotations")}}d(),e&&e.events.on("update",async()=>{const h=r.split("?")[0],m=(await e.all()).filter(f=>f.value.url===h).map(f=>f.value);i(m)})},[e,r]),{annotations:n,error:s,handleSaveAnnotation:async d=>{if(!t)throw new Error("User not authenticated");if(!e)throw new Error("Database not initialized");const h={_id:`${t}-${Date.now()}`,url:r.split("?")[0],text:d,timestamp:Date.now(),did:t,comments:[]};try{await e.put(h),i(p=>[...p,h])}catch(p){console.error("Failed to save annotation:",p),o("Failed to save annotation")}},handleDeleteAnnotation:async d=>{if(!e)throw new Error("Database not initialized");try{await e.del(d),i(h=>h.filter(p=>p._id!==d))}catch(h){console.error("Failed to delete annotation:",h),o("Failed to delete annotation")}},handleSaveComment:async(d,h)=>{if(!t)throw new Error("User not authenticated");if(!e)throw new Error("Database not initialized");try{const p=n.find(g=>g._id===d);if(!p)throw new Error("Annotation not found");const m={_id:`${t}-${Date.now()}`,text:h,timestamp:Date.now(),did:t},f={...p,comments:[...p.comments||[],m]};await e.put(f),i(g=>g.map(v=>v._id===d?f:v))}catch(p){console.error("Failed to save comment:",p),o("Failed to save comment")}}}},gj=r=>{const[e,t]=We.useState(new Map),[n,i]=We.useState(!0),[s,o]=We.useState(null),[a,c]=We.useState(null);return We.useEffect(()=>{console.log("useUserProfiles: Current DID:",r);async function h(){try{console.log("Initializing user profiles database...");const p=await WK({libp2p:{transports:[Zx(),Jx(),q9()],transportManager:{faultTolerance:kl.NO_FATAL},peerDiscovery:[z9({list:["/dns4/bootstrap.libp2p.io/tcp/443/wss/p2p/12D3KooWQL1aS4qD3yCjmV7gNmx4F5gP7pNXG1qimV5DXe7tXUn","/dns4/bootstrap.libp2p.io/tcp/443/wss/p2p/12D3KooWAtfLqN4QmgjrZ9eZ9r4L1B7bH7d9eW8fA4n4bBAyKSm","/dns4/relay.libp2p.io/tcp/443/wss/p2p/12D3KooWAdNWhqW6zSMv1tW2aLKNvEfR7f2DubkXq56Y2uLmsdN","/dns4/relay.ipfs.io/tcp/443/wss/p2p/12D3KooWAdNWhqW6zSMv1tW2aLKNvEfR7f2DubkXq56Y2uLmsdN","/dns4/relay.ipfs.io/tcp/443/wss/p2p/12D3KooWAdNWhqW6zSMv1tW2aLKNvEfR7f2DubkXq56Y2uLmsdN","/dns4/go-ipfs-bootstrap-1.ipfs.dwebops.pub/tcp/443/wss/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZguyWvRmga5yW","/dns4/go-ipfs-bootstrap-2.ipfs.dwebops.pub/tcp/443/wss/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZguyWvRmga5yX"]})],services:{identify:W9(),pubsub:pj()}}});p.libp2p.addEventListener("peer:connect",b=>{console.log("Connected to peer:",b.detail.toString())}),p.libp2p.addEventListener("peer:disconnect",b=>{console.log("Disconnected from peer:",b.detail.toString())}),console.log("IPFS initialized for user profiles:",p);const f=await(await l$({ipfs:p})).open("citizenx-user-profiles",{type:"documents"});console.log("User profiles database opened:",f),c(f);const g=await f.all(),v=new Map;g.forEach(b=>{v.set(b.value._id,b.value)});const y=localStorage.getItem("citizenx-user-profiles")||"[]";console.log("Raw localStorage profiles:",y);const w=JSON.parse(y);console.log("Parsed localStorage profiles:",w),w.forEach(b=>{v.has(b._id)||v.set(b._id,b)}),t(v),console.log("Initial profiles loaded:",Array.from(v.entries())),i(!1),f.events.on("update",async()=>{const b=await f.all(),E=new Map;b.forEach(k=>{E.set(k.value._id,k.value)}),JSON.parse(localStorage.getItem("citizenx-user-profiles")||"[]").forEach(k=>{E.has(k._id)||E.set(k._id,k)}),t(E),console.log("User profiles updated:",Array.from(E.entries()))}),f.events.on("peer",async()=>{console.log("Peer connected, syncing local profiles to OrbitDB");const b=JSON.parse(localStorage.getItem("citizenx-user-profiles")||"[]");for(const k of b)try{await f.put(k),console.log("Synced local profile to OrbitDB:",k)}catch(x){console.error("Failed to sync local profile:",x)}localStorage.setItem("citizenx-user-profiles",JSON.stringify([]));const E=await f.all(),A=new Map;E.forEach(k=>{A.set(k.value._id,k.value)}),t(A),console.log("Profiles after sync:",Array.from(A.entries()))})}catch(p){console.error("Failed to initialize user profiles database:",p),o("Failed to initialize user profiles database"),i(!1)}}h()},[]),{profiles:e,createProfile:async(h,p)=>{if(!r)throw new Error("User not authenticated");const m={_id:r,handle:h,profilePicture:p};try{if(!a)throw new Error("Database not initialized");await a.put(m),console.log("User profile created:",m),t(f=>{const g=new Map(f);return g.set(r,m),console.log("Profiles after create:",Array.from(g.entries())),g})}catch(f){if(f.message.includes("NoPeersSubscribedToTopic")){console.warn("No peers subscribed, saving profile to localStorage:",m);const g=JSON.parse(localStorage.getItem("citizenx-user-profiles")||"[]"),v=g.findIndex(y=>y._id===r);v!==-1?g[v]=m:g.push(m),localStorage.setItem("citizenx-user-profiles",JSON.stringify(g)),t(y=>{const w=new Map(y);return w.set(r,m),console.log("Profiles after local save:",Array.from(w.entries())),JSON.parse(localStorage.getItem("citizenx-user-profiles")||"[]").forEach(E=>{w.has(E._id)||w.set(E._id,E)}),console.log("Profiles after refresh:",Array.from(w.entries())),w})}else throw console.error("Failed to create user profile:",f),f}},updateProfile:async(h,p)=>{if(!r)throw new Error("User not authenticated");try{if(!a)throw new Error("Database not initialized");const m=await a.get(r);if(!m)throw new Error("User profile not found");const f={...m,handle:h,profilePicture:p};await a.put(f),console.log("User profile updated:",f),t(g=>{const v=new Map(g);return v.set(r,f),console.log("Profiles after update:",Array.from(v.entries())),v})}catch(m){if(m.message.includes("NoPeersSubscribedToTopic")){console.warn("No peers subscribed, updating profile in localStorage:",{did:r,handle:h,profilePicture:p});const f=JSON.parse(localStorage.getItem("citizenx-user-profiles")||"[]"),g=f.findIndex(y=>y._id===r),v={_id:r,handle:h,profilePicture:p};g!==-1?f[g]=v:f.push(v),localStorage.setItem("citizenx-user-profiles",JSON.stringify(f)),t(y=>{const w=new Map(y);return w.set(r,v),console.log("Profiles after local update:",Array.from(w.entries())),w})}else throw console.error("Failed to update user profile:",m),m}},loading:n,error:s}};async function WAe(){const r=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]),e=await crypto.subtle.exportKey("spki",r.publicKey),t=btoa(String.fromCharCode(...new Uint8Array(e))),n=await crypto.subtle.exportKey("pkcs8",r.privateKey),i=btoa(String.fromCharCode(...new Uint8Array(n)));return{publicKey:t,privateKey:i,rawPublicKey:r.publicKey,rawPrivateKey:r.privateKey}}async function yj(r,e){const t=Uint8Array.from(atob(e),a=>a.charCodeAt(0)),n=await crypto.subtle.importKey("pkcs8",t,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]),s=new TextEncoder().encode(r),o=await crypto.subtle.sign({name:"ECDSA",hash:"SHA-256"},n,s);return btoa(String.fromCharCode(...new Uint8Array(o)))}async function mj(r,e,t){const n=Uint8Array.from(atob(t),c=>c.charCodeAt(0)),i=await crypto.subtle.importKey("spki",n,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),s=Uint8Array.from(atob(e),c=>c.charCodeAt(0)),a=new TextEncoder().encode(r);return await crypto.subtle.verify({name:"ECDSA",hash:"SHA-256"},i,s,a)}async function GAe(r,e){const t=new TextEncoder,n=t.encode(e),i=crypto.getRandomValues(new Uint8Array(16)),s=await crypto.subtle.importKey("raw",n,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]),o=await crypto.subtle.deriveKey({name:"PBKDF2",salt:i,iterations:1e5,hash:"SHA-256"},s,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),a=crypto.getRandomValues(new Uint8Array(12)),c=t.encode(r),l=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},o,c),d=new Uint8Array(i.length+a.length+l.byteLength);return d.set(i,0),d.set(a,i.length),d.set(new Uint8Array(l),i.length+a.length),btoa(String.fromCharCode(...d))}async function QAe(r,e){const t=Uint8Array.from(atob(r),h=>h.charCodeAt(0)),n=t.slice(0,16),i=t.slice(16,28),s=t.slice(28),a=new TextEncoder().encode(e),c=await crypto.subtle.importKey("raw",a,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]),l=await crypto.subtle.deriveKey({name:"PBKDF2",salt:n,iterations:1e5,hash:"SHA-256"},c,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),d=await crypto.subtle.decrypt({name:"AES-GCM",iv:i},l,s);return new TextDecoder().decode(d)}const YAe=()=>{const[r,e]=We.useState(null),[t,n]=We.useState(null),[i,s]=We.useState(null),{profiles:o,loading:a,createProfile:c,updateProfile:l,error:d}=gj(r);return We.useEffect(()=>{const g=chrome;if(!g.storage||!g.storage.local){n("chrome.storage.local is not available");return}g.storage.local.get(["did"],v=>{if(v.did){e(v.did),console.log("useAuth: Initial DID from storage:",v.did);const y=localStorage.getItem("citizenx-user-profiles")||"[]";console.log("useAuth: Checking localStorage profiles for DID mismatch:",y);let w;try{w=JSON.parse(y)}catch(E){console.error("useAuth: Failed to parse localStorage profiles:",E),w=[]}const b=w.find(E=>(console.log("useAuth: Comparing DID",v.did,"with profile _id",E._id),E._id===v.did));!b&&w.length>0&&(console.log("useAuth: DID mismatch detected, clearing stale profiles"),localStorage.setItem("citizenx-user-profiles",JSON.stringify([]))),b&&(console.log("useAuth: Setting initial profile from localStorage:",b),s(b))}else console.log("useAuth: No DID found in storage")})},[]),We.useEffect(()=>{if(console.log("useAuth: Loading profiles, loading:",a,"profiles:",Array.from(o.entries())),r&&!a){const g=o.get(r);console.log("useAuth: Profile for DID",r,":",g),s(g||null)}},[r,o,a]),{did:r,profile:i,loading:a,authenticate:async()=>{try{const g=chrome;if(!g.storage||!g.storage.local)throw new Error("chrome.storage.local is not available");const v=await new Promise(y=>{g.storage.local.get(["did","privateKey"],y)});if(v.did&&v.privateKey){e(v.did),console.log("useAuth: Authenticated DID:",v.did);const y=Date.now().toString(),w=await yj(y,v.privateKey);if(!await mj(y,w,v.did))throw new Error("Failed to verify existing key pair");n(null)}else{const y=await WAe();g.storage.local.set({did:y.publicKey,privateKey:y.privateKey},()=>{console.log("useAuth: Key pair stored in chrome.storage.local"),e(y.publicKey),console.log("useAuth: New authenticated DID:",y.publicKey),n(null)})}}catch(g){console.error("useAuth: Authentication error:",g),n(g.message),e(null)}},signOut:()=>{e(null),s(null),n(null);const g=chrome;g.storage&&g.storage.local&&(g.storage.local.remove(["did","privateKey"],()=>{console.log("useAuth: Cleared DID and private key from chrome.storage.local")}),localStorage.setItem("citizenx-user-profiles",JSON.stringify([])),console.log("useAuth: Cleared profiles from localStorage"))},exportIdentity:async g=>{const v=chrome;if(!v.storage||!v.storage.local)throw new Error("chrome.storage.local is not available");const y=await new Promise(E=>{v.storage.local.get(["did","privateKey"],E)});if(!y.did||!y.privateKey)throw new Error("No identity found to export");const w=await GAe(y.privateKey,g);return JSON.stringify({did:y.did,privateKey:w})},importIdentity:async(g,v)=>{try{const y=chrome;if(!y.storage||!y.storage.local)throw new Error("chrome.storage.local is not available");const{did:w,privateKey:b}=JSON.parse(g),E=await QAe(b,v),A=Date.now().toString(),k=await yj(A,E);if(!await mj(A,k,w))throw new Error("Invalid key pair or passphrase");y.storage.local.set({did:w,privateKey:E},()=>{console.log("useAuth: Imported identity stored in chrome.storage.local"),e(w),console.log("useAuth: Imported DID:",w),n(null)})}catch(y){throw console.error("useAuth: Import error:",y),n(y.message),e(null),y}},createProfile:c,updateProfile:l,error:t||d}},JAe=({comment:r,creatorProfile:e})=>Ae.jsxs("div",{style:{marginLeft:"1rem",marginTop:"0.5rem",borderLeft:"2px solid #e5e7eb",paddingLeft:"0.5rem"},children:[Ae.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.25rem"},children:[(e==null?void 0:e.profilePicture)&&Ae.jsx("img",{src:e.profilePicture,alt:"Profile",style:{width:"1.5rem",height:"1.5rem",borderRadius:"50%",marginRight:"0.5rem"}}),Ae.jsxs("p",{style:{margin:"0",fontSize:"0.8rem",color:"#666"},children:[(e==null?void 0:e.handle)||"Anonymous"," • ",new Date(r.timestamp).toLocaleString()]})]}),Ae.jsx("p",{style:{margin:"0",fontSize:"0.9rem",color:"#333"},children:r.text})]}),XAe=({annotations:r,profiles:e,onDelete:t,onSaveComment:n})=>{const[i,s]=We.useState({}),o=async a=>{if(!(!n||!i[a]))try{await n(a,i[a]),s(c=>({...c,[a]:""}))}catch(c){console.error("Failed to submit comment:",c)}};return Ae.jsx("div",{children:r.map(a=>{const c=e.get(a.did||"");return Ae.jsxs("div",{style:{background:"#fff",padding:"0.5rem",border:"1px solid #e5e7eb",borderRadius:"5px",marginBottom:"0.5rem"},children:[Ae.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[Ae.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[(c==null?void 0:c.profilePicture)&&Ae.jsx("img",{src:c.profilePicture,alt:"Profile",style:{width:"1.5rem",height:"1.5rem",borderRadius:"50%",marginRight:"0.5rem"}}),Ae.jsxs("p",{style:{margin:"0",fontSize:"0.9rem",color:"#333"},children:[(c==null?void 0:c.handle)||"Anonymous"," • ",new Date(a.timestamp).toLocaleString()]})]}),Ae.jsx("button",{onClick:()=>t(a._id),style:{padding:"0.25rem 0.5rem",background:"#e11d48",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",fontSize:"0.8rem"},onMouseEnter:l=>l.currentTarget.style.backgroundColor="#f43f5e",onMouseLeave:l=>l.currentTarget.style.backgroundColor="#e11d48",children:"Delete"})]}),Ae.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.9rem",color:"#333"},children:a.text}),a.comments&&a.comments.length>0&&Ae.jsx("div",{style:{marginTop:"0.5rem"},children:a.comments.map(l=>Ae.jsx(JAe,{comment:l,creatorProfile:e.get(l.did)},l._id))}),n&&Ae.jsxs("div",{style:{marginTop:"0.5rem"},children:[Ae.jsx("textarea",{value:i[a._id]||"",onChange:l=>s(d=>({...d,[a._id]:l.target.value})),placeholder:"Add a comment...",style:{width:"100%",height:"3rem",marginBottom:"0.5rem",fontSize:"0.9rem",border:"1px solid #e5e7eb",borderRadius:"5px",padding:"0.5rem",color:"#333",backgroundColor:"#fff"}}),Ae.jsx("button",{onClick:()=>o(a._id),disabled:!i[a._id],style:{padding:"0.5rem 1rem",background:i[a._id]?"#2c7a7b":"#d1d5db",color:"#fff",border:"none",borderRadius:"5px",cursor:i[a._id]?"pointer":"not-allowed",width:"100%",fontSize:"0.9rem"},onMouseEnter:l=>i[a._id]&&(l.currentTarget.style.backgroundColor="#4a999a"),onMouseLeave:l=>i[a._id]&&(l.currentTarget.style.backgroundColor="#2c7a7b"),children:"Add Comment"})]})]},a._id)})})},ZAe=({url:r})=>{const[e,t]=We.useState(""),{did:n,profile:i,loading:s,authenticate:o,signOut:a,exportIdentity:c,importIdentity:l,createProfile:d,updateProfile:h,error:p}=YAe(),{profiles:m,error:f}=gj(n),[g,v]=We.useState(""),[y,w]=We.useState(""),[b,E]=We.useState(""),[A,k]=We.useState(""),[x,I]=We.useState(""),[T,L]=We.useState(""),[z,B]=We.useState(!1),[G,j]=We.useState(!1),[q,Q]=We.useState(""),[K,O]=We.useState(""),[U,W]=We.useState(!1),Y=We.useRef(null),H=r.startsWith("chrome-extension://"),{db:ie,error:me}=H?{db:null,error:null}:HAe(r),{annotations:de,error:le,handleSaveAnnotation:Ne,handleDeleteAnnotation:Me,handleSaveComment:Xe}=H?{annotations:[],error:null,handleSaveAnnotation:async()=>{},handleDeleteAnnotation:async()=>{},handleSaveComment:async()=>{}}:qAe(r,ie,n),nt=p||me||le||f;We.useEffect(()=>{console.log("AnnotationUI: Checking profile modal conditions - loading:",s,"did:",n,"profile:",i),!s&&n&&!i&&(console.log("AnnotationUI: Opening Update Profile modal"),B(!0))},[n,i,s]),We.useEffect(()=>{const pe=ws=>{Y.current&&!Y.current.contains(ws.target)&&W(!1)};return document.addEventListener("mousedown",pe),()=>{document.removeEventListener("mousedown",pe)}},[]);const It=async()=>{await Ne(e),t("")},kt=async()=>{try{if(!b){L("Please enter a passphrase to export your identity");return}const pe=await c(b);v(pe),L("")}catch(pe){L(pe.message)}},$t=async()=>{try{if(!y||!A){I("Please enter the identity data and passphrase");return}await l(y,A),w(""),k(""),I(""),v("")}catch(pe){I(pe.message)}},nr=async()=>{try{if(!q||!K){L("Please provide a handle and profile picture");return}i?await h(q,K):await d(q,K),B(!1),Q(""),O(""),W(!1)}catch(pe){L(pe.message)}},Nr=pe=>{var to;const ws=(to=pe.target.files)==null?void 0:to[0];if(ws){const bs=new FileReader;bs.onload=bn=>{var Wc;(Wc=bn.target)!=null&&Wc.result&&O(bn.target.result)},bs.readAsDataURL(ws)}},fa=()=>{W(pe=>!pe)},eo=()=>{W(!1),j(!0),E(""),v(""),L("")};return Ae.jsxs("div",{style:{padding:"1rem",width:"100%",backgroundColor:"#f5f7fa",minHeight:"100vh",fontFamily:"Arial, sans-serif"},children:[n?Ae.jsx("div",{style:{marginBottom:"1rem",backgroundColor:"#fff",padding:"0.5rem",borderRadius:"5px",border:"1px solid #e5e7eb"},children:Ae.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},children:[Ae.jsxs("div",{style:{display:"flex",alignItems:"center",flexShrink:0},children:[i&&i.profilePicture&&Ae.jsx("img",{src:i.profilePicture,alt:"Profile",style:{width:"2rem",height:"2rem",borderRadius:"50%",marginRight:"0.5rem"}}),Ae.jsxs("p",{style:{margin:"0",fontSize:"0.9rem",color:"#333",whiteSpace:"nowrap"},children:["Connected: ",(i==null?void 0:i.handle)||"Set your handle"]})]}),Ae.jsxs("div",{style:{position:"relative",flexShrink:0},children:[Ae.jsx("button",{onClick:fa,style:{padding:"0.25rem",background:"none",border:"none",cursor:"pointer"},"aria-label":"Settings",children:Ae.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.25rem",height:"1.25rem",viewBox:"0 0 24 24",fill:"none",stroke:"#2c7a7b",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[Ae.jsx("circle",{cx:"12",cy:"12",r:"3"}),Ae.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l-.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h-.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l-.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v-.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l-.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})}),U&&Ae.jsxs("div",{ref:Y,style:{position:"absolute",right:0,top:"100%",background:"#fff",border:"1px solid #e5e7eb",borderRadius:"5px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",zIndex:1e3},children:[Ae.jsx("button",{onClick:()=>B(!0),style:{display:"block",padding:"0.5rem 1rem",background:"none",border:"none",width:"100%",textAlign:"left",cursor:"pointer",color:"#333",fontSize:"0.9rem"},onMouseEnter:pe=>pe.currentTarget.style.backgroundColor="#f5f7fa",onMouseLeave:pe=>pe.currentTarget.style.backgroundColor="transparent",children:"Edit Profile"}),Ae.jsx("button",{onClick:eo,style:{display:"block",padding:"0.5rem 1rem",background:"none",border:"none",width:"100%",textAlign:"left",cursor:"pointer",color:"#333",fontSize:"0.9rem"},onMouseEnter:pe=>pe.currentTarget.style.backgroundColor="#f5f7fa",onMouseLeave:pe=>pe.currentTarget.style.backgroundColor="transparent",children:"Export Identity"}),Ae.jsx("button",{onClick:a,style:{display:"block",padding:"0.5rem 1rem",background:"none",border:"none",width:"100%",textAlign:"left",cursor:"pointer",color:"#f97316",fontSize:"0.9rem"},onMouseEnter:pe=>pe.currentTarget.style.backgroundColor="#f5f7fa",onMouseLeave:pe=>pe.currentTarget.style.backgroundColor="transparent",children:"Sign Out"})]})]})]})}):Ae.jsxs("div",{style:{marginBottom:"1rem"},children:[Ae.jsx("button",{onClick:o,style:{padding:"0.5rem 1rem",background:"#2c7a7b",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",width:"100%",fontSize:"0.9rem"},onMouseEnter:pe=>pe.currentTarget.style.backgroundColor="#4a999a",onMouseLeave:pe=>pe.currentTarget.style.backgroundColor="#2c7a7b",children:"Authenticate"}),Ae.jsxs("div",{style:{marginTop:"0.5rem"},children:[Ae.jsx("textarea",{value:y,onChange:pe=>w(pe.target.value),placeholder:"Paste your exported identity here...",style:{width:"100%",height:"3.75rem",marginBottom:"0.5rem",fontSize:"0.8rem",border:"1px solid #e5e7eb",borderRadius:"5px",padding:"0.5rem",color:"#333",backgroundColor:"#fff"}}),Ae.jsx("input",{type:"password",placeholder:"Enter passphrase to import",value:A,onChange:pe=>k(pe.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem",border:"1px solid #e5e7eb",borderRadius:"5px",fontSize:"0.9rem",color:"#333",backgroundColor:"#fff"}}),Ae.jsx("button",{onClick:$t,style:{padding:"0.5rem 1rem",background:"#2c7a7b",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",width:"100%",fontSize:"0.9rem"},onMouseEnter:pe=>pe.currentTarget.style.backgroundColor="#4a999a",onMouseLeave:pe=>pe.currentTarget.style.backgroundColor="#2c7a7b",children:"Import Identity"}),x&&Ae.jsx("p",{style:{color:"#e11d48",margin:"0.25rem 0 0 0",fontSize:"0.8rem"},children:x})]})]}),z&&Ae.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"#fff",padding:"1rem",borderRadius:"5px",boxShadow:"0 0 10px rgba(0,0,0,0.3)",zIndex:1e3,width:"90%",maxWidth:"400px"},children:[Ae.jsx("h2",{style:{fontSize:"1.2rem",margin:"0 0 0.5rem 0",color:"#333"},children:i?"Update Profile":"Set Profile"}),Ae.jsx("input",{type:"text",placeholder:"Enter your handle",value:q,onChange:pe=>Q(pe.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem",border:"1px solid #e5e7eb",borderRadius:"5px",fontSize:"0.9rem",color:"#333",backgroundColor:"#fff"}}),Ae.jsx("input",{type:"file",accept:"image/*",onChange:Nr,style:{width:"100%",marginBottom:"0.5rem"}}),K&&Ae.jsx("img",{src:K,alt:"Preview",style:{width:"3.125rem",height:"3.125rem",borderRadius:"50%",marginBottom:"0.5rem"}}),Ae.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[Ae.jsx("button",{onClick:nr,style:{padding:"0.5rem 1rem",background:"#2c7a7b",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",fontSize:"0.9rem",flex:1},onMouseEnter:pe=>pe.currentTarget.style.backgroundColor="#4a999a",onMouseLeave:pe=>pe.currentTarget.style.backgroundColor="#2c7a7b",children:"Save"}),Ae.jsx("button",{onClick:()=>B(!1),style:{padding:"0.5rem 1rem",background:"#f97316",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",fontSize:"0.9rem",flex:1},onMouseEnter:pe=>pe.currentTarget.style.backgroundColor="#fb923c",onMouseLeave:pe=>pe.currentTarget.style.backgroundColor="#f97316",children:"Cancel"})]})]}),G&&Ae.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"#fff",padding:"1rem",borderRadius:"5px",boxShadow:"0 0 10px rgba(0,0,0,0.3)",zIndex:1e3,width:"90%",maxWidth:"400px"},children:[Ae.jsx("h2",{style:{fontSize:"1.2rem",margin:"0 0 0.5rem 0",color:"#333"},children:"Export Identity"}),Ae.jsx("input",{type:"password",placeholder:"Enter passphrase to export",value:b,onChange:pe=>E(pe.target.value),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem",border:"1px solid #e5e7eb",borderRadius:"5px",fontSize:"0.9rem",color:"#333",backgroundColor:"#fff"}}),Ae.jsx("button",{onClick:kt,style:{padding:"0.5rem 1rem",background:"#2c7a7b",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",width:"100%",fontSize:"0.9rem",marginBottom:"0.5rem"},onMouseEnter:pe=>pe.currentTarget.style.backgroundColor="#4a999a",onMouseLeave:pe=>pe.currentTarget.style.backgroundColor="#2c7a7b",children:"Export"}),T&&Ae.jsx("p",{style:{color:"#e11d48",margin:"0.25rem 0 0.5rem 0",fontSize:"0.8rem"},children:T}),g&&Ae.jsx("textarea",{value:g,readOnly:!0,style:{width:"100%",height:"3.75rem",marginBottom:"0.5rem",fontSize:"0.8rem",border:"1px solid #e5e7eb",borderRadius:"5px",padding:"0.5rem",color:"#333",backgroundColor:"#fff"}}),Ae.jsx("button",{onClick:()=>j(!1),style:{padding:"0.5rem 1rem",background:"#f97316",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",width:"100%",fontSize:"0.9rem"},onMouseEnter:pe=>pe.currentTarget.style.backgroundColor="#fb923c",onMouseLeave:pe=>pe.currentTarget.style.backgroundColor="#f97316",children:"Close"})]}),nt&&Ae.jsx("p",{style:{color:"#e11d48",margin:"0 0 0.5rem 0",fontSize:"0.8rem"},children:nt}),Ae.jsx("textarea",{value:e,onChange:pe=>t(pe.target.value),placeholder:"Enter annotation...",style:{width:"100%",height:"5rem",marginBottom:"0.5rem",fontSize:"0.9rem",border:"1px solid #e5e7eb",borderRadius:"5px",padding:"0.5rem",color:"#333",backgroundColor:"#fff"}}),Ae.jsx("button",{onClick:It,disabled:!n||!ie,style:{padding:"0.5rem 1rem",background:n&&ie?"#2c7a7b":"#d1d5db",color:"#fff",border:"none",borderRadius:"5px",cursor:n&&ie?"pointer":"not-allowed",marginBottom:"1rem",width:"100%",fontSize:"0.9rem"},onMouseEnter:pe=>n&&ie&&(pe.currentTarget.style.backgroundColor="#4a999a"),onMouseLeave:pe=>n&&ie&&(pe.currentTarget.style.backgroundColor="#2c7a7b"),children:"Save"}),Ae.jsx(XAe,{annotations:de,profiles:m,onDelete:Me,onSaveComment:n&&ie?Xe:void 0})]})},eCe=()=>{const[r,e]=We.useState(null);return We.useEffect(()=>{const t=()=>{chrome.tabs.query({active:!0,currentWindow:!0},s=>{var o;(o=s[0])!=null&&o.url?e(s[0].url):(console.error("Failed to get current tab URL"),e(""))})};t();const n=(s,o,a)=>{o.url&&a.active&&e(o.url)};chrome.tabs.onUpdated.addListener(n);const i=()=>{t()};return chrome.tabs.onActivated.addListener(i),()=>{chrome.tabs.onUpdated.removeListener(n),chrome.tabs.onActivated.removeListener(i)}},[]),r===null?Ae.jsx("div",{children:"Loading..."}):Ae.jsx(ZAe,{url:r})},wj=document.getElementById("root");wj?n_(wj).render(Ae.jsx(eCe,{})):console.error("Root element not found")})();
