var Sre=Object.defineProperty;var tD=r=>{throw TypeError(r)};var Cre=(r,e,t)=>e in r?Sre(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var h=(r,e,t)=>Cre(r,typeof e!="symbol"?e+"":e,t),V7=(r,e,t)=>e.has(r)||tD("Cannot "+t);var T=(r,e,t)=>(V7(r,e,"read from private field"),t?t.call(r):e.get(r)),Q=(r,e,t)=>e.has(r)?tD("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),M=(r,e,t,n)=>(V7(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),te=(r,e,t)=>(V7(r,e,"access private method"),t);var ts=(r,e,t,n)=>({set _(s){M(r,e,s,t)},get _(){return T(r,e,n)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var W2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zu(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var tH={exports:{}},t5={},rH={exports:{}},nt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Em=Symbol.for("react.element"),Ire=Symbol.for("react.portal"),kre=Symbol.for("react.fragment"),Tre=Symbol.for("react.strict_mode"),_re=Symbol.for("react.profiler"),Pre=Symbol.for("react.provider"),Nre=Symbol.for("react.context"),Dre=Symbol.for("react.forward_ref"),Ore=Symbol.for("react.suspense"),Rre=Symbol.for("react.memo"),Bre=Symbol.for("react.lazy"),rD=Symbol.iterator;function Mre(r){return r===null||typeof r!="object"?null:(r=rD&&r[rD]||r["@@iterator"],typeof r=="function"?r:null)}var nH={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},sH=Object.assign,iH={};function F1(r,e,t){this.props=r,this.context=e,this.refs=iH,this.updater=t||nH}F1.prototype.isReactComponent={};F1.prototype.setState=function(r,e){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,e,"setState")};F1.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function oH(){}oH.prototype=F1.prototype;function Sk(r,e,t){this.props=r,this.context=e,this.refs=iH,this.updater=t||nH}var Ck=Sk.prototype=new oH;Ck.constructor=Sk;sH(Ck,F1.prototype);Ck.isPureReactComponent=!0;var nD=Array.isArray,aH=Object.prototype.hasOwnProperty,Ik={current:null},cH={key:!0,ref:!0,__self:!0,__source:!0};function lH(r,e,t){var n,s={},i=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)aH.call(e,n)&&!cH.hasOwnProperty(n)&&(s[n]=e[n]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];s.children=c}if(r&&r.defaultProps)for(n in a=r.defaultProps,a)s[n]===void 0&&(s[n]=a[n]);return{$$typeof:Em,type:r,key:i,ref:o,props:s,_owner:Ik.current}}function $re(r,e){return{$$typeof:Em,type:r.type,key:e,ref:r.ref,props:r.props,_owner:r._owner}}function kk(r){return typeof r=="object"&&r!==null&&r.$$typeof===Em}function Lre(r){var e={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(t){return e[t]})}var sD=/\/+/g;function H7(r,e){return typeof r=="object"&&r!==null&&r.key!=null?Lre(""+r.key):e.toString(36)}function B3(r,e,t,n,s){var i=typeof r;(i==="undefined"||i==="boolean")&&(r=null);var o=!1;if(r===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(r.$$typeof){case Em:case Ire:o=!0}}if(o)return o=r,s=s(o),r=n===""?"."+H7(o,0):n,nD(s)?(t="",r!=null&&(t=r.replace(sD,"$&/")+"/"),B3(s,e,t,"",function(l){return l})):s!=null&&(kk(s)&&(s=$re(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(sD,"$&/")+"/")+r)),e.push(s)),1;if(o=0,n=n===""?".":n+":",nD(r))for(var a=0;a<r.length;a++){i=r[a];var c=n+H7(i,a);o+=B3(i,e,t,c,s)}else if(c=Mre(r),typeof c=="function")for(r=c.call(r),a=0;!(i=r.next()).done;)i=i.value,c=n+H7(i,a++),o+=B3(i,e,t,c,s);else if(i==="object")throw e=String(r),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function yw(r,e,t){if(r==null)return r;var n=[],s=0;return B3(r,n,"","",function(i){return e.call(t,i,s++)}),n}function Ure(r){if(r._status===-1){var e=r._result;e=e(),e.then(function(t){(r._status===0||r._status===-1)&&(r._status=1,r._result=t)},function(t){(r._status===0||r._status===-1)&&(r._status=2,r._result=t)}),r._status===-1&&(r._status=0,r._result=e)}if(r._status===1)return r._result.default;throw r._result}var Xn={current:null},M3={transition:null},Fre={ReactCurrentDispatcher:Xn,ReactCurrentBatchConfig:M3,ReactCurrentOwner:Ik};function uH(){throw Error("act(...) is not supported in production builds of React.")}nt.Children={map:yw,forEach:function(r,e,t){yw(r,function(){e.apply(this,arguments)},t)},count:function(r){var e=0;return yw(r,function(){e++}),e},toArray:function(r){return yw(r,function(e){return e})||[]},only:function(r){if(!kk(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};nt.Component=F1;nt.Fragment=kre;nt.Profiler=_re;nt.PureComponent=Sk;nt.StrictMode=Tre;nt.Suspense=Ore;nt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Fre;nt.act=uH;nt.cloneElement=function(r,e,t){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var n=sH({},r.props),s=r.key,i=r.ref,o=r._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Ik.current),e.key!==void 0&&(s=""+e.key),r.type&&r.type.defaultProps)var a=r.type.defaultProps;for(c in e)aH.call(e,c)&&!cH.hasOwnProperty(c)&&(n[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)n.children=t;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];n.children=a}return{$$typeof:Em,type:r.type,key:s,ref:i,props:n,_owner:o}};nt.createContext=function(r){return r={$$typeof:Nre,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:Pre,_context:r},r.Consumer=r};nt.createElement=lH;nt.createFactory=function(r){var e=lH.bind(null,r);return e.type=r,e};nt.createRef=function(){return{current:null}};nt.forwardRef=function(r){return{$$typeof:Dre,render:r}};nt.isValidElement=kk;nt.lazy=function(r){return{$$typeof:Bre,_payload:{_status:-1,_result:r},_init:Ure}};nt.memo=function(r,e){return{$$typeof:Rre,type:r,compare:e===void 0?null:e}};nt.startTransition=function(r){var e=M3.transition;M3.transition={};try{r()}finally{M3.transition=e}};nt.unstable_act=uH;nt.useCallback=function(r,e){return Xn.current.useCallback(r,e)};nt.useContext=function(r){return Xn.current.useContext(r)};nt.useDebugValue=function(){};nt.useDeferredValue=function(r){return Xn.current.useDeferredValue(r)};nt.useEffect=function(r,e){return Xn.current.useEffect(r,e)};nt.useId=function(){return Xn.current.useId()};nt.useImperativeHandle=function(r,e,t){return Xn.current.useImperativeHandle(r,e,t)};nt.useInsertionEffect=function(r,e){return Xn.current.useInsertionEffect(r,e)};nt.useLayoutEffect=function(r,e){return Xn.current.useLayoutEffect(r,e)};nt.useMemo=function(r,e){return Xn.current.useMemo(r,e)};nt.useReducer=function(r,e,t){return Xn.current.useReducer(r,e,t)};nt.useRef=function(r){return Xn.current.useRef(r)};nt.useState=function(r){return Xn.current.useState(r)};nt.useSyncExternalStore=function(r,e,t){return Xn.current.useSyncExternalStore(r,e,t)};nt.useTransition=function(){return Xn.current.useTransition()};nt.version="18.3.1";rH.exports=nt;var ws=rH.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zre=ws,Vre=Symbol.for("react.element"),Hre=Symbol.for("react.fragment"),Kre=Object.prototype.hasOwnProperty,Gre=zre.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,jre={key:!0,ref:!0,__self:!0,__source:!0};function hH(r,e,t){var n,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)Kre.call(e,n)&&!jre.hasOwnProperty(n)&&(s[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)s[n]===void 0&&(s[n]=e[n]);return{$$typeof:Vre,type:r,key:i,ref:o,props:s,_owner:Gre.current}}t5.Fragment=Hre;t5.jsx=hH;t5.jsxs=hH;tH.exports=t5;var cr=tH.exports,dH={exports:{}},Zs={},fH={exports:{}},pH={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function e($,z){var W=$.length;$.push(z);e:for(;0<W;){var ee=W-1>>>1,J=$[ee];if(0<s(J,z))$[ee]=z,$[W]=J,W=ee;else break e}}function t($){return $.length===0?null:$[0]}function n($){if($.length===0)return null;var z=$[0],W=$.pop();if(W!==z){$[0]=W;e:for(var ee=0,J=$.length,le=J>>>1;ee<le;){var ye=2*(ee+1)-1,de=$[ye],fe=ye+1,De=$[fe];if(0>s(de,W))fe<J&&0>s(De,de)?($[ee]=De,$[fe]=W,ee=fe):($[ee]=de,$[ye]=W,ee=ye);else if(fe<J&&0>s(De,W))$[ee]=De,$[fe]=W,ee=fe;else break e}}return z}function s($,z){var W=$.sortIndex-z.sortIndex;return W!==0?W:$.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;r.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();r.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,d=null,p=3,y=!1,f=!1,g=!1,w=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v($){for(var z=t(l);z!==null;){if(z.callback===null)n(l);else if(z.startTime<=$)n(l),z.sortIndex=z.expirationTime,e(c,z);else break;z=t(l)}}function E($){if(g=!1,v($),!f)if(t(c)!==null)f=!0,H(S);else{var z=t(l);z!==null&&G(E,z.startTime-$)}}function S($,z){f=!1,g&&(g=!1,m(C),C=-1),y=!0;var W=p;try{for(v(z),d=t(c);d!==null&&(!(d.expirationTime>z)||$&&!K());){var ee=d.callback;if(typeof ee=="function"){d.callback=null,p=d.priorityLevel;var J=ee(d.expirationTime<=z);z=r.unstable_now(),typeof J=="function"?d.callback=J:d===t(c)&&n(c),v(z)}else n(c);d=t(c)}if(d!==null)var le=!0;else{var ye=t(l);ye!==null&&G(E,ye.startTime-z),le=!1}return le}finally{d=null,p=W,y=!1}}var I=!1,x=null,C=-1,P=5,L=-1;function K(){return!(r.unstable_now()-L<P)}function V(){if(x!==null){var $=r.unstable_now();L=$;var z=!0;try{z=x(!0,$)}finally{z?Z():(I=!1,x=null)}}else I=!1}var Z;if(typeof b=="function")Z=function(){b(V)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,U=Y.port2;Y.port1.onmessage=V,Z=function(){U.postMessage(null)}}else Z=function(){w(V,0)};function H($){x=$,I||(I=!0,Z())}function G($,z){C=w(function(){$(r.unstable_now())},z)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function($){$.callback=null},r.unstable_continueExecution=function(){f||y||(f=!0,H(S))},r.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<$?Math.floor(1e3/$):5},r.unstable_getCurrentPriorityLevel=function(){return p},r.unstable_getFirstCallbackNode=function(){return t(c)},r.unstable_next=function($){switch(p){case 1:case 2:case 3:var z=3;break;default:z=p}var W=p;p=z;try{return $()}finally{p=W}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function($,z){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var W=p;p=$;try{return z()}finally{p=W}},r.unstable_scheduleCallback=function($,z,W){var ee=r.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?ee+W:ee):W=ee,$){case 1:var J=-1;break;case 2:J=250;break;case 5:J=1073741823;break;case 4:J=1e4;break;default:J=5e3}return J=W+J,$={id:u++,callback:z,priorityLevel:$,startTime:W,expirationTime:J,sortIndex:-1},W>ee?($.sortIndex=W,e(l,$),t(c)===null&&$===t(l)&&(g?(m(C),C=-1):g=!0,G(E,W-ee))):($.sortIndex=J,e(c,$),f||y||(f=!0,H(S))),$},r.unstable_shouldYield=K,r.unstable_wrapCallback=function($){var z=p;return function(){var W=p;p=z;try{return $.apply(this,arguments)}finally{p=W}}}})(pH);fH.exports=pH;var qre=fH.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wre=ws,Js=qre;function oe(r){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+r,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+r+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var gH=new Set,Q2={};function wf(r,e){V0(r,e),V0(r+"Capture",e)}function V0(r,e){for(Q2[r]=e,r=0;r<e.length;r++)gH.add(e[r])}var kc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wx=Object.prototype.hasOwnProperty,Qre=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,iD={},oD={};function Jre(r){return wx.call(oD,r)?!0:wx.call(iD,r)?!1:Qre.test(r)?oD[r]=!0:(iD[r]=!0,!1)}function Yre(r,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function Xre(r,e,t,n){if(e===null||typeof e>"u"||Yre(r,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Zn(r,e,t,n,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=r,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Xr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){Xr[r]=new Zn(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var e=r[0];Xr[e]=new Zn(e,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){Xr[r]=new Zn(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){Xr[r]=new Zn(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){Xr[r]=new Zn(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){Xr[r]=new Zn(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){Xr[r]=new Zn(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){Xr[r]=new Zn(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){Xr[r]=new Zn(r,5,!1,r.toLowerCase(),null,!1,!1)});var Tk=/[\-:]([a-z])/g;function _k(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var e=r.replace(Tk,_k);Xr[e]=new Zn(e,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var e=r.replace(Tk,_k);Xr[e]=new Zn(e,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var e=r.replace(Tk,_k);Xr[e]=new Zn(e,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){Xr[r]=new Zn(r,1,!1,r.toLowerCase(),null,!1,!1)});Xr.xlinkHref=new Zn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){Xr[r]=new Zn(r,1,!1,r.toLowerCase(),null,!0,!0)});function Pk(r,e,t,n){var s=Xr.hasOwnProperty(e)?Xr[e]:null;(s!==null?s.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Xre(e,t,s,n)&&(t=null),n||s===null?Jre(e)&&(t===null?r.removeAttribute(e):r.setAttribute(e,""+t)):s.mustUseProperty?r[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,n=s.attributeNamespace,t===null?r.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,n?r.setAttributeNS(n,e,t):r.setAttribute(e,t))))}var zc=Wre.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,mw=Symbol.for("react.element"),ip=Symbol.for("react.portal"),op=Symbol.for("react.fragment"),Nk=Symbol.for("react.strict_mode"),bx=Symbol.for("react.profiler"),yH=Symbol.for("react.provider"),mH=Symbol.for("react.context"),Dk=Symbol.for("react.forward_ref"),vx=Symbol.for("react.suspense"),Ex=Symbol.for("react.suspense_list"),Ok=Symbol.for("react.memo"),Cl=Symbol.for("react.lazy"),wH=Symbol.for("react.offscreen"),aD=Symbol.iterator;function gg(r){return r===null||typeof r!="object"?null:(r=aD&&r[aD]||r["@@iterator"],typeof r=="function"?r:null)}var er=Object.assign,K7;function t2(r){if(K7===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);K7=e&&e[1]||""}return`
`+K7+r}var G7=!1;function j7(r,e){if(!r||G7)return"";G7=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var n=l}Reflect.construct(r,[],e)}else{try{e.call()}catch(l){n=l}r.call(e.prototype)}else{try{throw Error()}catch(l){n=l}r()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var s=l.stack.split(`
`),i=n.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var c=`
`+s[o].replace(" at new "," at ");return r.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",r.displayName)),c}while(1<=o&&0<=a);break}}}finally{G7=!1,Error.prepareStackTrace=t}return(r=r?r.displayName||r.name:"")?t2(r):""}function Zre(r){switch(r.tag){case 5:return t2(r.type);case 16:return t2("Lazy");case 13:return t2("Suspense");case 19:return t2("SuspenseList");case 0:case 2:case 15:return r=j7(r.type,!1),r;case 11:return r=j7(r.type.render,!1),r;case 1:return r=j7(r.type,!0),r;default:return""}}function xx(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case op:return"Fragment";case ip:return"Portal";case bx:return"Profiler";case Nk:return"StrictMode";case vx:return"Suspense";case Ex:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case mH:return(r.displayName||"Context")+".Consumer";case yH:return(r._context.displayName||"Context")+".Provider";case Dk:var e=r.render;return r=r.displayName,r||(r=e.displayName||e.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case Ok:return e=r.displayName||null,e!==null?e:xx(r.type)||"Memo";case Cl:e=r._payload,r=r._init;try{return xx(r(e))}catch{}}return null}function ene(r){var e=r.type;switch(r.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=e.render,r=r.displayName||r.name||"",e.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return xx(e);case 8:return e===Nk?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ou(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function bH(r){var e=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function tne(r){var e=bH(r)?"checked":"value",t=Object.getOwnPropertyDescriptor(r.constructor.prototype,e),n=""+r[e];if(!r.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(r,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){n=""+o,i.call(this,o)}}),Object.defineProperty(r,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){r._valueTracker=null,delete r[e]}}}}function ww(r){r._valueTracker||(r._valueTracker=tne(r))}function vH(r){if(!r)return!1;var e=r._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return r&&(n=bH(r)?r.checked?"true":"false":r.value),r=n,r!==t?(e.setValue(r),!0):!1}function L4(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function Ax(r,e){var t=e.checked;return er({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??r._wrapperState.initialChecked})}function cD(r,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=Ou(e.value!=null?e.value:t),r._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function EH(r,e){e=e.checked,e!=null&&Pk(r,"checked",e,!1)}function Sx(r,e){EH(r,e);var t=Ou(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&r.value===""||r.value!=t)&&(r.value=""+t):r.value!==""+t&&(r.value=""+t);else if(n==="submit"||n==="reset"){r.removeAttribute("value");return}e.hasOwnProperty("value")?Cx(r,e.type,t):e.hasOwnProperty("defaultValue")&&Cx(r,e.type,Ou(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(r.defaultChecked=!!e.defaultChecked)}function lD(r,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+r._wrapperState.initialValue,t||e===r.value||(r.value=e),r.defaultValue=e}t=r.name,t!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,t!==""&&(r.name=t)}function Cx(r,e,t){(e!=="number"||L4(r.ownerDocument)!==r)&&(t==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+t&&(r.defaultValue=""+t))}var r2=Array.isArray;function kp(r,e,t,n){if(r=r.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<r.length;t++)s=e.hasOwnProperty("$"+r[t].value),r[t].selected!==s&&(r[t].selected=s),s&&n&&(r[t].defaultSelected=!0)}else{for(t=""+Ou(t),e=null,s=0;s<r.length;s++){if(r[s].value===t){r[s].selected=!0,n&&(r[s].defaultSelected=!0);return}e!==null||r[s].disabled||(e=r[s])}e!==null&&(e.selected=!0)}}function Ix(r,e){if(e.dangerouslySetInnerHTML!=null)throw Error(oe(91));return er({},e,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function uD(r,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(oe(92));if(r2(t)){if(1<t.length)throw Error(oe(93));t=t[0]}e=t}e==null&&(e=""),t=e}r._wrapperState={initialValue:Ou(t)}}function xH(r,e){var t=Ou(e.value),n=Ou(e.defaultValue);t!=null&&(t=""+t,t!==r.value&&(r.value=t),e.defaultValue==null&&r.defaultValue!==t&&(r.defaultValue=t)),n!=null&&(r.defaultValue=""+n)}function hD(r){var e=r.textContent;e===r._wrapperState.initialValue&&e!==""&&e!==null&&(r.value=e)}function AH(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function kx(r,e){return r==null||r==="http://www.w3.org/1999/xhtml"?AH(e):r==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var bw,SH=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,s){MSApp.execUnsafeLocalFunction(function(){return r(e,t,n,s)})}:r}(function(r,e){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=e;else{for(bw=bw||document.createElement("div"),bw.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=bw.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;e.firstChild;)r.appendChild(e.firstChild)}});function J2(r,e){if(e){var t=r.firstChild;if(t&&t===r.lastChild&&t.nodeType===3){t.nodeValue=e;return}}r.textContent=e}var E2={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},rne=["Webkit","ms","Moz","O"];Object.keys(E2).forEach(function(r){rne.forEach(function(e){e=e+r.charAt(0).toUpperCase()+r.substring(1),E2[e]=E2[r]})});function CH(r,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||E2.hasOwnProperty(r)&&E2[r]?(""+e).trim():e+"px"}function IH(r,e){r=r.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,s=CH(t,e[t],n);t==="float"&&(t="cssFloat"),n?r.setProperty(t,s):r[t]=s}}var nne=er({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Tx(r,e){if(e){if(nne[r]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(oe(137,r));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(oe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(oe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(oe(62))}}function _x(r,e){if(r.indexOf("-")===-1)return typeof e.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Px=null;function Rk(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Nx=null,Tp=null,_p=null;function dD(r){if(r=Sm(r)){if(typeof Nx!="function")throw Error(oe(280));var e=r.stateNode;e&&(e=o5(e),Nx(r.stateNode,r.type,e))}}function kH(r){Tp?_p?_p.push(r):_p=[r]:Tp=r}function TH(){if(Tp){var r=Tp,e=_p;if(_p=Tp=null,dD(r),e)for(r=0;r<e.length;r++)dD(e[r])}}function _H(r,e){return r(e)}function PH(){}var q7=!1;function NH(r,e,t){if(q7)return r(e,t);q7=!0;try{return _H(r,e,t)}finally{q7=!1,(Tp!==null||_p!==null)&&(PH(),TH())}}function Y2(r,e){var t=r.stateNode;if(t===null)return null;var n=o5(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(r=r.type,n=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!n;break e;default:r=!1}if(r)return null;if(t&&typeof t!="function")throw Error(oe(231,e,typeof t));return t}var Dx=!1;if(kc)try{var yg={};Object.defineProperty(yg,"passive",{get:function(){Dx=!0}}),window.addEventListener("test",yg,yg),window.removeEventListener("test",yg,yg)}catch{Dx=!1}function sne(r,e,t,n,s,i,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(u){this.onError(u)}}var x2=!1,U4=null,F4=!1,Ox=null,ine={onError:function(r){x2=!0,U4=r}};function one(r,e,t,n,s,i,o,a,c){x2=!1,U4=null,sne.apply(ine,arguments)}function ane(r,e,t,n,s,i,o,a,c){if(one.apply(this,arguments),x2){if(x2){var l=U4;x2=!1,U4=null}else throw Error(oe(198));F4||(F4=!0,Ox=l)}}function bf(r){var e=r,t=r;if(r.alternate)for(;e.return;)e=e.return;else{r=e;do e=r,e.flags&4098&&(t=e.return),r=e.return;while(r)}return e.tag===3?t:null}function DH(r){if(r.tag===13){var e=r.memoizedState;if(e===null&&(r=r.alternate,r!==null&&(e=r.memoizedState)),e!==null)return e.dehydrated}return null}function fD(r){if(bf(r)!==r)throw Error(oe(188))}function cne(r){var e=r.alternate;if(!e){if(e=bf(r),e===null)throw Error(oe(188));return e!==r?null:r}for(var t=r,n=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(n=s.return,n!==null){t=n;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return fD(s),r;if(i===n)return fD(s),e;i=i.sibling}throw Error(oe(188))}if(t.return!==n.return)t=s,n=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,n=i;break}if(a===n){o=!0,n=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,n=s;break}if(a===n){o=!0,n=i,t=s;break}a=a.sibling}if(!o)throw Error(oe(189))}}if(t.alternate!==n)throw Error(oe(190))}if(t.tag!==3)throw Error(oe(188));return t.stateNode.current===t?r:e}function OH(r){return r=cne(r),r!==null?RH(r):null}function RH(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var e=RH(r);if(e!==null)return e;r=r.sibling}return null}var BH=Js.unstable_scheduleCallback,pD=Js.unstable_cancelCallback,lne=Js.unstable_shouldYield,une=Js.unstable_requestPaint,ur=Js.unstable_now,hne=Js.unstable_getCurrentPriorityLevel,Bk=Js.unstable_ImmediatePriority,MH=Js.unstable_UserBlockingPriority,z4=Js.unstable_NormalPriority,dne=Js.unstable_LowPriority,$H=Js.unstable_IdlePriority,r5=null,ha=null;function fne(r){if(ha&&typeof ha.onCommitFiberRoot=="function")try{ha.onCommitFiberRoot(r5,r,void 0,(r.current.flags&128)===128)}catch{}}var bo=Math.clz32?Math.clz32:yne,pne=Math.log,gne=Math.LN2;function yne(r){return r>>>=0,r===0?32:31-(pne(r)/gne|0)|0}var vw=64,Ew=4194304;function n2(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function V4(r,e){var t=r.pendingLanes;if(t===0)return 0;var n=0,s=r.suspendedLanes,i=r.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?n=n2(a):(i&=o,i!==0&&(n=n2(i)))}else o=t&~s,o!==0?n=n2(o):i!==0&&(n=n2(i));if(n===0)return 0;if(e!==0&&e!==n&&!(e&s)&&(s=n&-n,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(n&4&&(n|=t&16),e=r.entangledLanes,e!==0)for(r=r.entanglements,e&=n;0<e;)t=31-bo(e),s=1<<t,n|=r[t],e&=~s;return n}function mne(r,e){switch(r){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wne(r,e){for(var t=r.suspendedLanes,n=r.pingedLanes,s=r.expirationTimes,i=r.pendingLanes;0<i;){var o=31-bo(i),a=1<<o,c=s[o];c===-1?(!(a&t)||a&n)&&(s[o]=mne(a,e)):c<=e&&(r.expiredLanes|=a),i&=~a}}function Rx(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function LH(){var r=vw;return vw<<=1,!(vw&4194240)&&(vw=64),r}function W7(r){for(var e=[],t=0;31>t;t++)e.push(r);return e}function xm(r,e,t){r.pendingLanes|=e,e!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,e=31-bo(e),r[e]=t}function bne(r,e){var t=r.pendingLanes&~e;r.pendingLanes=e,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=e,r.mutableReadLanes&=e,r.entangledLanes&=e,e=r.entanglements;var n=r.eventTimes;for(r=r.expirationTimes;0<t;){var s=31-bo(t),i=1<<s;e[s]=0,n[s]=-1,r[s]=-1,t&=~i}}function Mk(r,e){var t=r.entangledLanes|=e;for(r=r.entanglements;t;){var n=31-bo(t),s=1<<n;s&e|r[n]&e&&(r[n]|=e),t&=~s}}var St=0;function UH(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var FH,$k,zH,VH,HH,Bx=!1,xw=[],yu=null,mu=null,wu=null,X2=new Map,Z2=new Map,Ll=[],vne="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function gD(r,e){switch(r){case"focusin":case"focusout":yu=null;break;case"dragenter":case"dragleave":mu=null;break;case"mouseover":case"mouseout":wu=null;break;case"pointerover":case"pointerout":X2.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Z2.delete(e.pointerId)}}function mg(r,e,t,n,s,i){return r===null||r.nativeEvent!==i?(r={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Sm(e),e!==null&&$k(e)),r):(r.eventSystemFlags|=n,e=r.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),r)}function Ene(r,e,t,n,s){switch(e){case"focusin":return yu=mg(yu,r,e,t,n,s),!0;case"dragenter":return mu=mg(mu,r,e,t,n,s),!0;case"mouseover":return wu=mg(wu,r,e,t,n,s),!0;case"pointerover":var i=s.pointerId;return X2.set(i,mg(X2.get(i)||null,r,e,t,n,s)),!0;case"gotpointercapture":return i=s.pointerId,Z2.set(i,mg(Z2.get(i)||null,r,e,t,n,s)),!0}return!1}function KH(r){var e=Fh(r.target);if(e!==null){var t=bf(e);if(t!==null){if(e=t.tag,e===13){if(e=DH(t),e!==null){r.blockedOn=e,HH(r.priority,function(){zH(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){r.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}r.blockedOn=null}function $3(r){if(r.blockedOn!==null)return!1;for(var e=r.targetContainers;0<e.length;){var t=Mx(r.domEventName,r.eventSystemFlags,e[0],r.nativeEvent);if(t===null){t=r.nativeEvent;var n=new t.constructor(t.type,t);Px=n,t.target.dispatchEvent(n),Px=null}else return e=Sm(t),e!==null&&$k(e),r.blockedOn=t,!1;e.shift()}return!0}function yD(r,e,t){$3(r)&&t.delete(e)}function xne(){Bx=!1,yu!==null&&$3(yu)&&(yu=null),mu!==null&&$3(mu)&&(mu=null),wu!==null&&$3(wu)&&(wu=null),X2.forEach(yD),Z2.forEach(yD)}function wg(r,e){r.blockedOn===e&&(r.blockedOn=null,Bx||(Bx=!0,Js.unstable_scheduleCallback(Js.unstable_NormalPriority,xne)))}function ey(r){function e(s){return wg(s,r)}if(0<xw.length){wg(xw[0],r);for(var t=1;t<xw.length;t++){var n=xw[t];n.blockedOn===r&&(n.blockedOn=null)}}for(yu!==null&&wg(yu,r),mu!==null&&wg(mu,r),wu!==null&&wg(wu,r),X2.forEach(e),Z2.forEach(e),t=0;t<Ll.length;t++)n=Ll[t],n.blockedOn===r&&(n.blockedOn=null);for(;0<Ll.length&&(t=Ll[0],t.blockedOn===null);)KH(t),t.blockedOn===null&&Ll.shift()}var Pp=zc.ReactCurrentBatchConfig,H4=!0;function Ane(r,e,t,n){var s=St,i=Pp.transition;Pp.transition=null;try{St=1,Lk(r,e,t,n)}finally{St=s,Pp.transition=i}}function Sne(r,e,t,n){var s=St,i=Pp.transition;Pp.transition=null;try{St=4,Lk(r,e,t,n)}finally{St=s,Pp.transition=i}}function Lk(r,e,t,n){if(H4){var s=Mx(r,e,t,n);if(s===null)s9(r,e,n,K4,t),gD(r,n);else if(Ene(s,r,e,t,n))n.stopPropagation();else if(gD(r,n),e&4&&-1<vne.indexOf(r)){for(;s!==null;){var i=Sm(s);if(i!==null&&FH(i),i=Mx(r,e,t,n),i===null&&s9(r,e,n,K4,t),i===s)break;s=i}s!==null&&n.stopPropagation()}else s9(r,e,n,null,t)}}var K4=null;function Mx(r,e,t,n){if(K4=null,r=Rk(n),r=Fh(r),r!==null)if(e=bf(r),e===null)r=null;else if(t=e.tag,t===13){if(r=DH(e),r!==null)return r;r=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;r=null}else e!==r&&(r=null);return K4=r,null}function GH(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(hne()){case Bk:return 1;case MH:return 4;case z4:case dne:return 16;case $H:return 536870912;default:return 16}default:return 16}}var cu=null,Uk=null,L3=null;function jH(){if(L3)return L3;var r,e=Uk,t=e.length,n,s="value"in cu?cu.value:cu.textContent,i=s.length;for(r=0;r<t&&e[r]===s[r];r++);var o=t-r;for(n=1;n<=o&&e[t-n]===s[i-n];n++);return L3=s.slice(r,1<n?1-n:void 0)}function U3(r){var e=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&e===13&&(r=13)):r=e,r===10&&(r=13),32<=r||r===13?r:0}function Aw(){return!0}function mD(){return!1}function ei(r){function e(t,n,s,i,o){this._reactName=t,this._targetInst=s,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in r)r.hasOwnProperty(a)&&(t=r[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Aw:mD,this.isPropagationStopped=mD,this}return er(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Aw)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Aw)},persist:function(){},isPersistent:Aw}),e}var z1={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Fk=ei(z1),Am=er({},z1,{view:0,detail:0}),Cne=ei(Am),Q7,J7,bg,n5=er({},Am,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zk,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==bg&&(bg&&r.type==="mousemove"?(Q7=r.screenX-bg.screenX,J7=r.screenY-bg.screenY):J7=Q7=0,bg=r),Q7)},movementY:function(r){return"movementY"in r?r.movementY:J7}}),wD=ei(n5),Ine=er({},n5,{dataTransfer:0}),kne=ei(Ine),Tne=er({},Am,{relatedTarget:0}),Y7=ei(Tne),_ne=er({},z1,{animationName:0,elapsedTime:0,pseudoElement:0}),Pne=ei(_ne),Nne=er({},z1,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Dne=ei(Nne),One=er({},z1,{data:0}),bD=ei(One),Rne={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bne={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Mne={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $ne(r){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(r):(r=Mne[r])?!!e[r]:!1}function zk(){return $ne}var Lne=er({},Am,{key:function(r){if(r.key){var e=Rne[r.key]||r.key;if(e!=="Unidentified")return e}return r.type==="keypress"?(r=U3(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Bne[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zk,charCode:function(r){return r.type==="keypress"?U3(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?U3(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Une=ei(Lne),Fne=er({},n5,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),vD=ei(Fne),zne=er({},Am,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zk}),Vne=ei(zne),Hne=er({},z1,{propertyName:0,elapsedTime:0,pseudoElement:0}),Kne=ei(Hne),Gne=er({},n5,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),jne=ei(Gne),qne=[9,13,27,32],Vk=kc&&"CompositionEvent"in window,A2=null;kc&&"documentMode"in document&&(A2=document.documentMode);var Wne=kc&&"TextEvent"in window&&!A2,qH=kc&&(!Vk||A2&&8<A2&&11>=A2),ED=" ",xD=!1;function WH(r,e){switch(r){case"keyup":return qne.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function QH(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var ap=!1;function Qne(r,e){switch(r){case"compositionend":return QH(e);case"keypress":return e.which!==32?null:(xD=!0,ED);case"textInput":return r=e.data,r===ED&&xD?null:r;default:return null}}function Jne(r,e){if(ap)return r==="compositionend"||!Vk&&WH(r,e)?(r=jH(),L3=Uk=cu=null,ap=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return qH&&e.locale!=="ko"?null:e.data;default:return null}}var Yne={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function AD(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e==="input"?!!Yne[r.type]:e==="textarea"}function JH(r,e,t,n){kH(n),e=G4(e,"onChange"),0<e.length&&(t=new Fk("onChange","change",null,t,n),r.push({event:t,listeners:e}))}var S2=null,ty=null;function Xne(r){aK(r,0)}function s5(r){var e=up(r);if(vH(e))return r}function Zne(r,e){if(r==="change")return e}var YH=!1;if(kc){var X7;if(kc){var Z7="oninput"in document;if(!Z7){var SD=document.createElement("div");SD.setAttribute("oninput","return;"),Z7=typeof SD.oninput=="function"}X7=Z7}else X7=!1;YH=X7&&(!document.documentMode||9<document.documentMode)}function CD(){S2&&(S2.detachEvent("onpropertychange",XH),ty=S2=null)}function XH(r){if(r.propertyName==="value"&&s5(ty)){var e=[];JH(e,ty,r,Rk(r)),NH(Xne,e)}}function ese(r,e,t){r==="focusin"?(CD(),S2=e,ty=t,S2.attachEvent("onpropertychange",XH)):r==="focusout"&&CD()}function tse(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return s5(ty)}function rse(r,e){if(r==="click")return s5(e)}function nse(r,e){if(r==="input"||r==="change")return s5(e)}function sse(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var Co=typeof Object.is=="function"?Object.is:sse;function ry(r,e){if(Co(r,e))return!0;if(typeof r!="object"||r===null||typeof e!="object"||e===null)return!1;var t=Object.keys(r),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var s=t[n];if(!wx.call(e,s)||!Co(r[s],e[s]))return!1}return!0}function ID(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function kD(r,e){var t=ID(r);r=0;for(var n;t;){if(t.nodeType===3){if(n=r+t.textContent.length,r<=e&&n>=e)return{node:t,offset:e-r};r=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=ID(t)}}function ZH(r,e){return r&&e?r===e?!0:r&&r.nodeType===3?!1:e&&e.nodeType===3?ZH(r,e.parentNode):"contains"in r?r.contains(e):r.compareDocumentPosition?!!(r.compareDocumentPosition(e)&16):!1:!1}function eK(){for(var r=window,e=L4();e instanceof r.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)r=e.contentWindow;else break;e=L4(r.document)}return e}function Hk(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e&&(e==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||e==="textarea"||r.contentEditable==="true")}function ise(r){var e=eK(),t=r.focusedElem,n=r.selectionRange;if(e!==t&&t&&t.ownerDocument&&ZH(t.ownerDocument.documentElement,t)){if(n!==null&&Hk(t)){if(e=n.start,r=n.end,r===void 0&&(r=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(r,t.value.length);else if(r=(e=t.ownerDocument||document)&&e.defaultView||window,r.getSelection){r=r.getSelection();var s=t.textContent.length,i=Math.min(n.start,s);n=n.end===void 0?i:Math.min(n.end,s),!r.extend&&i>n&&(s=n,n=i,i=s),s=kD(t,i);var o=kD(t,n);s&&o&&(r.rangeCount!==1||r.anchorNode!==s.node||r.anchorOffset!==s.offset||r.focusNode!==o.node||r.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),r.removeAllRanges(),i>n?(r.addRange(e),r.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),r.addRange(e)))}}for(e=[],r=t;r=r.parentNode;)r.nodeType===1&&e.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)r=e[t],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var ose=kc&&"documentMode"in document&&11>=document.documentMode,cp=null,$x=null,C2=null,Lx=!1;function TD(r,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Lx||cp==null||cp!==L4(n)||(n=cp,"selectionStart"in n&&Hk(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),C2&&ry(C2,n)||(C2=n,n=G4($x,"onSelect"),0<n.length&&(e=new Fk("onSelect","select",null,e,t),r.push({event:e,listeners:n}),e.target=cp)))}function Sw(r,e){var t={};return t[r.toLowerCase()]=e.toLowerCase(),t["Webkit"+r]="webkit"+e,t["Moz"+r]="moz"+e,t}var lp={animationend:Sw("Animation","AnimationEnd"),animationiteration:Sw("Animation","AnimationIteration"),animationstart:Sw("Animation","AnimationStart"),transitionend:Sw("Transition","TransitionEnd")},e9={},tK={};kc&&(tK=document.createElement("div").style,"AnimationEvent"in window||(delete lp.animationend.animation,delete lp.animationiteration.animation,delete lp.animationstart.animation),"TransitionEvent"in window||delete lp.transitionend.transition);function i5(r){if(e9[r])return e9[r];if(!lp[r])return r;var e=lp[r],t;for(t in e)if(e.hasOwnProperty(t)&&t in tK)return e9[r]=e[t];return r}var rK=i5("animationend"),nK=i5("animationiteration"),sK=i5("animationstart"),iK=i5("transitionend"),oK=new Map,_D="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function eh(r,e){oK.set(r,e),wf(e,[r])}for(var t9=0;t9<_D.length;t9++){var r9=_D[t9],ase=r9.toLowerCase(),cse=r9[0].toUpperCase()+r9.slice(1);eh(ase,"on"+cse)}eh(rK,"onAnimationEnd");eh(nK,"onAnimationIteration");eh(sK,"onAnimationStart");eh("dblclick","onDoubleClick");eh("focusin","onFocus");eh("focusout","onBlur");eh(iK,"onTransitionEnd");V0("onMouseEnter",["mouseout","mouseover"]);V0("onMouseLeave",["mouseout","mouseover"]);V0("onPointerEnter",["pointerout","pointerover"]);V0("onPointerLeave",["pointerout","pointerover"]);wf("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));wf("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));wf("onBeforeInput",["compositionend","keypress","textInput","paste"]);wf("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));wf("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));wf("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var s2="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lse=new Set("cancel close invalid load scroll toggle".split(" ").concat(s2));function PD(r,e,t){var n=r.type||"unknown-event";r.currentTarget=t,ane(n,e,void 0,r),r.currentTarget=null}function aK(r,e){e=(e&4)!==0;for(var t=0;t<r.length;t++){var n=r[t],s=n.event;n=n.listeners;e:{var i=void 0;if(e)for(var o=n.length-1;0<=o;o--){var a=n[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==i&&s.isPropagationStopped())break e;PD(s,a,l),i=c}else for(o=0;o<n.length;o++){if(a=n[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==i&&s.isPropagationStopped())break e;PD(s,a,l),i=c}}}if(F4)throw r=Ox,F4=!1,Ox=null,r}function zt(r,e){var t=e[Hx];t===void 0&&(t=e[Hx]=new Set);var n=r+"__bubble";t.has(n)||(cK(e,r,2,!1),t.add(n))}function n9(r,e,t){var n=0;e&&(n|=4),cK(t,r,n,e)}var Cw="_reactListening"+Math.random().toString(36).slice(2);function ny(r){if(!r[Cw]){r[Cw]=!0,gH.forEach(function(t){t!=="selectionchange"&&(lse.has(t)||n9(t,!1,r),n9(t,!0,r))});var e=r.nodeType===9?r:r.ownerDocument;e===null||e[Cw]||(e[Cw]=!0,n9("selectionchange",!1,e))}}function cK(r,e,t,n){switch(GH(e)){case 1:var s=Ane;break;case 4:s=Sne;break;default:s=Lk}t=s.bind(null,e,t,r),s=void 0,!Dx||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),n?s!==void 0?r.addEventListener(e,t,{capture:!0,passive:s}):r.addEventListener(e,t,!0):s!==void 0?r.addEventListener(e,t,{passive:s}):r.addEventListener(e,t,!1)}function s9(r,e,t,n,s){var i=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var a=n.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=n.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Fh(a),o===null)return;if(c=o.tag,c===5||c===6){n=i=o;continue e}a=a.parentNode}}n=n.return}NH(function(){var l=i,u=Rk(t),d=[];e:{var p=oK.get(r);if(p!==void 0){var y=Fk,f=r;switch(r){case"keypress":if(U3(t)===0)break e;case"keydown":case"keyup":y=Une;break;case"focusin":f="focus",y=Y7;break;case"focusout":f="blur",y=Y7;break;case"beforeblur":case"afterblur":y=Y7;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=wD;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=kne;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=Vne;break;case rK:case nK:case sK:y=Pne;break;case iK:y=Kne;break;case"scroll":y=Cne;break;case"wheel":y=jne;break;case"copy":case"cut":case"paste":y=Dne;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=vD}var g=(e&4)!==0,w=!g&&r==="scroll",m=g?p!==null?p+"Capture":null:p;g=[];for(var b=l,v;b!==null;){v=b;var E=v.stateNode;if(v.tag===5&&E!==null&&(v=E,m!==null&&(E=Y2(b,m),E!=null&&g.push(sy(b,E,v)))),w)break;b=b.return}0<g.length&&(p=new y(p,f,null,t,u),d.push({event:p,listeners:g}))}}if(!(e&7)){e:{if(p=r==="mouseover"||r==="pointerover",y=r==="mouseout"||r==="pointerout",p&&t!==Px&&(f=t.relatedTarget||t.fromElement)&&(Fh(f)||f[Tc]))break e;if((y||p)&&(p=u.window===u?u:(p=u.ownerDocument)?p.defaultView||p.parentWindow:window,y?(f=t.relatedTarget||t.toElement,y=l,f=f?Fh(f):null,f!==null&&(w=bf(f),f!==w||f.tag!==5&&f.tag!==6)&&(f=null)):(y=null,f=l),y!==f)){if(g=wD,E="onMouseLeave",m="onMouseEnter",b="mouse",(r==="pointerout"||r==="pointerover")&&(g=vD,E="onPointerLeave",m="onPointerEnter",b="pointer"),w=y==null?p:up(y),v=f==null?p:up(f),p=new g(E,b+"leave",y,t,u),p.target=w,p.relatedTarget=v,E=null,Fh(u)===l&&(g=new g(m,b+"enter",f,t,u),g.target=v,g.relatedTarget=w,E=g),w=E,y&&f)t:{for(g=y,m=f,b=0,v=g;v;v=Rf(v))b++;for(v=0,E=m;E;E=Rf(E))v++;for(;0<b-v;)g=Rf(g),b--;for(;0<v-b;)m=Rf(m),v--;for(;b--;){if(g===m||m!==null&&g===m.alternate)break t;g=Rf(g),m=Rf(m)}g=null}else g=null;y!==null&&ND(d,p,y,g,!1),f!==null&&w!==null&&ND(d,w,f,g,!0)}}e:{if(p=l?up(l):window,y=p.nodeName&&p.nodeName.toLowerCase(),y==="select"||y==="input"&&p.type==="file")var S=Zne;else if(AD(p))if(YH)S=nse;else{S=tse;var I=ese}else(y=p.nodeName)&&y.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(S=rse);if(S&&(S=S(r,l))){JH(d,S,t,u);break e}I&&I(r,p,l),r==="focusout"&&(I=p._wrapperState)&&I.controlled&&p.type==="number"&&Cx(p,"number",p.value)}switch(I=l?up(l):window,r){case"focusin":(AD(I)||I.contentEditable==="true")&&(cp=I,$x=l,C2=null);break;case"focusout":C2=$x=cp=null;break;case"mousedown":Lx=!0;break;case"contextmenu":case"mouseup":case"dragend":Lx=!1,TD(d,t,u);break;case"selectionchange":if(ose)break;case"keydown":case"keyup":TD(d,t,u)}var x;if(Vk)e:{switch(r){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else ap?WH(r,t)&&(C="onCompositionEnd"):r==="keydown"&&t.keyCode===229&&(C="onCompositionStart");C&&(qH&&t.locale!=="ko"&&(ap||C!=="onCompositionStart"?C==="onCompositionEnd"&&ap&&(x=jH()):(cu=u,Uk="value"in cu?cu.value:cu.textContent,ap=!0)),I=G4(l,C),0<I.length&&(C=new bD(C,r,null,t,u),d.push({event:C,listeners:I}),x?C.data=x:(x=QH(t),x!==null&&(C.data=x)))),(x=Wne?Qne(r,t):Jne(r,t))&&(l=G4(l,"onBeforeInput"),0<l.length&&(u=new bD("onBeforeInput","beforeinput",null,t,u),d.push({event:u,listeners:l}),u.data=x))}aK(d,e)})}function sy(r,e,t){return{instance:r,listener:e,currentTarget:t}}function G4(r,e){for(var t=e+"Capture",n=[];r!==null;){var s=r,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Y2(r,t),i!=null&&n.unshift(sy(r,i,s)),i=Y2(r,e),i!=null&&n.push(sy(r,i,s))),r=r.return}return n}function Rf(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function ND(r,e,t,n,s){for(var i=e._reactName,o=[];t!==null&&t!==n;){var a=t,c=a.alternate,l=a.stateNode;if(c!==null&&c===n)break;a.tag===5&&l!==null&&(a=l,s?(c=Y2(t,i),c!=null&&o.unshift(sy(t,c,a))):s||(c=Y2(t,i),c!=null&&o.push(sy(t,c,a)))),t=t.return}o.length!==0&&r.push({event:e,listeners:o})}var use=/\r\n?/g,hse=/\u0000|\uFFFD/g;function DD(r){return(typeof r=="string"?r:""+r).replace(use,`
`).replace(hse,"")}function Iw(r,e,t){if(e=DD(e),DD(r)!==e&&t)throw Error(oe(425))}function j4(){}var Ux=null,Fx=null;function zx(r,e){return r==="textarea"||r==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Vx=typeof setTimeout=="function"?setTimeout:void 0,dse=typeof clearTimeout=="function"?clearTimeout:void 0,OD=typeof Promise=="function"?Promise:void 0,fse=typeof queueMicrotask=="function"?queueMicrotask:typeof OD<"u"?function(r){return OD.resolve(null).then(r).catch(pse)}:Vx;function pse(r){setTimeout(function(){throw r})}function i9(r,e){var t=e,n=0;do{var s=t.nextSibling;if(r.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(n===0){r.removeChild(s),ey(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=s}while(t);ey(e)}function bu(r){for(;r!=null;r=r.nextSibling){var e=r.nodeType;if(e===1||e===3)break;if(e===8){if(e=r.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return r}function RD(r){r=r.previousSibling;for(var e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return r;e--}else t==="/$"&&e++}r=r.previousSibling}return null}var V1=Math.random().toString(36).slice(2),ia="__reactFiber$"+V1,iy="__reactProps$"+V1,Tc="__reactContainer$"+V1,Hx="__reactEvents$"+V1,gse="__reactListeners$"+V1,yse="__reactHandles$"+V1;function Fh(r){var e=r[ia];if(e)return e;for(var t=r.parentNode;t;){if(e=t[Tc]||t[ia]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(r=RD(r);r!==null;){if(t=r[ia])return t;r=RD(r)}return e}r=t,t=r.parentNode}return null}function Sm(r){return r=r[ia]||r[Tc],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function up(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(oe(33))}function o5(r){return r[iy]||null}var Kx=[],hp=-1;function th(r){return{current:r}}function Ht(r){0>hp||(r.current=Kx[hp],Kx[hp]=null,hp--)}function Mt(r,e){hp++,Kx[hp]=r.current,r.current=e}var Ru={},On=th(Ru),bs=th(!1),Md=Ru;function H0(r,e){var t=r.type.contextTypes;if(!t)return Ru;var n=r.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=e,r.__reactInternalMemoizedMaskedChildContext=s),s}function vs(r){return r=r.childContextTypes,r!=null}function q4(){Ht(bs),Ht(On)}function BD(r,e,t){if(On.current!==Ru)throw Error(oe(168));Mt(On,e),Mt(bs,t)}function lK(r,e,t){var n=r.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var s in n)if(!(s in e))throw Error(oe(108,ene(r)||"Unknown",s));return er({},t,n)}function W4(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Ru,Md=On.current,Mt(On,r),Mt(bs,bs.current),!0}function MD(r,e,t){var n=r.stateNode;if(!n)throw Error(oe(169));t?(r=lK(r,e,Md),n.__reactInternalMemoizedMergedChildContext=r,Ht(bs),Ht(On),Mt(On,r)):Ht(bs),Mt(bs,t)}var Ka=null,a5=!1,o9=!1;function uK(r){Ka===null?Ka=[r]:Ka.push(r)}function mse(r){a5=!0,uK(r)}function rh(){if(!o9&&Ka!==null){o9=!0;var r=0,e=St;try{var t=Ka;for(St=1;r<t.length;r++){var n=t[r];do n=n(!0);while(n!==null)}Ka=null,a5=!1}catch(s){throw Ka!==null&&(Ka=Ka.slice(r+1)),BH(Bk,rh),s}finally{St=e,o9=!1}}return null}var dp=[],fp=0,Q4=null,J4=0,Ii=[],ki=0,$d=null,pc=1,gc="";function Ch(r,e){dp[fp++]=J4,dp[fp++]=Q4,Q4=r,J4=e}function hK(r,e,t){Ii[ki++]=pc,Ii[ki++]=gc,Ii[ki++]=$d,$d=r;var n=pc;r=gc;var s=32-bo(n)-1;n&=~(1<<s),t+=1;var i=32-bo(e)+s;if(30<i){var o=s-s%5;i=(n&(1<<o)-1).toString(32),n>>=o,s-=o,pc=1<<32-bo(e)+s|t<<s|n,gc=i+r}else pc=1<<i|t<<s|n,gc=r}function Kk(r){r.return!==null&&(Ch(r,1),hK(r,1,0))}function Gk(r){for(;r===Q4;)Q4=dp[--fp],dp[fp]=null,J4=dp[--fp],dp[fp]=null;for(;r===$d;)$d=Ii[--ki],Ii[ki]=null,gc=Ii[--ki],Ii[ki]=null,pc=Ii[--ki],Ii[ki]=null}var Qs=null,Ws=null,jt=!1,fo=null;function dK(r,e){var t=Ni(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=r,e=r.deletions,e===null?(r.deletions=[t],r.flags|=16):e.push(t)}function $D(r,e){switch(r.tag){case 5:var t=r.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(r.stateNode=e,Qs=r,Ws=bu(e.firstChild),!0):!1;case 6:return e=r.pendingProps===""||e.nodeType!==3?null:e,e!==null?(r.stateNode=e,Qs=r,Ws=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=$d!==null?{id:pc,overflow:gc}:null,r.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Ni(18,null,null,0),t.stateNode=e,t.return=r,r.child=t,Qs=r,Ws=null,!0):!1;default:return!1}}function Gx(r){return(r.mode&1)!==0&&(r.flags&128)===0}function jx(r){if(jt){var e=Ws;if(e){var t=e;if(!$D(r,e)){if(Gx(r))throw Error(oe(418));e=bu(t.nextSibling);var n=Qs;e&&$D(r,e)?dK(n,t):(r.flags=r.flags&-4097|2,jt=!1,Qs=r)}}else{if(Gx(r))throw Error(oe(418));r.flags=r.flags&-4097|2,jt=!1,Qs=r}}}function LD(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Qs=r}function kw(r){if(r!==Qs)return!1;if(!jt)return LD(r),jt=!0,!1;var e;if((e=r.tag!==3)&&!(e=r.tag!==5)&&(e=r.type,e=e!=="head"&&e!=="body"&&!zx(r.type,r.memoizedProps)),e&&(e=Ws)){if(Gx(r))throw fK(),Error(oe(418));for(;e;)dK(r,e),e=bu(e.nextSibling)}if(LD(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(oe(317));e:{for(r=r.nextSibling,e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="/$"){if(e===0){Ws=bu(r.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}r=r.nextSibling}Ws=null}}else Ws=Qs?bu(r.stateNode.nextSibling):null;return!0}function fK(){for(var r=Ws;r;)r=bu(r.nextSibling)}function K0(){Ws=Qs=null,jt=!1}function jk(r){fo===null?fo=[r]:fo.push(r)}var wse=zc.ReactCurrentBatchConfig;function vg(r,e,t){if(r=t.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(oe(309));var n=t.stateNode}if(!n)throw Error(oe(147,r));var s=n,i=""+r;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof r!="string")throw Error(oe(284));if(!t._owner)throw Error(oe(290,r))}return r}function Tw(r,e){throw r=Object.prototype.toString.call(e),Error(oe(31,r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r))}function UD(r){var e=r._init;return e(r._payload)}function pK(r){function e(m,b){if(r){var v=m.deletions;v===null?(m.deletions=[b],m.flags|=16):v.push(b)}}function t(m,b){if(!r)return null;for(;b!==null;)e(m,b),b=b.sibling;return null}function n(m,b){for(m=new Map;b!==null;)b.key!==null?m.set(b.key,b):m.set(b.index,b),b=b.sibling;return m}function s(m,b){return m=Au(m,b),m.index=0,m.sibling=null,m}function i(m,b,v){return m.index=v,r?(v=m.alternate,v!==null?(v=v.index,v<b?(m.flags|=2,b):v):(m.flags|=2,b)):(m.flags|=1048576,b)}function o(m){return r&&m.alternate===null&&(m.flags|=2),m}function a(m,b,v,E){return b===null||b.tag!==6?(b=f9(v,m.mode,E),b.return=m,b):(b=s(b,v),b.return=m,b)}function c(m,b,v,E){var S=v.type;return S===op?u(m,b,v.props.children,E,v.key):b!==null&&(b.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Cl&&UD(S)===b.type)?(E=s(b,v.props),E.ref=vg(m,b,v),E.return=m,E):(E=j3(v.type,v.key,v.props,null,m.mode,E),E.ref=vg(m,b,v),E.return=m,E)}function l(m,b,v,E){return b===null||b.tag!==4||b.stateNode.containerInfo!==v.containerInfo||b.stateNode.implementation!==v.implementation?(b=p9(v,m.mode,E),b.return=m,b):(b=s(b,v.children||[]),b.return=m,b)}function u(m,b,v,E,S){return b===null||b.tag!==7?(b=xd(v,m.mode,E,S),b.return=m,b):(b=s(b,v),b.return=m,b)}function d(m,b,v){if(typeof b=="string"&&b!==""||typeof b=="number")return b=f9(""+b,m.mode,v),b.return=m,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case mw:return v=j3(b.type,b.key,b.props,null,m.mode,v),v.ref=vg(m,null,b),v.return=m,v;case ip:return b=p9(b,m.mode,v),b.return=m,b;case Cl:var E=b._init;return d(m,E(b._payload),v)}if(r2(b)||gg(b))return b=xd(b,m.mode,v,null),b.return=m,b;Tw(m,b)}return null}function p(m,b,v,E){var S=b!==null?b.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return S!==null?null:a(m,b,""+v,E);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case mw:return v.key===S?c(m,b,v,E):null;case ip:return v.key===S?l(m,b,v,E):null;case Cl:return S=v._init,p(m,b,S(v._payload),E)}if(r2(v)||gg(v))return S!==null?null:u(m,b,v,E,null);Tw(m,v)}return null}function y(m,b,v,E,S){if(typeof E=="string"&&E!==""||typeof E=="number")return m=m.get(v)||null,a(b,m,""+E,S);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case mw:return m=m.get(E.key===null?v:E.key)||null,c(b,m,E,S);case ip:return m=m.get(E.key===null?v:E.key)||null,l(b,m,E,S);case Cl:var I=E._init;return y(m,b,v,I(E._payload),S)}if(r2(E)||gg(E))return m=m.get(v)||null,u(b,m,E,S,null);Tw(b,E)}return null}function f(m,b,v,E){for(var S=null,I=null,x=b,C=b=0,P=null;x!==null&&C<v.length;C++){x.index>C?(P=x,x=null):P=x.sibling;var L=p(m,x,v[C],E);if(L===null){x===null&&(x=P);break}r&&x&&L.alternate===null&&e(m,x),b=i(L,b,C),I===null?S=L:I.sibling=L,I=L,x=P}if(C===v.length)return t(m,x),jt&&Ch(m,C),S;if(x===null){for(;C<v.length;C++)x=d(m,v[C],E),x!==null&&(b=i(x,b,C),I===null?S=x:I.sibling=x,I=x);return jt&&Ch(m,C),S}for(x=n(m,x);C<v.length;C++)P=y(x,m,C,v[C],E),P!==null&&(r&&P.alternate!==null&&x.delete(P.key===null?C:P.key),b=i(P,b,C),I===null?S=P:I.sibling=P,I=P);return r&&x.forEach(function(K){return e(m,K)}),jt&&Ch(m,C),S}function g(m,b,v,E){var S=gg(v);if(typeof S!="function")throw Error(oe(150));if(v=S.call(v),v==null)throw Error(oe(151));for(var I=S=null,x=b,C=b=0,P=null,L=v.next();x!==null&&!L.done;C++,L=v.next()){x.index>C?(P=x,x=null):P=x.sibling;var K=p(m,x,L.value,E);if(K===null){x===null&&(x=P);break}r&&x&&K.alternate===null&&e(m,x),b=i(K,b,C),I===null?S=K:I.sibling=K,I=K,x=P}if(L.done)return t(m,x),jt&&Ch(m,C),S;if(x===null){for(;!L.done;C++,L=v.next())L=d(m,L.value,E),L!==null&&(b=i(L,b,C),I===null?S=L:I.sibling=L,I=L);return jt&&Ch(m,C),S}for(x=n(m,x);!L.done;C++,L=v.next())L=y(x,m,C,L.value,E),L!==null&&(r&&L.alternate!==null&&x.delete(L.key===null?C:L.key),b=i(L,b,C),I===null?S=L:I.sibling=L,I=L);return r&&x.forEach(function(V){return e(m,V)}),jt&&Ch(m,C),S}function w(m,b,v,E){if(typeof v=="object"&&v!==null&&v.type===op&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case mw:e:{for(var S=v.key,I=b;I!==null;){if(I.key===S){if(S=v.type,S===op){if(I.tag===7){t(m,I.sibling),b=s(I,v.props.children),b.return=m,m=b;break e}}else if(I.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Cl&&UD(S)===I.type){t(m,I.sibling),b=s(I,v.props),b.ref=vg(m,I,v),b.return=m,m=b;break e}t(m,I);break}else e(m,I);I=I.sibling}v.type===op?(b=xd(v.props.children,m.mode,E,v.key),b.return=m,m=b):(E=j3(v.type,v.key,v.props,null,m.mode,E),E.ref=vg(m,b,v),E.return=m,m=E)}return o(m);case ip:e:{for(I=v.key;b!==null;){if(b.key===I)if(b.tag===4&&b.stateNode.containerInfo===v.containerInfo&&b.stateNode.implementation===v.implementation){t(m,b.sibling),b=s(b,v.children||[]),b.return=m,m=b;break e}else{t(m,b);break}else e(m,b);b=b.sibling}b=p9(v,m.mode,E),b.return=m,m=b}return o(m);case Cl:return I=v._init,w(m,b,I(v._payload),E)}if(r2(v))return f(m,b,v,E);if(gg(v))return g(m,b,v,E);Tw(m,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,b!==null&&b.tag===6?(t(m,b.sibling),b=s(b,v),b.return=m,m=b):(t(m,b),b=f9(v,m.mode,E),b.return=m,m=b),o(m)):t(m,b)}return w}var G0=pK(!0),gK=pK(!1),Y4=th(null),X4=null,pp=null,qk=null;function Wk(){qk=pp=X4=null}function Qk(r){var e=Y4.current;Ht(Y4),r._currentValue=e}function qx(r,e,t){for(;r!==null;){var n=r.alternate;if((r.childLanes&e)!==e?(r.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),r===t)break;r=r.return}}function Np(r,e){X4=r,qk=pp=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&e&&(ys=!0),r.firstContext=null)}function Ui(r){var e=r._currentValue;if(qk!==r)if(r={context:r,memoizedValue:e,next:null},pp===null){if(X4===null)throw Error(oe(308));pp=r,X4.dependencies={lanes:0,firstContext:r}}else pp=pp.next=r;return e}var zh=null;function Jk(r){zh===null?zh=[r]:zh.push(r)}function yK(r,e,t,n){var s=e.interleaved;return s===null?(t.next=t,Jk(e)):(t.next=s.next,s.next=t),e.interleaved=t,_c(r,n)}function _c(r,e){r.lanes|=e;var t=r.alternate;for(t!==null&&(t.lanes|=e),t=r,r=r.return;r!==null;)r.childLanes|=e,t=r.alternate,t!==null&&(t.childLanes|=e),t=r,r=r.return;return t.tag===3?t.stateNode:null}var Il=!1;function Yk(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function mK(r,e){r=r.updateQueue,e.updateQueue===r&&(e.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function wc(r,e){return{eventTime:r,lane:e,tag:0,payload:null,callback:null,next:null}}function vu(r,e,t){var n=r.updateQueue;if(n===null)return null;if(n=n.shared,ht&2){var s=n.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),n.pending=e,_c(r,t)}return s=n.interleaved,s===null?(e.next=e,Jk(n)):(e.next=s.next,s.next=e),n.interleaved=e,_c(r,t)}function F3(r,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,Mk(r,t)}}function FD(r,e){var t=r.updateQueue,n=r.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:n.shared,effects:n.effects},r.updateQueue=t;return}r=t.lastBaseUpdate,r===null?t.firstBaseUpdate=e:r.next=e,t.lastBaseUpdate=e}function Z4(r,e,t,n){var s=r.updateQueue;Il=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?i=l:o.next=l,o=c;var u=r.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(i!==null){var d=s.baseState;o=0,u=l=c=null,a=i;do{var p=a.lane,y=a.eventTime;if((n&p)===p){u!==null&&(u=u.next={eventTime:y,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=r,g=a;switch(p=e,y=t,g.tag){case 1:if(f=g.payload,typeof f=="function"){d=f.call(y,d,p);break e}d=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=g.payload,p=typeof f=="function"?f.call(y,d,p):f,p==null)break e;d=er({},d,p);break e;case 2:Il=!0}}a.callback!==null&&a.lane!==0&&(r.flags|=64,p=s.effects,p===null?s.effects=[a]:p.push(a))}else y={eventTime:y,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=y,c=d):u=u.next=y,o|=p;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;p=a,a=p.next,p.next=null,s.lastBaseUpdate=p,s.shared.pending=null}}while(!0);if(u===null&&(c=d),s.baseState=c,s.firstBaseUpdate=l,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Ud|=o,r.lanes=o,r.memoizedState=d}}function zD(r,e,t){if(r=e.effects,e.effects=null,r!==null)for(e=0;e<r.length;e++){var n=r[e],s=n.callback;if(s!==null){if(n.callback=null,n=t,typeof s!="function")throw Error(oe(191,s));s.call(n)}}}var Cm={},da=th(Cm),oy=th(Cm),ay=th(Cm);function Vh(r){if(r===Cm)throw Error(oe(174));return r}function Xk(r,e){switch(Mt(ay,e),Mt(oy,r),Mt(da,Cm),r=e.nodeType,r){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:kx(null,"");break;default:r=r===8?e.parentNode:e,e=r.namespaceURI||null,r=r.tagName,e=kx(e,r)}Ht(da),Mt(da,e)}function j0(){Ht(da),Ht(oy),Ht(ay)}function wK(r){Vh(ay.current);var e=Vh(da.current),t=kx(e,r.type);e!==t&&(Mt(oy,r),Mt(da,t))}function Zk(r){oy.current===r&&(Ht(da),Ht(oy))}var Jt=th(0);function e8(r){for(var e=r;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var a9=[];function eT(){for(var r=0;r<a9.length;r++)a9[r]._workInProgressVersionPrimary=null;a9.length=0}var z3=zc.ReactCurrentDispatcher,c9=zc.ReactCurrentBatchConfig,Ld=0,Zt=null,Ar=null,Or=null,t8=!1,I2=!1,cy=0,bse=0;function on(){throw Error(oe(321))}function tT(r,e){if(e===null)return!1;for(var t=0;t<e.length&&t<r.length;t++)if(!Co(r[t],e[t]))return!1;return!0}function rT(r,e,t,n,s,i){if(Ld=i,Zt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,z3.current=r===null||r.memoizedState===null?Ase:Sse,r=t(n,s),I2){i=0;do{if(I2=!1,cy=0,25<=i)throw Error(oe(301));i+=1,Or=Ar=null,e.updateQueue=null,z3.current=Cse,r=t(n,s)}while(I2)}if(z3.current=r8,e=Ar!==null&&Ar.next!==null,Ld=0,Or=Ar=Zt=null,t8=!1,e)throw Error(oe(300));return r}function nT(){var r=cy!==0;return cy=0,r}function Go(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Or===null?Zt.memoizedState=Or=r:Or=Or.next=r,Or}function Fi(){if(Ar===null){var r=Zt.alternate;r=r!==null?r.memoizedState:null}else r=Ar.next;var e=Or===null?Zt.memoizedState:Or.next;if(e!==null)Or=e,Ar=r;else{if(r===null)throw Error(oe(310));Ar=r,r={memoizedState:Ar.memoizedState,baseState:Ar.baseState,baseQueue:Ar.baseQueue,queue:Ar.queue,next:null},Or===null?Zt.memoizedState=Or=r:Or=Or.next=r}return Or}function ly(r,e){return typeof e=="function"?e(r):e}function l9(r){var e=Fi(),t=e.queue;if(t===null)throw Error(oe(311));t.lastRenderedReducer=r;var n=Ar,s=n.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}n.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,n=n.baseState;var a=o=null,c=null,l=i;do{var u=l.lane;if((Ld&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:r(n,l.action);else{var d={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=d,o=n):c=c.next=d,Zt.lanes|=u,Ud|=u}l=l.next}while(l!==null&&l!==i);c===null?o=n:c.next=a,Co(n,e.memoizedState)||(ys=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=c,t.lastRenderedState=n}if(r=t.interleaved,r!==null){s=r;do i=s.lane,Zt.lanes|=i,Ud|=i,s=s.next;while(s!==r)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function u9(r){var e=Fi(),t=e.queue;if(t===null)throw Error(oe(311));t.lastRenderedReducer=r;var n=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=r(i,o.action),o=o.next;while(o!==s);Co(i,e.memoizedState)||(ys=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,n]}function bK(){}function vK(r,e){var t=Zt,n=Fi(),s=e(),i=!Co(n.memoizedState,s);if(i&&(n.memoizedState=s,ys=!0),n=n.queue,sT(AK.bind(null,t,n,r),[r]),n.getSnapshot!==e||i||Or!==null&&Or.memoizedState.tag&1){if(t.flags|=2048,uy(9,xK.bind(null,t,n,s,e),void 0,null),$r===null)throw Error(oe(349));Ld&30||EK(t,e,s)}return s}function EK(r,e,t){r.flags|=16384,r={getSnapshot:e,value:t},e=Zt.updateQueue,e===null?(e={lastEffect:null,stores:null},Zt.updateQueue=e,e.stores=[r]):(t=e.stores,t===null?e.stores=[r]:t.push(r))}function xK(r,e,t,n){e.value=t,e.getSnapshot=n,SK(e)&&CK(r)}function AK(r,e,t){return t(function(){SK(e)&&CK(r)})}function SK(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!Co(r,t)}catch{return!0}}function CK(r){var e=_c(r,1);e!==null&&vo(e,r,1,-1)}function VD(r){var e=Go();return typeof r=="function"&&(r=r()),e.memoizedState=e.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ly,lastRenderedState:r},e.queue=r,r=r.dispatch=xse.bind(null,Zt,r),[e.memoizedState,r]}function uy(r,e,t,n){return r={tag:r,create:e,destroy:t,deps:n,next:null},e=Zt.updateQueue,e===null?(e={lastEffect:null,stores:null},Zt.updateQueue=e,e.lastEffect=r.next=r):(t=e.lastEffect,t===null?e.lastEffect=r.next=r:(n=t.next,t.next=r,r.next=n,e.lastEffect=r)),r}function IK(){return Fi().memoizedState}function V3(r,e,t,n){var s=Go();Zt.flags|=r,s.memoizedState=uy(1|e,t,void 0,n===void 0?null:n)}function c5(r,e,t,n){var s=Fi();n=n===void 0?null:n;var i=void 0;if(Ar!==null){var o=Ar.memoizedState;if(i=o.destroy,n!==null&&tT(n,o.deps)){s.memoizedState=uy(e,t,i,n);return}}Zt.flags|=r,s.memoizedState=uy(1|e,t,i,n)}function HD(r,e){return V3(8390656,8,r,e)}function sT(r,e){return c5(2048,8,r,e)}function kK(r,e){return c5(4,2,r,e)}function TK(r,e){return c5(4,4,r,e)}function _K(r,e){if(typeof e=="function")return r=r(),e(r),function(){e(null)};if(e!=null)return r=r(),e.current=r,function(){e.current=null}}function PK(r,e,t){return t=t!=null?t.concat([r]):null,c5(4,4,_K.bind(null,e,r),t)}function iT(){}function NK(r,e){var t=Fi();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&tT(e,n[1])?n[0]:(t.memoizedState=[r,e],r)}function DK(r,e){var t=Fi();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&tT(e,n[1])?n[0]:(r=r(),t.memoizedState=[r,e],r)}function OK(r,e,t){return Ld&21?(Co(t,e)||(t=LH(),Zt.lanes|=t,Ud|=t,r.baseState=!0),e):(r.baseState&&(r.baseState=!1,ys=!0),r.memoizedState=t)}function vse(r,e){var t=St;St=t!==0&&4>t?t:4,r(!0);var n=c9.transition;c9.transition={};try{r(!1),e()}finally{St=t,c9.transition=n}}function RK(){return Fi().memoizedState}function Ese(r,e,t){var n=xu(r);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},BK(r))MK(e,t);else if(t=yK(r,e,t,n),t!==null){var s=Wn();vo(t,r,n,s),$K(t,e,n)}}function xse(r,e,t){var n=xu(r),s={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(BK(r))MK(e,s);else{var i=r.alternate;if(r.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,Co(a,o)){var c=e.interleaved;c===null?(s.next=s,Jk(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}t=yK(r,e,s,n),t!==null&&(s=Wn(),vo(t,r,n,s),$K(t,e,n))}}function BK(r){var e=r.alternate;return r===Zt||e!==null&&e===Zt}function MK(r,e){I2=t8=!0;var t=r.pending;t===null?e.next=e:(e.next=t.next,t.next=e),r.pending=e}function $K(r,e,t){if(t&4194240){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,Mk(r,t)}}var r8={readContext:Ui,useCallback:on,useContext:on,useEffect:on,useImperativeHandle:on,useInsertionEffect:on,useLayoutEffect:on,useMemo:on,useReducer:on,useRef:on,useState:on,useDebugValue:on,useDeferredValue:on,useTransition:on,useMutableSource:on,useSyncExternalStore:on,useId:on,unstable_isNewReconciler:!1},Ase={readContext:Ui,useCallback:function(r,e){return Go().memoizedState=[r,e===void 0?null:e],r},useContext:Ui,useEffect:HD,useImperativeHandle:function(r,e,t){return t=t!=null?t.concat([r]):null,V3(4194308,4,_K.bind(null,e,r),t)},useLayoutEffect:function(r,e){return V3(4194308,4,r,e)},useInsertionEffect:function(r,e){return V3(4,2,r,e)},useMemo:function(r,e){var t=Go();return e=e===void 0?null:e,r=r(),t.memoizedState=[r,e],r},useReducer:function(r,e,t){var n=Go();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:e},n.queue=r,r=r.dispatch=Ese.bind(null,Zt,r),[n.memoizedState,r]},useRef:function(r){var e=Go();return r={current:r},e.memoizedState=r},useState:VD,useDebugValue:iT,useDeferredValue:function(r){return Go().memoizedState=r},useTransition:function(){var r=VD(!1),e=r[0];return r=vse.bind(null,r[1]),Go().memoizedState=r,[e,r]},useMutableSource:function(){},useSyncExternalStore:function(r,e,t){var n=Zt,s=Go();if(jt){if(t===void 0)throw Error(oe(407));t=t()}else{if(t=e(),$r===null)throw Error(oe(349));Ld&30||EK(n,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,HD(AK.bind(null,n,i,r),[r]),n.flags|=2048,uy(9,xK.bind(null,n,i,t,e),void 0,null),t},useId:function(){var r=Go(),e=$r.identifierPrefix;if(jt){var t=gc,n=pc;t=(n&~(1<<32-bo(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=cy++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=bse++,e=":"+e+"r"+t.toString(32)+":";return r.memoizedState=e},unstable_isNewReconciler:!1},Sse={readContext:Ui,useCallback:NK,useContext:Ui,useEffect:sT,useImperativeHandle:PK,useInsertionEffect:kK,useLayoutEffect:TK,useMemo:DK,useReducer:l9,useRef:IK,useState:function(){return l9(ly)},useDebugValue:iT,useDeferredValue:function(r){var e=Fi();return OK(e,Ar.memoizedState,r)},useTransition:function(){var r=l9(ly)[0],e=Fi().memoizedState;return[r,e]},useMutableSource:bK,useSyncExternalStore:vK,useId:RK,unstable_isNewReconciler:!1},Cse={readContext:Ui,useCallback:NK,useContext:Ui,useEffect:sT,useImperativeHandle:PK,useInsertionEffect:kK,useLayoutEffect:TK,useMemo:DK,useReducer:u9,useRef:IK,useState:function(){return u9(ly)},useDebugValue:iT,useDeferredValue:function(r){var e=Fi();return Ar===null?e.memoizedState=r:OK(e,Ar.memoizedState,r)},useTransition:function(){var r=u9(ly)[0],e=Fi().memoizedState;return[r,e]},useMutableSource:bK,useSyncExternalStore:vK,useId:RK,unstable_isNewReconciler:!1};function no(r,e){if(r&&r.defaultProps){e=er({},e),r=r.defaultProps;for(var t in r)e[t]===void 0&&(e[t]=r[t]);return e}return e}function Wx(r,e,t,n){e=r.memoizedState,t=t(n,e),t=t==null?e:er({},e,t),r.memoizedState=t,r.lanes===0&&(r.updateQueue.baseState=t)}var l5={isMounted:function(r){return(r=r._reactInternals)?bf(r)===r:!1},enqueueSetState:function(r,e,t){r=r._reactInternals;var n=Wn(),s=xu(r),i=wc(n,s);i.payload=e,t!=null&&(i.callback=t),e=vu(r,i,s),e!==null&&(vo(e,r,s,n),F3(e,r,s))},enqueueReplaceState:function(r,e,t){r=r._reactInternals;var n=Wn(),s=xu(r),i=wc(n,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=vu(r,i,s),e!==null&&(vo(e,r,s,n),F3(e,r,s))},enqueueForceUpdate:function(r,e){r=r._reactInternals;var t=Wn(),n=xu(r),s=wc(t,n);s.tag=2,e!=null&&(s.callback=e),e=vu(r,s,n),e!==null&&(vo(e,r,n,t),F3(e,r,n))}};function KD(r,e,t,n,s,i,o){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(n,i,o):e.prototype&&e.prototype.isPureReactComponent?!ry(t,n)||!ry(s,i):!0}function LK(r,e,t){var n=!1,s=Ru,i=e.contextType;return typeof i=="object"&&i!==null?i=Ui(i):(s=vs(e)?Md:On.current,n=e.contextTypes,i=(n=n!=null)?H0(r,s):Ru),e=new e(t,i),r.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=l5,r.stateNode=e,e._reactInternals=r,n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=s,r.__reactInternalMemoizedMaskedChildContext=i),e}function GD(r,e,t,n){r=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==r&&l5.enqueueReplaceState(e,e.state,null)}function Qx(r,e,t,n){var s=r.stateNode;s.props=t,s.state=r.memoizedState,s.refs={},Yk(r);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Ui(i):(i=vs(e)?Md:On.current,s.context=H0(r,i)),s.state=r.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Wx(r,e,i,t),s.state=r.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&l5.enqueueReplaceState(s,s.state,null),Z4(r,t,s,n),s.state=r.memoizedState),typeof s.componentDidMount=="function"&&(r.flags|=4194308)}function q0(r,e){try{var t="",n=e;do t+=Zre(n),n=n.return;while(n);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:r,source:e,stack:s,digest:null}}function h9(r,e,t){return{value:r,source:null,stack:t??null,digest:e??null}}function Jx(r,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var Ise=typeof WeakMap=="function"?WeakMap:Map;function UK(r,e,t){t=wc(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){s8||(s8=!0,oA=n),Jx(r,e)},t}function FK(r,e,t){t=wc(-1,t),t.tag=3;var n=r.type.getDerivedStateFromError;if(typeof n=="function"){var s=e.value;t.payload=function(){return n(s)},t.callback=function(){Jx(r,e)}}var i=r.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){Jx(r,e),typeof n!="function"&&(Eu===null?Eu=new Set([this]):Eu.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function jD(r,e,t){var n=r.pingCache;if(n===null){n=r.pingCache=new Ise;var s=new Set;n.set(e,s)}else s=n.get(e),s===void 0&&(s=new Set,n.set(e,s));s.has(t)||(s.add(t),r=Fse.bind(null,r,e,t),e.then(r,r))}function qD(r){do{var e;if((e=r.tag===13)&&(e=r.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return r;r=r.return}while(r!==null);return null}function WD(r,e,t,n,s){return r.mode&1?(r.flags|=65536,r.lanes=s,r):(r===e?r.flags|=65536:(r.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=wc(-1,1),e.tag=2,vu(t,e,1))),t.lanes|=1),r)}var kse=zc.ReactCurrentOwner,ys=!1;function $n(r,e,t,n){e.child=r===null?gK(e,null,t,n):G0(e,r.child,t,n)}function QD(r,e,t,n,s){t=t.render;var i=e.ref;return Np(e,s),n=rT(r,e,t,n,i,s),t=nT(),r!==null&&!ys?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~s,Pc(r,e,s)):(jt&&t&&Kk(e),e.flags|=1,$n(r,e,n,s),e.child)}function JD(r,e,t,n,s){if(r===null){var i=t.type;return typeof i=="function"&&!fT(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,zK(r,e,i,n,s)):(r=j3(t.type,null,n,e,e.mode,s),r.ref=e.ref,r.return=e,e.child=r)}if(i=r.child,!(r.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:ry,t(o,n)&&r.ref===e.ref)return Pc(r,e,s)}return e.flags|=1,r=Au(i,n),r.ref=e.ref,r.return=e,e.child=r}function zK(r,e,t,n,s){if(r!==null){var i=r.memoizedProps;if(ry(i,n)&&r.ref===e.ref)if(ys=!1,e.pendingProps=n=i,(r.lanes&s)!==0)r.flags&131072&&(ys=!0);else return e.lanes=r.lanes,Pc(r,e,s)}return Yx(r,e,t,n,s)}function VK(r,e,t){var n=e.pendingProps,s=n.children,i=r!==null?r.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Mt(yp,Vs),Vs|=t;else{if(!(t&1073741824))return r=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:r,cachePool:null,transitions:null},e.updateQueue=null,Mt(yp,Vs),Vs|=r,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:t,Mt(yp,Vs),Vs|=n}else i!==null?(n=i.baseLanes|t,e.memoizedState=null):n=t,Mt(yp,Vs),Vs|=n;return $n(r,e,s,t),e.child}function HK(r,e){var t=e.ref;(r===null&&t!==null||r!==null&&r.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Yx(r,e,t,n,s){var i=vs(t)?Md:On.current;return i=H0(e,i),Np(e,s),t=rT(r,e,t,n,i,s),n=nT(),r!==null&&!ys?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~s,Pc(r,e,s)):(jt&&n&&Kk(e),e.flags|=1,$n(r,e,t,s),e.child)}function YD(r,e,t,n,s){if(vs(t)){var i=!0;W4(e)}else i=!1;if(Np(e,s),e.stateNode===null)H3(r,e),LK(e,t,n),Qx(e,t,n,s),n=!0;else if(r===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=t.contextType;typeof l=="object"&&l!==null?l=Ui(l):(l=vs(t)?Md:On.current,l=H0(e,l));var u=t.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==n||c!==l)&&GD(e,o,n,l),Il=!1;var p=e.memoizedState;o.state=p,Z4(e,n,o,s),c=e.memoizedState,a!==n||p!==c||bs.current||Il?(typeof u=="function"&&(Wx(e,t,u,n),c=e.memoizedState),(a=Il||KD(e,t,a,n,p,c,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=c),o.props=n,o.state=c,o.context=l,n=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,mK(r,e),a=e.memoizedProps,l=e.type===e.elementType?a:no(e.type,a),o.props=l,d=e.pendingProps,p=o.context,c=t.contextType,typeof c=="object"&&c!==null?c=Ui(c):(c=vs(t)?Md:On.current,c=H0(e,c));var y=t.getDerivedStateFromProps;(u=typeof y=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||p!==c)&&GD(e,o,n,c),Il=!1,p=e.memoizedState,o.state=p,Z4(e,n,o,s);var f=e.memoizedState;a!==d||p!==f||bs.current||Il?(typeof y=="function"&&(Wx(e,t,y,n),f=e.memoizedState),(l=Il||KD(e,t,l,n,p,f,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,f,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,f,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=f),o.props=n,o.state=f,o.context=c,n=l):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=1024),n=!1)}return Xx(r,e,t,n,i,s)}function Xx(r,e,t,n,s,i){HK(r,e);var o=(e.flags&128)!==0;if(!n&&!o)return s&&MD(e,t,!1),Pc(r,e,i);n=e.stateNode,kse.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,r!==null&&o?(e.child=G0(e,r.child,null,i),e.child=G0(e,null,a,i)):$n(r,e,a,i),e.memoizedState=n.state,s&&MD(e,t,!0),e.child}function KK(r){var e=r.stateNode;e.pendingContext?BD(r,e.pendingContext,e.pendingContext!==e.context):e.context&&BD(r,e.context,!1),Xk(r,e.containerInfo)}function XD(r,e,t,n,s){return K0(),jk(s),e.flags|=256,$n(r,e,t,n),e.child}var Zx={dehydrated:null,treeContext:null,retryLane:0};function eA(r){return{baseLanes:r,cachePool:null,transitions:null}}function GK(r,e,t){var n=e.pendingProps,s=Jt.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=r!==null&&r.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(r===null||r.memoizedState!==null)&&(s|=1),Mt(Jt,s&1),r===null)return jx(e),r=e.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(e.mode&1?r.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,r=n.fallback,i?(n=e.mode,i=e.child,o={mode:"hidden",children:o},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=d5(o,n,0,null),r=xd(r,n,t,null),i.return=e,r.return=e,i.sibling=r,e.child=i,e.child.memoizedState=eA(t),e.memoizedState=Zx,r):oT(e,o));if(s=r.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return Tse(r,e,o,n,a,s,t);if(i){i=n.fallback,o=e.mode,s=r.child,a=s.sibling;var c={mode:"hidden",children:n.children};return!(o&1)&&e.child!==s?(n=e.child,n.childLanes=0,n.pendingProps=c,e.deletions=null):(n=Au(s,c),n.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Au(a,i):(i=xd(i,o,t,null),i.flags|=2),i.return=e,n.return=e,n.sibling=i,e.child=n,n=i,i=e.child,o=r.child.memoizedState,o=o===null?eA(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=r.childLanes&~t,e.memoizedState=Zx,n}return i=r.child,r=i.sibling,n=Au(i,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,r!==null&&(t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)),e.child=n,e.memoizedState=null,n}function oT(r,e){return e=d5({mode:"visible",children:e},r.mode,0,null),e.return=r,r.child=e}function _w(r,e,t,n){return n!==null&&jk(n),G0(e,r.child,null,t),r=oT(e,e.pendingProps.children),r.flags|=2,e.memoizedState=null,r}function Tse(r,e,t,n,s,i,o){if(t)return e.flags&256?(e.flags&=-257,n=h9(Error(oe(422))),_w(r,e,o,n)):e.memoizedState!==null?(e.child=r.child,e.flags|=128,null):(i=n.fallback,s=e.mode,n=d5({mode:"visible",children:n.children},s,0,null),i=xd(i,s,o,null),i.flags|=2,n.return=e,i.return=e,n.sibling=i,e.child=n,e.mode&1&&G0(e,r.child,null,o),e.child.memoizedState=eA(o),e.memoizedState=Zx,i);if(!(e.mode&1))return _w(r,e,o,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var a=n.dgst;return n=a,i=Error(oe(419)),n=h9(i,n,void 0),_w(r,e,o,n)}if(a=(o&r.childLanes)!==0,ys||a){if(n=$r,n!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(n.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,_c(r,s),vo(n,r,s,-1))}return dT(),n=h9(Error(oe(421))),_w(r,e,o,n)}return s.data==="$?"?(e.flags|=128,e.child=r.child,e=zse.bind(null,r),s._reactRetry=e,null):(r=i.treeContext,Ws=bu(s.nextSibling),Qs=e,jt=!0,fo=null,r!==null&&(Ii[ki++]=pc,Ii[ki++]=gc,Ii[ki++]=$d,pc=r.id,gc=r.overflow,$d=e),e=oT(e,n.children),e.flags|=4096,e)}function ZD(r,e,t){r.lanes|=e;var n=r.alternate;n!==null&&(n.lanes|=e),qx(r.return,e,t)}function d9(r,e,t,n,s){var i=r.memoizedState;i===null?r.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=t,i.tailMode=s)}function jK(r,e,t){var n=e.pendingProps,s=n.revealOrder,i=n.tail;if($n(r,e,n.children,t),n=Jt.current,n&2)n=n&1|2,e.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=e.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&ZD(r,t,e);else if(r.tag===19)ZD(r,t,e);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}n&=1}if(Mt(Jt,n),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)r=t.alternate,r!==null&&e8(r)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),d9(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(r=s.alternate,r!==null&&e8(r)===null){e.child=s;break}r=s.sibling,s.sibling=t,t=s,s=r}d9(e,!0,t,null,i);break;case"together":d9(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function H3(r,e){!(e.mode&1)&&r!==null&&(r.alternate=null,e.alternate=null,e.flags|=2)}function Pc(r,e,t){if(r!==null&&(e.dependencies=r.dependencies),Ud|=e.lanes,!(t&e.childLanes))return null;if(r!==null&&e.child!==r.child)throw Error(oe(153));if(e.child!==null){for(r=e.child,t=Au(r,r.pendingProps),e.child=t,t.return=e;r.sibling!==null;)r=r.sibling,t=t.sibling=Au(r,r.pendingProps),t.return=e;t.sibling=null}return e.child}function _se(r,e,t){switch(e.tag){case 3:KK(e),K0();break;case 5:wK(e);break;case 1:vs(e.type)&&W4(e);break;case 4:Xk(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,s=e.memoizedProps.value;Mt(Y4,n._currentValue),n._currentValue=s;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(Mt(Jt,Jt.current&1),e.flags|=128,null):t&e.child.childLanes?GK(r,e,t):(Mt(Jt,Jt.current&1),r=Pc(r,e,t),r!==null?r.sibling:null);Mt(Jt,Jt.current&1);break;case 19:if(n=(t&e.childLanes)!==0,r.flags&128){if(n)return jK(r,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Mt(Jt,Jt.current),n)break;return null;case 22:case 23:return e.lanes=0,VK(r,e,t)}return Pc(r,e,t)}var qK,tA,WK,QK;qK=function(r,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)r.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};tA=function(){};WK=function(r,e,t,n){var s=r.memoizedProps;if(s!==n){r=e.stateNode,Vh(da.current);var i=null;switch(t){case"input":s=Ax(r,s),n=Ax(r,n),i=[];break;case"select":s=er({},s,{value:void 0}),n=er({},n,{value:void 0}),i=[];break;case"textarea":s=Ix(r,s),n=Ix(r,n),i=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(r.onclick=j4)}Tx(t,n);var o;t=null;for(l in s)if(!n.hasOwnProperty(l)&&s.hasOwnProperty(l)&&s[l]!=null)if(l==="style"){var a=s[l];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Q2.hasOwnProperty(l)?i||(i=[]):(i=i||[]).push(l,null));for(l in n){var c=n[l];if(a=s!=null?s[l]:void 0,n.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(i||(i=[]),i.push(l,t)),t=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(i=i||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Q2.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&zt("scroll",r),i||a===c||(i=[])):(i=i||[]).push(l,c))}t&&(i=i||[]).push("style",t);var l=i;(e.updateQueue=l)&&(e.flags|=4)}};QK=function(r,e,t,n){t!==n&&(e.flags|=4)};function Eg(r,e){if(!jt)switch(r.tailMode){case"hidden":e=r.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?r.tail=null:t.sibling=null;break;case"collapsed":t=r.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||r.tail===null?r.tail=null:r.tail.sibling=null:n.sibling=null}}function an(r){var e=r.alternate!==null&&r.alternate.child===r.child,t=0,n=0;if(e)for(var s=r.child;s!==null;)t|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=r,s=s.sibling;else for(s=r.child;s!==null;)t|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=r,s=s.sibling;return r.subtreeFlags|=n,r.childLanes=t,e}function Pse(r,e,t){var n=e.pendingProps;switch(Gk(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return an(e),null;case 1:return vs(e.type)&&q4(),an(e),null;case 3:return n=e.stateNode,j0(),Ht(bs),Ht(On),eT(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(r===null||r.child===null)&&(kw(e)?e.flags|=4:r===null||r.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,fo!==null&&(lA(fo),fo=null))),tA(r,e),an(e),null;case 5:Zk(e);var s=Vh(ay.current);if(t=e.type,r!==null&&e.stateNode!=null)WK(r,e,t,n,s),r.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(oe(166));return an(e),null}if(r=Vh(da.current),kw(e)){n=e.stateNode,t=e.type;var i=e.memoizedProps;switch(n[ia]=e,n[iy]=i,r=(e.mode&1)!==0,t){case"dialog":zt("cancel",n),zt("close",n);break;case"iframe":case"object":case"embed":zt("load",n);break;case"video":case"audio":for(s=0;s<s2.length;s++)zt(s2[s],n);break;case"source":zt("error",n);break;case"img":case"image":case"link":zt("error",n),zt("load",n);break;case"details":zt("toggle",n);break;case"input":cD(n,i),zt("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},zt("invalid",n);break;case"textarea":uD(n,i),zt("invalid",n)}Tx(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?n.textContent!==a&&(i.suppressHydrationWarning!==!0&&Iw(n.textContent,a,r),s=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Iw(n.textContent,a,r),s=["children",""+a]):Q2.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&zt("scroll",n)}switch(t){case"input":ww(n),lD(n,i,!0);break;case"textarea":ww(n),hD(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=j4)}n=s,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=AH(t)),r==="http://www.w3.org/1999/xhtml"?t==="script"?(r=o.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof n.is=="string"?r=o.createElement(t,{is:n.is}):(r=o.createElement(t),t==="select"&&(o=r,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):r=o.createElementNS(r,t),r[ia]=e,r[iy]=n,qK(r,e,!1,!1),e.stateNode=r;e:{switch(o=_x(t,n),t){case"dialog":zt("cancel",r),zt("close",r),s=n;break;case"iframe":case"object":case"embed":zt("load",r),s=n;break;case"video":case"audio":for(s=0;s<s2.length;s++)zt(s2[s],r);s=n;break;case"source":zt("error",r),s=n;break;case"img":case"image":case"link":zt("error",r),zt("load",r),s=n;break;case"details":zt("toggle",r),s=n;break;case"input":cD(r,n),s=Ax(r,n),zt("invalid",r);break;case"option":s=n;break;case"select":r._wrapperState={wasMultiple:!!n.multiple},s=er({},n,{value:void 0}),zt("invalid",r);break;case"textarea":uD(r,n),s=Ix(r,n),zt("invalid",r);break;default:s=n}Tx(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var c=a[i];i==="style"?IH(r,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&SH(r,c)):i==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&J2(r,c):typeof c=="number"&&J2(r,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Q2.hasOwnProperty(i)?c!=null&&i==="onScroll"&&zt("scroll",r):c!=null&&Pk(r,i,c,o))}switch(t){case"input":ww(r),lD(r,n,!1);break;case"textarea":ww(r),hD(r);break;case"option":n.value!=null&&r.setAttribute("value",""+Ou(n.value));break;case"select":r.multiple=!!n.multiple,i=n.value,i!=null?kp(r,!!n.multiple,i,!1):n.defaultValue!=null&&kp(r,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(r.onclick=j4)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return an(e),null;case 6:if(r&&e.stateNode!=null)QK(r,e,r.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(oe(166));if(t=Vh(ay.current),Vh(da.current),kw(e)){if(n=e.stateNode,t=e.memoizedProps,n[ia]=e,(i=n.nodeValue!==t)&&(r=Qs,r!==null))switch(r.tag){case 3:Iw(n.nodeValue,t,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Iw(n.nodeValue,t,(r.mode&1)!==0)}i&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[ia]=e,e.stateNode=n}return an(e),null;case 13:if(Ht(Jt),n=e.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(jt&&Ws!==null&&e.mode&1&&!(e.flags&128))fK(),K0(),e.flags|=98560,i=!1;else if(i=kw(e),n!==null&&n.dehydrated!==null){if(r===null){if(!i)throw Error(oe(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(oe(317));i[ia]=e}else K0(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;an(e),i=!1}else fo!==null&&(lA(fo),fo=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(r!==null&&r.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(r===null||Jt.current&1?Sr===0&&(Sr=3):dT())),e.updateQueue!==null&&(e.flags|=4),an(e),null);case 4:return j0(),tA(r,e),r===null&&ny(e.stateNode.containerInfo),an(e),null;case 10:return Qk(e.type._context),an(e),null;case 17:return vs(e.type)&&q4(),an(e),null;case 19:if(Ht(Jt),i=e.memoizedState,i===null)return an(e),null;if(n=(e.flags&128)!==0,o=i.rendering,o===null)if(n)Eg(i,!1);else{if(Sr!==0||r!==null&&r.flags&128)for(r=e.child;r!==null;){if(o=e8(r),o!==null){for(e.flags|=128,Eg(i,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)i=t,r=n,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=r,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,r=o.dependencies,i.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t=t.sibling;return Mt(Jt,Jt.current&1|2),e.child}r=r.sibling}i.tail!==null&&ur()>W0&&(e.flags|=128,n=!0,Eg(i,!1),e.lanes=4194304)}else{if(!n)if(r=e8(o),r!==null){if(e.flags|=128,n=!0,t=r.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Eg(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!jt)return an(e),null}else 2*ur()-i.renderingStartTime>W0&&t!==1073741824&&(e.flags|=128,n=!0,Eg(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=ur(),e.sibling=null,t=Jt.current,Mt(Jt,n?t&1|2:t&1),e):(an(e),null);case 22:case 23:return hT(),n=e.memoizedState!==null,r!==null&&r.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Vs&1073741824&&(an(e),e.subtreeFlags&6&&(e.flags|=8192)):an(e),null;case 24:return null;case 25:return null}throw Error(oe(156,e.tag))}function Nse(r,e){switch(Gk(e),e.tag){case 1:return vs(e.type)&&q4(),r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 3:return j0(),Ht(bs),Ht(On),eT(),r=e.flags,r&65536&&!(r&128)?(e.flags=r&-65537|128,e):null;case 5:return Zk(e),null;case 13:if(Ht(Jt),r=e.memoizedState,r!==null&&r.dehydrated!==null){if(e.alternate===null)throw Error(oe(340));K0()}return r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 19:return Ht(Jt),null;case 4:return j0(),null;case 10:return Qk(e.type._context),null;case 22:case 23:return hT(),null;case 24:return null;default:return null}}var Pw=!1,Tn=!1,Dse=typeof WeakSet=="function"?WeakSet:Set,Ce=null;function gp(r,e){var t=r.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){ir(r,e,n)}else t.current=null}function rA(r,e,t){try{t()}catch(n){ir(r,e,n)}}var eO=!1;function Ose(r,e){if(Ux=H4,r=eK(),Hk(r)){if("selectionStart"in r)var t={start:r.selectionStart,end:r.selectionEnd};else e:{t=(t=r.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var s=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,c=-1,l=0,u=0,d=r,p=null;t:for(;;){for(var y;d!==t||s!==0&&d.nodeType!==3||(a=o+s),d!==i||n!==0&&d.nodeType!==3||(c=o+n),d.nodeType===3&&(o+=d.nodeValue.length),(y=d.firstChild)!==null;)p=d,d=y;for(;;){if(d===r)break t;if(p===t&&++l===s&&(a=o),p===i&&++u===n&&(c=o),(y=d.nextSibling)!==null)break;d=p,p=d.parentNode}d=y}t=a===-1||c===-1?null:{start:a,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(Fx={focusedElem:r,selectionRange:t},H4=!1,Ce=e;Ce!==null;)if(e=Ce,r=e.child,(e.subtreeFlags&1028)!==0&&r!==null)r.return=e,Ce=r;else for(;Ce!==null;){e=Ce;try{var f=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var g=f.memoizedProps,w=f.memoizedState,m=e.stateNode,b=m.getSnapshotBeforeUpdate(e.elementType===e.type?g:no(e.type,g),w);m.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(oe(163))}}catch(E){ir(e,e.return,E)}if(r=e.sibling,r!==null){r.return=e.return,Ce=r;break}Ce=e.return}return f=eO,eO=!1,f}function k2(r,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&r)===r){var i=s.destroy;s.destroy=void 0,i!==void 0&&rA(e,t,i)}s=s.next}while(s!==n)}}function u5(r,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&r)===r){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function nA(r){var e=r.ref;if(e!==null){var t=r.stateNode;switch(r.tag){case 5:r=t;break;default:r=t}typeof e=="function"?e(r):e.current=r}}function JK(r){var e=r.alternate;e!==null&&(r.alternate=null,JK(e)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(e=r.stateNode,e!==null&&(delete e[ia],delete e[iy],delete e[Hx],delete e[gse],delete e[yse])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function YK(r){return r.tag===5||r.tag===3||r.tag===4}function tO(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||YK(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function sA(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(r,e):t.insertBefore(r,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(r,t)):(e=t,e.appendChild(r)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=j4));else if(n!==4&&(r=r.child,r!==null))for(sA(r,e,t),r=r.sibling;r!==null;)sA(r,e,t),r=r.sibling}function iA(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.insertBefore(r,e):t.appendChild(r);else if(n!==4&&(r=r.child,r!==null))for(iA(r,e,t),r=r.sibling;r!==null;)iA(r,e,t),r=r.sibling}var Hr=null,lo=!1;function il(r,e,t){for(t=t.child;t!==null;)XK(r,e,t),t=t.sibling}function XK(r,e,t){if(ha&&typeof ha.onCommitFiberUnmount=="function")try{ha.onCommitFiberUnmount(r5,t)}catch{}switch(t.tag){case 5:Tn||gp(t,e);case 6:var n=Hr,s=lo;Hr=null,il(r,e,t),Hr=n,lo=s,Hr!==null&&(lo?(r=Hr,t=t.stateNode,r.nodeType===8?r.parentNode.removeChild(t):r.removeChild(t)):Hr.removeChild(t.stateNode));break;case 18:Hr!==null&&(lo?(r=Hr,t=t.stateNode,r.nodeType===8?i9(r.parentNode,t):r.nodeType===1&&i9(r,t),ey(r)):i9(Hr,t.stateNode));break;case 4:n=Hr,s=lo,Hr=t.stateNode.containerInfo,lo=!0,il(r,e,t),Hr=n,lo=s;break;case 0:case 11:case 14:case 15:if(!Tn&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&rA(t,e,o),s=s.next}while(s!==n)}il(r,e,t);break;case 1:if(!Tn&&(gp(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(a){ir(t,e,a)}il(r,e,t);break;case 21:il(r,e,t);break;case 22:t.mode&1?(Tn=(n=Tn)||t.memoizedState!==null,il(r,e,t),Tn=n):il(r,e,t);break;default:il(r,e,t)}}function rO(r){var e=r.updateQueue;if(e!==null){r.updateQueue=null;var t=r.stateNode;t===null&&(t=r.stateNode=new Dse),e.forEach(function(n){var s=Vse.bind(null,r,n);t.has(n)||(t.add(n),n.then(s,s))})}}function Wi(r,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var s=t[n];try{var i=r,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Hr=a.stateNode,lo=!1;break e;case 3:Hr=a.stateNode.containerInfo,lo=!0;break e;case 4:Hr=a.stateNode.containerInfo,lo=!0;break e}a=a.return}if(Hr===null)throw Error(oe(160));XK(i,o,s),Hr=null,lo=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(l){ir(s,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)ZK(e,r),e=e.sibling}function ZK(r,e){var t=r.alternate,n=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Wi(e,r),Mo(r),n&4){try{k2(3,r,r.return),u5(3,r)}catch(g){ir(r,r.return,g)}try{k2(5,r,r.return)}catch(g){ir(r,r.return,g)}}break;case 1:Wi(e,r),Mo(r),n&512&&t!==null&&gp(t,t.return);break;case 5:if(Wi(e,r),Mo(r),n&512&&t!==null&&gp(t,t.return),r.flags&32){var s=r.stateNode;try{J2(s,"")}catch(g){ir(r,r.return,g)}}if(n&4&&(s=r.stateNode,s!=null)){var i=r.memoizedProps,o=t!==null?t.memoizedProps:i,a=r.type,c=r.updateQueue;if(r.updateQueue=null,c!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&EH(s,i),_x(a,o);var l=_x(a,i);for(o=0;o<c.length;o+=2){var u=c[o],d=c[o+1];u==="style"?IH(s,d):u==="dangerouslySetInnerHTML"?SH(s,d):u==="children"?J2(s,d):Pk(s,u,d,l)}switch(a){case"input":Sx(s,i);break;case"textarea":xH(s,i);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?kp(s,!!i.multiple,y,!1):p!==!!i.multiple&&(i.defaultValue!=null?kp(s,!!i.multiple,i.defaultValue,!0):kp(s,!!i.multiple,i.multiple?[]:"",!1))}s[iy]=i}catch(g){ir(r,r.return,g)}}break;case 6:if(Wi(e,r),Mo(r),n&4){if(r.stateNode===null)throw Error(oe(162));s=r.stateNode,i=r.memoizedProps;try{s.nodeValue=i}catch(g){ir(r,r.return,g)}}break;case 3:if(Wi(e,r),Mo(r),n&4&&t!==null&&t.memoizedState.isDehydrated)try{ey(e.containerInfo)}catch(g){ir(r,r.return,g)}break;case 4:Wi(e,r),Mo(r);break;case 13:Wi(e,r),Mo(r),s=r.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(lT=ur())),n&4&&rO(r);break;case 22:if(u=t!==null&&t.memoizedState!==null,r.mode&1?(Tn=(l=Tn)||u,Wi(e,r),Tn=l):Wi(e,r),Mo(r),n&8192){if(l=r.memoizedState!==null,(r.stateNode.isHidden=l)&&!u&&r.mode&1)for(Ce=r,u=r.child;u!==null;){for(d=Ce=u;Ce!==null;){switch(p=Ce,y=p.child,p.tag){case 0:case 11:case 14:case 15:k2(4,p,p.return);break;case 1:gp(p,p.return);var f=p.stateNode;if(typeof f.componentWillUnmount=="function"){n=p,t=p.return;try{e=n,f.props=e.memoizedProps,f.state=e.memoizedState,f.componentWillUnmount()}catch(g){ir(n,t,g)}}break;case 5:gp(p,p.return);break;case 22:if(p.memoizedState!==null){sO(d);continue}}y!==null?(y.return=p,Ce=y):sO(d)}u=u.sibling}e:for(u=null,d=r;;){if(d.tag===5){if(u===null){u=d;try{s=d.stateNode,l?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=d.stateNode,c=d.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=CH("display",o))}catch(g){ir(r,r.return,g)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(g){ir(r,r.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===r)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===r)break e;for(;d.sibling===null;){if(d.return===null||d.return===r)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Wi(e,r),Mo(r),n&4&&rO(r);break;case 21:break;default:Wi(e,r),Mo(r)}}function Mo(r){var e=r.flags;if(e&2){try{e:{for(var t=r.return;t!==null;){if(YK(t)){var n=t;break e}t=t.return}throw Error(oe(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(J2(s,""),n.flags&=-33);var i=tO(r);iA(r,i,s);break;case 3:case 4:var o=n.stateNode.containerInfo,a=tO(r);sA(r,a,o);break;default:throw Error(oe(161))}}catch(c){ir(r,r.return,c)}r.flags&=-3}e&4096&&(r.flags&=-4097)}function Rse(r,e,t){Ce=r,eG(r)}function eG(r,e,t){for(var n=(r.mode&1)!==0;Ce!==null;){var s=Ce,i=s.child;if(s.tag===22&&n){var o=s.memoizedState!==null||Pw;if(!o){var a=s.alternate,c=a!==null&&a.memoizedState!==null||Tn;a=Pw;var l=Tn;if(Pw=o,(Tn=c)&&!l)for(Ce=s;Ce!==null;)o=Ce,c=o.child,o.tag===22&&o.memoizedState!==null?iO(s):c!==null?(c.return=o,Ce=c):iO(s);for(;i!==null;)Ce=i,eG(i),i=i.sibling;Ce=s,Pw=a,Tn=l}nO(r)}else s.subtreeFlags&8772&&i!==null?(i.return=s,Ce=i):nO(r)}}function nO(r){for(;Ce!==null;){var e=Ce;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Tn||u5(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Tn)if(t===null)n.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:no(e.type,t.memoizedProps);n.componentDidUpdate(s,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&zD(e,i,n);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}zD(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&ey(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(oe(163))}Tn||e.flags&512&&nA(e)}catch(p){ir(e,e.return,p)}}if(e===r){Ce=null;break}if(t=e.sibling,t!==null){t.return=e.return,Ce=t;break}Ce=e.return}}function sO(r){for(;Ce!==null;){var e=Ce;if(e===r){Ce=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Ce=t;break}Ce=e.return}}function iO(r){for(;Ce!==null;){var e=Ce;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{u5(4,e)}catch(c){ir(e,t,c)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var s=e.return;try{n.componentDidMount()}catch(c){ir(e,s,c)}}var i=e.return;try{nA(e)}catch(c){ir(e,i,c)}break;case 5:var o=e.return;try{nA(e)}catch(c){ir(e,o,c)}}}catch(c){ir(e,e.return,c)}if(e===r){Ce=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ce=a;break}Ce=e.return}}var Bse=Math.ceil,n8=zc.ReactCurrentDispatcher,aT=zc.ReactCurrentOwner,Mi=zc.ReactCurrentBatchConfig,ht=0,$r=null,wr=null,Qr=0,Vs=0,yp=th(0),Sr=0,hy=null,Ud=0,h5=0,cT=0,T2=null,fs=null,lT=0,W0=1/0,La=null,s8=!1,oA=null,Eu=null,Nw=!1,lu=null,i8=0,_2=0,aA=null,K3=-1,G3=0;function Wn(){return ht&6?ur():K3!==-1?K3:K3=ur()}function xu(r){return r.mode&1?ht&2&&Qr!==0?Qr&-Qr:wse.transition!==null?(G3===0&&(G3=LH()),G3):(r=St,r!==0||(r=window.event,r=r===void 0?16:GH(r.type)),r):1}function vo(r,e,t,n){if(50<_2)throw _2=0,aA=null,Error(oe(185));xm(r,t,n),(!(ht&2)||r!==$r)&&(r===$r&&(!(ht&2)&&(h5|=t),Sr===4&&Ul(r,Qr)),Es(r,n),t===1&&ht===0&&!(e.mode&1)&&(W0=ur()+500,a5&&rh()))}function Es(r,e){var t=r.callbackNode;wne(r,e);var n=V4(r,r===$r?Qr:0);if(n===0)t!==null&&pD(t),r.callbackNode=null,r.callbackPriority=0;else if(e=n&-n,r.callbackPriority!==e){if(t!=null&&pD(t),e===1)r.tag===0?mse(oO.bind(null,r)):uK(oO.bind(null,r)),fse(function(){!(ht&6)&&rh()}),t=null;else{switch(UH(n)){case 1:t=Bk;break;case 4:t=MH;break;case 16:t=z4;break;case 536870912:t=$H;break;default:t=z4}t=cG(t,tG.bind(null,r))}r.callbackPriority=e,r.callbackNode=t}}function tG(r,e){if(K3=-1,G3=0,ht&6)throw Error(oe(327));var t=r.callbackNode;if(Dp()&&r.callbackNode!==t)return null;var n=V4(r,r===$r?Qr:0);if(n===0)return null;if(n&30||n&r.expiredLanes||e)e=o8(r,n);else{e=n;var s=ht;ht|=2;var i=nG();($r!==r||Qr!==e)&&(La=null,W0=ur()+500,Ed(r,e));do try{Lse();break}catch(a){rG(r,a)}while(!0);Wk(),n8.current=i,ht=s,wr!==null?e=0:($r=null,Qr=0,e=Sr)}if(e!==0){if(e===2&&(s=Rx(r),s!==0&&(n=s,e=cA(r,s))),e===1)throw t=hy,Ed(r,0),Ul(r,n),Es(r,ur()),t;if(e===6)Ul(r,n);else{if(s=r.current.alternate,!(n&30)&&!Mse(s)&&(e=o8(r,n),e===2&&(i=Rx(r),i!==0&&(n=i,e=cA(r,i))),e===1))throw t=hy,Ed(r,0),Ul(r,n),Es(r,ur()),t;switch(r.finishedWork=s,r.finishedLanes=n,e){case 0:case 1:throw Error(oe(345));case 2:Ih(r,fs,La);break;case 3:if(Ul(r,n),(n&130023424)===n&&(e=lT+500-ur(),10<e)){if(V4(r,0)!==0)break;if(s=r.suspendedLanes,(s&n)!==n){Wn(),r.pingedLanes|=r.suspendedLanes&s;break}r.timeoutHandle=Vx(Ih.bind(null,r,fs,La),e);break}Ih(r,fs,La);break;case 4:if(Ul(r,n),(n&4194240)===n)break;for(e=r.eventTimes,s=-1;0<n;){var o=31-bo(n);i=1<<o,o=e[o],o>s&&(s=o),n&=~i}if(n=s,n=ur()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Bse(n/1960))-n,10<n){r.timeoutHandle=Vx(Ih.bind(null,r,fs,La),n);break}Ih(r,fs,La);break;case 5:Ih(r,fs,La);break;default:throw Error(oe(329))}}}return Es(r,ur()),r.callbackNode===t?tG.bind(null,r):null}function cA(r,e){var t=T2;return r.current.memoizedState.isDehydrated&&(Ed(r,e).flags|=256),r=o8(r,e),r!==2&&(e=fs,fs=t,e!==null&&lA(e)),r}function lA(r){fs===null?fs=r:fs.push.apply(fs,r)}function Mse(r){for(var e=r;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var s=t[n],i=s.getSnapshot;s=s.value;try{if(!Co(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ul(r,e){for(e&=~cT,e&=~h5,r.suspendedLanes|=e,r.pingedLanes&=~e,r=r.expirationTimes;0<e;){var t=31-bo(e),n=1<<t;r[t]=-1,e&=~n}}function oO(r){if(ht&6)throw Error(oe(327));Dp();var e=V4(r,0);if(!(e&1))return Es(r,ur()),null;var t=o8(r,e);if(r.tag!==0&&t===2){var n=Rx(r);n!==0&&(e=n,t=cA(r,n))}if(t===1)throw t=hy,Ed(r,0),Ul(r,e),Es(r,ur()),t;if(t===6)throw Error(oe(345));return r.finishedWork=r.current.alternate,r.finishedLanes=e,Ih(r,fs,La),Es(r,ur()),null}function uT(r,e){var t=ht;ht|=1;try{return r(e)}finally{ht=t,ht===0&&(W0=ur()+500,a5&&rh())}}function Fd(r){lu!==null&&lu.tag===0&&!(ht&6)&&Dp();var e=ht;ht|=1;var t=Mi.transition,n=St;try{if(Mi.transition=null,St=1,r)return r()}finally{St=n,Mi.transition=t,ht=e,!(ht&6)&&rh()}}function hT(){Vs=yp.current,Ht(yp)}function Ed(r,e){r.finishedWork=null,r.finishedLanes=0;var t=r.timeoutHandle;if(t!==-1&&(r.timeoutHandle=-1,dse(t)),wr!==null)for(t=wr.return;t!==null;){var n=t;switch(Gk(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&q4();break;case 3:j0(),Ht(bs),Ht(On),eT();break;case 5:Zk(n);break;case 4:j0();break;case 13:Ht(Jt);break;case 19:Ht(Jt);break;case 10:Qk(n.type._context);break;case 22:case 23:hT()}t=t.return}if($r=r,wr=r=Au(r.current,null),Qr=Vs=e,Sr=0,hy=null,cT=h5=Ud=0,fs=T2=null,zh!==null){for(e=0;e<zh.length;e++)if(t=zh[e],n=t.interleaved,n!==null){t.interleaved=null;var s=n.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,n.next=o}t.pending=n}zh=null}return r}function rG(r,e){do{var t=wr;try{if(Wk(),z3.current=r8,t8){for(var n=Zt.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}t8=!1}if(Ld=0,Or=Ar=Zt=null,I2=!1,cy=0,aT.current=null,t===null||t.return===null){Sr=1,hy=e,wr=null;break}e:{var i=r,o=t.return,a=t,c=e;if(e=Qr,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var y=qD(o);if(y!==null){y.flags&=-257,WD(y,o,a,i,e),y.mode&1&&jD(i,l,e),e=y,c=l;var f=e.updateQueue;if(f===null){var g=new Set;g.add(c),e.updateQueue=g}else f.add(c);break e}else{if(!(e&1)){jD(i,l,e),dT();break e}c=Error(oe(426))}}else if(jt&&a.mode&1){var w=qD(o);if(w!==null){!(w.flags&65536)&&(w.flags|=256),WD(w,o,a,i,e),jk(q0(c,a));break e}}i=c=q0(c,a),Sr!==4&&(Sr=2),T2===null?T2=[i]:T2.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var m=UK(i,c,e);FD(i,m);break e;case 1:a=c;var b=i.type,v=i.stateNode;if(!(i.flags&128)&&(typeof b.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Eu===null||!Eu.has(v)))){i.flags|=65536,e&=-e,i.lanes|=e;var E=FK(i,a,e);FD(i,E);break e}}i=i.return}while(i!==null)}iG(t)}catch(S){e=S,wr===t&&t!==null&&(wr=t=t.return);continue}break}while(!0)}function nG(){var r=n8.current;return n8.current=r8,r===null?r8:r}function dT(){(Sr===0||Sr===3||Sr===2)&&(Sr=4),$r===null||!(Ud&268435455)&&!(h5&268435455)||Ul($r,Qr)}function o8(r,e){var t=ht;ht|=2;var n=nG();($r!==r||Qr!==e)&&(La=null,Ed(r,e));do try{$se();break}catch(s){rG(r,s)}while(!0);if(Wk(),ht=t,n8.current=n,wr!==null)throw Error(oe(261));return $r=null,Qr=0,Sr}function $se(){for(;wr!==null;)sG(wr)}function Lse(){for(;wr!==null&&!lne();)sG(wr)}function sG(r){var e=aG(r.alternate,r,Vs);r.memoizedProps=r.pendingProps,e===null?iG(r):wr=e,aT.current=null}function iG(r){var e=r;do{var t=e.alternate;if(r=e.return,e.flags&32768){if(t=Nse(t,e),t!==null){t.flags&=32767,wr=t;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{Sr=6,wr=null;return}}else if(t=Pse(t,e,Vs),t!==null){wr=t;return}if(e=e.sibling,e!==null){wr=e;return}wr=e=r}while(e!==null);Sr===0&&(Sr=5)}function Ih(r,e,t){var n=St,s=Mi.transition;try{Mi.transition=null,St=1,Use(r,e,t,n)}finally{Mi.transition=s,St=n}return null}function Use(r,e,t,n){do Dp();while(lu!==null);if(ht&6)throw Error(oe(327));t=r.finishedWork;var s=r.finishedLanes;if(t===null)return null;if(r.finishedWork=null,r.finishedLanes=0,t===r.current)throw Error(oe(177));r.callbackNode=null,r.callbackPriority=0;var i=t.lanes|t.childLanes;if(bne(r,i),r===$r&&(wr=$r=null,Qr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Nw||(Nw=!0,cG(z4,function(){return Dp(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Mi.transition,Mi.transition=null;var o=St;St=1;var a=ht;ht|=4,aT.current=null,Ose(r,t),ZK(t,r),ise(Fx),H4=!!Ux,Fx=Ux=null,r.current=t,Rse(t),une(),ht=a,St=o,Mi.transition=i}else r.current=t;if(Nw&&(Nw=!1,lu=r,i8=s),i=r.pendingLanes,i===0&&(Eu=null),fne(t.stateNode),Es(r,ur()),e!==null)for(n=r.onRecoverableError,t=0;t<e.length;t++)s=e[t],n(s.value,{componentStack:s.stack,digest:s.digest});if(s8)throw s8=!1,r=oA,oA=null,r;return i8&1&&r.tag!==0&&Dp(),i=r.pendingLanes,i&1?r===aA?_2++:(_2=0,aA=r):_2=0,rh(),null}function Dp(){if(lu!==null){var r=UH(i8),e=Mi.transition,t=St;try{if(Mi.transition=null,St=16>r?16:r,lu===null)var n=!1;else{if(r=lu,lu=null,i8=0,ht&6)throw Error(oe(331));var s=ht;for(ht|=4,Ce=r.current;Ce!==null;){var i=Ce,o=i.child;if(Ce.flags&16){var a=i.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(Ce=l;Ce!==null;){var u=Ce;switch(u.tag){case 0:case 11:case 15:k2(8,u,i)}var d=u.child;if(d!==null)d.return=u,Ce=d;else for(;Ce!==null;){u=Ce;var p=u.sibling,y=u.return;if(JK(u),u===l){Ce=null;break}if(p!==null){p.return=y,Ce=p;break}Ce=y}}}var f=i.alternate;if(f!==null){var g=f.child;if(g!==null){f.child=null;do{var w=g.sibling;g.sibling=null,g=w}while(g!==null)}}Ce=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,Ce=o;else e:for(;Ce!==null;){if(i=Ce,i.flags&2048)switch(i.tag){case 0:case 11:case 15:k2(9,i,i.return)}var m=i.sibling;if(m!==null){m.return=i.return,Ce=m;break e}Ce=i.return}}var b=r.current;for(Ce=b;Ce!==null;){o=Ce;var v=o.child;if(o.subtreeFlags&2064&&v!==null)v.return=o,Ce=v;else e:for(o=b;Ce!==null;){if(a=Ce,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:u5(9,a)}}catch(S){ir(a,a.return,S)}if(a===o){Ce=null;break e}var E=a.sibling;if(E!==null){E.return=a.return,Ce=E;break e}Ce=a.return}}if(ht=s,rh(),ha&&typeof ha.onPostCommitFiberRoot=="function")try{ha.onPostCommitFiberRoot(r5,r)}catch{}n=!0}return n}finally{St=t,Mi.transition=e}}return!1}function aO(r,e,t){e=q0(t,e),e=UK(r,e,1),r=vu(r,e,1),e=Wn(),r!==null&&(xm(r,1,e),Es(r,e))}function ir(r,e,t){if(r.tag===3)aO(r,r,t);else for(;e!==null;){if(e.tag===3){aO(e,r,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Eu===null||!Eu.has(n))){r=q0(t,r),r=FK(e,r,1),e=vu(e,r,1),r=Wn(),e!==null&&(xm(e,1,r),Es(e,r));break}}e=e.return}}function Fse(r,e,t){var n=r.pingCache;n!==null&&n.delete(e),e=Wn(),r.pingedLanes|=r.suspendedLanes&t,$r===r&&(Qr&t)===t&&(Sr===4||Sr===3&&(Qr&130023424)===Qr&&500>ur()-lT?Ed(r,0):cT|=t),Es(r,e)}function oG(r,e){e===0&&(r.mode&1?(e=Ew,Ew<<=1,!(Ew&130023424)&&(Ew=4194304)):e=1);var t=Wn();r=_c(r,e),r!==null&&(xm(r,e,t),Es(r,t))}function zse(r){var e=r.memoizedState,t=0;e!==null&&(t=e.retryLane),oG(r,t)}function Vse(r,e){var t=0;switch(r.tag){case 13:var n=r.stateNode,s=r.memoizedState;s!==null&&(t=s.retryLane);break;case 19:n=r.stateNode;break;default:throw Error(oe(314))}n!==null&&n.delete(e),oG(r,t)}var aG;aG=function(r,e,t){if(r!==null)if(r.memoizedProps!==e.pendingProps||bs.current)ys=!0;else{if(!(r.lanes&t)&&!(e.flags&128))return ys=!1,_se(r,e,t);ys=!!(r.flags&131072)}else ys=!1,jt&&e.flags&1048576&&hK(e,J4,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;H3(r,e),r=e.pendingProps;var s=H0(e,On.current);Np(e,t),s=rT(null,e,n,r,s,t);var i=nT();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,vs(n)?(i=!0,W4(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Yk(e),s.updater=l5,e.stateNode=s,s._reactInternals=e,Qx(e,n,r,t),e=Xx(null,e,n,!0,i,t)):(e.tag=0,jt&&i&&Kk(e),$n(null,e,s,t),e=e.child),e;case 16:n=e.elementType;e:{switch(H3(r,e),r=e.pendingProps,s=n._init,n=s(n._payload),e.type=n,s=e.tag=Kse(n),r=no(n,r),s){case 0:e=Yx(null,e,n,r,t);break e;case 1:e=YD(null,e,n,r,t);break e;case 11:e=QD(null,e,n,r,t);break e;case 14:e=JD(null,e,n,no(n.type,r),t);break e}throw Error(oe(306,n,""))}return e;case 0:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:no(n,s),Yx(r,e,n,s,t);case 1:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:no(n,s),YD(r,e,n,s,t);case 3:e:{if(KK(e),r===null)throw Error(oe(387));n=e.pendingProps,i=e.memoizedState,s=i.element,mK(r,e),Z4(e,n,null,t);var o=e.memoizedState;if(n=o.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=q0(Error(oe(423)),e),e=XD(r,e,n,t,s);break e}else if(n!==s){s=q0(Error(oe(424)),e),e=XD(r,e,n,t,s);break e}else for(Ws=bu(e.stateNode.containerInfo.firstChild),Qs=e,jt=!0,fo=null,t=gK(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(K0(),n===s){e=Pc(r,e,t);break e}$n(r,e,n,t)}e=e.child}return e;case 5:return wK(e),r===null&&jx(e),n=e.type,s=e.pendingProps,i=r!==null?r.memoizedProps:null,o=s.children,zx(n,s)?o=null:i!==null&&zx(n,i)&&(e.flags|=32),HK(r,e),$n(r,e,o,t),e.child;case 6:return r===null&&jx(e),null;case 13:return GK(r,e,t);case 4:return Xk(e,e.stateNode.containerInfo),n=e.pendingProps,r===null?e.child=G0(e,null,n,t):$n(r,e,n,t),e.child;case 11:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:no(n,s),QD(r,e,n,s,t);case 7:return $n(r,e,e.pendingProps,t),e.child;case 8:return $n(r,e,e.pendingProps.children,t),e.child;case 12:return $n(r,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Mt(Y4,n._currentValue),n._currentValue=o,i!==null)if(Co(i.value,o)){if(i.children===s.children&&!bs.current){e=Pc(r,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var c=a.firstContext;c!==null;){if(c.context===n){if(i.tag===1){c=wc(-1,t&-t),c.tag=2;var l=i.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}i.lanes|=t,c=i.alternate,c!==null&&(c.lanes|=t),qx(i.return,t,e),a.lanes|=t;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(oe(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),qx(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}$n(r,e,s.children,t),e=e.child}return e;case 9:return s=e.type,n=e.pendingProps.children,Np(e,t),s=Ui(s),n=n(s),e.flags|=1,$n(r,e,n,t),e.child;case 14:return n=e.type,s=no(n,e.pendingProps),s=no(n.type,s),JD(r,e,n,s,t);case 15:return zK(r,e,e.type,e.pendingProps,t);case 17:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:no(n,s),H3(r,e),e.tag=1,vs(n)?(r=!0,W4(e)):r=!1,Np(e,t),LK(e,n,s),Qx(e,n,s,t),Xx(null,e,n,!0,r,t);case 19:return jK(r,e,t);case 22:return VK(r,e,t)}throw Error(oe(156,e.tag))};function cG(r,e){return BH(r,e)}function Hse(r,e,t,n){this.tag=r,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ni(r,e,t,n){return new Hse(r,e,t,n)}function fT(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Kse(r){if(typeof r=="function")return fT(r)?1:0;if(r!=null){if(r=r.$$typeof,r===Dk)return 11;if(r===Ok)return 14}return 2}function Au(r,e){var t=r.alternate;return t===null?(t=Ni(r.tag,e,r.key,r.mode),t.elementType=r.elementType,t.type=r.type,t.stateNode=r.stateNode,t.alternate=r,r.alternate=t):(t.pendingProps=e,t.type=r.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=r.flags&14680064,t.childLanes=r.childLanes,t.lanes=r.lanes,t.child=r.child,t.memoizedProps=r.memoizedProps,t.memoizedState=r.memoizedState,t.updateQueue=r.updateQueue,e=r.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=r.sibling,t.index=r.index,t.ref=r.ref,t}function j3(r,e,t,n,s,i){var o=2;if(n=r,typeof r=="function")fT(r)&&(o=1);else if(typeof r=="string")o=5;else e:switch(r){case op:return xd(t.children,s,i,e);case Nk:o=8,s|=8;break;case bx:return r=Ni(12,t,e,s|2),r.elementType=bx,r.lanes=i,r;case vx:return r=Ni(13,t,e,s),r.elementType=vx,r.lanes=i,r;case Ex:return r=Ni(19,t,e,s),r.elementType=Ex,r.lanes=i,r;case wH:return d5(t,s,i,e);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case yH:o=10;break e;case mH:o=9;break e;case Dk:o=11;break e;case Ok:o=14;break e;case Cl:o=16,n=null;break e}throw Error(oe(130,r==null?r:typeof r,""))}return e=Ni(o,t,e,s),e.elementType=r,e.type=n,e.lanes=i,e}function xd(r,e,t,n){return r=Ni(7,r,n,e),r.lanes=t,r}function d5(r,e,t,n){return r=Ni(22,r,n,e),r.elementType=wH,r.lanes=t,r.stateNode={isHidden:!1},r}function f9(r,e,t){return r=Ni(6,r,null,e),r.lanes=t,r}function p9(r,e,t){return e=Ni(4,r.children!==null?r.children:[],r.key,e),e.lanes=t,e.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},e}function Gse(r,e,t,n,s){this.tag=e,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=W7(0),this.expirationTimes=W7(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=W7(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function pT(r,e,t,n,s,i,o,a,c){return r=new Gse(r,e,t,a,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Ni(3,null,null,e),r.current=i,i.stateNode=r,i.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Yk(i),r}function jse(r,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ip,key:n==null?null:""+n,children:r,containerInfo:e,implementation:t}}function lG(r){if(!r)return Ru;r=r._reactInternals;e:{if(bf(r)!==r||r.tag!==1)throw Error(oe(170));var e=r;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(vs(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(oe(171))}if(r.tag===1){var t=r.type;if(vs(t))return lK(r,t,e)}return e}function uG(r,e,t,n,s,i,o,a,c){return r=pT(t,n,!0,r,s,i,o,a,c),r.context=lG(null),t=r.current,n=Wn(),s=xu(t),i=wc(n,s),i.callback=e??null,vu(t,i,s),r.current.lanes=s,xm(r,s,n),Es(r,n),r}function f5(r,e,t,n){var s=e.current,i=Wn(),o=xu(s);return t=lG(t),e.context===null?e.context=t:e.pendingContext=t,e=wc(i,o),e.payload={element:r},n=n===void 0?null:n,n!==null&&(e.callback=n),r=vu(s,e,o),r!==null&&(vo(r,s,o,i),F3(r,s,o)),o}function a8(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function cO(r,e){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var t=r.retryLane;r.retryLane=t!==0&&t<e?t:e}}function gT(r,e){cO(r,e),(r=r.alternate)&&cO(r,e)}function qse(){return null}var hG=typeof reportError=="function"?reportError:function(r){console.error(r)};function yT(r){this._internalRoot=r}p5.prototype.render=yT.prototype.render=function(r){var e=this._internalRoot;if(e===null)throw Error(oe(409));f5(r,e,null,null)};p5.prototype.unmount=yT.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var e=r.containerInfo;Fd(function(){f5(null,r,null,null)}),e[Tc]=null}};function p5(r){this._internalRoot=r}p5.prototype.unstable_scheduleHydration=function(r){if(r){var e=VH();r={blockedOn:null,target:r,priority:e};for(var t=0;t<Ll.length&&e!==0&&e<Ll[t].priority;t++);Ll.splice(t,0,r),t===0&&KH(r)}};function mT(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function g5(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function lO(){}function Wse(r,e,t,n,s){if(s){if(typeof n=="function"){var i=n;n=function(){var l=a8(o);i.call(l)}}var o=uG(e,n,r,0,null,!1,!1,"",lO);return r._reactRootContainer=o,r[Tc]=o.current,ny(r.nodeType===8?r.parentNode:r),Fd(),o}for(;s=r.lastChild;)r.removeChild(s);if(typeof n=="function"){var a=n;n=function(){var l=a8(c);a.call(l)}}var c=pT(r,0,!1,null,null,!1,!1,"",lO);return r._reactRootContainer=c,r[Tc]=c.current,ny(r.nodeType===8?r.parentNode:r),Fd(function(){f5(e,c,t,n)}),c}function y5(r,e,t,n,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var c=a8(o);a.call(c)}}f5(e,o,r,s)}else o=Wse(t,e,r,s,n);return a8(o)}FH=function(r){switch(r.tag){case 3:var e=r.stateNode;if(e.current.memoizedState.isDehydrated){var t=n2(e.pendingLanes);t!==0&&(Mk(e,t|1),Es(e,ur()),!(ht&6)&&(W0=ur()+500,rh()))}break;case 13:Fd(function(){var n=_c(r,1);if(n!==null){var s=Wn();vo(n,r,1,s)}}),gT(r,1)}};$k=function(r){if(r.tag===13){var e=_c(r,134217728);if(e!==null){var t=Wn();vo(e,r,134217728,t)}gT(r,134217728)}};zH=function(r){if(r.tag===13){var e=xu(r),t=_c(r,e);if(t!==null){var n=Wn();vo(t,r,e,n)}gT(r,e)}};VH=function(){return St};HH=function(r,e){var t=St;try{return St=r,e()}finally{St=t}};Nx=function(r,e,t){switch(e){case"input":if(Sx(r,t),e=t.name,t.type==="radio"&&e!=null){for(t=r;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==r&&n.form===r.form){var s=o5(n);if(!s)throw Error(oe(90));vH(n),Sx(n,s)}}}break;case"textarea":xH(r,t);break;case"select":e=t.value,e!=null&&kp(r,!!t.multiple,e,!1)}};_H=uT;PH=Fd;var Qse={usingClientEntryPoint:!1,Events:[Sm,up,o5,kH,TH,uT]},xg={findFiberByHostInstance:Fh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Jse={bundleType:xg.bundleType,version:xg.version,rendererPackageName:xg.rendererPackageName,rendererConfig:xg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:zc.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=OH(r),r===null?null:r.stateNode},findFiberByHostInstance:xg.findFiberByHostInstance||qse,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Dw=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Dw.isDisabled&&Dw.supportsFiber)try{r5=Dw.inject(Jse),ha=Dw}catch{}}Zs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Qse;Zs.createPortal=function(r,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!mT(e))throw Error(oe(200));return jse(r,e,null,t)};Zs.createRoot=function(r,e){if(!mT(r))throw Error(oe(299));var t=!1,n="",s=hG;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=pT(r,1,!1,null,null,t,!1,n,s),r[Tc]=e.current,ny(r.nodeType===8?r.parentNode:r),new yT(e)};Zs.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var e=r._reactInternals;if(e===void 0)throw typeof r.render=="function"?Error(oe(188)):(r=Object.keys(r).join(","),Error(oe(268,r)));return r=OH(e),r=r===null?null:r.stateNode,r};Zs.flushSync=function(r){return Fd(r)};Zs.hydrate=function(r,e,t){if(!g5(e))throw Error(oe(200));return y5(null,r,e,!0,t)};Zs.hydrateRoot=function(r,e,t){if(!mT(r))throw Error(oe(405));var n=t!=null&&t.hydratedSources||null,s=!1,i="",o=hG;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=uG(e,null,r,1,t??null,s,!1,i,o),r[Tc]=e.current,ny(r),n)for(r=0;r<n.length;r++)t=n[r],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new p5(e)};Zs.render=function(r,e,t){if(!g5(e))throw Error(oe(200));return y5(null,r,e,!1,t)};Zs.unmountComponentAtNode=function(r){if(!g5(r))throw Error(oe(40));return r._reactRootContainer?(Fd(function(){y5(null,null,r,!1,function(){r._reactRootContainer=null,r[Tc]=null})}),!0):!1};Zs.unstable_batchedUpdates=uT;Zs.unstable_renderSubtreeIntoContainer=function(r,e,t,n){if(!g5(t))throw Error(oe(200));if(r==null||r._reactInternals===void 0)throw Error(oe(38));return y5(r,e,t,!1,n)};Zs.version="18.3.1-next-f1338f8080-20240426";function dG(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(dG)}catch(r){console.error(r)}}dG(),dH.exports=Zs;var Yse=dH.exports,fG,uO=Yse;fG=uO.createRoot,uO.hydrateRoot;var wT={exports:{}},Op=typeof Reflect=="object"?Reflect:null,hO=Op&&typeof Op.apply=="function"?Op.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},q3;Op&&typeof Op.ownKeys=="function"?q3=Op.ownKeys:Object.getOwnPropertySymbols?q3=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:q3=function(e){return Object.getOwnPropertyNames(e)};function Xse(r){console&&console.warn&&console.warn(r)}var pG=Number.isNaN||function(e){return e!==e};function Pt(){Pt.init.call(this)}wT.exports=Pt;wT.exports.once=rie;Pt.EventEmitter=Pt;Pt.prototype._events=void 0;Pt.prototype._eventsCount=0;Pt.prototype._maxListeners=void 0;var dO=10;function m5(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(Pt,"defaultMaxListeners",{enumerable:!0,get:function(){return dO},set:function(r){if(typeof r!="number"||r<0||pG(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");dO=r}});Pt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Pt.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||pG(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function gG(r){return r._maxListeners===void 0?Pt.defaultMaxListeners:r._maxListeners}Pt.prototype.getMaxListeners=function(){return gG(this)};Pt.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var s=e==="error",i=this._events;if(i!==void 0)s=s&&i.error===void 0;else if(!s)return!1;if(s){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=i[e];if(c===void 0)return!1;if(typeof c=="function")hO(c,this,t);else for(var l=c.length,u=vG(c,l),n=0;n<l;++n)hO(u[n],this,t);return!0};function yG(r,e,t,n){var s,i,o;if(m5(t),i=r._events,i===void 0?(i=r._events=Object.create(null),r._eventsCount=0):(i.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),i=r._events),o=i[e]),o===void 0)o=i[e]=t,++r._eventsCount;else if(typeof o=="function"?o=i[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),s=gG(r),s>0&&o.length>s&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=o.length,Xse(a)}return r}Pt.prototype.addListener=function(e,t){return yG(this,e,t,!1)};Pt.prototype.on=Pt.prototype.addListener;Pt.prototype.prependListener=function(e,t){return yG(this,e,t,!0)};function Zse(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function mG(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},s=Zse.bind(n);return s.listener=t,n.wrapFn=s,s}Pt.prototype.once=function(e,t){return m5(t),this.on(e,mG(this,e,t)),this};Pt.prototype.prependOnceListener=function(e,t){return m5(t),this.prependListener(e,mG(this,e,t)),this};Pt.prototype.removeListener=function(e,t){var n,s,i,o,a;if(m5(t),s=this._events,s===void 0)return this;if(n=s[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;i===0?n.shift():eie(n,i),n.length===1&&(s[e]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};Pt.prototype.off=Pt.prototype.removeListener;Pt.prototype.removeAllListeners=function(e){var t,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var i=Object.keys(n),o;for(s=0;s<i.length;++s)o=i[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this};function wG(r,e,t){var n=r._events;if(n===void 0)return[];var s=n[e];return s===void 0?[]:typeof s=="function"?t?[s.listener||s]:[s]:t?tie(s):vG(s,s.length)}Pt.prototype.listeners=function(e){return wG(this,e,!0)};Pt.prototype.rawListeners=function(e){return wG(this,e,!1)};Pt.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):bG.call(r,e)};Pt.prototype.listenerCount=bG;function bG(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}Pt.prototype.eventNames=function(){return this._eventsCount>0?q3(this._events):[]};function vG(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function eie(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function tie(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function rie(r,e){return new Promise(function(t,n){function s(o){r.removeListener(e,i),n(o)}function i(){typeof r.removeListener=="function"&&r.removeListener("error",s),t([].slice.call(arguments))}EG(r,e,i,{once:!0}),e!=="error"&&nie(r,s,{once:!0})})}function nie(r,e,t){typeof r.on=="function"&&EG(r,"error",e,t)}function EG(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function s(i){n.once&&r.removeEventListener(e,s),t(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var w5=wT.exports,xG={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function i(c,l,u,d,p){if(typeof u!="function")throw new TypeError("The listener must be a function");var y=new s(u,d||c,p),f=t?t+l:l;return c._events[f]?c._events[f].fn?c._events[f]=[c._events[f],y]:c._events[f].push(y):(c._events[f]=y,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new n:delete c._events[l]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,d;if(this._eventsCount===0)return l;for(d in u=this._events)e.call(u,d)&&l.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=t?t+l:l,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var p=0,y=d.length,f=new Array(y);p<y;p++)f[p]=d[p].fn;return f},a.prototype.listenerCount=function(l){var u=t?t+l:l,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(l,u,d,p,y,f){var g=t?t+l:l;if(!this._events[g])return!1;var w=this._events[g],m=arguments.length,b,v;if(w.fn){switch(w.once&&this.removeListener(l,w.fn,void 0,!0),m){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,u),!0;case 3:return w.fn.call(w.context,u,d),!0;case 4:return w.fn.call(w.context,u,d,p),!0;case 5:return w.fn.call(w.context,u,d,p,y),!0;case 6:return w.fn.call(w.context,u,d,p,y,f),!0}for(v=1,b=new Array(m-1);v<m;v++)b[v-1]=arguments[v];w.fn.apply(w.context,b)}else{var E=w.length,S;for(v=0;v<E;v++)switch(w[v].once&&this.removeListener(l,w[v].fn,void 0,!0),m){case 1:w[v].fn.call(w[v].context);break;case 2:w[v].fn.call(w[v].context,u);break;case 3:w[v].fn.call(w[v].context,u,d);break;case 4:w[v].fn.call(w[v].context,u,d,p);break;default:if(!b)for(S=1,b=new Array(m-1);S<m;S++)b[S-1]=arguments[S];w[v].fn.apply(w[v].context,b)}}return!0},a.prototype.on=function(l,u,d){return i(this,l,u,d,!1)},a.prototype.once=function(l,u,d){return i(this,l,u,d,!0)},a.prototype.removeListener=function(l,u,d,p){var y=t?t+l:l;if(!this._events[y])return this;if(!u)return o(this,y),this;var f=this._events[y];if(f.fn)f.fn===u&&(!p||f.once)&&(!d||f.context===d)&&o(this,y);else{for(var g=0,w=[],m=f.length;g<m;g++)(f[g].fn!==u||p&&!f[g].once||d&&f[g].context!==d)&&w.push(f[g]);w.length?this._events[y]=w.length===1?w[0]:w:o(this,y)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=t?t+l:l,this._events[u]&&o(this,u)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a})(xG);var sie=xG.exports;const iie=Zu(sie);let AG=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},oie=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const fO=r=>globalThis.DOMException===void 0?new oie(r):new DOMException(r),pO=r=>{const e=r.reason===void 0?fO("This operation was aborted."):r.reason;return e instanceof Error?e:fO(e)};function Im(r,e){const{milliseconds:t,fallback:n,message:s,customTimers:i={setTimeout,clearTimeout}}=e;let o,a;const l=new Promise((u,d)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:y}=e;y.aborted&&d(pO(y)),a=()=>{d(pO(y))},y.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){r.then(u,d);return}const p=new AG;o=i.setTimeout.call(void 0,()=>{if(n){try{u(n())}catch(y){d(y)}return}typeof r.cancel=="function"&&r.cancel(),s===!1?u():s instanceof Error?d(s):(p.message=s??`Promise timed out after ${t} milliseconds`,d(p))},t),(async()=>{try{u(await r)}catch(y){d(y)}})()}).finally(()=>{l.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return l.clear=()=>{i.clearTimeout.call(void 0,o),o=void 0},l}function aie(r,e,t){let n=0,s=r.length;for(;s>0;){const i=Math.trunc(s/2);let o=n+i;t(r[o],e)<=0?(n=++o,s-=i+1):s=i}return n}var mi,_z;let cie=(_z=class{constructor(){Q(this,mi,[])}enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,id:t.id,run:e};if(this.size===0||T(this,mi)[this.size-1].priority>=t.priority){T(this,mi).push(n);return}const s=aie(T(this,mi),n,(i,o)=>o.priority-i.priority);T(this,mi).splice(s,0,n)}setPriority(e,t){const n=T(this,mi).findIndex(i=>i.id===e);if(n===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[s]=T(this,mi).splice(n,1);this.enqueue(s.run,{priority:t,id:e})}dequeue(){const e=T(this,mi).shift();return e==null?void 0:e.run}filter(e){return T(this,mi).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return T(this,mi).length}},mi=new WeakMap,_z);var qp,Wp,Hl,rm,Qp,nm,wi,Jp,Bn,sm,bi,Yp,Ya,im,G6,mt,SG,CG,IG,kG,TG,W3,uA,hA,Q3,_G,J3;class Bu extends iie{constructor(t){var n,s;super();Q(this,mt);Q(this,qp);Q(this,Wp);Q(this,Hl,0);Q(this,rm);Q(this,Qp);Q(this,nm,0);Q(this,wi);Q(this,Jp);Q(this,Bn);Q(this,sm);Q(this,bi,0);Q(this,Yp);Q(this,Ya);Q(this,im);Q(this,G6,1n);h(this,"timeout");if(t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:cie,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((n=t.intervalCap)==null?void 0:n.toString())??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((s=t.interval)==null?void 0:s.toString())??""}\` (${typeof t.interval})`);M(this,qp,t.carryoverConcurrencyCount),M(this,Wp,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),M(this,rm,t.intervalCap),M(this,Qp,t.interval),M(this,Bn,new t.queueClass),M(this,sm,t.queueClass),this.concurrency=t.concurrency,this.timeout=t.timeout,M(this,im,t.throwOnTimeout===!0),M(this,Ya,t.autoStart===!1)}get concurrency(){return T(this,Yp)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);M(this,Yp,t),te(this,mt,Q3).call(this)}setPriority(t,n){T(this,Bn).setPriority(t,n)}async add(t,n={}){return n.id??(n.id=(ts(this,G6)._++).toString()),n={timeout:this.timeout,throwOnTimeout:T(this,im),...n},new Promise((s,i)=>{T(this,Bn).enqueue(async()=>{var o;ts(this,bi)._++,ts(this,Hl)._++;try{(o=n.signal)==null||o.throwIfAborted();let a=t({signal:n.signal});n.timeout&&(a=Im(Promise.resolve(a),{milliseconds:n.timeout})),n.signal&&(a=Promise.race([a,te(this,mt,_G).call(this,n.signal)]));const c=await a;s(c),this.emit("completed",c)}catch(a){if(a instanceof AG&&!n.throwOnTimeout){s();return}i(a),this.emit("error",a)}finally{te(this,mt,IG).call(this)}},n),this.emit("add"),te(this,mt,W3).call(this)})}async addAll(t,n){return Promise.all(t.map(async s=>this.add(s,n)))}start(){return T(this,Ya)?(M(this,Ya,!1),te(this,mt,Q3).call(this),this):this}pause(){M(this,Ya,!0)}clear(){M(this,Bn,new(T(this,sm)))}async onEmpty(){T(this,Bn).size!==0&&await te(this,mt,J3).call(this,"empty")}async onSizeLessThan(t){T(this,Bn).size<t||await te(this,mt,J3).call(this,"next",()=>T(this,Bn).size<t)}async onIdle(){T(this,bi)===0&&T(this,Bn).size===0||await te(this,mt,J3).call(this,"idle")}get size(){return T(this,Bn).size}sizeBy(t){return T(this,Bn).filter(t).length}get pending(){return T(this,bi)}get isPaused(){return T(this,Ya)}}qp=new WeakMap,Wp=new WeakMap,Hl=new WeakMap,rm=new WeakMap,Qp=new WeakMap,nm=new WeakMap,wi=new WeakMap,Jp=new WeakMap,Bn=new WeakMap,sm=new WeakMap,bi=new WeakMap,Yp=new WeakMap,Ya=new WeakMap,im=new WeakMap,G6=new WeakMap,mt=new WeakSet,SG=function(){return T(this,Wp)||T(this,Hl)<T(this,rm)},CG=function(){return T(this,bi)<T(this,Yp)},IG=function(){ts(this,bi)._--,te(this,mt,W3).call(this),this.emit("next")},kG=function(){te(this,mt,hA).call(this),te(this,mt,uA).call(this),M(this,Jp,void 0)},TG=function(){const t=Date.now();if(T(this,wi)===void 0){const n=T(this,nm)-t;if(n<0)M(this,Hl,T(this,qp)?T(this,bi):0);else return T(this,Jp)===void 0&&M(this,Jp,setTimeout(()=>{te(this,mt,kG).call(this)},n)),!0}return!1},W3=function(){if(T(this,Bn).size===0)return T(this,wi)&&clearInterval(T(this,wi)),M(this,wi,void 0),this.emit("empty"),T(this,bi)===0&&this.emit("idle"),!1;if(!T(this,Ya)){const t=!T(this,mt,TG);if(T(this,mt,SG)&&T(this,mt,CG)){const n=T(this,Bn).dequeue();return n?(this.emit("active"),n(),t&&te(this,mt,uA).call(this),!0):!1}}return!1},uA=function(){T(this,Wp)||T(this,wi)!==void 0||(M(this,wi,setInterval(()=>{te(this,mt,hA).call(this)},T(this,Qp))),M(this,nm,Date.now()+T(this,Qp)))},hA=function(){T(this,Hl)===0&&T(this,bi)===0&&T(this,wi)&&(clearInterval(T(this,wi)),M(this,wi,void 0)),M(this,Hl,T(this,qp)?T(this,bi):0),te(this,mt,Q3).call(this)},Q3=function(){for(;te(this,mt,W3).call(this););},_G=async function(t){return new Promise((n,s)=>{t.addEventListener("abort",()=>{s(t.reason)},{once:!0})})},J3=async function(t,n){return new Promise(s=>{const i=()=>{n&&!n()||(this.off(t,i),s())};this.on(t,i)})};function He(){const r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}class gO{constructor(e){h(this,"buffer");h(this,"mask");h(this,"top");h(this,"btm");h(this,"next");if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class g9{constructor(e={}){h(this,"size");h(this,"hwm");h(this,"head");h(this,"tail");this.hwm=e.splitLimit??16,this.head=new gO(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new gO(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let lie=class extends Error{constructor(t,n){super(t??"The operation was aborted");h(this,"type");h(this,"code");this.type="aborted",this.code=n??"ABORT_ERR"}};function Nc(r={}){return uie(t=>{const n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function uie(r,e){e=e??{};let t=e.onEnd,n=new g9,s,i,o,a=He();const c=async()=>{try{return n.isEmpty()?o?{done:!0}:await new Promise((w,m)=>{i=b=>{i=null,n.push(b);try{w(r(n))}catch(v){m(v)}return s}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=He()})}},l=w=>i!=null?i(w):(n.push(w),s),u=w=>(n=new g9,i!=null?i({error:w}):(n.push({error:w}),s)),d=w=>{if(o)return s;if((e==null?void 0:e.objectMode)!==!0&&(w==null?void 0:w.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:w})},p=w=>o?s:(o=!0,w!=null?u(w):l({done:!0})),y=()=>(n=new g9,p(),{done:!0}),f=w=>(p(w),{done:!0});if(s={[Symbol.asyncIterator](){return this},next:c,return:y,throw:f,push:d,end:p,get readableLength(){return n.size},onEmpty:async w=>{const m=w==null?void 0:w.signal;if(m==null||m.throwIfAborted(),n.isEmpty())return;let b,v;m!=null&&(b=new Promise((E,S)=>{v=()=>{S(new lie)},m.addEventListener("abort",v)}));try{await Promise.race([a.promise,b])}finally{v!=null&&m!=null&&(m==null||m.removeEventListener("abort",v))}}},t==null)return s;const g=s;return s={[Symbol.asyncIterator](){return this},next(){return g.next()},throw(w){return g.throw(w),t!=null&&(t(w),t=void 0),{done:!0}},return(){return g.return(),t!=null&&(t(),t=void 0),{done:!0}},push:d,end(w){return g.end(w),t!=null&&(t(w),t=void 0),s},get readableLength(){return g.readableLength},onEmpty:w=>g.onEmpty(w)},s}let yO=class extends Error{constructor(t,n,s){super(t??"The operation was aborted");h(this,"type");h(this,"code");this.type="aborted",this.name=s??"AbortError",this.code=n??"ABORT_ERR"}};async function Vn(r,e,t){if(e==null)return r;if(e.aborted)return r.catch(()=>{}),Promise.reject(new yO(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName));let n;const s=new yO(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName);try{return await Promise.race([r,new Promise((i,o)=>{n=()=>{o(s)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}}let hie=class{constructor(){h(this,"readNext");h(this,"haveNext");h(this,"ended");h(this,"nextResult");h(this,"error");this.ended=!1,this.readNext=He(),this.haveNext=He()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=He(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=He(),await Vn(this.readNext.promise,t==null?void 0:t.signal,t)}};function die(){return new hie}function fie(r){return r[Symbol.asyncIterator]!=null}async function pie(r,e){try{await Promise.all(r.map(async t=>{for await(const n of t)await e.push(n)})),await e.end()}catch(t){await e.end(t).catch(()=>{})}}async function*gie(r){const e=die();pie(r,e).catch(()=>{}),yield*e}function*yie(r){for(const e of r)yield*e}function Su(...r){const e=[];for(const t of r)fie(t)||e.push(t);return e.length===r.length?yie(e):gie(r)}function Jn(r,...e){if(r==null)throw new Error("Empty pipeline");if(y9(r)){const n=r;r=()=>n.source}else if(NG(r)||PG(r)){const n=r;r=()=>n}const t=[r,...e];if(t.length>1&&y9(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)y9(t[n])&&(t[n]=wie(t[n]));return mie(...t)}const mie=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},PG=r=>(r==null?void 0:r[Symbol.asyncIterator])!=null,NG=r=>(r==null?void 0:r[Symbol.iterator])!=null,y9=r=>r==null?!1:r.sink!=null&&r.source!=null,wie=r=>e=>{const t=r.sink(e);if((t==null?void 0:t.then)!=null){const n=Nc({objectMode:!0});t.then(()=>{n.end()},o=>{n.end(o)});let s;const i=r.source;if(PG(i))s=async function*(){yield*i,n.end()};else if(NG(i))s=function*(){yield*i,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return Su(n,s())}return r.source};var bie=function(){return Date.now()};const Ow=bie;class vie{constructor(e,t,n){const s=this;this._started=Ow(),this._rescheduled=0,this._scheduled=t,this._args=n,this._triggered=!1,this._timerWrapper=()=>{s._rescheduled>0?(s._scheduled=s._rescheduled-(Ow()-s._started),s._schedule(s._scheduled)):(s._triggered=!0,e.apply(null,s._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);const t=Ow();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=Ow(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}}function Eie(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("timeout needed");let r;if(arguments.length>0){r=new Array(arguments.length-2);for(var e=0;e<r.length;e++)r[e]=arguments[e+2]}return new vie(arguments[0],arguments[1],r)}var xie=Eie;const{AbortController:Aie}=globalThis,mO=xie;class bT extends Aie{constructor(e){super(),this._ms=e,this._timer=mO(()=>this.abort(),e),Object.setPrototypeOf(this,bT.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=mO(()=>this.abort(),this._ms)}}var dA={TimeoutController:bT};const Cu=(...r)=>r.join("/").replace(new RegExp("((?<=\\/)\\/+)|(^\\.\\/)|((?<=\\/)\\.\\/)","g"),"")||".",Sie=3e4,Cie=async({ipfs:r,log:e,events:t,onSynced:n,start:s,timeout:i})=>{if(!r)throw new Error("An instance of ipfs is required.");if(!e)throw new Error("An instance of log is required.");const o=r.libp2p,a=r.libp2p.services.pubsub,c=e.id,l=Cu("/orbitdb/heads/",c),u=new Bu({concurrency:1}),d=new Set;t=t||new w5.EventEmitter,i=i||Sie;let p=!1;const y=async x=>{const C=await e.heads();t.emit("join",x,C)},f=x=>async function*(){const C=await e.heads();for await(const{bytes:P}of C)yield P}(),g=x=>async C=>{for await(const P of C){const L=P.subarray();L&&n&&await n(L)}p&&await y(x)},w=async({connection:x,stream:C})=>{const P=String(x.remotePeer);try{d.add(P),await Jn(C,g(P),f,C)}catch(L){d.delete(P),t.emit("error",L)}},m=async x=>{const C=async()=>{const{peerId:P,subscriptions:L}=x.detail,K=String(P),V=L.find(Z=>Z.topic===c);if(V)if(V.subscribe){if(d.has(K))return;const Z=new dA.TimeoutController(i),{signal:Y}=Z;try{d.add(K);const U=await o.dialProtocol(P,l,{signal:Y});await Jn(f,U,g(K))}catch(U){d.delete(K),U.name==="UnsupportedProtocolError"||t.emit("error",U)}finally{Z&&Z.clear()}}else d.delete(K),t.emit("leave",K)};u.add(C)},b=async x=>{const{topic:C,data:P}=x.detail,L=async()=>{try{P&&n&&await n(P)}catch(K){t.emit("error",K)}};C===c&&u.add(L)},v=async x=>{d.delete(x.detail.toString())},E=async x=>{p&&await a.publish(c,x.bytes)},S=async()=>{p&&(p=!1,await u.onIdle(),a.removeEventListener("subscription-change",m),a.removeEventListener("message",b),await o.unhandle(l),await a.unsubscribe(c),o.removeEventListener("peer:disconnect",v),d.clear())},I=async()=>{p||(await o.handle(l,w),a.addEventListener("subscription-change",m),a.addEventListener("message",b),await a.subscribe(c),o.addEventListener("peer:disconnect",v),p=!0)};return s!==!1&&await I(),{add:E,stop:S,start:I,events:t,peers:d}};var fA={exports:{}};typeof Object.create=="function"?fA.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:fA.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}};var Iie=fA.exports,DG=w5,kie=Iie,Tie=Ys;function Ys(r){if(!(this instanceof Ys))return new Ys(r);typeof r=="number"&&(r={max:r}),r||(r={}),DG.EventEmitter.call(this),this.cache={},this.head=this.tail=null,this.length=0,this.max=r.max||1e3,this.maxAge=r.maxAge||0}kie(Ys,DG.EventEmitter);Object.defineProperty(Ys.prototype,"keys",{get:function(){return Object.keys(this.cache)}});Ys.prototype.clear=function(){this.cache={},this.head=this.tail=null,this.length=0};Ys.prototype.remove=function(r){if(typeof r!="string"&&(r=""+r),!!this.cache.hasOwnProperty(r)){var e=this.cache[r];return delete this.cache[r],this._unlink(r,e.prev,e.next),e.value}};Ys.prototype._unlink=function(r,e,t){this.length--,this.length===0?this.head=this.tail=null:this.head===r?(this.head=e,this.cache[this.head].next=null):this.tail===r?(this.tail=t,this.cache[this.tail].prev=null):(this.cache[e].next=t,this.cache[t].prev=e)};Ys.prototype.peek=function(r){if(this.cache.hasOwnProperty(r)){var e=this.cache[r];if(this._checkAge(r,e))return e.value}};Ys.prototype.set=function(r,e){typeof r!="string"&&(r=""+r);var t;if(this.cache.hasOwnProperty(r)){if(t=this.cache[r],t.value=e,this.maxAge&&(t.modified=Date.now()),r===this.head)return e;this._unlink(r,t.prev,t.next)}else t={value:e,modified:0,next:null,prev:null},this.maxAge&&(t.modified=Date.now()),this.cache[r]=t,this.length===this.max&&this.evict();return this.length++,t.next=null,t.prev=this.head,this.head&&(this.cache[this.head].next=r),this.head=r,this.tail||(this.tail=r),e};Ys.prototype._checkAge=function(r,e){return this.maxAge&&Date.now()-e.modified>this.maxAge?(this.remove(r),this.emit("evict",{key:r,value:e.value}),!1):!0};Ys.prototype.get=function(r){if(typeof r!="string"&&(r=""+r),!!this.cache.hasOwnProperty(r)){var e=this.cache[r];if(this._checkAge(r,e))return this.head!==r&&(r===this.tail?(this.tail=e.next,this.cache[this.tail].prev=null):this.cache[e.prev].next=e.next,this.cache[e.next].prev=e.prev,this.cache[this.head].next=r,e.prev=this.head,e.next=null,this.head=r),e.value}};Ys.prototype.evict=function(){if(this.tail){var r=this.tail,e=this.remove(this.tail);this.emit("evict",{key:r,value:e})}};const pA=Zu(Tie),_ie=(r,e)=>{const t=r.time-e.time;return t===0&&r.id!==e.id?r.id<e.id?-1:1:t},Pie=r=>b5(r.id,++r.time),b5=(r,e)=>(e=e||0,{id:r,time:e}),Nie=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},vT=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};function Die(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var Oie=Die,Rie=Oie;let Bie=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Mie=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return OG(this,e)}},$ie=class{constructor(e){this.decoders=e}or(e){return OG(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const OG=(r,e)=>new $ie({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let Lie=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Bie(e,t,n),this.decoder=new Mie(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const RG=({name:r,prefix:e,encode:t,decode:n})=>new Lie(r,e,t,n),BG=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=Rie(t,e);return RG({prefix:r,name:e,encode:n,decode:i=>vT(s(i))})},Uie=(r,e,t,n)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Fie=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Vc=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>RG({prefix:e,name:r,encode(s){return Fie(s,n,t)},decode(s){return Uie(s,n,t,r)}}),Y3=Vc({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Vc({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Vc({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Vc({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Vc({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Vc({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Vc({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Vc({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Vc({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Un=BG({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});BG({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var zie=MG,wO=128,Vie=-128,Hie=Math.pow(2,31);function MG(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Hie;)e[t++]=r&255|wO,r/=128;for(;r&Vie;)e[t++]=r&255|wO,r>>>=7;return e[t]=r|0,MG.bytes=t-n+1,e}var Kie=gA,Gie=128,bO=127;function gA(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw gA.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&bO)<<s:(o&bO)*Math.pow(2,s),s+=7}while(o>=Gie);return gA.bytes=i-n,t}var jie=Math.pow(2,7),qie=Math.pow(2,14),Wie=Math.pow(2,21),Qie=Math.pow(2,28),Jie=Math.pow(2,35),Yie=Math.pow(2,42),Xie=Math.pow(2,49),Zie=Math.pow(2,56),eoe=Math.pow(2,63),toe=function(r){return r<jie?1:r<qie?2:r<Wie?3:r<Qie?4:r<Jie?5:r<Yie?6:r<Xie?7:r<Zie?8:r<eoe?9:10},roe={encode:zie,decode:Kie,encodingLength:toe},c8=roe;const yA=(r,e=0)=>[c8.decode(r,e),c8.decode.bytes],l8=(r,e,t=0)=>(c8.encode(r,e,t),e),u8=r=>c8.encodingLength(r),mA=(r,e)=>{const t=e.byteLength,n=u8(r),s=n+u8(t),i=new Uint8Array(s+t);return l8(r,i,0),l8(t,i,n),i.set(e,s),new ET(r,t,e,i)},noe=r=>{const e=vT(r),[t,n]=yA(e),[s,i]=yA(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new ET(t,s,o,e)},soe=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Nie(r.bytes,t.bytes)}};let ET=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const vO=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return ooe(t,wA(r),e||Un.encoder);default:return aoe(t,wA(r),e||Y3.encoder)}},EO=new WeakMap,wA=r=>{const e=EO.get(r);if(e==null){const t=new Map;return EO.set(r,t),t}return e};let Io=class ln{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Ag)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==coe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return ln.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=mA(e,t);return ln.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return ln.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&soe(e.multihash,n.multihash)}toString(e){return vO(this,e)}toJSON(){return{"/":vO(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof ln)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new ln(n,s,i,o||xO(n,s,i.bytes))}else if(t[loe]===!0){const{version:n,multihash:s,code:i}=t,o=noe(s);return ln.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Ag)throw new Error(`Version 0 CID must use dag-pb (code: ${Ag}) block encoding`);return new ln(e,t,n,n.bytes)}case 1:{const s=xO(e,t,n.bytes);return new ln(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return ln.create(0,Ag,e)}static createV1(e,t){return ln.create(1,e,t)}static decode(e){const[t,n]=ln.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=ln.inspectBytes(e),n=t.size-t.multihashSize,s=vT(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new ET(t.multihashCode,t.digestSize,i,s);return[t.version===0?ln.createV0(o):ln.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=yA(e.subarray(t));return t+=p,d};let s=n(),i=Ag;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,s]=ioe(e,t),i=ln.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return wA(i).set(n,e),i}};const ioe=(r,e)=>{switch(r[0]){case"Q":{const t=e||Un;return[Un.prefix,t.decode(`${Un.prefix}${r}`)]}case Un.prefix:{const t=e||Un;return[Un.prefix,t.decode(r)]}case Y3.prefix:{const t=e||Y3;return[Y3.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},ooe=(r,e,t)=>{const{prefix:n}=t;if(n!==Un.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},aoe=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},Ag=112,coe=18,xO=(r,e,t)=>{const n=u8(r),s=n+u8(e),i=new Uint8Array(s+t.byteLength);return l8(r,i,0),l8(e,i,n),i.set(t,s),i},loe=Symbol.for("@ipld/js-cid/CID"),uoe=({name:r,code:e,encode:t})=>new hoe(r,e,t);let hoe=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?mA(this.code,t):t.then(n=>mA(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Rw({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*doe(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const s=[...r,t],i=Io.asCID(n);i?yield[s.join("/"),i]:typeof n=="object"&&(yield*bA(n,s))}else{const t=Io.asCID(e);t?yield[r.join("/"),t]:yield*bA(e,r)}}function*bA(r,e){if(r==null||r instanceof Uint8Array)return;const t=Io.asCID(r);t&&(yield[e.join("/"),t]);for(const[n,s]of Object.entries(r)){const i=[...e,n];yield*doe(i,s)}}function*foe(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const s=[...r,t];yield s.join("/"),typeof n=="object"&&!Io.asCID(n)&&(yield*vA(n,s))}else yield*vA(e,r)}function*vA(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const s=[...e,t];yield s.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!Io.asCID(n)&&(yield*foe(s,n))}}function poe(r,e){let t=r;for(const[n,s]of e.entries()){if(t=t[s],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);const i=Io.asCID(t);if(i)return{value:i,remaining:e.slice(n+1).join("/")}}return{value:t}}let $G=class{constructor({cid:e,bytes:t,value:n}){if(!e||!t||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:Rw(),bytes:Rw(),value:Rw(),asBlock:Rw()})}links(){return bA(this.value,[])}tree(){return vA(this.value,[])}get(e="/"){return poe(this.value,e.split("/").filter(Boolean))}};async function H1({value:r,codec:e,hasher:t}){if(typeof r>"u")throw new Error('Missing required argument "value"');if(!e||!t)throw new Error("Missing required argument: codec or hasher");const n=e.encode(r),s=await t.digest(n),i=Io.create(1,e.code,s);return new $G({value:r,bytes:n,cid:i})}async function v5({bytes:r,codec:e,hasher:t}){if(!r)throw new Error('Missing required argument "bytes"');if(!e||!t)throw new Error("Missing required argument: codec or hasher");const n=e.decode(r),s=await t.digest(r),i=Io.create(1,e.code,s);return new $G({value:n,bytes:r,cid:i})}const goe=["string","number","bigint","symbol"],yoe=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function moe(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";const e=typeof r;if(goe.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(woe(r))return"Buffer";const t=boe(r);return t||"Object"}function woe(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function boe(r){const e=Object.prototype.toString.call(r).slice(8,-1);if(yoe.includes(e))return e}class X{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}X.uint=new X(0,"uint",!0);X.negint=new X(1,"negint",!0);X.bytes=new X(2,"bytes",!0);X.string=new X(3,"string",!0);X.array=new X(4,"array",!1);X.map=new X(5,"map",!1);X.tag=new X(6,"tag",!1);X.float=new X(7,"float",!0);X.false=new X(7,"false",!0);X.true=new X(7,"true",!0);X.null=new X(7,"null",!0);X.undefined=new X(7,"undefined",!0);X.break=new X(7,"break",!0);class ue{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const K1=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",voe=new TextDecoder,Eoe=new TextEncoder;function h8(r){return K1&&globalThis.Buffer.isBuffer(r)}function xT(r){return r instanceof Uint8Array?h8(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}const xoe=K1?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):SO(r,e,t):(r,e,t)=>t-e>64?voe.decode(r.subarray(e,t)):SO(r,e,t),LG=K1?r=>r.length>64?globalThis.Buffer.from(r):AO(r):r=>r.length>64?Eoe.encode(r):AO(r),Ta=r=>Uint8Array.from(r),AT=K1?(r,e,t)=>h8(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),Aoe=K1?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),xT(globalThis.Buffer.concat(r,e))):(r,e)=>{const t=new Uint8Array(e);let n=0;for(let s of r)n+s.length>t.length&&(s=s.subarray(0,t.length-n)),t.set(s,n),n+=s.length;return t},Soe=K1?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function Coe(r,e){if(h8(r)&&h8(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function AO(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let s=r.charCodeAt(n);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e}function SO(r,e,t){const n=[];for(;e<t;){const s=r[e];let i=null,o=s>239?4:s>223?3:s>191?2:1;if(e+o<=t){let a,c,l,u;switch(o){case 1:s<128&&(i=s);break;case 2:a=r[e+1],(a&192)===128&&(u=(s&31)<<6|a&63,u>127&&(i=u));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(u=(s&15)<<12|(a&63)<<6|c&63,u>2047&&(u<55296||u>57343)&&(i=u));break;case 4:a=r[e+1],c=r[e+2],l=r[e+3],(a&192)===128&&(c&192)===128&&(l&192)===128&&(u=(s&15)<<18|(a&63)<<12|(c&63)<<6|l&63,u>65535&&u<1114112&&(i=u))}}i===null?(i=65533,o=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|i&1023),n.push(i),e+=o}return UG(n)}const CO=4096;function UG(r){const e=r.length;if(e<=CO)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=CO));return t}const Ioe=256;class FG{constructor(e=Ioe){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const s=t.length-(this.maxCursor-this.cursor)-1;t.set(e,s)}else{if(t){const s=t.length-(this.maxCursor-this.cursor)-1;s<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,s),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=Soe(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=AT(n,0,this.cursor)}else t=Aoe(this.chunks,this.cursor);return e&&this.reset(),t}}const Oe="CBOR decode error:",Ad="CBOR encode error:";function G1(r,e,t){if(r.length-e<t)throw new Error(`${Oe} not enough data for type`)}const jr=[24,256,65536,4294967296,BigInt("18446744073709551616")];function vf(r,e,t){G1(r,e,1);const n=r[e];if(t.strict===!0&&n<jr[0])throw new Error(`${Oe} integer encoded in more bytes than necessary (strict decode)`);return n}function Ef(r,e,t){G1(r,e,2);const n=r[e]<<8|r[e+1];if(t.strict===!0&&n<jr[1])throw new Error(`${Oe} integer encoded in more bytes than necessary (strict decode)`);return n}function xf(r,e,t){G1(r,e,4);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<jr[2])throw new Error(`${Oe} integer encoded in more bytes than necessary (strict decode)`);return n}function Af(r,e,t){G1(r,e,8);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],s=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],i=(BigInt(n)<<BigInt(32))+BigInt(s);if(t.strict===!0&&i<jr[3])throw new Error(`${Oe} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(t.allowBigInt===!0)return i;throw new Error(`${Oe} integers outside of the safe integer range are not supported`)}function koe(r,e,t,n){return new ue(X.uint,vf(r,e+1,n),2)}function Toe(r,e,t,n){return new ue(X.uint,Ef(r,e+1,n),3)}function _oe(r,e,t,n){return new ue(X.uint,xf(r,e+1,n),5)}function Poe(r,e,t,n){return new ue(X.uint,Af(r,e+1,n),9)}function Sf(r,e){return Hi(r,0,e.value)}function Hi(r,e,t){if(t<jr[0]){const n=Number(t);r.push([e|n])}else if(t<jr[1]){const n=Number(t);r.push([e|24,n])}else if(t<jr[2]){const n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<jr[3]){const n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{const n=BigInt(t);if(n<jr[4]){const s=[e|27,0,0,0,0,0,0,0];let i=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));s[8]=i&255,i=i>>8,s[7]=i&255,i=i>>8,s[6]=i&255,i=i>>8,s[5]=i&255,s[4]=o&255,o=o>>8,s[3]=o&255,o=o>>8,s[2]=o&255,o=o>>8,s[1]=o&255,r.push(s)}else throw new Error(`${Oe} encountered BigInt larger than allowable range`)}}Sf.encodedSize=function(e){return Hi.encodedSize(e.value)};Hi.encodedSize=function(e){return e<jr[0]?1:e<jr[1]?2:e<jr[2]?3:e<jr[3]?5:9};Sf.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function Noe(r,e,t,n){return new ue(X.negint,-1-vf(r,e+1,n),2)}function Doe(r,e,t,n){return new ue(X.negint,-1-Ef(r,e+1,n),3)}function Ooe(r,e,t,n){return new ue(X.negint,-1-xf(r,e+1,n),5)}const ST=BigInt(-1),zG=BigInt(1);function Roe(r,e,t,n){const s=Af(r,e+1,n);if(typeof s!="bigint"){const i=-1-s;if(i>=Number.MIN_SAFE_INTEGER)return new ue(X.negint,i,9)}if(n.allowBigInt!==!0)throw new Error(`${Oe} integers outside of the safe integer range are not supported`);return new ue(X.negint,ST-BigInt(s),9)}function CT(r,e){const t=e.value,n=typeof t=="bigint"?t*ST-zG:t*-1-1;Hi(r,e.type.majorEncoded,n)}CT.encodedSize=function(e){const t=e.value,n=typeof t=="bigint"?t*ST-zG:t*-1-1;return n<jr[0]?1:n<jr[1]?2:n<jr[2]?3:n<jr[3]?5:9};CT.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function km(r,e,t,n){G1(r,e,t+n);const s=AT(r,e+t,e+t+n);return new ue(X.bytes,s,t+n)}function Boe(r,e,t,n){return km(r,e,1,t)}function Moe(r,e,t,n){return km(r,e,2,vf(r,e+1,n))}function $oe(r,e,t,n){return km(r,e,3,Ef(r,e+1,n))}function Loe(r,e,t,n){return km(r,e,5,xf(r,e+1,n))}function Uoe(r,e,t,n){const s=Af(r,e+1,n);if(typeof s=="bigint")throw new Error(`${Oe} 64-bit integer bytes lengths not supported`);return km(r,e,9,s)}function d8(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===X.string?LG(r.value):r.value),r.encodedBytes}function E5(r,e){const t=d8(e);Hi(r,e.type.majorEncoded,t.length),r.push(t)}E5.encodedSize=function(e){const t=d8(e);return Hi.encodedSize(t.length)+t.length};E5.compareTokens=function(e,t){return Foe(d8(e),d8(t))};function Foe(r,e){return r.length<e.length?-1:r.length>e.length?1:Coe(r,e)}function Tm(r,e,t,n,s){const i=t+n;G1(r,e,i);const o=new ue(X.string,xoe(r,e+t,e+i),i);return s.retainStringBytes===!0&&(o.byteValue=AT(r,e+t,e+i)),o}function zoe(r,e,t,n){return Tm(r,e,1,t,n)}function Voe(r,e,t,n){return Tm(r,e,2,vf(r,e+1,n),n)}function Hoe(r,e,t,n){return Tm(r,e,3,Ef(r,e+1,n),n)}function Koe(r,e,t,n){return Tm(r,e,5,xf(r,e+1,n),n)}function Goe(r,e,t,n){const s=Af(r,e+1,n);if(typeof s=="bigint")throw new Error(`${Oe} 64-bit integer string lengths not supported`);return Tm(r,e,9,s,n)}const joe=E5;function j1(r,e,t,n){return new ue(X.array,n,t)}function qoe(r,e,t,n){return j1(r,e,1,t)}function Woe(r,e,t,n){return j1(r,e,2,vf(r,e+1,n))}function Qoe(r,e,t,n){return j1(r,e,3,Ef(r,e+1,n))}function Joe(r,e,t,n){return j1(r,e,5,xf(r,e+1,n))}function Yoe(r,e,t,n){const s=Af(r,e+1,n);if(typeof s=="bigint")throw new Error(`${Oe} 64-bit integer array lengths not supported`);return j1(r,e,9,s)}function Xoe(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Oe} indefinite length items not allowed`);return j1(r,e,1,1/0)}function IT(r,e){Hi(r,X.array.majorEncoded,e.value)}IT.compareTokens=Sf.compareTokens;IT.encodedSize=function(e){return Hi.encodedSize(e.value)};function q1(r,e,t,n){return new ue(X.map,n,t)}function Zoe(r,e,t,n){return q1(r,e,1,t)}function eae(r,e,t,n){return q1(r,e,2,vf(r,e+1,n))}function tae(r,e,t,n){return q1(r,e,3,Ef(r,e+1,n))}function rae(r,e,t,n){return q1(r,e,5,xf(r,e+1,n))}function nae(r,e,t,n){const s=Af(r,e+1,n);if(typeof s=="bigint")throw new Error(`${Oe} 64-bit integer map lengths not supported`);return q1(r,e,9,s)}function sae(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Oe} indefinite length items not allowed`);return q1(r,e,1,1/0)}function kT(r,e){Hi(r,X.map.majorEncoded,e.value)}kT.compareTokens=Sf.compareTokens;kT.encodedSize=function(e){return Hi.encodedSize(e.value)};function iae(r,e,t,n){return new ue(X.tag,t,1)}function oae(r,e,t,n){return new ue(X.tag,vf(r,e+1,n),2)}function aae(r,e,t,n){return new ue(X.tag,Ef(r,e+1,n),3)}function cae(r,e,t,n){return new ue(X.tag,xf(r,e+1,n),5)}function lae(r,e,t,n){return new ue(X.tag,Af(r,e+1,n),9)}function TT(r,e){Hi(r,X.tag.majorEncoded,e.value)}TT.compareTokens=Sf.compareTokens;TT.encodedSize=function(e){return Hi.encodedSize(e.value)};const uae=20,hae=21,dae=22,fae=23;function pae(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${Oe} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new ue(X.null,null,1):new ue(X.undefined,void 0,1)}function gae(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Oe} indefinite length items not allowed`);return new ue(X.break,void 0,1)}function _T(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${Oe} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${Oe} Infinity values are not supported`)}return new ue(X.float,r,e)}function yae(r,e,t,n){return _T(NT(r,e+1),3,n)}function mae(r,e,t,n){return _T(DT(r,e+1),5,n)}function wae(r,e,t,n){return _T(GG(r,e+1),9,n)}function PT(r,e,t){const n=e.value;if(n===!1)r.push([X.float.majorEncoded|uae]);else if(n===!0)r.push([X.float.majorEncoded|hae]);else if(n===null)r.push([X.float.majorEncoded|dae]);else if(n===void 0)r.push([X.float.majorEncoded|fae]);else{let s,i=!1;(!t||t.float64!==!0)&&(HG(n),s=NT(Zi,1),n===s||Number.isNaN(n)?(Zi[0]=249,r.push(Zi.slice(0,3)),i=!0):(KG(n),s=DT(Zi,1),n===s&&(Zi[0]=250,r.push(Zi.slice(0,5)),i=!0))),i||(bae(n),s=GG(Zi,1),Zi[0]=251,r.push(Zi.slice(0,9)))}}PT.encodedSize=function(e,t){const n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){HG(n);let s=NT(Zi,1);if(n===s||Number.isNaN(n))return 3;if(KG(n),s=DT(Zi,1),n===s)return 5}return 9};const VG=new ArrayBuffer(9),fi=new DataView(VG,1),Zi=new Uint8Array(VG,0);function HG(r){if(r===1/0)fi.setUint16(0,31744,!1);else if(r===-1/0)fi.setUint16(0,64512,!1);else if(Number.isNaN(r))fi.setUint16(0,32256,!1);else{fi.setFloat32(0,r);const e=fi.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)fi.setUint16(0,31744,!1);else if(t===0)fi.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{const s=t-127;s<-24?fi.setUint16(0,0):s<-14?fi.setUint16(0,(e&2147483648)>>16|1<<24+s,!1):fi.setUint16(0,(e&2147483648)>>16|s+15<<10|n>>13,!1)}}}function NT(r,e){if(r.length-e<2)throw new Error(`${Oe} not enough data for float16`);const t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const n=t>>10&31,s=t&1023;let i;return n===0?i=s*2**-24:n!==31?i=(s+1024)*2**(n-25):i=s===0?1/0:NaN,t&32768?-i:i}function KG(r){fi.setFloat32(0,r,!1)}function DT(r,e){if(r.length-e<4)throw new Error(`${Oe} not enough data for float32`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function bae(r){fi.setFloat64(0,r,!1)}function GG(r,e){if(r.length-e<8)throw new Error(`${Oe} not enough data for float64`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}PT.compareTokens=Sf.compareTokens;function wt(r,e,t){throw new Error(`${Oe} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function x5(r){return()=>{throw new Error(`${Oe} ${r}`)}}const ge=[];for(let r=0;r<=23;r++)ge[r]=wt;ge[24]=koe;ge[25]=Toe;ge[26]=_oe;ge[27]=Poe;ge[28]=wt;ge[29]=wt;ge[30]=wt;ge[31]=wt;for(let r=32;r<=55;r++)ge[r]=wt;ge[56]=Noe;ge[57]=Doe;ge[58]=Ooe;ge[59]=Roe;ge[60]=wt;ge[61]=wt;ge[62]=wt;ge[63]=wt;for(let r=64;r<=87;r++)ge[r]=Boe;ge[88]=Moe;ge[89]=$oe;ge[90]=Loe;ge[91]=Uoe;ge[92]=wt;ge[93]=wt;ge[94]=wt;ge[95]=x5("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)ge[r]=zoe;ge[120]=Voe;ge[121]=Hoe;ge[122]=Koe;ge[123]=Goe;ge[124]=wt;ge[125]=wt;ge[126]=wt;ge[127]=x5("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)ge[r]=qoe;ge[152]=Woe;ge[153]=Qoe;ge[154]=Joe;ge[155]=Yoe;ge[156]=wt;ge[157]=wt;ge[158]=wt;ge[159]=Xoe;for(let r=160;r<=183;r++)ge[r]=Zoe;ge[184]=eae;ge[185]=tae;ge[186]=rae;ge[187]=nae;ge[188]=wt;ge[189]=wt;ge[190]=wt;ge[191]=sae;for(let r=192;r<=215;r++)ge[r]=iae;ge[216]=oae;ge[217]=aae;ge[218]=cae;ge[219]=lae;ge[220]=wt;ge[221]=wt;ge[222]=wt;ge[223]=wt;for(let r=224;r<=243;r++)ge[r]=x5("simple values are not supported");ge[244]=wt;ge[245]=wt;ge[246]=wt;ge[247]=pae;ge[248]=x5("simple values are not supported");ge[249]=yae;ge[250]=mae;ge[251]=wae;ge[252]=wt;ge[253]=wt;ge[254]=wt;ge[255]=gae;const xa=[];for(let r=0;r<24;r++)xa[r]=new ue(X.uint,r,1);for(let r=-1;r>=-24;r--)xa[31-r]=new ue(X.negint,r,1);xa[64]=new ue(X.bytes,new Uint8Array(0),1);xa[96]=new ue(X.string,"",1);xa[128]=new ue(X.array,0,1);xa[160]=new ue(X.map,0,1);xa[244]=new ue(X.false,!1,1);xa[245]=new ue(X.true,!0,1);xa[246]=new ue(X.null,null,1);function vae(r){switch(r.type){case X.false:return Ta([244]);case X.true:return Ta([245]);case X.null:return Ta([246]);case X.bytes:return r.value.length?void 0:Ta([64]);case X.string:return r.value===""?Ta([96]):void 0;case X.array:return r.value===0?Ta([128]):void 0;case X.map:return r.value===0?Ta([160]):void 0;case X.uint:return r.value<24?Ta([Number(r.value)]):void 0;case X.negint:if(r.value>=-24)return Ta([31-Number(r.value)])}}const Eae={float64:!1,mapSorter:Sae,quickEncodeToken:vae};function xae(){const r=[];return r[X.uint.major]=Sf,r[X.negint.major]=CT,r[X.bytes.major]=E5,r[X.string.major]=joe,r[X.array.major]=IT,r[X.map.major]=kT,r[X.tag.major]=TT,r[X.float.major]=PT,r}const jG=xae(),m9=new FG;class f8{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${Ad} object contains circular references`);return new f8(t,e)}}const ol={null:new ue(X.null,null),undefined:new ue(X.undefined,void 0),true:new ue(X.true,!0),false:new ue(X.false,!1),emptyArray:new ue(X.array,0),emptyMap:new ue(X.map,0)},Mu={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new ue(X.float,r):r>=0?new ue(X.uint,r):new ue(X.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new ue(X.uint,r):new ue(X.negint,r)},Uint8Array(r,e,t,n){return new ue(X.bytes,r)},string(r,e,t,n){return new ue(X.string,r)},boolean(r,e,t,n){return r?ol.true:ol.false},null(r,e,t,n){return ol.null},undefined(r,e,t,n){return ol.undefined},ArrayBuffer(r,e,t,n){return new ue(X.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new ue(X.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[ol.emptyArray,new ue(X.break)]:ol.emptyArray;n=f8.createCheck(n,r);const s=[];let i=0;for(const o of r)s[i++]=X3(o,t,n);return t.addBreakTokens?[new ue(X.array,r.length),s,new ue(X.break)]:[new ue(X.array,r.length),s]},Object(r,e,t,n){const s=e!=="Object",i=s?r.keys():Object.keys(r),o=s?r.size:i.length;if(!o)return t.addBreakTokens===!0?[ol.emptyMap,new ue(X.break)]:ol.emptyMap;n=f8.createCheck(n,r);const a=[];let c=0;for(const l of i)a[c++]=[X3(l,t,n),X3(s?r.get(l):r[l],t,n)];return Aae(a,t),t.addBreakTokens?[new ue(X.map,o),a,new ue(X.break)]:[new ue(X.map,o),a]}};Mu.Map=Mu.Object;Mu.Buffer=Mu.Uint8Array;for(const r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Mu[`${r}Array`]=Mu.DataView;function X3(r,e={},t){const n=moe(r),s=e&&e.typeEncoders&&e.typeEncoders[n]||Mu[n];if(typeof s=="function"){const o=s(r,n,e,t);if(o!=null)return o}const i=Mu[n];if(!i)throw new Error(`${Ad} unsupported type: ${n}`);return i(r,n,e,t)}function Aae(r,e){e.mapSorter&&r.sort(e.mapSorter)}function Sae(r,e){const t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);const s=t.type.major,i=jG[s].compareTokens(t,n);return i===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function qG(r,e,t,n){if(Array.isArray(e))for(const s of e)qG(r,s,t,n);else t[e.type.major](r,e,n)}function WG(r,e,t){const n=X3(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){const s=t.quickEncodeToken(n);if(s)return s;const i=e[n.type.major];if(i.encodedSize){const o=i.encodedSize(n,t),a=new FG(o);if(i(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return xT(a.chunks[0])}}return m9.reset(),qG(m9,n,e,t),m9.toBytes(!0)}function Z3(r,e){return e=Object.assign({},Eae,e),WG(r,jG,e)}const Cae={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Iae{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=xa[e];if(t===void 0){const n=ge[e];if(!n)throw new Error(`${Oe} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const s=e&31;t=n(this.data,this._pos,s,this.options)}return this._pos+=t.encodedLength,t}}const dy=Symbol.for("DONE"),A5=Symbol.for("BREAK");function kae(r,e,t){const n=[];for(let s=0;s<r.value;s++){const i=fy(e,t);if(i===A5){if(r.value===1/0)break;throw new Error(`${Oe} got unexpected break to lengthed array`)}if(i===dy)throw new Error(`${Oe} found array but not enough entries (got ${s}, expected ${r.value})`);n[s]=i}return n}function Tae(r,e,t){const n=t.useMaps===!0,s=n?void 0:{},i=n?new Map:void 0;for(let o=0;o<r.value;o++){const a=fy(e,t);if(a===A5){if(r.value===1/0)break;throw new Error(`${Oe} got unexpected break to lengthed map`)}if(a===dy)throw new Error(`${Oe} found map but not enough entries (got ${o} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${Oe} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&i.has(a)||!n&&a in s))throw new Error(`${Oe} found repeat map key "${a}"`);const c=fy(e,t);if(c===dy)throw new Error(`${Oe} found map but not enough entries (got ${o} [no value], expected ${r.value})`);n?i.set(a,c):s[a]=c}return n?i:s}function fy(r,e){if(r.done())return dy;const t=r.next();if(t.type===X.break)return A5;if(t.type.terminal)return t.value;if(t.type===X.array)return kae(t,r,e);if(t.type===X.map)return Tae(t,r,e);if(t.type===X.tag){if(e.tags&&typeof e.tags[t.value]=="function"){const n=fy(r,e);return e.tags[t.value](n)}throw new Error(`${Oe} tag not supported (${t.value})`)}throw new Error("unsupported")}function _ae(r,e){if(!(r instanceof Uint8Array))throw new Error(`${Oe} data to decode must be a Uint8Array`);e=Object.assign({},Cae,e);const t=e.tokenizer||new Iae(r,e),n=fy(t,e);if(n===dy)throw new Error(`${Oe} did not find any content to decode`);if(n===A5)throw new Error(`${Oe} got unexpected break`);return[n,r.subarray(t.pos())]}function Fl(r,e){const[t,n]=_ae(r,e);if(n.length>0)throw new Error(`${Oe} too many terminals, data makes no sense`);return t}function Pae(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function OT(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Nae(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var Dae=Nae,Oae=Dae;let Rae=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Bae=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return QG(this,e)}},Mae=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return QG(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function QG(r,e){return new Mae({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let $ae=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Rae(e,t,n),this.decoder=new Bae(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function JG({name:r,prefix:e,encode:t,decode:n}){return new $ae(r,e,t,n)}function S5({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=Oae(t,r);return JG({prefix:e,name:r,encode:n,decode:i=>OT(s(i))})}function Lae(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Uae(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function Hc({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return JG({prefix:e,name:r,encode(s){return Uae(s,n,t)},decode(s){return Lae(s,n,t,r)}})}const e4=Hc({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Hc({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Hc({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Hc({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Hc({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Hc({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Hc({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Hc({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Hc({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const w9=S5({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});S5({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const kl=S5({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});S5({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Fae=YG,IO=128,zae=-128,Vae=Math.pow(2,31);function YG(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Vae;)e[t++]=r&255|IO,r/=128;for(;r&zae;)e[t++]=r&255|IO,r>>>=7;return e[t]=r|0,YG.bytes=t-n+1,e}var Hae=EA,Kae=128,kO=127;function EA(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw EA.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&kO)<<s:(o&kO)*Math.pow(2,s),s+=7}while(o>=Kae);return EA.bytes=i-n,t}var Gae=Math.pow(2,7),jae=Math.pow(2,14),qae=Math.pow(2,21),Wae=Math.pow(2,28),Qae=Math.pow(2,35),Jae=Math.pow(2,42),Yae=Math.pow(2,49),Xae=Math.pow(2,56),Zae=Math.pow(2,63),ece=function(r){return r<Gae?1:r<jae?2:r<qae?3:r<Wae?4:r<Qae?5:r<Jae?6:r<Yae?7:r<Xae?8:r<Zae?9:10},tce={encode:Fae,decode:Hae,encodingLength:ece},p8=tce;function xA(r,e=0){return[p8.decode(r,e),p8.decode.bytes]}function g8(r,e,t=0){return p8.encode(r,e,t),e}function y8(r){return p8.encodingLength(r)}function rce(r,e){const t=e.byteLength,n=y8(r),s=n+y8(t),i=new Uint8Array(s+t);return g8(r,i,0),g8(t,i,n),i.set(e,s),new RT(r,t,e,i)}function nce(r){const e=OT(r),[t,n]=xA(e),[s,i]=xA(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new RT(t,s,o,e)}function sce(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Pae(r.bytes,t.bytes)}}let RT=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function TO(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return oce(t,AA(r),e??kl.encoder);default:return ace(t,AA(r),e??e4.encoder)}}const _O=new WeakMap;function AA(r){const e=_O.get(r);if(e==null){const t=new Map;return _O.set(r,t),t}return e}var Pz;let XG=class un{constructor(e,t,n,s){h(this,"code");h(this,"version");h(this,"multihash");h(this,"bytes");h(this,"/");h(this,Pz,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Sg)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==cce)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return un.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=rce(e,t);return un.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return un.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&sce(e.multihash,n.multihash)}toString(e){return TO(this,e)}toJSON(){return{"/":TO(this)}}link(){return this}[(Pz=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof un)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new un(n,s,i,o??PO(n,s,i.bytes))}else if(t[lce]===!0){const{version:n,multihash:s,code:i}=t,o=nce(s);return un.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Sg)throw new Error(`Version 0 CID must use dag-pb (code: ${Sg}) block encoding`);return new un(e,t,n,n.bytes)}case 1:{const s=PO(e,t,n.bytes);return new un(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return un.create(0,Sg,e)}static createV1(e,t){return un.create(1,e,t)}static decode(e){const[t,n]=un.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=un.inspectBytes(e),n=t.size-t.multihashSize,s=OT(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new RT(t.multihashCode,t.digestSize,i,s);return[t.version===0?un.createV0(o):un.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=xA(e.subarray(t));return t+=p,d};let s=n(),i=Sg;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,s]=ice(e,t),i=un.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return AA(i).set(n,e),i}};function ice(r,e){switch(r[0]){case"Q":{const t=e??kl;return[kl.prefix,t.decode(`${kl.prefix}${r}`)]}case kl.prefix:{const t=e??kl;return[kl.prefix,t.decode(r)]}case e4.prefix:{const t=e??e4;return[e4.prefix,t.decode(r)]}case w9.prefix:{const t=e??w9;return[w9.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function oce(r,e,t){const{prefix:n}=t;if(n!==kl.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s}function ace(r,e,t){const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s}const Sg=112,cce=18;function PO(r,e,t){const n=y8(r),s=n+y8(e),i=new Uint8Array(s+t.byteLength);return g8(r,i,0),g8(e,i,n),i.set(t,s),i}const lce=Symbol.for("@ipld/js-cid/CID"),ZG=42;function ej(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function uce(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=XG.asCID(r);if(!e)return null;const t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new ue(X.tag,ZG),new ue(X.bytes,t)]}function hce(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function dce(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const SA={float64:!0,typeEncoders:{Object:uce,undefined:hce,number:dce}},fce={...SA,typeEncoders:{...SA.typeEncoders}};function pce(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return XG.decode(r.subarray(1))}const m8={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};m8.tags[ZG]=pce;const gce={...m8,tags:m8.tags.slice()},yce="dag-cbor",tj=113,mce=r=>Z3(r,SA),wce=r=>Fl(ej(r),m8),_m=Object.freeze(Object.defineProperty({__proto__:null,code:tj,decode:wce,decodeOptions:gce,encode:mce,encodeOptions:fce,name:yce,toByteView:ej},Symbol.toStringTag,{value:"Module"})),bce=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),C5=uoe({name:"sha2-256",code:18,encode:bce("SHA-256")}),I5=_m,k5=C5,rj=Un,vce=async(r,e,t,n=null,s=[],i=[])=>{if(r==null)throw new Error("Identity is required, cannot create entry");if(e==null)throw new Error("Entry requires an id");if(t==null)throw new Error("Entry requires a payload");if(s==null||!Array.isArray(s))throw new Error("'next' argument is not an array");n=n||b5(r.publicKey);const o={id:e,payload:t,next:s,refs:i,clock:n,v:2},{bytes:a}=await H1({value:o,codec:I5,hasher:k5}),c=await r.sign(r,a);return o.key=r.publicKey,o.identity=r.hash,o.sig=c,sj(o)},Ece=async(r,e)=>{if(!r)throw new Error("Identities is required, cannot verify entry");if(!nj(e))throw new Error("Invalid Log entry");if(!e.key)throw new Error("Entry doesn't have a key");if(!e.sig)throw new Error("Entry doesn't have a signature");const t={id:e.id,payload:e.payload,next:e.next,refs:e.refs,clock:e.clock,v:e.v},{bytes:n}=await H1({value:t,codec:I5,hasher:k5});return r.verify(e.sig,e.key,n)},nj=r=>r&&r.id!==void 0&&r.next!==void 0&&r.payload!==void 0&&r.v!==void 0&&r.clock!==void 0&&r.refs!==void 0,xce=(r,e)=>r&&e&&r.hash===e.hash,Ace=async r=>{const{cid:e,value:t}=await v5({bytes:r,codec:I5,hasher:k5}),n=e.toString(rj);return{...t,hash:n,bytes:r}},sj=async r=>{const{cid:e,bytes:t}=await H1({value:r,codec:I5,hasher:k5}),n=e.toString(rj),s=b5(r.clock.id,r.clock.time);return{...r,clock:s,hash:n,bytes:t}},Ga={create:vce,verify:Ece,decode:Ace,encode:sj,isEntry:nj,isEqual:xce},BT=async()=>{let r={};const e=async(c,l)=>{r[c]=l};return{put:e,del:async c=>{delete r[c]},get:async c=>r[c],iterator:async function*(){for await(const[c,l]of Object.entries(r))yield[c,l]},merge:async c=>{if(c)for await(const[l,u]of c.iterator())e(l,u)},clear:async()=>{r={}},close:async()=>{}}},Sce=BT,Cce=async({storage:r,heads:e})=>{r=r||await Sce();const t=async u=>{u=NO(u);for(const d of u)await r.put(d.hash,d.bytes)},n=async u=>{await r.clear(),await t(u)},s=async u=>{const d=await a();if(d.find(y=>Ga.isEqual(y,u)))return;const p=NO([...d,u]);return await n(p),p},i=async u=>{const p=(await a()).filter(y=>y.hash!==u);await n(p)},o=async function*(){const u=r.iterator();for await(const[,d]of u)yield await Ga.decode(d)},a=async()=>{const u=[];for await(const d of o())u.push(d);return u},c=async()=>{await r.clear()},l=async()=>{await r.close()};return await t(e||[]),{put:t,set:n,add:s,remove:i,iterator:o,all:a,clear:c,close:l}},NO=r=>{r=new Set(r);const e={};for(const n of r)for(const s of n.next)e[s]=n.hash;const t=[];for(const n of r)e[n.hash]||t.push(n);return t};function Ice(r,e){const t=(i,o)=>i,n=(i,o)=>Tce(i,o,t);return((i,o)=>kce(i,o,n))(r,e)}function kce(r,e,t){const n=_ie(r.clock,e.clock);return n===0?t(r,e):n}function Tce(r,e,t){return r.clock.id===e.clock.id?t(r,e):r.clock.id<e.clock.id?-1:1}function _ce(r){const e=`Your log's tiebreaker function, ${r.name}, has returned zero and therefore cannot be`;return(n,s)=>{const i=r(n,s);if(i===0)throw Error(e);return i}}const Pce={LastWriteWins:Ice,NoZeroes:_ce},{LastWriteWins:Nce,NoZeroes:Dce}=Pce,Oce=()=>new Date().getTime().toString(),Rce=(r,e)=>Math.max(r,e.clock.time),b9=BT,Bce=async()=>({canAppend:async r=>!0}),Mce=async(r,{logId:e,logHeads:t,access:n,entryStorage:s,headsStorage:i,indexStorage:o,sortFn:a}={})=>{if(r==null)throw new Error("Identity is required");if(t!=null&&!Array.isArray(t))throw new Error("'logHeads' argument must be an array");const c=e||Oce();n=n||await Bce();const l=s||await b9(),u=o||await b9();i=i||await b9();const d=await Cce({storage:i,heads:t});a=Dce(a||Nce);const p=new Bu({concurrency:1}),y=new Bu({concurrency:1}),f=async()=>{const V=Math.max(0,(await g()).reduce(Rce,0));return b5(r.publicKey,V)},g=async()=>(await d.all()).sort(a).reverse(),w=async()=>{const V=[];for await(const Z of I())V.unshift(Z);return V},m=async V=>{const Z=await l.get(V);if(Z)return await Ga.decode(Z)},b=async V=>await u.get(V)!=null,v=async(V,Z={referencesCount:0})=>{const Y=async()=>{const U=await g(),H=U.map(W=>W.hash),G=await K(U,Z.referencesCount+U.length),$=await Ga.create(r,c,V,Pie(await f()),H,G);if(!await n.canAppend($))throw new Error(`Could not append entry:
Key "${r.hash}" is not allowed to write to the log`);return await d.set([$]),await l.put($.hash,$.bytes),await u.put($.hash,!0),$};return p.add(Y)},E=async V=>{if(!V)throw new Error("Log instance not defined");if(!L(V))throw new Error("Given argument is not an instance of Log");l.merge&&await l.merge(V.storage);const Z=await V.heads();for(const Y of Z)await S(Y)},S=async V=>{const Z=async()=>{if(await b(V.hash))return!1;const U=async ee=>{if(ee.id!==c)throw new Error(`Entry's id (${ee.id}) doesn't match the log's id (${c}).`);if(!await n.canAppend(ee))throw new Error(`Could not append entry:
Key "${ee.identity}" is not allowed to write to the log`);if(!await Ga.verify(r,ee))throw new Error(`Could not validate signature for entry "${ee.hash}"`)};await U(V);const H=(await g()).map(ee=>ee.hash),G=new Set([V.hash]),$=new Set([...V.next,...V.refs]),z=new Set,W=async()=>{const ee=Array.from($.values()).filter(b).map(m),J=await Promise.all(ee);for(const le of J){$.delete(le.hash),await U(le),G.add(le.hash);for(const ye of[...le.next,...le.refs])!await b(ye)&&!G.has(ye)?$.add(ye):H.includes(ye)&&z.add(ye)}$.size>0&&await W()};await W();for(const ee of G.values())await u.put(ee,!0);for(const ee of z.values())await d.remove(ee);return await l.put(V.hash,V.bytes),await d.add(V),!0};return y.add(Z)},I=async function*(V,Z){Z=Z||(()=>!1),V=V||await g();let U=V.sort(a);const H={};let G=[];const $={},z=ee=>!(H[ee]||$[ee]);let W;for(;U.length>0;)if(U=U.sort(a),W=U.pop(),W){const{hash:ee,next:J}=W;if(!H[ee]){if(yield W,await Z(W)===!0)break;H[ee]=!0,$[ee]=!0,G=[...G,...J].filter(z);const ye=fe=>{if(!H[fe]&&!$[fe])return $[fe]=!0,m(fe)},de=await Promise.all(G.map(ye));G=de.filter(fe=>fe!=null).reduce((fe,De)=>Array.from(new Set([...fe,...De.next])),[]).filter(z),U=[...de,...U]}}},x=async function*({amount:V=-1,gt:Z,gte:Y,lt:U,lte:H}={}){if(V===0)return;if(typeof H=="string"&&(H=[await m(H)]),typeof U=="string"){const fe=await m(U);U=await Promise.all(fe.next.map($e=>m($e)))}if(U!=null&&!Array.isArray(U))throw new Error("lt must be a string or an array of Entries");if(H!=null&&!Array.isArray(H))throw new Error("lte must be a string or an array of Entries");const G=(U||H||await g()).filter(fe=>fe!=null),$=Z||Y?await m(Z||Y):null,z=$||V===-1?-1:V;let W=0;const ee=async fe=>(W++,fe?!!(W>=z&&z!==-1||$&&Ga.isEqual(fe,$)):!1),J=$&&V!==-1&&!U&&!H,le=J?new pA(V+2):null;let ye=0;const de=I(G,ee);for await(const fe of de){const De=U&&Ga.isEqual(fe,G),$e=Z&&Ga.isEqual(fe,$);De||$e||(J?le.set(ye++,fe.hash):yield fe)}if(J){const fe=le.keys.length,De=fe>V?fe-V:0,$e=le.keys.slice(De,fe);for(const qe of $e){const et=le.get(qe);yield await m(et)}}},C=async()=>{await u.clear(),await d.clear(),await l.clear()},P=async()=>{await u.close(),await d.close(),await l.close()},L=V=>V&&V.id!==void 0&&V.clock!==void 0&&V.heads!==void 0&&V.values!==void 0&&V.access!==void 0&&V.identity!==void 0&&V.storage!==void 0,K=async(V,Z=0)=>{let Y=[];const U=async H=>Y.length>=Z&&Z!==-1;for await(const{hash:H}of I(V,U))Y.push(H);return Y=Y.slice(V.length+1,Z),Y};return{id:c,clock:f,heads:g,values:w,all:w,get:m,has:b,append:v,join:E,joinEntry:S,traverse:I,iterator:x,clear:C,close:P,access:n,identity:r,storage:l}},Sd=async(r,e)=>({put:async(l,u)=>{await r.put(l,u),await e.put(l,u)},get:async l=>{let u=await r.get(l);return u||(u=await e.get(l),u&&await r.put(l,u)),u},del:async l=>{await r.del(l),await e.del(l)},iterator:async function*({amount:l,reverse:u}={}){const d=[],p={amount:l||-1,reverse:u||!1};for(const y of[r,e])for await(const[f,g]of y.iterator(p))d[f]||(d[f]=!0,yield[f,g])},merge:async l=>{await r.merge(l),await e.merge(l),await l.merge(r),await l.merge(e)},clear:async()=>{await r.clear(),await e.clear()},close:async()=>{await r.close(),await e.close()}});function $ce(r){return r[Symbol.asyncIterator]!=null}function Dc(r){if($ce(r))return(async()=>{for await(const e of r);})();for(const e of r);}const DO=3e4,T5=async({ipfs:r,pin:e,timeout:t}={})=>{if(!r)throw new Error("An instance of ipfs is required.");return{put:async(u,d)=>{const p=Io.parse(u,Un),{signal:y}=new dA.TimeoutController(t||DO);await r.blockstore.put(p,d,{signal:y}),e&&!await r.pins.isPinned(p)&&await Dc(r.pins.add(p))},del:async u=>{},get:async u=>{const d=Io.parse(u,Un),{signal:p}=new dA.TimeoutController(t||DO),y=await r.blockstore.get(d,{signal:p});if(y)return y},iterator:async function*(){},merge:async u=>{},clear:async()=>{},close:async()=>{}}};var ij={},nh={},_5={},oj={};oj.supports=function(...e){const t=e.reduce((n,s)=>Object.assign(n,s),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})};var aj={},Aa=class extends Error{constructor(e,t){super(e||""),typeof t=="object"&&t!==null&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},Cf={},P5={},N5={};N5.byteLength=Fce;N5.toByteArray=Vce;N5.fromByteArray=Gce;var oa=[],yi=[],Lce=typeof Uint8Array<"u"?Uint8Array:Array,v9="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Bf=0,Uce=v9.length;Bf<Uce;++Bf)oa[Bf]=v9[Bf],yi[v9.charCodeAt(Bf)]=Bf;yi[45]=62;yi[95]=63;function cj(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function Fce(r){var e=cj(r),t=e[0],n=e[1];return(t+n)*3/4-n}function zce(r,e,t){return(e+t)*3/4-t}function Vce(r){var e,t=cj(r),n=t[0],s=t[1],i=new Lce(zce(r,n,s)),o=0,a=s>0?n-4:n,c;for(c=0;c<a;c+=4)e=yi[r.charCodeAt(c)]<<18|yi[r.charCodeAt(c+1)]<<12|yi[r.charCodeAt(c+2)]<<6|yi[r.charCodeAt(c+3)],i[o++]=e>>16&255,i[o++]=e>>8&255,i[o++]=e&255;return s===2&&(e=yi[r.charCodeAt(c)]<<2|yi[r.charCodeAt(c+1)]>>4,i[o++]=e&255),s===1&&(e=yi[r.charCodeAt(c)]<<10|yi[r.charCodeAt(c+1)]<<4|yi[r.charCodeAt(c+2)]>>2,i[o++]=e>>8&255,i[o++]=e&255),i}function Hce(r){return oa[r>>18&63]+oa[r>>12&63]+oa[r>>6&63]+oa[r&63]}function Kce(r,e,t){for(var n,s=[],i=e;i<t;i+=3)n=(r[i]<<16&16711680)+(r[i+1]<<8&65280)+(r[i+2]&255),s.push(Hce(n));return s.join("")}function Gce(r){for(var e,t=r.length,n=t%3,s=[],i=16383,o=0,a=t-n;o<a;o+=i)s.push(Kce(r,o,o+i>a?a:o+i));return n===1?(e=r[t-1],s.push(oa[e>>2]+oa[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],s.push(oa[e>>10]+oa[e>>4&63]+oa[e<<2&63]+"=")),s.join("")}var MT={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */MT.read=function(r,e,t,n,s){var i,o,a=s*8-n-1,c=(1<<a)-1,l=c>>1,u=-7,d=t?s-1:0,p=t?-1:1,y=r[e+d];for(d+=p,i=y&(1<<-u)-1,y>>=-u,u+=a;u>0;i=i*256+r[e+d],d+=p,u-=8);for(o=i&(1<<-u)-1,i>>=-u,u+=n;u>0;o=o*256+r[e+d],d+=p,u-=8);if(i===0)i=1-l;else{if(i===c)return o?NaN:(y?-1:1)*(1/0);o=o+Math.pow(2,n),i=i-l}return(y?-1:1)*o*Math.pow(2,i-n)};MT.write=function(r,e,t,n,s,i){var o,a,c,l=i*8-s-1,u=(1<<l)-1,d=u>>1,p=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=n?0:i-1,f=n?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+d>=1?e+=p/c:e+=p*Math.pow(2,1-d),e*c>=2&&(o++,c/=2),o+d>=u?(a=0,o=u):o+d>=1?(a=(e*c-1)*Math.pow(2,s),o=o+d):(a=e*Math.pow(2,d-1)*Math.pow(2,s),o=0));s>=8;r[t+y]=a&255,y+=f,a/=256,s-=8);for(o=o<<s|a,l+=s;l>0;r[t+y]=o&255,y+=f,o/=256,l-=8);r[t+y-f]|=g*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(r){const e=N5,t=MT,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=a,r.SlowBuffer=b,r.INSPECT_MAX_BYTES=50;const s=2147483647;r.kMaxLength=s,a.TYPED_ARRAY_SUPPORT=i(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function i(){try{const D=new Uint8Array(1),A={foo:function(){return 42}};return Object.setPrototypeOf(A,Uint8Array.prototype),Object.setPrototypeOf(D,A),D.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(D){if(D>s)throw new RangeError('The value "'+D+'" is invalid for option "size"');const A=new Uint8Array(D);return Object.setPrototypeOf(A,a.prototype),A}function a(D,A,k){if(typeof D=="number"){if(typeof A=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return d(D)}return c(D,A,k)}a.poolSize=8192;function c(D,A,k){if(typeof D=="string")return p(D,A);if(ArrayBuffer.isView(D))return f(D);if(D==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof D);if(li(D,ArrayBuffer)||D&&li(D.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(li(D,SharedArrayBuffer)||D&&li(D.buffer,SharedArrayBuffer)))return g(D,A,k);if(typeof D=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const B=D.valueOf&&D.valueOf();if(B!=null&&B!==D)return a.from(B,A,k);const N=w(D);if(N)return N;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof D[Symbol.toPrimitive]=="function")return a.from(D[Symbol.toPrimitive]("string"),A,k);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof D)}a.from=function(D,A,k){return c(D,A,k)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function l(D){if(typeof D!="number")throw new TypeError('"size" argument must be of type number');if(D<0)throw new RangeError('The value "'+D+'" is invalid for option "size"')}function u(D,A,k){return l(D),D<=0?o(D):A!==void 0?typeof k=="string"?o(D).fill(A,k):o(D).fill(A):o(D)}a.alloc=function(D,A,k){return u(D,A,k)};function d(D){return l(D),o(D<0?0:m(D)|0)}a.allocUnsafe=function(D){return d(D)},a.allocUnsafeSlow=function(D){return d(D)};function p(D,A){if((typeof A!="string"||A==="")&&(A="utf8"),!a.isEncoding(A))throw new TypeError("Unknown encoding: "+A);const k=v(D,A)|0;let B=o(k);const N=B.write(D,A);return N!==k&&(B=B.slice(0,N)),B}function y(D){const A=D.length<0?0:m(D.length)|0,k=o(A);for(let B=0;B<A;B+=1)k[B]=D[B]&255;return k}function f(D){if(li(D,Uint8Array)){const A=new Uint8Array(D);return g(A.buffer,A.byteOffset,A.byteLength)}return y(D)}function g(D,A,k){if(A<0||D.byteLength<A)throw new RangeError('"offset" is outside of buffer bounds');if(D.byteLength<A+(k||0))throw new RangeError('"length" is outside of buffer bounds');let B;return A===void 0&&k===void 0?B=new Uint8Array(D):k===void 0?B=new Uint8Array(D,A):B=new Uint8Array(D,A,k),Object.setPrototypeOf(B,a.prototype),B}function w(D){if(a.isBuffer(D)){const A=m(D.length)|0,k=o(A);return k.length===0||D.copy(k,0,0,A),k}if(D.length!==void 0)return typeof D.length!="number"||pg(D.length)?o(0):y(D);if(D.type==="Buffer"&&Array.isArray(D.data))return y(D.data)}function m(D){if(D>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return D|0}function b(D){return+D!=D&&(D=0),a.alloc(+D)}a.isBuffer=function(A){return A!=null&&A._isBuffer===!0&&A!==a.prototype},a.compare=function(A,k){if(li(A,Uint8Array)&&(A=a.from(A,A.offset,A.byteLength)),li(k,Uint8Array)&&(k=a.from(k,k.offset,k.byteLength)),!a.isBuffer(A)||!a.isBuffer(k))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(A===k)return 0;let B=A.length,N=k.length;for(let R=0,F=Math.min(B,N);R<F;++R)if(A[R]!==k[R]){B=A[R],N=k[R];break}return B<N?-1:N<B?1:0},a.isEncoding=function(A){switch(String(A).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(A,k){if(!Array.isArray(A))throw new TypeError('"list" argument must be an Array of Buffers');if(A.length===0)return a.alloc(0);let B;if(k===void 0)for(k=0,B=0;B<A.length;++B)k+=A[B].length;const N=a.allocUnsafe(k);let R=0;for(B=0;B<A.length;++B){let F=A[B];if(li(F,Uint8Array))R+F.length>N.length?(a.isBuffer(F)||(F=a.from(F)),F.copy(N,R)):Uint8Array.prototype.set.call(N,F,R);else if(a.isBuffer(F))F.copy(N,R);else throw new TypeError('"list" argument must be an Array of Buffers');R+=F.length}return N};function v(D,A){if(a.isBuffer(D))return D.length;if(ArrayBuffer.isView(D)||li(D,ArrayBuffer))return D.byteLength;if(typeof D!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof D);const k=D.length,B=arguments.length>2&&arguments[2]===!0;if(!B&&k===0)return 0;let N=!1;for(;;)switch(A){case"ascii":case"latin1":case"binary":return k;case"utf8":case"utf-8":return nl(D).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k*2;case"hex":return k>>>1;case"base64":return dh(D).length;default:if(N)return B?-1:nl(D).length;A=(""+A).toLowerCase(),N=!0}}a.byteLength=v;function E(D,A,k){let B=!1;if((A===void 0||A<0)&&(A=0),A>this.length||((k===void 0||k>this.length)&&(k=this.length),k<=0)||(k>>>=0,A>>>=0,k<=A))return"";for(D||(D="utf8");;)switch(D){case"hex":return z(this,A,k);case"utf8":case"utf-8":return Y(this,A,k);case"ascii":return G(this,A,k);case"latin1":case"binary":return $(this,A,k);case"base64":return Z(this,A,k);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return W(this,A,k);default:if(B)throw new TypeError("Unknown encoding: "+D);D=(D+"").toLowerCase(),B=!0}}a.prototype._isBuffer=!0;function S(D,A,k){const B=D[A];D[A]=D[k],D[k]=B}a.prototype.swap16=function(){const A=this.length;if(A%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let k=0;k<A;k+=2)S(this,k,k+1);return this},a.prototype.swap32=function(){const A=this.length;if(A%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let k=0;k<A;k+=4)S(this,k,k+3),S(this,k+1,k+2);return this},a.prototype.swap64=function(){const A=this.length;if(A%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let k=0;k<A;k+=8)S(this,k,k+7),S(this,k+1,k+6),S(this,k+2,k+5),S(this,k+3,k+4);return this},a.prototype.toString=function(){const A=this.length;return A===0?"":arguments.length===0?Y(this,0,A):E.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(A){if(!a.isBuffer(A))throw new TypeError("Argument must be a Buffer");return this===A?!0:a.compare(this,A)===0},a.prototype.inspect=function(){let A="";const k=r.INSPECT_MAX_BYTES;return A=this.toString("hex",0,k).replace(/(.{2})/g,"$1 ").trim(),this.length>k&&(A+=" ... "),"<Buffer "+A+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(A,k,B,N,R){if(li(A,Uint8Array)&&(A=a.from(A,A.offset,A.byteLength)),!a.isBuffer(A))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof A);if(k===void 0&&(k=0),B===void 0&&(B=A?A.length:0),N===void 0&&(N=0),R===void 0&&(R=this.length),k<0||B>A.length||N<0||R>this.length)throw new RangeError("out of range index");if(N>=R&&k>=B)return 0;if(N>=R)return-1;if(k>=B)return 1;if(k>>>=0,B>>>=0,N>>>=0,R>>>=0,this===A)return 0;let F=R-N,re=B-k;const we=Math.min(F,re),ze=this.slice(N,R),je=A.slice(k,B);for(let Ie=0;Ie<we;++Ie)if(ze[Ie]!==je[Ie]){F=ze[Ie],re=je[Ie];break}return F<re?-1:re<F?1:0};function I(D,A,k,B,N){if(D.length===0)return-1;if(typeof k=="string"?(B=k,k=0):k>2147483647?k=2147483647:k<-2147483648&&(k=-2147483648),k=+k,pg(k)&&(k=N?0:D.length-1),k<0&&(k=D.length+k),k>=D.length){if(N)return-1;k=D.length-1}else if(k<0)if(N)k=0;else return-1;if(typeof A=="string"&&(A=a.from(A,B)),a.isBuffer(A))return A.length===0?-1:x(D,A,k,B,N);if(typeof A=="number")return A=A&255,typeof Uint8Array.prototype.indexOf=="function"?N?Uint8Array.prototype.indexOf.call(D,A,k):Uint8Array.prototype.lastIndexOf.call(D,A,k):x(D,[A],k,B,N);throw new TypeError("val must be string, number or Buffer")}function x(D,A,k,B,N){let R=1,F=D.length,re=A.length;if(B!==void 0&&(B=String(B).toLowerCase(),B==="ucs2"||B==="ucs-2"||B==="utf16le"||B==="utf-16le")){if(D.length<2||A.length<2)return-1;R=2,F/=2,re/=2,k/=2}function we(je,Ie){return R===1?je[Ie]:je.readUInt16BE(Ie*R)}let ze;if(N){let je=-1;for(ze=k;ze<F;ze++)if(we(D,ze)===we(A,je===-1?0:ze-je)){if(je===-1&&(je=ze),ze-je+1===re)return je*R}else je!==-1&&(ze-=ze-je),je=-1}else for(k+re>F&&(k=F-re),ze=k;ze>=0;ze--){let je=!0;for(let Ie=0;Ie<re;Ie++)if(we(D,ze+Ie)!==we(A,Ie)){je=!1;break}if(je)return ze}return-1}a.prototype.includes=function(A,k,B){return this.indexOf(A,k,B)!==-1},a.prototype.indexOf=function(A,k,B){return I(this,A,k,B,!0)},a.prototype.lastIndexOf=function(A,k,B){return I(this,A,k,B,!1)};function C(D,A,k,B){k=Number(k)||0;const N=D.length-k;B?(B=Number(B),B>N&&(B=N)):B=N;const R=A.length;B>R/2&&(B=R/2);let F;for(F=0;F<B;++F){const re=parseInt(A.substr(F*2,2),16);if(pg(re))return F;D[k+F]=re}return F}function P(D,A,k,B){return sl(nl(A,D.length-k),D,k,B)}function L(D,A,k,B){return sl(Df(A),D,k,B)}function K(D,A,k,B){return sl(dh(A),D,k,B)}function V(D,A,k,B){return sl(Of(A,D.length-k),D,k,B)}a.prototype.write=function(A,k,B,N){if(k===void 0)N="utf8",B=this.length,k=0;else if(B===void 0&&typeof k=="string")N=k,B=this.length,k=0;else if(isFinite(k))k=k>>>0,isFinite(B)?(B=B>>>0,N===void 0&&(N="utf8")):(N=B,B=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const R=this.length-k;if((B===void 0||B>R)&&(B=R),A.length>0&&(B<0||k<0)||k>this.length)throw new RangeError("Attempt to write outside buffer bounds");N||(N="utf8");let F=!1;for(;;)switch(N){case"hex":return C(this,A,k,B);case"utf8":case"utf-8":return P(this,A,k,B);case"ascii":case"latin1":case"binary":return L(this,A,k,B);case"base64":return K(this,A,k,B);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,A,k,B);default:if(F)throw new TypeError("Unknown encoding: "+N);N=(""+N).toLowerCase(),F=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Z(D,A,k){return A===0&&k===D.length?e.fromByteArray(D):e.fromByteArray(D.slice(A,k))}function Y(D,A,k){k=Math.min(D.length,k);const B=[];let N=A;for(;N<k;){const R=D[N];let F=null,re=R>239?4:R>223?3:R>191?2:1;if(N+re<=k){let we,ze,je,Ie;switch(re){case 1:R<128&&(F=R);break;case 2:we=D[N+1],(we&192)===128&&(Ie=(R&31)<<6|we&63,Ie>127&&(F=Ie));break;case 3:we=D[N+1],ze=D[N+2],(we&192)===128&&(ze&192)===128&&(Ie=(R&15)<<12|(we&63)<<6|ze&63,Ie>2047&&(Ie<55296||Ie>57343)&&(F=Ie));break;case 4:we=D[N+1],ze=D[N+2],je=D[N+3],(we&192)===128&&(ze&192)===128&&(je&192)===128&&(Ie=(R&15)<<18|(we&63)<<12|(ze&63)<<6|je&63,Ie>65535&&Ie<1114112&&(F=Ie))}}F===null?(F=65533,re=1):F>65535&&(F-=65536,B.push(F>>>10&1023|55296),F=56320|F&1023),B.push(F),N+=re}return H(B)}const U=4096;function H(D){const A=D.length;if(A<=U)return String.fromCharCode.apply(String,D);let k="",B=0;for(;B<A;)k+=String.fromCharCode.apply(String,D.slice(B,B+=U));return k}function G(D,A,k){let B="";k=Math.min(D.length,k);for(let N=A;N<k;++N)B+=String.fromCharCode(D[N]&127);return B}function $(D,A,k){let B="";k=Math.min(D.length,k);for(let N=A;N<k;++N)B+=String.fromCharCode(D[N]);return B}function z(D,A,k){const B=D.length;(!A||A<0)&&(A=0),(!k||k<0||k>B)&&(k=B);let N="";for(let R=A;R<k;++R)N+=z7[D[R]];return N}function W(D,A,k){const B=D.slice(A,k);let N="";for(let R=0;R<B.length-1;R+=2)N+=String.fromCharCode(B[R]+B[R+1]*256);return N}a.prototype.slice=function(A,k){const B=this.length;A=~~A,k=k===void 0?B:~~k,A<0?(A+=B,A<0&&(A=0)):A>B&&(A=B),k<0?(k+=B,k<0&&(k=0)):k>B&&(k=B),k<A&&(k=A);const N=this.subarray(A,k);return Object.setPrototypeOf(N,a.prototype),N};function ee(D,A,k){if(D%1!==0||D<0)throw new RangeError("offset is not uint");if(D+A>k)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(A,k,B){A=A>>>0,k=k>>>0,B||ee(A,k,this.length);let N=this[A],R=1,F=0;for(;++F<k&&(R*=256);)N+=this[A+F]*R;return N},a.prototype.readUintBE=a.prototype.readUIntBE=function(A,k,B){A=A>>>0,k=k>>>0,B||ee(A,k,this.length);let N=this[A+--k],R=1;for(;k>0&&(R*=256);)N+=this[A+--k]*R;return N},a.prototype.readUint8=a.prototype.readUInt8=function(A,k){return A=A>>>0,k||ee(A,1,this.length),this[A]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(A,k){return A=A>>>0,k||ee(A,2,this.length),this[A]|this[A+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(A,k){return A=A>>>0,k||ee(A,2,this.length),this[A]<<8|this[A+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(A,k){return A=A>>>0,k||ee(A,4,this.length),(this[A]|this[A+1]<<8|this[A+2]<<16)+this[A+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(A,k){return A=A>>>0,k||ee(A,4,this.length),this[A]*16777216+(this[A+1]<<16|this[A+2]<<8|this[A+3])},a.prototype.readBigUInt64LE=Bo(function(A){A=A>>>0,at(A,"offset");const k=this[A],B=this[A+7];(k===void 0||B===void 0)&&Ut(A,this.length-8);const N=k+this[++A]*2**8+this[++A]*2**16+this[++A]*2**24,R=this[++A]+this[++A]*2**8+this[++A]*2**16+B*2**24;return BigInt(N)+(BigInt(R)<<BigInt(32))}),a.prototype.readBigUInt64BE=Bo(function(A){A=A>>>0,at(A,"offset");const k=this[A],B=this[A+7];(k===void 0||B===void 0)&&Ut(A,this.length-8);const N=k*2**24+this[++A]*2**16+this[++A]*2**8+this[++A],R=this[++A]*2**24+this[++A]*2**16+this[++A]*2**8+B;return(BigInt(N)<<BigInt(32))+BigInt(R)}),a.prototype.readIntLE=function(A,k,B){A=A>>>0,k=k>>>0,B||ee(A,k,this.length);let N=this[A],R=1,F=0;for(;++F<k&&(R*=256);)N+=this[A+F]*R;return R*=128,N>=R&&(N-=Math.pow(2,8*k)),N},a.prototype.readIntBE=function(A,k,B){A=A>>>0,k=k>>>0,B||ee(A,k,this.length);let N=k,R=1,F=this[A+--N];for(;N>0&&(R*=256);)F+=this[A+--N]*R;return R*=128,F>=R&&(F-=Math.pow(2,8*k)),F},a.prototype.readInt8=function(A,k){return A=A>>>0,k||ee(A,1,this.length),this[A]&128?(255-this[A]+1)*-1:this[A]},a.prototype.readInt16LE=function(A,k){A=A>>>0,k||ee(A,2,this.length);const B=this[A]|this[A+1]<<8;return B&32768?B|4294901760:B},a.prototype.readInt16BE=function(A,k){A=A>>>0,k||ee(A,2,this.length);const B=this[A+1]|this[A]<<8;return B&32768?B|4294901760:B},a.prototype.readInt32LE=function(A,k){return A=A>>>0,k||ee(A,4,this.length),this[A]|this[A+1]<<8|this[A+2]<<16|this[A+3]<<24},a.prototype.readInt32BE=function(A,k){return A=A>>>0,k||ee(A,4,this.length),this[A]<<24|this[A+1]<<16|this[A+2]<<8|this[A+3]},a.prototype.readBigInt64LE=Bo(function(A){A=A>>>0,at(A,"offset");const k=this[A],B=this[A+7];(k===void 0||B===void 0)&&Ut(A,this.length-8);const N=this[A+4]+this[A+5]*2**8+this[A+6]*2**16+(B<<24);return(BigInt(N)<<BigInt(32))+BigInt(k+this[++A]*2**8+this[++A]*2**16+this[++A]*2**24)}),a.prototype.readBigInt64BE=Bo(function(A){A=A>>>0,at(A,"offset");const k=this[A],B=this[A+7];(k===void 0||B===void 0)&&Ut(A,this.length-8);const N=(k<<24)+this[++A]*2**16+this[++A]*2**8+this[++A];return(BigInt(N)<<BigInt(32))+BigInt(this[++A]*2**24+this[++A]*2**16+this[++A]*2**8+B)}),a.prototype.readFloatLE=function(A,k){return A=A>>>0,k||ee(A,4,this.length),t.read(this,A,!0,23,4)},a.prototype.readFloatBE=function(A,k){return A=A>>>0,k||ee(A,4,this.length),t.read(this,A,!1,23,4)},a.prototype.readDoubleLE=function(A,k){return A=A>>>0,k||ee(A,8,this.length),t.read(this,A,!0,52,8)},a.prototype.readDoubleBE=function(A,k){return A=A>>>0,k||ee(A,8,this.length),t.read(this,A,!1,52,8)};function J(D,A,k,B,N,R){if(!a.isBuffer(D))throw new TypeError('"buffer" argument must be a Buffer instance');if(A>N||A<R)throw new RangeError('"value" argument is out of bounds');if(k+B>D.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(A,k,B,N){if(A=+A,k=k>>>0,B=B>>>0,!N){const re=Math.pow(2,8*B)-1;J(this,A,k,B,re,0)}let R=1,F=0;for(this[k]=A&255;++F<B&&(R*=256);)this[k+F]=A/R&255;return k+B},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(A,k,B,N){if(A=+A,k=k>>>0,B=B>>>0,!N){const re=Math.pow(2,8*B)-1;J(this,A,k,B,re,0)}let R=B-1,F=1;for(this[k+R]=A&255;--R>=0&&(F*=256);)this[k+R]=A/F&255;return k+B},a.prototype.writeUint8=a.prototype.writeUInt8=function(A,k,B){return A=+A,k=k>>>0,B||J(this,A,k,1,255,0),this[k]=A&255,k+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(A,k,B){return A=+A,k=k>>>0,B||J(this,A,k,2,65535,0),this[k]=A&255,this[k+1]=A>>>8,k+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(A,k,B){return A=+A,k=k>>>0,B||J(this,A,k,2,65535,0),this[k]=A>>>8,this[k+1]=A&255,k+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(A,k,B){return A=+A,k=k>>>0,B||J(this,A,k,4,4294967295,0),this[k+3]=A>>>24,this[k+2]=A>>>16,this[k+1]=A>>>8,this[k]=A&255,k+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(A,k,B){return A=+A,k=k>>>0,B||J(this,A,k,4,4294967295,0),this[k]=A>>>24,this[k+1]=A>>>16,this[k+2]=A>>>8,this[k+3]=A&255,k+4};function le(D,A,k,B,N){bt(A,B,N,D,k,7);let R=Number(A&BigInt(4294967295));D[k++]=R,R=R>>8,D[k++]=R,R=R>>8,D[k++]=R,R=R>>8,D[k++]=R;let F=Number(A>>BigInt(32)&BigInt(4294967295));return D[k++]=F,F=F>>8,D[k++]=F,F=F>>8,D[k++]=F,F=F>>8,D[k++]=F,k}function ye(D,A,k,B,N){bt(A,B,N,D,k,7);let R=Number(A&BigInt(4294967295));D[k+7]=R,R=R>>8,D[k+6]=R,R=R>>8,D[k+5]=R,R=R>>8,D[k+4]=R;let F=Number(A>>BigInt(32)&BigInt(4294967295));return D[k+3]=F,F=F>>8,D[k+2]=F,F=F>>8,D[k+1]=F,F=F>>8,D[k]=F,k+8}a.prototype.writeBigUInt64LE=Bo(function(A,k=0){return le(this,A,k,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=Bo(function(A,k=0){return ye(this,A,k,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(A,k,B,N){if(A=+A,k=k>>>0,!N){const we=Math.pow(2,8*B-1);J(this,A,k,B,we-1,-we)}let R=0,F=1,re=0;for(this[k]=A&255;++R<B&&(F*=256);)A<0&&re===0&&this[k+R-1]!==0&&(re=1),this[k+R]=(A/F>>0)-re&255;return k+B},a.prototype.writeIntBE=function(A,k,B,N){if(A=+A,k=k>>>0,!N){const we=Math.pow(2,8*B-1);J(this,A,k,B,we-1,-we)}let R=B-1,F=1,re=0;for(this[k+R]=A&255;--R>=0&&(F*=256);)A<0&&re===0&&this[k+R+1]!==0&&(re=1),this[k+R]=(A/F>>0)-re&255;return k+B},a.prototype.writeInt8=function(A,k,B){return A=+A,k=k>>>0,B||J(this,A,k,1,127,-128),A<0&&(A=255+A+1),this[k]=A&255,k+1},a.prototype.writeInt16LE=function(A,k,B){return A=+A,k=k>>>0,B||J(this,A,k,2,32767,-32768),this[k]=A&255,this[k+1]=A>>>8,k+2},a.prototype.writeInt16BE=function(A,k,B){return A=+A,k=k>>>0,B||J(this,A,k,2,32767,-32768),this[k]=A>>>8,this[k+1]=A&255,k+2},a.prototype.writeInt32LE=function(A,k,B){return A=+A,k=k>>>0,B||J(this,A,k,4,2147483647,-2147483648),this[k]=A&255,this[k+1]=A>>>8,this[k+2]=A>>>16,this[k+3]=A>>>24,k+4},a.prototype.writeInt32BE=function(A,k,B){return A=+A,k=k>>>0,B||J(this,A,k,4,2147483647,-2147483648),A<0&&(A=4294967295+A+1),this[k]=A>>>24,this[k+1]=A>>>16,this[k+2]=A>>>8,this[k+3]=A&255,k+4},a.prototype.writeBigInt64LE=Bo(function(A,k=0){return le(this,A,k,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=Bo(function(A,k=0){return ye(this,A,k,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function de(D,A,k,B,N,R){if(k+B>D.length)throw new RangeError("Index out of range");if(k<0)throw new RangeError("Index out of range")}function fe(D,A,k,B,N){return A=+A,k=k>>>0,N||de(D,A,k,4),t.write(D,A,k,B,23,4),k+4}a.prototype.writeFloatLE=function(A,k,B){return fe(this,A,k,!0,B)},a.prototype.writeFloatBE=function(A,k,B){return fe(this,A,k,!1,B)};function De(D,A,k,B,N){return A=+A,k=k>>>0,N||de(D,A,k,8),t.write(D,A,k,B,52,8),k+8}a.prototype.writeDoubleLE=function(A,k,B){return De(this,A,k,!0,B)},a.prototype.writeDoubleBE=function(A,k,B){return De(this,A,k,!1,B)},a.prototype.copy=function(A,k,B,N){if(!a.isBuffer(A))throw new TypeError("argument should be a Buffer");if(B||(B=0),!N&&N!==0&&(N=this.length),k>=A.length&&(k=A.length),k||(k=0),N>0&&N<B&&(N=B),N===B||A.length===0||this.length===0)return 0;if(k<0)throw new RangeError("targetStart out of bounds");if(B<0||B>=this.length)throw new RangeError("Index out of range");if(N<0)throw new RangeError("sourceEnd out of bounds");N>this.length&&(N=this.length),A.length-k<N-B&&(N=A.length-k+B);const R=N-B;return this===A&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(k,B,N):Uint8Array.prototype.set.call(A,this.subarray(B,N),k),R},a.prototype.fill=function(A,k,B,N){if(typeof A=="string"){if(typeof k=="string"?(N=k,k=0,B=this.length):typeof B=="string"&&(N=B,B=this.length),N!==void 0&&typeof N!="string")throw new TypeError("encoding must be a string");if(typeof N=="string"&&!a.isEncoding(N))throw new TypeError("Unknown encoding: "+N);if(A.length===1){const F=A.charCodeAt(0);(N==="utf8"&&F<128||N==="latin1")&&(A=F)}}else typeof A=="number"?A=A&255:typeof A=="boolean"&&(A=Number(A));if(k<0||this.length<k||this.length<B)throw new RangeError("Out of range index");if(B<=k)return this;k=k>>>0,B=B===void 0?this.length:B>>>0,A||(A=0);let R;if(typeof A=="number")for(R=k;R<B;++R)this[R]=A;else{const F=a.isBuffer(A)?A:a.from(A,N),re=F.length;if(re===0)throw new TypeError('The value "'+A+'" is invalid for argument "value"');for(R=0;R<B-k;++R)this[R+k]=F[R%re]}return this};const $e={};function qe(D,A,k){$e[D]=class extends k{constructor(){super(),Object.defineProperty(this,"message",{value:A.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${D}]`,this.stack,delete this.name}get code(){return D}set code(N){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:N,writable:!0})}toString(){return`${this.name} [${D}]: ${this.message}`}}}qe("ERR_BUFFER_OUT_OF_BOUNDS",function(D){return D?`${D} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),qe("ERR_INVALID_ARG_TYPE",function(D,A){return`The "${D}" argument must be of type number. Received type ${typeof A}`},TypeError),qe("ERR_OUT_OF_RANGE",function(D,A,k){let B=`The value of "${D}" is out of range.`,N=k;return Number.isInteger(k)&&Math.abs(k)>2**32?N=et(String(k)):typeof k=="bigint"&&(N=String(k),(k>BigInt(2)**BigInt(32)||k<-(BigInt(2)**BigInt(32)))&&(N=et(N)),N+="n"),B+=` It must be ${A}. Received ${N}`,B},RangeError);function et(D){let A="",k=D.length;const B=D[0]==="-"?1:0;for(;k>=B+4;k-=3)A=`_${D.slice(k-3,k)}${A}`;return`${D.slice(0,k)}${A}`}function Nt(D,A,k){at(A,"offset"),(D[A]===void 0||D[A+k]===void 0)&&Ut(A,D.length-(k+1))}function bt(D,A,k,B,N,R){if(D>k||D<A){const F=typeof A=="bigint"?"n":"";let re;throw A===0||A===BigInt(0)?re=`>= 0${F} and < 2${F} ** ${(R+1)*8}${F}`:re=`>= -(2${F} ** ${(R+1)*8-1}${F}) and < 2 ** ${(R+1)*8-1}${F}`,new $e.ERR_OUT_OF_RANGE("value",re,D)}Nt(B,N,R)}function at(D,A){if(typeof D!="number")throw new $e.ERR_INVALID_ARG_TYPE(A,"number",D)}function Ut(D,A,k){throw Math.floor(D)!==D?(at(D,k),new $e.ERR_OUT_OF_RANGE("offset","an integer",D)):A<0?new $e.ERR_BUFFER_OUT_OF_BOUNDS:new $e.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${A}`,D)}const kr=/[^+/0-9A-Za-z-_]/g;function Ro(D){if(D=D.split("=")[0],D=D.trim().replace(kr,""),D.length<2)return"";for(;D.length%4!==0;)D=D+"=";return D}function nl(D,A){A=A||1/0;let k;const B=D.length;let N=null;const R=[];for(let F=0;F<B;++F){if(k=D.charCodeAt(F),k>55295&&k<57344){if(!N){if(k>56319){(A-=3)>-1&&R.push(239,191,189);continue}else if(F+1===B){(A-=3)>-1&&R.push(239,191,189);continue}N=k;continue}if(k<56320){(A-=3)>-1&&R.push(239,191,189),N=k;continue}k=(N-55296<<10|k-56320)+65536}else N&&(A-=3)>-1&&R.push(239,191,189);if(N=null,k<128){if((A-=1)<0)break;R.push(k)}else if(k<2048){if((A-=2)<0)break;R.push(k>>6|192,k&63|128)}else if(k<65536){if((A-=3)<0)break;R.push(k>>12|224,k>>6&63|128,k&63|128)}else if(k<1114112){if((A-=4)<0)break;R.push(k>>18|240,k>>12&63|128,k>>6&63|128,k&63|128)}else throw new Error("Invalid code point")}return R}function Df(D){const A=[];for(let k=0;k<D.length;++k)A.push(D.charCodeAt(k)&255);return A}function Of(D,A){let k,B,N;const R=[];for(let F=0;F<D.length&&!((A-=2)<0);++F)k=D.charCodeAt(F),B=k>>8,N=k%256,R.push(N),R.push(B);return R}function dh(D){return e.toByteArray(Ro(D))}function sl(D,A,k,B){let N;for(N=0;N<B&&!(N+k>=A.length||N>=D.length);++N)A[N+k]=D[N];return N}function li(D,A){return D instanceof A||D!=null&&D.constructor!=null&&D.constructor.name!=null&&D.constructor.name===A.name}function pg(D){return D!==D}const z7=function(){const D="0123456789abcdef",A=new Array(256);for(let k=0;k<16;++k){const B=k*16;for(let N=0;N<16;++N)A[B+N]=D[k]+D[N]}return A}();function Bo(D){return typeof BigInt>"u"?fh:D}function fh(){throw new Error("BigInt not supported")}})(P5);let E9=null;var lj=function(){return E9===null&&(E9={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),E9},Pm={},$T={};const x9=Aa,jce=new Set(["buffer","view","utf8"]);let qce=class{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!jce.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new x9(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new x9(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new x9(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};$T.Encoding=qce;const{Buffer:LT}=P5||{},{Encoding:UT}=$T,Wce=lj;let FT=class extends UT{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new zT({encode:this.encode,decode:e=>this.decode(LT.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},zT=class extends UT{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new FT({encode:e=>{const t=this.encode(e);return LT.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},Qce=class extends UT{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new FT({encode:e=>LT.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){const{textEncoder:e,textDecoder:t}=Wce();return new zT({encode:n=>e.encode(this.encode(n)),decode:n=>this.decode(t.decode(n)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};Pm.BufferFormat=FT;Pm.ViewFormat=zT;Pm.UTF8Format=Qce;const{Buffer:Pn}=P5||{Buffer:{isBuffer:()=>!1}},{textEncoder:uj,textDecoder:OO}=lj(),{BufferFormat:Nm,ViewFormat:VT,UTF8Format:hj}=Pm,w8=r=>r;Cf.utf8=new hj({encode:function(r){return Pn.isBuffer(r)?r.toString("utf8"):ArrayBuffer.isView(r)?OO.decode(r):String(r)},decode:w8,name:"utf8",createViewTranscoder(){return new VT({encode:function(r){return ArrayBuffer.isView(r)?r:uj.encode(r)},decode:function(r){return OO.decode(r)},name:`${this.name}+view`})},createBufferTranscoder(){return new Nm({encode:function(r){return Pn.isBuffer(r)?r:ArrayBuffer.isView(r)?Pn.from(r.buffer,r.byteOffset,r.byteLength):Pn.from(String(r),"utf8")},decode:function(r){return r.toString("utf8")},name:`${this.name}+buffer`})}});Cf.json=new hj({encode:JSON.stringify,decode:JSON.parse,name:"json"});Cf.buffer=new Nm({encode:function(r){return Pn.isBuffer(r)?r:ArrayBuffer.isView(r)?Pn.from(r.buffer,r.byteOffset,r.byteLength):Pn.from(String(r),"utf8")},decode:w8,name:"buffer",createViewTranscoder(){return new VT({encode:function(r){return ArrayBuffer.isView(r)?r:Pn.from(String(r),"utf8")},decode:function(r){return Pn.from(r.buffer,r.byteOffset,r.byteLength)},name:`${this.name}+view`})}});Cf.view=new VT({encode:function(r){return ArrayBuffer.isView(r)?r:uj.encode(r)},decode:w8,name:"view",createBufferTranscoder(){return new Nm({encode:function(r){return Pn.isBuffer(r)?r:ArrayBuffer.isView(r)?Pn.from(r.buffer,r.byteOffset,r.byteLength):Pn.from(String(r),"utf8")},decode:w8,name:`${this.name}+buffer`})}});Cf.hex=new Nm({encode:function(r){return Pn.isBuffer(r)?r:Pn.from(String(r),"hex")},decode:function(r){return r.toString("hex")},name:"hex"});Cf.base64=new Nm({encode:function(r){return Pn.isBuffer(r)?r:Pn.from(String(r),"base64")},decode:function(r){return r.toString("base64")},name:"base64"});const RO=Aa,b8=Cf,{Encoding:Jce}=$T,{BufferFormat:Yce,ViewFormat:Xce,UTF8Format:Zce}=Pm,Cg=Symbol("formats"),Bw=Symbol("encodings"),ele=new Set(["buffer","view","utf8"]);let tle=class{constructor(e){if(Array.isArray(e)){if(!e.every(t=>ele.has(t)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[Bw]=new Map,this[Cg]=new Set(e);for(const t in b8)try{this.encoding(t)}catch(n){if(n.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw n}}encodings(){return Array.from(new Set(this[Bw].values()))}encoding(e){let t=this[Bw].get(e);if(t===void 0){if(typeof e=="string"&&e!==""){if(t=ile[e],!t)throw new RO(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof e!="object"||e===null)throw new TypeError("First argument 'encoding' must be a string or object");t=rle(e)}const{name:n,format:s}=t;if(!this[Cg].has(s))if(this[Cg].has("view"))t=t.createViewTranscoder();else if(this[Cg].has("buffer"))t=t.createBufferTranscoder();else if(this[Cg].has("utf8"))t=t.createUTF8Transcoder();else throw new RO(`Encoding '${n}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(const i of[e,n,t.name,t.commonName])this[Bw].set(i,t)}return t}};aj.Transcoder=tle;function rle(r){if(r instanceof Jce)return r;const e="type"in r&&typeof r.type=="string"?r.type:void 0,t=r.name||e||`anonymous-${ole++}`;switch(nle(r)){case"view":return new Xce({...r,name:t});case"utf8":return new Zce({...r,name:t});case"buffer":return new Yce({...r,name:t});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function nle(r){return"format"in r&&r.format!==void 0?r.format:"buffer"in r&&typeof r.buffer=="boolean"?r.buffer?"buffer":"utf8":"code"in r&&Number.isInteger(r.code)?"view":"buffer"}const sle={binary:b8.buffer,"utf-8":b8.utf8},ile={...b8,...sle};let ole=0;var W1={},ale=typeof queueMicrotask=="function"?queueMicrotask:r=>Promise.resolve().then(r),BO=ale;W1.fromCallback=function(r,e){if(r===void 0){var t=new Promise(function(n,s){r=function(i,o){i?s(i):n(o)}});r[e!==void 0?e:"promise"]=t}else if(typeof r!="function")throw new TypeError("Callback must be a function");return r};W1.fromPromise=function(r,e){if(e===void 0)return r;r.then(function(t){BO(()=>e(null,t))}).catch(function(t){BO(()=>e(t))})};var Sa={},Dm={};Dm.getCallback=function(r,e){return typeof r=="function"?r:e};Dm.getOptions=function(r,e){return typeof r=="object"&&r!==null?r:e!==void 0?e:{}};const{fromCallback:A9}=W1,Fs=Aa,{getOptions:S9,getCallback:MO}=Dm,ph=Symbol("promise"),Mf=Symbol("callback"),$o=Symbol("working"),Hh=Symbol("handleOne"),ja=Symbol("handleMany"),C9=Symbol("autoClose"),$u=Symbol("finishWork"),fa=Symbol("returnMany"),al=Symbol("closing"),Ig=Symbol("handleClose"),Mw=Symbol("closed"),kg=Symbol("closeCallbacks"),Iu=Symbol("keyEncoding"),zd=Symbol("valueEncoding"),I9=Symbol("abortOnClose"),$w=Symbol("legacy"),k9=Symbol("keys"),T9=Symbol("values"),cl=Symbol("limit"),Ti=Symbol("count"),Lw=Object.freeze({}),cle=()=>{};let $O=!1;class HT{constructor(e,t,n){if(typeof e!="object"||e===null){const s=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${s}`)}if(typeof t!="object"||t===null)throw new TypeError("The second argument must be an options object");this[Mw]=!1,this[kg]=[],this[$o]=!1,this[al]=!1,this[C9]=!1,this[Mf]=null,this[Hh]=this[Hh].bind(this),this[ja]=this[ja].bind(this),this[Ig]=this[Ig].bind(this),this[Iu]=t[Iu],this[zd]=t[zd],this[$w]=n,this[cl]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[Ti]=0,this[I9]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[Ti]}get limit(){return this[cl]}next(e){let t;if(e===void 0)t=new Promise((n,s)=>{e=(i,o,a)=>{i?s(i):this[$w]?o===void 0&&a===void 0?n():n([o,a]):n(o)}});else if(typeof e!="function")throw new TypeError("Callback must be a function");return this[al]?this.nextTick(e,new Fs("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[$o]?this.nextTick(e,new Fs("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[$o]=!0,this[Mf]=e,this[Ti]>=this[cl]?this.nextTick(this[Hh],null):this._next(this[Hh])),t}_next(e){this.nextTick(e)}nextv(e,t,n){return n=MO(t,n),n=A9(n,ph),t=S9(t,Lw),Number.isInteger(e)?(this[al]?this.nextTick(n,new Fs("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[$o]?this.nextTick(n,new Fs("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[cl]<1/0&&(e=Math.min(e,this[cl]-this[Ti])),this[$o]=!0,this[Mf]=n,e<=0?this.nextTick(this[ja],null,[]):this._nextv(e,t,this[ja])),n[ph]):(this.nextTick(n,new TypeError("The first argument 'size' must be an integer")),n[ph])}_nextv(e,t,n){const s=[],i=(o,a,c)=>{if(o)return n(o);if(this[$w]?a===void 0&&c===void 0:a===void 0)return n(null,s);s.push(this[$w]?[a,c]:a),s.length===e?n(null,s):this._next(i)};this._next(i)}all(e,t){return t=MO(e,t),t=A9(t,ph),e=S9(e,Lw),this[al]?this.nextTick(t,new Fs("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[$o]?this.nextTick(t,new Fs("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[$o]=!0,this[Mf]=t,this[C9]=!0,this[Ti]>=this[cl]?this.nextTick(this[ja],null,[]):this._all(e,this[ja])),t[ph]}_all(e,t){let n=this[Ti];const s=[],i=()=>{const a=this[cl]<1/0?Math.min(1e3,this[cl]-n):1e3;a<=0?this.nextTick(t,null,s):this._nextv(a,Lw,o)},o=(a,c)=>{a?t(a):c.length===0?t(null,s):(s.push.apply(s,c),n+=c.length,i())};i()}[$u](){const e=this[Mf];return this[I9]&&e===null?cle:(this[$o]=!1,this[Mf]=null,this[al]&&this._close(this[Ig]),e)}[fa](e,t,n){this[C9]?this.close(e.bind(null,t,n)):e(t,n)}seek(e,t){if(t=S9(t,Lw),!this[al]){if(this[$o])throw new Fs("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const n=this.db.keyEncoding(t.keyEncoding||this[Iu]),s=n.format;t.keyEncoding!==s&&(t={...t,keyEncoding:s});const i=this.db.prefixKey(n.encode(e),s);this._seek(i,t)}}}_seek(e,t){throw new Fs("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){return e=A9(e,ph),this[Mw]?this.nextTick(e):this[al]?this[kg].push(e):(this[al]=!0,this[kg].push(e),this[$o]?this[I9]&&this[$u]()(new Fs("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[Ig])),e[ph]}_close(e){this.nextTick(e)}[Ig](){this[Mw]=!0,this.db.detachResource(this);const e=this[kg];this[kg]=[];for(const t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;(e=await this.next())!==void 0;)yield e}finally{this[Mw]||await this.close()}}}let D5=class extends HT{constructor(e,t){super(e,t,!0),this[k9]=t.keys!==!1,this[T9]=t.values!==!1}[Hh](e,t,n){const s=this[$u]();if(e)return s(e);try{t=this[k9]&&t!==void 0?this[Iu].decode(t):void 0,n=this[T9]&&n!==void 0?this[zd].decode(n):void 0}catch(i){return s(new Q0("entry",i))}t===void 0&&n===void 0||this[Ti]++,s(null,t,n)}[ja](e,t){const n=this[$u]();if(e)return this[fa](n,e);try{for(const s of t){const i=s[0],o=s[1];s[0]=this[k9]&&i!==void 0?this[Iu].decode(i):void 0,s[1]=this[T9]&&o!==void 0?this[zd].decode(o):void 0}}catch(s){return this[fa](n,new Q0("entries",s))}this[Ti]+=t.length,this[fa](n,null,t)}end(e){return!$O&&typeof console<"u"&&($O=!0,console.warn(new Fs("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}},lle=class extends HT{constructor(e,t){super(e,t,!1)}[Hh](e,t){const n=this[$u]();if(e)return n(e);try{t=t!==void 0?this[Iu].decode(t):void 0}catch(s){return n(new Q0("key",s))}t!==void 0&&this[Ti]++,n(null,t)}[ja](e,t){const n=this[$u]();if(e)return this[fa](n,e);try{for(let s=0;s<t.length;s++){const i=t[s];t[s]=i!==void 0?this[Iu].decode(i):void 0}}catch(s){return this[fa](n,new Q0("keys",s))}this[Ti]+=t.length,this[fa](n,null,t)}},ule=class extends HT{constructor(e,t){super(e,t,!1)}[Hh](e,t){const n=this[$u]();if(e)return n(e);try{t=t!==void 0?this[zd].decode(t):void 0}catch(s){return n(new Q0("value",s))}t!==void 0&&this[Ti]++,n(null,t)}[ja](e,t){const n=this[$u]();if(e)return this[fa](n,e);try{for(let s=0;s<t.length;s++){const i=t[s];t[s]=i!==void 0?this[zd].decode(i):void 0}}catch(s){return this[fa](n,new Q0("values",s))}this[Ti]+=t.length,this[fa](n,null,t)}};class Q0 extends Fs{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}}for(const r of["_ended property","_nexting property","_end method"])Object.defineProperty(D5.prototype,r.split(" ")[0],{get(){throw new Fs(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new Fs(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})}});D5.keyEncoding=Iu;D5.valueEncoding=zd;Sa.AbstractIterator=D5;Sa.AbstractKeyIterator=lle;Sa.AbstractValueIterator=ule;var KT={};const{AbstractKeyIterator:hle,AbstractValueIterator:dle}=Sa,_h=Symbol("iterator"),Tg=Symbol("callback"),J0=Symbol("handleOne"),Cd=Symbol("handleMany");let CA=class extends hle{constructor(e,t){super(e,t),this[_h]=e.iterator({...t,keys:!0,values:!1}),this[J0]=this[J0].bind(this),this[Cd]=this[Cd].bind(this)}},dj=class extends dle{constructor(e,t){super(e,t),this[_h]=e.iterator({...t,keys:!1,values:!0}),this[J0]=this[J0].bind(this),this[Cd]=this[Cd].bind(this)}};for(const r of[CA,dj]){const e=r===CA,t=e?n=>n[0]:n=>n[1];r.prototype._next=function(n){this[Tg]=n,this[_h].next(this[J0])},r.prototype[J0]=function(n,s,i){const o=this[Tg];n?o(n):o(null,e?s:i)},r.prototype._nextv=function(n,s,i){this[Tg]=i,this[_h].nextv(n,s,this[Cd])},r.prototype._all=function(n,s){this[Tg]=s,this[_h].all(n,this[Cd])},r.prototype[Cd]=function(n,s){const i=this[Tg];n?i(n):i(null,s.map(t))},r.prototype._seek=function(n,s){this[_h].seek(n,s)},r.prototype._close=function(n){this[_h].close(n)}}KT.DefaultKeyIterator=CA;KT.DefaultValueIterator=dj;var O5={};const{AbstractIterator:fle,AbstractKeyIterator:ple,AbstractValueIterator:gle}=Sa,_9=Aa,ns=Symbol("nut"),R5=Symbol("undefer"),B5=Symbol("factory");let fj=class extends fle{constructor(e,t){super(e,t),this[ns]=null,this[B5]=()=>e.iterator(t),this.db.defer(()=>this[R5]())}},pj=class extends ple{constructor(e,t){super(e,t),this[ns]=null,this[B5]=()=>e.keys(t),this.db.defer(()=>this[R5]())}},gj=class extends gle{constructor(e,t){super(e,t),this[ns]=null,this[B5]=()=>e.values(t),this.db.defer(()=>this[R5]())}};for(const r of[fj,pj,gj])r.prototype[R5]=function(){this.db.status==="open"&&(this[ns]=this[B5]())},r.prototype._next=function(e){this[ns]!==null?this[ns].next(e):this.db.status==="opening"?this.db.defer(()=>this._next(e)):this.nextTick(e,new _9("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._nextv=function(e,t,n){this[ns]!==null?this[ns].nextv(e,t,n):this.db.status==="opening"?this.db.defer(()=>this._nextv(e,t,n)):this.nextTick(n,new _9("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._all=function(e,t){this[ns]!==null?this[ns].all(t):this.db.status==="opening"?this.db.defer(()=>this._all(e,t)):this.nextTick(t,new _9("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._seek=function(e,t){this[ns]!==null?this[ns]._seek(e,t):this.db.status==="opening"&&this.db.defer(()=>this._seek(e,t))},r.prototype._close=function(e){this[ns]!==null?this[ns].close(e):this.db.status==="opening"?this.db.defer(()=>this._close(e)):this.nextTick(e)};O5.DeferredIterator=fj;O5.DeferredKeyIterator=pj;O5.DeferredValueIterator=gj;var yj={},GT={};const{fromCallback:LO}=W1,Uw=Aa,{getCallback:yle,getOptions:mle}=Dm,Fw=Symbol("promise"),ui=Symbol("status"),$f=Symbol("operations"),_g=Symbol("finishClose"),Lf=Symbol("closeCallbacks");let wle=class{constructor(e){if(typeof e!="object"||e===null){const t=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${t}`)}this[$f]=[],this[Lf]=[],this[ui]="open",this[_g]=this[_g].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[$f].length}put(e,t,n){if(this[ui]!=="open")throw new Uw("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const s=this.db._checkKey(e)||this.db._checkValue(t);if(s)throw s;const i=n&&n.sublevel!=null?n.sublevel:this.db,o=n,a=i.keyEncoding(n&&n.keyEncoding),c=i.valueEncoding(n&&n.valueEncoding),l=a.format;n={...n,keyEncoding:l,valueEncoding:c.format},i!==this.db&&(n.sublevel=null);const u=i.prefixKey(a.encode(e),l),d=c.encode(t);return this._put(u,d,n),this[$f].push({...o,type:"put",key:e,value:t}),this}_put(e,t,n){}del(e,t){if(this[ui]!=="open")throw new Uw("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const n=this.db._checkKey(e);if(n)throw n;const s=t&&t.sublevel!=null?t.sublevel:this.db,i=t,o=s.keyEncoding(t&&t.keyEncoding),a=o.format;return t={...t,keyEncoding:a},s!==this.db&&(t.sublevel=null),this._del(s.prefixKey(o.encode(e),a),t),this[$f].push({...i,type:"del",key:e}),this}_del(e,t){}clear(){if(this[ui]!=="open")throw new Uw("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[$f]=[],this}_clear(){}write(e,t){return t=yle(e,t),t=LO(t,Fw),e=mle(e),this[ui]!=="open"?this.nextTick(t,new Uw("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(t):(this[ui]="writing",this._write(e,n=>{this[ui]="closing",this[Lf].push(()=>t(n)),n||this.db.emit("batch",this[$f]),this._close(this[_g])})),t[Fw]}_write(e,t){}close(e){return e=LO(e,Fw),this[ui]==="closing"?this[Lf].push(e):this[ui]==="closed"?this.nextTick(e):(this[Lf].push(e),this[ui]!=="writing"&&(this[ui]="closing",this._close(this[_g]))),e[Fw]}_close(e){this.nextTick(e)}[_g](){this[ui]="closed",this.db.detachResource(this);const e=this[Lf];this[Lf]=[];for(const t of e)t()}};GT.AbstractChainedBatch=wle;const{AbstractChainedBatch:ble}=GT,vle=Aa,Uf=Symbol("encoded");let Ele=class extends ble{constructor(e){super(e),this[Uf]=[]}_put(e,t,n){this[Uf].push({...n,type:"put",key:e,value:t})}_del(e,t){this[Uf].push({...t,type:"del",key:e})}_clear(){this[Uf]=[]}_write(e,t){this.db.status==="opening"?this.db.defer(()=>this._write(e,t)):this.db.status==="open"?this[Uf].length===0?this.nextTick(t):this.db._batch(this[Uf],e,t):this.nextTick(t,new vle("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};yj.DefaultChainedBatch=Ele;const UO=Aa,xle=Object.prototype.hasOwnProperty,Ale=new Set(["lt","lte","gt","gte"]);var Sle=function(r,e){const t={};for(const n in r)if(xle.call(r,n)&&!(n==="keyEncoding"||n==="valueEncoding")){if(n==="start"||n==="end")throw new UO(`The legacy range option '${n}' has been removed`,{code:"LEVEL_LEGACY"});if(n==="encoding")throw new UO("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});Ale.has(n)?t[n]=e.encode(r[n]):t[n]=r[n]}return t.reverse=!!t.reverse,t.limit=Number.isInteger(t.limit)&&t.limit>=0?t.limit:-1,t};/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let FO;var mj=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:W2):r=>(FO||(FO=Promise.resolve())).then(r).catch(e=>setTimeout(()=>{throw e},0)),P9,zO;function Cle(){if(zO)return P9;zO=1;const r=mj;return P9=function(e,...t){t.length===0?r(e):r(()=>e(...t))},P9}var Pg={},VO;function Ile(){if(VO)return Pg;VO=1;const{AbstractIterator:r,AbstractKeyIterator:e,AbstractValueIterator:t}=Sa,n=Symbol("unfix"),s=Symbol("iterator"),i=Symbol("handleOne"),o=Symbol("handleMany"),a=Symbol("callback");class c extends r{constructor(p,y,f,g){super(p,y),this[s]=f,this[n]=g,this[i]=this[i].bind(this),this[o]=this[o].bind(this),this[a]=null}[i](p,y,f){const g=this[a];if(p)return g(p);y!==void 0&&(y=this[n](y)),g(p,y,f)}[o](p,y){const f=this[a];if(p)return f(p);for(const g of y){const w=g[0];w!==void 0&&(g[0]=this[n](w))}f(p,y)}}class l extends e{constructor(p,y,f,g){super(p,y),this[s]=f,this[n]=g,this[i]=this[i].bind(this),this[o]=this[o].bind(this),this[a]=null}[i](p,y){const f=this[a];if(p)return f(p);y!==void 0&&(y=this[n](y)),f(p,y)}[o](p,y){const f=this[a];if(p)return f(p);for(let g=0;g<y.length;g++){const w=y[g];w!==void 0&&(y[g]=this[n](w))}f(p,y)}}class u extends t{constructor(p,y,f){super(p,y),this[s]=f}}for(const d of[c,l])d.prototype._next=function(p){this[a]=p,this[s].next(this[i])},d.prototype._nextv=function(p,y,f){this[a]=f,this[s].nextv(p,y,this[o])},d.prototype._all=function(p,y){this[a]=y,this[s].all(p,this[o])};for(const d of[u])d.prototype._next=function(p){this[s].next(p)},d.prototype._nextv=function(p,y,f){this[s].nextv(p,y,f)},d.prototype._all=function(p,y){this[s].all(p,y)};for(const d of[c,l,u])d.prototype._seek=function(p,y){this[s].seek(p,y)},d.prototype._close=function(p){this[s].close(p)};return Pg.AbstractSublevelIterator=c,Pg.AbstractSublevelKeyIterator=l,Pg.AbstractSublevelValueIterator=u,Pg}var N9,HO;function kle(){if(HO)return N9;HO=1;const r=Aa,{Buffer:e}=P5||{},{AbstractSublevelIterator:t,AbstractSublevelKeyIterator:n,AbstractSublevelValueIterator:s}=Ile(),i=Symbol("prefix"),o=Symbol("upperBound"),a=Symbol("prefixRange"),c=Symbol("parent"),l=Symbol("unfix"),u=new TextEncoder,d={separator:"!"};N9=function({AbstractLevel:m}){class b extends m{static defaults(E){if(typeof E=="string")throw new r("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(E&&E.open)throw new r("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return E==null?d:E.separator?E:{...E,separator:"!"}}constructor(E,S,I){const{separator:x,manifest:C,...P}=b.defaults(I);S=w(S,x);const L=x.charCodeAt(0)+1,K=E[c]||E;if(!u.encode(S).every(Y=>Y>L&&Y<127))throw new r(`Prefix must use bytes > ${L} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(p(K,C),P);const V=(E.prefix||"")+x+S+x,Z=V.slice(0,-1)+String.fromCharCode(L);this[c]=K,this[i]=new f(V),this[o]=new f(Z),this[l]=new g,this.nextTick=K.nextTick}prefixKey(E,S){if(S==="utf8")return this[i].utf8+E;if(E.byteLength===0)return this[i][S];if(S==="view"){const I=this[i].view,x=new Uint8Array(I.byteLength+E.byteLength);return x.set(I,0),x.set(E,I.byteLength),x}else{const I=this[i].buffer;return e.concat([I,E],I.byteLength+E.byteLength)}}[a](E,S){E.gte!==void 0?E.gte=this.prefixKey(E.gte,S):E.gt!==void 0?E.gt=this.prefixKey(E.gt,S):E.gte=this[i][S],E.lte!==void 0?E.lte=this.prefixKey(E.lte,S):E.lt!==void 0?E.lt=this.prefixKey(E.lt,S):E.lte=this[o][S]}get prefix(){return this[i].utf8}get db(){return this[c]}_open(E,S){this[c].open({passive:!0},S)}_put(E,S,I,x){this[c].put(E,S,I,x)}_get(E,S,I){this[c].get(E,S,I)}_getMany(E,S,I){this[c].getMany(E,S,I)}_del(E,S,I){this[c].del(E,S,I)}_batch(E,S,I){this[c].batch(E,S,I)}_clear(E,S){this[a](E,E.keyEncoding),this[c].clear(E,S)}_iterator(E){this[a](E,E.keyEncoding);const S=this[c].iterator(E),I=this[l].get(this[i].utf8.length,E.keyEncoding);return new t(this,E,S,I)}_keys(E){this[a](E,E.keyEncoding);const S=this[c].keys(E),I=this[l].get(this[i].utf8.length,E.keyEncoding);return new n(this,E,S,I)}_values(E){this[a](E,E.keyEncoding);const S=this[c].values(E);return new s(this,E,S)}}return{AbstractSublevel:b}};const p=function(m,b){return{...m.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...b,encodings:{utf8:y(m,"utf8"),buffer:y(m,"buffer"),view:y(m,"view")}}},y=function(m,b){return m.supports.encodings[b]?m.keyEncoding(b).name===b:!1};class f{constructor(b){this.utf8=b,this.view=u.encode(b),this.buffer=e?e.from(this.view.buffer,0,this.view.byteLength):{}}}class g{constructor(){this.cache=new Map}get(b,v){let E=this.cache.get(v);return E===void 0&&(v==="view"?E=(function(S,I){return I.subarray(S)}).bind(null,b):E=(function(S,I){return I.slice(S)}).bind(null,b),this.cache.set(v,E)),E}}const w=function(m,b){let v=0,E=m.length;for(;v<E&&m[v]===b;)v++;for(;E>v&&m[E-1]===b;)E--;return m.slice(v,E)};return N9}const{supports:Tle}=oj,{Transcoder:_le}=aj,{EventEmitter:Ple}=w5,{fromCallback:ll}=W1,Xi=Aa,{AbstractIterator:gh}=Sa,{DefaultKeyIterator:Nle,DefaultValueIterator:Dle}=KT,{DeferredIterator:Ole,DeferredKeyIterator:Rle,DeferredValueIterator:Ble}=O5,{DefaultChainedBatch:KO}=yj,{getCallback:yh,getOptions:ul}=Dm,zw=Sle,Qe=Symbol("promise"),_a=Symbol("landed"),mh=Symbol("resources"),D9=Symbol("closeResources"),Ng=Symbol("operations"),Dg=Symbol("undefer"),Vw=Symbol("deferOpen"),GO=Symbol("options"),tt=Symbol("status"),wh=Symbol("defaultOptions"),Ff=Symbol("transcoder"),Hw=Symbol("keyEncoding"),O9=Symbol("valueEncoding"),Mle=()=>{};let jT=class extends Ple{constructor(e,t){if(super(),typeof e!="object"||e===null)throw new TypeError("The first argument 'manifest' must be an object");t=ul(t);const{keyEncoding:n,valueEncoding:s,passive:i,...o}=t;this[mh]=new Set,this[Ng]=[],this[Vw]=!0,this[GO]=o,this[tt]="opening",this.supports=Tle(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:e.snapshots!==!1,permanence:e.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[Ff]=new _le($le(this)),this[Hw]=this[Ff].encoding(n||"utf8"),this[O9]=this[Ff].encoding(s||"utf8");for(const a of this[Ff].encodings())this.supports.encodings[a.commonName]||(this.supports.encodings[a.commonName]=!0);this[wh]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[Hw].commonName,valueEncoding:this[O9].commonName}),key:Object.freeze({keyEncoding:this[Hw].commonName})},this.nextTick(()=>{this[Vw]&&this.open({passive:!1},Mle)})}get status(){return this[tt]}keyEncoding(e){return this[Ff].encoding(e??this[Hw])}valueEncoding(e){return this[Ff].encoding(e??this[O9])}open(e,t){t=yh(e,t),t=ll(t,Qe),e={...this[GO],...ul(e)},e.createIfMissing=e.createIfMissing!==!1,e.errorIfExists=!!e.errorIfExists;const n=s=>{this[tt]==="closing"||this[tt]==="opening"?this.once(_a,s?()=>n(s):n):this[tt]!=="open"?t(new Xi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:s})):t()};return e.passive?this[tt]==="opening"?this.once(_a,n):this.nextTick(n):this[tt]==="closed"||this[Vw]?(this[Vw]=!1,this[tt]="opening",this.emit("opening"),this._open(e,s=>{if(s){this[tt]="closed",this[D9](()=>{this.emit(_a),n(s)}),this[Dg]();return}this[tt]="open",this[Dg](),this.emit(_a),this[tt]==="open"&&this.emit("open"),this[tt]==="open"&&this.emit("ready"),n()})):this[tt]==="open"?this.nextTick(n):this.once(_a,()=>this.open(e,t)),t[Qe]}_open(e,t){this.nextTick(t)}close(e){e=ll(e,Qe);const t=n=>{this[tt]==="opening"||this[tt]==="closing"?this.once(_a,n?t(n):t):this[tt]!=="closed"?e(new Xi("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:n})):e()};if(this[tt]==="open"){this[tt]="closing",this.emit("closing");const n=s=>{this[tt]="open",this[Dg](),this.emit(_a),t(s)};this[D9](()=>{this._close(s=>{if(s)return n(s);this[tt]="closed",this[Dg](),this.emit(_a),this[tt]==="closed"&&this.emit("closed"),t()})})}else this[tt]==="closed"?this.nextTick(t):this.once(_a,()=>this.close(e));return e[Qe]}[D9](e){if(this[mh].size===0)return this.nextTick(e);let t=this[mh].size,n=!0;const s=()=>{--t===0&&(n?this.nextTick(e):e())};for(const i of this[mh])i.close(s);n=!1,this[mh].clear()}_close(e){this.nextTick(e)}get(e,t,n){if(n=yh(t,n),n=ll(n,Qe),t=ul(t,this[wh].entry),this[tt]==="opening")return this.defer(()=>this.get(e,t,n)),n[Qe];if(zf(this,n))return n[Qe];const s=this._checkKey(e);if(s)return this.nextTick(n,s),n[Qe];const i=this.keyEncoding(t.keyEncoding),o=this.valueEncoding(t.valueEncoding),a=i.format,c=o.format;return(t.keyEncoding!==a||t.valueEncoding!==c)&&(t=Object.assign({},t,{keyEncoding:a,valueEncoding:c})),this._get(this.prefixKey(i.encode(e),a),t,(l,u)=>{if(l)return(l.code==="LEVEL_NOT_FOUND"||l.notFound||/NotFound/i.test(l))&&(l.code||(l.code="LEVEL_NOT_FOUND"),l.notFound||(l.notFound=!0),l.status||(l.status=404)),n(l);try{u=o.decode(u)}catch(d){return n(new Xi("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:d}))}n(null,u)}),n[Qe]}_get(e,t,n){this.nextTick(n,new Error("NotFound"))}getMany(e,t,n){if(n=yh(t,n),n=ll(n,Qe),t=ul(t,this[wh].entry),this[tt]==="opening")return this.defer(()=>this.getMany(e,t,n)),n[Qe];if(zf(this,n))return n[Qe];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'keys' must be an array")),n[Qe];if(e.length===0)return this.nextTick(n,null,[]),n[Qe];const s=this.keyEncoding(t.keyEncoding),i=this.valueEncoding(t.valueEncoding),o=s.format,a=i.format;(t.keyEncoding!==o||t.valueEncoding!==a)&&(t=Object.assign({},t,{keyEncoding:o,valueEncoding:a}));const c=new Array(e.length);for(let l=0;l<e.length;l++){const u=e[l],d=this._checkKey(u);if(d)return this.nextTick(n,d),n[Qe];c[l]=this.prefixKey(s.encode(u),o)}return this._getMany(c,t,(l,u)=>{if(l)return n(l);try{for(let d=0;d<u.length;d++)u[d]!==void 0&&(u[d]=i.decode(u[d]))}catch(d){return n(new Xi(`Could not decode one or more of ${u.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:d}))}n(null,u)}),n[Qe]}_getMany(e,t,n){this.nextTick(n,null,new Array(e.length).fill(void 0))}put(e,t,n,s){if(s=yh(n,s),s=ll(s,Qe),n=ul(n,this[wh].entry),this[tt]==="opening")return this.defer(()=>this.put(e,t,n,s)),s[Qe];if(zf(this,s))return s[Qe];const i=this._checkKey(e)||this._checkValue(t);if(i)return this.nextTick(s,i),s[Qe];const o=this.keyEncoding(n.keyEncoding),a=this.valueEncoding(n.valueEncoding),c=o.format,l=a.format;(n.keyEncoding!==c||n.valueEncoding!==l)&&(n=Object.assign({},n,{keyEncoding:c,valueEncoding:l}));const u=this.prefixKey(o.encode(e),c),d=a.encode(t);return this._put(u,d,n,p=>{if(p)return s(p);this.emit("put",e,t),s()}),s[Qe]}_put(e,t,n,s){this.nextTick(s)}del(e,t,n){if(n=yh(t,n),n=ll(n,Qe),t=ul(t,this[wh].key),this[tt]==="opening")return this.defer(()=>this.del(e,t,n)),n[Qe];if(zf(this,n))return n[Qe];const s=this._checkKey(e);if(s)return this.nextTick(n,s),n[Qe];const i=this.keyEncoding(t.keyEncoding),o=i.format;return t.keyEncoding!==o&&(t=Object.assign({},t,{keyEncoding:o})),this._del(this.prefixKey(i.encode(e),o),t,a=>{if(a)return n(a);this.emit("del",e),n()}),n[Qe]}_del(e,t,n){this.nextTick(n)}batch(e,t,n){if(!arguments.length){if(this[tt]==="opening")return new KO(this);if(this[tt]!=="open")throw new Xi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof e=="function"?n=e:n=yh(t,n),n=ll(n,Qe),t=ul(t,this[wh].empty),this[tt]==="opening")return this.defer(()=>this.batch(e,t,n)),n[Qe];if(zf(this,n))return n[Qe];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'operations' must be an array")),n[Qe];if(e.length===0)return this.nextTick(n),n[Qe];const s=new Array(e.length),{keyEncoding:i,valueEncoding:o,...a}=t;for(let c=0;c<e.length;c++){if(typeof e[c]!="object"||e[c]===null)return this.nextTick(n,new TypeError("A batch operation must be an object")),n[Qe];const l=Object.assign({},e[c]);if(l.type!=="put"&&l.type!=="del")return this.nextTick(n,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),n[Qe];const u=this._checkKey(l.key);if(u)return this.nextTick(n,u),n[Qe];const d=l.sublevel!=null?l.sublevel:this,p=d.keyEncoding(l.keyEncoding||i),y=p.format;if(l.key=d.prefixKey(p.encode(l.key),y),l.keyEncoding=y,l.type==="put"){const f=this._checkValue(l.value);if(f)return this.nextTick(n,f),n[Qe];const g=d.valueEncoding(l.valueEncoding||o);l.value=g.encode(l.value),l.valueEncoding=g.format}d!==this&&(l.sublevel=null),s[c]=l}return this._batch(s,a,c=>{if(c)return n(c);this.emit("batch",e),n()}),n[Qe]}_batch(e,t,n){this.nextTick(n)}sublevel(e,t){return this._sublevel(e,IA.defaults(t))}_sublevel(e,t){return new IA(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=yh(e,t),t=ll(t,Qe),e=ul(e,this[wh].empty),this[tt]==="opening")return this.defer(()=>this.clear(e,t)),t[Qe];if(zf(this,t))return t[Qe];const n=e,s=this.keyEncoding(e.keyEncoding);return e=zw(e,s),e.keyEncoding=s.format,e.limit===0?this.nextTick(t):this._clear(e,i=>{if(i)return t(i);this.emit("clear",n),t()}),t[Qe]}_clear(e,t){this.nextTick(t)}iterator(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=zw(e,t),e.keys=e.keys!==!1,e.values=e.values!==!1,e[gh.keyEncoding]=t,e[gh.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[tt]==="opening")return new Ole(this,e);if(this[tt]!=="open")throw new Xi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new gh(this,e)}keys(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=zw(e,t),e[gh.keyEncoding]=t,e[gh.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[tt]==="opening")return new Rle(this,e);if(this[tt]!=="open")throw new Xi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new Nle(this,e)}values(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=zw(e,t),e[gh.keyEncoding]=t,e[gh.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[tt]==="opening")return new Ble(this,e);if(this[tt]!=="open")throw new Xi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new Dle(this,e)}defer(e){if(typeof e!="function")throw new TypeError("The first argument must be a function");this[Ng].push(e)}[Dg](){if(this[Ng].length===0)return;const e=this[Ng];this[Ng]=[];for(const t of e)t()}attachResource(e){if(typeof e!="object"||e===null||typeof e.close!="function")throw new TypeError("The first argument must be a resource object");this[mh].add(e)}detachResource(e){this[mh].delete(e)}_chainedBatch(){return new KO(this)}_checkKey(e){if(e==null)return new Xi("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(e==null)return new Xi("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};jT.prototype.nextTick=Cle();const{AbstractSublevel:IA}=kle()({AbstractLevel:jT});_5.AbstractLevel=jT;_5.AbstractSublevel=IA;const zf=function(r,e){return r[tt]!=="open"?(r.nextTick(e,new Xi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},$le=function(r){return Object.keys(r.supports.encodings).filter(e=>!!r.supports.encodings[e])};nh.AbstractLevel=_5.AbstractLevel;nh.AbstractSublevel=_5.AbstractSublevel;nh.AbstractIterator=Sa.AbstractIterator;nh.AbstractKeyIterator=Sa.AbstractKeyIterator;nh.AbstractValueIterator=Sa.AbstractValueIterator;nh.AbstractChainedBatch=GT.AbstractChainedBatch;/*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var Lle=Fle;const Ule=mj;function Fle(r,e,t){if(typeof e!="number")throw new Error("second argument must be a Number");let n,s,i,o,a,c=!0,l;Array.isArray(r)?(n=[],i=s=r.length):(o=Object.keys(r),n={},i=s=o.length);function u(p){function y(){t&&t(p,n),t=null}c?Ule(y):y()}function d(p,y,f){if(n[p]=f,y&&(a=!0),--i===0||y)u(y);else if(!a&&l<s){let g;o?(g=o[l],l+=1,r[g](function(w,m){d(g,w,m)})):(g=l,l+=1,r[g](function(w,m){d(g,w,m)}))}}l=e,i?o?o.some(function(p,y){return r[p](function(f,g){d(p,f,g)}),y===e-1}):r.some(function(p,y){return p(function(f,g){d(y,f,g)}),y===e-1}):u(null),c=!1}var wj={},bj=function(e){const t=e.gte!==void 0?e.gte:e.gt!==void 0?e.gt:void 0,n=e.lte!==void 0?e.lte:e.lt!==void 0?e.lt:void 0,s=e.gte===void 0,i=e.lte===void 0;return t!==void 0&&n!==void 0?IDBKeyRange.bound(t,n,s,i):t!==void 0?IDBKeyRange.lowerBound(t,s):n!==void 0?IDBKeyRange.upperBound(n,i):null};const zle=new TextEncoder;var vj=function(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):zle.encode(r)};const{AbstractIterator:Vle}=nh,jO=bj,Kw=vj,Lo=Symbol("cache"),Pa=Symbol("finished"),Ns=Symbol("options"),Na=Symbol("currentOptions"),bh=Symbol("position"),R9=Symbol("location"),Vf=Symbol("first"),qO={};let Hle=class extends Vle{constructor(e,t,n){super(e,n),this[Lo]=[],this[Pa]=this.limit===0,this[Ns]=n,this[Na]={...n},this[bh]=void 0,this[R9]=t,this[Vf]=!0}_nextv(e,t,n){if(this[Vf]=!1,this[Pa])return this.nextTick(n,null,[]);if(this[Lo].length>0)return e=Math.min(e,this[Lo].length),this.nextTick(n,null,this[Lo].splice(0,e));this[bh]!==void 0&&(this[Ns].reverse?(this[Na].lt=this[bh],this[Na].lte=void 0):(this[Na].gt=this[bh],this[Na].gte=void 0));let s;try{s=jO(this[Na])}catch{return this[Pa]=!0,this.nextTick(n,null,[])}const i=this.db.db.transaction([this[R9]],"readonly"),o=i.objectStore(this[R9]),a=[];if(this[Ns].reverse){const c=!this[Ns].values&&o.openKeyCursor?"openKeyCursor":"openCursor";o[c](s,"prev").onsuccess=l=>{const u=l.target.result;if(u){const{key:d,value:p}=u;this[bh]=d,a.push([this[Ns].keys&&d!==void 0?Kw(d):void 0,this[Ns].values&&p!==void 0?Kw(p):void 0]),a.length<e?u.continue():WO(i)}else this[Pa]=!0}}else{let c,l;const u=()=>{if(c===void 0||l===void 0)return;const d=Math.max(c.length,l.length);d===0||e===1/0?this[Pa]=!0:this[bh]=c[d-1],a.length=d;for(let p=0;p<d;p++){const y=c[p],f=l[p];a[p]=[this[Ns].keys&&y!==void 0?Kw(y):void 0,this[Ns].values&&f!==void 0?Kw(f):void 0]}WO(i)};this[Ns].keys||e<1/0?o.getAllKeys(s,e<1/0?e:void 0).onsuccess=d=>{c=d.target.result,u()}:(c=[],this.nextTick(u)),this[Ns].values?o.getAll(s,e<1/0?e:void 0).onsuccess=d=>{l=d.target.result,u()}:(l=[],this.nextTick(u))}i.onabort=()=>{n(i.error||new Error("aborted by user")),n=null},i.oncomplete=()=>{n(null,a),n=null}}_next(e){if(this[Lo].length>0){const[t,n]=this[Lo].shift();this.nextTick(e,null,t,n)}else if(this[Pa])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[Vf]&&(this[Vf]=!1,t=1),this._nextv(t,qO,(n,s)=>{if(n)return e(n);this[Lo]=s,this._next(e)})}}_all(e,t){this[Vf]=!1;const n=this[Lo].splice(0,this[Lo].length),s=this.limit-this.count-n.length;if(s<=0)return this.nextTick(t,null,n);this._nextv(s,qO,(i,o)=>{if(i)return t(i);n.length>0&&(o=n.concat(o)),t(null,o)})}_seek(e,t){this[Vf]=!0,this[Lo]=[],this[Pa]=!1,this[bh]=void 0,this[Na]={...this[Ns]};let n;try{n=jO(this[Ns])}catch{this[Pa]=!0;return}n!==null&&!n.includes(e)?this[Pa]=!0:this[Ns].reverse?this[Na].lte=e:this[Na].gte=e}};wj.Iterator=Hle;function WO(r){typeof r.commit=="function"&&r.commit()}var Kle=function(e,t,n,s,i){if(s.limit===0)return e.nextTick(i);const o=e.db.transaction([t],"readwrite"),a=o.objectStore(t);let c=0;o.oncomplete=function(){i()},o.onabort=function(){i(o.error||new Error("aborted by user"))};const l=a.openKeyCursor?"openKeyCursor":"openCursor",u=s.reverse?"prev":"next";a[l](n,u).onsuccess=function(d){const p=d.target.result;p&&(a.delete(p.key).onsuccess=function(){(s.limit<=0||++c<s.limit)&&p.continue()})}};const{AbstractLevel:Gle}=nh,QO=Aa,jle=Lle,{fromCallback:qle}=W1,{Iterator:Wle}=wj,JO=vj,Qle=Kle,Jle=bj,Ej="level-js-",Og=Symbol("idb"),B9=Symbol("namePrefix"),Da=Symbol("location"),M9=Symbol("version"),vh=Symbol("store"),Rg=Symbol("onComplete"),YO=Symbol("promise");class xj extends Gle{constructor(e,t,n){if(typeof t=="function"||typeof n=="function")throw new QO("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:s,version:i,...o}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),typeof e!="string")throw new Error("constructor requires a location string argument");this[Da]=e,this[B9]=s??Ej,this[M9]=parseInt(i||1,10),this[Og]=null}get location(){return this[Da]}get namePrefix(){return this[B9]}get version(){return this[M9]}get db(){return this[Og]}get type(){return"browser-level"}_open(e,t){const n=indexedDB.open(this[B9]+this[Da],this[M9]);n.onerror=function(){t(n.error||new Error("unknown error"))},n.onsuccess=()=>{this[Og]=n.result,t()},n.onupgradeneeded=s=>{const i=s.target.result;i.objectStoreNames.contains(this[Da])||i.createObjectStore(this[Da])}}[vh](e){return this[Og].transaction([this[Da]],e).objectStore(this[Da])}[Rg](e,t){const n=e.transaction;n.onabort=function(){t(n.error||new Error("aborted by user"))},n.oncomplete=function(){t(null,e.result)}}_get(e,t,n){const s=this[vh]("readonly");let i;try{i=s.get(e)}catch(o){return this.nextTick(n,o)}this[Rg](i,function(o,a){if(o)return n(o);if(a===void 0)return n(new QO("Entry not found",{code:"LEVEL_NOT_FOUND"}));n(null,JO(a))})}_getMany(e,t,n){const s=this[vh]("readonly"),i=e.map(o=>a=>{let c;try{c=s.get(o)}catch(l){return a(l)}c.onsuccess=()=>{const l=c.result;a(null,l===void 0?l:JO(l))},c.onerror=l=>{l.stopPropagation(),a(c.error)}});jle(i,16,n)}_del(e,t,n){const s=this[vh]("readwrite");let i;try{i=s.delete(e)}catch(o){return this.nextTick(n,o)}this[Rg](i,n)}_put(e,t,n,s){const i=this[vh]("readwrite");let o;try{o=i.put(t,e)}catch(a){return this.nextTick(s,a)}this[Rg](o,s)}_iterator(e){return new Wle(this,this[Da],e)}_batch(e,t,n){const s=this[vh]("readwrite"),i=s.transaction;let o=0,a;i.onabort=function(){n(a||i.error||new Error("aborted by user"))},i.oncomplete=function(){n()};function c(){const l=e[o++],u=l.key;let d;try{d=l.type==="del"?s.delete(u):s.put(l.value,u)}catch(p){a=p,i.abort();return}o<e.length?d.onsuccess=c:typeof i.commit=="function"&&i.commit()}c()}_clear(e,t){let n,s;try{n=Jle(e)}catch{return this.nextTick(t)}if(e.limit>=0)return Qle(this,this[Da],n,e,t);try{const i=this[vh]("readwrite");s=n?i.delete(n):i.clear()}catch(i){return this.nextTick(t,i)}this[Rg](s,t)}_close(e){this[Og].close(),this.nextTick(e)}}xj.destroy=function(r,e,t){typeof e=="function"&&(t=e,e=Ej),t=qle(t,YO);const n=indexedDB.deleteDatabase(e+r);return n.onsuccess=function(){t()},n.onerror=function(s){t(s)},t[YO]};ij.BrowserLevel=xj;var Yle=ij.BrowserLevel;const Xle="./level",Zle="view",kA=async({path:r,valueEncoding:e}={})=>{r=r||Xle,e=e||Zle;const t=new Yle(r,{valueEncoding:e,passive:!0});return await t.open(),{put:async(u,d)=>{await t.put(u,d)},del:async u=>{await t.del(u)},get:async u=>{try{const d=await t.get(u);if(d)return d}catch{}},iterator:async function*({amount:u,reverse:d}={}){const p={limit:u||-1,reverse:d||!1};for await(const[y,f]of t.iterator(p))yield[y,f]},merge:async u=>{},clear:async()=>{await t.clear()},close:async()=>{await t.close()}}},XO=1e6,pa=async({size:r}={})=>{let e=new pA(r||XO);return{put:async(l,u)=>{e.set(l,u)},del:async l=>{e.remove(l)},get:async l=>e.get(l),iterator:async function*(){for await(const l of e.keys){const u=e.get(l);yield[l,u]}},merge:async l=>{if(l)for await(const[u,d]of l.iterator())e.set(u,d)},clear:async()=>{e=new pA(r||XO)},close:async()=>{}}},eue=16,$9=1e3,qT=async({ipfs:r,identity:e,address:t,name:n,access:s,directory:i,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:u,syncAutomatically:d,onUpdate:p})=>{i=Cu(i||"./orbitdb",`./${t}/`),o=o||{},u=Number(u)>-1?u:eue,c=c||await Sd(await pa({size:$9}),await T5({ipfs:r,pin:!0})),a=a||await Sd(await pa({size:$9}),await kA({path:Cu(i,"/log/_heads/")})),l=l||await Sd(await pa({size:$9}),await kA({path:Cu(i,"/log/_index/")}));const y=await Mce(e,{logId:t,access:s,entryStorage:c,headsStorage:a,indexStorage:l}),f=new w5.EventEmitter,g=new Bu({concurrency:1}),w=async S=>{const I=async()=>{const C=await y.append(S,{referencesCount:u});return await E.add(C),p&&await p(y,C),f.emit("update",C),C.hash},x=await g.add(I);return await g.onIdle(),x},m=async S=>{const I=async()=>{const x=await Ga.decode(S);x&&await y.joinEntry(x)&&(p&&await p(y,x),f.emit("update",x))};await g.add(I)},b=async()=>{await E.stop(),await g.onIdle(),await y.close(),s&&s.close&&await s.close(),f.emit("close")},v=async()=>{await g.onIdle(),await y.clear(),s&&s.drop&&await s.drop(),f.emit("drop")},E=await Cie({ipfs:r,log:y,events:f,onSynced:m,start:d});return{address:t,name:n,identity:e,meta:o,close:b,drop:v,addOperation:w,log:y,sync:E,peers:E.peers,events:f,access:s}},Aj="documents",tue={indexBy:"_id"},Sj=({indexBy:r}=tue)=>async({ipfs:e,identity:t,address:n,name:s,access:i,directory:o,meta:a,headsStorage:c,entryStorage:l,indexStorage:u,referencesCount:d,syncAutomatically:p,onUpdate:y})=>{const f=await qT({ipfs:e,identity:t,address:n,name:s,access:i,directory:o,meta:a,headsStorage:c,entryStorage:l,indexStorage:u,referencesCount:d,syncAutomatically:p}),{addOperation:g,log:w}=f,m=async x=>{const C=x[r];if(!C)throw new Error(`The provided document doesn't contain field '${r}'`);return g({op:"PUT",key:C,value:x})},b=async x=>{if(!await v(x))throw new Error(`No document with key '${x}' in the database`);return g({op:"DEL",key:x,value:null})},v=async x=>{for await(const C of S())if(x===C.key)return C},E=async x=>{const C=[];for await(const P of S())x(P.value)&&C.push(P.value);return C},S=async function*({amount:x}={}){const C={};let P=0;for await(const L of w.iterator()){const{op:K,key:V,value:Z}=L.payload;if(K==="PUT"&&!C[V]?(C[V]=!0,P++,yield{hash:L.hash,key:V,value:Z}):K==="DEL"&&!C[V]&&(C[V]=!0),P>=x)break}};return{...f,type:Aj,put:m,del:b,get:v,iterator:S,query:E,indexBy:r,all:async()=>{const x=[];for await(const C of S())x.unshift(C);return x}}};Sj.type=Aj;const Cj="events",Ij=()=>async({ipfs:r,identity:e,address:t,name:n,access:s,directory:i,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:u,syncAutomatically:d,onUpdate:p})=>{const y=await qT({ipfs:r,identity:e,address:t,name:n,access:s,directory:i,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:u,syncAutomatically:d,onUpdate:p}),{addOperation:f,log:g}=y,w=async E=>f({op:"ADD",key:null,value:E}),m=async E=>(await g.get(E)).payload.value,b=async function*({gt:E,gte:S,lt:I,lte:x,amount:C}={}){const P=g.iterator({gt:E,gte:S,lt:I,lte:x,amount:C});for await(const L of P){const K=L.hash,V=L.payload.value;yield{hash:K,value:V}}};return{...y,type:Cj,add:w,get:m,iterator:b,all:async()=>{const E=[];for await(const S of b())E.unshift(S);return E}}};Ij.type=Cj;const kj="keyvalue",Tj=()=>async({ipfs:r,identity:e,address:t,name:n,access:s,directory:i,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:u,syncAutomatically:d,onUpdate:p})=>{const y=await qT({ipfs:r,identity:e,address:t,name:n,access:s,directory:i,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:u,syncAutomatically:d,onUpdate:p}),{addOperation:f,log:g}=y,w=async(S,I)=>f({op:"PUT",key:S,value:I}),m=async S=>f({op:"DEL",key:S,value:null}),b=async S=>{for await(const I of g.traverse()){const{op:x,key:C,value:P}=I.payload;if(x==="PUT"&&C===S)return P;if(x==="DEL"&&C===S)return}},v=async function*({amount:S}={}){const I={};let x=0;for await(const C of g.traverse()){const{op:P,key:L,value:K}=C.payload;if(P==="PUT"&&!I[L]){I[L]=!0,x++;const V=C.hash;yield{key:L,value:K,hash:V}}else P==="DEL"&&!I[L]&&(I[L]=!0);if(x>=S)break}};return{...y,type:kj,put:w,set:w,del:m,get:b,iterator:v,all:async()=>{const S=[];for await(const I of v())S.unshift(I);return S}}};Tj.type=kj;const TA={},WT=r=>{if(!r.type)throw new Error("Database type does not contain required field 'type'.");TA[r.type]=r},rue=r=>{if(!r)throw new Error("Type not specified");if(!TA[r])throw new Error(`Unsupported database type: '${r}'`);return TA[r]};WT(Ij);WT(Sj);WT(Tj);const nue=Symbol.for("@libp2p/connection"),Y0=Symbol.for("@libp2p/content-routing"),v8=Symbol.for("@libp2p/peer-discovery"),QT=Symbol.for("@libp2p/peer-id");function _j(r){return!!(r!=null&&r[QT])}const X0=Symbol.for("@libp2p/peer-routing"),M5="keep-alive",E8="StrictSign",JT="StrictNoSign";var Pi;(function(r){r.Accept="accept",r.Ignore="ignore",r.Reject="reject"})(Pi||(Pi={}));const $5=Symbol.for("@libp2p/transport");var Z0;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(Z0||(Z0={}));var gx;let Vd=(gx=class extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}},h(gx,"name","AbortError"),gx);class Pj extends Error{constructor(e="Unexpected Peer"){super(e),this.name="UnexpectedPeerError"}}h(Pj,"name","UnexpectedPeerError");var yx;let sue=(yx=class extends Error{constructor(e="Invalid crypto exchange"){super(e),this.name="InvalidCryptoExchangeError"}},h(yx,"name","InvalidCryptoExchangeError"),yx);class ie extends Error{constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}}h(ie,"name","InvalidParametersError");class py extends Error{constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}h(py,"name","InvalidPublicKeyError");class YT extends Error{constructor(e="Invalid private key"){super(e),this.name="InvalidPrivateKeyError"}}h(YT,"name","InvalidPrivateKeyError");class Nj extends Error{constructor(e="The connection is closing"){super(e),this.name="ConnectionClosingError"}}h(Nj,"name","ConnectionClosingError");class XT extends Error{constructor(e="The connection is closed"){super(e),this.name="ConnectionClosedError"}}h(XT,"name","ConnectionClosedError");class ZT extends Error{constructor(e="Connection failed"){super(e),this.name="ConnectionFailedError"}}h(ZT,"name","ConnectionFailedError");class Ph extends Error{constructor(e="The muxer is closed"){super(e),this.name="MuxerClosedError"}}h(Ph,"name","MuxerClosedError");class Dj extends Error{constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}}h(Dj,"name","StreamResetError");class x8 extends Error{constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}}h(x8,"name","StreamStateError");var mx;let vr=(mx=class extends Error{constructor(e="Not found"){super(e),this.name="NotFoundError"}},h(mx,"name","NotFoundError"),mx);class e_ extends Error{constructor(e="Invalid PeerID"){super(e),this.name="InvalidPeerIdError"}}h(e_,"name","InvalidPeerIdError");class L5 extends Error{constructor(e="Invalid multiaddr"){super(e),this.name="InvalidMultiaddrError"}}h(L5,"name","InvalidMultiaddrError");class Oj extends Error{constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}h(Oj,"name","InvalidCIDError");class U5 extends Error{constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}h(U5,"name","InvalidMultihashError");class Om extends Error{constructor(e="Unsupported protocol error"){super(e),this.name="UnsupportedProtocolError"}}h(Om,"name","UnsupportedProtocolError");class Rt extends Error{constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}}h(Rt,"name","InvalidMessageError");class Rj extends Error{constructor(e="Protocol error"){super(e),this.name="ProtocolError"}}h(Rj,"name","ProtocolError");class Rm extends Error{constructor(e="Timed out"){super(e),this.name="TimeoutError"}}h(Rm,"name","TimeoutError");class Hd extends Error{constructor(e="Not started"){super(e),this.name="NotStartedError"}}h(Hd,"name","NotStartedError");class Rp extends Error{constructor(e="Dial error"){super(e),this.name="DialError"}}h(Rp,"name","DialError");class A8 extends Error{constructor(e="Listen error"){super(e),this.name="ListenError"}}h(A8,"name","ListenError");class t_ extends Error{constructor(e="Limited connection"){super(e),this.name="LimitedConnectionError"}}h(t_,"name","LimitedConnectionError");class Bj extends Error{constructor(e="Too many inbound protocol streams"){super(e),this.name="TooManyInboundProtocolStreamsError"}}h(Bj,"name","TooManyInboundProtocolStreamsError");class F5 extends Error{constructor(e="Too many outbound protocol streams"){super(e),this.name="TooManyOutboundProtocolStreamsError"}}h(F5,"name","TooManyOutboundProtocolStreamsError");class If extends Error{constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}h(If,"name","UnsupportedKeyTypeError");var Wo;class Er extends EventTarget{constructor(){super();Q(this,Wo,new Map)}listenerCount(t){const n=T(this,Wo).get(t);return n==null?0:n.length}addEventListener(t,n,s){super.addEventListener(t,n,s);let i=T(this,Wo).get(t);i==null&&(i=[],T(this,Wo).set(t,i)),i.push({callback:n,once:(s!==!0&&s!==!1&&(s==null?void 0:s.once))??!1})}removeEventListener(t,n,s){super.removeEventListener(t.toString(),n??null,s);let i=T(this,Wo).get(t);i!=null&&(i=i.filter(({callback:o})=>o!==n),T(this,Wo).set(t,i))}dispatchEvent(t){const n=super.dispatchEvent(t);let s=T(this,Wo).get(t.type);return s==null||(s=s.filter(({once:i})=>!i),T(this,Wo).set(t.type,s)),n}safeDispatchEvent(t,n={}){return this.dispatchEvent(new CustomEvent(t,n))}}Wo=new WeakMap;function r_(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}async function Oc(...r){const e=[];for(const t of r)r_(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStart!=null&&await t.beforeStart()})),await Promise.all(e.map(async t=>{await t.start()})),await Promise.all(e.map(async t=>{t.afterStart!=null&&await t.afterStart()}))}async function sh(...r){const e=[];for(const t of r)r_(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStop!=null&&await t.beforeStop()})),await Promise.all(e.map(async t=>{await t.stop()})),await Promise.all(e.map(async t=>{t.afterStop!=null&&await t.afterStop()}))}const Lr=Symbol.for("@libp2p/service-capabilities"),Lu=Symbol.for("@libp2p/service-dependencies");function iue(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function z5(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function oue(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var aue=oue,cue=aue;let lue=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},uue=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Mj(this,e)}},hue=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return Mj(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Mj(r,e){return new hue({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let due=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new lue(e,t,n),this.decoder=new uue(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function $j({name:r,prefix:e,encode:t,decode:n}){return new due(r,e,t,n)}function V5({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=cue(t,r);return $j({prefix:e,name:r,encode:n,decode:i=>z5(s(i))})}function fue(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function pue(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function ti({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return $j({prefix:e,name:r,encode(s){return pue(s,n,t)},decode(s){return fue(s,n,t,r)}})}const _i=V5({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});V5({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const t4=ti({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ti({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});ti({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});ti({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});ti({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});ti({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});ti({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});ti({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});ti({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const L9=V5({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});V5({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var gue=Lj,ZO=128,yue=-128,mue=Math.pow(2,31);function Lj(r,e,t){e=e||[],t=t||0;for(var n=t;r>=mue;)e[t++]=r&255|ZO,r/=128;for(;r&yue;)e[t++]=r&255|ZO,r>>>=7;return e[t]=r|0,Lj.bytes=t-n+1,e}var wue=_A,bue=128,eR=127;function _A(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw _A.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&eR)<<s:(o&eR)*Math.pow(2,s),s+=7}while(o>=bue);return _A.bytes=i-n,t}var vue=Math.pow(2,7),Eue=Math.pow(2,14),xue=Math.pow(2,21),Aue=Math.pow(2,28),Sue=Math.pow(2,35),Cue=Math.pow(2,42),Iue=Math.pow(2,49),kue=Math.pow(2,56),Tue=Math.pow(2,63),_ue=function(r){return r<vue?1:r<Eue?2:r<xue?3:r<Aue?4:r<Sue?5:r<Cue?6:r<Iue?7:r<kue?8:r<Tue?9:10},Pue={encode:gue,decode:wue,encodingLength:_ue},S8=Pue;function PA(r,e=0){return[S8.decode(r,e),S8.decode.bytes]}function C8(r,e,t=0){return S8.encode(r,e,t),e}function I8(r){return S8.encodingLength(r)}function Kd(r,e){const t=e.byteLength,n=I8(r),s=n+I8(t),i=new Uint8Array(s+t);return C8(r,i,0),C8(t,i,n),i.set(e,s),new n_(r,t,e,i)}function Nue(r){const e=z5(r),[t,n]=PA(e),[s,i]=PA(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new n_(t,s,o,e)}function Due(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&iue(r.bytes,t.bytes)}}let n_=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function tR(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Rue(t,NA(r),e??_i.encoder);default:return Bue(t,NA(r),e??t4.encoder)}}const rR=new WeakMap;function NA(r){const e=rR.get(r);if(e==null){const t=new Map;return rR.set(r,t),t}return e}var Nz;let H5=class hn{constructor(e,t,n,s){h(this,"code");h(this,"version");h(this,"multihash");h(this,"bytes");h(this,"/");h(this,Nz,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Bg)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Mue)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return hn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Kd(e,t);return hn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return hn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Due(e.multihash,n.multihash)}toString(e){return tR(this,e)}toJSON(){return{"/":tR(this)}}link(){return this}[(Nz=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof hn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new hn(n,s,i,o??nR(n,s,i.bytes))}else if(t[$ue]===!0){const{version:n,multihash:s,code:i}=t,o=Nue(s);return hn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Bg)throw new Error(`Version 0 CID must use dag-pb (code: ${Bg}) block encoding`);return new hn(e,t,n,n.bytes)}case 1:{const s=nR(e,t,n.bytes);return new hn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return hn.create(0,Bg,e)}static createV1(e,t){return hn.create(1,e,t)}static decode(e){const[t,n]=hn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=hn.inspectBytes(e),n=t.size-t.multihashSize,s=z5(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new n_(t.multihashCode,t.digestSize,i,s);return[t.version===0?hn.createV0(o):hn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=PA(e.subarray(t));return t+=p,d};let s=n(),i=Bg;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,s]=Oue(e,t),i=hn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return NA(i).set(n,e),i}};function Oue(r,e){switch(r[0]){case"Q":{const t=e??_i;return[_i.prefix,t.decode(`${_i.prefix}${r}`)]}case _i.prefix:{const t=e??_i;return[_i.prefix,t.decode(r)]}case t4.prefix:{const t=e??t4;return[t4.prefix,t.decode(r)]}case L9.prefix:{const t=e??L9;return[L9.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Rue(r,e,t){const{prefix:n}=t;if(n!==_i.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s}function Bue(r,e,t){const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s}const Bg=112,Mue=18;function nR(r,e,t){const n=I8(r),s=n+I8(e),i=new Uint8Array(s+t.byteLength);return C8(r,i,0),C8(e,i,n),i.set(t,s),i}const $ue=Symbol.for("@ipld/js-cid/CID"),Uj=0,Lue="identity",Fj=z5;function Uue(r){return Kd(Uj,Fj(r))}const s_={code:Uj,name:Lue,encode:Fj,digest:Uue};function rt(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function it(r=0){return new Uint8Array(r)}function Ss(r=0){return new Uint8Array(r)}function Cr(r,e){e==null&&(e=r.reduce((s,i)=>s+i.length,0));const t=Ss(e);let n=0;for(const s of r)t.set(s,n),n+=s.length;return t}const zj=Symbol.for("@achingbrain/uint8arraylist");function sR(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(const n of r){const s=t+n.byteLength;if(e<s)return{buf:n,index:e-t};t=s}throw new RangeError("index is out of bounds")}function i2(r){return!!(r!=null&&r[zj])}var Dz;class Ge{constructor(...e){h(this,"bufs");h(this,"length");h(this,Dz,!0);this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[(Dz=zj,Symbol.iterator)](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(i2(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(i2(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){const t=sR(this.bufs,e);return t.buf[t.index]}set(e,t){const n=sR(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(i2(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){const{bufs:n,length:s}=this._subList(e,t);return Cr(n,s)}subarray(e,t){const{bufs:n,length:s}=this._subList(e,t);return n.length===1?n[0]:Cr(n,s)}sublist(e,t){const{bufs:n,length:s}=this._subList(e,t),i=new Ge;return i.length=s,i.bufs=[...n],i}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};const n=[];let s=0;for(let i=0;i<this.bufs.length;i++){const o=this.bufs[i],a=s,c=a+o.byteLength;if(s=c,e>=c)continue;const l=e>=a&&e<c,u=t>a&&t<=c;if(l&&u){if(e===a&&t===c){n.push(o);break}const d=e-a;n.push(o.subarray(d,d+(t-e)));break}if(l){if(e===0){n.push(o);continue}n.push(o.subarray(e-a));continue}if(u){if(t===c){n.push(o);break}n.push(o.subarray(0,t-a));break}n.push(o)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!i2(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const s=n.byteLength;if(s===0)throw new TypeError("search must be at least 1 byte long");const i=256,o=new Int32Array(i);for(let d=0;d<i;d++)o[d]=-1;for(let d=0;d<s;d++)o[n[d]]=d;const a=o,c=this.byteLength-n.byteLength,l=n.byteLength-1;let u;for(let d=t;d<=c;d+=u){u=0;for(let p=l;p>=0;p--){const y=this.get(d+p);if(n[p]!==y){u=Math.max(1,p-a[y]);break}}if(u===0)return d}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const n=Ss(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){const s=it(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt16(0,t,n),this.write(s,e)}getInt32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){const s=it(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt32(0,t,n),this.write(s,e)}getBigInt64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){const s=it(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigInt64(0,t,n),this.write(s,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const n=Ss(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){const s=it(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint16(0,t,n),this.write(s,e)}getUint32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){const s=it(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint32(0,t,n),this.write(s,e)}getBigUint64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){const s=it(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigUint64(0,t,n),this.write(s,e)}getFloat32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){const s=it(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat32(0,t,n),this.write(s,e)}getFloat64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){const s=it(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat64(0,t,n),this.write(s,e)}equals(e){if(e==null||!(e instanceof Ge)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!rt(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const n=new Ge;return n.bufs=e,t==null&&(t=e.reduce((s,i)=>s+i.byteLength,0)),n.length=t,n}}function Fue(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function zue(r){return new TextEncoder().encode(r)}function Vue(r){return new TextDecoder().decode(r)}function Hue(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var Kue=Hue,Gue=Kue;let jue=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},que=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Vj(this,e)}},Wue=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return Vj(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Vj(r,e){return new Wue({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Que=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new jue(e,t,n),this.decoder=new que(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function K5({name:r,prefix:e,encode:t,decode:n}){return new Que(r,e,t,n)}function Bm({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=Gue(t,r);return K5({prefix:e,name:r,encode:n,decode:i=>Fue(s(i))})}function Jue(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Yue(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function rn({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return K5({prefix:e,name:r,encode(s){return Yue(s,n,t)},decode(s){return Jue(s,n,t,r)}})}const Xue=Bm({prefix:"9",name:"base10",alphabet:"0123456789"}),Zue=Object.freeze(Object.defineProperty({__proto__:null,base10:Xue},Symbol.toStringTag,{value:"Module"})),ehe=rn({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),the=rn({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),rhe=Object.freeze(Object.defineProperty({__proto__:null,base16:ehe,base16upper:the},Symbol.toStringTag,{value:"Module"})),nhe=rn({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),she=Object.freeze(Object.defineProperty({__proto__:null,base2:nhe},Symbol.toStringTag,{value:"Module"})),Hj=Array.from(""),ihe=Hj.reduce((r,e,t)=>(r[t]=e,r),[]),ohe=Hj.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function ahe(r){return r.reduce((e,t)=>(e+=ihe[t],e),"")}function che(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const s=ohe[n];if(s==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}const lhe=K5({prefix:"",name:"base256emoji",encode:ahe,decode:che}),uhe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:lhe},Symbol.toStringTag,{value:"Module"})),hhe=rn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),dhe=rn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),fhe=rn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),phe=rn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ghe=rn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),yhe=rn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),mhe=rn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),whe=rn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),bhe=rn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),vhe=Object.freeze(Object.defineProperty({__proto__:null,base32:hhe,base32hex:ghe,base32hexpad:mhe,base32hexpadupper:whe,base32hexupper:yhe,base32pad:fhe,base32padupper:phe,base32upper:dhe,base32z:bhe},Symbol.toStringTag,{value:"Module"})),Ehe=Bm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),xhe=Bm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Ahe=Object.freeze(Object.defineProperty({__proto__:null,base36:Ehe,base36upper:xhe},Symbol.toStringTag,{value:"Module"})),She=Bm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Che=Bm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Ihe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:She,base58flickr:Che},Symbol.toStringTag,{value:"Module"})),khe=rn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),The=rn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),_he=rn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Phe=rn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Nhe=Object.freeze(Object.defineProperty({__proto__:null,base64:khe,base64pad:The,base64url:_he,base64urlpad:Phe},Symbol.toStringTag,{value:"Module"})),Dhe=rn({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Ohe=Object.freeze(Object.defineProperty({__proto__:null,base8:Dhe},Symbol.toStringTag,{value:"Module"})),Rhe=K5({prefix:"\0",name:"identity",encode:r=>Vue(r),decode:r=>zue(r)}),Bhe=Object.freeze(Object.defineProperty({__proto__:null,identity:Rhe},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const iR={...Bhe,...she,...Ohe,...Zue,...rhe,...vhe,...Ahe,...Ihe,...Nhe,...uhe};function Kj(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const oR=Kj("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),U9=Kj("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=Ss(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Gj={utf8:oR,"utf-8":oR,hex:iR.base16,latin1:U9,ascii:U9,binary:U9,...iR};function he(r,e="utf8"){const t=Gj[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}function ce(r,e="utf8"){const t=Gj[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}const Mhe=parseInt("11111",2),DA=parseInt("10000000",2),$he=parseInt("01111111",2),aR={0:Mg,1:Mg,2:Lhe,3:zhe,4:Vhe,5:Fhe,6:Uhe,16:Mg,22:Mg,48:Mg};function ih(r,e={offset:0}){const t=r[e.offset]&Mhe;if(e.offset++,aR[t]!=null)return aR[t](r,e);throw new Error("No decoder for tag "+t)}function Mm(r,e){let t=0;if((r[e.offset]&DA)===DA){const n=r[e.offset]&$he;let s="0x";e.offset++;for(let i=0;i<n;i++,e.offset++)s+=r[e.offset].toString(16).padStart(2,"0");t=parseInt(s,16)}else t=r[e.offset],e.offset++;return t}function Mg(r,e){Mm(r,e);const t=[];for(;!(e.offset>=r.byteLength);){const n=ih(r,e);if(n===null)break;t.push(n)}return t}function Lhe(r,e){const t=Mm(r,e),n=e.offset,s=e.offset+t,i=[];for(let o=n;o<s;o++)o===n&&r[o]===0||i.push(r[o]);return e.offset+=t,Uint8Array.from(i)}function Uhe(r,e){const t=Mm(r,e),n=e.offset+t,s=r[e.offset];e.offset++;let i=0,o=0;s<40?(i=0,o=s):s<80?(i=1,o=s-40):(i=2,o=s-80);let a=`${i}.${o}`,c=[];for(;e.offset<n;){const l=r[e.offset];if(e.offset++,c.push(l&127),l<128){c.reverse();let u=0;for(let d=0;d<c.length;d++)u+=c[d]<<d*7;a+=`.${u}`,c=[]}}return a}function Fhe(r,e){return e.offset++,null}function zhe(r,e){const t=Mm(r,e),n=r[e.offset];e.offset++;const s=r.subarray(e.offset,e.offset+t-1);if(e.offset+=t,n!==0)throw new Error("Unused bits in bit string is unimplemented");return s}function Vhe(r,e){const t=Mm(r,e),n=r.subarray(e.offset,e.offset+t);return e.offset+=t,n}function Hhe(r){let e=r.toString(16);e.length%2===1&&(e="0"+e);const t=new Ge;for(let n=0;n<e.length;n+=2)t.append(Uint8Array.from([parseInt(`${e[n]}${e[n+1]}`,16)]));return t}function G5(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);const e=Hhe(r.byteLength);return new Ge(Uint8Array.from([e.byteLength|DA]),e)}function zs(r){const e=new Ge,t=128;return(r.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(r),new Ge(Uint8Array.from([2]),G5(e),e)}function i_(r){const e=Uint8Array.from([0]),t=new Ge(e,r);return new Ge(Uint8Array.from([3]),G5(t),t)}function Khe(r){return new Ge(Uint8Array.from([4]),G5(r),r)}function bc(r,e=48){const t=new Ge;for(const n of r)t.append(n);return new Ge(Uint8Array.from([e]),G5(t),t)}const jj="1.2.840.10045.3.1.7",qj="1.3.132.0.34",Wj="1.3.132.0.35";async function Ghe(r="P-256"){const e=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:r},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",e.publicKey),privateKey:await crypto.subtle.exportKey("jwk",e.privateKey)}}async function jhe(r,e){const t=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["sign"]),n=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},t,e.subarray());return new Uint8Array(n,0,n.byteLength)}async function qhe(r,e,t){const n=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["verify"]);return crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},n,e,t.subarray())}const Whe=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),Qhe=Uint8Array.from([6,5,43,129,4,0,34]),Jhe=Uint8Array.from([6,5,43,129,4,0,35]),Qj={ext:!0,kty:"EC",crv:"P-256"},Jj={ext:!0,kty:"EC",crv:"P-384"},Yj={ext:!0,kty:"EC",crv:"P-521"},Bp=32,Mp=48,$p=66;function Yhe(r){const e=ih(r);return Xj(e)}function Xj(r){const e=r[1],t=ce(e,"base64url"),n=r[2][1][0],s=1;let i,o;if(e.byteLength===Bp)return i=ce(n.subarray(s,s+Bp),"base64url"),o=ce(n.subarray(s+Bp),"base64url"),new n4({...Qj,key_ops:["sign"],d:t,x:i,y:o});if(e.byteLength===Mp)return i=ce(n.subarray(s,s+Mp),"base64url"),o=ce(n.subarray(s+Mp),"base64url"),new n4({...Jj,key_ops:["sign"],d:t,x:i,y:o});if(e.byteLength===$p)return i=ce(n.subarray(s,s+$p),"base64url"),o=ce(n.subarray(s+$p),"base64url"),new n4({...Yj,key_ops:["sign"],d:t,x:i,y:o});throw new ie(`Private key length was wrong length, got ${e.byteLength}, expected 32, 48 or 66`)}function Zj(r){const e=ih(r);return eq(e)}function eq(r){const e=r[1][1][0],t=1;let n,s;if(e.byteLength===Bp*2+1)return n=ce(e.subarray(t,t+Bp),"base64url"),s=ce(e.subarray(t+Bp),"base64url"),new r4({...Qj,key_ops:["verify"],x:n,y:s});if(e.byteLength===Mp*2+1)return n=ce(e.subarray(t,t+Mp),"base64url"),s=ce(e.subarray(t+Mp),"base64url"),new r4({...Jj,key_ops:["verify"],x:n,y:s});if(e.byteLength===$p*2+1)return n=ce(e.subarray(t,t+$p),"base64url"),s=ce(e.subarray(t+$p),"base64url"),new r4({...Yj,key_ops:["verify"],x:n,y:s});throw new ie(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function Xhe(r){return bc([zs(Uint8Array.from([1])),Khe(he(r.d??"","base64url")),bc([tq(r.crv)],160),bc([i_(new Ge(Uint8Array.from([4]),he(r.x??"","base64url"),he(r.y??"","base64url")))],161)]).subarray()}function Zhe(r){return bc([zs(Uint8Array.from([1])),bc([tq(r.crv)],160),bc([i_(new Ge(Uint8Array.from([4]),he(r.x??"","base64url"),he(r.y??"","base64url")))],161)]).subarray()}function tq(r){if(r==="P-256")return Whe;if(r==="P-384")return Qhe;if(r==="P-521")return Jhe;throw new ie(`Invalid curve ${r}`)}async function ede(r="P-256"){const e=await Ghe(r);return new n4(e.privateKey)}class r4{constructor(e){h(this,"type","ECDSA");h(this,"jwk");h(this,"_raw");this.jwk=e}get raw(){return this._raw==null&&(this._raw=Zhe(this.jwk)),this._raw}toMultihash(){return s_.digest($i(this))}toCID(){return H5.createV1(114,this.toMultihash())}toString(){return _i.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:rt(this.raw,e.raw)}async verify(e,t){return qhe(this.jwk,t,e)}}class n4{constructor(e){h(this,"type","ECDSA");h(this,"jwk");h(this,"publicKey");h(this,"_raw");this.jwk=e,this.publicKey=new r4({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){return this._raw==null&&(this._raw=Xhe(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:rt(this.raw,e.raw)}async sign(e){return jhe(this.jwk,e)}}function cR(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function tde(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function j5(r,...e){if(!tde(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function rde(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");cR(r.outputLen),cR(r.blockLen)}function k8(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function nde(r,e){j5(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const Hf=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function F9(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function Uo(r,e){return r<<32-e|r>>>e}typeof Uint8Array.from([]).toHex=="function"&&Uint8Array.fromHex;function sde(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function o_(r){return typeof r=="string"&&(r=sde(r)),j5(r),r}function ide(...r){let e=0;for(let n=0;n<r.length;n++){const s=r[n];j5(s),e+=s.length}const t=new Uint8Array(e);for(let n=0,s=0;n<r.length;n++){const i=r[n];t.set(i,s),s+=i.length}return t}let rq=class{clone(){return this._cloneInto()}};function nq(r){const e=n=>r().update(o_(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function a_(r=32){if(Hf&&typeof Hf.getRandomValues=="function")return Hf.getRandomValues(new Uint8Array(r));if(Hf&&typeof Hf.randomBytes=="function")return Uint8Array.from(Hf.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function ode(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function ade(r,e,t){return r&e^~r&t}function cde(r,e,t){return r&e^r&t^e&t}let sq=class extends rq{constructor(e,t,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=F9(this.buffer)}update(e){k8(this);const{view:t,buffer:n,blockLen:s}=this;e=o_(e);const i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=F9(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){k8(this),nde(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(n,0),o=0);for(let d=o;d<s;d++)t[d]=0;ode(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=F9(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<l;d++)a.setUint32(4*d,u[d],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=i,e.destroyed=o,s%t&&e.buffer.set(n),e}};const lde=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),hl=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),dl=new Uint32Array(64);let ude=class extends sq{constructor(e=32){super(64,e,8,!1),this.A=hl[0]|0,this.B=hl[1]|0,this.C=hl[2]|0,this.D=hl[3]|0,this.E=hl[4]|0,this.F=hl[5]|0,this.G=hl[6]|0,this.H=hl[7]|0}get(){const{A:e,B:t,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,t,n,s,i,o,a,c]}set(e,t,n,s,i,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let d=0;d<16;d++,t+=4)dl[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){const p=dl[d-15],y=dl[d-2],f=Uo(p,7)^Uo(p,18)^p>>>3,g=Uo(y,17)^Uo(y,19)^y>>>10;dl[d]=g+dl[d-7]+f+dl[d-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let d=0;d<64;d++){const p=Uo(a,6)^Uo(a,11)^Uo(a,25),y=u+p+ade(a,c,l)+lde[d]+dl[d]|0,g=(Uo(n,2)^Uo(n,13)^Uo(n,22))+cde(n,s,i)|0;u=l,l=c,c=a,a=o+y|0,o=i,i=s,s=n,n=y+g|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,s,i,o,a,c,l,u)}roundClean(){dl.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const hde=nq(()=>new ude),Gw=BigInt(2**32-1),OA=BigInt(32);function iq(r,e=!1){return e?{h:Number(r&Gw),l:Number(r>>OA&Gw)}:{h:Number(r>>OA&Gw)|0,l:Number(r&Gw)|0}}function dde(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:i,l:o}=iq(r[s],e);[t[s],n[s]]=[i,o]}return[t,n]}const fde=(r,e)=>BigInt(r>>>0)<<OA|BigInt(e>>>0),pde=(r,e,t)=>r>>>t,gde=(r,e,t)=>r<<32-t|e>>>t,yde=(r,e,t)=>r>>>t|e<<32-t,mde=(r,e,t)=>r<<32-t|e>>>t,wde=(r,e,t)=>r<<64-t|e>>>t-32,bde=(r,e,t)=>r>>>t-32|e<<64-t,vde=(r,e)=>e,Ede=(r,e)=>r,xde=(r,e,t)=>r<<t|e>>>32-t,Ade=(r,e,t)=>e<<t|r>>>32-t,Sde=(r,e,t)=>e<<t-32|r>>>64-t,Cde=(r,e,t)=>r<<t-32|e>>>64-t;function Ide(r,e,t,n){const s=(e>>>0)+(n>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}const kde=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),Tde=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,_de=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),Pde=(r,e,t,n,s)=>e+t+n+s+(r/2**32|0)|0,Nde=(r,e,t,n,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(s>>>0),Dde=(r,e,t,n,s,i)=>e+t+n+s+i+(r/2**32|0)|0,Je={fromBig:iq,split:dde,toBig:fde,shrSH:pde,shrSL:gde,rotrSH:yde,rotrSL:mde,rotrBH:wde,rotrBL:bde,rotr32H:vde,rotr32L:Ede,rotlSH:xde,rotlSL:Ade,rotlBH:Sde,rotlBL:Cde,add:Ide,add3L:kde,add3H:Tde,add4L:_de,add4H:Pde,add5H:Dde,add5L:Nde},[Ode,Rde]=Je.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),fl=new Uint32Array(80),pl=new Uint32Array(80);let Bde=class extends sq{constructor(e=64){super(128,e,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:d,Fl:p,Gh:y,Gl:f,Hh:g,Hl:w}=this;return[e,t,n,s,i,o,a,c,l,u,d,p,y,f,g,w]}set(e,t,n,s,i,o,a,c,l,u,d,p,y,f,g,w){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=d|0,this.Fl=p|0,this.Gh=y|0,this.Gl=f|0,this.Hh=g|0,this.Hl=w|0}process(e,t){for(let v=0;v<16;v++,t+=4)fl[v]=e.getUint32(t),pl[v]=e.getUint32(t+=4);for(let v=16;v<80;v++){const E=fl[v-15]|0,S=pl[v-15]|0,I=Je.rotrSH(E,S,1)^Je.rotrSH(E,S,8)^Je.shrSH(E,S,7),x=Je.rotrSL(E,S,1)^Je.rotrSL(E,S,8)^Je.shrSL(E,S,7),C=fl[v-2]|0,P=pl[v-2]|0,L=Je.rotrSH(C,P,19)^Je.rotrBH(C,P,61)^Je.shrSH(C,P,6),K=Je.rotrSL(C,P,19)^Je.rotrBL(C,P,61)^Je.shrSL(C,P,6),V=Je.add4L(x,K,pl[v-7],pl[v-16]),Z=Je.add4H(V,I,L,fl[v-7],fl[v-16]);fl[v]=Z|0,pl[v]=V|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:d,El:p,Fh:y,Fl:f,Gh:g,Gl:w,Hh:m,Hl:b}=this;for(let v=0;v<80;v++){const E=Je.rotrSH(d,p,14)^Je.rotrSH(d,p,18)^Je.rotrBH(d,p,41),S=Je.rotrSL(d,p,14)^Je.rotrSL(d,p,18)^Je.rotrBL(d,p,41),I=d&y^~d&g,x=p&f^~p&w,C=Je.add5L(b,S,x,Rde[v],pl[v]),P=Je.add5H(C,m,E,I,Ode[v],fl[v]),L=C|0,K=Je.rotrSH(n,s,28)^Je.rotrBH(n,s,34)^Je.rotrBH(n,s,39),V=Je.rotrSL(n,s,28)^Je.rotrBL(n,s,34)^Je.rotrBL(n,s,39),Z=n&i^n&a^i&a,Y=s&o^s&c^o&c;m=g|0,b=w|0,g=y|0,w=f|0,y=d|0,f=p|0,{h:d,l:p}=Je.add(l|0,u|0,P|0,L|0),l=a|0,u=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const U=Je.add3L(L,V,Y);n=Je.add3H(U,P,K,Z),s=U|0}({h:n,l:s}=Je.add(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=Je.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=Je.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Je.add(this.Dh|0,this.Dl|0,l|0,u|0),{h:d,l:p}=Je.add(this.Eh|0,this.El|0,d|0,p|0),{h:y,l:f}=Je.add(this.Fh|0,this.Fl|0,y|0,f|0),{h:g,l:w}=Je.add(this.Gh|0,this.Gl|0,g|0,w|0),{h:m,l:b}=Je.add(this.Hh|0,this.Hl|0,m|0,b|0),this.set(n,s,i,o,a,c,l,u,d,p,y,f,g,w,m,b)}roundClean(){fl.fill(0),pl.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Mde=nq(()=>new Bde);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const c_=BigInt(0),RA=BigInt(1);function e1(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function l_(r){if(!e1(r))throw new Error("Uint8Array expected")}function ku(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}function jw(r){const e=r.toString(16);return e.length&1?"0"+e:e}function oq(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?c_:BigInt("0x"+r)}const aq=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",$de=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function t1(r){if(l_(r),aq)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=$de[r[t]];return e}const Oa={_0:48,_9:57,A:65,F:70,a:97,f:102};function lR(r){if(r>=Oa._0&&r<=Oa._9)return r-Oa._0;if(r>=Oa.A&&r<=Oa.F)return r-(Oa.A-10);if(r>=Oa.a&&r<=Oa.f)return r-(Oa.a-10)}function T8(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(aq)return Uint8Array.fromHex(r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let s=0,i=0;s<t;s++,i+=2){const o=lR(r.charCodeAt(i)),a=lR(r.charCodeAt(i+1));if(o===void 0||a===void 0){const c=r[i]+r[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function Id(r){return oq(t1(r))}function kd(r){return l_(r),oq(t1(Uint8Array.from(r).reverse()))}function gy(r,e){return T8(r.toString(16).padStart(e*2,"0"))}function yy(r,e){return gy(r,e).reverse()}function or(r,e,t){let n;if(typeof e=="string")try{n=T8(e)}catch(i){throw new Error(r+" must be hex string or Uint8Array, cause: "+i)}else if(e1(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const s=n.length;if(typeof t=="number"&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return n}function r1(...r){let e=0;for(let n=0;n<r.length;n++){const s=r[n];l_(s),e+=s.length}const t=new Uint8Array(e);for(let n=0,s=0;n<r.length;n++){const i=r[n];t.set(i,s),s+=i.length}return t}const z9=r=>typeof r=="bigint"&&c_<=r;function u_(r,e,t){return z9(r)&&z9(e)&&z9(t)&&e<=r&&r<t}function Gs(r,e,t,n){if(!u_(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function Lde(r){let e;for(e=0;r>c_;r>>=RA,e+=1);return e}const q5=r=>(RA<<BigInt(r))-RA,V9=r=>new Uint8Array(r),uR=r=>Uint8Array.from(r);function Ude(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=V9(r),s=V9(r),i=0;const o=()=>{n.fill(1),s.fill(0),i=0},a=(...d)=>t(s,n,...d),c=(d=V9(0))=>{s=a(uR([0]),d),n=a(),d.length!==0&&(s=a(uR([1]),d),n=a())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const p=[];for(;d<e;){n=a();const y=n.slice();p.push(y),d+=n.length}return r1(...p)};return(d,p)=>{o(),c(d);let y;for(;!(y=p(l()));)c();return o(),y}}const Fde={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||e1(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function Q1(r,e,t={}){const n=(s,i,o)=>{const a=Fde[i];if(typeof a!="function")throw new Error("invalid validator function");const c=r[s];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(s)+" is invalid. Expected "+i+", got "+c)};for(const[s,i]of Object.entries(e))n(s,i,!1);for(const[s,i]of Object.entries(t))n(s,i,!0);return r}function _8(r){const e=new WeakMap;return(t,...n)=>{const s=e.get(t);if(s!==void 0)return s;const i=r(t,...n);return e.set(t,i),i}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Br=BigInt(0),Yt=BigInt(1),Nh=BigInt(2),zde=BigInt(3),BA=BigInt(4),hR=BigInt(5),dR=BigInt(8);function Ot(r,e){const t=r%e;return t>=Br?t:e+t}function cq(r,e,t){if(e<Br)throw new Error("invalid exponent, negatives unsupported");if(t<=Br)throw new Error("invalid modulus");if(t===Yt)return Br;let n=Yt;for(;e>Br;)e&Yt&&(n=n*r%t),r=r*r%t,e>>=Yt;return n}function Qt(r,e,t){let n=r;for(;e-- >Br;)n*=n,n%=t;return n}function MA(r,e){if(r===Br)throw new Error("invert: expected non-zero number");if(e<=Br)throw new Error("invert: expected positive modulus, got "+e);let t=Ot(r,e),n=e,s=Br,i=Yt;for(;t!==Br;){const a=n/t,c=n%t,l=s-i*a;n=t,t=c,s=i,i=l}if(n!==Yt)throw new Error("invert: does not exist");return Ot(s,e)}function Vde(r){const e=(r-Yt)/Nh;let t,n,s;for(t=r-Yt,n=0;t%Nh===Br;t/=Nh,n++);for(s=Nh;s<r&&cq(s,e,r)!==r-Yt;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(r+Yt)/BA;return function(c,l){const u=c.pow(l,o);if(!c.eql(c.sqr(u),l))throw new Error("Cannot find square root");return u}}const i=(t+Yt)/Nh;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=n,u=a.pow(a.mul(a.ONE,s),t),d=a.pow(c,i),p=a.pow(c,t);for(;!a.eql(p,a.ONE);){if(a.eql(p,a.ZERO))return a.ZERO;let y=1;for(let g=a.sqr(p);y<l&&!a.eql(g,a.ONE);y++)g=a.sqr(g);const f=a.pow(u,Yt<<BigInt(l-y-1));u=a.sqr(f),d=a.mul(d,f),p=a.mul(p,u),l=y}return d}}function Hde(r){if(r%BA===zde){const e=(r+Yt)/BA;return function(n,s){const i=n.pow(s,e);if(!n.eql(n.sqr(i),s))throw new Error("Cannot find square root");return i}}if(r%dR===hR){const e=(r-hR)/dR;return function(n,s){const i=n.mul(s,Nh),o=n.pow(i,e),a=n.mul(s,o),c=n.mul(n.mul(a,Nh),o),l=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(l),s))throw new Error("Cannot find square root");return l}}return Vde(r)}const Kde=(r,e)=>(Ot(r,e)&Yt)===Yt,Gde=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function jde(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=Gde.reduce((n,s)=>(n[s]="function",n),e);return Q1(r,t)}function qde(r,e,t){if(t<Br)throw new Error("invalid exponent, negatives unsupported");if(t===Br)return r.ONE;if(t===Yt)return e;let n=r.ONE,s=e;for(;t>Br;)t&Yt&&(n=r.mul(n,s)),s=r.sqr(s),t>>=Yt;return n}function Wde(r,e){const t=new Array(e.length),n=e.reduce((i,o,a)=>r.is0(o)?i:(t[a]=i,r.mul(i,o)),r.ONE),s=r.inv(n);return e.reduceRight((i,o,a)=>r.is0(o)?i:(t[a]=r.mul(i,t[a]),r.mul(i,o)),s),t}function lq(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function W5(r,e,t=!1,n={}){if(r<=Br)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:s,nByteLength:i}=lq(r,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:r,isLE:t,BITS:s,BYTES:i,MASK:q5(s),ZERO:Br,ONE:Yt,create:c=>Ot(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Br<=c&&c<r},is0:c=>c===Br,isOdd:c=>(c&Yt)===Yt,neg:c=>Ot(-c,r),eql:(c,l)=>c===l,sqr:c=>Ot(c*c,r),add:(c,l)=>Ot(c+l,r),sub:(c,l)=>Ot(c-l,r),mul:(c,l)=>Ot(c*l,r),pow:(c,l)=>qde(a,c,l),div:(c,l)=>Ot(c*MA(l,r),r),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>MA(c,r),sqrt:n.sqrt||(c=>(o||(o=Hde(r)),o(a,c))),invertBatch:c=>Wde(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>t?yy(c,i):gy(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return t?kd(c):Id(c)}});return Object.freeze(a)}function uq(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function hq(r){const e=uq(r);return e+Math.ceil(e/2)}function Qde(r,e,t=!1){const n=r.length,s=uq(e),i=hq(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=t?kd(r):Id(r),a=Ot(o,e-Yt)+Yt;return t?yy(a,s):gy(a,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const fR=BigInt(0),$A=BigInt(1);function H9(r,e){const t=e.negate();return r?t:e}function dq(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function K9(r,e){dq(r,e);const t=Math.ceil(e/r)+1,n=2**(r-1),s=2**r,i=q5(r),o=BigInt(r);return{windows:t,windowSize:n,mask:i,maxNumber:s,shiftBy:o}}function pR(r,e,t){const{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=t;let a=Number(r&s),c=r>>o;a>n&&(a-=i,c+=$A);const l=e*n,u=l+Math.abs(a)-1,d=a===0,p=a<0,y=e%2!==0;return{nextN:c,offset:u,isZero:d,isNeg:p,isNegF:y,offsetF:l}}function Jde(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function Yde(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}const G9=new WeakMap,fq=new WeakMap;function j9(r){return fq.get(r)||1}function pq(r,e){return{constTimeNegate:H9,hasPrecomputes(t){return j9(t)!==1},unsafeLadder(t,n,s=r.ZERO){let i=t;for(;n>fR;)n&$A&&(s=s.add(i)),i=i.double(),n>>=$A;return s},precomputeWindow(t,n){const{windows:s,windowSize:i}=K9(n,e),o=[];let a=t,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<i;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,n,s){let i=r.ZERO,o=r.BASE;const a=K9(t,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:u,isZero:d,isNeg:p,isNegF:y,offsetF:f}=pR(s,c,a);s=l,d?o=o.add(H9(y,n[f])):i=i.add(H9(p,n[u]))}return{p:i,f:o}},wNAFUnsafe(t,n,s,i=r.ZERO){const o=K9(t,e);for(let a=0;a<o.windows&&s!==fR;a++){const{nextN:c,offset:l,isZero:u,isNeg:d}=pR(s,a,o);if(s=c,!u){const p=n[l];i=i.add(d?p.negate():p)}}return i},getPrecomputes(t,n,s){let i=G9.get(n);return i||(i=this.precomputeWindow(n,t),t!==1&&G9.set(n,s(i))),i},wNAFCached(t,n,s){const i=j9(t);return this.wNAF(i,this.getPrecomputes(i,t,s),n)},wNAFCachedUnsafe(t,n,s,i){const o=j9(t);return o===1?this.unsafeLadder(t,n,i):this.wNAFUnsafe(o,this.getPrecomputes(o,t,s),n,i)},setWindowSize(t,n){dq(n,e),fq.set(t,n),G9.delete(t)}}}function gq(r,e,t,n){if(Jde(t,r),Yde(n,e),t.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const s=r.ZERO,i=Lde(BigInt(t.length)),o=i>12?i-3:i>4?i-2:i?2:1,a=q5(o),c=new Array(Number(a)+1).fill(s),l=Math.floor((e.BITS-1)/o)*o;let u=s;for(let d=l;d>=0;d-=o){c.fill(s);for(let y=0;y<n.length;y++){const f=n[y],g=Number(f>>BigInt(d)&a);c[g]=c[g].add(t[y])}let p=s;for(let y=c.length-1,f=s;y>0;y--)f=f.add(c[y]),p=p.add(f);if(u=u.add(p),d!==0)for(let y=0;y<o;y++)u=u.double()}return u}function h_(r){return jde(r.Fp),Q1(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...lq(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Fo=BigInt(0),Rn=BigInt(1),gR=BigInt(2),Xde=BigInt(8),Zde={zip215:!0};function efe(r){const e=h_(r);return Q1(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function tfe(r){const e=efe(r),{Fp:t,n,prehash:s,hash:i,randomBytes:o,nByteLength:a,h:c}=e,l=gR<<BigInt(a*8)-Rn,u=t.create,d=W5(e.n,e.nBitLength),p=e.uvRatio||((G,$)=>{try{return{isValid:!0,value:t.sqrt(G*t.inv($))}}catch{return{isValid:!1,value:Fo}}}),y=e.adjustScalarBytes||(G=>G),f=e.domain||((G,$,z)=>{if(ku("phflag",z),$.length||z)throw new Error("Contexts/pre-hash are not supported");return G});function g(G,$,z=!1){const W=z?Rn:Fo;Gs("coordinate "+G,$,W,l)}function w(G){if(!(G instanceof v))throw new Error("ExtendedPoint expected")}const m=_8((G,$)=>{const{ex:z,ey:W,ez:ee}=G,J=G.is0();$==null&&($=J?Xde:t.inv(ee));const le=u(z*$),ye=u(W*$),de=u(ee*$);if(J)return{x:Fo,y:Rn};if(de!==Rn)throw new Error("invZ was invalid");return{x:le,y:ye}}),b=_8(G=>{const{a:$,d:z}=e;if(G.is0())throw new Error("bad point: ZERO");const{ex:W,ey:ee,ez:J,et:le}=G,ye=u(W*W),de=u(ee*ee),fe=u(J*J),De=u(fe*fe),$e=u(ye*$),qe=u(fe*u($e+de)),et=u(De+u(z*u(ye*de)));if(qe!==et)throw new Error("bad point: equation left != right (1)");const Nt=u(W*ee),bt=u(J*le);if(Nt!==bt)throw new Error("bad point: equation left != right (2)");return!0});class v{constructor($,z,W,ee){g("x",$),g("y",z),g("z",W,!0),g("t",ee),this.ex=$,this.ey=z,this.ez=W,this.et=ee,Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine($){if($ instanceof v)throw new Error("extended point not allowed");const{x:z,y:W}=$||{};return g("x",z),g("y",W),new v(z,W,Rn,u(z*W))}static normalizeZ($){const z=t.invertBatch($.map(W=>W.ez));return $.map((W,ee)=>W.toAffine(z[ee])).map(v.fromAffine)}static msm($,z){return gq(v,d,$,z)}_setWindowSize($){I.setWindowSize(this,$)}assertValidity(){b(this)}equals($){w($);const{ex:z,ey:W,ez:ee}=this,{ex:J,ey:le,ez:ye}=$,de=u(z*ye),fe=u(J*ee),De=u(W*ye),$e=u(le*ee);return de===fe&&De===$e}is0(){return this.equals(v.ZERO)}negate(){return new v(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:$}=e,{ex:z,ey:W,ez:ee}=this,J=u(z*z),le=u(W*W),ye=u(gR*u(ee*ee)),de=u($*J),fe=z+W,De=u(u(fe*fe)-J-le),$e=de+le,qe=$e-ye,et=de-le,Nt=u(De*qe),bt=u($e*et),at=u(De*et),Ut=u(qe*$e);return new v(Nt,bt,Ut,at)}add($){w($);const{a:z,d:W}=e,{ex:ee,ey:J,ez:le,et:ye}=this,{ex:de,ey:fe,ez:De,et:$e}=$,qe=u(ee*de),et=u(J*fe),Nt=u(ye*W*$e),bt=u(le*De),at=u((ee+J)*(de+fe)-qe-et),Ut=bt-Nt,kr=bt+Nt,Ro=u(et-z*qe),nl=u(at*Ut),Df=u(kr*Ro),Of=u(at*Ro),dh=u(Ut*kr);return new v(nl,Df,dh,Of)}subtract($){return this.add($.negate())}wNAF($){return I.wNAFCached(this,$,v.normalizeZ)}multiply($){const z=$;Gs("scalar",z,Rn,n);const{p:W,f:ee}=this.wNAF(z);return v.normalizeZ([W,ee])[0]}multiplyUnsafe($,z=v.ZERO){const W=$;return Gs("scalar",W,Fo,n),W===Fo?S:this.is0()||W===Rn?this:I.wNAFCachedUnsafe(this,W,v.normalizeZ,z)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return I.unsafeLadder(this,n).is0()}toAffine($){return m(this,$)}clearCofactor(){const{h:$}=e;return $===Rn?this:this.multiplyUnsafe($)}static fromHex($,z=!1){const{d:W,a:ee}=e,J=t.BYTES;$=or("pointHex",$,J),ku("zip215",z);const le=$.slice(),ye=$[J-1];le[J-1]=ye&-129;const de=kd(le),fe=z?l:t.ORDER;Gs("pointHex.y",de,Fo,fe);const De=u(de*de),$e=u(De-Rn),qe=u(W*De-ee);let{isValid:et,value:Nt}=p($e,qe);if(!et)throw new Error("Point.fromHex: invalid y coordinate");const bt=(Nt&Rn)===Rn,at=(ye&128)!==0;if(!z&&Nt===Fo&&at)throw new Error("Point.fromHex: x=0 and x_0=1");return at!==bt&&(Nt=u(-Nt)),v.fromAffine({x:Nt,y:de})}static fromPrivateKey($){const{scalar:z}=P($);return E.multiply(z)}toRawBytes(){const{x:$,y:z}=this.toAffine(),W=yy(z,t.BYTES);return W[W.length-1]|=$&Rn?128:0,W}toHex(){return t1(this.toRawBytes())}}v.BASE=new v(e.Gx,e.Gy,Rn,u(e.Gx*e.Gy)),v.ZERO=new v(Fo,Rn,Rn,Fo);const{BASE:E,ZERO:S}=v,I=pq(v,a*8);function x(G){return Ot(G,n)}function C(G){return x(kd(G))}function P(G){const $=t.BYTES;G=or("private key",G,$);const z=or("hashed private key",i(G),2*$),W=y(z.slice(0,$)),ee=z.slice($,2*$),J=C(W);return{head:W,prefix:ee,scalar:J}}function L(G){const{head:$,prefix:z,scalar:W}=P(G),ee=E.multiply(W),J=ee.toRawBytes();return{head:$,prefix:z,scalar:W,point:ee,pointBytes:J}}function K(G){return L(G).pointBytes}function V(G=new Uint8Array,...$){const z=r1(...$);return C(i(f(z,or("context",G),!!s)))}function Z(G,$,z={}){G=or("message",G),s&&(G=s(G));const{prefix:W,scalar:ee,pointBytes:J}=L($),le=V(z.context,W,G),ye=E.multiply(le).toRawBytes(),de=V(z.context,ye,J,G),fe=x(le+de*ee);Gs("signature.s",fe,Fo,n);const De=r1(ye,yy(fe,t.BYTES));return or("result",De,t.BYTES*2)}const Y=Zde;function U(G,$,z,W=Y){const{context:ee,zip215:J}=W,le=t.BYTES;G=or("signature",G,2*le),$=or("message",$),z=or("publicKey",z,le),J!==void 0&&ku("zip215",J),s&&($=s($));const ye=kd(G.slice(le,2*le));let de,fe,De;try{de=v.fromHex(z,J),fe=v.fromHex(G.slice(0,le),J),De=E.multiplyUnsafe(ye)}catch{return!1}if(!J&&de.isSmallOrder())return!1;const $e=V(ee,fe.toRawBytes(),de.toRawBytes(),$);return fe.add(de.multiplyUnsafe($e)).subtract(De).clearCofactor().equals(v.ZERO)}return E._setWindowSize(8),{CURVE:e,getPublicKey:K,sign:Z,verify:U,ExtendedPoint:v,utils:{getExtendedPublicKey:L,randomPrivateKey:()=>o(t.BYTES),precompute(G=8,$=v.BASE){return $._setWindowSize(G),$.multiply(BigInt(3)),$}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Kf=BigInt(0),q9=BigInt(1);function rfe(r){return Q1(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function nfe(r){const e=rfe(r),{P:t}=e,n=b=>Ot(b,t),s=e.montgomeryBits,i=Math.ceil(s/8),o=e.nByteLength,a=e.adjustScalarBytes||(b=>b),c=e.powPminus2||(b=>cq(b,t-BigInt(2),t));function l(b,v,E){const S=n(b*(v-E));return v=n(v-S),E=n(E+S),[v,E]}const u=(e.a-BigInt(2))/BigInt(4);function d(b,v){Gs("u",b,Kf,t),Gs("scalar",v,Kf,t);const E=v,S=b;let I=q9,x=Kf,C=b,P=q9,L=Kf,K;for(let Z=BigInt(s-1);Z>=Kf;Z--){const Y=E>>Z&q9;L^=Y,K=l(L,I,C),I=K[0],C=K[1],K=l(L,x,P),x=K[0],P=K[1],L=Y;const U=I+x,H=n(U*U),G=I-x,$=n(G*G),z=H-$,W=C+P,ee=C-P,J=n(ee*U),le=n(W*G),ye=J+le,de=J-le;C=n(ye*ye),P=n(S*n(de*de)),I=n(H*$),x=n(z*(H+n(u*z)))}K=l(L,I,C),I=K[0],C=K[1],K=l(L,x,P),x=K[0],P=K[1];const V=c(x);return n(I*V)}function p(b){return yy(n(b),i)}function y(b){const v=or("u coordinate",b,i);return o===32&&(v[31]&=127),kd(v)}function f(b){const v=or("scalar",b),E=v.length;if(E!==i&&E!==o){let S=""+i+" or "+o;throw new Error("invalid scalar, expected "+S+" bytes, got "+E)}return kd(a(v))}function g(b,v){const E=y(v),S=f(b),I=d(E,S);if(I===Kf)throw new Error("invalid private or public key received");return p(I)}const w=p(e.Gu);function m(b){return g(b,w)}return{scalarMult:g,scalarMultBase:m,getSharedSecret:(b,v)=>g(b,v),getPublicKey:b=>m(b),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:w}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const my=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),yR=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const sfe=BigInt(1),mR=BigInt(2),ife=BigInt(3),ofe=BigInt(5),afe=BigInt(8);function yq(r){const e=BigInt(10),t=BigInt(20),n=BigInt(40),s=BigInt(80),i=my,a=r*r%i*r%i,c=Qt(a,mR,i)*a%i,l=Qt(c,sfe,i)*r%i,u=Qt(l,ofe,i)*l%i,d=Qt(u,e,i)*u%i,p=Qt(d,t,i)*d%i,y=Qt(p,n,i)*p%i,f=Qt(y,s,i)*y%i,g=Qt(f,s,i)*y%i,w=Qt(g,e,i)*u%i;return{pow_p_5_8:Qt(w,mR,i)*r%i,b2:a}}function mq(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function cfe(r,e){const t=my,n=Ot(e*e*e,t),s=Ot(n*n*e,t),i=yq(r*s).pow_p_5_8;let o=Ot(r*n*i,t);const a=Ot(e*o*o,t),c=o,l=Ot(o*yR,t),u=a===r,d=a===Ot(-r,t),p=a===Ot(-r*yR,t);return u&&(o=c),(d||p)&&(o=l),Kde(o,t)&&(o=Ot(-o,t)),{isValid:u||d,value:o}}const wR=W5(my,void 0,!0),lfe={a:wR.create(BigInt(-1)),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:wR,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:afe,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Mde,randomBytes:a_,adjustScalarBytes:mq,uvRatio:cfe},P8=tfe(lfe),qw=nfe({P:my,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{const e=my,{pow_p_5_8:t,b2:n}=yq(r);return Ot(Qt(t,ife,e)*n,e)},adjustScalarBytes:mq,randomBytes:a_}),wy=32,qa=64,LA=32;function ufe(){const r=P8.utils.randomPrivateKey(),e=P8.getPublicKey(r);return{privateKey:ffe(r,e),publicKey:e}}function hfe(r,e){const t=r.subarray(0,LA);return P8.sign(e instanceof Uint8Array?e:e.subarray(),t)}function dfe(r,e,t){return P8.verify(e,t instanceof Uint8Array?t:t.subarray(),r)}function ffe(r,e){const t=new Uint8Array(qa);for(let n=0;n<LA;n++)t[n]=r[n],t[LA+n]=e[n];return t}class wq{constructor(e){h(this,"type","Ed25519");h(this,"raw");this.raw=by(e,wy)}toMultihash(){return s_.digest($i(this))}toCID(){return H5.createV1(114,this.toMultihash())}toString(){return _i.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:rt(this.raw,e.raw)}verify(e,t){return dfe(this.raw,t,e)}}class UA{constructor(e,t){h(this,"type","Ed25519");h(this,"raw");h(this,"publicKey");this.raw=by(e,qa),this.publicKey=new wq(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:rt(this.raw,e.raw)}sign(e){return hfe(this.raw,e)}}function bq(r){if(r.length>qa){r=by(r,qa+wy);const n=r.subarray(0,qa),s=r.subarray(qa,r.length);return new UA(n,s)}r=by(r,qa);const e=r.subarray(0,qa),t=r.subarray(wy);return new UA(e,t)}function d_(r){return r=by(r,wy),new wq(r)}async function pfe(){const{privateKey:r,publicKey:e}=ufe();return new UA(r,e)}function by(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new ie(`Key must be a Uint8Array of length ${e}, got ${r.length}`);return r}const gfe=Math.pow(2,7),yfe=Math.pow(2,14),mfe=Math.pow(2,21),f_=Math.pow(2,28),p_=Math.pow(2,35),g_=Math.pow(2,42),y_=Math.pow(2,49),vt=128,In=127;function kt(r){if(r<gfe)return 1;if(r<yfe)return 2;if(r<mfe)return 3;if(r<f_)return 4;if(r<p_)return 5;if(r<g_)return 6;if(r<y_)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function vq(r,e,t=0){switch(kt(r)){case 8:e[t++]=r&255|vt,r/=128;case 7:e[t++]=r&255|vt,r/=128;case 6:e[t++]=r&255|vt,r/=128;case 5:e[t++]=r&255|vt,r/=128;case 4:e[t++]=r&255|vt,r>>>=7;case 3:e[t++]=r&255|vt,r>>>=7;case 2:e[t++]=r&255|vt,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function wfe(r,e,t=0){switch(kt(r)){case 8:e.set(t++,r&255|vt),r/=128;case 7:e.set(t++,r&255|vt),r/=128;case 6:e.set(t++,r&255|vt),r/=128;case 5:e.set(t++,r&255|vt),r/=128;case 4:e.set(t++,r&255|vt),r>>>=7;case 3:e.set(t++,r&255|vt),r>>>=7;case 2:e.set(t++,r&255|vt),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function Eq(r,e){let t=r[e],n=0;if(n+=t&In,t<vt||(t=r[e+1],n+=(t&In)<<7,t<vt)||(t=r[e+2],n+=(t&In)<<14,t<vt)||(t=r[e+3],n+=(t&In)<<21,t<vt)||(t=r[e+4],n+=(t&In)*f_,t<vt)||(t=r[e+5],n+=(t&In)*p_,t<vt)||(t=r[e+6],n+=(t&In)*g_,t<vt)||(t=r[e+7],n+=(t&In)*y_,t<vt))return n;throw new RangeError("Could not decode varint")}function bfe(r,e){let t=r.get(e),n=0;if(n+=t&In,t<vt||(t=r.get(e+1),n+=(t&In)<<7,t<vt)||(t=r.get(e+2),n+=(t&In)<<14,t<vt)||(t=r.get(e+3),n+=(t&In)<<21,t<vt)||(t=r.get(e+4),n+=(t&In)*f_,t<vt)||(t=r.get(e+5),n+=(t&In)*p_,t<vt)||(t=r.get(e+6),n+=(t&In)*g_,t<vt)||(t=r.get(e+7),n+=(t&In)*y_,t<vt))return n;throw new RangeError("Could not decode varint")}function Jr(r,e,t=0){return e==null&&(e=Ss(kt(r))),e instanceof Uint8Array?vq(r,e,t):wfe(r,e,t)}function Po(r,e=0){return r instanceof Uint8Array?Eq(r,e):bfe(r,e)}const m_=new Float32Array([-0]),uu=new Uint8Array(m_.buffer);function vfe(r,e,t){m_[0]=r,e[t]=uu[0],e[t+1]=uu[1],e[t+2]=uu[2],e[t+3]=uu[3]}function Efe(r,e){return uu[0]=r[e],uu[1]=r[e+1],uu[2]=r[e+2],uu[3]=r[e+3],m_[0]}const w_=new Float64Array([-0]),kn=new Uint8Array(w_.buffer);function xfe(r,e,t){w_[0]=r,e[t]=kn[0],e[t+1]=kn[1],e[t+2]=kn[2],e[t+3]=kn[3],e[t+4]=kn[4],e[t+5]=kn[5],e[t+6]=kn[6],e[t+7]=kn[7]}function Afe(r,e){return kn[0]=r[e],kn[1]=r[e+1],kn[2]=r[e+2],kn[3]=r[e+3],kn[4]=r[e+4],kn[5]=r[e+5],kn[6]=r[e+6],kn[7]=r[e+7],w_[0]}const Sfe=BigInt(Number.MAX_SAFE_INTEGER),Cfe=BigInt(Number.MIN_SAFE_INTEGER);class _n{constructor(e,t){h(this,"lo");h(this,"hi");this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return Td;if(e<Sfe&&e>Cfe)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let n=e>>32n,s=e-(n<<32n);return t&&(n=~n|0n,s=~s|0n,++s>bR&&(s=0n,++n>bR&&(n=0n))),new _n(Number(s),Number(n))}static fromNumber(e){if(e===0)return Td;const t=e<0;t&&(e=-e);let n=e>>>0,s=(e-n)/4294967296>>>0;return t&&(s=~s>>>0,n=~n>>>0,++n>4294967295&&(n=0,++s>4294967295&&(s=0))),new _n(n,s)}static from(e){return typeof e=="number"?_n.fromNumber(e):typeof e=="bigint"?_n.fromBigInt(e):typeof e=="string"?_n.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new _n(e.low>>>0,e.high>>>0):Td}}const Td=new _n(0,0);Td.toBigInt=function(){return 0n};Td.zzEncode=Td.zzDecode=function(){return this};Td.length=function(){return 1};const bR=4294967296n;function Ife(r){let e=0,t=0;for(let n=0;n<r.length;++n)t=r.charCodeAt(n),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function kfe(r,e,t){if(t-e<1)return"";let s;const i=[];let o=0,a;for(;e<t;)a=r[e++],a<128?i[o++]=a:a>191&&a<224?i[o++]=(a&31)<<6|r[e++]&63:a>239&&a<365?(a=((a&7)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,i[o++]=55296+(a>>10),i[o++]=56320+(a&1023)):i[o++]=(a&15)<<12|(r[e++]&63)<<6|r[e++]&63,o>8191&&((s??(s=[])).push(String.fromCharCode.apply(String,i)),o=0);return s!=null?(o>0&&s.push(String.fromCharCode.apply(String,i.slice(0,o))),s.join("")):String.fromCharCode.apply(String,i.slice(0,o))}function xq(r,e,t){const n=t;let s,i;for(let o=0;o<r.length;++o)s=r.charCodeAt(o),s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&((i=r.charCodeAt(o+1))&64512)===56320?(s=65536+((s&1023)<<10)+(i&1023),++o,e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128);return t-n}function Qi(r,e){return RangeError(`index out of range: ${r.pos} + ${e??1} > ${r.len}`)}function Ww(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}class Tfe{constructor(e){h(this,"buf");h(this,"pos");h(this,"len");h(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Qi(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Qi(this,4);return Ww(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Qi(this,4);return Ww(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Qi(this,4);const e=Efe(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw Qi(this,4);const e=Afe(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Qi(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){const e=this.bytes();return kfe(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Qi(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Qi(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new _n(0,0);let t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw Qi(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw Qi(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Qi(this,8);const e=Ww(this.buf,this.pos+=4),t=Ww(this.buf,this.pos+=4);return new _n(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=Eq(this.buf,this.pos);return this.pos+=kt(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function _fe(r){return new Tfe(r instanceof Uint8Array?r:r.subarray())}function Le(r,e,t){const n=_fe(r);return e.decode(n,void 0,t)}function Pfe(r){let n,s=8192;return function(o){if(o<1||o>4096)return Ss(o);s+o>8192&&(n=Ss(8192),s=0);const a=n.subarray(s,s+=o);return s&7&&(s=(s|7)+1),a}}class o2{constructor(e,t,n){h(this,"fn");h(this,"len");h(this,"next");h(this,"val");this.fn=e,this.len=t,this.next=void 0,this.val=n}}function W9(){}class Nfe{constructor(e){h(this,"head");h(this,"tail");h(this,"len");h(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const Dfe=Pfe();function Ofe(r){return globalThis.Buffer!=null?Ss(r):Dfe(r)}class FA{constructor(){h(this,"len");h(this,"head");h(this,"tail");h(this,"states");this.len=0,this.head=new o2(W9,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new o2(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new Bfe((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(Qw,10,_n.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=_n.fromBigInt(e);return this._push(Qw,t.length(),t)}uint64Number(e){return this._push(vq,kt(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=_n.fromBigInt(e).zzEncode();return this._push(Qw,t.length(),t)}sint64Number(e){const t=_n.fromNumber(e).zzEncode();return this._push(Qw,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(Q9,1,e?1:0)}fixed32(e){return this._push($g,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=_n.fromBigInt(e);return this._push($g,4,t.lo)._push($g,4,t.hi)}fixed64Number(e){const t=_n.fromNumber(e);return this._push($g,4,t.lo)._push($g,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(vfe,4,e)}double(e){return this._push(xfe,8,e)}bytes(e){const t=e.length>>>0;return t===0?this._push(Q9,1,0):this.uint32(t)._push(Mfe,t,e)}string(e){const t=Ife(e);return t!==0?this.uint32(t)._push(xq,t,e):this._push(Q9,1,0)}fork(){return this.states=new Nfe(this),this.head=this.tail=new o2(W9,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new o2(W9,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next;const t=Ofe(this.len);let n=0;for(;e!=null;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}}function Q9(r,e,t){e[t]=r&255}function Rfe(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}class Bfe extends o2{constructor(t,n){super(Rfe,t,n);h(this,"next");this.next=void 0}}function Qw(r,e,t){for(;r.hi!==0;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}function $g(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function Mfe(r,e,t){e.set(r,t)}globalThis.Buffer!=null&&(FA.prototype.bytes=function(r){const e=r.length>>>0;return this.uint32(e),e>0&&this._push($fe,e,r),this},FA.prototype.string=function(r){const e=globalThis.Buffer.byteLength(r);return this.uint32(e),e>0&&this._push(Lfe,e,r),this});function $fe(r,e,t){e.set(r,t)}function Lfe(r,e,t){r.length<40?xq(r,e,t):e.utf8Write!=null?e.utf8Write(r,t):e.set(he(r),t)}function Ufe(){return new FA}function Ue(r,e){const t=Ufe();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var N8;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(N8||(N8={}));function Aq(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function Cs(r){function e(s){if(r[s.toString()]==null)throw new Error("Invalid enum value");return r[s]}const t=function(i,o){const a=e(i);o.int32(a)},n=function(i){const o=i.int32();return e(o)};return Aq("enum",N8.VARINT,t,n)}function Fe(r,e){return Aq("message",N8.LENGTH_DELIMITED,r,e)}class It extends Error{constructor(){super(...arguments);h(this,"code","ERR_MAX_LENGTH");h(this,"name","MaxLengthError")}}class vR extends Error{constructor(){super(...arguments);h(this,"code","ERR_MAX_SIZE");h(this,"name","MaxSizeError")}}var qt;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.ECDSA="ECDSA"})(qt||(qt={}));var zA;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1",r[r.ECDSA=3]="ECDSA"})(zA||(zA={}));(function(r){r.codec=()=>Cs(zA)})(qt||(qt={}));var Uu;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),qt.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.Type=qt.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(Uu||(Uu={}));var D8;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),qt.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.Type=qt.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(D8||(D8={}));const Gf=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ffe(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Lp(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function $m(r,...e){if(!Ffe(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Q5(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Lp(r.outputLen),Lp(r.blockLen)}function O8(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function zfe(r,e){$m(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function wa(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function P2(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function zo(r,e){return r<<32-e|r>>>e}function J9(r,e){return r<<e|r>>>32-e>>>0}const Vfe=async()=>{};async function Hfe(r,e,t){let n=Date.now();for(let s=0;s<r;s++){t(s);const i=Date.now()-n;i>=0&&i<e||(await Vfe(),n+=i)}}function Sq(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function vy(r){return typeof r=="string"&&(r=Sq(r)),$m(r),r}function ER(r){return typeof r=="string"&&(r=Sq(r)),$m(r),r}function Kfe(r,e){if(e!==void 0&&{}.toString.call(e)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(r,e)}let Cq=class{};function b_(r){const e=n=>r().update(vy(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Gfe(r=32){if(Gf&&typeof Gf.getRandomValues=="function")return Gf.getRandomValues(new Uint8Array(r));if(Gf&&typeof Gf.randomBytes=="function")return Uint8Array.from(Gf.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function Fu(r){if(isNaN(r)||r<=0)throw new ie("random bytes length must be a Number bigger than 0");return Gfe(r)}class xR extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}}class AR extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class jfe extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}const ba={get(r=globalThis){const e=r.crypto;if((e==null?void 0:e.subtle)==null)throw new jfe("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}};function qfe(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function Iq(r,e,t){return r&e^~r&t}function kq(r,e,t){return r&e^r&t^e&t}class v_ extends Cq{constructor(e,t,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=P2(this.buffer)}update(e){O8(this),e=vy(e),$m(e);const{view:t,buffer:n,blockLen:s}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=P2(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){O8(this),zfe(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;t[o++]=128,wa(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(n,0),o=0);for(let d=o;d<s;d++)t[d]=0;qfe(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=P2(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<l;d++)a.setUint32(4*d,u[d],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=s,e.pos=a,s%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const gl=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),cn=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Jw=BigInt(2**32-1),SR=BigInt(32);function Wfe(r,e=!1){return e?{h:Number(r&Jw),l:Number(r>>SR&Jw)}:{h:Number(r>>SR&Jw)|0,l:Number(r&Jw)|0}}function Qfe(r,e=!1){const t=r.length;let n=new Uint32Array(t),s=new Uint32Array(t);for(let i=0;i<t;i++){const{h:o,l:a}=Wfe(r[i],e);[n[i],s[i]]=[o,a]}return[n,s]}const CR=(r,e,t)=>r>>>t,IR=(r,e,t)=>r<<32-t|e>>>t,jf=(r,e,t)=>r>>>t|e<<32-t,qf=(r,e,t)=>r<<32-t|e>>>t,Yw=(r,e,t)=>r<<64-t|e>>>t-32,Xw=(r,e,t)=>r>>>t-32|e<<64-t;function Ra(r,e,t,n){const s=(e>>>0)+(n>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}const Jfe=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),Yfe=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,Xfe=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),Zfe=(r,e,t,n,s)=>e+t+n+s+(r/2**32|0)|0,epe=(r,e,t,n,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(s>>>0),tpe=(r,e,t,n,s,i)=>e+t+n+s+i+(r/2**32|0)|0,rpe=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),yl=new Uint32Array(64);let npe=class extends v_{constructor(e=32){super(64,e,8,!1),this.A=gl[0]|0,this.B=gl[1]|0,this.C=gl[2]|0,this.D=gl[3]|0,this.E=gl[4]|0,this.F=gl[5]|0,this.G=gl[6]|0,this.H=gl[7]|0}get(){const{A:e,B:t,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,t,n,s,i,o,a,c]}set(e,t,n,s,i,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let d=0;d<16;d++,t+=4)yl[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){const p=yl[d-15],y=yl[d-2],f=zo(p,7)^zo(p,18)^p>>>3,g=zo(y,17)^zo(y,19)^y>>>10;yl[d]=g+yl[d-7]+f+yl[d-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let d=0;d<64;d++){const p=zo(a,6)^zo(a,11)^zo(a,25),y=u+p+Iq(a,c,l)+rpe[d]+yl[d]|0,g=(zo(n,2)^zo(n,13)^zo(n,22))+kq(n,s,i)|0;u=l,l=c,c=a,a=o+y|0,o=i,i=s,s=n,n=y+g|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,s,i,o,a,c,l,u)}roundClean(){wa(yl)}destroy(){this.set(0,0,0,0,0,0,0,0),wa(this.buffer)}};const Tq=Qfe(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),spe=Tq[0],ipe=Tq[1],ml=new Uint32Array(80),wl=new Uint32Array(80);let ope=class extends v_{constructor(e=64){super(128,e,16,!1),this.Ah=cn[0]|0,this.Al=cn[1]|0,this.Bh=cn[2]|0,this.Bl=cn[3]|0,this.Ch=cn[4]|0,this.Cl=cn[5]|0,this.Dh=cn[6]|0,this.Dl=cn[7]|0,this.Eh=cn[8]|0,this.El=cn[9]|0,this.Fh=cn[10]|0,this.Fl=cn[11]|0,this.Gh=cn[12]|0,this.Gl=cn[13]|0,this.Hh=cn[14]|0,this.Hl=cn[15]|0}get(){const{Ah:e,Al:t,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:d,Fl:p,Gh:y,Gl:f,Hh:g,Hl:w}=this;return[e,t,n,s,i,o,a,c,l,u,d,p,y,f,g,w]}set(e,t,n,s,i,o,a,c,l,u,d,p,y,f,g,w){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=d|0,this.Fl=p|0,this.Gh=y|0,this.Gl=f|0,this.Hh=g|0,this.Hl=w|0}process(e,t){for(let v=0;v<16;v++,t+=4)ml[v]=e.getUint32(t),wl[v]=e.getUint32(t+=4);for(let v=16;v<80;v++){const E=ml[v-15]|0,S=wl[v-15]|0,I=jf(E,S,1)^jf(E,S,8)^CR(E,S,7),x=qf(E,S,1)^qf(E,S,8)^IR(E,S,7),C=ml[v-2]|0,P=wl[v-2]|0,L=jf(C,P,19)^Yw(C,P,61)^CR(C,P,6),K=qf(C,P,19)^Xw(C,P,61)^IR(C,P,6),V=Xfe(x,K,wl[v-7],wl[v-16]),Z=Zfe(V,I,L,ml[v-7],ml[v-16]);ml[v]=Z|0,wl[v]=V|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:d,El:p,Fh:y,Fl:f,Gh:g,Gl:w,Hh:m,Hl:b}=this;for(let v=0;v<80;v++){const E=jf(d,p,14)^jf(d,p,18)^Yw(d,p,41),S=qf(d,p,14)^qf(d,p,18)^Xw(d,p,41),I=d&y^~d&g,x=p&f^~p&w,C=epe(b,S,x,ipe[v],wl[v]),P=tpe(C,m,E,I,spe[v],ml[v]),L=C|0,K=jf(n,s,28)^Yw(n,s,34)^Yw(n,s,39),V=qf(n,s,28)^Xw(n,s,34)^Xw(n,s,39),Z=n&i^n&a^i&a,Y=s&o^s&c^o&c;m=g|0,b=w|0,g=y|0,w=f|0,y=d|0,f=p|0,{h:d,l:p}=Ra(l|0,u|0,P|0,L|0),l=a|0,u=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const U=Jfe(L,V,Y);n=Yfe(U,P,K,Z),s=U|0}({h:n,l:s}=Ra(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=Ra(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=Ra(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Ra(this.Dh|0,this.Dl|0,l|0,u|0),{h:d,l:p}=Ra(this.Eh|0,this.El|0,d|0,p|0),{h:y,l:f}=Ra(this.Fh|0,this.Fl|0,y|0,f|0),{h:g,l:w}=Ra(this.Gh|0,this.Gl|0,g|0,w|0),{h:m,l:b}=Ra(this.Hh|0,this.Hl|0,m|0,b|0),this.set(n,s,i,o,a,c,l,u,d,p,y,f,g,w,m,b)}roundClean(){wa(ml,wl)}destroy(){wa(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const ape=b_(()=>new npe),cpe=b_(()=>new ope),_d=ape;let E_=class{constructor(e,t){h(this,"type","RSA");h(this,"jwk");h(this,"_raw");h(this,"_multihash");this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=A_(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return H5.createV1(114,this._multihash)}toString(){return _i.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:rt(this.raw,e.raw)}verify(e,t){return xpe(this.jwk,t,e)}},_q=class{constructor(e,t){h(this,"type","RSA");h(this,"jwk");h(this,"_raw");h(this,"publicKey");this.jwk=e,this.publicKey=t}get raw(){return this._raw==null&&(this._raw=dpe(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:rt(this.raw,e.raw)}sign(e){return Epe(this.jwk,e)}};const Pq=8192,x_=18,lpe=1062,upe=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function hpe(r){return{n:ce(r[1],"base64url"),e:ce(r[2],"base64url"),d:ce(r[3],"base64url"),p:ce(r[4],"base64url"),q:ce(r[5],"base64url"),dp:ce(r[6],"base64url"),dq:ce(r[7],"base64url"),qi:ce(r[8],"base64url"),kty:"RSA"}}function dpe(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new ie("JWK was missing components");return bc([zs(Uint8Array.from([0])),zs(he(r.n,"base64url")),zs(he(r.e,"base64url")),zs(he(r.d,"base64url")),zs(he(r.p,"base64url")),zs(he(r.q,"base64url")),zs(he(r.dp,"base64url")),zs(he(r.dq,"base64url")),zs(he(r.qi,"base64url"))]).subarray()}function fpe(r){const e=ih(r[1],{offset:0});return{kty:"RSA",n:ce(e[0],"base64url"),e:ce(e[1],"base64url")}}function A_(r){if(r.n==null||r.e==null)throw new ie("JWK was missing components");return bc([upe,i_(bc([zs(he(r.n,"base64url")),zs(he(r.e,"base64url"))]))]).subarray()}function ppe(r){const e=ih(r);return Nq(e)}function Nq(r){const e=hpe(r);return ype(e)}function gpe(r,e){if(r.byteLength>=lpe)throw new py("Key size is too large");const t=ih(r,{offset:0});return Dq(t,r,e)}function Dq(r,e,t){const n=fpe(r);if(t==null){const s=_d(Uu.encode({Type:qt.RSA,Data:e}));t=Kd(x_,s)}return new E_(n,t)}function ype(r){if(Spe(r)>Pq)throw new ie("Key size is too large");const e=wpe(r),t=_d(Uu.encode({Type:qt.RSA,Data:A_(e.publicKey)})),n=Kd(x_,t);return new _q(e.privateKey,new E_(e.publicKey,n))}async function mpe(r){if(r>Pq)throw new ie("Key size is too large");const e=await vpe(r),t=_d(Uu.encode({Type:qt.RSA,Data:A_(e.publicKey)})),n=Kd(x_,t);return new _q(e.privateKey,new E_(e.publicKey,n))}function wpe(r){if(r==null)throw new ie("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}const bpe="1.2.840.113549.1.1.1";async function vpe(r){const e=await ba.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await Ape(e);return{privateKey:t[0],publicKey:t[1]}}async function Epe(r,e){const t=await ba.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await ba.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(n,0,n.byteLength)}async function xpe(r,e,t){const n=await ba.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return ba.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,t instanceof Uint8Array?t:t.subarray())}async function Ape(r){if(r.privateKey==null||r.publicKey==null)throw new ie("Private and public key are required");return Promise.all([ba.get().subtle.exportKey("jwk",r.privateKey),ba.get().subtle.exportKey("jwk",r.publicKey)])}function Spe(r){if(r.kty!=="RSA")throw new ie("invalid key type");if(r.n==null)throw new ie("invalid key modulus");return he(r.n,"base64url").length*8}let Oq=class extends rq{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,rde(e);const n=o_(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),i.fill(0)}update(e){return k8(this),this.iHash.update(e),this}digestInto(e){k8(this),j5(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Rq=(r,e,t)=>new Oq(r,e).update(t).digest();Rq.create=(r,e)=>new Oq(r,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function kR(r){r.lowS!==void 0&&ku("lowS",r.lowS),r.prehash!==void 0&&ku("prehash",r.prehash)}function Cpe(r){const e=h_(r);Q1(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:n,a:s}=e;if(t){if(!n.eql(s,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}class Ipe extends Error{constructor(e=""){super(e)}}const Wa={Err:Ipe,_tlv:{encode:(r,e)=>{const{Err:t}=Wa;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const n=e.length/2,s=jw(n);if(s.length/2&128)throw new t("tlv.encode: long form length too big");const i=n>127?jw(s.length/2|128):"";return jw(r)+i+s+e},decode(r,e){const{Err:t}=Wa;let n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");const s=e[n++],i=!!(s&128);let o=0;if(!i)o=s;else{const c=s&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(n+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(r){const{Err:e}=Wa;if(r<uc)throw new e("integer: negative integers are not allowed");let t=jw(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=Wa;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Id(r)}},toSig(r){const{Err:e,_int:t,_tlv:n}=Wa,s=or("signature",r),{v:i,l:o}=n.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:l,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(r){const{_tlv:e,_int:t}=Wa,n=e.encode(2,t.encode(r.r)),s=e.encode(2,t.encode(r.s)),i=n+s;return e.encode(48,i)}},uc=BigInt(0),Pr=BigInt(1);BigInt(2);const TR=BigInt(3);BigInt(4);function kpe(r){const e=Cpe(r),{Fp:t}=e,n=W5(e.n,e.nBitLength),s=e.toBytes||((g,w,m)=>{const b=w.toAffine();return r1(Uint8Array.from([4]),t.toBytes(b.x),t.toBytes(b.y))}),i=e.fromBytes||(g=>{const w=g.subarray(1),m=t.fromBytes(w.subarray(0,t.BYTES)),b=t.fromBytes(w.subarray(t.BYTES,2*t.BYTES));return{x:m,y:b}});function o(g){const{a:w,b:m}=e,b=t.sqr(g),v=t.mul(b,g);return t.add(t.add(v,t.mul(g,w)),m)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(g){return u_(g,Pr,e.n)}function c(g){const{allowedPrivateKeyLengths:w,nByteLength:m,wrapPrivateKey:b,n:v}=e;if(w&&typeof g!="bigint"){if(e1(g)&&(g=t1(g)),typeof g!="string"||!w.includes(g.length))throw new Error("invalid private key");g=g.padStart(m*2,"0")}let E;try{E=typeof g=="bigint"?g:Id(or("private key",g,m))}catch{throw new Error("invalid private key, expected hex or "+m+" bytes, got "+typeof g)}return b&&(E=Ot(E,v)),Gs("private key",E,Pr,v),E}function l(g){if(!(g instanceof p))throw new Error("ProjectivePoint expected")}const u=_8((g,w)=>{const{px:m,py:b,pz:v}=g;if(t.eql(v,t.ONE))return{x:m,y:b};const E=g.is0();w==null&&(w=E?t.ONE:t.inv(v));const S=t.mul(m,w),I=t.mul(b,w),x=t.mul(v,w);if(E)return{x:t.ZERO,y:t.ZERO};if(!t.eql(x,t.ONE))throw new Error("invZ was invalid");return{x:S,y:I}}),d=_8(g=>{if(g.is0()){if(e.allowInfinityPoint&&!t.is0(g.py))return;throw new Error("bad point: ZERO")}const{x:w,y:m}=g.toAffine();if(!t.isValid(w)||!t.isValid(m))throw new Error("bad point: x or y not FE");const b=t.sqr(m),v=o(w);if(!t.eql(b,v))throw new Error("bad point: equation left != right");if(!g.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class p{constructor(w,m,b){if(w==null||!t.isValid(w))throw new Error("x required");if(m==null||!t.isValid(m))throw new Error("y required");if(b==null||!t.isValid(b))throw new Error("z required");this.px=w,this.py=m,this.pz=b,Object.freeze(this)}static fromAffine(w){const{x:m,y:b}=w||{};if(!w||!t.isValid(m)||!t.isValid(b))throw new Error("invalid affine point");if(w instanceof p)throw new Error("projective point not allowed");const v=E=>t.eql(E,t.ZERO);return v(m)&&v(b)?p.ZERO:new p(m,b,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(w){const m=t.invertBatch(w.map(b=>b.pz));return w.map((b,v)=>b.toAffine(m[v])).map(p.fromAffine)}static fromHex(w){const m=p.fromAffine(i(or("pointHex",w)));return m.assertValidity(),m}static fromPrivateKey(w){return p.BASE.multiply(c(w))}static msm(w,m){return gq(p,n,w,m)}_setWindowSize(w){f.setWindowSize(this,w)}assertValidity(){d(this)}hasEvenY(){const{y:w}=this.toAffine();if(t.isOdd)return!t.isOdd(w);throw new Error("Field doesn't support isOdd")}equals(w){l(w);const{px:m,py:b,pz:v}=this,{px:E,py:S,pz:I}=w,x=t.eql(t.mul(m,I),t.mul(E,v)),C=t.eql(t.mul(b,I),t.mul(S,v));return x&&C}negate(){return new p(this.px,t.neg(this.py),this.pz)}double(){const{a:w,b:m}=e,b=t.mul(m,TR),{px:v,py:E,pz:S}=this;let I=t.ZERO,x=t.ZERO,C=t.ZERO,P=t.mul(v,v),L=t.mul(E,E),K=t.mul(S,S),V=t.mul(v,E);return V=t.add(V,V),C=t.mul(v,S),C=t.add(C,C),I=t.mul(w,C),x=t.mul(b,K),x=t.add(I,x),I=t.sub(L,x),x=t.add(L,x),x=t.mul(I,x),I=t.mul(V,I),C=t.mul(b,C),K=t.mul(w,K),V=t.sub(P,K),V=t.mul(w,V),V=t.add(V,C),C=t.add(P,P),P=t.add(C,P),P=t.add(P,K),P=t.mul(P,V),x=t.add(x,P),K=t.mul(E,S),K=t.add(K,K),P=t.mul(K,V),I=t.sub(I,P),C=t.mul(K,L),C=t.add(C,C),C=t.add(C,C),new p(I,x,C)}add(w){l(w);const{px:m,py:b,pz:v}=this,{px:E,py:S,pz:I}=w;let x=t.ZERO,C=t.ZERO,P=t.ZERO;const L=e.a,K=t.mul(e.b,TR);let V=t.mul(m,E),Z=t.mul(b,S),Y=t.mul(v,I),U=t.add(m,b),H=t.add(E,S);U=t.mul(U,H),H=t.add(V,Z),U=t.sub(U,H),H=t.add(m,v);let G=t.add(E,I);return H=t.mul(H,G),G=t.add(V,Y),H=t.sub(H,G),G=t.add(b,v),x=t.add(S,I),G=t.mul(G,x),x=t.add(Z,Y),G=t.sub(G,x),P=t.mul(L,H),x=t.mul(K,Y),P=t.add(x,P),x=t.sub(Z,P),P=t.add(Z,P),C=t.mul(x,P),Z=t.add(V,V),Z=t.add(Z,V),Y=t.mul(L,Y),H=t.mul(K,H),Z=t.add(Z,Y),Y=t.sub(V,Y),Y=t.mul(L,Y),H=t.add(H,Y),V=t.mul(Z,H),C=t.add(C,V),V=t.mul(G,H),x=t.mul(U,x),x=t.sub(x,V),V=t.mul(U,Z),P=t.mul(G,P),P=t.add(P,V),new p(x,C,P)}subtract(w){return this.add(w.negate())}is0(){return this.equals(p.ZERO)}wNAF(w){return f.wNAFCached(this,w,p.normalizeZ)}multiplyUnsafe(w){const{endo:m,n:b}=e;Gs("scalar",w,uc,b);const v=p.ZERO;if(w===uc)return v;if(this.is0()||w===Pr)return this;if(!m||f.hasPrecomputes(this))return f.wNAFCachedUnsafe(this,w,p.normalizeZ);let{k1neg:E,k1:S,k2neg:I,k2:x}=m.splitScalar(w),C=v,P=v,L=this;for(;S>uc||x>uc;)S&Pr&&(C=C.add(L)),x&Pr&&(P=P.add(L)),L=L.double(),S>>=Pr,x>>=Pr;return E&&(C=C.negate()),I&&(P=P.negate()),P=new p(t.mul(P.px,m.beta),P.py,P.pz),C.add(P)}multiply(w){const{endo:m,n:b}=e;Gs("scalar",w,Pr,b);let v,E;if(m){const{k1neg:S,k1:I,k2neg:x,k2:C}=m.splitScalar(w);let{p:P,f:L}=this.wNAF(I),{p:K,f:V}=this.wNAF(C);P=f.constTimeNegate(S,P),K=f.constTimeNegate(x,K),K=new p(t.mul(K.px,m.beta),K.py,K.pz),v=P.add(K),E=L.add(V)}else{const{p:S,f:I}=this.wNAF(w);v=S,E=I}return p.normalizeZ([v,E])[0]}multiplyAndAddUnsafe(w,m,b){const v=p.BASE,E=(I,x)=>x===uc||x===Pr||!I.equals(v)?I.multiplyUnsafe(x):I.multiply(x),S=E(this,m).add(E(w,b));return S.is0()?void 0:S}toAffine(w){return u(this,w)}isTorsionFree(){const{h:w,isTorsionFree:m}=e;if(w===Pr)return!0;if(m)return m(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:w,clearCofactor:m}=e;return w===Pr?this:m?m(p,this):this.multiplyUnsafe(e.h)}toRawBytes(w=!0){return ku("isCompressed",w),this.assertValidity(),s(p,this,w)}toHex(w=!0){return ku("isCompressed",w),t1(this.toRawBytes(w))}}p.BASE=new p(e.Gx,e.Gy,t.ONE),p.ZERO=new p(t.ZERO,t.ONE,t.ZERO);const y=e.nBitLength,f=pq(p,e.endo?Math.ceil(y/2):y);return{CURVE:e,ProjectivePoint:p,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function Tpe(r){const e=h_(r);return Q1(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function _pe(r){const e=Tpe(r),{Fp:t,n}=e,s=t.BYTES+1,i=2*t.BYTES+1;function o(Y){return Ot(Y,n)}function a(Y){return MA(Y,n)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:d}=kpe({...e,toBytes(Y,U,H){const G=U.toAffine(),$=t.toBytes(G.x),z=r1;return ku("isCompressed",H),H?z(Uint8Array.from([U.hasEvenY()?2:3]),$):z(Uint8Array.from([4]),$,t.toBytes(G.y))},fromBytes(Y){const U=Y.length,H=Y[0],G=Y.subarray(1);if(U===s&&(H===2||H===3)){const $=Id(G);if(!u_($,Pr,t.ORDER))throw new Error("Point is not on curve");const z=u($);let W;try{W=t.sqrt(z)}catch(le){const ye=le instanceof Error?": "+le.message:"";throw new Error("Point is not on curve"+ye)}const ee=(W&Pr)===Pr;return(H&1)===1!==ee&&(W=t.neg(W)),{x:$,y:W}}else if(U===i&&H===4){const $=t.fromBytes(G.subarray(0,t.BYTES)),z=t.fromBytes(G.subarray(t.BYTES,2*t.BYTES));return{x:$,y:z}}else{const $=s,z=i;throw new Error("invalid Point, expected length of "+$+", or uncompressed "+z+", got "+U)}}}),p=Y=>t1(gy(Y,e.nByteLength));function y(Y){const U=n>>Pr;return Y>U}function f(Y){return y(Y)?o(-Y):Y}const g=(Y,U,H)=>Id(Y.slice(U,H));class w{constructor(U,H,G){Gs("r",U,Pr,n),Gs("s",H,Pr,n),this.r=U,this.s=H,G!=null&&(this.recovery=G),Object.freeze(this)}static fromCompact(U){const H=e.nByteLength;return U=or("compactSignature",U,H*2),new w(g(U,0,H),g(U,H,2*H))}static fromDER(U){const{r:H,s:G}=Wa.toSig(or("DER",U));return new w(H,G)}assertValidity(){}addRecoveryBit(U){return new w(this.r,this.s,U)}recoverPublicKey(U){const{r:H,s:G,recovery:$}=this,z=I(or("msgHash",U));if($==null||![0,1,2,3].includes($))throw new Error("recovery id invalid");const W=$===2||$===3?H+e.n:H;if(W>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const ee=$&1?"03":"02",J=c.fromHex(ee+p(W)),le=a(W),ye=o(-z*le),de=o(G*le),fe=c.BASE.multiplyAndAddUnsafe(J,ye,de);if(!fe)throw new Error("point at infinify");return fe.assertValidity(),fe}hasHighS(){return y(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return T8(this.toDERHex())}toDERHex(){return Wa.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return T8(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}}const m={isValidPrivateKey(Y){try{return l(Y),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const Y=hq(e.n);return Qde(e.randomBytes(Y),e.n)},precompute(Y=8,U=c.BASE){return U._setWindowSize(Y),U.multiply(BigInt(3)),U}};function b(Y,U=!0){return c.fromPrivateKey(Y).toRawBytes(U)}function v(Y){const U=e1(Y),H=typeof Y=="string",G=(U||H)&&Y.length;return U?G===s||G===i:H?G===2*s||G===2*i:Y instanceof c}function E(Y,U,H=!0){if(v(Y))throw new Error("first arg must be private key");if(!v(U))throw new Error("second arg must be public key");return c.fromHex(U).multiply(l(Y)).toRawBytes(H)}const S=e.bits2int||function(Y){if(Y.length>8192)throw new Error("input is too large");const U=Id(Y),H=Y.length*8-e.nBitLength;return H>0?U>>BigInt(H):U},I=e.bits2int_modN||function(Y){return o(S(Y))},x=q5(e.nBitLength);function C(Y){return Gs("num < 2^"+e.nBitLength,Y,uc,x),gy(Y,e.nByteLength)}function P(Y,U,H=L){if(["recovered","canonical"].some($e=>$e in H))throw new Error("sign() legacy options not supported");const{hash:G,randomBytes:$}=e;let{lowS:z,prehash:W,extraEntropy:ee}=H;z==null&&(z=!0),Y=or("msgHash",Y),kR(H),W&&(Y=or("prehashed msgHash",G(Y)));const J=I(Y),le=l(U),ye=[C(le),C(J)];if(ee!=null&&ee!==!1){const $e=ee===!0?$(t.BYTES):ee;ye.push(or("extraEntropy",$e))}const de=r1(...ye),fe=J;function De($e){const qe=S($e);if(!d(qe))return;const et=a(qe),Nt=c.BASE.multiply(qe).toAffine(),bt=o(Nt.x);if(bt===uc)return;const at=o(et*o(fe+bt*le));if(at===uc)return;let Ut=(Nt.x===bt?0:2)|Number(Nt.y&Pr),kr=at;return z&&y(at)&&(kr=f(at),Ut^=1),new w(bt,kr,Ut)}return{seed:de,k2sig:De}}const L={lowS:e.lowS,prehash:!1},K={lowS:e.lowS,prehash:!1};function V(Y,U,H=L){const{seed:G,k2sig:$}=P(Y,U,H),z=e;return Ude(z.hash.outputLen,z.nByteLength,z.hmac)(G,$)}c.BASE._setWindowSize(8);function Z(Y,U,H,G=K){var Ut;const $=Y;U=or("msgHash",U),H=or("publicKey",H);const{lowS:z,prehash:W,format:ee}=G;if(kR(G),"strict"in G)throw new Error("options.strict was renamed to lowS");if(ee!==void 0&&ee!=="compact"&&ee!=="der")throw new Error("format must be compact or der");const J=typeof $=="string"||e1($),le=!J&&!ee&&typeof $=="object"&&$!==null&&typeof $.r=="bigint"&&typeof $.s=="bigint";if(!J&&!le)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let ye,de;try{if(le&&(ye=new w($.r,$.s)),J){try{ee!=="compact"&&(ye=w.fromDER($))}catch(kr){if(!(kr instanceof Wa.Err))throw kr}!ye&&ee!=="der"&&(ye=w.fromCompact($))}de=c.fromHex(H)}catch{return!1}if(!ye||z&&ye.hasHighS())return!1;W&&(U=e.hash(U));const{r:fe,s:De}=ye,$e=I(U),qe=a(De),et=o($e*qe),Nt=o(fe*qe),bt=(Ut=c.BASE.multiplyAndAddUnsafe(de,et,Nt))==null?void 0:Ut.toAffine();return bt?o(bt.x)===fe:!1}return{CURVE:e,getPublicKey:b,getSharedSecret:E,sign:V,verify:Z,ProjectivePoint:c,Signature:w,utils:m}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ppe(r){return{hash:r,hmac:(e,...t)=>Rq(r,e,ide(...t)),randomBytes:a_}}function Npe(r,e){const t=n=>_pe({...r,...Ppe(n)});return{...t(e),create:t}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Bq=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),_R=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Dpe=BigInt(1),VA=BigInt(2),PR=(r,e)=>(r+e/VA)/e;function Ope(r){const e=Bq,t=BigInt(3),n=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=r*r*r%e,u=l*l*r%e,d=Qt(u,t,e)*u%e,p=Qt(d,t,e)*u%e,y=Qt(p,VA,e)*l%e,f=Qt(y,s,e)*y%e,g=Qt(f,i,e)*f%e,w=Qt(g,a,e)*g%e,m=Qt(w,c,e)*w%e,b=Qt(m,a,e)*g%e,v=Qt(b,t,e)*u%e,E=Qt(v,o,e)*f%e,S=Qt(E,n,e)*l%e,I=Qt(S,VA,e);if(!HA.eql(HA.sqr(I),r))throw new Error("Cannot find square root");return I}const HA=W5(Bq,void 0,void 0,{sqrt:Ope}),va=Npe({a:BigInt(0),b:BigInt(7),Fp:HA,n:_R,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const e=_R,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Dpe*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=t,o=BigInt("0x100000000000000000000000000000000"),a=PR(i*r,e),c=PR(-n*r,e);let l=Ot(r-a*t-c*s,e),u=Ot(-a*n-c*i,e);const d=l>o,p=u>o;if(d&&(l=e-l),p&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:d,k1:l,k2neg:p,k2:u}}}},hde);BigInt(0);va.ProjectivePoint;function Rpe({name:r,code:e,encode:t}){return new Bpe(r,e,t)}let Bpe=class{constructor(e,t,n){h(this,"name");h(this,"code");h(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Kd(this.code,t):t.then(n=>Kd(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Mpe(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const Mq=Rpe({name:"sha2-256",code:18,encode:Mpe("SHA-256")});function $q(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}const $pe=33,Lpe=32;function Upe(r,e){const t=Mq.digest(e instanceof Uint8Array?e:e.subarray());if($q(t))return t.then(({digest:n})=>va.sign(n,r).toDERRawBytes()).catch(n=>{throw new xR(String(n))});try{return va.sign(t.digest,r).toDERRawBytes()}catch(n){throw new xR(String(n))}}function Fpe(r,e,t){const n=Mq.digest(t instanceof Uint8Array?t:t.subarray());if($q(n))return n.then(({digest:s})=>va.verify(e,s,r)).catch(s=>{throw new AR(String(s))});try{return va.verify(e,n.digest,r)}catch(s){throw new AR(String(s))}}class Lq{constructor(e){h(this,"type","secp256k1");h(this,"raw");h(this,"_key");this._key=Kpe(e),this.raw=Vpe(this._key)}toMultihash(){return s_.digest($i(this))}toCID(){return H5.createV1(114,this.toMultihash())}toString(){return _i.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:rt(this.raw,e.raw)}verify(e,t){return Fpe(this._key,t,e)}}class Uq{constructor(e,t){h(this,"type","secp256k1");h(this,"raw");h(this,"publicKey");this.raw=Hpe(e),this.publicKey=new Lq(t??Gpe(e))}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:rt(this.raw,e.raw)}sign(e){return Upe(this.raw,e)}}function Fq(r){return new Uq(r)}function S_(r){return new Lq(r)}async function zpe(){const r=jpe();return new Uq(r)}function Vpe(r){return va.ProjectivePoint.fromHex(r).toRawBytes(!0)}function Hpe(r){try{return va.getPublicKey(r,!0),r}catch(e){throw new YT(String(e))}}function Kpe(r){try{return va.ProjectivePoint.fromHex(r),r}catch(e){throw new py(String(e))}}function Gpe(r){try{return va.getPublicKey(r,!0)}catch(e){throw new YT(String(e))}}function jpe(){return va.utils.randomPrivateKey()}async function J5(r,e){if(r==="Ed25519")return pfe();if(r==="secp256k1")return zpe();if(r==="RSA")return mpe(Qpe(e));if(r==="ECDSA")return ede(Jpe(e));throw new If}function Is(r,e){const{Type:t,Data:n}=Uu.decode(r),s=n??new Uint8Array;switch(t){case qt.RSA:return gpe(s,e);case qt.Ed25519:return d_(s);case qt.secp256k1:return S_(s);case qt.ECDSA:return Zj(s);default:throw new If}}function qpe(r){var n,s;if(r.byteLength===wy)return d_(r);if(r.byteLength===$pe)return S_(r);const e=ih(r),t=(n=e[1])==null?void 0:n[0];if(t===jj||t===qj||t===Wj)return eq(e);if(((s=e[0])==null?void 0:s[0])===bpe)return Dq(e,r);throw new ie("Could not extract public key from raw bytes")}function zq(r){const{Type:e,Data:t}=Uu.decode(r.digest),n=t??new Uint8Array;switch(e){case qt.Ed25519:return d_(n);case qt.secp256k1:return S_(n);case qt.ECDSA:return Zj(n);default:throw new If}}function $i(r){return Uu.encode({Type:qt[r.type],Data:r.raw})}function Wpe(r){const e=D8.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case qt.RSA:return ppe(t);case qt.Ed25519:return bq(t);case qt.secp256k1:return Fq(t);case qt.ECDSA:return Yhe(t);default:throw new If}}function KA(r){var n;if(r.byteLength===qa)return bq(r);if(r.byteLength===Lpe)return Fq(r);const e=ih(r),t=(n=e[2])==null?void 0:n[0];if(t===jj||t===qj||t===Wj)return Xj(e);if(e.length>8)return Nq(e);throw new ie("Could not extract private key from raw bytes")}function Lm(r){return D8.encode({Type:qt[r.type],Data:r.raw})}function Qpe(r){return r==null?2048:parseInt(r,10)}function Jpe(r){if(r==="P-256"||r==null)return"P-256";if(r==="P-384")return"P-384";if(r==="P-521")return"P-521";throw new ie("Unsupported curve, should be P-256, P-384 or P-521")}async function Vq(r){if(r.type==="RSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if(r.type==="ECDSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"ECDSA",namedCurve:r.jwk.crv??"P-256"},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"ECDSA",namedCurve:r.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new ie("Only RSA and ECDSA keys are supported")}function Ype(r,e){for(let t=0;t<r.byteLength;t++){if(r[t]<e[t])return-1;if(r[t]>e[t])return 1}return r.byteLength>e.byteLength?1:r.byteLength<e.byteLength?-1:0}const Xpe=async(r,e,t)=>{if(!r)throw new Error("No signature given");if(!e)throw new Error("Given publicKey was undefined");if(!t)throw new Error("Given input data was undefined");t instanceof Uint8Array||(t=typeof t=="string"?he(t):new Uint8Array(t));const n=(i,o,a)=>i.verify(o,a);let s=!1;try{const i=qpe(he(e,"base16"));s=await n(i,t,he(r,"base16"))}catch{}return Promise.resolve(s)},GA=async(r,e)=>{if(!r)throw new Error("No signing key given");if(!e)throw new Error("Given input data was undefined");return e instanceof Uint8Array||(e=typeof e=="string"?he(e):new Uint8Array(e)),ce(await r.sign(e),"base16")},Zpe=pa({size:1e3}),Hq=async(r,e,t)=>{const n=await Zpe,s=await n.get(r);let i=!1;if(s){const o=(a,c)=>c instanceof Uint8Array?Ype(a,c)===0:a.toString()===c.toString();i=s.publicKey===e&&o(s.data,t)}else{const o=await Xpe(r,e,t);i=o,o&&await n.put(r,{publicKey:e,data:t})}return i},e0e="./keystore",Kq=async({storage:r,path:e}={})=>{r=r||await Sd(await pa({size:1e3}),await kA({path:e||e0e}));const t=await pa({size:1e3}),n=async()=>{await r.close(),await t.close()},s=async()=>{await r.clear(),await t.clear()},i=async u=>{if(!u)throw new Error("id needed to check a key");let d=!1,p=await t.get(u);if(p)d=!0;else try{p=await r.get("private_"+u),d=p!=null}catch{console.error("Error: ENOENT: no such file or directory")}return d},o=async(u,d)=>{const{privateKey:p}=d;await r.put("private_"+u,p);const y=KA(p);await t.put(u,y)};return{clear:s,close:n,hasKey:i,addKey:o,createKey:async u=>{if(!u)throw new Error("id needed to create a key");const d=await J5("secp256k1"),p={publicKey:d.publicKey.raw,privateKey:d.raw};return await o(u,p),d},getKey:async u=>{if(!u)throw new Error("id needed to get a key");let d=await t.get(u);if(!d){let p;try{p=await r.get("private_"+u)}catch{}if(!p)return;d=KA(p),await t.put(u,d)}return d},getPublic:(u,d={})=>{const p=["hex","buffer"],y=d.format||"hex";if(p.indexOf(y)===-1)throw new Error("Supported formats are `hex` and `buffer`");const f=u.publicKey.raw;return y==="buffer"?f:ce(f,"base16")}}},Gq=_m,jq=C5,t0e=Un,qq=async({id:r,publicKey:e,signatures:t,type:n,sign:s,verify:i}={})=>{if(!r)throw new Error("Identity id is required");if(!e)throw new Error("Invalid public key");if(!t)throw new Error("Signatures object is required");if(!t.id)throw new Error("Signature of id is required");if(!t.publicKey)throw new Error("Signature of publicKey+id is required");if(!n)throw new Error("Identity type is required");t=Object.assign({},t);const o={id:r,publicKey:e,signatures:t,type:n,sign:s,verify:i},{hash:a,bytes:c}=await r0e(o);return o.hash=a,o.bytes=c,o},r0e=async r=>{const{id:e,publicKey:t,signatures:n,type:s}=r,i={id:e,publicKey:t,signatures:n,type:s},{cid:o,bytes:a}=await H1({value:i,codec:Gq,hasher:jq});return{hash:o.toString(t0e),bytes:Uint8Array.from(a)}},n0e=async r=>{const{value:e}=await v5({bytes:r,codec:Gq,hasher:jq});return qq({...e})},s0e=r=>!!(r.id&&r.hash&&r.bytes&&r.publicKey&&r.signatures&&r.signatures.id&&r.signatures.publicKey&&r.type),i0e=(r,e)=>r.id===e.id&&r.hash===e.hash&&r.type===e.type&&r.publicKey===e.publicKey&&r.signatures.id===e.signatures.id&&r.signatures.publicKey===e.signatures.publicKey,Wq="publickey",o0e=async r=>{const{id:e,publicKey:t,signatures:n}=r;return Hq(n.publicKey,e,t+n.id)},C_=({keystore:r})=>async()=>{if(!r)throw new Error("PublicKeyIdentityProvider requires a keystore parameter");return{type:Wq,getId:async({id:n}={})=>{if(!n)throw new Error("id is required");const s=await r.getKey(n)||await r.createKey(n);return ce(s.publicKey.raw,"base16")},signIdentity:async(n,{id:s}={})=>{if(!s)throw new Error("id is required");const i=await r.getKey(s);if(!i)throw new Error(`Signing key for '${s}' not found`);return GA(i,n)}}};C_.verifyIdentity=o0e;C_.type=Wq;const I_={},a0e=r=>Object.keys(I_).includes(r),Y9=r=>{if(!a0e(r))throw new Error(`IdentityProvider type '${r}' is not supported`);return I_[r]},c0e=r=>{if(!r.type||typeof r.type!="string")throw new Error("Given IdentityProvider doesn't have a field 'type'.");if(!r.verifyIdentity)throw new Error("Given IdentityProvider doesn't have a function 'verifyIdentity'.");I_[r.type]=r};c0e(C_);const l0e=Cu("./orbitdb","identities"),u0e=async({keystore:r,path:e,storage:t,ipfs:n}={})=>{r=r||await Kq({path:e||l0e}),t||(t=n?await Sd(await pa({size:1e3}),await T5({ipfs:n,pin:!0})):await BT());const s=await pa({size:1e3}),i=async u=>{const d=await t.get(u);if(d)return n0e(d)},o=async(u={})=>{u.keystore=r;const d=Y9("publickey"),y=await(u.provider||d({keystore:r}))();if(!Y9(y.type))throw new Error("Identity provider is unknown. Use useIdentityProvider(provider) to register the identity provider");const f=await y.getId(u),g=await r.getKey(f)||await r.createKey(f),w=r.getPublic(g),m=await GA(g,f),b=await y.signIdentity(w+m,u),E=await qq({id:f,publicKey:w,signatures:{id:m,publicKey:b},type:y.type,sign:c,verify:l});return await t.put(E.hash,E.bytes),E},a=async u=>{if(!s0e(u))return!1;const{id:d,publicKey:p,signatures:y}=u;if(!await l(y.id,p,d))return!1;const g=await s.get(y.id);if(g)return i0e(u,g);const m=await Y9(u.type).verifyIdentity(u);return m&&await s.put(y.id,u),m},c=async(u,d)=>{const p=await r.getKey(u.id);if(!p)throw new Error("Private signing key not found from KeyStore");return await GA(p,d)},l=async(u,d,p)=>await Hq(u,d,p);return{createIdentity:o,verifyIdentity:a,getIdentity:i,sign:c,verify:l,keystore:r}},h0e=r=>{if(r=r.toString(),!r.startsWith("/orbitdb")&&!r.startsWith("\\orbitdb"))return!1;r=r.replaceAll("/orbitdb/",""),r=r.replaceAll("\\orbitdb\\",""),r=r.replaceAll("/",""),r=r.replaceAll("\\","");let e;try{e=Io.parse(r,Un)}catch{return!1}return e!==void 0},NR=r=>{if(r&&r.protocol==="orbitdb"&&r.hash)return r;const e="orbitdb",t=r.replace("/orbitdb/","").replace("\\orbitdb\\","");return{protocol:e,hash:t,address:r,toString:()=>Cu("/",e,t)}},DR=_m,OR=C5,d0e=Un,f0e=async({ipfs:r,storage:e}={})=>(e=e||await Sd(await pa({size:1e5}),await T5({ipfs:r,pin:!0})),{get:async i=>{const o=await e.get(i),{value:a}=await v5({bytes:o,codec:DR,hasher:OR});return a&&await e.put(i,o),a},create:async({name:i,type:o,accessController:a,meta:c})=>{if(!i)throw new Error("name is required");if(!o)throw new Error("type is required");if(!a)throw new Error("accessController is required");const l=Object.assign({name:i,type:o,accessController:a},c!==void 0?{meta:c}:{}),{cid:u,bytes:d}=await H1({value:l,codec:DR,hasher:OR}),p=u.toString(d0e);return await e.put(p,d),{hash:p,manifest:l}},close:async()=>{await e.close()}}),Qq=async(r=32)=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="",n=0;for(;n<r;)t+=e.charAt(Math.floor(Math.random()*e.length)),n+=1;return t},Jq=_m,Yq=C5,p0e=Un,g0e=async({storage:r,type:e,params:t})=>{const n={type:e,...t},{cid:s,bytes:i}=await H1({value:n,codec:Jq,hasher:Yq}),o=s.toString(p0e);return await r.put(o,i),o},s4="ipfs",Y5=({write:r,storage:e}={})=>async({orbitdb:t,identities:n,address:s})=>{if(e=e||await Sd(await pa({size:1e3}),await T5({ipfs:t.ipfs,pin:!0})),r=r||[t.identity.id],s){const o=await e.get(s.replaceAll("/ipfs/","")),{value:a}=await v5({bytes:o,codec:Jq,hasher:Yq});r=a.write}else s=await g0e({storage:e,type:s4,params:{write:r}}),s=Cu("/",s4,s);return{type:s4,address:s,write:r,canAppend:async o=>{const a=await n.getIdentity(o.identity);if(!a)return!1;const{id:c}=a;return r.includes(c)||r.includes("*")?await n.verifyIdentity(a):!1}}};Y5.type=s4;const Xq="orbitdb",Zq=({write:r}={})=>async({orbitdb:e,identities:t,address:n,name:s})=>{n=n||s||await Qq(64),r=r||[e.identity.id];const i=await e.open(n,{type:"keyvalue",AccessController:Y5({write:r})});n=i.address;const o=async f=>{const g=await t.getIdentity(f.identity);if(!g)return!1;const{id:w}=g;return await d("write",w)||await d("admin",w)?await t.verifyIdentity(g):!1},a=async()=>{const f=[];for await(const w of i.iterator())f[w.key]=w.value;const g=w=>{const m=w[0];f[m]=new Set([...f[m]||[],...w[1]])};return Object.entries({...f,admin:new Set([...f.admin||[],...i.access.write])}).forEach(g),f},c=async f=>(await a())[f]||new Set([]),l=async()=>{await i.close()},u=async()=>{await i.drop()},d=async(f,g)=>{const w=new Set(await c(f));return w.has(g)||w.has("*")};return{type:Xq,address:n,write:r,canAppend:o,capabilities:a,get:c,grant:async(f,g)=>{const w=new Set([...await i.get(f)||[],g]);await i.put(f,Array.from(w.values()))},revoke:async(f,g)=>{const w=new Set(await i.get(f)||[]);w.delete(g),w.size>0?await i.put(f,Array.from(w.values())):await i.del(f)},close:l,drop:u,events:i.events}};Zq.type=Xq;const jA={},y0e=r=>{if(!jA[r])throw new Error(`AccessController type '${r}' is not supported`);return jA[r]},eW=r=>{if(!r.type)throw new Error("AccessController does not contain required field 'type'.");jA[r.type]=r};eW(Y5);eW(Zq);const m0e="events",w0e=Y5,b0e=async({ipfs:r,id:e,identity:t,identities:n,directory:s}={})=>{if(r==null)throw new Error("IPFS instance is a required argument.");e=e||await Qq();const i=r.libp2p.peerId;s=s||"./orbitdb";let o;n?o=n.keystore:(o=await Kq({path:Cu(s,"./keystore")}),n=await u0e({ipfs:r,keystore:o})),t?t.provider&&(t=await n.createIdentity({...t})):t=await n.createIdentity({id:e});const a=await f0e({ipfs:r});let c={};const l=async(p,{type:y,meta:f,sync:g,Database:w,AccessController:m,headsStorage:b,entryStorage:v,indexStorage:E,referencesCount:S}={})=>{let I,x,C;if(c[p])return c[p];if(h0e(p)){const L=NR(p);x=await a.get(L.hash);const K=x.accessController.split("/",2).pop();m=y0e(K)(),C=await m({orbitdb:{open:l,identity:t,ipfs:r},identities:n,address:x.accessController}),I=x.name,y=y||x.type,f=x.meta}else{y=y||m0e,m=m||w0e(),C=await m({orbitdb:{open:l,identity:t,ipfs:r},identities:n,name:p});const L=await a.create({name:p,type:y,accessController:C.address,meta:f});if(x=L.manifest,p=NR(L.hash),I=x.name,f=x.meta,c[p])return c[p]}if(w=w||rue(y)(),!w)throw new Error(`Unsupported database type: '${y}'`);p=p.toString();const P=await w({ipfs:r,identity:t,address:p,name:I,access:C,directory:s,meta:f,syncAutomatically:g,headsStorage:b,entryStorage:v,indexStorage:E,referencesCount:S});return P.events.on("close",u(p)),c[p]=P,P},u=p=>()=>{delete c[p]};return{id:e,open:l,stop:async()=>{for(const p of Object.values(c))await p.close();o&&await o.close(),a&&await a.close(),c={}},ipfs:r,directory:s,keystore:o,identities:n,identity:t,peerId:i}};function At(r){const e=new globalThis.AbortController;function t(){e.abort();for(const i of r)(i==null?void 0:i.removeEventListener)!=null&&i.removeEventListener("abort",t)}for(const i of r){if((i==null?void 0:i.aborted)===!0){t();break}(i==null?void 0:i.addEventListener)!=null&&i.addEventListener("abort",t)}function n(){for(const i of r)(i==null?void 0:i.removeEventListener)!=null&&i.removeEventListener("abort",t)}const s=e.signal;return s.clear=n,s}let v0e=class extends Error{constructor(t,n){super(t??"The operation was aborted");h(this,"type");h(this,"code");this.type="aborted",this.name="AbortError",this.code=n??"ABORT_ERR"}};async function Di(r,e,t,n){const s=new v0e(n==null?void 0:n.errorMessage,n==null?void 0:n.errorCode);return(t==null?void 0:t.aborted)===!0?Promise.reject(s):new Promise((i,o)=>{function a(){t==null||t.removeEventListener("abort",u),r.removeEventListener(e,c),(n==null?void 0:n.errorEvent)!=null&&r.removeEventListener(n.errorEvent,l)}const c=d=>{var p;try{if(((p=n==null?void 0:n.filter)==null?void 0:p.call(n,d))===!1)return}catch(y){a(),o(y);return}a(),i(d)},l=d=>{a(),o(d.detail)},u=()=>{a(),o(s)};t==null||t.addEventListener("abort",u),r.addEventListener(e,c),(n==null?void 0:n.errorEvent)!=null&&r.addEventListener(n.errorEvent,l)})}class E0e extends Error{constructor(t="Rate limit exceeded",n){super(t);h(this,"remainingPoints");h(this,"msBeforeNext");h(this,"consumedPoints");h(this,"isFirstInDuration");this.name="RateLimitError",this.remainingPoints=n.remainingPoints,this.msBeforeNext=n.msBeforeNext,this.consumedPoints=n.consumedPoints,this.isFirstInDuration=n.isFirstInDuration}}class tW extends Error{constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}h(tW,"name","QueueFullError");class x0e{constructor(e){h(this,"deferred");h(this,"signal");var t;this.signal=e,this.deferred=He(),this.onAbort=this.onAbort.bind(this),(t=this.signal)==null||t.addEventListener("abort",this.onAbort)}onAbort(){var e;this.deferred.reject(((e=this.signal)==null?void 0:e.reason)??new Vd)}cleanup(){var e;(e=this.signal)==null||e.removeEventListener("abort",this.onAbort)}}function A0e(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}class S0e{constructor(e,t){h(this,"id");h(this,"fn");h(this,"options");h(this,"recipients");h(this,"status");h(this,"timeline");h(this,"controller");this.id=A0e(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,n)=>{var s;return t&&((s=n.signal)==null?void 0:s.aborted)===!0},!0)&&(this.controller.abort(new Vd),this.cleanup())}async join(e={}){var n;const t=new x0e(e.signal);return this.recipients.push(t),(n=e.signal)==null||n.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await Vn(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{var t;e.cleanup(),(t=e.signal)==null||t.removeEventListener("abort",this.onAbort)})}}class Gd extends Er{constructor(t={}){var n;super();h(this,"concurrency");h(this,"maxSize");h(this,"queue");h(this,"pending");h(this,"sort");this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.maxSize=t.maxSize??Number.POSITIVE_INFINITY,this.pending=0,t.metricName!=null&&((n=t.metrics)==null||n.registerMetricGroup(t.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})})),this.sort=t.sort,this.queue=[]}tryToStartAnother(){if(this.size===0)return queueMicrotask(()=>{this.safeDispatchEvent("empty")}),this.running===0&&queueMicrotask(()=>{this.safeDispatchEvent("idle")}),!1;if(this.pending<this.concurrency){let t;for(const n of this.queue)if(n.status==="queued"){t=n;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let n=0;n<this.queue.length;n++)if(this.queue[n]===t){this.queue.splice(n,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(t){this.queue.push(t),this.sort!=null&&this.queue.sort(this.sort)}async add(t,n){var i;if((i=n==null?void 0:n.signal)==null||i.throwIfAborted(),this.size===this.maxSize)throw new tW;const s=new S0e(t,n);return this.enqueue(s),this.safeDispatchEvent("add"),this.tryToStartAnother(),s.join(n).then(o=>(this.safeDispatchEvent("completed",{detail:o}),this.safeDispatchEvent("success",{detail:{job:s,result:o}}),o)).catch(o=>{if(s.status==="queued"){for(let a=0;a<this.queue.length;a++)if(this.queue[a]===s){this.queue.splice(a,1);break}}throw this.safeDispatchEvent("error",{detail:o}),this.safeDispatchEvent("failure",{detail:{job:s,error:o}}),o})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new Vd)}),this.clear()}async onEmpty(t){this.size!==0&&await Di(this,"empty",t==null?void 0:t.signal)}async onSizeLessThan(t,n){this.size<t||await Di(this,"next",n==null?void 0:n.signal,{filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await Di(this,"idle",t==null?void 0:t.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){var l,u,d;(l=t==null?void 0:t.signal)==null||l.throwIfAborted();const n=Nc({objectMode:!0}),s=p=>{p!=null?this.abort():this.clear(),n.end(p)},i=p=>{p.detail!=null&&n.push(p.detail)},o=p=>{s(p.detail)},a=()=>{s()},c=()=>{s(new Vd("Queue aborted"))};this.addEventListener("completed",i),this.addEventListener("error",o),this.addEventListener("idle",a),(u=t==null?void 0:t.signal)==null||u.addEventListener("abort",c);try{yield*n}finally{this.removeEventListener("completed",i),this.removeEventListener("error",o),this.removeEventListener("idle",a),(d=t==null?void 0:t.signal)==null||d.removeEventListener("abort",c),s()}}}class zu extends Gd{has(e){return this.find(e)!=null}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}const C0e=8,k_=1024*1024*4;let I0e=class extends Error{constructor(){super(...arguments);h(this,"name","InvalidMessageLengthError");h(this,"code","ERR_INVALID_MSG_LENGTH")}},rW=class extends Error{constructor(){super(...arguments);h(this,"name","InvalidDataLengthError");h(this,"code","ERR_MSG_DATA_TOO_LONG")}},k0e=class extends Error{constructor(){super(...arguments);h(this,"name","InvalidDataLengthLengthError");h(this,"code","ERR_MSG_LENGTH_TOO_LONG")}},RR=class extends Error{constructor(){super(...arguments);h(this,"name","UnexpectedEOFError");h(this,"code","ERR_UNEXPECTED_EOF")}};function nW(r){return r[Symbol.asyncIterator]!=null}function sW(r,e){if(r.byteLength>e)throw new rW("Message length too long")}const X5=r=>{const e=kt(r),t=Ss(e);return Jr(r,t),X5.bytes=e,t};X5.bytes=0;function n1(r,e){e=e??{};const t=e.lengthEncoder??X5,n=(e==null?void 0:e.maxDataLength)??k_;function*s(i){sW(i,n);const o=t(i.byteLength);o instanceof Uint8Array?yield o:yield*o,i instanceof Uint8Array?yield i:yield*i}return nW(r)?async function*(){for await(const i of r)yield*s(i)}():function*(){for(const i of r)yield*s(i)}()}n1.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??X5,n=(e==null?void 0:e.maxDataLength)??k_;return sW(r,n),new Ge(t(r.byteLength),r)};var Dh;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(Dh||(Dh={}));const T_=r=>{const e=Po(r);return T_.bytes=kt(e),e};T_.bytes=0;function s1(r,e){const t=new Ge;let n=Dh.LENGTH,s=-1;const i=(e==null?void 0:e.lengthDecoder)??T_,o=(e==null?void 0:e.maxLengthLength)??C0e,a=(e==null?void 0:e.maxDataLength)??k_;function*c(){for(;t.byteLength>0;){if(n===Dh.LENGTH)try{if(s=i(t),s<0)throw new I0e("Invalid message length");if(s>a)throw new rW("Message length too long");const l=i.bytes;t.consume(l),(e==null?void 0:e.onLength)!=null&&e.onLength(s),n=Dh.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>o)throw new k0e("Message length length too long");break}throw l}if(n===Dh.DATA){if(t.byteLength<s)break;const l=t.sublist(0,s);t.consume(s),(e==null?void 0:e.onData)!=null&&e.onData(l),yield l,n=Dh.LENGTH}}}return nW(r)?async function*(){for await(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new RR("Unexpected end of input")}():function*(){for(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new RR("Unexpected end of input")}()}s1.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:i,value:o}=await r.next(t);if(i===!0)return;o!=null&&(yield o)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}}();return s1(n,{...e??{},onLength:i=>{t=i}})};function __(r){const[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:s=>{n.push(s)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}function T0e(r){return r[Symbol.asyncIterator]!=null}function J1(r,e){let t=0;if(T0e(r))return async function*(){for await(const c of r)yield e(c,t++)}();const n=__(r),{value:s,done:i}=n.next();if(i===!0)return function*(){}();const o=e(s,t++);if(typeof o.then=="function")return async function*(){yield await o;for await(const c of n)yield e(c,t++)}();const a=e;return function*(){yield o;for(const c of n)yield a(c,t++)}()}function _0e(r){return r[Symbol.asyncIterator]!=null}function R8(r,e){return _0e(r)?async function*(){let t=0;if(!(e<1)){for await(const n of r)if(yield n,t++,t===e)return}}():function*(){let t=0;if(!(e<1)){for(const n of r)if(yield n,t++,t===e)return}}()}class Re extends Event{constructor(t,n){super(t);h(this,"type");h(this,"detail");this.type=t,this.detail=n}}const Zw="/ipfs/bitswap/1.2.0",P0e=1024,N0e=1024,D0e=1024,O0e=5e3,R0e=10,B0e=50,M0e=!1,$0e=3,iW=1024*1024*4,L0e=iW;var Nr;(function(r){r.WantBlock="WantBlock",r.WantHave="WantHave"})(Nr||(Nr={}));var qA;(function(r){r[r.WantBlock=0]="WantBlock",r[r.WantHave=1]="WantHave"})(qA||(qA={}));(function(r){r.codec=()=>Cs(qA)})(Nr||(Nr={}));var Ey;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.priority!=null&&t.priority!==0&&(n.uint32(16),n.int32(t.priority)),t.cancel!=null&&(n.uint32(24),n.bool(t.cancel)),t.wantType!=null&&(n.uint32(32),Nr.codec().encode(t.wantType,n)),t.sendDontHave!=null&&(n.uint32(40),n.bool(t.sendDontHave)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={cid:it(0),priority:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.cid=t.bytes();break}case 2:{i.priority=t.int32();break}case 3:{i.cancel=t.bool();break}case 4:{i.wantType=Nr.codec().decode(t);break}case 5:{i.sendDontHave=t.bool();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(Ey||(Ey={}));var B8;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.entries!=null)for(const i of t.entries)n.uint32(10),Ey.codec().encode(i,n);t.full!=null&&(n.uint32(16),n.bool(t.full)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{var a,c;const i={entries:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{if(((a=s.limits)==null?void 0:a.entries)!=null&&i.entries.length===s.limits.entries)throw new It('Decode error - map field "entries" had too many elements');i.entries.push(Ey.codec().decode(t,t.uint32(),{limits:(c=s.limits)==null?void 0:c.entries$}));break}case 2:{i.full=t.bool();break}default:{t.skipType(l&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(B8||(B8={}));var xy;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.prefix!=null&&t.prefix.byteLength>0&&(n.uint32(10),n.bytes(t.prefix)),t.data!=null&&t.data.byteLength>0&&(n.uint32(18),n.bytes(t.data)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={prefix:it(0),data:it(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.prefix=t.bytes();break}case 2:{i.data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(xy||(xy={}));var ga;(function(r){r.HaveBlock="HaveBlock",r.DoNotHaveBlock="DoNotHaveBlock"})(ga||(ga={}));var M8;(function(r){r[r.HaveBlock=0]="HaveBlock",r[r.DoNotHaveBlock=1]="DoNotHaveBlock"})(M8||(M8={}));(function(r){r.codec=()=>Cs(M8)})(ga||(ga={}));var Ay;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.type!=null&&M8[t.type]!==0&&(n.uint32(16),ga.codec().encode(t.type,n)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={cid:it(0),type:ga.HaveBlock},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.cid=t.bytes();break}case 2:{i.type=ga.codec().decode(t);break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(Ay||(Ay={}));var Sy;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.wantlist!=null&&(n.uint32(10),B8.codec().encode(t.wantlist,n)),t.blocks!=null)for(const i of t.blocks)n.uint32(26),xy.codec().encode(i,n);if(t.blockPresences!=null)for(const i of t.blockPresences)n.uint32(34),Ay.codec().encode(i,n);t.pendingBytes!=null&&t.pendingBytes!==0&&(n.uint32(40),n.int32(t.pendingBytes)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{var a,c,l,u,d;const i={blocks:[],blockPresences:[],pendingBytes:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const p=t.uint32();switch(p>>>3){case 1:{i.wantlist=B8.codec().decode(t,t.uint32(),{limits:(a=s.limits)==null?void 0:a.wantlist});break}case 3:{if(((c=s.limits)==null?void 0:c.blocks)!=null&&i.blocks.length===s.limits.blocks)throw new It('Decode error - map field "blocks" had too many elements');i.blocks.push(xy.codec().decode(t,t.uint32(),{limits:(l=s.limits)==null?void 0:l.blocks$}));break}case 4:{if(((u=s.limits)==null?void 0:u.blockPresences)!=null&&i.blockPresences.length===s.limits.blockPresences)throw new It('Decode error - map field "blockPresences" had too many elements');i.blockPresences.push(Ay.codec().decode(t,t.uint32(),{limits:(d=s.limits)==null?void 0:d.blockPresences$}));break}case 5:{i.pendingBytes=t.int32();break}default:{t.skipType(p&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(Sy||(Sy={}));function U0e(r,e){for(const[t,n]of e.wantlist.entries()){const s=r.wantlist.get(t);s!=null&&(s.priority>n.priority&&(n.priority=s.priority),n.cancel=n.cancel??s.cancel,n.wantType=n.wantType??s.wantType,n.sendDontHave=n.sendDontHave??s.sendDontHave),r.wantlist.set(t,n)}for(const[t,n]of e.blockPresences.entries())r.blockPresences.set(t,n);for(const[t,n]of e.blocks.entries())r.blocks.set(t,n);return e.full&&!r.full&&(r.full=!0),r}class oW extends Error{constructor(e="Block too large"){super(e),this.name="BlockTooLargeError"}}h(oW,"name","BlockTooLargeError");const F0e=4193648,z0e=F0e+16;function*V0e(r,e){const t=[...r.wantlist.values()],n=[...r.blockPresences.values()],s=[...r.blocks.values()];let i=0,o=0,a=0,c=!1;for(;;){const l={wantlist:{full:r.full??!1,entries:[]},blockPresences:[],blocks:[],pendingBytes:0};let u=Sy.encode(l).byteLength,{added:d,hasMore:p,newSize:y}=X9(s,l.blocks,a,e,u,H0e);a+=d,u=y;const f=p;({added:d,hasMore:p,newSize:y}=X9(n,l.blockPresences,o,e,u,K0e)),o+=d,u=y;const g=p;if({added:d,hasMore:p,newSize:y}=X9(t,l.wantlist.entries,i,e,u,G0e),i+=d,u=y,c=!f&&!g&&!p,c||(l.wantlist.full=!1),yield Sy.encode(l),c)break}}function X9(r,e,t,n,s,i){let o=0,a=!1;for(let c=t;c<r.length;c++){const l=r[c],u=i(l);if(u>z0e)throw new oW("Cannot send block as after encoding it is over the max message size");const d=s+u;if(d>n){a=!0;break}e.push(l),o++,s=d}return{hasMore:a,added:o,newSize:s}}function H0e(r){return P_(3,xy.encode(r))}function K0e(r){return P_(4,Ay.encode(r))}function G0e(r){return P_(1,Ey.encode(r))}function P_(r,e){const t=kt(r),n=kt(e.byteLength);return t+n+e.byteLength}let j0e=class extends Er{constructor(t,n={}){var s,i;super();h(this,"log");h(this,"libp2p");h(this,"routing");h(this,"protocols");h(this,"running");h(this,"maxInboundStreams");h(this,"maxOutboundStreams");h(this,"messageReceiveTimeout");h(this,"registrarIds");h(this,"metrics");h(this,"sendQueue");h(this,"runOnLimitedConnections");h(this,"maxOutgoingMessageSize");h(this,"maxIncomingMessageSize");this.log=t.logger.forComponent("helia:bitswap:network"),this.libp2p=t.libp2p,this.routing=t.routing,this.protocols=n.protocols??[Zw],this.registrarIds=[],this.running=!1,this._onStream=this._onStream.bind(this),this.maxInboundStreams=n.maxInboundStreams??N0e,this.maxOutboundStreams=n.maxOutboundStreams??D0e,this.messageReceiveTimeout=n.messageReceiveTimeout??O0e,this.runOnLimitedConnections=n.runOnLimitedConnections??M0e,this.maxIncomingMessageSize=n.maxIncomingMessageSize??iW,this.maxOutgoingMessageSize=n.maxOutgoingMessageSize??n.maxIncomingMessageSize??L0e,this.metrics={blocksSent:(s=t.metrics)==null?void 0:s.registerCounter("helia_bitswap_sent_blocks_total"),dataSent:(i=t.metrics)==null?void 0:i.registerCounter("helia_bitswap_sent_data_bytes_total")},this.sendQueue=new zu({concurrency:n.messageSendConcurrency??B0e,metrics:t.metrics,metricName:"helia_bitswap_message_send_queue"}),this.sendQueue.addEventListener("error",o=>{this.log.error("error sending wantlist to peer",o.detail)})}async start(){if(this.running)return;this.running=!0,await this.libp2p.handle(this.protocols,this._onStream,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnections});const t={onConnect:n=>{this.safeDispatchEvent("peer:connected",{detail:n})},onDisconnect:n=>{this.safeDispatchEvent("peer:disconnected",{detail:n})}};this.registrarIds=[];for(const n of this.protocols)this.registrarIds.push(await this.libp2p.register(n,t));this.libp2p.getConnections().forEach(n=>{this.safeDispatchEvent("peer:connected",{detail:n.remotePeer})})}async stop(){if(this.running=!1,await this.libp2p.unhandle(this.protocols),this.registrarIds!=null){for(const t of this.registrarIds)this.libp2p.unregister(t);this.registrarIds=[]}}_onStream(t){if(!this.running)return;const{stream:n,connection:s}=t;Promise.resolve().then(async()=>{this.log("incoming new bitswap %s stream from %p",n.protocol,s.remotePeer);const i=()=>{n.status==="open"?n.abort(new Rm(`Incoming Bitswap stream timed out after ${this.messageReceiveTimeout}ms`)):this.log("stream aborted with status %s",n.status)};let o=AbortSignal.timeout(this.messageReceiveTimeout);o.addEventListener("abort",i),await n.closeWrite(),await Jn(n,a=>s1(a,{maxDataLength:this.maxIncomingMessageSize}),async a=>{for await(const c of a)try{const l=Sy.decode(c);this.log("incoming new bitswap %s message from %p on stream",n.protocol,s.remotePeer,n.id),this.safeDispatchEvent("bitswap:message",{detail:{peer:s.remotePeer,message:l}}),o.removeEventListener("abort",i),o=AbortSignal.timeout(this.messageReceiveTimeout),o.addEventListener("abort",i)}catch(l){this.log.error("error reading incoming bitswap message from %p on stream",s.remotePeer,n.id,l),n.abort(l);break}})}).catch(i=>{this.log.error("error handling incoming stream from %p",s.remotePeer,i),n.abort(i)})}async*findProviders(t,n){var s;(s=n==null?void 0:n.onProgress)==null||s.call(n,new Re("bitswap:network:find-providers",t));for await(const i of this.routing.findProviders(t,n))await this.libp2p.isDialable(i.multiaddrs,{runOnLimitedConnection:this.runOnLimitedConnections})&&(yield i)}async findAndConnect(t,n){await Dc(J1(R8(this.findProviders(t,n),(n==null?void 0:n.maxProviders)??$0e),async s=>this.connectTo(s.id,n))).catch(s=>{this.log.error(s)})}async sendMessage(t,n,s){if(!this.running)throw new Error("network isn't running");const i=this.sendQueue.queue.find(o=>t.equals(o.options.peerId)&&o.status==="queued");if(i!=null){i.options.message=U0e(i.options.message,n),await i.join({signal:s==null?void 0:s.signal});return}await this.sendQueue.add(async o=>{var l,u;const a=o==null?void 0:o.message;if(a==null)throw new ie("No message to send");this.log("sendMessage to %p",t),(l=o==null?void 0:o.onProgress)==null||l.call(o,new Re("bitswap:network:send-wantlist",t));const c=await this.libp2p.dialProtocol(t,Zw,o);await c.closeRead();try{await Jn(V0e(a,this.maxOutgoingMessageSize),d=>n1(d),c),await c.close(o)}catch(d){(u=o==null?void 0:o.onProgress)==null||u.call(o,new Re("bitswap:network:send-wantlist:error",{peer:t,error:d})),this.log.error("error sending message to %p",t,d),c.abort(d)}this._updateSentStats(a.blocks)},{peerId:t,signal:s==null?void 0:s.signal,message:n})}async connectTo(t,n){var i;if(!this.running)throw new Hd("Network isn't running");(i=n==null?void 0:n.onProgress)==null||i.call(n,new Re("bitswap:network:dial",t));const[s]=await Promise.all([this.libp2p.dial(t,n),Di(this.libp2p,"peer:identify",n==null?void 0:n.signal,{filter:o=>{if(!o.detail.peerId.equals(t))return!1;if(o.detail.protocols.includes(Zw))return!0;throw new Om(`${t} did not support ${Zw}`)}})]);return s}_updateSentStats(t){var s,i;let n=0;for(const o of t.values())n+=o.data.byteLength;(s=this.metrics.dataSent)==null||s.increment(n),(i=this.metrics.blocksSent)==null||i.increment(t.size)}};function q0e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Z5(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function W0e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var Q0e=W0e,J0e=Q0e;let Y0e=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},X0e=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return aW(this,e)}},Z0e=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return aW(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function aW(r,e){return new Z0e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let e1e=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Y0e(e,t,n),this.decoder=new X0e(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function cW({name:r,prefix:e,encode:t,decode:n}){return new e1e(r,e,t,n)}function ev({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=J0e(t,r);return cW({prefix:e,name:r,encode:n,decode:i=>Z5(s(i))})}function t1e(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function r1e(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function Kc({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return cW({prefix:e,name:r,encode(s){return r1e(s,n,t)},decode(s){return t1e(s,n,t,r)}})}const na=ev({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});ev({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const i4=Kc({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Kc({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Kc({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Kc({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Kc({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Kc({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Kc({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Kc({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Kc({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Z9=ev({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});ev({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var n1e=lW,BR=128,s1e=-128,i1e=Math.pow(2,31);function lW(r,e,t){e=e||[],t=t||0;for(var n=t;r>=i1e;)e[t++]=r&255|BR,r/=128;for(;r&s1e;)e[t++]=r&255|BR,r>>>=7;return e[t]=r|0,lW.bytes=t-n+1,e}var o1e=WA,a1e=128,MR=127;function WA(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw WA.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&MR)<<s:(o&MR)*Math.pow(2,s),s+=7}while(o>=a1e);return WA.bytes=i-n,t}var c1e=Math.pow(2,7),l1e=Math.pow(2,14),u1e=Math.pow(2,21),h1e=Math.pow(2,28),d1e=Math.pow(2,35),f1e=Math.pow(2,42),p1e=Math.pow(2,49),g1e=Math.pow(2,56),y1e=Math.pow(2,63),m1e=function(r){return r<c1e?1:r<l1e?2:r<u1e?3:r<h1e?4:r<d1e?5:r<f1e?6:r<p1e?7:r<g1e?8:r<y1e?9:10},w1e={encode:n1e,decode:o1e,encodingLength:m1e},$8=w1e;function QA(r,e=0){return[$8.decode(r,e),$8.decode.bytes]}function L8(r,e,t=0){return $8.encode(r,e,t),e}function U8(r){return $8.encodingLength(r)}function F8(r,e){const t=e.byteLength,n=U8(r),s=n+U8(t),i=new Uint8Array(s+t);return L8(r,i,0),L8(t,i,n),i.set(e,s),new N_(r,t,e,i)}function uW(r){const e=Z5(r),[t,n]=QA(e),[s,i]=QA(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new N_(t,s,o,e)}function b1e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&q0e(r.bytes,t.bytes)}}let N_=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function $R(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return E1e(t,JA(r),e??na.encoder);default:return x1e(t,JA(r),e??i4.encoder)}}const LR=new WeakMap;function JA(r){const e=LR.get(r);if(e==null){const t=new Map;return LR.set(r,t),t}return e}var Oz;let D_=class dn{constructor(e,t,n,s){h(this,"code");h(this,"version");h(this,"multihash");h(this,"bytes");h(this,"/");h(this,Oz,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Lg)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==A1e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return dn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=F8(e,t);return dn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return dn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&b1e(e.multihash,n.multihash)}toString(e){return $R(this,e)}toJSON(){return{"/":$R(this)}}link(){return this}[(Oz=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof dn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new dn(n,s,i,o??UR(n,s,i.bytes))}else if(t[S1e]===!0){const{version:n,multihash:s,code:i}=t,o=uW(s);return dn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Lg)throw new Error(`Version 0 CID must use dag-pb (code: ${Lg}) block encoding`);return new dn(e,t,n,n.bytes)}case 1:{const s=UR(e,t,n.bytes);return new dn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return dn.create(0,Lg,e)}static createV1(e,t){return dn.create(1,e,t)}static decode(e){const[t,n]=dn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=dn.inspectBytes(e),n=t.size-t.multihashSize,s=Z5(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new N_(t.multihashCode,t.digestSize,i,s);return[t.version===0?dn.createV0(o):dn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=QA(e.subarray(t));return t+=p,d};let s=n(),i=Lg;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,s]=v1e(e,t),i=dn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return JA(i).set(n,e),i}};function v1e(r,e){switch(r[0]){case"Q":{const t=e??na;return[na.prefix,t.decode(`${na.prefix}${r}`)]}case na.prefix:{const t=e??na;return[na.prefix,t.decode(r)]}case i4.prefix:{const t=e??i4;return[i4.prefix,t.decode(r)]}case Z9.prefix:{const t=e??Z9;return[Z9.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function E1e(r,e,t){const{prefix:n}=t;if(n!==na.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s}function x1e(r,e,t){const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s}const Lg=112,A1e=18;function UR(r,e,t){const n=U8(r),s=n+U8(e),i=new Uint8Array(s+t.byteLength);return L8(r,i,0),L8(e,i,n),i.set(t,s),i}const S1e=Symbol.for("@ipld/js-cid/CID"),hW=0,C1e="identity",dW=Z5;function I1e(r){return F8(hW,dW(r))}const fW={code:hW,name:C1e,encode:dW,digest:I1e};function k1e({name:r,code:e,encode:t}){return new T1e(r,e,t)}let T1e=class{constructor(e,t,n){h(this,"name");h(this,"code");h(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?F8(this.code,t):t.then(n=>F8(this.code,n))}else throw Error("Unknown type, must be binary type")}};function _1e(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const P1e=k1e({name:"sha2-256",code:18,encode:_1e("SHA-256")}),pW=Symbol.for("nodejs.util.inspect.custom"),N1e=114;var Rz;class O_{constructor(e){h(this,"type");h(this,"multihash");h(this,"publicKey");h(this,"string");h(this,Rz,!0);this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=na.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return D_.createV1(N1e,this.multihash)}toJSON(){return this.toString()}equals(e){var t;if(e==null)return!1;if(e instanceof Uint8Array)return rt(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(((t=e==null?void 0:e.toMultihash())==null?void 0:t.bytes)!=null)return rt(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[(Rz=QT,pW)](){return`PeerId(${this.toString()})`}}class gW extends O_{constructor(t){super({...t,type:"RSA"});h(this,"type","RSA");h(this,"publicKey");this.publicKey=t.publicKey}}class yW extends O_{constructor(t){super({...t,type:"Ed25519"});h(this,"type","Ed25519");h(this,"publicKey");this.publicKey=t.publicKey}}class mW extends O_{constructor(t){super({...t,type:"secp256k1"});h(this,"type","secp256k1");h(this,"publicKey");this.publicKey=t.publicKey}}const D1e=2336;var Bz,Mz;class wW{constructor(e){h(this,"type","url");h(this,"multihash");h(this,"publicKey");h(this,"url");h(this,Bz,!0);this.url=e.toString(),this.multihash=fW.digest(he(this.url))}[(Mz=pW,Bz=QT,Mz)](){return`PeerId(${this.url})`}toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return D_.createV1(D1e,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=ce(e)),e.toString()===this.toString())}}const O1e=114,FR=2336;function mr(r,e){let t;if(r.charAt(0)==="1"||r.charAt(0)==="Q")t=uW(na.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return Y1(D_.parse(r));throw new ie('Please pass a multibase decoder for strings that do not start with "1" or "Q"')}return ri(t)}function i1(r){if(r.type==="Ed25519")return new yW({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new mW({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new gW({multihash:r.toCID().multihash,publicKey:r});throw new If}function R1e(r){return i1(r.publicKey)}function ri(r){if(M1e(r))return new gW({multihash:r});if(B1e(r))try{const e=zq(r);if(e.type==="Ed25519")return new yW({multihash:r,publicKey:e});if(e.type==="secp256k1")return new mW({multihash:r,publicKey:e})}catch{const t=ce(r.digest);return new wW(new URL(t))}throw new U5("Supplied PeerID Multihash is invalid")}function Y1(r){if((r==null?void 0:r.multihash)==null||r.version==null||r.version===1&&r.code!==O1e&&r.code!==FR)throw new Oj("Supplied PeerID CID is invalid");if(r.code===FR){const e=ce(r.multihash.digest);return new wW(new URL(e))}return ri(r.multihash)}function B1e(r){return r.code===fW.code}function M1e(r){return r.code===P1e.code}function bW(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function $1e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var L1e=$1e,U1e=L1e;let F1e=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},z1e=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return vW(this,e)}},V1e=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return vW(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function vW(r,e){return new V1e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let H1e=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new F1e(e,t,n),this.decoder=new z1e(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function K1e({name:r,prefix:e,encode:t,decode:n}){return new H1e(r,e,t,n)}function EW({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=U1e(t,r);return K1e({prefix:e,name:r,encode:n,decode:i=>bW(s(i))})}const G1e=EW({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});EW({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var j1e=xW,zR=128,q1e=-128,W1e=Math.pow(2,31);function xW(r,e,t){e=e||[],t=t||0;for(var n=t;r>=W1e;)e[t++]=r&255|zR,r/=128;for(;r&q1e;)e[t++]=r&255|zR,r>>>=7;return e[t]=r|0,xW.bytes=t-n+1,e}var Q1e=YA,J1e=128,VR=127;function YA(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw YA.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&VR)<<s:(o&VR)*Math.pow(2,s),s+=7}while(o>=J1e);return YA.bytes=i-n,t}var Y1e=Math.pow(2,7),X1e=Math.pow(2,14),Z1e=Math.pow(2,21),ege=Math.pow(2,28),tge=Math.pow(2,35),rge=Math.pow(2,42),nge=Math.pow(2,49),sge=Math.pow(2,56),ige=Math.pow(2,63),oge=function(r){return r<Y1e?1:r<X1e?2:r<Z1e?3:r<ege?4:r<tge?5:r<rge?6:r<nge?7:r<sge?8:r<ige?9:10},age={encode:j1e,decode:Q1e,encodingLength:oge},HR=age;function KR(r,e=0){return[HR.decode(r,e),HR.decode.bytes]}function cge(r){const e=bW(r),[t,n]=KR(e),[s,i]=KR(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new lge(t,s,o,e)}let lge=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function N2(r,e){const t={[Symbol.iterator]:()=>t,next:()=>{const n=r.next(),s=n.value;return n.done===!0||s==null?{done:!0,value:void 0}:{done:!1,value:e(s)}}};return t}function eE(r){const e=cge(G1e.decode(`z${r}`));return ri(e)}class oh{constructor(e){h(this,"map");if(this.map=new Map,e!=null)for(const[t,n]of e.entries())this.map.set(t.toString(),{key:t,value:n})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return N2(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,n)=>{e(t.value,t.key,this)})}get(e){var t;return(t=this.map.get(e.toString()))==null?void 0:t.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return N2(this.map.values(),e=>e.key)}values(){return N2(this.map.values(),e=>e.value)}get size(){return this.map.size}}class Eo{constructor(e){h(this,"set");if(this.set=new Set,e!=null)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return N2(this.set.entries(),e=>{const t=eE(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{const n=eE(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return N2(this.set.values(),e=>eE(e))}intersection(e){const t=new Eo;for(const n of e)this.has(n)&&t.add(n);return t}difference(e){const t=new Eo;for(const n of this)e.has(n)||t.add(n);return t}union(e){const t=new Eo;for(const n of e)t.add(n);for(const n of this)t.add(n);return t}}function uge(){return new Eo}let AW=class extends Cq{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Q5(e);const n=vy(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),wa(i)}update(e){return O8(this),this.iHash.update(e),this}digestInto(e){O8(this),$m(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const tv=(r,e,t)=>new AW(r,e).update(t).digest();tv.create=(r,e)=>new AW(r,e);function SW(r,e,t,n){Q5(r);const s=Kfe({dkLen:32,asyncTick:10},n),{c:i,dkLen:o,asyncTick:a}=s;if(Lp(i),Lp(o),Lp(a),i<1)throw new Error("iterations (c) should be >= 1");const c=ER(e),l=ER(t),u=new Uint8Array(o),d=tv.create(r,c),p=d._cloneInto().update(l);return{c:i,dkLen:o,asyncTick:a,DK:u,PRF:d,PRFSalt:p}}function CW(r,e,t,n,s){return r.destroy(),e.destroy(),n&&n.destroy(),wa(s),t}function hge(r,e,t,n){const{c:s,dkLen:i,DK:o,PRF:a,PRFSalt:c}=SW(r,e,t,n);let l;const u=new Uint8Array(4),d=P2(u),p=new Uint8Array(a.outputLen);for(let y=1,f=0;f<i;y++,f+=a.outputLen){const g=o.subarray(f,f+a.outputLen);d.setInt32(0,y,!1),(l=c._cloneInto(l)).update(u).digestInto(p),g.set(p.subarray(0,g.length));for(let w=1;w<s;w++){a._cloneInto(l).update(p).digestInto(p);for(let m=0;m<g.length;m++)g[m]^=p[m]}}return CW(a,c,o,l,p)}async function IW(r,e,t,n){const{c:s,dkLen:i,asyncTick:o,DK:a,PRF:c,PRFSalt:l}=SW(r,e,t,n);let u;const d=new Uint8Array(4),p=P2(d),y=new Uint8Array(c.outputLen);for(let f=1,g=0;g<i;f++,g+=c.outputLen){const w=a.subarray(g,g+c.outputLen);p.setInt32(0,f,!1),(u=l._cloneInto(u)).update(d).digestInto(y),w.set(y.subarray(0,w.length)),await Hfe(s-1,o,()=>{c._cloneInto(u).update(y).digestInto(y);for(let m=0;m<w.length;m++)w[m]^=y[m]})}return CW(c,l,a,u,y)}const Ug=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),bl=new Uint32Array(80);class dge extends v_{constructor(){super(64,20,8,!1),this.A=Ug[0]|0,this.B=Ug[1]|0,this.C=Ug[2]|0,this.D=Ug[3]|0,this.E=Ug[4]|0}get(){const{A:e,B:t,C:n,D:s,E:i}=this;return[e,t,n,s,i]}set(e,t,n,s,i){this.A=e|0,this.B=t|0,this.C=n|0,this.D=s|0,this.E=i|0}process(e,t){for(let c=0;c<16;c++,t+=4)bl[c]=e.getUint32(t,!1);for(let c=16;c<80;c++)bl[c]=J9(bl[c-3]^bl[c-8]^bl[c-14]^bl[c-16],1);let{A:n,B:s,C:i,D:o,E:a}=this;for(let c=0;c<80;c++){let l,u;c<20?(l=Iq(s,i,o),u=1518500249):c<40?(l=s^i^o,u=1859775393):c<60?(l=kq(s,i,o),u=2400959708):(l=s^i^o,u=3395469782);const d=J9(n,5)+l+a+u+bl[c]|0;a=o,o=i,i=J9(s,30),s=n,n=d}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,this.set(n,s,i,o,a)}roundClean(){wa(bl)}destroy(){this.set(0,0,0,0,0),wa(this.buffer)}}const fge=b_(()=>new dge),pge=fge,R_=cpe,gge=ti({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});ti({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});ti({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});ti({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const GR={sha1:pge,"sha2-256":_d,"sha2-512":R_};function jR(r,e,t,n,s){if(s!=="sha1"&&s!=="sha2-256"&&s!=="sha2-512"){const a=Object.keys(GR).join(" / ");throw new ie(`Hash '${s}' is unknown or not supported. Must be ${a}`)}const i=GR[s],o=hge(i,r,e,{c:t,dkLen:n});return gge.encode(o).substring(1)}const B_={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},kW={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},TW=new globalThis.TextEncoder;function yge(r,e){const t=B_[e];let n=kW[e];for(let s=0;s<r.length;s++)n^=BigInt(r[s]),n=BigInt.asUintN(e,n*t);return n}function mge(r,e,t){if(t.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");const n=B_[e];let s=kW[e],i=r;for(;i.length>0;){const o=TW.encodeInto(i,t);i=i.slice(o.read);for(let a=0;a<o.written;a++)s^=BigInt(t[a]),s=BigInt.asUintN(e,s*n)}return s}function wge(r,{size:e=32,utf8Buffer:t}={}){if(!B_[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof r=="string"){if(t)return mge(r,e,t);r=TW.encode(r)}return yge(r,e)}const M_={hash:r=>Number(wge(r,{size:32})),hashV:(r,e)=>bge(M_.hash(r,e))};function bge(r){let e=r.toString(16);return e.length%2===1&&(e=`0${e}`),he(e,"base16")}const _W=64;class Kh{constructor(e,t,n,s=2){h(this,"fp");h(this,"h");h(this,"seed");if(s>_W)throw new TypeError("Invalid Fingerprint Size");const i=t.hashV(e,n),o=it(s);for(let a=0;a<o.length;a++)o[a]=i[a];o.length===0&&(o[0]=7),this.fp=o,this.h=t,this.seed=n}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return(e==null?void 0:e.fp)instanceof Uint8Array?rt(this.fp,e.fp):!1}}function z8(r,e){return Math.floor(Math.random()*(e-r))+r}class e3{constructor(e){h(this,"contents");this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof Kh))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof Kh))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof Kh))throw new TypeError("Invalid Fingerprint");const t=z8(0,this.contents.length-1),n=this.contents[t];return this.contents[t]=e,n}remove(e){if(!(e instanceof Kh))throw new TypeError("Invalid Fingerprint");const t=this.contents.findIndex(n=>e.equals(n));return t>-1?(this.contents[t]=null,!0):!1}}const vge=500;class qR{constructor(e){h(this,"bucketSize");h(this,"filterSize");h(this,"fingerprintSize");h(this,"buckets");h(this,"count");h(this,"hash");h(this,"seed");this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??M_,this.seed=e.seed??z8(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=he(e));const t=new Kh(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,s=(n^t.hash())%this.filterSize;if(this.buckets[n]==null&&(this.buckets[n]=new e3(this.bucketSize)),this.buckets[s]==null&&(this.buckets[s]=new e3(this.bucketSize)),this.buckets[n].add(t)||this.buckets[s].add(t))return this.count++,!0;const i=[n,s];let o=i[z8(0,i.length-1)];this.buckets[o]==null&&(this.buckets[o]=new e3(this.bucketSize));for(let a=0;a<vge;a++){const c=this.buckets[o].swap(t);if(c!=null&&(o=(o^c.hash())%this.filterSize,this.buckets[o]==null&&(this.buckets[o]=new e3(this.bucketSize)),this.buckets[o].add(c)))return this.count++,!0}return!1}has(e){var o,a;typeof e=="string"&&(e=he(e));const t=new Kh(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,s=((o=this.buckets[n])==null?void 0:o.has(t))??!1;if(s)return s;const i=(n^t.hash())%this.filterSize;return((a=this.buckets[i])==null?void 0:a.has(t))??!1}remove(e){var a,c;typeof e=="string"&&(e=he(e));const t=new Kh(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,s=((a=this.buckets[n])==null?void 0:a.remove(t))??!1;if(s)return this.count--,s;const i=(n^t.hash())%this.filterSize,o=((c=this.buckets[i])==null?void 0:c.remove(t))??!1;return o&&this.count--,o}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}}const Ege={1:.5,2:.84,4:.95,8:.98};function xge(r=.001){return r>.002?2:r>1e-5?4:8}function Age(r,e=.001){const t=xge(e),n=Ege[t],s=Math.round(r/n),i=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),_W);return{filterSize:s,bucketSize:t,fingerprintSize:i}}class Sge{constructor(e){h(this,"filterSize");h(this,"bucketSize");h(this,"fingerprintSize");h(this,"scale");h(this,"filterSeries");h(this,"hash");h(this,"seed");this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??M_,this.seed=e.seed??z8(0,Math.pow(2,10)),this.filterSeries=[new qR({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=he(e)),this.has(e))return!0;let t=this.filterSeries.find(n=>n.reliable);if(t==null){const n=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new qR({filterSize:n,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=he(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=he(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}function jd(r,e=.001,t){return new Sge({...Age(r,e)})}class Cge{constructor(e,t){h(this,"filter");this.filter=jd(e,t)}has(e){return this.filter.has(e.toMultihash().bytes)}add(e){this.filter.add(e.toMultihash().bytes)}remove(e){var t,n;(n=(t=this.filter).remove)==null||n.call(t,e.toMultihash().bytes)}}function Ige(r,e=.001){return new Cge(r,e)}class kge extends oh{constructor(t){super();h(this,"metric");const{name:n,metrics:s}=t;this.metric=s.registerMetric(n),this.updateComponentMetric()}set(t,n){return super.set(t,n),this.updateComponentMetric(),this}delete(t){const n=super.delete(t);return this.updateComponentMetric(),n}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function PW(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new kge({name:e,metrics:t}):n=new oh,n}function Tge(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function $_(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function _ge(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var Pge=_ge,Nge=Pge;let Dge=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Oge=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return NW(this,e)}},Rge=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return NW(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function NW(r,e){return new Rge({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Bge=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Dge(e,t,n),this.decoder=new Oge(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function DW({name:r,prefix:e,encode:t,decode:n}){return new Bge(r,e,t,n)}function rv({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=Nge(t,r);return DW({prefix:e,name:r,encode:n,decode:i=>$_(s(i))})}function Mge(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function $ge(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function ni({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return DW({prefix:e,name:r,encode(s){return $ge(s,n,t)},decode(s){return Mge(s,n,t,r)}})}const o4=ni({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ni({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});ni({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});ni({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});ni({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});ni({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});ni({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});ni({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});ni({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const tE=rv({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});rv({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Tl=rv({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});rv({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Lge=OW,WR=128,Uge=-128,Fge=Math.pow(2,31);function OW(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Fge;)e[t++]=r&255|WR,r/=128;for(;r&Uge;)e[t++]=r&255|WR,r>>>=7;return e[t]=r|0,OW.bytes=t-n+1,e}var zge=XA,Vge=128,QR=127;function XA(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw XA.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&QR)<<s:(o&QR)*Math.pow(2,s),s+=7}while(o>=Vge);return XA.bytes=i-n,t}var Hge=Math.pow(2,7),Kge=Math.pow(2,14),Gge=Math.pow(2,21),jge=Math.pow(2,28),qge=Math.pow(2,35),Wge=Math.pow(2,42),Qge=Math.pow(2,49),Jge=Math.pow(2,56),Yge=Math.pow(2,63),Xge=function(r){return r<Hge?1:r<Kge?2:r<Gge?3:r<jge?4:r<qge?5:r<Wge?6:r<Qge?7:r<Jge?8:r<Yge?9:10},Zge={encode:Lge,decode:zge,encodingLength:Xge},V8=Zge;function ZA(r,e=0){return[V8.decode(r,e),V8.decode.bytes]}function H8(r,e,t=0){return V8.encode(r,e,t),e}function K8(r){return V8.encodingLength(r)}function eS(r,e){const t=e.byteLength,n=K8(r),s=n+K8(t),i=new Uint8Array(s+t);return H8(r,i,0),H8(t,i,n),i.set(e,s),new L_(r,t,e,i)}function e2e(r){const e=$_(r),[t,n]=ZA(e),[s,i]=ZA(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new L_(t,s,o,e)}function t2e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Tge(r.bytes,t.bytes)}}let L_=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function JR(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return n2e(t,tS(r),e??Tl.encoder);default:return s2e(t,tS(r),e??o4.encoder)}}const YR=new WeakMap;function tS(r){const e=YR.get(r);if(e==null){const t=new Map;return YR.set(r,t),t}return e}var $z;let rS=class fn{constructor(e,t,n,s){h(this,"code");h(this,"version");h(this,"multihash");h(this,"bytes");h(this,"/");h(this,$z,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Fg)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==i2e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return fn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=eS(e,t);return fn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return fn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&t2e(e.multihash,n.multihash)}toString(e){return JR(this,e)}toJSON(){return{"/":JR(this)}}link(){return this}[($z=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof fn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new fn(n,s,i,o??XR(n,s,i.bytes))}else if(t[o2e]===!0){const{version:n,multihash:s,code:i}=t,o=e2e(s);return fn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Fg)throw new Error(`Version 0 CID must use dag-pb (code: ${Fg}) block encoding`);return new fn(e,t,n,n.bytes)}case 1:{const s=XR(e,t,n.bytes);return new fn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return fn.create(0,Fg,e)}static createV1(e,t){return fn.create(1,e,t)}static decode(e){const[t,n]=fn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=fn.inspectBytes(e),n=t.size-t.multihashSize,s=$_(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new L_(t.multihashCode,t.digestSize,i,s);return[t.version===0?fn.createV0(o):fn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=ZA(e.subarray(t));return t+=p,d};let s=n(),i=Fg;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,s]=r2e(e,t),i=fn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return tS(i).set(n,e),i}};function r2e(r,e){switch(r[0]){case"Q":{const t=e??Tl;return[Tl.prefix,t.decode(`${Tl.prefix}${r}`)]}case Tl.prefix:{const t=e??Tl;return[Tl.prefix,t.decode(r)]}case o4.prefix:{const t=e??o4;return[o4.prefix,t.decode(r)]}case tE.prefix:{const t=e??tE;return[tE.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function n2e(r,e,t){const{prefix:n}=t;if(n!==Tl.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s}function s2e(r,e,t){const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s}const Fg=112,i2e=18;function XR(r,e,t){const n=K8(r),s=n+K8(e),i=new Uint8Array(s+t.byteLength);return H8(r,i,0),H8(e,i,n),i.set(t,s),i}const o2e=Symbol.for("@ipld/js-cid/CID"),rE=ni({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});ni({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});ni({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});ni({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});class a2{constructor(e=!1,t=0){h(this,"full");h(this,"pendingBytes");h(this,"wantlist");h(this,"blocks");h(this,"blockPresences");this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}addWantlistEntry(e,t){const n=rE.encode(e.multihash.bytes);this.wantlist.set(n,t)}addBlockPresence(e,t){const n=rE.encode(e.multihash.bytes);this.blockPresences.set(n,t)}addBlock(e,t){const n=rE.encode(e.multihash.bytes);this.blocks.set(n,t)}}function a2e(r){let e=new Uint8Array(r.reduce((n,s)=>n+kt(s),0)),t=0;for(const n of r)e=Jr(n,e,t),t+=kt(n);return e}function ZR(r){return a2e([r.version,r.code,r.multihash.code,r.multihash.digest.byteLength])}class c2e{constructor(e,t){h(this,"peerId");h(this,"blockstore");h(this,"network");h(this,"wants");h(this,"exchangeCount");h(this,"bytesSent");h(this,"bytesReceived");h(this,"lastExchange");h(this,"maxSizeReplaceHasWithBlock");h(this,"log");this.peerId=e.peerId,this.blockstore=e.blockstore,this.network=e.network,this.wants=new Map,this.log=e.logger.forComponent(`helia:bitswap:ledger:${e.peerId}`),this.exchangeCount=0,this.bytesSent=0,this.bytesReceived=0,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock??P0e}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesReceived+=e}debtRatio(){return this.bytesSent/(this.bytesReceived+1)}async sendBlocksToPeer(e){const t=new a2,n=new Set;for(const[s,i]of this.wants.entries())try{const o=await this.blockstore.get(i.cid,e);i.wantType===Nr.WantHave?o.byteLength<this.maxSizeReplaceHasWithBlock?(this.log("sending have and block for %c",i.cid),n.add(s),t.addBlock(i.cid,{data:o,prefix:ZR(i.cid)})):(this.log("sending have for %c",i.cid),t.addBlockPresence(i.cid,{cid:i.cid.bytes,type:ga.HaveBlock})):(this.log("sending block for %c",i.cid),n.add(s),t.addBlock(i.cid,{data:o,prefix:ZR(i.cid)}))}catch(o){if(o.name!=="NotFoundError")throw o;if(this.log("do not have block for %c",i.cid),!i.sendDontHave||i.sentDoNotHave===!0)continue;i.sentDoNotHave=!0,t.addBlockPresence(i.cid,{cid:i.cid.bytes,type:ga.DoNotHaveBlock})}if(t.blocks.size>0||t.blockPresences.size>0){this.log("sending message"),await this.network.sendMessage(this.peerId,t,e),this.log("sent message"),this.sentBytes([...t.blocks.values()].reduce((s,i)=>s+i.data.byteLength,0));for(const s of n)this.wants.delete(s)}}}class l2e{constructor(e,t={}){h(this,"blockstore");h(this,"network");h(this,"ledgerMap");h(this,"maxSizeReplaceHasWithBlock");h(this,"log");h(this,"logger");this.blockstore=e.blockstore,this.network=e.network,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock,this.log=e.logger.forComponent("helia:bitswap:peer-want-lists"),this.logger=e.logger,this.ledgerMap=PW({name:"helia_bitswap_ledger_map",metrics:e.metrics}),this.network.addEventListener("bitswap:message",n=>{this.receiveMessage(n.detail.peer,n.detail.message).catch(s=>{this.log.error("error receiving bitswap message from %p",n.detail.peer,s)})}),this.network.addEventListener("peer:disconnected",n=>{this.peerDisconnected(n.detail)})}ledgerForPeer(e){const t=this.ledgerMap.get(e);if(t!=null)return{peer:t.peerId,value:t.debtRatio(),sent:t.bytesSent,received:t.bytesReceived,exchanged:t.exchangeCount}}wantListForPeer(e){const t=this.ledgerMap.get(e);if(t!=null)return[...t.wants.values()]}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.peerId)}async receiveMessage(e,t){var s;let n=this.ledgerMap.get(e);if(n==null&&(n=new c2e({peerId:e,blockstore:this.blockstore,network:this.network,logger:this.logger},{maxSizeReplaceHasWithBlock:this.maxSizeReplaceHasWithBlock}),this.ledgerMap.set(e,n)),n.receivedBytes(((s=t.blocks)==null?void 0:s.reduce((i,o)=>i+o.data.byteLength,0))??0),t.wantlist!=null){t.wantlist.full===!0&&n.wants.clear();for(const i of t.wantlist.entries){const o=rS.decode(i.cid),a=ce(o.multihash.bytes,"base64");i.cancel===!0?(this.log("peer %p cancelled want of block for %c",e,o),n.wants.delete(a)):(i.wantType===Nr.WantHave?this.log("peer %p wanted block presence for %c",e,o):this.log("peer %p wanted block for %c",e,o),n.wants.set(a,{cid:o,priority:i.priority,wantType:i.wantType??Nr.WantBlock,sendDontHave:i.sendDontHave??!1}))}}this.log("send blocks to peer"),await n.sendBlocksToPeer()}async receivedBlock(e,t){const n=ce(e.multihash.bytes,"base64"),s=[];for(const i of this.ledgerMap.values())i.wants.has(n)&&s.push(i);await Promise.all(s.map(async i=>i.sendBlocksToPeer(t)))}peerDisconnected(e){this.ledgerMap.delete(e)}}function u2e(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function h2e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var d2e=h2e,f2e=d2e;let p2e=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},g2e=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return RW(this,e)}},y2e=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return RW(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function RW(r,e){return new y2e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let m2e=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new p2e(e,t,n),this.decoder=new g2e(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function BW({name:r,prefix:e,encode:t,decode:n}){return new m2e(r,e,t,n)}function MW({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=f2e(t,r);return BW({prefix:e,name:r,encode:n,decode:i=>u2e(s(i))})}function w2e(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function b2e(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function si({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return BW({prefix:e,name:r,encode(s){return b2e(s,n,t)},decode(s){return w2e(s,n,t,r)}})}const v2e=si({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});si({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});si({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});si({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});si({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});si({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});si({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});si({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});si({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const E2e=MW({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});MW({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const x2e=si({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});si({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});si({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});si({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const o1=1e3,a1=o1*60,c1=a1*60,qd=c1*24,A2e=qd*7,S2e=qd*365.25;function $W(r,e){try{if(typeof r=="string"&&r.length>0)return C2e(r);if(typeof r=="number"&&isFinite(r))return e!=null&&e.long?k2e(r):I2e(r);throw new Error("Value is not a string or number.")}catch(t){const n=T2e(t)?`${t.message}. value=${JSON.stringify(r)}`:"An unknown error has occured.";throw new Error(n)}}function C2e(r){if(r=String(r),r.length>100)throw new Error("Value exceeds the maximum length of 100 characters.");const e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!e)return NaN;const t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*S2e;case"weeks":case"week":case"w":return t*A2e;case"days":case"day":case"d":return t*qd;case"hours":case"hour":case"hrs":case"hr":case"h":return t*c1;case"minutes":case"minute":case"mins":case"min":case"m":return t*a1;case"seconds":case"second":case"secs":case"sec":case"s":return t*o1;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:throw new Error(`The unit ${n} was matched, but no matching case exists.`)}}function I2e(r){const e=Math.abs(r);return e>=qd?`${Math.round(r/qd)}d`:e>=c1?`${Math.round(r/c1)}h`:e>=a1?`${Math.round(r/a1)}m`:e>=o1?`${Math.round(r/o1)}s`:`${r}ms`}function k2e(r){const e=Math.abs(r);return e>=qd?t3(r,e,qd,"day"):e>=c1?t3(r,e,c1,"hour"):e>=a1?t3(r,e,a1,"minute"):e>=o1?t3(r,e,o1,"second"):`${r} ms`}function t3(r,e,t,n){const s=e>=t*1.5;return`${Math.round(r/t)} ${n}${s?"s":""}`}function T2e(r){return typeof r=="object"&&r!==null&&"message"in r}function _2e(r){t.debug=t,t.default=t,t.coerce=c,t.disable=i,t.enable=s,t.enabled=o,t.humanize=$W,t.destroy=l,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let p=0;p<u.length;p++)d=(d<<5)-d+u.charCodeAt(p),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,p=null,y,f;function g(...w){if(!g.enabled)return;const m=g,b=Number(new Date),v=b-(d||b);m.diff=v,m.prev=d,m.curr=b,d=b,w[0]=t.coerce(w[0]),typeof w[0]!="string"&&w.unshift("%O");let E=0;w[0]=w[0].replace(/%([a-zA-Z%])/g,(I,x)=>{if(I==="%%")return"%";E++;const C=t.formatters[x];if(typeof C=="function"){const P=w[E];I=C.call(m,P),w.splice(E,1),E--}return I}),t.formatArgs.call(m,w),(m.log||t.log).apply(m,w)}return g.namespace=u,g.useColors=t.useColors(),g.color=t.selectColor(u),g.extend=n,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(y!==t.namespaces&&(y=t.namespaces,f=t.enabled(u)),f),set:w=>{p=w}}),typeof t.init=="function"&&t.init(g),g}function n(u,d){const p=t(this.namespace+(typeof d>"u"?":":d)+u);return p.log=this.log,p}function s(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let d;const p=(typeof u=="string"?u:"").split(/[\s,]+/),y=p.length;for(d=0;d<y;d++)p[d]&&(u=p[d].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function i(){const u=[...t.names.map(a),...t.skips.map(a).map(d=>"-"+d)].join(",");return t.enable(""),u}function o(u){if(u[u.length-1]==="*")return!0;let d,p;for(d=0,p=t.skips.length;d<p;d++)if(t.skips[d].test(u))return!1;for(d=0,p=t.names.length;d<p;d++)if(t.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack??u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.setupFormatters(t.formatters),t.enable(t.load()),t}var P2e={};const sa=$2e(),N2e=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function D2e(){var r,e,t,n,s;return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&((r=navigator.userAgent)==null?void 0:r.toLowerCase().match(/(edge|trident)\/(\d+)/))!=null?!1:typeof document<"u"&&((t=(e=document.documentElement)==null?void 0:e.style)==null?void 0:t.WebkitAppearance)||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&((n=navigator.userAgent)==null?void 0:n.toLowerCase().match(/firefox\/(\d+)/))!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&((s=navigator.userAgent)==null?void 0:s.toLowerCase().match(/applewebkit\/(\d+)/))}function O2e(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+$W(this.diff),!this.useColors)return;const e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(t++,s==="%c"&&(n=t))}),r.splice(n,0,e)}const R2e=console.debug??console.log??(()=>{});function B2e(r){try{r?sa==null||sa.setItem("debug",r):sa==null||sa.removeItem("debug")}catch{}}function M2e(){let r;try{r=sa==null?void 0:sa.getItem("debug")}catch{}return!r&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(r=P2e.DEBUG),r}function $2e(){try{return localStorage}catch{}}function L2e(r){r.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}const js=_2e({formatArgs:O2e,save:B2e,load:M2e,useColors:D2e,setupFormatters:L2e,colors:N2e,storage:sa,log:R2e});js.formatters.b=r=>r==null?"undefined":E2e.baseEncode(r);js.formatters.t=r=>r==null?"undefined":v2e.baseEncode(r);js.formatters.m=r=>r==null?"undefined":x2e.baseEncode(r);js.formatters.p=r=>r==null?"undefined":r.toString();js.formatters.c=r=>r==null?"undefined":r.toString();js.formatters.k=r=>r==null?"undefined":r.toString();js.formatters.a=r=>r==null?"undefined":r.toString();js.formatters.e=r=>r==null?"undefined":eB(r.stack)??eB(r.message)??r.toString();function U2e(r){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function nv(){return{forComponent(r){return X1(r)}}}function X1(r){let e=U2e(`${r}:trace`);return js.enabled(`${r}:trace`)&&js.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=js(`${r}:trace`)),Object.assign(js(r),{error:js(`${r}:error`),trace:e})}function eB(r){if(r!=null&&(r=r.trim(),r.length!==0))return r}function LW(r){const e=[Vu.A];return r==null?e:Array.isArray(r)?r.length===0?e:r:[r]}const UW=60;function FW(r){return{Status:r.Status??0,TC:r.TC??r.flag_tc??!1,RD:r.RD??r.flag_rd??!1,RA:r.RA??r.flag_ra??!1,AD:r.AD??r.flag_ad??!1,CD:r.CD??r.flag_cd??!1,Question:(r.Question??r.questions??[]).map(e=>({name:e.name,type:Vu[e.type]})),Answer:(r.Answer??r.answers??[]).map(e=>({name:e.name,type:Vu[e.type],TTL:e.TTL??e.ttl??UW,data:e.data instanceof Uint8Array?ce(e.data):e.data}))}}const F2e=4;function tB(r,e={}){const t=new Bu({concurrency:e.queryConcurrency??F2e});return async(n,s={})=>{var a;const i=new URLSearchParams;i.set("name",n),LW(s.types).forEach(c=>{i.append("type",Vu[c])}),(a=s.onProgress)==null||a.call(s,new Re("dns:query",{detail:n}));const o=await t.add(async()=>{var u;const c=await fetch(`${r}?${i}`,{headers:{accept:"application/dns-json"},signal:s==null?void 0:s.signal});if(c.status!==200)throw new Error(`Unexpected HTTP status: ${c.status} - ${c.statusText}`);const l=FW(await c.json());return(u=s.onProgress)==null||u.call(s,new Re("dns:response",{detail:l})),l},{signal:s.signal});if(o==null)throw new Error("No DNS response received");return o}}function z2e(){return[tB("https://cloudflare-dns.com/dns-query"),tB("https://dns.google/resolve")]}var V2e=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),n=Object.create(null);function s(i,o){t[i]=o,e++,e>=r&&(e=0,n=t,t=Object.create(null))}return{has:function(i){return t[i]!==void 0||n[i]!==void 0},remove:function(i){t[i]!==void 0&&(t[i]=void 0),n[i]!==void 0&&(n[i]=void 0)},get:function(i){var o=t[i];if(o!==void 0)return o;if((o=n[i])!==void 0)return s(i,o),o},set:function(i,o){t[i]!==void 0?t[i]=o:s(i,o)},clear:function(){t=Object.create(null),n=Object.create(null)}}};const H2e=Zu(V2e);class K2e{constructor(e){h(this,"lru");this.lru=H2e(e)}get(e,t){let n=!0;const s=[];for(const i of t){const o=this.getAnswers(e,i);if(o.length===0){n=!1;break}s.push(...o)}if(n)return FW({answers:s})}getAnswers(e,t){const n=`${e.toLowerCase()}-${t}`,s=this.lru.get(n);if(s!=null){const i=s.filter(o=>o.expires>Date.now()).map(({expires:o,value:a})=>({...a,TTL:Math.round((o-Date.now())/1e3),type:Vu[a.type]}));return i.length===0&&this.lru.remove(n),i}return[]}add(e,t){const n=`${e.toLowerCase()}-${t.type}`,s=this.lru.get(n)??[];s.push({expires:Date.now()+(t.TTL??UW)*1e3,value:t}),this.lru.set(n,s)}remove(e,t){const n=`${e.toLowerCase()}-${t}`;this.lru.remove(n)}clear(){this.lru.clear()}}function G2e(r){return new K2e(r)}const j2e=1e3;let q2e=class{constructor(e){h(this,"resolvers");h(this,"cache");this.resolvers={},this.cache=G2e(e.cacheSize??j2e),Object.entries(e.resolvers??{}).forEach(([t,n])=>{Array.isArray(n)||(n=[n]),t.endsWith(".")||(t=`${t}.`),this.resolvers[t]=n}),this.resolvers["."]==null&&(this.resolvers["."]=z2e())}async query(e,t={}){var c,l,u;const n=LW(t.types),s=t.cached!==!1?this.cache.get(e,n):void 0;if(s!=null)return(c=t.onProgress)==null||c.call(t,new Re("dns:cache",{detail:s})),s;const i=`${e.split(".").pop()}.`,o=(this.resolvers[i]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),a=[];for(const d of o){if(((l=t.signal)==null?void 0:l.aborted)===!0)break;try{const p=await d(e,{...t,types:n});for(const y of p.Answer)this.cache.add(e,y);return p}catch(p){a.push(p),(u=t.onProgress)==null||u.call(t,new Re("dns:error",{detail:p}))}}throw a.length===1?a[0]:new AggregateError(a,`DNS lookup of ${e} ${n} failed`)}};var Vu;(function(r){r[r.A=1]="A",r[r.CNAME=5]="CNAME",r[r.TXT=16]="TXT",r[r.AAAA=28]="AAAA"})(Vu||(Vu={}));function zW(r={}){return new q2e(r)}const Ma="/",VW=new TextEncoder().encode(Ma),r3=VW[0];class Dt{constructor(e,t){h(this,"_buf");if(typeof e=="string")this._buf=he(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==r3)throw new Error("Invalid key")}toString(e="utf8"){return ce(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Dt(e.join(Ma))}static random(){return new Dt(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new Dt(e):typeof e.uint8Array=="function"?new Dt(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=VW),this._buf[0]!==r3){const e=new Uint8Array(this._buf.byteLength+1);e.fill(r3,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===r3;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),n=e.list();for(let s=0;s<t.length;s++){if(n.length<s+1)return!1;const i=t[s],o=n[s];if(i<o)return!0;if(i>o)return!1}return t.length<n.length}reverse(){return Dt.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Ma).slice(1)}type(){return W2e(this.baseNamespace())}name(){return Q2e(this.baseNamespace())}instance(e){return new Dt(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Ma)||(e+=Ma),e+=this.type(),new Dt(e)}parent(){const e=this.list();return e.length===1?new Dt(Ma):new Dt(e.slice(0,-1).join(Ma))}child(e){return this.toString()===Ma?e:e.toString()===Ma?this:new Dt(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return Dt.withNamespaces([...this.namespaces(),...J2e(e.map(t=>t.namespaces()))])}}function W2e(r){const e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function Q2e(r){const e=r.split(":");return e[e.length-1]}function J2e(r){return[].concat(...r)}function Y2e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Z1(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function X2e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var Z2e=X2e,eye=Z2e;let tye=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},rye=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return HW(this,e)}},nye=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return HW(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function HW(r,e){return new nye({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let sye=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new tye(e,t,n),this.decoder=new rye(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function KW({name:r,prefix:e,encode:t,decode:n}){return new sye(r,e,t,n)}function sv({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=eye(t,r);return KW({prefix:e,name:r,encode:n,decode:i=>Z1(s(i))})}function iye(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function oye(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function ii({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return KW({prefix:e,name:r,encode(s){return oye(s,n,t)},decode(s){return iye(s,n,t,r)}})}const Up=sv({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});sv({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const a4=ii({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ii({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});ii({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});ii({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});ii({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});ii({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});ii({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});ii({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});ii({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const _l=sv({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});sv({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var aye=GW,rB=128,cye=-128,lye=Math.pow(2,31);function GW(r,e,t){e=e||[],t=t||0;for(var n=t;r>=lye;)e[t++]=r&255|rB,r/=128;for(;r&cye;)e[t++]=r&255|rB,r>>>=7;return e[t]=r|0,GW.bytes=t-n+1,e}var uye=nS,hye=128,nB=127;function nS(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw nS.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&nB)<<s:(o&nB)*Math.pow(2,s),s+=7}while(o>=hye);return nS.bytes=i-n,t}var dye=Math.pow(2,7),fye=Math.pow(2,14),pye=Math.pow(2,21),gye=Math.pow(2,28),yye=Math.pow(2,35),mye=Math.pow(2,42),wye=Math.pow(2,49),bye=Math.pow(2,56),vye=Math.pow(2,63),Eye=function(r){return r<dye?1:r<fye?2:r<pye?3:r<gye?4:r<yye?5:r<mye?6:r<wye?7:r<bye?8:r<vye?9:10},xye={encode:aye,decode:uye,encodingLength:Eye},G8=xye;function sS(r,e=0){return[G8.decode(r,e),G8.decode.bytes]}function j8(r,e,t=0){return G8.encode(r,e,t),e}function q8(r){return G8.encodingLength(r)}function W8(r,e){const t=e.byteLength,n=q8(r),s=n+q8(t),i=new Uint8Array(s+t);return j8(r,i,0),j8(t,i,n),i.set(e,s),new U_(r,t,e,i)}function Aye(r){const e=Z1(r),[t,n]=sS(e),[s,i]=sS(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new U_(t,s,o,e)}function Sye(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Y2e(r.bytes,t.bytes)}}let U_=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function sB(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Iye(t,iS(r),e??_l.encoder);default:return kye(t,iS(r),e??a4.encoder)}}const iB=new WeakMap;function iS(r){const e=iB.get(r);if(e==null){const t=new Map;return iB.set(r,t),t}return e}var Lz;let Wd=class pn{constructor(e,t,n,s){h(this,"code");h(this,"version");h(this,"multihash");h(this,"bytes");h(this,"/");h(this,Lz,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==zg)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Tye)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return pn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=W8(e,t);return pn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return pn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Sye(e.multihash,n.multihash)}toString(e){return sB(this,e)}toJSON(){return{"/":sB(this)}}link(){return this}[(Lz=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof pn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new pn(n,s,i,o??oB(n,s,i.bytes))}else if(t[_ye]===!0){const{version:n,multihash:s,code:i}=t,o=Aye(s);return pn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==zg)throw new Error(`Version 0 CID must use dag-pb (code: ${zg}) block encoding`);return new pn(e,t,n,n.bytes)}case 1:{const s=oB(e,t,n.bytes);return new pn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return pn.create(0,zg,e)}static createV1(e,t){return pn.create(1,e,t)}static decode(e){const[t,n]=pn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=pn.inspectBytes(e),n=t.size-t.multihashSize,s=Z1(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new U_(t.multihashCode,t.digestSize,i,s);return[t.version===0?pn.createV0(o):pn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=sS(e.subarray(t));return t+=p,d};let s=n(),i=zg;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,s]=Cye(e,t),i=pn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return iS(i).set(n,e),i}};function Cye(r,e){switch(r[0]){case"Q":{const t=e??_l;return[_l.prefix,t.decode(`${_l.prefix}${r}`)]}case _l.prefix:{const t=e??_l;return[_l.prefix,t.decode(r)]}case a4.prefix:{const t=e??a4;return[a4.prefix,t.decode(r)]}case Up.prefix:{const t=e??Up;return[Up.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Iye(r,e,t){const{prefix:n}=t;if(n!==_l.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s}function kye(r,e,t){const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s}const zg=112,Tye=18;function oB(r,e,t){const n=q8(r),s=n+q8(e),i=new Uint8Array(s+t.byteLength);return j8(r,i,0),j8(e,i,n),i.set(t,s),i}const _ye=Symbol.for("@ipld/js-cid/CID");function jW({name:r,code:e,encode:t}){return new Pye(r,e,t)}let Pye=class{constructor(e,t,n){h(this,"name");h(this,"code");h(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?W8(this.code,t):t.then(n=>W8(this.code,n))}else throw Error("Unknown type, must be binary type")}};function n3({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*Nye(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const s=[...r,t],i=Wd.asCID(n);i!=null?yield[s.join("/"),i]:typeof n=="object"&&(yield*oS(n,s))}else{const t=Wd.asCID(e);t!=null?yield[r.join("/"),t]:yield*oS(e,r)}}function*oS(r,e){if(r==null||r instanceof Uint8Array)return;const t=Wd.asCID(r);t!=null&&(yield[e.join("/"),t]);for(const[n,s]of Object.entries(r)){const i=[...e,n];yield*Nye(i,s)}}function*Dye(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const s=[...r,t];yield s.join("/"),typeof n=="object"&&Wd.asCID(n)==null&&(yield*aS(n,s))}else yield*aS(e,r)}function*aS(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const s=[...e,t];yield s.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&Wd.asCID(n)==null&&(yield*Dye(s,n))}}function Oye(r,e){let t=r;for(const[n,s]of e.entries()){if(t=t[s],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);const i=Wd.asCID(t);if(i!=null)return{value:i,remaining:e.slice(n+1).join("/")}}return{value:t}}let Rye=class{constructor({cid:e,bytes:t,value:n}){h(this,"cid");h(this,"bytes");h(this,"value");h(this,"asBlock");if(e==null||t==null||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:n3(),bytes:n3(),value:n3(),asBlock:n3()})}links(){return oS(this.value,[])}tree(){return aS(this.value,[])}get(e="/"){return Oye(this.value,e.split("/").filter(Boolean))}};function Bye({bytes:r,cid:e,value:t,codec:n}){const s=t!==void 0?t:n==null?void 0:n.decode(r);if(s===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new Rye({cid:e,bytes:r,value:s})}const qW="/pin/",aB="/pinned-block/",cS=Up,cB=1;function s3(r){return r.version===0&&(r=r.toV1()),new Dt(`${qW}${r.toString(cS)}`)}var Ic,c4,lS;class Mye{constructor(e,t,n){Q(this,Ic);h(this,"datastore");h(this,"blockstore");h(this,"getCodec");this.datastore=e,this.blockstore=t,this.getCodec=n}async*add(e,t={}){const n=s3(e);if(await this.datastore.has(n))throw new Error("Already pinned");const s=Math.round(t.depth??1/0);if(s<0)throw new Error("Depth must be greater than or equal to 0");const i=new Gd({concurrency:cB});for await(const a of te(this,Ic,c4).call(this,e,i,{...t,depth:s}))await te(this,Ic,lS).call(this,a,c=>c.pinnedBy.find(l=>rt(l,e.bytes))!=null?!1:(c.pinCount++,c.pinnedBy.push(e.bytes),!0),t),yield a;const o={depth:s,metadata:t.metadata??{}};await this.datastore.put(n,Z3(o),t)}async*rm(e,t={}){const n=s3(e),s=await this.datastore.get(n,t),i=Fl(s);await this.datastore.delete(n,t);const o=new Gd({concurrency:cB});for await(const a of te(this,Ic,c4).call(this,e,o,{...t,depth:i.depth}))await te(this,Ic,lS).call(this,a,c=>(c.pinCount--,c.pinnedBy=c.pinnedBy.filter(l=>rt(l,e.bytes)),!0),{...t,depth:i.depth}),yield a}async*ls(e={}){for await(const{key:t,value:n}of this.datastore.query({prefix:qW+(e.cid!=null?`${e.cid.toString(Up)}`:"")},e)){const s=Wd.parse(t.toString().substring(5),Up),i=Fl(n);yield{cid:s,...i}}}async isPinned(e,t={}){const n=new Dt(`${aB}${cS.encode(e.multihash.bytes)}`);return this.datastore.has(n,t)}async get(e,t){const n=s3(e),s=await this.datastore.get(n,t);return Fl(s)}async setMetadata(e,t,n){const s=s3(e),i=await this.datastore.get(s,n),o=Fl(i);o.metadata=t??{},await this.datastore.put(s,Z3(o),n)}}Ic=new WeakSet,c4=async function*(e,t,n){if(n.depth===-1)return;const s=await this.getCodec(e.code),i=await this.blockstore.get(e,n),o=Bye({bytes:i,cid:e,codec:s});yield e;for await(const[,a]of o.links())yield*await t.add(async()=>te(this,Ic,c4).call(this,a,t,{...n,depth:n.depth-1}))},lS=async function(e,t,n){var a;const s=new Dt(`${aB}${cS.encode(e.multihash.bytes)}`);let i={pinCount:0,pinnedBy:[]};try{i=Fl(await this.datastore.get(s,n))}catch(c){if(c.name!=="NotFoundError")throw c}if(t(i)){if(i.pinCount===0&&await this.datastore.has(s)){await this.datastore.delete(s);return}await this.datastore.put(s,Z3(i),n),(a=n.onProgress)==null||a.call(n,new Re("helia:pin:add",e))}};const $ye=1,Lye=5;class WW extends Error{constructor(e="Insufficient providers found"){super(e),this.name="InsufficientProvidersError"}}h(WW,"name","InsufficientProvidersError");class c2 extends Error{constructor(e="No routers available"){super(e),this.name="NoRoutersAvailableError"}}h(c2,"name","NoRoutersAvailableError");class QW extends Error{constructor(e="Unknown hash algorithm"){super(e),this.name="UnknownHashAlgorithmError"}}h(QW,"name","UnknownHashAlgorithmError");class JW extends Error{constructor(e="Unknown codec"){super(e),this.name="UnknownCodecError"}}h(JW,"name","UnknownCodecError");const Uye=5;class Fye{constructor(e,t){h(this,"log");h(this,"routers");h(this,"providerLookupConcurrency");var n,s,i,o,a,c,l;this.log=e.logger.forComponent("helia:routing"),this.routers=t.routers??[],this.providerLookupConcurrency=t.providerLookupConcurrency??Uye,this.findProviders=((n=e.metrics)==null?void 0:n.traceFunction("helia.routing.findProviders",this.findProviders.bind(this),{optionsIndex:1}))??this.findProviders,this.provide=((s=e.metrics)==null?void 0:s.traceFunction("helia.routing.provide",this.provide.bind(this),{optionsIndex:1}))??this.provide,this.cancelReprovide=((i=e.metrics)==null?void 0:i.traceFunction("helia.routing.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1}))??this.cancelReprovide,this.put=((o=e.metrics)==null?void 0:o.traceFunction("helia.routing.put",this.put.bind(this),{optionsIndex:2}))??this.put,this.get=((a=e.metrics)==null?void 0:a.traceFunction("helia.routing.get",this.get.bind(this),{optionsIndex:1}))??this.get,this.findPeer=((c=e.metrics)==null?void 0:c.traceFunction("helia.routing.findPeer",this.findPeer.bind(this),{optionsIndex:1}))??this.findPeer,this.getClosestPeers=((l=e.metrics)==null?void 0:l.traceFunction("helia.routing.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1}))??this.getClosestPeers}async start(){await Oc(...this.routers)}async stop(){await sh(...this.routers)}async*findProviders(e,t={}){if(this.routers.length===0)throw new c2("No content routers available");const n=new zu({concurrency:this.providerLookupConcurrency});n.addEventListener("error",()=>{});for await(const s of Su(n.toGenerator(),...Eh(this.routers,"findProviders").map(i=>i.findProviders(e,t))))if(s!=null){if(s.multiaddrs.length===0){if(n.find(s.id)!=null)continue;n.add(async()=>{try{const i=await this.findPeer(s.id,t);return i.multiaddrs.length===0?null:i}catch(i){return this.log.error("could not load multiaddrs for peer %p",s.id,i),null}},{peerId:s.id,signal:t.signal}).catch(i=>{this.log.error("could not load multiaddrs for peer %p",s.id,i)})}yield s}}async provide(e,t={}){if(this.routers.length===0)throw new c2("No content routers available");await Promise.all(Eh(this.routers,"provide").map(async n=>{await n.provide(e,t)}))}async cancelReprovide(e,t={}){await Promise.all(Eh(this.routers,"cancelReprovide").map(async n=>{await n.cancelReprovide(e,t)}))}async put(e,t,n){await Promise.all(Eh(this.routers,"put").map(async s=>{await s.put(e,t,n)}))}async get(e,t){return Promise.any(Eh(this.routers,"get").map(async n=>n.get(e,t)))}async findPeer(e,t){if(this.routers.length===0)throw new c2("No peer routers available");const n=this,s=Su(...Eh(this.routers,"findPeer").map(i=>async function*(){try{yield await i.findPeer(e,t)}catch(o){n.log.error(o)}}()));for await(const i of s)if(i!=null)return i;throw new vr("Could not find peer in routing")}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new c2("No peer routers available");for await(const n of Su(...Eh(this.routers,"getClosestPeers").map(s=>s.getClosestPeers(e,t))))n!=null&&(yield n)}}function Eh(r,e){return r.filter(t=>t[e]!=null)}const Tu={},Qd=r=>{r.addEventListener("message",e=>{Qd.dispatchEvent("message",r,e)}),r.port!=null&&r.port.addEventListener("message",e=>{Qd.dispatchEvent("message",r,e)})};Qd.addEventListener=(r,e)=>{Tu[r]==null&&(Tu[r]=[]),Tu[r].push(e)};Qd.removeEventListener=(r,e)=>{Tu[r]!=null&&(Tu[r]=Tu[r].filter(t=>t===e))};Qd.dispatchEvent=function(r,e,t){Tu[r]!=null&&Tu[r].forEach(n=>n(e,t))};const lB="lock:worker:request-read",uB="lock:worker:release-read",hB="lock:master:grant-read",dB="lock:worker:request-write",fB="lock:worker:release-write",pB="lock:master:grant-write",zye=(r=21)=>Math.random().toString().substring(2),gB=(r,e,t,n,s)=>(i,o)=>{if(o.data.type!==t)return;const a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};r.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>{i.postMessage({type:s,name:a.name,identifier:a.identifier}),await new Promise(c=>{const l=u=>{if((u==null?void 0:u.data)==null)return;const d={type:u.data.type,name:u.data.name,identifier:u.data.identifier};d.type===n&&d.identifier===a.identifier&&(i.removeEventListener("message",l),c())};i.addEventListener("message",l)})}}}))},yB=(r,e,t,n)=>async()=>{const s=zye();return globalThis.postMessage({type:e,identifier:s,name:r}),new Promise(i=>{const o=a=>{if((a==null?void 0:a.data)==null)return;const c={type:a.data.type,identifier:a.data.identifier};c.type===t&&c.identifier===s&&(globalThis.removeEventListener("message",o),i(()=>{globalThis.postMessage({type:n,identifier:s,name:r})}))};globalThis.addEventListener("message",o)})},Vye={singleProcess:!1},Hye=r=>{if(r=Object.assign({},Vye,r),!!globalThis.document||r.singleProcess){const t=new EventTarget;return Qd.addEventListener("message",gB(t,"requestReadLock",lB,uB,hB)),Qd.addEventListener("message",gB(t,"requestWriteLock",dB,fB,pB)),t}return{isWorker:!0,readLock:t=>yB(t,lB,hB,uB),writeLock:t=>yB(t,dB,pB,fB)}},xh={};let zl;async function nE(r,e){let t;const n=new Promise(s=>{t=s});return r.add(async()=>Im((async()=>{await new Promise(s=>{t(()=>{s()})})})(),{milliseconds:e.timeout})),n}const Kye=(r,e)=>{if(zl.isWorker===!0)return{readLock:zl.readLock(r,e),writeLock:zl.writeLock(r,e)};const t=new Bu({concurrency:1});let n;return{async readLock(){if(n!=null)return nE(n,e);n=new Bu({concurrency:e.concurrency,autoStart:!1});const s=n,i=nE(n,e);return t.add(async()=>{s.start(),await s.onIdle().then(()=>{n===s&&(n=null)})}),i},async writeLock(){return n=null,nE(t,e)}}},Gye={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function F_(r){const e=Object.assign({},Gye,r);return zl==null&&(zl=Hye(e),zl.isWorker!==!0&&(zl.addEventListener("requestReadLock",t=>{xh[t.data.name]!=null&&xh[t.data.name].readLock().then(async n=>t.data.handler().finally(()=>{n()}))}),zl.addEventListener("requestWriteLock",async t=>{xh[t.data.name]!=null&&xh[t.data.name].writeLock().then(async n=>t.data.handler().finally(()=>{n()}))}))),xh[e.name]==null&&(xh[e.name]=Kye(e.name,e)),xh[e.name]}class jye{constructor(e,t,n={}){h(this,"lock");h(this,"child");h(this,"pins");h(this,"started");this.child=e,this.pins=t,this.lock=F_({singleProcess:n.holdGcLock}),this.started=!1}isStarted(){return this.started}async start(){await Oc(this.child),this.started=!0}async stop(){await sh(this.child),this.started=!1}unwrap(){return this.child}async put(e,t,n={}){var i;(i=n==null?void 0:n.signal)==null||i.throwIfAborted();const s=await this.lock.readLock();try{return await this.child.put(e,t,n)}finally{s()}}async*putMany(e,t={}){var s;(s=t==null?void 0:t.signal)==null||s.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.putMany(e,t)}finally{n()}}async get(e,t={}){var s;(s=t==null?void 0:t.signal)==null||s.throwIfAborted();const n=await this.lock.readLock();try{return await this.child.get(e,t)}finally{n()}}async*getMany(e,t={}){var s;(s=t==null?void 0:t.signal)==null||s.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.getMany(e,t)}finally{n()}}async delete(e,t={}){var s;(s=t==null?void 0:t.signal)==null||s.throwIfAborted();const n=await this.lock.writeLock();try{if(await this.pins.isPinned(e))throw new Error("CID was pinned");await this.child.delete(e,t)}finally{n()}}async*deleteMany(e,t={}){var s;(s=t==null?void 0:t.signal)==null||s.throwIfAborted();const n=await this.lock.writeLock();try{const i=this;yield*this.child.deleteMany(async function*(){for await(const o of e){if(await i.pins.isPinned(o))throw new Error("CID was pinned");yield o}}(),t)}finally{n()}}async has(e,t={}){var s;(s=t==null?void 0:t.signal)==null||s.throwIfAborted();const n=await this.lock.readLock();try{return await this.child.has(e,t)}finally{n()}}async*getAll(e={}){var n;(n=e==null?void 0:e.signal)==null||n.throwIfAborted();const t=await this.lock.readLock();try{yield*this.child.getAll(e)}finally{t()}}createSession(e,t){var n;return(n=t==null?void 0:t.signal)==null||n.throwIfAborted(),this.child.createSession(e,t)}}const sE=new Dt("/version"),mB=1;async function qye(r){if(!await r.has(sE)){await r.put(sE,he(`${mB}`));return}const e=await r.get(sE),t=ce(e);if(parseInt(t,10)!==mB)throw new Error("Unknown datastore version, a datastore migration may be required")}class Wye extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===X.array&&(t.elements++,t.elements!==1&&e.push([44])),t.type===X.map&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[X.uint.major](e,t){this.prefix(e);const n=String(t.value),s=[];for(let i=0;i<n.length;i++)s[i]=n.charCodeAt(i);e.push(s)}[X.negint.major](e,t){this[X.uint.major](e,t)}[X.bytes.major](e,t){throw new Error(`${Ad} unsupported type: Uint8Array`)}[X.string.major](e,t){this.prefix(e);const n=LG(JSON.stringify(t.value));e.push(n.length>32?xT(n):n)}[X.array.major](e,t){this.prefix(e),this.inRecursive.push({type:X.array,elements:0}),e.push([91])}[X.map.major](e,t){this.prefix(e),this.inRecursive.push({type:X.map,elements:0}),e.push([123])}[X.tag.major](e,t){}[X.float.major](e,t){if(t.type.name==="break"){const o=this.inRecursive.pop();if(o){if(o.type===X.array)e.push([93]);else if(o.type===X.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${Ad} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}const n=String(t.value),s=[];let i=!1;for(let o=0;o<n.length;o++)s[o]=n.charCodeAt(o),!i&&(s[o]===46||s[o]===101||s[o]===69)&&(i=!0);i||(s.push(46),s.push(48)),e.push(s)}}function Qye(r,e){if(Array.isArray(r[0])||Array.isArray(e[0]))throw new Error(`${Ad} complex map keys are not supported`);const t=r[0],n=e[0];if(t.type!==X.string||n.type!==X.string)throw new Error(`${Ad} non-string map keys are not supported`);if(t<n)return-1;if(t>n)return 1;throw new Error(`${Ad} unexpected duplicate map keys, this is not supported`)}const Jye={addBreakTokens:!0,mapSorter:Qye};function Yye(r,e){return e=Object.assign({},Jye,e),WG(r,new Wye,e)}class YW{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error(`${Oe} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw new Error(`${Oe} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this._pos;let t=!1,n=!1;const s=a=>{for(;!this.done();){const c=this.ch();if(a.includes(c))this._pos++;else break}};if(this.ch()===45&&(t=!0,this._pos++),this.ch()===48)if(this._pos++,this.ch()===46)this._pos++,n=!0;else return new ue(X.uint,0,this._pos-e);if(s([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw new Error(`${Oe} unexpected token at position ${this._pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${Oe} unexpected token at position ${this._pos}`);n=!0,this._pos++,s([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this._pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this._pos++,s([48,49,50,51,52,53,54,55,56,57]));const i=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),o=parseFloat(i);return n?new ue(X.float,o,this._pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(o)?new ue(o>=0?X.uint:X.negint,o,this._pos-e):new ue(o>=0?X.uint:X.negint,BigInt(i),this._pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${Oe} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let i=this._pos,o=0;i<this.data.length&&o<65536;i++,o++){const a=this.data[i];if(a===92||a<32||a>=128)break;if(a===34){const c=String.fromCharCode.apply(null,this.data.subarray(this._pos,i));return this._pos=i+1,new ue(X.string,c,o)}}const e=this._pos,t=[],n=()=>{if(this._pos+4>=this.data.length)throw new Error(`${Oe} unexpected end of unicode escape sequence at position ${this._pos}`);let i=0;for(let o=0;o<4;o++){let a=this.ch();if(a>=48&&a<=57)a-=48;else if(a>=97&&a<=102)a=a-97+10;else if(a>=65&&a<=70)a=a-65+10;else throw new Error(`${Oe} unexpected unicode escape character at position ${this._pos}`);i=i*16+a,this._pos++}return i},s=()=>{const i=this.ch();let o=null,a=i>239?4:i>223?3:i>191?2:1;if(this._pos+a>this.data.length)throw new Error(`${Oe} unexpected unicode sequence at position ${this._pos}`);let c,l,u,d;switch(a){case 1:i<128&&(o=i);break;case 2:c=this.data[this._pos+1],(c&192)===128&&(d=(i&31)<<6|c&63,d>127&&(o=d));break;case 3:c=this.data[this._pos+1],l=this.data[this._pos+2],(c&192)===128&&(l&192)===128&&(d=(i&15)<<12|(c&63)<<6|l&63,d>2047&&(d<55296||d>57343)&&(o=d));break;case 4:c=this.data[this._pos+1],l=this.data[this._pos+2],u=this.data[this._pos+3],(c&192)===128&&(l&192)===128&&(u&192)===128&&(d=(i&15)<<18|(c&63)<<12|(l&63)<<6|u&63,d>65535&&d<1114112&&(o=d))}o===null?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|o&1023),t.push(o),this._pos+=a};for(;!this.done();){const i=this.ch();let o;switch(i){case 92:if(this._pos++,this.done())throw new Error(`${Oe} unexpected string termination at position ${this._pos}`);switch(o=this.ch(),this._pos++,o){case 34:case 39:case 92:case 47:t.push(o);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${Oe} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new ue(X.string,UG(t),this._pos-e);default:if(i<32)throw new Error(`${Oe} invalid control character at position ${this._pos}`);i<128?(t.push(i),this._pos++):s()}}throw new Error(`${Oe} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new ue(X.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new ue(X.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new ue(X.null,null,4);case 102:return this.expect([102,97,108,115,101]),new ue(X.false,!1,5);case 116:return this.expect([116,114,117,101]),new ue(X.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${Oe} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this._pos++,this.skipWhitespace(),new ue(X.break,void 0,1);if(this.ch()!==44)throw new Error(`${Oe} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this._pos++,this.skipWhitespace(),new ue(X.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new ue(X.break,void 0,1);if(this.ch()!==44)throw new Error(`${Oe} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this._pos++,this.skipWhitespace(),new ue(X.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${Oe} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${Oe} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}}function Xye(r,e){return e=Object.assign({tokenizer:new YW(r,e)},e),Fl(r,e)}function Zye(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function z_(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function eme(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var tme=eme,rme=tme;let nme=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},sme=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return XW(this,e)}},ime=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return XW(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function XW(r,e){return new ime({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let ome=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new nme(e,t,n),this.decoder=new sme(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function ZW({name:r,prefix:e,encode:t,decode:n}){return new ome(r,e,t,n)}function iv({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=rme(t,r);return ZW({prefix:e,name:r,encode:n,decode:i=>z_(s(i))})}function ame(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function cme(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function oi({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return ZW({prefix:e,name:r,encode(s){return cme(s,n,t)},decode(s){return ame(s,n,t,r)}})}const l4=oi({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});oi({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});oi({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});oi({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});oi({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});oi({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});oi({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});oi({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});oi({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const iE=iv({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});iv({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Pl=iv({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});iv({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var lme=eQ,wB=128,ume=-128,hme=Math.pow(2,31);function eQ(r,e,t){e=e||[],t=t||0;for(var n=t;r>=hme;)e[t++]=r&255|wB,r/=128;for(;r&ume;)e[t++]=r&255|wB,r>>>=7;return e[t]=r|0,eQ.bytes=t-n+1,e}var dme=uS,fme=128,bB=127;function uS(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw uS.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&bB)<<s:(o&bB)*Math.pow(2,s),s+=7}while(o>=fme);return uS.bytes=i-n,t}var pme=Math.pow(2,7),gme=Math.pow(2,14),yme=Math.pow(2,21),mme=Math.pow(2,28),wme=Math.pow(2,35),bme=Math.pow(2,42),vme=Math.pow(2,49),Eme=Math.pow(2,56),xme=Math.pow(2,63),Ame=function(r){return r<pme?1:r<gme?2:r<yme?3:r<mme?4:r<wme?5:r<bme?6:r<vme?7:r<Eme?8:r<xme?9:10},Sme={encode:lme,decode:dme,encodingLength:Ame},Q8=Sme;function hS(r,e=0){return[Q8.decode(r,e),Q8.decode.bytes]}function J8(r,e,t=0){return Q8.encode(r,e,t),e}function Y8(r){return Q8.encodingLength(r)}function Cme(r,e){const t=e.byteLength,n=Y8(r),s=n+Y8(t),i=new Uint8Array(s+t);return J8(r,i,0),J8(t,i,n),i.set(e,s),new V_(r,t,e,i)}function Ime(r){const e=z_(r),[t,n]=hS(e),[s,i]=hS(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new V_(t,s,o,e)}function kme(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Zye(r.bytes,t.bytes)}}let V_=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function vB(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return _me(t,dS(r),e??Pl.encoder);default:return Pme(t,dS(r),e??l4.encoder)}}const EB=new WeakMap;function dS(r){const e=EB.get(r);if(e==null){const t=new Map;return EB.set(r,t),t}return e}var Uz;let tQ=class gn{constructor(e,t,n,s){h(this,"code");h(this,"version");h(this,"multihash");h(this,"bytes");h(this,"/");h(this,Uz,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Vg)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Nme)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return gn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Cme(e,t);return gn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return gn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&kme(e.multihash,n.multihash)}toString(e){return vB(this,e)}toJSON(){return{"/":vB(this)}}link(){return this}[(Uz=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof gn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new gn(n,s,i,o??xB(n,s,i.bytes))}else if(t[Dme]===!0){const{version:n,multihash:s,code:i}=t,o=Ime(s);return gn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Vg)throw new Error(`Version 0 CID must use dag-pb (code: ${Vg}) block encoding`);return new gn(e,t,n,n.bytes)}case 1:{const s=xB(e,t,n.bytes);return new gn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return gn.create(0,Vg,e)}static createV1(e,t){return gn.create(1,e,t)}static decode(e){const[t,n]=gn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=gn.inspectBytes(e),n=t.size-t.multihashSize,s=z_(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new V_(t.multihashCode,t.digestSize,i,s);return[t.version===0?gn.createV0(o):gn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=hS(e.subarray(t));return t+=p,d};let s=n(),i=Vg;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,s]=Tme(e,t),i=gn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return dS(i).set(n,e),i}};function Tme(r,e){switch(r[0]){case"Q":{const t=e??Pl;return[Pl.prefix,t.decode(`${Pl.prefix}${r}`)]}case Pl.prefix:{const t=e??Pl;return[Pl.prefix,t.decode(r)]}case l4.prefix:{const t=e??l4;return[l4.prefix,t.decode(r)]}case iE.prefix:{const t=e??iE;return[iE.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function _me(r,e,t){const{prefix:n}=t;if(n!==Pl.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s}function Pme(r,e,t){const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s}const Vg=112,Nme=18;function xB(r,e,t){const n=Y8(r),s=n+Y8(e),i=new Uint8Array(s+t.byteLength);return J8(r,i,0),J8(e,i,n),i.set(t,s),i}const Dme=Symbol.for("@ipld/js-cid/CID"),rQ=oi({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});oi({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});oi({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});oi({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function Ome(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function Rme(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=tQ.asCID(r);if(!e)return null;const t=e.toString();return[new ue(X.map,1/0,1),new ue(X.string,"/",1),new ue(X.string,t,t.length),new ue(X.break,void 0,1)]}function X8(r){const e=rQ.encode(r).slice(1);return[new ue(X.map,1/0,1),new ue(X.string,"/",1),new ue(X.map,1/0,1),new ue(X.string,"bytes",5),new ue(X.string,e,e.length),new ue(X.break,void 0,1),new ue(X.break,void 0,1)]}function Ji(r){return X8(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}function Bme(r){return X8(new Uint8Array(r))}function Mme(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function $me(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const Lme={typeEncoders:{Object:Rme,Buffer:X8,Uint8Array:X8,Int8Array:Ji,Uint16Array:Ji,Int16Array:Ji,Uint32Array:Ji,Int32Array:Ji,Float32Array:Ji,Float64Array:Ji,Uint8ClampedArray:Ji,BigInt64Array:Ji,BigUint64Array:Ji,DataView:Ji,ArrayBuffer:Bme,undefined:Mme,number:$me}};class Ume extends YW{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(e.type===X.map){const t=this._next();if(t.type===X.string&&t.value==="/"){const n=this._next();if(n.type===X.string){if(this._next().type!==X.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new ue(X.tag,42,0)}if(n.type===X.map){const s=this._next();if(s.type===X.string&&s.value==="bytes"){const i=this._next();if(i.type===X.string){for(let a=0;a<2;a++)if(this._next().type!==X.break)throw new Error("Invalid encoded Bytes form");const o=rQ.decode(`m${i.value}`);return new ue(X.bytes,o,i.value.length)}this.tokenBuffer.push(i)}this.tokenBuffer.push(s)}this.tokenBuffer.push(n)}this.tokenBuffer.push(t)}return e}}const fS={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};fS.tags[42]=tQ.parse;const Fme="dag-json",nQ=297,sQ=r=>Yye(r,Lme),iQ=r=>{const e=Ome(r),t=Object.assign(fS,{tokenizer:new Ume(e,fS)});return Xye(e,t)},AB=r=>zme.decode(sQ(r)),zme=new TextDecoder,Vme=r=>iQ(Hme.encode(r)),Hme=new TextEncoder,Kme=Object.freeze(Object.defineProperty({__proto__:null,code:nQ,decode:iQ,encode:sQ,format:AB,name:Fme,parse:Vme,stringify:AB},Symbol.toStringTag,{value:"Module"}));function Gme(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function H_(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function jme(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var qme=jme,Wme=qme;let Qme=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Jme=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return oQ(this,e)}},Yme=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return oQ(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function oQ(r,e){return new Yme({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Xme=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Qme(e,t,n),this.decoder=new Jme(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function aQ({name:r,prefix:e,encode:t,decode:n}){return new Xme(r,e,t,n)}function ov({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=Wme(t,r);return aQ({prefix:e,name:r,encode:n,decode:i=>H_(s(i))})}function Zme(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function ewe(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function Gc({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return aQ({prefix:e,name:r,encode(s){return ewe(s,n,t)},decode(s){return Zme(s,n,t,r)}})}const u4=Gc({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Gc({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Gc({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Gc({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Gc({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Gc({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Gc({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Gc({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Gc({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const oE=ov({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});ov({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Nl=ov({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});ov({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var twe=cQ,SB=128,rwe=-128,nwe=Math.pow(2,31);function cQ(r,e,t){e=e||[],t=t||0;for(var n=t;r>=nwe;)e[t++]=r&255|SB,r/=128;for(;r&rwe;)e[t++]=r&255|SB,r>>>=7;return e[t]=r|0,cQ.bytes=t-n+1,e}var swe=pS,iwe=128,CB=127;function pS(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw pS.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&CB)<<s:(o&CB)*Math.pow(2,s),s+=7}while(o>=iwe);return pS.bytes=i-n,t}var owe=Math.pow(2,7),awe=Math.pow(2,14),cwe=Math.pow(2,21),lwe=Math.pow(2,28),uwe=Math.pow(2,35),hwe=Math.pow(2,42),dwe=Math.pow(2,49),fwe=Math.pow(2,56),pwe=Math.pow(2,63),gwe=function(r){return r<owe?1:r<awe?2:r<cwe?3:r<lwe?4:r<uwe?5:r<hwe?6:r<dwe?7:r<fwe?8:r<pwe?9:10},ywe={encode:twe,decode:swe,encodingLength:gwe},Z8=ywe;function gS(r,e=0){return[Z8.decode(r,e),Z8.decode.bytes]}function eb(r,e,t=0){return Z8.encode(r,e,t),e}function tb(r){return Z8.encodingLength(r)}function mwe(r,e){const t=e.byteLength,n=tb(r),s=n+tb(t),i=new Uint8Array(s+t);return eb(r,i,0),eb(t,i,n),i.set(e,s),new K_(r,t,e,i)}function wwe(r){const e=H_(r),[t,n]=gS(e),[s,i]=gS(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new K_(t,s,o,e)}function bwe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Gme(r.bytes,t.bytes)}}let K_=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function IB(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Ewe(t,yS(r),e??Nl.encoder);default:return xwe(t,yS(r),e??u4.encoder)}}const kB=new WeakMap;function yS(r){const e=kB.get(r);if(e==null){const t=new Map;return kB.set(r,t),t}return e}var Fz;let l2=class yn{constructor(e,t,n,s){h(this,"code");h(this,"version");h(this,"multihash");h(this,"bytes");h(this,"/");h(this,Fz,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Hg)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Awe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return yn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=mwe(e,t);return yn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return yn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&bwe(e.multihash,n.multihash)}toString(e){return IB(this,e)}toJSON(){return{"/":IB(this)}}link(){return this}[(Fz=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof yn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new yn(n,s,i,o??TB(n,s,i.bytes))}else if(t[Swe]===!0){const{version:n,multihash:s,code:i}=t,o=wwe(s);return yn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Hg)throw new Error(`Version 0 CID must use dag-pb (code: ${Hg}) block encoding`);return new yn(e,t,n,n.bytes)}case 1:{const s=TB(e,t,n.bytes);return new yn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return yn.create(0,Hg,e)}static createV1(e,t){return yn.create(1,e,t)}static decode(e){const[t,n]=yn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=yn.inspectBytes(e),n=t.size-t.multihashSize,s=H_(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new K_(t.multihashCode,t.digestSize,i,s);return[t.version===0?yn.createV0(o):yn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=gS(e.subarray(t));return t+=p,d};let s=n(),i=Hg;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,s]=vwe(e,t),i=yn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return yS(i).set(n,e),i}};function vwe(r,e){switch(r[0]){case"Q":{const t=e??Nl;return[Nl.prefix,t.decode(`${Nl.prefix}${r}`)]}case Nl.prefix:{const t=e??Nl;return[Nl.prefix,t.decode(r)]}case u4.prefix:{const t=e??u4;return[u4.prefix,t.decode(r)]}case oE.prefix:{const t=e??oE;return[oE.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Ewe(r,e,t){const{prefix:n}=t;if(n!==Nl.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s}function xwe(r,e,t){const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s}const Hg=112,Awe=18;function TB(r,e,t){const n=tb(r),s=n+tb(e),i=new Uint8Array(s+t.byteLength);return eb(r,i,0),eb(e,i,n),i.set(t,s),i}const Swe=Symbol.for("@ipld/js-cid/CID"),Cwe=new TextDecoder;function G_(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");const s=r[e++];if(t+=n<28?(s&127)<<n:(s&127)*2**n,s<128)break}return[t,e]}function rb(r,e){let t;[t,e]=G_(r,e);const n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function lQ(r,e){let t;return[t,e]=G_(r,e),[t&7,t>>3,e]}function Iwe(r){const e={},t=r.length;let n=0;for(;n<t;){let s,i;if([s,i,n]=lQ(r,n),i===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(s!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${s}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=rb(r,n)}else if(i===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(s!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${s}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=rb(r,n),e.Name=Cwe.decode(o)}else if(i===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(s!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${s}) for Tsize`);[e.Tsize,n]=G_(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function kwe(r){const e=r.length;let t=0,n,s=!1,i;for(;t<e;){let a,c;if([a,c,t]=lQ(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(i)throw new Error("protobuf: (PBNode) duplicate Data section");[i,t]=rb(r,t),n&&(s=!0)}else if(c===2){if(s)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let l;[l,t]=rb(r,t),n.push(Iwe(l))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");const o={};return i&&(o.Data=i),o.Links=n||[],o}const uQ=new TextEncoder,_B=2**32,Twe=2**31;function _we(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=D2(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){const n=uQ.encode(r.Name);t-=n.length,e.set(n,t),t=D2(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=D2(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function Pwe(r){const e=Dwe(r),t=new Uint8Array(e);let n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=D2(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let s=r.Links.length-1;s>=0;s--){const i=_we(r.Links[s],t.subarray(0,n));n-=i,n=D2(t,n,i)-1,t[n]=18}return t}function Nwe(r){let e=0;if(r.Hash){const t=r.Hash.length;e+=1+t+Fp(t)}if(typeof r.Name=="string"){const t=uQ.encode(r.Name).length;e+=1+t+Fp(t)}return typeof r.Tsize=="number"&&(e+=1+Fp(r.Tsize)),e}function Dwe(r){let e=0;if(r.Data){const t=r.Data.length;e+=1+t+Fp(t)}if(r.Links)for(const t of r.Links){const n=Nwe(t);e+=1+n+Fp(n)}return e}function D2(r,e,t){e-=Fp(t);const n=e;for(;t>=Twe;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function Fp(r){return r%2===0&&r++,Math.floor((Owe(r)+6)/7)}function Owe(r){let e=0;return r>=_B&&(r=Math.floor(r/_B),e=32),r>=65536&&(r>>>=16,e+=16),r>=256&&(r>>>=8,e+=8),e+Rwe[r]}const Rwe=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],Bwe=["Data","Links"],Mwe=["Hash","Name","Tsize"],mS=new TextEncoder;function hQ(r,e){if(r===e)return 0;const t=r.Name?mS.encode(r.Name):[],n=e.Name?mS.encode(e.Name):[];let s=t.length,i=n.length;for(let o=0,a=Math.min(s,i);o<a;++o)if(t[o]!==n[o]){s=t[o],i=n[o];break}return s<i?-1:i<s?1:0}function PB(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function dQ(r){if(typeof r.asCID=="object"){const t=l2.asCID(r);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Hash){let t=l2.asCID(r.Hash);try{t||(typeof r.Hash=="string"?t=l2.parse(r.Hash):r.Hash instanceof Uint8Array&&(t=l2.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(e.Name=r.Name),typeof r.Tsize=="number"&&(e.Tsize=r.Tsize),e}function fQ(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Data!==void 0)if(typeof r.Data=="string")e.Data=mS.encode(r.Data);else if(r.Data instanceof Uint8Array)e.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))e.Links=r.Links.map(dQ),e.Links.sort(hQ);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function pQ(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!PB(r,Bwe))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<r.Links.length;e++){const t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!PB(t,Mwe))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash==null||!t.Hash["/"]||t.Hash["/"]!==t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0){if(typeof t.Tsize!="number"||t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&hQ(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function $we(r,e=[]){return fQ({Data:r,Links:e})}function Lwe(r,e,t){return dQ({Hash:t,Name:r,Tsize:e})}function Uwe(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}const Fwe="dag-pb",gQ=112;function zwe(r){pQ(r);const e={};return r.Links&&(e.Links=r.Links.map(t=>{const n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),Pwe(e)}function Vwe(r){const e=Uwe(r),t=kwe(e),n={};return t.Data&&(n.Data=t.Data),t.Links&&(n.Links=t.Links.map(s=>{const i={};try{i.Hash=l2.decode(s.Hash)}catch{}if(!i.Hash)throw new Error("Invalid Hash field found in link, expected CID");return s.Name!==void 0&&(i.Name=s.Name),s.Tsize!==void 0&&(i.Tsize=s.Tsize),i})),n}const Hwe=Object.freeze(Object.defineProperty({__proto__:null,code:gQ,createLink:Lwe,createNode:$we,decode:Vwe,encode:zwe,name:Fwe,prepare:fQ,validate:pQ},Symbol.toStringTag,{value:"Module"})),Kwe=new TextEncoder,Gwe=new TextDecoder,jwe="json",yQ=512;function qwe(r){return Kwe.encode(JSON.stringify(r))}function Wwe(r){return JSON.parse(Gwe.decode(r))}const Qwe=Object.freeze(Object.defineProperty({__proto__:null,code:yQ,decode:Wwe,encode:qwe,name:jwe},Symbol.toStringTag,{value:"Module"})),Jwe="raw",mQ=85;function Ywe(r){return Z1(r)}function Xwe(r){return Z1(r)}const Zwe=Object.freeze(Object.defineProperty({__proto__:null,code:mQ,decode:Xwe,encode:Ywe,name:Jwe},Symbol.toStringTag,{value:"Module"}));function j_(r){return(r==null?void 0:r.then)!=null}function e3e(r=[],e){const t={[gQ]:Hwe,[mQ]:Zwe,[tj]:_m,[nQ]:Kme,[yQ]:Qwe};return r.forEach(n=>{t[n.code]=n}),async n=>{let s=t[n];if(s==null&&e!=null){const i=e(n);j_(i)?s=await i:s=i,t[s.code]=s}if(s!=null)return s;throw new JW(`Could not load codec for ${n}`)}}const wQ=0,t3e="identity",bQ=Z1;function r3e(r){return W8(wQ,bQ(r))}const NB={code:wQ,name:t3e,encode:bQ,digest:r3e};function vQ(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const DB=jW({name:"sha2-256",code:18,encode:vQ("SHA-256")}),OB=jW({name:"sha2-512",code:19,encode:vQ("SHA-512")});function n3e(r=[],e){const t={[DB.code]:DB,[OB.code]:OB,[NB.code]:NB};return r.forEach(n=>{t[n.code]=n}),async n=>{let s=t[n];if(s==null&&e!=null){const i=e(n);j_(i)?s=await i:s=i,t[s.code]=s}if(s!=null)return s;throw new QW(`No hasher configured for multihash code 0x${n.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)}}const xp=class xp extends Error{constructor(t="Not Found"){super(t);h(this,"name",xp.name);h(this,"code",xp.code)}};h(xp,"name","NotFoundError"),h(xp,"code","ERR_NOT_FOUND");let Cy=xp;class EQ{has(e,t){return Promise.reject(new Error(".has is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}async*putMany(e,t){for await(const{cid:n,block:s}of e)await this.put(n,s,t),yield n}get(e,t){return Promise.reject(new Error(".get is not implemented"))}async*getMany(e,t){for await(const n of e)yield{cid:n,block:await this.get(n,t)}}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(e,t){for await(const n of e)await this.delete(n,t),yield n}async*getAll(e){throw new Error(".getAll is not implemented")}}const i3=0;class s3e extends EQ{constructor(t){super();h(this,"child");this.child=t}put(t,n){return t.multihash.code===i3||this.child==null?t:this.child.put(t,n)}get(t){if(t.multihash.code===i3)return t.multihash.digest;if(this.child==null)throw new Cy;return this.child.get(t)}has(t){return t.multihash.code===i3?!0:this.child==null?!1:this.child.has(t)}delete(t){if(t.code!==i3&&this.child!=null)return this.child.delete(t)}getAll(t){return this.child!=null?this.child.getAll(t):[]}}function i3e(r){return r[Symbol.asyncIterator]!=null}function kh(r,e){let t=0;if(i3e(r))return async function*(){for await(const c of r)await e(c,t++)&&(yield c)}();const n=__(r),{value:s,done:i}=n.next();if(i===!0)return function*(){}();const o=e(s,t++);if(typeof o.then=="function")return async function*(){await o&&(yield s);for await(const c of n)await e(c,t++)&&(yield c)}();const a=e;return function*(){o===!0&&(yield s);for(const c of n)a(c,t++)&&(yield c)}()}function o3e(r){return r[Symbol.asyncIterator]!=null}function RB(r){return(r==null?void 0:r.then)!=null}function nb(r,e){let t=0;if(o3e(r))return async function*(){for await(const c of r){const l=e(c,t++);RB(l)&&await l,yield c}}();const n=__(r),{value:s,done:i}=n.next();if(i===!0)return function*(){}();const o=e(s,t++);if(typeof(o==null?void 0:o.then)=="function")return async function*(){yield s;for await(const c of n){const l=e(c,t++);RB(l)&&await l,yield c}}();const a=e;return function*(){yield s;for(const c of n)a(c,t++),yield c}()}class xQ{constructor(e){h(this,"child");h(this,"getHasher");h(this,"log");h(this,"logger");h(this,"components");this.log=e.logger.forComponent("helia:networked-storage"),this.logger=e.logger,this.components=e,this.child=new s3e(e.blockstore),this.getHasher=e.getHasher}async put(e,t,n={}){var s,i,o;return await this.child.has(e,n)?((s=n.onProgress)==null||s.call(n,new Re("blocks:put:duplicate",e)),e):((i=n.onProgress)==null||i.call(n,new Re("blocks:put:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async a=>{var c;return(c=a.announce)==null?void 0:c.call(a,e,t,n)})),(o=n.onProgress)==null||o.call(n,new Re("blocks:put:blockstore:put",e)),this.child.put(e,t,n))}async*putMany(e,t={}){var i;const n=kh(e,async({cid:o})=>{var c;const a=await this.child.has(o,t);return a&&((c=t.onProgress)==null||c.call(t,new Re("blocks:put-many:duplicate",o))),!a}),s=nb(n,async({cid:o,block:a})=>{var c;(c=t.onProgress)==null||c.call(t,new Re("blocks:put-many:providers:notify",o)),await Promise.all(this.components.blockBrokers.map(async l=>{var u;return(u=l.announce)==null?void 0:u.call(l,o,a,t)}))});(i=t.onProgress)==null||i.call(t,new Re("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(s,t)}async get(e,t={}){var n,s,i,o;if(t.offline!==!0&&!await this.child.has(e,t)){const a=await this.getHasher(e.multihash.code);(n=t.onProgress)==null||n.call(t,new Re("blocks:get:providers:get",e));const c=await BB(e,this.components.blockBrokers,a,{...t,log:this.log});return(s=t.onProgress)==null||s.call(t,new Re("blocks:get:blockstore:put",e)),await this.child.put(e,c,t),(i=t.onProgress)==null||i.call(t,new Re("blocks:get:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async l=>{var u;return(u=l.announce)==null?void 0:u.call(l,e,c,t)})),c}return(o=t.onProgress)==null||o.call(t,new Re("blocks:get:blockstore:get",e)),this.child.get(e,t)}async*getMany(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new Re("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(nb(e,async s=>{var i,o,a;if(t.offline!==!0&&!await this.child.has(s,t)){const c=await this.getHasher(s.multihash.code);(i=t.onProgress)==null||i.call(t,new Re("blocks:get-many:providers:get",s));const l=await BB(s,this.components.blockBrokers,c,{...t,log:this.log});(o=t.onProgress)==null||o.call(t,new Re("blocks:get-many:blockstore:put",s)),await this.child.put(s,l,t),(a=t.onProgress)==null||a.call(t,new Re("blocks:get-many:providers:notify",s)),await Promise.all(this.components.blockBrokers.map(async u=>{var d;return(d=u.announce)==null?void 0:d.call(u,s,l,t)}))}}))}async delete(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new Re("blocks:delete:blockstore:delete",e)),await this.child.delete(e,t)}async*deleteMany(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new Re("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(const s of e)yield s}(),t)}async has(e,t={}){return this.child.has(e,t)}async*getAll(e={}){var t;(t=e.onProgress)==null||t.call(e,new Re("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(e)}}class a3e extends xQ{constructor(t){super(t);h(this,"started");this.started=!1}isStarted(){return this.started}async start(){await Oc(this.child,...this.components.blockBrokers),this.started=!0}async stop(){await sh(this.child,...this.components.blockBrokers),this.started=!1}unwrap(){return this.child}createSession(t,n){const s=this.components.blockBrokers.map(i=>i.createSession==null?i:i.createSession(n));return new c3e({blockstore:this.child,blockBrokers:s,getHasher:this.getHasher,logger:this.logger},{root:t})}}class c3e extends xQ{constructor(t,n){super(t);h(this,"closeController");this.closeController=new AbortController,this.closeController.signal,this.log=t.logger.forComponent(`helia:session-storage:${n.root}`)}close(){this.closeController.abort()}async put(t,n,s={}){const i=At([this.closeController.signal,s.signal]);try{return await super.put(t,n,{...s,signal:i})}finally{i.clear()}}async*putMany(t,n={}){const s=At([this.closeController.signal,n.signal]);try{yield*super.putMany(t,{...n,signal:s})}finally{s.clear()}}async get(t,n={}){const s=At([this.closeController.signal,n.signal]);try{return await super.get(t,{...n,signal:s})}finally{s.clear()}}async*getMany(t,n={}){const s=At([this.closeController.signal,n.signal]);try{yield*super.getMany(t,{...n,signal:s})}finally{s.clear()}}async delete(t,n={}){const s=At([this.closeController.signal,n.signal]);try{await super.delete(t,{...n,signal:s})}finally{s.clear()}}async*deleteMany(t,n={}){const s=At([this.closeController.signal,n.signal]);try{yield*super.deleteMany(t,{...n,signal:s})}finally{s.clear()}}async has(t,n={}){const s=At([this.closeController.signal,n.signal]);try{return await super.has(t,{...n,signal:s})}finally{s.clear()}}async*getAll(t={}){const n=At([this.closeController.signal,t.signal]);try{yield*super.getAll({...t,signal:n})}finally{n.clear()}}}function l3e(r){return typeof r.retrieve=="function"}const u3e=(r,e)=>{if(e==null)throw new ie(`No hasher configured for multihash code 0x${r.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`);return async t=>{let n;const s=e.digest(t);if(j_(s)?n=await s:n=s,!rt(n.digest,r.multihash.digest))throw new U5("Hash of downloaded block did not match multihash from passed CID")}};async function BB(r,e,t,n){const s=u3e(r,t),i=new AbortController,o=At([i.signal,n.signal]);i.signal;const a=[];for(const c of e)l3e(c)&&a.push(c);try{return await Promise.any(a.map(async c=>{try{let l=!1;const u=await c.retrieve(r,{...n,signal:o,validateFn:async d=>{await s(d),l=!0}});return l||await s(u),u}catch(l){throw n.log.error("could not retrieve verified block for %c",r,l),l}}))}finally{i.abort(),o.clear()}}const h3e=ii({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});ii({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});ii({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});ii({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});class AQ extends Er{constructor(t,n){super();h(this,"initialPeerSearchComplete");h(this,"requests");h(this,"name");h(this,"log");h(this,"logger");h(this,"minProviders");h(this,"maxProviders");h(this,"providers");h(this,"evictionFilter");this.name=n.name,this.logger=t.logger,this.log=t.logger.forComponent(this.name),this.requests=new Map,this.minProviders=n.minProviders??$ye,this.maxProviders=n.maxProviders??Lye,this.providers=[],this.evictionFilter=jd(this.maxProviders)}async retrieve(t,n={}){const s=h3e.encode(t.multihash.bytes),i=this.requests.get(s);if(i!=null)return this.log("join existing request for %c",t),i;const o=He();if(this.requests.set(s,o.promise),this.providers.length===0){let u=!1;this.initialPeerSearchComplete==null&&(u=!0,this.log=this.logger.forComponent(`${this.name}:${t}`),this.initialPeerSearchComplete=this.findProviders(t,this.minProviders,n)),await this.initialPeerSearchComplete,u&&this.log("found initial session peers for %c",t)}let a=!1;const c=new Gd({concurrency:this.maxProviders});c.addEventListener("error",()=>{}),c.addEventListener("failure",u=>{this.log.error("error querying provider %o, evicting from session",u.detail.job.options.provider,u.detail.error),this.evict(u.detail.job.options.provider)}),c.addEventListener("success",u=>{a=!0,o.resolve(u.detail.result)}),c.addEventListener("idle",()=>{var u;a||((u=n.signal)==null?void 0:u.aborted)===!0||Promise.resolve().then(async()=>{this.log("no session peers had block for for %c, finding new providers",t);for(let d=0;d<this.minProviders&&this.providers.length!==0;d++){const p=this.providers[Math.floor(Math.random()*this.providers.length)];this.evict(p)}await this.findProviders(t,this.minProviders,n),this.log("found new providers re-retrieving %c",t),this.requests.delete(s),o.resolve(await this.retrieve(t,n))}).catch(d=>{this.log.error("could not find new providers for %c",t,d),o.reject(d)})});const l=u=>{c.add(async()=>this.queryProvider(t,u.detail,n),{provider:u.detail}).catch(d=>{var p;((p=n.signal)==null?void 0:p.aborted)!==!0&&this.log.error("error retrieving session block for %c",t,d)})};this.addEventListener("provider",l),Promise.all([...this.providers].map(async u=>c.add(async()=>this.queryProvider(t,u,n),{provider:u}))).catch(u=>{var d;((d=n.signal)==null?void 0:d.aborted)!==!0&&this.log.error("error retrieving session block for %c",t,u)});try{return await o.promise}finally{this.removeEventListener("provider",l),c.clear(),this.requests.delete(s)}}evict(t){this.evictionFilter.add(this.toEvictionKey(t));const n=this.providers.findIndex(s=>this.equals(s,t));n!==-1&&this.providers.splice(n,1)}isEvicted(t){return this.evictionFilter.has(this.toEvictionKey(t))}hasProvider(t){return!!(this.providers.find(n=>this.equals(n,t))!=null||this.isEvicted(t))}async findProviders(t,n,s){const i=He();let o=0;return Promise.resolve().then(async()=>{var a;this.log("finding %d-%d new provider(s) for %c",n,this.maxProviders,t);for await(const c of this.findNewProviders(t,s)){if(o===this.maxProviders||((a=s.signal)==null?void 0:a.aborted)===!0)break;if(!this.hasProvider(c)&&(this.log("found %d/%d new providers",o,this.maxProviders),this.providers.push(c),this.safeDispatchEvent("provider",{detail:c}),o++,o===n&&(this.log("session is ready"),i.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",o);break}}if(this.log("found %d/%d new session peers",o,this.maxProviders),o<n)throw new WW(`Found ${o} of ${n} ${this.name} providers for ${t}`)}).catch(a=>{this.log.error("error searching routing for potential session peers for %c",t,a.errors??a),i.reject(a)}),i.promise}}class d3e{constructor(e){h(this,"blockstore");h(this,"datastore");h(this,"pins");h(this,"logger");h(this,"routing");h(this,"getCodec");h(this,"getHasher");h(this,"dns");h(this,"metrics");h(this,"log");this.logger=e.logger??nv(),this.log=this.logger.forComponent("helia"),this.getHasher=n3e(e.hashers,e.loadHasher),this.getCodec=e3e(e.codecs,e.loadCodec),this.dns=e.dns??zW(),this.metrics=e.metrics;const t={blockstore:e.blockstore,datastore:e.datastore,logger:this.logger,blockBrokers:[],getHasher:this.getHasher,getCodec:this.getCodec,dns:this.dns,metrics:this.metrics,...e.components??{}};this.routing=t.routing=new Fye(t,{routers:(e.routers??[]).flatMap(s=>{const i=[s];return s[Y0]!=null&&i.push(s[Y0]),s[X0]!=null&&i.push(s[X0]),i}),providerLookupConcurrency:e.providerLookupConcurrency});const n=new a3e(t);this.pins=new Mye(e.datastore,n,this.getCodec),this.blockstore=new jye(n,this.pins,{holdGcLock:e.holdGcLock??!0}),this.datastore=e.datastore,t.blockBrokers=e.blockBrokers.map(s=>s(t))}async start(){await qye(this.datastore),await Oc(this.blockstore,this.datastore,this.routing)}async stop(){await sh(this.blockstore,this.datastore,this.routing)}async gc(e={}){const t=await this.blockstore.lock.writeLock();try{const n=this,s=this.blockstore.unwrap();this.log("gc start"),await Dc(s.deleteMany(async function*(){var i,o;for await(const{cid:a}of s.getAll())try{if(await n.pins.isPinned(a,e))continue;yield a,(i=e.onProgress)==null||i.call(e,new Re("helia:gc:deleted",a))}catch(c){n.log.error("Error during gc",c),(o=e.onProgress)==null||o.call(e,new Re("helia:gc:error",c))}}()))}finally{t()}this.log("gc finished")}}class f3e extends AQ{constructor(t,n){super(t,{...n,name:"helia:bitswap:session"});h(this,"wantList");h(this,"network");this.wantList=t.wantList,this.network=t.network}async queryProvider(t,n,s){this.log("sending WANT-BLOCK for %c to %p",t,n);const i=await this.wantList.wantSessionBlock(t,n,s);if(this.log("%p %s %c",n,i.has?"has":"does not have",t),i.has&&i.block!=null)return i.block;throw new Error("Provider did not have block")}async*findNewProviders(t,n={}){for await(const s of this.network.findProviders(t,n))yield s.id}toEvictionKey(t){return t.toMultihash().bytes}equals(t,n){return t.equals(n)}}function p3e(r,e){return new f3e(r,e)}class g3e{constructor(e){h(this,"blocksReceived");h(this,"duplicateBlocksReceived");h(this,"dataReceived");h(this,"duplicateDataReceived");var t,n,s,i;this.blocksReceived=(t=e.metrics)==null?void 0:t.registerMetricGroup("helia_bitswap_received_blocks"),this.duplicateBlocksReceived=(n=e.metrics)==null?void 0:n.registerMetricGroup("helia_bitswap_duplicate_received_blocks"),this.dataReceived=(s=e.metrics)==null?void 0:s.registerMetricGroup("helia_bitswap_data_received_bytes"),this.duplicateDataReceived=(i=e.metrics)==null?void 0:i.registerMetricGroup("helia_bitswap_duplicate_data_received_bytes")}updateBlocksReceived(e=1,t){var s;const n={global:e};t!=null&&(n[t.toString()]=e),(s=this.blocksReceived)==null||s.increment(n)}updateDuplicateBlocksReceived(e=1,t){var s;const n={global:e};t!=null&&(n[t.toString()]=e),(s=this.duplicateBlocksReceived)==null||s.increment(n)}updateDataReceived(e,t){var s;const n={global:e};t!=null&&(n[t.toString()]=e),(s=this.dataReceived)==null||s.increment(n)}updateDuplicateDataReceived(e,t){var s;const n={global:e};t!=null&&(n[t.toString()]=e),(s=this.duplicateDataReceived)==null||s.increment(n)}}class y3e extends Map{constructor(t){super();h(this,"metric");const{name:n,metrics:s}=t;this.metric=s.registerMetric(n),this.updateComponentMetric()}set(t,n){return super.set(t,n),this.updateComponentMetric(),this}delete(t){const n=super.delete(t);return this.updateComponentMetric(),n}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function SQ(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new y3e({name:e,metrics:t}):n=new Map,n}function m3e({name:r,code:e,encode:t}){return new w3e(r,e,t)}let w3e=class{constructor(e,t,n){h(this,"name");h(this,"code");h(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?eS(this.code,t):t.then(n=>eS(this.code,n))}else throw Error("Unknown type, must be binary type")}};function b3e(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const MB=m3e({name:"sha2-256",code:18,encode:b3e("SHA-256")});function v3e(r){if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");const e=[];for(;r.length>0;){const t=Po(r);e.push(t),r=r.slice(kt(t))}return e}class E3e extends Er{constructor(t,n={}){super();h(this,"peers");h(this,"wants");h(this,"network");h(this,"log");h(this,"sendMessagesDelay");h(this,"sendMessagesTimeout");h(this,"hashLoader");h(this,"sendingMessages");this.peers=PW({name:"helia_bitswap_peers",metrics:t.metrics}),this.wants=SQ({name:"helia_bitswap_wantlist",metrics:t.metrics}),this.network=t.network,this.sendMessagesDelay=n.sendMessagesDelay??R0e,this.log=t.logger.forComponent("helia:bitswap:wantlist"),this.hashLoader=n.hashLoader,this.network.addEventListener("bitswap:message",s=>{this.receiveMessage(s.detail.peer,s.detail.message).catch(i=>{this.log.error("error receiving bitswap message from %p",s.detail.peer,i)})}),this.network.addEventListener("peer:connected",s=>{this.peerConnected(s.detail).catch(i=>{this.log.error("error processing newly connected bitswap peer %p",s.detail,i)})}),this.network.addEventListener("peer:disconnected",s=>{this.peerDisconnected(s.detail)})}async addEntry(t,n){var o;const s=ce(t.multihash.bytes,"base64");let i=this.wants.get(s);i==null&&(i={cid:t,priority:n.priority??1,wantType:n.wantType??Nr.WantBlock,cancel:!1,sendDontHave:!0},this.wants.set(s,i)),i.wantType===Nr.WantHave&&n.wantType===Nr.WantBlock&&(i.wantType=Nr.WantBlock),await this.sendMessagesDebounced();try{return n.wantType===Nr.WantBlock?(await Di(this,"block",n==null?void 0:n.signal,{filter:l=>rt(t.multihash.digest,l.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail:(await Di(this,"presence",n==null?void 0:n.signal,{filter:c=>rt(t.multihash.digest,c.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail}finally{((o=n.signal)==null?void 0:o.aborted)===!0&&(this.log("want for %c was aborted, cancelling want",t),i.cancel=!0,await this.sendMessagesDebounced())}}async sendMessagesDebounced(){var t;await((t=this.sendingMessages)==null?void 0:t.promise),clearTimeout(this.sendMessagesTimeout),this.sendMessagesTimeout=setTimeout(()=>{this.sendMessages().catch(n=>{this.log("error sending messages to peers",n)})},this.sendMessagesDelay)}async sendMessages(){this.sendingMessages=He(),await Promise.all([...this.peers.entries()].map(async([t,n])=>{const s=new Set,i=new a2;for(const[o,a]of this.wants.entries())n.has(o)||a.cancel||(s.add(o),i.addWantlistEntry(a.cid,{cid:a.cid.bytes,priority:a.priority,wantType:a.wantType,cancel:a.cancel,sendDontHave:a.sendDontHave}));if(i.wantlist.size!==0)try{await this.network.sendMessage(t,i);for(const o of s)n.add(o)}catch(o){this.log.error("error sending full wantlist to new peer",o)}})).catch(t=>{this.log.error("error sending messages",t)});for(const[t,n]of this.wants)if(n.cancel){this.wants.delete(t);for(const s of this.peers.values())s.delete(t)}this.sendingMessages.resolve()}has(t){const n=ce(t.multihash.bytes,"base64");return this.wants.has(n)}async wantSessionPresence(t,n,s={}){const i=new a2;return i.addWantlistEntry(t,{cid:t.bytes,sendDontHave:!0,wantType:Nr.WantHave,priority:1}),await this.network.sendMessage(n,i),(await Di(this,"presence",s.signal,{filter:a=>n.equals(a.detail.sender)&&rt(t.multihash.digest,a.detail.cid.multihash.digest)})).detail}async wantBlock(t,n={}){return this.addEntry(t,{...n,wantType:Nr.WantBlock})}async wantSessionBlock(t,n,s={}){const i=new a2;return i.addWantlistEntry(t,{cid:t.bytes,sendDontHave:!0,wantType:Nr.WantBlock,priority:1}),await this.network.sendMessage(n,i),(await Di(this,"presence",s.signal,{filter:a=>n.equals(a.detail.sender)&&rt(t.multihash.digest,a.detail.cid.multihash.digest)})).detail}async receivedBlock(t,n){const s=ce(t.multihash.bytes,"base64"),i=this.wants.get(s);i!=null&&(i.cancel=!0,await this.sendMessagesDebounced())}async receiveMessage(t,n){var i;this.log("received message from %p with %d blocks",t,n.blocks.length);let s=!1;for(const o of n.blocks){if(o.prefix==null||o.data==null)continue;const a=v3e(o.prefix),c=a[0],l=a[1],u=a[2],d=u===MB.code?MB:await((i=this.hashLoader)==null?void 0:i.getHasher(u));if(d==null){this.log.error("unknown hash algorithm",u);continue}let p=d.digest(o.data);p.then!=null&&(p=await p);const y=rS.create(c===0?0:1,l,p);this.log("received block from %p for %c",t,y),this.safeDispatchEvent("block",{detail:{sender:t,cid:y,block:o.data}}),this.safeDispatchEvent("presence",{detail:{sender:t,cid:y,has:!0,block:o.data}});const f=ce(y.multihash.bytes,"base64"),g=this.wants.get(f);g!=null&&(g.cancel=!0,s=!0)}for(const{cid:o,type:a}of n.blockPresences){const c=rS.decode(o);this.log("received %s from %p for %c",a,t,c),this.safeDispatchEvent("presence",{detail:{sender:t,cid:c,has:a===ga.HaveBlock}})}s&&await this.sendMessagesDebounced()}async peerConnected(t){const n=new Set,s=new a2(!0);for(const[i,o]of this.wants.entries())o.cancel||(n.add(i),s.addWantlistEntry(o.cid,{cid:o.cid.bytes,priority:1,wantType:Nr.WantBlock,cancel:!1,sendDontHave:!1}));if(s.wantlist.size===0){this.peers.set(t,n);return}try{await this.network.sendMessage(t,s),this.peers.set(t,n)}catch(i){this.log.error("error sending full wantlist to new peer %p",t,i)}}peerDisconnected(t){this.peers.delete(t)}start(){}stop(){this.peers.clear(),clearTimeout(this.sendMessagesTimeout)}}class x3e{constructor(e,t={}){h(this,"log");h(this,"logger");h(this,"stats");h(this,"network");h(this,"blockstore");h(this,"peerWantLists");h(this,"wantList");this.logger=e.logger,this.log=e.logger.forComponent("helia:bitswap"),this.blockstore=e.blockstore,this.stats=new g3e(e),this.network=new j0e(e,t),this.peerWantLists=new l2e({...e,network:this.network},t),this.wantList=new E3e({...e,network:this.network},t)}createSession(e={}){return p3e({wantList:this.wantList,network:this.network,logger:this.logger},e)}async want(e,t={}){const n=new AbortController,s=At([n.signal,t.signal]);n.signal,this.network.findAndConnect(e,{...t,signal:s}).catch(i=>{n.signal.aborted||this.log.error("error during finding and connect for cid %c",e,i)});try{return(await this.wantList.wantBlock(e,{...t,signal:s})).block}finally{n.abort(),s.clear()}}async notify(e,t,n={}){await Promise.all([this.peerWantLists.receivedBlock(e,n),this.wantList.receivedBlock(e,n)])}getWantlist(){return[...this.wantList.wants.values()].filter(e=>!e.cancel).map(e=>({cid:e.cid,priority:e.priority,wantType:e.wantType}))}getPeerWantlist(e){return this.peerWantLists.wantListForPeer(e)}async start(){this.wantList.start(),await this.network.start()}async stop(){this.wantList.stop(),await this.network.stop()}}const A3e=(r,e={})=>new x3e(r,e);class S3e{constructor(e,t={}){h(this,"bitswap");h(this,"started");const{getHasher:n}=e;this.bitswap=A3e(e,{hashLoader:{getHasher:async s=>n(s)},...t}),this.started=!1}isStarted(){return this.started}async start(){await this.bitswap.start(),this.started=!0}async stop(){await this.bitswap.stop(),this.started=!1}async announce(e,t,n){await this.bitswap.notify(e,t,n)}async retrieve(e,t={}){return this.bitswap.want(e,t)}createSession(e){const t=this.bitswap.createSession(e);return{announce:async(n,s,i)=>{await this.bitswap.notify(n,s,i)},retrieve:async(n,s)=>t.retrieve(n,s)}}}function C3e(r={}){return e=>new S3e(e,r)}class I3e{constructor(){h(this,"index",0);h(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,s){return this.readAtomically(()=>{let i=0,o=0;const a=this.peekChar();if(a===void 0)return;const c=a==="0",l=2**(8*s)-1;for(;;){const u=this.readAtomically(()=>{const d=this.readChar();if(d===void 0)return;const p=Number.parseInt(d,e);if(!Number.isNaN(p))return p});if(u===void 0)break;if(i*=e,i+=u,i>l||(o+=1,t!==void 0&&o>t))return}if(o!==0)return!n&&c&&o>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){const e=t=>{for(let n=0;n<t.length/2;n++){const s=n*2;if(n<t.length-3){const o=this.readSeparator(":",n,()=>this.readIPv4Addr());if(o!==void 0)return t[s]=o[0],t[s+1]=o[1],t[s+2]=o[2],t[s+3]=o[3],[s+4,!0]}const i=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(i===void 0)return[s,!1];t[s]=i>>8,t[s+1]=i&255}return[t.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[n,s]=e(t);if(n===16)return t;if(s||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const i=new Uint8Array(14),o=16-(n+2),[a]=e(i.subarray(0,o));return t.set(i.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const CQ=45,k3e=15,l1=new I3e;function IQ(r){if(!(r.length>k3e))return l1.new(r).parseWith(()=>l1.readIPv4Addr())}function kQ(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>CQ))return l1.new(r).parseWith(()=>l1.readIPv6Addr())}function sb(r,e=!1){if(r.includes("%")&&(r=r.split("%")[0]),r.length>CQ)return;const t=l1.new(r).parseWith(()=>l1.readIPAddr());if(t)return e&&t.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,t[0],t[1],t[2],t[3]]):t}function u1(r){return!!IQ(r)}function q_(r){return!!kQ(r)}function TQ(r){return!!sb(r)}var _Q;(function(){var r,e,t,n,s,i,o,a;a=function(c){var l,u,d,p;return l=(c&255<<24)>>>24,u=(c&255<<16)>>>16,d=(c&65280)>>>8,p=c&255,[l,u,d,p].join(".")},o=function(c){var l,u,d,p,y,f;for(l=[],d=p=0;p<=3&&c.length!==0;d=++p){if(d>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}f=e(c),y=f[0],u=f[1],c=c.substring(u),l.push(y)}if(c.length!==0)throw new Error("Invalid IP");switch(l.length){case 1:if(l[0]>4294967295)throw new Error("Invalid IP");return l[0]>>>0;case 2:if(l[0]>255||l[1]>16777215)throw new Error("Invalid IP");return(l[0]<<24|l[1])>>>0;case 3:if(l[0]>255||l[1]>255||l[2]>65535)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2])>>>0;case 4:if(l[0]>255||l[1]>255||l[2]>255||l[3]>255)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2]<<8|l[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},n=t("0"),i=t("a"),s=t("A"),e=function(c){var l,u,d,p,y;for(p=0,l=10,u="9",d=0,c.length>1&&c[d]==="0"&&(c[d+1]==="x"||c[d+1]==="X"?(d+=2,l=16):"0"<=c[d+1]&&c[d+1]<="9"&&(d++,l=8,u="7")),y=d;d<c.length;){if("0"<=c[d]&&c[d]<=u)p=p*l+(t(c[d])-n)>>>0;else if(l===16)if("a"<=c[d]&&c[d]<="f")p=p*l+(10+t(c[d])-i)>>>0;else if("A"<=c[d]&&c[d]<="F")p=p*l+(10+t(c[d])-s)>>>0;else break;else break;if(p>4294967295)throw new Error("too large");d++}if(d===y)throw new Error("empty octet");return[p,d]},r=function(){function c(l,u){var d,p,y;if(typeof l!="string")throw new Error("Missing `net' parameter");if(u||(y=l.split("/",2),l=y[0],u=y[1]),u||(u=32),typeof u=="string"&&u.indexOf(".")>-1){try{this.maskLong=o(u)}catch{throw new Error("Invalid mask: "+u)}for(d=p=32;p>=0;d=--p)if(this.maskLong===4294967295<<32-d>>>0){this.bitmask=d;break}}else if(u||u===0)this.bitmask=parseInt(u,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(o(l)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+l)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+u);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(l){return typeof l=="string"&&(l.indexOf("/")>0||l.split(".").length!==4)&&(l=new c(l)),l instanceof c?this.contains(l.base)&&this.contains(l.broadcast||l.last):(o(l)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(l){return l==null&&(l=1),new c(a(this.netLong+this.size*l),this.mask)},c.prototype.forEach=function(l){var u,d,p;for(p=o(this.first),d=o(this.last),u=0;p<=d;)l(a(p),p,u),u++,p++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),_Q=r}).call(W2);const T3e=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],_3e=T3e.map(r=>new _Q(r));function W_(r){for(const e of _3e)if(e.contains(r))return!0;return!1}function P3e(r){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(r)}function N3e(r){const e=r.split(":");if(e.length<2)return!1;const t=e[e.length-1].padStart(4,"0"),n=e[e.length-2].padStart(4,"0"),s=`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(t.substring(0,2),16)}.${parseInt(t.substring(2),16)}`;return W_(s)}function D3e(r){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)}function O3e(r){const e=r.split(":"),t=e[e.length-1];return W_(t)}function R3e(r){return/^::$/.test(r)||/^::1$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}function ah(r){return u1(r)?W_(r):P3e(r)?N3e(r):D3e(r)?O3e(r):q_(r)?R3e(r):void 0}function B3e(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function M3e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var $3e=M3e,L3e=$3e;let U3e=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},F3e=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return PQ(this,e)}},z3e=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return PQ(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function PQ(r,e){return new z3e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let V3e=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new U3e(e,t,n),this.decoder=new F3e(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function NQ({name:r,prefix:e,encode:t,decode:n}){return new V3e(r,e,t,n)}function DQ({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=L3e(t,r);return NQ({prefix:e,name:r,encode:n,decode:i=>B3e(s(i))})}function H3e(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function K3e(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function av({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return NQ({prefix:e,name:r,encode(s){return K3e(s,n,t)},decode(s){return H3e(s,n,t,r)}})}const G3e=DQ({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});DQ({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});av({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});av({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});const j3e=av({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});av({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const q3e=r=>r.toString().split("/").slice(1),Um=r=>({match:e=>e.length<1?!1:r(e[0])?e.slice(1):!1,pattern:"fn"}),ot=r=>({match:e=>Um(t=>t===r).match(e),pattern:r}),eg=()=>({match:r=>Um(e=>typeof e=="string").match(r),pattern:"{string}"}),cv=()=>({match:r=>Um(e=>!isNaN(parseInt(e))).match(r),pattern:"{number}"}),Tt=()=>({match:r=>{if(r.length<2||r[0]!=="p2p"&&r[0]!=="ipfs")return!1;if(r[1].startsWith("Q")||r[1].startsWith("1"))try{G3e.decode(`z${r[1]}`)}catch{return!1}else return!1;return r.slice(2)},pattern:"/p2p/{peerid}"}),ib=()=>({match:r=>{if(r.length<2||r[0]!=="certhash")return!1;try{j3e.decode(r[1])}catch{return!1}return r.slice(2)},pattern:"/certhash/{certhash}"}),Et=r=>({match:e=>{const t=r.match(e);return t===!1?e:t},pattern:`optional(${r.pattern})`}),Yn=(...r)=>({match:e=>{let t;for(const n of r){const s=n.match(e);s!==!1&&(t==null||s.length<t.length)&&(t=s)}return t??!1},pattern:`or(${r.map(e=>e.pattern).join(", ")})`}),lt=(...r)=>({match:e=>{for(const t of r){const n=t.match(e);if(n===!1)return!1;e=n}return e},pattern:`and(${r.map(e=>e.pattern).join(", ")})`});function Lt(...r){function e(s){let i=q3e(s);for(const o of r){const a=o.match(i);if(a===!1)return!1;i=a}return i}function t(s){return e(s)!==!1}function n(s){const i=e(s);return i===!1?!1:i.length===0}return{matchers:r,matches:t,exactMatch:n}}const W3e=Tt(),Q3e=Lt(W3e),lv=lt(ot("dns4"),eg()),uv=lt(ot("dns6"),eg()),hv=lt(ot("dnsaddr"),eg()),Q_=lt(ot("dns"),eg());Lt(lv,Et(Tt()));Lt(uv,Et(Tt()));Lt(hv,Et(Tt()));const OQ=Lt(Yn(Q_,hv,lv,uv),Et(Tt())),RQ=lt(ot("ip4"),Um(u1)),BQ=lt(ot("ip6"),Um(q_)),J_=Yn(RQ,BQ),vc=Yn(J_,Q_,lv,uv,hv),J3e=Lt(Yn(J_,lt(Yn(Q_,hv,lv,uv),Et(Tt())))),$B=Lt(RQ),LB=Lt(BQ),Y3e=Lt(J_),Y_=lt(vc,ot("tcp"),cv()),Fm=lt(vc,ot("udp"),cv()),ob=Lt(lt(Y_,Et(Tt())));Lt(Fm);const X_=lt(Fm,ot("quic"),Et(Tt())),dv=lt(Fm,ot("quic-v1"),Et(Tt())),X3e=Yn(X_,dv);Lt(X_);const Z3e=Lt(dv),wS=Yn(vc,Y_,Fm,X_,dv),MQ=Yn(lt(wS,ot("ws"),Et(Tt()))),Iy=Lt(MQ),$Q=Yn(lt(wS,ot("wss"),Et(Tt())),lt(wS,ot("tls"),Et(lt(ot("sni"),eg())),ot("ws"),Et(Tt()))),ab=Lt($Q),LQ=lt(Fm,ot("webrtc-direct"),Et(ib()),Et(ib()),Et(Tt())),bS=Lt(LQ),UQ=lt(dv,ot("webtransport"),Et(ib()),Et(ib()),Et(Tt())),UB=Lt(UQ),cb=Yn(MQ,$Q,lt(Y_,Et(Tt())),lt(X3e,Et(Tt())),lt(vc,Et(Tt())),LQ,UQ,Tt()),FQ=Lt(cb),e4e=lt(cb,ot("p2p-circuit"),Tt()),Hu=Lt(e4e),t4e=Yn(lt(cb,ot("p2p-circuit"),ot("webrtc"),Et(Tt())),lt(cb,ot("webrtc"),Et(Tt())),lt(ot("webrtc"),Et(Tt()))),vS=Lt(t4e),r4e=Yn(lt(vc,ot("tcp"),cv(),ot("http"),Et(Tt())),lt(vc,ot("http"),Et(Tt()))),n4e=Lt(r4e),s4e=Yn(lt(vc,ot("tcp"),Yn(lt(ot("443"),ot("http")),lt(cv(),ot("https"))),Et(Tt())),lt(vc,ot("tls"),ot("http"),Et(Tt())),lt(vc,ot("https"),Et(Tt()))),i4e=Lt(s4e),o4e=Yn(lt(ot("memory"),eg(),Et(Tt())));Lt(o4e);function a4e(r,e,t){let n=0;for(const s of r)if(!(n<e)){if(n>t)break;if(s!==255)return!1;n++}return!0}function c4e(r,e,t,n){let s=0;for(const i of r)if(!(s<t)){if(s>n)break;if(i!==e[s])return!1;s++}return!0}function l4e(r){switch(r.length){case ky:return r.join(".");case Ty:{const e=[];for(let t=0;t<r.length;t++)t%2===0&&e.push(r[t].toString(16).padStart(2,"0")+r[t+1].toString(16).padStart(2,"0"));return e.join(":")}default:throw new Error("Invalid ip length")}}function u4e(r){let e=0;for(let[t,n]of r.entries()){if(n===255){e+=8;continue}for(;n&128;)e++,n=n<<1;if(n&128)return-1;for(let s=t+1;s<r.length;s++)if(r[s]!=0)return-1;break}return e}function h4e(r){let e="0x";for(const t of r)e+=(t>>4).toString(16)+(t&15).toString(16);return e}const ky=4,Ty=16,d4e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function zQ(r,e){e.length===Ty&&r.length===ky&&a4e(e,0,11)&&(e=e.slice(12)),e.length===ky&&r.length===Ty&&c4e(r,d4e,0,11)&&(r=r.slice(12));const t=r.length;if(t!=e.length)throw new Error("Failed to mask ip");const n=new Uint8Array(t);for(let s=0;s<t;s++)n[s]=r[s]&e[s];return n}function f4e(r,e){if(typeof e=="string"&&(e=sb(e)),e==null)throw new Error("Invalid ip");if(e.length!==r.network.length)return!1;for(let t=0;t<e.length;t++)if((r.network[t]&r.mask[t])!==(e[t]&r.mask[t]))return!1;return!0}function p4e(r){const[e,t]=r.split("/");if(!e||!t)throw new Error("Failed to parse given CIDR: "+r);let n=ky,s=IQ(e);if(s==null&&(n=Ty,s=kQ(e),s==null))throw new Error("Failed to parse given CIDR: "+r);const i=parseInt(t,10);if(Number.isNaN(i)||String(i).length!==t.length||i<0||i>n*8)throw new Error("Failed to parse given CIDR: "+r);const o=VQ(i,8*n);return{network:zQ(s,o),mask:o}}function VQ(r,e){if(e!==8*ky&&e!==8*Ty)throw new Error("Invalid CIDR mask");if(r<0||r>e)throw new Error("Invalid CIDR mask");const t=e/8,n=new Uint8Array(t);for(let s=0;s<t;s++){if(r>=8){n[s]=255,r-=8;continue}n[s]=255-(255>>r),r=0}return n}class HQ{constructor(e,t){if(t==null)({network:this.network,mask:this.mask}=p4e(e));else{const n=sb(e);if(n==null)throw new Error("Failed to parse network");t=String(t);const s=parseInt(t,10);if(Number.isNaN(s)||String(s).length!==t.length||s<0||s>n.length*8){const i=sb(t);if(i==null)throw new Error("Failed to parse mask");this.mask=i}else this.mask=VQ(s,8*n.length);this.network=zQ(n,this.mask)}}contains(e){return f4e({network:this.network,mask:this.mask},e)}toString(){const e=u4e(this.mask),t=e!==-1?String(e):h4e(this.mask);return l4e(this.network)+"/"+t}}function g4e(r,e){return new HQ(r).contains(e)}function y4e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Z_(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function m4e(r){return new TextEncoder().encode(r)}function w4e(r){return new TextDecoder().decode(r)}function b4e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var v4e=b4e,E4e=v4e;let x4e=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},A4e=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return KQ(this,e)}},S4e=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return KQ(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function KQ(r,e){return new S4e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let C4e=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new x4e(e,t,n),this.decoder=new A4e(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function fv({name:r,prefix:e,encode:t,decode:n}){return new C4e(r,e,t,n)}function zm({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=E4e(t,r);return fv({prefix:e,name:r,encode:n,decode:i=>Z_(s(i))})}function I4e(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function k4e(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function nn({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return fv({prefix:e,name:r,encode(s){return k4e(s,n,t)},decode(s){return I4e(s,n,t,r)}})}const Pd=nn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),T4e=nn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),_4e=nn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),P4e=nn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),N4e=nn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),D4e=nn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),O4e=nn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),R4e=nn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),B4e=nn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),M4e=Object.freeze(Object.defineProperty({__proto__:null,base32:Pd,base32hex:N4e,base32hexpad:O4e,base32hexpadupper:R4e,base32hexupper:D4e,base32pad:_4e,base32padupper:P4e,base32upper:T4e,base32z:B4e},Symbol.toStringTag,{value:"Module"})),po=zm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),$4e=zm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),L4e=Object.freeze(Object.defineProperty({__proto__:null,base58btc:po,base58flickr:$4e},Symbol.toStringTag,{value:"Module"})),U4e=zm({prefix:"9",name:"base10",alphabet:"0123456789"}),F4e=Object.freeze(Object.defineProperty({__proto__:null,base10:U4e},Symbol.toStringTag,{value:"Module"})),z4e=nn({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),V4e=nn({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),H4e=Object.freeze(Object.defineProperty({__proto__:null,base16:z4e,base16upper:V4e},Symbol.toStringTag,{value:"Module"})),K4e=nn({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),G4e=Object.freeze(Object.defineProperty({__proto__:null,base2:K4e},Symbol.toStringTag,{value:"Module"})),GQ=Array.from(""),j4e=GQ.reduce((r,e,t)=>(r[t]=e,r),[]),q4e=GQ.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function W4e(r){return r.reduce((e,t)=>(e+=j4e[t],e),"")}function Q4e(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const s=q4e[n];if(s==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}const J4e=fv({prefix:"",name:"base256emoji",encode:W4e,decode:Q4e}),Y4e=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:J4e},Symbol.toStringTag,{value:"Module"})),h4=zm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),X4e=zm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Z4e=Object.freeze(Object.defineProperty({__proto__:null,base36:h4,base36upper:X4e},Symbol.toStringTag,{value:"Module"})),e8e=nn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),t8e=nn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),r8e=nn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),n8e=nn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),s8e=Object.freeze(Object.defineProperty({__proto__:null,base64:e8e,base64pad:t8e,base64url:r8e,base64urlpad:n8e},Symbol.toStringTag,{value:"Module"})),i8e=nn({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),o8e=Object.freeze(Object.defineProperty({__proto__:null,base8:i8e},Symbol.toStringTag,{value:"Module"})),a8e=fv({prefix:"\0",name:"identity",encode:r=>w4e(r),decode:r=>m4e(r)}),c8e=Object.freeze(Object.defineProperty({__proto__:null,identity:a8e},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;var l8e=jQ,FB=128,u8e=-128,h8e=Math.pow(2,31);function jQ(r,e,t){e=e||[],t=t||0;for(var n=t;r>=h8e;)e[t++]=r&255|FB,r/=128;for(;r&u8e;)e[t++]=r&255|FB,r>>>=7;return e[t]=r|0,jQ.bytes=t-n+1,e}var d8e=ES,f8e=128,zB=127;function ES(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw ES.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&zB)<<s:(o&zB)*Math.pow(2,s),s+=7}while(o>=f8e);return ES.bytes=i-n,t}var p8e=Math.pow(2,7),g8e=Math.pow(2,14),y8e=Math.pow(2,21),m8e=Math.pow(2,28),w8e=Math.pow(2,35),b8e=Math.pow(2,42),v8e=Math.pow(2,49),E8e=Math.pow(2,56),x8e=Math.pow(2,63),A8e=function(r){return r<p8e?1:r<g8e?2:r<y8e?3:r<m8e?4:r<w8e?5:r<b8e?6:r<v8e?7:r<E8e?8:r<x8e?9:10},S8e={encode:l8e,decode:d8e,encodingLength:A8e},lb=S8e;function xS(r,e=0){return[lb.decode(r,e),lb.decode.bytes]}function ub(r,e,t=0){return lb.encode(r,e,t),e}function hb(r){return lb.encodingLength(r)}function C8e(r,e){const t=e.byteLength,n=hb(r),s=n+hb(t),i=new Uint8Array(s+t);return ub(r,i,0),ub(t,i,n),i.set(e,s),new eP(r,t,e,i)}function qQ(r){const e=Z_(r),[t,n]=xS(e),[s,i]=xS(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new eP(t,s,o,e)}function I8e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&y4e(r.bytes,t.bytes)}}let eP=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function VB(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return T8e(t,AS(r),e??po.encoder);default:return _8e(t,AS(r),e??Pd.encoder)}}const HB=new WeakMap;function AS(r){const e=HB.get(r);if(e==null){const t=new Map;return HB.set(r,t),t}return e}var zz;let WQ=class mn{constructor(e,t,n,s){h(this,"code");h(this,"version");h(this,"multihash");h(this,"bytes");h(this,"/");h(this,zz,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Kg)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==P8e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return mn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=C8e(e,t);return mn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return mn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&I8e(e.multihash,n.multihash)}toString(e){return VB(this,e)}toJSON(){return{"/":VB(this)}}link(){return this}[(zz=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof mn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new mn(n,s,i,o??KB(n,s,i.bytes))}else if(t[N8e]===!0){const{version:n,multihash:s,code:i}=t,o=qQ(s);return mn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Kg)throw new Error(`Version 0 CID must use dag-pb (code: ${Kg}) block encoding`);return new mn(e,t,n,n.bytes)}case 1:{const s=KB(e,t,n.bytes);return new mn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return mn.create(0,Kg,e)}static createV1(e,t){return mn.create(1,e,t)}static decode(e){const[t,n]=mn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=mn.inspectBytes(e),n=t.size-t.multihashSize,s=Z_(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new eP(t.multihashCode,t.digestSize,i,s);return[t.version===0?mn.createV0(o):mn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=xS(e.subarray(t));return t+=p,d};let s=n(),i=Kg;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,s]=k8e(e,t),i=mn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return AS(i).set(n,e),i}};function k8e(r,e){switch(r[0]){case"Q":{const t=e??po;return[po.prefix,t.decode(`${po.prefix}${r}`)]}case po.prefix:{const t=e??po;return[po.prefix,t.decode(r)]}case Pd.prefix:{const t=e??Pd;return[Pd.prefix,t.decode(r)]}case h4.prefix:{const t=e??h4;return[h4.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function T8e(r,e,t){const{prefix:n}=t;if(n!==po.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s}function _8e(r,e,t){const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s}const Kg=112,P8e=18;function KB(r,e,t){const n=hb(r),s=n+hb(e),i=new Uint8Array(s+t.byteLength);return ub(r,i,0),ub(e,i,n),i.set(t,s),i}const N8e=Symbol.for("@ipld/js-cid/CID"),D8e={...c8e,...G4e,...o8e,...F4e,...H4e,...M4e,...Z4e,...L4e,...s8e,...Y4e},GB=u1,O8e=q_,QQ=function(r){let e=0;if(r=r.toString().trim(),GB(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(O8e(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const i=GB(t[n]);let o;i&&(o=QQ(t[n]),t[n]=ce(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,ce(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(n=0;n<t.length;n++){const i=parseInt(t[n],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},R8e=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const s=[];for(let i=0;i<t;i++)s.push(r[e+i]);return s.join(".")}if(t===16){const s=[];for(let i=0;i<t;i+=2)s.push(n.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Ds=-1,_y={},SS={},B8e=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Ds,"ip6zone"],[43,8,"ipcidr"],[53,Ds,"dns",!0],[54,Ds,"dns4",!0],[55,Ds,"dns6",!0],[56,Ds,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Ds,"unix",!1,!0],[421,Ds,"ipfs"],[421,Ds,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Ds,"garlic64"],[448,0,"tls"],[449,Ds,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Ds,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,Ds,"http-path"],[777,Ds,"memory"]];B8e.forEach(r=>{const e=M8e(...r);SS[e.code]=e,_y[e.name]=e});function M8e(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function We(r){if(typeof r=="number"){if(SS[r]!=null)return SS[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(_y[r]!=null)return _y[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}const $8e=We("ip4"),L8e=We("ip6"),U8e=We("ipcidr");function tP(r,e){switch(We(r).code){case 4:case 41:return V8e(e);case 42:return lE(e);case 43:return ce(e,"base10");case 6:case 273:case 33:case 132:return JQ(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return lE(e);case 421:return j8e(e);case 444:return WB(e);case 445:return WB(e);case 466:return G8e(e);case 481:return globalThis.encodeURIComponent(lE(e));default:return ce(e,"base16")}}function jB(r,e){switch(We(r).code){case 4:return qB(e);case 41:return qB(e);case 42:return cE(e);case 43:return he(e,"base10");case 6:case 273:case 33:case 132:return rP(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return cE(e);case 421:return H8e(e);case 444:return q8e(e);case 445:return W8e(e);case 466:return K8e(e);case 481:return cE(globalThis.decodeURIComponent(e));default:return he(e,"base16")}}function F8e(r){let e,t;if(r.stringTuples().forEach(([n,s])=>{(n===$8e.code||n===L8e.code)&&(t=s),n===U8e.code&&(e=s)}),e==null||t==null)throw new Error("Invalid multiaddr");return new HQ(t,e)}const aE=Object.values(D8e).map(r=>r.decoder),z8e=function(){let r=aE[0].or(aE[1]);return aE.slice(2).forEach(e=>r=r.or(e)),r}();function qB(r){if(!TQ(r))throw new Error("invalid ip address");return QQ(r)}function V8e(r){const e=R8e(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!TQ(e))throw new Error("invalid ip address");return e}function rP(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function JQ(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function cE(r){const e=he(r),t=Uint8Array.from(Jr(e.length));return Cr([t,e],t.length+e.length)}function lE(r){const e=Po(r);if(r=r.slice(kt(e)),r.length!==e)throw new Error("inconsistent lengths");return ce(r)}function H8e(r){let e;r[0]==="Q"||r[0]==="1"?e=qQ(po.decode(`z${r}`)).bytes:e=WQ.parse(r).multihash.bytes;const t=Uint8Array.from(Jr(e.length));return Cr([t,e],t.length+e.length)}function K8e(r){const e=z8e.decode(r),t=Uint8Array.from(Jr(e.length));return Cr([t,e],t.length+e.length)}function G8e(r){const e=Po(r),t=r.slice(kt(e));if(t.length!==e)throw new Error("inconsistent lengths");return"u"+ce(t,"base64url")}function j8e(r){const e=Po(r),t=r.slice(kt(e));if(t.length!==e)throw new Error("inconsistent lengths");return ce(t,"base58btc")}function q8e(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Pd.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=rP(n);return Cr([t,s],t.length+s.length)}function W8e(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=Pd.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=rP(n);return Cr([t,s],t.length+s.length)}function WB(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=ce(e,"base32"),s=JQ(t);return`${n}:${s}`}function Q8e(r){r=CS(r);const e=[],t=[];let n=null;const s=r.split("/").slice(1);if(s.length===1&&s[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let i=0;i<s.length;i++){const o=s[i],a=We(o);if(a.size===0){e.push([a.code]),t.push([a.code]);continue}if(i++,i>=s.length)throw new nP("invalid address: "+r);if(a.path===!0){n=CS(s.slice(i).join("/")),e.push([a.code,jB(a.code,n)]),t.push([a.code,n]);break}const c=jB(a.code,s[i]);e.push([a.code,c]),t.push([a.code,tP(a.code,c)])}return{string:YQ(t),bytes:XQ(e),tuples:e,stringTuples:t,path:n}}function QB(r){const e=[],t=[];let n=null,s=0;for(;s<r.length;){const i=Po(r,s),o=kt(i),a=We(i),c=J8e(a,r.slice(s+o));if(c===0){e.push([i]),t.push([i]),s+=o;continue}const l=r.slice(s+o,s+o+c);if(s+=c+o,s>r.length)throw new nP("Invalid address Uint8Array: "+ce(r,"base16"));e.push([i,l]);const u=tP(i,l);if(t.push([i,u]),a.path===!0){n=u;break}}return{bytes:Uint8Array.from(r),string:YQ(t),tuples:e,stringTuples:t,path:n}}function YQ(r){const e=[];return r.map(t=>{const n=We(t[0]);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),CS(e.join("/"))}function XQ(r){return Cr(r.map(e=>{const t=We(e[0]);let n=Uint8Array.from(Jr(t.code));return e.length>1&&e[1]!=null&&(n=Cr([n,e[1]])),n}))}function J8e(r,e){if(r.size>0)return r.size/8;if(r.size===0)return 0;{const t=Po(e instanceof Uint8Array?e:Uint8Array.from(e));return t+kt(t)}}function CS(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}class nP extends Error{constructor(t){super(`Error parsing address: ${t}`);h(this,"name","ParseError")}}h(nP,"name","ParseError");const Y8e=Symbol.for("nodejs.util.inspect.custom"),ZQ=Symbol.for("@multiformats/js-multiaddr/multiaddr"),X8e=[We("dns").code,We("dns4").code,We("dns6").code,We("dnsaddr").code];class Z8e extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}var Vz,Xp,Kl,om,am;const Ap=class Ap{constructor(e){h(this,"bytes");Q(this,Xp);Q(this,Kl);Q(this,om);Q(this,am);h(this,Vz,!0);e==null&&(e="");let t;if(e instanceof Uint8Array)t=QB(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=Q8e(e)}else if(pv(e))t=QB(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,M(this,Xp,t.string),M(this,Kl,t.tuples),M(this,om,t.stringTuples),M(this,am,t.path)}toString(){return T(this,Xp)}toJSON(){return this.toString()}toOptions(){let e,t,n,s,i="";const o=We("tcp"),a=We("udp"),c=We("ip4"),l=We("ip6"),u=We("dns6"),d=We("ip6zone");for(const[y,f]of this.stringTuples())y===d.code&&(i=`%${f??""}`),X8e.includes(y)&&(t=o.name==="tcp"?"tcp":"udp",s=443,n=`${f??""}${i}`,e=y===u.code?6:4),(y===o.code||y===a.code)&&(t=We(y).name==="tcp"?"tcp":"udp",s=parseInt(f??"")),(y===c.code||y===l.code)&&(t=We(y).name==="tcp"?"tcp":"udp",n=`${f??""}${i}`,e=y===l.code?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}protos(){return T(this,Kl).map(([e])=>Object.assign({},We(e)))}protoCodes(){return T(this,Kl).map(([e])=>e)}protoNames(){return T(this,Kl).map(([e])=>We(e).name)}tuples(){return T(this,Kl).map(([e,t])=>t==null?[e]:[e,t])}stringTuples(){return T(this,om).map(([e,t])=>t==null?[e]:[e,t])}encapsulate(e){return e=new Ap(e),new Ap(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Ap(n.slice(0,s))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new Ap(XQ(t.slice(0,n)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([n,s])=>{n===_y.p2p.code&&e.push([n,s]),n===_y["p2p-circuit"].code&&(e=[])});const t=e.pop();if((t==null?void 0:t[1])!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?ce(po.decode(`z${n}`),"base58btc"):ce(WQ.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return T(this,am)}equals(e){return rt(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const n=sP.get(t.name);if(n==null)throw new Z8e(`no available resolver for ${t.name}`);return(await n(this,e)).map(i=>Ve(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(Vz=ZQ,Y8e)](){return`Multiaddr(${T(this,Xp)})`}};Xp=new WeakMap,Kl=new WeakMap,om=new WeakMap,am=new WeakMap;let IS=Ap;const sP=new Map;function pv(r){return!!(r!=null&&r[ZQ])}function Ve(r){return new IS(r)}const ebe=[We("tcp").code,We("dns").code,We("dnsaddr").code,We("dns4").code,We("dns6").code];function JB(r){var e;return(e=eJ("sni",r))==null?void 0:e[1]}function YB(r){var t;const e=(t=eJ("tcp",r))==null?void 0:t[1];return e==null?"":`:${e}`}function eJ(r,e){let t;try{t=We(r).code}catch{return}for(const[n,s]of e)if(n===t&&s!=null)return[n,s]}function XB(r){return r.some(([e,t])=>e===We("tls").code)}function Yi(r,e,t){const n=tJ[We(r).name];if(n==null)throw new Error(`Can't interpret protocol ${We(r).name}`);const s=n(e,t);return r===We("ip6").code?`[${s}]`:s}const tJ={ip4:(r,e)=>r,ip6:(r,e)=>e.length===0?r:`[${r}]`,tcp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`tcp://${Yi(t[0],t[1]??"",e)}:${r}`},udp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`udp://${Yi(t[0],t[1]??"",e)}:${r}`},dnsaddr:(r,e)=>r,dns4:(r,e)=>r,dns6:(r,e)=>r,dns:(r,e)=>r,ipfs:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${Yi(t[0],t[1]??"",e)}`},p2p:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${Yi(t[0],t[1]??"",e)}`},http:(r,e)=>{const t=XB(e),n=JB(e),s=YB(e);if(t&&n!=null)return`https://${n}${s}`;const i=t?"https://":"http://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=Yi(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${i}${a}`},"http-path":(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");const n=Yi(t[0],t[1]??"",e),s=decodeURIComponent(r);return`${n}/${s}`},tls:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return Yi(t[0],t[1]??"",e)},sni:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return Yi(t[0],t[1]??"",e)},https:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=Yi(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`https://${n}`},ws:(r,e)=>{const t=XB(e),n=JB(e),s=YB(e);if(t&&n!=null)return`wss://${n}${s}`;const i=t?"wss://":"ws://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=Yi(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${i}${a}`},wss:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=Yi(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`wss://${n}`}};function rJ(r,e){const n=Ve(r).stringTuples(),s=n.pop();if(s==null)throw new Error("Unexpected end of multiaddr");const i=We(s[0]),o=tJ[i.name];if(o==null)throw new Error(`No interpreter found for ${i.name}`);let a=o(s[1]??"",n);return ebe.includes(s[0])&&(a=a.replace(/^.*:\/\//,""),s[1]==="443"?a=`https://${a}`:a=`http://${a}`),(a.startsWith("http://")||a.startsWith("https://")||a.startsWith("ws://")||a.startsWith("wss://"))&&(a=new URL(a).toString(),a.endsWith("/")&&(a=a.substring(0,a.length-1))),a}let tbe=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},rbe=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return nJ(this,e)}},nbe=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return nJ(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function nJ(r,e){return new nbe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let sbe=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new tbe(e,t,n),this.decoder=new rbe(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function ibe({name:r,prefix:e,encode:t,decode:n}){return new sbe(r,e,t,n)}function obe(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function abe(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function gv({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return ibe({prefix:e,name:r,encode(s){return abe(s,n,t)},decode(s){return obe(s,n,t,r)}})}const cbe=gv({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});gv({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});gv({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});gv({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Xh,Zh,Zp,e0,ed,j6,sJ;class lbe{constructor(e,{logger:t,transformRequestInit:n}){Q(this,j6);h(this,"url");Q(this,Xh,0);Q(this,Zh,0);Q(this,Zp,0);Q(this,e0,0);Q(this,ed,new Map);h(this,"log");h(this,"transformRequestInit");this.url=e instanceof URL?e:new URL(e),this.transformRequestInit=n,this.log=t.forComponent(`helia:trustless-gateway-block-broker:${this.url.hostname}`)}async getRawBlock(e,t){const n=new URL(this.url.toString());if(n.pathname=`/ipfs/${e.toString()}`,n.search="?format=raw",(t==null?void 0:t.aborted)===!0)throw new Error(`Signal to fetch raw block for CID ${e} from gateway ${this.url} was aborted prior to fetch`);const s=te(this,j6,sJ).call(this,e),i=new AbortController,o=()=>{i.abort()};t==null||t.addEventListener("abort",o);try{let a=T(this,ed).get(s);if(a==null){ts(this,Xh)._++;const c={signal:i.signal,headers:{Accept:"application/vnd.ipld.raw"},cache:"force-cache"},l=this.transformRequestInit!=null?await this.transformRequestInit(c):c;a=fetch(n.toString(),l).then(async u=>{if(this.log("GET %s %d",n,u.status),!u.ok)throw ts(this,Zh)._++,new Error(`unable to fetch raw block for CID ${e} from gateway ${this.url}`);return ts(this,e0)._++,new Uint8Array(await u.arrayBuffer())}),T(this,ed).set(s,a)}return await a}catch{throw(t==null?void 0:t.aborted)===!0?new Error(`fetching raw block for CID ${e} from gateway ${this.url} was aborted`):(ts(this,Zh)._++,new Error(`unable to fetch raw block for CID ${e}`))}finally{t==null||t.removeEventListener("abort",o),T(this,ed).delete(s)}}reliability(){return T(this,Xh)===0?1:T(this,Zp)>0?-1/0:T(this,e0)/(T(this,Xh)+T(this,Zh)*3)}incrementInvalidBlocks(){ts(this,Zp)._++}getStats(){return{attempts:T(this,Xh),errors:T(this,Zh),invalidBlocks:T(this,Zp),successes:T(this,e0),pendingResponses:T(this,ed).size}}}Xh=new WeakMap,Zh=new WeakMap,Zp=new WeakMap,e0=new WeakMap,ed=new WeakMap,j6=new WeakSet,sJ=function(e){const t=e.multihash.bytes;return cbe.encode(t)};function ube(r,e,t){return r.filter(n=>{if(i4e.matches(n)||e&&n4e.matches(n))return t||OQ.matches(n)?!0:ah(n.toOptions().host)===!1;if(!e&&t){const{host:s}=n.toOptions();if(s==="127.0.0.1"||s==="localhost"||s.endsWith(".localhost"))return!0}return!1})}async function*iJ(r,e,t,n,s,i={}){for await(const o of e.findProviders(r,i)){const a=ube(o.multiaddrs,n,s);if(a.length===0)continue;const c=rJ(a[0]);yield new lbe(c,{logger:t,transformRequestInit:i.transformRequestInit})}}class hbe extends AQ{constructor(t,n){super(t,{...n,name:"helia:trustless-gateway:session"});h(this,"routing");h(this,"allowInsecure");h(this,"allowLocal");h(this,"transformRequestInit");this.routing=t.routing,this.allowInsecure=n.allowInsecure??oJ,this.allowLocal=n.allowLocal??aJ,this.transformRequestInit=n.transformRequestInit}async queryProvider(t,n,s){var o;this.log("fetching BLOCK for %c from %s",t,n.url);const i=await n.getRawBlock(t,s.signal);return this.log.trace("got block for %c from %s",t,n.url),await((o=s.validateFn)==null?void 0:o.call(s,i)),i}async*findNewProviders(t,n={}){yield*iJ(t,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...n,transformRequestInit:this.transformRequestInit})}toEvictionKey(t){return t.url.toString()}equals(t,n){return t.url.toString()===n.url.toString()}}function dbe(r,e){return new hbe(r,e)}class fbe{constructor(e,t={}){h(this,"allowInsecure");h(this,"allowLocal");h(this,"transformRequestInit");h(this,"routing");h(this,"log");h(this,"logger");this.log=e.logger.forComponent("helia:trustless-gateway-block-broker"),this.logger=e.logger,this.routing=e.routing,this.allowInsecure=t.allowInsecure??oJ,this.allowLocal=t.allowLocal??aJ,this.transformRequestInit=t.transformRequestInit}async retrieve(e,t={}){var s,i;const n=[];for await(const o of iJ(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...t,transformRequestInit:this.transformRequestInit})){this.log("getting block for %c from %s",e,o.url);try{const a=await o.getRawBlock(e,t.signal);this.log.trace("got block for %c from %s",e,o.url);try{await((s=t.validateFn)==null?void 0:s.call(t,a))}catch(c){this.log.error("failed to validate block for %c from %s",e,o.url,c);continue}return a}catch(a){if(this.log.error("failed to get block for %c from %s",e,o.url,a),a instanceof Error?n.push(a):n.push(new Error(`Unable to fetch raw block for CID ${e} from gateway ${o.url}`)),((i=t.signal)==null?void 0:i.aborted)===!0){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",e,o.url);break}}}throw n.length>0?new AggregateError(n,`Unable to fetch raw block for CID ${e} from any gateway`):new Error(`Unable to fetch raw block for CID ${e} from any gateway`)}createSession(e={}){return dbe({logger:this.logger,routing:this.routing},{...e,allowLocal:this.allowLocal,allowInsecure:this.allowInsecure,transformRequestInit:this.transformRequestInit})}}const oJ=!1,aJ=!1;function pbe(r={}){return e=>new fbe(e,r)}async function*ZB(r,e={}){const t=r.getReader();try{for(;;){const n=await t.read();if(n.done)return;yield n.value}}finally{e.preventCancel!==!0&&await t.cancel(),t.releaseLock()}}var cJ={exports:{}};(function(r){(function(){r.exports=w;var e=86400,t=3200,n=146097*t/400,s=e*n,i=1e3*s,o=864e13,a=4294967296,c=1e6,l="000000000",u=Math.trunc||function(P){var L=P-P%1;return L==0&&(P<0||P===0&&1/P!=1/0)?-0:L},d=w.prototype,p=(w.fromDate=function(P){return new w(+P)},w.fromInt64BE=S(0,1,2,3,0,4),w.fromInt64LE=S(3,2,1,0,4,0),w.fromString=function(V){var L,K=new w,V=(V+="").replace(/^\s*[+\-]?\d+/,function(Y){var Y=+Y,U=1970+(Y-1970)%400;return K.year=Y-U,U}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(Z,Y,U){return Y<0&&(U*=-1),L=6e4*(60*+Y+ +U),""}).replace(/\.\d+$/,function(Z){return K.nano=+(Z+l).substr(1,9),""}).split(/\D+/);if(1<V.length?V[1]--:V[1]=0,K.time=L=Date.UTC.apply(Date,V)-(L||0),isNaN(L))throw new TypeError("Invalid Date");return m(K)},w.fromTimeT=function(P){return v(P,0)},d.year=0,d.time=0,d.nano=0,d.addNano=function(P){return this.nano+=+P||0,this},d.getNano=function(){var P=m(this);return(P.time%1e3*c+ +P.nano+1e9)%1e9},d.getTimeT=function(){var L=m(this),P=Math.floor(L.time/1e3),L=L.year;return L&&(P+=L*n*e/t),P},d.getYear=function(){return this.toDate().getUTCFullYear()+this.year},d.toDate=function(){return b(m(this).time)},d.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},d.toString=function(P){var L=this,K=L.toDate(),V={H:function(){return x(K.getUTCHours())},L:function(){return C(K.getUTCMilliseconds(),3)},M:function(){return x(K.getUTCMinutes())},N:function(){return C(L.getNano(),9)},S:function(){return x(K.getUTCSeconds())},Y:function(){var Z=L.getYear();return 999999<Z?"+"+Z:9999<Z?"+"+C(Z,6):0<=Z?C(Z,4):-999999<=Z?"-"+C(-Z,6):Z},a:function(){return f[K.getUTCDay()]},b:function(){return y[K.getUTCMonth()]},d:function(){return x(K.getUTCDate())},e:function(){return function(Z){return(9<Z?"":" ")+(0|Z)}(K.getUTCDate())},m:function(){return x(K.getUTCMonth()+1)}};return function Z(Y){return Y.replace(/%./g,function(U){var G=U[1],H=g[G],G=V[G];return H?Z(H):G?G():U})}(P||p)},d.writeInt64BE=E(0,1,2,3,0,4),d.writeInt64LE=E(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),y=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return w;function w(P,L,K){var V=this;if(!(V instanceof w))return new w(P,L,K);V.time=+P||0,V.nano=+L||0,V.year=+K||0,m(V)}function m(P){var L,K,V,Z=P.year,Y=P.time,U=P.nano,H=((U<0||c<=U)&&(U-=(K=Math.floor(U/c))*c,Y+=K,K=1),Z%t);return(Y<-864e13||o<Y||H)&&((L=u(Y/i))&&(Z+=L*t,Y-=L*i),(V=b(Y)).setUTCFullYear(H+V.getUTCFullYear()),V=(Y=+V)+(L=u((Z-=H)/t))*i,L&&-864e13<=V&&V<=o&&(Z-=L*t,Y=V),K=1),K&&(P.year=Z,P.time=Y,P.nano=U),P}function b(P){var L=new Date(0);return L.setTime(P),L}function v(Z,V){Z=+Z||0;var K=u((V=(V|0)*a)/s)+u(Z/s),V=V%s+Z%s,Z=u(V/s);return Z&&(K+=Z,V-=Z*s),new w(1e3*V,0,K*t)}function E(P,L,K,V,Z,Y){return function(H,G){var z=m(this);H=H||new Array(8),I(H,G|=0);var W=Math.floor(z.time/1e3),z=z.year*(n*e/t),$=u(z/a)+u(W/a),z=z%a+W%a,W=Math.floor(z/a);return W&&($+=W,z-=W*a),U(H,G+Z,$),U(H,G+Y,z),H};function U(H,G,$){H[G+P]=$>>24&255,H[G+L]=$>>16&255,H[G+K]=$>>8&255,H[G+V]=255&$}}function S(P,L,K,V,Z,Y){return function(H,G){I(H,G|=0);var $=U(H,G+Z);return v(U(H,G+Y),$)};function U(H,G){return 16777216*H[G+P]+(H[G+L]<<16|H[G+K]<<8|H[G+V])}}function I(P,L){if(P=P&&P.length,P==null)throw new TypeError("Invalid Buffer");if(P<L+8)throw new RangeError("Out of range")}function x(P){return(9<P?"":"0")+(0|P)}function C(P,L){return(l+(0|P)).substr(-L)}})()})(cJ);var gbe=cJ.exports;const kS=Zu(gbe);class Vl extends Error{constructor(e="Record signature verification failed"){super(e),this.name="SignatureVerificationError"}}h(Vl,"name","SignatureVerificationError");class lJ extends Error{constructor(e="Record has expired"){super(e),this.name="RecordExpiredError"}}h(lJ,"name","RecordExpiredError");class iP extends Error{constructor(e="The validity type is unsupported"){super(e),this.name="UnsupportedValidityError"}}h(iP,"name","UnsupportedValidityError");class uJ extends Error{constructor(e="The record is too large"){super(e),this.name="RecordTooLargeError"}}h(uJ,"name","RecordTooLargeError");class hJ extends Error{constructor(e="Value must be a valid content path starting with /"){super(e),this.name="InvalidValueError"}}h(hJ,"name","InvalidValueError");class dJ extends Error{constructor(e="Invalid record data"){super(e),this.name="InvalidRecordDataError"}}h(dJ,"name","InvalidRecordDataError");class TS extends Error{constructor(e="Invalid embedded public key"){super(e),this.name="InvalidEmbeddedPublicKeyError"}}h(TS,"name","InvalidEmbeddedPublicKeyError");var xo;(function(r){(function(n){n.EOL="EOL"})(r.ValidityType||(r.ValidityType={}));let e;(function(n){n[n.EOL=0]="EOL"})(e||(e={})),function(n){n.codec=()=>Cs(e)}(r.ValidityType||(r.ValidityType={}));let t;r.codec=()=>(t==null&&(t=Fe((n,s,i={})=>{i.lengthDelimited!==!1&&s.fork(),n.value!=null&&(s.uint32(10),s.bytes(n.value)),n.signatureV1!=null&&(s.uint32(18),s.bytes(n.signatureV1)),n.validityType!=null&&(s.uint32(24),r.ValidityType.codec().encode(n.validityType,s)),n.validity!=null&&(s.uint32(34),s.bytes(n.validity)),n.sequence!=null&&(s.uint32(40),s.uint64(n.sequence)),n.ttl!=null&&(s.uint32(48),s.uint64(n.ttl)),n.pubKey!=null&&(s.uint32(58),s.bytes(n.pubKey)),n.signatureV2!=null&&(s.uint32(66),s.bytes(n.signatureV2)),n.data!=null&&(s.uint32(74),s.bytes(n.data)),i.lengthDelimited!==!1&&s.ldelim()},(n,s,i={})=>{const o={},a=s==null?n.len:n.pos+s;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.value=n.bytes();break}case 2:{o.signatureV1=n.bytes();break}case 3:{o.validityType=r.ValidityType.codec().decode(n);break}case 4:{o.validity=n.bytes();break}case 5:{o.sequence=n.uint64();break}case 6:{o.ttl=n.uint64();break}case 7:{o.pubKey=n.bytes();break}case 8:{o.signatureV2=n.bytes();break}case 9:{o.data=n.bytes();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>Ue(n,r.codec()),r.decode=(n,s)=>Le(n,r.codec(),s)})(xo||(xo={}));function ybe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function oP(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function mbe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var wbe=mbe,bbe=wbe;let vbe=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Ebe=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return fJ(this,e)}},xbe=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return fJ(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function fJ(r,e){return new xbe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Abe=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new vbe(e,t,n),this.decoder=new Ebe(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function pJ({name:r,prefix:e,encode:t,decode:n}){return new Abe(r,e,t,n)}function yv({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=bbe(t,r);return pJ({prefix:e,name:r,encode:n,decode:i=>oP(s(i))})}function Sbe(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Cbe(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function jc({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return pJ({prefix:e,name:r,encode(s){return Cbe(s,n,t)},decode(s){return Sbe(s,n,t,r)}})}const uE=yv({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});yv({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const d4=jc({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});jc({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});jc({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});jc({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});jc({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});jc({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});jc({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});jc({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});jc({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Dl=yv({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});yv({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ibe=gJ,eM=128,kbe=-128,Tbe=Math.pow(2,31);function gJ(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Tbe;)e[t++]=r&255|eM,r/=128;for(;r&kbe;)e[t++]=r&255|eM,r>>>=7;return e[t]=r|0,gJ.bytes=t-n+1,e}var _be=_S,Pbe=128,tM=127;function _S(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw _S.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&tM)<<s:(o&tM)*Math.pow(2,s),s+=7}while(o>=Pbe);return _S.bytes=i-n,t}var Nbe=Math.pow(2,7),Dbe=Math.pow(2,14),Obe=Math.pow(2,21),Rbe=Math.pow(2,28),Bbe=Math.pow(2,35),Mbe=Math.pow(2,42),$be=Math.pow(2,49),Lbe=Math.pow(2,56),Ube=Math.pow(2,63),Fbe=function(r){return r<Nbe?1:r<Dbe?2:r<Obe?3:r<Rbe?4:r<Bbe?5:r<Mbe?6:r<$be?7:r<Lbe?8:r<Ube?9:10},zbe={encode:Ibe,decode:_be,encodingLength:Fbe},db=zbe;function PS(r,e=0){return[db.decode(r,e),db.decode.bytes]}function fb(r,e,t=0){return db.encode(r,e,t),e}function pb(r){return db.encodingLength(r)}function Vbe(r,e){const t=e.byteLength,n=pb(r),s=n+pb(t),i=new Uint8Array(s+t);return fb(r,i,0),fb(t,i,n),i.set(e,s),new aP(r,t,e,i)}function yJ(r){const e=oP(r),[t,n]=PS(e),[s,i]=PS(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new aP(t,s,o,e)}function Hbe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&ybe(r.bytes,t.bytes)}}let aP=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function rM(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Gbe(t,NS(r),e??Dl.encoder);default:return jbe(t,NS(r),e??d4.encoder)}}const nM=new WeakMap;function NS(r){const e=nM.get(r);if(e==null){const t=new Map;return nM.set(r,t),t}return e}var Hz;let sM=class wn{constructor(e,t,n,s){h(this,"code");h(this,"version");h(this,"multihash");h(this,"bytes");h(this,"/");h(this,Hz,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Gg)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==qbe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return wn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Vbe(e,t);return wn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return wn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Hbe(e.multihash,n.multihash)}toString(e){return rM(this,e)}toJSON(){return{"/":rM(this)}}link(){return this}[(Hz=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof wn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new wn(n,s,i,o??iM(n,s,i.bytes))}else if(t[Wbe]===!0){const{version:n,multihash:s,code:i}=t,o=yJ(s);return wn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Gg)throw new Error(`Version 0 CID must use dag-pb (code: ${Gg}) block encoding`);return new wn(e,t,n,n.bytes)}case 1:{const s=iM(e,t,n.bytes);return new wn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return wn.create(0,Gg,e)}static createV1(e,t){return wn.create(1,e,t)}static decode(e){const[t,n]=wn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=wn.inspectBytes(e),n=t.size-t.multihashSize,s=oP(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new aP(t.multihashCode,t.digestSize,i,s);return[t.version===0?wn.createV0(o):wn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=PS(e.subarray(t));return t+=p,d};let s=n(),i=Gg;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,s]=Kbe(e,t),i=wn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return NS(i).set(n,e),i}};function Kbe(r,e){switch(r[0]){case"Q":{const t=e??Dl;return[Dl.prefix,t.decode(`${Dl.prefix}${r}`)]}case Dl.prefix:{const t=e??Dl;return[Dl.prefix,t.decode(r)]}case d4.prefix:{const t=e??d4;return[d4.prefix,t.decode(r)]}case uE.prefix:{const t=e??uE;return[uE.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Gbe(r,e,t){const{prefix:n}=t;if(n!==Dl.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s}function jbe(r,e,t){const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s}const Gg=112,qbe=18;function iM(r,e,t){const n=pb(r),s=n+pb(e),i=new Uint8Array(s+t.byteLength);return fb(r,i,0),fb(e,i,n),i.set(t,s),i}const Wbe=Symbol.for("@ipld/js-cid/CID"),Qbe=X1("ipns:utils"),mJ=he("/ipns/"),Jbe=0,Ybe=18;function Xbe(r){let e;if(r.pubKey!=null)try{e=Is(r.pubKey)}catch(t){throw Qbe.error(t),t}if(e!=null)return e}function Zbe(r){const e=he("ipns-signature:");return Cr([e,r])}function wJ(r){return"signatureV1"in r?xo.encode({value:he(r.value),signatureV1:r.signatureV1,validityType:r.validityType,validity:he(r.validity),sequence:r.sequence,ttl:r.ttl,pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data}):xo.encode({pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data})}function Vm(r){const e=xo.decode(r);if(e.sequence!=null&&(e.sequence=BigInt(e.sequence)),e.ttl!=null&&(e.ttl=BigInt(e.ttl)),e.signatureV2==null||e.data==null)throw new Vl("Missing data or signatureV2");const t=vJ(e.data),n=e6e(t.Value),s=ce(t.Validity);if(e.value!=null&&e.signatureV1!=null)return t6e(e),{value:n,validityType:xo.ValidityType.EOL,validity:s,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV1:e.signatureV1,signatureV2:e.signatureV2,data:e.data};if(e.signatureV2!=null)return{value:n,validityType:xo.ValidityType.EOL,validity:s,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}function bJ(r){return Cr([mJ,r.bytes])}function DS(r){const e=yJ(r.slice(mJ.length));if(!OS(e,Jbe)&&!OS(e,Ybe))throw new U5("Multihash in IPNS key was not identity or sha2-256");return e}function vJ(r){const e=Fl(r);if(e.ValidityType===0)e.ValidityType=xo.ValidityType.EOL;else throw new iP("The validity type is unsupported");return Number.isInteger(e.Sequence)&&(e.Sequence=BigInt(e.Sequence)),Number.isInteger(e.TTL)&&(e.TTL=BigInt(e.TTL)),e}function e6e(r){const e=ce(r).trim();if(e.startsWith("/"))return e;try{return`/ipfs/${sM.decode(r).toV1().toString()}`}catch{}try{return`/ipfs/${sM.parse(e).toV1().toString()}`}catch{}throw new hJ("Value must be a valid content path starting with /")}function t6e(r){if(r.data==null)throw new dJ("Record data is missing");const e=vJ(r.data);if(!rt(e.Value,r.value??new Uint8Array(0)))throw new Vl('Field "value" did not match between protobuf and CBOR');if(!rt(e.Validity,r.validity??new Uint8Array(0)))throw new Vl('Field "validity" did not match between protobuf and CBOR');if(e.ValidityType!==r.validityType)throw new Vl('Field "validityType" did not match between protobuf and CBOR');if(e.Sequence!==r.sequence)throw new Vl('Field "sequence" did not match between protobuf and CBOR');if(e.TTL!==r.ttl)throw new Vl('Field "ttl" did not match between protobuf and CBOR')}function OS(r,e){return r.code===e}const o3=X1("ipns:validator"),r6e=1024*10,n6e=async(r,e)=>{const t=Vm(e);let n;try{const s=Zbe(t.data);n=await r.verify(s,t.signatureV2)}catch{n=!1}if(!n)throw o3.error("record signature verification failed"),new Vl("Record signature verification failed");if(t.validityType===xo.ValidityType.EOL){if(kS.fromString(t.validity).toDate().getTime()<Date.now())throw o3.error("record has expired"),new lJ("record has expired")}else if(t.validityType!=null)throw o3.error("the validity type is unsupported"),new iP("The validity type is unsupported");o3("ipns record for %s is valid",t.value)};async function EJ(r,e){if(e.byteLength>r6e)throw new uJ("The record is too large");const t=DS(r);let n;OS(t,0)&&(n=zq(t));const s=Vm(e),i=Xbe(s)??n;if(i==null)throw new TS("Could not extract public key from IPNS record or routing key");const o=bJ(i.toMultihash());if(!rt(o,r))throw new TS("Embedded public key did not match routing key");await n6e(i,e)}let s6e=class extends Error{constructor(){super(...arguments);h(this,"name","InvalidMessageLengthError");h(this,"code","ERR_INVALID_MESSAGE_LENGTH")}};async function*oM(r,e={}){const t=/\r?\n/,n=new TextDecoder("utf8");let s="";for await(let i of r){if(typeof i=="string"&&(i=new TextEncoder().encode(i)),i2(i)&&(i=i.subarray()),s+=n.decode(i,{stream:!0}),s.length>((e==null?void 0:e.maxMessageLength)??s.length))throw new s6e("Incoming message too long");const o=s.split(t);s=o.pop()??"";for(let a=0;a<o.length;a++)yield JSON.parse(o[a])}s+=n.decode(),s!==""&&(yield JSON.parse(s))}class f4 extends Error{constructor(e="Invalid request"){super(e),this.name="InvalidRequestError"}}h(f4,"name","InvalidRequestError");class $a extends Error{constructor(e="Bad response"){super(e),this.name="BadResponseError"}}h($a,"name","BadResponseError");function i6e(r){return r[Symbol.asyncIterator]!=null}function o6e(r){if(i6e(r))return(async()=>{for await(const e of r)return e})();for(const e of r)return e}function a6e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function cP(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function c6e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var l6e=c6e,u6e=l6e;let h6e=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},d6e=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return xJ(this,e)}},f6e=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return xJ(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function xJ(r,e){return new f6e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let p6e=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new h6e(e,t,n),this.decoder=new d6e(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function AJ({name:r,prefix:e,encode:t,decode:n}){return new p6e(r,e,t,n)}function mv({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=u6e(t,r);return AJ({prefix:e,name:r,encode:n,decode:i=>cP(s(i))})}function g6e(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function y6e(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function qc({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return AJ({prefix:e,name:r,encode(s){return y6e(s,n,t)},decode(s){return g6e(s,n,t,r)}})}const p4=qc({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});qc({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});qc({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});qc({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});qc({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});qc({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});qc({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});qc({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});qc({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const hE=mv({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});mv({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Ol=mv({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});mv({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var m6e=SJ,aM=128,w6e=-128,b6e=Math.pow(2,31);function SJ(r,e,t){e=e||[],t=t||0;for(var n=t;r>=b6e;)e[t++]=r&255|aM,r/=128;for(;r&w6e;)e[t++]=r&255|aM,r>>>=7;return e[t]=r|0,SJ.bytes=t-n+1,e}var v6e=RS,E6e=128,cM=127;function RS(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw RS.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&cM)<<s:(o&cM)*Math.pow(2,s),s+=7}while(o>=E6e);return RS.bytes=i-n,t}var x6e=Math.pow(2,7),A6e=Math.pow(2,14),S6e=Math.pow(2,21),C6e=Math.pow(2,28),I6e=Math.pow(2,35),k6e=Math.pow(2,42),T6e=Math.pow(2,49),_6e=Math.pow(2,56),P6e=Math.pow(2,63),N6e=function(r){return r<x6e?1:r<A6e?2:r<S6e?3:r<C6e?4:r<I6e?5:r<k6e?6:r<T6e?7:r<_6e?8:r<P6e?9:10},D6e={encode:m6e,decode:v6e,encodingLength:N6e},gb=D6e;function BS(r,e=0){return[gb.decode(r,e),gb.decode.bytes]}function yb(r,e,t=0){return gb.encode(r,e,t),e}function mb(r){return gb.encodingLength(r)}function O6e(r,e){const t=e.byteLength,n=mb(r),s=n+mb(t),i=new Uint8Array(s+t);return yb(r,i,0),yb(t,i,n),i.set(e,s),new lP(r,t,e,i)}function R6e(r){const e=cP(r),[t,n]=BS(e),[s,i]=BS(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new lP(t,s,o,e)}function B6e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&a6e(r.bytes,t.bytes)}}let lP=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function lM(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return $6e(t,MS(r),e??Ol.encoder);default:return L6e(t,MS(r),e??p4.encoder)}}const uM=new WeakMap;function MS(r){const e=uM.get(r);if(e==null){const t=new Map;return uM.set(r,t),t}return e}var Kz;let hM=class bn{constructor(e,t,n,s){h(this,"code");h(this,"version");h(this,"multihash");h(this,"bytes");h(this,"/");h(this,Kz,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==jg)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==U6e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return bn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=O6e(e,t);return bn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return bn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&B6e(e.multihash,n.multihash)}toString(e){return lM(this,e)}toJSON(){return{"/":lM(this)}}link(){return this}[(Kz=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof bn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new bn(n,s,i,o??dM(n,s,i.bytes))}else if(t[F6e]===!0){const{version:n,multihash:s,code:i}=t,o=R6e(s);return bn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==jg)throw new Error(`Version 0 CID must use dag-pb (code: ${jg}) block encoding`);return new bn(e,t,n,n.bytes)}case 1:{const s=dM(e,t,n.bytes);return new bn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return bn.create(0,jg,e)}static createV1(e,t){return bn.create(1,e,t)}static decode(e){const[t,n]=bn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=bn.inspectBytes(e),n=t.size-t.multihashSize,s=cP(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new lP(t.multihashCode,t.digestSize,i,s);return[t.version===0?bn.createV0(o):bn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=BS(e.subarray(t));return t+=p,d};let s=n(),i=jg;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,s]=M6e(e,t),i=bn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return MS(i).set(n,e),i}};function M6e(r,e){switch(r[0]){case"Q":{const t=e??Ol;return[Ol.prefix,t.decode(`${Ol.prefix}${r}`)]}case Ol.prefix:{const t=e??Ol;return[Ol.prefix,t.decode(r)]}case p4.prefix:{const t=e??p4;return[p4.prefix,t.decode(r)]}case hE.prefix:{const t=e??hE;return[hE.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function $6e(r,e,t){const{prefix:n}=t;if(n!==Ol.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s}function L6e(r,e,t){const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s}const jg=112,U6e=18;function dM(r,e,t){const n=mb(r),s=n+mb(e),i=new Uint8Array(s+t.byteLength);return yb(r,i,0),yb(e,i,n),i.set(t,s),i}const F6e=Symbol.for("@ipld/js-cid/CID"),fM=he("/ipns/");function pM(r){return rt(r.subarray(0,fM.byteLength),fM)}class z6e{constructor(e){h(this,"client");this.client=e}async*findProviders(e,t={}){yield*J1(this.client.getProviders(e,t),n=>({id:n.ID,multiaddrs:n.Addrs??[]}))}async provide(){}async cancelReprovide(){}async put(e,t,n){if(!pM(e))return;const s=DS(e),i=hM.createV1(114,s),o=Vm(t);await this.client.putIPNS(i,o,n)}async get(e,t){if(!pM(e))throw new vr("Not found");const n=DS(e),s=hM.createV1(114,n);try{const i=await this.client.getIPNS(s,t);return wJ(i)}catch(i){throw i.name==="BadResponseError"?new vr("Not found"):i}}}class V6e{constructor(e){h(this,"client");this.client=e}async findPeer(e,t={}){const n=await o6e(this.client.getPeers(e,t));if(n!=null)return{id:n.ID,multiaddrs:n.Addrs??[]};throw new vr("Not found")}async*getClosestPeers(e,t={}){}}const Tr=X1("delegated-routing-v1-http-api-client"),a3={concurrentRequests:4,timeout:3e4,cacheTTL:5*60*1e3,cacheName:"delegated-routing-v1-cache"};var qn,u2,$S,h2;class H6e{constructor(e,t={}){Q(this,qn);h(this,"started");h(this,"httpQueue");h(this,"shutDownController");h(this,"clientUrl");h(this,"timeout");h(this,"contentRouting");h(this,"peerRouting");h(this,"filterAddrs");h(this,"filterProtocols");h(this,"inFlightRequests");h(this,"cacheName");h(this,"cache");h(this,"cacheTTL");this.started=!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.httpQueue=new Bu({concurrency:t.concurrentRequests??a3.concurrentRequests}),this.inFlightRequests=new Map,this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=t.timeout??a3.timeout,this.filterAddrs=t.filterAddrs,this.filterProtocols=t.filterProtocols,this.contentRouting=new z6e(this),this.peerRouting=new V6e(this),this.cacheName=t.cacheName??a3.cacheName,this.cacheTTL=t.cacheTTL??a3.cacheTTL}get[Y0](){return this.contentRouting}get[X0](){return this.peerRouting}isStarted(){return this.started}async start(){var e;this.started||(this.started=!0,this.cacheTTL>0&&(this.cache=await((e=globalThis.caches)==null?void 0:e.open(this.cacheName)),this.cache!=null&&Tr("cache enabled with ttl %d",this.cacheTTL)))}async stop(){var e;this.httpQueue.clear(),this.shutDownController.abort(),await((e=globalThis.caches)==null?void 0:e.delete(this.cacheName)),this.started=!1}async*getProviders(e,t={}){Tr("getProviders starts: %c",e);const n=AbortSignal.timeout(this.timeout),s=At([this.shutDownController.signal,n,t.signal]),i=He(),o=He();this.httpQueue.add(async()=>(i.resolve(),o.promise));try{await i.promise;const a=new URL(`${this.clientUrl}routing/v1/providers/${e.toString()}`);te(this,qn,$S).call(this,a,t.filterAddrs,t.filterProtocols);const c={headers:{Accept:"application/x-ndjson"},signal:s},l=await te(this,qn,h2).call(this,a.toString(),c);if(l==null)throw new $a("No response received");if(!l.ok)throw l.status===404?new vr("No matching records found"):l.status===422?new f4("Request does not conform to schema or semantic constraints"):new $a(`Unexpected status code: ${l.status}`);if(l.body==null)throw new $a("Routing response had no body");const u=l.headers.get("Content-Type");if(u==null)throw new $a("No Content-Type header received");if(u!=null&&u.startsWith("application/json")){const d=await l.json();for(const p of d.Providers){const y=te(this,qn,u2).call(this,p);y!=null&&(yield y)}}else if(u.includes("application/x-ndjson"))for await(const d of oM(ZB(l.body))){const p=te(this,qn,u2).call(this,d);p!=null&&(yield p)}else throw new $a(`Unsupported Content-Type: ${u}`)}catch(a){Tr.error("getProviders errored:",a)}finally{s.clear(),o.resolve(),Tr("getProviders finished: %c",e)}}async*getPeers(e,t={}){Tr("getPeers starts: %c",e);const n=AbortSignal.timeout(this.timeout),s=At([this.shutDownController.signal,n,t.signal]),i=He(),o=He();this.httpQueue.add(async()=>(i.resolve(),o.promise));try{await i.promise;const a=new URL(`${this.clientUrl}routing/v1/peers/${e.toCID().toString()}`);te(this,qn,$S).call(this,a,t.filterAddrs,t.filterProtocols);const c={headers:{Accept:"application/x-ndjson"},signal:s},l=await te(this,qn,h2).call(this,a.toString(),c);if(l.status===404)throw new vr("No matching records found");if(l.status===422)throw new f4("Request does not conform to schema or semantic constraints");if(l.body==null)throw new $a("Routing response had no body");if(l.headers.get("Content-Type")==="application/json"){const d=await l.json();for(const p of d.Peers){const y=te(this,qn,u2).call(this,p);y!=null&&(yield y)}}else for await(const d of oM(ZB(l.body))){const p=te(this,qn,u2).call(this,d);p!=null&&(yield p)}}catch(a){Tr.error("getPeers errored:",a)}finally{s.clear(),o.resolve(),Tr("getPeers finished: %c",e)}}async getIPNS(e,t={}){Tr("getIPNS starts: %s",e);const n=AbortSignal.timeout(this.timeout),s=At([this.shutDownController.signal,n,t.signal]),i=He(),o=He();this.httpQueue.add(async()=>(i.resolve(),o.promise));const a=`${this.clientUrl}routing/v1/ipns/${e}`;try{await i.promise;const c={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:s},l=await te(this,qn,h2).call(this,a,c);if(Tr("getIPNS GET %s %d",a,l.status),l.status===404)throw new vr("No matching records found");if(l.status===422)throw new f4("Request does not conform to schema or semantic constraints");if(l.body==null)throw new $a("GET ipns response had no body");const u=await l.arrayBuffer(),d=new Uint8Array(u,0,u.byteLength);return t.validate!==!1&&await EJ(bJ(e.multihash),d),Vm(d)}catch(c){throw Tr.error("getIPNS GET %s error:",a,c),c}finally{s.clear(),o.resolve(),Tr("getIPNS finished: %s",e)}}async putIPNS(e,t,n={}){Tr("putIPNS starts: %c",e);const s=AbortSignal.timeout(this.timeout),i=At([this.shutDownController.signal,s,n.signal]),o=He(),a=He();this.httpQueue.add(async()=>(o.resolve(),a.promise));const c=`${this.clientUrl}routing/v1/ipns/${e}`;try{await o.promise;const l=wJ(t),u={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:l,signal:i},d=await te(this,qn,h2).call(this,c,u);if(Tr("putIPNS PUT %s %d",c,d.status),d.status!==200)throw new $a("PUT ipns response had status other than 200")}catch(l){throw Tr.error("putIPNS PUT %s error:",c,l.stack),l}finally{i.clear(),a.resolve(),Tr("putIPNS finished: %c",e)}}}qn=new WeakSet,u2=function(e){var t;try{const n=[],s=((t=e.Addrs)==null?void 0:t.map(Ve))??[];return e.Protocols!=null&&n.push(...e.Protocols),e.Protocol!=null&&(n.push(e.Protocol),delete e.Protocol),{...e,Schema:"peer",ID:mr(e.ID),Addrs:s,Protocols:n}}catch(n){Tr.error("could not conform record to peer schema",n)}},$S=function(e,t,n){var s,i;if(t!=null||this.filterAddrs!=null){const o=(t==null?void 0:t.join(","))??((s=this.filterAddrs)==null?void 0:s.join(","))??"";o!==""&&e.searchParams.set("filter-addrs",o)}if(n!=null||this.filterProtocols!=null){const o=(n==null?void 0:n.join(","))??((i=this.filterProtocols)==null?void 0:i.join(","))??"";o!==""&&e.searchParams.set("filter-protocols",o)}},h2=async function(e,t){var c,l;const n=t.method??"GET",s=`${n}-${e}`;if(n==="GET"){const u=await((c=this.cache)==null?void 0:c.match(e));if(u!=null){if(parseInt(u.headers.get("x-cache-expires")??"0",10)>Date.now())return Tr("returning cached response for %s",s),u;await((l=this.cache)==null?void 0:l.delete(e))}}const i=this.inFlightRequests.get(s);if(i!=null){const u=await i;return Tr("deduplicating outgoing request for %s",s),u.clone()}const o=fetch(e,t).then(async u=>{if(this.cache!=null&&u.ok&&n==="GET"){const d=Date.now()+this.cacheTTL,p=new Headers(u.headers);p.set("x-cache-expires",d.toString());const y=new Response(u.clone().body,{status:u.status,statusText:u.statusText,headers:p});await this.cache.put(e,y)}return u}).finally(()=>{this.inFlightRequests.delete(s)});return this.inFlightRequests.set(s,o),await o};function K6e(r,e={}){return new H6e(new URL(r),e)}function G6e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function wv(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function j6e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var q6e=j6e,W6e=q6e;let Q6e=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},J6e=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return CJ(this,e)}},Y6e=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return CJ(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function CJ(r,e){return new Y6e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let X6e=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Q6e(e,t,n),this.decoder=new J6e(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function IJ({name:r,prefix:e,encode:t,decode:n}){return new X6e(r,e,t,n)}function bv({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=W6e(t,r);return IJ({prefix:e,name:r,encode:n,decode:i=>wv(s(i))})}function Z6e(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function e5e(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function Wc({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return IJ({prefix:e,name:r,encode(s){return e5e(s,n,t)},decode(s){return Z6e(s,n,t,r)}})}const g4=Wc({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Wc({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Wc({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Wc({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Wc({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Wc({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Wc({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Wc({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Wc({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const dE=bv({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});bv({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Rl=bv({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});bv({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var t5e=kJ,gM=128,r5e=-128,n5e=Math.pow(2,31);function kJ(r,e,t){e=e||[],t=t||0;for(var n=t;r>=n5e;)e[t++]=r&255|gM,r/=128;for(;r&r5e;)e[t++]=r&255|gM,r>>>=7;return e[t]=r|0,kJ.bytes=t-n+1,e}var s5e=LS,i5e=128,yM=127;function LS(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw LS.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&yM)<<s:(o&yM)*Math.pow(2,s),s+=7}while(o>=i5e);return LS.bytes=i-n,t}var o5e=Math.pow(2,7),a5e=Math.pow(2,14),c5e=Math.pow(2,21),l5e=Math.pow(2,28),u5e=Math.pow(2,35),h5e=Math.pow(2,42),d5e=Math.pow(2,49),f5e=Math.pow(2,56),p5e=Math.pow(2,63),g5e=function(r){return r<o5e?1:r<a5e?2:r<c5e?3:r<l5e?4:r<u5e?5:r<h5e?6:r<d5e?7:r<f5e?8:r<p5e?9:10},y5e={encode:t5e,decode:s5e,encodingLength:g5e},wb=y5e;function US(r,e=0){return[wb.decode(r,e),wb.decode.bytes]}function bb(r,e,t=0){return wb.encode(r,e,t),e}function vb(r){return wb.encodingLength(r)}function TJ(r,e){const t=e.byteLength,n=vb(r),s=n+vb(t),i=new Uint8Array(s+t);return bb(r,i,0),bb(t,i,n),i.set(e,s),new uP(r,t,e,i)}function m5e(r){const e=wv(r),[t,n]=US(e),[s,i]=US(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new uP(t,s,o,e)}function w5e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&G6e(r.bytes,t.bytes)}}let uP=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function mM(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return E5e(t,FS(r),e??Rl.encoder);default:return x5e(t,FS(r),e??g4.encoder)}}const wM=new WeakMap;function FS(r){const e=wM.get(r);if(e==null){const t=new Map;return wM.set(r,t),t}return e}var Gz;let b5e=class vn{constructor(e,t,n,s){h(this,"code");h(this,"version");h(this,"multihash");h(this,"bytes");h(this,"/");h(this,Gz,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==qg)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==A5e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return vn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=TJ(e,t);return vn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return vn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&w5e(e.multihash,n.multihash)}toString(e){return mM(this,e)}toJSON(){return{"/":mM(this)}}link(){return this}[(Gz=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof vn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new vn(n,s,i,o??bM(n,s,i.bytes))}else if(t[S5e]===!0){const{version:n,multihash:s,code:i}=t,o=m5e(s);return vn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==qg)throw new Error(`Version 0 CID must use dag-pb (code: ${qg}) block encoding`);return new vn(e,t,n,n.bytes)}case 1:{const s=bM(e,t,n.bytes);return new vn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return vn.create(0,qg,e)}static createV1(e,t){return vn.create(1,e,t)}static decode(e){const[t,n]=vn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=vn.inspectBytes(e),n=t.size-t.multihashSize,s=wv(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new uP(t.multihashCode,t.digestSize,i,s);return[t.version===0?vn.createV0(o):vn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=US(e.subarray(t));return t+=p,d};let s=n(),i=qg;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,s]=v5e(e,t),i=vn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return FS(i).set(n,e),i}};function v5e(r,e){switch(r[0]){case"Q":{const t=e??Rl;return[Rl.prefix,t.decode(`${Rl.prefix}${r}`)]}case Rl.prefix:{const t=e??Rl;return[Rl.prefix,t.decode(r)]}case g4.prefix:{const t=e??g4;return[g4.prefix,t.decode(r)]}case dE.prefix:{const t=e??dE;return[dE.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function E5e(r,e,t){const{prefix:n}=t;if(n!==Rl.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s}function x5e(r,e,t){const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s}const qg=112,A5e=18;function bM(r,e,t){const n=vb(r),s=n+vb(e),i=new Uint8Array(s+t.byteLength);return bb(r,i,0),bb(e,i,n),i.set(t,s),i}const S5e=Symbol.for("@ipld/js-cid/CID");function C5e(){return{filterProtocols:["unknown","transport-bitswap","transport-ipfs-gateway-http"],filterAddrs:["https","webtransport","webrtc","webrtc-direct","wss","tls"]}}const vM="[a-fA-F\\d:]",hu=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${vM})|(?<=${vM})(?=\\s|$))`:"",uo="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",yr="[a-fA-F\\d]{1,4}",vv=`
(?:
(?:${yr}:){7}(?:${yr}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${yr}:){6}(?:${uo}|:${yr}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${yr}:){5}(?::${uo}|(?::${yr}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${yr}:){4}(?:(?::${yr}){0,1}:${uo}|(?::${yr}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${yr}:){3}(?:(?::${yr}){0,2}:${uo}|(?::${yr}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${yr}:){2}(?:(?::${yr}){0,3}:${uo}|(?::${yr}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${yr}:){1}(?:(?::${yr}){0,4}:${uo}|(?::${yr}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${yr}){0,5}:${uo}|(?::${yr}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),I5e=new RegExp(`(?:^${uo}$)|(?:^${vv}$)`),k5e=new RegExp(`^${uo}$`),T5e=new RegExp(`^${vv}$`),Ev=r=>r&&r.exact?I5e:new RegExp(`(?:${hu(r)}${uo}${hu(r)})|(?:${hu(r)}${vv}${hu(r)})`,"g");Ev.v4=r=>r&&r.exact?k5e:new RegExp(`${hu(r)}${uo}${hu(r)}`,"g");Ev.v6=r=>r&&r.exact?T5e:new RegExp(`${hu(r)}${vv}${hu(r)}`,"g");function _5e(r){const e=(...t)=>r(...t);return Object.defineProperty(e,"name",{value:`functionTimeout(${r.name||"<anonymous>"})`,configurable:!0}),e}const{toString:P5e}=Object.prototype;function N5e(r){return P5e.call(r)==="[object RegExp]"}const EM={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function D5e(r,e={}){if(!N5e(r))throw new TypeError("Expected a RegExp instance");const t=Object.keys(EM).map(s=>(typeof e[s]=="boolean"?e[s]:r[s])?EM[s]:"").join(""),n=new RegExp(e.source||r.source,t);return n.lastIndex=typeof e.lastIndex=="number"?e.lastIndex:r.lastIndex,n}function _J(r,e,{timeout:t}={}){try{return _5e(()=>D5e(r).test(e),{timeout:t})()}catch(n){throw n}}const O5e=15,R5e=45,PJ={timeout:400};function xM(r){return r.length>R5e?!1:_J(Ev.v6({exact:!0}),r,PJ)}function B5e(r){return r.length>O5e?!1:_J(Ev.v4({exact:!0}),r,PJ)}const AM={http:"80",https:"443",ws:"80",wss:"443"},M5e=["http","https","ws","wss"];function $5e(r,e){e=e??{};const t=e.defaultDnsType??"dns4",{scheme:n,hostname:s,port:i,path:o}=L5e(r),a=[U5e(s,t),F5e(i,n),z5e(n)];o!=null&&a.push(V5e(o));const c="/"+a.filter(l=>!!l).reduce((l,u)=>l.concat(u),[]).join("/");return Ve(c)}function L5e(r){const[e]=r.split(":");M5e.includes(e)||(r="http"+r.substring(e.length));let{protocol:t,hostname:n,port:s,pathname:i,search:o}=new URL(r);if(s==null||s===""){const c=H5e(e);c!=null&&(s=c),c==null&&t==="http:"&&(s="80")}let a;return i!=null&&i!==""&&i!=="/"&&(i.startsWith("/")&&(i=i.substring(1)),a=i),o!=null&&o!==""&&(a=a??"",a+=o),{scheme:e,hostname:n,port:s,path:a}}function U5e(r,e){if(!(r==null||r==="")){if(B5e(r))return["ip4",r];if(xM(r))return["ip6",r];if(r[0]==="["){const t=r.substring(1,r.length-1);if(xM(t))return["ip6",t]}return[e,r]}}function F5e(r,e){if(!(r==null||r===""))return e==="udp"?["udp",r]:["tcp",r]}function z5e(r){if(r.match(/^tcp$|^udp$/)==null)return[r]}function V5e(r){if(!(r==null||r===""))return["http-path",encodeURIComponent(r)]}function H5e(r){if(!(r==null||r===""||AM[r]==null))return AM[r]}const NJ=0,K5e="identity",DJ=wv;function G5e(r){return TJ(NJ,DJ(r))}const j5e={code:NJ,name:K5e,encode:DJ,digest:G5e},q5e=["https://trustless-gateway.link","https://4everland.io"],W5e=2336;function Q5e(r){return r=r.toString(),{id:Y1(b5e.createV1(W5e,j5e.digest(he(r)))),multiaddrs:[$5e(r)]}}class J5e{constructor(e={}){h(this,"gateways");this.gateways=(e.gateways??q5e).map(t=>Q5e(t))}async*findProviders(e,t){yield*this.gateways.toSorted(()=>Math.random()>.5?1:-1).map(n=>({...n,protocols:["transport-ipfs-gateway-http"]}))}}function Y5e(r={}){return new J5e(r)}class X5e{constructor(e){h(this,"libp2p");this.libp2p=e}async provide(e,t){await this.libp2p.contentRouting.provide(e,t)}async cancelReprovide(e,t){await this.libp2p.contentRouting.cancelReprovide(e,t)}async*findProviders(e,t){yield*this.libp2p.contentRouting.findProviders(e,t)}async put(e,t,n){await this.libp2p.contentRouting.put(e,t,n)}async get(e,t){return this.libp2p.contentRouting.get(e,t)}async findPeer(e,t){return this.libp2p.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t){yield*this.libp2p.peerRouting.getClosestPeers(e,t)}}function Z5e(r){return new X5e(r)}function eve(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function hP(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function tve(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var rve=tve,nve=rve;let sve=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ive=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return OJ(this,e)}},ove=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return OJ(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function OJ(r,e){return new ove({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let ave=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new sve(e,t,n),this.decoder=new ive(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function RJ({name:r,prefix:e,encode:t,decode:n}){return new ave(r,e,t,n)}function xv({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=nve(t,r);return RJ({prefix:e,name:r,encode:n,decode:i=>hP(s(i))})}function cve(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function lve(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function Qc({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return RJ({prefix:e,name:r,encode(s){return lve(s,n,t)},decode(s){return cve(s,n,t,r)}})}const hc=Qc({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Qc({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Qc({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Qc({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Qc({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Qc({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Qc({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Qc({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Qc({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const fE=xv({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});xv({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Bl=xv({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});xv({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var uve=BJ,SM=128,hve=-128,dve=Math.pow(2,31);function BJ(r,e,t){e=e||[],t=t||0;for(var n=t;r>=dve;)e[t++]=r&255|SM,r/=128;for(;r&hve;)e[t++]=r&255|SM,r>>>=7;return e[t]=r|0,BJ.bytes=t-n+1,e}var fve=zS,pve=128,CM=127;function zS(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw zS.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&CM)<<s:(o&CM)*Math.pow(2,s),s+=7}while(o>=pve);return zS.bytes=i-n,t}var gve=Math.pow(2,7),yve=Math.pow(2,14),mve=Math.pow(2,21),wve=Math.pow(2,28),bve=Math.pow(2,35),vve=Math.pow(2,42),Eve=Math.pow(2,49),xve=Math.pow(2,56),Ave=Math.pow(2,63),Sve=function(r){return r<gve?1:r<yve?2:r<mve?3:r<wve?4:r<bve?5:r<vve?6:r<Eve?7:r<xve?8:r<Ave?9:10},Cve={encode:uve,decode:fve,encodingLength:Sve},Eb=Cve;function VS(r,e=0){return[Eb.decode(r,e),Eb.decode.bytes]}function xb(r,e,t=0){return Eb.encode(r,e,t),e}function Ab(r){return Eb.encodingLength(r)}function Ive(r,e){const t=e.byteLength,n=Ab(r),s=n+Ab(t),i=new Uint8Array(s+t);return xb(r,i,0),xb(t,i,n),i.set(e,s),new dP(r,t,e,i)}function MJ(r){const e=hP(r),[t,n]=VS(e),[s,i]=VS(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new dP(t,s,o,e)}function kve(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&eve(r.bytes,t.bytes)}}let dP=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function IM(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Pve(t,HS(r),e??Bl.encoder);default:return Nve(t,HS(r),e??hc.encoder)}}const kM=new WeakMap;function HS(r){const e=kM.get(r);if(e==null){const t=new Map;return kM.set(r,t),t}return e}var jz;let Tve=class En{constructor(e,t,n,s){h(this,"code");h(this,"version");h(this,"multihash");h(this,"bytes");h(this,"/");h(this,jz,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Wg)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Dve)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return En.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Ive(e,t);return En.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return En.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&kve(e.multihash,n.multihash)}toString(e){return IM(this,e)}toJSON(){return{"/":IM(this)}}link(){return this}[(jz=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof En)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new En(n,s,i,o??TM(n,s,i.bytes))}else if(t[Ove]===!0){const{version:n,multihash:s,code:i}=t,o=MJ(s);return En.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Wg)throw new Error(`Version 0 CID must use dag-pb (code: ${Wg}) block encoding`);return new En(e,t,n,n.bytes)}case 1:{const s=TM(e,t,n.bytes);return new En(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return En.create(0,Wg,e)}static createV1(e,t){return En.create(1,e,t)}static decode(e){const[t,n]=En.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=En.inspectBytes(e),n=t.size-t.multihashSize,s=hP(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new dP(t.multihashCode,t.digestSize,i,s);return[t.version===0?En.createV0(o):En.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=VS(e.subarray(t));return t+=p,d};let s=n(),i=Wg;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,s]=_ve(e,t),i=En.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return HS(i).set(n,e),i}};function _ve(r,e){switch(r[0]){case"Q":{const t=e??Bl;return[Bl.prefix,t.decode(`${Bl.prefix}${r}`)]}case Bl.prefix:{const t=e??Bl;return[Bl.prefix,t.decode(r)]}case hc.prefix:{const t=e??hc;return[hc.prefix,t.decode(r)]}case fE.prefix:{const t=e??fE;return[fE.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Pve(r,e,t){const{prefix:n}=t;if(n!==Bl.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s}function Nve(r,e,t){const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s}const Wg=112,Dve=18;function TM(r,e,t){const n=Ab(r),s=n+Ab(e),i=new Uint8Array(s+t.byteLength);return xb(r,i,0),xb(e,i,n),i.set(t,s),i}const Ove=Symbol.for("@ipld/js-cid/CID"),Rve=85;class Bve extends EQ{constructor(){super();h(this,"data");this.data=new Map}put(t,n){return this.data.set(hc.encode(t.multihash.bytes),n),t}get(t){const n=this.data.get(hc.encode(t.multihash.bytes));if(n==null)throw new Cy;return n}has(t){return this.data.has(hc.encode(t.multihash.bytes))}async delete(t){this.data.delete(hc.encode(t.multihash.bytes))}async*getAll(){for(const[t,n]of this.data.entries())yield{cid:Tve.createV1(Rve,MJ(hc.decode(t))),block:n}}}X1("blockstore:core:tiered");const Mve="SHARDING";function $ve(r){return r[Symbol.asyncIterator]!=null}function Sb(r){if($ve(r))return(async()=>{const t=[];for await(const n of r)t.push(n);return t})();const e=[];for(const t of r)e.push(t);return e}function Lve(r){return r[Symbol.asyncIterator]!=null}function _M(r,e){return Lve(r)?async function*(){yield*(await Sb(r)).sort(e)}():function*(){yield*Sb(r).sort(e)}()}class Uve{put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:s}of e)await this.put(n,s,t),yield n}async*getMany(e,t={}){for await(const n of e)yield{key:n,value:await this.get(n,t)}}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,s){e.push({key:n,value:s})},delete(n){t.push(n)},commit:async n=>{await Dc(this.putMany(e,n)),e=[],await Dc(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null){const s=e.prefix;n=kh(n,i=>i.key.toString().startsWith(s))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((s,i)=>kh(s,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((s,i)=>_M(s,i),n)),e.offset!=null){let s=0;const i=e.offset;n=kh(n,()=>s++>=i)}return e.limit!=null&&(n=R8(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null){const s=e.prefix;n=kh(n,i=>i.toString().startsWith(s))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((s,i)=>kh(s,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((s,i)=>_M(s,i),n)),e.offset!=null){const s=e.offset;let i=0;n=kh(n,()=>i++>=s)}return e.limit!=null&&(n=R8(n,e.limit)),n}}class $J extends Uve{constructor(){super();h(this,"data");this.data=new Map}put(t,n){return this.data.set(t.toString(),n),t}get(t){const n=this.data.get(t.toString());if(n==null)throw new Cy;return n}has(t){return this.data.has(t.toString())}delete(t){this.data.delete(t.toString())}*_all(){for(const[t,n]of this.data.entries())yield{key:new Dt(t),value:n}}*_allKeys(){for(const t of this.data.keys())yield new Dt(t)}}new Dt(Mve);X1("datastore:core:tiered");class Fve extends d3e{constructor(t){super({...t,components:{libp2p:t.libp2p}});h(this,"libp2p");this.libp2p=t.libp2p}async start(){await super.start(),await this.libp2p.start()}async stop(){await super.stop(),await this.libp2p.stop()}}let zve=class{constructor(){h(this,"readNext");h(this,"haveNext");h(this,"ended");h(this,"nextResult");h(this,"error");this.ended=!1,this.readNext=He(),this.haveNext=He()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=He(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=He(),await Vn(this.readNext.promise,t==null?void 0:t.signal,t)}};function Vve(){return new zve}let Hve=class extends Error{constructor(){super(...arguments);h(this,"name","UnexpectedEOFError");h(this,"code","ERR_UNEXPECTED_EOF")}};function Cb(r,e){const t=Vve();r.sink(t).catch(async o=>{await t.end(o)}),r.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());const s=new Ge;return{read:async o=>{var c;if((c=o==null?void 0:o.signal)==null||c.throwIfAborted(),(o==null?void 0:o.bytes)==null){const{done:l,value:u}=await Vn(n.next(),o==null?void 0:o.signal);return l===!0?null:u}for(;s.byteLength<o.bytes;){const{value:l,done:u}=await Vn(n.next(),o==null?void 0:o.signal);if(u===!0)throw new Hve("unexpected end of input");s.append(l)}const a=s.sublist(0,o.bytes);return s.consume(o.bytes),a},write:async(o,a)=>{var c;(c=a==null?void 0:a.signal)==null||c.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(s.byteLength>0){const o=r.source;r.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield s:yield*s,yield*o}()}return r}}}let Kve=class extends Error{constructor(){super(...arguments);h(this,"name","InvalidMessageLengthError");h(this,"code","ERR_INVALID_MSG_LENGTH")}},Gve=class extends Error{constructor(){super(...arguments);h(this,"name","InvalidDataLengthError");h(this,"code","ERR_MSG_DATA_TOO_LONG")}},jve=class extends Error{constructor(){super(...arguments);h(this,"name","InvalidDataLengthLengthError");h(this,"code","ERR_MSG_LENGTH_TOO_LONG")}};function h1(r,e={}){const t=Cb(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=kt(e.maxDataLength));const n=(e==null?void 0:e.lengthDecoder)??Po,s=(e==null?void 0:e.lengthEncoder)??Jr;return{read:async o=>{let a=-1;const c=new Ge;for(;;){c.append(await t.read({...o,bytes:1}));try{a=n(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new Kve("Invalid message length");if((e==null?void 0:e.maxLengthLength)!=null&&c.byteLength>e.maxLengthLength)throw new jve("message length length too long");if(a>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&a>e.maxDataLength)throw new Gve("message length too long");return t.read({...o,bytes:a})},write:async(o,a)=>{await t.write(new Ge(s(o.byteLength),o),a)},writeV:async(o,a)=>{const c=new Ge(...o.flatMap(l=>[s(l.byteLength),l]));await t.write(c,a)},unwrap:()=>t.unwrap()}}function PM(){const r=He();let e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,r.resolve(t)},source:async function*(){yield*await r.promise}()}}function qve(){const r=PM(),e=PM();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}const Py=65535,NM=Py-16;var qz,Wz;const Hm=!!((Wz=(qz=globalThis.process)==null?void 0:qz.env)!=null&&Wz.DUMP_SESSION_KEYS);function pE(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function LJ(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Hs(r,...e){if(!LJ(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function DM(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Wve(r,e){Hs(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function OM(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const _u=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),Qve=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Jve=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Jve)throw new Error("Non little-endian hardware is not supported");function Yve(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function KS(r){if(typeof r=="string")r=Yve(r);else if(LJ(r))r=GS(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function Xve(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function Zve(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}const e7e=(r,e)=>{function t(n,...s){if(Hs(n),r.nonceLength!==void 0){const u=s[0];if(!u)throw new Error("nonce / iv required");r.varSizeNonce?Hs(u):Hs(u,r.nonceLength)}const i=r.tagLength;i&&s[1]!==void 0&&Hs(s[1]);const o=e(n,...s),a=(u,d)=>{if(d!==void 0){if(u!==2)throw new Error("cipher output not supported");Hs(d)}};let c=!1;return{encrypt(u,d){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Hs(u),a(o.encrypt.length,d),o.encrypt(u,d)},decrypt(u,d){if(Hs(u),i&&u.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(o.decrypt.length,d),o.decrypt(u,d)}}}return Object.assign(t,r),t};function RM(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!t7e(e))throw new Error("invalid output, must be aligned");return e}function BM(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i),c=4,l=0;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function t7e(r){return r.byteOffset%4===0}function GS(r){return Uint8Array.from(r)}function d1(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}const UJ=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),r7e=UJ("expand 16-byte k"),n7e=UJ("expand 32-byte k"),s7e=_u(r7e),i7e=_u(n7e);function ft(r,e){return r<<e|r>>>32-e}function jS(r){return r.byteOffset%4===0}const c3=64,o7e=16,FJ=2**32-1,MM=new Uint32Array;function a7e(r,e,t,n,s,i,o,a){const c=s.length,l=new Uint8Array(c3),u=_u(l),d=jS(s)&&jS(i),p=d?_u(s):MM,y=d?_u(i):MM;for(let f=0;f<c;o++){if(r(e,t,n,u,o,a),o>=FJ)throw new Error("arx: counter overflow");const g=Math.min(c3,c-f);if(d&&g===c3){const w=f/4;if(f%4!==0)throw new Error("arx: invalid block position");for(let m=0,b;m<o7e;m++)b=w+m,y[b]=p[b]^u[m];f+=c3;continue}for(let w=0,m;w<g;w++)m=f+w,i[m]=s[m]^l[w];f+=g}}function c7e(r,e){const{allowShortKeys:t,extendNonceFn:n,counterLength:s,counterRight:i,rounds:o}=Xve({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return pE(s),pE(o),OM(i),OM(t),(a,c,l,u,d=0)=>{Hs(a),Hs(c),Hs(l);const p=l.length;if(u===void 0&&(u=new Uint8Array(p)),Hs(u),pE(d),d<0||d>=FJ)throw new Error("arx: counter overflow");if(u.length<p)throw new Error(`arx: output (${u.length}) is shorter than data (${p})`);const y=[];let f=a.length,g,w;if(f===32)y.push(g=GS(a)),w=i7e;else if(f===16&&t)g=new Uint8Array(32),g.set(a),g.set(a,16),w=s7e,y.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${f}`);jS(c)||y.push(c=GS(c));const m=_u(g);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(w,m,_u(c.subarray(0,16)),m),c=c.subarray(16)}const b=16-s;if(b!==c.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){const E=new Uint8Array(12);E.set(c,i?0:12-c.length),c=E,y.push(c)}const v=_u(c);return a7e(r,w,m,v,l,u,d,o),d1(...y),u}}const Ur=(r,e)=>r[e++]&255|(r[e++]&255)<<8;class l7e{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=KS(e),Hs(e,32);const t=Ur(e,0),n=Ur(e,2),s=Ur(e,4),i=Ur(e,6),o=Ur(e,8),a=Ur(e,10),c=Ur(e,12),l=Ur(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|s<<6)&7939,this.r[3]=(s>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Ur(e,16+2*u)}process(e,t,n=!1){const s=n?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],d=o[4],p=o[5],y=o[6],f=o[7],g=o[8],w=o[9],m=Ur(e,t+0),b=Ur(e,t+2),v=Ur(e,t+4),E=Ur(e,t+6),S=Ur(e,t+8),I=Ur(e,t+10),x=Ur(e,t+12),C=Ur(e,t+14);let P=i[0]+(m&8191),L=i[1]+((m>>>13|b<<3)&8191),K=i[2]+((b>>>10|v<<6)&8191),V=i[3]+((v>>>7|E<<9)&8191),Z=i[4]+((E>>>4|S<<12)&8191),Y=i[5]+(S>>>1&8191),U=i[6]+((S>>>14|I<<2)&8191),H=i[7]+((I>>>11|x<<5)&8191),G=i[8]+((x>>>8|C<<8)&8191),$=i[9]+(C>>>5|s),z=0,W=z+P*a+L*(5*w)+K*(5*g)+V*(5*f)+Z*(5*y);z=W>>>13,W&=8191,W+=Y*(5*p)+U*(5*d)+H*(5*u)+G*(5*l)+$*(5*c),z+=W>>>13,W&=8191;let ee=z+P*c+L*a+K*(5*w)+V*(5*g)+Z*(5*f);z=ee>>>13,ee&=8191,ee+=Y*(5*y)+U*(5*p)+H*(5*d)+G*(5*u)+$*(5*l),z+=ee>>>13,ee&=8191;let J=z+P*l+L*c+K*a+V*(5*w)+Z*(5*g);z=J>>>13,J&=8191,J+=Y*(5*f)+U*(5*y)+H*(5*p)+G*(5*d)+$*(5*u),z+=J>>>13,J&=8191;let le=z+P*u+L*l+K*c+V*a+Z*(5*w);z=le>>>13,le&=8191,le+=Y*(5*g)+U*(5*f)+H*(5*y)+G*(5*p)+$*(5*d),z+=le>>>13,le&=8191;let ye=z+P*d+L*u+K*l+V*c+Z*a;z=ye>>>13,ye&=8191,ye+=Y*(5*w)+U*(5*g)+H*(5*f)+G*(5*y)+$*(5*p),z+=ye>>>13,ye&=8191;let de=z+P*p+L*d+K*u+V*l+Z*c;z=de>>>13,de&=8191,de+=Y*a+U*(5*w)+H*(5*g)+G*(5*f)+$*(5*y),z+=de>>>13,de&=8191;let fe=z+P*y+L*p+K*d+V*u+Z*l;z=fe>>>13,fe&=8191,fe+=Y*c+U*a+H*(5*w)+G*(5*g)+$*(5*f),z+=fe>>>13,fe&=8191;let De=z+P*f+L*y+K*p+V*d+Z*u;z=De>>>13,De&=8191,De+=Y*l+U*c+H*a+G*(5*w)+$*(5*g),z+=De>>>13,De&=8191;let $e=z+P*g+L*f+K*y+V*p+Z*d;z=$e>>>13,$e&=8191,$e+=Y*u+U*l+H*c+G*a+$*(5*w),z+=$e>>>13,$e&=8191;let qe=z+P*w+L*g+K*f+V*y+Z*p;z=qe>>>13,qe&=8191,qe+=Y*d+U*u+H*l+G*c+$*a,z+=qe>>>13,qe&=8191,z=(z<<2)+z|0,z=z+W|0,W=z&8191,z=z>>>13,ee+=z,i[0]=W,i[1]=ee,i[2]=J,i[3]=le,i[4]=ye,i[5]=de,i[6]=fe,i[7]=De,i[8]=$e,i[9]=qe}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,n[0]=e[0]+5,s=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+s,s=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(s^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;d1(n)}update(e){DM(this);const{buffer:t,blockLen:n}=this;e=KS(e);const s=e.length;for(let i=0;i<s;){const o=Math.min(n-this.pos,s-i);if(o===n){for(;n<=s-i;i+=n)this.process(e,i);continue}t.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){d1(this.h,this.r,this.buffer,this.pad)}digestInto(e){DM(this),Wve(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:s}=this;if(s){for(t[s++]=1;s<16;s++)t[s]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=n[o]>>>0,e[i++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}function u7e(r){const e=(n,s)=>r(s).update(KS(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}const h7e=u7e(r=>new l7e(r));function d7e(r,e,t,n,s,i=20){let o=r[0],a=r[1],c=r[2],l=r[3],u=e[0],d=e[1],p=e[2],y=e[3],f=e[4],g=e[5],w=e[6],m=e[7],b=s,v=t[0],E=t[1],S=t[2],I=o,x=a,C=c,P=l,L=u,K=d,V=p,Z=y,Y=f,U=g,H=w,G=m,$=b,z=v,W=E,ee=S;for(let le=0;le<i;le+=2)I=I+L|0,$=ft($^I,16),Y=Y+$|0,L=ft(L^Y,12),I=I+L|0,$=ft($^I,8),Y=Y+$|0,L=ft(L^Y,7),x=x+K|0,z=ft(z^x,16),U=U+z|0,K=ft(K^U,12),x=x+K|0,z=ft(z^x,8),U=U+z|0,K=ft(K^U,7),C=C+V|0,W=ft(W^C,16),H=H+W|0,V=ft(V^H,12),C=C+V|0,W=ft(W^C,8),H=H+W|0,V=ft(V^H,7),P=P+Z|0,ee=ft(ee^P,16),G=G+ee|0,Z=ft(Z^G,12),P=P+Z|0,ee=ft(ee^P,8),G=G+ee|0,Z=ft(Z^G,7),I=I+K|0,ee=ft(ee^I,16),H=H+ee|0,K=ft(K^H,12),I=I+K|0,ee=ft(ee^I,8),H=H+ee|0,K=ft(K^H,7),x=x+V|0,$=ft($^x,16),G=G+$|0,V=ft(V^G,12),x=x+V|0,$=ft($^x,8),G=G+$|0,V=ft(V^G,7),C=C+Z|0,z=ft(z^C,16),Y=Y+z|0,Z=ft(Z^Y,12),C=C+Z|0,z=ft(z^C,8),Y=Y+z|0,Z=ft(Z^Y,7),P=P+L|0,W=ft(W^P,16),U=U+W|0,L=ft(L^U,12),P=P+L|0,W=ft(W^P,8),U=U+W|0,L=ft(L^U,7);let J=0;n[J++]=o+I|0,n[J++]=a+x|0,n[J++]=c+C|0,n[J++]=l+P|0,n[J++]=u+L|0,n[J++]=d+K|0,n[J++]=p+V|0,n[J++]=y+Z|0,n[J++]=f+Y|0,n[J++]=g+U|0,n[J++]=w+H|0,n[J++]=m+G|0,n[J++]=b+$|0,n[J++]=v+z|0,n[J++]=E+W|0,n[J++]=S+ee|0}const f7e=c7e(d7e,{counterRight:!1,counterLength:4,allowShortKeys:!1}),p7e=new Uint8Array(16),$M=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(p7e.subarray(t))},g7e=new Uint8Array(32);function LM(r,e,t,n,s){const i=r(e,t,g7e),o=h7e.create(i);s&&$M(o,s),$M(o,n);const a=new Uint8Array(16),c=Qve(a);BM(c,0,BigInt(s?s.length:0),!0),BM(c,8,BigInt(n.length),!0),o.update(a);const l=o.digest();return d1(i,a),l}const y7e=r=>(e,t,n)=>({encrypt(i,o){const a=i.length;o=RM(a+16,o,!1),o.set(i);const c=o.subarray(0,-16);r(e,t,c,c,1);const l=LM(r,e,t,c,n);return o.set(l,a),d1(l),o},decrypt(i,o){o=RM(i.length-16,o,!1);const a=i.subarray(0,-16),c=i.subarray(-16),l=LM(r,e,t,a,n);if(!Zve(c,l))throw new Error("invalid tag");return o.set(i.subarray(0,-16)),r(e,t,o,o,1),d1(l),o}}),UM=e7e({blockSize:64,nonceLength:12,tagLength:16},y7e(f7e));function m7e(r,e,t){return Q5(r),t===void 0&&(t=new Uint8Array(r.outputLen)),tv(r,vy(t),vy(e))}const gE=Uint8Array.from([0]),FM=Uint8Array.of();function w7e(r,e,t,n=32){Q5(r),Lp(n);const s=r.outputLen;if(n>255*s)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(n/s);t===void 0&&(t=FM);const o=new Uint8Array(i*s),a=tv.create(r,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<i;u++)gE[0]=u+1,c.update(u===0?FM:l).update(t).update(gE).digestInto(l),o.set(l,s*u),a._cloneInto(c);return a.destroy(),c.destroy(),wa(l,gE),o.slice(0,n)}const b7e={hashSHA256(r){return _d(r.subarray())},getHKDF(r,e){const t=m7e(_d,e,r),s=w7e(_d,t,void 0,96),i=s.subarray(0,32),o=s.subarray(32,64),a=s.subarray(64,96);return[i,o,a]},generateX25519KeyPair(){const r=qw.utils.randomPrivateKey();return{publicKey:qw.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:qw.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,e){return qw.getSharedSecret(r.subarray(),e.subarray())},chaCha20Poly1305Encrypt(r,e,t,n){return UM(n,e,t).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,e,t,n,s){return UM(n,e,t).decrypt(r.subarray(),s)}},v7e=b7e;function E7e(r){return{generateKeypair:r.generateX25519KeyPair,dh:(e,t)=>r.generateX25519SharedKey(e.privateKey,t).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}const Ib=r=>{const e=Ss(2);return e[0]=r>>8,e[1]=r,e};Ib.bytes=2;const y4=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let e=0;return e+=r[0]<<8,e+=r[1],e}return r.getUint16(0)};y4.bytes=2;function x7e(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function zJ(r,e){!e.enabled||!Hm||(r?(e(`LOCAL_STATIC_PUBLIC_KEY ${ce(r.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${ce(r.privateKey,"hex")}`)):e("Missing local static keys."))}function VJ(r,e){!e.enabled||!Hm||(r?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${ce(r.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${ce(r.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function A7e(r,e){!e.enabled||!Hm||e(r?`REMOTE_STATIC_PUBLIC_KEY ${ce(r.subarray(),"hex")}`:"Missing remote static public key.")}function HJ(r,e){!e.enabled||!Hm||e(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${ce(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function KJ(r,e,t){!t.enabled||!Hm||(t(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&ce(r.k,"hex")}`),t(`CIPHER_STATE_2 ${e.n.getUint64()} ${e.k&&ce(e.k,"hex")}`))}function Ku(r,e){if(r.length!==e.length)throw new Error("Inputs should have the same length");const t=Ss(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return t}const q6=class q6 extends Error{constructor(t="Invalid crypto exchange"){super(t);h(this,"code");this.code=q6.code}};h(q6,"code","ERR_INVALID_CRYPTO_EXCHANGE");let O2=q6;const S7e=0,C7e=4294967295,I7e="Cipherstate has reached maximum n, a new handshake must be performed";class k7e{constructor(e=S7e){h(this,"n");h(this,"bytes");h(this,"view");this.n=e,this.bytes=it(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>C7e)throw new Error(I7e)}}const zp=it(0);class l3{constructor(e,t=void 0,n=0){h(this,"k");h(this,"n");h(this,"crypto");this.crypto=e,this.k=t,this.n=new k7e(n)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();const n=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),n}decryptWithAd(e,t,n){if(!this.hasKey())return t;this.n.assertValue();const s=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,n);return this.n.increment(),s}}class T7e{constructor(e,t){h(this,"cs");h(this,"ck");h(this,"h");h(this,"crypto");this.crypto=e;const n=he(t,"utf-8");this.h=P7e(e,n),this.ck=this.h,this.cs=new l3(e)}mixKey(e){const[t,n]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new l3(this.crypto,n)}mixHash(e){this.h=this.crypto.hash(new Ge(this.h,e))}encryptAndHash(e){const t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){const t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){const[e,t]=this.crypto.hkdf(this.ck,zp);return[new l3(this.crypto,e),new l3(this.crypto,t)]}}class _7e{constructor(e){h(this,"ss");h(this,"s");h(this,"e");h(this,"rs");h(this,"re");h(this,"initiator");h(this,"crypto");const{crypto:t,protocolName:n,prologue:s,initiator:i,s:o,e:a,rs:c,re:l}=e;this.crypto=t,this.ss=new T7e(t,n),this.ss.mixHash(s),this.initiator=i,this.s=o,this.e=a,this.rs=c,this.re=l}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");const e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw new Error("remote static public key is already set");const n=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+n)throw new Error("message is not long enough");const s=e.sublist(t,t+n);return this.rs=this.ss.decryptAndHash(s),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class GJ extends _7e{writeMessageA(e){return new Ge(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){const t=this.writeE();this.writeEE();const n=this.writeS();return this.writeES(),new Ge(t,n,this.ss.encryptAndHash(e))}writeMessageC(e){const t=this.writeS();return this.writeSE(),new Ge(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(t){throw new O2(`handshake stage 0 validation fail: ${t.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();const t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(t){throw new O2(`handshake stage 1 validation fail: ${t.message}`)}}readMessageC(e){try{const t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(t){throw new O2(`handshake stage 2 validation fail: ${t.message}`)}}}function P7e(r,e){if(e.length<=32){const t=it(32);return t.set(e),t}else return r.hash(e)}var kb;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(const i of t.webtransportCerthashes)n.uint32(10),n.bytes(i);if(t.streamMuxers!=null)for(const i of t.streamMuxers)n.uint32(18),n.string(i);s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{var a,c;const i={webtransportCerthashes:[],streamMuxers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{if(((a=s.limits)==null?void 0:a.webtransportCerthashes)!=null&&i.webtransportCerthashes.length===s.limits.webtransportCerthashes)throw new It('Decode error - map field "webtransportCerthashes" had too many elements');i.webtransportCerthashes.push(t.bytes());break}case 2:{if(((c=s.limits)==null?void 0:c.streamMuxers)!=null&&i.streamMuxers.length===s.limits.streamMuxers)throw new It('Decode error - map field "streamMuxers" had too many elements');i.streamMuxers.push(t.string());break}default:{t.skipType(l&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(kb||(kb={}));var Tb;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.identityKey!=null&&t.identityKey.byteLength>0&&(n.uint32(10),n.bytes(t.identityKey)),t.identitySig!=null&&t.identitySig.byteLength>0&&(n.uint32(18),n.bytes(t.identitySig)),t.extensions!=null&&(n.uint32(34),kb.codec().encode(t.extensions,n)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{var a;const i={identityKey:it(0),identitySig:it(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{i.identityKey=t.bytes();break}case 2:{i.identitySig=t.bytes();break}case 4:{i.extensions=kb.codec().decode(t,t.uint32(),{limits:(a=s.limits)==null?void 0:a.extensions});break}default:{t.skipType(c&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(Tb||(Tb={}));async function jJ(r,e,t){const n=await r.sign(WJ(e));return Tb.encode({identityKey:$i(r.publicKey),identitySig:n,extensions:t})}async function qJ(r,e,t){try{const n=Tb.decode(r),s=Is(n.identityKey);if((t==null?void 0:t.equals(s))===!1)throw new Error(`Payload identity key ${s} does not match expected remote identity key ${t}`);if(!e)throw new Error("Remote static does not exist");const i=WJ(e);if(!await s.verify(i,n.identitySig))throw new Error("Invalid payload signature");return n}catch(n){throw new Pj(n.message)}}function WJ(r){const e=he("noise-libp2p-static-key:");return r instanceof Uint8Array?Cr([e,r],e.length+r.length):(r.prepend(e),r)}async function N7e(r,e){const{log:t,connection:n,crypto:s,privateKey:i,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=r,u=await jJ(i,a.publicKey,l),d=new GJ({crypto:s,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:o,s:a});zJ(d.s,t),t.trace("Stage 0 - Initiator starting to send first message."),await n.write(d.writeMessageA(zp),e),t.trace("Stage 0 - Initiator finished sending first message."),VJ(d.e,t),t.trace("Stage 1 - Initiator waiting to receive first message from responder...");const p=d.readMessageB(await n.read(e));t.trace("Stage 1 - Initiator received the message."),HJ(d.re,t),A7e(d.rs,t),t.trace("Initiator going to check remote's signature...");const y=await qJ(p,d.rs,c);t.trace("All good with the signature!"),t.trace("Stage 2 - Initiator sending third handshake message."),await n.write(d.writeMessageC(u),e),t.trace("Stage 2 - Initiator sent message with signed payload.");const[f,g]=d.ss.split();return KJ(f,g,t),{payload:y,encrypt:w=>f.encryptWithAd(zp,w),decrypt:(w,m)=>g.decryptWithAd(zp,w,m)}}async function D7e(r,e){const{log:t,connection:n,crypto:s,privateKey:i,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=r,u=await jJ(i,a.publicKey,l),d=new GJ({crypto:s,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:o,s:a});zJ(d.s,t),t.trace("Stage 0 - Responder waiting to receive first message."),d.readMessageA(await n.read(e)),t.trace("Stage 0 - Responder received first message."),HJ(d.re,t),t.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(d.writeMessageB(u),e),t.trace("Stage 1 - Responder sent the second handshake message with signed payload."),VJ(d.e,t),t.trace("Stage 2 - Responder waiting for third handshake message...");const p=d.readMessageC(await n.read(e));t.trace("Stage 2 - Responder received the message, finished handshake.");const y=await qJ(p,d.rs,c),[f,g]=d.ss.split();return KJ(f,g,t),{payload:y,encrypt:w=>g.encryptWithAd(zp,w),decrypt:(w,m)=>f.decryptWithAd(zp,w,m)}}const zM=16;function O7e(r,e){return async function*(t){for await(const n of t)for(let s=0;s<n.length;s+=NM){let i=s+NM;i>n.length&&(i=n.length);let o;n instanceof Uint8Array?o=r.encrypt(n.subarray(s,i)):o=r.encrypt(n.sublist(s,i)),e==null||e.encryptedPackets.increment(),yield new Ge(Ib(o.byteLength),o)}}}function R7e(r,e){return async function*(t){for await(const n of t)for(let s=0;s<n.length;s+=Py){let i=s+Py;if(i>n.length&&(i=n.length),i-zM<s)throw new Error("Invalid chunk");const o=n.sublist(s,i),a=n.subarray(s,i-zM);try{const c=r.decrypt(o,a);e==null||e.decryptedPackets.increment(),yield c}catch(c){throw e==null||e.decryptErrors.increment(),c}}}}var Qz,Jz;Jz=Symbol.toStringTag,Qz=Lr;class B7e{constructor(e,t={}){h(this,"protocol","/noise");h(this,"crypto");h(this,"prologue");h(this,"staticKey");h(this,"extensions");h(this,"metrics");h(this,"components");h(this,Jz,"@chainsafe/libp2p-noise");h(this,Qz,["@libp2p/connection-encryption","@chainsafe/libp2p-noise"]);const{staticNoiseKey:n,extensions:s,crypto:i,prologueBytes:o}=t,{metrics:a}=e;this.components=e;const c=i??v7e;this.crypto=E7e(c),this.extensions={webtransportCerthashes:[],...s},this.metrics=a?x7e(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=o??it(0)}async secureOutbound(e,t){var a,c;const n=h1(e,{lengthEncoder:Ib,lengthDecoder:y4,maxDataLength:Py}),s=await this.performHandshakeInitiator(n,this.components.privateKey,(a=t==null?void 0:t.remotePeer)==null?void 0:a.publicKey,t),i=await this.createSecureConnection(n,s);e.source=i.source,e.sink=i.sink;const o=Is(s.payload.identityKey);return{conn:e,remoteExtensions:s.payload.extensions,remotePeer:i1(o),streamMuxer:this.getStreamMuxer((c=s.payload.extensions)==null?void 0:c.streamMuxers)}}getStreamMuxer(e){if(e==null)return;const t=this.components.upgrader.getStreamMuxers();if(t!=null)for(const n of e){const s=t.get(n);if(s!=null)return s}if(e.length)throw new sue("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(e,t){var a,c;const n=h1(e,{lengthEncoder:Ib,lengthDecoder:y4,maxDataLength:Py}),s=await this.performHandshakeResponder(n,this.components.privateKey,(a=t==null?void 0:t.remotePeer)==null?void 0:a.publicKey,t),i=await this.createSecureConnection(n,s);e.source=i.source,e.sink=i.sink;const o=Is(s.payload.identityKey);return{conn:e,remoteExtensions:s.payload.extensions,remotePeer:i1(o),streamMuxer:this.getStreamMuxer((c=s.payload.extensions)==null?void 0:c.streamMuxers)}}async performHandshakeInitiator(e,t,n,s){var o,a;let i;try{i=await N7e({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},s),(o=this.metrics)==null||o.xxHandshakeSuccesses.increment()}catch(c){throw(a=this.metrics)==null||a.xxHandshakeErrors.increment(),c}return i}async performHandshakeResponder(e,t,n,s){var o,a;let i;try{i=await D7e({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},s),(o=this.metrics)==null||o.xxHandshakeSuccesses.increment()}catch(c){throw(a=this.metrics)==null||a.xxHandshakeErrors.increment(),c}return i}async createSecureConnection(e,t){const[n,s]=qve(),i=e.unwrap();return await Jn(n,O7e(t,this.metrics),i,o=>s1(o,{lengthDecoder:y4}),R7e(t,this.metrics),n),s}}function QJ(r={}){return e=>new B7e(e,r)}function JJ(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}class Gh extends Error{constructor(e="The frame was invalid"){super(e),this.name="InvalidFrameError"}}h(Gh,"name","InvalidFrameError");class fP extends Error{constructor(e="Unrequested ping error"){super(e),this.name="UnrequestedPingError"}}h(fP,"name","UnrequestedPingError");class pP extends Error{constructor(e="Unrequested ping error"){super(e),this.name="NotMatchingPingError"}}h(pP,"name","NotMatchingPingError");class YJ extends Error{constructor(e="Invalid state"){super(e),this.name="InvalidStateError"}}h(YJ,"name","InvalidStateError");class XJ extends Error{constructor(e="Strean already exists"){super(e),this.name="StreamAlreadyExistsError"}}h(XJ,"name","StreamAlreadyExistsError");class ZJ extends Error{constructor(e="Decode invalid version"){super(e),this.name="DecodeInvalidVersionError"}}h(ZJ,"name","DecodeInvalidVersionError");class eY extends Error{constructor(e="Both clients"){super(e),this.name="BothClientsError"}}h(eY,"name","BothClientsError");class gP extends Error{constructor(e="Receive window exceeded"){super(e),this.name="ReceiveWindowExceededError"}}h(gP,"name","ReceiveWindowExceededError");const M7e=new Set([Gh.name,fP.name,pP.name,XJ.name,ZJ.name,eY.name,gP.name]),yP=256*1024,$7e=16*1024*1024,L7e={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:yP,maxStreamWindowSize:$7e,maxMessageSize:64*1024};function U7e(r){if(r.keepAliveInterval<=0)throw new ie("keep-alive interval must be positive");if(r.maxInboundStreams<0)throw new ie("max inbound streams must be larger or equal 0");if(r.maxOutboundStreams<0)throw new ie("max outbound streams must be larger or equal 0");if(r.initialStreamWindowSize<yP)throw new ie("InitialStreamWindowSize must be larger or equal 256 kB");if(r.maxStreamWindowSize<r.initialStreamWindowSize)throw new ie("MaxStreamWindowSize must be larger than the InitialStreamWindowSize");if(r.maxStreamWindowSize>2**32-1)throw new ie("MaxStreamWindowSize must be less than equal MAX_UINT32");if(r.maxMessageSize<1024)throw new ie("MaxMessageSize must be greater than a kilobyte")}var xr;(function(r){r[r.Data=0]="Data",r[r.WindowUpdate=1]="WindowUpdate",r[r.Ping=2]="Ping",r[r.GoAway=3]="GoAway"})(xr||(xr={}));var nr;(function(r){r[r.SYN=1]="SYN",r[r.ACK=2]="ACK",r[r.FIN=4]="FIN",r[r.RST=8]="RST"})(nr||(nr={}));Object.values(nr).filter(r=>typeof r!="string");const F7e=0;var jo;(function(r){r[r.NormalTermination=0]="NormalTermination",r[r.ProtocolError=1]="ProtocolError",r[r.InternalError=2]="InternalError"})(jo||(jo={}));const R2=12,VM=2**24;function z7e(r){if(r[0]!==F7e)throw new Gh("Invalid frame version");return{type:r[1],flag:(r[2]<<8)+r[3],streamID:r[4]*VM+(r[5]<<16)+(r[6]<<8)+r[7],length:r[8]*VM+(r[9]<<16)+(r[10]<<8)+r[11]}}let V7e=class{constructor(e){h(this,"source");h(this,"buffer");h(this,"frameInProgress");this.source=H7e(e),this.buffer=new Ge,this.frameInProgress=!1}async*emitFrames(){for await(const e of this.source)for(this.buffer.append(e);;){const t=this.readHeader();if(t===void 0)break;const{type:n,length:s}=t;n===xr.Data?(this.frameInProgress=!0,yield{header:t,readData:this.readBytes.bind(this,s)}):yield{header:t}}}readHeader(){if(this.frameInProgress)throw new YJ("decoding frame already in progress");if(this.buffer.length<R2)return;const e=z7e(this.buffer.subarray(0,R2));return this.buffer.consume(R2),e}async readBytes(e){if(this.buffer.length<e){for await(const n of this.source)if(this.buffer.append(n),this.buffer.length>=e)break}const t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}};function H7e(r){if(r[Symbol.iterator]!==void 0){const e=r[Symbol.iterator]();return e.return=void 0,{[Symbol.iterator](){return e}}}else if(r[Symbol.asyncIterator]!==void 0){const e=r[Symbol.asyncIterator]();return e.return=void 0,{[Symbol.asyncIterator](){return e}}}else throw new Error("a source must be either an iterable or an async iterable")}function HM(r){const e=new Uint8Array(R2);return e[1]=r.type,e[2]=r.flag>>>8,e[3]=r.flag,e[4]=r.streamID>>>24,e[5]=r.streamID>>>16,e[6]=r.streamID>>>8,e[7]=r.streamID,e[8]=r.length>>>24,e[9]=r.length>>>16,e[10]=r.length>>>8,e[11]=r.length,e}function K7e(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function tY(r,e){var n,s;const t=(s=(n=JJ(r)).return)==null?void 0:s.call(n);K7e(t)&&t.catch(i=>{e.error("could not cause iterator to return",i)})}const G7e=5e3;function yE(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}class mP{constructor(e){h(this,"id");h(this,"direction");h(this,"timeline");h(this,"protocol");h(this,"metadata");h(this,"source");h(this,"status");h(this,"readStatus");h(this,"writeStatus");h(this,"log");h(this,"sinkController");h(this,"sinkEnd");h(this,"closed");h(this,"endErr");h(this,"streamSource");h(this,"onEnd");h(this,"onCloseRead");h(this,"onCloseWrite");h(this,"onReset");h(this,"onAbort");h(this,"sendCloseWriteTimeout");h(this,"sendingData");this.sinkController=new AbortController,this.sinkEnd=He(),this.closed=He(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??G7e,this.onEnd=e.onEnd,this.onCloseRead=e==null?void 0:e.onCloseRead,this.onCloseWrite=e==null?void 0:e.onCloseWrite,this.onReset=e==null?void 0:e.onReset,this.onAbort=e==null?void 0:e.onAbort,this.source=this.streamSource=Nc({onEnd:t=>{t!=null?this.log.trace("source ended with error",t):this.log.trace("source ended"),this.onSourceEnd(t)}}),this.sink=this.sink.bind(this)}async sink(e){if(this.writeStatus!=="ready")throw new x8(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";const t={signal:this.sinkController.signal};if(this.direction==="outbound"){const s=this.sendNewStream(t);yE(s)&&await s}const n=()=>{tY(e,this.log)};try{this.sinkController.signal.addEventListener("abort",n),this.log.trace("sink reading from source");for await(let s of e){s=s instanceof Uint8Array?new Ge(s):s;const i=this.sendData(s,t);yE(i)&&(this.sendingData=He(),await i,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",n)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(t){throw this.log.trace("sink ended with error, calling abort with error",t),this.abort(t),t}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){var t;this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(t=this.onCloseRead)==null||t.call(this),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){var t;this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(t=this.onCloseWrite)==null||t.call(this),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.status==="open"&&(this.log.trace("closing gracefully"),this.status="closing",await Vn(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e==null?void 0:e.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(e={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const t=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),t==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(e={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),await Vn(this.sink([]),e.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&await Vn(this.sendingData.promise,e.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await Vn(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){var n;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",e),this.log("try to send reset to remote");const t=this.sendReset();yE(t)&&t.catch(s=>{this.log.error("error sending reset message",s)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),(n=this.onAbort)==null||n.call(this,e)}reset(){var t;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;const e=new Dj("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),(t=this.onReset)==null||t.call(this)}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}var ho;(function(r){r[r.Init=0]="Init",r[r.SYNSent=1]="SYNSent",r[r.SYNReceived=2]="SYNReceived",r[r.Established=3]="Established",r[r.Finished=4]="Finished"})(ho||(ho={}));class j7e extends mP{constructor(t){super({...t,onEnd:n=>{var s;this.state=ho.Finished,(s=t.onEnd)==null||s.call(t,n)}});h(this,"name");h(this,"state");h(this,"config");h(this,"_id");h(this,"sendWindowCapacity");h(this,"sendWindowCapacityUpdate");h(this,"recvWindow");h(this,"recvWindowCapacity");h(this,"epochStart");h(this,"getRTT");h(this,"sendFrame");this.config=t.config,this._id=parseInt(t.id,10),this.name=t.name,this.state=t.state,this.sendWindowCapacity=yP,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=t.getRTT,this.sendFrame=t.sendFrame,this.source=nb(this.source,()=>{this.sendWindowUpdate()})}async sendNewStream(){}async sendData(t,n={}){var s,i;for(t=t.sublist();t.byteLength!==0;){if(this.sendWindowCapacity===0&&((s=this.log)==null||s.trace("wait for send window capacity, status %s",this.status),await this.waitForSendWindowCapacity(n),this.status==="closed"||this.status==="aborted"||this.status==="reset")){(i=this.log)==null||i.trace("%s while waiting for send window capacity",this.status);return}const o=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-R2,t.length),a=this.getSendFlags();this.sendFrame({type:xr.Data,flag:a,streamID:this._id,length:o},t.sublist(0,o)),this.sendWindowCapacity-=o,t.consume(o)}}async sendReset(){this.sendFrame({type:xr.WindowUpdate,flag:nr.RST,streamID:this._id,length:0})}async sendCloseWrite(){const t=this.getSendFlags()|nr.FIN;this.sendFrame({type:xr.WindowUpdate,flag:t,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(t={}){var o,a;if(this.sendWindowCapacity>0)return;let n,s;const i=()=>{this.status==="open"||this.status==="closing"?s(new Vd("Stream aborted")):n()};(o=t.signal)==null||o.addEventListener("abort",i);try{await new Promise((c,l)=>{this.sendWindowCapacityUpdate=()=>{c()},s=l,n=c})}finally{(a=t.signal)==null||a.removeEventListener("abort",i)}}handleWindowUpdate(t){var s,i;(s=this.log)==null||s.trace("stream received window update id=%s",this._id),this.processFlags(t.flag);const n=this.sendWindowCapacity;this.sendWindowCapacity+=t.length,n===0&&t.length>0&&((i=this.sendWindowCapacityUpdate)==null||i.call(this))}async handleData(t,n){var i;if((i=this.log)==null||i.trace("stream received data id=%s",this._id),this.processFlags(t.flag),this.recvWindowCapacity<t.length)throw new gP("Receive window exceeded");const s=await n();this.recvWindowCapacity-=t.length,this.sourcePush(s)}processFlags(t){(t&nr.ACK)===nr.ACK&&this.state===ho.SYNSent&&(this.state=ho.Established),(t&nr.FIN)===nr.FIN&&this.remoteCloseWrite(),(t&nr.RST)===nr.RST&&this.reset()}getSendFlags(){switch(this.state){case ho.Init:return this.state=ho.SYNSent,nr.SYN;case ho.SYNReceived:return this.state=ho.Established,nr.ACK;default:return 0}}sendWindowUpdate(){const t=this.getSendFlags(),n=Date.now(),s=this.getRTT();if(t===0&&s>-1&&n-this.epochStart<s*4&&(this.recvWindow=Math.min(this.recvWindow*2,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&t===0)return;const i=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=n,this.sendFrame({type:xr.WindowUpdate,flag:t,streamID:this._id,length:i})}}const rY="/yamux/1.0.0",q7e=500;var Yz,Xz;Xz=Symbol.toStringTag,Yz=Lr;class W7e{constructor(e,t={}){h(this,"protocol",rY);h(this,"_components");h(this,"_init");h(this,Xz,"@chainsafe/libp2p-yamux");h(this,Yz,["@libp2p/stream-multiplexing"]);this._components=e,this._init=t}createStreamMuxer(e){return new Q7e(this._components,{...this._init,...e})}}class Q7e{constructor(e,t){h(this,"protocol",rY);h(this,"source");h(this,"sink");h(this,"config");h(this,"log");h(this,"logger");h(this,"closeController");h(this,"nextStreamID");h(this,"_streams");h(this,"nextPingID");h(this,"activePing");h(this,"rtt");h(this,"client");h(this,"localGoAway");h(this,"remoteGoAway");h(this,"numInboundStreams");h(this,"numOutboundStreams");h(this,"onIncomingStream");h(this,"onStreamEnd");var n;this.client=t.direction==="outbound",this.config={...L7e,...t},this.logger=e.logger,this.log=this.logger.forComponent("libp2p:yamux"),U7e(this.config),this.closeController=new AbortController,this.closeController.signal,this.onIncomingStream=t.onIncomingStream,this.onStreamEnd=t.onStreamEnd,this._streams=new Map,this.source=Nc({onEnd:()=>{var s;(s=this.log)==null||s.trace("muxer source ended"),this._streams.forEach(i=>{i.destroy()})}}),this.sink=async s=>{var c,l,u;const i=()=>{const d=JJ(s);if(d.return!=null){const p=d.return();J7e(p)&&p.catch(y=>{var f;(f=this.log)==null||f.call(this,"could not cause sink source to return",y)})}};let o,a;try{const d=new V7e(s);try{this.closeController.signal.addEventListener("abort",i);for await(const p of d.emitFrames())await this.handleFrame(p.header,p.readData)}finally{this.closeController.signal.removeEventListener("abort",i)}o=jo.NormalTermination}catch(d){M7e.has(d.name)?((c=this.log)==null||c.error("protocol error in sink",d),o=jo.ProtocolError):((l=this.log)==null||l.error("internal error in sink",d),o=jo.InternalError),a=d}(u=this.log)==null||u.trace("muxer sink ended"),a!=null?this.abort(a,o):await this.close({reason:o})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,(n=this.log)==null||n.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(s=>{var i;return(i=this.log)==null?void 0:i.error("keepalive error: %s",s)}),this.ping().catch(s=>{var i;return(i=this.log)==null?void 0:i.error("ping error: %s",s)})}get streams(){return Array.from(this._streams.values())}newStream(e){var s;if(this.remoteGoAway!==void 0)throw new Ph("Muxer closed remotely");if(this.localGoAway!==void 0)throw new Ph("Muxer closed locally");const t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new F5("max outbound streams exceeded");(s=this.log)==null||s.trace("new outgoing stream id=%s",t);const n=this._newStream(t,e,ho.Init,"outbound");return this._streams.set(t,n),this.numOutboundStreams++,n.sendWindowUpdate(),n}async ping(){if(this.remoteGoAway!==void 0)throw new Ph("Muxer closed remotely");if(this.localGoAway!==void 0)throw new Ph("Muxer closed locally");if(this.activePing===void 0){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((s,i)=>{const o=()=>{i(new Ph("Muxer closed locally"))};this.closeController.signal.addEventListener("abort",o,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",o),s()}}),resolve:e};const t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const n=Date.now();this.rtt=n-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(e={}){var n;if(this.closeController.signal.aborted)return;const t=(e==null?void 0:e.reason)??jo.NormalTermination;if((n=this.log)==null||n.trace("muxer close reason=%s",t),e.signal==null){const s=AbortSignal.timeout(q7e);e={...e,signal:s}}try{await Promise.all([...this._streams.values()].map(async s=>s.close(e))),this.sendGoAway(t),this._closeMuxer()}catch(s){this.abort(s)}}abort(e,t){var n;if(!this.closeController.signal.aborted){t=t??jo.InternalError,(n=this.log)==null||n.error("muxer abort reason=%s error=%s",t,e);for(const s of this._streams.values())s.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,n,s){if(this._streams.get(e)!=null)throw new ie("Stream already exists with that id");const i=new j7e({id:e.toString(),name:t,state:n,direction:s,sendFrame:this.sendFrame.bind(this),onEnd:()=>{var o;this.closeStream(e),(o=this.onStreamEnd)==null||o.call(this,i)},log:this.logger.forComponent(`libp2p:yamux:${s}:${e}`),config:this.config,getRTT:this.getRTT.bind(this)});return i}closeStream(e){this.client===(e%2===0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){var t;const e=new Promise((n,s)=>{this.closeController.signal.addEventListener("abort",s,{once:!0})});for((t=this.log)==null||t.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let n;try{await Promise.race([e,new Promise(s=>{n=setTimeout(s,this.config.keepAliveInterval)})]),this.ping().catch(s=>{var i;return(i=this.log)==null?void 0:i.error("ping error: %s",s)})}catch{clearInterval(n);return}}}async handleFrame(e,t){var o;const{streamID:n,type:s,length:i}=e;if((o=this.log)==null||o.trace("received frame %o",e),n===0)switch(s){case xr.Ping:{this.handlePing(e);return}case xr.GoAway:{this.handleGoAway(i);return}default:throw new Gh("Invalid frame type")}else switch(e.type){case xr.Data:case xr.WindowUpdate:{await this.handleStreamMessage(e,t);return}default:throw new Gh("Invalid frame type")}}handlePing(e){var t,n;if(e.flag===nr.SYN)(t=this.log)==null||t.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,nr.ACK);else if(e.flag===nr.ACK)(n=this.log)==null||n.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length);else throw new Gh("Invalid frame flag")}handlePingResponse(e){if(this.activePing===void 0)throw new fP("ping not requested");if(this.activePing.id!==e)throw new pP("ping doesn't match our id");this.activePing.resolve()}handleGoAway(e){var t;(t=this.log)==null||t.trace("received GoAway reason=%s",jo[e]??"unknown"),this.remoteGoAway=e;for(const n of this._streams.values())n.reset();this._closeMuxer()}async handleStreamMessage(e,t){var a,c;const{streamID:n,flag:s,type:i}=e;(s&nr.SYN)===nr.SYN&&this.incomingStream(n);const o=this._streams.get(n);if(o===void 0){if(i===xr.Data){if((a=this.log)==null||a.call(this,"discarding data for stream id=%s",n),t===void 0)throw new Error("unreachable");await t()}else(c=this.log)==null||c.trace("frame for missing stream id=%s",n);return}switch(i){case xr.WindowUpdate:{o.handleWindowUpdate(e);return}case xr.Data:{if(t===void 0)throw new Error("unreachable");await o.handleData(e,t);return}default:throw new Error("unreachable")}}incomingStream(e){var n,s,i;if(this.client!==(e%2===0))throw new ie("Both endpoints are clients");if(this._streams.has(e))return;if((n=this.log)==null||n.trace("new incoming stream id=%s",e),this.localGoAway!==void 0){this.sendFrame({type:xr.WindowUpdate,flag:nr.RST,streamID:e,length:0});return}if(this.numInboundStreams>=this.config.maxInboundStreams){(s=this.log)==null||s.call(this,"maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:xr.WindowUpdate,flag:nr.RST,streamID:e,length:0});return}const t=this._newStream(e,void 0,ho.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),(i=this.onIncomingStream)==null||i.call(this,t)}sendFrame(e,t){var n;if((n=this.log)==null||n.trace("sending frame %o",e),e.type===xr.Data){if(t===void 0)throw new Gh("Invalid frame");this.source.push(new Ge(HM(e),t))}else this.source.push(HM(e))}sendPing(e,t=nr.SYN){var n,s;t===nr.SYN?(n=this.log)==null||n.trace("sending ping request pingId=%s",e):(s=this.log)==null||s.trace("sending ping response pingId=%s",e),this.sendFrame({type:xr.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=jo.NormalTermination){var t;(t=this.log)==null||t.call(this,"sending GoAway reason=%s",jo[e]),this.localGoAway=e,this.sendFrame({type:xr.GoAway,flag:0,streamID:0,length:e})}}function J7e(r){return r!=null&&typeof r.then=="function"}function Y7e(r={}){return e=>new W7e(e,r)}const X7e=41;function nY(r){try{const[[e,t]]=r.stringTuples();if(t==null)return!1;if(e===X7e)return g4e("2000::/3",t)}catch{}return!1}const Z7e=4,e9e=41;function sY(r){try{const[[e]]=r.stringTuples();return e===Z7e||e===e9e}catch{}return!1}function Jd(r){try{if(!sY(r))return!1;const[[,e]]=r.stringTuples();return e==null?!1:ah(e)??!1}catch{}return!0}function t9e(r,e,t){let n,s;function i(){const a={signal:s.signal};if((t==null?void 0:t.timeout)!=null){const c=At([s.signal,AbortSignal.timeout(t.timeout)]);a.signal=c}Promise.resolve().then(async()=>{await r(a)}).catch(()=>{}).finally(()=>{s.signal.aborted||(n=setTimeout(i,e))})}let o=!1;return{setInterval:a=>{e=a,n!=null&&(clearTimeout(n),n=setTimeout(i,e))},setTimeout:a=>{t==null&&(t={}),t.timeout=a},start:()=>{o||(o=!0,s=new AbortController,s.signal,(t==null?void 0:t.runImmediately)===!0?queueMicrotask(()=>{i()}):n=setTimeout(i,e))},stop:()=>{clearTimeout(n),s==null||s.abort(),o=!1}}}function Xs(r,e){const t=h1(r,e),n={read:async(s,i)=>{const o=await t.read(i);return s.decode(o)},write:async(s,i,o)=>{await t.write(i.encode(s),o)},writeV:async(s,i,o)=>{await t.writeV(s.map(a=>i.encode(a)),o)},pb:s=>({read:async i=>n.read(s,i),write:async(i,o)=>n.write(i,s,o),writeV:async(i,o)=>n.writeV(i,s,o),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}function r9e(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var n9e=iY,KM=128,s9e=-128,i9e=Math.pow(2,31);function iY(r,e,t){e=e||[],t=t||0;for(var n=t;r>=i9e;)e[t++]=r&255|KM,r/=128;for(;r&s9e;)e[t++]=r&255|KM,r>>>=7;return e[t]=r|0,iY.bytes=t-n+1,e}var o9e=qS,a9e=128,GM=127;function qS(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw qS.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&GM)<<s:(o&GM)*Math.pow(2,s),s+=7}while(o>=a9e);return qS.bytes=i-n,t}var c9e=Math.pow(2,7),l9e=Math.pow(2,14),u9e=Math.pow(2,21),h9e=Math.pow(2,28),d9e=Math.pow(2,35),f9e=Math.pow(2,42),p9e=Math.pow(2,49),g9e=Math.pow(2,56),y9e=Math.pow(2,63),m9e=function(r){return r<c9e?1:r<l9e?2:r<u9e?3:r<h9e?4:r<d9e?5:r<f9e?6:r<p9e?7:r<g9e?8:r<y9e?9:10},w9e={encode:n9e,decode:o9e,encodingLength:m9e},jM=w9e;function qM(r,e=0){return[jM.decode(r,e),jM.decode.bytes]}function b9e(r){const e=r9e(r),[t,n]=qM(e),[s,i]=qM(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new v9e(t,s,o,e)}let v9e=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};const E9e="libp2p",x9e="autonat",A9e="1.0.0",S9e=3e4,C9e=2,I9e=20,k9e=80,T9e=8192;var Gt;(function(r){(function(s){s.DIAL="DIAL",s.DIAL_RESPONSE="DIAL_RESPONSE"})(r.MessageType||(r.MessageType={}));let e;(function(s){s[s.DIAL=0]="DIAL",s[s.DIAL_RESPONSE=1]="DIAL_RESPONSE"})(e||(e={})),function(s){s.codec=()=>Cs(e)}(r.MessageType||(r.MessageType={})),function(s){s.OK="OK",s.E_DIAL_ERROR="E_DIAL_ERROR",s.E_DIAL_REFUSED="E_DIAL_REFUSED",s.E_BAD_REQUEST="E_BAD_REQUEST",s.E_INTERNAL_ERROR="E_INTERNAL_ERROR"}(r.ResponseStatus||(r.ResponseStatus={}));let t;(function(s){s[s.OK=0]="OK",s[s.E_DIAL_ERROR=100]="E_DIAL_ERROR",s[s.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",s[s.E_BAD_REQUEST=200]="E_BAD_REQUEST",s[s.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"})(t||(t={})),function(s){s.codec=()=>Cs(t)}(r.ResponseStatus||(r.ResponseStatus={})),function(s){let i;s.codec=()=>(i==null&&(i=Fe((o,a,c={})=>{if(c.lengthDelimited!==!1&&a.fork(),o.id!=null&&(a.uint32(10),a.bytes(o.id)),o.addrs!=null)for(const l of o.addrs)a.uint32(18),a.bytes(l);c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{var d;const l={addrs:[]},u=a==null?o.len:o.pos+a;for(;o.pos<u;){const p=o.uint32();switch(p>>>3){case 1:{l.id=o.bytes();break}case 2:{if(((d=c.limits)==null?void 0:d.addrs)!=null&&l.addrs.length===c.limits.addrs)throw new It('Decode error - map field "addrs" had too many elements');l.addrs.push(o.bytes());break}default:{o.skipType(p&7);break}}}return l})),i),s.encode=o=>Ue(o,s.codec()),s.decode=(o,a)=>Le(o,s.codec(),a)}(r.PeerInfo||(r.PeerInfo={})),function(s){let i;s.codec=()=>(i==null&&(i=Fe((o,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),o.peer!=null&&(a.uint32(10),r.PeerInfo.codec().encode(o.peer,a)),c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{var d;const l={},u=a==null?o.len:o.pos+a;for(;o.pos<u;){const p=o.uint32();switch(p>>>3){case 1:{l.peer=r.PeerInfo.codec().decode(o,o.uint32(),{limits:(d=c.limits)==null?void 0:d.peer});break}default:{o.skipType(p&7);break}}}return l})),i),s.encode=o=>Ue(o,s.codec()),s.decode=(o,a)=>Le(o,s.codec(),a)}(r.Dial||(r.Dial={})),function(s){let i;s.codec=()=>(i==null&&(i=Fe((o,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),o.status!=null&&(a.uint32(8),r.ResponseStatus.codec().encode(o.status,a)),o.statusText!=null&&(a.uint32(18),a.string(o.statusText)),o.addr!=null&&(a.uint32(26),a.bytes(o.addr)),c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{const l={},u=a==null?o.len:o.pos+a;for(;o.pos<u;){const d=o.uint32();switch(d>>>3){case 1:{l.status=r.ResponseStatus.codec().decode(o);break}case 2:{l.statusText=o.string();break}case 3:{l.addr=o.bytes();break}default:{o.skipType(d&7);break}}}return l})),i),s.encode=o=>Ue(o,s.codec()),s.decode=(o,a)=>Le(o,s.codec(),a)}(r.DialResponse||(r.DialResponse={}));let n;r.codec=()=>(n==null&&(n=Fe((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.type!=null&&(i.uint32(8),r.MessageType.codec().encode(s.type,i)),s.dial!=null&&(i.uint32(18),r.Dial.codec().encode(s.dial,i)),s.dialResponse!=null&&(i.uint32(26),r.DialResponse.codec().encode(s.dialResponse,i)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{var l,u;const a={},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const d=s.uint32();switch(d>>>3){case 1:{a.type=r.MessageType.codec().decode(s);break}case 2:{a.dial=r.Dial.codec().decode(s,s.uint32(),{limits:(l=o.limits)==null?void 0:l.dial});break}case 3:{a.dialResponse=r.DialResponse.codec().decode(s,s.uint32(),{limits:(u=o.limits)==null?void 0:u.dialResponse});break}default:{s.skipType(d&7);break}}}return a})),n),r.encode=s=>Ue(s,r.codec()),r.decode=(s,i)=>Le(s,r.codec(),i)})(Gt||(Gt={}));const _9e=4,P9e=8;var Zz,eV;class N9e{constructor(e,t){h(this,"components");h(this,"protocol");h(this,"timeout");h(this,"maxInboundStreams");h(this,"maxOutboundStreams");h(this,"maxMessageSize");h(this,"started");h(this,"log");h(this,"topologyId");h(this,"dialResults");h(this,"findPeers");h(this,"addressFilter");h(this,"connectionThreshold");h(this,eV,"@libp2p/autonat");h(this,Zz,["@libp2p/autonat"]);this.components=e,this.log=e.logger.forComponent("libp2p:auto-nat"),this.started=!1,this.protocol=`/${t.protocolPrefix??E9e}/${x9e}/${A9e}`,this.timeout=t.timeout??S9e,this.maxInboundStreams=t.maxInboundStreams??C9e,this.maxOutboundStreams=t.maxOutboundStreams??I9e,this.connectionThreshold=t.connectionThreshold??k9e,this.maxMessageSize=t.maxMessageSize??T9e,this.dialResults=new Map,this.findPeers=t9e(this.findRandomPeers.bind(this),6e4),this.addressFilter=jd(1024)}get[(eV=Symbol.toStringTag,Zz=Lr,Lu)](){return["@libp2p/identify"]}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,e=>{this.handleIncomingAutonatStream(e).catch(t=>{this.log.error("error handling incoming autonat stream - %e",t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.topologyId=await this.components.registrar.register(this.protocol,{onConnect:(e,t)=>{this.verifyExternalAddresses(t).catch(n=>{this.log.error("could not verify addresses - %e",n)})}}),this.findPeers.start(),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),this.topologyId!=null&&await this.components.registrar.unhandle(this.topologyId),this.dialResults.clear(),this.findPeers.stop(),this.started=!1}allAddressesAreVerified(){return this.components.addressManager.getAddressesWithMetadata().every(e=>e.expires>Date.now()?!0:e.verified)}async findRandomPeers(e){if(this.allAddressesAreVerified())return;const t=At([AbortSignal.timeout(1e4),e==null?void 0:e.signal]);try{this.log("starting random walk to find peers to run AutoNAT");for await(const n of this.components.randomWalk.walk({signal:t})){if(!await this.components.connectionManager.isDialable(n.multiaddrs)){this.log.trace("random peer %p was not dialable %s",n.id,n.multiaddrs.map(s=>s.toString()).join(", "));continue}try{this.log.trace("dial random peer %p",n.id),await this.components.connectionManager.openConnection(n.multiaddrs,{signal:t})}catch{}if(this.allAddressesAreVerified()){this.log("stopping random walk, all addresses are verified");return}if(!this.hasConnectionCapacity()){this.log("stopping random walk, too close to max connections");return}}}catch{}}async handleIncomingAutonatStream(e){const t=AbortSignal.timeout(this.timeout),n=Xs(e.stream,{maxDataLength:this.maxMessageSize}).pb(Gt);try{const s=await n.read({signal:t}),i=await this.handleAutonatMessage(s,e.connection,{signal:t});await n.write(i,{signal:t}),await n.unwrap().unwrap().close({signal:t})}catch(s){this.log.error("error handling incoming autonat stream - %e",s),e.stream.abort(s)}}async handleAutonatMessage(e,t,n){const s=this.components.addressManager.getAddresses().map(d=>d.toOptions().host),i=e.dial;if(i==null)return this.log.error("dial was missing from message"),{type:Gt.MessageType.DIAL_RESPONSE,dialResponse:{status:Gt.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}};let o;const a=i.peer;if((a==null?void 0:a.id)==null)return this.log.error("PeerId missing from message"),{type:Gt.MessageType.DIAL_RESPONSE,dialResponse:{status:Gt.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}};try{const d=b9e(a.id);o=ri(d)}catch(d){return this.log.error("invalid PeerId - %e",d),{type:Gt.MessageType.DIAL_RESPONSE,dialResponse:{status:Gt.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}}if(this.log("incoming request from %p",o),!t.remotePeer.equals(o))return this.log("target peer %p did not equal sending peer %p",o,t.remotePeer),{type:Gt.MessageType.DIAL_RESPONSE,dialResponse:{status:Gt.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}};const c=a.addrs.map(d=>Ve(d)).filter(d=>{const p=d.toOptions();return Jd(d)?!1:p.host!==t.remoteAddr.toOptions().host?(this.log.trace("not dialing %a - target host did not match remote host %a",d,t.remoteAddr),!1):s.includes(p.host)?!1:this.components.transportManager.dialTransportForMultiaddr(d)==null?(this.log.trace("not dialing %a - transport unsupported",d),!1):!0}).map(d=>(d.getPeerId()==null&&(d=d.encapsulate(`/p2p/${o.toString()}`)),d));if(c.length===0)return this.log("refused to dial all multiaddrs for %p from message",o),{type:Gt.MessageType.DIAL_RESPONSE,dialResponse:{status:Gt.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}};this.log("dial multiaddrs %s for peer %p",c.map(d=>d.toString()).join(", "),o);let l="",u=c[0];for await(const d of c){let p;u=d;try{if(p=await this.components.connectionManager.openConnection(d,n),!p.remoteAddr.equals(d))throw this.log.error("tried to dial %a but dialed %a",d,p.remoteAddr),new Error("Unexpected remote address");return this.log("successfully dialed %p via %a",o,d),{type:Gt.MessageType.DIAL_RESPONSE,dialResponse:{status:Gt.ResponseStatus.OK,addr:p.remoteAddr.decapsulateCode(We("p2p").code).bytes}}}catch(y){this.log.error("could not dial %p - %e",o,y),l=y.message}finally{p!=null&&await p.close()}}return{type:Gt.MessageType.DIAL_RESPONSE,dialResponse:{status:Gt.ResponseStatus.E_DIAL_ERROR,statusText:l,addr:u.bytes}}}getFirstUnverifiedMultiaddr(e,t){var s,i;const n=this.components.addressManager.getAddressesWithMetadata().sort((o,a)=>o.type==="observed"&&a.type!=="observed"?1:a.type==="observed"&&o.type!=="observed"?-1:0).filter(o=>!(!(o.expires<Date.now())||o.multiaddr.toOptions().family===6&&(!t||!nY(o.multiaddr))||Jd(o.multiaddr)));for(const o of n){const a=o.multiaddr.toString();let c=this.dialResults.get(a);if(c!=null){if(c.networkSegments.includes(e)){this.log.trace("%a already has a network segment result from %s",c.multiaddr,e);continue}if(c.queue.size>10){this.log.trace("%a already has enough peers queued",c.multiaddr);continue}}if(c==null){const l=o.expires<Date.now();if(l&&((i=(s=this.addressFilter).remove)==null||i.call(s,a)),this.addressFilter.has(a))continue;this.addressFilter.add(a),this.log.trace("creating dial result %s %s",l?"to revalidate":"for",a),c={multiaddr:o.multiaddr,success:0,failure:0,networkSegments:[],verifyingPeers:uge(),queue:new zu({concurrency:3,maxSize:50}),type:o.type,lastVerified:o.lastVerified},this.dialResults.set(a,c)}return c}}removeOutdatedMultiaddrResults(){const e=new Set(this.components.addressManager.getAddressesWithMetadata().filter(({expires:t})=>t<Date.now()).map(({multiaddr:t})=>t.toString()));for(const t of this.dialResults.keys())e.has(t)||(this.log.trace("remove results for %a",t),this.dialResults.delete(t))}async verifyExternalAddresses(e){if(!this.isStarted())return;this.removeOutdatedMultiaddrResults();const n=(await this.components.peerStore.get(e.remotePeer)).addresses.some(({multiaddr:o})=>o.toOptions().family===6),s=this.getNetworkSegment(e.remoteAddr),i=this.getFirstUnverifiedMultiaddr(s,n);if(i==null){this.log.trace("no unverified public addresses found for peer %p to verify, not requesting verification",e.remotePeer);return}if(!this.hasConnectionCapacity()){i.lastVerified!=null?(this.log("automatically re-verifying %a because we are too close to the connection limit",i.multiaddr),this.confirmAddress(i)):this.log("skipping verifying %a because we are too close to the connection limit",i.multiaddr);return}i.queue.add(async o=>{await this.askPeerToVerify(e,s,o)},{peerId:e.remotePeer,multiaddr:i.multiaddr}).catch(o=>{(i==null?void 0:i.result)==null&&this.log.error("error from %p verifying address %a - %e",e.remotePeer,i==null?void 0:i.multiaddr,o)})}async askPeerToVerify(e,t,n){let s=this.dialResults.get(n.multiaddr.toString());if(s==null){this.log("%a was verified while %p was queued",n.multiaddr,e.remotePeer);return}const i=AbortSignal.timeout(this.timeout);this.log.trace("asking %p to verify multiaddr %s",e.remotePeer,n.multiaddr);const o=await e.newStream(this.protocol,{signal:i});try{const a=Xs(o).pb(Gt),[,c]=await Promise.all([a.write({type:Gt.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toMultihash().bytes,addrs:[n.multiaddr.bytes]}}},{signal:i}),a.read({signal:i})]);if(c.type!==Gt.MessageType.DIAL_RESPONSE||c.dialResponse==null){this.log("invalid autonat response from %p - %j",e.remotePeer,c);return}const l=c.dialResponse.status;if(this.log.trace("autonat response from %p for %a is %s",e.remotePeer,n.multiaddr,l),l!==Gt.ResponseStatus.OK&&l!==Gt.ResponseStatus.E_DIAL_ERROR)return;if(s=this.dialResults.get(n.multiaddr.toString()),s==null){this.log.trace("peer reported %a as %s but there is no result object",n.multiaddr,c.dialResponse.status);return}if(s.networkSegments.includes(t)){this.log.trace("%a results included network segment %s",n.multiaddr,t);return}if(s.result!=null){this.log.trace("already resolved result for %a, ignoring response from",n.multiaddr,e.remotePeer);return}if(s.verifyingPeers.has(e.remotePeer)){this.log.trace("peer %p has already verified %a, ignoring response",e.remotePeer,n.multiaddr);return}if(s.verifyingPeers.add(e.remotePeer),s.networkSegments.push(t),l===Gt.ResponseStatus.OK){if(s.success++,s.type!=="observed"){this.confirmAddress(s);return}}else l===Gt.ResponseStatus.E_DIAL_ERROR&&s.failure++;this.log("%a success %d failure %d",s.multiaddr,s.success,s.failure),s.success===_9e&&this.confirmAddress(s),s.failure===P9e&&this.unconfirmAddress(s)}finally{try{await o.close({signal:i})}catch(a){o.abort(a)}}}hasConnectionCapacity(){const t=this.components.connectionManager.getConnections().length,n=this.components.connectionManager.getMaxConnections();return t/n*100<this.connectionThreshold}confirmAddress(e){this.log("%s address %a is externally dialable",e.type,e.multiaddr),this.components.addressManager.confirmObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!0,e.queue.abort()}unconfirmAddress(e){this.log("%s address %a is not externally dialable",e.type,e.multiaddr),this.components.addressManager.removeObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!1,e.queue.abort()}getNetworkSegment(e){const t=e.toOptions();return t.family===4?t.host.split(".")[0].padStart(3,"0"):t.host.split(":")[0].padStart(4,"0")}}function D9e(r={}){return e=>new N9e(e,r)}const O9e=ve("dns4"),R9e=ve("dns6"),B9e=ve("dnsaddr"),Yd=gr(ve("dns"),B9e,O9e,R9e),Av=gr(ve("ip4"),ve("ip6")),f1=gr(Be(Av,ve("tcp")),Be(Yd,ve("tcp"))),Sv=Be(Av,ve("udp")),M9e=Be(Sv,ve("utp")),$9e=Be(Sv,ve("quic")),L9e=Be(Sv,ve("quic-v1")),WS=gr(Be(f1,ve("ws")),Be(Yd,ve("ws"))),_b=gr(Be(WS,ve("p2p")),WS),QS=gr(Be(f1,ve("wss")),Be(Yd,ve("wss")),Be(f1,ve("tls"),ve("ws")),Be(Yd,ve("tls"),ve("ws"))),Pb=gr(Be(QS,ve("p2p")),QS),JS=gr(Be(f1,ve("http")),Be(Av,ve("http")),Be(Yd,ve("http"))),YS=gr(Be(f1,ve("https")),Be(Av,ve("https")),Be(Yd,ve("https"))),WM=Be(Sv,ve("webrtc-direct"),ve("certhash")),oY=gr(Be(WM,ve("p2p")),WM),QM=Be(L9e,ve("webtransport"),ve("certhash"),ve("certhash")),aY=gr(Be(QM,ve("p2p")),QM),cY=gr(Be(_b,ve("p2p-webrtc-star"),ve("p2p")),Be(Pb,ve("p2p-webrtc-star"),ve("p2p")),Be(_b,ve("p2p-webrtc-star")),Be(Pb,ve("p2p-webrtc-star")));gr(Be(_b,ve("p2p-websocket-star"),ve("p2p")),Be(Pb,ve("p2p-websocket-star"),ve("p2p")),Be(_b,ve("p2p-websocket-star")),Be(Pb,ve("p2p-websocket-star")));const lY=gr(Be(JS,ve("p2p-webrtc-direct"),ve("p2p")),Be(YS,ve("p2p-webrtc-direct"),ve("p2p")),Be(JS,ve("p2p-webrtc-direct")),Be(YS,ve("p2p-webrtc-direct"))),Xd=gr(WS,QS,JS,YS,cY,lY,f1,M9e,$9e,Yd,oY,aY);gr(Be(Xd,ve("p2p-stardust"),ve("p2p")),Be(Xd,ve("p2p-stardust")));const du=gr(Be(Xd,ve("p2p")),cY,lY,oY,aY,ve("p2p")),JM=gr(Be(du,ve("p2p-circuit"),du),Be(du,ve("p2p-circuit")),Be(ve("p2p-circuit"),du),Be(Xd,ve("p2p-circuit")),Be(ve("p2p-circuit"),Xd),ve("p2p-circuit")),uY=()=>gr(Be(JM,uY),JM),Oh=uY(),U9e=gr(Be(Oh,du,Oh),Be(du,Oh),Be(Oh,du),Oh,du);gr(Be(Oh,ve("webrtc"),ve("p2p")),Be(Oh,ve("webrtc")),Be(Xd,ve("webrtc"),ve("p2p")),Be(Xd,ve("webrtc")),ve("webrtc"));function hY(r){function e(t){let n;try{n=Ve(t)}catch{return!1}const s=r(n.protoNames());return s===null?!1:s===!0||s===!1?s:s.length===0}return e}function Be(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(s=>(n=typeof s=="function"?s().partialMatch(t):s.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:hY(e),partialMatch:e}}function gr(...r){function e(n){let s=null;return r.some(i=>{const o=typeof i=="function"?i().partialMatch(n):i.partialMatch(n);return o!=null?(s=o,!0):!1}),s}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:hY(e),partialMatch:e}}function ve(r){const e=r;function t(s){let i;try{i=Ve(s)}catch{return!1}const o=i.protoNames();return o.length===1&&o[0]===e}function n(s){return s.length===0?null:s[0]===e?s.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}const F9e="bootstrap",z9e=50,V9e=1e3;var tV,rV,nV,sV;class dY extends(sV=Er,nV=v8,rV=Symbol.toStringTag,tV=Lr,sV){constructor(t,n={list:[]}){if(n.list==null||n.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super();h(this,"log");h(this,"timer");h(this,"list");h(this,"timeout");h(this,"components");h(this,"_init");h(this,nV,this);h(this,rV,"@libp2p/bootstrap");h(this,tV,["@libp2p/peer-discovery"]);this.components=t,this.log=t.logger.forComponent("libp2p:bootstrap"),this.timeout=n.timeout??V9e,this.list=[];for(const s of n.list){if(!U9e.matches(s)){this.log.error("Invalid multiaddr");continue}const i=Ve(s),o=i.getPeerId();if(o==null){this.log.error("Invalid bootstrap multiaddr without peer id");continue}const a={id:mr(o),multiaddrs:[i]};this.list.push(a)}this._init=n}isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(t=>{this.log.error(t)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(const t of this.list){if(await this.components.peerStore.merge(t.id,{tags:{[this._init.tagName??F9e]:{value:this._init.tagValue??z9e,ttl:this._init.tagTTL}},multiaddrs:t.multiaddrs}),this.timer==null)return;this.safeDispatchEvent("peer",{detail:t}),this.components.connectionManager.openConnection(t.id).catch(n=>{this.log.error("could not dial bootstrap peer %p",t.id,n)})}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}}h(dY,"tag","bootstrap");function fY(r){return e=>new dY(e,r)}var Nb;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(n.uint32(26),n.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={publicKey:it(0),payloadType:it(0),payload:it(0),signature:it(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.publicKey=t.bytes();break}case 2:{i.payloadType=t.bytes();break}case 3:{i.payload=t.bytes();break}case 5:{i.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(Nb||(Nb={}));class H9e extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}}const $l=class $l{constructor(e){h(this,"publicKey");h(this,"payloadType");h(this,"payload");h(this,"signature");h(this,"marshaled");const{publicKey:t,payloadType:n,payload:s,signature:i}=e;this.publicKey=t,this.payloadType=n,this.payload=s,this.signature=i}marshal(){return this.marshaled==null&&(this.marshaled=Nb.encode({publicKey:$i(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return rt(this.marshal(),e.marshal())}async validate(e){const t=YM(e,this.payloadType,this.payload);return this.publicKey.verify(t.subarray(),this.signature)}};h($l,"createFromProtobuf",async e=>{const t=Nb.decode(e),n=Is(t.publicKey);return new $l({publicKey:n,payloadType:t.payloadType,payload:t.payload,signature:t.signature})}),h($l,"seal",async(e,t)=>{if(t==null)throw new Error("Missing private key");const n=e.domain,s=e.codec,i=e.marshal(),o=YM(n,s,i),a=await t.sign(o.subarray());return new $l({publicKey:t.publicKey,payloadType:s,payload:i,signature:a})}),h($l,"openAndCertify",async(e,t)=>{const n=await $l.createFromProtobuf(e);if(!await n.validate(t))throw new H9e("Envelope signature is not valid for the given domain");return n});let Gu=$l;const YM=(r,e,t)=>{const n=he(r),s=Jr(n.byteLength),i=Jr(e.length),o=Jr(t.length);return new Ge(s,n,i,e,o,t)};function K9e(r,e){const t=(n,s)=>n.toString().localeCompare(s.toString());return r.length!==e.length?!1:(e.sort(t),r.sort(t).every((n,s)=>e[s].equals(n)))}function G9e(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var j9e=pY,XM=128,q9e=-128,W9e=Math.pow(2,31);function pY(r,e,t){e=e||[],t=t||0;for(var n=t;r>=W9e;)e[t++]=r&255|XM,r/=128;for(;r&q9e;)e[t++]=r&255|XM,r>>>=7;return e[t]=r|0,pY.bytes=t-n+1,e}var Q9e=XS,J9e=128,ZM=127;function XS(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw XS.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&ZM)<<s:(o&ZM)*Math.pow(2,s),s+=7}while(o>=J9e);return XS.bytes=i-n,t}var Y9e=Math.pow(2,7),X9e=Math.pow(2,14),Z9e=Math.pow(2,21),eEe=Math.pow(2,28),tEe=Math.pow(2,35),rEe=Math.pow(2,42),nEe=Math.pow(2,49),sEe=Math.pow(2,56),iEe=Math.pow(2,63),oEe=function(r){return r<Y9e?1:r<X9e?2:r<Z9e?3:r<eEe?4:r<tEe?5:r<rEe?6:r<nEe?7:r<sEe?8:r<iEe?9:10},aEe={encode:j9e,decode:Q9e,encodingLength:oEe},e$=aEe;function t$(r,e=0){return[e$.decode(r,e),e$.decode.bytes]}function cEe(r){const e=G9e(r),[t,n]=t$(e),[s,i]=t$(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new lEe(t,s,o,e)}let lEe=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};const uEe="libp2p-peer-record",hEe=Uint8Array.from([3,1]);var Db;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=Fe((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.multiaddr!=null&&s.multiaddr.byteLength>0&&(i.uint32(10),i.bytes(s.multiaddr)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{const a={multiaddr:it(0)},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const l=s.uint32();switch(l>>>3){case 1:{a.multiaddr=s.bytes();break}default:{s.skipType(l&7);break}}}return a})),n),t.encode=s=>Ue(s,t.codec()),t.decode=(s,i)=>Le(s,t.codec(),i)})(r.AddressInfo||(r.AddressInfo={}));let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.peerId!=null&&t.peerId.byteLength>0&&(n.uint32(10),n.bytes(t.peerId)),t.seq!=null&&t.seq!==0n&&(n.uint32(16),n.uint64(t.seq)),t.addresses!=null)for(const i of t.addresses)n.uint32(26),r.AddressInfo.codec().encode(i,n);s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{var a,c;const i={peerId:it(0),seq:0n,addresses:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{i.peerId=t.bytes();break}case 2:{i.seq=t.uint64();break}case 3:{if(((a=s.limits)==null?void 0:a.addresses)!=null&&i.addresses.length===s.limits.addresses)throw new It('Decode error - map field "addresses" had too many elements');i.addresses.push(r.AddressInfo.codec().decode(t,t.uint32(),{limits:(c=s.limits)==null?void 0:c.addresses$}));break}default:{t.skipType(l&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(Db||(Db={}));const za=class za{constructor(e){h(this,"peerId");h(this,"multiaddrs");h(this,"seqNumber");h(this,"domain",za.DOMAIN);h(this,"codec",za.CODEC);h(this,"marshaled");const{peerId:t,multiaddrs:n,seqNumber:s}=e;this.peerId=t,this.multiaddrs=n??[],this.seqNumber=s??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=Db.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof za)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!K9e(this.multiaddrs,e.multiaddrs))}};h(za,"createFromProtobuf",e=>{const t=Db.decode(e),n=ri(cEe(t.peerId)),s=(t.addresses??[]).map(o=>Ve(o.multiaddr)),i=t.seq;return new za({peerId:n,multiaddrs:s,seqNumber:i})}),h(za,"DOMAIN",uEe),h(za,"CODEC",hEe);let ya=za;function gY(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var dEe=yY,r$=128,fEe=-128,pEe=Math.pow(2,31);function yY(r,e,t){e=e||[],t=t||0;for(var n=t;r>=pEe;)e[t++]=r&255|r$,r/=128;for(;r&fEe;)e[t++]=r&255|r$,r>>>=7;return e[t]=r|0,yY.bytes=t-n+1,e}var gEe=ZS,yEe=128,n$=127;function ZS(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw ZS.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&n$)<<s:(o&n$)*Math.pow(2,s),s+=7}while(o>=yEe);return ZS.bytes=i-n,t}var mEe=Math.pow(2,7),wEe=Math.pow(2,14),bEe=Math.pow(2,21),vEe=Math.pow(2,28),EEe=Math.pow(2,35),xEe=Math.pow(2,42),AEe=Math.pow(2,49),SEe=Math.pow(2,56),CEe=Math.pow(2,63),IEe=function(r){return r<mEe?1:r<wEe?2:r<bEe?3:r<vEe?4:r<EEe?5:r<xEe?6:r<AEe?7:r<SEe?8:r<CEe?9:10},kEe={encode:dEe,decode:gEe,encodingLength:IEe},s$=kEe;function i$(r,e=0){return[s$.decode(r,e),s$.decode.bytes]}function TEe(r){const e=gY(r),[t,n]=i$(e),[s,i]=i$(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new _Ee(t,s,o,e)}let _Ee=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};const PEe=290,NEe=1,mY=2e3,DEe=100,u3=`${M5}-circuit-relay`;BigInt(1<<17);const Ob="/libp2p/circuit/relay/0.2.0/hop",o$="/libp2p/circuit/relay/0.2.0/stop",a$=300,OEe=4096,REe=.001;var p1;(function(r){(function(n){n.RESERVE="RESERVE",n.CONNECT="CONNECT",n.STATUS="STATUS"})(r.Type||(r.Type={}));let e;(function(n){n[n.RESERVE=0]="RESERVE",n[n.CONNECT=1]="CONNECT",n[n.STATUS=2]="STATUS"})(e||(e={})),function(n){n.codec=()=>Cs(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=Fe((n,s,i={})=>{i.lengthDelimited!==!1&&s.fork(),n.type!=null&&(s.uint32(8),r.Type.codec().encode(n.type,s)),n.peer!=null&&(s.uint32(18),g1.codec().encode(n.peer,s)),n.reservation!=null&&(s.uint32(26),Rb.codec().encode(n.reservation,s)),n.limit!=null&&(s.uint32(34),y1.codec().encode(n.limit,s)),n.status!=null&&(s.uint32(40),Fn.codec().encode(n.status,s)),i.lengthDelimited!==!1&&s.ldelim()},(n,s,i={})=>{var c,l,u;const o={},a=s==null?n.len:n.pos+s;for(;n.pos<a;){const d=n.uint32();switch(d>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.peer=g1.codec().decode(n,n.uint32(),{limits:(c=i.limits)==null?void 0:c.peer});break}case 3:{o.reservation=Rb.codec().decode(n,n.uint32(),{limits:(l=i.limits)==null?void 0:l.reservation});break}case 4:{o.limit=y1.codec().decode(n,n.uint32(),{limits:(u=i.limits)==null?void 0:u.limit});break}case 5:{o.status=Fn.codec().decode(n);break}default:{n.skipType(d&7);break}}}return o})),t),r.encode=n=>Ue(n,r.codec()),r.decode=(n,s)=>Le(n,r.codec(),s)})(p1||(p1={}));var Ua;(function(r){(function(n){n.CONNECT="CONNECT",n.STATUS="STATUS"})(r.Type||(r.Type={}));let e;(function(n){n[n.CONNECT=0]="CONNECT",n[n.STATUS=1]="STATUS"})(e||(e={})),function(n){n.codec=()=>Cs(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=Fe((n,s,i={})=>{i.lengthDelimited!==!1&&s.fork(),n.type!=null&&(s.uint32(8),r.Type.codec().encode(n.type,s)),n.peer!=null&&(s.uint32(18),g1.codec().encode(n.peer,s)),n.limit!=null&&(s.uint32(26),y1.codec().encode(n.limit,s)),n.status!=null&&(s.uint32(32),Fn.codec().encode(n.status,s)),i.lengthDelimited!==!1&&s.ldelim()},(n,s,i={})=>{var c,l;const o={},a=s==null?n.len:n.pos+s;for(;n.pos<a;){const u=n.uint32();switch(u>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.peer=g1.codec().decode(n,n.uint32(),{limits:(c=i.limits)==null?void 0:c.peer});break}case 3:{o.limit=y1.codec().decode(n,n.uint32(),{limits:(l=i.limits)==null?void 0:l.limit});break}case 4:{o.status=Fn.codec().decode(n);break}default:{n.skipType(u&7);break}}}return o})),t),r.encode=n=>Ue(n,r.codec()),r.decode=(n,s)=>Le(n,r.codec(),s)})(Ua||(Ua={}));var g1;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.addrs!=null)for(const i of t.addrs)n.uint32(18),n.bytes(i);s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{var a;const i={id:it(0),addrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{i.id=t.bytes();break}case 2:{if(((a=s.limits)==null?void 0:a.addrs)!=null&&i.addrs.length===s.limits.addrs)throw new It('Decode error - map field "addrs" had too many elements');i.addrs.push(t.bytes());break}default:{t.skipType(c&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(g1||(g1={}));var Rb;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.expire!=null&&t.expire!==0n&&(n.uint32(8),n.uint64(t.expire)),t.addrs!=null)for(const i of t.addrs)n.uint32(18),n.bytes(i);t.voucher!=null&&(n.uint32(26),Mb.codec().encode(t.voucher,n)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{var a,c;const i={expire:0n,addrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{i.expire=t.uint64();break}case 2:{if(((a=s.limits)==null?void 0:a.addrs)!=null&&i.addrs.length===s.limits.addrs)throw new It('Decode error - map field "addrs" had too many elements');i.addrs.push(t.bytes());break}case 3:{i.voucher=Mb.codec().decode(t,t.uint32(),{limits:(c=s.limits)==null?void 0:c.voucher});break}default:{t.skipType(l&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(Rb||(Rb={}));var y1;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.duration!=null&&(n.uint32(8),n.uint32(t.duration)),t.data!=null&&(n.uint32(16),n.uint64(t.data)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.duration=t.uint32();break}case 2:{i.data=t.uint64();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(y1||(y1={}));var Fn;(function(r){r.UNUSED="UNUSED",r.OK="OK",r.RESERVATION_REFUSED="RESERVATION_REFUSED",r.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONNECTION_FAILED="CONNECTION_FAILED",r.NO_RESERVATION="NO_RESERVATION",r.MALFORMED_MESSAGE="MALFORMED_MESSAGE",r.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"})(Fn||(Fn={}));var eC;(function(r){r[r.UNUSED=0]="UNUSED",r[r.OK=100]="OK",r[r.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",r[r.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",r[r.PERMISSION_DENIED=202]="PERMISSION_DENIED",r[r.CONNECTION_FAILED=203]="CONNECTION_FAILED",r[r.NO_RESERVATION=204]="NO_RESERVATION",r[r.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",r[r.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"})(eC||(eC={}));(function(r){r.codec=()=>Cs(eC)})(Fn||(Fn={}));var Bb;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.relay!=null&&t.relay.byteLength>0&&(n.uint32(10),n.bytes(t.relay)),t.peer!=null&&t.peer.byteLength>0&&(n.uint32(18),n.bytes(t.peer)),t.expiration!=null&&t.expiration!==0n&&(n.uint32(24),n.uint64(t.expiration)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={relay:it(0),peer:it(0),expiration:0n},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.relay=t.bytes();break}case 2:{i.peer=t.bytes();break}case 3:{i.expiration=t.uint64();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(Bb||(Bb={}));var Mb;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&(n.uint32(26),Bb.codec().encode(t.payload,n)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{var a;const i={publicKey:it(0),payloadType:it(0),signature:it(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{i.publicKey=t.bytes();break}case 2:{i.payloadType=t.bytes();break}case 3:{i.payload=Bb.codec().decode(t,t.uint32(),{limits:(a=s.limits)==null?void 0:a.payload});break}case 5:{i.signature=t.bytes();break}default:{t.skipType(c&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(Mb||(Mb={}));function BEe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var MEe=BEe,$Ee=MEe;let LEe=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},UEe=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return wY(this,e)}},FEe=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return wY(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function wY(r,e){return new FEe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let zEe=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new LEe(e,t,n),this.decoder=new UEe(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function bY({name:r,prefix:e,encode:t,decode:n}){return new zEe(r,e,t,n)}function Cv({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=$Ee(t,r);return bY({prefix:e,name:r,encode:n,decode:i=>gY(s(i))})}function VEe(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function HEe(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function Jc({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return bY({prefix:e,name:r,encode(s){return HEe(s,n,t)},decode(s){return VEe(s,n,t,r)}})}Jc({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Jc({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Jc({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Jc({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Jc({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Jc({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Jc({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Jc({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Jc({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});Cv({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Cv({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});Cv({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Cv({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});class tC extends Error{constructor(){super(...arguments);h(this,"name","HadEnoughRelaysError")}}h(tC,"name","HadEnoughRelaysError");class vY extends Error{constructor(){super(...arguments);h(this,"name","DoubleRelayError")}}h(vY,"name","DoubleRelayError");class EY extends Error{constructor(){super(...arguments);h(this,"name","RelayQueueFullError")}}h(EY,"name","RelayQueueFullError");function c$(r){const e=r*BigInt(1e3),t=new Date().getTime();return Number(e-BigInt(t))}class l${constructor(e){h(this,"expires");h(this,"bytes");(e==null?void 0:e.duration)!=null&&(e==null?void 0:e.duration)!==0&&(this.expires=Date.now()+e.duration*1e3),this.bytes=e==null?void 0:e.data,this.bytes===0n&&(this.bytes=void 0),this.onData=this.onData.bind(this)}onData(e){this.bytes!=null&&(this.bytes-=BigInt(e.byteLength),this.bytes<0n&&(this.bytes=0n))}getLimits(){if(this.expires==null&&this.bytes==null)return;const e={};if(this.bytes!=null){const t=this;Object.defineProperty(e,"bytes",{get(){return t.bytes}})}if(this.expires!=null){const t=this;Object.defineProperty(e,"seconds",{get(){return Math.round(((t.expires??0)-Date.now())/1e3)}})}return e}}const xY=Lt(lt(FQ.matchers[0],ot("p2p-circuit"))),AY=Lt(ot("p2p-circuit"));function u$(r){const{stream:e,remoteAddr:t,logger:n,onDataRead:s,onDataWrite:i}=r,o=n.forComponent("libp2p:stream:converter");let a=!1,c=!1;const l=e.close.bind(e);e.close=async f=>{await l(f),y(!0)};const u=e.abort.bind(e);e.abort=f=>{u(f),y(!0)};const d=e.sink.bind(e);e.sink=async f=>{try{await d(Jn(f,g=>nb(g,w=>i==null?void 0:i(w))))}catch(g){g.type!=="aborted"&&o.error("%s error in sink",t,g)}finally{c=!0,y()}};const p={log:o,sink:e.sink,source:async function*(){try{for await(const f of e.source)s==null||s(f),yield f}finally{a=!0,y()}}(),remoteAddr:t,timeline:{open:Date.now(),close:void 0},close:e.close,abort:e.abort};function y(f){f===!0&&(a=!0,c=!0),a&&c&&p.timeline.close==null&&(p.timeline.close=Date.now())}return p}class KEe extends Er{constructor(t,n={}){super();h(this,"peerStore");h(this,"registrar");h(this,"connectionManager");h(this,"randomWalk");h(this,"started");h(this,"running");h(this,"topologyId");h(this,"log");h(this,"discoveryController");h(this,"filter");h(this,"queue");this.log=t.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.started=!1,this.running=!1,this.peerStore=t.peerStore,this.registrar=t.registrar,this.connectionManager=t.connectionManager,this.randomWalk=t.randomWalk,this.filter=n.filter,this.discoveryController=new AbortController,this.discoveryController.signal}isStarted(){return this.started}async start(){this.topologyId=await this.registrar.register(Ob,{filter:this.filter,onConnect:t=>{var n,s;this.log.trace("discovered relay %p queue (length: %d, active %d)",t,(n=this.queue)==null?void 0:n.size,(s=this.queue)==null?void 0:s.running),this.safeDispatchEvent("relay:discover",{detail:t})}}),this.started=!0}stop(){var t;this.topologyId!=null&&this.registrar.unregister(this.topologyId),(t=this.discoveryController)==null||t.abort(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,this.discoveryController.signal,Promise.resolve().then(async()=>{var s;this.log("searching peer store for relays");const t=await this.peerStore.all({filters:[i=>i.protocols.includes(Ob)],orders:[()=>Math.random()<.5?1:-1,(i,o)=>{const a=h$(i),c=h$(o);return a>c?-1:c>a?1:0}]});for(const i of t)this.log.trace("found relay peer %p in peer store",i.id),this.safeDispatchEvent("relay:discover",{detail:i.id});this.log("found %d relay peers in peer store",t.length);const n=this.queue=new zu({concurrency:5});this.log("start random walk");for await(const i of this.randomWalk.walk({signal:this.discoveryController.signal})){if(this.log.trace("found random peer %p",i.id),n.has(i.id)){this.log.trace("random peer %p was already in queue",i.id);continue}if(((s=this.connectionManager.getConnections(i.id))==null?void 0:s.length)>0){this.log.trace("random peer %p was already connected",i.id);continue}if(!await this.connectionManager.isDialable(i.multiaddrs)){this.log.trace("random peer %p was not dialable",i.id,i.multiaddrs.map(o=>o.toString()));continue}n.queued>10&&(this.log.trace("wait for space in queue for %p",i.id),await n.onSizeLessThan(10,{signal:this.discoveryController.signal})),this.log("adding random peer %p to dial queue (length: %d, active %d)",i.id,n.size,n.running),n.add(async()=>{const o=At([this.discoveryController.signal,AbortSignal.timeout(5e3)]);try{await this.connectionManager.openConnection(i.id,{signal:o})}finally{o.clear()}},{peerId:i.id,signal:this.discoveryController.signal}).catch(o=>{this.log.error("error opening connection to random peer %p",i.id,o)})}this.log("stop random walk"),await n.onIdle()}).catch(t=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network",t)}))}stopDiscovery(){var t;this.log("stop discovery"),this.running=!1,(t=this.discoveryController)==null||t.abort()}}function h$(r){const e=r.metadata.get("last-dial-success");return e==null?0:new Date(ce(e)).getTime()}class GEe extends Er{constructor(t,n={}){super();h(this,"connectionManager");h(this,"addressManager");h(this,"reservationStore");h(this,"listeningAddrs");h(this,"log");h(this,"listenTimeout");h(this,"reservationId");h(this,"relay");h(this,"_onRemoveRelayPeer",t=>{var n,s;this.log("relay removed %p our relay %p",t.detail.relay,this.relay,(n=this.relay)==null?void 0:n.equals(t.detail.relay)),((s=this.relay)==null?void 0:s.equals(t.detail.relay))===!0&&(this.log("relay peer removed %p",t.detail.relay),this.listeningAddrs.forEach(i=>{this.addressManager.removeObservedAddr(i)}),this.listeningAddrs=[],this.safeDispatchEvent("listening"))});h(this,"_onAddRelayPeer",t=>{const{details:n}=t.detail;n.type!=="configured"&&n.id===this.reservationId&&this.addedRelay(t.detail)});this.log=t.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=t.connectionManager,this.addressManager=t.addressManager,this.reservationStore=t.reservationStore,this.listeningAddrs=[],this.listenTimeout=n.listenTimeout??mY,this.reservationStore.addEventListener("relay:removed",this._onRemoveRelayPeer),this.reservationStore.addEventListener("relay:created-reservation",this._onAddRelayPeer)}async listen(t){if(AY.exactMatch(t))this.log("searching for circuit relay servers"),this.reservationId=this.reservationStore.reserveRelay();else if(xY.exactMatch(t)){this.log("listen on specific relay server %a",t);const n=AbortSignal.timeout(this.listenTimeout),s=t.decapsulate("/p2p-circuit"),i=await this.connectionManager.openConnection(s,{signal:n});if(!this.reservationStore.hasReservation(i.remotePeer)){this.log("making reservation on peer %p",i.remotePeer);const o=await this.reservationStore.addRelay(i.remotePeer,"configured");this.addedRelay(o)}}else throw new A8(`Could not listen on p2p-circuit address "${t}"`)}getAddrs(){return[...this.listeningAddrs.values()].flat()}updateAnnounceAddrs(){}async close(){this.reservationStore.cancelReservations(),this.listeningAddrs=[],this.reservationStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),queueMicrotask(()=>{this.safeDispatchEvent("close")})}addedRelay(t){this.log("relay peer added %p",t.relay),this.relay=t.relay,this.listeningAddrs=t.details.reservation.addrs.map(n=>Ve(n).encapsulate("/p2p-circuit")),this.listeningAddrs.forEach(n=>{this.addressManager.confirmObservedAddr(n,{type:"transport"})}),queueMicrotask(()=>{this.safeDispatchEvent("listening")})}}function jEe(r){return new GEe(r)}const qEe="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let WEe=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=qEe[t[r]&63];return e};const QEe=60*1e3*10,JEe=60*1e3*5,YEe=30*1e3;var ms,SY,d2,f2;class XEe extends Er{constructor(t,n){super();Q(this,ms);h(this,"peerId");h(this,"connectionManager");h(this,"peerStore");h(this,"events");h(this,"reserveQueue");h(this,"reservations");h(this,"pendingReservations");h(this,"maxReservationQueueLength");h(this,"reservationCompletionTimeout");h(this,"started");h(this,"log");h(this,"relayFilter");this.log=t.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=t.peerId,this.connectionManager=t.connectionManager,this.peerStore=t.peerStore,this.events=t.events,this.reservations=new oh,this.pendingReservations=[],this.maxReservationQueueLength=(n==null?void 0:n.maxReservationQueueLength)??DEe,this.reservationCompletionTimeout=(n==null?void 0:n.reservationCompletionTimeout)??mY,this.started=!1,this.relayFilter=jd(100),this.reserveQueue=new zu({concurrency:(n==null?void 0:n.reservationConcurrency)??NEe,metricName:"libp2p_relay_reservation_queue",metrics:t.metrics}),this.events.addEventListener("connection:close",s=>{[...this.reservations.values()].find(o=>o.connection===s.detail.id)!=null&&te(this,ms,d2).call(this,s.detail.remotePeer).catch(o=>{this.log("could not remove relay %p - %e",s.detail,o)})})}isStarted(){return this.started}start(){this.started=!0}afterStart(){Promise.resolve().then(async()=>{const t=await this.peerStore.all({filters:[n=>n.tags.has(u3)]});this.log("removing tag from %d old relays",t.length),await Promise.all(t.map(async n=>{await this.peerStore.merge(n.id,{tags:{[u3]:void 0}})})),this.log("redialing %d old relays",t.length),await Promise.all(t.map(async n=>this.addRelay(n.id,"discovered"))),te(this,ms,f2).call(this)}).catch(t=>{this.log.error(t)})}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:t})=>{clearTimeout(t)}),this.reservations.clear(),this.started=!1}reserveRelay(){const t=WEe();return this.pendingReservations.push(t),te(this,ms,f2).call(this),t}async addRelay(t,n){if(this.peerId.equals(t))throw this.log.trace("not trying to use self as relay"),new A8("Cannot use self as relay");if(this.reserveQueue.size>this.maxReservationQueueLength)throw new EY("The reservation queue is full");const s=this.reserveQueue.find(t);if(s!=null)return this.log.trace("potential relay peer %p is already in the reservation queue",t),s.join();if(this.relayFilter.has(t.toMultihash().bytes))throw new A8("The relay was previously invalid");return this.log.trace("try to reserve relay slot with %p",t),this.reserveQueue.add(async()=>{const i=Date.now();try{const o=this.reservations.get(t);if(o!=null){const g=this.connectionManager.getConnections(t);let w=!1;if(g.length===0&&this.log("already have relay reservation with %p but we are no longer connected",t),g.map(m=>m.id).includes(o.connection)&&(this.log("already have relay reservation with %p and the original connection is still open",t),w=!0),w&&c$(o.reservation.expire)>QEe)return this.log("already have relay reservation with %p but we are still connected and it does not expire soon",t),{relay:t,details:o};await te(this,ms,d2).call(this,t)}if(n==="discovered"&&this.pendingReservations.length===0)throw new tC("Not making reservation on discovered relay because we do not need any more relays");const a=AbortSignal.timeout(this.reservationCompletionTimeout);const c=await this.connectionManager.openConnection(t,{signal:a});if(Hu.matches(c.remoteAddr))throw new vY("not creating reservation over relayed connection");const l=await te(this,ms,SY).call(this,c,{signal:a}),u=c$(l.expire);this.log("created reservation on relay peer %p, expiry date is %s",t,new Date(Date.now()+u).toString());const d=Math.min(Math.max(u-JEe,YEe),Math.pow(2,31)-1),p=setTimeout(()=>{this.log("refresh reservation to relay %p",t),this.addRelay(t,n).catch(async g=>{this.log.error("could not refresh reservation to relay %p - %e",t,g),await te(this,ms,d2).call(this,t)}).catch(g=>{this.log.error("could not remove expired reservation to relay %p - %e",t,g)})},d);let y;if(n==="discovered"){const g=this.pendingReservations.pop();if(g==null)throw new tC("Made reservation on relay but did not need any more discovered relays");y={timeout:p,reservation:l,type:n,connection:c.id,id:g}}else y={timeout:p,reservation:l,type:n,connection:c.id};this.reservations.set(t,y),await this.peerStore.merge(t,{tags:{[u3]:{value:1,ttl:u}}}),te(this,ms,f2).call(this);const f={relay:t,details:y};return this.safeDispatchEvent("relay:created-reservation",{detail:f}),f}catch(o){throw n==="discovered"&&o.name==="HadEnoughRelaysError"||this.log.error("could not reserve slot on %p after %dms - %e",t,Date.now()-i,o),(o.name==="DialError"||o.name==="UnsupportedProtocolError")&&this.relayFilter.add(t.toMultihash().bytes),te(this,ms,d2).call(this,t).catch(a=>{this.log.error("could not remove reservation on %p after reserving slot failed - %e",t,a)}),o}},{peerId:t})}hasReservation(t){return this.reservations.has(t)}getReservation(t){var n;return(n=this.reservations.get(t))==null?void 0:n.reservation}reservationCount(t){return t==null?this.reservations.size:[...this.reservations.values()].reduce((n,s)=>(s.type===t&&n++,n),0)}cancelReservations(){[...this.reservations.values()].forEach(t=>{clearTimeout(t.timeout)}),this.reservations.clear()}}ms=new WeakSet,SY=async function(t,n){var l;(l=n.signal)==null||l.throwIfAborted(),this.log("requesting reservation from %p",t.remotePeer);const s=await t.newStream(Ob,n),o=Xs(s).pb(p1);this.log.trace("send RESERVE to %p",t.remotePeer),await o.write({type:p1.Type.RESERVE},n);let a;try{this.log.trace("reading response from %p",t.remotePeer),a=await o.read(n)}catch(u){throw s.abort(u),u}finally{s.status!=="closed"&&await s.close(n)}if(this.log.trace("read response %o",a),a.status===Fn.OK&&a.reservation!=null){const u=new Set;u.add(t.remoteAddr.toString());for(const d of a.reservation.addrs){let p=Ve(d);p.getPeerId()==null&&(p=p.encapsulate(`/p2p/${t.remotePeer}`)),p=Ve(p.toString().replace(`/p2p/${t.remotePeer}/p2p/${t.remotePeer}`,`/p2p/${t.remotePeer}`)),u.add(p.toString())}return a.reservation.addrs=[...u].map(d=>Ve(d).bytes),a.reservation}const c=`reservation failed with status ${a.status??"undefined"}`;throw this.log.error(c),new Error(c)},d2=async function(t){const n=this.reservations.get(t);n!=null&&(this.log("removing relay reservation with %p from local store",t),clearTimeout(n.timeout),this.reservations.delete(t),n.type==="discovered"&&this.pendingReservations.push(n.id),await this.peerStore.merge(t,{tags:{[u3]:void 0}}),this.safeDispatchEvent("relay:removed",{detail:{relay:t,details:n}}),te(this,ms,f2).call(this))},f2=function(){if(this.pendingReservations.length===0){this.log.trace("have discovered enough relays"),this.reserveQueue.clear(),this.safeDispatchEvent("relay:found-enough-relays");return}this.relayFilter=jd(100),this.log("not discovered enough relays %d/%d",this.reservations.size,this.pendingReservations.length),this.safeDispatchEvent("relay:not-enough-relays")};const ZEe=r=>{if(r.peer==null)return!1;try{r.peer.addrs.forEach(Ve)}catch{return!1}return!0},d$={maxInboundStopStreams:a$,maxOutboundStopStreams:a$};var iV,oV,aV,cV;class exe{constructor(e,t={}){h(this,"discovery");h(this,"registrar");h(this,"peerStore");h(this,"connectionManager");h(this,"transportManager");h(this,"peerId");h(this,"upgrader");h(this,"addressManager");h(this,"connectionGater");h(this,"reservationStore");h(this,"logger");h(this,"maxInboundStopStreams");h(this,"maxOutboundStopStreams");h(this,"started");h(this,"log");h(this,"shutdownController");h(this,cV,"@libp2p/circuit-relay-v2-transport");h(this,aV,["@libp2p/transport","@libp2p/circuit-relay-v2-transport"]);h(this,iV,!0);this.log=e.logger.forComponent("libp2p:circuit-relay:transport"),this.registrar=e.registrar,this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.logger=e.logger,this.peerId=e.peerId,this.upgrader=e.upgrader,this.addressManager=e.addressManager,this.connectionGater=e.connectionGater,this.maxInboundStopStreams=t.maxInboundStopStreams??d$.maxInboundStopStreams,this.maxOutboundStopStreams=t.maxOutboundStopStreams??d$.maxOutboundStopStreams,this.shutdownController=new AbortController,this.discovery=new KEe(e,{filter:t.discoveryFilter??Ige(OEe,REe)}),this.discovery.addEventListener("relay:discover",n=>{this.reservationStore.addRelay(n.detail,"discovered").catch(s=>{s.name!=="HadEnoughRelaysError"&&s.name!=="RelayQueueFullError"&&this.log.error("could not add discovered relay %p",n.detail,s)})}),this.reservationStore=new XEe(e,t),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{var n;(n=this.discovery)==null||n.startDiscovery()}),this.reservationStore.addEventListener("relay:found-enough-relays",()=>{var n;(n=this.discovery)==null||n.stopDiscovery()}),this.started=!1}get[(cV=Symbol.toStringTag,aV=Lr,oV=Lu,iV=$5,oV)](){return this.discovery!=null?["@libp2p/identify"]:[]}isStarted(){return this.started}async start(){this.shutdownController=new AbortController,await this.registrar.handle(o$,e=>{const t=this.upgrader.createInboundAbortSignal(this.shutdownController.signal);this.onStop(e,t).catch(n=>{this.log.error("error while handling STOP protocol",n),e.stream.abort(n)}).finally(()=>{t.clear()})},{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0}),await Oc(this.discovery,this.reservationStore),this.started=!0}async stop(){this.shutdownController.abort(),await sh(this.discovery,this.reservationStore),await this.registrar.unhandle(o$),this.started=!1}async dial(e,t){var y,f,g,w,m,b;if(e.protoCodes().filter(v=>v===PEe).length!==1){const v="Invalid circuit relay address";throw this.log.error(v,e),new Rp(v)}const n=e.toString().split("/p2p-circuit"),s=Ve(n[0]),i=Ve(n[n.length-1]),o=s.getPeerId(),a=i.getPeerId();if(o==null||a==null){const v=`ircuit relay dial to ${e.toString()} failed as address did not have both relay and destination PeerIDs`;throw this.log.error(`c${v}`),new Rp(`C${v}`)}const c=mr(o),l=mr(a);let d=this.connectionManager.getConnections(c)[0];d==null?(await this.peerStore.merge(c,{multiaddrs:[s]}),(y=t.onProgress)==null||y.call(t,new Re("circuit-relay:open-connection")),d=await this.connectionManager.openConnection(c,t)):(f=t.onProgress)==null||f.call(t,new Re("circuit-relay:reuse-connection"));let p;try{(g=t.onProgress)==null||g.call(t,new Re("circuit-relay:open-hop-stream")),p=await d.newStream(Ob,t);const v=Xs(p),E=v.pb(p1);(w=t.onProgress)==null||w.call(t,new Re("circuit-relay:write-connect-message")),await E.write({type:p1.Type.CONNECT,peer:{id:l.toMultihash().bytes,addrs:[Ve(i).bytes]}},t),(m=t.onProgress)==null||m.call(t,new Re("circuit-relay:read-connect-response"));const S=await E.read(t);if(S.status!==Fn.OK)throw new Rt(`failed to connect via relay with status ${((b=S==null?void 0:S.status)==null?void 0:b.toString())??"undefined"}`);const I=new l$(S.limit),x=u$({stream:v.unwrap(),remoteAddr:e,localAddr:s.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`),logger:this.logger,onDataRead:I.onData,onDataWrite:I.onData});return this.log("new outbound relayed connection %a",x.remoteAddr),await this.upgrader.upgradeOutbound(x,{...t,limits:I.getLimits()})}catch(v){throw this.log.error("circuit relay dial to destination %p via relay %p failed",l,c,v),p==null||p.abort(v),v}}createListener(e){return jEe({peerId:this.peerId,connectionManager:this.connectionManager,addressManager:this.addressManager,reservationStore:this.reservationStore,logger:this.logger})}listenFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>xY.exactMatch(t)||AY.exactMatch(t))}dialFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>Hu.exactMatch(t))}async onStop({connection:e,stream:t},n){var u,d;if(!this.reservationStore.hasReservation(e.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.transportManager.listen([e.remoteAddr.encapsulate("/p2p-circuit")])}catch(p){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on",p)}const s=Xs(t).pb(Ua),i=await s.read({signal:n});if(this.log("new circuit relay v2 stop stream from %p with type %s",e.remotePeer,i.type),(i==null?void 0:i.type)===void 0){this.log.error("type was missing from circuit v2 stop protocol request from %s",e.remotePeer),await s.write({type:Ua.Type.STATUS,status:Fn.MALFORMED_MESSAGE},{signal:n}),await t.close();return}if(i.type!==Ua.Type.CONNECT){this.log.error("invalid stop connect request via peer %p",e.remotePeer),await s.write({type:Ua.Type.STATUS,status:Fn.UNEXPECTED_MESSAGE},{signal:n}),await t.close();return}if(!ZEe(i)){this.log.error("invalid stop connect request via peer %p",e.remotePeer),await s.write({type:Ua.Type.STATUS,status:Fn.MALFORMED_MESSAGE},{signal:n}),await t.close({signal:n});return}const o=ri(TEe(i.peer.id));if(await((d=(u=this.connectionGater).denyInboundRelayedConnection)==null?void 0:d.call(u,e.remotePeer,o))===!0){this.log.error("connection gater denied inbound relayed connection from %p",e.remotePeer),await s.write({type:Ua.Type.STATUS,status:Fn.PERMISSION_DENIED},{signal:n}),await t.close({signal:n});return}this.log.trace("sending success response to %p",e.remotePeer),await s.write({type:Ua.Type.STATUS,status:Fn.OK},{signal:n});const a=new l$(i.limit),c=e.remoteAddr.encapsulate(`/p2p-circuit/p2p/${o.toString()}`);this.addressManager.getAddresses()[0];const l=u$({stream:s.unwrap().unwrap(),remoteAddr:c,logger:this.logger,onDataRead:a.onData,onDataWrite:a.onData});this.log("new inbound relayed connection %a",l.remoteAddr),await this.upgrader.upgradeInbound(l,{limits:a.getLimits(),signal:n}),this.log("%s connection %a upgraded","inbound",l.remoteAddr)}}function CY(r={}){return e=>new exe(e,r)}const f$=()=>{const r=new Error("Delay aborted");return r.name="AbortError",r},txe=new WeakMap;function rxe({clearTimeout:r,setTimeout:e}={}){return(t,{value:n,signal:s}={})=>{if(s!=null&&s.aborted)return Promise.reject(f$());let i,o,a;const c=r??clearTimeout,l=()=>{c(i),a(f$())},u=()=>{s&&s.removeEventListener("abort",l)},d=new Promise((p,y)=>{o=()=>{u(),p(n)},a=y,i=(e??setTimeout)(o,t)});return s&&s.addEventListener("abort",l,{once:!0}),txe.set(d,()=>{c(i),i=null,o()}),d}}const IY=rxe();var qo;(function(r){(function(n){n.UNUSED="UNUSED",n.CONNECT="CONNECT",n.SYNC="SYNC"})(r.Type||(r.Type={}));let e;(function(n){n[n.UNUSED=0]="UNUSED",n[n.CONNECT=100]="CONNECT",n[n.SYNC=300]="SYNC"})(e||(e={})),function(n){n.codec=()=>Cs(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=Fe((n,s,i={})=>{if(i.lengthDelimited!==!1&&s.fork(),n.type!=null&&(s.uint32(8),r.Type.codec().encode(n.type,s)),n.observedAddresses!=null)for(const o of n.observedAddresses)s.uint32(18),s.bytes(o);i.lengthDelimited!==!1&&s.ldelim()},(n,s,i={})=>{var c;const o={observedAddresses:[]},a=s==null?n.len:n.pos+s;for(;n.pos<a;){const l=n.uint32();switch(l>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{if(((c=i.limits)==null?void 0:c.observedAddresses)!=null&&o.observedAddresses.length===i.limits.observedAddresses)throw new It('Decode error - map field "observedAddresses" had too many elements');o.observedAddresses.push(n.bytes());break}default:{n.skipType(l&7);break}}}return o})),t),r.encode=n=>Ue(n,r.codec()),r.decode=(n,s)=>Le(n,r.codec(),s)})(qo||(qo={}));function p$(r,e){return Hu.matches(r)||e.dialTransportForMultiaddr(r)==null?!1:OQ.matches(r)?!0:Y3e.matches(r)?ah(r.toOptions().host)===!1:!1}const g$=1024*4,y$=100,h3={timeout:5e3,retries:3,maxInboundStreams:1,maxOutboundStreams:1};var lV,uV;uV=Symbol.toStringTag,lV=Lu;class nxe{constructor(e,t){h(this,"started");h(this,"timeout");h(this,"retries");h(this,"maxInboundStreams");h(this,"maxOutboundStreams");h(this,"peerStore");h(this,"registrar");h(this,"connectionManager");h(this,"addressManager");h(this,"transportManager");h(this,"topologyId");h(this,"log");h(this,uV,"@libp2p/dcutr");h(this,lV,["@libp2p/identify"]);this.log=e.logger.forComponent("libp2p:dcutr"),this.started=!1,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.timeout=t.timeout??h3.timeout,this.retries=t.retries??h3.retries,this.maxInboundStreams=t.maxInboundStreams??h3.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??h3.maxOutboundStreams}isStarted(){return this.started}async start(){this.started||(this.topologyId=await this.registrar.register(d3,{notifyOnLimitedConnection:!0,onConnect:(e,t)=>{Hu.exactMatch(t.remoteAddr)&&t.direction==="inbound"&&this.upgradeInbound(t).catch(n=>{this.log.error("error during outgoing DCUtR attempt",n)})}}),await this.registrar.handle(d3,e=>{this.handleIncomingUpgrade(e.stream,e.connection).catch(t=>{this.log.error("error during incoming DCUtR attempt",t),e.stream.abort(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:!0}),this.started=!0)}async stop(){await this.registrar.unhandle(d3),this.topologyId!=null&&this.registrar.unregister(this.topologyId),this.started=!1}async upgradeInbound(e){if(await this.attemptUnilateralConnectionUpgrade(e))return;let t;for(let n=0;n<this.retries;n++){const s={signal:AbortSignal.timeout(this.timeout)};try{t=await e.newStream([d3],{signal:s.signal,runOnLimitedConnection:!0});const i=Xs(t,{maxDataLength:g$}).pb(qo);this.log("B sending connect to %p",e.remotePeer);const o=Date.now();await i.write({type:qo.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(d=>d.bytes)},s),this.log("B receiving connect from %p",e.remotePeer);const a=await i.read(s);if(a.type!==qo.Type.CONNECT)throw this.log("A sent wrong message type"),new Rt("DCUtR message type was incorrect");const c=this.getDialableMultiaddrs(a.observedAddresses);if(c.length===0)throw this.log("A did not have any dialable multiaddrs"),new Rt("DCUtR connect message had no multiaddrs");const l=Date.now()-o;this.log("A sending sync, rtt %dms",l),await i.write({type:qo.Type.SYNC,observedAddresses:[]},s),this.log("A waiting for half RTT"),await IY(l/2),this.log("B dialing",c);const u=await this.connectionManager.openConnection(c,{signal:s.signal,priority:y$,force:!0,initiator:!1});this.log("DCUtR to %p succeeded to address %a, closing relayed connection",e.remotePeer,u.remoteAddr),await e.close(s);break}catch(i){if(this.log.error("error while attempting DCUtR on attempt %d of %d",n+1,this.retries,i),t==null||t.abort(i),n===this.retries)throw i}finally{t!=null&&await t.close(s)}}}async attemptUnilateralConnectionUpgrade(e){const n=(await this.peerStore.get(e.remotePeer)).addresses.map(s=>{const i=s.multiaddr;return i.getPeerId()==null?i.encapsulate(`/p2p/${e.remotePeer}`):i}).filter(s=>p$(s,this.transportManager));if(n.length>0){const s=AbortSignal.timeout(this.timeout);try{this.log("attempting unilateral connection upgrade to %a",n);const i=await this.connectionManager.openConnection(n,{signal:s,force:!0});if(Hu.exactMatch(i.remoteAddr))throw new Error("Could not open a new, non-limited, connection");return this.log("unilateral connection upgrade to %p succeeded via %a, closing relayed connection",e.remotePeer,i.remoteAddr),await e.close({signal:s}),!0}catch(i){this.log.error("unilateral connection upgrade to %p on addresses %a failed",e.remotePeer,n,i)}}else this.log("peer %p has no public addresses, not attempting unilateral connection upgrade",e.remotePeer);return!1}async handleIncomingUpgrade(e,t){const n={signal:AbortSignal.timeout(this.timeout)};try{const s=Xs(e,{maxDataLength:g$}).pb(qo);this.log("A receiving connect");const i=await s.read(n);if(i.type!==qo.Type.CONNECT)throw this.log("B sent wrong message type"),new Rt("DCUtR message type was incorrect");if(i.observedAddresses.length===0)throw this.log("B sent no multiaddrs"),new Rt("DCUtR connect message had no multiaddrs");const o=this.getDialableMultiaddrs(i.observedAddresses);if(o.length===0)throw this.log("B had no dialable multiaddrs"),new Rt("DCUtR connect message had no dialable multiaddrs");if(this.log("A sending connect"),await s.write({type:qo.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(l=>l.bytes)}),this.log("A receiving sync"),(await s.read(n)).type!==qo.Type.SYNC)throw new Rt("DCUtR message type was incorrect");this.log("A dialing",o);const c=await this.connectionManager.openConnection(o,{signal:n.signal,priority:y$,force:!0});this.log("DCUtR to %p succeeded via %a, closing relayed connection",t.remotePeer,c.remoteAddr),await t.close(n)}catch(s){this.log.error("incoming DCUtR from %p failed",t.remotePeer,s),e.abort(s)}finally{await e.close(n)}}getDialableMultiaddrs(e){const t=[];for(const n of e)if(!(n==null||n.length===0))try{const s=Ve(n);if(!p$(s,this.transportManager))continue;t.push(s)}catch{}return t}}const d3="/libp2p/dcutr";function sxe(r={}){return e=>new nxe(e,r)}const f3=globalThis.CustomEvent??Event;async function*Km(r,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);const n=e.ordered??!1,s=new EventTarget,i=[];let o=He(),a=He(),c=!1,l,u=!1;s.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(const f of r){if(i.length===t&&(o=He(),await o.promise),u)break;const g={done:!1};i.push(g),f().then(w=>{g.done=!0,g.ok=!0,g.value=w,s.dispatchEvent(new f3("task-complete"))},w=>{g.done=!0,g.err=w,s.dispatchEvent(new f3("task-complete"))})}c=!0,s.dispatchEvent(new f3("task-complete"))}catch(f){l=f,s.dispatchEvent(new f3("task-complete"))}});function d(){var f;return n?(f=i[0])==null?void 0:f.done:!!i.find(g=>g.done)}function*p(){for(;i.length>0&&i[0].done;){const f=i[0];if(i.shift(),f.ok)yield f.value;else throw u=!0,o.resolve(),f.err;o.resolve()}}function*y(){for(;d();)for(let f=0;f<i.length;f++)if(i[f].done){const g=i[f];if(i.splice(f,1),f--,g.ok)yield g.value;else throw u=!0,o.resolve(),g.err;o.resolve()}}for(;;){if(d()||(a=He(),await a.promise),l!=null)throw l;if(n?yield*p():yield*y(),c&&i.length===0)break}}const ixe="0.1.0",oxe="id",axe="id/push",cxe="1.0.0",lxe="1.0.0",uxe=1024*8,hxe=32;var m1;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.protocolVersion!=null&&(n.uint32(42),n.string(t.protocolVersion)),t.agentVersion!=null&&(n.uint32(50),n.string(t.agentVersion)),t.publicKey!=null&&(n.uint32(10),n.bytes(t.publicKey)),t.listenAddrs!=null)for(const i of t.listenAddrs)n.uint32(18),n.bytes(i);if(t.observedAddr!=null&&(n.uint32(34),n.bytes(t.observedAddr)),t.protocols!=null)for(const i of t.protocols)n.uint32(26),n.string(i);t.signedPeerRecord!=null&&(n.uint32(66),n.bytes(t.signedPeerRecord)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{var a,c;const i={listenAddrs:[],protocols:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 5:{i.protocolVersion=t.string();break}case 6:{i.agentVersion=t.string();break}case 1:{i.publicKey=t.bytes();break}case 2:{if(((a=s.limits)==null?void 0:a.listenAddrs)!=null&&i.listenAddrs.length===s.limits.listenAddrs)throw new It('Decode error - map field "listenAddrs" had too many elements');i.listenAddrs.push(t.bytes());break}case 4:{i.observedAddr=t.bytes();break}case 3:{if(((c=s.limits)==null?void 0:c.protocols)!=null&&i.protocols.length===s.limits.protocols)throw new It('Decode error - map field "protocols" had too many elements');i.protocols.push(t.string());break}case 8:{i.signedPeerRecord=t.bytes();break}default:{t.skipType(l&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(m1||(m1={}));const Ci={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:uxe,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnLimitedConnection:!0,concurrency:hxe};function dxe(r){if(r!=null&&r.length>0)try{return Ve(r)}catch{}}function fxe(r,e){return e??r.userAgent}async function kY(r,e,t,n,s){if(t("received identify from %p",n.remotePeer),s==null)throw new Rt("message was null or undefined");const i={};if(s.listenAddrs.length>0&&(i.addresses=s.listenAddrs.map(c=>({isCertified:!1,multiaddr:Ve(c)}))),s.protocols.length>0&&(i.protocols=s.protocols),s.publicKey!=null){const c=Is(s.publicKey);if(!i1(c).equals(n.remotePeer))throw new Rt("public key did not match remote PeerId");i.publicKey=c}let o;if(s.signedPeerRecord!=null){t.trace("received signedPeerRecord from %p",n.remotePeer);let c=s.signedPeerRecord;const l=await Gu.openAndCertify(c,ya.DOMAIN);let u=ya.createFromProtobuf(l.payload);const d=Y1(l.publicKey.toCID());if(!u.peerId.equals(d))throw new Rt("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(u.peerId))throw new Rt("signing key does not match remote PeerId");let p;try{p=await r.get(u.peerId)}catch(y){if(y.name!=="NotFoundError")throw y}if(p!=null&&(i.metadata=p.metadata,p.peerRecordEnvelope!=null)){const y=await Gu.createFromProtobuf(p.peerRecordEnvelope),f=ya.createFromProtobuf(y.payload);f.seqNumber>=u.seqNumber&&(t("sequence number was lower or equal to existing sequence number - stored: %d received: %d",f.seqNumber,u.seqNumber),u=f,c=p.peerRecordEnvelope)}i.peerRecordEnvelope=c,i.addresses=u.multiaddrs.map(y=>({isCertified:!0,multiaddr:y})),o={seq:u.seqNumber,addresses:u.multiaddrs}}else t("%p did not send a signed peer record",n.remotePeer);if(t.trace("patching %p with",n.remotePeer,i),await r.patch(n.remotePeer,i),s.agentVersion!=null||s.protocolVersion!=null){const c={};s.agentVersion!=null&&(c.AgentVersion=he(s.agentVersion)),s.protocolVersion!=null&&(c.ProtocolVersion=he(s.protocolVersion)),t.trace("merging %p metadata",n.remotePeer,c),await r.merge(n.remotePeer,{metadata:c})}const a={peerId:n.remotePeer,protocolVersion:s.protocolVersion,agentVersion:s.agentVersion,publicKey:s.publicKey,listenAddrs:s.listenAddrs.map(c=>Ve(c)),observedAddr:s.observedAddr==null?void 0:Ve(s.observedAddr),protocols:s.protocols,signedPeerRecord:o,connection:n};return e.safeDispatchEvent("peer:identify",{detail:a}),a}class TY{constructor(e,t){h(this,"host");h(this,"protocol");h(this,"started");h(this,"timeout");h(this,"peerId");h(this,"privateKey");h(this,"peerStore");h(this,"registrar");h(this,"addressManager");h(this,"maxInboundStreams");h(this,"maxOutboundStreams");h(this,"maxMessageSize");h(this,"maxObservedAddresses");h(this,"events");h(this,"runOnLimitedConnection");h(this,"log");this.protocol=t.protocol,this.started=!1,this.peerId=e.peerId,this.privateKey=e.privateKey,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.events=e.events,this.log=t.log,this.timeout=t.timeout??Ci.timeout,this.maxInboundStreams=t.maxInboundStreams??Ci.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??Ci.maxOutboundStreams,this.maxMessageSize=t.maxMessageSize??Ci.maxMessageSize,this.maxObservedAddresses=t.maxObservedAddresses??Ci.maxObservedAddresses,this.runOnLimitedConnection=t.runOnLimitedConnection??Ci.runOnLimitedConnection,this.host={protocolVersion:`${t.protocolPrefix??Ci.protocolPrefix}/${ixe}`,agentVersion:fxe(e.nodeInfo,t.agentVersion)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:he(this.host.agentVersion),ProtocolVersion:he(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,e=>{this.handleProtocol(e).catch(t=>{this.log.error(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}}var hV,dV;class pxe extends(dV=TY,hV=Lr,dV){constructor(t,n={}){super(t,{...n,protocol:`/${n.protocolPrefix??Ci.protocolPrefix}/${axe}/${lxe}`,log:t.logger.forComponent("libp2p:identify-push")});h(this,"connectionManager");h(this,"concurrency");h(this,hV,["@libp2p/identify-push"]);this.connectionManager=t.connectionManager,this.concurrency=n.concurrency??Ci.concurrency,(n.runOnSelfUpdate??Ci.runOnSelfUpdate)&&t.events.addEventListener("self:peer:update",s=>{this.push().catch(i=>{this.log.error(i)})})}async push(){if(!this.isStarted())return;const t=this.addressManager.getAddresses().map(d=>d.decapsulateCode(We("p2p").code)),n=new ya({peerId:this.peerId,multiaddrs:t}),s=await Gu.seal(n,this.privateKey),i=this.registrar.getProtocols(),o=await this.peerStore.get(this.peerId),a=ce(o.metadata.get("AgentVersion")??he(this.host.agentVersion)),c=ce(o.metadata.get("ProtocolVersion")??he(this.host.protocolVersion)),l=this;async function*u(){for(const d of l.connectionManager.getConnections())(await l.peerStore.get(d.remotePeer)).protocols.includes(l.protocol)&&(yield async()=>{let y;const f=AbortSignal.timeout(l.timeout);try{y=await d.newStream(l.protocol,{signal:f,runOnLimitedConnection:l.runOnLimitedConnection}),await Xs(y,{maxDataLength:l.maxMessageSize}).pb(m1).write({listenAddrs:t.map(w=>w.bytes),signedPeerRecord:s.marshal(),protocols:i,agentVersion:a,protocolVersion:c},{signal:f}),await y.close({signal:f})}catch(g){l.log.error("could not push identify update to peer",g),y==null||y.abort(g)}})}await Dc(Km(u(),{concurrency:this.concurrency}))}async handleProtocol(t){const{connection:n,stream:s}=t;try{if(this.peerId.equals(n.remotePeer))throw new Error("received push from ourselves?");const i={signal:AbortSignal.timeout(this.timeout)},a=await Xs(s,{maxDataLength:this.maxMessageSize}).pb(m1).read(i);await s.close(i),await kY(this.peerStore,this.events,this.log,n,a)}catch(i){this.log.error("received invalid message",i),s.abort(i);return}this.log.trace("handled push from %p",n.remotePeer)}}const gxe=41;var fV,pV;class yxe extends(pV=TY,fV=Lr,pV){constructor(t,n={}){super(t,{...n,protocol:`/${n.protocolPrefix??Ci.protocolPrefix}/${oxe}/${cxe}`,log:t.logger.forComponent("libp2p:identify")});h(this,fV,["@libp2p/identify"]);(n.runOnConnectionOpen??Ci.runOnConnectionOpen)&&t.events.addEventListener("connection:open",s=>{const i=s.detail;this.identify(i).catch(o=>{o.name!==Om.name&&this.log.error("error during identify trigged by connection:open",o)})})}async _identify(t,n={}){let s;if(n.signal==null){const i=AbortSignal.timeout(this.timeout);n={...n,signal:i}}try{s=await t.newStream(this.protocol,{...n,runOnLimitedConnection:this.runOnLimitedConnection});const o=await Xs(s,{maxDataLength:this.maxMessageSize}).pb(m1).read(n);return await s.close(n),o}catch(i){throw s==null||s.abort(i),i}}async identify(t,n={}){const s=await this._identify(t,n),{publicKey:i,protocols:o,observedAddr:a}=s;if(i==null)throw new Rt("public key was missing from identify message");const c=Is(i),l=Y1(c.toCID());if(!t.remotePeer.equals(l))throw new Rt("identified peer does not match the expected peer");if(this.peerId.equals(l))throw new Rt("identified peer is our own peer id?");return this.maybeAddObservedAddress(a),this.log("identify completed for peer %p and protocols %o",l,o),kY(this.peerStore,this.events,this.log,t,s)}maybeAddObservedAddress(t){const n=dxe(t);if(n==null)return;if(this.log.trace("our observed address was %a",n),Jd(n)){this.log.trace("our observed address was private");return}if(n.stringTuples()[0][0]===gxe&&!nY(n)){this.log.trace("our observed address was IPv6 but not a global unicast address");return}ob.exactMatch(n)||(this.log.trace("storing the observed address"),this.addressManager.addObservedAddr(n))}async handleProtocol(t){const{connection:n,stream:s}=t,i=AbortSignal.timeout(this.timeout);try{const o=await this.peerStore.get(this.peerId),a=this.addressManager.getAddresses().map(d=>d.decapsulateCode(We("p2p").code));let c=o.peerRecordEnvelope;if(a.length>0&&c==null){const d=new ya({peerId:this.peerId,multiaddrs:a});c=(await Gu.seal(d,this.privateKey)).marshal().subarray()}let l=n.remoteAddr.bytes;J3e.matches(n.remoteAddr)||(l=void 0),await Xs(s).pb(m1).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:$i(this.privateKey.publicKey),listenAddrs:a.map(d=>d.bytes),signedPeerRecord:c,observedAddr:l,protocols:o.protocols},{signal:i}),await s.close({signal:i})}catch(o){this.log.error("could not respond to identify request",o),s.abort(o)}}}function _Y(r={}){return e=>new yxe(e,r)}function mxe(r={}){return e=>new pxe(e,r)}const Gm=1e3,wP=60*Gm,Iv=60*wP,wxe=36*Iv,bxe="/ipfs/kad/1.0.0",vxe=48*Iv,Exe=24*Iv,xxe=10,Axe=16384,Sxe=Iv,PY=20,bP=3,Cxe=5*wP,Ixe=Gm,kxe=5*Gm,Txe=5*wP,_xe=30*Gm,Pxe=180*Gm,m$=`${M5}-kad-dht`;var $b;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key.byteLength>0&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(n.uint32(42),n.string(t.timeReceived)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={key:it(0),value:it(0),timeReceived:""},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.key=t.bytes();break}case 2:{i.value=t.bytes();break}case 5:{i.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})($b||($b={}));function Nxe(r){const e=r.getUTCFullYear(),t=String(r.getUTCMonth()+1).padStart(2,"0"),n=String(r.getUTCDate()).padStart(2,"0"),s=String(r.getUTCHours()).padStart(2,"0"),i=String(r.getUTCMinutes()).padStart(2,"0"),o=String(r.getUTCSeconds()).padStart(2,"0"),a=r.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${n}T${s}:${i}:${o}.${c}Z`}function Dxe(r){const e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");const n=parseInt(t[1],10),s=parseInt(t[2],10)-1,i=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),l=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,s,i,o,a,c,l))}class Li{constructor(e,t,n){h(this,"key");h(this,"value");h(this,"timeReceived");if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return $b.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:Nxe(this.timeReceived)}}static deserialize(e){const t=$b.decode(e);return new Li(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=Dxe(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new Li(e.key,e.value,t)}}class Lb extends Error{constructor(e="Query error"){super(e),this.name="QueryError"}}class Oxe extends Error{constructor(e="Query aborted"){super(e),this.name="QueryAbortedError"}}class Rxe extends Error{constructor(e="Invalid record"){super(e),this.name="InvalidRecordError"}}class Bxe extends Error{constructor(e="No selector function configured for prefix"){super(e),this.name="MissingSelectorError"}}var w$;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.key!=null&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&(n.uint32(18),n.bytes(t.value)),t.author!=null&&(n.uint32(26),n.bytes(t.author)),t.signature!=null&&(n.uint32(34),n.bytes(t.signature)),t.timeReceived!=null&&(n.uint32(42),n.string(t.timeReceived)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.key=t.bytes();break}case 2:{i.value=t.bytes();break}case 3:{i.author=t.bytes();break}case 4:{i.signature=t.bytes();break}case 5:{i.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(w$||(w$={}));var Bt;(function(r){r.PUT_VALUE="PUT_VALUE",r.GET_VALUE="GET_VALUE",r.ADD_PROVIDER="ADD_PROVIDER",r.GET_PROVIDERS="GET_PROVIDERS",r.FIND_NODE="FIND_NODE",r.PING="PING"})(Bt||(Bt={}));var Ub;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(Ub||(Ub={}));(function(r){r.codec=()=>Cs(Ub)})(Bt||(Bt={}));var w1;(function(r){r.NOT_CONNECTED="NOT_CONNECTED",r.CONNECTED="CONNECTED",r.CAN_CONNECT="CAN_CONNECT",r.CANNOT_CONNECT="CANNOT_CONNECT"})(w1||(w1={}));var rC;(function(r){r[r.NOT_CONNECTED=0]="NOT_CONNECTED",r[r.CONNECTED=1]="CONNECTED",r[r.CAN_CONNECT=2]="CAN_CONNECT",r[r.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(rC||(rC={}));(function(r){r.codec=()=>Cs(rC)})(w1||(w1={}));var mp;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.multiaddrs!=null)for(const i of t.multiaddrs)n.uint32(18),n.bytes(i);t.connection!=null&&(n.uint32(24),w1.codec().encode(t.connection,n)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{var a;const i={id:it(0),multiaddrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{i.id=t.bytes();break}case 2:{if(((a=s.limits)==null?void 0:a.multiaddrs)!=null&&i.multiaddrs.length===s.limits.multiaddrs)throw new It('Decode error - map field "multiaddrs" had too many elements');i.multiaddrs.push(t.bytes());break}case 3:{i.connection=w1.codec().decode(t);break}default:{t.skipType(c&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(mp||(mp={}));var Nd;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.type!=null&&Ub[t.type]!==0&&(n.uint32(8),Bt.codec().encode(t.type,n)),t.clusterLevel!=null&&(n.uint32(80),n.int32(t.clusterLevel)),t.key!=null&&(n.uint32(18),n.bytes(t.key)),t.record!=null&&(n.uint32(26),n.bytes(t.record)),t.closer!=null)for(const i of t.closer)n.uint32(66),mp.codec().encode(i,n);if(t.providers!=null)for(const i of t.providers)n.uint32(74),mp.codec().encode(i,n);s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{var a,c,l,u;const i={type:Bt.PUT_VALUE,closer:[],providers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const d=t.uint32();switch(d>>>3){case 1:{i.type=Bt.codec().decode(t);break}case 10:{i.clusterLevel=t.int32();break}case 2:{i.key=t.bytes();break}case 3:{i.record=t.bytes();break}case 8:{if(((a=s.limits)==null?void 0:a.closer)!=null&&i.closer.length===s.limits.closer)throw new It('Decode error - map field "closer" had too many elements');i.closer.push(mp.codec().decode(t,t.uint32(),{limits:(c=s.limits)==null?void 0:c.closer$}));break}case 9:{if(((l=s.limits)==null?void 0:l.providers)!=null&&i.providers.length===s.limits.providers)throw new It('Decode error - map field "providers" had too many elements');i.providers.push(mp.codec().decode(t,t.uint32(),{limits:(u=s.limits)==null?void 0:u.providers$}));break}default:{t.skipType(d&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(Nd||(Nd={}));function b$(r,e={}){var n;const t={...r,name:"SEND_QUERY",type:0,messageName:r.type,messageType:r.type};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:send-query",{detail:t})),t}function nC(r,e={}){var n;const t={...r,name:"PEER_RESPONSE",type:1,messageName:r.messageType,closer:r.closer??[],providers:r.providers??[]};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:peer-response",{detail:t})),t}function mE(r,e={}){var n;const t={...r,name:"FINAL_PEER",type:2};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:final-peer",{detail:t})),t}function ju(r,e={}){var n;const t={...r,name:"QUERY_ERROR",type:3};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:query-error",{detail:t})),t}function v$(r,e={}){var n;const t={...r,name:"PROVIDER",type:4};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:provider",{detail:t})),t}function sC(r,e={}){var n;const t={...r,name:"VALUE",type:5};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:value",{detail:t})),t}function E$(r,e={}){var n;const t={...r,name:"DIAL_PEER",type:7};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:dial-peer",{detail:t})),t}function Mxe(r,e,t){if(t.length===0)throw new ie("No records given");const s=ce(e).split("/");if(s.length<3)throw new ie("Record key does not have a selector function");const i=r[s[1].toString()];if(i==null)throw new Bxe(`No selector function configured for key type "${s[1]}"`);return t.length===1?0:i(e,t)}function $xe(r,e){return 0}const Lxe={pk:$xe};async function vP(r,e){const t=e.key,s=ce(t).split("/");if(s.length<3)return;const i=r[s[1].toString()];if(i==null)throw new ie(`No validator available for key type "${s[1]}"`);await i(t,e.value)}const Uxe=async(r,e)=>{if(!(r instanceof Uint8Array))throw new ie('"key" must be a Uint8Array');if(r.byteLength<5)throw new ie("Invalid public key record");if(ce(r.subarray(0,4))!=="/pk/")throw new ie("key was not prefixed with /pk/");const n=Is(e),s=r.slice(4);if(!rt(s,n.toMultihash().bytes))throw new ie("public key does not match passed in key")},Fxe={pk:Uxe};function zxe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function EP(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Vxe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var Hxe=Vxe,Kxe=Hxe;let Gxe=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},jxe=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return NY(this,e)}},qxe=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return NY(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function NY(r,e){return new qxe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Wxe=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Gxe(e,t,n),this.decoder=new jxe(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function DY({name:r,prefix:e,encode:t,decode:n}){return new Wxe(r,e,t,n)}function kv({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=Kxe(t,r);return DY({prefix:e,name:r,encode:n,decode:i=>EP(s(i))})}function Qxe(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Jxe(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function Yc({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return DY({prefix:e,name:r,encode(s){return Jxe(s,n,t)},decode(s){return Qxe(s,n,t,r)}})}const m4=Yc({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Yc({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Yc({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Yc({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Yc({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Yc({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Yc({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Yc({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Yc({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const wE=kv({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});kv({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Ml=kv({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});kv({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Yxe=OY,x$=128,Xxe=-128,Zxe=Math.pow(2,31);function OY(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Zxe;)e[t++]=r&255|x$,r/=128;for(;r&Xxe;)e[t++]=r&255|x$,r>>>=7;return e[t]=r|0,OY.bytes=t-n+1,e}var eAe=iC,tAe=128,A$=127;function iC(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw iC.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&A$)<<s:(o&A$)*Math.pow(2,s),s+=7}while(o>=tAe);return iC.bytes=i-n,t}var rAe=Math.pow(2,7),nAe=Math.pow(2,14),sAe=Math.pow(2,21),iAe=Math.pow(2,28),oAe=Math.pow(2,35),aAe=Math.pow(2,42),cAe=Math.pow(2,49),lAe=Math.pow(2,56),uAe=Math.pow(2,63),hAe=function(r){return r<rAe?1:r<nAe?2:r<sAe?3:r<iAe?4:r<oAe?5:r<aAe?6:r<cAe?7:r<lAe?8:r<uAe?9:10},dAe={encode:Yxe,decode:eAe,encodingLength:hAe},Fb=dAe;function oC(r,e=0){return[Fb.decode(r,e),Fb.decode.bytes]}function zb(r,e,t=0){return Fb.encode(r,e,t),e}function Vb(r){return Fb.encodingLength(r)}function aC(r,e){const t=e.byteLength,n=Vb(r),s=n+Vb(t),i=new Uint8Array(s+t);return zb(r,i,0),zb(t,i,n),i.set(e,s),new xP(r,t,e,i)}function kf(r){const e=EP(r),[t,n]=oC(e),[s,i]=oC(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new xP(t,s,o,e)}function fAe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&zxe(r.bytes,t.bytes)}}let xP=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function S$(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return gAe(t,cC(r),e??Ml.encoder);default:return yAe(t,cC(r),e??m4.encoder)}}const C$=new WeakMap;function cC(r){const e=C$.get(r);if(e==null){const t=new Map;return C$.set(r,t),t}return e}var gV;let AP=class xn{constructor(e,t,n,s){h(this,"code");h(this,"version");h(this,"multihash");h(this,"bytes");h(this,"/");h(this,gV,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Qg)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==mAe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return xn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=aC(e,t);return xn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return xn.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&fAe(e.multihash,n.multihash)}toString(e){return S$(this,e)}toJSON(){return{"/":S$(this)}}link(){return this}[(gV=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof xn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new xn(n,s,i,o??I$(n,s,i.bytes))}else if(t[wAe]===!0){const{version:n,multihash:s,code:i}=t,o=kf(s);return xn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Qg)throw new Error(`Version 0 CID must use dag-pb (code: ${Qg}) block encoding`);return new xn(e,t,n,n.bytes)}case 1:{const s=I$(e,t,n.bytes);return new xn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return xn.create(0,Qg,e)}static createV1(e,t){return xn.create(1,e,t)}static decode(e){const[t,n]=xn.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=xn.inspectBytes(e),n=t.size-t.multihashSize,s=EP(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new xP(t.multihashCode,t.digestSize,i,s);return[t.version===0?xn.createV0(o):xn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=oC(e.subarray(t));return t+=p,d};let s=n(),i=Qg;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,s]=pAe(e,t),i=xn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return cC(i).set(n,e),i}};function pAe(r,e){switch(r[0]){case"Q":{const t=e??Ml;return[Ml.prefix,t.decode(`${Ml.prefix}${r}`)]}case Ml.prefix:{const t=e??Ml;return[Ml.prefix,t.decode(r)]}case m4.prefix:{const t=e??m4;return[m4.prefix,t.decode(r)]}case wE.prefix:{const t=e??wE;return[wE.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function gAe(r,e,t){const{prefix:n}=t;if(n!==Ml.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s}function yAe(r,e,t){const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s}const Qg=112,mAe=18;function I$(r,e,t){const n=Vb(r),s=n+Vb(e),i=new Uint8Array(s+t.byteLength);return zb(r,i,0),zb(e,i,n),i.set(t,s),i}const wAe=Symbol.for("@ipld/js-cid/CID"),bAe=85;function vAe({name:r,code:e,encode:t}){return new EAe(r,e,t)}let EAe=class{constructor(e,t,n){h(this,"name");h(this,"code");h(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?aC(this.code,t):t.then(n=>aC(this.code,n))}else throw Error("Unknown type, must be binary type")}};function xAe(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const RY=vAe({name:"sha2-256",code:18,encode:xAe("SHA-256")}),AAe=he("/pk/");function SAe(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{const[[t,n]]=e.stringTuples();if(t===53||t===54||t===55)return n!=="localhost";if(t!==4&&t!==6||n==null)return!1;const s=ah(n);return s==null?!0:!s})}}async function Ny(r){return(await RY.digest(r)).digest}async function ko(r){return Ny(r.toMultihash().bytes)}function B2(r,e){return new Dt(`${r}/${ce(e,"base32")}`,!1)}function CAe(r){return Cr([AAe,r.toMultihash().bytes])}function IAe(r){return ce(r.subarray(0,4))==="/pk/"}function kAe(r){const e=kf(r.subarray(4));return ri(e)}function k$(r,e){const t=new Date;return new Li(r,e,t).serialize()}const TAe=290,_Ae=54,PAe=55,NAe=56,DAe=4,OAe=41;function RAe(r){const e=r.stringTuples();for(const t of e)if(t[0]===TAe)return!1;if(e[0][0]===_Ae||e[0][0]===PAe||e[0][0]===NAe)return!0;if(e[0][0]===DAe||e[0][0]===OAe){const t=ah(`${e[0][1]}`);return t==null||!t}return!1}function BY(r){const e=r.toString().split("/"),t=e.pop(),n=e.pop();if(t==null||n==null)throw new Error(`incorrectly formatted provider entry key in datastore: ${r.toString()}`);return{cid:AP.createV1(bAe,kf(he(n,"base32"))),peerId:mr(t)}}function bE(r,e,t){const n=typeof e=="string"?e:ce(e.multihash.bytes,"base32"),s=[r,n];return t!=null&&s.push(t.toString()),new Dt(s.join("/"))}function MY(r){return new Date(Po(r))}function Wf(r,e,t){return async function*(...n){var a,c,l,u,d;const s=(a=e.queryTime)==null?void 0:a.timer(t),i=(c=e.errorTime)==null?void 0:c.timer(t);let o=!1;try{(l=e.queries)==null||l.increment({[t]:!0}),yield*r(...n)}catch(p){throw o=!0,i==null||i(),(u=e.errors)==null||u.increment({[t]:!0}),p}finally{(d=e.queries)==null||d.decrement({[t]:!0}),o||s==null||s()}}}function $Y(r,e,t){return async function(...n){var a,c,l,u,d;const s=(a=e==null?void 0:e.queryTime)==null?void 0:a.timer(t),i=(c=e==null?void 0:e.errorTime)==null?void 0:c.timer(t);let o=!1;try{return(l=e.queries)==null||l.increment({[t]:!0}),await r(...n)}catch(p){throw o=!0,i==null||i(),(u=e.errors)==null||u.increment({[t]:!0}),p}finally{(d=e.queries)==null||d.decrement({[t]:!0}),o||s==null||s()}}}class BAe{constructor(e,t){h(this,"log");h(this,"components");h(this,"validators");h(this,"selectors");h(this,"peerRouting");h(this,"queryManager");h(this,"network");h(this,"datastorePrefix");var l,u;const{validators:n,selectors:s,peerRouting:i,queryManager:o,network:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-fetching`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n,this.selectors=s,this.peerRouting=i,this.queryManager=o,this.network=a,this.get=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.get",this.get.bind(this),{optionsIndex:1}))??this.get,this.put=((u=e.metrics)==null?void 0:u.traceFunction("libp2p.kadDHT.put",this.put.bind(this),{optionsIndex:2}))??this.put}async getLocal(e){this.log("getLocal %b",e);const t=B2(this.datastorePrefix,e);this.log("fetching record for key %k",t);const n=await this.components.datastore.get(t);this.log("found %k in local datastore",t);const s=Li.deserialize(n);return await vP(this.validators,s),s}async*sendCorrectionRecord(e,t,n,s={}){this.log("sendCorrection for %b",e);const i=k$(e,n);for(const{value:o,from:a}of t){if(rt(o,n)){this.log("record was ok");continue}if(this.components.peerId.equals(a)){try{const u=B2(this.datastorePrefix,e);this.log(`Storing corrected record for key ${u.toString()}`),await this.components.datastore.put(u,i.subarray())}catch(u){this.log.error("Failed error correcting self",u)}continue}let c=!1;const l={type:Bt.PUT_VALUE,key:e,record:i};for await(const u of this.network.sendRequest(a,l,s))u.name==="PEER_RESPONSE"&&u.record!=null&&rt(u.record.value,Li.deserialize(i).value)&&(c=!0),yield u;c||(yield ju({from:a,error:new Lb("Value not put correctly")},s)),this.log.error("Failed error correcting entry")}}async*put(e,t,n={}){this.log("put key %b value %b",e,t);const s=k$(e,t),i=B2(this.datastorePrefix,e);this.log(`storing record for key ${i.toString()}`),await this.components.datastore.put(i,s.subarray()),yield*Jn(this.peerRouting.getClosestPeers(e,{...n,signal:n.signal}),o=>J1(o,a=>async()=>{if(a.name!=="FINAL_PEER")return[a];const c=[],l={type:Bt.PUT_VALUE,key:e,record:s};this.log("send put to %p",a.peer.id);for await(const u of this.network.sendRequest(a.peer.id,l,n))c.push(u),u.name==="PEER_RESPONSE"&&(u.record!=null&&rt(u.record.value,Li.deserialize(s).value)||c.push(ju({from:a.peer.id,error:new Lb("Value not put correctly")},n)));return c}),o=>Km(o,{ordered:!1,concurrency:bP}),async function*(o){for await(const a of o)yield*a})}async*get(e,t={}){this.log("get %b",e);const n=[];for await(const a of this.getMany(e,t))a.name==="VALUE"&&n.push(a),yield a;if(n.length===0)return;const s=n.map(a=>a.value);let i=0;try{i=Mxe(this.selectors,e,s)}catch(a){if(a.name!=="InvalidParametersError")throw a}const o=s[i];if(this.log("GetValue %b %b",e,o),o==null)throw new vr("Best value was not found");yield*this.sendCorrectionRecord(e,n,o,t),yield n[i]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{const i=await this.getLocal(e);yield sC({value:i.value,from:this.components.peerId},t)}catch(i){this.log("error getting local value for %b",e,i)}const n=this,s=async function*({peer:i,signal:o}){for await(const a of n.peerRouting.getValueOrPeers(i,e,{...t,signal:o}))yield a,a.name==="PEER_RESPONSE"&&a.record!=null&&(yield sC({from:i,value:a.record.value},t))};yield*this.queryManager.run(e,s,t)}}function MAe(r,e){return{id:r.id.toMultihash().bytes,multiaddrs:(r.multiaddrs??[]).map(n=>n.bytes),connection:e}}function p3(r){if(r.id==null)throw new Error("Invalid peer in message");const e=kf(r.id);return{id:ri(e),multiaddrs:(r.multiaddrs??[]).map(t=>Ve(t))}}class $Ae{constructor(e,t){h(this,"log");h(this,"components");h(this,"network");h(this,"peerRouting");h(this,"queryManager");h(this,"routingTable");h(this,"providers");var l,u;const{network:n,peerRouting:s,queryManager:i,routingTable:o,providers:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-routing`),this.network=n,this.peerRouting=s,this.queryManager=i,this.routingTable=o,this.providers=a,this.findProviders=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(d,p)=>(d.name==="PROVIDER"&&(p.providers??(p.providers=[]),p.providers.push(...d.providers.map(y=>y.id.toString()))),p)}))??this.findProviders,this.provide=((u=e.metrics)==null?void 0:u.traceFunction("libp2p.kadDHT.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(d,p)=>(d.name==="PEER_RESPONSE"&&d.messageName==="ADD_PROVIDER"&&(p.providers??(p.providers=[]),p.providers.push(d.from.toString())),p)}))??this.provide}async*provide(e,t,n={}){this.log("provide %s",e);const s=e.multihash.bytes;await this.providers.addProvider(e,this.components.peerId);const i={type:Bt.ADD_PROVIDER,key:s,providers:[MAe({id:this.components.peerId,multiaddrs:t})]};let o=0;const a=c=>async()=>{if(c.name!=="FINAL_PEER")return[c];const l=[];this.log("putProvider %s to %p",e,c.peer.id);try{this.log("sending provider record for %s to %p",e,c.peer.id);for await(const u of this.network.sendMessage(c.peer.id,i,n))u.name==="PEER_RESPONSE"&&(this.log("sent provider record for %s to %p",e,c.peer.id),o++),l.push(u)}catch(u){this.log.error("error sending provide record to peer %p",c.peer.id,u),l.push(ju({from:c.peer.id,error:u},n))}return l};yield*Jn(this.peerRouting.getClosestPeers(s,n),c=>J1(c,l=>a(l)),c=>Km(c,{ordered:!1,concurrency:bP}),async function*(c){for await(const l of c)yield*l}),this.log("sent provider records to %d peers",o)}async*findProviders(e,t){const n=this.routingTable.kBucketSize;let s=0;const i=e.multihash.bytes,o=this;this.log("findProviders %c",e);const a=await this.providers.getProviders(e);if(a.length>0){const u=[];for(const d of a.slice(0,n))try{const p=await this.components.peerStore.get(d);u.push({id:d,multiaddrs:p.addresses.map(({multiaddr:y})=>y)})}catch(p){if(p.name!=="NotFoundError")throw p;this.log("no peer store entry for %p",d)}if(yield nC({from:this.components.peerId,messageType:Bt.GET_PROVIDERS,providers:u},t),yield v$({from:this.components.peerId,providers:u},t),s+=u.length,s>=n)return}const c=async function*({peer:u,signal:d}){const p={type:Bt.GET_PROVIDERS,key:i};yield*o.network.sendRequest(u,p,{...t,signal:d})},l=new Eo(a);for await(const u of this.queryManager.run(i,c,t))if(yield u,u.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",u.providers.length,e,u.closer.length);const d=[];for(const p of u.providers)l.has(p.id)||(l.add(p.id),d.push(p));if(d.length>0&&(yield v$({from:u.from,providers:d},t),s+=d.length,s>=n))return}}}class vE{constructor(e){h(this,"movingAverage");h(this,"variance");h(this,"deviation");h(this,"forecast");h(this,"timeSpan");h(this,"previousTime");this.timeSpan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timeSpan)}push(e,t=Date.now()){if(this.previousTime!=null){const n=this.alpha(t,this.previousTime),s=e-this.movingAverage,i=n*s;this.movingAverage=n*e+(1-n)*this.movingAverage,this.variance=(1-n)*(this.variance+s*i),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+n*s}else this.movingAverage=e;this.previousTime=t}}const LAe=1.2,UAe=2,FAe=2e3;class Dy{constructor(e={}){h(this,"success");h(this,"failure");h(this,"next");h(this,"metric");h(this,"timeoutMultiplier");h(this,"failureMultiplier");h(this,"minTimeout");var t;this.success=new vE(e.interval??5e3),this.failure=new vE(e.interval??5e3),this.next=new vE(e.interval??5e3),this.failureMultiplier=e.failureMultiplier??UAe,this.timeoutMultiplier=e.timeoutMultiplier??LAe,this.minTimeout=e.minTimeout??FAe,e.metricName!=null&&(this.metric=(t=e.metrics)==null?void 0:t.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){const t=Math.max(Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier)),this.minTimeout),n=AbortSignal.timeout(t),s=At([e.signal,n]);return s.start=Date.now(),s.timeout=t,s}cleanUp(e){var n,s;const t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),(n=this.metric)==null||n.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),(s=this.metric)==null||s.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}}class zAe{constructor(){h(this,"readNext");h(this,"haveNext");h(this,"ended");h(this,"nextResult");this.ended=!1,this.readNext=He(),this.haveNext=He()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=He(),e}async throw(e){return this.ended=!0,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=He(),await Vn(this.readNext.promise,t==null?void 0:t.signal,t)}}function VAe(){return new zAe}let HAe=class extends Error{constructor(){super(...arguments);h(this,"name","UnexpectedEOFError");h(this,"code","ERR_UNEXPECTED_EOF")}};class KAe extends Error{constructor(t,n){super(t);h(this,"code");this.code=n}}let GAe=class extends KAe{constructor(t){super(t,"ABORT_ERR");h(this,"type");this.type="aborted",this.name="AbortError"}};function jAe(r,e){const t=VAe();r.sink(t).catch(async o=>{await t.end(o)}),r.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());const s=new Ge;return{read:async(o,a)=>{var u,d;(u=a==null?void 0:a.signal)==null||u.throwIfAborted();let c;const l=new Promise((p,y)=>{var f;c=()=>{y(new GAe("Read aborted"))},(f=a==null?void 0:a.signal)==null||f.addEventListener("abort",c)});try{if(o==null){const{done:y,value:f}=await Promise.race([n.next(),l]);return y===!0?new Ge:f}for(;s.byteLength<o;){const{value:y,done:f}=await Promise.race([n.next(),l]);if(f===!0)throw new HAe("unexpected end of input");s.append(y)}const p=s.sublist(0,o);return s.consume(o),p}finally{c!=null&&((d=a==null?void 0:a.signal)==null||d.removeEventListener("abort",c))}},write:async(o,a)=>{var c;(c=a==null?void 0:a.signal)==null||c.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(s.byteLength>0){const o=r.source;r.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield s:yield*s,yield*o}()}return r}}}let qAe=class extends Error{constructor(){super(...arguments);h(this,"name","InvalidMessageLengthError");h(this,"code","ERR_INVALID_MSG_LENGTH")}},WAe=class extends Error{constructor(){super(...arguments);h(this,"name","InvalidDataLengthError");h(this,"code","ERR_MSG_DATA_TOO_LONG")}},QAe=class extends Error{constructor(){super(...arguments);h(this,"name","InvalidDataLengthLengthError");h(this,"code","ERR_MSG_LENGTH_TOO_LONG")}};function JAe(r,e={}){const t=jAe(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=kt(e.maxDataLength));const n=(e==null?void 0:e.lengthDecoder)??Po,s=(e==null?void 0:e.lengthEncoder)??Jr;return{read:async o=>{let a=-1;const c=new Ge;for(;;){c.append(await t.read(1,o));try{a=n(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new qAe("Invalid message length");if((e==null?void 0:e.maxLengthLength)!=null&&c.byteLength>e.maxLengthLength)throw new QAe("message length length too long");if(a>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&a>e.maxDataLength)throw new WAe("message length too long");return t.read(a,o)},write:async(o,a)=>{await t.write(new Ge(s(o.byteLength),o),a)},writeV:async(o,a)=>{const c=new Ge(...o.flatMap(l=>[s(l.byteLength),l]));await t.write(c,a)},unwrap:()=>t.unwrap()}}function T$(r,e){const t=JAe(r,e),n={read:async(s,i)=>{const o=await t.read(i);return s.decode(o)},write:async(s,i,o)=>{await t.write(i.encode(s),o)},writeV:async(s,i,o)=>{await t.writeV(s.map(a=>i.encode(a)),o)},pb:s=>({read:async i=>n.read(s,i),write:async(i,o)=>n.write(i,s,o),writeV:async(i,o)=>n.writeV(i,s,o),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}let YAe=class extends Er{constructor(t,n){var s,i,o,a;super();h(this,"log");h(this,"protocol");h(this,"running");h(this,"components");h(this,"timeout");h(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${n.logPrefix}:network`),this.running=!1,this.protocol=n.protocol,this.timeout=new Dy({...n.timeout??{},metrics:t.metrics,metricName:`${n.metricsPrefix}_network_message_send_times_milliseconds`}),this.metrics={operations:(s=t.metrics)==null?void 0:s.registerCounterGroup(`${n.metricsPrefix}_outbound_rpc_requests_total`),errors:(i=t.metrics)==null?void 0:i.registerCounterGroup(`${n.metricsPrefix}_outbound_rpc_errors_total`)},this.sendRequest=((o=t.metrics)==null?void 0:o.traceFunction("libp2p.kadDHT.sendRequest",this.sendRequest.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],u){return{...u,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((u,d)=>{l[`providers-${d}`]=u.id.toString()}),c.closer.length>0&&c.closer.forEach((u,d)=>{l[`closer-${d}`]=u.id.toString()})),l)}))??this.sendRequest,this.sendMessage=((a=t.metrics)==null?void 0:a.traceFunction("libp2p.kadDHT.sendMessage",this.sendMessage.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],u){return{...u,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((u,d)=>{l[`providers-${d}`]=u.id.toString()}),c.closer.length>0&&c.closer.forEach((u,d)=>{l[`closer-${d}`]=u.id.toString()})),l)}))??this.sendMessage}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(t,n,s={}){var c,l,u;if(!this.running)return;const i=n.type;if(i==null)throw new ie("Message type was missing");this.log("sending %s to %p",n.type,t),yield E$({peer:t},s),yield b$({to:t,type:i},s);let o;const a=this.timeout.getTimeoutSignal(s);s={...s,signal:a};try{(c=this.metrics.operations)==null||c.increment({[i]:!0}),o=await(await this.components.connectionManager.openConnection(t,s)).newStream(this.protocol,s);const p=await this._writeReadMessage(o,n,s);o.close(s).catch(y=>{this.log.error("error closing stream to %p",t,y),o==null||o.abort(y)}),yield nC({from:t,messageType:p.type,closer:p.closer.map(p3),providers:p.providers.map(p3),record:p.record==null?void 0:Li.deserialize(p.record)},s)}catch(d){(l=this.metrics.errors)==null||l.increment({[i]:!0}),o==null||o.abort(d),((u=s.signal)==null?void 0:u.aborted)!==!0&&this.log.error("could not send %s to %p - %e",n.type,t,d),yield ju({from:t,error:d},s)}finally{this.timeout.cleanUp(a)}}async*sendMessage(t,n,s={}){var c,l;if(!this.running)return;const i=n.type;if(i==null)throw new ie("Message type was missing");this.log("sending %s to %p",n.type,t),yield E$({peer:t},s),yield b$({to:t,type:i},s);let o;const a=this.timeout.getTimeoutSignal(s);s={...s,signal:a};try{(c=this.metrics.operations)==null||c.increment({[i]:!0}),o=await(await this.components.connectionManager.openConnection(t,s)).newStream(this.protocol,s),await this._writeMessage(o,n,s),o.close(s).catch(d=>{this.log.error("error closing stream to %p",t,d),o==null||o.abort(d)}),yield nC({from:t,messageType:i},s)}catch(u){(l=this.metrics.errors)==null||l.increment({[i]:!0}),o==null||o.abort(u),yield ju({from:t,error:u},s)}finally{this.timeout.cleanUp(a)}}async _writeMessage(t,n,s){await T$(t).write(n,Nd,s)}async _writeReadMessage(t,n,s){const i=T$(t);await i.write(n,Nd,s);const o=await i.read(Nd,s);return o.closer.forEach(a=>{this.safeDispatchEvent("peer",{detail:p3(a)})}),o.providers.forEach(a=>{this.safeDispatchEvent("peer",{detail:p3(a)})}),o}};function Oy(r,e){if(r.byteLength!==e.byteLength)throw new Error("Inputs should have the same length");for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}class SP{constructor(e,t){h(this,"originDhtKey");h(this,"capacity");h(this,"peerDistances");this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peer)}async add(e){const t=await ko(e.id);this.addWithKadId(e,t)}addWithKadId(e,t){if(this.peerDistances.find(i=>i.peer.id.equals(e.id))!=null)return;const n={peer:e,distance:Ku(this.originDhtKey,t)};let s=!1;for(let i=0;i<this.peerDistances.length;i++){const o=Oy(this.peerDistances[i].distance,n.distance);if(o===0||o===1){s=!0,this.peerDistances.splice(i,0,n);break}}s||this.peerDistances.push(n),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async isCloser(e){if(this.length===0)return!0;const t=await ko(e),n=Ku(t,this.originDhtKey),s=this.peerDistances[this.peerDistances.length-1].distance;return Oy(n,s)===-1}async anyCloser(e){return e.length===0?!1:Promise.any(e.map(async t=>this.isCloser(t)))}}class XAe{constructor(e,t){h(this,"log");h(this,"routingTable");h(this,"network");h(this,"validators");h(this,"queryManager");h(this,"peerStore");h(this,"peerId");var n,s;this.routingTable=t.routingTable,this.network=t.network,this.validators=t.validators,this.queryManager=t.queryManager,this.peerStore=e.peerStore,this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:peer-routing`),this.findPeer=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.kadDHT.findPeer",this.findPeer.bind(this),{optionsIndex:1}))??this.findPeer,this.getClosestPeers=((s=e.metrics)==null?void 0:s.traceFunction("libp2p.kadDHT.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1}))??this.getClosestPeers}async findPeerLocal(e){let t;const n=await this.routingTable.find(e);if(n!=null){this.log("findPeerLocal found %p in routing table",e);try{t=await this.peerStore.get(n)}catch(s){if(s.name!=="NotFoundError")throw s}}if(t==null)try{t=await this.peerStore.get(e)}catch(s){if(s.name!=="NotFoundError")throw s}if(t!=null)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(s=>s.multiaddr)}}async*_getValueSingle(e,t,n={}){const s={type:Bt.GET_VALUE,key:t};yield*this.network.sendRequest(e,s,n)}async*getPublicKeyFromNode(e,t={}){const n=CAe(e);for await(const s of this._getValueSingle(e,n,t))if(yield s,s.name==="PEER_RESPONSE"&&s.record!=null){const i=Is(s.record.value),o=i1(i);if(!o.equals(e))throw new py("public key does not match id");if(o.publicKey==null)throw new py("public key missing");yield sC({from:e,value:s.record.value},t)}throw new Lb(`Node not responding with its public key: ${e.toString()}`)}async*findPeer(e,t={}){if(this.log("findPeer %p",e),t.useCache!==!1){const s=await this.findPeerLocal(e);if(s!=null){this.log("found local"),yield mE({from:this.peerId,peer:s},t);return}}let n=!1;if(t.useNetwork!==!1){const s=this,i=async function*({peer:o,signal:a}){const c={type:Bt.FIND_NODE,key:e.toMultihash().bytes};for await(const l of s.network.sendRequest(o,c,{...t,signal:a}))if(yield l,l.name==="PEER_RESPONSE"){const u=l.closer.find(d=>d.id.equals(e));u!=null&&(yield mE({from:l.from,peer:u},t))}};for await(const o of this.queryManager.run(e.toMultihash().bytes,i,t))o.name==="FINAL_PEER"&&(n=!0),yield o}n||(yield ju({from:this.peerId,error:new vr("Not found")},t))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);const n=await Ny(e),s=this.routingTable.closestPeers(n),i=this,o=new SP(n,this.routingTable.kBucketSize);await Promise.all(s.map(async c=>{await o.add({id:c,multiaddrs:[]})}));const a=async function*({peer:c,signal:l}){i.log("closerPeersSingle %s from %p",ce(e,"base32"),c);const u={type:Bt.FIND_NODE,key:e};yield*i.network.sendRequest(c,u,{...t,signal:l})};for await(const c of this.queryManager.run(e,a,t))c.name==="PEER_RESPONSE"&&await Promise.all(c.closer.map(async l=>{await o.add(l)})),yield c;this.log("found %d peers close to %b",o.length,e);for(const c of o.peers)yield mE({from:this.peerId,peer:c},t)}async*getValueOrPeers(e,t,n={}){for await(const s of this._getValueSingle(e,t,n)){if(s.name==="PEER_RESPONSE"&&s.record!=null)try{await this._verifyRecordOnline(s.record)}catch{const o="invalid record received, discarded";this.log(o),yield ju({from:s.from,error:new Lb(o)},n);continue}yield s}}async _verifyRecordOnline(e){if(e.timeReceived==null)throw new Rxe("invalid record received");await vP(this.validators,new Li(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){const n=[];try{const c=kf(e),l=ri(c),u=await this.peerStore.get(l);n.push({id:u.id,multiaddrs:u.addresses.map(({multiaddr:d})=>d)})}catch{}const s=await Ny(e),i=this.routingTable.closestPeers(s),o=await ko(t),a=Ku(o,s);for(const c of i){const l=await ko(c),u=Ku(l,s);if(Oy(u,a)===-1)try{const d=await this.peerStore.get(c);n.push({id:c,multiaddrs:d.addresses.map(({multiaddr:p})=>p)})}catch(d){if(d.name!=="NotFoundError")throw d}}return n.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",n.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p with %d peers in the routing table",e,t,this.routingTable.size),n}}class ZAe{constructor(e,t){h(this,"log");h(this,"datastore");h(this,"datastorePrefix");h(this,"lock");this.log=e.logger.forComponent(`${t.logPrefix}:providers`),this.datastorePrefix=`${t.datastorePrefix}/provider`,this.datastore=e.datastore,this.lock=t.lock}async addProvider(e,t){const n=await this.lock.readLock();try{this.log("%p provides %s",t,e),await this.writeProviderEntry(e,t)}finally{n()}}async removeProvider(e,t){const n=await this.lock.writeLock();try{const s=bE(this.datastorePrefix,e,t);this.log("%p no longer provides %s",t,e),await this.datastore.delete(s)}finally{n()}}async getProviders(e){const t=await this.lock.readLock();try{this.log("get providers for %c",e);const n=await this.loadProviders(e);return this.log("got %d providers for %c",n.size,e),[...n.keys()]}finally{t()}}async writeProviderEntry(e,t,n=new Date){const s=bE(this.datastorePrefix,e,t),i=Jr(n.getTime());await this.datastore.put(s,i)}async loadProviders(e){const t=new oh,n=bE(this.datastorePrefix,e);for await(const s of this.datastore.query({prefix:n.toString()})){const{peerId:i}=BY(s.key);t.set(i,MY(s.value))}return t}}async function*eSe(r){const{key:e,startingPeer:t,ourPeerId:n,signal:s,query:i,alpha:o,pathIndex:a,numPaths:c,queryFuncTimeout:l,log:u,peersSeen:d,connectionManager:p}=r,y=new Gd({concurrency:o,sort:(w,m)=>Oy(w.options.distance,m.options.distance)}),f=await Ny(e);function g(w,m){if(w==null)return;d.add(w);const b=Ku(m,f);y.add(async()=>{const v=[s];l!=null&&v.push(AbortSignal.timeout(l));const E=At(v);try{for await(const S of i({...r,key:e,peer:w,signal:E,pathIndex:a,numPaths:c})){if(E.aborted)return;if(S.name==="PEER_RESPONSE")for(const I of S.closer){if(d.has(I.id)){u.trace("already seen %p in query",I.id);continue}if(n.equals(I.id)){u("not querying ourselves");continue}if(!await p.isDialable(I.multiaddrs)){u("not querying undialable peer");continue}const x=await ko(I.id),C=Ku(x,f);if(Oy(C,b)!==-1){u.trace("skipping %p as they are not closer to %b than %p",I.id,e,w);continue}u.trace("querying closer peer %p",I.id),g(I.id,x)}y.safeDispatchEvent("completed",{detail:S})}}catch(S){if(!s.aborted)return ju({from:w,error:S},r)}finally{E.clear()}},{distance:b}).catch(v=>{u.error(v)})}g(t,await ko(t));try{for await(const w of y.toGenerator({signal:s}))w!=null&&(yield w)}catch(w){throw s.aborted?new Oxe("Query aborted"):w}}class tSe{constructor(e,t){h(this,"disjointPaths");h(this,"alpha");h(this,"shutDownController");h(this,"running");h(this,"logger");h(this,"peerId");h(this,"connectionManager");h(this,"routingTable");h(this,"initialQuerySelfHasRun");h(this,"logPrefix");this.logPrefix=t.logPrefix,this.disjointPaths=t.disjointPaths??PY,this.alpha=t.alpha??bP,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.shutDownController=new AbortController,this.shutDownController.signal,this.running=!1}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutDownController=new AbortController,this.shutDownController.signal,void 0)}async stop(){this.running=!1,this.shutDownController.abort()}async*run(e,t,n={}){if(!this.running)throw new Error("QueryManager not started");if(n.signal==null){const c=AbortSignal.timeout(Pxe);n={...n,signal:c}}const s=new AbortController,i=At([this.shutDownController.signal,s.signal,n.signal]);s.signal;const o=this.logger.forComponent(`${this.logPrefix}:query:`+ce(e,"base58btc"));let a=!1;try{n.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(o("waiting for initial query-self query before continuing"),await Vn(this.initialQuerySelfHasRun.promise,i),this.initialQuerySelfHasRun=void 0),o("query:start");const c=await Ny(e),l=this.routingTable.closestPeers(c),u=l.slice(0,Math.min(this.disjointPaths,l.length));if(l.length===0){o.error("Running query with no peers");return}const d=new Eo,p=u.map((y,f)=>eSe({...n,key:e,startingPeer:y,ourPeerId:this.peerId,signal:i,query:t,pathIndex:f,numPaths:u.length,alpha:this.alpha,queryFuncTimeout:n.queryFuncTimeout,log:o,peersSeen:d,onProgress:n.onProgress,connectionManager:this.connectionManager}));for await(const y of Su(...p)){if(y.name==="QUERY_ERROR"&&o.error("query error",y.error),y.name==="PEER_RESPONSE")for(const f of[...y.closer,...y.providers])await this.connectionManager.isDialable(f.multiaddrs)&&await this.routingTable.add(f.id);yield y}a=!0}catch(c){if(!(!this.running&&c.name==="QueryAbortedError"))throw c}finally{a||(o("query exited early"),s.abort()),i.clear(),o("query:done")}}}function rSe(r){return r[Symbol.asyncIterator]!=null}function LY(r){if(rSe(r))return(async()=>{let e=0;for await(const t of r)e++;return e})();{let e=0;for(const t of r)e++;return e}}const nSe=r=>{const e=r.addEventListener||r.on||r.addListener,t=r.removeEventListener||r.off||r.removeListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function sSe(r,e,t){let n;const s=new Promise((i,o)=>{var y;if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");(y=t.signal)==null||y.throwIfAborted();const a=[e].flat(),c=[],{addListener:l,removeListener:u}=nSe(r),d=(...f)=>{const g=t.multiArgs?f:f[0];t.filter&&!t.filter(g)||(c.push(g),t.count===c.length&&(n(),i(c)))},p=f=>{n(),o(f)};n=()=>{for(const f of a)u(f,d);for(const f of t.rejectionEvents)u(f,p)};for(const f of a)l(f,d);for(const f of t.rejectionEvents)l(f,p);t.signal&&t.signal.addEventListener("abort",()=>{p(t.signal.reason)},{once:!0}),t.resolveImmediately&&i(c)});if(s.cancel=n,typeof t.timeout=="number"){const i=Im(s,{milliseconds:t.timeout});return i.cancel=n,i}return s}function iSe(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};const n=sSe(r,e,t),s=n.then(i=>i[0]);return s.cancel=n.cancel,s}class oSe{constructor(e,t){h(this,"log");h(this,"peerId");h(this,"peerRouting");h(this,"routingTable");h(this,"count");h(this,"interval");h(this,"initialInterval");h(this,"queryTimeout");h(this,"running");h(this,"timeoutId");h(this,"controller");h(this,"initialQuerySelfHasRun");h(this,"querySelfPromise");this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:query-self`),this.running=!1,this.peerRouting=t.peerRouting,this.routingTable=t.routingTable,this.count=t.count??PY,this.interval=t.interval??Cxe,this.initialInterval=t.initialInterval??Ixe,this.queryTimeout=t.queryTimeout??kxe,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.querySelf=$Y(this.querySelf.bind(this),t.operationMetrics,"SELF_QUERY")}isStarted(){return this.running}start(){this.running||(this.running=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.initialInterval))}stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}async querySelf(){if(!this.running){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=He(),this.running){this.controller=new AbortController;const e=[this.controller.signal];if(this.initialQuerySelfHasRun==null){const n=AbortSignal.timeout(this.queryTimeout);e.push(n)}const t=At(e);this.controller.signal;try{this.routingTable.size===0&&(this.log("routing table was empty, waiting for some peers before running query"),await iSe(this.routingTable,"peer:add",{signal:t,filter:i=>!this.peerId.equals(i.detail)}),this.log("routing table has peers, continuing with query")),this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);const n=Date.now(),s=await Jn(this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes,{signal:t,isSelfQuery:!0}),i=>R8(i,this.count),async i=>LY(i));this.log("self-query found %d peers in %dms",s,Date.now()-n)}catch(n){this.log.error("self-query error",n)}finally{t.clear(),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.running&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.interval))}}class aSe extends Er{constructor(t,n){super();h(this,"log");h(this,"reprovideQueue");h(this,"maxQueueSize");h(this,"datastore");h(this,"timeout");h(this,"reprovideTimeout");h(this,"running");h(this,"shutdownController");h(this,"reprovideThreshold");h(this,"contentRouting");h(this,"datastorePrefix");h(this,"addressManager");h(this,"validity");h(this,"interval");h(this,"lock");h(this,"peerId");this.log=t.logger.forComponent(`${n.logPrefix}:reprovider`),this.peerId=t.peerId,this.reprovideQueue=new Gd({concurrency:n.concurrency??xxe,metrics:t.metrics,metricName:`${n.metricsPrefix}_reprovide_queue`}),this.reprovideTimeout=new Dy({...n.timeout??{},metrics:t.metrics,metricName:`${n.metricsPrefix}_reprovide_timeout_milliseconds`}),this.datastore=t.datastore,this.addressManager=t.addressManager,this.datastorePrefix=`${n.datastorePrefix}/provider`,this.reprovideThreshold=n.threshold??Exe,this.maxQueueSize=n.maxQueueSize??Axe,this.validity=n.validity??vxe,this.interval=n.interval??Sxe,this.contentRouting=n.contentRouting,this.lock=n.lock,this.running=!1,this.reprovide=$Y(this.reprovide.bind(this),n.operationMetrics,"PROVIDE")}start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,this.timeout=setTimeout(()=>{this.cleanUp().catch(t=>{this.log.error("error running reprovide/cleanup - %e",t)})},this.interval))}stop(){var t;this.running=!1,this.reprovideQueue.clear(),clearTimeout(this.timeout),(t=this.shutdownController)==null||t.abort()}async cleanUp(){const t=await this.lock.writeLock();try{this.safeDispatchEvent("reprovide:start");for await(const n of this.datastore.query({prefix:this.datastorePrefix}))try{const{cid:s,peerId:i}=BY(n.key),o=MY(n.value).getTime(),a=o+this.validity,c=Date.now(),l=c>a;this.log.trace("comparing: %d < %d = %s %s",o,c-this.validity,l,l?"(expired)":""),l&&await this.datastore.delete(n.key),this.peerId.equals(i)&&c-a<this.reprovideThreshold&&this.queueReprovide(s).catch(u=>{this.log.error("could not reprovide %c - %e",s,u)})}catch(s){this.log.error("error processing datastore key %s - %e",n.key,s.message)}this.log("reprovide/cleanup successful")}finally{t(),this.safeDispatchEvent("reprovide:end"),this.running&&(this.timeout=setTimeout(()=>{this.cleanUp().catch(n=>{this.log.error("error running re-provide - %e",n)})},this.interval))}}async queueReprovide(t){var s;if(!this.running)return;this.log.trace("waiting for queue capacity before adding %c to re-provide queue",t),await this.reprovideQueue.onSizeLessThan(this.maxQueueSize);const n=this.reprovideQueue.queue.find(i=>i.options.cid.equals(t));if(n!=null)return this.log.trace("not adding %c to re-provide queue - already in queue",t),n.join();this.log.trace("adding %c to re-provide queue",t),this.reprovideQueue.add(async i=>{var a;if((a=i.signal)==null||a.throwIfAborted(),!this.running)return;this.log.trace("re-providing %c",t);const o=this.reprovideTimeout.getTimeoutSignal(i);try{await this.reprovide(i.cid,i)}finally{this.reprovideTimeout.cleanUp(o)}this.log.trace("re-provided %c",t)},{signal:(s=this.shutdownController)==null?void 0:s.signal,cid:t}).catch(i=>{this.log.error("could not re-provide key %c - %e",t,i)})}async reprovide(t,n){await Dc(this.contentRouting.provide(t,this.addressManager.getAddresses(),n))}}const cSe=20,lSe=5e3,uSe="kad-close",hSe=50;class dSe{constructor(e,t){h(this,"routingTable");h(this,"components");h(this,"closestPeers");h(this,"newPeers");h(this,"refreshInterval");h(this,"peerSetSize");h(this,"timeout");h(this,"closeTagName");h(this,"closeTagValue");h(this,"log");h(this,"running");this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.routingTable=t.routingTable,this.refreshInterval=t.refreshInterval??lSe,this.peerSetSize=t.peerSetSize??cSe,this.closeTagName=t.closeTagName??uSe,this.closeTagValue=t.closeTagValue??hSe,this.closestPeers=new Eo,this.onPeerPing=this.onPeerPing.bind(this),this.running=!1}async start(){if(this.running)return;this.running=!0;const e=await ko(this.components.peerId);this.newPeers=new SP(e,this.peerSetSize),this.routingTable.addEventListener("peer:ping",this.onPeerPing),this.timeout=setInterval(()=>{this.updatePeerTags().catch(t=>{this.log.error("error updating peer tags - %e",t)})},this.refreshInterval)}stop(){this.running=!1,this.routingTable.removeEventListener("peer:ping",this.onPeerPing),clearTimeout(this.timeout)}onPeerPing(e){var t;(t=this.newPeers)==null||t.add({id:e.detail,multiaddrs:[]}).catch(n=>{this.log.error("error adding peer to distance list - %e",n)})}async updatePeerTags(){var s;const e=new Eo((s=this.newPeers)==null?void 0:s.peers.map(i=>i.id)),t=e.difference(this.closestPeers),n=this.closestPeers.difference(e);this.closestPeers=e,await Promise.all([...[...t].map(async i=>{await this.components.peerStore.merge(i,{tags:{[this.closeTagName]:{value:this.closeTagValue},[m$]:{value:1}}})}),...[...n].map(async i=>{await this.components.peerStore.merge(i,{tags:{[this.closeTagName]:void 0,[m$]:void 0}})})])}}function w4(r){return Array.isArray(r==null?void 0:r.peers)}class fSe{constructor(e){h(this,"root");h(this,"localPeer");h(this,"prefixLength");h(this,"splitThreshold");h(this,"kBucketSize");h(this,"numberOfNodesToPing");h(this,"lastPingThreshold");h(this,"ping");h(this,"verify");h(this,"onAdd");h(this,"onRemove");h(this,"onMove");h(this,"addingPeerMap");this.prefixLength=e.prefixLength??ySe,this.kBucketSize=e.kBucketSize??UY,this.splitThreshold=e.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=e.numberOfOldContactsToPing??bSe,this.lastPingThreshold=e.lastPingThreshold??ASe,this.ping=e.ping,this.verify=e.verify,this.onAdd=e.onAdd,this.onRemove=e.onRemove,this.addingPeerMap=new oh,this.root={prefix:"",depth:0,peers:[]}}async addSelfPeer(e){this.localPeer={peerId:e,kadId:await ko(e),lastPing:Date.now()}}async add(e,t){const n={peerId:e,kadId:await ko(e),lastPing:0},s=this.addingPeerMap.get(e);if(s!=null)return s;try{const i=this._add(n,t);this.addingPeerMap.set(e,i),await i}finally{this.addingPeerMap.delete(e)}}async _add(e,t){var o;const n=this._determineBucket(e.kadId);if(this._indexOf(n,e.kadId)>-1)return;if(n.peers.length===this.splitThreshold&&n.depth<this.prefixLength){await this._split(n),await this._add(e,t);return}if(n.peers.length<this.kBucketSize){if(!gSe(e,this.lastPingThreshold)){n.peers.push(e),await((o=this.onAdd)==null?void 0:o.call(this,e,n));return}await this.verify(e,t)&&(e.lastPing=Date.now(),await this._add(e,t));return}const s=n.peers.filter(a=>{var c;return!(a.peerId.equals((c=this.localPeer)==null?void 0:c.peerId)||a.lastPing>Date.now()-this.lastPingThreshold)}).sort((a,c)=>a.lastPing<c.lastPing?-1:a.lastPing>c.lastPing?1:0).slice(0,this.numberOfNodesToPing);let i=!1;for await(const a of this.ping(s,t))i=!0,await this.remove(a.kadId);i&&await this._add(e,t)}*closest(e,t=this.kBucketSize){const n=new SP(e,t);for(const s of this.toIterable())n.addWithKadId({id:s.peerId,multiaddrs:[]},s.kadId);yield*J1(n.peers,s=>s.id)}count(){function e(t){if(w4(t))return t.peers.length;let n=0;return t.left!=null&&(n+=e(t.left)),t.right!=null&&(n+=e(t.right)),n}return e(this.root)}get(e){const t=this._determineBucket(e),n=this._indexOf(t,e);return t.peers[n]}async remove(e){var s;const t=this._determineBucket(e),n=this._indexOf(t,e);if(n>-1){const i=t.peers.splice(n,1)[0];await((s=this.onRemove)==null?void 0:s.call(this,i,t))}}*toIterable(){function*e(t){if(w4(t)){yield*t.peers;return}yield*e(t.left),yield*e(t.right)}yield*e(this.root)}distance(e,t){return BigInt("0x"+ce(Ku(e,t),"base16"))}_determineBucket(e){const t=ce(e,"base2");function n(s,i=0){return w4(s)?s:t[i]==="0"?n(s.left,i+1):n(s.right,i+1)}return n(this.root)}_indexOf(e,t){return e.peers.findIndex(n=>rt(n.kadId,t))}async _split(e){var s,i;const t={prefix:"0",depth:e.depth+1,peers:[]},n={prefix:"1",depth:e.depth+1,peers:[]};for(const o of e.peers)ce(o.kadId,"base2")[e.depth]==="0"?(t.peers.push(o),await((s=this.onMove)==null?void 0:s.call(this,o,e,t))):(n.peers.push(o),await((i=this.onMove)==null?void 0:i.call(this,o,e,n)));pSe(e,t,n)}}function pSe(r,e,t){return delete r.peers,r.left=e,r.right=t,r.prefix===""&&(delete r.depth,delete r.prefix),!0}function gSe(r,e){return r.lastPing<Date.now()-e}const UY=20,ySe=6,mSe=20,wSe=100,bSe=3,vSe=20,ESe=100,_$="kad-peer",xSe=1,ASe=6e5,SSe=!0,CSe=1e3;class ISe extends Er{constructor(t,n){super();h(this,"kBucketSize");h(this,"kb");h(this,"network");h(this,"closestPeerTagger");h(this,"log");h(this,"components");h(this,"running");h(this,"pingNewContactTimeout");h(this,"pingNewContactQueue");h(this,"pingOldContactTimeout");h(this,"pingOldContactQueue");h(this,"populateFromDatastoreOnStart");h(this,"populateFromDatastoreLimit");h(this,"protocol");h(this,"peerTagName");h(this,"peerTagValue");h(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${n.logPrefix}:routing-table`),this.kBucketSize=n.kBucketSize??UY,this.running=!1,this.protocol=n.protocol,this.network=n.network,this.peerTagName=n.peerTagName??_$,this.peerTagValue=n.peerTagValue??xSe,this.pingOldContacts=this.pingOldContacts.bind(this),this.verifyNewContact=this.verifyNewContact.bind(this),this.peerAdded=this.peerAdded.bind(this),this.peerRemoved=this.peerRemoved.bind(this),this.populateFromDatastoreOnStart=n.populateFromDatastoreOnStart??SSe,this.populateFromDatastoreLimit=n.populateFromDatastoreLimit??CSe,this.pingOldContactQueue=new zu({concurrency:n.pingOldContactConcurrency??vSe,metricName:`${n.metricsPrefix}_ping_old_contact_queue`,metrics:this.components.metrics,maxSize:n.pingOldContactMaxQueueSize??ESe}),this.pingOldContactTimeout=new Dy({...n.pingOldContactTimeout??{},metrics:this.components.metrics,metricName:`${n.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`}),this.pingNewContactQueue=new zu({concurrency:n.pingNewContactConcurrency??mSe,metricName:`${n.metricsPrefix}_ping_new_contact_queue`,metrics:this.components.metrics,maxSize:n.pingNewContactMaxQueueSize??wSe}),this.pingNewContactTimeout=new Dy({...n.pingNewContactTimeout??{},metrics:this.components.metrics,metricName:`${n.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`}),this.kb=new fSe({kBucketSize:n.kBucketSize,prefixLength:n.prefixLength,splitThreshold:n.splitThreshold,numberOfOldContactsToPing:n.numberOfOldContactsToPing,lastPingThreshold:n.lastPingThreshold,ping:this.pingOldContacts,verify:this.verifyNewContact,onAdd:this.peerAdded,onRemove:this.peerRemoved}),this.closestPeerTagger=new dSe(this.components,{logPrefix:n.logPrefix,routingTable:this,peerSetSize:n.closestPeerSetSize,refreshInterval:n.closestPeerSetRefreshInterval,closeTagName:n.closeTagName,closeTagValue:n.closeTagValue}),this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMinOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),routingTableKadBucketMaxOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_max_depth`),kadBucketEvents:this.components.metrics.registerCounterGroup(`${n.metricsPrefix}_kad_bucket_events_total`)})}isStarted(){return this.running}async start(){this.running||(this.running=!0,await Oc(this.closestPeerTagger),await this.kb.addSelfPeer(this.components.peerId))}async afterStart(){Promise.resolve().then(async()=>{if(!this.populateFromDatastoreOnStart)return;let t=0;for(const n of await this.components.peerStore.all({filters:[s=>s.protocols.includes(this.protocol)&&s.tags.has(_$)],limit:this.populateFromDatastoreLimit})){if(!this.running)return;try{await this.add(n.id),t++}catch{this.log("failed to add peer %p to routing table, removing kad-dht peer tags - %e"),await this.components.peerStore.merge(n.id,{tags:{[this.peerTagName]:void 0}})}}this.log("added %d peer store peers to the routing table",t)}).catch(t=>{this.log.error("error adding peer store peers to the routing table %e",t)})}async stop(){this.running=!1,await sh(this.closestPeerTagger),this.pingOldContactQueue.abort(),this.pingNewContactQueue.abort()}async peerAdded(t,n){var s;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:{value:this.peerTagValue}}}),this.updateMetrics(),(s=this.metrics)==null||s.kadBucketEvents.increment({peer_added:!0}),this.safeDispatchEvent("peer:add",{detail:t.peerId})}async peerRemoved(t,n){var s;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:void 0}}),this.updateMetrics(),(s=this.metrics)==null||s.kadBucketEvents.increment({peer_removed:!0}),this.safeDispatchEvent("peer:remove",{detail:t.peerId})}async*pingOldContacts(t,n){var i;if(!this.running)return;const s=[];for(const o of t){if(this.kb.get(o.kadId)==null){this.log("asked to ping contact %p that was not in routing table",o.peerId);continue}(i=this.metrics)==null||i.kadBucketEvents.increment({ping_old_contact:!0}),s.push(async()=>{const a=this.pingOldContactQueue.find(o.peerId);if(a!=null)return this.log("asked to ping contact %p was already being pinged",o.peerId),await a.join(n)?void 0:o;if(!await this.pingOldContactQueue.add(async l=>{var p;const u=this.pingOldContactTimeout.getTimeoutSignal(),d=At([u,l==null?void 0:l.signal]);try{return await this.pingContact(o,l)}catch{return(p=this.metrics)==null||p.kadBucketEvents.increment({ping_old_contact_error:!0}),!0}finally{this.pingOldContactTimeout.cleanUp(u),d.clear()}},{peerId:o.peerId,signal:n==null?void 0:n.signal}))return o})}for await(const o of Km(s))o!=null&&(yield o)}async verifyNewContact(t,n){var o;const s=this.pingNewContactTimeout.getTimeoutSignal(),i=At([s,n==null?void 0:n.signal]);try{const a=this.pingNewContactQueue.find(t.peerId);return a!=null?(this.log("joining existing ping to add new peer %p to routing table",t.peerId),await a.join({signal:i})):await this.pingNewContactQueue.add(async c=>{var l;return(l=this.metrics)==null||l.kadBucketEvents.increment({ping_new_contact:!0}),this.log("pinging new peer %p before adding to routing table",t.peerId),this.pingContact(t,c)},{peerId:t.peerId,signal:i})}catch{return this.log.trace("tried to add peer %p but they were not online",t.peerId),(o=this.metrics)==null||o.kadBucketEvents.increment({ping_new_contact_error:!0}),!1}finally{this.pingNewContactTimeout.cleanUp(s),i.clear()}}async pingContact(t,n){try{this.log("pinging contact %p",t.peerId);for await(const s of this.network.sendRequest(t.peerId,{type:Bt.PING},n))if(s.type===lC.PEER_RESPONSE)return s.messageType===Bt.PING?(this.log("contact %p ping ok",t.peerId),this.safeDispatchEvent("peer:ping",{detail:t.peerId}),!0):!1;return!1}catch(s){return this.log("error pinging old contact %p - %e",t.peerId,s),!1}}get size(){return this.kb==null?0:this.kb.count()}async find(t){var s;const n=await ko(t);return(s=this.kb.get(n))==null?void 0:s.peerId}closestPeer(t){const n=this.closestPeers(t,1);if(n.length>0)return n[0]}closestPeers(t,n=this.kBucketSize){return this.kb==null?[]:[...this.kb.closest(t,n)]}async add(t,n){if(this.kb==null)throw new Error("RoutingTable is not started");await this.kb.add(t,n)}async remove(t){if(this.kb==null)throw new Error("RoutingTable is not started");const n=await ko(t);await this.kb.remove(n)}updateMetrics(){if(this.metrics==null||this.kb==null)return;let t=0,n=0,s=0,i=20,o=0;function a(c){if(w4(c)){c.depth>s&&(s=c.depth),n++,t+=c.peers.length,c.peers.length<i&&(i=c.peers.length),c.peers.length>o&&(o=c.peers.length);return}a(c.left),a(c.right)}a(this.kb.root),this.metrics.routingTableSize.update(t),this.metrics.routingTableKadBucketTotal.update(n),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(t/n)),this.metrics.routingTableKadBucketMinOccupancy.update(i),this.metrics.routingTableKadBucketMaxOccupancy.update(o),this.metrics.routingTableKadBucketMaxDepth.update(s)}}const kSe=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],g3=15;class TSe{constructor(e,t){h(this,"log");h(this,"peerRouting");h(this,"routingTable");h(this,"refreshInterval");h(this,"refreshQueryTimeout");h(this,"commonPrefixLengthRefreshedAt");h(this,"refreshTimeoutId");const{peerRouting:n,routingTable:s,refreshInterval:i,refreshQueryTimeout:o,logPrefix:a}=t;this.log=e.logger.forComponent(`${a}:routing-table:refresh`),this.peerRouting=n,this.routingTable=s,this.refreshInterval=i??Txe,this.refreshQueryTimeout=o??_xe,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async afterStart(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");const t=this._maxCommonPrefix(),n=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${n.map(s=>s.toISOString()).join(", ")} ]`),Promise.all(n.map(async(s,i)=>{try{if(await this._refreshCommonPrefixLength(i,s,e),this._numPeersForCpl(t)===0){const o=Math.min(2*(i+1),n.length-1);for(let a=i+1;a<o+1;a++)try{await this._refreshCommonPrefixLength(a,s,e)}catch(c){this.log.error(c)}}}catch(o){this.log.error(o)}})).catch(s=>{this.log.error(s)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(s=>{this.log.error(s)})}async _refreshCommonPrefixLength(e,t,n){if(!n&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}const s=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,s,this.routingTable.size);const i=AbortSignal.timeout(this.refreshQueryTimeout),o=await LY(this.peerRouting.getClosestPeers(s.toMultihash().bytes,{signal:i}));this.log(`found ${o} peers that were close to imaginary peer %p`,s),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,s,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(e){e>g3&&(e=g3);const t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}async _generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");if(this.routingTable.kb.localPeer==null)throw new Error("Local peer not set");const t=Fu(2),n=(t[1]<<8)+t[0],s=await this._makePeerId(this.routingTable.kb.localPeer.kadId,n,e),i=kf(s);return ri(i)}async _makePeerId(e,t,n){if(n>g3)throw new Error(`Cannot generate peer ID for common prefix length greater than ${g3}`);const o=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>n,a=65535<<16-(n+1),c=o&a|t&~a,l=kSe[c],u=new ArrayBuffer(34),d=new DataView(u,0,u.byteLength);return d.setUint8(0,RY.code),d.setUint8(1,32),d.setUint32(2,l,!1),new Uint8Array(d.buffer,d.byteOffset,d.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){var e;if(((e=this.routingTable.kb)==null?void 0:e.localPeer)!=null)for(const{kadId:t}of this.routingTable.kb.toIterable()){const n=Ku(this.routingTable.kb.localPeer.kadId,t);let s=0;for(const i of n)if(i===0)s++;else break;yield s}}}class _Se{constructor(e,t){h(this,"peerId");h(this,"providers");h(this,"peerStore");h(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:add-provider`),this.peerId=e.peerId,this.providers=t.providers,this.peerStore=e.peerStore}async handle(e,t){if(t.key==null||t.key.length===0)throw new Rt("Missing key");let n;try{n=AP.decode(t.key)}catch{throw new Rt("Invalid CID")}(t.providers==null||t.providers.length===0)&&this.log.error("no providers found in message"),this.log("%p asked us, %p to store provider record for for %c",e,this.peerId,n),await Promise.all(t.providers.map(async s=>{const i=kf(s.id),o=ri(i),a=s.multiaddrs.map(c=>Ve(c));if(!e.equals(o)){this.log("invalid provider peer %p from %p",s.id,e);return}if(s.multiaddrs.length<1){this.log("no valid addresses for provider %p. Ignore",e);return}this.log.trace("received provider %p for %s (addrs %s)",e,n,a),await this.providers.addProvider(n,o),await this.peerStore.merge(o,{multiaddrs:a})}))}}class PSe{constructor(e,t){h(this,"peerRouting");h(this,"peerInfoMapper");h(this,"peerId");h(this,"addressManager");h(this,"log");const{peerRouting:n,logPrefix:s}=t;this.log=e.logger.forComponent(`${s}:rpc:handlers:find-node`),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=n,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(this.log("incoming request from %p for peers closer to %b",e,t.key),t.key==null)throw new Rt("Invalid FIND_NODE message received - key was missing");const n=await this.peerRouting.getCloserPeersOffline(t.key,e);rt(this.peerId.toMultihash().bytes,t.key)&&n.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(i=>i.decapsulateCode(We("p2p").code))});const s={type:Bt.FIND_NODE,clusterLevel:t.clusterLevel,closer:n.map(this.peerInfoMapper).filter(({multiaddrs:i})=>i.length).map(i=>({id:i.id.toMultihash().bytes,multiaddrs:i.multiaddrs.map(o=>o.bytes)})),providers:[]};return s.closer.length===0&&this.log("could not find any peers closer to %b than %p",t.key,e),s}}class NSe{constructor(e,t){h(this,"peerId");h(this,"peerRouting");h(this,"providers");h(this,"peerStore");h(this,"peerInfoMapper");h(this,"log");const{peerRouting:n,providers:s,logPrefix:i}=t;this.log=e.logger.forComponent(`${i}:rpc:handlers:get-providers`),this.peerId=e.peerId,this.peerStore=e.peerStore,this.peerRouting=n,this.providers=s,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(t.key==null)throw new Rt("Invalid GET_PROVIDERS message received - key was missing");let n;try{n=AP.decode(t.key)}catch{throw new Rt("Invalid CID")}this.log("%p asking for providers for %s",e,n);const[s,i]=await Promise.all([Sb(J1(await this.providers.getProviders(n),async a=>{const c=await this.peerStore.get(a);return{id:c.id,multiaddrs:c.addresses.map(({multiaddr:u})=>u)}})),this.peerRouting.getCloserPeersOffline(t.key,this.peerId)]),o={type:Bt.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:i.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)})),providers:s.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))};return this.log("got %s providers %s closerPeers",o.providers.length,o.closer.length),o}async _getAddresses(e){return[]}}class DSe{constructor(e,t){h(this,"peerStore");h(this,"datastore");h(this,"peerRouting");h(this,"log");h(this,"datastorePrefix");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:get-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}async handle(e,t){const n=t.key;if(this.log("%p asked for key %b",e,n),n==null||n.length===0)throw new Rt("Invalid key");const s={type:Bt.GET_VALUE,key:n,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(IAe(n)){this.log("is public key");const a=kAe(n);let c;try{const l=await this.peerStore.get(a);if(l.id.publicKey==null)throw new vr("No public key found in key book");c=$i(l.id.publicKey)}catch(l){if(l.name!=="NotFoundError")throw l}if(c!=null)return this.log("returning found public key"),s.record=new Li(n,c,new Date).serialize(),s}const[i,o]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getCloserPeersOffline(n,e)]);return i!=null&&(this.log("had record for %b in local datastore",n),s.record=i.serialize()),o.length>0&&(this.log("had %s closer peers in routing table",o.length),s.closer=o.map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))),s}async _checkLocalDatastore(e){this.log("checkLocalDatastore looking for %b",e);const t=B2(this.datastorePrefix,e);let n;try{n=await this.datastore.get(t)}catch(i){if(i.name==="NotFoundError")return;throw i}const s=Li.deserialize(n);if(s.timeReceived==null||Date.now()-s.timeReceived.getTime()>wxe){await this.datastore.delete(t);return}return s}}class OSe{constructor(e,t){h(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:ping`)}async handle(e,t){return this.log("ping from %p",e),t}}class RSe{constructor(e,t){h(this,"components");h(this,"validators");h(this,"log");h(this,"datastorePrefix");const{validators:n}=t;this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:put-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n}async handle(e,t){const n=t.key;if(this.log("%p asked us to store value for key %b",e,n),t.record==null){const s=`Empty record from: ${e.toString()}`;throw this.log.error(s),new Rt(s)}try{const s=Li.deserialize(t.record);await vP(this.validators,s),s.timeReceived=new Date;const i=B2(this.datastorePrefix,s.key);await this.components.datastore.put(i,s.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,i)}catch(s){this.log("did not put record for key %b into datastore %o",n,s)}return t}}let BSe=class{constructor(e,t){h(this,"handlers");h(this,"routingTable");h(this,"log");h(this,"metrics");var n,s;this.metrics={operations:(n=e.metrics)==null?void 0:n.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_requests_total`),errors:(s=e.metrics)==null?void 0:s.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_errors_total`)},this.log=e.logger.forComponent(`${t.logPrefix}:rpc`),this.routingTable=t.routingTable,this.handlers={[Bt.GET_VALUE.toString()]:new DSe(e,t),[Bt.PUT_VALUE.toString()]:new RSe(e,t),[Bt.FIND_NODE.toString()]:new PSe(e,t),[Bt.ADD_PROVIDER.toString()]:new _Se(e,t),[Bt.GET_PROVIDERS.toString()]:new NSe(e,t),[Bt.PING.toString()]:new OSe(e,t)}}async handleMessage(e,t){var s,i;const n=this.handlers[t.type];if(n==null){this.log.error(`no handler found for message type: ${t.type}`);return}try{return(s=this.metrics.operations)==null||s.increment({[t.type]:!0}),await n.handle(e,t)}catch{(i=this.metrics.errors)==null||i.increment({[t.type]:!0})}}onIncomingStream(e){let t="unknown";Promise.resolve().then(async()=>{const{stream:n,connection:s}=e,i=s.remotePeer,o=this;await Jn(n,a=>s1(a),async function*(a){for await(const c of a){const l=Nd.decode(c);t=l.type,o.log("incoming %s from %p",l.type,i);const u=await o.handleMessage(i,l);u!=null&&(yield Nd.encode(u))}},a=>n1(a),n)}).catch(n=>{this.log.error("error handling %s RPC message from %p - %e",t,e.connection.remotePeer,n)})}};class MSe extends Er{constructor(t,n){super();h(this,"log");h(this,"components");h(this,"protocol");h(this,"running");h(this,"registrarId");const{protocol:s,logPrefix:i}=n;this.components=t,this.log=t.logger.forComponent(`${i}:topology-listener`),this.running=!1,this.protocol=s}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:t=>{this.log("observed peer %p with protocol %s",t,this.protocol),this.dispatchEvent(new CustomEvent("peer",{detail:t}))}}))}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class $Se{constructor(e){h(this,"dht");this.dht=e}async provide(e,t={}){await Dc(this.dht.provide(e,t))}async cancelReprovide(e){await this.dht.cancelReprovide(e)}async*findProviders(e,t={}){for await(const n of this.dht.findProviders(e,t))n.name==="PROVIDER"&&(yield*n.providers)}async put(e,t,n){await Dc(this.dht.put(e,t,n))}async get(e,t){for await(const n of this.dht.get(e,t))if(n.name==="VALUE")return n.value;throw new vr("Could not find value for key")}}class LSe{constructor(e){h(this,"dht");this.dht=e}async findPeer(e,t={}){for await(const n of this.dht.findPeer(e,t))if(n.name==="FINAL_PEER")return n.peer;throw new vr("Peer not found")}async*getClosestPeers(e,t={}){for await(const n of this.dht.getClosestPeers(e,t))n.name==="FINAL_PEER"&&(yield n.peer)}}const USe=32,FSe=64;var yV,mV,wV;class zSe extends Er{constructor(t,n={}){var u,d,p,y;super();h(this,"protocol");h(this,"routingTable");h(this,"providers");h(this,"network");h(this,"peerRouting");h(this,"components");h(this,"log");h(this,"running");h(this,"kBucketSize");h(this,"clientMode");h(this,"validators");h(this,"selectors");h(this,"queryManager");h(this,"contentFetching");h(this,"contentRouting");h(this,"routingTableRefresh");h(this,"rpc");h(this,"topologyListener");h(this,"querySelf");h(this,"maxInboundStreams");h(this,"maxOutboundStreams");h(this,"dhtContentRouting");h(this,"dhtPeerRouting");h(this,"peerInfoMapper");h(this,"reprovider");h(this,wV,"@libp2p/kad-dht");h(this,mV,["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery"]);h(this,yV,["@libp2p/identify"]);const s=n.logPrefix??"libp2p:kad-dht",i=n.datastorePrefix??"/dht",o=n.metricsPrefix??"libp2p_kad_dht",a={queries:(u=t.metrics)==null?void 0:u.registerMetricGroup(`${o}_operations_total`,{label:"operation"}),errors:(d=t.metrics)==null?void 0:d.registerCounterGroup(`${o}_operation_errors_total`,{label:"operation"}),queryTime:(p=t.metrics)==null?void 0:p.registerMetricGroup(`${o}_operation_time_seconds`,{label:"operation"}),errorTime:(y=t.metrics)==null?void 0:y.registerMetricGroup(`${o}_operation_error_time_seconds`,{label:"operation"})};this.running=!1,this.components=t,this.log=t.logger.forComponent(s),this.protocol=n.protocol??bxe,this.kBucketSize=n.kBucketSize??20,this.clientMode=n.clientMode??!0,this.maxInboundStreams=n.maxInboundStreams??USe,this.maxOutboundStreams=n.maxOutboundStreams??FSe,this.peerInfoMapper=n.peerInfoMapper??SAe;const c=F_();this.providers=new ZAe(t,{...n.providers,logPrefix:s,datastorePrefix:i,lock:c}),this.validators={...Fxe,...n.validators},this.selectors={...Lxe,...n.selectors},this.network=new YAe(t,{protocol:this.protocol,logPrefix:s,metricsPrefix:o}),this.routingTable=new ISe(t,{kBucketSize:n.kBucketSize,pingOldContactTimeout:n.pingOldContactTimeout,pingOldContactConcurrency:n.pingOldContactConcurrency,pingOldContactMaxQueueSize:n.pingOldContactMaxQueueSize,pingNewContactTimeout:n.pingNewContactTimeout,pingNewContactConcurrency:n.pingNewContactConcurrency,pingNewContactMaxQueueSize:n.pingNewContactMaxQueueSize,protocol:this.protocol,logPrefix:s,metricsPrefix:o,prefixLength:n.prefixLength,splitThreshold:n.kBucketSplitThreshold,network:this.network});const l=He();n.allowQueryWithZeroPeers===!0&&l.resolve(),this.queryManager=new tSe(t,{disjointPaths:Math.ceil(this.kBucketSize/2),logPrefix:s,metricsPrefix:o,initialQuerySelfHasRun:l,routingTable:this.routingTable}),this.peerRouting=new XAe(t,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:s}),this.contentFetching=new BAe(t,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:s,datastorePrefix:i}),this.contentRouting=new $Ae(t,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:s}),this.routingTableRefresh=new TSe(t,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:s}),this.rpc=new BSe(t,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:s,metricsPrefix:o,datastorePrefix:i,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new MSe(t,{protocol:this.protocol,logPrefix:s}),this.querySelf=new oSe(t,{peerRouting:this.peerRouting,interval:n.querySelfInterval,initialInterval:n.initialQuerySelfInterval,logPrefix:s,initialQuerySelfHasRun:l,routingTable:this.routingTable,operationMetrics:a}),this.reprovider=new aSe(t,{...n.reprovide,logPrefix:s,metricsPrefix:o,datastorePrefix:i,contentRouting:this.contentRouting,lock:c,operationMetrics:a}),this.network.addEventListener("peer",f=>{const g=f.detail;this.onPeerConnect(g).catch(w=>{this.log.error("could not add %p to routing table",g.id,w)}),this.dispatchEvent(new CustomEvent("peer",{detail:g}))}),this.topologyListener.addEventListener("peer",f=>{const g=f.detail;Promise.resolve().then(async()=>{const w=await this.components.peerStore.get(g),m={id:g,multiaddrs:w.addresses.map(({multiaddr:b})=>b),protocols:w.protocols};await this.onPeerConnect(m)}).catch(w=>{this.log.error("could not add %p to routing table - %e",g,w)})}),this.dhtPeerRouting=new LSe(this),this.dhtContentRouting=new $Se(this),n.clientMode==null&&t.events.addEventListener("self:peer:update",f=>{this.log("received update of self-peer info"),Promise.resolve().then(async()=>{const g=f.detail.peer.addresses.some(({multiaddr:m})=>RAe(m)),w=this.getMode();g&&w==="client"?await this.setMode("server"):w==="server"&&!g&&await this.setMode("client")}).catch(g=>{this.log.error("error setting dht server mode",g)})}),this.get=Wf(this.get.bind(this),a,"GET_VALUE"),this.findProviders=Wf(this.findProviders.bind(this),a,"FIND_PROVIDERS"),this.findPeer=Wf(this.findPeer.bind(this),a,"FIND_PEER"),this.getClosestPeers=Wf(this.getClosestPeers.bind(this),a,"GET_CLOSEST_PEERS"),this.provide=Wf(this.provide.bind(this),a,"PROVIDE"),this.put=Wf(this.put.bind(this),a,"PUT_VALUE")}get[(wV=Symbol.toStringTag,mV=Lr,yV=Lu,Y0)](){return this.dhtContentRouting}get[X0](){return this.dhtPeerRouting}get[v8](){return this}async onPeerConnect(t){if(this.log.trace("peer %p connected",t.id),t=this.peerInfoMapper(t),t.multiaddrs.length===0){this.log.trace("ignoring %p as there were no valid addresses in %s after filtering",t.id,t.multiaddrs.map(n=>n.toString()));return}try{await this.routingTable.add(t.id)}catch(n){this.log.error("could not add %p to routing table",t.id,n)}}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(t,n=!1){if(t===this.getMode()&&!n){this.log("already in %s mode",t);return}if(await this.components.registrar.unhandle(this.protocol),t===this.getMode()&&!n){this.log("already in %s mode",t);return}t==="client"?(this.log("enabling client mode while in %s mode",this.getMode()),this.clientMode=!0):(this.log("enabling server mode while in %s mode",this.getMode()),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running||(this.running=!0,await this.setMode(this.clientMode?"client":"server",!0),await Oc(this.routingTable,this.queryManager,this.network,this.topologyListener,this.routingTableRefresh,this.reprovider),await Oc(this.querySelf))}async stop(){this.running=!1,await sh(this.querySelf,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener,this.reprovider)}async*put(t,n,s={}){yield*this.contentFetching.put(t,n,s)}async*get(t,n={}){yield*this.contentFetching.get(t,n)}async*provide(t,n={}){yield*this.contentRouting.provide(t,this.components.addressManager.getAddresses(),n)}async cancelReprovide(t){await this.providers.removeProvider(t,this.components.peerId)}async*findProviders(t,n={}){yield*this.contentRouting.findProviders(t,n)}async*findPeer(t,n={}){yield*this.peerRouting.findPeer(t,n)}async*getClosestPeers(t,n={}){yield*this.peerRouting.getClosestPeers(t,n)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}}var lC;(function(r){r[r.SEND_QUERY=0]="SEND_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADD_PEER=6]="ADD_PEER",r[r.DIAL_PEER=7]="DIAL_PEER"})(lC||(lC={}));function VSe(r={}){return e=>new zSe(e,r)}var HSe=r=>{if(Object.prototype.toString.call(r)!=="[object Object]")return!1;const e=Object.getPrototypeOf(r);return e===null||e===Object.prototype};const Hb=HSe,{hasOwnProperty:FY}=Object.prototype,{propertyIsEnumerable:KSe}=Object,b1=(r,e,t)=>Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),GSe=W2,P$={concatArrays:!1,ignoreUndefined:!1},Tv=r=>{const e=[];for(const t in r)FY.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){const t=Object.getOwnPropertySymbols(r);for(const n of t)KSe.call(r,n)&&e.push(n)}return e};function tg(r){return Array.isArray(r)?jSe(r):Hb(r)?qSe(r):r}function jSe(r){const e=r.slice(0,0);return Tv(r).forEach(t=>{b1(e,t,tg(r[t]))}),e}function qSe(r){const e=Object.getPrototypeOf(r)===null?Object.create(null):{};return Tv(r).forEach(t=>{b1(e,t,tg(r[t]))}),e}const zY=(r,e,t,n)=>(t.forEach(s=>{typeof e[s]>"u"&&n.ignoreUndefined||(s in r&&r[s]!==Object.getPrototypeOf(r)?b1(r,s,uC(r[s],e[s],n)):b1(r,s,tg(e[s])))}),r),WSe=(r,e,t)=>{let n=r.slice(0,0),s=0;return[r,e].forEach(i=>{const o=[];for(let a=0;a<i.length;a++)FY.call(i,a)&&(o.push(String(a)),i===r?b1(n,s++,i[a]):b1(n,s++,tg(i[a])));n=zY(n,i,Tv(i).filter(a=>!o.includes(a)),t)}),n};function uC(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?WSe(r,e,t):!Hb(e)||!Hb(r)?tg(e):zY(r,e,Tv(e),t)}var QSe=function(...r){const e=uC(tg(P$),this!==GSe&&this||{},P$);let t={_:{}};for(const n of r)if(n!==void 0){if(!Hb(n))throw new TypeError("`"+n+"` is not an Option Object");t=uC(t,{_:n},e)}return t._};const CP=Zu(QSe);function JSe(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function YSe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var XSe=YSe,ZSe=XSe;let eCe=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},tCe=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return VY(this,e)}},rCe=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return VY(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function VY(r,e){return new rCe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let nCe=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new eCe(e,t,n),this.decoder=new tCe(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function HY({name:r,prefix:e,encode:t,decode:n}){return new nCe(r,e,t,n)}function KY({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=ZSe(t,r);return HY({prefix:e,name:r,encode:n,decode:i=>JSe(s(i))})}function sCe(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function iCe(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function _v({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return HY({prefix:e,name:r,encode(s){return iCe(s,n,t)},decode(s){return sCe(s,n,t,r)}})}const oCe=KY({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});KY({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var aCe=GY,N$=128,cCe=-128,lCe=Math.pow(2,31);function GY(r,e,t){e=e||[],t=t||0;for(var n=t;r>=lCe;)e[t++]=r&255|N$,r/=128;for(;r&cCe;)e[t++]=r&255|N$,r>>>=7;return e[t]=r|0,GY.bytes=t-n+1,e}var uCe=hC,hCe=128,D$=127;function hC(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw hC.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&D$)<<s:(o&D$)*Math.pow(2,s),s+=7}while(o>=hCe);return hC.bytes=i-n,t}var dCe=Math.pow(2,7),fCe=Math.pow(2,14),pCe=Math.pow(2,21),gCe=Math.pow(2,28),yCe=Math.pow(2,35),mCe=Math.pow(2,42),wCe=Math.pow(2,49),bCe=Math.pow(2,56),vCe=Math.pow(2,63),ECe=function(r){return r<dCe?1:r<fCe?2:r<pCe?3:r<gCe?4:r<yCe?5:r<mCe?6:r<wCe?7:r<bCe?8:r<vCe?9:10},xCe={encode:aCe,decode:uCe,encodingLength:ECe},jY=xCe;function O$(r,e,t=0){return jY.encode(r,e,t),e}function R$(r){return jY.encodingLength(r)}function B$(r,e){const t=e.byteLength,n=R$(r),s=n+R$(t),i=new Uint8Array(s+t);return O$(r,i,0),O$(t,i,n),i.set(e,s),new ACe(r,t,e,i)}let ACe=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function SCe({name:r,code:e,encode:t}){return new CCe(r,e,t)}let CCe=class{constructor(e,t,n){h(this,"name");h(this,"code");h(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?B$(this.code,t):t.then(n=>B$(this.code,n))}else throw Error("Unknown type, must be binary type")}};function ICe(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const kCe=SCe({name:"sha2-256",code:18,encode:ICe("SHA-256")});function TCe(r){return r>=55296&&r<=56319}function _Ce(r){return r>=56320&&r<=57343}var PCe=function(e,t,n){if(typeof t!="string")throw new Error("Input must be string");for(var s=t.length,i=0,o,a,c=0;c<s;c+=1){if(o=t.charCodeAt(c),a=t[c],TCe(o)&&_Ce(t.charCodeAt(c+1))&&(c+=1,a+=t[c]),i+=e(a),i===n)return t.slice(0,c+1);if(i>n)return t.slice(0,c-a.length+1)}return t};function NCe(r){return r>=55296&&r<=56319}function DCe(r){return r>=56320&&r<=57343}var OCe=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var t=e.length,n=0,s=null,i=null,o=0;o<t;o++)s=e.charCodeAt(o),DCe(s)?i!=null&&NCe(i)?n+=1:n+=3:s<=127?n+=1:s>=128&&s<=2047?n+=2:s>=2048&&s<=65535&&(n+=3),i=s;return n},RCe=PCe,BCe=OCe,MCe=RCe.bind(null,BCe),$Ce=MCe,LCe=/[\/\?<>\\:\*\|"]/g,UCe=/[\x00-\x1f\x80-\x9f]/g,FCe=/^\.+$/,zCe=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,VCe=/[\. ]+$/;function M$(r,e){if(typeof r!="string")throw new Error("Input must be string");var t=r.replace(LCe,e).replace(UCe,e).replace(FCe,e).replace(zCe,e).replace(VCe,e);return $Ce(t,255)}var HCe=function(r,e){var t=e&&e.replacement||"",n=M$(r,t);return t===""?n:M$(n,"")};const KCe=Zu(HCe),EE={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function qY(r){const e="AES-GCM";let t=16;const n=12,s="SHA-256",i=16,o=32767,a=ba.get();t*=8;async function c(d,p){const y=a.getRandomValues(new Uint8Array(i)),f=a.getRandomValues(new Uint8Array(n)),g={name:e,iv:f};typeof p=="string"&&(p=he(p));let w;if(p.length===0){w=await a.subtle.importKey("jwk",EE,{name:"AES-GCM"},!0,["encrypt"]);try{const b={name:"PBKDF2",salt:y,iterations:o,hash:{name:s}},v=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);w=await a.subtle.deriveKey(b,v,{name:e,length:t},!0,["encrypt"])}catch{w=await a.subtle.importKey("jwk",EE,{name:"AES-GCM"},!0,["encrypt"])}}else{const b={name:"PBKDF2",salt:y,iterations:o,hash:{name:s}},v=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);w=await a.subtle.deriveKey(b,v,{name:e,length:t},!0,["encrypt"])}const m=await a.subtle.encrypt(g,w,d);return Cr([y,g.iv,new Uint8Array(m)])}async function l(d,p){const y=d.subarray(0,i),f=d.subarray(i,i+n),g=d.subarray(i+n),w={name:e,iv:f};typeof p=="string"&&(p=he(p));let m;if(p.length===0)try{const v={name:"PBKDF2",salt:y,iterations:o,hash:{name:s}},E=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);m=await a.subtle.deriveKey(v,E,{name:e,length:t},!0,["decrypt"])}catch{m=await a.subtle.importKey("jwk",EE,{name:"AES-GCM"},!0,["decrypt"])}else{const v={name:"PBKDF2",salt:y,iterations:o,hash:{name:s}},E=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);m=await a.subtle.deriveKey(v,E,{name:e,length:t},!0,["decrypt"])}const b=await a.subtle.decrypt(w,m,g);return new Uint8Array(b)}return{encrypt:c,decrypt:l}}/*!
 * MIT License
 * 
 * Copyright (c) 2017-2024 Peculiar Ventures, LLC
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const GCe="[object ArrayBuffer]";class me{static isArrayBuffer(e){return Object.prototype.toString.call(e)===GCe}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const n=me.toUint8Array(e),s=me.toUint8Array(t);if(n.length!==s.byteLength)return!1;for(let i=0;i<n.length;i++)if(n[i]!==s[i])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let n=0;for(const o of t)n+=o.byteLength;const s=new Uint8Array(n);let i=0;for(const o of t){const a=this.toUint8Array(o);s.set(a,i),i+=a.length}return e[e.length-1]instanceof Function?this.toView(s,e[e.length-1]):s.buffer}}const xE="string",jCe=/^[0-9a-f\s]+$/i,qCe=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,WCe=/^[a-zA-Z0-9-_]+$/;class $${static fromString(e){const t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n.buffer}static toString(e){const t=me.toUint8Array(e);let n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return decodeURIComponent(escape(n))}}class Vo{static toString(e,t=!1){const n=me.toArrayBuffer(e),s=new DataView(n);let i="";for(let o=0;o<n.byteLength;o+=2){const a=s.getUint16(o,t);i+=String.fromCharCode(a)}return i}static fromString(e,t=!1){const n=new ArrayBuffer(e.length*2),s=new DataView(n);for(let i=0;i<e.length;i++)s.setUint16(i*2,e.charCodeAt(i),t);return n}}class Te{static isHex(e){return typeof e===xE&&jCe.test(e)}static isBase64(e){return typeof e===xE&&qCe.test(e)}static isBase64Url(e){return typeof e===xE&&WCe.test(e)}static ToString(e,t="utf8"){const n=me.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return Vo.toString(n,!0);case"utf16":case"utf16be":return Vo.toString(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return Vo.fromString(e,!0);case"utf16":case"utf16be":return Vo.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=me.toUint8Array(e);if(typeof btoa<"u"){const n=this.ToString(t,"binary");return btoa(n)}else return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Te.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Te.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=Te.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return $$.fromString(e);case"utf16":case"utf16be":return Vo.fromString(e);case"utf16le":case"usc2":return Vo.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=Te.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return $$.toString(e);case"utf16":case"utf16be":return Vo.toString(e);case"utf16le":case"usc2":return Vo.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,n=new Uint8Array(t);for(let s=0;s<t;s++)n[s]=e.charCodeAt(s);return n.buffer}static ToBinary(e){const t=me.toUint8Array(e);let n="";for(let s=0;s<t.length;s++)n+=String.fromCharCode(t[s]);return n}static ToHex(e){const t=me.toUint8Array(e);let n="";const s=t.length;for(let i=0;i<s;i++){const o=t[i];o<16&&(n+="0"),n+=o.toString(16)}return n}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Te.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const n=new Uint8Array(t.length/2);for(let s=0;s<t.length;s=s+2){const i=t.slice(s,s+2);n[s/2]=parseInt(i,16)}return n.buffer}static ToUtf16String(e,t=!1){return Vo.toString(e,t)}static FromUtf16String(e,t=!1){return Vo.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}static formatString(e){return(e==null?void 0:e.replace(/[\n\r\t ]/g,""))||""}}Te.DEFAULT_UTF8_ENCODING="utf8";function QCe(...r){const e=r.map(s=>s.byteLength).reduce((s,i)=>s+i),t=new Uint8Array(e);let n=0;return r.map(s=>new Uint8Array(s)).forEach(s=>{for(const i of s)t[n++]=i}),t.buffer}function WY(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let s=0;s<r.byteLength;s++)if(t[s]!==n[s])return!1;return!0}/*!
 Copyright (c) Peculiar Ventures, LLC
*/function v1(r,e){let t=0;if(r.length===1)return r[0];for(let n=r.length-1;n>=0;n--)t+=r[r.length-1-n]*Math.pow(2,e*n);return t}function Zd(r,e,t=-1){const n=t;let s=r,i=0,o=Math.pow(2,e);for(let a=1;a<8;a++){if(r<o){let c;if(n<0)c=new ArrayBuffer(a),i=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),i=n}const l=new Uint8Array(c);for(let u=a-1;u>=0;u--){const d=Math.pow(2,u*e);l[i-u-1]=Math.floor(s/d),s-=l[i-u-1]*d}return c}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function dC(...r){let e=0,t=0;for(const i of r)e+=i.length;const n=new ArrayBuffer(e),s=new Uint8Array(n);for(const i of r)s.set(i,t),t+=i.length;return s}function QY(){const r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const a=r[0]===255&&r[1]&128,c=r[0]===0&&(r[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=r[0]&128;const n=v1(t,8),s=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(s);for(let a=0;a<this.valueHex.byteLength;a++)i[a]=r[a];return i[0]&=127,v1(i,8)-n}function JCe(r){const e=r<0?r*-1:r;let t=128;for(let n=1;n<8;n++){if(e<=t){if(r<0){const o=t-e,a=Zd(o,8,n),c=new Uint8Array(a);return c[0]|=128,a}let s=Zd(e,8,n),i=new Uint8Array(s);if(i[0]&128){const o=s.slice(0),a=new Uint8Array(o);s=new ArrayBuffer(s.byteLength+1),i=new Uint8Array(s);for(let c=0;c<o.byteLength;c++)i[c+1]=a[c];i[0]=0}return s}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function YCe(r,e){if(r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let s=0;s<t.length;s++)if(t[s]!==n[s])return!1;return!0}function Ks(r,e){const t=r.toString(10);if(e<t.length)return"";const n=e-t.length,s=new Array(n);for(let o=0;o<n;o++)s[o]="0";return s.join("").concat(t)}/*!
 * Copyright (c) 2014, GMO GlobalSign
 * Copyright (c) 2015-2022, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */function Kb(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function IP(r){let e=0,t=0;for(let s=0;s<r.length;s++){const i=r[s];e+=i.byteLength}const n=new Uint8Array(e);for(let s=0;s<r.length;s++){const i=r[s];n.set(new Uint8Array(i),t),t+=i.byteLength}return n.buffer}function Xc(r,e,t,n){return e instanceof Uint8Array?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class Pv{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return IP(this.items)}}const Jg=[new Uint8Array([1])],L$="0123456789",AE="name",U$="valueHexView",XCe="isHexOnly",ZCe="idBlock",eIe="tagClass",tIe="tagNumber",rIe="isConstructed",nIe="fromBER",sIe="toBER",iIe="local",us="",No=new ArrayBuffer(0),Nv=new Uint8Array(0),Ry="EndOfContent",JY="OCTET STRING",YY="BIT STRING";function Ca(r){var e;return e=class extends r{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}constructor(...n){var s;super(...n);const i=n[0]||{};this.isHexOnly=(s=i.isHexOnly)!==null&&s!==void 0?s:!1,this.valueHexView=i.valueHex?me.toUint8Array(i.valueHex):Nv}fromBER(n,s,i){const o=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!Xc(this,o,s,i))return-1;const a=s+i;return this.valueHexView=o.subarray(s,a),this.valueHexView.length?(this.blockLength=i,a):(this.warnings.push("Zero buffer length"),s)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",No)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:Te.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class Tf{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=us,warnings:n=[],valueBeforeDecode:s=Nv}={}){this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=me.toUint8Array(s)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Te.ToHex(this.valueBeforeDecodeView)}}}Tf.NAME="baseBlock";class es extends Tf{fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}es.NAME="valueBlock";class XY extends Ca(Tf){constructor({idBlock:e={}}={}){var t,n,s,i;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?me.toUint8Array(e.valueHex):Nv,this.tagClass=(n=e.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(s=e.tagNumber)!==null&&s!==void 0?s:-1,this.isConstructed=(i=e.isConstructed)!==null&&i!==void 0?i:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",No}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const s=new Uint8Array(1);if(!e){let i=this.tagNumber;i&=31,t|=i,s[0]=t}return s.buffer}if(!this.isHexOnly){const s=Zd(this.tagNumber,7),i=new Uint8Array(s),o=s.byteLength,a=new Uint8Array(o+1);if(a[0]=t|31,!e){for(let c=0;c<o-1;c++)a[c+1]=i[c]|128;a[o]=i[o-1]}return a.buffer}const n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=t|31,!e){const s=this.valueHexView;for(let i=0;i<s.length-1;i++)n[i+1]=s[i]|128;n[this.valueHexView.byteLength]=s[s.length-1]}return n.buffer}fromBER(e,t,n){const s=me.toUint8Array(e);if(!Xc(this,s,t,n))return-1;const i=s.subarray(t,t+n);if(i.length===0)return this.error="Zero buffer length",-1;switch(i[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(i[0]&32)===32,this.isHexOnly=!1;const a=i[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,l=this.valueHexView=new Uint8Array(255),u=255;for(;i[c]&128;){if(l[c-1]=i[c]&127,c++,c>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(c===u){u+=255;const p=new Uint8Array(u);for(let y=0;y<l.length;y++)p[y]=l[y];l=this.valueHexView=new Uint8Array(u)}}this.blockLength=c+1,l[c-1]=i[c]&127;const d=new Uint8Array(c);for(let p=0;p<c;p++)d[p]=l[p];l=this.valueHexView=new Uint8Array(c),l.set(d),this.blockLength<=9?this.tagNumber=v1(l,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}XY.NAME="identificationBlock";class ZY extends Tf{constructor({lenBlock:e={}}={}){var t,n,s;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(n=e.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(s=e.length)!==null&&s!==void 0?s:0}fromBER(e,t,n){const s=me.toUint8Array(e);if(!Xc(this,s,t,n))return-1;const i=s.subarray(t,t+n);if(i.length===0)return this.error="Zero buffer length",-1;if(i[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=i[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(i[0]&128),this.longFormUsed===!1)return this.length=i[0],this.blockLength=1,t+this.blockLength;const o=i[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>i.length)return this.error="End of input reached before message was fully decoded",-1;const a=t+1,c=s.subarray(a,a+o);return c[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=v1(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(e=!1){let t,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=128),t;if(this.longFormUsed){const s=Zd(this.length,8);if(s.byteLength>127)return this.error="Too big length",No;if(t=new ArrayBuffer(s.byteLength+1),e)return t;const i=new Uint8Array(s);n=new Uint8Array(t),n[0]=s.byteLength|128;for(let o=0;o<s.byteLength;o++)n[o+1]=i[o];return t}return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}ZY.NAME="lengthBlock";const xe={};class Zr extends Tf{constructor({name:e=us,optional:t=!1,primitiveSchema:n,...s}={},i){super(s),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new XY(s),this.lenBlock=new ZY(s),this.valueBlock=i?new i(s):new es(s)}fromBER(e,t,n){const s=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}toBER(e,t){const n=t||new Pv;t||eX(this);const s=this.idBlock.toBER(e);if(n.write(s),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{const i=this.valueBlock.toBER(e);this.lenBlock.length=i.byteLength;const o=this.lenBlock.toBER(e);n.write(o),n.write(i)}return t?No:n.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():Te.ToHex(this.toBER())}onAsciiEncoding(){const e=this.constructor.NAME,t=Te.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),n=e.toBER();return YCe(t,n)}}Zr.NAME="BaseBlock";function eX(r){var e;if(r instanceof xe.Constructed)for(const t of r.valueBlock.value)eX(t)&&(r.lenBlock.isIndefiniteForm=!0);return!!(!((e=r.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}class kP extends Zr{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=us,...t}={},n){super(t,n),e&&this.fromString(e)}fromBER(e,t,n){const s=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}kP.NAME="BaseStringBlock";class tX extends Ca(es){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}tX.NAME="PrimitiveValueBlock";var rX;let jm=class extends Zr{constructor(e={}){super(e,tX),this.idBlock.isConstructed=!1}};rX=jm;xe.Primitive=rX;jm.NAME="PRIMITIVE";function oIe(r,e){if(r instanceof e)return r;const t=new e;return t.idBlock=r.idBlock,t.lenBlock=r.lenBlock,t.warnings=r.warnings,t.valueBeforeDecodeView=r.valueBeforeDecodeView,t}function rg(r,e=0,t=r.length){const n=e;let s=new Zr({},es);const i=new Tf;if(!Xc(i,r,e,t))return s.error=i.error,{offset:-1,result:s};if(!r.subarray(e,e+t).length)return s.error="Zero buffer length",{offset:-1,result:s};let a=s.idBlock.fromBER(r,e,t);if(s.idBlock.warnings.length&&s.warnings.concat(s.idBlock.warnings),a===-1)return s.error=s.idBlock.error,{offset:-1,result:s};if(e=a,t-=s.idBlock.blockLength,a=s.lenBlock.fromBER(r,e,t),s.lenBlock.warnings.length&&s.warnings.concat(s.lenBlock.warnings),a===-1)return s.error=s.lenBlock.error,{offset:-1,result:s};if(e=a,t-=s.lenBlock.blockLength,!s.idBlock.isConstructed&&s.lenBlock.isIndefiniteForm)return s.error="Indefinite length form used for primitive encoding form",{offset:-1,result:s};let c=Zr;switch(s.idBlock.tagClass){case 1:if(s.idBlock.tagNumber>=37&&s.idBlock.isHexOnly===!1)return s.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:s};switch(s.idBlock.tagNumber){case 0:if(s.idBlock.isConstructed&&s.lenBlock.length>0)return s.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:s};c=xe.EndOfContent;break;case 1:c=xe.Boolean;break;case 2:c=xe.Integer;break;case 3:c=xe.BitString;break;case 4:c=xe.OctetString;break;case 5:c=xe.Null;break;case 6:c=xe.ObjectIdentifier;break;case 10:c=xe.Enumerated;break;case 12:c=xe.Utf8String;break;case 13:c=xe.RelativeObjectIdentifier;break;case 14:c=xe.TIME;break;case 15:return s.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:s};case 16:c=xe.Sequence;break;case 17:c=xe.Set;break;case 18:c=xe.NumericString;break;case 19:c=xe.PrintableString;break;case 20:c=xe.TeletexString;break;case 21:c=xe.VideotexString;break;case 22:c=xe.IA5String;break;case 23:c=xe.UTCTime;break;case 24:c=xe.GeneralizedTime;break;case 25:c=xe.GraphicString;break;case 26:c=xe.VisibleString;break;case 27:c=xe.GeneralString;break;case 28:c=xe.UniversalString;break;case 29:c=xe.CharacterString;break;case 30:c=xe.BmpString;break;case 31:c=xe.DATE;break;case 32:c=xe.TimeOfDay;break;case 33:c=xe.DateTime;break;case 34:c=xe.Duration;break;default:{const l=s.idBlock.isConstructed?new xe.Constructed:new xe.Primitive;l.idBlock=s.idBlock,l.lenBlock=s.lenBlock,l.warnings=s.warnings,s=l}}break;case 2:case 3:case 4:default:c=s.idBlock.isConstructed?xe.Constructed:xe.Primitive}return s=oIe(s,c),a=s.fromBER(r,e,s.lenBlock.isIndefiniteForm?t:s.lenBlock.length),s.valueBeforeDecodeView=r.subarray(n,n+s.blockLength),{offset:a,result:s}}function Ec(r){if(!r.byteLength){const e=new Zr({},es);return e.error="Input buffer has zero length",{offset:-1,result:e}}return rg(me.toUint8Array(r).slice(),0,r.byteLength)}function aIe(r,e){return r?1:e}class Pu extends es{constructor({value:e=[],isIndefiniteForm:t=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){const s=me.toUint8Array(e);if(!Xc(this,s,t,n))return-1;if(this.valueBeforeDecodeView=s.subarray(t,t+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let i=t;for(;aIe(this.isIndefiniteForm,n)>0;){const o=rg(s,i,n);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(i=o.offset,this.blockLength+=o.result.blockLength,n-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===Ry)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===Ry?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}toBER(e,t){const n=t||new Pv;for(let s=0;s<this.value.length;s++)this.value[s].toBER(e,n);return t?No:n.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}Pu.NAME="ConstructedValueBlock";var nX;class xs extends Zr{constructor(e={}){super(e,Pu),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const s=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}onAsciiEncoding(){const e=[];for(const n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(s=>`  ${s}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}nX=xs;xe.Constructed=nX;xs.NAME="CONSTRUCTED";class sX extends es{fromBER(e,t,n){return t}toBER(e){return No}}sX.override="EndOfContentValueBlock";var iX;class TP extends Zr{constructor(e={}){super(e,sX),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}iX=TP;xe.EndOfContent=iX;TP.NAME=Ry;var oX;class Rc extends Zr{constructor(e={}){super(e,es),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){const n=new ArrayBuffer(2);if(!e){const s=new Uint8Array(n);s[0]=5,s[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}}oX=Rc;xe.Null=oX;Rc.NAME="NULL";class aX extends Ca(es){get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=me.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,n){const s=me.toUint8Array(e);return Xc(this,s,t,n)?(this.valueHexView=s.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,QY.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}aX.NAME="BooleanValueBlock";var cX;let Dv=class extends Zr{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,aX),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};cX=Dv;xe.Boolean=cX;Dv.NAME="BOOLEAN";class lX extends Ca(Pu){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,n){let s=0;if(this.isConstructed){if(this.isHexOnly=!1,s=Pu.prototype.fromBER.call(this,e,t,n),s===-1)return s;for(let i=0;i<this.value.length;i++){const o=this.value[i].constructor.NAME;if(o===Ry){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==JY)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,s=super.fromBER(e,t,n),this.blockLength=n;return s}toBER(e,t){return this.isConstructed?Pu.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}lX.NAME="OctetStringValueBlock";var _P;let yo=class extends Zr{constructor({idBlock:e={},lenBlock:t={},...n}={}){var s,i;(s=n.isConstructed)!==null&&s!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},lX),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const i=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(i.byteLength){const o=rg(i,0,i.byteLength);o.offset!==-1&&o.offset===n&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return xs.prototype.onAsciiEncoding.call(this);const e=this.constructor.NAME,t=Te.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof _P&&e.push(t.valueBlock.valueHexView);return me.concat(e)}};_P=yo;xe.OctetString=_P;yo.NAME=JY;class uX extends Ca(Pu){constructor({unusedBits:e=0,isConstructed:t=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let s=-1;if(this.isConstructed){if(s=Pu.prototype.fromBER.call(this,e,t,n),s===-1)return s;for(const a of this.value){const c=a.constructor.NAME;if(c===Ry){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==YY)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const l=a.valueBlock;if(this.unusedBits>0&&l.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=l.unusedBits}return s}const i=me.toUint8Array(e);if(!Xc(this,i,t,n))return-1;const o=i.subarray(t,t+n);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const a=o.subarray(1);try{if(a.byteLength){const c=rg(a,0,a.byteLength);c.offset!==-1&&c.offset===n-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+n}toBER(e,t){if(this.isConstructed)return Pu.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return No;const n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}uX.NAME="BitStringValueBlock";var hX;let Dd=class extends Zr{constructor({idBlock:e={},lenBlock:t={},...n}={}){var s,i;(s=n.isConstructed)!==null&&s!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},uX),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return xs.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const o of t)e.push(o.toString(2).padStart(8,"0"));const n=e.join(""),s=this.constructor.NAME,i=n.substring(0,n.length-this.valueBlock.unusedBits);return`${s} : ${i}`}}};hX=Dd;xe.BitString=hX;Dd.NAME=YY;var dX;function cIe(r,e){const t=new Uint8Array([0]),n=new Uint8Array(r),s=new Uint8Array(e);let i=n.slice(0);const o=i.length-1,a=s.slice(0),c=a.length-1;let l=0;const u=c<o?o:c;let d=0;for(let p=u;p>=0;p--,d++){switch(!0){case d<a.length:l=i[o-d]+a[c-d]+t[0];break;default:l=i[o-d]+t[0]}switch(t[0]=l/10,!0){case d>=i.length:i=dC(new Uint8Array([l%10]),i);break;default:i[o-d]=l%10}}return t[0]>0&&(i=dC(t,i)),i}function F$(r){if(r>=Jg.length)for(let e=Jg.length;e<=r;e++){const t=new Uint8Array([0]);let n=Jg[e-1].slice(0);for(let s=n.length-1;s>=0;s--){const i=new Uint8Array([(n[s]<<1)+t[0]]);t[0]=i[0]/10,n[s]=i[0]%10}t[0]>0&&(n=dC(t,n)),Jg.push(n)}return Jg[r]}function lIe(r,e){let t=0;const n=new Uint8Array(r),s=new Uint8Array(e),i=n.slice(0),o=i.length-1,a=s.slice(0),c=a.length-1;let l,u=0;for(let d=c;d>=0;d--,u++)switch(l=i[o-u]-a[c-u]-t,!0){case l<0:t=1,i[o-u]=l+10;break;default:t=0,i[o-u]=l}if(t>0)for(let d=o-c+1;d>=0;d--,u++)if(l=i[o-u]-t,l<0)t=1,i[o-u]=l+10;else{t=0,i[o-u]=l;break}return i.slice()}class PP extends Ca(es){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=QY.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(JCe(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,s=0){const i=this.fromBER(e,t,n);if(i===-1)return i;const o=this.valueHexView;return o[0]===0&&o[1]&128?this.valueHexView=o.subarray(1):s!==0&&o.length<s&&(s-o.length>1&&(s=o.length+1),this.valueHexView=o.subarray(s-o.length)),i}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(t,1),this.valueHexView=n}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,n){const s=super.fromBER(e,t,n);return s===-1||this.setValueHex(),s}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),n=0,s;const i=this.valueHexView;let o="",a=!1;for(let c=i.byteLength-1;c>=0;c--){s=i[c];for(let l=0;l<8;l++){if((s&1)===1)switch(n){case e:t=lIe(F$(n),t),o="-";break;default:t=cIe(t,F$(n))}n++,s>>=1}}for(let c=0;c<t.length;c++)t[c]&&(a=!0),a&&(o+=L$.charAt(t[c]));return a===!1&&(o+=L$.charAt(0)),o}}dX=PP;PP.NAME="IntegerValueBlock";Object.defineProperty(dX.prototype,"valueHex",{set:function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var M2;class xc extends Zr{constructor(e={}){super(e,PP),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return Kb(),BigInt(this.valueBlock.toString())}static fromBigInt(e){Kb();const t=BigInt(e),n=new Pv,s=t.toString(16).replace(/^-/,""),i=new Uint8Array(Te.FromHex(s));if(t<0){const a=new Uint8Array(i.length+(i[0]&128?1:0));a[0]|=128;const l=BigInt(`0x${Te.ToHex(a)}`)+t,u=me.toUint8Array(Te.FromHex(l.toString(16)));u[0]|=128,n.write(u)}else i[0]&128&&n.write(new Uint8Array([0])),n.write(i);return new M2({valueHex:n.final()})}convertToDER(){const e=new M2({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new M2({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}M2=xc;xe.Integer=M2;xc.NAME="INTEGER";var fX;class Ov extends xc{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}fX=Ov;xe.Enumerated=fX;Ov.NAME="ENUMERATED";class fC extends Ca(es){constructor({valueDec:e=-1,isFirstSid:t=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;const s=me.toUint8Array(e);if(!Xc(this,s,t,n))return-1;const i=s.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,!!(i[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,i[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=v1(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){Kb();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const n=new Uint8Array(t.length/7);for(let s=0;s<n.length;s++)n[s]=parseInt(t.slice(s*7,s*7+7),2)+(s+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const s=this.valueHexView,i=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)i[o]=s[o]|128;return i[this.blockLength-1]=s[this.blockLength-1],i.buffer}const t=Zd(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",No;const n=new Uint8Array(t.byteLength);if(!e){const s=new Uint8Array(t),i=t.byteLength-1;for(let o=0;o<i;o++)n[o]=s[o]|128;n[i]=s[i]}return n}toString(){let e="";if(this.isHexOnly)e=Te.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}fC.NAME="sidBlock";class pX extends es{constructor({value:e=us,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let s=t;for(;n>0;){const i=new fC;if(s=i.fromBER(e,s,n),s===-1)return this.blockLength=0,this.error=i.error,s;this.value.length===0&&(i.isFirstSid=!0),this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return s}toBER(e){const t=[];for(let n=0;n<this.value.length;n++){const s=this.value[n].toBER(e);if(s.byteLength===0)return this.error=this.value[n].error,No;t.push(s)}return IP(t)}fromString(e){this.value=[];let t=0,n=0,s="",i=!1;do if(n=e.indexOf(".",t),n===-1?s=e.substring(t):s=e.substring(t,n),t=n+1,i){const o=this.value[0];let a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}const c=parseInt(s,10);if(isNaN(c))return;o.valueDec=c+a,i=!1}else{const o=new fC;if(s>Number.MAX_SAFE_INTEGER){Kb();const a=BigInt(s);o.valueBigInt=a}else if(o.valueDec=parseInt(s,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,i=!0),this.value.push(o)}while(n!==-1)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let s=this.value[n].toString();n!==0&&(e=`${e}.`),t?(s=`{${s}}`,this.value[n].isFirstSid?e=`2.{${s} - 80}`:e+=s):e+=s}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}pX.NAME="ObjectIdentifierValueBlock";var gX;class dc extends Zr{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,pX),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}gX=dc;xe.ObjectIdentifier=gX;dc.NAME="OBJECT IDENTIFIER";class pC extends Ca(Tf){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,n){if(n===0)return t;const s=me.toUint8Array(e);if(!Xc(this,s,t,n))return-1;const i=s.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,!!(i[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,i[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=v1(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const s=this.valueHexView,i=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)i[o]=s[o]|128;return i[this.blockLength-1]=s[this.blockLength-1],i.buffer}const t=Zd(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",No;const n=new Uint8Array(t.byteLength);if(!e){const s=new Uint8Array(t),i=t.byteLength-1;for(let o=0;o<i;o++)n[o]=s[o]|128;n[i]=s[i]}return n.buffer}toString(){let e="";return this.isHexOnly?e=Te.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}pC.NAME="relativeSidBlock";class yX extends es{constructor({value:e=us,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let s=t;for(;n>0;){const i=new pC;if(s=i.fromBER(e,s,n),s===-1)return this.blockLength=0,this.error=i.error,s;this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return s}toBER(e,t){const n=[];for(let s=0;s<this.value.length;s++){const i=this.value[s].toBER(e);if(i.byteLength===0)return this.error=this.value[s].error,No;n.push(i)}return IP(n)}fromString(e){this.value=[];let t=0,n=0,s="";do{n=e.indexOf(".",t),n===-1?s=e.substring(t):s=e.substring(t,n),t=n+1;const i=new pC;if(i.valueDec=parseInt(s,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(n!==-1);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let s=this.value[n].toString();n!==0&&(e=`${e}.`),t&&(s=`{${s}}`),e+=s}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}yX.NAME="RelativeObjectIdentifierValueBlock";var mX;class NP extends Zr{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,yX),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}mX=NP;xe.RelativeObjectIdentifier=mX;NP.NAME="RelativeObjectIdentifier";var wX;class Dr extends xs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}wX=Dr;xe.Sequence=wX;Dr.NAME="SEQUENCE";var bX;let Ac=class extends xs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};bX=Ac;xe.Set=bX;Ac.NAME="SET";class vX extends Ca(es){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=us}toJSON(){return{...super.toJSON(),value:this.value}}}vX.NAME="StringValueBlock";class EX extends vX{}EX.NAME="SimpleStringValueBlock";class ai extends kP{constructor({...e}={}){super(e,EX)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,me.toUint8Array(e))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let s=0;s<t;s++)n[s]=e.charCodeAt(s);this.valueBlock.value=e}}ai.NAME="SIMPLE STRING";class xX extends ai{fromBuffer(e){this.valueBlock.valueHexView=me.toUint8Array(e);try{this.valueBlock.value=Te.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=Te.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(Te.FromUtf8String(e)),this.valueBlock.value=e}}xX.NAME="Utf8StringValueBlock";var AX;class Zc extends xX{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}AX=Zc;xe.Utf8String=AX;Zc.NAME="UTF8String";class SX extends ai{fromBuffer(e){this.valueBlock.value=Te.ToUtf16String(e),this.valueBlock.valueHexView=me.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(Te.FromUtf16String(e))}}SX.NAME="BmpStringValueBlock";var CX;class Rv extends SX{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}CX=Rv;xe.BmpString=CX;Rv.NAME="BMPString";class IX extends ai{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let s=0;s<n.length;s+=4)n[s]=n[s+3],n[s+1]=n[s+2],n[s+2]=0,n[s+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let s=0;s<t;s++){const i=Zd(e.charCodeAt(s),8),o=new Uint8Array(i);if(o.length>4)continue;const a=4-o.length;for(let c=o.length-1;c>=0;c--)n[s*4+c+a]=o[c]}this.valueBlock.value=e}}IX.NAME="UniversalStringValueBlock";var kX;class Bv extends IX{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}kX=Bv;xe.UniversalString=kX;Bv.NAME="UniversalString";var TX;class Mv extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}TX=Mv;xe.NumericString=TX;Mv.NAME="NumericString";var _X;class $v extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}_X=$v;xe.PrintableString=_X;$v.NAME="PrintableString";var PX;class Lv extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}PX=Lv;xe.TeletexString=PX;Lv.NAME="TeletexString";var NX;class Uv extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}NX=Uv;xe.VideotexString=NX;Uv.NAME="VideotexString";var DX;class Fv extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}DX=Fv;xe.IA5String=DX;Fv.NAME="IA5String";var OX;class zv extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}OX=zv;xe.GraphicString=OX;zv.NAME="GraphicString";var RX;class qm extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}RX=qm;xe.VisibleString=RX;qm.NAME="VisibleString";var BX;class Vv extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}BX=Vv;xe.GeneralString=BX;Vv.NAME="GeneralString";var MX;class Hv extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}MX=Hv;xe.CharacterString=MX;Hv.NAME="CharacterString";var $X;class Wm extends qm{constructor({value:e,valueDate:t,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let s=0;s<e.length;s++)this.valueBlock.valueHexView[s]=e.charCodeAt(s)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,me.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}const s=parseInt(n[1],10);s>=50?this.year=1900+s:this.year=2e3+s,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=Ks(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=Ks(this.month,2),t[2]=Ks(this.day,2),t[3]=Ks(this.hour,2),t[4]=Ks(this.minute,2),t[5]=Ks(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}$X=Wm;xe.UTCTime=$X;Wm.NAME="UTCTime";var LX;class Kv extends Wm{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){const e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,n="",s="",i=0,o,a=0,c=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),t=!0;else{const d=new Number(e[e.length-1]);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(t){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let d=1,p=n.indexOf("+"),y="";if(p===-1&&(p=n.indexOf("-"),d=-1),p!==-1){if(y=n.substring(p+1),n=n.substring(0,p),y.length!==2&&y.length!==4)throw new Error("Wrong input string for conversion");let f=parseInt(y.substring(0,2),10);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");if(a=d*f,y.length===4){if(f=parseInt(y.substring(2,4),10),isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");c=d*f}}}let l=n.indexOf(".");if(l===-1&&(l=n.indexOf(",")),l!==-1){const d=new Number(`0${n.substring(l)}`);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");i=d.valueOf(),s=n.substring(0,l)}else s=n;switch(!0){case s.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,l!==-1)throw new Error("Wrong input string for conversion");break;case s.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=60*i;this.minute=Math.floor(d),d=60*(d-this.minute),this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case s.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=60*i;this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case s.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){const d=1e3*i;this.millisecond=Math.floor(d)}break;default:throw new Error("Wrong input string for conversion")}const u=o.exec(s);if(u===null)throw new Error("Wrong input string for conversion");for(let d=1;d<u.length;d++)switch(d){case 1:this.year=parseInt(u[d],10);break;case 2:this.month=parseInt(u[d],10);break;case 3:this.day=parseInt(u[d],10);break;case 4:this.hour=parseInt(u[d],10)+a;break;case 5:this.minute=parseInt(u[d],10)+c;break;case 6:this.second=parseInt(u[d],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const d=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=d.getUTCFullYear(),this.month=d.getUTCMonth(),this.day=d.getUTCDay(),this.hour=d.getUTCHours(),this.minute=d.getUTCMinutes(),this.second=d.getUTCSeconds(),this.millisecond=d.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push(Ks(this.year,4)),t.push(Ks(this.month,2)),t.push(Ks(this.day,2)),t.push(Ks(this.hour,2)),t.push(Ks(this.minute,2)),t.push(Ks(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(Ks(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}LX=Kv;xe.GeneralizedTime=LX;Kv.NAME="GeneralizedTime";var UX;class DP extends Zc{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}UX=DP;xe.DATE=UX;DP.NAME="DATE";var FX;class OP extends Zc{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}FX=OP;xe.TimeOfDay=FX;OP.NAME="TimeOfDay";var zX;class RP extends Zc{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}zX=RP;xe.DateTime=zX;RP.NAME="DateTime";var VX;class BP extends Zc{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}VX=BP;xe.Duration=VX;BP.NAME="Duration";var HX;class MP extends Zc{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}HX=MP;xe.TIME=HX;MP.NAME="TIME";class ef{constructor({name:e=us,optional:t=!1}={}){this.name=e,this.optional=t}}class $P extends ef{constructor({value:e=[],...t}={}){super(t),this.value=e}}class Gb extends ef{constructor({value:e=new ef,local:t=!1,...n}={}){super(n),this.value=e,this.local=t}}class uIe{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=me.toUint8Array(e)}constructor({data:e=Nv}={}){this.dataView=me.toUint8Array(e)}fromBER(e,t,n){const s=t+n;return this.dataView=me.toUint8Array(e).subarray(t,s),s}toBER(e){return this.dataView.slice().buffer}}function jh(r,e,t){if(t instanceof $P){for(const i of t.value)if(jh(r,e,i).verified)return{verified:!0,result:r};{const i={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(AE)&&(i.name=t.name),i}}if(t instanceof ef)return t.hasOwnProperty(AE)&&(r[t.name]=e),{verified:!0,result:r};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(ZCe in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(nIe in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(sIe in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const n=t.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(eIe)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(tIe)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(rIe)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:r};if(!(XCe in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:r};if(t.idBlock.isHexOnly){if(!(U$ in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const i=t.idBlock.valueHexView,o=e.idBlock.valueHexView;if(i.length!==o.length)return{verified:!1,result:r};for(let a=0;a<i.length;a++)if(i[a]!==o[1])return{verified:!1,result:r}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,us),t.name&&(r[t.name]=e)),t instanceof xe.Constructed){let i=0,o={verified:!1,result:{error:"Unknown error"}},a=t.valueBlock.value.length;if(a>0&&t.valueBlock.value[0]instanceof Gb&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:r};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let c=!0;for(let l=0;l<t.valueBlock.value.length;l++)c=c&&(t.valueBlock.value[l].optional||!1);return c?{verified:!0,result:r}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,us),t.name&&delete r[t.name]),r.error="Inconsistent object length",{verified:!1,result:r})}for(let c=0;c<a;c++)if(c-i>=e.valueBlock.value.length){if(t.valueBlock.value[c].optional===!1){const l={verified:!1,result:r};return r.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,us),t.name&&(delete r[t.name],l.name=t.name)),l}}else if(t.valueBlock.value[0]instanceof Gb){if(o=jh(r,e.valueBlock.value[c],t.valueBlock.value[0].value),o.verified===!1)if(t.valueBlock.value[0].optional)i++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,us),t.name&&delete r[t.name]),o;if(AE in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let l={};iIe in t.valueBlock.value[0]&&t.valueBlock.value[0].local?l=e:l=r,typeof l[t.valueBlock.value[0].name]>"u"&&(l[t.valueBlock.value[0].name]=[]),l[t.valueBlock.value[0].name].push(e.valueBlock.value[c])}}else if(o=jh(r,e.valueBlock.value[c-i],t.valueBlock.value[c]),o.verified===!1)if(t.valueBlock.value[c].optional)i++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,us),t.name&&delete r[t.name]),o;if(o.verified===!1){const c={verified:!1,result:r};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,us),t.name&&(delete r[t.name],c.name=t.name)),c}return{verified:!0,result:r}}if(t.primitiveSchema&&U$ in e.valueBlock){const i=rg(e.valueBlock.valueHexView);if(i.offset===-1){const o={verified:!1,result:i.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,us),t.name&&(delete r[t.name],o.name=t.name)),o}return jh(r,i.result,t.primitiveSchema)}return{verified:!0,result:r}}function hIe(r,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};const t=rg(me.toUint8Array(r));return t.offset===-1?{verified:!1,result:t.result}:jh(t.result,t.result,e)}const KX=Object.freeze(Object.defineProperty({__proto__:null,Any:ef,BaseBlock:Zr,BaseStringBlock:kP,BitString:Dd,BmpString:Rv,Boolean:Dv,CharacterString:Hv,Choice:$P,Constructed:xs,DATE:DP,DateTime:RP,Duration:BP,EndOfContent:TP,Enumerated:Ov,GeneralString:Vv,GeneralizedTime:Kv,GraphicString:zv,HexBlock:Ca,IA5String:Fv,Integer:xc,Null:Rc,NumericString:Mv,ObjectIdentifier:dc,OctetString:yo,Primitive:jm,PrintableString:$v,RawData:uIe,RelativeObjectIdentifier:NP,Repeated:Gb,Sequence:Dr,Set:Ac,TIME:MP,TeletexString:Lv,TimeOfDay:OP,UTCTime:Wm,UniversalString:Bv,Utf8String:Zc,ValueBlock:es,VideotexString:Uv,ViewWriter:Pv,VisibleString:qm,compareSchema:jh,fromBER:Ec,verifySchema:hIe},Symbol.toStringTag,{value:"Module"})),GX=_v({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});_v({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});_v({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});_v({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const dIe=16,gC=32,yC=1e4;async function Gv(r,e){const n=await qY().encrypt(r,e);return GX.encode(n)}async function z$(r,e,t){if(r.type==="RSA")return yIe(r,e,t);if(r.type==="Ed25519")return fIe(r,e,t);if(r.type==="secp256k1")return pIe(r,e,t);if(r.type==="ECDSA")return gIe(r,e,t);throw new If}async function fIe(r,e,t="libp2p-key"){if(t==="libp2p-key")return Gv(Lm(r),e);throw new ie(`export format '${t}' is not supported`)}async function pIe(r,e,t="libp2p-key"){if(t==="libp2p-key")return Gv(Lm(r),e);throw new ie("Export format is not supported")}async function gIe(r,e,t="libp2p-key"){if(t==="libp2p-key")return Gv(Lm(r),e);throw new ie(`export format '${t}' is not supported`)}async function yIe(r,e,t="pkcs-8"){if(t==="pkcs-8")return mIe(r,e);if(t==="libp2p-key")return Gv(Lm(r),e);throw new ie("Export format is not supported")}async function mIe(r,e){const t=ba.get(),s=new Dr({value:[new xc({value:0}),new Dr({value:[new dc({value:"1.2.840.113549.1.1.1"}),new Rc]}),new yo({valueHex:r.raw})]}).toBER(),i=new Uint8Array(s,0,s.byteLength),o=Fu(dIe),a=await IW(R_,e,o,{c:yC,dkLen:gC}),c=Fu(16),l=await t.subtle.importKey("raw",a,"AES-CBC",!1,["encrypt"]),u=await t.subtle.encrypt({name:"AES-CBC",iv:c},l,i),d=new Dr({value:[new yo({valueHex:o}),new xc({value:yC}),new xc({value:gC}),new Dr({value:[new dc({value:"1.2.840.113549.2.11"}),new Rc]})]}),p=new Dr({value:[new dc({value:"1.2.840.113549.1.5.13"}),new Dr({value:[new Dr({value:[new dc({value:"1.2.840.113549.1.5.12"}),d]}),new Dr({value:[new dc({value:"2.16.840.1.101.3.4.1.42"}),new yo({valueHex:c})]})]})]}),f=new Dr({value:[p,new yo({valueHex:u})]}).toBER(),g=new Uint8Array(f,0,f.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...ce(g,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join(`
`)}async function V$(r,e){try{const t=await wIe(r,e);return Wpe(t)}catch{}if(!r.includes("BEGIN"))throw new ie("Encrypted key was not a libp2p-key or a PEM file");return bIe(r,e)}async function wIe(r,e){const t=GX.decode(r);return qY().decrypt(t,e)}async function bIe(r,e){const t=ba.get();let n;if(r.includes("-----BEGIN ENCRYPTED PRIVATE KEY-----")){const i=he(r.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:o}=Ec(i),{iv:a,salt:c,iterations:l,keySize:u,cipherText:d}=vIe(o),p=await IW(R_,e,c,{c:l,dkLen:u}),y=await t.subtle.importKey("raw",p,"AES-CBC",!1,["decrypt"]),f=$2(await t.subtle.decrypt({name:"AES-CBC",iv:a},y,d)),{result:g}=Ec(f);n=H$(g)}else if(r.includes("-----BEGIN PRIVATE KEY-----")){const i=he(r.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:o}=Ec(i);n=H$(o)}else throw new ie("Could not parse private key from PEM data");const s=KA(n);if(s.type!=="RSA")throw new ie("Could not parse RSA private key from PEM data");return s}function vIe(r){const e=r.valueBlock.value[0];if(e.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.13")throw new ie("Only pkcs5PBES2 encrypted private keys are supported");const n=e.valueBlock.value[1].valueBlock.value[0];if(n.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.12")throw new ie("Only pkcs5PBKDF2 key derivation functions are supported");const i=n.valueBlock.value[1],o=$2(i.valueBlock.value[0].getValue());let a=yC,c=gC;if(i.valueBlock.value.length===3)a=Number(i.valueBlock.value[1].toBigInt()),c=Number(i.valueBlock.value[2].toBigInt());else if(i.valueBlock.value.length===2)throw new ie("Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key");const l=e.valueBlock.value[1].valueBlock.value[1],u=l.valueBlock.value[0].toString();if(u!=="OBJECT IDENTIFIER : 1.2.840.113549.3.7"){if(u!=="OBJECT IDENTIFIER : 1.3.14.3.2.7"){if(u!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2"){if(u!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22"){if(u!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42")throw new ie("Only AES-CBC encryption schemes are supported")}}}}const d=$2(l.valueBlock.value[1].getValue());return{cipherText:$2(r.valueBlock.value[1].getValue()),salt:o,iterations:a,keySize:c,iv:d}}function H$(r){return $2(r.valueBlock.value[2].getValue())}function $2(r){return new Uint8Array(r,0,r.byteLength)}const EIe="/pkcs8/",mC="/info/",Yg=new WeakMap,Ah={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},SE={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function Qf(r){return r==null||typeof r!="string"?!1:r===KCe(r.trim())&&r.length>0}async function Fr(){const t=Math.random()*800+200;await new Promise(n=>setTimeout(n,t))}function Sh(r){return new Dt(EIe+r)}function Jf(r){return new Dt(mC+r)}async function xIe(r){const e=Lm(r),t=await kCe.digest(e);return oCe.encode(t.bytes).substring(1)}var bV,vV;vV=Symbol.toStringTag,bV=Lr;class AIe{constructor(e,t){h(this,"components");h(this,"init");h(this,"log");h(this,"self");h(this,vV,"@libp2p/keychain");h(this,bV,["@libp2p/keychain"]);var s,i,o,a,c,l,u,d,p,y;if(this.components=e,this.log=e.logger.forComponent("libp2p:keychain"),this.init=CP(SE,t),this.self=t.selfKey??"self",this.init.pass!=null&&((s=this.init.pass)==null?void 0:s.length)<20)throw new Error("pass must be least 20 characters");if(((i=this.init.dek)==null?void 0:i.keyLength)!=null&&this.init.dek.keyLength<Ah.minKeyLength)throw new Error(`dek.keyLength must be least ${Ah.minKeyLength} bytes`);if(((a=(o=this.init.dek)==null?void 0:o.salt)==null?void 0:a.length)!=null&&this.init.dek.salt.length<Ah.minSaltLength)throw new Error(`dek.saltLength must be least ${Ah.minSaltLength} bytes`);if(((c=this.init.dek)==null?void 0:c.iterationCount)!=null&&this.init.dek.iterationCount<Ah.minIterationCount)throw new Error(`dek.iterationCount must be least ${Ah.minIterationCount}`);const n=this.init.pass!=null&&((l=this.init.dek)==null?void 0:l.salt)!=null?jR(this.init.pass,(u=this.init.dek)==null?void 0:u.salt,(d=this.init.dek)==null?void 0:d.iterationCount,(p=this.init.dek)==null?void 0:p.keyLength,(y=this.init.dek)==null?void 0:y.hash):"";Yg.set(this,{dek:n})}static generateOptions(){const e=Object.assign({},SE),t=Math.ceil(Ah.minSaltLength/3)*3;return e.dek.salt=ce(Fu(t),"base64"),e}static get options(){return SE}async findKeyByName(e){if(!Qf(e))throw await Fr(),new ie(`Invalid key name '${e}'`);const t=Jf(e);try{const n=await this.components.datastore.get(t);return JSON.parse(ce(n))}catch(n){throw await Fr(),this.log.error(n),new vr(`Key '${e}' does not exist.`)}}async findKeyById(e){try{const t={prefix:mC};for await(const n of this.components.datastore.query(t)){const s=JSON.parse(ce(n.value));if(s.id===e)return s}throw new ie(`Key with id '${e}' does not exist.`)}catch(t){throw await Fr(),t}}async importKey(e,t){if(!Qf(e))throw await Fr(),new ie(`Invalid key name '${e}'`);if(t==null)throw await Fr(),new ie("Key is required");const n=Sh(e);if(await this.components.datastore.has(n))throw await Fr(),new ie(`Key '${e}' already exists`);let i,o;try{i=await xIe(t);const l=Yg.get(this);if(l==null)throw new ie("dek missing");const u=l.dek;o=await z$(t,u,t.type==="RSA"?"pkcs-8":"libp2p-key")}catch(l){throw await Fr(),l}const a={name:e,id:i},c=this.components.datastore.batch();return c.put(n,he(o)),c.put(Jf(e),he(JSON.stringify(a))),await c.commit(),a}async exportKey(e){if(!Qf(e))throw await Fr(),new ie(`Invalid key name '${e}'`);const t=Sh(e);try{const n=await this.components.datastore.get(t),s=ce(n),i=Yg.get(this);if(i==null)throw new ie("dek missing");const o=i.dek;return await V$(s,o)}catch(n){throw await Fr(),n}}async removeKey(e){if(!Qf(e)||e===this.self)throw await Fr(),new ie(`Invalid key name '${e}'`);const t=Sh(e),n=await this.findKeyByName(e),s=this.components.datastore.batch();return s.delete(t),s.delete(Jf(e)),await s.commit(),n}async listKeys(){const e={prefix:mC},t=[];for await(const n of this.components.datastore.query(e))t.push(JSON.parse(ce(n.value)));return t}async renameKey(e,t){if(!Qf(e)||e===this.self)throw await Fr(),new ie(`Invalid old key name '${e}'`);if(!Qf(t)||t===this.self)throw await Fr(),new ie(`Invalid new key name '${t}'`);const n=Sh(e),s=Sh(t),i=Jf(e),o=Jf(t);if(await this.components.datastore.has(s))throw await Fr(),new ie(`Key '${t}' already exists`);try{const c=await this.components.datastore.get(n),l=await this.components.datastore.get(i),u=JSON.parse(ce(l));u.name=t;const d=this.components.datastore.batch();return d.put(s,c),d.put(o,he(JSON.stringify(u))),d.delete(n),d.delete(i),await d.commit(),u}catch(c){throw await Fr(),c}}async rotateKeychainPass(e,t){var a,c,l,u;if(typeof e!="string")throw await Fr(),new ie(`Invalid old pass type '${typeof e}'`);if(typeof t!="string")throw await Fr(),new ie(`Invalid new pass type '${typeof t}'`);if(t.length<20)throw await Fr(),new ie(`Invalid pass length ${t.length}`);this.log("recreating keychain");const n=Yg.get(this);if(n==null)throw new ie("dek missing");const s=n.dek;this.init.pass=t;const i=t!=null&&((a=this.init.dek)==null?void 0:a.salt)!=null?jR(t,this.init.dek.salt,(c=this.init.dek)==null?void 0:c.iterationCount,(l=this.init.dek)==null?void 0:l.keyLength,(u=this.init.dek)==null?void 0:u.hash):"";Yg.set(this,{dek:i});const o=await this.listKeys();for(const d of o){const p=await this.components.datastore.get(Sh(d.name)),y=ce(p),f=await V$(y,s),g=i.toString(),w=await z$(f,g,f.type==="RSA"?"pkcs-8":"libp2p-key"),m=this.components.datastore.batch(),b={name:d.name,id:d.id};m.put(Sh(d.name),he(w)),m.put(Jf(d.name),he(JSON.stringify(b))),await m.commit()}this.log("keychain reconstructed")}}function jX(r={}){return e=>new AIe(e,r)}class qX{constructor(e={}){h(this,"memoryStorage");h(this,"points");h(this,"duration");h(this,"blockDuration");h(this,"execEvenly");h(this,"execEvenlyMinDelayMs");h(this,"keyPrefix");this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??this.duration*1e3/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new SIe}async consume(e,t=1,n={}){const s=this.getKey(e),i=this._getKeySecDuration(n);let o=this.memoryStorage.incrby(s,t,i);if(o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.consumedPoints>this.points)throw this.blockDuration>0&&o.consumedPoints<=this.points+t&&(o=this.memoryStorage.set(s,o.consumedPoints,this.blockDuration)),new E0e("Rate limit exceeded",o);if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let a=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));a<this.execEvenlyMinDelayMs&&(a=o.consumedPoints*this.execEvenlyMinDelayMs),await IY(a)}return o}penalty(e,t=1,n={}){const s=this.getKey(e),i=this._getKeySecDuration(n),o=this.memoryStorage.incrby(s,t,i);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}reward(e,t=1,n={}){const s=this.getKey(e),i=this._getKeySecDuration(n),o=this.memoryStorage.incrby(s,-t,i);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}block(e,t){const n=t*1e3,s=this.points+1;return this.memoryStorage.set(this.getKey(e),s,t),{remainingPoints:0,msBeforeNext:n===0?-1:n,consumedPoints:s,isFirstInDuration:!1}}set(e,t,n=0){const s=(n>=0?n:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,n),{remainingPoints:0,msBeforeNext:s===0?-1:s,consumedPoints:t,isFirstInDuration:!1}}get(e){const t=this.memoryStorage.get(this.getKey(e));return t!=null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return(e==null?void 0:e.customDuration)!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}}class SIe{constructor(){h(this,"storage");this.storage=new Map}incrby(e,t,n){const s=this.storage.get(e);if(s!=null){const i=s.expiresAt!=null?s.expiresAt.getTime()-new Date().getTime():-1;return s.expiresAt==null||i>0?(s.value+=t,{remainingPoints:0,msBeforeNext:i,consumedPoints:s.value,isFirstInDuration:!1}):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){const s=n*1e3,i=this.storage.get(e);i!=null&&clearTimeout(i.timeoutId);const o={value:t,expiresAt:s>0?new Date(Date.now()+s):void 0};return this.storage.set(e,o),s>0&&(o.timeoutId=setTimeout(()=>{this.storage.delete(e)},s),o.timeoutId.unref!=null&&o.timeoutId.unref()),{remainingPoints:0,msBeforeNext:s===0?-1:s,consumedPoints:o.value,isFirstInDuration:!0}}get(e){const t=this.storage.get(e);if(t!=null)return{remainingPoints:0,msBeforeNext:t.expiresAt!=null?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){const t=this.storage.get(e);return t!=null?(t.timeoutId!=null&&clearTimeout(t.timeoutId),this.storage.delete(e),!0):!1}}var gt;(function(r){r[r.NEW_STREAM=0]="NEW_STREAM",r[r.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",r[r.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",r[r.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",r[r.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",r[r.RESET_RECEIVER=5]="RESET_RECEIVER",r[r.RESET_INITIATOR=6]="RESET_INITIATOR"})(gt||(gt={}));const LP=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),K$=Object.freeze({NEW_STREAM:gt.NEW_STREAM,MESSAGE:gt.MESSAGE_INITIATOR,CLOSE:gt.CLOSE_INITIATOR,RESET:gt.RESET_INITIATOR}),CIe=Object.freeze({MESSAGE:gt.MESSAGE_RECEIVER,CLOSE:gt.CLOSE_RECEIVER,RESET:gt.RESET_RECEIVER}),WX=1<<20,IIe=4<<20;let kIe=class{constructor(e=WX,t=IIe){h(this,"_buffer");h(this,"_headerInfo");h(this,"_maxMessageSize");h(this,"_maxUnprocessedMessageQueueSize");this._buffer=new Ge,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw new Rt("Unprocessed message queue size too large!");const t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(l){if(l.name==="InvalidMessageError")throw l;break}const{id:n,type:s,length:i,offset:o}=this._headerInfo;if(this._buffer.length-o<i)break;const c={id:n,type:s};(s===gt.NEW_STREAM||s===gt.MESSAGE_INITIATOR||s===gt.MESSAGE_RECEIVER)&&(c.data=this._buffer.sublist(o,o+i)),t.push(c),this._buffer.consume(o+i),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:n}=j$(e),{value:s,offset:i}=j$(e,n),o=t&7;if(LP[o]==null)throw new Error(`Invalid type received: ${o}`);if(s>this._maxMessageSize)throw new Rt("Message size too large");return{id:t>>3,type:o,offset:n+i,length:s}}};const TIe=128,G$=127;function j$(r,e=0){let t=0,n=0,s=e,i;const o=r.length;do{if(s>=o||n>49)throw e=0,new RangeError("Could not decode varint");i=r.get(s++),t+=n<28?(i&G$)<<n:(i&G$)*Math.pow(2,n),n+=7}while(i>=TIe);return e=s-e,{value:t,offset:e}}const CE=10*1024;let _Ie=class{constructor(){h(this,"_pool");h(this,"_poolOffset");this._pool=Ss(CE),this._poolOffset=0}write(e,t){const n=this._pool;let s=this._poolOffset;Jr(e.id<<3|e.type,n,s),s+=kt(e.id<<3|e.type),(e.type===gt.NEW_STREAM||e.type===gt.MESSAGE_INITIATOR||e.type===gt.MESSAGE_RECEIVER)&&e.data!=null?(Jr(e.data.length,n,s),s+=kt(e.data.length)):(Jr(0,n,s),s+=kt(0));const i=n.subarray(this._poolOffset,s);CE-s<100?(this._pool=Ss(CE),this._poolOffset=0):this._poolOffset=s,t.append(i),(e.type===gt.NEW_STREAM||e.type===gt.MESSAGE_INITIATOR||e.type===gt.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}};const PIe=new _Ie;async function*NIe(r){for await(const e of r){const t=new Ge;PIe.write(e,t),yield t}}class DIe extends Error{constructor(e="Stream input buffer error"){super(e),this.name="StreamInputBufferError"}}class OIe extends mP{constructor(t){super(t);h(this,"name");h(this,"streamId");h(this,"send");h(this,"types");h(this,"maxDataSize");this.types=t.direction==="outbound"?K$:CIe,this.send=t.send,this.name=t.name,this.streamId=t.streamId,this.maxDataSize=t.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:K$.NEW_STREAM,data:new Ge(he(this.name))})}async sendData(t){for(t=t.sublist();t.byteLength>0;){const n=Math.min(t.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:t.sublist(0,n)}),t.consume(n)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}function RIe(r){const{id:e,name:t,send:n,onEnd:s,type:i="initiator",maxMsgSize:o=WX}=r;return new OIe({id:i==="initiator"?`i${e}`:`r${e}`,streamId:e,name:`${t??e}`,direction:i==="initiator"?"outbound":"inbound",maxDataSize:o,onEnd:s,send:n,log:r.logger.forComponent(`libp2p:mplex:stream:${i}:${e}`)})}const BIe=1024,MIe=1024,$Ie=1024*1024*4,LIe=5,UIe=500;function q$(r){const e={...r,type:`${LP[r.type]} (${r.type})`};return r.type===gt.NEW_STREAM&&(e.data=ce(r.data instanceof Uint8Array?r.data:r.data.subarray())),(r.type===gt.MESSAGE_INITIATOR||r.type===gt.MESSAGE_RECEIVER)&&(e.data=ce(r.data instanceof Uint8Array?r.data:r.data.subarray(),"base16")),e}class FIe{constructor(e,t){h(this,"protocol","/mplex/6.7.0");h(this,"sink");h(this,"source");h(this,"log");h(this,"_streamId");h(this,"_streams");h(this,"_init");h(this,"_source");h(this,"closeController");h(this,"rateLimiter");h(this,"closeTimeout");h(this,"logger");t=t??{},this.log=e.logger.forComponent("libp2p:mplex"),this.logger=e.logger,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=t,this.closeTimeout=t.closeTimeout??UIe,this.sink=this._createSink(),this._source=Nc({objectMode:!0,onEnd:()=>{for(const n of this._streams.initiators.values())n.destroy();for(const n of this._streams.receivers.values())n.destroy()}}),this.source=Jn(this._source,n=>NIe(n)),this.closeController=new AbortController,this.rateLimiter=new qX({points:t.disconnectThreshold??LIe,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Ph("Muxer already closed");const t=this._streamId++;e=e==null?t.toString():e.toString();const n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}async close(e){if(this.closeController.signal.aborted)return;const t=(e==null?void 0:e.signal)??AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map(async n=>n.close({signal:t}))),this._source.end(),await this._source.onEmpty({signal:t}),this.closeController.abort()}catch(n){this.abort(n)}}abort(e){this.closeController.signal.aborted||(this.streams.forEach(t=>{t.abort(e)}),this.closeController.abort(e))}_newReceiverStream(e){const{id:t,name:n}=e,s=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:s})}_newStream(e){const{id:t,name:n,type:s,registry:i}=e;if(this.log("new %s stream %s",s,t),s==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??MIe))throw new F5("Too many outbound streams open");if(i.has(t))throw new Error(`${s} stream ${t} already exists!`);const c=RIe({id:t,name:n,send:async l=>{this.log.enabled&&this.log.trace("%s stream %s send",s,t,q$(l)),this._source.push(l)},type:s,onEnd:()=>{this.log("%s stream with id %s and protocol %s ended",s,t,c.protocol),i.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(c)},maxMsgSize:this._init.maxMsgSize,logger:this.logger});return i.set(t,c),c}_createSink(){return async t=>{const n=()=>{tY(t,this.log)};this.closeController.signal.addEventListener("abort",n);try{const s=new kIe(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const i of t)for(const o of s.write(i))await this._handleIncoming(o);this._source.end()}catch(s){this.log("error in sink",s),this._source.end(s)}finally{this.closeController.signal.removeEventListener("abort",n)}}}async _handleIncoming(e){const{id:t,type:n}=e;if(this.log.enabled&&this.log.trace("incoming message",q$(e)),e.type===gt.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??BIe)){this.log("too many inbound streams open"),this._source.push({id:t,type:gt.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(new Error("Too many open streams"));return}return}const a=this._newReceiverStream({id:t,name:ce(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(a);return}const i=((n&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(i==null){this.log("missing stream %s for message type %s",t,LP[n]);try{await this.rateLimiter.consume("missing-stream",1)}catch{this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(new Error("Too many messages for missing streams"));return}return}const o=this._init.maxStreamBufferSize??$Ie;try{switch(n){case gt.MESSAGE_INITIATOR:case gt.MESSAGE_RECEIVER:if(i.sourceReadableLength()>o)throw this._source.push({id:e.id,type:n===gt.MESSAGE_INITIATOR?gt.RESET_RECEIVER:gt.RESET_INITIATOR}),new DIe("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers");i.sourcePush(e.data);break;case gt.CLOSE_INITIATOR:case gt.CLOSE_RECEIVER:i.remoteCloseWrite();break;case gt.RESET_INITIATOR:case gt.RESET_RECEIVER:i.reset();break;default:this.log("unknown message type %s",n)}}catch(a){this.log.error("error while processing message",a),i.abort(a)}}}var EV,xV;xV=Symbol.toStringTag,EV=Lr;class zIe{constructor(e,t={}){h(this,"protocol","/mplex/6.7.0");h(this,"_init");h(this,"components");h(this,xV,"@libp2p/mplex");h(this,EV,["@libp2p/stream-multiplexing"]);this.components=e,this._init=t}createStreamMuxer(e={}){return new FIe(this.components,{...e,...this._init})}}function VIe(r={}){return e=>new zIe(e,r)}const IE=32,HIe="1.0.0",KIe="ping",GIe="ipfs",jIe=1e4,qIe=2,WIe=1;var AV,SV;SV=Symbol.toStringTag,AV=Lr;class QIe{constructor(e,t={}){h(this,"protocol");h(this,"components");h(this,"started");h(this,"timeout");h(this,"maxInboundStreams");h(this,"maxOutboundStreams");h(this,"runOnLimitedConnection");h(this,"log");h(this,SV,"@libp2p/ping");h(this,AV,["@libp2p/ping"]);this.components=e,this.log=e.logger.forComponent("libp2p:ping"),this.started=!1,this.protocol=`/${t.protocolPrefix??GIe}/${KIe}/${HIe}`,this.timeout=t.timeout??jIe,this.maxInboundStreams=t.maxInboundStreams??qIe,this.maxOutboundStreams=t.maxOutboundStreams??WIe,this.runOnLimitedConnection=t.runOnLimitedConnection??!0,this.handleMessage=this.handleMessage.bind(this)}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){this.log("incoming ping from %p",e.connection.remotePeer);const{stream:t}=e,n=Date.now(),s=Cb(t);let i=!1;Promise.resolve().then(async()=>{for(;;){const o=AbortSignal.timeout(this.timeout);o.addEventListener("abort",()=>{t==null||t.abort(new Rm("ping timeout"))});const a=await s.read({bytes:IE,signal:o});await s.write(a,{signal:o}),i=!0}}).catch(o=>{i&&o.name==="UnexpectedEOFError"&&t.readStatus!=="ready"||(this.log.error("incoming ping from %p failed with error - %e",e.connection.remotePeer,o),t==null||t.abort(o))}).finally(()=>{const o=Date.now()-n;this.log("incoming ping from %p complete in %dms",e.connection.remotePeer,o);const a=AbortSignal.timeout(this.timeout);t.close({signal:a}).catch(c=>{this.log.error("error closing ping stream from %p - %e",e.connection.remotePeer,c),t==null||t.abort(c)})})}async ping(e,t={}){this.log("pinging %p",e);const n=Date.now(),s=Fu(IE),i=await this.components.connectionManager.openConnection(e,t);let o;if(t.signal==null){const a=AbortSignal.timeout(this.timeout);t={...t,signal:a}}try{o=await i.newStream(this.protocol,{...t,runOnLimitedConnection:this.runOnLimitedConnection});const a=Cb(o),[,c]=await Promise.all([a.write(s,t),a.read({...t,bytes:IE})]),l=Date.now()-n;if(!rt(s,c.subarray()))throw new Rj(`Received wrong ping ack after ${l}ms`);return this.log("ping %p complete in %dms",i.remotePeer,l),l}catch(a){throw this.log.error("error while pinging %p",i.remotePeer,a),o==null||o.abort(a),a}finally{o!=null&&await o.close(t)}}}function JIe(r={}){return e=>new QIe(e,r)}var ss;(function(r){(function(n){n.FIN="FIN",n.STOP_SENDING="STOP_SENDING",n.RESET="RESET",n.FIN_ACK="FIN_ACK"})(r.Flag||(r.Flag={}));let e;(function(n){n[n.FIN=0]="FIN",n[n.STOP_SENDING=1]="STOP_SENDING",n[n.RESET=2]="RESET",n[n.FIN_ACK=3]="FIN_ACK"})(e||(e={})),function(n){n.codec=()=>Cs(e)}(r.Flag||(r.Flag={}));let t;r.codec=()=>(t==null&&(t=Fe((n,s,i={})=>{i.lengthDelimited!==!1&&s.fork(),n.flag!=null&&(s.uint32(8),r.Flag.codec().encode(n.flag,s)),n.message!=null&&(s.uint32(18),s.bytes(n.message)),i.lengthDelimited!==!1&&s.ldelim()},(n,s,i={})=>{const o={},a=s==null?n.len:n.pos+s;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.flag=r.Flag.codec().decode(n);break}case 2:{o.message=n.bytes();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>Ue(n,r.codec()),r.decode=(n,s)=>Le(n,r.codec(),s)})(ss||(ss={}));const YIe=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],W$=Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),XIe="libp2p+webrtc+v1/",ZIe=466,eke=2*1024*1024,tke=30*1e3,jv=16*1024;function rke(r=jv){const e=kt(r-kt(r)),t=1+kt(Object.keys(ss.Flag).length-1),n=1,s=r-e-t-n,i=kt(s);return e+t+n+i}const nke=rke(),ske=5e3,ike=5e3,oke=3e4,QX="/webrtc",wC="/webrtc-signaling/0.0.1",ake="/libp2p/webrtc-direct/certificate",cke="webrtc-direct-certificate-private-key",lke=12096e5,Q$=864e5;var J$=function(r,e,t){if(t||arguments.length===2)for(var n=0,s=e.length,i;n<s;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},uke=function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r}(),hke=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}(),dke=function(){function r(e,t,n,s){this.name=e,this.version=t,this.os=n,this.bot=s,this.type="bot-device"}return r}(),fke=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),pke=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),gke=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,yke=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Y$=3,mke=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",gke]],X$=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function wke(r){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new pke:typeof navigator<"u"?vke(navigator.userAgent):xke()}function bke(r){return r!==""&&mke.reduce(function(e,t){var n=t[0],s=t[1];if(e)return e;var i=s.exec(r);return!!i&&[n,i]},!1)}function vke(r){var e=bke(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new fke;var s=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);s?s.length<Y$&&(s=J$(J$([],s,!0),Ake(Y$-s.length),!0)):s=[];var i=s.join("."),o=Eke(r),a=yke.exec(r);return a&&a[1]?new dke(t,i,o,a[1]):new uke(t,i,o)}function Eke(r){for(var e=0,t=X$.length;e<t;e++){var n=X$[e],s=n[0],i=n[1],o=i.exec(r);if(o)return s}return null}function xke(){var r=typeof process<"u"&&process.version;return r?new hke(process.version.slice(1)):null}function Ake(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}const Z$=wke(),UP=Z$!=null&&Z$.name==="firefox",JX=async function*(){},YX=async r=>{};function Ske(r,e,t=oke,n){r.readyState==="open"&&Promise.resolve().then(async()=>{if(r.bufferedAmount>0){n.log("%s drain channel with %d buffered bytes",e,r.bufferedAmount);const s=He();let i=!1;r.bufferedAmountLowThreshold=0;const o=()=>{i||(n.log("%s drain channel closed before drain",e),s.resolve())};r.addEventListener("close",o,{once:!0}),r.addEventListener("bufferedamountlow",()=>{i=!0,r.removeEventListener("close",o),s.resolve()}),await Im(s.promise,{milliseconds:t})}}).then(async()=>{r.readyState==="open"&&r.close()}).catch(s=>{n.log.error("error closing outbound stream",s)})}async function eL(r){return r=r??{},typeof r=="function"&&(r=await r()),r.iceServers=r.iceServers??YIe.map(e=>({urls:[e]})),r}const Cke=(r=32)=>XIe+[...Array(r)].map(()=>W$.at(Math.floor(Math.random()*W$.length))).join("");class bC{constructor(e,t){h(this,"log");h(this,"peerConnection");h(this,"remoteAddr");h(this,"timeline");h(this,"metrics");h(this,"source",JX());h(this,"sink",YX);this.log=e.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=t.remoteAddr,this.timeline=t.timeline,this.peerConnection=t.peerConnection;const n=this.peerConnection,s=n.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",n.connectionState,"initial state",s),(n.connectionState==="disconnected"||n.connectionState==="failed"||n.connectionState==="closed")&&(this.timeline.close=Date.now())}}async close(e){var t;this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),(t=this.metrics)==null||t.increment({close:!0})}abort(e){var t;this.log.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),(t=this.metrics)==null||t.increment({abort:!0})}}class Ike extends mP{constructor(t){const n=t.onEnd;t.onEnd=i=>{this.log.trace('readable and writeable ends closed with status "%s"',this.status),Promise.resolve(async()=>{if(!(this.timeline.abort!=null||this.timeline.reset!==null))try{await Im(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(o){this.log.error("error receiving FIN_ACK",o)}}).then(()=>{this.incomingData.end(),n==null||n(i)}).catch(o=>{this.log.error("error ending stream",o)}).finally(()=>{this.channel.close()})};super(t);h(this,"channel");h(this,"incomingData");h(this,"maxBufferedAmount");h(this,"bufferedAmountLowEventTimeout");h(this,"maxMessageSize");h(this,"receiveFinAck");h(this,"finAckTimeout");h(this,"openTimeout");h(this,"closeController");switch(this.channel=t.channel,this.channel.binaryType="arraybuffer",this.incomingData=Nc(),this.bufferedAmountLowEventTimeout=t.bufferedAmountLowEventTimeout??tke,this.maxBufferedAmount=t.maxBufferedAmount??eke,this.maxMessageSize=(t.maxMessageSize??jv)-nke,this.receiveFinAck=He(),this.finAckTimeout=t.closeTimeout??ske,this.openTimeout=t.openTimeout??ike,this.closeController=new AbortController,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(this.timeline.close===void 0||this.timeline.close===0)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new x8("Unknown datachannel state")}this.channel.onopen=i=>{this.timeline.open=new Date().getTime()},this.channel.onclose=i=>{this.log.trace("received onclose event"),this.closeController.abort(),this.receiveFinAck.resolve(),this.close().catch(o=>{this.log.error("error closing stream after channel closed",o)})},this.channel.onerror=i=>{this.log.trace("received onerror event"),this.closeController.abort();const o=i.error;this.abort(o)},this.channel.onmessage=async i=>{const{data:o}=i;o===null||o.byteLength===0||this.incomingData.push(new Uint8Array(o,0,o.byteLength))};const s=this;Promise.resolve().then(async()=>{for await(const i of s1(this.incomingData)){const o=s.processIncomingProtobuf(i);o!=null&&s.sourcePush(new Ge(o))}}).catch(i=>{this.log.error("error processing incoming data channel messages",i)})}sendNewStream(){}async _sendMessage(t,n=!0){if(this.channel.readyState==="closed"||this.channel.readyState==="closing")throw new x8(`Invalid datachannel state - ${this.channel.readyState}`);if(this.channel.readyState!=="open"){const s=AbortSignal.timeout(this.openTimeout),i=At([this.closeController.signal,s]);try{this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await Di(this.channel,"open",i)}finally{i.clear()}this.log('channel state is now "%s", sending data',this.channel.readyState)}if(n&&this.channel.bufferedAmount>this.maxBufferedAmount){const s=AbortSignal.timeout(this.bufferedAmountLowEventTimeout),i=At([this.closeController.signal,s]);try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await Di(this.channel,"bufferedamountlow",i)}catch(o){throw s.aborted?new Rm(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`):o}finally{i.clear()}}try{this.log.trace('sending message, channel state "%s"',this.channel.readyState),this.channel.send(t.subarray())}catch(s){this.log.error("error while sending message",s)}}async sendData(t){const n=t.byteLength;for(t=t.sublist();t.byteLength>0;){const s=Math.min(t.byteLength,this.maxMessageSize),i=t.subarray(0,s),o=ss.encode({message:i}),a=n1.single(o);this.log.trace("sending %d/%d bytes on channel",i.byteLength,n),await this._sendMessage(a),t.consume(s)}this.log.trace('finished sending data, channel state "%s"',this.channel.readyState)}async sendReset(){try{await this._sendFlag(ss.Flag.RESET)}catch(t){this.log.error("failed to send reset - %e",t)}finally{this.channel.close()}}async sendCloseWrite(t){if(this.channel.readyState!=="open"){this.receiveFinAck.resolve();return}if(await this._sendFlag(ss.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await Vn(this.receiveFinAck.promise,t==null?void 0:t.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorName:"FinAckNotReceivedError"})}catch(s){this.log.error("failed to await FIN_ACK",s)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){this.channel.readyState==="open"&&await this._sendFlag(ss.Flag.STOP_SENDING)}processIncomingProtobuf(t){const n=ss.decode(t);if(n.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',n.flag,this.writeStatus,this.readStatus),n.flag===ss.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(ss.Flag.FIN_ACK).catch(s=>{this.log.error("error sending FIN_ACK immediately",s)})),n.flag===ss.Flag.RESET&&this.reset(),n.flag===ss.Flag.STOP_SENDING&&this.remoteCloseRead(),n.flag===ss.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),this.readStatus==="ready")return n.message}async _sendFlag(t){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',t.toString(),this.channel.readyState),!1;this.log.trace("sending flag %s",t.toString());const n=ss.encode({flag:t}),s=n1.single(n);try{return await this._sendMessage(s,!1),!0}catch(i){this.log.error("could not send flag %s - %e",t.toString(),i)}return!1}}function jb(r){const{channel:e,direction:t,handshake:n}=r;return new Ike({id:`${e.id}`,log:r.logger.forComponent(`libp2p:webrtc:stream:${n===!0?"handshake":t}:${e.id}`),...r})}class FP{constructor(e,t){h(this,"protocol");h(this,"peerConnection");h(this,"bufferedStreams",[]);h(this,"metrics");h(this,"dataChannelOptions");h(this,"components");h(this,"log");this.components=e,this.peerConnection=t.peerConnection,this.metrics=t.metrics,this.protocol=t.protocol??QX,this.dataChannelOptions=t.dataChannelOptions??{},this.log=e.logger.forComponent("libp2p:webrtc:muxerfactory"),this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',n.id),n.label==="init"){this.log.trace("closing early init channel"),n.close();return}const s={},i=jb({channel:n,direction:"inbound",onEnd:o=>{s.onEnd(o)},logger:e.logger,...this.dataChannelOptions});s.stream=i,s.channel=n,s.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(o=>o.stream.id!==i.id)},this.bufferedStreams.push(s)}}createStreamMuxer(e){return new kke(this.components,{...e,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}}var t0,b4;class kke{constructor(e,t){Q(this,t0);h(this,"init");h(this,"streams");h(this,"protocol");h(this,"log");h(this,"peerConnection");h(this,"dataChannelOptions");h(this,"metrics");h(this,"logger");h(this,"source",JX());h(this,"sink",YX);this.init=t,this.log=e.logger.forComponent("libp2p:webrtc:muxer"),this.logger=e.logger,this.streams=t.streams.map(n=>n.stream),this.peerConnection=t.peerConnection,this.protocol=t.protocol??QX,this.metrics=t.metrics,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:n})=>{var o,a;if(this.log.trace("incoming datachannel with channel id %d",n.id),n.label==="init"){this.log.trace("closing init channel"),n.close();return}const s=n.id,i=jb({channel:n,direction:"inbound",onEnd:()=>{te(this,t0,b4).call(this,i,n),this.log("incoming channel %s ended",s)},logger:this.logger,...this.dataChannelOptions});this.streams.push(i),(o=this.metrics)==null||o.increment({incoming_stream:!0}),(a=t==null?void 0:t.onIncomingStream)==null||a.call(t,i)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(n=>{var s,i,o;n.onEnd=()=>{this.log("incoming early channel %s ended with state %s",n.channel.id,n.channel.readyState),te(this,t0,b4).call(this,n.stream,n.channel)},(s=this.metrics)==null||s.increment({incoming_stream:!0}),(o=(i=this.init)==null?void 0:i.onIncomingStream)==null||o.call(i,n.stream)})})}async close(e){try{await Promise.all(this.streams.map(async t=>t.close(e)))}catch(t){this.abort(t)}}abort(e){for(const t of this.streams)t.abort(e)}newStream(){var s;const e=this.peerConnection.createDataChannel(""),t=e.id;this.log.trace("opened outgoing datachannel with channel id %s",t);const n=jb({channel:e,direction:"outbound",onEnd:()=>{te(this,t0,b4).call(this,n,e),this.log("outgoing channel %s ended",t)},logger:this.logger,...this.dataChannelOptions});return this.streams.push(n),(s=this.metrics)==null||s.increment({outgoing_stream:!0}),n}}t0=new WeakSet,b4=function(e,t){var n,s,i;this.log.trace("stream %s %s %s onEnd",e.direction,e.id,e.protocol),Ske(t,`${e.direction} ${e.id} ${e.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(o=>o.id!==e.id),(n=this.metrics)==null||n.increment({stream_end:!0}),(i=(s=this.init)==null?void 0:s.onStreamEnd)==null||i.call(s,e)};const XX=globalThis.RTCPeerConnection,ZX=globalThis.RTCSessionDescription,Tke=globalThis.RTCIceCandidate;class Qm extends Error{constructor(e){super(`WebRTC transport error: ${e}`),this.name="WebRTCTransportError"}}class fu extends Qm{constructor(e="SDP handshake failed"){super(e),this.name="SDPHandshakeFailedError"}}class _ke extends Qm{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`),this.name="WebRTC/InvalidFingerprintError"}}class Pke extends Qm{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}}class Nke extends Qm{constructor(e){super(`unsupported hash algorithm code: ${e} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}}var mo;(function(r){(function(n){n.SDP_OFFER="SDP_OFFER",n.SDP_ANSWER="SDP_ANSWER",n.ICE_CANDIDATE="ICE_CANDIDATE"})(r.Type||(r.Type={}));let e;(function(n){n[n.SDP_OFFER=0]="SDP_OFFER",n[n.SDP_ANSWER=1]="SDP_ANSWER",n[n.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(e||(e={})),function(n){n.codec=()=>Cs(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=Fe((n,s,i={})=>{i.lengthDelimited!==!1&&s.fork(),n.type!=null&&(s.uint32(8),r.Type.codec().encode(n.type,s)),n.data!=null&&(s.uint32(18),s.string(n.data)),i.lengthDelimited!==!1&&s.ldelim()},(n,s,i={})=>{const o={},a=s==null?n.len:n.pos+s;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.data=n.string();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>Ue(n,r.codec()),r.decode=(n,s)=>Le(n,r.codec(),s)})(mo||(mo={}));const eZ=async(r,e,t)=>{var n,s,i,o;try{const a=He();for(Dke(r,a);;){const c=await Promise.race([a.promise,e.read({signal:t.signal}).catch(()=>{})]);if(c==null){(n=t.signal)==null||n.throwIfAborted();break}if(c.type!==mo.Type.ICE_CANDIDATE)throw new Rt("ICE candidate message expected");const l=JSON.parse(c.data??"null");if(l===""||l===null){(s=t.onProgress)==null||s.call(t,new Re("webrtc:end-of-ice-candidates")),t.log.trace("end-of-candidates received");continue}const u=new Tke(l);t.log.trace("%s received new ICE candidate %o",t.direction,l);try{(i=t.onProgress)==null||i.call(t,new Re("webrtc:add-ice-candidate",u.candidate)),await r.addIceCandidate(u)}catch(d){t.log.error("%s bad candidate received",t.direction,l,d)}}}catch(a){if(t.log.error("%s error parsing ICE candidate",t.direction,a),((o=t.signal)==null?void 0:o.aborted)===!0&&zP(r)!=="connected")throw a}};function zP(r){return UP?r.iceConnectionState:r.connectionState}function Dke(r,e){r[UP?"oniceconnectionstatechange":"onconnectionstatechange"]=t=>{switch(zP(r)){case"connected":e.resolve();break;case"failed":case"disconnected":case"closed":e.reject(new ZT("RTCPeerConnection was closed"));break}}}async function Oke({rtcConfiguration:r,dataChannel:e,signal:t,metrics:n,multiaddr:s,connectionManager:i,transportManager:o,log:a,logger:c,onProgress:l}){const{baseAddr:u}=Mke(s);n==null||n.dialerEvents.increment({open:!0}),a.trace("dialing base address: %a",u);const d=u.getPeerId();if(d==null)throw new ie("Relay peer was missing");const p=i.getConnections(mr(d));let y,f=!1;p.length===0?(l==null||l(new Re("webrtc:dial-relay")),y=await o.dial(u,{signal:t,onProgress:l}),f=!0):(l==null||l(new Re("webrtc:reuse-relay-connection")),y=p[0]);try{l==null||l(new Re("webrtc:open-signaling-stream"));const g=await y.newStream(wC,{signal:t,runOnLimitedConnection:!0}),w=Xs(g).pb(mo),m=new XX(r),b=new FP({logger:c},{peerConnection:m,dataChannelOptions:e});try{const v=m.createDataChannel("init");m.onicecandidate=({candidate:x})=>{const C=JSON.stringify((x==null?void 0:x.toJSON())??null);a.trace("initiator sending ICE candidate %o",x),w.write({type:mo.Type.ICE_CANDIDATE,data:C},{signal:t}).catch(P=>{a.error("error sending ICE candidate",P)})},m.onicecandidateerror=x=>{a.error("initiator ICE candidate error",x)};const E=await m.createOffer().catch(x=>{throw a.error("could not execute createOffer",x),new fu("Failed to set createOffer")});a.trace("initiator send SDP offer %s",E.sdp),l==null||l(new Re("webrtc:send-sdp-offer")),await w.write({type:mo.Type.SDP_OFFER,data:E.sdp},{signal:t}),await m.setLocalDescription(E).catch(x=>{throw a.error("could not execute setLocalDescription",x),new fu("Failed to set localDescription")}),l==null||l(new Re("webrtc:read-sdp-answer")),a.trace("initiator read SDP answer");const S=await w.read({signal:t});if(S.type!==mo.Type.SDP_ANSWER)throw new fu("Remote should send an SDP answer");a.trace("initiator received SDP answer %s",S.data);const I=new ZX({type:"answer",sdp:S.data});return await m.setRemoteDescription(I).catch(x=>{throw a.error("could not execute setRemoteDescription",x),new fu("Failed to set remoteDescription")}),a.trace("initiator read candidates until connected"),l==null||l(new Re("webrtc:read-ice-candidates")),await eZ(m,w,{direction:"initiator",signal:t,log:a,onProgress:l}),a.trace("initiator connected, closing init channel"),v.close(),l==null||l(new Re("webrtc:close-signaling-stream")),a.trace("closing signaling channel"),await g.close({signal:t}),a.trace("initiator connected to remote address %s",s),{remoteAddress:s,peerConnection:m,muxerFactory:b}}catch(v){throw a.error("outgoing signaling error",v),m.close(),g.abort(v),v}finally{m.onicecandidate=null,m.onicecandidateerror=null}}finally{if(f)try{await y.close({signal:t})}catch(g){y.abort(g)}}}const tL=Lt(FQ.matchers[0],ot("p2p-circuit"));class VP extends Er{constructor(t,n){super();h(this,"transportManager");h(this,"shutdownController");h(this,"events");this.transportManager=t.transportManager,this.events=t.events,this.shutdownController=n.shutdownController,this.onTransportListening=this.onTransportListening.bind(this)}async listen(){this.events.addEventListener("transport:listening",this.onTransportListening)}onTransportListening(t){t.detail.getAddrs().filter(s=>tL.exactMatch(s)).map(s=>s.encapsulate("/webrtc")).length>0&&this.safeDispatchEvent("listening")}getAddrs(){return this.transportManager.getListeners().filter(t=>!(t instanceof VP)).map(t=>t.getAddrs().filter(n=>tL.exactMatch(n)).map(n=>n.encapsulate("/webrtc"))).flat()}updateAnnounceAddrs(){}async close(){this.events.removeEventListener("transport:listening",this.onTransportListening),this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})}}async function Rke({peerConnection:r,stream:e,signal:t,connection:n,log:s}){s.trace("new inbound signaling stream");const i=Xs(e).pb(mo);try{r.onicecandidate=({candidate:u})=>{const d=JSON.stringify((u==null?void 0:u.toJSON())??null);s.trace("recipient sending ICE candidate %s",d),i.write({type:mo.Type.ICE_CANDIDATE,data:d},{signal:t}).catch(p=>{s.error("error sending ICE candidate",p)})},s.trace("recipient read SDP offer");const a=await i.read({signal:t});if(a.type!==mo.Type.SDP_OFFER)throw new fu(`expected message type SDP_OFFER, received: ${a.type??"undefined"} `);s.trace("recipient received SDP offer %s",a.data);const c=new ZX({type:"offer",sdp:a.data});await r.setRemoteDescription(c).catch(u=>{throw s.error("could not execute setRemoteDescription",u),new fu("Failed to set remoteDescription")});const l=await r.createAnswer().catch(u=>{throw s.error("could not execute createAnswer",u),new fu("Failed to create answer")});s.trace("recipient send SDP answer %s",l.sdp),await i.write({type:mo.Type.SDP_ANSWER,data:l.sdp},{signal:t}),await r.setLocalDescription(l).catch(u=>{throw s.error("could not execute setLocalDescription",u),new fu("Failed to set localDescription")}),s.trace("recipient read candidates until connected"),await eZ(r,i,{direction:"recipient",signal:t,log:s})}catch(a){if(zP(r)!=="connected")throw s.error("error while handling signaling stream from peer %a",n.remoteAddr,a),r.close(),a;s("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",n.remoteAddr,a)}const o=Ve(`/webrtc/p2p/${n.remoteAddr.getPeerId()}`);return s.trace("recipient connected to remote address %s",o),{remoteAddress:o}}var CV,IV,kV,TV;TV=$5,kV=Symbol.toStringTag,IV=Lr,CV=Lu;class Bke{constructor(e,t={}){h(this,"components");h(this,"init");h(this,"log");h(this,"_started",!1);h(this,"metrics");h(this,"shutdownController");h(this,TV,!0);h(this,kV,"@libp2p/webrtc");h(this,IV,["@libp2p/transport"]);h(this,CV,["@libp2p/identify","@libp2p/circuit-relay-v2-transport"]);this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}isStarted(){return this._started}async start(){await this.components.registrar.handle(wC,e=>{const t=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);this._onProtocol(e,t).catch(n=>{this.log.error("failed to handle incoming connect from %p",e.connection.remotePeer,n)}).finally(()=>{t.clear()})},{runOnLimitedConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(wC),this._started=!1}createListener(e){return new VP(this.components,{shutdownController:this.shutdownController})}listenFilter(e){return e.filter(vS.exactMatch)}dialFilter(e){return this.listenFilter(e)}async dial(e,t){var c;this.log.trace("dialing address: %a",e);const{remoteAddress:n,peerConnection:s,muxerFactory:i}=await Oke({rtcConfiguration:await eL(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:t.onProgress}),o=new bC(this.components,{peerConnection:s,timeline:{open:Date.now()},remoteAddr:n,metrics:(c=this.metrics)==null?void 0:c.dialerEvents}),a=await t.upgrader.upgradeOutbound(o,{skipProtection:!0,skipEncryption:!0,muxerFactory:i,onProgress:t.onProgress,signal:t.signal});return this._closeOnShutdown(s,o),a}async _onProtocol({connection:e,stream:t},n){var o;const s=new XX(await eL(this.init.rtcConfiguration)),i=new FP(this.components,{peerConnection:s,dataChannelOptions:this.init.dataChannel});try{const{remoteAddress:a}=await Rke({peerConnection:s,connection:e,stream:t,signal:n,log:this.log});await t.close({signal:n});const c=new bC(this.components,{peerConnection:s,timeline:{open:new Date().getTime()},remoteAddr:a,metrics:(o=this.metrics)==null?void 0:o.listenerEvents});await this.components.upgrader.upgradeInbound(c,{skipEncryption:!0,skipProtection:!0,muxerFactory:i,signal:n}),this._closeOnShutdown(s,c)}catch(a){throw this.log.error("incoming signaling error",a),s.close(),t.abort(a),a}}_closeOnShutdown(e,t){const n=()=>{t.close().catch(s=>{this.log.error("could not close WebRTCMultiaddrConnection",s)})};this.shutdownController.signal.addEventListener("abort",n),e.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",n)})}}function Mke(r){const e=r.toString().split("/webrtc/");if(e.length!==2)throw new ie("webrtc protocol was not present in multiaddr");if(!e[0].includes("/p2p-circuit"))throw new ie("p2p-circuit protocol was not present in multiaddr");let t=Ve(e[0]);const s=Ve("/"+e[1]).getPeerId();if(s==null)throw new ie("destination peer id was missing");const i=t.protos().pop();if(i===void 0)throw new ie("invalid multiaddr");return i.name!=="p2p"&&(t=t.encapsulate(`/p2p/${s}`)),{baseAddr:t,peerId:mr(s)}}/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var rL;(function(r){(function(e){var t=typeof globalThis=="object"?globalThis:typeof W2=="object"?W2:typeof self=="object"?self:typeof this=="object"?this:a(),n=s(r);typeof t.Reflect<"u"&&(n=s(t.Reflect,n)),e(n,t),typeof t.Reflect>"u"&&(t.Reflect=r);function s(c,l){return function(u,d){Object.defineProperty(c,u,{configurable:!0,writable:!0,value:d}),l&&l(u,d)}}function i(){try{return Function("return this;")()}catch{}}function o(){try{return(0,eval)("(function() { return this; })()")}catch{}}function a(){return i()||o()}})(function(e,t){var n=Object.prototype.hasOwnProperty,s=typeof Symbol=="function",i=s&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=s&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",c={__proto__:[]}instanceof Array,l=!a&&!c,u={create:a?function(){return B(Object.create(null))}:c?function(){return B({__proto__:null})}:function(){return B({})},has:l?function(N,R){return n.call(N,R)}:function(N,R){return R in N},get:l?function(N,R){return n.call(N,R)?N[R]:void 0}:function(N,R){return N[R]}},d=Object.getPrototypeOf(Function),p=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:D(),y=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:A(),f=typeof WeakMap=="function"?WeakMap:k(),g=s?Symbol.for("@reflect-metadata:registry"):void 0,w=pg(),m=z7(w);function b(N,R,F,re){if(J(F)){if(!Nt(N))throw new TypeError;if(!at(R))throw new TypeError;return V(N,R)}else{if(!Nt(N))throw new TypeError;if(!de(R))throw new TypeError;if(!de(re)&&!J(re)&&!le(re))throw new TypeError;return le(re)&&(re=void 0),F=et(F),Z(N,R,F,re)}}e("decorate",b);function v(N,R){function F(re,we){if(!de(re))throw new TypeError;if(!J(we)&&!Ut(we))throw new TypeError;$(N,R,re,we)}return F}e("metadata",v);function E(N,R,F,re){if(!de(F))throw new TypeError;return J(re)||(re=et(re)),$(N,R,F,re)}e("defineMetadata",E);function S(N,R,F){if(!de(R))throw new TypeError;return J(F)||(F=et(F)),Y(N,R,F)}e("hasMetadata",S);function I(N,R,F){if(!de(R))throw new TypeError;return J(F)||(F=et(F)),U(N,R,F)}e("hasOwnMetadata",I);function x(N,R,F){if(!de(R))throw new TypeError;return J(F)||(F=et(F)),H(N,R,F)}e("getMetadata",x);function C(N,R,F){if(!de(R))throw new TypeError;return J(F)||(F=et(F)),G(N,R,F)}e("getOwnMetadata",C);function P(N,R){if(!de(N))throw new TypeError;return J(R)||(R=et(R)),z(N,R)}e("getMetadataKeys",P);function L(N,R){if(!de(N))throw new TypeError;return J(R)||(R=et(R)),W(N,R)}e("getOwnMetadataKeys",L);function K(N,R,F){if(!de(R))throw new TypeError;if(J(F)||(F=et(F)),!de(R))throw new TypeError;J(F)||(F=et(F));var re=fh(R,F,!1);return J(re)?!1:re.OrdinaryDeleteMetadata(N,R,F)}e("deleteMetadata",K);function V(N,R){for(var F=N.length-1;F>=0;--F){var re=N[F],we=re(R);if(!J(we)&&!le(we)){if(!at(we))throw new TypeError;R=we}}return R}function Z(N,R,F,re){for(var we=N.length-1;we>=0;--we){var ze=N[we],je=ze(R,F,re);if(!J(je)&&!le(je)){if(!de(je))throw new TypeError;re=je}}return re}function Y(N,R,F){var re=U(N,R,F);if(re)return!0;var we=sl(R);return le(we)?!1:Y(N,we,F)}function U(N,R,F){var re=fh(R,F,!1);return J(re)?!1:$e(re.OrdinaryHasOwnMetadata(N,R,F))}function H(N,R,F){var re=U(N,R,F);if(re)return G(N,R,F);var we=sl(R);if(!le(we))return H(N,we,F)}function G(N,R,F){var re=fh(R,F,!1);if(!J(re))return re.OrdinaryGetOwnMetadata(N,R,F)}function $(N,R,F,re){var we=fh(F,re,!0);we.OrdinaryDefineOwnMetadata(N,R,F,re)}function z(N,R){var F=W(N,R),re=sl(N);if(re===null)return F;var we=z(re,R);if(we.length<=0)return F;if(F.length<=0)return we;for(var ze=new y,je=[],Ie=0,be=F;Ie<be.length;Ie++){var Ae=be[Ie],_e=ze.has(Ae);_e||(ze.add(Ae),je.push(Ae))}for(var Ne=0,st=we;Ne<st.length;Ne++){var Ae=st[Ne],_e=ze.has(Ae);_e||(ze.add(Ae),je.push(Ae))}return je}function W(N,R){var F=fh(N,R,!1);return F?F.OrdinaryOwnMetadataKeys(N,R):[]}function ee(N){if(N===null)return 1;switch(typeof N){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return N===null?1:6;default:return 6}}function J(N){return N===void 0}function le(N){return N===null}function ye(N){return typeof N=="symbol"}function de(N){return typeof N=="object"?N!==null:typeof N=="function"}function fe(N,R){switch(ee(N)){case 0:return N;case 1:return N;case 2:return N;case 3:return N;case 4:return N;case 5:return N}var F="string",re=Ro(N,i);if(re!==void 0){var we=re.call(N,F);if(de(we))throw new TypeError;return we}return De(N)}function De(N,R){var F,re,we;{var ze=N.toString;if(bt(ze)){var re=ze.call(N);if(!de(re))return re}var F=N.valueOf;if(bt(F)){var re=F.call(N);if(!de(re))return re}}throw new TypeError}function $e(N){return!!N}function qe(N){return""+N}function et(N){var R=fe(N);return ye(R)?R:qe(R)}function Nt(N){return Array.isArray?Array.isArray(N):N instanceof Object?N instanceof Array:Object.prototype.toString.call(N)==="[object Array]"}function bt(N){return typeof N=="function"}function at(N){return typeof N=="function"}function Ut(N){switch(ee(N)){case 3:return!0;case 4:return!0;default:return!1}}function kr(N,R){return N===R||N!==N&&R!==R}function Ro(N,R){var F=N[R];if(F!=null){if(!bt(F))throw new TypeError;return F}}function nl(N){var R=Ro(N,o);if(!bt(R))throw new TypeError;var F=R.call(N);if(!de(F))throw new TypeError;return F}function Df(N){return N.value}function Of(N){var R=N.next();return R.done?!1:R}function dh(N){var R=N.return;R&&R.call(N)}function sl(N){var R=Object.getPrototypeOf(N);if(typeof N!="function"||N===d||R!==d)return R;var F=N.prototype,re=F&&Object.getPrototypeOf(F);if(re==null||re===Object.prototype)return R;var we=re.constructor;return typeof we!="function"||we===N?R:we}function li(){var N;!J(g)&&typeof t.Reflect<"u"&&!(g in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&(N=Bo(t.Reflect));var R,F,re,we=new f,ze={registerProvider:je,getProvider:be,setProvider:_e};return ze;function je(Ne){if(!Object.isExtensible(ze))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case N===Ne:break;case J(R):R=Ne;break;case R===Ne:break;case J(F):F=Ne;break;case F===Ne:break;default:re===void 0&&(re=new y),re.add(Ne);break}}function Ie(Ne,st){if(!J(R)){if(R.isProviderFor(Ne,st))return R;if(!J(F)){if(F.isProviderFor(Ne,st))return R;if(!J(re))for(var Ft=nl(re);;){var ar=Of(Ft);if(!ar)return;var qi=Df(ar);if(qi.isProviderFor(Ne,st))return dh(Ft),qi}}}if(!J(N)&&N.isProviderFor(Ne,st))return N}function be(Ne,st){var Ft=we.get(Ne),ar;return J(Ft)||(ar=Ft.get(st)),J(ar)&&(ar=Ie(Ne,st),J(ar)||(J(Ft)&&(Ft=new p,we.set(Ne,Ft)),Ft.set(st,ar))),ar}function Ae(Ne){if(J(Ne))throw new TypeError;return R===Ne||F===Ne||!J(re)&&re.has(Ne)}function _e(Ne,st,Ft){if(!Ae(Ft))throw new Error("Metadata provider not registered.");var ar=be(Ne,st);if(ar!==Ft){if(!J(ar))return!1;var qi=we.get(Ne);J(qi)&&(qi=new p,we.set(Ne,qi)),qi.set(st,Ft)}return!0}}function pg(){var N;return!J(g)&&de(t.Reflect)&&Object.isExtensible(t.Reflect)&&(N=t.Reflect[g]),J(N)&&(N=li()),!J(g)&&de(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,g,{enumerable:!1,configurable:!1,writable:!1,value:N}),N}function z7(N){var R=new f,F={isProviderFor:function(Ae,_e){var Ne=R.get(Ae);return J(Ne)?!1:Ne.has(_e)},OrdinaryDefineOwnMetadata:je,OrdinaryHasOwnMetadata:we,OrdinaryGetOwnMetadata:ze,OrdinaryOwnMetadataKeys:Ie,OrdinaryDeleteMetadata:be};return w.registerProvider(F),F;function re(Ae,_e,Ne){var st=R.get(Ae),Ft=!1;if(J(st)){if(!Ne)return;st=new p,R.set(Ae,st),Ft=!0}var ar=st.get(_e);if(J(ar)){if(!Ne)return;if(ar=new p,st.set(_e,ar),!N.setProvider(Ae,_e,F))throw st.delete(_e),Ft&&R.delete(Ae),new Error("Wrong provider for target.")}return ar}function we(Ae,_e,Ne){var st=re(_e,Ne,!1);return J(st)?!1:$e(st.has(Ae))}function ze(Ae,_e,Ne){var st=re(_e,Ne,!1);if(!J(st))return st.get(Ae)}function je(Ae,_e,Ne,st){var Ft=re(Ne,st,!0);Ft.set(Ae,_e)}function Ie(Ae,_e){var Ne=[],st=re(Ae,_e,!1);if(J(st))return Ne;for(var Ft=st.keys(),ar=nl(Ft),qi=0;;){var eD=Of(ar);if(!eD)return Ne.length=qi,Ne;var xre=Df(eD);try{Ne[qi]=xre}catch(Are){try{dh(ar)}finally{throw Are}}qi++}}function be(Ae,_e,Ne){var st=re(_e,Ne,!1);if(J(st)||!st.delete(Ae))return!1;if(st.size===0){var Ft=R.get(_e);J(Ft)||(Ft.delete(Ne),Ft.size===0&&R.delete(Ft))}return!0}}function Bo(N){var R=N.defineMetadata,F=N.hasOwnMetadata,re=N.getOwnMetadata,we=N.getOwnMetadataKeys,ze=N.deleteMetadata,je=new f,Ie={isProviderFor:function(be,Ae){var _e=je.get(be);return!J(_e)&&_e.has(Ae)?!0:we(be,Ae).length?(J(_e)&&(_e=new y,je.set(be,_e)),_e.add(Ae),!0):!1},OrdinaryDefineOwnMetadata:R,OrdinaryHasOwnMetadata:F,OrdinaryGetOwnMetadata:re,OrdinaryOwnMetadataKeys:we,OrdinaryDeleteMetadata:ze};return Ie}function fh(N,R,F){var re=w.getProvider(N,R);if(!J(re))return re;if(F){if(w.setProvider(N,R,m))return m;throw new Error("Illegal state.")}}function D(){var N={},R=[],F=function(){function Ie(be,Ae,_e){this._index=0,this._keys=be,this._values=Ae,this._selector=_e}return Ie.prototype["@@iterator"]=function(){return this},Ie.prototype[o]=function(){return this},Ie.prototype.next=function(){var be=this._index;if(be>=0&&be<this._keys.length){var Ae=this._selector(this._keys[be],this._values[be]);return be+1>=this._keys.length?(this._index=-1,this._keys=R,this._values=R):this._index++,{value:Ae,done:!1}}return{value:void 0,done:!0}},Ie.prototype.throw=function(be){throw this._index>=0&&(this._index=-1,this._keys=R,this._values=R),be},Ie.prototype.return=function(be){return this._index>=0&&(this._index=-1,this._keys=R,this._values=R),{value:be,done:!0}},Ie}(),re=function(){function Ie(){this._keys=[],this._values=[],this._cacheKey=N,this._cacheIndex=-2}return Object.defineProperty(Ie.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Ie.prototype.has=function(be){return this._find(be,!1)>=0},Ie.prototype.get=function(be){var Ae=this._find(be,!1);return Ae>=0?this._values[Ae]:void 0},Ie.prototype.set=function(be,Ae){var _e=this._find(be,!0);return this._values[_e]=Ae,this},Ie.prototype.delete=function(be){var Ae=this._find(be,!1);if(Ae>=0){for(var _e=this._keys.length,Ne=Ae+1;Ne<_e;Ne++)this._keys[Ne-1]=this._keys[Ne],this._values[Ne-1]=this._values[Ne];return this._keys.length--,this._values.length--,kr(be,this._cacheKey)&&(this._cacheKey=N,this._cacheIndex=-2),!0}return!1},Ie.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=N,this._cacheIndex=-2},Ie.prototype.keys=function(){return new F(this._keys,this._values,we)},Ie.prototype.values=function(){return new F(this._keys,this._values,ze)},Ie.prototype.entries=function(){return new F(this._keys,this._values,je)},Ie.prototype["@@iterator"]=function(){return this.entries()},Ie.prototype[o]=function(){return this.entries()},Ie.prototype._find=function(be,Ae){if(!kr(this._cacheKey,be)){this._cacheIndex=-1;for(var _e=0;_e<this._keys.length;_e++)if(kr(this._keys[_e],be)){this._cacheIndex=_e;break}}return this._cacheIndex<0&&Ae&&(this._cacheIndex=this._keys.length,this._keys.push(be),this._values.push(void 0)),this._cacheIndex},Ie}();return re;function we(Ie,be){return Ie}function ze(Ie,be){return be}function je(Ie,be){return[Ie,be]}}function A(){var N=function(){function R(){this._map=new p}return Object.defineProperty(R.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),R.prototype.has=function(F){return this._map.has(F)},R.prototype.add=function(F){return this._map.set(F,F),this},R.prototype.delete=function(F){return this._map.delete(F)},R.prototype.clear=function(){this._map.clear()},R.prototype.keys=function(){return this._map.keys()},R.prototype.values=function(){return this._map.keys()},R.prototype.entries=function(){return this._map.entries()},R.prototype["@@iterator"]=function(){return this.keys()},R.prototype[o]=function(){return this.keys()},R}();return N}function k(){var N=16,R=u.create(),F=re();return function(){function be(){this._key=re()}return be.prototype.has=function(Ae){var _e=we(Ae,!1);return _e!==void 0?u.has(_e,this._key):!1},be.prototype.get=function(Ae){var _e=we(Ae,!1);return _e!==void 0?u.get(_e,this._key):void 0},be.prototype.set=function(Ae,_e){var Ne=we(Ae,!0);return Ne[this._key]=_e,this},be.prototype.delete=function(Ae){var _e=we(Ae,!1);return _e!==void 0?delete _e[this._key]:!1},be.prototype.clear=function(){this._key=re()},be}();function re(){var be;do be="@@WeakMap@@"+Ie();while(u.has(R,be));return R[be]=!0,be}function we(be,Ae){if(!n.call(be,F)){if(!Ae)return;Object.defineProperty(be,F,{value:u.create()})}return be[F]}function ze(be,Ae){for(var _e=0;_e<Ae;++_e)be[_e]=Math.random()*255|0;return be}function je(be){if(typeof Uint8Array=="function"){var Ae=new Uint8Array(be);return typeof crypto<"u"?crypto.getRandomValues(Ae):typeof msCrypto<"u"?msCrypto.getRandomValues(Ae):ze(Ae,be),Ae}return ze(new Array(be),be)}function Ie(){var be=je(N);be[6]=be[6]&79|64,be[8]=be[8]&191|128;for(var Ae="",_e=0;_e<N;++_e){var Ne=be[_e];(_e===4||_e===6||_e===8)&&(Ae+="-"),Ne<16&&(Ae+="0"),Ae+=Ne.toString(16).toLowerCase()}return Ae}}function B(N){return N.__=void 0,delete N.__,N}})})(rL||(rL={}));var ne;(function(r){r[r.Sequence=0]="Sequence",r[r.Set=1]="Set",r[r.Choice=2]="Choice"})(ne||(ne={}));var j;(function(r){r[r.Any=1]="Any",r[r.Boolean=2]="Boolean",r[r.OctetString=3]="OctetString",r[r.BitString=4]="BitString",r[r.Integer=5]="Integer",r[r.Enumerated=6]="Enumerated",r[r.ObjectIdentifier=7]="ObjectIdentifier",r[r.Utf8String=8]="Utf8String",r[r.BmpString=9]="BmpString",r[r.UniversalString=10]="UniversalString",r[r.NumericString=11]="NumericString",r[r.PrintableString=12]="PrintableString",r[r.TeletexString=13]="TeletexString",r[r.VideotexString=14]="VideotexString",r[r.IA5String=15]="IA5String",r[r.GraphicString=16]="GraphicString",r[r.VisibleString=17]="VisibleString",r[r.GeneralString=18]="GeneralString",r[r.CharacterString=19]="CharacterString",r[r.UTCTime=20]="UTCTime",r[r.GeneralizedTime=21]="GeneralizedTime",r[r.DATE=22]="DATE",r[r.TimeOfDay=23]="TimeOfDay",r[r.DateTime=24]="DateTime",r[r.Duration=25]="Duration",r[r.TIME=26]="TIME",r[r.Null=27]="Null"})(j||(j={}));class qv{constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if(typeof e=="number")this.fromNumber(e);else if(me.isBufferSource(e))this.unusedBits=t,this.value=me.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof Dd))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new Dd({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new Dd({name:e})}toNumber(){let e="";const t=new Uint8Array(this.value);for(const n of t)e+=n.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2);const n=t.length+7>>3;this.unusedBits=(n<<3)-t.length;const s=new Uint8Array(n);t=t.padStart(n<<3,"0").split("").reverse().join("");let i=0;for(;i<n;)s[i]=parseInt(t.slice(i<<3,(i<<3)+8),2),i++;this.value=s.buffer}}class ut{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){typeof e=="number"?this.buffer=new ArrayBuffer(e):me.isBufferSource(e)?this.buffer=me.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof yo))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new yo({valueHex:this.buffer})}toSchema(e){return new yo({name:e})}}const $ke={fromASN:r=>r instanceof Rc?null:r.valueBeforeDecodeView,toASN:r=>{if(r===null)return new Rc;const e=Ec(r);if(e.result.error)throw new Error(e.result.error);return e.result}},Lke={fromASN:r=>r.valueBlock.valueHexView.byteLength>=4?r.valueBlock.toString():r.valueBlock.valueDec,toASN:r=>new xc({value:+r})},Uke={fromASN:r=>r.valueBlock.valueDec,toASN:r=>new Ov({value:r})},Kt={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new xc({valueHex:r})},Fke={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Dd({valueHex:r})},zke={fromASN:r=>r.valueBlock.toString(),toASN:r=>new dc({value:r})},Vke={fromASN:r=>r.valueBlock.value,toASN:r=>new Dv({value:r})},qb={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new yo({valueHex:r})},Hke={fromASN:r=>new ut(r.getValue()),toASN:r=>r.toASN()};function Ki(r){return{fromASN:e=>e.valueBlock.value,toASN:e=>new r({value:e})}}const tZ=Ki(Zc),Kke=Ki(Rv),Gke=Ki(Bv),jke=Ki(Mv),qke=Ki($v),Wke=Ki(Lv),Qke=Ki(Uv),Jke=Ki(Fv),Yke=Ki(zv),Xke=Ki(qm),Zke=Ki(Vv),eTe=Ki(Hv),tTe={fromASN:r=>r.toDate(),toASN:r=>new Wm({valueDate:r})},rTe={fromASN:r=>r.toDate(),toASN:r=>new Kv({valueDate:r})},nTe={fromASN:()=>null,toASN:()=>new Rc};function HP(r){switch(r){case j.Any:return $ke;case j.BitString:return Fke;case j.BmpString:return Kke;case j.Boolean:return Vke;case j.CharacterString:return eTe;case j.Enumerated:return Uke;case j.GeneralString:return Zke;case j.GeneralizedTime:return rTe;case j.GraphicString:return Yke;case j.IA5String:return Jke;case j.Integer:return Lke;case j.Null:return nTe;case j.NumericString:return jke;case j.ObjectIdentifier:return zke;case j.OctetString:return qb;case j.PrintableString:return qke;case j.TeletexString:return Wke;case j.UTCTime:return tTe;case j.UniversalString:return Gke;case j.Utf8String:return tZ;case j.VideotexString:return Qke;case j.VisibleString:return Xke;default:return null}}function yc(r){return typeof r=="function"&&r.prototype?r.prototype.toASN&&r.prototype.fromASN?!0:yc(r.prototype):!!(r&&typeof r=="object"&&"toASN"in r&&"fromASN"in r)}function rZ(r){var e;if(r){const t=Object.getPrototypeOf(r);return((e=t==null?void 0:t.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:rZ(t)}return!1}function sTe(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let s=0;s<r.byteLength;s++)if(t[s]!==n[s])return!1;return!0}class iTe{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){const n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!n.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return n}cache(e){const t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){const t={type:ne.Sequence,items:{}},n=this.findParentSchema(e);return n&&(Object.assign(t,n),t.items=Object.assign({},t.items,n.items)),t}create(e,t){const n=this.items.get(e)||this.createDefault(e),s=[];for(const i in n.items){const o=n.items[i],a=t?i:"";let c;if(typeof o.type=="number"){const u=j[o.type],d=KX[u];if(!d)throw new Error(`Cannot get ASN1 class by name '${u}'`);c=new d({name:a})}else yc(o.type)?c=new o.type().toSchema(a):o.optional?this.get(o.type).type===ne.Choice?c=new ef({name:a}):(c=this.create(o.type,!1),c.name=a):c=new ef({name:a});const l=!!o.optional||o.defaultValue!==void 0;if(o.repeated){c.name="";const u=o.repeated==="set"?Ac:Dr;c=new u({name:"",value:[new Gb({name:a,value:c})]})}if(o.context!==null&&o.context!==void 0)if(o.implicit)if(typeof o.type=="number"||yc(o.type)){const u=o.repeated?xs:jm;s.push(new u({name:a,optional:l,idBlock:{tagClass:3,tagNumber:o.context}}))}else{this.cache(o.type);const u=!!o.repeated;let d=u?c:this.get(o.type,!0).schema;d="valueBlock"in d?d.valueBlock.value:d.value,s.push(new xs({name:u?"":a,optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:d}))}else s.push(new xs({optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:[c]}));else c.optional=l,s.push(c)}switch(n.type){case ne.Sequence:return new Dr({value:s,name:""});case ne.Set:return new Ac({value:s,name:""});case ne.Choice:return new $P({value:s,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){const t=Object.getPrototypeOf(e);return t?this.items.get(t)||this.findParentSchema(t):null}}const Oi=new iTe,ae=r=>e=>{let t;Oi.has(e)?t=Oi.get(e):(t=Oi.createDefault(e),Oi.set(e,t)),Object.assign(t,r)},O=r=>(e,t)=>{let n;Oi.has(e.constructor)?n=Oi.get(e.constructor):(n=Oi.createDefault(e.constructor),Oi.set(e.constructor,n));const s=Object.assign({},r);if(typeof s.type=="number"&&!s.converter){const i=HP(r.type);if(!i)throw new Error(`Cannot get default converter for property '${t}' of ${e.constructor.name}`);s.converter=i}n.items[t]=s};class nL extends Error{constructor(){super(...arguments),this.schemas=[]}}class oTe{static parse(e,t){const n=Ec(e);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,t)}static fromASN(e,t){var n;try{if(yc(t))return new t().fromASN(e);const s=Oi.get(t);Oi.cache(t);let i=s.schema;if(e.constructor===xs&&s.type!==ne.Choice){i=new xs({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:s.schema.valueBlock.value});for(const c in s.items)delete e[c]}const o=jh({},e,i);if(!o.verified)throw new nL(`Data does not match to ${t.name} ASN1 schema. ${o.result.error}`);const a=new t;if(rZ(t)){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const c=s.itemType;if(typeof c=="number"){const l=HP(c);if(!l)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);return t.from(e.valueBlock.value,u=>l.fromASN(u))}else return t.from(e.valueBlock.value,l=>this.fromASN(l,c))}for(const c in s.items){const l=o.result[c];if(!l)continue;const u=s.items[c],d=u.type;if(typeof d=="number"||yc(d)){const p=(n=u.converter)!==null&&n!==void 0?n:yc(d)?new d:null;if(!p)throw new Error("Converter is empty");if(u.repeated)if(u.implicit){const y=u.repeated==="sequence"?Dr:Ac,f=new y;f.valueBlock=l.valueBlock;const g=Ec(f.toBER(!1));if(g.offset===-1)throw new Error(`Cannot parse the child item. ${g.result.error}`);if(!("value"in g.result.valueBlock&&Array.isArray(g.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const w=g.result.valueBlock.value;a[c]=Array.from(w,m=>p.fromASN(m))}else a[c]=Array.from(l,y=>p.fromASN(y));else{let y=l;if(u.implicit){let f;if(yc(d))f=new d().toSchema("");else{const g=j[d],w=KX[g];if(!w)throw new Error(`Cannot get '${g}' class from asn1js module`);f=new w}f.valueBlock=y.valueBlock,y=Ec(f.toBER(!1)).result}a[c]=p.fromASN(y)}}else if(u.repeated){if(!Array.isArray(l))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");a[c]=Array.from(l,p=>this.fromASN(p,d))}else a[c]=this.fromASN(l,d)}return a}catch(s){throw s instanceof nL&&s.schemas.push(t.name),s}}}class KP{static serialize(e){return e instanceof Zr?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&typeof e=="object"&&yc(e))return e.toASN();if(!(e&&typeof e=="object"))throw new TypeError("Parameter 1 should be type of Object.");const t=e.constructor,n=Oi.get(t);Oi.cache(t);let s=[];if(n.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if(typeof n.itemType=="number"){const o=HP(n.itemType);if(!o)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);s=e.map(a=>o.toASN(a))}else s=e.map(o=>this.toAsnItem({type:n.itemType},"[]",t,o))}else for(const o in n.items){const a=n.items[o],c=e[o];if(c===void 0||a.defaultValue===c||typeof a.defaultValue=="object"&&typeof c=="object"&&sTe(this.serialize(a.defaultValue),this.serialize(c)))continue;const l=KP.toAsnItem(a,o,t,c);if(typeof a.context=="number")if(a.implicit)if(!a.repeated&&(typeof a.type=="number"||yc(a.type))){const u={};u.valueHex=l instanceof Rc?l.valueBeforeDecodeView:l.valueBlock.toBER(),s.push(new jm({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},...u}))}else s.push(new xs({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:l.valueBlock.value}));else s.push(new xs({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:[l]}));else a.repeated?s=s.concat(l):s.push(l)}let i;switch(n.type){case ne.Sequence:i=new Dr({value:s});break;case ne.Set:i=new Ac({value:s});break;case ne.Choice:if(!s[0])throw new Error(`Schema '${t.name}' has wrong data. Choice cannot be empty.`);i=s[0];break}return i}static toAsnItem(e,t,n,s){let i;if(typeof e.type=="number"){const o=e.converter;if(!o)throw new Error(`Property '${t}' doesn't have converter for type ${j[e.type]} in schema '${n.name}'`);if(e.repeated){if(!Array.isArray(s))throw new TypeError("Parameter 'objProp' should be type of Array.");const a=Array.from(s,l=>o.toASN(l)),c=e.repeated==="sequence"?Dr:Ac;i=new c({value:a})}else i=o.toASN(s)}else if(e.repeated){if(!Array.isArray(s))throw new TypeError("Parameter 'objProp' should be type of Array.");const o=Array.from(s,c=>this.toASN(c)),a=e.repeated==="sequence"?Dr:Ac;i=new a({value:o})}else i=this.toASN(s);return i}}class xt extends Array{constructor(e=[]){if(typeof e=="number")super(e);else{super();for(const t of e)this.push(t)}}}class pe{static serialize(e){return KP.serialize(e)}static parse(e,t){return oTe.parse(e,t)}static toString(e){const t=me.isBufferSource(e)?me.toArrayBuffer(e):pe.serialize(e),n=Ec(t);if(n.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${n.result.error}`);return n.result.toString()}}function _(r,e,t,n){var s=arguments.length,i=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(i=(s<3?o(i):s>3?o(e,t,i):o(e,t))||i);return s>3&&i&&Object.defineProperty(e,t,i),i}class sL{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){const t=e.split(".");if(t.length!==4)throw new Error("Invalid IPv4 address");return t.map(n=>{const s=parseInt(n,10);if(isNaN(s)||s<0||s>255)throw new Error("Invalid IPv4 address part");return s})}static parseIPv6(e){const n=this.expandIPv6(e).split(":");if(n.length!==8)throw new Error("Invalid IPv6 address");return n.reduce((s,i)=>{const o=parseInt(i,16);if(isNaN(o)||o<0||o>65535)throw new Error("Invalid IPv6 address part");return s.push(o>>8&255),s.push(o&255),s},[])}static expandIPv6(e){if(!e.includes("::"))return e;const t=e.split("::");if(t.length>2)throw new Error("Invalid IPv6 address");const n=t[0]?t[0].split(":"):[],s=t[1]?t[1].split(":"):[],i=8-(n.length+s.length);if(i<0)throw new Error("Invalid IPv6 address");return[...n,...Array(i).fill("0"),...s].join(":")}static formatIPv6(e){const t=[];for(let n=0;n<16;n+=2)t.push((e[n]<<8|e[n+1]).toString(16));return this.compressIPv6(t.join(":"))}static compressIPv6(e){const t=e.split(":");let n=-1,s=0,i=-1,o=0;for(let a=0;a<t.length;a++)t[a]==="0"?(i===-1&&(i=a),o++):(o>s&&(n=i,s=o),i=-1,o=0);if(o>s&&(n=i,s=o),s>1){const a=t.slice(0,n).join(":"),c=t.slice(n+s).join(":");return`${a}::${c}`}return e}static parseCIDR(e){const[t,n]=e.split("/"),s=parseInt(n,10);if(this.isIPv4(t)){if(s<0||s>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(t),s]}else{if(s<0||s>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(t),s]}}static decodeIP(e){if(e.length===64&&parseInt(e,16)===0)return"::/0";if(e.length!==16)return e;const t=parseInt(e.slice(8),16).toString(2).split("").reduce((s,i)=>s+ +i,0);let n=e.slice(0,8).replace(/(.{2})/g,s=>`${parseInt(s,16)}.`);return n=n.slice(0,-1),`${n}/${t}`}static toString(e){const t=new Uint8Array(e);if(t.length===4)return Array.from(t).join(".");if(t.length===16)return this.formatIPv6(t);if(t.length===8||t.length===32){const n=t.length/2,s=t.slice(0,n),i=t.slice(n);if(t.every(c=>c===0))return t.length===8?"0.0.0.0/0":"::/0";const a=i.reduce((c,l)=>c+(l.toString(2).match(/1/g)||[]).length,0);return t.length===8?`${Array.from(s).join(".")}/${a}`:`${this.formatIPv6(s)}/${a}`}return this.decodeIP(Te.ToHex(e))}static fromString(e){if(e.includes("/")){const[n,s]=this.parseCIDR(e),i=new Uint8Array(n.length);let o=s;for(let c=0;c<i.length;c++)o>=8?(i[c]=255,o-=8):o>0&&(i[c]=255<<8-o,o=0);const a=new Uint8Array(n.length*2);return a.set(n,0),a.set(i,n.length),a.buffer}const t=this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e);return new Uint8Array(t).buffer}}var vC,EC,xC;let en=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};_([O({type:j.TeletexString})],en.prototype,"teletexString",void 0);_([O({type:j.PrintableString})],en.prototype,"printableString",void 0);_([O({type:j.UniversalString})],en.prototype,"universalString",void 0);_([O({type:j.Utf8String})],en.prototype,"utf8String",void 0);_([O({type:j.BmpString})],en.prototype,"bmpString",void 0);en=_([ae({type:ne.Choice})],en);let E1=class extends en{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?Te.ToHex(this.anyValue):super.toString())}};_([O({type:j.IA5String})],E1.prototype,"ia5String",void 0);_([O({type:j.Any})],E1.prototype,"anyValue",void 0);E1=_([ae({type:ne.Choice})],E1);class Wv{constructor(e={}){this.type="",this.value=new E1,Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],Wv.prototype,"type",void 0);_([O({type:E1})],Wv.prototype,"value",void 0);let x1=vC=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,vC.prototype)}};x1=vC=_([ae({type:ne.Set,itemType:Wv})],x1);let AC=EC=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,EC.prototype)}};AC=EC=_([ae({type:ne.Sequence,itemType:x1})],AC);let fr=xC=class extends AC{constructor(e){super(e),Object.setPrototypeOf(this,xC.prototype)}};fr=xC=_([ae({type:ne.Sequence})],fr);const aTe={fromASN:r=>sL.toString(qb.fromASN(r)),toASN:r=>qb.toASN(sL.fromString(r))};class By{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],By.prototype,"typeId",void 0);_([O({type:j.Any,context:0})],By.prototype,"value",void 0);class GP{constructor(e={}){this.partyName=new en,Object.assign(this,e)}}_([O({type:en,optional:!0,context:0,implicit:!0})],GP.prototype,"nameAssigner",void 0);_([O({type:en,context:1,implicit:!0})],GP.prototype,"partyName",void 0);let Ke=class{constructor(e={}){Object.assign(this,e)}};_([O({type:By,context:0,implicit:!0})],Ke.prototype,"otherName",void 0);_([O({type:j.IA5String,context:1,implicit:!0})],Ke.prototype,"rfc822Name",void 0);_([O({type:j.IA5String,context:2,implicit:!0})],Ke.prototype,"dNSName",void 0);_([O({type:j.Any,context:3,implicit:!0})],Ke.prototype,"x400Address",void 0);_([O({type:fr,context:4,implicit:!1})],Ke.prototype,"directoryName",void 0);_([O({type:GP,context:5})],Ke.prototype,"ediPartyName",void 0);_([O({type:j.IA5String,context:6,implicit:!0})],Ke.prototype,"uniformResourceIdentifier",void 0);_([O({type:j.OctetString,context:7,implicit:!0,converter:aTe})],Ke.prototype,"iPAddress",void 0);_([O({type:j.ObjectIdentifier,context:8,implicit:!0})],Ke.prototype,"registeredID",void 0);Ke=_([ae({type:ne.Choice})],Ke);const jP="1.3.6.1.5.5.7",cTe=`${jP}.1`,ng=`${jP}.3`,Qv=`${jP}.48`,iL=`${Qv}.1`,oL=`${Qv}.2`,aL=`${Qv}.3`,cL=`${Qv}.5`,ch="2.5.29";var SC;const CC=`${cTe}.1`;class Jm{constructor(e={}){this.accessMethod="",this.accessLocation=new Ke,Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],Jm.prototype,"accessMethod",void 0);_([O({type:Ke})],Jm.prototype,"accessLocation",void 0);let wp=SC=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,SC.prototype)}};wp=SC=_([ae({type:ne.Sequence,itemType:Jm})],wp);const IC=`${ch}.35`;class qP extends ut{}class qh{constructor(e={}){e&&Object.assign(this,e)}}_([O({type:qP,context:0,optional:!0,implicit:!0})],qh.prototype,"keyIdentifier",void 0);_([O({type:Ke,context:1,optional:!0,implicit:!0,repeated:"sequence"})],qh.prototype,"authorityCertIssuer",void 0);_([O({type:j.Integer,context:2,optional:!0,implicit:!0,converter:Kt})],qh.prototype,"authorityCertSerialNumber",void 0);const nZ=`${ch}.19`;class Wb{constructor(e={}){this.cA=!1,Object.assign(this,e)}}_([O({type:j.Boolean,defaultValue:!1})],Wb.prototype,"cA",void 0);_([O({type:j.Integer,optional:!0})],Wb.prototype,"pathLenConstraint",void 0);var kC;let Qn=kC=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,kC.prototype)}};Qn=kC=_([ae({type:ne.Sequence,itemType:Ke})],Qn);var TC;let lL=TC=class extends Qn{constructor(e){super(e),Object.setPrototypeOf(this,TC.prototype)}};lL=TC=_([ae({type:ne.Sequence})],lL);var _C;const sZ=`${ch}.32`;let Bc=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};_([O({type:j.IA5String})],Bc.prototype,"ia5String",void 0);_([O({type:j.VisibleString})],Bc.prototype,"visibleString",void 0);_([O({type:j.BmpString})],Bc.prototype,"bmpString",void 0);_([O({type:j.Utf8String})],Bc.prototype,"utf8String",void 0);Bc=_([ae({type:ne.Choice})],Bc);class WP{constructor(e={}){this.organization=new Bc,this.noticeNumbers=[],Object.assign(this,e)}}_([O({type:Bc})],WP.prototype,"organization",void 0);_([O({type:j.Integer,repeated:"sequence"})],WP.prototype,"noticeNumbers",void 0);class QP{constructor(e={}){Object.assign(this,e)}}_([O({type:WP,optional:!0})],QP.prototype,"noticeRef",void 0);_([O({type:Bc,optional:!0})],QP.prototype,"explicitText",void 0);let Qb=class{constructor(e={}){Object.assign(this,e)}};_([O({type:j.IA5String})],Qb.prototype,"cPSuri",void 0);_([O({type:QP})],Qb.prototype,"userNotice",void 0);Qb=_([ae({type:ne.Choice})],Qb);class JP{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],JP.prototype,"policyQualifierId",void 0);_([O({type:j.Any})],JP.prototype,"qualifier",void 0);class Jv{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],Jv.prototype,"policyIdentifier",void 0);_([O({type:JP,repeated:"sequence",optional:!0})],Jv.prototype,"policyQualifiers",void 0);let Jb=_C=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,_C.prototype)}};Jb=_C=_([ae({type:ne.Sequence,itemType:Jv})],Jb);let Yb=class{constructor(e=0){this.value=e}};_([O({type:j.Integer})],Yb.prototype,"value",void 0);Yb=_([ae({type:ne.Choice})],Yb);let uL=class extends Yb{};uL=_([ae({type:ne.Choice})],uL);var PC;const NC=`${ch}.31`;var eo;(function(r){r[r.unused=1]="unused",r[r.keyCompromise=2]="keyCompromise",r[r.cACompromise=4]="cACompromise",r[r.affiliationChanged=8]="affiliationChanged",r[r.superseded=16]="superseded",r[r.cessationOfOperation=32]="cessationOfOperation",r[r.certificateHold=64]="certificateHold",r[r.privilegeWithdrawn=128]="privilegeWithdrawn",r[r.aACompromise=256]="aACompromise"})(eo||(eo={}));class iZ extends qv{toJSON(){const e=[],t=this.toNumber();return t&eo.aACompromise&&e.push("aACompromise"),t&eo.affiliationChanged&&e.push("affiliationChanged"),t&eo.cACompromise&&e.push("cACompromise"),t&eo.certificateHold&&e.push("certificateHold"),t&eo.cessationOfOperation&&e.push("cessationOfOperation"),t&eo.keyCompromise&&e.push("keyCompromise"),t&eo.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&eo.superseded&&e.push("superseded"),t&eo.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}}let tf=class{constructor(e={}){Object.assign(this,e)}};_([O({type:Ke,context:0,repeated:"sequence",implicit:!0})],tf.prototype,"fullName",void 0);_([O({type:x1,context:1,implicit:!0})],tf.prototype,"nameRelativeToCRLIssuer",void 0);tf=_([ae({type:ne.Choice})],tf);class sg{constructor(e={}){Object.assign(this,e)}}_([O({type:tf,context:0,optional:!0})],sg.prototype,"distributionPoint",void 0);_([O({type:iZ,context:1,optional:!0,implicit:!0})],sg.prototype,"reasons",void 0);_([O({type:Ke,context:2,optional:!0,repeated:"sequence",implicit:!0})],sg.prototype,"cRLIssuer",void 0);let Vp=PC=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,PC.prototype)}};Vp=PC=_([ae({type:ne.Sequence,itemType:sg})],Vp);var DC;let hL=DC=class extends Vp{constructor(e){super(e),Object.setPrototypeOf(this,DC.prototype)}};hL=DC=_([ae({type:ne.Sequence,itemType:sg})],hL);class Nn{constructor(e={}){this.onlyContainsUserCerts=Nn.ONLY,this.onlyContainsCACerts=Nn.ONLY,this.indirectCRL=Nn.ONLY,this.onlyContainsAttributeCerts=Nn.ONLY,Object.assign(this,e)}}Nn.ONLY=!1;_([O({type:tf,context:0,optional:!0})],Nn.prototype,"distributionPoint",void 0);_([O({type:j.Boolean,context:1,defaultValue:Nn.ONLY,implicit:!0})],Nn.prototype,"onlyContainsUserCerts",void 0);_([O({type:j.Boolean,context:2,defaultValue:Nn.ONLY,implicit:!0})],Nn.prototype,"onlyContainsCACerts",void 0);_([O({type:iZ,context:3,optional:!0,implicit:!0})],Nn.prototype,"onlySomeReasons",void 0);_([O({type:j.Boolean,context:4,defaultValue:Nn.ONLY,implicit:!0})],Nn.prototype,"indirectCRL",void 0);_([O({type:j.Boolean,context:5,defaultValue:Nn.ONLY,implicit:!0})],Nn.prototype,"onlyContainsAttributeCerts",void 0);var L2;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(L2||(L2={}));let OC=class{constructor(e=L2.unspecified){this.reason=L2.unspecified,this.reason=e}toJSON(){return L2[this.reason]}toString(){return this.toJSON()}};_([O({type:j.Enumerated})],OC.prototype,"reason",void 0);OC=_([ae({type:ne.Choice})],OC);var RC;const oZ=`${ch}.37`;let Xb=RC=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,RC.prototype)}};Xb=RC=_([ae({type:ne.Sequence,itemType:j.ObjectIdentifier})],Xb);const lTe=`${ng}.1`,uTe=`${ng}.2`,hTe=`${ng}.3`,dTe=`${ng}.4`,fTe=`${ng}.8`,pTe=`${ng}.9`;let BC=class{constructor(e=new ArrayBuffer(0)){this.value=e}};_([O({type:j.Integer,converter:Kt})],BC.prototype,"value",void 0);BC=_([ae({type:ne.Choice})],BC);let MC=class{constructor(e){this.value=new Date,e&&(this.value=e)}};_([O({type:j.GeneralizedTime})],MC.prototype,"value",void 0);MC=_([ae({type:ne.Choice})],MC);var $C;let dL=$C=class extends Qn{constructor(e){super(e),Object.setPrototypeOf(this,$C.prototype)}};dL=$C=_([ae({type:ne.Sequence})],dL);const aZ=`${ch}.15`;var to;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(to||(to={}));class kE extends qv{toJSON(){const e=this.toNumber(),t=[];return e&to.cRLSign&&t.push("crlSign"),e&to.dataEncipherment&&t.push("dataEncipherment"),e&to.decipherOnly&&t.push("decipherOnly"),e&to.digitalSignature&&t.push("digitalSignature"),e&to.encipherOnly&&t.push("encipherOnly"),e&to.keyAgreement&&t.push("keyAgreement"),e&to.keyCertSign&&t.push("keyCertSign"),e&to.keyEncipherment&&t.push("keyEncipherment"),e&to.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}}var LC;class Yv{constructor(e={}){this.base=new Ke,this.minimum=0,Object.assign(this,e)}}_([O({type:Ke})],Yv.prototype,"base",void 0);_([O({type:j.Integer,context:0,defaultValue:0,implicit:!0})],Yv.prototype,"minimum",void 0);_([O({type:j.Integer,context:1,optional:!0,implicit:!0})],Yv.prototype,"maximum",void 0);let Zb=LC=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,LC.prototype)}};Zb=LC=_([ae({type:ne.Sequence,itemType:Yv})],Zb);class cZ{constructor(e={}){Object.assign(this,e)}}_([O({type:Zb,context:0,optional:!0,implicit:!0})],cZ.prototype,"permittedSubtrees",void 0);_([O({type:Zb,context:1,optional:!0,implicit:!0})],cZ.prototype,"excludedSubtrees",void 0);class lZ{constructor(e={}){Object.assign(this,e)}}_([O({type:j.Integer,context:0,implicit:!0,optional:!0,converter:Kt})],lZ.prototype,"requireExplicitPolicy",void 0);_([O({type:j.Integer,context:1,implicit:!0,optional:!0,converter:Kt})],lZ.prototype,"inhibitPolicyMapping",void 0);var UC;class YP{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],YP.prototype,"issuerDomainPolicy",void 0);_([O({type:j.ObjectIdentifier})],YP.prototype,"subjectDomainPolicy",void 0);let fL=UC=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,UC.prototype)}};fL=UC=_([ae({type:ne.Sequence,itemType:YP})],fL);var FC;const uZ=`${ch}.17`;let zC=FC=class extends Qn{constructor(e){super(e),Object.setPrototypeOf(this,FC.prototype)}};zC=FC=_([ae({type:ne.Sequence})],zC);let Mc=class{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}};_([O({type:j.ObjectIdentifier})],Mc.prototype,"type",void 0);_([O({type:j.Any,repeated:"set"})],Mc.prototype,"values",void 0);var VC;let pL=VC=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,VC.prototype)}};pL=VC=_([ae({type:ne.Sequence,itemType:Mc})],pL);const hZ=`${ch}.14`;class Nu extends qP{}class dZ{constructor(e={}){Object.assign(this,e)}}_([O({type:j.GeneralizedTime,context:0,implicit:!0,optional:!0})],dZ.prototype,"notBefore",void 0);_([O({type:j.GeneralizedTime,context:1,implicit:!0,optional:!0})],dZ.prototype,"notAfter",void 0);var U2;(function(r){r[r.keyUpdateAllowed=1]="keyUpdateAllowed",r[r.newExtensions=2]="newExtensions",r[r.pKIXCertificate=4]="pKIXCertificate"})(U2||(U2={}));class fZ extends qv{toJSON(){const e=[],t=this.toNumber();return t&U2.pKIXCertificate&&e.push("pKIXCertificate"),t&U2.newExtensions&&e.push("newExtensions"),t&U2.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}}class pZ{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new fZ,Object.assign(this,e)}}_([O({type:j.GeneralString})],pZ.prototype,"entrustVers",void 0);_([O({type:fZ})],pZ.prototype,"entrustInfoFlags",void 0);var HC;let gL=HC=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,HC.prototype)}};gL=HC=_([ae({type:ne.Sequence,itemType:Jm})],gL);class Ee{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof Ee&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&WY(e.parameters,this.parameters)||e.parameters===this.parameters)}}_([O({type:j.ObjectIdentifier})],Ee.prototype,"algorithm",void 0);_([O({type:j.Any,optional:!0})],Ee.prototype,"parameters",void 0);class wo{constructor(e={}){this.algorithm=new Ee,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:Ee})],wo.prototype,"algorithm",void 0);_([O({type:j.BitString})],wo.prototype,"subjectPublicKey",void 0);let Wr=class{constructor(e){if(e)if(typeof e=="string"||typeof e=="number"||e instanceof Date){const t=new Date(e);t.getUTCFullYear()>2049?this.generalTime=t:this.utcTime=t}else Object.assign(this,e)}getTime(){const e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};_([O({type:j.UTCTime})],Wr.prototype,"utcTime",void 0);_([O({type:j.GeneralizedTime})],Wr.prototype,"generalTime",void 0);Wr=_([ae({type:ne.Choice})],Wr);class Ym{constructor(e){this.notBefore=new Wr(new Date),this.notAfter=new Wr(new Date),e&&(this.notBefore=new Wr(e.notBefore),this.notAfter=new Wr(e.notAfter))}}_([O({type:Wr})],Ym.prototype,"notBefore",void 0);_([O({type:Wr})],Ym.prototype,"notAfter",void 0);var KC;let zi=class gZ{constructor(e={}){this.extnID="",this.critical=gZ.CRITICAL,this.extnValue=new ut,Object.assign(this,e)}};zi.CRITICAL=!1;_([O({type:j.ObjectIdentifier})],zi.prototype,"extnID",void 0);_([O({type:j.Boolean,defaultValue:zi.CRITICAL})],zi.prototype,"critical",void 0);_([O({type:ut})],zi.prototype,"extnValue",void 0);let qu=KC=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,KC.prototype)}};qu=KC=_([ae({type:ne.Sequence,itemType:zi})],qu);var rf;(function(r){r[r.v1=0]="v1",r[r.v2=1]="v2",r[r.v3=2]="v3"})(rf||(rf={}));class ci{constructor(e={}){this.version=rf.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new Ee,this.issuer=new fr,this.validity=new Ym,this.subject=new fr,this.subjectPublicKeyInfo=new wo,Object.assign(this,e)}}_([O({type:j.Integer,context:0,defaultValue:rf.v1})],ci.prototype,"version",void 0);_([O({type:j.Integer,converter:Kt})],ci.prototype,"serialNumber",void 0);_([O({type:Ee})],ci.prototype,"signature",void 0);_([O({type:fr})],ci.prototype,"issuer",void 0);_([O({type:Ym})],ci.prototype,"validity",void 0);_([O({type:fr})],ci.prototype,"subject",void 0);_([O({type:wo})],ci.prototype,"subjectPublicKeyInfo",void 0);_([O({type:j.BitString,context:1,implicit:!0,optional:!0})],ci.prototype,"issuerUniqueID",void 0);_([O({type:j.BitString,context:2,implicit:!0,optional:!0})],ci.prototype,"subjectUniqueID",void 0);_([O({type:qu,context:3,optional:!0})],ci.prototype,"extensions",void 0);class nf{constructor(e={}){this.tbsCertificate=new ci,this.signatureAlgorithm=new Ee,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:ci})],nf.prototype,"tbsCertificate",void 0);_([O({type:Ee})],nf.prototype,"signatureAlgorithm",void 0);_([O({type:j.BitString})],nf.prototype,"signatureValue",void 0);class Xv{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new Wr,Object.assign(this,e)}}_([O({type:j.Integer,converter:Kt})],Xv.prototype,"userCertificate",void 0);_([O({type:Wr})],Xv.prototype,"revocationDate",void 0);_([O({type:zi,optional:!0,repeated:"sequence"})],Xv.prototype,"crlEntryExtensions",void 0);class el{constructor(e={}){this.signature=new Ee,this.issuer=new fr,this.thisUpdate=new Wr,Object.assign(this,e)}}_([O({type:j.Integer,optional:!0})],el.prototype,"version",void 0);_([O({type:Ee})],el.prototype,"signature",void 0);_([O({type:fr})],el.prototype,"issuer",void 0);_([O({type:Wr})],el.prototype,"thisUpdate",void 0);_([O({type:Wr,optional:!0})],el.prototype,"nextUpdate",void 0);_([O({type:Xv,repeated:"sequence",optional:!0})],el.prototype,"revokedCertificates",void 0);_([O({type:zi,optional:!0,context:0,repeated:"sequence"})],el.prototype,"crlExtensions",void 0);class XP{constructor(e={}){this.tbsCertList=new el,this.signatureAlgorithm=new Ee,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:el})],XP.prototype,"tbsCertList",void 0);_([O({type:Ee})],XP.prototype,"signatureAlgorithm",void 0);_([O({type:j.BitString})],XP.prototype,"signature",void 0);class ig{constructor(e={}){this.issuer=new fr,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:fr})],ig.prototype,"issuer",void 0);_([O({type:j.Integer,converter:Kt})],ig.prototype,"serialNumber",void 0);let A1=class{constructor(e={}){Object.assign(this,e)}};_([O({type:Nu,context:0,implicit:!0})],A1.prototype,"subjectKeyIdentifier",void 0);_([O({type:ig})],A1.prototype,"issuerAndSerialNumber",void 0);A1=_([ae({type:ne.Choice})],A1);var $c;(function(r){r[r.v0=0]="v0",r[r.v1=1]="v1",r[r.v2=2]="v2",r[r.v3=3]="v3",r[r.v4=4]="v4",r[r.v5=5]="v5"})($c||($c={}));let My=class extends Ee{};My=_([ae({type:ne.Sequence})],My);let e6=class extends Ee{};e6=_([ae({type:ne.Sequence})],e6);let Ea=class extends Ee{};Ea=_([ae({type:ne.Sequence})],Ea);let t6=class extends Ee{};t6=_([ae({type:ne.Sequence})],t6);let yL=class extends Ee{};yL=_([ae({type:ne.Sequence})],yL);let GC=class extends Ee{};GC=_([ae({type:ne.Sequence})],GC);let og=class{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}};_([O({type:j.ObjectIdentifier})],og.prototype,"attrType",void 0);_([O({type:j.Any,repeated:"set"})],og.prototype,"attrValues",void 0);var jC;class Ia{constructor(e={}){this.version=$c.v0,this.sid=new A1,this.digestAlgorithm=new My,this.signatureAlgorithm=new e6,this.signature=new ut,Object.assign(this,e)}}_([O({type:j.Integer})],Ia.prototype,"version",void 0);_([O({type:A1})],Ia.prototype,"sid",void 0);_([O({type:My})],Ia.prototype,"digestAlgorithm",void 0);_([O({type:og,repeated:"set",context:0,implicit:!0,optional:!0})],Ia.prototype,"signedAttrs",void 0);_([O({type:e6})],Ia.prototype,"signatureAlgorithm",void 0);_([O({type:ut})],Ia.prototype,"signature",void 0);_([O({type:og,repeated:"set",context:1,implicit:!0,optional:!0})],Ia.prototype,"unsignedAttrs",void 0);let r6=jC=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,jC.prototype)}};r6=jC=_([ae({type:ne.Set,itemType:Ia})],r6);let mL=class extends Wr{};mL=_([ae({type:ne.Choice})],mL);let wL=class extends Ia{};wL=_([ae({type:ne.Sequence})],wL);class ZP{constructor(e={}){this.acIssuer=new Ke,this.acSerial=0,this.attrs=[],Object.assign(this,e)}}_([O({type:Ke})],ZP.prototype,"acIssuer",void 0);_([O({type:j.Integer})],ZP.prototype,"acSerial",void 0);_([O({type:Mc,repeated:"sequence"})],ZP.prototype,"attrs",void 0);var qC;let n6=qC=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,qC.prototype)}};n6=qC=_([ae({type:ne.Sequence,itemType:j.ObjectIdentifier})],n6);class Zv{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}}_([O({type:j.Integer,optional:!0})],Zv.prototype,"pathLenConstraint",void 0);_([O({type:n6,implicit:!0,context:0,optional:!0})],Zv.prototype,"permittedAttrs",void 0);_([O({type:n6,implicit:!0,context:1,optional:!0})],Zv.prototype,"excludedAttrs",void 0);_([O({type:j.Boolean,defaultValue:!0})],Zv.prototype,"permitUnSpecified",void 0);class _f{constructor(e={}){this.issuer=new Qn,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:Qn})],_f.prototype,"issuer",void 0);_([O({type:j.Integer,converter:Kt})],_f.prototype,"serial",void 0);_([O({type:j.BitString,optional:!0})],_f.prototype,"issuerUID",void 0);var WC;(function(r){r[r.publicKey=0]="publicKey",r[r.publicKeyCert=1]="publicKeyCert",r[r.otherObjectTypes=2]="otherObjectTypes"})(WC||(WC={}));class Pf{constructor(e={}){this.digestedObjectType=WC.publicKey,this.digestAlgorithm=new Ee,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:j.Enumerated})],Pf.prototype,"digestedObjectType",void 0);_([O({type:j.ObjectIdentifier,optional:!0})],Pf.prototype,"otherObjectTypeID",void 0);_([O({type:Ee})],Pf.prototype,"digestAlgorithm",void 0);_([O({type:j.BitString})],Pf.prototype,"objectDigest",void 0);class e7{constructor(e={}){Object.assign(this,e)}}_([O({type:Qn,optional:!0})],e7.prototype,"issuerName",void 0);_([O({type:_f,context:0,implicit:!0,optional:!0})],e7.prototype,"baseCertificateID",void 0);_([O({type:Pf,context:1,implicit:!0,optional:!0})],e7.prototype,"objectDigestInfo",void 0);let S1=class{constructor(e={}){Object.assign(this,e)}};_([O({type:Ke,repeated:"sequence"})],S1.prototype,"v1Form",void 0);_([O({type:e7,context:0,implicit:!0})],S1.prototype,"v2Form",void 0);S1=_([ae({type:ne.Choice})],S1);class t7{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}}_([O({type:j.GeneralizedTime})],t7.prototype,"notBeforeTime",void 0);_([O({type:j.GeneralizedTime})],t7.prototype,"notAfterTime",void 0);class Xm{constructor(e={}){Object.assign(this,e)}}_([O({type:_f,implicit:!0,context:0,optional:!0})],Xm.prototype,"baseCertificateID",void 0);_([O({type:Qn,implicit:!0,context:1,optional:!0})],Xm.prototype,"entityName",void 0);_([O({type:Pf,implicit:!0,context:2,optional:!0})],Xm.prototype,"objectDigestInfo",void 0);var QC;(function(r){r[r.v2=1]="v2"})(QC||(QC={}));class Do{constructor(e={}){this.version=QC.v2,this.holder=new Xm,this.issuer=new S1,this.signature=new Ee,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new t7,this.attributes=[],Object.assign(this,e)}}_([O({type:j.Integer})],Do.prototype,"version",void 0);_([O({type:Xm})],Do.prototype,"holder",void 0);_([O({type:S1})],Do.prototype,"issuer",void 0);_([O({type:Ee})],Do.prototype,"signature",void 0);_([O({type:j.Integer,converter:Kt})],Do.prototype,"serialNumber",void 0);_([O({type:t7})],Do.prototype,"attrCertValidityPeriod",void 0);_([O({type:Mc,repeated:"sequence"})],Do.prototype,"attributes",void 0);_([O({type:j.BitString,optional:!0})],Do.prototype,"issuerUniqueID",void 0);_([O({type:qu,optional:!0})],Do.prototype,"extensions",void 0);class r7{constructor(e={}){this.acinfo=new Do,this.signatureAlgorithm=new Ee,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:Do})],r7.prototype,"acinfo",void 0);_([O({type:Ee})],r7.prototype,"signatureAlgorithm",void 0);_([O({type:j.BitString})],r7.prototype,"signatureValue",void 0);var s6;(function(r){r[r.unmarked=1]="unmarked",r[r.unclassified=2]="unclassified",r[r.restricted=4]="restricted",r[r.confidential=8]="confidential",r[r.secret=16]="secret",r[r.topSecret=32]="topSecret"})(s6||(s6={}));class JC extends qv{}class eN{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:j.ObjectIdentifier,implicit:!0,context:0})],eN.prototype,"type",void 0);_([O({type:j.Any,implicit:!0,context:1})],eN.prototype,"value",void 0);class tN{constructor(e={}){this.policyId="",this.classList=new JC(s6.unclassified),Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],tN.prototype,"policyId",void 0);_([O({type:JC,defaultValue:new JC(s6.unclassified)})],tN.prototype,"classList",void 0);_([O({type:eN,repeated:"set"})],tN.prototype,"securityCategories",void 0);class n7{constructor(e={}){Object.assign(this,e)}}_([O({type:ut})],n7.prototype,"cotets",void 0);_([O({type:j.ObjectIdentifier})],n7.prototype,"oid",void 0);_([O({type:j.Utf8String})],n7.prototype,"string",void 0);class yZ{constructor(e={}){this.values=[],Object.assign(this,e)}}_([O({type:Qn,implicit:!0,context:0,optional:!0})],yZ.prototype,"policyAuthority",void 0);_([O({type:n7,repeated:"sequence"})],yZ.prototype,"values",void 0);var YC;class s7{constructor(e={}){this.targetCertificate=new _f,Object.assign(this,e)}}_([O({type:_f})],s7.prototype,"targetCertificate",void 0);_([O({type:Ke,optional:!0})],s7.prototype,"targetName",void 0);_([O({type:Pf,optional:!0})],s7.prototype,"certDigestInfo",void 0);let C1=class{constructor(e={}){Object.assign(this,e)}};_([O({type:Ke,context:0,implicit:!0})],C1.prototype,"targetName",void 0);_([O({type:Ke,context:1,implicit:!0})],C1.prototype,"targetGroup",void 0);_([O({type:s7,context:2,implicit:!0})],C1.prototype,"targetCert",void 0);C1=_([ae({type:ne.Choice})],C1);let XC=YC=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,YC.prototype)}};XC=YC=_([ae({type:ne.Sequence,itemType:C1})],XC);var ZC;let bL=ZC=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,ZC.prototype)}};bL=ZC=_([ae({type:ne.Sequence,itemType:XC})],bL);class mZ{constructor(e={}){Object.assign(this,e)}}_([O({type:Qn,implicit:!0,context:0,optional:!0})],mZ.prototype,"roleAuthority",void 0);_([O({type:Ke,implicit:!0,context:1})],mZ.prototype,"roleName",void 0);class rN{constructor(e={}){this.service=new Ke,this.ident=new Ke,Object.assign(this,e)}}_([O({type:Ke})],rN.prototype,"service",void 0);_([O({type:Ke})],rN.prototype,"ident",void 0);_([O({type:ut,optional:!0})],rN.prototype,"authInfo",void 0);var eI;class nN{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],nN.prototype,"otherCertFormat",void 0);_([O({type:j.Any})],nN.prototype,"otherCert",void 0);let I1=class{constructor(e={}){Object.assign(this,e)}};_([O({type:nf})],I1.prototype,"certificate",void 0);_([O({type:r7,context:2,implicit:!0})],I1.prototype,"v2AttrCert",void 0);_([O({type:nN,context:3,implicit:!0})],I1.prototype,"other",void 0);I1=_([ae({type:ne.Choice})],I1);let i6=eI=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,eI.prototype)}};i6=eI=_([ae({type:ne.Set,itemType:I1})],i6);class ag{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],ag.prototype,"contentType",void 0);_([O({type:j.Any,context:0})],ag.prototype,"content",void 0);let $y=class{constructor(e={}){Object.assign(this,e)}};_([O({type:ut})],$y.prototype,"single",void 0);_([O({type:j.Any})],$y.prototype,"any",void 0);$y=_([ae({type:ne.Choice})],$y);class i7{constructor(e={}){this.eContentType="",Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],i7.prototype,"eContentType",void 0);_([O({type:$y,context:0,optional:!0})],i7.prototype,"eContent",void 0);let Ly=class{constructor(e={}){Object.assign(this,e)}};_([O({type:ut,context:0,implicit:!0,optional:!0})],Ly.prototype,"value",void 0);_([O({type:ut,converter:Hke,context:0,implicit:!0,optional:!0,repeated:"sequence"})],Ly.prototype,"constructedValue",void 0);Ly=_([ae({type:ne.Choice})],Ly);class Zm{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new t6,Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],Zm.prototype,"contentType",void 0);_([O({type:t6})],Zm.prototype,"contentEncryptionAlgorithm",void 0);_([O({type:Ly,optional:!0})],Zm.prototype,"encryptedContent",void 0);class o7{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],o7.prototype,"keyAttrId",void 0);_([O({type:j.Any,optional:!0})],o7.prototype,"keyAttr",void 0);var tI;class a7{constructor(e={}){this.subjectKeyIdentifier=new Nu,Object.assign(this,e)}}_([O({type:Nu})],a7.prototype,"subjectKeyIdentifier",void 0);_([O({type:j.GeneralizedTime,optional:!0})],a7.prototype,"date",void 0);_([O({type:o7,optional:!0})],a7.prototype,"other",void 0);let k1=class{constructor(e={}){Object.assign(this,e)}};_([O({type:a7,context:0,implicit:!0,optional:!0})],k1.prototype,"rKeyId",void 0);_([O({type:ig,optional:!0})],k1.prototype,"issuerAndSerialNumber",void 0);k1=_([ae({type:ne.Choice})],k1);class sN{constructor(e={}){this.rid=new k1,this.encryptedKey=new ut,Object.assign(this,e)}}_([O({type:k1})],sN.prototype,"rid",void 0);_([O({type:ut})],sN.prototype,"encryptedKey",void 0);let o6=tI=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,tI.prototype)}};o6=tI=_([ae({type:ne.Sequence,itemType:sN})],o6);class iN{constructor(e={}){this.algorithm=new Ee,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:Ee})],iN.prototype,"algorithm",void 0);_([O({type:j.BitString})],iN.prototype,"publicKey",void 0);let sf=class{constructor(e={}){Object.assign(this,e)}};_([O({type:Nu,context:0,implicit:!0,optional:!0})],sf.prototype,"subjectKeyIdentifier",void 0);_([O({type:iN,context:1,implicit:!0,optional:!0})],sf.prototype,"originatorKey",void 0);_([O({type:ig,optional:!0})],sf.prototype,"issuerAndSerialNumber",void 0);sf=_([ae({type:ne.Choice})],sf);class cg{constructor(e={}){this.version=$c.v3,this.originator=new sf,this.keyEncryptionAlgorithm=new Ea,this.recipientEncryptedKeys=new o6,Object.assign(this,e)}}_([O({type:j.Integer})],cg.prototype,"version",void 0);_([O({type:sf,context:0})],cg.prototype,"originator",void 0);_([O({type:ut,context:1,optional:!0})],cg.prototype,"ukm",void 0);_([O({type:Ea})],cg.prototype,"keyEncryptionAlgorithm",void 0);_([O({type:o6})],cg.prototype,"recipientEncryptedKeys",void 0);let T1=class{constructor(e={}){Object.assign(this,e)}};_([O({type:Nu,context:0,implicit:!0})],T1.prototype,"subjectKeyIdentifier",void 0);_([O({type:ig})],T1.prototype,"issuerAndSerialNumber",void 0);T1=_([ae({type:ne.Choice})],T1);class ew{constructor(e={}){this.version=$c.v0,this.rid=new T1,this.keyEncryptionAlgorithm=new Ea,this.encryptedKey=new ut,Object.assign(this,e)}}_([O({type:j.Integer})],ew.prototype,"version",void 0);_([O({type:T1})],ew.prototype,"rid",void 0);_([O({type:Ea})],ew.prototype,"keyEncryptionAlgorithm",void 0);_([O({type:ut})],ew.prototype,"encryptedKey",void 0);class tw{constructor(e={}){this.keyIdentifier=new ut,Object.assign(this,e)}}_([O({type:ut})],tw.prototype,"keyIdentifier",void 0);_([O({type:j.GeneralizedTime,optional:!0})],tw.prototype,"date",void 0);_([O({type:o7,optional:!0})],tw.prototype,"other",void 0);class rw{constructor(e={}){this.version=$c.v4,this.kekid=new tw,this.keyEncryptionAlgorithm=new Ea,this.encryptedKey=new ut,Object.assign(this,e)}}_([O({type:j.Integer})],rw.prototype,"version",void 0);_([O({type:tw})],rw.prototype,"kekid",void 0);_([O({type:Ea})],rw.prototype,"keyEncryptionAlgorithm",void 0);_([O({type:ut})],rw.prototype,"encryptedKey",void 0);class nw{constructor(e={}){this.version=$c.v0,this.keyEncryptionAlgorithm=new Ea,this.encryptedKey=new ut,Object.assign(this,e)}}_([O({type:j.Integer})],nw.prototype,"version",void 0);_([O({type:GC,context:0,optional:!0})],nw.prototype,"keyDerivationAlgorithm",void 0);_([O({type:Ea})],nw.prototype,"keyEncryptionAlgorithm",void 0);_([O({type:ut})],nw.prototype,"encryptedKey",void 0);class oN{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],oN.prototype,"oriType",void 0);_([O({type:j.Any})],oN.prototype,"oriValue",void 0);let Wu=class{constructor(e={}){Object.assign(this,e)}};_([O({type:ew,optional:!0})],Wu.prototype,"ktri",void 0);_([O({type:cg,context:1,implicit:!0,optional:!0})],Wu.prototype,"kari",void 0);_([O({type:rw,context:2,implicit:!0,optional:!0})],Wu.prototype,"kekri",void 0);_([O({type:nw,context:3,implicit:!0,optional:!0})],Wu.prototype,"pwri",void 0);_([O({type:oN,context:4,implicit:!0,optional:!0})],Wu.prototype,"ori",void 0);Wu=_([ae({type:ne.Choice})],Wu);var rI;let a6=rI=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,rI.prototype)}};a6=rI=_([ae({type:ne.Set,itemType:Wu})],a6);var nI;class c7{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],c7.prototype,"otherRevInfoFormat",void 0);_([O({type:j.Any})],c7.prototype,"otherRevInfo",void 0);let c6=class{constructor(e={}){this.other=new c7,Object.assign(this,e)}};_([O({type:c7,context:1,implicit:!0})],c6.prototype,"other",void 0);c6=_([ae({type:ne.Choice})],c6);let l6=nI=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,nI.prototype)}};l6=nI=_([ae({type:ne.Set,itemType:c6})],l6);class aN{constructor(e={}){Object.assign(this,e)}}_([O({type:i6,context:0,implicit:!0,optional:!0})],aN.prototype,"certs",void 0);_([O({type:l6,context:1,implicit:!0,optional:!0})],aN.prototype,"crls",void 0);var sI;let iI=sI=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,sI.prototype)}};iI=sI=_([ae({type:ne.Set,itemType:og})],iI);class sw{constructor(e={}){this.version=$c.v0,this.recipientInfos=new a6,this.encryptedContentInfo=new Zm,Object.assign(this,e)}}_([O({type:j.Integer})],sw.prototype,"version",void 0);_([O({type:aN,context:0,implicit:!0,optional:!0})],sw.prototype,"originatorInfo",void 0);_([O({type:a6})],sw.prototype,"recipientInfos",void 0);_([O({type:Zm})],sw.prototype,"encryptedContentInfo",void 0);_([O({type:iI,context:1,implicit:!0,optional:!0})],sw.prototype,"unprotectedAttrs",void 0);const gTe="1.2.840.113549.1.7.2";var oI;let u6=oI=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,oI.prototype)}};u6=oI=_([ae({type:ne.Set,itemType:My})],u6);class lg{constructor(e={}){this.version=$c.v0,this.digestAlgorithms=new u6,this.encapContentInfo=new i7,this.signerInfos=new r6,Object.assign(this,e)}}_([O({type:j.Integer})],lg.prototype,"version",void 0);_([O({type:u6})],lg.prototype,"digestAlgorithms",void 0);_([O({type:i7})],lg.prototype,"encapContentInfo",void 0);_([O({type:i6,context:0,implicit:!0,optional:!0})],lg.prototype,"certificates",void 0);_([O({type:l6,context:1,implicit:!0,optional:!0})],lg.prototype,"crls",void 0);_([O({type:r6})],lg.prototype,"signerInfos",void 0);const Uy="1.2.840.10045.2.1",cN="1.2.840.10045.4.1",wZ="1.2.840.10045.4.3.1",lN="1.2.840.10045.4.3.2",uN="1.2.840.10045.4.3.3",hN="1.2.840.10045.4.3.4",vL="1.2.840.10045.3.1.7",EL="1.3.132.0.34",xL="1.3.132.0.35";function iw(r){return new Ee({algorithm:r})}const yTe=iw(cN);iw(wZ);const mTe=iw(lN),wTe=iw(uN),bTe=iw(hN);let Fy=class{constructor(e={}){Object.assign(this,e)}};_([O({type:j.ObjectIdentifier})],Fy.prototype,"fieldType",void 0);_([O({type:j.Any})],Fy.prototype,"parameters",void 0);Fy=_([ae({type:ne.Sequence})],Fy);class vTe extends ut{}let _1=class{constructor(e={}){Object.assign(this,e)}};_([O({type:j.OctetString})],_1.prototype,"a",void 0);_([O({type:j.OctetString})],_1.prototype,"b",void 0);_([O({type:j.BitString,optional:!0})],_1.prototype,"seed",void 0);_1=_([ae({type:ne.Sequence})],_1);var aI;(function(r){r[r.ecpVer1=1]="ecpVer1"})(aI||(aI={}));let Lc=class{constructor(e={}){this.version=aI.ecpVer1,Object.assign(this,e)}};_([O({type:j.Integer})],Lc.prototype,"version",void 0);_([O({type:Fy})],Lc.prototype,"fieldID",void 0);_([O({type:_1})],Lc.prototype,"curve",void 0);_([O({type:vTe})],Lc.prototype,"base",void 0);_([O({type:j.Integer,converter:Kt})],Lc.prototype,"order",void 0);_([O({type:j.Integer,optional:!0})],Lc.prototype,"cofactor",void 0);Lc=_([ae({type:ne.Sequence})],Lc);let Qu=class{constructor(e={}){Object.assign(this,e)}};_([O({type:j.ObjectIdentifier})],Qu.prototype,"namedCurve",void 0);_([O({type:j.Null})],Qu.prototype,"implicitCurve",void 0);_([O({type:Lc})],Qu.prototype,"specifiedCurve",void 0);Qu=_([ae({type:ne.Choice})],Qu);class l7{constructor(e={}){this.version=1,this.privateKey=new ut,Object.assign(this,e)}}_([O({type:j.Integer})],l7.prototype,"version",void 0);_([O({type:ut})],l7.prototype,"privateKey",void 0);_([O({type:Qu,context:0,optional:!0})],l7.prototype,"parameters",void 0);_([O({type:j.BitString,context:1,optional:!0})],l7.prototype,"publicKey",void 0);class h6{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:j.Integer,converter:Kt})],h6.prototype,"r",void 0);_([O({type:j.Integer,converter:Kt})],h6.prototype,"s",void 0);const _s="1.2.840.113549.1.1",of=`${_s}.1`,ETe=`${_s}.7`,xTe=`${_s}.9`,F2=`${_s}.10`,ATe=`${_s}.2`,STe=`${_s}.4`,d6=`${_s}.5`,CTe=`${_s}.14`,cI=`${_s}.11`,f6=`${_s}.12`,p6=`${_s}.13`,bZ=`${_s}.15`,vZ=`${_s}.16`,g6="1.3.14.3.2.26",EZ="2.16.840.1.101.3.4.2.4",y6="2.16.840.1.101.3.4.2.1",m6="2.16.840.1.101.3.4.2.2",w6="2.16.840.1.101.3.4.2.3",ITe="2.16.840.1.101.3.4.2.5",kTe="2.16.840.1.101.3.4.2.6",TTe="1.2.840.113549.2.2",_Te="1.2.840.113549.2.5",u7=`${_s}.8`;function Ir(r){return new Ee({algorithm:r,parameters:null})}Ir(TTe);Ir(_Te);const af=Ir(g6);Ir(EZ);Ir(y6);Ir(m6);Ir(w6);Ir(ITe);Ir(kTe);const xZ=new Ee({algorithm:u7,parameters:pe.serialize(af)}),AZ=new Ee({algorithm:xTe,parameters:pe.serialize(qb.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))});Ir(of);Ir(ATe);Ir(STe);Ir(d6);Ir(bZ);Ir(vZ);Ir(f6);Ir(p6);Ir(bZ);Ir(vZ);class h7{constructor(e={}){this.hashAlgorithm=new Ee(af),this.maskGenAlgorithm=new Ee({algorithm:u7,parameters:pe.serialize(af)}),this.pSourceAlgorithm=new Ee(AZ),Object.assign(this,e)}}_([O({type:Ee,context:0,defaultValue:af})],h7.prototype,"hashAlgorithm",void 0);_([O({type:Ee,context:1,defaultValue:xZ})],h7.prototype,"maskGenAlgorithm",void 0);_([O({type:Ee,context:2,defaultValue:AZ})],h7.prototype,"pSourceAlgorithm",void 0);new Ee({algorithm:ETe,parameters:pe.serialize(new h7)});class cf{constructor(e={}){this.hashAlgorithm=new Ee(af),this.maskGenAlgorithm=new Ee({algorithm:u7,parameters:pe.serialize(af)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}}_([O({type:Ee,context:0,defaultValue:af})],cf.prototype,"hashAlgorithm",void 0);_([O({type:Ee,context:1,defaultValue:xZ})],cf.prototype,"maskGenAlgorithm",void 0);_([O({type:j.Integer,context:2,defaultValue:20})],cf.prototype,"saltLength",void 0);_([O({type:j.Integer,context:3,defaultValue:1})],cf.prototype,"trailerField",void 0);new Ee({algorithm:F2,parameters:pe.serialize(new cf)});class d7{constructor(e={}){this.digestAlgorithm=new Ee,this.digest=new ut,Object.assign(this,e)}}_([O({type:Ee})],d7.prototype,"digestAlgorithm",void 0);_([O({type:ut})],d7.prototype,"digest",void 0);var lI;class f7{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:j.Integer,converter:Kt})],f7.prototype,"prime",void 0);_([O({type:j.Integer,converter:Kt})],f7.prototype,"exponent",void 0);_([O({type:j.Integer,converter:Kt})],f7.prototype,"coefficient",void 0);let uI=lI=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,lI.prototype)}};uI=lI=_([ae({type:ne.Sequence,itemType:f7})],uI);class ka{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:j.Integer})],ka.prototype,"version",void 0);_([O({type:j.Integer,converter:Kt})],ka.prototype,"modulus",void 0);_([O({type:j.Integer,converter:Kt})],ka.prototype,"publicExponent",void 0);_([O({type:j.Integer,converter:Kt})],ka.prototype,"privateExponent",void 0);_([O({type:j.Integer,converter:Kt})],ka.prototype,"prime1",void 0);_([O({type:j.Integer,converter:Kt})],ka.prototype,"prime2",void 0);_([O({type:j.Integer,converter:Kt})],ka.prototype,"exponent1",void 0);_([O({type:j.Integer,converter:Kt})],ka.prototype,"exponent2",void 0);_([O({type:j.Integer,converter:Kt})],ka.prototype,"coefficient",void 0);_([O({type:uI,optional:!0})],ka.prototype,"otherPrimeInfos",void 0);class dN{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:j.Integer,converter:Kt})],dN.prototype,"modulus",void 0);_([O({type:j.Integer,converter:Kt})],dN.prototype,"publicExponent",void 0);var hI;(function(r){r[r.Transient=0]="Transient",r[r.Singleton=1]="Singleton",r[r.ResolutionScoped=2]="ResolutionScoped",r[r.ContainerScoped=3]="ContainerScoped"})(hI||(hI={}));const rs=hI;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var dI=function(r,e){return dI=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])},dI(r,e)};function fN(r,e){dI(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function PTe(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(n.next(u))}catch(d){o(d)}}function c(u){try{l(n.throw(u))}catch(d){o(d)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((n=n.apply(r,[])).next())})}function NTe(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,s,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(i=l[0]&2?s.return:l[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,l[1])).done)return i;switch(s=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,s=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],s=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function y3(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function b6(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),s,i=[],o;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Rh(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(b6(arguments[e]));return r}var DTe="injectionTokens";function OTe(r){var e=Reflect.getMetadata("design:paramtypes",r)||[],t=Reflect.getOwnMetadata(DTe,r)||{};return Object.keys(t).forEach(function(n){e[+n]=t[n]}),e}function SZ(r){return!!r.useClass}function fI(r){return!!r.useFactory}var CZ=function(){function r(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return r.prototype.createProxy=function(e){var t=this,n={},s=!1,i,o=function(){return s||(i=e(t.wrap()),s=!0),i};return new Proxy(n,this.createHandler(o))},r.prototype.createHandler=function(e){var t={},n=function(s){t[s]=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];i[0]=e();var a=Reflect[s];return a.apply(void 0,Rh(i))}};return this.reflectMethods.forEach(n),t},r}();function Yf(r){return typeof r=="string"||typeof r=="symbol"}function RTe(r){return typeof r=="object"&&"token"in r&&"multiple"in r}function AL(r){return typeof r=="object"&&"token"in r&&"transform"in r}function BTe(r){return typeof r=="function"||r instanceof CZ}function v4(r){return!!r.useToken}function E4(r){return r.useValue!=null}function MTe(r){return SZ(r)||E4(r)||v4(r)||fI(r)}var pN=function(){function r(){this._registryMap=new Map}return r.prototype.entries=function(){return this._registryMap.entries()},r.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},r.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},r.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},r.prototype.setAll=function(e,t){this._registryMap.set(e,t)},r.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},r.prototype.clear=function(){this._registryMap.clear()},r.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},r}(),$Te=function(r){fN(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(pN),m3=function(){function r(){this.scopedResolutions=new Map}return r}();function LTe(r,e){if(r===null)return"at position #"+e;var t=r.split(",")[e].trim();return'"'+t+'" at position #'+e}function UTe(r,e,t){return t===void 0&&(t="    "),Rh([r],e.message.split(`
`).map(function(n){return t+n})).join(`
`)}function FTe(r,e,t){var n=b6(r.toString().match(/constructor\(([\w, ]+)\)/)||[],2),s=n[1],i=s===void 0?null:s,o=LTe(i,e);return UTe("Cannot inject the dependency "+o+' of "'+r.name+'" constructor. Reason:',t)}function zTe(r){if(typeof r.dispose!="function")return!1;var e=r.dispose;return!(e.length>0)}var VTe=function(r){fN(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(pN),HTe=function(r){fN(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(pN),KTe=function(){function r(){this.preResolution=new VTe,this.postResolution=new HTe}return r}(),IZ=new Map,GTe=function(){function r(e){this.parent=e,this._registry=new $Te,this.interceptors=new KTe,this.disposed=!1,this.disposables=new Set}return r.prototype.register=function(e,t,n){n===void 0&&(n={lifecycle:rs.Transient}),this.ensureNotDisposed();var s;if(MTe(t)?s=t:s={useClass:t},v4(s))for(var i=[e],o=s;o!=null;){var a=o.useToken;if(i.includes(a))throw new Error("Token registration cycle detected! "+Rh(i,[a]).join(" -> "));i.push(a);var c=this._registry.get(a);c&&v4(c.provider)?o=c.provider:o=null}if((n.lifecycle===rs.Singleton||n.lifecycle==rs.ContainerScoped||n.lifecycle==rs.ResolutionScoped)&&(E4(s)||fI(s)))throw new Error('Cannot use lifecycle "'+rs[n.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:s,options:n}),this},r.prototype.registerType=function(e,t){return this.ensureNotDisposed(),Yf(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},r.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},r.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),Yf(e)){if(Yf(t))return this.register(e,{useToken:t},{lifecycle:rs.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:rs.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var n=e;return t&&!Yf(t)&&(n=t),this.register(e,{useClass:n},{lifecycle:rs.Singleton})},r.prototype.resolve=function(e,t,n){t===void 0&&(t=new m3),n===void 0&&(n=!1),this.ensureNotDisposed();var s=this.getRegistration(e);if(!s&&Yf(e)){if(n)return;throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"Single"),s){var i=this.resolveRegistration(s,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(BTe(e)){var i=this.construct(e,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},r.prototype.executePreResolutionInterceptor=function(e,t){var n,s;if(this.interceptors.preResolution.has(e)){var i=[];try{for(var o=y3(this.interceptors.preResolution.getAll(e)),a=o.next();!a.done;a=o.next()){var c=a.value;c.options.frequency!="Once"&&i.push(c),c.callback(e,t)}}catch(l){n={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(n)throw n.error}}this.interceptors.preResolution.setAll(e,i)}},r.prototype.executePostResolutionInterceptor=function(e,t,n){var s,i;if(this.interceptors.postResolution.has(e)){var o=[];try{for(var a=y3(this.interceptors.postResolution.getAll(e)),c=a.next();!c.done;c=a.next()){var l=c.value;l.options.frequency!="Once"&&o.push(l),l.callback(e,t,n)}}catch(u){s={error:u}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(s)throw s.error}}this.interceptors.postResolution.setAll(e,o)}},r.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===rs.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var n=e.options.lifecycle===rs.Singleton,s=e.options.lifecycle===rs.ContainerScoped,i=n||s,o;return E4(e.provider)?o=e.provider.useValue:v4(e.provider)?o=i?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):SZ(e.provider)?o=i?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):fI(e.provider)?o=e.provider.useFactory(this):o=this.construct(e.provider,t),e.options.lifecycle===rs.ResolutionScoped&&t.scopedResolutions.set(e,o),o},r.prototype.resolveAll=function(e,t,n){var s=this;t===void 0&&(t=new m3),n===void 0&&(n=!1),this.ensureNotDisposed();var i=this.getAllRegistrations(e);if(!i&&Yf(e)){if(n)return[];throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"All"),i){var o=i.map(function(c){return s.resolveRegistration(c,t)});return this.executePostResolutionInterceptor(e,o,"All"),o}var a=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,a,"All"),a},r.prototype.isRegistered=function(e,t){return t===void 0&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},r.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},r.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var n=y3(this._registry.entries()),s=n.next();!s.done;s=n.next()){var i=b6(s.value,2),o=i[0],a=i[1];this._registry.setAll(o,a.filter(function(c){return!E4(c.provider)}).map(function(c){return c.instance=void 0,c}))}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},r.prototype.createChildContainer=function(){var e,t;this.ensureNotDisposed();var n=new r(this);try{for(var s=y3(this._registry.entries()),i=s.next();!i.done;i=s.next()){var o=b6(i.value,2),a=o[0],c=o[1];c.some(function(l){var u=l.options;return u.lifecycle===rs.ContainerScoped})&&n._registry.setAll(a,c.map(function(l){return l.options.lifecycle===rs.ContainerScoped?{provider:l.provider,options:l.options}:l}))}}catch(l){e={error:l}}finally{try{i&&!i.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return n},r.prototype.beforeResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:n})},r.prototype.afterResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:n})},r.prototype.dispose=function(){return PTe(this,void 0,void 0,function(){var e;return NTe(this,function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach(function(n){var s=n.dispose();s&&e.push(s)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},r.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},r.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},r.prototype.construct=function(e,t){var n=this;if(e instanceof CZ)return e.createProxy(function(i){return n.resolve(i,t)});var s=function(){var i=IZ.get(e);if(!i||i.length===0){if(e.length===0)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var o=i.map(n.resolveParams(t,e));return new(e.bind.apply(e,Rh([void 0],o)))}();return zTe(s)&&this.disposables.add(s),s},r.prototype.resolveParams=function(e,t){var n=this;return function(s,i){var o,a,c;try{return RTe(s)?AL(s)?s.multiple?(o=n.resolve(s.transform)).transform.apply(o,Rh([n.resolveAll(s.token,new m3,s.isOptional)],s.transformArgs)):(a=n.resolve(s.transform)).transform.apply(a,Rh([n.resolve(s.token,e,s.isOptional)],s.transformArgs)):s.multiple?n.resolveAll(s.token,new m3,s.isOptional):n.resolve(s.token,e,s.isOptional):AL(s)?(c=n.resolve(s.transform,e)).transform.apply(c,Rh([n.resolve(s.token,e)],s.transformArgs)):n.resolve(s,e)}catch(l){throw new Error(FTe(t,i,l))}}},r.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},r}(),tn=new GTe;function p7(r){return function(e){IZ.set(e,OTe(e))}}if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var pI;class g7{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}}_([O({type:j.ObjectIdentifier})],g7.prototype,"attrId",void 0);_([O({type:j.Any,repeated:"set"})],g7.prototype,"attrValues",void 0);let SL=pI=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,pI.prototype)}};SL=pI=_([ae({type:ne.Sequence,itemType:g7})],SL);var gI;let CL=gI=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,gI.prototype)}};CL=gI=_([ae({type:ne.Sequence,itemType:ag})],CL);class kZ{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],kZ.prototype,"certId",void 0);_([O({type:j.Any,context:0})],kZ.prototype,"certValue",void 0);class TZ{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],TZ.prototype,"crlId",void 0);_([O({type:j.Any,context:0})],TZ.prototype,"crltValue",void 0);class _Z extends ut{}let y7=class{constructor(e={}){this.encryptionAlgorithm=new Ee,this.encryptedData=new _Z,Object.assign(this,e)}};_([O({type:Ee})],y7.prototype,"encryptionAlgorithm",void 0);_([O({type:_Z})],y7.prototype,"encryptedData",void 0);var yI,mI;(function(r){r[r.v1=0]="v1"})(mI||(mI={}));class PZ extends ut{}let wI=yI=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,yI.prototype)}};wI=yI=_([ae({type:ne.Sequence,itemType:Mc})],wI);class ow{constructor(e={}){this.version=mI.v1,this.privateKeyAlgorithm=new Ee,this.privateKey=new PZ,Object.assign(this,e)}}_([O({type:j.Integer})],ow.prototype,"version",void 0);_([O({type:Ee})],ow.prototype,"privateKeyAlgorithm",void 0);_([O({type:PZ})],ow.prototype,"privateKey",void 0);_([O({type:wI,implicit:!0,context:0,optional:!0})],ow.prototype,"attributes",void 0);let IL=class extends ow{};IL=_([ae({type:ne.Sequence})],IL);let kL=class extends y7{};kL=_([ae({type:ne.Sequence})],kL);class NZ{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],NZ.prototype,"secretTypeId",void 0);_([O({type:j.Any,context:0})],NZ.prototype,"secretValue",void 0);class aw{constructor(e={}){this.mac=new d7,this.macSalt=new ut,this.iterations=1,Object.assign(this,e)}}_([O({type:d7})],aw.prototype,"mac",void 0);_([O({type:ut})],aw.prototype,"macSalt",void 0);_([O({type:j.Integer,defaultValue:1})],aw.prototype,"iterations",void 0);class m7{constructor(e={}){this.version=3,this.authSafe=new ag,this.macData=new aw,Object.assign(this,e)}}_([O({type:j.Integer})],m7.prototype,"version",void 0);_([O({type:ag})],m7.prototype,"authSafe",void 0);_([O({type:aw,optional:!0})],m7.prototype,"macData",void 0);var bI;class w7{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:j.ObjectIdentifier})],w7.prototype,"bagId",void 0);_([O({type:j.Any,context:0})],w7.prototype,"bagValue",void 0);_([O({type:g7,repeated:"set",optional:!0})],w7.prototype,"bagAttributes",void 0);let TL=bI=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,bI.prototype)}};TL=bI=_([ae({type:ne.Sequence,itemType:w7})],TL);var vI,EI,xI;const DZ="1.2.840.113549.1.9",OZ=`${DZ}.7`,gN=`${DZ}.14`;let v6=class extends en{constructor(e={}){super(e)}toString(){return this.ia5String||super.toString()}};_([O({type:j.IA5String})],v6.prototype,"ia5String",void 0);v6=_([ae({type:ne.Choice})],v6);let _L=class extends ag{};_L=_([ae({type:ne.Sequence})],_L);let PL=class extends m7{};PL=_([ae({type:ne.Sequence})],PL);let NL=class extends y7{};NL=_([ae({type:ne.Sequence})],NL);let AI=class{constructor(e=""){this.value=e}toString(){return this.value}};_([O({type:j.IA5String})],AI.prototype,"value",void 0);AI=_([ae({type:ne.Choice})],AI);let DL=class extends v6{};DL=_([ae({type:ne.Choice})],DL);let OL=class extends en{};OL=_([ae({type:ne.Choice})],OL);let SI=class{constructor(e=new Date){this.value=e}};_([O({type:j.GeneralizedTime})],SI.prototype,"value",void 0);SI=_([ae({type:ne.Choice})],SI);let RL=class extends en{};RL=_([ae({type:ne.Choice})],RL);let CI=class{constructor(e="M"){this.value=e}toString(){return this.value}};_([O({type:j.PrintableString})],CI.prototype,"value",void 0);CI=_([ae({type:ne.Choice})],CI);let E6=class{constructor(e=""){this.value=e}toString(){return this.value}};_([O({type:j.PrintableString})],E6.prototype,"value",void 0);E6=_([ae({type:ne.Choice})],E6);let BL=class extends E6{};BL=_([ae({type:ne.Choice})],BL);let ML=class extends en{};ML=_([ae({type:ne.Choice})],ML);let II=class{constructor(e=""){this.value=e}toString(){return this.value}};_([O({type:j.ObjectIdentifier})],II.prototype,"value",void 0);II=_([ae({type:ne.Choice})],II);let $L=class extends Wr{};$L=_([ae({type:ne.Choice})],$L);let kI=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};_([O({type:j.Integer})],kI.prototype,"value",void 0);kI=_([ae({type:ne.Choice})],kI);let LL=class extends Ia{};LL=_([ae({type:ne.Sequence})],LL);let x6=class extends en{};x6=_([ae({type:ne.Choice})],x6);let UL=vI=class extends qu{constructor(e){super(e),Object.setPrototypeOf(this,vI.prototype)}};UL=vI=_([ae({type:ne.Sequence})],UL);let FL=EI=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,EI.prototype)}};FL=EI=_([ae({type:ne.Set,itemType:og})],FL);let TI=class{constructor(e=""){this.value=e}toString(){return this.value}};_([O({type:j.BmpString})],TI.prototype,"value",void 0);TI=_([ae({type:ne.Choice})],TI);let _I=class extends Ee{};_I=_([ae({type:ne.Sequence})],_I);let zL=xI=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,xI.prototype)}};zL=xI=_([ae({type:ne.Sequence,itemType:_I})],zL);var PI;let A6=PI=class extends xt{constructor(e){super(e),Object.setPrototypeOf(this,PI.prototype)}};A6=PI=_([ae({type:ne.Sequence,itemType:Mc})],A6);class ug{constructor(e={}){this.version=0,this.subject=new fr,this.subjectPKInfo=new wo,this.attributes=new A6,Object.assign(this,e)}}_([O({type:j.Integer})],ug.prototype,"version",void 0);_([O({type:fr})],ug.prototype,"subject",void 0);_([O({type:wo})],ug.prototype,"subjectPKInfo",void 0);_([O({type:A6,implicit:!0,context:0})],ug.prototype,"attributes",void 0);class zy{constructor(e={}){this.certificationRequestInfo=new ug,this.signatureAlgorithm=new Ee,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}_([O({type:ug})],zy.prototype,"certificationRequestInfo",void 0);_([O({type:Ee})],zy.prototype,"signatureAlgorithm",void 0);_([O({type:j.BitString})],zy.prototype,"signature",void 0);/*!
 * MIT License
 * 
 * Copyright (c) Peculiar Ventures. All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const cw="crypto.algorithm";class jTe{getAlgorithms(){return tn.resolveAll(cw)}toAsnAlgorithm(e){({...e});for(const t of this.getAlgorithms()){const n=t.toAsnAlgorithm(e);if(n)return n}if(/^[0-9.]+$/.test(e.name)){const t=new Ee({algorithm:e.name});if("parameters"in e){const n=e;t.parameters=n.parameters}return t}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(const n of this.getAlgorithms()){const s=n.toWebAlgorithm(e);if(s)return s}return{name:e.algorithm,parameters:e.parameters}}}const lf="crypto.algorithmProvider";tn.registerSingleton(lf,jTe);var x4;const Ps="1.3.36.3.3.2.8.1.1",VL=`${Ps}.1`,HL=`${Ps}.2`,KL=`${Ps}.3`,GL=`${Ps}.4`,jL=`${Ps}.5`,qL=`${Ps}.6`,WL=`${Ps}.7`,QL=`${Ps}.8`,JL=`${Ps}.9`,YL=`${Ps}.10`,XL=`${Ps}.11`,ZL=`${Ps}.12`,eU=`${Ps}.13`,tU=`${Ps}.14`,rU="brainpoolP160r1",nU="brainpoolP160t1",sU="brainpoolP192r1",iU="brainpoolP192t1",oU="brainpoolP224r1",aU="brainpoolP224t1",cU="brainpoolP256r1",lU="brainpoolP256t1",uU="brainpoolP320r1",hU="brainpoolP320t1",dU="brainpoolP384r1",fU="brainpoolP384t1",pU="brainpoolP512r1",gU="brainpoolP512t1",Wt="ECDSA";let Vy=x4=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case Wt.toLowerCase():if("hash"in e)switch((typeof e.hash=="string"?e.hash:e.hash.name).toLowerCase()){case"sha-1":return yTe;case"sha-256":return mTe;case"sha-384":return wTe;case"sha-512":return bTe}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t=vL;break;case"K-256":t=x4.SECP256K1;break;case"P-384":t=EL;break;case"P-521":t=xL;break;case rU:t=VL;break;case nU:t=HL;break;case sU:t=KL;break;case iU:t=GL;break;case oU:t=jL;break;case aU:t=qL;break;case cU:t=WL;break;case lU:t=QL;break;case uU:t=JL;break;case hU:t=YL;break;case dU:t=XL;break;case fU:t=ZL;break;case pU:t=eU;break;case gU:t=tU;break}if(t)return new Ee({algorithm:Uy,parameters:pe.serialize(new Qu({namedCurve:t}))})}}return null}toWebAlgorithm(e){switch(e.algorithm){case cN:return{name:Wt,hash:{name:"SHA-1"}};case lN:return{name:Wt,hash:{name:"SHA-256"}};case uN:return{name:Wt,hash:{name:"SHA-384"}};case hN:return{name:Wt,hash:{name:"SHA-512"}};case Uy:{if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(pe.parse(e.parameters,Qu).namedCurve){case vL:return{name:Wt,namedCurve:"P-256"};case x4.SECP256K1:return{name:Wt,namedCurve:"K-256"};case EL:return{name:Wt,namedCurve:"P-384"};case xL:return{name:Wt,namedCurve:"P-521"};case VL:return{name:Wt,namedCurve:rU};case HL:return{name:Wt,namedCurve:nU};case KL:return{name:Wt,namedCurve:sU};case GL:return{name:Wt,namedCurve:iU};case jL:return{name:Wt,namedCurve:oU};case qL:return{name:Wt,namedCurve:aU};case WL:return{name:Wt,namedCurve:cU};case QL:return{name:Wt,namedCurve:lU};case JL:return{name:Wt,namedCurve:uU};case YL:return{name:Wt,namedCurve:hU};case XL:return{name:Wt,namedCurve:dU};case ZL:return{name:Wt,namedCurve:fU};case eU:return{name:Wt,namedCurve:pU};case tU:return{name:Wt,namedCurve:gU}}}}return null}};Vy.SECP256K1="1.3.132.0.10";Vy=x4=_([p7()],Vy);tn.registerSingleton(cw,Vy);const RZ=Symbol("name"),BZ=Symbol("value");class yt{constructor(e,t={},n=""){this[RZ]=e,this[BZ]=n;for(const s in t)this[s]=t[s]}}yt.NAME=RZ;yt.VALUE=BZ;class qTe{static toTextObject(e){const t=new yt("Algorithm Identifier",{},lh.toString(e.algorithm));if(e.parameters)switch(e.algorithm){case Uy:{const n=new Vy().toWebAlgorithm(e);n&&"namedCurve"in n?t["Named Curve"]=n.namedCurve:t.Parameters=e.parameters;break}default:t.Parameters=e.parameters}return t}}class lh{static toString(e){const t=this.items[e];return t||e}}lh.items={[g6]:"sha1",[EZ]:"sha224",[y6]:"sha256",[m6]:"sha384",[w6]:"sha512",[of]:"rsaEncryption",[d6]:"sha1WithRSAEncryption",[CTe]:"sha224WithRSAEncryption",[cI]:"sha256WithRSAEncryption",[f6]:"sha384WithRSAEncryption",[p6]:"sha512WithRSAEncryption",[Uy]:"ecPublicKey",[cN]:"ecdsaWithSHA1",[wZ]:"ecdsaWithSHA224",[lN]:"ecdsaWithSHA256",[uN]:"ecdsaWithSHA384",[hN]:"ecdsaWithSHA512",[lTe]:"TLS WWW server authentication",[uTe]:"TLS WWW client authentication",[hTe]:"Code Signing",[dTe]:"E-mail Protection",[fTe]:"Time Stamping",[pTe]:"OCSP Signing",[gTe]:"Signed Data"};class uf{static serialize(e){return this.serializeObj(e).join(`
`)}static pad(e=0){return"".padStart(2*e," ")}static serializeObj(e,t=0){const n=[];let s=this.pad(t++),i="";const o=e[yt.VALUE];o&&(i=` ${o}`),n.push(`${s}${e[yt.NAME]}:${i}`),s=this.pad(t);for(const a in e){if(typeof a=="symbol")continue;const c=e[a],l=a?`${a}: `:"";if(typeof c=="string"||typeof c=="number"||typeof c=="boolean")n.push(`${s}${l}${c}`);else if(c instanceof Date)n.push(`${s}${l}${c.toUTCString()}`);else if(Array.isArray(c))for(const u of c)u[yt.NAME]=a,n.push(...this.serializeObj(u,t));else if(c instanceof yt)c[yt.NAME]=a,n.push(...this.serializeObj(c,t));else if(me.isBufferSource(c))a?(n.push(`${s}${l}`),n.push(...this.serializeBufferSource(c,t+1))):n.push(...this.serializeBufferSource(c,t));else if("toTextObject"in c){const u=c.toTextObject();u[yt.NAME]=a,n.push(...this.serializeObj(u,t))}else throw new TypeError("Cannot serialize data in text format. Unsupported type.")}return n}static serializeBufferSource(e,t=0){const n=this.pad(t),s=me.toUint8Array(e),i=[];for(let o=0;o<s.length;){const a=[];for(let c=0;c<16&&o<s.length;c++){c===8&&a.push("");const l=s[o++].toString(16).padStart(2,"0");a.push(l)}i.push(`${n}${a.join(" ")}`)}return i}static serializeAlgorithm(e){return this.algorithmSerializer.toTextObject(e)}}uf.oidSerializer=lh;uf.algorithmSerializer=qTe;class uh{constructor(...e){if(e.length===1){const t=e[0];this.rawData=pe.serialize(t),this.onInit(t)}else{const t=pe.parse(e[0],e[1]);this.rawData=me.toArrayBuffer(e[0]),this.onInit(t)}}equal(e){return e instanceof uh?WY(e.rawData,this.rawData):!1}toString(e="text"){switch(e){case"asn":return pe.toString(this.rawData);case"text":return uf.serialize(this.toTextObject());case"hex":return Te.ToHex(this.rawData);case"base64":return Te.ToBase64(this.rawData);case"base64url":return Te.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){const e=this.toTextObjectEmpty();return e[""]=this.rawData,e}toTextObjectEmpty(e){return new yt(this.getTextName(),{},e)}}uh.NAME="ASN";class Gi extends uh{constructor(...e){let t;me.isBufferSource(e[0])?t=me.toArrayBuffer(e[0]):t=pe.serialize(new zi({extnID:e[0],critical:e[1],extnValue:new ut(me.toArrayBuffer(e[2]))})),super(t,zi)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[yt.NAME]===Gi.NAME&&(e[yt.NAME]=lh.toString(this.type)),e}}var MZ;class pu{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&e.extractable!==void 0}constructor(){this.items=new Map,this[MZ]="CryptoProvider",typeof self<"u"&&typeof crypto<"u"?this.set(pu.DEFAULT,crypto):typeof global<"u"&&global.crypto&&global.crypto.subtle&&this.set(pu.DEFAULT,global.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,t){return this.items.forEach(e,t)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=pu.DEFAULT){const t=this.items.get(e.toLowerCase());if(!t)throw new Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if(typeof e=="string"){if(!t)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),t)}else this.items.set(pu.DEFAULT,e);return this}}MZ=Symbol.toStringTag;pu.DEFAULT="default";const Kr=new pu,WTe=/^[0-2](?:\.[1-9][0-9]*)+$/;function QTe(r){return new RegExp(WTe).test(r)}class $Z{constructor(e={}){this.items={};for(const t in e)this.register(t,e[t])}get(e){return this.items[e]||null}findId(e){return QTe(e)?e:this.get(e)}register(e,t){this.items[e]=t,this.items[t]=e}}const ks=new $Z;ks.register("CN","2.5.4.3");ks.register("L","2.5.4.7");ks.register("ST","2.5.4.8");ks.register("O","2.5.4.10");ks.register("OU","2.5.4.11");ks.register("C","2.5.4.6");ks.register("DC","0.9.2342.19200300.100.1.25");ks.register("E","1.2.840.113549.1.9.1");ks.register("G","2.5.4.42");ks.register("I","2.5.4.43");ks.register("SN","2.5.4.4");ks.register("T","2.5.4.12");function JTe(r,e){return`\\${Te.ToHex(Te.FromUtf8String(e)).toUpperCase()}`}function YTe(r){return r.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,JTe)}class Ri{static isASCII(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!1;return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,t={}){this.extraNames=new $Z,this.asn=new fr;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const s=t[n];this.extraNames.register(n,s)}typeof e=="string"?this.asn=this.fromString(e):e instanceof fr?this.asn=e:me.isBufferSource(e)?this.asn=pe.parse(e,fr):this.asn=this.fromJSON(e)}getField(e){const t=this.extraNames.findId(e)||ks.findId(e),n=[];for(const s of this.asn)for(const i of s)i.type===t&&n.push(i.value.toString());return n}getName(e){return this.extraNames.get(e)||ks.get(e)}toString(){return this.asn.map(e=>e.map(t=>{const n=this.getName(t.type)||t.type,s=t.value.anyValue?`#${Te.ToHex(t.value.anyValue)}`:YTe(t.value.toString());return`${n}=${s}`}).join("+")).join(", ")}toJSON(){var e;const t=[];for(const n of this.asn){const s={};for(const i of n){const o=this.getName(i.type)||i.type;(e=s[o])!==null&&e!==void 0||(s[o]=[]),s[o].push(i.value.anyValue?`#${Te.ToHex(i.value.anyValue)}`:i.value.toString())}t.push(s)}return t}fromString(e){const t=new fr,n=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g;let s=null,i=",";for(;s=n.exec(`${e},`);){let[,o,a]=s;const c=a[a.length-1];(c===","||c==="+")&&(a=a.slice(0,a.length-1),s[3]=c);const l=s[3];o=this.getTypeOid(o);const u=this.createAttribute(o,a);i==="+"?t[t.length-1].push(u):t.push(new x1([u])),i=l}return t}fromJSON(e){const t=new fr;for(const n of e){const s=new x1;for(const i in n){const o=this.getTypeOid(i),a=n[i];for(const c of a){const l=this.createAttribute(o,c);s.push(l)}}t.push(s)}return t}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,t){const n=new Wv({type:e});if(typeof t=="object")for(const s in t)switch(s){case"ia5String":n.value.ia5String=t[s];break;case"utf8String":n.value.utf8String=t[s];break;case"universalString":n.value.universalString=t[s];break;case"bmpString":n.value.bmpString=t[s];break;case"printableString":n.value.printableString=t[s];break}else if(t[0]==="#")n.value.anyValue=Te.FromHex(t.slice(1));else{const s=this.processStringValue(t);e===this.getName("E")||e===this.getName("DC")?n.value.ia5String=s:Ri.isPrintableString(s)?n.value.printableString=s:n.value.utf8String=s}return n}processStringValue(e){const t=/"(.*?[^\\])?"/.exec(e);return t&&(e=t[1]),e.replace(/\\0a/ig,`
`).replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return pe.serialize(this.asn)}async getThumbprint(...e){var t;let n,s="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(s=e[0]||s,n=e[1]||Kr.get()):n=e[0]||Kr.get(),await n.subtle.digest(s,this.toArrayBuffer())}}const LZ="Cannot initialize GeneralName from ASN.1 data.",yU=`${LZ} Unsupported string format in use.`,XTe=`${LZ} Value doesn't match to GUID regular expression.`,mU=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,wU="1.3.6.1.4.1.311.25.1",bU="1.3.6.1.4.1.311.20.2.3",TE="dns",_E="dn",PE="email",NE="ip",DE="url",OE="guid",RE="upn",w3="id";class gu extends uh{constructor(...e){let t;if(e.length===2)switch(e[0]){case _E:{const n=new Ri(e[1]).toArrayBuffer(),s=pe.parse(n,fr);t=new Ke({directoryName:s});break}case TE:t=new Ke({dNSName:e[1]});break;case PE:t=new Ke({rfc822Name:e[1]});break;case OE:{const n=new RegExp(mU,"i").exec(e[1]);if(!n)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");const s=n.slice(1).map((i,o)=>o<3?Te.ToHex(new Uint8Array(Te.FromHex(i)).reverse()):i).join("");t=new Ke({otherName:new By({typeId:wU,value:pe.serialize(new ut(Te.FromHex(s)))})});break}case NE:t=new Ke({iPAddress:e[1]});break;case w3:t=new Ke({registeredID:e[1]});break;case RE:{t=new Ke({otherName:new By({typeId:bU,value:pe.serialize(tZ.toASN(e[1]))})});break}case DE:t=new Ke({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else me.isBufferSource(e[0])?t=pe.parse(e[0],Ke):t=e[0];super(t)}onInit(e){if(e.dNSName!=null)this.type=TE,this.value=e.dNSName;else if(e.rfc822Name!=null)this.type=PE,this.value=e.rfc822Name;else if(e.iPAddress!=null)this.type=NE,this.value=e.iPAddress;else if(e.uniformResourceIdentifier!=null)this.type=DE,this.value=e.uniformResourceIdentifier;else if(e.registeredID!=null)this.type=w3,this.value=e.registeredID;else if(e.directoryName!=null)this.type=_E,this.value=new Ri(e.directoryName).toString();else if(e.otherName!=null)if(e.otherName.typeId===wU){this.type=OE;const t=pe.parse(e.otherName.value,ut),n=new RegExp(mU,"i").exec(Te.ToHex(t));if(!n)throw new Error(XTe);this.value=n.slice(1).map((s,i)=>i<3?Te.ToHex(new Uint8Array(Te.FromHex(s)).reverse()):s).join("-")}else if(e.otherName.typeId===bU)this.type=RE,this.value=pe.parse(e.otherName.value,en).toString();else throw new Error(yU);else throw new Error(yU)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case _E:case TE:case OE:case NE:case w3:case RE:case DE:e=this.type.toUpperCase();break;case PE:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let t=this.value;return this.type===w3&&(t=lh.toString(t)),new yt(e,void 0,t)}}class Hy extends uh{constructor(e){let t;if(e instanceof Qn)t=e;else if(Array.isArray(e)){const n=[];for(const s of e)if(s instanceof Ke)n.push(s);else{const i=pe.parse(new gu(s.type,s.value).rawData,Ke);n.push(i)}t=new Qn(n)}else if(me.isBufferSource(e))t=pe.parse(e,Qn);else throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(t)}onInit(e){const t=[];for(const n of e){let s=null;try{s=new gu(n)}catch{continue}t.push(s)}this.items=t}toJSON(){return this.items.map(e=>e.toJSON())}toTextObject(){const e=super.toTextObjectEmpty();for(const t of this.items){const n=t.toTextObject();let s=e[n[yt.NAME]];Array.isArray(s)||(s=[],e[n[yt.NAME]]=s),s.push(n)}return e}}Hy.NAME="GeneralNames";const z2="-{5}",Ky="\\n",ZTe=`[^${Ky}]+`,e_e=`${z2}BEGIN (${ZTe}(?=${z2}))${z2}`,t_e=`${z2}END \\1${z2}`,P1="\\n",r_e=`[^:${Ky}]+`,n_e=`(?:[^${Ky}]+${P1}(?: +[^${Ky}]+${P1})*)`,s_e="[a-zA-Z0-9=+/]+",i_e=`(?:${s_e}${P1})+`,vU=`${e_e}${P1}(?:((?:${r_e}: ${n_e})+))?${P1}?(${i_e})${t_e}`;class qs{static isPem(e){return typeof e=="string"&&new RegExp(vU,"g").test(e)}static decodeWithHeaders(e){e=e.replace(/\r/g,"");const t=new RegExp(vU,"g"),n=[];let s=null;for(;s=t.exec(e);){const i=s[3].replace(new RegExp(`[${Ky}]+`,"g"),""),o={type:s[1],headers:[],rawData:Te.FromBase64(i)},a=s[2];if(a){const c=a.split(new RegExp(P1,"g"));let l=null;for(const u of c){const[d,p]=u.split(/:(.*)/);if(p===void 0){if(!l)throw new Error("Cannot parse PEM string. Incorrect header value");l.value+=d.trim()}else l&&o.headers.push(l),l={key:d,value:p.trim()}}l&&o.headers.push(l)}n.push(o)}return n}static decode(e){return this.decodeWithHeaders(e).map(n=>n.rawData)}static decodeFirst(e){const t=this.decode(e);if(!t.length)throw new RangeError("PEM string doesn't contain any objects");return t[0]}static encode(e,t){if(Array.isArray(e)){const n=new Array;return t?e.forEach(s=>{if(!me.isBufferSource(s))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");n.push(this.encodeStruct({type:t,rawData:me.toArrayBuffer(s)}))}):e.forEach(s=>{if(!("type"in s))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");n.push(this.encodeStruct(s))}),n.join(`
`)}else{if(!t)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:t,rawData:me.toArrayBuffer(e)})}}static encodeStruct(e){var t;const n=e.type.toLocaleUpperCase(),s=[];if(s.push(`-----BEGIN ${n}-----`),!((t=e.headers)===null||t===void 0)&&t.length){for(const l of e.headers)s.push(`${l.key}: ${l.value}`);s.push("")}const i=Te.ToBase64(e.rawData);let o,a=0;const c=Array();for(;a<i.length&&(i.length-a<64?o=i.substring(a):(o=i.substring(a,a+64),a+=64),o.length!==0);)if(c.push(o),o.length<64)break;return s.push(...c),s.push(`-----END ${n}-----`),s.join(`
`)}}qs.CertificateTag="CERTIFICATE";qs.CrlTag="CRL";qs.CertificateRequestTag="CERTIFICATE REQUEST";qs.PublicKeyTag="PUBLIC KEY";qs.PrivateKeyTag="PRIVATE KEY";class Uc extends uh{static isAsnEncoded(e){return me.isBufferSource(e)||typeof e=="string"}static toArrayBuffer(e){if(typeof e=="string"){if(qs.isPem(e))return qs.decode(e)[0];if(Te.isHex(e))return Te.FromHex(e);if(Te.isBase64(e))return Te.FromBase64(e);if(Te.isBase64Url(e))return Te.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}else{const t=Te.ToBinary(e);return qs.isPem(t)?qs.decode(t)[0]:Te.isHex(t)?Te.FromHex(t):Te.isBase64(t)?Te.FromBase64(t):Te.isBase64Url(t)?Te.FromBase64Url(t):me.toArrayBuffer(e)}}constructor(...e){Uc.isAsnEncoded(e[0])?super(Uc.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){switch(e){case"pem":return qs.encode(this.rawData,this.tag);default:return super.toString(e)}}}class Ao extends Uc{static async create(e,t=Kr.get()){if(e instanceof Ao)return e;if(pu.isCryptoKey(e)){if(e.type!=="public")throw new TypeError("Public key is required");const n=await t.subtle.exportKey("spki",e);return new Ao(n)}else{if(e.publicKey)return e.publicKey;if(me.isBufferSource(e))return new Ao(e);throw new TypeError("Unsupported PublicKeyType")}}constructor(e){Uc.isAsnEncoded(e)?super(e,wo):super(e),this.tag=qs.PublicKeyTag}async export(...e){let t,n=["verify"],s={hash:"SHA-256",...this.algorithm};e.length>1?(s=e[0]||s,n=e[1]||n,t=e[2]||Kr.get()):t=e[0]||Kr.get();let i=this.rawData;const o=pe.parse(this.rawData,wo);return o.algorithm.algorithm===F2&&(i=o_e(o,i)),t.subtle.importKey("spki",i,s,!0,n)}onInit(e){const t=tn.resolve(lf),n=this.algorithm=t.toWebAlgorithm(e.algorithm);switch(e.algorithm.algorithm){case of:{const s=pe.parse(e.subjectPublicKey,dN),i=me.toUint8Array(s.modulus);n.publicExponent=me.toUint8Array(s.publicExponent),n.modulusLength=(i[0]?i:i.slice(1)).byteLength<<3;break}}}async getThumbprint(...e){var t;let n,s="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(s=e[0]||s,n=e[1]||Kr.get()):n=e[0]||Kr.get(),await n.subtle.digest(s,this.rawData)}async getKeyIdentifier(...e){let t,n="SHA-1";e.length===1?typeof e[0]=="string"?(n=e[0],t=Kr.get()):t=e[0]:e.length===2?(n=e[0],t=e[1]):t=Kr.get();const s=pe.parse(this.rawData,wo);return await t.subtle.digest(n,s.subjectPublicKey)}toTextObject(){const e=this.toTextObjectEmpty(),t=pe.parse(this.rawData,wo);switch(e.Algorithm=uf.serializeAlgorithm(t.algorithm),t.algorithm.algorithm){case Uy:e["EC Point"]=t.subjectPublicKey;break;case of:default:e["Raw Data"]=t.subjectPublicKey}return e}}function o_e(r,e){return r.algorithm=new Ee({algorithm:of,parameters:null}),e=pe.serialize(r),e}class Gy extends Gi{static async create(e,t=!1,n=Kr.get()){if("name"in e&&"serialNumber"in e)return new Gy(e,t);const i=await(await Ao.create(e,n)).getKeyIdentifier(n);return new Gy(Te.ToHex(i),t)}constructor(...e){if(me.isBufferSource(e[0]))super(e[0]);else if(typeof e[0]=="string"){const t=new qh({keyIdentifier:new qP(Te.FromHex(e[0]))});super(IC,e[1],pe.serialize(t))}else{const t=e[0],n=t.name instanceof Hy?pe.parse(t.name.rawData,Qn):t.name,s=new qh({authorityCertIssuer:n,authorityCertSerialNumber:Te.FromHex(t.serialNumber)});super(IC,e[1],pe.serialize(s))}}onInit(e){super.onInit(e);const t=pe.parse(e.extnValue,qh);t.keyIdentifier&&(this.keyId=Te.ToHex(t.keyIdentifier)),(t.authorityCertIssuer||t.authorityCertSerialNumber)&&(this.certId={name:t.authorityCertIssuer||[],serialNumber:t.authorityCertSerialNumber?Te.ToHex(t.authorityCertSerialNumber):""})}toTextObject(){const e=this.toTextObjectWithoutValue(),t=pe.parse(this.value,qh);return t.authorityCertIssuer&&(e["Authority Issuer"]=new Hy(t.authorityCertIssuer).toTextObject()),t.authorityCertSerialNumber&&(e["Authority Serial Number"]=t.authorityCertSerialNumber),t.keyIdentifier&&(e[""]=t.keyIdentifier),e}}Gy.NAME="Authority Key Identifier";class yN extends Gi{constructor(...e){if(me.isBufferSource(e[0])){super(e[0]);const t=pe.parse(this.value,Wb);this.ca=t.cA,this.pathLength=t.pathLenConstraint}else{const t=new Wb({cA:e[0],pathLenConstraint:e[1]});super(nZ,e[2],pe.serialize(t)),this.ca=e[0],this.pathLength=e[1]}}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ca&&(e.CA=this.ca),this.pathLength!==void 0&&(e["Path Length"]=this.pathLength),e}}yN.NAME="Basic Constraints";var EU;(function(r){r.serverAuth="1.3.6.1.5.5.7.3.1",r.clientAuth="1.3.6.1.5.5.7.3.2",r.codeSigning="1.3.6.1.5.5.7.3.3",r.emailProtection="1.3.6.1.5.5.7.3.4",r.timeStamping="1.3.6.1.5.5.7.3.8",r.ocspSigning="1.3.6.1.5.5.7.3.9"})(EU||(EU={}));class UZ extends Gi{constructor(...e){if(me.isBufferSource(e[0])){super(e[0]);const t=pe.parse(this.value,Xb);this.usages=t.map(n=>n)}else{const t=new Xb(e[0]);super(oZ,e[1],pe.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.usages.map(t=>lh.toString(t)).join(", "),e}}UZ.NAME="Extended Key Usages";var xU;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(xU||(xU={}));class FZ extends Gi{constructor(...e){if(me.isBufferSource(e[0])){super(e[0]);const t=pe.parse(this.value,kE);this.usages=t.toNumber()}else{const t=new kE(e[0]);super(aZ,e[1],pe.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=pe.parse(this.value,kE);return e[""]=t.toJSON().join(", "),e}}FZ.NAME="Key Usages";class b7 extends Gi{static async create(e,t=!1,n=Kr.get()){const i=await(await Ao.create(e,n)).getKeyIdentifier(n);return new b7(Te.ToHex(i),t)}constructor(...e){if(me.isBufferSource(e[0])){super(e[0]);const t=pe.parse(this.value,Nu);this.keyId=Te.ToHex(t)}else{const t=typeof e[0]=="string"?Te.FromHex(e[0]):e[0],n=new Nu(t);super(hZ,e[1],pe.serialize(n)),this.keyId=Te.ToHex(t)}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=pe.parse(this.value,Nu);return e[""]=t,e}}b7.NAME="Subject Key Identifier";class zZ extends Gi{constructor(...e){me.isBufferSource(e[0])?super(e[0]):super(uZ,e[1],new Hy(e[0]||[]).rawData)}onInit(e){super.onInit(e);const t=pe.parse(e.extnValue,zC);this.names=new Hy(t)}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.names.toTextObject();for(const n in t)e[n]=t[n];return e}}zZ.NAME="Subject Alternative Name";class ji{static register(e,t){this.items.set(e,t)}static create(e){const t=new Gi(e),n=this.items.get(t.type);return n?new n(e):t}}ji.items=new Map;class VZ extends Gi{constructor(...e){var t;if(me.isBufferSource(e[0])){super(e[0]);const n=pe.parse(this.value,Jb);this.policies=n.map(s=>s.policyIdentifier)}else{const n=e[0],s=(t=e[1])!==null&&t!==void 0?t:!1,i=new Jb(n.map(o=>new Jv({policyIdentifier:o})));super(sZ,s,pe.serialize(i)),this.policies=n}}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Policy=this.policies.map(t=>new yt("",{},lh.toString(t))),e}}VZ.NAME="Certificate Policies";ji.register(sZ,VZ);class HZ extends Gi{constructor(...e){var t;if(me.isBufferSource(e[0]))super(e[0]);else if(Array.isArray(e[0])&&typeof e[0][0]=="string"){const s=e[0].map(o=>new sg({distributionPoint:new tf({fullName:[new Ke({uniformResourceIdentifier:o})]})})),i=new Vp(s);super(NC,e[1],pe.serialize(i))}else{const n=new Vp(e[0]);super(NC,e[1],pe.serialize(n))}(t=this.distributionPoints)!==null&&t!==void 0||(this.distributionPoints=[])}onInit(e){super.onInit(e);const t=pe.parse(e.extnValue,Vp);this.distributionPoints=t}toTextObject(){const e=this.toTextObjectWithoutValue();return e["Distribution Point"]=this.distributionPoints.map(t=>{var n;const s={};return t.distributionPoint&&(s[""]=(n=t.distributionPoint.fullName)===null||n===void 0?void 0:n.map(i=>new gu(i).toString()).join(", ")),t.reasons&&(s.Reasons=t.reasons.toString()),t.cRLIssuer&&(s["CRL Issuer"]=t.cRLIssuer.map(i=>i.toString()).join(", ")),s}),e}}HZ.NAME="CRL Distribution Points";class KZ extends Gi{constructor(...e){var t,n,s,i;if(me.isBufferSource(e[0]))super(e[0]);else if(e[0]instanceof wp){const o=new wp(e[0]);super(CC,e[1],pe.serialize(o))}else{const o=e[0],a=new wp;v3(a,o,iL,"ocsp"),v3(a,o,oL,"caIssuers"),v3(a,o,aL,"timeStamping"),v3(a,o,cL,"caRepository"),super(CC,e[1],pe.serialize(a))}(t=this.ocsp)!==null&&t!==void 0||(this.ocsp=[]),(n=this.caIssuers)!==null&&n!==void 0||(this.caIssuers=[]),(s=this.timeStamping)!==null&&s!==void 0||(this.timeStamping=[]),(i=this.caRepository)!==null&&i!==void 0||(this.caRepository=[])}onInit(e){super.onInit(e),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],pe.parse(e.extnValue,wp).forEach(n=>{switch(n.accessMethod){case iL:this.ocsp.push(new gu(n.accessLocation));break;case oL:this.caIssuers.push(new gu(n.accessLocation));break;case aL:this.timeStamping.push(new gu(n.accessLocation));break;case cL:this.caRepository.push(new gu(n.accessLocation));break}})}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ocsp.length&&b3(e,"OCSP",this.ocsp),this.caIssuers.length&&b3(e,"CA Issuers",this.caIssuers),this.timeStamping.length&&b3(e,"Time Stamping",this.timeStamping),this.caRepository.length&&b3(e,"CA Repository",this.caRepository),e}}KZ.NAME="Authority Info Access";function b3(r,e,t){if(t.length===1)r[e]=t[0].toTextObject();else{const n=new yt("");t.forEach((s,i)=>{const o=s.toTextObject(),a=`${o[yt.NAME]} ${i+1}`;let c=n[a];Array.isArray(c)||(c=[],n[a]=c),c.push(o)}),r[e]=n}}function v3(r,e,t,n){const s=e[n];s&&(Array.isArray(s)?s:[s]).forEach(o=>{typeof o=="string"&&(o=new gu("url",o)),r.push(new Jm({accessMethod:t,accessLocation:pe.parse(o.rawData,Ke)}))})}class hg extends uh{constructor(...e){let t;if(me.isBufferSource(e[0]))t=me.toArrayBuffer(e[0]);else{const n=e[0],s=Array.isArray(e[1])?e[1].map(i=>me.toArrayBuffer(i)):[];t=pe.serialize(new Mc({type:n,values:s}))}super(t,Mc)}onInit(e){this.type=e.type,this.values=e.values}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Value=this.values.map(t=>new yt("",{"":t})),e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty();return e[yt.NAME]===hg.NAME&&(e[yt.NAME]=lh.toString(this.type)),e}}hg.NAME="Attribute";class GZ extends hg{constructor(...e){var t;if(me.isBufferSource(e[0]))super(e[0]);else{const n=new x6({printableString:e[0]});super(OZ,[pe.serialize(n)])}(t=this.password)!==null&&t!==void 0||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){const t=pe.parse(this.values[0],x6);this.password=t.toString()}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[yt.VALUE]=this.password,e}}GZ.NAME="Challenge Password";class mN extends hg{constructor(...e){var t;if(me.isBufferSource(e[0]))super(e[0]);else{const n=e[0],s=new qu;for(const i of n)s.push(pe.parse(i.rawData,zi));super(gN,[pe.serialize(s)])}(t=this.items)!==null&&t!==void 0||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){const t=pe.parse(this.values[0],qu);this.items=t.map(n=>ji.create(pe.serialize(n)))}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.items.map(n=>n.toTextObject());for(const n of t)e[n[yt.NAME]]=n;return e}}mN.NAME="Extensions";class v7{static register(e,t){this.items.set(e,t)}static create(e){const t=new hg(e),n=this.items.get(t.type);return n?new n(e):t}}v7.items=new Map;const lw="crypto.signatureFormatter";class a_e{toAsnSignature(e,t){return me.toArrayBuffer(t)}toWebSignature(e,t){return me.toArrayBuffer(t)}}var A4;let NI=A4=class{static createPssParams(e,t){const n=A4.getHashAlgorithm(e);return n?new cf({hashAlgorithm:n,maskGenAlgorithm:new Ee({algorithm:u7,parameters:pe.serialize(n)}),saltLength:t}):null}static getHashAlgorithm(e){const t=tn.resolve(lf);return typeof e=="string"?t.toAsnAlgorithm({name:e}):typeof e=="object"&&e&&"name"in e?t.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if("hash"in e){let t;if(typeof e.hash=="string")t=e.hash;else if(e.hash&&typeof e.hash=="object"&&"name"in e.hash&&typeof e.hash.name=="string")t=e.hash.name.toUpperCase();else throw new Error("Cannot get hash algorithm name");switch(t.toLowerCase()){case"sha-1":return new Ee({algorithm:d6,parameters:null});case"sha-256":return new Ee({algorithm:cI,parameters:null});case"sha-384":return new Ee({algorithm:f6,parameters:null});case"sha-512":return new Ee({algorithm:p6,parameters:null})}}else return new Ee({algorithm:of,parameters:null});break;case"rsa-pss":if("hash"in e){if(!("saltLength"in e&&typeof e.saltLength=="number"))throw new Error("Cannot get 'saltLength' from 'alg' argument");const t=A4.createPssParams(e.hash,e.saltLength);if(!t)throw new Error("Cannot create PSS parameters");return new Ee({algorithm:F2,parameters:pe.serialize(t)})}else return new Ee({algorithm:F2,parameters:null})}return null}toWebAlgorithm(e){switch(e.algorithm){case of:return{name:"RSASSA-PKCS1-v1_5"};case d6:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case cI:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case f6:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case p6:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case F2:if(e.parameters){const t=pe.parse(e.parameters,cf);return{name:"RSA-PSS",hash:tn.resolve(lf).toWebAlgorithm(t.hashAlgorithm),saltLength:t.saltLength}}else return{name:"RSA-PSS"}}return null}};NI=A4=_([p7()],NI);tn.registerSingleton(cw,NI);let DI=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new Ee({algorithm:g6});case"sha-256":return new Ee({algorithm:y6});case"sha-384":return new Ee({algorithm:m6});case"sha-512":return new Ee({algorithm:w6})}return null}toWebAlgorithm(e){switch(e.algorithm){case g6:return{name:"SHA-1"};case y6:return{name:"SHA-256"};case m6:return{name:"SHA-384"};case w6:return{name:"SHA-512"}}return null}};DI=_([p7()],DI);tn.registerSingleton(cw,DI);class Bi{addPadding(e,t){const n=me.toUint8Array(t),s=new Uint8Array(e);return s.set(n,e-n.length),s}removePadding(e,t=!1){let n=me.toUint8Array(e);for(let s=0;s<n.length;s++)if(n[s]){n=n.slice(s);break}if(t&&n[0]>127){const s=new Uint8Array(n.length+1);return s.set(n,1),s.buffer}return n.buffer}toAsnSignature(e,t){if(e.name==="ECDSA"){const n=e.namedCurve,s=Bi.namedCurveSize.get(n)||Bi.defaultNamedCurveSize,i=new h6,o=me.toUint8Array(t);return i.r=this.removePadding(o.slice(0,s),!0),i.s=this.removePadding(o.slice(s,s+s),!0),pe.serialize(i)}return null}toWebSignature(e,t){if(e.name==="ECDSA"){const n=pe.parse(t,h6),s=e.namedCurve,i=Bi.namedCurveSize.get(s)||Bi.defaultNamedCurveSize,o=this.addPadding(i,this.removePadding(n.r)),a=this.addPadding(i,this.removePadding(n.s));return QCe(o,a)}return null}}Bi.namedCurveSize=new Map;Bi.defaultNamedCurveSize=32;const BE="1.3.101.110",AU="1.3.101.111",ME="1.3.101.112",SU="1.3.101.113";let OI=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"ed25519":t=ME;break;case"x25519":t=BE;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t=ME;break;case"ed448":t=SU;break}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t=BE;break;case"x448":t=AU;break}}return t?new Ee({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case ME:return{name:"Ed25519"};case SU:return{name:"EdDSA",namedCurve:"Ed448"};case BE:return{name:"X25519"};case AU:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};OI=_([p7()],OI);tn.registerSingleton(cw,OI);class c_e extends Uc{constructor(e){Uc.isAsnEncoded(e)?super(e,zy):super(e),this.tag=qs.CertificateRequestTag}onInit(e){this.tbs=pe.serialize(e.certificationRequestInfo),this.publicKey=new Ao(e.certificationRequestInfo.subjectPKInfo);const t=tn.resolve(lf);this.signatureAlgorithm=t.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signature,this.attributes=e.certificationRequestInfo.attributes.map(s=>v7.create(pe.serialize(s)));const n=this.getAttribute(gN);this.extensions=[],n instanceof mN&&(this.extensions=n.items),this.subjectName=new Ri(e.certificationRequestInfo.subject),this.subject=this.subjectName.toString()}getAttribute(e){for(const t of this.attributes)if(t.type===e)return t;return null}getAttributes(e){return this.attributes.filter(t=>t.type===e)}getExtension(e){for(const t of this.extensions)if(t.type===e)return t;return null}getExtensions(e){return this.extensions.filter(t=>t.type===e)}async verify(e=Kr.get()){const t={...this.publicKey.algorithm,...this.signatureAlgorithm},n=await this.publicKey.export(t,["verify"],e),s=tn.resolveAll(lw).reverse();let i=null;for(const a of s)if(i=a.toWebSignature(t,this.signature),i)break;if(!i)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await e.subtle.verify(this.signatureAlgorithm,n,i,this.tbs)}toTextObject(){const e=this.toTextObjectEmpty(),t=pe.parse(this.rawData,zy),n=t.certificationRequestInfo,s=new yt("",{Version:`${rf[n.version]} (${n.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){const i=new yt("");for(const o of this.attributes){const a=o.toTextObject();i[a[yt.NAME]]=a}s.Attributes=i}return e.Data=s,e.Signature=new yt("",{Algorithm:uf.serializeAlgorithm(t.signatureAlgorithm),"":t.signature}),e}}c_e.NAME="PKCS#10 Certificate Request";class wN extends Uc{constructor(e){Uc.isAsnEncoded(e)?super(e,nf):super(e),this.tag=qs.CertificateTag}onInit(e){const t=e.tbsCertificate;this.tbs=pe.serialize(t),this.serialNumber=Te.ToHex(t.serialNumber),this.subjectName=new Ri(t.subject),this.subject=new Ri(t.subject).toString(),this.issuerName=new Ri(t.issuer),this.issuer=this.issuerName.toString();const n=tn.resolve(lf);this.signatureAlgorithm=n.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signatureValue;const s=t.validity.notBefore.utcTime||t.validity.notBefore.generalTime;if(!s)throw new Error("Cannot get 'notBefore' value");this.notBefore=s;const i=t.validity.notAfter.utcTime||t.validity.notAfter.generalTime;if(!i)throw new Error("Cannot get 'notAfter' value");this.notAfter=i,this.extensions=[],t.extensions&&(this.extensions=t.extensions.map(o=>ji.create(pe.serialize(o)))),this.publicKey=new Ao(t.subjectPublicKeyInfo)}getExtension(e){for(const t of this.extensions)if(typeof e=="string"){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter(t=>typeof e=="string"?t.type===e:t instanceof e)}async verify(e={},t=Kr.get()){let n,s;const i=e.publicKey;try{if(!i)n={...this.publicKey.algorithm,...this.signatureAlgorithm},s=await this.publicKey.export(n,["verify"],t);else if("publicKey"in i)n={...i.publicKey.algorithm,...this.signatureAlgorithm},s=await i.publicKey.export(n,["verify"],t);else if(i instanceof Ao)n={...i.algorithm,...this.signatureAlgorithm},s=await i.export(n,["verify"],t);else if(me.isBufferSource(i)){const l=new Ao(i);n={...l.algorithm,...this.signatureAlgorithm},s=await l.export(n,["verify"],t)}else n={...i.algorithm,...this.signatureAlgorithm},s=i}catch{return!1}const o=tn.resolveAll(lw).reverse();let a=null;for(const l of o)if(a=l.toWebSignature(n,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");const c=await t.subtle.verify(this.signatureAlgorithm,s,a,this.tbs);if(e.signatureOnly)return c;{const u=(e.date||new Date).getTime();return c&&this.notBefore.getTime()<u&&u<this.notAfter.getTime()}}async getThumbprint(...e){let t,n="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(n=e[0]||n,t=e[1])),t??(t=Kr.get()),await t.subtle.digest(n,this.rawData)}async isSelfSigned(e=Kr.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},e)}toTextObject(){const e=this.toTextObjectEmpty(),t=pe.parse(this.rawData,nf),n=t.tbsCertificate,s=new yt("",{Version:`${rf[n.version]} (${n.version})`,"Serial Number":n.serialNumber,"Signature Algorithm":uf.serializeAlgorithm(n.signature),Issuer:this.issuer,Validity:new yt("",{"Not Before":n.validity.notBefore.getTime(),"Not After":n.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(n.issuerUniqueID&&(s["Issuer Unique ID"]=n.issuerUniqueID),n.subjectUniqueID&&(s["Subject Unique ID"]=n.subjectUniqueID),this.extensions.length){const i=new yt("");for(const o of this.extensions){const a=o.toTextObject();i[a[yt.NAME]]=a}s.Extensions=i}return e.Data=s,e.Signature=new yt("",{Algorithm:uf.serializeAlgorithm(t.signatureAlgorithm),"":t.signatureValue}),e}}wN.NAME="Certificate";class l_e{static async createSelfSigned(e,t=Kr.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},t)}static async create(e,t=Kr.get()){var n;let s;e.publicKey instanceof Ao?s=e.publicKey.rawData:"publicKey"in e.publicKey?s=e.publicKey.publicKey.rawData:me.isBufferSource(e.publicKey)?s=e.publicKey:s=await t.subtle.exportKey("spki",e.publicKey);const i=e.serialNumber?me.toUint8Array(Te.FromHex(e.serialNumber)):t.getRandomValues(new Uint8Array(16));i[0]>127&&(i[0]&=127),i.length>1&&i[0]===0&&(i[1]|=128);const o=e.notBefore||new Date,a=e.notAfter||new Date(o.getTime()+31536e6),c=new nf({tbsCertificate:new ci({version:rf.v3,serialNumber:i,validity:new Ym({notBefore:o,notAfter:a}),extensions:new qu(((n=e.extensions)===null||n===void 0?void 0:n.map(w=>pe.parse(w.rawData,zi)))||[]),subjectPublicKeyInfo:pe.parse(s,wo)})});if(e.subject){const w=e.subject instanceof Ri?e.subject:new Ri(e.subject);c.tbsCertificate.subject=pe.parse(w.toArrayBuffer(),fr)}if(e.issuer){const w=e.issuer instanceof Ri?e.issuer:new Ri(e.issuer);c.tbsCertificate.issuer=pe.parse(w.toArrayBuffer(),fr)}const l={hash:"SHA-256"},u="signingKey"in e?{...l,...e.signingAlgorithm,...e.signingKey.algorithm}:{...l,...e.signingAlgorithm},d=tn.resolve(lf);c.tbsCertificate.signature=c.signatureAlgorithm=d.toAsnAlgorithm(u);const p=pe.serialize(c.tbsCertificate),y="signingKey"in e?await t.subtle.sign(u,e.signingKey,p):e.signature,f=tn.resolveAll(lw).reverse();let g=null;for(const w of f)if(g=w.toAsnSignature(u,y),g)break;if(!g)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return c.signatureValue=g,new wN(pe.serialize(c))}}var CU;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(CU||(CU={}));ji.register(nZ,yN);ji.register(oZ,UZ);ji.register(aZ,FZ);ji.register(hZ,b7);ji.register(IC,Gy);ji.register(uZ,zZ);ji.register(NC,HZ);ji.register(CC,KZ);v7.register(OZ,GZ);v7.register(gN,mN);tn.registerSingleton(lw,a_e);tn.registerSingleton(lw,Bi);Bi.namedCurveSize.set("P-256",32);Bi.namedCurveSize.set("K-256",32);Bi.namedCurveSize.set("P-384",48);Bi.namedCurveSize.set("P-521",66);function jZ(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function u_e(r){return new TextEncoder().encode(r)}function h_e(r){return new TextDecoder().decode(r)}function d_e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var f_e=d_e,p_e=f_e;let g_e=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},y_e=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return qZ(this,e)}},m_e=class{constructor(e){h(this,"decoders");this.decoders=e}or(e){return qZ(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function qZ(r,e){return new m_e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let w_e=class{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new g_e(e,t,n),this.decoder=new y_e(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function E7({name:r,prefix:e,encode:t,decode:n}){return new w_e(r,e,t,n)}function uw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=p_e(t,r);return E7({prefix:e,name:r,encode:n,decode:i=>jZ(s(i))})}function b_e(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function v_e(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function sn({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return E7({prefix:e,name:r,encode(s){return v_e(s,n,t)},decode(s){return b_e(s,n,t,r)}})}const E_e=sn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),x_e=sn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),bN=sn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),A_e=sn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),S_e=Object.freeze(Object.defineProperty({__proto__:null,base64:E_e,base64pad:x_e,base64url:bN,base64urlpad:A_e},Symbol.toStringTag,{value:"Module"}));var C_e=WZ,IU=128,I_e=-128,k_e=Math.pow(2,31);function WZ(r,e,t){e=e||[],t=t||0;for(var n=t;r>=k_e;)e[t++]=r&255|IU,r/=128;for(;r&I_e;)e[t++]=r&255|IU,r>>>=7;return e[t]=r|0,WZ.bytes=t-n+1,e}var T_e=RI,__e=128,kU=127;function RI(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw RI.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&kU)<<s:(o&kU)*Math.pow(2,s),s+=7}while(o>=__e);return RI.bytes=i-n,t}var P_e=Math.pow(2,7),N_e=Math.pow(2,14),D_e=Math.pow(2,21),O_e=Math.pow(2,28),R_e=Math.pow(2,35),B_e=Math.pow(2,42),M_e=Math.pow(2,49),$_e=Math.pow(2,56),L_e=Math.pow(2,63),U_e=function(r){return r<P_e?1:r<N_e?2:r<D_e?3:r<O_e?4:r<R_e?5:r<B_e?6:r<M_e?7:r<$_e?8:r<L_e?9:10},F_e={encode:C_e,decode:T_e,encodingLength:U_e},S6=F_e;function TU(r,e=0){return[S6.decode(r,e),S6.decode.bytes]}function _U(r,e,t=0){return S6.encode(r,e,t),e}function PU(r){return S6.encodingLength(r)}function C6(r,e){const t=e.byteLength,n=PU(r),s=n+PU(t),i=new Uint8Array(s+t);return _U(r,i,0),_U(t,i,n),i.set(e,s),new QZ(r,t,e,i)}function z_e(r){const e=jZ(r),[t,n]=TU(e),[s,i]=TU(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new QZ(t,s,o,e)}let QZ=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function V_e({name:r,code:e,encode:t}){return new H_e(r,e,t)}let H_e=class{constructor(e,t,n){h(this,"name");h(this,"code");h(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?C6(this.code,t):t.then(n=>C6(this.code,n))}else throw Error("Unknown type, must be binary type")}};function K_e(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const vN=V_e({name:"sha2-256",code:18,encode:K_e("SHA-256")});class G_e extends Er{async listen(){throw new Pke("WebRTCTransport.createListener")}getAddrs(){return[]}updateAnnounceAddrs(){}async close(){}}const j_e=uw({prefix:"9",name:"base10",alphabet:"0123456789"}),q_e=Object.freeze(Object.defineProperty({__proto__:null,base10:j_e},Symbol.toStringTag,{value:"Module"})),W_e=sn({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Q_e=sn({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),J_e=Object.freeze(Object.defineProperty({__proto__:null,base16:W_e,base16upper:Q_e},Symbol.toStringTag,{value:"Module"})),Y_e=sn({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),X_e=Object.freeze(Object.defineProperty({__proto__:null,base2:Y_e},Symbol.toStringTag,{value:"Module"})),JZ=Array.from(""),Z_e=JZ.reduce((r,e,t)=>(r[t]=e,r),[]),ePe=JZ.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function tPe(r){return r.reduce((e,t)=>(e+=Z_e[t],e),"")}function rPe(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const s=ePe[n];if(s==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}const nPe=E7({prefix:"",name:"base256emoji",encode:tPe,decode:rPe}),sPe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:nPe},Symbol.toStringTag,{value:"Module"})),iPe=sn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),oPe=sn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),aPe=sn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),cPe=sn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),lPe=sn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),uPe=sn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),hPe=sn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),dPe=sn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),fPe=sn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),pPe=Object.freeze(Object.defineProperty({__proto__:null,base32:iPe,base32hex:lPe,base32hexpad:hPe,base32hexpadupper:dPe,base32hexupper:uPe,base32pad:aPe,base32padupper:cPe,base32upper:oPe,base32z:fPe},Symbol.toStringTag,{value:"Module"})),gPe=uw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),yPe=uw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),mPe=Object.freeze(Object.defineProperty({__proto__:null,base36:gPe,base36upper:yPe},Symbol.toStringTag,{value:"Module"})),wPe=uw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),bPe=uw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),vPe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:wPe,base58flickr:bPe},Symbol.toStringTag,{value:"Module"})),EPe=sn({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),xPe=Object.freeze(Object.defineProperty({__proto__:null,base8:EPe},Symbol.toStringTag,{value:"Module"})),APe=E7({prefix:"\0",name:"identity",encode:r=>h_e(r),decode:r=>u_e(r)}),SPe=Object.freeze(Object.defineProperty({__proto__:null,identity:APe},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const CPe={...SPe,...X_e,...xPe,...q_e,...J_e,...pPe,...mPe,...vPe,...S_e,...sPe},YZ=Object.values(CPe).map(r=>r.decoder).reduce((r,e)=>r.or(e)),IPe=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function kPe(r){var t;if(r==null)return;const e=r.match(IPe);return(t=e==null?void 0:e.groups)==null?void 0:t.fingerprint}function XZ(r){const t=r.stringTuples().filter(n=>n[0]===ZIe).map(n=>n[1])[0];if(t===void 0||t==="")throw new ie(`Couldn't find a certhash component of multiaddr: ${r.toString()}`);return t}function TPe(r){return z_e(YZ.decode(r))}function _Pe(r){const e=TPe(XZ(r)),t=NPe(e.code),n=e.digest.reduce((i,o)=>i+o.toString(16).padStart(2,"0"),""),s=n.match(/.{1,2}/g);if(s==null)throw new _ke(n,r.toString());return`${t} ${s.join(":").toUpperCase()}`}function PPe(r){const e=r.split(":").map(s=>parseInt(s,16)),t=Uint8Array.from(e),n=C6(vN.code,t);return Ve(`/certhash/${bN.encode(n.bytes)}`)}function NPe(r){switch(r){case 17:return"sha-1";case 18:return"sha-256";case 19:return"sha-512";default:throw new Nke(r)}}function DPe(r,e){const{host:t,port:n,family:s}=r.toOptions(),i=_Pe(r);return{type:"answer",sdp:`v=0
o=- 0 0 IN IP${s} ${t}
s=-
t=0 0
a=ice-lite
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
c=IN IP${s} ${t}
a=mid:0
a=ice-options:ice2
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:${i}
a=setup:passive
a=sctp-port:5000
a=max-message-size:${jv}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function OPe(r,e){const{host:t,port:n,family:s}=r.toOptions();return{type:"offer",sdp:`v=0
o=- 0 0 IN IP${s} ${t}
s=-
c=IN IP${s} ${t}
t=0 0
a=ice-options:ice2,trickle
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:active
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:sha-256 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
a=sctp-port:5000
a=max-message-size:${jv}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function NU(r,e){if(r.sdp===void 0)throw new ie("Can't munge a missing SDP");const t=r.sdp.includes(`\r
`)?`\r
`:`
`;return r.sdp=r.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,`
a=ice-ufrag:`+e+t).replace(/\na=ice-pwd:[^\n]*\n/,`
a=ice-pwd:`+e+t),r}const $E=he("libp2p-webrtc-noise:");function RPe(r,e,t){const n=r.trim().toLowerCase().replaceAll(":",""),s=he(n,"hex"),i=C6(vN.code,s),o=YZ.decode(XZ(e)),a=$E.byteLength+i.bytes.byteLength+o.byteLength;return Cr(t==="server"?[$E,o,i.bytes]:[$E,i.bytes,o],a)}const BPe=UP?"iceconnectionstatechange":"connectionstatechange";async function MPe(r,e,t){var s,i,o;const n=r.createDataChannel("",{negotiated:!0,id:0});try{if(t.role==="client"){t.log.trace("client creating local offer");const f=await r.createOffer();t.log.trace("client created local offer %s",f.sdp);const g=NU(f,e);t.log.trace("client setting local offer %s",g.sdp),await r.setLocalDescription(g);const w=DPe(t.remoteAddr,e);t.log.trace("client setting server description %s",w.sdp),await r.setRemoteDescription(w)}else{const f=OPe(t.remoteAddr,e);t.log.trace("server setting client %s %s",f.type,f.sdp),await r.setRemoteDescription(f),t.log.trace("server creating local answer");const g=await r.createAnswer();t.log.trace("server created local answer");const w=NU(g,e);t.log.trace("server setting local description %s",g.sdp),await r.setLocalDescription(w)}if(n.readyState!=="open"&&(t.log.trace("%s wait for handshake channel to open, starting status %s",t.role,n.readyState),await Di(n,"open",t.signal)),t.log.trace("%s handshake channel opened",t.role),t.role==="server"){const f=((s=r.remoteFingerprint())==null?void 0:s.value)??"";t.remoteAddr=t.remoteAddr.encapsulate(PPe(f))}const a=kPe((i=r.localDescription)==null?void 0:i.sdp);if(a==null)throw new Qm("Could not get fingerprint from local description sdp");t.log.trace("%s performing noise handshake",t.role);const c=RPe(a,t.remoteAddr,t.role),l=QJ({prologueBytes:c})(t),u=jb({channel:n,direction:"outbound",handshake:!0,logger:t.logger,...t.dataChannel??{}}),d=new bC(t,{peerConnection:r,remoteAddr:t.remoteAddr,timeline:{open:Date.now()},metrics:t.events});r.addEventListener(BPe,()=>{switch(r.connectionState){case"failed":case"disconnected":case"closed":d.close().catch(f=>{t.log.error("error closing connection",f),d.abort(f)});break;default:break}}),(o=t.events)==null||o.increment({peer_connection:!0});const p=new FP(t,{peerConnection:r,metrics:t.events,dataChannelOptions:t.dataChannel});if(t.role==="client")return t.log.trace("%s secure inbound",t.role),await l.secureInbound(u,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0}),t.log.trace("%s upgrade outbound",t.role),await t.upgrader.upgradeOutbound(d,{skipProtection:!0,skipEncryption:!0,muxerFactory:p,signal:t.signal});t.log.trace("%s secure outbound",t.role);const y=await l.secureOutbound(u,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0});d.remoteAddr=d.remoteAddr.encapsulate(`/p2p/${y.remotePeer}`),t.log.trace("%s upgrade inbound",t.role),await t.upgrader.upgradeInbound(d,{skipProtection:!0,skipEncryption:!0,muxerFactory:p,signal:t.signal})}catch(a){throw n.close(),a}}async function $Pe(r,e,t,n){n==null&&(n=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"}));const s=typeof t=="function"?await t():t;return new RTCPeerConnection({...s??{},certificates:[n]})}async function LPe(r){const e=await Vq(r),t=await crypto.subtle.exportKey("pkcs8",e.privateKey);return["-----BEGIN PRIVATE KEY-----",...ce(new Uint8Array(t),"base64pad").split(/(.{64})/).filter(Boolean),"-----END PRIVATE KEY-----"].join(`
`)}var _V,PV,NV;NV=$5,PV=Symbol.toStringTag,_V=Lr;class UPe{constructor(e,t={}){h(this,"log");h(this,"metrics");h(this,"components");h(this,"init");h(this,"certificate");h(this,"privateKey");h(this,"emitter");h(this,"renewCertificateTask");h(this,NV,!0);h(this,PV,"@libp2p/webrtc-direct");h(this,_V,["@libp2p/transport"]);if(this.log=e.logger.forComponent("libp2p:webrtc-direct"),this.components=e,this.init=t,this.emitter=new Er,t.certificateLifespan!=null&&t.certificateRenewalThreshold!=null&&t.certificateRenewalThreshold>=t.certificateLifespan)throw new ie("Certificate renewal threshold must be less than certificate lifespan");e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}async start(){this.certificate=await this.getCertificate()}async stop(){this.renewCertificateTask!=null&&clearTimeout(this.renewCertificateTask),this.certificate=void 0}async dial(e,t){var a;this.log("dial %a",e),t.signal.throwIfAborted();let n;const s=e.getPeerId();s!=null&&(n=mr(s));const i=Cke(),o=await $Pe("client",i,typeof this.init.rtcConfiguration=="function"?await this.init.rtcConfiguration():this.init.rtcConfiguration??{});try{return await MPe(o,i,{role:"client",log:this.log,logger:this.components.logger,metrics:this.components.metrics,events:(a=this.metrics)==null?void 0:a.dialerEvents,signal:t.signal,remoteAddr:e,dataChannel:this.init.dataChannel,upgrader:t.upgrader,peerId:this.components.peerId,remotePeerId:n,privateKey:this.components.privateKey})}catch(c){throw o.close(),c}}createListener(e){if(this.certificate==null)throw new Hd;return new G_e(this.components,{...this.init,...e,certificate:this.certificate,emitter:this.emitter})}listenFilter(e){return e.filter(bS.exactMatch)}dialFilter(e){return this.listenFilter(e)}async getCertificate(e){if(FPe(this.init.certificate))return this.log("using provided TLS certificate"),this.init.certificate;const t=await this.loadOrCreatePrivateKey(),{pem:n,certhash:s}=await this.loadOrCreateCertificate(t,e);return{privateKey:await LPe(t),pem:n,certhash:s}}async loadOrCreatePrivateKey(){if(this.privateKey!=null)return this.privateKey;const e=this.init.certificateKeychainName??cke,t=this.getKeychain();try{if(t==null)throw this.log("no keychain configured - not checking for stored private key"),new vr;this.log.trace("checking for stored private key"),this.privateKey=await t.exportKey(e)}catch(n){if(n.name!=="NotFoundError")throw n;this.log.trace("generating private key"),this.privateKey=await J5("ECDSA","P-256"),t!=null?(this.log.trace("storing private key"),await t.importKey(e,this.privateKey)):this.log("no keychain configured - not storing private key")}return this.privateKey}async loadOrCreateCertificate(e,t){if(this.certificate!=null&&t!==!0)return this.certificate;let n;const s=new Dt(this.init.certificateDatastoreKey??ake),i=await Vq(e);try{if(t===!0)throw this.log.trace("forcing renewal of TLS certificate"),new vr;this.log.trace("checking for stored TLS certificate"),n=await this.loadCertificate(s,i)}catch(a){if(a.name!=="NotFoundError")throw a;this.log.trace("generating new TLS certificate"),n=await this.createCertificate(s,i)}let o=n.notAfter.getTime()-(this.init.certificateRenewalThreshold??Q$)-Date.now();return o<0&&(o=100),this.log("will renew TLS certificate after %d ms",o),this.renewCertificateTask=setTimeout(()=>{this.log("renewing TLS certificate"),this.getCertificate(!0).then(a=>{this.certificate=a,this.emitter.safeDispatchEvent("certificate:renew",{detail:a})}).catch(a=>{this.log.error("could not renew certificate - %e",a)})},o),{pem:n.toString("pem"),certhash:bN.encode((await vN.digest(new Uint8Array(n.rawData))).bytes)}}async loadCertificate(e,t){const n=await this.components.datastore.get(e),s=new wN(n),i=s.notAfter.getTime()-(this.init.certificateRenewalThreshold??Q$);if(Date.now()>i)throw this.log("stored TLS certificate has expired"),new vr;this.log("loaded certificate, expires in %d ms",i);const o=await s.publicKey.export(crypto),a=await crypto.subtle.exportKey("raw",o),c=await crypto.subtle.exportKey("raw",t.publicKey);if(!rt(new Uint8Array(a,0,a.byteLength),new Uint8Array(c,0,c.byteLength)))throw this.log("stored TLS certificate public key did not match public key from private key"),new vr;return this.log("loaded certificate, expiry time is %o",i),s}async createCertificate(e,t){const n=new Date,s=new Date(Date.now()+(this.init.certificateLifespan??lke));n.setMilliseconds(0),s.setMilliseconds(0);const i=await l_e.createSelfSigned({serialNumber:(BigInt(Math.random().toString().replace(".",""))*100000n).toString(16),name:"CN=example.com, C=US, L=CA, O=example, ST=CA",notBefore:n,notAfter:s,keys:t,extensions:[new yN(!1,void 0,!0)]},crypto);return this.getKeychain()!=null?(this.log.trace("storing TLS certificate"),await this.components.datastore.put(e,he(i.toString("pem")))):this.log("no keychain is configured so not storing TLS certificate since the private key will not be reused"),i}getKeychain(){try{return this.components.keychain}catch{}}}function FPe(r){return r==null?!1:typeof r.privateKey=="string"&&typeof r.pem=="string"&&typeof r.certhash=="string"}function zPe(r){return e=>new UPe(e,r)}function ZZ(r){return e=>new Bke(e,r)}const VPe=async r=>{if(r.readyState>=2)throw new Error("socket closed");r.readyState!==1&&await new Promise((e,t)=>{function n(){r.removeEventListener("open",s),r.removeEventListener("error",i)}function s(){n(),e()}function i(o){n(),t(o.error??new Error(`connect ECONNREFUSED ${r.url}`))}r.addEventListener("open",s),r.addEventListener("error",i)})},HPe=(r,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,async n=>{for await(const s of n){try{await VPe(r)}catch(i){if(i.message==="socket closed")break;throw i}if(r.readyState===r.CLOSING||r.readyState===r.CLOSED)break;r.send(s)}e.closeOnEnd!=null&&r.readyState<=1&&await new Promise((s,i)=>{r.addEventListener("close",o=>{if(o.wasClean||o.code===1006)s();else{const a=Object.assign(new Error("ws error"),{event:o});i(a)}}),setTimeout(()=>{r.close()})})});var x7={},A7={};Object.defineProperty(A7,"__esModule",{value:!0});class KPe{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const t={value:e,done:!1};if(this.pullQueue.length){const n=this.pullQueue.shift();n&&n.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{const t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{const t=this.pushQueue.shift();return t?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((n,s)=>{this.pullQueue.push({resolve:n,reject:s})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}let eee=class{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){const s=new KPe;s.highWaterMark=t,s.lowWaterMark=n,s.removeCallback=e({push:i=>s.push(i),stop:()=>s.stop(),fail:i=>s.fail(i),on:(i,o)=>{s.eventHandlers[i]=o}})||(()=>{}),this[Symbol.asyncIterator]=()=>s[Symbol.asyncIterator](),Object.freeze(this)}};A7.EventIterator=eee;A7.default=eee;Object.defineProperty(x7,"__esModule",{value:!0});const EN=A7;var GPe=x7.EventIterator=EN.EventIterator;function jPe(r,e,t){return new EN.EventIterator(({push:n})=>(this.addEventListener(r,n,e),()=>this.removeEventListener(r,n,e)),t)}x7.subscribe=jPe;x7.default=EN.EventIterator;function DU(r){var e;return r instanceof ArrayBuffer||((e=r==null?void 0:r.constructor)==null?void 0:e.name)==="ArrayBuffer"&&typeof(r==null?void 0:r.byteLength)=="number"}const qPe=r=>{r.binaryType="arraybuffer";const e=async()=>{await new Promise((i,o)=>{if(n){i();return}if(s!=null){o(s);return}const a=u=>{r.removeEventListener("open",c),r.removeEventListener("error",l),u()},c=()=>{a(i)},l=u=>{a(()=>{o(u.error??new Error(`connect ECONNREFUSED ${r.url}`))})};r.addEventListener("open",c),r.addEventListener("error",l)})},t=async function*(){const i=new GPe(({push:o,stop:a,fail:c})=>{const l=d=>{let p=null;typeof d.data=="string"&&(p=he(d.data)),DU(d.data)&&(p=new Uint8Array(d.data)),d.data instanceof Uint8Array&&(p=d.data),p!=null&&o(p)},u=d=>{c(d.error??new Error("Socket error"))};return r.addEventListener("message",l),r.addEventListener("error",u),r.addEventListener("close",a),()=>{r.removeEventListener("message",l),r.removeEventListener("error",u),r.removeEventListener("close",a)}},{highWaterMark:1/0});await e();for await(const o of i)yield DU(o)?new Uint8Array(o):o}();let n=r.readyState===1,s;return r.addEventListener("open",()=>{n=!0,s=null}),r.addEventListener("close",()=>{n=!1,s=null}),r.addEventListener("error",i=>{n||(s=i.error??new Error(`connect ECONNREFUSED ${r.url}`))}),Object.assign(t,{connected:e})},WPe=(r,e)=>{e=e??{};const t=qPe(r);let n=e.remoteAddress,s=e.remotePort;if(r.url!=null)try{const o=new URL(r.url);n=o.hostname,s=parseInt(o.port,10)}catch{}if(n==null||s==null)throw new Error("Remote connection did not have address and/or port");return{sink:HPe(r,e),source:t,connected:async()=>{await t.connected()},close:async()=>{(r.readyState===r.CONNECTING||r.readyState===r.OPEN)&&await new Promise(o=>{r.addEventListener("close",()=>{o()}),r.close()})},destroy:()=>{r.terminate!=null?r.terminate():r.close()},remoteAddress:n,remotePort:s,socket:r}},QPe=WebSocket,JPe={"http:":"ws:","https:":"wss:"},OU="ws:",YPe=(r,e)=>{if(r.startsWith("//")&&(r=`${(e==null?void 0:e.protocol)??OU}${r}`),r.startsWith("/")&&e!=null){const n=e.protocol??OU,s=e.host,i=e.port!=null&&(s==null?void 0:s.endsWith(`:${e.port}`))!==!0?`:${e.port}`:"";r=`${n}//${s}${i}${r}`}const t=new URL(r);for(const[n,s]of Object.entries(JPe))t.protocol===n&&(t.protocol=s);return t};function XPe(r,e){const t=typeof window>"u"?void 0:window.location;e=e??{};const n=YPe(r,t),s=new QPe(n.toString(),e.websocket);return WPe(s,e)}function ZPe(r){return r.filter(e=>ab.exactMatch(e)||Iy.exactMatch(e))}function eNe(){throw new Error("WebSocket Servers can not be created in the browser!")}const tNe=500;function rNe(r,e,t){const n=t.logger.forComponent("libp2p:websockets:maconn"),s=t.metrics,i=t.metricPrefix??"",o={log:n,async sink(a){try{await r.sink(async function*(){for await(const c of a)c instanceof Uint8Array?yield c:yield c.subarray()}())}catch(c){c.type!=="aborted"&&n.error(c)}},source:r.source,remoteAddr:e,timeline:{open:Date.now()},async close(a={}){var u,d;const c=Date.now();if(a.signal==null){const p=AbortSignal.timeout(tNe);a={...a,signal:p}}const l=()=>{const{host:p,port:y}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s after %dms, destroying it manually",p,y,Date.now()-c),this.abort(new Vd("Socket close timeout"))};(u=a.signal)==null||u.addEventListener("abort",l);try{await r.close()}catch(p){n.error("error closing WebSocket gracefully",p),this.abort(p)}finally{(d=a.signal)==null||d.removeEventListener("abort",l),o.timeline.close=Date.now()}},abort(a){const{host:c,port:l}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s due to error",c,l,a),r.destroy(),o.timeline.close=Date.now(),s==null||s.increment({[`${i}error`]:!0})}};return r.socket.addEventListener("close",()=>{s==null||s.increment({[`${i}close`]:!0}),o.timeline.close==null&&(o.timeline.close=Date.now())},{once:!0}),o}var DV,OV,RV;RV=$5,OV=Symbol.toStringTag,DV=Lr;class nNe{constructor(e,t={}){h(this,"log");h(this,"init");h(this,"logger");h(this,"metrics");h(this,"components");h(this,RV,!0);h(this,OV,"@libp2p/websockets");h(this,DV,["@libp2p/transport"]);this.log=e.logger.forComponent("libp2p:websockets"),this.logger=e.logger,this.components=e,this.init=t,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}async dial(e,t){var o;this.log("dialing %s",e),t=t??{};const n=await this._connect(e,t),s=rNe(n,e,{logger:this.logger,metrics:(o=this.metrics)==null?void 0:o.dialerEvents});this.log("new outbound connection %s",s.remoteAddr);const i=await t.upgrader.upgradeOutbound(s,t);return this.log("outbound connection %s upgraded",s.remoteAddr),i}async _connect(e,t){var o,a,c,l,u;(o=t==null?void 0:t.signal)==null||o.throwIfAborted();const n=e.toOptions();this.log("dialing %s:%s",n.host,n.port);const s=He(),i=XPe(rJ(e),this.init);i.socket.addEventListener("error",()=>{var p;const d=new ZT(`Could not connect to ${e.toString()}`);this.log.error("connection error:",d),(p=this.metrics)==null||p.dialerEvents.increment({error:!0}),s.reject(d)});try{(a=t.onProgress)==null||a.call(t,new Re("websockets:open-connection")),await Vn(Promise.race([i.connected(),s.promise]),t.signal)}catch(d){throw(c=t.signal)!=null&&c.aborted&&((l=this.metrics)==null||l.dialerEvents.increment({abort:!0})),i.close().catch(p=>{this.log.error("error closing raw socket",p)}),d}return this.log("connected %s",e),(u=this.metrics)==null||u.dialerEvents.increment({connect:!0}),i}createListener(e){return eNe({logger:this.logger,events:this.components.events,metrics:this.components.metrics},{...this.init,...e})}listenFilter(e){var t,n;return e=Array.isArray(e)?e:[e],((t=this.init)==null?void 0:t.filter)!=null?(n=this.init)==null?void 0:n.filter(e):ZPe(e)}dialFilter(e){return this.listenFilter(e)}}function tee(r={}){return e=>new nNe(e,r)}function sNe(r,e){const t=e.map((n,s)=>({record:Vm(n),index:s}));return t.sort((n,s)=>{const i=n.record.sequence,o=s.record.sequence;if(i>o)return-1;if(i<o)return 1;if(n.record.validityType===xo.ValidityType.EOL&&s.record.validityType===xo.ValidityType.EOL){const a=kS.fromString(n.record.validity).toDate(),c=kS.fromString(s.record.validity).toDate();if(a.getTime()>c.getTime())return-1;if(a.getTime()<c.getTime())return 1}return 0}),t[0].index}const ree="2.8.5",nee="js-libp2p";function see(r,e){return`${r??nee}/${e??ree} browser/${globalThis.navigator.userAgent}`}const iNe="5.3.0",oNe="helia",aNe={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};function cNe(r={}){const e=`${oNe}/${iNe} ${see()}`;return{privateKey:r.privateKey,dns:r.dns,nodeInfo:{userAgent:e},addresses:{listen:["/p2p-circuit","/webrtc"]},transports:[CY(),ZZ(),zPe(),tee()],connectionEncrypters:[QJ()],streamMuxers:[Y7e(),VIe()],peerDiscovery:[fY(aNe)],services:{autoNAT:D9e(),dcutr:sxe(),delegatedRouting:()=>K6e("https://delegated-ipfs.dev",C5e()),dht:VSe({clientMode:!0,validators:{ipns:EJ},selectors:{ipns:sNe}}),identify:_Y(),identifyPush:mxe(),keychain:jX(r.keychain),ping:JIe()}}}async function lNe(r,e={}){const t=e.selfKey??"self",n=jX(e)({datastore:r,logger:nv()});let s;return await r.has(new Dt(`/pkcs8/${t}`))?s=await n.exportKey(t):(s=await J5(e.keyType??"Ed25519"),await n.importKey(t,s)),s}const uNe=32,{code:hNe}=We("dnsaddr");class dNe extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}}const iee=async function(e,t={}){const n=t.maxRecursiveDepth??uNe;if(n===0)throw new dNe("Max recursive depth reached");const[,s]=e.stringTuples().find(([l])=>l===hNe)??[],o=await((t==null?void 0:t.dns)??zW()).query(`_dnsaddr.${s}`,{signal:t==null?void 0:t.signal,types:[Vu.TXT]}),a=e.getPeerId(),c=[];for(const l of o.Answer){const u=l.data.replace(/["']/g,"").trim().split("=")[1];if(u==null||a!=null&&!u.includes(a))continue;const d=Ve(u);if(u.startsWith("/dnsaddr")){const p=await d.resolve({...t,maxRecursiveDepth:n-1});c.push(...p.map(y=>y.toString()))}else c.push(d.toString())}return c},fNe={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:r=>r},connectionManager:{resolvers:{dnsaddr:iee}},transportManager:{faultTolerance:Z0.FATAL_ALL}};async function pNe(r){var t,n;const e=CP(fNe,r);if(e.connectionProtector===null&&((n=(t=globalThis.process)==null?void 0:t.env)==null?void 0:n.LIBP2P_FORCE_PNET)!=null)throw new ie("Private network is enforced, but no protector was provided");return e}function gNe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function xN(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function yNe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,w=0,m=0,b=f.length;m!==b&&f[m]===0;)m++,g++;for(var v=(b-m)*u+1>>>0,E=new Uint8Array(v);m!==b;){for(var S=f[m],I=0,x=v-1;(S!==0||I<w)&&x!==-1;x--,I++)S+=256*E[x]>>>0,E[x]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=I,m++}for(var C=v-w;C!==v&&E[C]===0;)C++;for(var P=c.repeat(g);C<v;++C)P+=r.charAt(E[C]);return P}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var w=0,m=0;f[g]===c;)w++,g++;for(var b=(f.length-g)*l+1>>>0,v=new Uint8Array(b);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var S=0,I=b-1;(E!==0||S<m)&&I!==-1;I--,S++)E+=a*v[I]>>>0,v[I]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=S,g++}if(f[g]!==" "){for(var x=b-m;x!==b&&v[x]===0;)x++;for(var C=new Uint8Array(w+(b-x)),P=w;x!==b;)C[P++]=v[x++];return C}}}function y(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:y}}var mNe=yNe,wNe=mNe;class bNe{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class vNe{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return oee(this,e)}}class ENe{constructor(e){h(this,"decoders");this.decoders=e}or(e){return oee(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function oee(r,e){return new ENe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}class xNe{constructor(e,t,n,s){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new bNe(e,t,n),this.decoder=new vNe(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function aee({name:r,prefix:e,encode:t,decode:n}){return new xNe(r,e,t,n)}function S7({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=wNe(t,r);return aee({prefix:e,name:r,encode:n,decode:i=>xN(s(i))})}function ANe(r,e,t,n){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[r[u]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function SNe(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i}function tl({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return aee({prefix:e,name:r,encode(s){return SNe(s,n,t)},decode(s){return ANe(s,n,t,r)}})}const V2=tl({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});tl({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});tl({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});tl({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});tl({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});tl({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});tl({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});tl({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});tl({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const LE=S7({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});S7({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Qa=S7({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});S7({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var CNe=cee,RU=128,INe=-128,kNe=Math.pow(2,31);function cee(r,e,t){e=e||[],t=t||0;for(var n=t;r>=kNe;)e[t++]=r&255|RU,r/=128;for(;r&INe;)e[t++]=r&255|RU,r>>>=7;return e[t]=r|0,cee.bytes=t-n+1,e}var TNe=BI,_Ne=128,BU=127;function BI(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw BI.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&BU)<<s:(o&BU)*Math.pow(2,s),s+=7}while(o>=_Ne);return BI.bytes=i-n,t}var PNe=Math.pow(2,7),NNe=Math.pow(2,14),DNe=Math.pow(2,21),ONe=Math.pow(2,28),RNe=Math.pow(2,35),BNe=Math.pow(2,42),MNe=Math.pow(2,49),$Ne=Math.pow(2,56),LNe=Math.pow(2,63),UNe=function(r){return r<PNe?1:r<NNe?2:r<DNe?3:r<ONe?4:r<RNe?5:r<BNe?6:r<MNe?7:r<$Ne?8:r<LNe?9:10},FNe={encode:CNe,decode:TNe,encodingLength:UNe},I6=FNe;function MI(r,e=0){return[I6.decode(r,e),I6.decode.bytes]}function k6(r,e,t=0){return I6.encode(r,e,t),e}function T6(r){return I6.encodingLength(r)}function zNe(r,e){const t=e.byteLength,n=T6(r),s=n+T6(t),i=new Uint8Array(s+t);return k6(r,i,0),k6(t,i,n),i.set(e,s),new AN(r,t,e,i)}function lee(r){const e=xN(r),[t,n]=MI(e),[s,i]=MI(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new AN(t,s,o,e)}function VNe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&gNe(r.bytes,t.bytes)}}let AN=class{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}};function MU(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return KNe(t,$I(r),e??Qa.encoder);default:return GNe(t,$I(r),e??V2.encoder)}}const $U=new WeakMap;function $I(r){const e=$U.get(r);if(e==null){const t=new Map;return $U.set(r,t),t}return e}var BV;class zr{constructor(e,t,n,s){h(this,"code");h(this,"version");h(this,"multihash");h(this,"bytes");h(this,"/");h(this,BV,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Xg)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==jNe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return zr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=zNe(e,t);return zr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return zr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&VNe(e.multihash,n.multihash)}toString(e){return MU(this,e)}toJSON(){return{"/":MU(this)}}link(){return this}[(BV=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof zr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new zr(n,s,i,o??LU(n,s,i.bytes))}else if(t[qNe]===!0){const{version:n,multihash:s,code:i}=t,o=lee(s);return zr.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Xg)throw new Error(`Version 0 CID must use dag-pb (code: ${Xg}) block encoding`);return new zr(e,t,n,n.bytes)}case 1:{const s=LU(e,t,n.bytes);return new zr(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return zr.create(0,Xg,e)}static createV1(e,t){return zr.create(1,e,t)}static decode(e){const[t,n]=zr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=zr.inspectBytes(e),n=t.size-t.multihashSize,s=xN(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new AN(t.multihashCode,t.digestSize,i,s);return[t.version===0?zr.createV0(o):zr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=MI(e.subarray(t));return t+=p,d};let s=n(),i=Xg;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,s]=HNe(e,t),i=zr.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return $I(i).set(n,e),i}}function HNe(r,e){switch(r[0]){case"Q":{const t=e??Qa;return[Qa.prefix,t.decode(`${Qa.prefix}${r}`)]}case Qa.prefix:{const t=e??Qa;return[Qa.prefix,t.decode(r)]}case V2.prefix:{const t=e??V2;return[V2.prefix,t.decode(r)]}case LE.prefix:{const t=e??LE;return[LE.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function KNe(r,e,t){const{prefix:n}=t;if(n!==Qa.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s}function GNe(r,e,t){const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s}const Xg=112,jNe=18;function LU(r,e,t){const n=T6(r),s=n+T6(e),i=new Uint8Array(s+t.byteLength);return k6(r,i,0),k6(e,i,n),i.set(t,s),i}const qNe=Symbol.for("@ipld/js-cid/CID"),WNe=36e5,QNe=216e5;var Wh;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=Fe((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.key!=null&&s.key!==""&&(i.uint32(10),i.string(s.key)),s.value!=null&&s.value.byteLength>0&&(i.uint32(18),i.bytes(s.value)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{const a={key:"",value:it(0)},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const l=s.uint32();switch(l>>>3){case 1:{a.key=s.string();break}case 2:{a.value=s.bytes();break}default:{s.skipType(l&7);break}}}return a})),n),t.encode=s=>Ue(s,t.codec()),t.decode=(s,i)=>Le(s,t.codec(),i)})(r.Peer$metadataEntry||(r.Peer$metadataEntry={})),function(t){let n;t.codec=()=>(n==null&&(n=Fe((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.key!=null&&s.key!==""&&(i.uint32(10),i.string(s.key)),s.value!=null&&(i.uint32(18),P6.codec().encode(s.value,i)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{var l;const a={key:""},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const u=s.uint32();switch(u>>>3){case 1:{a.key=s.string();break}case 2:{a.value=P6.codec().decode(s,s.uint32(),{limits:(l=o.limits)==null?void 0:l.value});break}default:{s.skipType(u&7);break}}}return a})),n),t.encode=s=>Ue(s,t.codec()),t.decode=(s,i)=>Le(s,t.codec(),i)}(r.Peer$tagsEntry||(r.Peer$tagsEntry={}));let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.addresses!=null)for(const i of t.addresses)n.uint32(10),_6.codec().encode(i,n);if(t.protocols!=null)for(const i of t.protocols)n.uint32(18),n.string(i);if(t.publicKey!=null&&(n.uint32(34),n.bytes(t.publicKey)),t.peerRecordEnvelope!=null&&(n.uint32(42),n.bytes(t.peerRecordEnvelope)),t.metadata!=null&&t.metadata.size!==0)for(const[i,o]of t.metadata.entries())n.uint32(50),r.Peer$metadataEntry.codec().encode({key:i,value:o},n);if(t.tags!=null&&t.tags.size!==0)for(const[i,o]of t.tags.entries())n.uint32(58),r.Peer$tagsEntry.codec().encode({key:i,value:o},n);t.updated!=null&&(n.uint32(64),n.uint64Number(t.updated)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{var a,c,l,u,d,p;const i={addresses:[],protocols:[],metadata:new Map,tags:new Map},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const y=t.uint32();switch(y>>>3){case 1:{if(((a=s.limits)==null?void 0:a.addresses)!=null&&i.addresses.length===s.limits.addresses)throw new It('Decode error - map field "addresses" had too many elements');i.addresses.push(_6.codec().decode(t,t.uint32(),{limits:(c=s.limits)==null?void 0:c.addresses$}));break}case 2:{if(((l=s.limits)==null?void 0:l.protocols)!=null&&i.protocols.length===s.limits.protocols)throw new It('Decode error - map field "protocols" had too many elements');i.protocols.push(t.string());break}case 4:{i.publicKey=t.bytes();break}case 5:{i.peerRecordEnvelope=t.bytes();break}case 6:{if(((u=s.limits)==null?void 0:u.metadata)!=null&&i.metadata.size===s.limits.metadata)throw new vR('Decode error - map field "metadata" had too many elements');const f=r.Peer$metadataEntry.codec().decode(t,t.uint32());i.metadata.set(f.key,f.value);break}case 7:{if(((d=s.limits)==null?void 0:d.tags)!=null&&i.tags.size===s.limits.tags)throw new vR('Decode error - map field "tags" had too many elements');const f=r.Peer$tagsEntry.codec().decode(t,t.uint32(),{limits:{value:(p=s.limits)==null?void 0:p.tags$value}});i.tags.set(f.key,f.value);break}case 8:{i.updated=t.uint64Number();break}default:{t.skipType(y&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(Wh||(Wh={}));var _6;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(n.uint32(10),n.bytes(t.multiaddr)),t.isCertified!=null&&(n.uint32(16),n.bool(t.isCertified)),t.observed!=null&&(n.uint32(24),n.uint64Number(t.observed)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={multiaddr:it(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.multiaddr=t.bytes();break}case 2:{i.isCertified=t.bool();break}case 3:{i.observed=t.uint64Number();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(_6||(_6={}));var P6;(function(r){let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.value!=null&&t.value!==0&&(n.uint32(8),n.uint32(t.value)),t.expiry!=null&&(n.uint32(16),n.uint64(t.expiry)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={value:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.value=t.uint32();break}case 2:{i.expiry=t.uint64();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(P6||(P6={}));function JNe(r,e){if(r.publicKey!=null||e.publicKey==null)return r;let t;if(r.type==="RSA"){const s=Qa.decode(`z${r}`);t=lee(s)}const n=Is(e.publicKey,t);return i1(n)}function LI(r,e,t){const n=Wh.decode(e);return UI(r,n,t)}function UI(r,e,t){const n=new Map,s=BigInt(Date.now());for(const[i,o]of e.tags.entries())o.expiry!=null&&o.expiry<s||n.set(i,o);return{...e,id:JNe(r,e),addresses:e.addresses.filter(({observed:i})=>i!=null&&i>Date.now()-t).map(({multiaddr:i,isCertified:o})=>({multiaddr:Ve(i),isCertified:o??!1})),metadata:e.metadata,peerRecordEnvelope:e.peerRecordEnvelope??void 0,tags:n}}function YNe(r,e){return XNe(r.addresses,e.addresses)&&ZNe(r.protocols,e.protocols)&&eDe(r.publicKey,e.publicKey)&&tDe(r.peerRecordEnvelope,e.peerRecordEnvelope)&&rDe(r.metadata,e.metadata)&&nDe(r.tags,e.tags)}function XNe(r,e){return hee(r,e,(t,n)=>!(t.isCertified!==n.isCertified||!rt(t.multiaddr,n.multiaddr)))}function ZNe(r,e){return hee(r,e,(t,n)=>t===n)}function eDe(r,e){return uee(r,e)}function tDe(r,e){return uee(r,e)}function rDe(r,e){return dee(r,e,(t,n)=>rt(t,n))}function nDe(r,e){return dee(r,e,(t,n)=>t.value===n.value&&t.expiry===n.expiry)}function uee(r,e){return r==null&&e==null?!0:r!=null&&e!=null?rt(r,e):!1}function hee(r,e,t){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!t(r[n],e[n]))return!1;return!0}function dee(r,e,t){if(r.size!==e.size)return!1;for(const[n,s]of r.entries()){const i=e.get(n);if(i==null||!t(s,i))return!1}return!0}const fee="/peers/";function E3(r){if(!_j(r)||r.type==null)throw new ie("Invalid PeerId");const e=r.toCID().toString();return new Dt(`${fee}${e}`)}async function sDe(r,e,t,n){const s=new Map;for(const i of t){if(i==null)continue;if(i.multiaddr instanceof Uint8Array&&(i.multiaddr=Ve(i.multiaddr)),!pv(i.multiaddr))throw new ie("Multiaddr was invalid");if(!await e(r,i.multiaddr))continue;const o=i.isCertified??!1,a=i.multiaddr.toString(),c=s.get(a);c!=null?i.isCertified=c.isCertified||o:s.set(a,{multiaddr:i.multiaddr,isCertified:o})}return[...s.values()].sort((i,o)=>i.multiaddr.toString().localeCompare(o.multiaddr.toString())).map(({isCertified:i,multiaddr:o})=>({isCertified:i,multiaddr:o.bytes}))}async function UE(r,e,t,n){var p,y;if(e==null)throw new ie("Invalid PeerData");if(e.publicKey!=null&&r.publicKey!=null&&!e.publicKey.equals(r.publicKey))throw new ie("publicKey bytes do not match peer id publicKey bytes");const s=(p=n.existingPeer)==null?void 0:p.peer;if(s!=null&&!r.equals(s.id))throw new ie("peer id did not match existing peer id");let i=(s==null?void 0:s.addresses)??[],o=new Set((s==null?void 0:s.protocols)??[]),a=(s==null?void 0:s.metadata)??new Map,c=(s==null?void 0:s.tags)??new Map,l=s==null?void 0:s.peerRecordEnvelope;if(t==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(i=[],e.multiaddrs!=null&&i.push(...e.multiaddrs.map(f=>({isCertified:!1,multiaddr:f}))),e.addresses!=null&&i.push(...e.addresses)),e.protocols!=null&&(o=new Set(e.protocols)),e.metadata!=null){const f=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);a=x3(f,{validate:UU})}if(e.tags!=null){const f=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);c=x3(f,{validate:FU,map:zU})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}if(t==="merge"){if(e.multiaddrs!=null&&i.push(...e.multiaddrs.map(f=>({isCertified:!1,multiaddr:f}))),e.addresses!=null&&i.push(...e.addresses),e.protocols!=null&&(o=new Set([...o,...e.protocols])),e.metadata!=null){const f=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(const[g,w]of f)w==null?a.delete(g):a.set(g,w);a=x3([...a.entries()],{validate:UU})}if(e.tags!=null){const f=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),g=new Map(c);for(const[w,m]of f)m==null?g.delete(w):g.set(w,m);c=x3([...g.entries()],{validate:FU,map:zU})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}let u;(s==null?void 0:s.id.publicKey)!=null?u=$i(s.id.publicKey):e.publicKey!=null?u=$i(e.publicKey):r.publicKey!=null&&(u=$i(r.publicKey));const d={addresses:await sDe(r,n.addressFilter??(async()=>!0),i,(y=n.existingPeer)==null?void 0:y.peerPB.addresses),protocols:[...o.values()].sort((f,g)=>f.localeCompare(g)),metadata:a,tags:c,publicKey:u,peerRecordEnvelope:l};return d.addresses.forEach(f=>{var g,w,m;f.observed=((m=(w=(g=n.existingPeer)==null?void 0:g.peerPB.addresses)==null?void 0:w.find(b=>rt(b.multiaddr,b.multiaddr)))==null?void 0:m.observed)??Date.now()}),r.type!=="RSA"&&delete d.publicKey,d}function x3(r,e){var n;const t=new Map;for(const[s,i]of r)i!=null&&e.validate(s,i);for(const[s,i]of r.sort(([o],[a])=>o.localeCompare(a)))i!=null&&t.set(s,((n=e.map)==null?void 0:n.call(e,s,i))??i);return t}function UU(r,e){if(typeof r!="string")throw new ie("Metadata key must be a string");if(!(e instanceof Uint8Array))throw new ie("Metadata value must be a Uint8Array")}function FU(r,e){if(typeof r!="string")throw new ie("Tag name must be a string");if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new ie("Tag value must be an integer");if(e.value<0||e.value>100)throw new ie("Tag value must be between 0-100")}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new ie("Tag ttl must be an integer");if(e.ttl<0)throw new ie("Tag ttl must be between greater than 0")}}function zU(r,e){let t;return e.expiry!=null&&(t=e.expiry),e.ttl!=null&&(t=BigInt(Date.now()+Number(e.ttl))),{value:e.value??0,expiry:t}}function pee(r){const e=r.toString().split("/")[2],t=zr.parse(e,V2);return Y1(t)}function FE(r,e,t){const n=pee(r);return LI(n,e,t)}function iDe(r,e){return{prefix:fee,filters:(r.filters??[]).map(t=>({key:n,value:s})=>t(FE(n,s,e))),orders:(r.orders??[]).map(t=>(n,s)=>t(FE(n.key,n.value,e),FE(s.key,s.value,e)))}}var As,S4,C4,I4;class oDe{constructor(e,t={}){Q(this,As);h(this,"peerId");h(this,"datastore");h(this,"lock");h(this,"addressFilter");h(this,"log");h(this,"maxAddressAge");h(this,"maxPeerAge");this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.lock=F_({name:"peer-store",singleProcess:!0}),this.maxAddressAge=t.maxAddressAge??WNe,this.maxPeerAge=t.maxPeerAge??QNe}async has(e){try{return await this.load(e),!0}catch(t){if(t.name!=="NotFoundError")throw t}return!1}async delete(e){this.peerId.equals(e)||await this.datastore.delete(E3(e))}async load(e){const t=E3(e),n=await this.datastore.get(t),s=Wh.decode(n);if(te(this,As,I4).call(this,e,s))throw await this.datastore.delete(t),new vr;return UI(e,s,this.peerId.equals(e)?1/0:this.maxAddressAge)}async save(e,t){const n=await te(this,As,S4).call(this,e),s=await UE(e,t,"patch",{addressFilter:this.addressFilter});return te(this,As,C4).call(this,e,s,n)}async patch(e,t){const n=await te(this,As,S4).call(this,e),s=await UE(e,t,"patch",{addressFilter:this.addressFilter,existingPeer:n});return te(this,As,C4).call(this,e,s,n)}async merge(e,t){const n=await te(this,As,S4).call(this,e),s=await UE(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:n});return te(this,As,C4).call(this,e,s,n)}async*all(e){for await(const{key:t,value:n}of this.datastore.query(iDe(e??{},this.maxAddressAge))){const s=pee(t);if(s.equals(this.peerId))continue;const i=Wh.decode(n);if(te(this,As,I4).call(this,s,i)){await this.datastore.delete(t);continue}yield UI(s,i,this.peerId.equals(s)?1/0:this.maxAddressAge)}}}As=new WeakSet,S4=async function(e){try{const t=E3(e),n=await this.datastore.get(t),s=Wh.decode(n);if(te(this,As,I4).call(this,e,s))throw await this.datastore.delete(t),new vr;return{peerPB:s,peer:LI(e,n,this.maxAddressAge)}}catch(t){t.name!=="NotFoundError"&&this.log.error("invalid peer data found in peer store - %e",t)}},C4=async function(e,t,n){t.updated=Date.now();const s=Wh.encode(t);return await this.datastore.put(E3(e),s),{peer:LI(e,s,this.maxAddressAge),previous:n==null?void 0:n.peer,updated:n==null||!YNe(t,n.peerPB)}},I4=function(e,t){if(t.updated==null)return!0;if(this.peerId.equals(e))return!1;const n=t.updated<Date.now()-this.maxPeerAge,s=Date.now()-this.maxAddressAge,i=t.addresses.filter(o=>o.observed!=null&&o.observed>s);return n&&i.length===0};var MV,r0,k4;MV=Symbol.toStringTag;class aDe{constructor(e,t={}){Q(this,r0);h(this,"store");h(this,"events");h(this,"peerId");h(this,"log");h(this,MV,"@libp2p/peer-store");this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new oDe(e,t)}async forEach(e,t){this.log.trace("forEach await read lock");const n=await this.store.lock.readLock();this.log.trace("forEach got read lock");try{for await(const s of this.store.all(t))e(s)}finally{this.log.trace("forEach release read lock"),n()}}async all(e){this.log.trace("all await read lock");const t=await this.store.lock.readLock();this.log.trace("all got read lock");try{return await Sb(this.store.all(e))}finally{this.log.trace("all release read lock"),t()}}async delete(e){this.log.trace("delete await write lock");const t=await this.store.lock.writeLock();this.log.trace("delete got write lock");try{await this.store.delete(e)}finally{this.log.trace("delete release write lock"),t()}}async has(e){this.log.trace("has await read lock");const t=await this.store.lock.readLock();this.log.trace("has got read lock");try{return await this.store.has(e)}finally{this.log.trace("has release read lock"),t()}}async get(e){this.log.trace("get await read lock");const t=await this.store.lock.readLock();this.log.trace("get got read lock");try{return await this.store.load(e)}finally{this.log.trace("get release read lock"),t()}}async save(e,t){this.log.trace("save await write lock");const n=await this.store.lock.writeLock();this.log.trace("save got write lock");try{const s=await this.store.save(e,t);return te(this,r0,k4).call(this,e,s),s.peer}finally{this.log.trace("save release write lock"),n()}}async patch(e,t){this.log.trace("patch await write lock");const n=await this.store.lock.writeLock();this.log.trace("patch got write lock");try{const s=await this.store.patch(e,t);return te(this,r0,k4).call(this,e,s),s.peer}finally{this.log.trace("patch release write lock"),n()}}async merge(e,t){this.log.trace("merge await write lock");const n=await this.store.lock.writeLock();this.log.trace("merge got write lock");try{const s=await this.store.merge(e,t);return te(this,r0,k4).call(this,e,s),s.peer}finally{this.log.trace("merge release write lock"),n()}}async consumePeerRecord(e,t){const n=await Gu.openAndCertify(e,ya.DOMAIN),s=Y1(n.publicKey.toCID());if((t==null?void 0:t.equals(s))===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",t,s),!1;const i=ya.createFromProtobuf(n.payload);let o;try{o=await this.get(s)}catch(a){if(a.name!=="NotFoundError")throw a}if((o==null?void 0:o.peerRecordEnvelope)!=null){const a=await Gu.createFromProtobuf(o.peerRecordEnvelope),c=ya.createFromProtobuf(a.payload);if(c.seqNumber>=i.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",c.seqNumber,i.seqNumber),!1}return await this.patch(i.peerId,{peerRecordEnvelope:e,addresses:i.multiaddrs.map(a=>({isCertified:!0,multiaddr:a}))}),!0}}r0=new WeakSet,k4=function(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))};function cDe(r,e={}){return new aDe(r,e)}function lDe(r,e){let t;const n=function(){const s=function(){t=void 0,r()};clearTimeout(t),t=setTimeout(s,e)};return n.start=()=>{},n.stop=()=>{clearTimeout(t)},n}const VU=864e13,uDe=448,zE=449,hDe=53,dDe=54,fDe=55,pDe=56;class gDe{constructor(e,t={}){h(this,"log");h(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=new Map}has(e){const t=this.findHost(e);for(const n of this.mappings.values())if(n.domain===t)return!0;return!1}add(e,t){t.forEach(n=>{this.log("add DNS mapping %s to %s",n,e);const s=ah(n)===!0;this.mappings.set(n,{domain:e,verified:s,expires:s?VU-Date.now():0,lastVerified:s?VU-Date.now():void 0})})}remove(e){const t=this.findHost(e);let n=!1;for(const[s,i]of this.mappings.entries())i.domain===t&&(this.log("removing %s to %s DNS mapping %e",s,i.domain,new Error("where")),this.mappings.delete(s),n=n||i.verified);return n}getAll(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n].multiaddr.stringTuples(),o=i[0][1];if(o!=null)for(const[a,c]of this.mappings.entries()){if(o!==a)continue;this.maybeAddSNITuple(i,c.domain)&&(e.splice(n,1),n--,t.push({multiaddr:Ve(`/${i.map(u=>[We(u[0]).name,u[1]].join("/")).join("/")}`),verified:c.verified,type:"dns-mapping",expires:c.expires,lastVerified:c.lastVerified}))}}return t}maybeAddSNITuple(e,t){var n;for(let s=0;s<e.length;s++)if(e[s][0]===uDe&&((n=e[s+1])==null?void 0:n[0])!==zE)return e.splice(s+1,0,[zE,t]),!0;return!1}confirm(e,t){const n=this.findHost(e);let s=!1;for(const[i,o]of this.mappings.entries())o.domain===n&&(this.log("marking %s to %s DNS mapping as verified",i,o.domain),s=o.verified,o.verified=!0,o.expires=Date.now()+t,o.lastVerified=Date.now());return s}unconfirm(e,t){const n=this.findHost(e);let s=!1;for(const[i,o]of this.mappings.entries())o.domain===n&&(this.log("removing verification of %s to %s DNS mapping",i,o.domain),s=s||o.verified,o.verified=!1,o.expires=Date.now()+t);return s}findHost(e){for(const t of e.stringTuples())if(t[0]===zE||t[0]===hDe||t[0]===dDe||t[0]===fDe||t[0]===pDe)return t[1]}}const VE=4,HE=41,KE=6,yDe=273;class mDe{constructor(e,t={}){h(this,"log");h(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=new Map}has(e){const t=e.stringTuples();for(const n of this.mappings.values())for(const s of n)if(s.externalIp===t[0][1])return!0;return!1}add(e,t,n,s=t,i="tcp"){const o=`${e}-${t}-${i}`,a=this.mappings.get(o)??[],c={internalIp:e,internalPort:t,externalIp:n,externalPort:s,externalFamily:u1(n)?4:6,protocol:i,verified:!1,expires:0};a.push(c),this.mappings.set(o,a)}remove(e){const t=e.stringTuples(),n=t[0][1]??"",s=t[1][0]===KE?"tcp":"udp",i=parseInt(t[1][1]??"0");let o=!1;for(const[a,c]of this.mappings.entries()){for(let l=0;l<c.length;l++){const u=c[l];u.externalIp===n&&u.externalPort===i&&u.protocol===s&&(this.log("removing %s:%s to %s:%s %s IP mapping",u.externalIp,u.externalPort,n,i,s),o=o||u.verified,c.splice(l,1),l--)}c.length===0&&this.mappings.delete(a)}return o}getAll(e){const t=[];for(const{multiaddr:n}of e){const s=n.stringTuples();let i;if((s[0][0]===VE||s[0][0]===HE)&&s[1][0]===KE?i=`${s[0][1]}-${s[1][1]}-tcp`:(s[0][0]===VE||s[0][0]===HE)&&s[1][0]===yDe&&(i=`${s[0][1]}-${s[1][1]}-udp`),i==null)continue;const o=this.mappings.get(i);if(o!=null)for(const a of o)s[0][0]=a.externalFamily===4?VE:HE,s[0][1]=a.externalIp,s[1][1]=`${a.externalPort}`,t.push({multiaddr:Ve(`/${s.map(c=>[We(c[0]).name,c[1]].join("/")).join("/")}`),verified:a.verified,type:"ip-mapping",expires:a.expires,lastVerified:a.lastVerified})}return t}confirm(e,t){const s=e.stringTuples()[0][1];let i=!1;for(const o of this.mappings.values())for(const a of o)a.externalIp===s&&(this.log("marking %s to %s IP mapping as verified",a.internalIp,a.externalIp),i=a.verified,a.verified=!0,a.expires=Date.now()+t,a.lastVerified=Date.now());return i}unconfirm(e,t){const n=e.stringTuples(),s=n[0][1]??"",i=n[1][0]===KE?"tcp":"udp",o=parseInt(n[1][1]??"0");let a=!1;for(const c of this.mappings.values())for(let l=0;l<c.length;l++){const u=c[l];u.externalIp===s&&u.externalPort===o&&u.protocol===i&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",u.externalIp,u.externalPort,s,o,i),a=a||u.verified,u.verified=!1,u.expires=Date.now()+t)}return a}}const wDe=4,bDe=41;function vDe(r){try{const[[e,t]]=r.stringTuples();if(t==null)return!1;if(e===wDe)return t.startsWith("169.254.");if(e===bDe)return t.toLowerCase().startsWith("fe80")}catch{}return!1}const EDe={maxObservedAddresses:10};class xDe{constructor(e,t={}){h(this,"log");h(this,"addresses");h(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??EDe.maxObservedAddresses}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(const t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&(Jd(e)||vDe(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:Ve(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){var n;const t=((n=this.addresses.get(e.toString()))==null?void 0:n.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){const n=e.toString(),s=this.addresses.get(n)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},i=s.verified;return s.verified=!0,s.expires=Date.now()+t,s.lastVerified=Date.now(),this.log("marking observed address %a as verified",n),this.addresses.set(n,s),i}}const ADe=4,SDe=41,CDe=53,IDe=54,kDe=55,TDe=56,_De=[ADe,SDe,CDe,IDe,kDe,TDe];function HU(r){try{const[[e]]=r.stringTuples();return _De.includes(e)}catch{}return!1}const PDe={maxObservedAddresses:10};class NDe{constructor(e,t={}){h(this,"log");h(this,"addresses");h(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??PDe.maxObservedAddresses}get(e,t){if(Jd(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};const n=this.toKey(e);let s=this.addresses.get(n);return s==null&&(s={verified:!HU(e),expires:0},this.addresses.set(n,s)),{multiaddr:e,verified:s.verified,type:"transport",expires:s.expires,lastVerified:s.lastVerified}}has(e){const t=this.toKey(e);return this.addresses.has(t)}remove(e){var s;const t=this.toKey(e),n=((s=this.addresses.get(t))==null?void 0:s.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),n}confirm(e,t){const n=this.toKey(e),s=this.addresses.get(n)??{verified:!1,expires:0,lastVerified:0},i=s.verified;return s.verified=!0,s.expires=Date.now()+t,s.lastVerified=Date.now(),this.addresses.set(n,s),i}unconfirm(e,t){const n=this.toKey(e),s=this.addresses.get(n)??{verified:!1,expires:0},i=s.verified;return s.verified=!1,s.expires=Date.now()+t,this.addresses.set(n,s),i}toKey(e){if(HU(e)){const t=e.toOptions();return`${t.host}-${t.port}-${t.transport}`}return e.toString()}}const KU=6e4,GU={addressVerificationTTL:KU*10,addressVerificationRetry:KU*5},DDe=r=>r;function GE(r,e){const t=r.getPeerId();return t!=null&&mr(t).equals(e)&&(r=r.decapsulate(Ve(`/p2p/${e.toString()}`))),r}var $V;$V=Symbol.toStringTag;class ODe{constructor(e,t={}){h(this,"log");h(this,"components");h(this,"listen");h(this,"announce");h(this,"appendAnnounce");h(this,"announceFilter");h(this,"observed");h(this,"dnsMappings");h(this,"ipMappings");h(this,"transportAddresses");h(this,"observedAddressFilter");h(this,"addressVerificationTTL");h(this,"addressVerificationRetry");h(this,$V,"@libp2p/address-manager");const{listen:n=[],announce:s=[],appendAnnounce:i=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=n.map(o=>o.toString()),this.announce=new Set(s.map(o=>o.toString())),this.appendAnnounce=new Set(i.map(o=>o.toString())),this.observed=new xDe(e,t),this.dnsMappings=new gDe(e,t),this.ipMappings=new mDe(e,t),this.transportAddresses=new NDe(e,t),this.announceFilter=t.announceFilter??DDe,this.observedAddressFilter=jd(1024),this.addressVerificationTTL=t.addressVerificationTTL??GU.addressVerificationTTL,this.addressVerificationRetry=t.addressVerificationRetry??GU.addressVerificationRetry,this._updatePeerStoreAddresses=lDe(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}_updatePeerStoreAddresses(){const e=this.getAddresses().map(t=>t.getPeerId()===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(t=>{this.log.error("error updating addresses",t)})}getListenAddrs(){return Array.from(this.listen).map(e=>Ve(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>Ve(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>Ve(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){const t=e.stringTuples(),n=`${t[0][1]}:${t[1][1]}`;this.observedAddressFilter.has(n)||(this.observedAddressFilter.add(n),e=GE(e,this.components.peerId),!this.ipMappings.has(e)&&(this.dnsMappings.has(e)||this.observed.add(e)))}confirmObservedAddr(e,t){e=GE(e,this.components.peerId);let n=!0;((t==null?void 0:t.type)==="transport"||this.transportAddresses.has(e))&&!this.transportAddresses.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="dns-mapping"||this.dnsMappings.has(e))&&!this.dnsMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="ip-mapping"||this.ipMappings.has(e))&&!this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="observed"||this.observed.has(e))&&(this.maybeUpgradeToIPMapping(e)?(this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL),n=!1):!this.observed.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1)),n||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=GE(e,this.components.peerId),this.observed.has(e)&&this.observed.remove(e),this.transportAddresses.has(e)&&this.transportAddresses.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.dnsMappings.has(e)&&this.dnsMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.ipMappings.has(e)&&this.ipMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry)}getAddresses(){const e=new Set,t=this.getAddressesWithMetadata().filter(n=>{if(!n.verified)return!1;const s=n.multiaddr.toString();return e.has(s)?!1:(e.add(s),!0)}).map(n=>n.multiaddr);return this.announceFilter(t.map(n=>{var i;const s=Ve(n);return((i=s.protos().pop())==null?void 0:i.path)===!0||s.getPeerId()===this.components.peerId.toString()?s:s.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){const e=this.getAnnounceAddrs();if(e.length>0)return this.components.transportManager.getListeners().forEach(s=>{s.updateAnnounceAddrs(e)}),e.map(s=>({multiaddr:s,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];t=t.concat(this.components.transportManager.getAddrs().map(s=>this.transportAddresses.get(s,this.addressVerificationTTL)));const n=this.getAppendAnnounceAddrs();return n.length>0&&(this.components.transportManager.getListeners().forEach(s=>{s.updateAnnounceAddrs(n)}),t=t.concat(n.map(s=>({multiaddr:s,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),t=t.concat(this.observed.getAll()),t=t.concat(this.ipMappings.getAll(t)),t=t.concat(this.dnsMappings.getAll(t)),t}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove(Ve(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,n,s=t,i="tcp"){this.ipMappings.add(e,t,n,s,i),this.observed.removePrefixed(`/ip${u1(n)?4:6}/${n}/${i}/${s}`)}removePublicAddressMapping(e,t,n,s=t,i="tcp"){this.ipMappings.remove(Ve(`/ip${u1(n)?4:6}/${n}/${i}/${s}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(e){if(this.ipMappings.has(e))return!1;const t=e.toOptions();if(t.family===6||t.host==="127.0.0.1"||ah(t.host)===!0)return!1;const n=this.components.transportManager.getListeners(),s=[i=>Iy.exactMatch(i)||ab.exactMatch(i),i=>ob.exactMatch(i),i=>Z3e.exactMatch(i)];for(const i of s){if(!i(e))continue;const o=n.filter(l=>l.getAddrs().filter(u=>u.toOptions().family===4&&i(u)).length>0);if(o.length!==1)continue;const a=o[0].getAddrs().filter(l=>l.toOptions().host!=="127.0.0.1").pop();if(a==null)continue;const c=a.toOptions();return this.observed.remove(e),this.ipMappings.add(c.host,c.port,t.host,t.port,t.transport),!0}return!1}}var jU;(function(r){r.NOT_STARTED_YET="The libp2p node is not started yet",r.NOT_FOUND="Not found"})(jU||(jU={}));class RDe extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}}class BDe extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}}class jE extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}}class qU extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}}class MDe extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}}class $De extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}}class LDe extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}}class WU extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}}class UDe extends Error{constructor(e="No transport was configured to listen on this address"){super(e),this.name="UnsupportedListenAddressError"}}class FDe extends Error{constructor(e="Configured listen addresses could not be listened on"){super(e),this.name="UnsupportedListenAddressesError"}}class zDe extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}}class VDe extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}}class HDe extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}}class A3 extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}}class S3 extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}}class KDe extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}}class GDe{constructor(e={}){h(this,"components",{});h(this,"_started",!1);this.components={};for(const[t,n]of Object.entries(e))this.components[t]=n;this.components.logger==null&&(this.components.logger=nv())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(t=>r_(t)).map(async t=>{var n;await((n=t[e])==null?void 0:n.call(t))}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const jDe=["metrics","connectionProtector","dns"],qDe=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function WDe(r={}){const e=new GDe(r);return new Proxy(e,{get(n,s,i){if(typeof s=="string"&&!qDe.includes(s)){const o=e.components[s];if(o==null&&!jDe.includes(s))throw new RDe(`${s} not set`);return o}return Reflect.get(n,s,i)},set(n,s,i){return typeof s=="string"?e.components[s]=i:Reflect.set(n,s,i),!0}})}function QDe(r){const e={};for(const t of Object.values(r.components))for(const n of JDe(t))e[n]=!0;for(const t of Object.values(r.components))for(const n of YDe(t))if(e[n]!==!0)throw new BDe(`Service "${XDe(t)}" required capability "${n}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function JDe(r){return Array.isArray(r==null?void 0:r[Lr])?r[Lr]:[]}function YDe(r){return Array.isArray(r==null?void 0:r[Lu])?r[Lu]:[]}function XDe(r){return(r==null?void 0:r[Symbol.toStringTag])??(r==null?void 0:r.toString())??"unknown"}const ZDe=4,eOe=41;function tOe(r={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{if(Iy.matches(e))return!1;const t=e.stringTuples();return t[0][0]===ZDe||t[0][0]===eOe?!!ah(`${t[0][1]}`):!1},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...r}}function gee(r){if(_j(r))return{peerId:r,multiaddrs:[]};let e=Array.isArray(r)?r:[r],t;if(e.length>0){const n=e[0].getPeerId();t=n==null?void 0:mr(n),e.forEach(s=>{if(!pv(s))throw new L5("Invalid multiaddr");const i=s.getPeerId();if(i==null){if(t!=null)throw new ie("Multiaddrs must all have the same peer id or have no peer id")}else{const o=mr(i);if((t==null?void 0:t.equals(o))!==!0)throw new ie("Multiaddrs must all have the same peer id or have no peer id")}})}return e=e.filter(n=>!Q3e.exactMatch(n)),{peerId:t,multiaddrs:e}}const rOe=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function nOe(r,e){var s;const t=((s=r==null?void 0:r.streams)==null?void 0:s.map(i=>i.protocol))??[],n=(e==null?void 0:e.closableProtocols)??rOe;if(!(t.filter(i=>i!=null&&!n.includes(i)).length>0))try{await(r==null?void 0:r.close(e))}catch(i){r==null||r.abort(i)}}const yee=1e4,sOe=1e4,QU=1e4,mee=25,iOe=5,oOe=10,aOe=5,cOe="last-dial-failure",lOe="last-dial-success",wee=500,bee=100,vee=50;async function uOe(r,e){let t=!1;for(const s of sP.keys())if(t=r.protoNames().includes(s),t)break;if(!t)return[r];const n=await r.resolve(e);return e.log("resolved %s to",r,n.map(s=>s.toString())),n}function FI(r){try{let e;if(typeof r=="string"?e=Ve(r):e=r,!e.protoNames().includes("ipcidr")){const n=e.protoNames().includes("ip6")?"/ipcidr/128":"/ipcidr/32";e=e.encapsulate(n)}return F8e(e)}catch{throw new Error(`Can't convert to IpNet, Invalid multiaddr format: ${r}`)}}const hOe={maxConnections:bee};class dOe{constructor(e,t={}){h(this,"maxConnections");h(this,"connectionManager");h(this,"peerStore");h(this,"allow");h(this,"events");h(this,"log");this.maxConnections=t.maxConnections??hOe.maxConnections,this.allow=(t.allow??[]).map(n=>FI(n)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections %e",e)})}async _maybePruneConnections(){const e=this.connectionManager.getConnections(),t=e.length;if(this.log("checking max connections limit %d/%d",t,this.maxConnections),t<=this.maxConnections)return;const n=new oh;for(const a of e){const c=a.remotePeer;if(!n.has(c)){n.set(c,0);try{const l=await this.peerStore.get(c);n.set(c,[...l.tags.values()].reduce((u,d)=>u+d.value,0))}catch(l){l.name!=="NotFoundError"&&this.log.error("error loading peer tags",l)}}}const s=this.sortConnections(e,n),i=Math.max(t-this.maxConnections,0),o=[];for(const a of s)if(this.log("too many connections open - closing a connection to %p",a.remotePeer),this.allow.some(l=>l.contains(a.remoteAddr.nodeAddress().address))||o.push(a),o.length===i)break;await Promise.all(o.map(async a=>{await nOe(a,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:o})}sortConnections(e,t){return e.sort((n,s)=>{const i=n.timeline.open,o=s.timeline.open;return i<o?1:i>o?-1:0}).sort((n,s)=>n.direction==="outbound"&&s.direction==="inbound"?1:n.direction==="inbound"&&s.direction==="outbound"?-1:0).sort((n,s)=>n.streams.length>s.streams.length?1:n.streams.length<s.streams.length?-1:0).sort((n,s)=>{const i=t.get(n.remotePeer)??0,o=t.get(s.remotePeer)??0;return i>o?1:i<o?-1:0})}}class fOe extends Gd{constructor(e={}){super({...e,sort:(t,n)=>t.options.priority>n.options.priority?-1:t.options.priority<n.options.priority?1:0})}}function pOe(r){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r)||/^::1$/.test(r)}function JU(r){if(!sY(r))return!1;const{address:e}=r.nodeAddress();return pOe(e)}function gOe(r,e){const t=ob.exactMatch(r.multiaddr),n=ob.exactMatch(e.multiaddr);if(t&&!n)return-1;if(!t&&n)return 1;const s=ab.exactMatch(r.multiaddr),i=ab.exactMatch(e.multiaddr);if(s&&!i)return-1;if(!s&&i)return 1;const o=Iy.exactMatch(r.multiaddr),a=Iy.exactMatch(e.multiaddr);if(o&&!a)return-1;if(!o&&a)return 1;const c=vS.exactMatch(r.multiaddr),l=vS.exactMatch(e.multiaddr);if(c&&!l)return-1;if(!c&&l)return 1;const u=bS.exactMatch(r.multiaddr),d=bS.exactMatch(e.multiaddr);if(u&&!d)return-1;if(!u&&d)return 1;const p=UB.exactMatch(r.multiaddr),y=UB.exactMatch(e.multiaddr);return p&&!y?-1:!p&&y?1:0}function yOe(r,e){const t=JU(r.multiaddr),n=JU(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function mOe(r,e){const t=Jd(r.multiaddr),n=Jd(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function wOe(r,e){return r.isCertified&&!e.isCertified?-1:!r.isCertified&&e.isCertified?1:0}function bOe(r,e){const t=Hu.exactMatch(r.multiaddr),n=Hu.exactMatch(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function vOe(r){return r.sort(gOe).sort(wOe).sort(bOe).sort(mOe).sort(yOe)}const C3={maxParallelDials:vee,maxDialQueueLength:wee,maxPeerAddrsToDial:mee,dialTimeout:yee};class EOe{constructor(e,t={}){h(this,"queue");h(this,"components");h(this,"addressSorter");h(this,"maxPeerAddrsToDial");h(this,"maxDialQueueLength");h(this,"dialTimeout");h(this,"shutDownController");h(this,"connections");h(this,"log");this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??C3.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??C3.maxDialQueueLength,this.dialTimeout=t.dialTimeout??C3.dialTimeout,this.connections=t.connections??new oh,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.shutDownController=new AbortController,this.shutDownController.signal;for(const[n,s]of Object.entries(t.resolvers??{}))sP.set(n,s);this.queue=new fOe({concurrency:t.maxParallelDials??C3.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",n=>{var s;((s=n.detail)==null?void 0:s.name)!==Vd.name&&this.log.error("error in dial queue - %e",n.detail)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e,t={}){var a,c,l;const{peerId:n,multiaddrs:s}=gee(e),i=Array.from(this.connections.values()).flat().find(u=>t.force===!0?!1:u.remotePeer.equals(n)?!0:s.find(d=>d.equals(u.remoteAddr)));if((i==null?void 0:i.status)==="open")return this.log("already connected to %a",i.remoteAddr),(a=t.onProgress)==null||a.call(t,new Re("dial-queue:already-connected")),i;const o=this.queue.queue.find(u=>{if((n==null?void 0:n.equals(u.options.peerId))===!0)return!0;const d=u.options.multiaddrs;if(d==null)return!1;for(const p of s)if(d.has(p.toString()))return!0;return!1});if(o!=null){this.log("joining existing dial target for %p",n);for(const u of s)o.options.multiaddrs.add(u.toString());return(c=t.onProgress)==null||c.call(t,new Re("dial-queue:already-in-dial-queue")),o.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new Rp("Dial queue is full");return this.log("creating dial target for %p",n,s.map(u=>u.toString())),(l=t.onProgress)==null||l.call(t,new Re("dial-queue:add-to-dial-queue")),this.queue.add(async u=>{var p;(p=u.onProgress)==null||p.call(u,new Re("dial-queue:start-dial"));const d=At([this.shutDownController.signal,u.signal]);try{return await this.dialPeer(u,d)}finally{d.clear()}},{peerId:n,priority:t.priority??xee,multiaddrs:new Set(s.map(u=>u.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})}async dialPeer(e,t){var u;const n=e.peerId,s=e.multiaddrs,i=new Set;let o=e.multiaddrs.size===0,a=0,c=0;const l=[];for(this.log("starting dial to %p",n);o||s.size>0;){c++,o=!1;const d=[],p=new Set(e.multiaddrs);s.clear(),this.log("calculating addrs to dial %p from %s",n,[...p]);const y=await this.calculateMultiaddrs(n,p,{...e,signal:t});for(const f of y){if(i.has(f.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",f.multiaddr,n);continue}d.push(f)}this.log("%s dial to %p with %s",c===1?"starting":"continuing",n,d.map(f=>f.multiaddr.toString())),(u=e==null?void 0:e.onProgress)==null||u.call(e,new Re("dial-queue:calculated-addresses",d));for(const f of d){if(a===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",a,e.peerId),new Rp("Peer had more than maxPeerAddrsToDial");a++;try{const g=await this.components.transportManager.dial(f.multiaddr,{...e,signal:t});this.log("dial to %a succeeded",f.multiaddr);try{await this.components.peerStore.merge(g.remotePeer,{multiaddrs:[g.remoteAddr],metadata:{[lOe]:he(Date.now().toString())}})}catch(w){this.log.error("could not update last dial failure key for %p",n,w)}return g}catch(g){if(this.log.error("dial failed to %a",f.multiaddr,g),i.add(f.multiaddr.toString()),n!=null)try{await this.components.peerStore.merge(n,{metadata:{[cOe]:he(Date.now().toString())}})}catch(w){this.log.error("could not update last dial failure key for %p",n,w)}if(t.aborted)throw new Rm(g.message);l.push(g)}}}throw l.length===1?l[0]:new AggregateError(l,"All multiaddr dials failed")}async calculateMultiaddrs(e,t=new Set,n={}){var d,p;const s=[...t].map(y=>({multiaddr:Ve(y),isCertified:!1}));if(e!=null){if(this.components.peerId.equals(e))throw new Rp("Tried to dial self");if(await((p=(d=this.components.connectionGater).denyDialPeer)==null?void 0:p.call(d,e))===!0)throw new WU("The dial request is blocked by gater.allowDialPeer");if(s.length===0){this.log("loading multiaddrs for %p",e);try{const y=await this.components.peerStore.get(e);s.push(...y.addresses),this.log("loaded multiaddrs for %p",e,s.map(({multiaddr:f})=>f.toString()))}catch(y){if(y.name!=="NotFoundError")throw y}}if(s.length===0){this.log("looking up multiaddrs for %p in the peer routing",e);try{const y=await this.components.peerRouting.findPeer(e,n);this.log("found multiaddrs for %p in the peer routing",e,s.map(({multiaddr:f})=>f.toString())),s.push(...y.multiaddrs.map(f=>({multiaddr:f,isCertified:!1})))}catch(y){y.name==="NoPeerRoutersError"?this.log("no peer routers configured",e):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",e,y)}}}let i=(await Promise.all(s.map(async y=>{const f=await uOe(y.multiaddr,{dns:this.components.dns,...n,log:this.log});return f.length===1&&f[0].equals(y.multiaddr)?y:f.map(g=>({multiaddr:g,isCertified:!1}))}))).flat();if(e!=null){const y=`/p2p/${e.toString()}`;i=i.map(f=>{const g=f.multiaddr.protos().pop();return(g==null?void 0:g.path)===!0?f:f.multiaddr.getPeerId()==null?{multiaddr:f.multiaddr.encapsulate(y),isCertified:f.isCertified}:f})}const o=i.filter(y=>{if(this.components.transportManager.dialTransportForMultiaddr(y.multiaddr)==null)return!1;const f=y.multiaddr.getPeerId();return e!=null&&f!=null?e.equals(f):!0}),a=new Map;for(const y of o){const f=y.multiaddr.toString(),g=a.get(f);if(g!=null){g.isCertified=g.isCertified||y.isCertified||!1;continue}a.set(f,y)}const c=[...a.values()];if(c.length===0)throw new zDe("The dial request has no valid addresses");const l=[];for(const y of c)this.components.connectionGater.denyDialMultiaddr!=null&&await this.components.connectionGater.denyDialMultiaddr(y.multiaddr)||l.push(y);const u=this.addressSorter==null?vOe(l):l.sort(this.addressSorter);if(u.length===0)throw new WU("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",i.map(({multiaddr:y})=>y.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",u.map(({multiaddr:y})=>y.toString())),u}async isDialable(e,t={}){Array.isArray(e)||(e=[e]);try{const n=await this.calculateMultiaddrs(void 0,new Set(e.map(s=>s.toString())),t);return t.runOnLimitedConnection===!1?n.find(s=>!Hu.matches(s.multiaddr))!=null:!0}catch(n){this.log.trace("error calculating if multiaddr(s) were dialable",n)}return!1}}var Eee={};function Vi(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var xOe=Vi;Vi.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Vi.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Vi.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};Vi.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Vi.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};Vi.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};Vi.prototype.start=Vi.prototype.try;Vi.prototype.errors=function(){return this._errors};Vi.prototype.attempts=function(){return this._attempts};Vi.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var s=this._errors[n],i=s.message,o=(r[i]||0)+1;r[i]=o,o>=t&&(e=s,t=o)}return e};(function(r){var e=xOe;r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)n[s]=t[s];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],o=0;o<n.retries;o++)i.push(this.createTimeout(o,n));return t&&t.forever&&!i.length&&i.push(this.createTimeout(o,n)),i.sort(function(a,c){return a-c}),i},r.createTimeout=function(t,n){var s=n.randomize?Math.random()+1:1,i=Math.round(s*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return i=Math.min(i,n.maxTimeout),i},r.wrap=function(t,n,s){if(n instanceof Array&&(s=n,n=null),!s){s=[];for(var i in t)typeof t[i]=="function"&&s.push(i)}for(var o=0;o<s.length;o++){var a=s[o],c=t[a];t[a]=(function(u){var d=r.operation(n),p=Array.prototype.slice.call(arguments,1),y=p.pop();p.push(function(f){d.retry(f)||(f&&(arguments[0]=d.mainError()),y.apply(this,arguments))}),d.attempt(function(){u.apply(t,p)})}).bind(t,c),t[a].options=n}}})(Eee);var AOe=Eee;const SOe=Zu(AOe),COe=Object.prototype.toString,IOe=r=>COe.call(r)==="[object Error]",kOe=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function TOe(r){return r&&IOe(r)&&r.name==="TypeError"&&typeof r.message=="string"?r.message==="Load failed"?r.stack===void 0:kOe.has(r.message):!1}class _Oe extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const YU=(r,e,t)=>{const n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r};async function POe(r,e){return new Promise((t,n)=>{e={...e},e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.retries??(e.retries=10);const s=SOe.operation(e),i=()=>{var a;s.stop(),n((a=e.signal)==null?void 0:a.reason)};e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",i,{once:!0});const o=()=>{var a;(a=e.signal)==null||a.removeEventListener("abort",i),s.stop()};s.attempt(async a=>{try{const c=await r(a);o(),t(c)}catch(c){try{if(!(c instanceof Error))throw new TypeError(`Non-error was thrown: "${c}". You should only throw errors.`);if(c instanceof _Oe)throw c.originalError;if(c instanceof TypeError&&!TOe(c))throw c;if(YU(c,a,e),await e.shouldRetry(c)||(s.stop(),n(c)),await e.onFailedAttempt(c),!s.retry(c))throw s.mainError()}catch(l){YU(l,a,e),o(),n(l)}}})})}class NOe{constructor(e,t={}){h(this,"log");h(this,"queue");h(this,"started");h(this,"peerStore");h(this,"retries");h(this,"retryInterval");h(this,"backoffFactor");h(this,"connectionManager");h(this,"events");this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new zu({concurrency:t.maxParallelReconnects??aOe,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",n=>{this.maybeReconnect(n.detail).catch(s=>{this.log.error("failed to maybe reconnect to %p - %e",n.detail,s)})})}async maybeReconnect(e){if(!this.started)return;const t=await this.peerStore.get(e);XU(t)&&(this.queue.has(e)||this.queue.add(async n=>{await POe(async s=>{if(this.started)try{await this.connectionManager.openConnection(e,{signal:n==null?void 0:n.signal})}catch(i){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,s,this.retries,i),i}},{signal:n==null?void 0:n.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:e}).catch(async n=>{this.log.error("failed to reconnect to %p - %e",e,n);const s={};[...t.tags.keys()].forEach(i=>{i.startsWith(M5)&&(s[i]=void 0)}),await this.peerStore.merge(e,{tags:s}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})}).catch(async n=>{this.log.error("failed to remove keep-alive tag from %p - %e",e,n)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[t=>XU(t)]});await Promise.all(e.map(async t=>{await this.connectionManager.openConnection(t.id).catch(n=>{this.log.error(n)})}))}).catch(e=>{this.log.error(e)})}stop(){this.started=!1,this.queue.abort()}}function XU(r){for(const e of r.tags.keys())if(e.startsWith(M5))return!0;return!1}const xee=50,qE={maxConnections:bee,inboundConnectionThreshold:iOe,maxIncomingPendingConnections:oOe};var LV;LV=Symbol.toStringTag;class DOe{constructor(e,t={}){h(this,"started");h(this,"connections");h(this,"allow");h(this,"deny");h(this,"maxIncomingPendingConnections");h(this,"incomingPendingConnections");h(this,"outboundPendingConnections");h(this,"maxConnections");h(this,"dialQueue");h(this,"reconnectQueue");h(this,"connectionPruner");h(this,"inboundConnectionRateLimiter");h(this,"peerStore");h(this,"metrics");h(this,"events");h(this,"log");h(this,"peerId");h(this,LV,"@libp2p/connection-manager");var n;if(this.maxConnections=t.maxConnections??qE.maxConnections,this.maxConnections<1)throw new ie("Connection Manager maxConnections must be greater than 0");this.connections=new oh,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(s=>FI(s)),this.deny=(t.deny??[]).map(s=>FI(s)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??qE.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new qX({points:t.inboundConnectionThreshold??qE.inboundConnectionThreshold,duration:1}),this.connectionPruner=new dOe({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{maxConnections:this.maxConnections,allow:(n=t.allow)==null?void 0:n.map(s=>Ve(s))}),this.dialQueue=new EOe(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??vee,maxDialQueueLength:t.maxDialQueueLength??wee,maxPeerAddrsToDial:t.maxPeerAddrsToDial??mee,dialTimeout:t.dialTimeout??yee,resolvers:t.resolvers??{dnsaddr:iee},connections:this.connections}),this.reconnectQueue=new NOe({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}async start(){var e,t,n;(e=this.metrics)==null||e.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const s={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(const i of this.connections.values())for(const o of i)s[o.direction]++;return s}}),(t=this.metrics)==null||t.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const s={};for(const i of this.connections.values())for(const o of i)for(const a of o.streams){const c=`${a.direction} ${a.protocol??"unnegotiated"}`;s[c]=(s[c]??0)+1}return s}}),(n=this.metrics)==null||n.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const s={};for(const o of this.connections.values())for(const a of o){const c={};for(const l of a.streams){const u=`${l.direction} ${l.protocol??"unnegotiated"}`;c[u]=(c[u]??0)+1}for(const[l,u]of Object.entries(c))s[l]=s[l]??[],s[l].push(u)}const i={};for(let[o,a]of Object.entries(s)){a=a.sort((l,u)=>l-u);const c=Math.floor(a.length*.9);i[o]=a[c]}return i}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await Oc(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await sh(this.reconnectQueue,this.dialQueue,this.connectionPruner);const e=[];for(const t of this.connections.values())for(const n of t)e.push((async()=>{try{await n.close()}catch(s){this.log.error(s)}})());this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}onConnect(e){this._onConnect(e).catch(t=>{this.log.error(t)})}async _onConnect(e){const{detail:t}=e;if(!this.started){await t.close();return}if(t.status!=="open")return;const n=t.remotePeer,s=!this.connections.has(n),i=this.connections.get(n)??[];i.push(t),this.connections.set(n,i),n.publicKey!=null&&n.type==="RSA"&&await this.peerStore.patch(n,{publicKey:n.publicKey}),s&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){const{detail:t}=e,n=t.remotePeer,i=(this.connections.get(n)??[]).filter(o=>o.id!==t.id);this.connections.set(n,i),i.length===0&&(this.log("onDisconnect remove all connections for peer %p",n),this.connections.delete(n),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let t=[];for(const n of this.connections.values())t=t.concat(n);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){var n,s;if(!this.started)throw new Hd("Not started");this.outboundPendingConnections++;try{(n=t.signal)==null||n.throwIfAborted();const{peerId:i}=gee(e);if(this.peerId.equals(i))throw new e_("Can not dial self");if(i!=null&&t.force!==!0){this.log("dial %p",i);const l=this.getConnections(i).find(u=>u.limits==null);if(l!=null)return this.log("had an existing non-limited connection to %p",i),(s=t.onProgress)==null||s.call(t,new Re("dial-queue:already-connected")),l}const o=await this.dialQueue.dial(e,{...t,priority:t.priority??xee});if(o.status!=="open")throw new XT("Remote closed connection during opening");let a=this.connections.get(o.remotePeer);a==null&&(a=[],this.connections.set(o.remotePeer,a));let c=!1;for(const l of a)if(l.id===o.id&&(c=!0),t.force!==!0&&l.id!==o.id&&l.remoteAddr.equals(o.remoteAddr))return o.abort(new L5("Duplicate multiaddr connection")),l;return c||a.push(o),o}finally{this.outboundPendingConnections--}}async closeConnections(e,t={}){const n=this.connections.get(e)??[];await Promise.all(n.map(async s=>{try{await s.close(t)}catch(i){s.abort(i)}}))}async acceptIncomingConnection(e){if(this.deny.some(s=>s.contains(e.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(s=>s.contains(e.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const s=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(s,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,s),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(n=>Ve(n))}))}async isDialable(e,t={}){return this.dialQueue.isDialable(e,t)}}const OOe=1e4,ROe="1.0.0",BOe="ping",MOe="ipfs",ZU=32,$Oe=!0;var UV,FV;FV=Symbol.toStringTag,UV=Lr;class LOe{constructor(e,t={}){h(this,"protocol");h(this,"components");h(this,"log");h(this,"heartbeatInterval");h(this,"pingIntervalMs");h(this,"abortController");h(this,"timeout");h(this,"abortConnectionOnPingFailure");h(this,FV,"@libp2p/connection-monitor");h(this,UV,["@libp2p/connection-monitor"]);this.components=e,this.protocol=`/${t.protocolPrefix??MOe}/${BOe}/${ROe}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??OOe,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??$Oe,this.timeout=new Dy({...t.pingTimeout??{},metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(async()=>{var n;let t=Date.now();try{const s=this.timeout.getTimeoutSignal({signal:(n=this.abortController)==null?void 0:n.signal}),i=await e.newStream(this.protocol,{signal:s,runOnLimitedConnection:!0}),o=Cb(i);t=Date.now(),await Promise.all([o.write(Fu(ZU),{signal:s}),o.read({bytes:ZU,signal:s})]),e.rtt=Date.now()-t,await o.unwrap().close({signal:s})}catch(s){if(s.name!=="UnsupportedProtocolError")throw s;e.rtt=(Date.now()-t)/2}}).catch(t=>{this.log.error("error during heartbeat",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){var e;(e=this.abortController)==null||e.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}}var zV;zV=Symbol.toStringTag;class UOe{constructor(e,t){h(this,"routers");h(this,"started");h(this,"components");h(this,zV,"@libp2p/content-routing");var n,s,i,o,a;this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()}),getAttributesFromYieldedValue:(c,l)=>({...l,providers:[...Array.isArray(l.providers)?l.providers:[],c.id.toString()]})}))??this.findProviders,this.provide=((s=e.metrics)==null?void 0:s.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.provide,this.cancelReprovide=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.cancelReprovide,this.put=((o=e.metrics)==null?void 0:o.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([c])=>({key:ce(c,"base36")})}))??this.put,this.get=((a=e.metrics)==null?void 0:a.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([c])=>({key:ce(c,"base36")})}))??this.get}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw new jE("No content routers available");const n=this,s=new Eo;for await(const i of Su(...n.routers.map(o=>o.findProviders(e,t))))i!=null&&(i.multiaddrs.length>0&&await this.components.peerStore.merge(i.id,{multiaddrs:i.multiaddrs}),!s.has(i.id)&&(s.add(i.id),yield i))}async provide(e,t={}){if(this.routers.length===0)throw new jE("No content routers available");await Promise.all(this.routers.map(async n=>{await n.provide(e,t)}))}async cancelReprovide(e,t={}){if(this.routers.length===0)throw new jE("No content routers available");await Promise.all(this.routers.map(async n=>{await n.cancelReprovide(e,t)}))}async put(e,t,n){if(!this.isStarted())throw new Hd;await Promise.all(this.routers.map(async s=>{await s.put(e,t,n)}))}async get(e,t){if(!this.isStarted())throw new Hd;return Promise.any(this.routers.map(async n=>n.get(e,t)))}}var VV;VV=Symbol.toStringTag;class FOe{constructor(e,t={}){h(this,"log");h(this,"peerId");h(this,"peerStore");h(this,"routers");h(this,VV,"@libp2p/peer-routing");var n,s;this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([i],o)=>({...o,peer:i.toString()})}))??this.findPeer,this.getClosestPeers=((s=e.metrics)==null?void 0:s.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([i],o)=>({...o,key:ce(i,"base36")}),getAttributesFromYieldedValue:(i,o)=>({...o,peers:[...Array.isArray(o.peers)?o.peers:[],i.id.toString()]})}))??this.getClosestPeers}async findPeer(e,t){if(this.routers.length===0)throw new qU("No peer routers available");if(e.toString()===this.peerId.toString())throw new MDe("Should not try to find self");const n=this,s=Su(...this.routers.map(i=>async function*(){try{yield await i.findPeer(e,t)}catch(o){n.log.error(o)}}()));for await(const i of s)if(i!=null)return i.multiaddrs.length>0&&await this.peerStore.merge(i.id,{multiaddrs:i.multiaddrs}),i;throw new vr}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new qU("No peer routers available");const n=this,s=jd(1024);for await(const i of Km(async function*(){const o=Su(...n.routers.map(a=>a.getClosestPeers(e,t)));for await(let a of o)yield async()=>{if(a.multiaddrs.length===0)try{a=await n.findPeer(a.id,{...t,useCache:!1})}catch(c){n.log.error("could not find peer multiaddrs",c);return}return a}}()))i!=null&&(i.multiaddrs.length>0&&await this.peerStore.merge(i.id,{multiaddrs:i.multiaddrs}),!s.has(i.id.toMultihash().bytes)&&(s.add(i.id.toMultihash().bytes),yield i))}}var HV,KV;class zOe extends(KV=Er,HV=Symbol.toStringTag,KV){constructor(t){super();h(this,"peerRouting");h(this,"log");h(this,"walking");h(this,"walkers");h(this,"shutdownController");h(this,"walkController");h(this,"needNext");h(this,HV,"@libp2p/random-walk");this.log=t.logger.forComponent("libp2p:random-walk"),this.peerRouting=t.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}async*walk(t){var s,i;this.walking||this.startWalk(),this.walkers++;const n=At([this.shutdownController.signal,t==null?void 0:t.signal]);try{for(;;)(s=this.needNext)==null||s.resolve(),this.needNext=He(),yield(await Di(this,"walk:peer",n,{errorEvent:"walk:error"})).detail}finally{n.clear(),this.walkers--,this.walkers===0&&((i=this.walkController)==null||i.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;const t=At([this.walkController.signal,this.shutdownController.signal]),n=Date.now();let s=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const i=Fu(32);let o=Date.now();for await(const a of this.peerRouting.getClosestPeers(i,{signal:t}))t.aborted&&this.log("aborting walk"),t.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",a.id,Date.now()-o,this.walkers),s++,this.safeDispatchEvent("walk:peer",{detail:a}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),await Vn(this.needNext.promise,t)),o=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",i,this.walkers,s)}catch(i){this.log.error("random walk errored",i),this.safeDispatchEvent("walk:error",{detail:i})}this.log("no walkers left, ended walk")}).catch(i=>{this.log.error("random walk errored",i)}).finally(()=>{this.log("finished walk, found %d peers after %dms",s,Date.now()-n),this.walking=!1})}}const Aee=32,See=64;var GV;GV=Symbol.toStringTag;class VOe{constructor(e){h(this,"log");h(this,"topologies");h(this,"handlers");h(this,"components");h(this,GV,"@libp2p/registrar");this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(t==null)throw new $De(`No handler registered for protocol ${e}`);return t}getTopologies(e){const t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,n){if(this.handlers.has(e)&&(n==null?void 0:n.force)!==!0)throw new LDe(`Handler already registered for protocol ${e}`);const s=CP.bind({ignoreUndefined:!0})({maxInboundStreams:Aee,maxOutboundStreams:See},n);this.handlers.set(e,{handler:t,options:s}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]})}async unhandle(e){(Array.isArray(e)?e:[e]).forEach(n=>{this.handlers.delete(n)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(e,t){if(t==null)throw new ie("invalid topology");const n=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let s=this.topologies.get(e);return s==null&&(s=new Map,this.topologies.set(e,s)),s.set(n,t),n}unregister(e){for(const[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),n.size===0&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail;this.components.peerStore.get(t).then(n=>{var s,i,o;for(const a of n.protocols){const c=this.topologies.get(a);if(c!=null)for(const l of c.values())((s=l.filter)==null?void 0:s.has(t))!==!1&&((i=l.filter)==null||i.remove(t),(o=l.onDisconnect)==null||o.call(l,t))}}).catch(n=>{n.name!=="NotFoundError"&&this.log.error("could not inform topologies of disconnecting peer %p",t,n)})}_onPeerUpdate(e){var i,o,a;const{peer:t,previous:n}=e.detail,s=((n==null?void 0:n.protocols)??[]).filter(c=>!t.protocols.includes(c));for(const c of s){const l=this.topologies.get(c);if(l!=null)for(const u of l.values())((i=u.filter)==null?void 0:i.has(t.id))!==!1&&((o=u.filter)==null||o.remove(t.id),(a=u.onDisconnect)==null||a.call(u,t.id))}}_onPeerIdentify(e){var i,o,a;const t=e.detail.protocols,n=e.detail.connection,s=e.detail.peerId;for(const c of t){const l=this.topologies.get(c);if(l!=null)for(const u of l.values())n.limits!=null&&u.notifyOnLimitedConnection!==!0||((i=u.filter)==null?void 0:i.has(s))!==!0&&((o=u.filter)==null||o.add(s),(a=u.onConnect)==null||a.call(u,s,n))}}}var jV;jV=Symbol.toStringTag;class HOe{constructor(e,t={}){h(this,"log");h(this,"components");h(this,"transports");h(this,"listeners");h(this,"faultTolerance");h(this,"started");h(this,jV,"@libp2p/transport-manager");this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=new Map,this.listeners=SQ({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??Z0.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(t==null)throw new ie("Transport must have a valid tag");if(this.transports.has(t))throw new ie(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[t,n]of this.listeners)for(this.log("closing listeners for %s",t);n.length>0;){const s=n.pop();s!=null&&e.push(s.close())}await Promise.all(e),this.log("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){var s;const n=this.dialTransportForMultiaddr(e);if(n==null)throw new KDe(`No transport available for address ${String(e)}`);return(s=t==null?void 0:t.onProgress)==null||s.call(t,new Re("transport-manager:selected-transport",n[Symbol.toStringTag])),n.dial(e,{...t,upgrader:this.components.upgrader})}getAddrs(){let e=[];for(const t of this.listeners.values())for(const n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(const t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(const t of this.transports.values())if(t.listenFilter([e]).length>0)return t}async listen(e){if(!this.isStarted())throw new Hd("Not started");if(e==null||e.length===0){this.log("no addresses were provided for listening, this node is dial only");return}const t={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};e.forEach(i=>{t.errors.set(i.toString(),new UDe)});const n=[];for(const[i,o]of this.transports.entries()){const a=o.listenFilter(e);for(const c of a){this.log("creating listener for %s on %a",i,c);const l=o.createListener({upgrader:this.components.upgrader});let u=this.listeners.get(i)??[];u==null&&(u=[],this.listeners.set(i,u)),u.push(l),l.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:l})}),l.addEventListener("close",()=>{const d=u.findIndex(p=>p===l);u.splice(d,1),this.components.events.safeDispatchEvent("transport:close",{detail:l})}),$B.matches(c)?t.ipv4.attempts++:LB.matches(c)&&t.ipv6.attempts++,n.push(l.listen(c).then(()=>{t.errors.delete(c.toString()),$B.matches(c)&&t.ipv4.success++,LB.matches(c)&&t.ipv6.success++},d=>{throw this.log.error("transport %s could not listen on address %a - %e",i,c,d),t.errors.set(c.toString(),d),d}))}}const s=await Promise.allSettled(n);if(!(s.length>0&&s.every(i=>i.status==="fulfilled"))){if(this.ipv6Unsupported(t)){this.log("all IPv4 addresses succeed but all IPv6 failed");return}if(this.faultTolerance===Z0.NO_FATAL){this.log("failed to listen on any address but fault tolerance allows this");return}throw new FDe(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...t.errors.entries()].map(([i,o])=>`
  ${i}: ${`${o.stack??o}`.split(`
`).join(`
  `)}
`).join("")}`)}}ipv6Unsupported(e){if(e.ipv4.attempts===0||e.ipv6.attempts===0)return!1;const t=e.ipv4.attempts===e.ipv4.success,n=e.ipv6.success===0;return t&&n}async remove(e){const t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);const n=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){const s=t.pop();s!=null&&n.push(s.close())}await Promise.all(n),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}const hs="/multistream/1.0.0",SN=1024,KOe=he(`
`);async function p2(r,e,t){await r.write(e,t)}async function GOe(r,e,t){await r.writeV(e,t)}async function jOe(r,e){const t=await r.read(e);if(t.byteLength===0||t.get(t.byteLength-1)!==KOe[0])throw e.log.error("Invalid mss message - missing newline",t),new Rt("Missing newline");return t.sublist(0,-1)}async function Hp(r,e){const t=await jOe(r,e);return ce(t.subarray())}async function WE(r,e,t){if(e=Array.isArray(e)?[...e]:[e],e.length===1&&t.negotiateFully===!1)return qOe(r,e[0],t);const n=h1(r,{...t,maxDataLength:SN}),s=e.shift();if(s==null)throw new Error("At least one protocol must be specified");t.log.trace('select: write ["%s", "%s"]',hs,s);const i=he(`${hs}
`),o=he(`${s}
`);await GOe(n,[i,o],t),t.log.trace("select: reading multistream-select header");let a=await Hp(n,t);if(t.log.trace('select: read "%s"',a),a===hs&&(t.log.trace("select: reading protocol response"),a=await Hp(n,t),t.log.trace('select: read "%s"',a)),a===s)return{stream:n.unwrap(),protocol:s};for(const c of e){t.log.trace('select: write "%s"',c),await p2(n,he(`${c}
`),t),t.log.trace("select: reading protocol response");const l=await Hp(n,t);if(t.log.trace('select: read "%s" for "%s"',l,c),l===c)return{stream:n.unwrap(),protocol:c}}throw new Om("protocol selection failed")}function qOe(r,e,t){const n=r.sink.bind(r),s=r.source;let i=!1,o=!1;const a=He();let c=!1,l=!1;const u=He();let d=!1,p=!1;const y=He(),f=h1({sink:n,source:s},{...t,maxDataLength:SN});r.sink=async b=>{const{sink:v}=f.unwrap();await v(async function*(){let E=!1;for await(const S of b){if(l&&await u.promise,c)yield S;else{l=!0,t.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',hs,e,S.byteLength);const I=`${e}
`;yield new Ge(Uint8Array.from([19]),he(`${hs}
`),Jr(I.length),he(I),S).subarray(),t.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',hs,e,S.byteLength),c=!0,l=!1,u.resolve(),g().catch(x=>{t.log.error("could not finish optimistic protocol negotiation of %s",e,x)})}E=!0}E||await g()}())};async function g(){if(o){t.log.trace("optimistic: already negotiating %s stream",e),await a.promise;return}o=!0;try{c||(t.log.trace("optimistic: doing send protocol for %s stream",e),await w()),d||(t.log.trace("optimistic: doing read protocol for %s stream",e),await m())}finally{o=!1,i=!0,a.resolve()}}async function w(){if(l){await u.promise;return}l=!0;try{t.log.trace('optimistic: write ["%s", "%s", data] in source',hs,e),await f.writeV([he(`${hs}
`),he(`${e}
`)]),t.log.trace('optimistic: wrote ["%s", "%s", data] in source',hs,e)}finally{c=!0,l=!1,u.resolve()}}async function m(){if(p){await y.promise;return}p=!0;try{t.log.trace("optimistic: reading multistream select header");let b=await Hp(f,t);if(t.log.trace('optimistic: read multistream select header "%s"',b),b===hs&&(b=await Hp(f,t)),t.log.trace('optimistic: read protocol "%s", expecting "%s"',b,e),b!==e)throw new Om("protocol selection failed")}finally{d=!0,p=!1,y.resolve()}}if(r.source=async function*(){await g(),t.log.trace('optimistic: reading data from "%s" stream',e),yield*f.unwrap().source}(),r.closeRead!=null){const b=r.closeRead.bind(r);r.closeRead=async v=>{i||await g().catch(E=>{t.log.error("could not negotiate protocol before close read",E)}),await b(v)}}if(r.closeWrite!=null){const b=r.closeWrite.bind(r);r.closeWrite=async v=>{i||await g().catch(E=>{t.log.error("could not negotiate protocol before close write",E)}),await b(v)}}if(r.close!=null){const b=r.close.bind(r);r.close=async v=>{const E=[];l&&E.push(u.promise),p&&E.push(y.promise),E.length>0?await Vn(Promise.all(E),v==null?void 0:v.signal):(i=!0,o=!1,a.resolve()),await b(v)}}return{stream:r,protocol:e}}async function QE(r,e,t){e=Array.isArray(e)?e:[e],t.log.trace("handle: available protocols %s",e);const n=h1(r,{...t,maxDataLength:SN,maxLengthLength:2});for(;;){t.log.trace("handle: reading incoming string");const s=await Hp(n,t);if(t.log.trace('handle: read "%s"',s),s===hs){t.log.trace('handle: respond with "%s" for "%s"',hs,s),await p2(n,he(`${hs}
`),t),t.log.trace('handle: responded with "%s" for "%s"',hs,s);continue}if(e.includes(s))return t.log.trace('handle: respond with "%s" for "%s"',s,s),await p2(n,he(`${s}
`),t),t.log.trace('handle: responded with "%s" for "%s"',s,s),{stream:n.unwrap(),protocol:s};if(s==="ls"){const i=new Ge(...e.map(o=>n1.single(he(`${o}
`))),he(`
`));t.log.trace('handle: respond with "%s" for %s',e,s),await p2(n,i,t),t.log.trace('handle: responded with "%s" for %s',e,s);continue}t.log.trace('handle: respond with "na" for "%s"',s),await p2(n,he(`na
`),t),t.log('handle: responded with "na" for "%s"',s)}}const WOe=500;var qV,WV;WV=Symbol.toStringTag,qV=nue;class QOe{constructor(e){h(this,"id");h(this,"remoteAddr");h(this,"remotePeer");h(this,"direction");h(this,"timeline");h(this,"multiplexer");h(this,"encryption");h(this,"status");h(this,"limits");h(this,"log");h(this,"tags");h(this,"_newStream");h(this,"_close");h(this,"_abort");h(this,"_getStreams");h(this,WV,"Connection");h(this,qV,!0);const{remoteAddr:t,remotePeer:n,newStream:s,close:i,abort:o,getStreams:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=n,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.limits=e.limits,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=s,this._close=i,this._abort=o,this._getStreams=a,this.tags=[]}get streams(){return this._getStreams()}async newStream(e,t){if(this.status==="closing")throw new Nj("the connection is being closed");if(this.status==="closed")throw new XT("the connection is closed");if(Array.isArray(e)||(e=[e]),this.limits!=null&&(t==null?void 0:t.runOnLimitedConnection)!==!0)throw new t_("Cannot open protocol stream on limited connection");const n=await this._newStream(e,t);return n.direction="outbound",n}async close(e={}){if(!(this.status==="closed"||this.status==="closing")){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",e.signal==null){const t=AbortSignal.timeout(WOe);e={...e,signal:t}}try{this.log.trace("closing underlying transport"),await this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(t){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,t),this.abort(t)}}}abort(e){this.status!=="closed"&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this._abort(e),this.status="closed",this.timeline.close=Date.now())}}function JOe(r){return new QOe(r)}function YOe(r,e){try{const{options:t}=e.getHandler(r);return t.maxInboundStreams}catch(t){if(t.name!=="UnhandledProtocolError")throw t}return Aee}function XOe(r,e,t={}){try{const{options:n}=e.getHandler(r);if(n.maxOutboundStreams!=null)return n.maxOutboundStreams}catch(n){if(n.name!=="UnhandledProtocolError")throw n}return t.maxOutboundStreams??See}function eF(r,e,t){let n=0;return t.streams.forEach(s=>{s.direction===e&&s.protocol===r&&n++}),n}var QV;QV=Symbol.toStringTag;class ZOe{constructor(e,t){h(this,"components");h(this,"connectionEncrypters");h(this,"streamMuxers");h(this,"inboundUpgradeTimeout");h(this,"inboundStreamProtocolNegotiationTimeout");h(this,"outboundStreamProtocolNegotiationTimeout");h(this,"events");h(this,"metrics");h(this,QV,"@libp2p/upgrader");var n,s;this.components=e,this.connectionEncrypters=new Map,t.connectionEncrypters.forEach(i=>{this.connectionEncrypters.set(i.protocol,i)}),this.streamMuxers=new Map,t.streamMuxers.forEach(i=>{this.streamMuxers.set(i.protocol,i)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??sOe,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??QU,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??QU,this.events=e.events,this.metrics={dials:(n=e.metrics)==null?void 0:n.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:(s=e.metrics)==null?void 0:s.registerCounterGroup("libp2p_connection_manager_dial_errors_total")}}async shouldBlockConnection(e,...t){const n=this.components.connectionGater[e];if(n==null)return;if(await n.apply(this.components.connectionGater,t)===!0)throw new VDe(`The multiaddr connection is blocked by gater.${e}`)}createInboundAbortSignal(e){return At([AbortSignal.timeout(this.inboundUpgradeTimeout),e])}async upgradeInbound(e,t){var i,o;let n=!1;const s=this.createInboundAbortSignal(t.signal);try{if((i=this.metrics.dials)==null||i.increment({inbound:!0}),n=await this.components.connectionManager.acceptIncomingConnection(e),!n)throw new HDe("Connection denied");await this.shouldBlockConnection("denyInboundConnection",e),await this._performUpgrade(e,"inbound",{...t,signal:s})}catch(a){throw(o=this.metrics.errors)==null||o.increment({inbound:!0}),a}finally{s.clear(),n&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){var n,s;try{(n=this.metrics.dials)==null||n.increment({outbound:!0});const i=e.remoteAddr.getPeerId();let o;i!=null&&(o=mr(i),await this.shouldBlockConnection("denyOutboundConnection",o,e));let a="outbound";return t.initiator===!1&&(a="inbound"),await this._performUpgrade(e,a,t)}catch(i){throw(s=this.metrics.errors)==null||s.increment({outbound:!0}),i}}async _performUpgrade(e,t,n){var u,d,p;let s,i,o,a,c;(u=this.components.metrics)==null||u.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t);let l=e;if((n==null?void 0:n.skipProtection)!==!0){const y=this.components.connectionProtector;y!=null&&(e.log("protecting the %s connection",t),l=await y.protect(e,n))}try{if(s=l,(n==null?void 0:n.skipEncryption)!==!0){(d=n==null?void 0:n.onProgress)==null||d.call(n,new Re(`upgrader:encrypt-${t}-connection`)),{conn:s,remotePeer:i,protocol:c,streamMuxer:a}=await(t==="inbound"?this._encryptInbound(l,n):this._encryptOutbound(l,n));const y={...l,...s};await this.shouldBlockConnection(t==="inbound"?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",i,y)}else{const y=e.remoteAddr.getPeerId();if(y==null)throw new L5(`${t} connection that skipped encryption must have a peer id`);const f=mr(y);c="native",i=f}if(i.equals(this.components.peerId)){const y=new e_("Can not dial self");throw e.abort(y),y}if(o=s,(n==null?void 0:n.muxerFactory)!=null)a=n.muxerFactory;else if(a==null&&this.streamMuxers.size>0){(p=n==null?void 0:n.onProgress)==null||p.call(n,new Re(`upgrader:multiplex-${t}-connection`));const y=await(t==="inbound"?this._multiplexInbound({...l,...s},this.streamMuxers,n):this._multiplexOutbound({...l,...s},this.streamMuxers,n));a=y.muxerFactory,o=y.stream}}catch(y){throw e.log.error("failed to upgrade inbound connection %s %a - %e",t==="inbound"?"from":"to",e.remoteAddr,y),y}return await this.shouldBlockConnection(t==="inbound"?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",i,e),e.log("successfully upgraded %s connection",t),this._createConnection({cryptoProtocol:c,direction:t,maConn:e,upgradedConn:o,muxerFactory:a,remotePeer:i,limits:n==null?void 0:n.limits})}_createConnection(e){const{cryptoProtocol:t,direction:n,maConn:s,upgradedConn:i,remotePeer:o,muxerFactory:a,limits:c}=e;let l,u,d;a!=null&&(l=a.createStreamMuxer({direction:n,onIncomingStream:f=>{d!=null&&Promise.resolve().then(async()=>{var S;const g=this.components.registrar.getProtocols(),w=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout),{stream:m,protocol:b}=await QE(f,g,{signal:w,log:f.log,yieldBytes:!1});if(d==null)return;d.log("incoming stream opened on %s",b);const v=YOe(b,this.components.registrar);if(eF(b,"inbound",d)===v){const I=new Bj(`Too many inbound protocol streams for protocol "${b}" - limit ${v}`);throw f.abort(I),I}f.source=m.source,f.sink=m.sink,f.protocol=b,m.closeWrite!=null&&(f.closeWrite=m.closeWrite),m.closeRead!=null&&(f.closeRead=m.closeRead),m.close!=null&&(f.close=m.close),await this.components.peerStore.merge(o,{protocols:[b]}),(S=this.components.metrics)==null||S.trackProtocolStream(f,d),this._onStream({connection:d,stream:f,protocol:b})}).catch(async g=>{d.log.error("error handling incoming stream id %s - %e",f.id,g),f.timeline.close==null&&await f.close()})}}),u=async(f,g={})=>{var m;if(l==null)throw new A3("Connection is not multiplexed");d.log.trace("starting new stream for protocols %s",f);const w=await l.newStream();d.log.trace("started new stream %s for protocols %s",w.id,f);try{if(g.signal==null){w.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",f);const I=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);g={...g,signal:I}}w.log.trace("selecting protocol from protocols %s",f);const{stream:b,protocol:v}=await WE(w,f,{...g,log:w.log,yieldBytes:!0});w.log.trace("selected protocol %s",v);const E=XOe(v,this.components.registrar,g),S=eF(v,"outbound",d);if(S>=E){const I=new F5(`Too many outbound protocol streams for protocol "${v}" - ${S}/${E}`);throw w.abort(I),I}return await this.components.peerStore.merge(o,{protocols:[v]}),w.source=b.source,w.sink=b.sink,w.protocol=v,b.closeWrite!=null&&(w.closeWrite=b.closeWrite),b.closeRead!=null&&(w.closeRead=b.closeRead),b.close!=null&&(w.close=b.close),(m=this.components.metrics)==null||m.trackProtocolStream(w,d),w}catch(b){throw d.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e",n==="inbound"?"from":"to",e.maConn.remoteAddr,f,b),w.timeline.close==null&&w.abort(b),b}},Promise.all([l.sink(i.source),i.sink(l.source)]).catch(f=>{d.log.error("error piping data through muxer - %e",f)}));const p=s.timeline;s.timeline=new Proxy(p,{set:(...f)=>(f[1]==="close"&&f[2]!=null&&p.close==null&&(async()=>{try{d.status==="open"&&await d.close()}catch(g){d.log.error("error closing connection after timeline close %e",g)}finally{this.events.safeDispatchEvent("connection:close",{detail:d})}})().catch(g=>{d.log.error("error thrown while dispatching connection:close event %e",g)}),Reflect.set(...f))}),s.timeline.upgraded=Date.now();const y=()=>{throw new A3("Connection is not multiplexed")};return d=JOe({remoteAddr:s.remoteAddr,remotePeer:o,status:"open",direction:n,timeline:s.timeline,multiplexer:l==null?void 0:l.protocol,encryption:t,limits:c,logger:this.components.logger,newStream:u??y,getStreams:()=>(l==null?void 0:l.streams)??[],close:async f=>{await(l==null?void 0:l.close(f)),await s.close(f)},abort:f=>{s.abort(f),l==null||l.abort(f)}}),this.events.safeDispatchEvent("connection:open",{detail:d}),d.__maConnTimeline=p,d}_onStream(e){const{connection:t,stream:n,protocol:s}=e,{handler:i,options:o}=this.components.registrar.getHandler(s);if(t.limits!=null&&o.runOnLimitedConnection!==!0)throw new t_("Cannot open protocol stream on limited connection");i({connection:t,stream:n})}async _encryptInbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{const{stream:s,protocol:i}=await QE(e,n,{...t,log:e.log}),o=this.connectionEncrypters.get(i);if(o==null)throw new S3(`no crypto module found for ${i}`);return e.log("encrypting inbound connection to %a using %s",e.remoteAddr,i),{...await o.secureInbound(s,t),protocol:i}}catch(s){throw e.log.error("encrypting inbound connection from %a failed",e.remoteAddr,s),new S3(s.message)}}async _encryptOutbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",n);const{stream:s,protocol:i}=await WE(e,n,{...t,log:e.log,yieldBytes:!0}),o=this.connectionEncrypters.get(i);if(o==null)throw new S3(`no crypto module found for ${i}`);return e.log("encrypting outbound connection to %a using %s",e.remoteAddr,i),{...await o.secureOutbound(s,t),protocol:i}}catch(s){throw e.log.error("encrypting outbound connection to %a failed",e.remoteAddr,s),new S3(s.message)}}async _multiplexOutbound(e,t,n){const s=Array.from(t.keys());e.log("outbound selecting muxer %s",s);try{e.log.trace("selecting stream muxer from %s",s);const{stream:i,protocol:o}=await WE(e,s,{...n,log:e.log,yieldBytes:!0});e.log("selected %s as muxer protocol",o);const a=t.get(o);return{stream:i,muxerFactory:a}}catch(i){throw e.log.error("error multiplexing outbound connection",i),new A3(String(i))}}async _multiplexInbound(e,t,n){const s=Array.from(t.keys());e.log("inbound handling muxers %s",s);try{const{stream:i,protocol:o}=await QE(e,s,{...n,log:e.log}),a=t.get(o);return{stream:i,muxerFactory:a}}catch(i){throw e.log.error("error multiplexing inbound connection",i),new A3(String(i))}}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}}var cm,zI;class eRe extends Er{constructor(t){var u,d,p,y,f,g,w,m,b,v,E,S;super();Q(this,cm);h(this,"peerId");h(this,"peerStore");h(this,"contentRouting");h(this,"peerRouting");h(this,"metrics");h(this,"services");h(this,"logger");h(this,"status");h(this,"components");h(this,"log");this.status="stopped";const n=new Er,s=n.dispatchEvent.bind(n);n.dispatchEvent=I=>{const x=s(I),C=this.dispatchEvent(new CustomEvent(I.type,{detail:I.detail}));return x||C},this.peerId=t.peerId,this.logger=t.logger??nv(),this.log=this.logger.forComponent("libp2p"),this.services={};const i=((u=t.nodeInfo)==null?void 0:u.name)??nee,o=((d=t.nodeInfo)==null?void 0:d.version)??ree,a=this.components=WDe({peerId:t.peerId,privateKey:t.privateKey,nodeInfo:{name:i,version:o,userAgent:((p=t.nodeInfo)==null?void 0:p.userAgent)??see(i,o)},logger:this.logger,events:n,datastore:t.datastore??new $J,connectionGater:tOe(t.connectionGater),dns:t.dns});this.peerStore=this.configureComponent("peerStore",cDe(a,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...t.peerStore})),t.metrics!=null&&(this.metrics=this.configureComponent("metrics",t.metrics(this.components))),a.events.addEventListener("peer:update",I=>{if(I.detail.previous==null){const x={id:I.detail.peer.id,multiaddrs:I.detail.peer.addresses.map(C=>C.multiaddr)};a.events.safeDispatchEvent("peer:discovery",{detail:x})}}),t.connectionProtector!=null&&this.configureComponent("connectionProtector",t.connectionProtector(a)),this.components.upgrader=new ZOe(this.components,{connectionEncrypters:(t.connectionEncrypters??[]).map((I,x)=>this.configureComponent(`connection-encryption-${x}`,I(this.components))),streamMuxers:(t.streamMuxers??[]).map((I,x)=>this.configureComponent(`stream-muxers-${x}`,I(this.components))),inboundUpgradeTimeout:(y=t.connectionManager)==null?void 0:y.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:((f=t.connectionManager)==null?void 0:f.inboundStreamProtocolNegotiationTimeout)??((g=t.connectionManager)==null?void 0:g.protocolNegotiationTimeout),outboundStreamProtocolNegotiationTimeout:((w=t.connectionManager)==null?void 0:w.outboundStreamProtocolNegotiationTimeout)??((m=t.connectionManager)==null?void 0:m.protocolNegotiationTimeout)}),this.configureComponent("transportManager",new HOe(this.components,t.transportManager)),this.configureComponent("connectionManager",new DOe(this.components,t.connectionManager)),((b=t.connectionMonitor)==null?void 0:b.enabled)!==!1&&this.configureComponent("connectionMonitor",new LOe(this.components,t.connectionMonitor)),this.configureComponent("registrar",new VOe(this.components)),this.configureComponent("addressManager",new ODe(this.components,t.addresses));const c=(t.peerRouters??[]).map((I,x)=>this.configureComponent(`peer-router-${x}`,I(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new FOe(this.components,{routers:c}));const l=(t.contentRouters??[]).map((I,x)=>this.configureComponent(`content-router-${x}`,I(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new UOe(this.components,{routers:l})),this.configureComponent("randomWalk",new zOe(this.components)),(t.peerDiscovery??[]).forEach((I,x)=>{this.configureComponent(`peer-discovery-${x}`,I(this.components)).addEventListener("peer",P=>{te(this,cm,zI).call(this,P)})}),(v=t.transports)==null||v.forEach((I,x)=>{this.components.transportManager.add(this.configureComponent(`transport-${x}`,I(this.components)))}),t.services!=null)for(const I of Object.keys(t.services)){const x=t.services[I],C=x(this.components);if(C==null){this.log.error("service factory %s returned null or undefined instance",I);continue}this.services[I]=C,this.configureComponent(I,C),C[Y0]!=null&&(this.log("registering service %s for content routing",I),l.push(C[Y0])),C[X0]!=null&&(this.log("registering service %s for peer routing",I),c.push(C[X0])),C[v8]!=null&&(this.log("registering service %s for peer discovery",I),(S=(E=C[v8]).addEventListener)==null||S.call(E,"peer",P=>{te(this,cm,zI).call(this,P)}))}QDe(a)}configureComponent(t,n){return n==null&&this.log.error("component %s was null or undefined",t),this.components[t]=n,n}async start(){var t,n,s,i;if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{await((n=(t=this.components).beforeStart)==null?void 0:n.call(t)),await this.components.start(),await((i=(s=this.components).afterStart)==null?void 0:i.call(s)),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(o){throw this.log.error("An error occurred starting libp2p",o),this.status="started",await this.stop(),o}}}async stop(){var t,n,s,i;this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",await((n=(t=this.components).beforeStop)==null?void 0:n.call(t)),await this.components.stop(),await((i=(s=this.components).afterStop)==null?void 0:i.call(s)),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(t){return this.components.connectionManager.getConnections(t)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const t=new Eo;for(const n of this.components.connectionManager.getConnections())t.add(n.remotePeer);return Array.from(t)}async dial(t,n={}){return this.components.connectionManager.openConnection(t,{priority:75,...n})}async dialProtocol(t,n,s={}){if(n==null)throw new ie("no protocols were provided to open a stream");if(n=Array.isArray(n)?n:[n],n.length===0)throw new ie("no protocols were provided to open a stream");return(await this.dial(t,s)).newStream(n,s)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(t,n={}){pv(t)&&(t=mr(t.getPeerId()??"")),await this.components.connectionManager.closeConnections(t,n)}async getPublicKey(t,n={}){if(this.log("getPublicKey %p",t),t.publicKey!=null)return t.publicKey;try{const a=await this.peerStore.get(t);if(a.id.publicKey!=null)return a.id.publicKey}catch(a){if(a.name!=="NotFoundError")throw a}const s=Cr([he("/pk/"),t.toMultihash().bytes]),i=await this.contentRouting.get(s,n),o=Is(i);return await this.peerStore.patch(t,{publicKey:o}),o}async handle(t,n,s){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async i=>{await this.components.registrar.handle(i,n,s)}))}async unhandle(t){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async n=>{await this.components.registrar.unhandle(n)}))}async register(t,n){return this.components.registrar.register(t,n)}unregister(t){this.components.registrar.unregister(t)}async isDialable(t,n={}){return this.components.connectionManager.isDialable(t,n)}}cm=new WeakSet,zI=function(t){const{detail:n}=t;if(n.id.toString()===this.peerId.toString()){this.log.error("peer discovery mechanism discovered self");return}this.components.peerStore.merge(n.id,{multiaddrs:n.multiaddrs}).catch(s=>{this.log.error(s)})};async function tRe(r={}){r.privateKey??(r.privateKey=await J5("Ed25519"));const e=new eRe({...await pNe(r),peerId:R1e(r.privateKey)});return r.start!==!1&&await e.start(),e}async function rRe(r){const e=r.libp2p??{};e.privateKey==null&&r.datastore!=null&&(e.privateKey=await lNe(r.datastore,r.keychain));const t=cNe(e);return t.datastore=t.datastore??r.datastore,await tRe({...t,...e,start:!1})}async function nRe(r={}){const e=r.datastore??new $J,t=r.blockstore??new Bve;let n;sRe(r.libp2p)?n=r.libp2p:n=await rRe({...r,libp2p:{dns:r.dns,...r.libp2p,start:void 0},datastore:e});const s=new Fve({...r,libp2p:n,datastore:e,blockstore:t,blockBrokers:r.blockBrokers??[pbe(),C3e()],routers:r.routers??[Z5e(n),Y5e()],metrics:n.metrics});return r.start!==!1&&await s.start(),s}function sRe(r){return r==null?!1:["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"].every(t=>typeof r[t]=="function")}function Cee(r){return r[Symbol.asyncIterator]!=null}const C7=r=>{const e=kt(r),t=Ss(e);return Jr(r,t),C7.bytes=e,t};C7.bytes=0;function CN(r,e){e=e??{};const t=e.lengthEncoder??C7;function*n(s){const i=t(s.byteLength);i instanceof Uint8Array?yield i:yield*i,s instanceof Uint8Array?yield s:yield*s}return Cee(r)?async function*(){for await(const s of r)yield*n(s)}():function*(){for(const s of r)yield*n(s)}()}CN.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??C7;return new Ge(t(r.byteLength),r)};class iRe extends Error{constructor(){super(...arguments);h(this,"name","InvalidMessageLengthError");h(this,"code","ERR_INVALID_MSG_LENGTH")}}class oRe extends Error{constructor(){super(...arguments);h(this,"name","InvalidDataLengthError");h(this,"code","ERR_MSG_DATA_TOO_LONG")}}class aRe extends Error{constructor(){super(...arguments);h(this,"name","InvalidDataLengthLengthError");h(this,"code","ERR_MSG_LENGTH_TOO_LONG")}}class tF extends Error{constructor(){super(...arguments);h(this,"name","UnexpectedEOFError");h(this,"code","ERR_UNEXPECTED_EOF")}}const cRe=8,lRe=1024*1024*4;var Bh;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(Bh||(Bh={}));const IN=r=>{const e=Po(r);return IN.bytes=kt(e),e};IN.bytes=0;function VI(r,e){const t=new Ge;let n=Bh.LENGTH,s=-1;const i=(e==null?void 0:e.lengthDecoder)??IN,o=(e==null?void 0:e.maxLengthLength)??cRe,a=(e==null?void 0:e.maxDataLength)??lRe;function*c(){for(;t.byteLength>0;){if(n===Bh.LENGTH)try{if(s=i(t),s<0)throw new iRe("Invalid message length");if(s>a)throw new oRe("Message length too long");const l=i.bytes;t.consume(l),(e==null?void 0:e.onLength)!=null&&e.onLength(s),n=Bh.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>o)throw new aRe("Message length length too long");break}throw l}if(n===Bh.DATA){if(t.byteLength<s)break;const l=t.sublist(0,s);t.consume(s),(e==null?void 0:e.onData)!=null&&e.onData(l),yield l,n=Bh.LENGTH}}}return Cee(r)?async function*(){for await(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new tF("Unexpected end of input")}():function*(){for(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new tF("Unexpected end of input")}()}VI.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:i,value:o}=await r.next(t);if(i===!0)return;o!=null&&(yield o)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}}();return VI(n,{...e??{},onLength:i=>{t=i}})};function uRe(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var hRe=Iee,rF=128,dRe=-128,fRe=Math.pow(2,31);function Iee(r,e,t){e=e||[],t=t||0;for(var n=t;r>=fRe;)e[t++]=r&255|rF,r/=128;for(;r&dRe;)e[t++]=r&255|rF,r>>>=7;return e[t]=r|0,Iee.bytes=t-n+1,e}var pRe=HI,gRe=128,nF=127;function HI(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw HI.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&nF)<<s:(o&nF)*Math.pow(2,s),s+=7}while(o>=gRe);return HI.bytes=i-n,t}var yRe=Math.pow(2,7),mRe=Math.pow(2,14),wRe=Math.pow(2,21),bRe=Math.pow(2,28),vRe=Math.pow(2,35),ERe=Math.pow(2,42),xRe=Math.pow(2,49),ARe=Math.pow(2,56),SRe=Math.pow(2,63),CRe=function(r){return r<yRe?1:r<mRe?2:r<wRe?3:r<bRe?4:r<vRe?5:r<ERe?6:r<xRe?7:r<ARe?8:r<SRe?9:10},IRe={encode:hRe,decode:pRe,encodingLength:CRe},N6=IRe;function sF(r,e=0){return[N6.decode(r,e),N6.decode.bytes]}function iF(r,e,t=0){return N6.encode(r,e,t),e}function oF(r){return N6.encodingLength(r)}function aF(r,e){const t=e.byteLength,n=oF(r),s=n+oF(t),i=new Uint8Array(s+t);return iF(r,i,0),iF(t,i,n),i.set(e,s),new Tee(r,t,e,i)}function kee(r){const e=uRe(r),[t,n]=sF(e),[s,i]=sF(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new Tee(t,s,o,e)}class Tee{constructor(e,t,n,s){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=s}}const dg=1e3,kN=60*dg,cF="/floodsub/1.0.0",lF="/meshsub/1.0.0",kRe="/meshsub/1.1.0",JE="/meshsub/1.2.0",TRe=6,_Re=4,PRe=12,NRe=4,DRe=2,ORe=5,RRe=3,BRe=6,MRe=.25,$Re=3,uF=100,LRe=dg,URe=kN,FRe=16,zRe=kN,VRe=10*dg,HRe=15,KRe=300,GRe=dg,jRe=60,qRe=2,WRe=10*dg,Xf=5e3,QRe=10,JRe=3*dg,YRe=2*kN,XRe=120*1e3,ZRe="ERR_TOPIC_VALIDATOR_REJECT",eBe="ERR_TOPIC_VALIDATOR_IGNORE",tBe=0,rBe=128,nBe=1e3,sBe=1e3,iBe=1,oBe=512,aBe=512,cBe={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxIdontwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};var Od;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=Fe((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.subscribe!=null&&(i.uint32(8),i.bool(s.subscribe)),s.topic!=null&&(i.uint32(18),i.string(s.topic)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{const a={},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const l=s.uint32();switch(l>>>3){case 1:{a.subscribe=s.bool();break}case 2:{a.topic=s.string();break}default:{s.skipType(l&7);break}}}return a})),n),t.encode=s=>Ue(s,t.codec()),t.decode=(s,i)=>Le(s,t.codec(),i)})(r.SubOpts||(r.SubOpts={})),function(t){let n;t.codec=()=>(n==null&&(n=Fe((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.from!=null&&(i.uint32(10),i.bytes(s.from)),s.data!=null&&(i.uint32(18),i.bytes(s.data)),s.seqno!=null&&(i.uint32(26),i.bytes(s.seqno)),s.topic!=null&&s.topic!==""&&(i.uint32(34),i.string(s.topic)),s.signature!=null&&(i.uint32(42),i.bytes(s.signature)),s.key!=null&&(i.uint32(50),i.bytes(s.key)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{const a={topic:""},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const l=s.uint32();switch(l>>>3){case 1:{a.from=s.bytes();break}case 2:{a.data=s.bytes();break}case 3:{a.seqno=s.bytes();break}case 4:{a.topic=s.string();break}case 5:{a.signature=s.bytes();break}case 6:{a.key=s.bytes();break}default:{s.skipType(l&7);break}}}return a})),n),t.encode=s=>Ue(s,t.codec()),t.decode=(s,i)=>Le(s,t.codec(),i)}(r.Message||(r.Message={})),function(t){let n;t.codec=()=>(n==null&&(n=Fe((s,i,o={})=>{if(o.lengthDelimited!==!1&&i.fork(),s.ihave!=null)for(const a of s.ihave)i.uint32(10),r.ControlIHave.codec().encode(a,i);if(s.iwant!=null)for(const a of s.iwant)i.uint32(18),r.ControlIWant.codec().encode(a,i);if(s.graft!=null)for(const a of s.graft)i.uint32(26),r.ControlGraft.codec().encode(a,i);if(s.prune!=null)for(const a of s.prune)i.uint32(34),r.ControlPrune.codec().encode(a,i);if(s.idontwant!=null)for(const a of s.idontwant)i.uint32(42),r.ControlIDontWant.codec().encode(a,i);o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{var l,u,d,p,y,f,g,w,m,b;const a={ihave:[],iwant:[],graft:[],prune:[],idontwant:[]},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const v=s.uint32();switch(v>>>3){case 1:{if(((l=o.limits)==null?void 0:l.ihave)!=null&&a.ihave.length===o.limits.ihave)throw new It('Decode error - map field "ihave" had too many elements');a.ihave.push(r.ControlIHave.codec().decode(s,s.uint32(),{limits:(u=o.limits)==null?void 0:u.ihave$}));break}case 2:{if(((d=o.limits)==null?void 0:d.iwant)!=null&&a.iwant.length===o.limits.iwant)throw new It('Decode error - map field "iwant" had too many elements');a.iwant.push(r.ControlIWant.codec().decode(s,s.uint32(),{limits:(p=o.limits)==null?void 0:p.iwant$}));break}case 3:{if(((y=o.limits)==null?void 0:y.graft)!=null&&a.graft.length===o.limits.graft)throw new It('Decode error - map field "graft" had too many elements');a.graft.push(r.ControlGraft.codec().decode(s,s.uint32(),{limits:(f=o.limits)==null?void 0:f.graft$}));break}case 4:{if(((g=o.limits)==null?void 0:g.prune)!=null&&a.prune.length===o.limits.prune)throw new It('Decode error - map field "prune" had too many elements');a.prune.push(r.ControlPrune.codec().decode(s,s.uint32(),{limits:(w=o.limits)==null?void 0:w.prune$}));break}case 5:{if(((m=o.limits)==null?void 0:m.idontwant)!=null&&a.idontwant.length===o.limits.idontwant)throw new It('Decode error - map field "idontwant" had too many elements');a.idontwant.push(r.ControlIDontWant.codec().decode(s,s.uint32(),{limits:(b=o.limits)==null?void 0:b.idontwant$}));break}default:{s.skipType(v&7);break}}}return a})),n),t.encode=s=>Ue(s,t.codec()),t.decode=(s,i)=>Le(s,t.codec(),i)}(r.ControlMessage||(r.ControlMessage={})),function(t){let n;t.codec=()=>(n==null&&(n=Fe((s,i,o={})=>{if(o.lengthDelimited!==!1&&i.fork(),s.topicID!=null&&(i.uint32(10),i.string(s.topicID)),s.messageIDs!=null)for(const a of s.messageIDs)i.uint32(18),i.bytes(a);o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{var l;const a={messageIDs:[]},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const u=s.uint32();switch(u>>>3){case 1:{a.topicID=s.string();break}case 2:{if(((l=o.limits)==null?void 0:l.messageIDs)!=null&&a.messageIDs.length===o.limits.messageIDs)throw new It('Decode error - map field "messageIDs" had too many elements');a.messageIDs.push(s.bytes());break}default:{s.skipType(u&7);break}}}return a})),n),t.encode=s=>Ue(s,t.codec()),t.decode=(s,i)=>Le(s,t.codec(),i)}(r.ControlIHave||(r.ControlIHave={})),function(t){let n;t.codec=()=>(n==null&&(n=Fe((s,i,o={})=>{if(o.lengthDelimited!==!1&&i.fork(),s.messageIDs!=null)for(const a of s.messageIDs)i.uint32(10),i.bytes(a);o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{var l;const a={messageIDs:[]},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const u=s.uint32();switch(u>>>3){case 1:{if(((l=o.limits)==null?void 0:l.messageIDs)!=null&&a.messageIDs.length===o.limits.messageIDs)throw new It('Decode error - map field "messageIDs" had too many elements');a.messageIDs.push(s.bytes());break}default:{s.skipType(u&7);break}}}return a})),n),t.encode=s=>Ue(s,t.codec()),t.decode=(s,i)=>Le(s,t.codec(),i)}(r.ControlIWant||(r.ControlIWant={})),function(t){let n;t.codec=()=>(n==null&&(n=Fe((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.topicID!=null&&(i.uint32(10),i.string(s.topicID)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{const a={},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const l=s.uint32();switch(l>>>3){case 1:{a.topicID=s.string();break}default:{s.skipType(l&7);break}}}return a})),n),t.encode=s=>Ue(s,t.codec()),t.decode=(s,i)=>Le(s,t.codec(),i)}(r.ControlGraft||(r.ControlGraft={})),function(t){let n;t.codec=()=>(n==null&&(n=Fe((s,i,o={})=>{if(o.lengthDelimited!==!1&&i.fork(),s.topicID!=null&&(i.uint32(10),i.string(s.topicID)),s.peers!=null)for(const a of s.peers)i.uint32(18),r.PeerInfo.codec().encode(a,i);s.backoff!=null&&(i.uint32(24),i.uint64Number(s.backoff)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{var l,u;const a={peers:[]},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const d=s.uint32();switch(d>>>3){case 1:{a.topicID=s.string();break}case 2:{if(((l=o.limits)==null?void 0:l.peers)!=null&&a.peers.length===o.limits.peers)throw new It('Decode error - map field "peers" had too many elements');a.peers.push(r.PeerInfo.codec().decode(s,s.uint32(),{limits:(u=o.limits)==null?void 0:u.peers$}));break}case 3:{a.backoff=s.uint64Number();break}default:{s.skipType(d&7);break}}}return a})),n),t.encode=s=>Ue(s,t.codec()),t.decode=(s,i)=>Le(s,t.codec(),i)}(r.ControlPrune||(r.ControlPrune={})),function(t){let n;t.codec=()=>(n==null&&(n=Fe((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.peerID!=null&&(i.uint32(10),i.bytes(s.peerID)),s.signedPeerRecord!=null&&(i.uint32(18),i.bytes(s.signedPeerRecord)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{const a={},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const l=s.uint32();switch(l>>>3){case 1:{a.peerID=s.bytes();break}case 2:{a.signedPeerRecord=s.bytes();break}default:{s.skipType(l&7);break}}}return a})),n),t.encode=s=>Ue(s,t.codec()),t.decode=(s,i)=>Le(s,t.codec(),i)}(r.PeerInfo||(r.PeerInfo={})),function(t){let n;t.codec=()=>(n==null&&(n=Fe((s,i,o={})=>{if(o.lengthDelimited!==!1&&i.fork(),s.messageIDs!=null)for(const a of s.messageIDs)i.uint32(10),i.bytes(a);o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{var l;const a={messageIDs:[]},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const u=s.uint32();switch(u>>>3){case 1:{if(((l=o.limits)==null?void 0:l.messageIDs)!=null&&a.messageIDs.length===o.limits.messageIDs)throw new It('Decode error - map field "messageIDs" had too many elements');a.messageIDs.push(s.bytes());break}default:{s.skipType(u&7);break}}}return a})),n),t.encode=s=>Ue(s,t.codec()),t.decode=(s,i)=>Le(s,t.codec(),i)}(r.ControlIDontWant||(r.ControlIDontWant={}));let e;r.codec=()=>(e==null&&(e=Fe((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.subscriptions!=null)for(const i of t.subscriptions)n.uint32(10),r.SubOpts.codec().encode(i,n);if(t.messages!=null)for(const i of t.messages)n.uint32(18),r.Message.codec().encode(i,n);t.control!=null&&(n.uint32(26),r.ControlMessage.codec().encode(t.control,n)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{var a,c,l,u,d;const i={subscriptions:[],messages:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const p=t.uint32();switch(p>>>3){case 1:{if(((a=s.limits)==null?void 0:a.subscriptions)!=null&&i.subscriptions.length===s.limits.subscriptions)throw new It('Decode error - map field "subscriptions" had too many elements');i.subscriptions.push(r.SubOpts.codec().decode(t,t.uint32(),{limits:(c=s.limits)==null?void 0:c.subscriptions$}));break}case 2:{if(((l=s.limits)==null?void 0:l.messages)!=null&&i.messages.length===s.limits.messages)throw new It('Decode error - map field "messages" had too many elements');i.messages.push(r.Message.codec().decode(t,t.uint32(),{limits:(u=s.limits)==null?void 0:u.messages$}));break}case 3:{i.control=r.ControlMessage.codec().decode(t,t.uint32(),{limits:(d=s.limits)==null?void 0:d.control});break}default:{t.skipType(p&7);break}}}return i})),e),r.encode=t=>Ue(t,r.codec()),r.decode=(t,n)=>Le(t,r.codec(),n)})(Od||(Od={}));class lBe{constructor(e,t,n){h(this,"gossip");h(this,"msgs",new Map);h(this,"msgIdToStrFn");h(this,"history",[]);h(this,"notValidatedCount",0);this.gossip=e,this.msgIdToStrFn=n;for(let s=0;s<t;s++)this.history[s]=[]}get size(){return this.msgs.size}put(e,t,n=!1){const{msgIdStr:s}=e;return this.msgs.has(s)?!1:(this.msgs.set(s,{message:t,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),n||this.notValidatedCount++,!0)}observeDuplicate(e,t){const n=this.msgs.get(e);n!=null&&!n.validated&&n.originatingPeers.add(t)}get(e){var t;return(t=this.msgs.get(this.msgIdToStrFn(e)))==null?void 0:t.message}getWithIWantCount(e,t){const n=this.msgs.get(e);if(n==null)return null;const s=(n.iwantCounts.get(t)??0)+1;return n.iwantCounts.set(t,s),{msg:n.message,count:s}}getGossipIDs(e){const t=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach(s=>{const i=this.msgs.get(s.msgIdStr);if(((i==null?void 0:i.validated)??!1)&&e.has(s.topic)){let o=t.get(s.topic);o==null&&(o=[],t.set(s.topic,o)),o.push(s.msgId)}});return t}validate(e){const t=this.msgs.get(e);if(t==null)return null;t.validated||this.notValidatedCount--;const{message:n,originatingPeers:s}=t;return t.validated=!0,t.originatingPeers=new Set,{message:n,originatingPeers:s}}shift(){this.history[this.history.length-1].forEach(t=>{const n=this.msgs.get(t.msgIdStr);n!=null&&(this.msgs.delete(t.msgIdStr),n.validated||this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(e){const t=this.msgs.get(e);return t==null?null:(this.msgs.delete(e),t)}}var hF;(function(r){r.StrictSign="StrictSign",r.StrictNoSign="StrictNoSign"})(hF||(hF={}));var N1;(function(r){r[r.Signing=0]="Signing",r[r.Anonymous=1]="Anonymous"})(N1||(N1={}));var So;(function(r){r.Error="error",r.Ignore="ignore",r.Reject="reject",r.Blacklisted="blacklisted"})(So||(So={}));var is;(function(r){r.InvalidSignature="invalid_signature",r.InvalidSeqno="invalid_seqno",r.InvalidPeerId="invalid_peerid",r.SignaturePresent="signature_present",r.SeqnoPresent="seqno_present",r.FromPresent="from_present",r.TransformFailed="transform_failed"})(is||(is={}));var ls;(function(r){r.duplicate="duplicate",r.invalid="invalid",r.valid="valid"})(ls||(ls={}));function dF(r){switch(r){case Pi.Ignore:return So.Ignore;case Pi.Reject:return So.Reject;default:throw new Error("Unreachable")}}var fF;(function(r){r.forward="forward",r.publish="publish"})(fF||(fF={}));var ps;(function(r){r.Fanout="fanout",r.Random="random",r.Subscribed="subscribed",r.Outbound="outbound",r.NotEnough="not_enough",r.Opportunistic="opportunistic"})(ps||(ps={}));var la;(function(r){r.Dc="disconnected",r.BadScore="bad_score",r.Prune="prune",r.Excess="excess"})(la||(la={}));var H2;(function(r){r.GraftBackoff="graft_backoff",r.BrokenPromise="broken_promise",r.MessageDeficit="message_deficit",r.IPColocation="IP_colocation"})(H2||(H2={}));var K2;(function(r){r.LowScore="low_score",r.MaxIhave="max_ihave",r.MaxIasked="max_iasked"})(K2||(K2={}));var bp;(function(r){r.graylist="graylist",r.publish="publish",r.gossip="gossip",r.mesh="mesh"})(bp||(bp={}));function uBe(r,e,t){return{protocolsEnabled:r.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:r.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:r.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:r.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEventsFanout:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_fanout_total",help:"Number of times we include peers in a topic mesh for fanout reasons",labelNames:["topic"]}),meshPeerInclusionEventsRandom:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_random_total",help:"Number of times we include peers in a topic mesh for random reasons",labelNames:["topic"]}),meshPeerInclusionEventsSubscribed:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_subscribed_total",help:"Number of times we include peers in a topic mesh for subscribed reasons",labelNames:["topic"]}),meshPeerInclusionEventsOutbound:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_outbound_total",help:"Number of times we include peers in a topic mesh for outbound reasons",labelNames:["topic"]}),meshPeerInclusionEventsNotEnough:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_not_enough_total",help:"Number of times we include peers in a topic mesh for not_enough reasons",labelNames:["topic"]}),meshPeerInclusionEventsOpportunistic:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_opportunistic_total",help:"Number of times we include peers in a topic mesh for opportunistic reasons",labelNames:["topic"]}),meshPeerInclusionEventsUnknown:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_unknown_total",help:"Number of times we include peers in a topic mesh for unknown reasons",labelNames:["topic"]}),meshPeerChurnEventsDisconnected:r.gauge({name:"gossipsub_peer_churn_events_disconnected_total",help:"Number of times we remove peers in a topic mesh for disconnected reasons",labelNames:["topic"]}),meshPeerChurnEventsBadScore:r.gauge({name:"gossipsub_peer_churn_events_bad_score_total",help:"Number of times we remove peers in a topic mesh for bad_score reasons",labelNames:["topic"]}),meshPeerChurnEventsPrune:r.gauge({name:"gossipsub_peer_churn_events_prune_total",help:"Number of times we remove peers in a topic mesh for prune reasons",labelNames:["topic"]}),meshPeerChurnEventsExcess:r.gauge({name:"gossipsub_peer_churn_events_excess_total",help:"Number of times we remove peers in a topic mesh for excess reasons",labelNames:["topic"]}),meshPeerChurnEventsUnknown:r.gauge({name:"gossipsub_peer_churn_events_unknown_total",help:"Number of times we remove peers in a topic mesh for unknown reasons",labelNames:["topic"]}),peersPerProtocol:r.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:r.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:r.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),acceptedMessagesTotal:r.gauge({name:"gossipsub_accepted_messages_total",help:"Total accepted messages for each topic",labelNames:["topic"]}),ignoredMessagesTotal:r.gauge({name:"gossipsub_ignored_messages_total",help:"Total ignored messages for each topic",labelNames:["topic"]}),rejectedMessagesTotal:r.gauge({name:"gossipsub_rejected_messages_total",help:"Total rejected messages for each topic",labelNames:["topic"]}),unknownValidationResultsTotal:r.gauge({name:"gossipsub_unknown_validation_results_total",help:"Total unknown validation results for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:r.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),asyncValidationDelayFromFirstSeenSec:r.histogram({name:"gossipsub_async_validation_delay_from_first_seen",help:"Async validation report delay from first seen in second",buckets:[.01,.03,.1,.3,1,3,10]}),asyncValidationUnknownFirstSeen:r.gauge({name:"gossipsub_async_validation_unknown_first_seen_count_total",help:"Async validation report unknown first seen value for message"}),peerReadStreamError:r.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:r.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:r.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:r.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:r.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:r.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:r.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:r.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:r.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:r.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:r.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:r.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:r.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:r.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:r.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:r.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:r.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:r.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:r.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:r.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:r.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:r.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),rpcSentIDontWant:r.gauge({name:"gossipsub_rpc_sent_idontwant_total",help:"RPC sent"}),msgPublishCount:r.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:r.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),directPeersPublishedTotal:r.gauge({name:"gossipsub_direct_peers_published_total",help:"Total direct peers that we publish a msg to",labelNames:["topic"]}),floodsubPeersPublishedTotal:r.gauge({name:"gossipsub_floodsub_peers_published_total",help:"Total floodsub peers that we publish a msg to",labelNames:["topic"]}),meshPeersPublishedTotal:r.gauge({name:"gossipsub_mesh_peers_published_total",help:"Total mesh peers that we publish a msg to",labelNames:["topic"]}),fanoutPeersPublishedTotal:r.gauge({name:"gossipsub_fanout_peers_published_total",help:"Total fanout peers that we publish a msg to",labelNames:["topic"]}),msgPublishBytes:r.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgPublishTime:r.histogram({name:"gossipsub_msg_publish_seconds",help:"Total time in seconds to publish a message",buckets:[.001,.002,.005,.01,.1,.5,1],labelNames:["topic"]}),msgForwardCount:r.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:r.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:r.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:r.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),prevalidationInvalidTotal:r.gauge({name:"gossipsub_pre_validation_invalid_total",help:"Total count of invalid messages received",labelNames:["topic"]}),prevalidationValidTotal:r.gauge({name:"gossipsub_pre_validation_valid_total",help:"Total count of valid messages received",labelNames:["topic"]}),prevalidationDuplicateTotal:r.gauge({name:"gossipsub_pre_validation_duplicate_total",help:"Total count of duplicate messages received",labelNames:["topic"]}),prevalidationUnknownTotal:r.gauge({name:"gossipsub_pre_validation_unknown_status_total",help:"Total count of unknown_status messages received",labelNames:["topic"]}),msgReceivedInvalid:r.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:r.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:r.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*t.maxMeshMessageDeliveriesWindowSec,.5*t.maxMeshMessageDeliveriesWindowSec,Number(t.maxMeshMessageDeliveriesWindowSec),2*t.maxMeshMessageDeliveriesWindowSec,4*t.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:r.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:r.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:r.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:r.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:r.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:r.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:r.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:r.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:r.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:r.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:r.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*t.behaviourPenaltyThreshold,.5*t.behaviourPenaltyThreshold,Number(t.behaviourPenaltyThreshold),2*t.behaviourPenaltyThreshold,4*t.behaviourPenaltyThreshold]}),ihaveRcvIgnored:r.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:r.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:r.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:r.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:r.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),idontwantRcvMsgids:r.gauge({name:"gossipsub_idontwant_rcv_msgids_total",help:"Total received IDONTWANT messages"}),idontwantRcvDonthaveMsgids:r.gauge({name:"gossipsub_idontwant_rcv_dont_have_msgids_total",help:"Total received IDONTWANT messageIDs that we do not have in mcache"}),iwantPromiseStarted:r.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:r.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:r.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:r.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:r.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:r.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:r.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*t.gossipPromiseExpireSec,Number(t.gossipPromiseExpireSec),2*t.gossipPromiseExpireSec,4*t.gossipPromiseExpireSec]}),iwantPromiseUntracked:r.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),connectedPeersBackoffSec:r.histogram({name:"gossipsub_connected_peers_backoff_seconds",help:"Backoff time in seconds",buckets:[1,2,4,10,20,60,120]}),cacheSize:r.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:r.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:r.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:r.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:r.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:e,toTopic(n){return this.topicStrToLabel.get(n)??n},onJoin(n){this.topicSubscriptionStatus.set({topicStr:n},1),this.meshPeerCounts.set({topicStr:n},0)},onLeave(n){this.topicSubscriptionStatus.set({topicStr:n},0),this.meshPeerCounts.set({topicStr:n},0)},onAddToMesh(n,s,i){const o=this.toTopic(n);switch(s){case ps.Fanout:this.meshPeerInclusionEventsFanout.inc({topic:o},i);break;case ps.Random:this.meshPeerInclusionEventsRandom.inc({topic:o},i);break;case ps.Subscribed:this.meshPeerInclusionEventsSubscribed.inc({topic:o},i);break;case ps.Outbound:this.meshPeerInclusionEventsOutbound.inc({topic:o},i);break;case ps.NotEnough:this.meshPeerInclusionEventsNotEnough.inc({topic:o},i);break;case ps.Opportunistic:this.meshPeerInclusionEventsOpportunistic.inc({topic:o},i);break;default:this.meshPeerInclusionEventsUnknown.inc({topic:o},i);break}},onRemoveFromMesh(n,s,i){const o=this.toTopic(n);switch(s){case la.Dc:this.meshPeerChurnEventsDisconnected.inc({topic:o},i);break;case la.BadScore:this.meshPeerChurnEventsBadScore.inc({topic:o},i);break;case la.Prune:this.meshPeerChurnEventsPrune.inc({topic:o},i);break;case la.Excess:this.meshPeerChurnEventsExcess.inc({topic:o},i);break;default:this.meshPeerChurnEventsUnknown.inc({topic:o},i);break}},onReportValidation(n,s,i){if(this.asyncValidationMcacheHit.inc({hit:n!=null?"hit":"miss"}),n!=null){const o=this.toTopic(n.message.topic);switch(s){case Pi.Accept:this.acceptedMessagesTotal.inc({topic:o});break;case Pi.Ignore:this.ignoredMessagesTotal.inc({topic:o});break;case Pi.Reject:this.rejectedMessagesTotal.inc({topic:o});break;default:this.unknownValidationResultsTotal.inc({topic:o});break}}i!=null?this.asyncValidationDelayFromFirstSeenSec.observe((Date.now()-i)/1e3):this.asyncValidationUnknownFirstSeen.inc()},onScorePenalty(n){this.scoringPenalties.inc({penalty:n},1)},onIhaveRcv(n,s,i){const o=this.toTopic(n);this.ihaveRcvMsgids.inc({topic:o},s),this.ihaveRcvNotSeenMsgids.inc({topic:o},i)},onIwantRcv(n,s){for(const[i,o]of n){const a=this.toTopic(i);this.iwantRcvMsgids.inc({topic:a},o)}this.iwantRcvDonthaveMsgids.inc(s)},onIdontwantRcv(n,s){this.idontwantRcvMsgids.inc(n),this.idontwantRcvDonthaveMsgids.inc(s)},onForwardMsg(n,s){const i=this.toTopic(n);this.msgForwardCount.inc({topic:i},1),this.msgForwardPeers.inc({topic:i},s)},onPublishMsg(n,s,i,o,a){const c=this.toTopic(n);this.msgPublishCount.inc({topic:c},1),this.msgPublishBytes.inc({topic:c},i*o),this.msgPublishPeersByTopic.inc({topic:c},i),this.directPeersPublishedTotal.inc({topic:c},s.direct),this.floodsubPeersPublishedTotal.inc({topic:c},s.floodsub),this.meshPeersPublishedTotal.inc({topic:c},s.mesh),this.fanoutPeersPublishedTotal.inc({topic:c},s.fanout),this.msgPublishTime.observe({topic:c},a/1e3)},onMsgRecvPreValidation(n){const s=this.toTopic(n);this.msgReceivedPreValidation.inc({topic:s},1)},onMsgRecvError(n){const s=this.toTopic(n);this.msgReceivedError.inc({topic:s},1)},onPrevalidationResult(n,s){const i=this.toTopic(n);switch(s){case ls.duplicate:this.prevalidationDuplicateTotal.inc({topic:i});break;case ls.invalid:this.prevalidationInvalidTotal.inc({topic:i});break;case ls.valid:this.prevalidationValidTotal.inc({topic:i});break;default:this.prevalidationUnknownTotal.inc({topic:i});break}},onMsgRecvInvalid(n,s){const i=this.toTopic(n),o=s.reason===So.Error?s.error:s.reason;this.msgReceivedInvalid.inc({error:o},1),this.msgReceivedInvalidByTopic.inc({topic:i},1)},onDuplicateMsgDelivery(n,s,i){const o=this.toTopic(n);this.duplicateMsgDeliveryDelay.observe({topic:o},s/1e3),i&&this.duplicateMsgLateDelivery.inc({topic:o},1)},onPublishDuplicateMsg(n){const s=this.toTopic(n);this.duplicateMsgIgnored.inc({topic:s},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(n,s){this.rpcRecvBytes.inc(s),this.rpcRecvCount.inc(1),n.subscriptions!=null&&this.rpcRecvSubscription.inc(n.subscriptions.length),n.messages!=null&&this.rpcRecvMessage.inc(n.messages.length),n.control!=null&&(this.rpcRecvControl.inc(1),n.control.ihave!=null&&this.rpcRecvIHave.inc(n.control.ihave.length),n.control.iwant!=null&&this.rpcRecvIWant.inc(n.control.iwant.length),n.control.graft!=null&&this.rpcRecvGraft.inc(n.control.graft.length),n.control.prune!=null&&this.rpcRecvPrune.inc(n.control.prune.length))},onRpcSent(n,s){var i,o,a,c,l;if(this.rpcSentBytes.inc(s),this.rpcSentCount.inc(1),n.subscriptions!=null&&this.rpcSentSubscription.inc(n.subscriptions.length),n.messages!=null&&this.rpcSentMessage.inc(n.messages.length),n.control!=null){const u=((i=n.control.ihave)==null?void 0:i.length)??0,d=((o=n.control.iwant)==null?void 0:o.length)??0,p=((a=n.control.graft)==null?void 0:a.length)??0,y=((c=n.control.prune)==null?void 0:c.length)??0,f=((l=n.control.idontwant)==null?void 0:l.length)??0;u>0&&this.rpcSentIHave.inc(u),d>0&&this.rpcSentIWant.inc(d),p>0&&this.rpcSentGraft.inc(p),y>0&&this.rpcSentPrune.inc(y),f>0&&this.rpcSentIDontWant.inc(f),(u>0||d>0||p>0||y>0||f>0)&&this.rpcSentControl.inc(1)}},registerScores(n,s){let i=0,o=0,a=0,c=0;for(const l of n)l>=s.graylistThreshold&&i++,l>=s.publishThreshold&&o++,l>=s.gossipThreshold&&a++,l>=0&&c++;this.peersByScoreThreshold.set({threshold:bp.graylist},i),this.peersByScoreThreshold.set({threshold:bp.publish},o),this.peersByScoreThreshold.set({threshold:bp.gossip},a),this.peersByScoreThreshold.set({threshold:bp.mesh},c),this.score.set(n)},registerScoreWeights(n){for(const[s,i]of n.byTopic)this.scoreWeights.set({topic:s,p:"p1"},i.p1w),this.scoreWeights.set({topic:s,p:"p2"},i.p2w),this.scoreWeights.set({topic:s,p:"p3"},i.p3w),this.scoreWeights.set({topic:s,p:"p3b"},i.p3bw),this.scoreWeights.set({topic:s,p:"p4"},i.p4w);this.scoreWeights.set({p:"p5"},n.p5w),this.scoreWeights.set({p:"p6"},n.p6w),this.scoreWeights.set({p:"p7"},n.p7w)},registerScorePerMesh(n,s){const i=new Map;n.forEach((o,a)=>{const c=this.topicStrToLabel.get(a)??"unknown";let l=i.get(c);l==null&&(l=new Set,i.set(c,l)),o.forEach(u=>l==null?void 0:l.add(u))});for(const[o,a]of i){const c=[];a.forEach(l=>{c.push(s.get(l)??0)}),this.scorePerMesh.set({topic:o},c)}}}}class Ct extends Error{constructor(e="Invalid peer score params"){super(e),this.name="InvalidPeerScoreParamsError"}}h(Ct,"name","InvalidPeerScoreParamsError");const hBe={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},dBe={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function fBe(r={}){return{...hBe,...r,topics:r.topics!=null?Object.entries(r.topics).reduce((e,[t,n])=>(e[t]=pBe(n),e),{}):{}}}function pBe(r={}){return{...dBe,...r}}function gBe(r){for(const[e,t]of Object.entries(r.topics))try{yBe(t)}catch(n){throw new Ct(`invalid score parameters for topic ${e}: ${n.message}`)}if(r.topicScoreCap<0)throw new Ct("invalid topic score cap; must be positive (or 0 for no cap)");if(r.appSpecificScore===null||r.appSpecificScore===void 0)throw new Ct("missing application specific score function");if(r.IPColocationFactorWeight>0)throw new Ct("invalid IPColocationFactorWeight; must be negative (or 0 to disable)");if(r.IPColocationFactorWeight!==0&&r.IPColocationFactorThreshold<1)throw new Ct("invalid IPColocationFactorThreshold; must be at least 1");if(r.behaviourPenaltyWeight>0)throw new Ct("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)");if(r.behaviourPenaltyWeight!==0&&(r.behaviourPenaltyDecay<=0||r.behaviourPenaltyDecay>=1))throw new Ct("invalid BehaviourPenaltyDecay; must be between 0 and 1");if(r.decayInterval<1e3)throw new Ct("invalid DecayInterval; must be at least 1s");if(r.decayToZero<=0||r.decayToZero>=1)throw new Ct("invalid DecayToZero; must be between 0 and 1")}function yBe(r){if(r.topicWeight<0)throw new Ct("invalid topic weight; must be >= 0");if(r.timeInMeshQuantum===0)throw new Ct("invalid TimeInMeshQuantum; must be non zero");if(r.timeInMeshWeight<0)throw new Ct("invalid TimeInMeshWeight; must be positive (or 0 to disable)");if(r.timeInMeshWeight!==0&&r.timeInMeshQuantum<=0)throw new Ct("invalid TimeInMeshQuantum; must be positive");if(r.timeInMeshWeight!==0&&r.timeInMeshCap<=0)throw new Ct("invalid TimeInMeshCap; must be positive");if(r.firstMessageDeliveriesWeight<0)throw new Ct("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)");if(r.firstMessageDeliveriesWeight!==0&&(r.firstMessageDeliveriesDecay<=0||r.firstMessageDeliveriesDecay>=1))throw new Ct("invalid FirstMessageDeliveriesDecay; must be between 0 and 1");if(r.firstMessageDeliveriesWeight!==0&&r.firstMessageDeliveriesCap<=0)throw new Ct("invalid FirstMessageDeliveriesCap; must be positive");if(r.meshMessageDeliveriesWeight>0)throw new Ct("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)");if(r.meshMessageDeliveriesWeight!==0&&(r.meshMessageDeliveriesDecay<=0||r.meshMessageDeliveriesDecay>=1))throw new Ct("invalid MeshMessageDeliveriesDecay; must be between 0 and 1");if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesCap<=0)throw new Ct("invalid MeshMessageDeliveriesCap; must be positive");if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesThreshold<=0)throw new Ct("invalid MeshMessageDeliveriesThreshold; must be positive");if(r.meshMessageDeliveriesWindow<0)throw new Ct("invalid MeshMessageDeliveriesWindow; must be non-negative");if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesActivation<1e3)throw new Ct("invalid MeshMessageDeliveriesActivation; must be at least 1s");if(r.meshFailurePenaltyWeight>0)throw new Ct("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)");if(r.meshFailurePenaltyWeight!==0&&(r.meshFailurePenaltyDecay<=0||r.meshFailurePenaltyDecay>=1))throw new Ct("invalid MeshFailurePenaltyDecay; must be between 0 and 1");if(r.invalidMessageDeliveriesWeight>0)throw new Ct("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)");if(r.invalidMessageDeliveriesDecay<=0||r.invalidMessageDeliveriesDecay>=1)throw new Ct("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1")}const mBe={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function wBe(r={}){return{...mBe,...r}}function KI(r,e,t=()=>!0){const n=new Set;if(e<=0)return n;for(const s of r){if(n.size>=e)break;t(s)&&(n.add(s),r.delete(s))}return n}function bBe(r,e){return KI(r,e,()=>!0)}class vBe extends Map{constructor(t){super();h(this,"getDefault");this.getDefault=t}getOrDefault(t){let n=super.get(t);return n===void 0&&(n=this.getDefault(),this.set(t,n)),n}}function EBe(r,e,t,n){let s=0;Object.entries(e.topics).forEach(([o,a])=>{const c=t.topics[o];if(c===void 0)return;let l=0;if(a.inMesh){let y=a.meshTime/c.timeInMeshQuantum;y>c.timeInMeshCap&&(y=c.timeInMeshCap),l+=y*c.timeInMeshWeight}let u=a.firstMessageDeliveries;if(u>c.firstMessageDeliveriesCap&&(u=c.firstMessageDeliveriesCap),l+=u*c.firstMessageDeliveriesWeight,a.meshMessageDeliveriesActive&&a.meshMessageDeliveries<c.meshMessageDeliveriesThreshold){const y=c.meshMessageDeliveriesThreshold-a.meshMessageDeliveries,f=y*y;l+=f*c.meshMessageDeliveriesWeight}const d=a.meshFailurePenalty;l+=d*c.meshFailurePenaltyWeight;const p=a.invalidMessageDeliveries*a.invalidMessageDeliveries;l+=p*c.invalidMessageDeliveriesWeight,s+=l*c.topicWeight}),t.topicScoreCap>0&&s>t.topicScoreCap&&(s=t.topicScoreCap);const i=t.appSpecificScore(r);if(s+=i*t.appSpecificWeight,e.knownIPs.forEach(o=>{if(t.IPColocationFactorWhitelist.has(o))return;const a=n.get(o),c=a!=null?a.size:0;if(c>t.IPColocationFactorThreshold){const l=c-t.IPColocationFactorThreshold,u=l*l;s+=u*t.IPColocationFactorWeight}}),e.behaviourPenalty>t.behaviourPenaltyThreshold){const o=e.behaviourPenalty-t.behaviourPenaltyThreshold,a=o*o;s+=a*t.behaviourPenaltyWeight}return s}function tr(r,t){var t=t||{};this._capacity=t.capacity,this._head=0,this._tail=0,Array.isArray(r)?this._fromArray(r):(this._capacityMask=3,this._list=new Array(4))}tr.prototype.peekAt=function(e){var t=e;if(t===(t|0)){var n=this.size();if(!(t>=n||t<-n))return t<0&&(t+=n),t=this._head+t&this._capacityMask,this._list[t]}};tr.prototype.get=function(e){return this.peekAt(e)};tr.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};tr.prototype.peekFront=function(){return this.peek()};tr.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(tr.prototype,"length",{get:function(){return this.size()}});tr.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};tr.prototype.unshift=function(e){if(arguments.length===0)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};tr.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}};tr.prototype.push=function(e){if(arguments.length===0)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};tr.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),n}};tr.prototype.removeOne=function(e){var t=e;if(t===(t|0)&&this._head!==this._tail){var n=this.size(),s=this._list.length;if(!(t>=n||t<-n)){t<0&&(t+=n),t=this._head+t&this._capacityMask;var i=this._list[t],o;if(e<n/2){for(o=e;o>0;o--)this._list[t]=this._list[t=t-1+s&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+s&this._capacityMask}else{for(o=n-1-e;o>0;o--)this._list[t]=this._list[t=t+1+s&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+s&this._capacityMask}return i}}};tr.prototype.remove=function(e,t){var n=e,s,i=t;if(n===(n|0)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(n>=o||n<-o||t<1)){if(n<0&&(n+=o),t===1||!t)return s=new Array(1),s[0]=this.removeOne(n),s;if(n===0&&n+t>=o)return s=this.toArray(),this.clear(),s;n+t>o&&(t=o-n);var c;for(s=new Array(t),c=0;c<t;c++)s[c]=this._list[this._head+n+c&this._capacityMask];if(n=this._head+n&this._capacityMask,e+t===o){for(this._tail=this._tail-t+a&this._capacityMask,c=t;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return s}if(e===0){for(this._head=this._head+t+a&this._capacityMask,c=t-1;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return s}if(n<o/2){for(this._head=this._head+e+t+a&this._capacityMask,c=e;c>0;c--)this.unshift(this._list[n=n-1+a&this._capacityMask]);for(n=this._head-1+a&this._capacityMask;i>0;)this._list[n=n-1+a&this._capacityMask]=void 0,i--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+t+a&this._capacityMask,c=o-(t+e);c>0;c--)this.push(this._list[n++]);for(n=this._tail;i>0;)this._list[n=n+1+a&this._capacityMask]=void 0,i--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),s}}};tr.prototype.splice=function(e,t){var n=e;if(n===(n|0)){var s=this.size();if(n<0&&(n+=s),!(n>s))if(arguments.length>2){var i,o,a,c=arguments.length,l=this._list.length,u=2;if(!s||n<s/2){for(o=new Array(n),i=0;i<n;i++)o[i]=this._list[this._head+i&this._capacityMask];for(t===0?(a=[],n>0&&(this._head=this._head+n+l&this._capacityMask)):(a=this.remove(n,t),this._head=this._head+n+l&this._capacityMask);c>u;)this.unshift(arguments[--c]);for(i=n;i>0;i--)this.unshift(o[i-1])}else{o=new Array(s-(n+t));var d=o.length;for(i=0;i<d;i++)o[i]=this._list[this._head+n+t+i&this._capacityMask];for(t===0?(a=[],n!=s&&(this._tail=this._head+n+l&this._capacityMask)):(a=this.remove(n,t),this._tail=this._tail-d+l&this._capacityMask);u<c;)this.push(arguments[u++]);for(i=0;i<d;i++)this.push(o[i])}return a}else return this.remove(n,t)}};tr.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0};tr.prototype.isEmpty=function(){return this._head===this._tail};tr.prototype.toArray=function(){return this._copyArray(!1)};tr.prototype._fromArray=function(e){var t=e.length,n=this._nextPowerOf2(t);this._list=new Array(n),this._capacityMask=n-1,this._tail=t;for(var s=0;s<t;s++)this._list[s]=e[s]};tr.prototype._copyArray=function(e,t){var n=this._list,s=n.length,i=this.length;if(t=t|i,t==i&&this._head<this._tail)return this._list.slice(this._head,this._tail);var o=new Array(t),a=0,c;if(e||this._head>this._tail){for(c=this._head;c<s;c++)o[a++]=n[c];for(c=0;c<this._tail;c++)o[a++]=n[c]}else for(c=this._head;c<this._tail;c++)o[a++]=n[c];return o};tr.prototype._growArray=function(){if(this._head!=0){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1};tr.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};tr.prototype._nextPowerOf2=function(e){var t=Math.log(e)/Math.log(2),n=1<<t+1;return Math.max(n,4)};var xBe=tr;const ABe=Zu(xBe);var os;(function(r){r[r.unknown=0]="unknown",r[r.valid=1]="valid",r[r.invalid=2]="invalid",r[r.ignored=3]="ignored"})(os||(os={}));class SBe{constructor(){h(this,"records");h(this,"queue");this.records=new Map,this.queue=new ABe}getRecord(e){return this.records.get(e)}ensureRecord(e){let t=this.records.get(e);if(t!=null)return t;t={status:os.unknown,firstSeenTsMs:Date.now(),validated:0,peers:new Set},this.records.set(e,t);const n={msgId:e,expire:Date.now()+XRe};return this.queue.push(n),t}gc(){const e=Date.now();let t=this.queue.peekFront();for(;t!=null&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}class CBe{constructor(e,t,n,s){h(this,"params");h(this,"metrics");h(this,"peerStats",new Map);h(this,"peerIPs",new vBe(()=>new Set));h(this,"scoreCache",new Map);h(this,"deliveryRecords",new SBe);h(this,"_backgroundInterval");h(this,"scoreCacheValidityMs");h(this,"computeScore");h(this,"log");this.params=e,this.metrics=t,gBe(e),this.scoreCacheValidityMs=s.scoreCacheValidityMs,this.computeScore=s.computeScore??EBe,this.log=n.forComponent("libp2p:gossipsub:score")}get size(){return this.peerStats.size}start(){if(this._backgroundInterval!=null){this.log("Peer score already running");return}this._backgroundInterval=setInterval(()=>{this.background()},this.params.decayInterval),this.log("started")}stop(){if(this._backgroundInterval==null){this.log("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),this.log("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,t])=>[e,t]))}messageFirstSeenTimestampMs(e){const t=this.deliveryRecords.getRecord(e);return t!=null?t.firstSeenTsMs:null}refreshScores(){const e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach((n,s)=>{if(!n.connected){e>n.expire&&(this.removeIPsForPeer(s,n.knownIPs),this.peerStats.delete(s),this.scoreCache.delete(s));return}Object.entries(n.topics).forEach(([i,o])=>{const a=this.params.topics[i];a!==void 0&&(o.firstMessageDeliveries*=a.firstMessageDeliveriesDecay,o.firstMessageDeliveries<t&&(o.firstMessageDeliveries=0),o.meshMessageDeliveries*=a.meshMessageDeliveriesDecay,o.meshMessageDeliveries<t&&(o.meshMessageDeliveries=0),o.meshFailurePenalty*=a.meshFailurePenaltyDecay,o.meshFailurePenalty<t&&(o.meshFailurePenalty=0),o.invalidMessageDeliveries*=a.invalidMessageDeliveriesDecay,o.invalidMessageDeliveries<t&&(o.invalidMessageDeliveries=0),o.inMesh&&(o.meshTime=e-o.graftTime,o.meshTime>a.meshMessageDeliveriesActivation&&(o.meshMessageDeliveriesActive=!0)))}),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<t&&(n.behaviourPenalty=0)})}score(e){var a,c,l;(a=this.metrics)==null||a.scoreFnCalls.inc();const t=this.peerStats.get(e);if(t==null)return 0;const n=Date.now(),s=this.scoreCache.get(e);if(s!=null&&s.cacheUntil>n)return s.score;(c=this.metrics)==null||c.scoreFnRuns.inc();const i=this.computeScore(e,t,this.params,this.peerIPs),o=n+this.scoreCacheValidityMs;return s!=null?((l=this.metrics)==null||l.scoreCachedDelta.observe(Math.abs(i-s.score)),s.score=i,s.cacheUntil=o):this.scoreCache.set(e,{score:i,cacheUntil:o}),i}addPenalty(e,t,n){var i;const s=this.peerStats.get(e);s!=null&&(s.behaviourPenalty+=t,(i=this.metrics)==null||i.onScorePenalty(n))}addPeer(e){const t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){const n=this.peerStats.get(e);n!=null&&n.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){const n=this.peerStats.get(e);n!=null&&n.knownIPs.delete(t);const s=this.peerIPs.get(t);s!=null&&(s.delete(e),s.size===0&&this.peerIPs.delete(t))}removePeer(e){const t=this.peerStats.get(e);if(t!=null){if(this.score(e)>0){this.removeIPsForPeer(e,t.knownIPs),this.peerStats.delete(e);return}Object.entries(t.topics).forEach(([n,s])=>{s.firstMessageDeliveries=0;const i=this.params.topics[n].meshMessageDeliveriesThreshold;if(s.inMesh&&s.meshMessageDeliveriesActive&&s.meshMessageDeliveries<i){const o=i-s.meshMessageDeliveries;s.meshFailurePenalty+=o*o}s.inMesh=!1,s.meshMessageDeliveriesActive=!1}),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){const n=this.peerStats.get(e);if(n!=null){const s=this.getPtopicStats(n,t);s!=null&&(s.inMesh=!0,s.graftTime=Date.now(),s.meshTime=0,s.meshMessageDeliveriesActive=!1)}}prune(e,t){const n=this.peerStats.get(e);if(n!=null){const s=this.getPtopicStats(n,t);if(s!=null){const i=this.params.topics[t].meshMessageDeliveriesThreshold;if(s.meshMessageDeliveriesActive&&s.meshMessageDeliveries<i){const o=i-s.meshMessageDeliveries;s.meshFailurePenalty+=o*o}s.meshMessageDeliveriesActive=!1,s.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,n){this.markFirstMessageDelivery(e,n);const s=this.deliveryRecords.ensureRecord(t),i=Date.now();if(s.status!==os.unknown){this.log("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,i-s.firstSeenTsMs,os[s.status]);return}s.status=os.valid,s.validated=i,s.peers.forEach(o=>{o!==e.toString()&&this.markDuplicateMessageDelivery(o,n)})}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,n,s){switch(s){case So.Error:this.markInvalidMessageDelivery(e,n);return;case So.Blacklisted:return}const i=this.deliveryRecords.ensureRecord(t);if(i.status!==os.unknown){this.log("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-i.firstSeenTsMs,os[i.status]);return}if(s===So.Ignore){i.status=os.ignored,i.peers.clear();return}i.status=os.invalid,this.markInvalidMessageDelivery(e,n),i.peers.forEach(o=>{this.markInvalidMessageDelivery(o,n)}),i.peers.clear()}duplicateMessage(e,t,n){const s=this.deliveryRecords.ensureRecord(t);if(!s.peers.has(e))switch(s.status){case os.unknown:s.peers.add(e);break;case os.valid:s.peers.add(e),this.markDuplicateMessageDelivery(e,n,s.validated);break;case os.invalid:this.markInvalidMessageDelivery(e,n);break;case os.ignored:break}}markInvalidMessageDelivery(e,t){const n=this.peerStats.get(e);if(n!=null){const s=this.getPtopicStats(n,t);s!=null&&(s.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){const n=this.peerStats.get(e);if(n!=null){const s=this.getPtopicStats(n,t);if(s!=null){let i=this.params.topics[t].firstMessageDeliveriesCap;s.firstMessageDeliveries=Math.min(i,s.firstMessageDeliveries+1),s.inMesh&&(i=this.params.topics[t].meshMessageDeliveriesCap,s.meshMessageDeliveries=Math.min(i,s.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,n){var i;const s=this.peerStats.get(e);if(s!=null){const o=n!==void 0?Date.now():0,a=this.getPtopicStats(s,t);if(a!=null&&a.inMesh){const c=this.params.topics[t];if(n!==void 0){const u=o-n,d=u>c.meshMessageDeliveriesWindow;if((i=this.metrics)==null||i.onDuplicateMsgDelivery(t,u,d),d)return}const l=c.meshMessageDeliveriesCap;a.meshMessageDeliveries=Math.min(l,a.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(const n of t){const s=this.peerIPs.get(n);s!=null&&(s.delete(e),s.size===0&&this.peerIPs.delete(n))}}getPtopicStats(e,t){let n=e.topics[t];return n!==void 0?n:this.params.topics[t]!==void 0?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=n,n):null}}function IBe(r,e,t,n,s){let i=0;const o=new Map;if(Object.entries(e.topics).forEach(([p,y])=>{const f=s.get(p)??"unknown",g=t.topics[p];if(g===void 0)return;let w=o.get(f);w==null&&(w={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(f,w));let m=0,b=0,v=0,E=0,S=0;if(y.inMesh){const P=Math.max(y.meshTime/g.timeInMeshQuantum,g.timeInMeshCap);m+=P*g.timeInMeshWeight}let I=y.firstMessageDeliveries;if(I>g.firstMessageDeliveriesCap&&(I=g.firstMessageDeliveriesCap),b+=I*g.firstMessageDeliveriesWeight,y.meshMessageDeliveriesActive&&y.meshMessageDeliveries<g.meshMessageDeliveriesThreshold){const P=g.meshMessageDeliveriesThreshold-y.meshMessageDeliveries,L=P*P;v+=L*g.meshMessageDeliveriesWeight}const x=y.meshFailurePenalty;E+=x*g.meshFailurePenaltyWeight;const C=y.invalidMessageDeliveries*y.invalidMessageDeliveries;S+=C*g.invalidMessageDeliveriesWeight,i+=(m+b+v+E+S)*g.topicWeight,w.p1w+=m,w.p2w+=b,w.p3w+=v,w.p3bw+=E,w.p4w+=S}),t.topicScoreCap>0&&i>t.topicScoreCap){i=t.topicScoreCap;const p=t.topicScoreCap/i;for(const y of o.values())y.p1w*=p,y.p2w*=p,y.p3w*=p,y.p3bw*=p,y.p4w*=p}let a=0,c=0,l=0;const u=t.appSpecificScore(r);a+=u*t.appSpecificWeight,e.knownIPs.forEach(p=>{if(t.IPColocationFactorWhitelist.has(p))return;const y=n.get(p),f=y!=null?y.size:0;if(f>t.IPColocationFactorThreshold){const g=f-t.IPColocationFactorThreshold,w=g*g;c+=w*t.IPColocationFactorWeight}});const d=e.behaviourPenalty*e.behaviourPenalty;return l+=d*t.behaviourPenaltyWeight,i+=a+c+l,{byTopic:o,p5w:a,p6w:c,p7w:l,score:i}}function kBe(r,e,t,n,s){const i={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const o of r){const a=e.get(o);if(a!=null){const c=IBe(o,a,t,n,s);for(const[l,u]of c.byTopic){let d=i.byTopic.get(l);d==null&&(d={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},i.byTopic.set(l,d)),d.p1w.push(u.p1w),d.p2w.push(u.p2w),d.p3w.push(u.p3w),d.p3bw.push(u.p3bw),d.p4w.push(u.p4w)}i.p5w.push(c.p5w),i.p6w.push(c.p6w),i.p7w.push(c.p7w),i.score.push(c.score)}else i.p5w.push(0),i.p6w.push(0),i.p7w.push(0),i.score.push(0)}return i}class TBe{constructor(e,t,n){h(this,"rawStream");h(this,"pushable");h(this,"closeController");h(this,"maxBufferSize");this.rawStream=e,this.pushable=Nc(),this.closeController=new AbortController,this.maxBufferSize=n.maxBufferSize??1/0,this.closeController.signal.addEventListener("abort",()=>{e.close().catch(s=>{e.abort(s)})}),Jn(this.pushable,this.rawStream).catch(t)}get protocol(){return this.rawStream.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(CN.single(e))}pushPrefixed(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}async close(){this.closeController.abort(),await this.pushable.return()}}class _Be{constructor(e,t={}){h(this,"source");h(this,"rawStream");h(this,"closeController");this.rawStream=e,this.closeController=new AbortController,this.closeController.signal.addEventListener("abort",()=>{e.close().catch(n=>{e.abort(n)})}),this.source=Jn(this.rawStream,n=>VI(n,t))}async close(){this.closeController.abort()}}class PBe{constructor(e,t,n){h(this,"gossipsubIWantFollowupMs");h(this,"msgIdToStrFn");h(this,"metrics");h(this,"promises",new Map);h(this,"requestMsByMsg",new Map);h(this,"requestMsByMsgExpire");this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=n,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){const n=Math.floor(Math.random()*t.length),s=t[n],i=this.msgIdToStrFn(s);let o=this.promises.get(i);o==null&&(o=new Map,this.promises.set(i,o));const a=Date.now();o.has(e)||(o.set(e,a+this.gossipsubIWantFollowupMs),this.metrics!=null&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(i)||this.requestMsByMsg.set(i,a)))}getBrokenPromises(){var s;const e=Date.now(),t=new Map;let n=0;return this.promises.forEach((i,o)=>{i.forEach((a,c)=>{a<e&&(t.set(c,(t.get(c)??0)+1),i.delete(c),n++)}),i.size===0&&this.promises.delete(o)}),(s=this.metrics)==null||s.iwantPromiseBroken.inc(n),t}deliverMessage(e,t=!1){this.trackMessage(e);const n=this.promises.get(e);n!=null&&(this.promises.delete(e),this.metrics!=null&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(n.size)))}rejectMessage(e,t){switch(this.trackMessage(e),t){case So.Error:return}this.promises.delete(e)}clear(){this.promises.clear()}prune(){var n;const e=Date.now()-this.requestMsByMsgExpire;let t=0;for(const[s,i]of this.requestMsByMsg.entries())if(i<e)this.requestMsByMsg.delete(s),t++;else break;(n=this.metrics)==null||n.iwantMessagePruned.inc(t)}trackMessage(e){if(this.metrics!=null){const t=this.requestMsByMsg.get(e);t!==void 0&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}const _ee=he("libp2p-pubsub:");async function NBe(r,e,t,n){switch(r.type){case N1.Signing:{const s={from:r.author.toMultihash().bytes,data:n,seqno:Fu(8),topic:e,signature:void 0,key:void 0},i=Cr([_ee,Od.Message.encode(s)]);s.signature=await r.privateKey.sign(i),s.key=r.key;const o={type:"signed",from:r.author,data:t,sequenceNumber:BigInt(`0x${ce(s.seqno??new Uint8Array(0),"base16")}`),topic:e,signature:s.signature,key:Is(s.key)};return{raw:s,msg:o}}case N1.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:e,signature:void 0,key:void 0},msg:{type:"unsigned",data:t,topic:e}};default:throw new Error("Unreachable")}}async function DBe(r,e){switch(r){case JT:return e.signature!=null?{valid:!1,error:is.SignaturePresent}:e.seqno!=null?{valid:!1,error:is.SeqnoPresent}:e.key!=null?{valid:!1,error:is.FromPresent}:{valid:!0,message:{type:"unsigned",topic:e.topic,data:e.data??new Uint8Array(0)}};case E8:{if(e.seqno==null)return{valid:!1,error:is.InvalidSeqno};if(e.seqno.length!==8)return{valid:!1,error:is.InvalidSeqno};if(e.signature==null)return{valid:!1,error:is.InvalidSignature};if(e.from==null)return{valid:!1,error:is.InvalidPeerId};let t;try{t=ri(kee(e.from))}catch{return{valid:!1,error:is.InvalidPeerId}}let n;if(e.key!=null){if(n=Is(e.key),t.publicKey!==void 0&&!n.equals(t.publicKey))return{valid:!1,error:is.InvalidPeerId}}else{if(t.publicKey==null)return{valid:!1,error:is.InvalidPeerId};n=t.publicKey}const s={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},i=Cr([_ee,Od.Message.encode(s)]);return await n.verify(i,e.signature)?{valid:!0,message:{type:"signed",from:t,data:e.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${ce(e.seqno,"base16")}`),topic:e.topic,signature:e.signature,key:e.key!=null?Is(e.key):n}}:{valid:!1,error:is.InvalidSignature}}default:throw new Error("Unreachable")}}function Ho(r=[],e){return{subscriptions:[],messages:r,control:e!==void 0?{graft:e.graft??[],prune:e.prune??[],ihave:e.ihave??[],iwant:e.iwant??[],idontwant:e.idontwant??[]}:void 0}}function pF(r){return r.control===void 0&&(r.control={graft:[],prune:[],ihave:[],iwant:[],idontwant:[]}),r}function Ba(r){if(r.length<=1)return r;const e=()=>Math.floor(Math.random()*Math.floor(r.length));for(let t=0;t<r.length;t++){const n=e(),s=r[t];r[t]=r[n],r[n]=s}return r}function OBe(r){return ce(r,"base64")}function RBe(r,e,t){switch(r){case E8:return{type:N1.Signing,author:e,key:$i(t.publicKey),privateKey:t};case JT:return{type:N1.Anonymous};default:throw new Error(`Unknown signature policy "${r}"`)}}const BBe=(r,e)=>{const t=he(e.toString(16).padStart(16,"0"),"base16"),n=$i(r),s=new Uint8Array(n.byteLength+t.length);return s.set(n,0),s.set(t,n.byteLength),s};function MBe({name:r,code:e,encode:t}){return new $Be(r,e,t)}class $Be{constructor(e,t,n){h(this,"name");h(this,"code");h(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?aF(this.code,t):t.then(n=>aF(this.code,n))}else throw Error("Unknown type, must be binary type")}}function LBe(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const UBe=MBe({name:"sha2-256",code:18,encode:LBe("SHA-256")});function FBe(r){if(r.type!=="signed")throw new Error("expected signed message type");if(r.sequenceNumber==null)throw Error("missing seqno field");return BBe(r.from.publicKey??r.key,r.sequenceNumber)}async function zBe(r){return UBe.encode(r.data)}var D6;(function(r){r[r.ip4=4]="ip4",r[r.ip6=41]="ip6"})(D6||(D6={}));function VBe(r){for(const e of r.tuples())switch(e[0]){case D6.ip4:case D6.ip6:return tP(e[0],e[1])}return null}class YE{constructor(e){h(this,"entries",new Map);h(this,"validityMs");this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return this.entries.has(e)?!0:(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){const e=Date.now();for(const[t,n]of this.entries.entries())if(n.validUntilMs<e)this.entries.delete(t);else break}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);return t!=null&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}var Rs;(function(r){r[r.started=0]="started",r[r.stopped=1]="stopped"})(Rs||(Rs={}));var JV,YV,XV,ZV;class Pee extends(ZV=Er,XV=Symbol.toStringTag,YV=Lr,JV=Lu,ZV){constructor(t,n={}){super();h(this,"globalSignaturePolicy");h(this,"multicodecs",[JE,kRe,lF]);h(this,"publishConfig");h(this,"dataTransform");h(this,"peers",new Map);h(this,"streamsInbound",new Map);h(this,"streamsOutbound",new Map);h(this,"outboundInflightQueue",Nc({objectMode:!0}));h(this,"direct",new Set);h(this,"floodsubPeers",new Set);h(this,"seenCache");h(this,"acceptFromWhitelist",new Map);h(this,"topics",new Map);h(this,"subscriptions",new Set);h(this,"mesh",new Map);h(this,"fanout",new Map);h(this,"fanoutLastpub",new Map);h(this,"gossip",new Map);h(this,"control",new Map);h(this,"peerhave",new Map);h(this,"iasked",new Map);h(this,"backoff",new Map);h(this,"outbound",new Map);h(this,"msgIdFn");h(this,"fastMsgIdFn");h(this,"msgIdToStrFn");h(this,"fastMsgIdCache");h(this,"publishedMessageIds");h(this,"mcache");h(this,"score");h(this,"topicValidators",new Map);h(this,"log");h(this,"heartbeatTicks",0);h(this,"gossipTracer");h(this,"idontwantCounts",new Map);h(this,"idontwants",new Map);h(this,"components");h(this,"directPeerInitial",null);h(this,"opts");h(this,"decodeRpcLimits");h(this,"metrics");h(this,"status",{code:Rs.stopped});h(this,"maxInboundStreams");h(this,"maxOutboundStreams");h(this,"runOnLimitedConnection");h(this,"allowedTopics");h(this,"heartbeatTimer",null);h(this,XV,"@chainsafe/libp2p-gossipsub");h(this,YV,["@libp2p/pubsub"]);h(this,JV,["@libp2p/identify"]);h(this,"runHeartbeat",()=>{var n;const t=(n=this.metrics)==null?void 0:n.heartbeatDuration.startTimer();this.heartbeat().catch(s=>{this.log("Error running heartbeat",s)}).finally(()=>{var s;if(t!=null&&t(),this.status.code===Rs.started){clearTimeout(this.status.heartbeatTimeout);let i=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;i<this.opts.heartbeatInterval*.25&&(i+=this.opts.heartbeatInterval,(s=this.metrics)==null||s.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,i)}})});h(this,"tagMeshPeer",t=>{const{peerId:n,topic:s}=t.detail;this.components.peerStore.merge(this.peers.get(n)??mr(n),{tags:{[s]:{value:100}}}).catch(i=>{this.log.error("Error tagging peer %s with topic %s",n,s,i)})});h(this,"untagMeshPeer",t=>{const{peerId:n,topic:s}=t.detail;this.components.peerStore.merge(this.peers.get(n)??mr(n),{tags:{[s]:void 0}}).catch(i=>{this.log.error("Error untagging peer %s with topic %s",n,s,i)})});const s={fallbackToFloodsub:!0,floodPublish:!0,batchPublish:!1,tagMeshPeers:!0,doPX:!1,directPeers:[],D:TRe,Dlo:_Re,Dhi:PRe,Dscore:NRe,Dout:DRe,Dlazy:BRe,heartbeatInterval:LRe,fanoutTTL:URe,mcacheLength:ORe,mcacheGossip:RRe,seenTTL:YRe,gossipsubIWantFollowupMs:JRe,prunePeers:FRe,pruneBackoff:zRe,unsubcribeBackoff:VRe,graftFloodThreshold:WRe,opportunisticGraftPeers:qRe,opportunisticGraftTicks:jRe,directConnectTicks:KRe,gossipFactor:MRe,idontwantMinDataSize:oBe,idontwantMaxMessages:aBe,...n,scoreParams:fBe(n.scoreParams),scoreThresholds:wBe(n.scoreThresholds)};if(this.components=t,this.decodeRpcLimits=s.decodeRpcLimits??cBe,this.globalSignaturePolicy=s.globalSignaturePolicy??E8,s.fallbackToFloodsub&&this.multicodecs.push(cF),this.log=t.logger.forComponent(s.debugName??"libp2p:gossipsub"),this.opts=s,this.direct=new Set(s.directPeers.map(i=>i.id.toString())),this.seenCache=new YE({validityMs:s.seenTTL}),this.publishedMessageIds=new YE({validityMs:s.seenTTL}),n.msgIdFn!=null)this.msgIdFn=n.msgIdFn;else switch(this.globalSignaturePolicy){case E8:this.msgIdFn=FBe;break;case JT:this.msgIdFn=zBe;break;default:throw new Error(`Invalid globalSignaturePolicy: ${this.globalSignaturePolicy}`)}if(n.fastMsgIdFn!=null&&(this.fastMsgIdFn=n.fastMsgIdFn,this.fastMsgIdCache=new YE({validityMs:s.seenTTL})),this.msgIdToStrFn=n.msgIdToStrFn??OBe,this.mcache=n.messageCache??new lBe(s.mcacheGossip,s.mcacheLength,this.msgIdToStrFn),n.dataTransform!=null&&(this.dataTransform=n.dataTransform),n.metricsRegister!=null){if(n.metricsTopicStrToLabel==null)throw Error("Must set metricsTopicStrToLabel with metrics");const i=Math.max(...Object.values(s.scoreParams.topics).map(a=>a.meshMessageDeliveriesWindow),sBe),o=uBe(n.metricsRegister,n.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:s.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:i/1e3});o.mcacheSize.addCollect(()=>{this.onScrapeMetrics(o)});for(const a of this.multicodecs)o.protocolsEnabled.set({protocol:a},1);this.metrics=o}else this.metrics=null;this.gossipTracer=new PBe(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new CBe(this.opts.scoreParams,this.metrics,this.components.logger,{scoreCacheValidityMs:s.heartbeatInterval}),this.maxInboundStreams=n.maxInboundStreams,this.maxOutboundStreams=n.maxOutboundStreams,this.runOnLimitedConnection=n.runOnLimitedConnection,this.allowedTopics=s.allowedTopics!=null?new Set(s.allowedTopics):null}getPeers(){return[...this.peers.values()]}isStarted(){return this.status.code===Rs.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=RBe(this.globalSignaturePolicy,this.components.peerId,this.components.privateKey),this.outboundInflightQueue=Nc({objectMode:!0}),Jn(this.outboundInflightQueue,async o=>{for await(const{peerId:a,connection:c}of o)await this.createOutboundStream(a,c)}).catch(o=>{this.log.error("outbound inflight queue error",o)}),await Promise.all(this.opts.directPeers.map(async o=>{await this.components.peerStore.merge(o.id,{multiaddrs:o.addrs})}));const t=this.components.registrar;await Promise.all(this.multicodecs.map(async o=>t.handle(o,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection})));const n={onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this),notifyOnLimitedConnection:this.runOnLimitedConnection},s=await Promise.all(this.multicodecs.map(async o=>t.register(o,n))),i=setTimeout(this.runHeartbeat,uF);this.status={code:Rs.started,registrarTopologyIds:s,heartbeatTimeout:i,hearbeatStartMs:Date.now()+uF},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async o=>this.connect(o)))}).catch(o=>{this.log(o)})},GRe),this.opts.tagMeshPeers&&(this.addEventListener("gossipsub:graft",this.tagMeshPeer),this.addEventListener("gossipsub:prune",this.untagMeshPeer)),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==Rs.started)return;const{registrarTopologyIds:t}=this.status;this.status={code:Rs.stopped},this.opts.tagMeshPeers&&(this.removeEventListener("gossipsub:graft",this.tagMeshPeer),this.removeEventListener("gossipsub:prune",this.untagMeshPeer));const n=this.components.registrar;await Promise.all(this.multicodecs.map(async i=>n.unhandle(i))),t.forEach(i=>{n.unregister(i)}),this.outboundInflightQueue.end();const s=[];for(const i of this.streamsOutbound.values())s.push(i.close());this.streamsOutbound.clear();for(const i of this.streamsInbound.values())s.push(i.close());this.streamsInbound.clear(),await Promise.all(s),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer!=null&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache!=null&&this.fastMsgIdCache.clear(),this.directPeerInitial!=null&&clearTimeout(this.directPeerInitial),this.idontwantCounts.clear(),this.idontwants.clear(),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:t,connection:n}){if(!this.isStarted())return;const s=n.remotePeer;this.addPeer(s,n.direction,n.remoteAddr),this.createInboundStream(s,t),this.outboundInflightQueue.push({peerId:s,connection:n})}onPeerConnected(t,n){var s;(s=this.metrics)==null||s.newConnectionCount.inc({status:n.status}),!(!this.isStarted()||n.status!=="open")&&(this.addPeer(t,n.direction,n.remoteAddr),this.outboundInflightQueue.push({peerId:t,connection:n}))}onPeerDisconnected(t){this.log("connection ended %p",t),this.removePeer(t)}async createOutboundStream(t,n){var i;if(!this.isStarted())return;const s=t.toString();if(this.peers.has(s)&&!this.streamsOutbound.has(s))try{const o=new TBe(await n.newStream(this.multicodecs,{runOnLimitedConnection:this.runOnLimitedConnection}),c=>{this.log.error("outbound pipe error",c)},{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",t),this.streamsOutbound.set(s,o);const a=o.protocol;a===cF&&this.floodsubPeers.add(s),(i=this.metrics)==null||i.peersPerProtocol.inc({protocol:a},1),this.subscriptions.size>0&&(this.log("send subscriptions to",s),this.sendSubscriptions(s,Array.from(this.subscriptions),!0))}catch(o){this.log.error("createOutboundStream error",o)}}createInboundStream(t,n){if(!this.isStarted())return;const s=t.toString();if(!this.peers.has(s))return;const i=this.streamsInbound.get(s);i!==void 0&&(this.log("replacing existing inbound steam %s",s),i.close().catch(a=>{this.log.error(a)})),this.log("create inbound stream %s",s);const o=new _Be(n,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(s,o),this.pipePeerReadStream(t,o.source).catch(a=>{this.log(a)})}addPeer(t,n,s){const i=t.toString();if(!this.peers.has(i)){this.log("new peer %p",t),this.peers.set(i,t),this.score.addPeer(i);const o=VBe(s);o!==null?this.score.addIP(i,o):this.log("Added peer has no IP in current address %s %s",i,s.toString()),this.outbound.has(i)||this.outbound.set(i,n==="outbound")}}removePeer(t){var o,a;const n=t.toString();if(!this.peers.has(n))return;this.log("delete peer %p",t),this.peers.delete(n);const s=this.streamsOutbound.get(n),i=this.streamsInbound.get(n);s!=null&&((o=this.metrics)==null||o.peersPerProtocol.inc({protocol:s.protocol},-1)),s==null||s.close().catch(c=>{this.log.error(c)}),i==null||i.close().catch(c=>{this.log.error(c)}),this.streamsOutbound.delete(n),this.streamsInbound.delete(n);for(const c of this.topics.values())c.delete(n);for(const[c,l]of this.mesh)l.delete(n)&&((a=this.metrics)==null||a.onRemoveFromMesh(c,la.Dc,1));for(const c of this.fanout.values())c.delete(n);this.floodsubPeers.delete(n),this.gossip.delete(n),this.control.delete(n),this.outbound.delete(n),this.idontwantCounts.delete(n),this.idontwants.delete(n),this.score.removePeer(n),this.acceptFromWhitelist.delete(n)}get started(){return this.status.code===Rs.started}getMeshPeers(t){const n=this.mesh.get(t);return n!=null?Array.from(n):[]}getSubscribers(t){const n=this.topics.get(t);return(n!=null?Array.from(n):[]).map(s=>this.peers.get(s)??mr(s))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(t,n){var s;try{await Jn(n,async i=>{var o,a,c;for await(const l of i)try{const u=l.subarray(),d=Od.decode(u,{limits:{subscriptions:this.decodeRpcLimits.maxSubscriptions,messages:this.decodeRpcLimits.maxMessages,control$:{ihave:this.decodeRpcLimits.maxIhaveMessageIDs,iwant:this.decodeRpcLimits.maxIwantMessageIDs,graft:this.decodeRpcLimits.maxControlMessages,prune:this.decodeRpcLimits.maxControlMessages,prune$:{peers:this.decodeRpcLimits.maxPeerInfos},idontwant:this.decodeRpcLimits.maxControlMessages,idontwant$:{messageIDs:this.decodeRpcLimits.maxIdontwantMessageIDs}}}});if((o=this.metrics)==null||o.onRpcRecv(d,u.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(t,d)}catch(p){(a=this.metrics)==null||a.onRpcRecvError(),this.log(p)}else this.handleReceivedRpc(t,d).catch(p=>{var y;(y=this.metrics)==null||y.onRpcRecvError(),this.log(p)})}catch(u){(c=this.metrics)==null||c.onRpcDataError(),this.log(u)}})}catch(i){(s=this.metrics)==null||s.onPeerReadStreamError(),this.handlePeerReadStreamError(i,t)}}handlePeerReadStreamError(t,n){this.log.error(t),this.onPeerDisconnected(n)}async handleReceivedRpc(t,n){var u;if(!this.acceptFrom(t.toString())){this.log("received message from unacceptable peer %p",t),(u=this.metrics)==null||u.rpcRecvNotAccepted.inc();return}const s=n.subscriptions!=null?n.subscriptions.length:0,i=n.messages!=null?n.messages.length:0;let o=0,a=0,c=0,l=0;if(n.control!=null&&(n.control.ihave!=null&&(o=n.control.ihave.length),n.control.iwant!=null&&(a=n.control.iwant.length),n.control.graft!=null&&(c=n.control.graft.length),n.control.prune!=null&&(l=n.control.prune.length)),this.log(`rpc.from ${t.toString()} subscriptions ${s} messages ${i} ihave ${o} iwant ${a} graft ${c} prune ${l}`),n.subscriptions!=null&&n.subscriptions.length>0){const d=[];n.subscriptions.forEach(p=>{const y=p.topic,f=p.subscribe===!0;if(y!=null){if(this.allowedTopics!=null&&!this.allowedTopics.has(y))return;this.handleReceivedSubscription(t,y,f),d.push({topic:y,subscribe:f})}}),this.safeDispatchEvent("subscription-change",{detail:{peerId:t,subscriptions:d}})}for(const d of n.messages){if(this.allowedTopics!=null&&!this.allowedTopics.has(d.topic))continue;const p=this.handleReceivedMessage(t,d).catch(y=>{var f;(f=this.metrics)==null||f.onMsgRecvError(d.topic),this.log(y)});this.opts.awaitRpcMessageHandler&&await p}n.control!=null&&await this.handleControlMessage(t.toString(),n.control)}handleReceivedSubscription(t,n,s){this.log("subscription update from %p topic %s",t,n);let i=this.topics.get(n);i==null&&(i=new Set,this.topics.set(n,i)),s?i.add(t.toString()):i.delete(t.toString())}async handleReceivedMessage(t,n){var o,a,c;(o=this.metrics)==null||o.onMsgRecvPreValidation(n.topic);const s=await this.validateReceivedMessage(t,n);(a=this.metrics)==null||a.onPrevalidationResult(n.topic,s.code);const i=s.code;switch(i){case ls.duplicate:this.score.duplicateMessage(t.toString(),s.msgIdStr,n.topic),this.gossipTracer.deliverMessage(s.msgIdStr,!0),this.mcache.observeDuplicate(s.msgIdStr,t.toString());return;case ls.invalid:if(s.msgIdStr!=null){const l=s.msgIdStr;this.score.rejectMessage(t.toString(),l,n.topic,s.reason),this.gossipTracer.rejectMessage(l,s.reason)}else this.score.rejectInvalidMessage(t.toString(),n.topic);(c=this.metrics)==null||c.onMsgRecvInvalid(n.topic,s);return;case ls.valid:this.score.validateMessage(s.messageId.msgIdStr),this.gossipTracer.deliverMessage(s.messageId.msgIdStr),this.mcache.put(s.messageId,n,!this.opts.asyncValidation),this.subscriptions.has(n.topic)&&(!this.components.peerId.equals(t)||this.opts.emitSelf)&&(super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:t,msgId:s.messageId.msgIdStr,msg:s.msg}})),super.dispatchEvent(new CustomEvent("message",{detail:s.msg}))),this.opts.asyncValidation||this.forwardMessage(s.messageId.msgIdStr,n,t.toString());break;default:throw new Error(`Invalid validation result: ${i}`)}}async validateReceivedMessage(t,n){var p,y,f,g;const s=(p=this.fastMsgIdFn)==null?void 0:p.call(this,n),i=s!==void 0?(y=this.fastMsgIdCache)==null?void 0:y.get(s):void 0;if(i!=null)return{code:ls.duplicate,msgIdStr:i};const o=await DBe(this.globalSignaturePolicy,n);if(!o.valid)return{code:ls.invalid,reason:So.Error,error:o.error};const a=o.message;try{this.dataTransform!=null&&(a.data=this.dataTransform.inboundTransform(n.topic,a.data))}catch(w){return this.log("Invalid message, transform failed",w),{code:ls.invalid,reason:So.Error,error:is.TransformFailed}}const c=await this.msgIdFn(a),l=this.msgIdToStrFn(c),u={msgId:c,msgIdStr:l};if(s!==void 0&&this.fastMsgIdCache!=null&&this.fastMsgIdCache.put(s,l)&&((f=this.metrics)==null||f.fastMsgIdCacheCollision.inc()),this.seenCache.has(l))return{code:ls.duplicate,msgIdStr:l};this.seenCache.put(l),(((g=n.data)==null?void 0:g.length)??0)>=this.opts.idontwantMinDataSize&&this.sendIDontWants(c,n.topic,t.toString());const d=this.topicValidators.get(n.topic);if(d!=null){let w;try{w=await d(t,a)}catch(m){const b=m.code;b===eBe&&(w=Pi.Ignore),b===ZRe?w=Pi.Reject:w=Pi.Ignore}if(w!==Pi.Accept)return{code:ls.invalid,reason:dF(w),msgIdStr:l}}return{code:ls.valid,messageId:u,msg:a}}getScore(t){return this.score.score(t)}sendSubscriptions(t,n,s){this.sendRpc(t,{subscriptions:n.map(i=>({topic:i,subscribe:s})),messages:[]})}async handleControlMessage(t,n){var l,u,d,p,y,f,g;if(n===void 0)return;const s=((l=n.ihave)==null?void 0:l.length)>0?this.handleIHave(t,n.ihave):[],i=((u=n.iwant)==null?void 0:u.length)>0?this.handleIWant(t,n.iwant):[],o=((d=n.graft)==null?void 0:d.length)>0?await this.handleGraft(t,n.graft):[];if(((p=n.prune)==null?void 0:p.length)>0&&await this.handlePrune(t,n.prune),((y=n.idontwant)==null?void 0:y.length)>0&&this.handleIdontwant(t,n.idontwant),s.length===0&&i.length===0&&o.length===0)return;const a=this.sendRpc(t,Ho(i,{iwant:s,prune:o})),c=(f=s[0])==null?void 0:f.messageIDs;c!=null&&(a?this.gossipTracer.addPromise(t,c):(g=this.metrics)==null||g.iwantPromiseUntracked.inc(1))}acceptFrom(t){if(this.direct.has(t))return!0;const n=Date.now(),s=this.acceptFromWhitelist.get(t);if(s!=null&&s.messagesAccepted<rBe&&s.acceptUntil>=n)return s.messagesAccepted+=1,!0;const i=this.score.score(t);return i>=tBe?this.acceptFromWhitelist.set(t,{messagesAccepted:0,acceptUntil:n+nBe}):this.acceptFromWhitelist.delete(t),i>=this.opts.scoreThresholds.graylistThreshold}handleIHave(t,n){var u,d,p;if(n.length===0)return[];const s=this.score.score(t);if(s<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",t,s),(u=this.metrics)==null||u.ihaveRcvIgnored.inc({reason:K2.LowScore}),[];const i=(this.peerhave.get(t)??0)+1;if(this.peerhave.set(t,i),i>QRe)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",t,i),(d=this.metrics)==null||d.ihaveRcvIgnored.inc({reason:K2.MaxIhave}),[];const o=this.iasked.get(t)??0;if(o>=Xf)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",t,o),(p=this.metrics)==null||p.ihaveRcvIgnored.inc({reason:K2.MaxIasked}),[];const a=new Map;if(n.forEach(({topicID:y,messageIDs:f})=>{var w;if(y==null||f==null||!this.mesh.has(y))return;let g=0;f.forEach(m=>{const b=this.msgIdToStrFn(m);this.seenCache.has(b)||(a.set(b,m),g++)}),(w=this.metrics)==null||w.onIhaveRcv(y,f.length,g)}),a.size===0)return[];let c=a.size;c+o>Xf&&(c=Xf-o),this.log("IHAVE: Asking for %d out of %d messages from %s",c,a.size,t);let l=Array.from(a.values());return Ba(l),l=l.slice(0,c),this.iasked.set(t,o+c),[{messageIDs:l}]}handleIWant(t,n){var c;if(n.length===0)return[];const s=this.score.score(t);if(s<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",t,s),[];const i=new Map,o=new Map;let a=0;return n.forEach(({messageIDs:l})=>{l==null||l.forEach(u=>{const d=this.msgIdToStrFn(u),p=this.mcache.getWithIWantCount(d,t);if(p==null){a++;return}if(o.set(p.msg.topic,1+(o.get(p.msg.topic)??0)),p.count>$Re){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",t,u);return}i.set(d,p.msg)})}),(c=this.metrics)==null||c.onIwantRcv(o,a),i.size===0?(this.log("IWANT: Could not provide any wanted messages to %s",t),[]):(this.log("IWANT: Sending %d messages to %s",i.size,t),Array.from(i.values()))}async handleGraft(t,n){const s=[],i=this.score.score(t),o=Date.now();let a=this.opts.doPX;if(n.forEach(({topicID:l})=>{var p,y;if(l==null)return;const u=this.mesh.get(l);if(u==null){a=!1;return}if(u.has(t))return;const d=(p=this.backoff.get(l))==null?void 0:p.get(t);if(this.direct.has(t))this.log("GRAFT: ignoring request from direct peer %s",t),s.push(l),a=!1;else if(typeof d=="number"&&o<d){this.log("GRAFT: ignoring backed off peer %s",t),this.score.addPenalty(t,1,H2.GraftBackoff),a=!1;const f=d+this.opts.graftFloodThreshold-this.opts.pruneBackoff;o<f&&this.score.addPenalty(t,1,H2.GraftBackoff),this.addBackoff(t,l),s.push(l)}else i<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",t,i,l),s.push(l),a=!1,this.addBackoff(t,l)):u.size>=this.opts.Dhi&&!(this.outbound.get(t)??!1)?(s.push(l),this.addBackoff(t,l)):(this.log("GRAFT: Add mesh link from %s in %s",t,l),this.score.graft(t,l),u.add(t),(y=this.metrics)==null||y.onAddToMesh(l,ps.Subscribed,1));this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:t,topic:l,direction:"inbound"}})}),s.length===0)return[];const c=!1;return Promise.all(s.map(async l=>this.makePrune(t,l,a,c)))}async handlePrune(t,n){var i;const s=this.score.score(t);for(const{topicID:o,backoff:a,peers:c}of n){if(o==null)continue;const l=this.mesh.get(o);if(l==null)return;this.log("PRUNE: Remove mesh link to %s in %s",t,o),this.score.prune(t,o),l.has(t)&&(l.delete(t),(i=this.metrics)==null||i.onRemoveFromMesh(o,la.Prune,1)),typeof a=="number"&&a>0?this.doAddBackoff(t,o,a*1e3):this.addBackoff(t,o),c!=null&&c.length>0&&(s<this.opts.scoreThresholds.acceptPXThreshold?this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",t,s,o):await this.pxConnect(c)),this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:t,topic:o,direction:"inbound"}})}}handleIdontwant(t,n){var l;let s=this.idontwantCounts.get(t)??0;if(s>=this.opts.idontwantMaxMessages)return;const i=s;let o=this.idontwants.get(t);o==null&&(o=new Map,this.idontwants.set(t,o));let a=0;e:for(const{messageIDs:u}of n)for(const d of u){if(s>=this.opts.idontwantMaxMessages)break e;s++;const p=this.msgIdToStrFn(d);o.set(p,this.heartbeatTicks),this.mcache.msgs.has(p)||a++}this.idontwantCounts.set(t,s);const c=s-i;(l=this.metrics)==null||l.onIdontwantRcv(c,a)}addBackoff(t,n){this.doAddBackoff(t,n,this.opts.pruneBackoff)}doAddBackoff(t,n,s){let i=this.backoff.get(n);i==null&&(i=new Map,this.backoff.set(n,i));const o=Date.now()+s;(i.get(t)??0)<o&&i.set(t,o)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((t,n)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",n,t),this.score.addPenalty(n,t,H2.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%HRe!==0)return;const t=Date.now();this.backoff.forEach((n,s)=>{n.forEach((i,o)=>{i+iBe*this.opts.heartbeatInterval<t&&n.delete(o)}),n.size===0&&this.backoff.delete(s)})}async directConnect(){const t=[];this.direct.forEach(n=>{this.streamsOutbound.has(n)||t.push(n)}),await Promise.all(t.map(async n=>this.connect(n)))}async pxConnect(t){t.length>this.opts.prunePeers&&(Ba(t),t=t.slice(0,this.opts.prunePeers));const n=[];await Promise.all(t.map(async s=>{if(s.peerID==null)return;const i=ri(kee(s.peerID)),o=i.toString();if(!this.peers.has(o)){if(s.signedPeerRecord==null){n.push(o);return}try{if(!await this.components.peerStore.consumePeerRecord(s.signedPeerRecord,i)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}n.push(o)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),n.length!==0&&await Promise.all(n.map(async s=>this.connect(s)))}async connect(t){var i;this.log("Initiating connection with %s",t);const n=mr(t),s=await this.components.connectionManager.openConnection(n);for(const o of this.multicodecs)for(const a of this.components.registrar.getTopologies(o))(i=a.onConnect)==null||i.call(a,n,s)}subscribe(t){if(this.status.code!==Rs.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(t)){this.subscriptions.add(t);for(const n of this.peers.keys())this.sendSubscriptions(n,[t],!0)}this.join(t)}unsubscribe(t){if(this.status.code!==Rs.started)throw new Error("Pubsub is not started");const n=this.subscriptions.delete(t);if(this.log("unsubscribe from %s - am subscribed %s",t,n),n)for(const s of this.peers.keys())this.sendSubscriptions(s,[t],!1);this.leave(t)}join(t){var o,a,c;if(this.status.code!==Rs.started)throw new Error("Gossipsub has not started");if(this.mesh.has(t))return;this.log("JOIN %s",t),(o=this.metrics)==null||o.onJoin(t);const n=new Set,s=this.backoff.get(t),i=this.fanout.get(t);if(i!=null&&(this.fanout.delete(t),this.fanoutLastpub.delete(t),i.forEach(l=>{!this.direct.has(l)&&this.score.score(l)>=0&&(s==null?void 0:s.has(l))!==!0&&n.add(l)}),(a=this.metrics)==null||a.onAddToMesh(t,ps.Fanout,n.size)),n.size<this.opts.D){const l=n.size;this.getRandomGossipPeers(t,this.opts.D,d=>!n.has(d)&&!this.direct.has(d)&&this.score.score(d)>=0&&(s==null?void 0:s.has(d))!==!0).forEach(d=>{n.add(d)}),(c=this.metrics)==null||c.onAddToMesh(t,ps.Random,n.size-l)}this.mesh.set(t,n),n.forEach(l=>{this.log("JOIN: Add mesh link to %s in %s",l,t),this.sendGraft(l,t)})}leave(t){var s;if(this.status.code!==Rs.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",t),(s=this.metrics)==null||s.onLeave(t);const n=this.mesh.get(t);n!=null&&(Promise.all(Array.from(n).map(async i=>{this.log("LEAVE: Remove mesh link to %s in %s",i,t),await this.sendPrune(i,t)})).catch(i=>{this.log("Error sending prunes to mesh peers",i)}),this.mesh.delete(t))}selectPeersToForward(t,n,s){const i=new Set,o=this.topics.get(t);o!=null&&(this.direct.forEach(c=>{o.has(c)&&n!==c&&!((s==null?void 0:s.has(c))??!1)&&i.add(c)}),this.floodsubPeers.forEach(c=>{o.has(c)&&n!==c&&!((s==null?void 0:s.has(c))??!1)&&this.score.score(c)>=this.opts.scoreThresholds.publishThreshold&&i.add(c)}));const a=this.mesh.get(t);return a!=null&&a.size>0&&a.forEach(c=>{n!==c&&!((s==null?void 0:s.has(c))??!1)&&i.add(c)}),i}selectPeersToPublish(t){const n=new Set,s={direct:0,floodsub:0,mesh:0,fanout:0},i=this.topics.get(t);if(i!=null)if(this.opts.floodPublish)i.forEach(o=>{this.direct.has(o)?(n.add(o),s.direct++):this.score.score(o)>=this.opts.scoreThresholds.publishThreshold&&(n.add(o),s.floodsub++)});else{this.direct.forEach(a=>{i.has(a)&&(n.add(a),s.direct++)}),this.floodsubPeers.forEach(a=>{i.has(a)&&this.score.score(a)>=this.opts.scoreThresholds.publishThreshold&&(n.add(a),s.floodsub++)});const o=this.mesh.get(t);if(o!=null&&o.size>0)o.forEach(a=>{n.add(a),s.mesh++}),o.size<this.opts.D&&this.getRandomGossipPeers(t,this.opts.D-o.size,c=>!o.has(c)&&!this.direct.has(c)&&!this.floodsubPeers.has(c)&&this.score.score(c)>=this.opts.scoreThresholds.publishThreshold).forEach(c=>{n.add(c),s.mesh++});else{const a=this.fanout.get(t);if(a!=null&&a.size>0)a.forEach(c=>{n.add(c),s.fanout++});else{const c=this.getRandomGossipPeers(t,this.opts.D,l=>this.score.score(l)>=this.opts.scoreThresholds.publishThreshold);c.size>0&&(this.fanout.set(t,c),c.forEach(l=>{n.add(l),s.fanout++}))}this.fanoutLastpub.set(t,Date.now())}}return{tosend:n,tosendCount:s}}forwardMessage(t,n,s,i){var a;s!=null&&this.score.deliverMessage(s,t,n.topic);const o=this.selectPeersToForward(n.topic,s,i);o.forEach(c=>{this.sendRpc(c,Ho([n]))}),(a=this.metrics)==null||a.onForwardMsg(n.topic,o.size)}async publish(t,n,s){var v,E;const i=Date.now(),o=this.dataTransform!=null?this.dataTransform.outboundTransform(t,n):n;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");const{raw:a,msg:c}=await NBe(this.publishConfig,t,n,o),l=await this.msgIdFn(c),u=this.msgIdToStrFn(l),d=(s==null?void 0:s.ignoreDuplicatePublishError)??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(u)){if(d)return(v=this.metrics)==null||v.onPublishDuplicateMsg(t),{recipients:[]};throw Error("PublishError.Duplicate")}const{tosend:p,tosendCount:y}=this.selectPeersToPublish(t),f=this.opts.emitSelf&&this.subscriptions.has(t),g=(s==null?void 0:s.allowPublishToZeroTopicPeers)??this.opts.allowPublishToZeroTopicPeers;if(p.size===0&&!g&&!f)throw Error("PublishError.NoPeersSubscribedToTopic");this.seenCache.put(u),this.mcache.put({msgId:l,msgIdStr:u},a,!0),this.publishedMessageIds.put(u);const w=(s==null?void 0:s.batchPublish)??this.opts.batchPublish,m=Ho([a]);if(w)this.sendRpcInBatch(p,m);else for(const S of p)this.sendRpc(S,m)||p.delete(S);const b=Date.now()-i;return(E=this.metrics)==null||E.onPublishMsg(t,y,p.size,a.data!=null?a.data.length:0,b),f&&(p.add(this.components.peerId.toString()),super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:u,msg:c}})),super.dispatchEvent(new CustomEvent("message",{detail:c}))),{recipients:Array.from(p.values()).map(S=>this.peers.get(S)??mr(S))}}sendRpcInBatch(t,n){var o;const s=Od.encode(n),i=CN.single(s);for(const a of t){const c=this.streamsOutbound.get(a);if(c==null){this.log(`Cannot send RPC to ${a} as there is no open stream to it available`),t.delete(a);continue}try{c.pushPrefixed(i)}catch(l){t.delete(a),this.log.error(`Cannot send rpc to ${a}`,l)}(o=this.metrics)==null||o.onRpcSent(n,s.length)}}reportMessageValidationResult(t,n,s){var a;let i;if(s===Pi.Accept){if(i=this.mcache.validate(t),i!=null){const{message:c,originatingPeers:l}=i;this.score.deliverMessage(n,t,c.topic),this.forwardMessage(t,i.message,n,l)}}else if(i=this.mcache.remove(t),i!=null){const c=dF(s),{message:l,originatingPeers:u}=i;this.score.rejectMessage(n,t,l.topic,c);for(const d of u)this.score.rejectMessage(d,t,l.topic,c)}const o=this.score.messageFirstSeenTimestampMs(t);(a=this.metrics)==null||a.onReportValidation(i,s,o)}sendGraft(t,n){const i=Ho([],{graft:[{topicID:n}]});this.sendRpc(t,i)}async sendPrune(t,n){const i=[await this.makePrune(t,n,this.opts.doPX,!0)],o=Ho([],{prune:i});this.sendRpc(t,o)}sendIDontWants(t,n,s){var c;const i=this.mesh.get(n);if(i==null)return;const o=new Set(i);o.delete(s);for(const l of o)((c=this.streamsOutbound.get(l))==null?void 0:c.protocol)!==JE&&o.delete(l);const a=Ho([],{idontwant:[{messageIDs:[t]}]});this.sendRpcInBatch(o,a)}sendRpc(t,n){var c,l,u,d,p;const s=this.streamsOutbound.get(t);if(s==null)return this.log(`Cannot send RPC to ${t} as there is no open stream to it available`),!1;const i=this.control.get(t);i!=null&&(this.piggybackControl(t,n,i),this.control.delete(t));const o=this.gossip.get(t);o!=null&&(this.piggybackGossip(t,n,o),this.gossip.delete(t));const a=Od.encode(n);try{s.push(a)}catch(y){return this.log.error(`Cannot send rpc to ${t}`,y),i!=null&&this.control.set(t,i),o!=null&&this.gossip.set(t,o),!1}if((c=this.metrics)==null||c.onRpcSent(n,a.length),((l=n.control)==null?void 0:l.graft)!=null)for(const y of(u=n.control)==null?void 0:u.graft)y.topicID!=null&&this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:t,topic:y.topicID,direction:"outbound"}});if(((d=n.control)==null?void 0:d.prune)!=null)for(const y of(p=n.control)==null?void 0:p.prune)y.topicID!=null&&this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:t,topic:y.topicID,direction:"outbound"}});return!0}piggybackControl(t,n,s){var o,a;const i=pF(n);for(const c of s.graft)c.topicID!=null&&(((o=this.mesh.get(c.topicID))==null?void 0:o.has(t))??!1)&&i.control.graft.push(c);for(const c of s.prune)c.topicID!=null&&!(((a=this.mesh.get(c.topicID))==null?void 0:a.has(t))??!1)&&i.control.prune.push(c)}piggybackGossip(t,n,s){const i=pF(n);i.control.ihave=s}async sendGraftPrune(t,n,s){const i=this.opts.doPX,o=!1;for(const[a,c]of t){const l=c.map(p=>({topicID:p}));let u=[];const d=n.get(a);d!=null&&(u=await Promise.all(d.map(async p=>this.makePrune(a,p,i&&!(s.get(a)??!1),o))),n.delete(a)),this.sendRpc(a,Ho([],{graft:l,prune:u}))}for(const[a,c]of n){const l=await Promise.all(c.map(async u=>this.makePrune(a,u,i&&!(s.get(a)??!1),o)));this.sendRpc(a,Ho([],{prune:l}))}}emitGossip(t){const n=this.mcache.getGossipIDs(new Set(t.keys()));for(const[s,i]of t)this.doEmitGossip(s,i,n.get(s)??[])}doEmitGossip(t,n,s){if(s.length===0||(Ba(s),s.length>Xf&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",s.length),n.size===0))return;let i=this.opts.Dlazy;const a=this.opts.gossipFactor*n.size;let c=n;a>i&&(i=a),i>c.size?i=c.size:c=Ba(Array.from(c)).slice(0,i),c.forEach(l=>{let u=s;s.length>Xf&&(u=Ba(u.slice()).slice(0,Xf)),this.pushGossip(l,{topicID:t,messageIDs:u})})}flush(){for(const[t,n]of this.gossip.entries())this.gossip.delete(t),this.sendRpc(t,Ho([],{ihave:n}));for(const[t,n]of this.control.entries()){this.control.delete(t);const s=Ho([],{graft:n.graft,prune:n.prune});this.sendRpc(t,s)}}pushGossip(t,n){this.log("Add gossip to %s",t);const s=this.gossip.get(t)??[];this.gossip.set(t,s.concat(n))}async makePrune(t,n,s,i){var u;if(this.score.prune(t,n),((u=this.streamsOutbound.get(t))==null?void 0:u.protocol)===lF)return{topicID:n,peers:[]};const o=i?this.opts.unsubcribeBackoff:this.opts.pruneBackoff,a=o/1e3;if(this.doAddBackoff(t,n,o),!s)return{topicID:n,peers:[],backoff:a};const c=this.getRandomGossipPeers(n,this.opts.prunePeers,d=>d!==t&&this.score.score(d)>=0),l=await Promise.all(Array.from(c).map(async d=>{const p=this.peers.get(d)??mr(d);let y;try{y=await this.components.peerStore.get(p)}catch(f){if(f.name!=="NotFoundError")throw f}return{peerID:p.toMultihash().bytes,signedPeerRecord:y==null?void 0:y.peerRecordEnvelope}}));return{topicID:n,peers:l,backoff:a}}async heartbeat(){var g,w;const{D:t,Dlo:n,Dhi:s,Dscore:i,Dout:o,fanoutTTL:a}=this.opts;this.heartbeatTicks++;const c=new Map,l=m=>{let b=c.get(m);return b===void 0&&(b=this.score.score(m),c.set(m,b)),b},u=new Map,d=new Map,p=new Map;this.clearBackoff(),this.peerhave.clear(),(g=this.metrics)==null||g.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.idontwantCounts.clear();for(const m of this.idontwants.values())for(const[b,v]of m)this.heartbeatTicks-v>=this.opts.mcacheLength&&m.delete(b);this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),(w=this.fastMsgIdCache)==null||w.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const y=new Map;this.mesh.forEach((m,b)=>{const v=this.topics.get(b),E=new Set,S=new Set;if(y.set(b,S),v!=null){const C=Ba(Array.from(v)),P=this.backoff.get(b);for(const L of C){const K=this.streamsOutbound.get(L);if(K!=null&&this.multicodecs.includes(K.protocol)&&!m.has(L)&&!this.direct.has(L)){const V=l(L);(P==null?void 0:P.has(L))!==!0&&V>=0&&E.add(L),V>=this.opts.scoreThresholds.gossipThreshold&&S.add(L)}}}const I=(C,P)=>{var K;this.log("HEARTBEAT: Remove mesh link to %s in %s",C,b),this.addBackoff(C,b),m.delete(C),l(C)>=this.opts.scoreThresholds.gossipThreshold&&S.add(C),(K=this.metrics)==null||K.onRemoveFromMesh(b,P,1);const L=d.get(C);L==null?d.set(C,[b]):L.push(b)},x=(C,P)=>{var K;this.log("HEARTBEAT: Add mesh link to %s in %s",C,b),this.score.graft(C,b),m.add(C),S.delete(C),(K=this.metrics)==null||K.onAddToMesh(b,P,1);const L=u.get(C);L==null?u.set(C,[b]):L.push(b)};if(m.forEach(C=>{const P=l(C);P<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",C,P,b),I(C,la.BadScore),p.set(C,!0))}),m.size<n){const C=t-m.size;bBe(E,C).forEach(L=>{x(L,ps.NotEnough)})}if(m.size>s){let C=Array.from(m);C.sort((L,K)=>l(K)-l(L)),C=C.slice(0,i).concat(Ba(C.slice(i)));let P=0;if(C.slice(0,t).forEach(L=>{(this.outbound.get(L)??!1)&&P++}),P<o){const L=V=>{const Z=C[V];for(let Y=V;Y>0;Y--)C[Y]=C[Y-1];C[0]=Z};if(P>0){let V=P;for(let Z=1;Z<t&&V>0;Z++)(this.outbound.get(C[Z])??!1)&&(L(Z),V--)}let K=t-P;for(let V=t;V<C.length&&K>0;V++)(this.outbound.get(C[V])??!1)&&(L(V),K--)}C.slice(t).forEach(L=>{I(L,la.Excess)})}if(m.size>=n){let C=0;if(m.forEach(P=>{(this.outbound.get(P)??!1)&&C++}),C<o){const P=o-C;KI(E,P,K=>this.outbound.get(K)===!0).forEach(K=>{x(K,ps.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&m.size>1){const C=Array.from(m).sort((K,V)=>l(K)-l(V)),P=Math.floor(m.size/2),L=l(C[P]);if(L<this.opts.scoreThresholds.opportunisticGraftThreshold){const K=this.opts.opportunisticGraftPeers,V=KI(E,K,Z=>l(Z)>L);for(const Z of V)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",Z,b),x(Z,ps.Opportunistic)}}});const f=Date.now();this.fanoutLastpub.forEach((m,b)=>{m+a<f&&(this.fanout.delete(b),this.fanoutLastpub.delete(b))}),this.fanout.forEach((m,b)=>{const v=this.topics.get(b);m.forEach(x=>{(!((v==null?void 0:v.has(x))??!1)||l(x)<this.opts.scoreThresholds.publishThreshold)&&m.delete(x)});const E=this.topics.get(b),S=[],I=new Set;if(y.set(b,I),E!=null){const x=Ba(Array.from(E));for(const C of x){const P=this.streamsOutbound.get(C);if(P!=null&&this.multicodecs.includes(P.protocol)&&!m.has(C)&&!this.direct.has(C)){const L=l(C);L>=this.opts.scoreThresholds.publishThreshold&&S.push(C),L>=this.opts.scoreThresholds.gossipThreshold&&I.add(C)}}}if(m.size<t){const x=t-m.size;S.slice(0,x).forEach(C=>{m.add(C),I==null||I.delete(C)})}}),this.emitGossip(y),await this.sendGraftPrune(u,d,p),this.flush(),this.mcache.shift(),this.dispatchEvent(new CustomEvent("gossipsub:heartbeat"))}getRandomGossipPeers(t,n,s=()=>!0){const i=this.topics.get(t);if(i==null)return new Set;let o=[];return i.forEach(a=>{const c=this.streamsOutbound.get(a);c!=null&&this.multicodecs.includes(c.protocol)&&s(a)&&o.push(a)}),o=Ba(o),n>0&&o.length>n&&(o=o.slice(0,n)),new Set(o)}onScrapeMetrics(t){var l,u;t.mcacheSize.set(this.mcache.size),t.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),t.cacheSize.set({cache:"direct"},this.direct.size),t.cacheSize.set({cache:"seenCache"},this.seenCache.size),t.cacheSize.set({cache:"fastMsgIdCache"},((l=this.fastMsgIdCache)==null?void 0:l.size)??0),t.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),t.cacheSize.set({cache:"mcache"},this.mcache.size),t.cacheSize.set({cache:"score"},this.score.size),t.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),t.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),t.cacheSize.set({cache:"topics"},this.topics.size),t.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),t.cacheSize.set({cache:"mesh"},this.mesh.size),t.cacheSize.set({cache:"fanout"},this.fanout.size),t.cacheSize.set({cache:"peers"},this.peers.size),t.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),t.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),t.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),t.cacheSize.set({cache:"gossip"},this.gossip.size),t.cacheSize.set({cache:"control"},this.control.size),t.cacheSize.set({cache:"peerhave"},this.peerhave.size),t.cacheSize.set({cache:"outbound"},this.outbound.size);let n=0;const s=Date.now();t.connectedPeersBackoffSec.reset();for(const d of this.backoff.values()){n+=d.size;for(const[p,y]of d.entries())this.peers.has(p)&&t.connectedPeersBackoffSec.observe(Math.max(0,y-s)/1e3)}t.cacheSize.set({cache:"backoff"},n);let i=0;for(const d of this.idontwants.values())i+=d.size;t.cacheSize.set({cache:"idontwants"},i);for(const[d,p]of this.topics)t.topicPeersCount.set({topicStr:d},p.size);for(const[d,p]of this.mesh)t.meshPeerCounts.set({topicStr:d},p.size);const o=[],a=new Map;t.behaviourPenalty.reset();for(const d of this.peers.keys()){const p=this.score.score(d);o.push(p),a.set(d,p),t.behaviourPenalty.observe(((u=this.score.peerStats.get(d))==null?void 0:u.behaviourPenalty)??0)}t.registerScores(o,this.opts.scoreThresholds),t.registerScorePerMesh(this.mesh,a);const c=kBe(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,t.topicStrToLabel);t.registerScoreWeights(c)}}h(Pee,"multicodec",JE);function HBe(r={}){return e=>new Pee(e,r)}const KBe=r=>{const[e,t]=ws.useState(null),[n,s]=ws.useState(null);return ws.useEffect(()=>{async function i(){try{console.log("Starting OrbitDB initialization for",r);let o;try{o=await nRe({libp2p:{transports:[tee(),ZZ(),CY()],transportManager:{faultTolerance:Z0.NO_FATAL},peerDiscovery:[fY({list:["/dns4/bootstrap.libp2p.io/tcp/443/wss/p2p/12D3KooWQL1aS4qD3yCjmV7gNmx4F5gP7pNXG1qimV5DXe7tXUn","/dns4/bootstrap.libp2p.io/tcp/443/wss/p2p/12D3KooWAtfLqN4QmgjrZ9eZ9r4L1B7bH7d9eW8fA4n4bBAyKSm","/dns4/relay.libp2p.io/tcp/443/wss/p2p/12D3KooWAdNWhqW6zSMv1tW2aLKNvEfR7f2DubkXq56Y2uLmsdN","/dns4/relay.ipfs.io/tcp/443/wss/p2p/12D3KooWAdNWhqW6zSMv1tW2aLKNvEfR7f2DubkXq56Y2uLmsdN","/dns4/relay.ipfs.io/tcp/443/wss/p2p/12D3KooWAdNWhqW6zSMv1tW2aLKNvEfR7f2DubkXq56Y2uLmsdN"]})],services:{identify:_Y(),pubsub:HBe()}}}),o.libp2p.addEventListener("peer:connect",l=>{console.log("Connected to peer:",l.detail.toString())}),o.libp2p.addEventListener("peer:disconnect",l=>{console.log("Disconnected from peer:",l.detail.toString())})}catch(l){throw console.error("Failed to initialize Helia:",l),new Error("IPFS initialization failed")}if(console.log("IPFS initialized:",o),!o)throw new Error("IPFS instance is undefined");const a=await b0e({ipfs:o});console.log("OrbitDB instance created:",a);const c=await a.open("citizenx-annotations",{type:"documents"});console.log("Database opened:",c),t(c)}catch(o){console.error("OrbitDB initialization failed:",o),s("Failed to initialize decentralized storage")}}i()},[r]),{db:e,error:n}},hi=r=>{try{const e=new URL(r);let t=e.pathname.replace(/^\/[a-z]{2}(\/|$)/,"/");t.startsWith("/")||(t="/"+t),t=t.replace(/\/+$/,"");const n=new URLSearchParams(e.search),s=new URLSearchParams;return e.searchParams.forEach((o,a)=>{!a.startsWith("utm_")&&!["lang","locale"].includes(a)&&s.set(a,o)}),`${e.protocol}//${e.host}${t}${s.toString()?"?"+s.toString():""}`}catch(e){return console.error("Failed to normalize URL:",e),r}},GBe=(r,e)=>{const[t,n]=ws.useState([]),[s,i]=ws.useState(null),o=hi(r);return ws.useEffect(()=>{async function l(){if(e)try{const u=JSON.parse(localStorage.getItem("citizenx-annotations")||"[]");console.log("Local annotations on init:",u);const d=u.filter(p=>hi(p.url)===o);n(d),await new Promise(p=>{e.events.on("update",async()=>{const y=await e.all();console.log("Initial update, annotations loaded:",y);const f=y.filter(g=>hi(g.value.url)===o);n(f.map(g=>g.value)),p()})}),u.length>0&&e.events.on("peer",async()=>{console.log("Peer connected, syncing localStorage annotations to OrbitDB");for(const f of u)try{await e.put(f),console.log("Synced local annotation to OrbitDB:",f)}catch(g){console.error("Failed to sync local annotation:",g)}localStorage.removeItem("citizenx-annotations");const y=(await e.all()).filter(f=>hi(f.value.url)===o);n(y.map(f=>f.value))}),e.events.on("update",async()=>{const p=await e.all();console.log("Database updated, new docs:",p);const y=p.filter(f=>hi(f.value.url)===o);n(y.map(f=>f.value)),console.log("Annotations database updated:",y)})}catch(u){console.error("Failed to fetch annotations:",u),i("Failed to load annotations")}else{const d=JSON.parse(localStorage.getItem("citizenx-annotations")||"[]").filter(p=>hi(p.url)===o);n(d)}}l()},[e,o]),{annotations:t,setAnnotations:n,error:s,handleSaveAnnotation:async l=>{if(l.trim()&&e){const u={_id:Date.now().toString(),url:o,text:l.trim(),timestamp:Date.now()};try{await e.put(u),console.log("Successfully saved to OrbitDB:",u);const d=await e.all();console.log("Annotations after save:",d);const p=d.filter(y=>hi(y.value.url)===o);n(p.map(y=>y.value))}catch(d){const p=d;if(p.message.includes("NoPeersSubscribedToTopic")){console.warn("No peers subscribed, saving to localStorage:",u);const y=JSON.parse(localStorage.getItem("citizenx-annotations")||"[]");y.push(u),localStorage.setItem("citizenx-annotations",JSON.stringify(y));const f=y.filter(g=>hi(g.url)===o);n(f),e.events.on("peer",async()=>{console.log("Peer connected, retrying save to OrbitDB");try{await e.put(u),console.log("Successfully saved to OrbitDB after peer connection:",u),localStorage.removeItem("citizenx-annotations");const w=(await e.all()).filter(m=>hi(m.value.url)===o);n(w.map(m=>m.value))}catch(g){console.error("Retry failed:",g)}})}else console.error("Failed to save annotation:",p),i("Failed to save annotation")}}else if(l.trim()){const u={_id:Date.now().toString(),url:o,text:l.trim(),timestamp:Date.now()},d=JSON.parse(localStorage.getItem("citizenx-annotations")||"[]");d.push(u),localStorage.setItem("citizenx-annotations",JSON.stringify(d));const p=d.filter(y=>hi(y.url)===o);n(p)}},handleDeleteAnnotation:async l=>{if(e)try{await e.del(l),console.log("Successfully deleted annotation from OrbitDB:",l);const d=(await e.all()).filter(p=>hi(p.value.url)===o);n(d.map(p=>p.value))}catch(u){console.error("Failed to delete annotation:",u),i("Failed to delete annotation")}else{const d=JSON.parse(localStorage.getItem("citizenx-annotations")||"[]").filter(y=>y._id!==l);localStorage.setItem("citizenx-annotations",JSON.stringify(d));const p=d.filter(y=>hi(y.url)===o);n(p),console.warn("No peers subscribed, deleted from localStorage:",l)}}}},jBe="6.13.5";function qBe(r,e,t){const n=e.split("|").map(i=>i.trim());for(let i=0;i<n.length;i++)switch(e){case"any":return;case"bigint":case"boolean":case"number":case"string":if(typeof r===e)return}const s=new Error(`invalid value for type ${e}`);throw s.code="INVALID_ARGUMENT",s.argument=`value.${t}`,s.value=r,s}async function Ln(r){const e=Object.keys(r);return(await Promise.all(e.map(n=>Promise.resolve(r[n])))).reduce((n,s,i)=>(n[e[i]]=s,n),{})}function Me(r,e,t){for(let n in e){let s=e[n];const i=t?t[n]:null;i&&qBe(s,i,n),Object.defineProperty(r,n,{enumerable:!0,value:s,writable:!1})}}function vp(r){if(r==null)return"null";if(Array.isArray(r))return"[ "+r.map(vp).join(", ")+" ]";if(r instanceof Uint8Array){const e="0123456789abcdef";let t="0x";for(let n=0;n<r.length;n++)t+=e[r[n]>>4],t+=e[r[n]&15];return t}if(typeof r=="object"&&typeof r.toJSON=="function")return vp(r.toJSON());switch(typeof r){case"boolean":case"symbol":return r.toString();case"bigint":return BigInt(r).toString();case"number":return r.toString();case"string":return JSON.stringify(r);case"object":{const e=Object.keys(r);return e.sort(),"{ "+e.map(t=>`${vp(t)}: ${vp(r[t])}`).join(", ")+" }"}}return"[ COULD NOT SERIALIZE ]"}function qr(r,e){return r&&r.code===e}function TN(r){return qr(r,"CALL_EXCEPTION")}function rr(r,e,t){let n=r;{const i=[];if(t){if("message"in t||"code"in t||"name"in t)throw new Error(`value will overwrite populated values: ${vp(t)}`);for(const o in t){if(o==="shortMessage")continue;const a=t[o];i.push(o+"="+vp(a))}}i.push(`code=${e}`),i.push(`version=${jBe}`),i.length&&(r+=" ("+i.join(", ")+")")}let s;switch(e){case"INVALID_ARGUMENT":s=new TypeError(r);break;case"NUMERIC_FAULT":case"BUFFER_OVERRUN":s=new RangeError(r);break;default:s=new Error(r)}return Me(s,{code:e}),t&&Object.assign(s,t),s.shortMessage==null&&Me(s,{shortMessage:n}),s}function se(r,e,t,n){if(!r)throw rr(e,t,n)}function q(r,e,t,n){se(r,e,"INVALID_ARGUMENT",{argument:t,value:n})}function Nee(r,e,t){t==null&&(t=""),t&&(t=": "+t),se(r>=e,"missing argument"+t,"MISSING_ARGUMENT",{count:r,expectedCount:e}),se(r<=e,"too many arguments"+t,"UNEXPECTED_ARGUMENT",{count:r,expectedCount:e})}["NFD","NFC","NFKD","NFKC"].reduce((r,e)=>{try{if("test".normalize(e)!=="test")throw new Error("bad");if(e==="NFD"&&"".normalize("NFD")!=="e")throw new Error("broken");r.push(e)}catch{}return r},[]);function I7(r,e,t){if(t==null&&(t=""),r!==e){let n=t,s="new";t&&(n+=".",s+=" "+t),se(!1,`private constructor; use ${n}from* methods`,"UNSUPPORTED_OPERATION",{operation:s})}}function Dee(r,e,t){if(r instanceof Uint8Array)return t?new Uint8Array(r):r;if(typeof r=="string"&&r.match(/^0x(?:[0-9a-f][0-9a-f])*$/i)){const n=new Uint8Array((r.length-2)/2);let s=2;for(let i=0;i<n.length;i++)n[i]=parseInt(r.substring(s,s+2),16),s+=2;return n}q(!1,"invalid BytesLike value",e||"value",r)}function dt(r,e){return Dee(r,e,!1)}function zn(r,e){return Dee(r,e,!0)}function $t(r,e){return!(typeof r!="string"||!r.match(/^0x[0-9A-Fa-f]*$/)||typeof e=="number"&&r.length!==2+2*e||e===!0&&r.length%2!==0)}function _N(r){return $t(r,!0)||r instanceof Uint8Array}const gF="0123456789abcdef";function ke(r){const e=dt(r);let t="0x";for(let n=0;n<e.length;n++){const s=e[n];t+=gF[(s&240)>>4]+gF[s&15]}return t}function pr(r){return"0x"+r.map(e=>ke(e).substring(2)).join("")}function Kp(r){return $t(r,!0)?(r.length-2)/2:dt(r).length}function sr(r,e,t){const n=dt(r);return t!=null&&t>n.length&&se(!1,"cannot slice beyond data bounds","BUFFER_OVERRUN",{buffer:n,length:n.length,offset:t}),ke(n.slice(e??0,t??n.length))}function Oee(r,e,t){const n=dt(r);se(e>=n.length,"padding exceeds data length","BUFFER_OVERRUN",{buffer:new Uint8Array(n),length:e,offset:e+1});const s=new Uint8Array(e);return s.fill(0),t?s.set(n,e-n.length):s.set(n,0),ke(s)}function hf(r,e){return Oee(r,e,!0)}function WBe(r,e){return Oee(r,e,!1)}const k7=BigInt(0),go=BigInt(1),GI=9007199254740991;function QBe(r,e){const t=T7(r,"value"),n=BigInt(Ze(e,"width"));if(se(t>>n===k7,"overflow","NUMERIC_FAULT",{operation:"fromTwos",fault:"overflow",value:r}),t>>n-go){const s=(go<<n)-go;return-((~t&s)+go)}return t}function Ree(r,e){let t=Pe(r,"value");const n=BigInt(Ze(e,"width")),s=go<<n-go;if(t<k7){t=-t,se(t<=s,"too low","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:r});const i=(go<<n)-go;return(~t&i)+go}else se(t<s,"too high","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:r});return t}function g2(r,e){const t=T7(r,"value"),n=BigInt(Ze(e,"bits"));return t&(go<<n)-go}function Pe(r,e){switch(typeof r){case"bigint":return r;case"number":return q(Number.isInteger(r),"underflow",e||"value",r),q(r>=-9007199254740991&&r<=GI,"overflow",e||"value",r),BigInt(r);case"string":try{if(r==="")throw new Error("empty string");return r[0]==="-"&&r[1]!=="-"?-BigInt(r.substring(1)):BigInt(r)}catch(t){q(!1,`invalid BigNumberish string: ${t.message}`,e||"value",r)}}q(!1,"invalid BigNumberish value",e||"value",r)}function T7(r,e){const t=Pe(r,e);return se(t>=k7,"unsigned value cannot be negative","NUMERIC_FAULT",{fault:"overflow",operation:"getUint",value:r}),t}const yF="0123456789abcdef";function PN(r){if(r instanceof Uint8Array){let e="0x0";for(const t of r)e+=yF[t>>4],e+=yF[t&15];return BigInt(e)}return Pe(r)}function Ze(r,e){switch(typeof r){case"bigint":return q(r>=-9007199254740991&&r<=GI,"overflow",e||"value",r),Number(r);case"number":return q(Number.isInteger(r),"underflow",e||"value",r),q(r>=-9007199254740991&&r<=GI,"overflow",e||"value",r),r;case"string":try{if(r==="")throw new Error("empty string");return Ze(BigInt(r),e)}catch(t){q(!1,`invalid numeric string: ${t.message}`,e||"value",r)}}q(!1,"invalid numeric value",e||"value",r)}function JBe(r){return Ze(PN(r))}function Ju(r,e){let n=T7(r,"value").toString(16);if(e==null)n.length%2&&(n="0"+n);else{const s=Ze(e,"width");for(se(s*2>=n.length,`value exceeds width (${s} bytes)`,"NUMERIC_FAULT",{operation:"toBeHex",fault:"overflow",value:r});n.length<s*2;)n="0"+n}return"0x"+n}function Hn(r){const e=T7(r,"value");if(e===k7)return new Uint8Array([]);let t=e.toString(16);t.length%2&&(t="0"+t);const n=new Uint8Array(t.length/2);for(let s=0;s<n.length;s++){const i=s*2;n[s]=parseInt(t.substring(i,i+2),16)}return n}function Ep(r){let e=ke(_N(r)?r:Hn(r)).substring(2);for(;e.startsWith("0");)e=e.substring(1);return e===""&&(e="0"),"0x"+e}const mF="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";BigInt(0);const wF=BigInt(58);function YBe(r){const e=dt(r);let t=PN(e),n="";for(;t;)n=mF[Number(t%wF)]+n,t/=wF;for(let s=0;s<e.length&&!e[s];s++)n=mF[0]+n;return n}function XBe(r){r=atob(r);const e=new Uint8Array(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return dt(e)}function ZBe(r){const e=dt(r);let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}var n0;class Bee{constructor(e,t,n){h(this,"filter");h(this,"emitter");Q(this,n0);M(this,n0,t),Me(this,{emitter:e,filter:n})}async removeListener(){T(this,n0)!=null&&await this.emitter.off(this.filter,T(this,n0))}}n0=new WeakMap;function eMe(r,e,t,n,s){q(!1,`invalid codepoint at offset ${e}; ${r}`,"bytes",t)}function Mee(r,e,t,n,s){if(r==="BAD_PREFIX"||r==="UNEXPECTED_CONTINUE"){let i=0;for(let o=e+1;o<t.length&&t[o]>>6===2;o++)i++;return i}return r==="OVERRUN"?t.length-e-1:0}function tMe(r,e,t,n,s){return r==="OVERLONG"?(q(typeof s=="number","invalid bad code point for replacement","badCodepoint",s),n.push(s),0):(n.push(65533),Mee(r,e,t))}const rMe=Object.freeze({error:eMe,ignore:Mee,replace:tMe});function nMe(r,e){e==null&&(e=rMe.error);const t=dt(r,"bytes"),n=[];let s=0;for(;s<t.length;){const i=t[s++];if(!(i>>7)){n.push(i);continue}let o=null,a=null;if((i&224)===192)o=1,a=127;else if((i&240)===224)o=2,a=2047;else if((i&248)===240)o=3,a=65535;else{(i&192)===128?s+=e("UNEXPECTED_CONTINUE",s-1,t,n):s+=e("BAD_PREFIX",s-1,t,n);continue}if(s-1+o>=t.length){s+=e("OVERRUN",s-1,t,n);continue}let c=i&(1<<8-o-1)-1;for(let l=0;l<o;l++){let u=t[s];if((u&192)!=128){s+=e("MISSING_CONTINUE",s,t,n),c=null;break}c=c<<6|u&63,s++}if(c!==null){if(c>1114111){s+=e("OUT_OF_RANGE",s-1-o,t,n,c);continue}if(c>=55296&&c<=57343){s+=e("UTF16_SURROGATE",s-1-o,t,n,c);continue}if(c<=a){s+=e("OVERLONG",s-1-o,t,n,c);continue}n.push(c)}}return n}function Sc(r,e){q(typeof r=="string","invalid string value","str",r);let t=[];for(let n=0;n<r.length;n++){const s=r.charCodeAt(n);if(s<128)t.push(s);else if(s<2048)t.push(s>>6|192),t.push(s&63|128);else if((s&64512)==55296){n++;const i=r.charCodeAt(n);q(n<r.length&&(i&64512)===56320,"invalid surrogate pair","str",r);const o=65536+((s&1023)<<10)+(i&1023);t.push(o>>18|240),t.push(o>>12&63|128),t.push(o>>6&63|128),t.push(o&63|128)}else t.push(s>>12|224),t.push(s>>6&63|128),t.push(s&63|128)}return new Uint8Array(t)}function sMe(r){return r.map(e=>e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10&1023)+55296,(e&1023)+56320))).join("")}function O6(r,e){return sMe(nMe(r,e))}function $ee(r){async function e(t,n){se(n==null||!n.cancelled,"request cancelled before sending","CANCELLED");const s=t.url.split(":")[0].toLowerCase();se(s==="http"||s==="https",`unsupported protocol ${s}`,"UNSUPPORTED_OPERATION",{info:{protocol:s},operation:"request"}),se(s==="https"||!t.credentials||t.allowInsecureAuthentication,"insecure authorized connections unsupported","UNSUPPORTED_OPERATION",{operation:"request"});let i=null;const o=new AbortController,a=setTimeout(()=>{i=rr("request timeout","TIMEOUT"),o.abort()},t.timeout);n&&n.addListener(()=>{i=rr("request cancelled","CANCELLED"),o.abort()});const c={method:t.method,headers:new Headers(Array.from(t)),body:t.body||void 0,signal:o.signal};let l;try{l=await fetch(t.url,c)}catch(y){throw clearTimeout(a),i||y}clearTimeout(a);const u={};l.headers.forEach((y,f)=>{u[f.toLowerCase()]=y});const d=await l.arrayBuffer(),p=d==null?null:new Uint8Array(d);return{statusCode:l.status,statusMessage:l.statusText,headers:u,body:p}}return e}const iMe=12,oMe=250;let bF=$ee();const aMe=new RegExp("^data:([^;:]*)?(;base64)?,(.*)$","i"),cMe=new RegExp("^ipfs://(ipfs/)?(.*)$","i");let XE=!1;async function Lee(r,e){try{const t=r.match(aMe);if(!t)throw new Error("invalid data");return new Du(200,"OK",{"content-type":t[1]||"text/plain"},t[2]?XBe(t[3]):uMe(t[3]))}catch{return new Du(599,"BAD REQUEST (invalid data: URI)",{},null,new Yu(r))}}function Uee(r){async function e(t,n){try{const s=t.match(cMe);if(!s)throw new Error("invalid link");return new Yu(`${r}${s[2]}`)}catch{return new Du(599,"BAD REQUEST (invalid IPFS URI)",{},null,new Yu(t))}}return e}const I3={data:Lee,ipfs:Uee("https://gateway.ipfs.io/ipfs/")},Fee=new WeakMap;var td,Gl;class lMe{constructor(e){Q(this,td);Q(this,Gl);M(this,td,[]),M(this,Gl,!1),Fee.set(e,()=>{if(!T(this,Gl)){M(this,Gl,!0);for(const t of T(this,td))setTimeout(()=>{t()},0);M(this,td,[])}})}addListener(e){se(!T(this,Gl),"singal already cancelled","UNSUPPORTED_OPERATION",{operation:"fetchCancelSignal.addCancelListener"}),T(this,td).push(e)}get cancelled(){return T(this,Gl)}checkSignal(){se(!this.cancelled,"cancelled","CANCELLED",{})}}td=new WeakMap,Gl=new WeakMap;function k3(r){if(r==null)throw new Error("missing signal; should not happen");return r.checkSignal(),r}var s0,i0,io,Xa,o0,a0,_r,Ms,Za,rd,nd,sd,Qo,oo,jl,id,y2;const W6=class W6{constructor(e){Q(this,id);Q(this,s0);Q(this,i0);Q(this,io);Q(this,Xa);Q(this,o0);Q(this,a0);Q(this,_r);Q(this,Ms);Q(this,Za);Q(this,rd);Q(this,nd);Q(this,sd);Q(this,Qo);Q(this,oo);Q(this,jl);M(this,a0,String(e)),M(this,s0,!1),M(this,i0,!0),M(this,io,{}),M(this,Xa,""),M(this,o0,3e5),M(this,oo,{slotInterval:oMe,maxAttempts:iMe}),M(this,jl,null)}get url(){return T(this,a0)}set url(e){M(this,a0,String(e))}get body(){return T(this,_r)==null?null:new Uint8Array(T(this,_r))}set body(e){if(e==null)M(this,_r,void 0),M(this,Ms,void 0);else if(typeof e=="string")M(this,_r,Sc(e)),M(this,Ms,"text/plain");else if(e instanceof Uint8Array)M(this,_r,e),M(this,Ms,"application/octet-stream");else if(typeof e=="object")M(this,_r,Sc(JSON.stringify(e))),M(this,Ms,"application/json");else throw new Error("invalid body")}hasBody(){return T(this,_r)!=null}get method(){return T(this,Xa)?T(this,Xa):this.hasBody()?"POST":"GET"}set method(e){e==null&&(e=""),M(this,Xa,String(e).toUpperCase())}get headers(){const e=Object.assign({},T(this,io));return T(this,Za)&&(e.authorization=`Basic ${ZBe(Sc(T(this,Za)))}`),this.allowGzip&&(e["accept-encoding"]="gzip"),e["content-type"]==null&&T(this,Ms)&&(e["content-type"]=T(this,Ms)),this.body&&(e["content-length"]=String(this.body.length)),e}getHeader(e){return this.headers[e.toLowerCase()]}setHeader(e,t){T(this,io)[String(e).toLowerCase()]=String(t)}clearHeaders(){M(this,io,{})}[Symbol.iterator](){const e=this.headers,t=Object.keys(e);let n=0;return{next:()=>{if(n<t.length){const s=t[n++];return{value:[s,e[s]],done:!1}}return{value:void 0,done:!0}}}}get credentials(){return T(this,Za)||null}setCredentials(e,t){q(!e.match(/:/),"invalid basic authentication username","username","[REDACTED]"),M(this,Za,`${e}:${t}`)}get allowGzip(){return T(this,i0)}set allowGzip(e){M(this,i0,!!e)}get allowInsecureAuthentication(){return!!T(this,s0)}set allowInsecureAuthentication(e){M(this,s0,!!e)}get timeout(){return T(this,o0)}set timeout(e){q(e>=0,"timeout must be non-zero","timeout",e),M(this,o0,e)}get preflightFunc(){return T(this,rd)||null}set preflightFunc(e){M(this,rd,e)}get processFunc(){return T(this,nd)||null}set processFunc(e){M(this,nd,e)}get retryFunc(){return T(this,sd)||null}set retryFunc(e){M(this,sd,e)}get getUrlFunc(){return T(this,jl)||bF}set getUrlFunc(e){M(this,jl,e)}toString(){return`<FetchRequest method=${JSON.stringify(this.method)} url=${JSON.stringify(this.url)} headers=${JSON.stringify(this.headers)} body=${T(this,_r)?ke(T(this,_r)):"null"}>`}setThrottleParams(e){e.slotInterval!=null&&(T(this,oo).slotInterval=e.slotInterval),e.maxAttempts!=null&&(T(this,oo).maxAttempts=e.maxAttempts)}send(){return se(T(this,Qo)==null,"request already sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.send"}),M(this,Qo,new lMe(this)),te(this,id,y2).call(this,0,vF()+this.timeout,0,this,new Du(0,"",{},null,this))}cancel(){se(T(this,Qo)!=null,"request has not been sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.cancel"});const e=Fee.get(this);if(!e)throw new Error("missing signal; should not happen");e()}redirect(e){const t=this.url.split(":")[0].toLowerCase(),n=e.split(":")[0].toLowerCase();se(this.method==="GET"&&(t!=="https"||n!=="http")&&e.match(/^https?:/),"unsupported redirect","UNSUPPORTED_OPERATION",{operation:`redirect(${this.method} ${JSON.stringify(this.url)} => ${JSON.stringify(e)})`});const s=new W6(e);return s.method="GET",s.allowGzip=this.allowGzip,s.timeout=this.timeout,M(s,io,Object.assign({},T(this,io))),T(this,_r)&&M(s,_r,new Uint8Array(T(this,_r))),M(s,Ms,T(this,Ms)),s}clone(){const e=new W6(this.url);return M(e,Xa,T(this,Xa)),T(this,_r)&&M(e,_r,T(this,_r)),M(e,Ms,T(this,Ms)),M(e,io,Object.assign({},T(this,io))),M(e,Za,T(this,Za)),this.allowGzip&&(e.allowGzip=!0),e.timeout=this.timeout,this.allowInsecureAuthentication&&(e.allowInsecureAuthentication=!0),M(e,rd,T(this,rd)),M(e,nd,T(this,nd)),M(e,sd,T(this,sd)),M(e,oo,Object.assign({},T(this,oo))),M(e,jl,T(this,jl)),e}static lockConfig(){XE=!0}static getGateway(e){return I3[e.toLowerCase()]||null}static registerGateway(e,t){if(e=e.toLowerCase(),e==="http"||e==="https")throw new Error(`cannot intercept ${e}; use registerGetUrl`);if(XE)throw new Error("gateways locked");I3[e]=t}static registerGetUrl(e){if(XE)throw new Error("gateways locked");bF=e}static createGetUrlFunc(e){return $ee()}static createDataGateway(){return Lee}static createIpfsGatewayFunc(e){return Uee(e)}};s0=new WeakMap,i0=new WeakMap,io=new WeakMap,Xa=new WeakMap,o0=new WeakMap,a0=new WeakMap,_r=new WeakMap,Ms=new WeakMap,Za=new WeakMap,rd=new WeakMap,nd=new WeakMap,sd=new WeakMap,Qo=new WeakMap,oo=new WeakMap,jl=new WeakMap,id=new WeakSet,y2=async function(e,t,n,s,i){var u,d,p;if(e>=T(this,oo).maxAttempts)return i.makeServerError("exceeded maximum retry limit");se(vF()<=t,"timeout","TIMEOUT",{operation:"request.send",reason:"timeout",request:s}),n>0&&await hMe(n);let o=this.clone();const a=(o.url.split(":")[0]||"").toLowerCase();if(a in I3){const y=await I3[a](o.url,k3(T(s,Qo)));if(y instanceof Du){let f=y;if(this.processFunc){k3(T(s,Qo));try{f=await this.processFunc(o,f)}catch(g){(g.throttle==null||typeof g.stall!="number")&&f.makeServerError("error in post-processing function",g).assertOk()}}return f}o=y}this.preflightFunc&&(o=await this.preflightFunc(o));const c=await this.getUrlFunc(o,k3(T(s,Qo)));let l=new Du(c.statusCode,c.statusMessage,c.headers,c.body,s);if(l.statusCode===301||l.statusCode===302){try{const y=l.headers.location||"";return te(u=o.redirect(y),id,y2).call(u,e+1,t,0,s,l)}catch{}return l}else if(l.statusCode===429&&(this.retryFunc==null||await this.retryFunc(o,l,e))){const y=l.headers["retry-after"];let f=T(this,oo).slotInterval*Math.trunc(Math.random()*Math.pow(2,e));return typeof y=="string"&&y.match(/^[1-9][0-9]*$/)&&(f=parseInt(y)),te(d=o.clone(),id,y2).call(d,e+1,t,f,s,l)}if(this.processFunc){k3(T(s,Qo));try{l=await this.processFunc(o,l)}catch(y){(y.throttle==null||typeof y.stall!="number")&&l.makeServerError("error in post-processing function",y).assertOk();let f=T(this,oo).slotInterval*Math.trunc(Math.random()*Math.pow(2,e));return y.stall>=0&&(f=y.stall),te(p=o.clone(),id,y2).call(p,e+1,t,f,s,l)}}return l};let Yu=W6;var lm,um,hm,$s,c0,od;const YN=class YN{constructor(e,t,n,s,i){Q(this,lm);Q(this,um);Q(this,hm);Q(this,$s);Q(this,c0);Q(this,od);M(this,lm,e),M(this,um,t),M(this,hm,Object.keys(n).reduce((o,a)=>(o[a.toLowerCase()]=String(n[a]),o),{})),M(this,$s,s==null?null:new Uint8Array(s)),M(this,c0,i||null),M(this,od,{message:""})}toString(){return`<FetchResponse status=${this.statusCode} body=${T(this,$s)?ke(T(this,$s)):"null"}>`}get statusCode(){return T(this,lm)}get statusMessage(){return T(this,um)}get headers(){return Object.assign({},T(this,hm))}get body(){return T(this,$s)==null?null:new Uint8Array(T(this,$s))}get bodyText(){try{return T(this,$s)==null?"":O6(T(this,$s))}catch{se(!1,"response body is not valid UTF-8 data","UNSUPPORTED_OPERATION",{operation:"bodyText",info:{response:this}})}}get bodyJson(){try{return JSON.parse(this.bodyText)}catch{se(!1,"response body is not valid JSON","UNSUPPORTED_OPERATION",{operation:"bodyJson",info:{response:this}})}}[Symbol.iterator](){const e=this.headers,t=Object.keys(e);let n=0;return{next:()=>{if(n<t.length){const s=t[n++];return{value:[s,e[s]],done:!1}}return{value:void 0,done:!0}}}}makeServerError(e,t){let n;e?n=`CLIENT ESCALATED SERVER ERROR (${this.statusCode} ${this.statusMessage}; ${e})`:(e=`${this.statusCode} ${this.statusMessage}`,n=`CLIENT ESCALATED SERVER ERROR (${e})`);const s=new YN(599,n,this.headers,this.body,T(this,c0)||void 0);return M(s,od,{message:e,error:t}),s}throwThrottleError(e,t){t==null?t=-1:q(Number.isInteger(t)&&t>=0,"invalid stall timeout","stall",t);const n=new Error(e||"throttling requests");throw Me(n,{stall:t,throttle:!0}),n}getHeader(e){return this.headers[e.toLowerCase()]}hasBody(){return T(this,$s)!=null}get request(){return T(this,c0)}ok(){return T(this,od).message===""&&this.statusCode>=200&&this.statusCode<300}assertOk(){if(this.ok())return;let{message:e,error:t}=T(this,od);e===""&&(e=`server response ${this.statusCode} ${this.statusMessage}`);let n=null;this.request&&(n=this.request.url);let s=null;try{T(this,$s)&&(s=O6(T(this,$s)))}catch{}se(!1,e,"SERVER_ERROR",{request:this.request||"unknown request",response:this,error:t,info:{requestUrl:n,responseBody:s,responseStatus:`${this.statusCode} ${this.statusMessage}`}})}};lm=new WeakMap,um=new WeakMap,hm=new WeakMap,$s=new WeakMap,c0=new WeakMap,od=new WeakMap;let Du=YN;function vF(){return new Date().getTime()}function uMe(r){return Sc(r.replace(/%([0-9a-f][0-9a-f])/gi,(e,t)=>String.fromCharCode(parseInt(t,16))))}function hMe(r){return new Promise(e=>setTimeout(e,r))}function dMe(r){let e=r.toString(16);for(;e.length<2;)e="0"+e;return"0x"+e}function EF(r,e,t){let n=0;for(let s=0;s<t;s++)n=n*256+r[e+s];return n}function xF(r,e,t,n){const s=[];for(;t<e+1+n;){const i=zee(r,t);s.push(i.result),t+=i.consumed,se(t<=e+1+n,"child data too short","BUFFER_OVERRUN",{buffer:r,length:n,offset:e})}return{consumed:1+n,result:s}}function zee(r,e){se(r.length!==0,"data too short","BUFFER_OVERRUN",{buffer:r,length:0,offset:1});const t=n=>{se(n<=r.length,"data short segment too short","BUFFER_OVERRUN",{buffer:r,length:r.length,offset:n})};if(r[e]>=248){const n=r[e]-247;t(e+1+n);const s=EF(r,e+1,n);return t(e+1+n+s),xF(r,e,e+1+n,n+s)}else if(r[e]>=192){const n=r[e]-192;return t(e+1+n),xF(r,e,e+1,n)}else if(r[e]>=184){const n=r[e]-183;t(e+1+n);const s=EF(r,e+1,n);t(e+1+n+s);const i=ke(r.slice(e+1+n,e+1+n+s));return{consumed:1+n+s,result:i}}else if(r[e]>=128){const n=r[e]-128;t(e+1+n);const s=ke(r.slice(e+1,e+1+n));return{consumed:1+n,result:s}}return{consumed:1,result:dMe(r[e])}}function _7(r){const e=dt(r,"data"),t=zee(e,0);return q(t.consumed===e.length,"unexpected junk after rlp payload","data",r),t.result}function AF(r){const e=[];for(;r;)e.unshift(r&255),r>>=8;return e}function Vee(r){if(Array.isArray(r)){let n=[];if(r.forEach(function(i){n=n.concat(Vee(i))}),n.length<=55)return n.unshift(192+n.length),n;const s=AF(n.length);return s.unshift(247+s.length),s.concat(n)}const e=Array.prototype.slice.call(dt(r,"object"));if(e.length===1&&e[0]<=127)return e;if(e.length<=55)return e.unshift(128+e.length),e;const t=AF(e.length);return t.unshift(183+t.length),t.concat(e)}const SF="0123456789abcdef";function df(r){let e="0x";for(const t of Vee(r))e+=SF[t>>4],e+=SF[t&15];return e}const Kn=32,jI=new Uint8Array(Kn),fMe=["then"],T3={},Hee=new WeakMap;function Mh(r){return Hee.get(r)}function CF(r,e){Hee.set(r,e)}function Zg(r,e){const t=new Error(`deferred error during ABI decoding triggered accessing ${r}`);throw t.error=e,t}function qI(r,e,t){return r.indexOf(null)>=0?e.map((n,s)=>n instanceof D1?qI(Mh(n),n,t):n):r.reduce((n,s,i)=>{let o=e.getValue(s);return s in n||(t&&o instanceof D1&&(o=qI(Mh(o),o,t)),n[s]=o),n},{})}var l0;const Sp=class Sp extends Array{constructor(...t){const n=t[0];let s=t[1],i=(t[2]||[]).slice(),o=!0;n!==T3&&(s=t,i=[],o=!1);super(s.length);Q(this,l0);s.forEach((l,u)=>{this[u]=l});const a=i.reduce((l,u)=>(typeof u=="string"&&l.set(u,(l.get(u)||0)+1),l),new Map);if(CF(this,Object.freeze(s.map((l,u)=>{const d=i[u];return d!=null&&a.get(d)===1?d:null}))),M(this,l0,[]),T(this,l0)==null&&T(this,l0),!o)return;Object.freeze(this);const c=new Proxy(this,{get:(l,u,d)=>{if(typeof u=="string"){if(u.match(/^[0-9]+$/)){const y=Ze(u,"%index");if(y<0||y>=this.length)throw new RangeError("out of result range");const f=l[y];return f instanceof Error&&Zg(`index ${y}`,f),f}if(fMe.indexOf(u)>=0)return Reflect.get(l,u,d);const p=l[u];if(p instanceof Function)return function(...y){return p.apply(this===d?l:this,y)};if(!(u in l))return l.getValue.apply(this===d?l:this,[u])}return Reflect.get(l,u,d)}});return CF(c,Mh(this)),c}toArray(t){const n=[];return this.forEach((s,i)=>{s instanceof Error&&Zg(`index ${i}`,s),t&&s instanceof Sp&&(s=s.toArray(t)),n.push(s)}),n}toObject(t){const n=Mh(this);return n.reduce((s,i,o)=>(se(i!=null,`value at index ${o} unnamed`,"UNSUPPORTED_OPERATION",{operation:"toObject()"}),qI(n,this,t)),{})}slice(t,n){t==null&&(t=0),t<0&&(t+=this.length,t<0&&(t=0)),n==null&&(n=this.length),n<0&&(n+=this.length,n<0&&(n=0)),n>this.length&&(n=this.length);const s=Mh(this),i=[],o=[];for(let a=t;a<n;a++)i.push(this[a]),o.push(s[a]);return new Sp(T3,i,o)}filter(t,n){const s=Mh(this),i=[],o=[];for(let a=0;a<this.length;a++){const c=this[a];c instanceof Error&&Zg(`index ${a}`,c),t.call(n,c,a,this)&&(i.push(c),o.push(s[a]))}return new Sp(T3,i,o)}map(t,n){const s=[];for(let i=0;i<this.length;i++){const o=this[i];o instanceof Error&&Zg(`index ${i}`,o),s.push(t.call(n,o,i,this))}return s}getValue(t){const n=Mh(this).indexOf(t);if(n===-1)return;const s=this[n];return s instanceof Error&&Zg(`property ${JSON.stringify(t)}`,s.error),s}static fromItems(t,n){return new Sp(T3,t,n)}};l0=new WeakMap;let D1=Sp;function IF(r){let e=Hn(r);return se(e.length<=Kn,"value out-of-bounds","BUFFER_OVERRUN",{buffer:e,length:Kn,offset:e.length}),e.length!==Kn&&(e=zn(pr([jI.slice(e.length%Kn),e]))),e}class rl{constructor(e,t,n,s){h(this,"name");h(this,"type");h(this,"localName");h(this,"dynamic");Me(this,{name:e,type:t,localName:n,dynamic:s},{name:"string",type:"string",localName:"string",dynamic:"boolean"})}_throwError(e,t){q(!1,e,this.localName,t)}}var ec,ad,u0,T4;class WI{constructor(){Q(this,u0);Q(this,ec);Q(this,ad);M(this,ec,[]),M(this,ad,0)}get data(){return pr(T(this,ec))}get length(){return T(this,ad)}appendWriter(e){return te(this,u0,T4).call(this,zn(e.data))}writeBytes(e){let t=zn(e);const n=t.length%Kn;return n&&(t=zn(pr([t,jI.slice(n)]))),te(this,u0,T4).call(this,t)}writeValue(e){return te(this,u0,T4).call(this,IF(e))}writeUpdatableValue(){const e=T(this,ec).length;return T(this,ec).push(jI),M(this,ad,T(this,ad)+Kn),t=>{T(this,ec)[e]=IF(t)}}}ec=new WeakMap,ad=new WeakMap,u0=new WeakSet,T4=function(e){return T(this,ec).push(e),M(this,ad,T(this,ad)+e.length),e.length};var as,Ls,cd,ld,ql,mf,JI,Kee;const XN=class XN{constructor(e,t,n){Q(this,mf);h(this,"allowLoose");Q(this,as);Q(this,Ls);Q(this,cd);Q(this,ld);Q(this,ql);Me(this,{allowLoose:!!t}),M(this,as,zn(e)),M(this,cd,0),M(this,ld,null),M(this,ql,n??1024),M(this,Ls,0)}get data(){return ke(T(this,as))}get dataLength(){return T(this,as).length}get consumed(){return T(this,Ls)}get bytes(){return new Uint8Array(T(this,as))}subReader(e){const t=new XN(T(this,as).slice(T(this,Ls)+e),this.allowLoose,T(this,ql));return M(t,ld,this),t}readBytes(e,t){let n=te(this,mf,Kee).call(this,0,e,!!t);return te(this,mf,JI).call(this,e),M(this,Ls,T(this,Ls)+n.length),n.slice(0,e)}readValue(){return PN(this.readBytes(Kn))}readIndex(){return JBe(this.readBytes(Kn))}};as=new WeakMap,Ls=new WeakMap,cd=new WeakMap,ld=new WeakMap,ql=new WeakMap,mf=new WeakSet,JI=function(e){var t;if(T(this,ld))return te(t=T(this,ld),mf,JI).call(t,e);M(this,cd,T(this,cd)+e),se(T(this,ql)<1||T(this,cd)<=T(this,ql)*this.dataLength,`compressed ABI data exceeds inflation ratio of ${T(this,ql)} ( see: https://github.com/ethers-io/ethers.js/issues/4537 )`,"BUFFER_OVERRUN",{buffer:zn(T(this,as)),offset:T(this,Ls),length:e,info:{bytesRead:T(this,cd),dataLength:this.dataLength}})},Kee=function(e,t,n){let s=Math.ceil(t/Kn)*Kn;return T(this,Ls)+s>T(this,as).length&&(this.allowLoose&&n&&T(this,Ls)+t<=T(this,as).length?s=t:se(!1,"data out-of-bounds","BUFFER_OVERRUN",{buffer:zn(T(this,as)),length:T(this,as).length,offset:T(this,Ls)+s})),T(this,as).slice(T(this,Ls),T(this,Ls)+s)};let QI=XN;function R6(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function NN(r,...e){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(r.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${r.length}`)}function pMe(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");R6(r.outputLen),R6(r.blockLen)}function O1(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Gee(r,e){NN(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const ZE=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const jee=r=>r instanceof Uint8Array,gMe=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),ex=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Ko=(r,e)=>r<<32-e|r>>>e,yMe=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!yMe)throw new Error("Non little-endian hardware is not supported");function mMe(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function P7(r){if(typeof r=="string"&&(r=mMe(r)),!jee(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}function wMe(...r){const e=new Uint8Array(r.reduce((n,s)=>n+s.length,0));let t=0;return r.forEach(n=>{if(!jee(n))throw new Error("Uint8Array expected");e.set(n,t),t+=n.length}),e}class DN{clone(){return this._cloneInto()}}function ON(r){const e=n=>r().update(P7(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function bMe(r=32){if(ZE&&typeof ZE.getRandomValues=="function")return ZE.getRandomValues(new Uint8Array(r));throw new Error("crypto.getRandomValues must be defined")}class qee extends DN{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,pMe(e);const n=P7(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),i.fill(0)}update(e){return O1(this),this.iHash.update(e),this}digestInto(e){O1(this),NN(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Wee=(r,e,t)=>new qee(r,e).update(t).digest();Wee.create=(r,e)=>new qee(r,e);function vMe(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}class Qee extends DN{constructor(e,t,n,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ex(this.buffer)}update(e){O1(this);const{view:t,buffer:n,blockLen:s}=this;e=P7(e);const i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=ex(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){O1(this),Gee(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(n,0),o=0);for(let d=o;d<s;d++)t[d]=0;vMe(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=ex(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<l;d++)a.setUint32(4*d,u[d],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=i,e.destroyed=o,s%t&&e.buffer.set(n),e}}const EMe=(r,e,t)=>r&e^~r&t,xMe=(r,e,t)=>r&e^r&t^e&t,AMe=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),vl=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),El=new Uint32Array(64);class SMe extends Qee{constructor(){super(64,32,8,!1),this.A=vl[0]|0,this.B=vl[1]|0,this.C=vl[2]|0,this.D=vl[3]|0,this.E=vl[4]|0,this.F=vl[5]|0,this.G=vl[6]|0,this.H=vl[7]|0}get(){const{A:e,B:t,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,t,n,s,i,o,a,c]}set(e,t,n,s,i,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let d=0;d<16;d++,t+=4)El[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){const p=El[d-15],y=El[d-2],f=Ko(p,7)^Ko(p,18)^p>>>3,g=Ko(y,17)^Ko(y,19)^y>>>10;El[d]=g+El[d-7]+f+El[d-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let d=0;d<64;d++){const p=Ko(a,6)^Ko(a,11)^Ko(a,25),y=u+p+EMe(a,c,l)+AMe[d]+El[d]|0,g=(Ko(n,2)^Ko(n,13)^Ko(n,22))+xMe(n,s,i)|0;u=l,l=c,c=a,a=o+y|0,o=i,i=s,s=n,n=y+g|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,s,i,o,a,c,l,u)}roundClean(){El.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Jee=ON(()=>new SMe),_3=BigInt(2**32-1),YI=BigInt(32);function Yee(r,e=!1){return e?{h:Number(r&_3),l:Number(r>>YI&_3)}:{h:Number(r>>YI&_3)|0,l:Number(r&_3)|0}}function Xee(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:i,l:o}=Yee(r[s],e);[t[s],n[s]]=[i,o]}return[t,n]}const CMe=(r,e)=>BigInt(r>>>0)<<YI|BigInt(e>>>0),IMe=(r,e,t)=>r>>>t,kMe=(r,e,t)=>r<<32-t|e>>>t,TMe=(r,e,t)=>r>>>t|e<<32-t,_Me=(r,e,t)=>r<<32-t|e>>>t,PMe=(r,e,t)=>r<<64-t|e>>>t-32,NMe=(r,e,t)=>r>>>t-32|e<<64-t,DMe=(r,e)=>e,OMe=(r,e)=>r,Zee=(r,e,t)=>r<<t|e>>>32-t,ete=(r,e,t)=>e<<t|r>>>32-t,tte=(r,e,t)=>e<<t-32|r>>>64-t,rte=(r,e,t)=>r<<t-32|e>>>64-t;function RMe(r,e,t,n){const s=(e>>>0)+(n>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}const BMe=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),MMe=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,$Me=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),LMe=(r,e,t,n,s)=>e+t+n+s+(r/2**32|0)|0,UMe=(r,e,t,n,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(s>>>0),FMe=(r,e,t,n,s,i)=>e+t+n+s+i+(r/2**32|0)|0,Ye={fromBig:Yee,split:Xee,toBig:CMe,shrSH:IMe,shrSL:kMe,rotrSH:TMe,rotrSL:_Me,rotrBH:PMe,rotrBL:NMe,rotr32H:DMe,rotr32L:OMe,rotlSH:Zee,rotlSL:ete,rotlBH:tte,rotlBL:rte,add:RMe,add3L:BMe,add3H:MMe,add4L:$Me,add4H:LMe,add5H:FMe,add5L:UMe},[zMe,VMe]=Ye.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),xl=new Uint32Array(80),Al=new Uint32Array(80);class HMe extends Qee{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:d,Fl:p,Gh:y,Gl:f,Hh:g,Hl:w}=this;return[e,t,n,s,i,o,a,c,l,u,d,p,y,f,g,w]}set(e,t,n,s,i,o,a,c,l,u,d,p,y,f,g,w){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=d|0,this.Fl=p|0,this.Gh=y|0,this.Gl=f|0,this.Hh=g|0,this.Hl=w|0}process(e,t){for(let v=0;v<16;v++,t+=4)xl[v]=e.getUint32(t),Al[v]=e.getUint32(t+=4);for(let v=16;v<80;v++){const E=xl[v-15]|0,S=Al[v-15]|0,I=Ye.rotrSH(E,S,1)^Ye.rotrSH(E,S,8)^Ye.shrSH(E,S,7),x=Ye.rotrSL(E,S,1)^Ye.rotrSL(E,S,8)^Ye.shrSL(E,S,7),C=xl[v-2]|0,P=Al[v-2]|0,L=Ye.rotrSH(C,P,19)^Ye.rotrBH(C,P,61)^Ye.shrSH(C,P,6),K=Ye.rotrSL(C,P,19)^Ye.rotrBL(C,P,61)^Ye.shrSL(C,P,6),V=Ye.add4L(x,K,Al[v-7],Al[v-16]),Z=Ye.add4H(V,I,L,xl[v-7],xl[v-16]);xl[v]=Z|0,Al[v]=V|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:d,El:p,Fh:y,Fl:f,Gh:g,Gl:w,Hh:m,Hl:b}=this;for(let v=0;v<80;v++){const E=Ye.rotrSH(d,p,14)^Ye.rotrSH(d,p,18)^Ye.rotrBH(d,p,41),S=Ye.rotrSL(d,p,14)^Ye.rotrSL(d,p,18)^Ye.rotrBL(d,p,41),I=d&y^~d&g,x=p&f^~p&w,C=Ye.add5L(b,S,x,VMe[v],Al[v]),P=Ye.add5H(C,m,E,I,zMe[v],xl[v]),L=C|0,K=Ye.rotrSH(n,s,28)^Ye.rotrBH(n,s,34)^Ye.rotrBH(n,s,39),V=Ye.rotrSL(n,s,28)^Ye.rotrBL(n,s,34)^Ye.rotrBL(n,s,39),Z=n&i^n&a^i&a,Y=s&o^s&c^o&c;m=g|0,b=w|0,g=y|0,w=f|0,y=d|0,f=p|0,{h:d,l:p}=Ye.add(l|0,u|0,P|0,L|0),l=a|0,u=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const U=Ye.add3L(L,V,Y);n=Ye.add3H(U,P,K,Z),s=U|0}({h:n,l:s}=Ye.add(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=Ye.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=Ye.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Ye.add(this.Dh|0,this.Dl|0,l|0,u|0),{h:d,l:p}=Ye.add(this.Eh|0,this.El|0,d|0,p|0),{h:y,l:f}=Ye.add(this.Fh|0,this.Fl|0,y|0,f|0),{h:g,l:w}=Ye.add(this.Gh|0,this.Gl|0,g|0,w|0),{h:m,l:b}=Ye.add(this.Hh|0,this.Hl|0,m|0,b|0),this.set(n,s,i,o,a,c,l,u,d,p,y,f,g,w,m,b)}roundClean(){xl.fill(0),Al.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const KMe=ON(()=>new HMe);function GMe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}const kF=GMe();kF.crypto||kF.msCrypto;function jMe(r){switch(r){case"sha256":return Jee.create();case"sha512":return KMe.create()}q(!1,"invalid hashing algorithm name","algorithm",r)}const[nte,ste,ite]=[[],[],[]],qMe=BigInt(0),e2=BigInt(1),WMe=BigInt(2),QMe=BigInt(7),JMe=BigInt(256),YMe=BigInt(113);for(let r=0,e=e2,t=1,n=0;r<24;r++){[t,n]=[n,(2*t+3*n)%5],nte.push(2*(5*n+t)),ste.push((r+1)*(r+2)/2%64);let s=qMe;for(let i=0;i<7;i++)e=(e<<e2^(e>>QMe)*YMe)%JMe,e&WMe&&(s^=e2<<(e2<<BigInt(i))-e2);ite.push(s)}const[XMe,ZMe]=Xee(ite,!0),TF=(r,e,t)=>t>32?tte(r,e,t):Zee(r,e,t),_F=(r,e,t)=>t>32?rte(r,e,t):ete(r,e,t);function e$e(r,e=24){const t=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=t[c],u=t[c+1],d=TF(l,u,1)^t[a],p=_F(l,u,1)^t[a+1];for(let y=0;y<50;y+=10)r[o+y]^=d,r[o+y+1]^=p}let s=r[2],i=r[3];for(let o=0;o<24;o++){const a=ste[o],c=TF(s,i,a),l=_F(s,i,a),u=nte[o];s=r[u],i=r[u+1],r[u]=c,r[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=XMe[n],r[1]^=ZMe[n]}t.fill(0)}class RN extends DN{constructor(e,t,n,s=!1,i=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=s,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,R6(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=gMe(this.state)}keccak(){e$e(this.state32,this.rounds),this.posOut=0,this.pos=0}update(e){O1(this);const{blockLen:t,state:n}=this;e=P7(e);const s=e.length;for(let i=0;i<s;){const o=Math.min(t-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:n,blockLen:s}=this;e[n]^=t,t&128&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){O1(this,!1),NN(e),this.finish();const t=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-s);e.set(t.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return R6(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Gee(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new RN(t,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}}const t$e=(r,e,t)=>ON(()=>new RN(e,r,t)),r$e=t$e(1,136,256/8);let ote=!1;const ate=function(r){return r$e(r)};let cte=ate;function br(r){const e=dt(r,"data");return ke(cte(e))}br._=ate;br.lock=function(){ote=!0};br.register=function(r){if(ote)throw new TypeError("keccak256 is locked");cte=r};Object.freeze(br);const lte=function(r){return jMe("sha256").update(r).digest()};let ute=lte,hte=!1;function fg(r){const e=dt(r,"data");return ke(ute(e))}fg._=lte;fg.lock=function(){hte=!0};fg.register=function(r){if(hte)throw new Error("sha256 is locked");ute=r};Object.freeze(fg);Object.freeze(fg);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const dte=BigInt(0),N7=BigInt(1),n$e=BigInt(2),D7=r=>r instanceof Uint8Array,s$e=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function R1(r){if(!D7(r))throw new Error("Uint8Array expected");let e="";for(let t=0;t<r.length;t++)e+=s$e[r[t]];return e}function fte(r){const e=r.toString(16);return e.length&1?`0${e}`:e}function BN(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return BigInt(r===""?"0":`0x${r}`)}function B1(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const t=new Uint8Array(e/2);for(let n=0;n<t.length;n++){const s=n*2,i=r.slice(s,s+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");t[n]=o}return t}function Rd(r){return BN(R1(r))}function MN(r){if(!D7(r))throw new Error("Uint8Array expected");return BN(R1(Uint8Array.from(r).reverse()))}function M1(r,e){return B1(r.toString(16).padStart(e*2,"0"))}function $N(r,e){return M1(r,e).reverse()}function i$e(r){return B1(fte(r))}function so(r,e,t){let n;if(typeof e=="string")try{n=B1(e)}catch(i){throw new Error(`${r} must be valid hex string, got "${e}". Cause: ${i}`)}else if(D7(e))n=Uint8Array.from(e);else throw new Error(`${r} must be hex string or Uint8Array`);const s=n.length;if(typeof t=="number"&&s!==t)throw new Error(`${r} expected ${t} bytes, got ${s}`);return n}function jy(...r){const e=new Uint8Array(r.reduce((n,s)=>n+s.length,0));let t=0;return r.forEach(n=>{if(!D7(n))throw new Error("Uint8Array expected");e.set(n,t),t+=n.length}),e}function o$e(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function a$e(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function c$e(r){let e;for(e=0;r>dte;r>>=N7,e+=1);return e}function l$e(r,e){return r>>BigInt(e)&N7}const u$e=(r,e,t)=>r|(t?N7:dte)<<BigInt(e),LN=r=>(n$e<<BigInt(r-1))-N7,tx=r=>new Uint8Array(r),PF=r=>Uint8Array.from(r);function pte(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=tx(r),s=tx(r),i=0;const o=()=>{n.fill(1),s.fill(0),i=0},a=(...d)=>t(s,n,...d),c=(d=tx())=>{s=a(PF([0]),d),n=a(),d.length!==0&&(s=a(PF([1]),d),n=a())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const p=[];for(;d<e;){n=a();const y=n.slice();p.push(y),d+=n.length}return jy(...p)};return(d,p)=>{o(),c(d);let y;for(;!(y=p(l()));)c();return o(),y}}const h$e={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||r instanceof Uint8Array,isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function hw(r,e,t={}){const n=(s,i,o)=>{const a=h$e[i];if(typeof a!="function")throw new Error(`Invalid validator "${i}", expected function`);const c=r[s];if(!(o&&c===void 0)&&!a(c,r))throw new Error(`Invalid param ${String(s)}=${c} (${typeof c}), expected ${i}`)};for(const[s,i]of Object.entries(e))n(s,i,!1);for(const[s,i]of Object.entries(t))n(s,i,!0);return r}const d$e=Object.freeze(Object.defineProperty({__proto__:null,bitGet:l$e,bitLen:c$e,bitMask:LN,bitSet:u$e,bytesToHex:R1,bytesToNumberBE:Rd,bytesToNumberLE:MN,concatBytes:jy,createHmacDrbg:pte,ensureBytes:so,equalBytes:o$e,hexToBytes:B1,hexToNumber:BN,numberToBytesBE:M1,numberToBytesLE:$N,numberToHexUnpadded:fte,numberToVarBytesBE:i$e,utf8ToBytes:a$e,validateObject:hw},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Mr=BigInt(0),hr=BigInt(1),$h=BigInt(2),f$e=BigInt(3),XI=BigInt(4),NF=BigInt(5),DF=BigInt(8);BigInt(9);BigInt(16);function ds(r,e){const t=r%e;return t>=Mr?t:e+t}function p$e(r,e,t){if(t<=Mr||e<Mr)throw new Error("Expected power/modulo > 0");if(t===hr)return Mr;let n=hr;for(;e>Mr;)e&hr&&(n=n*r%t),r=r*r%t,e>>=hr;return n}function di(r,e,t){let n=r;for(;e-- >Mr;)n*=n,n%=t;return n}function ZI(r,e){if(r===Mr||e<=Mr)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=ds(r,e),n=e,s=Mr,i=hr;for(;t!==Mr;){const a=n/t,c=n%t,l=s-i*a;n=t,t=c,s=i,i=l}if(n!==hr)throw new Error("invert: does not exist");return ds(s,e)}function g$e(r){const e=(r-hr)/$h;let t,n,s;for(t=r-hr,n=0;t%$h===Mr;t/=$h,n++);for(s=$h;s<r&&p$e(s,e,r)!==r-hr;s++);if(n===1){const o=(r+hr)/XI;return function(c,l){const u=c.pow(l,o);if(!c.eql(c.sqr(u),l))throw new Error("Cannot find square root");return u}}const i=(t+hr)/$h;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=n,u=a.pow(a.mul(a.ONE,s),t),d=a.pow(c,i),p=a.pow(c,t);for(;!a.eql(p,a.ONE);){if(a.eql(p,a.ZERO))return a.ZERO;let y=1;for(let g=a.sqr(p);y<l&&!a.eql(g,a.ONE);y++)g=a.sqr(g);const f=a.pow(u,hr<<BigInt(l-y-1));u=a.sqr(f),d=a.mul(d,f),p=a.mul(p,u),l=y}return d}}function y$e(r){if(r%XI===f$e){const e=(r+hr)/XI;return function(n,s){const i=n.pow(s,e);if(!n.eql(n.sqr(i),s))throw new Error("Cannot find square root");return i}}if(r%DF===NF){const e=(r-NF)/DF;return function(n,s){const i=n.mul(s,$h),o=n.pow(i,e),a=n.mul(s,o),c=n.mul(n.mul(a,$h),o),l=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(l),s))throw new Error("Cannot find square root");return l}}return g$e(r)}const m$e=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function w$e(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=m$e.reduce((n,s)=>(n[s]="function",n),e);return hw(r,t)}function b$e(r,e,t){if(t<Mr)throw new Error("Expected power > 0");if(t===Mr)return r.ONE;if(t===hr)return e;let n=r.ONE,s=e;for(;t>Mr;)t&hr&&(n=r.mul(n,s)),s=r.sqr(s),t>>=hr;return n}function v$e(r,e){const t=new Array(e.length),n=e.reduce((i,o,a)=>r.is0(o)?i:(t[a]=i,r.mul(i,o)),r.ONE),s=r.inv(n);return e.reduceRight((i,o,a)=>r.is0(o)?i:(t[a]=r.mul(i,t[a]),r.mul(i,o)),s),t}function gte(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function E$e(r,e,t=!1,n={}){if(r<=Mr)throw new Error(`Expected Field ORDER > 0, got ${r}`);const{nBitLength:s,nByteLength:i}=gte(r,e);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=y$e(r),a=Object.freeze({ORDER:r,BITS:s,BYTES:i,MASK:LN(s),ZERO:Mr,ONE:hr,create:c=>ds(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return Mr<=c&&c<r},is0:c=>c===Mr,isOdd:c=>(c&hr)===hr,neg:c=>ds(-c,r),eql:(c,l)=>c===l,sqr:c=>ds(c*c,r),add:(c,l)=>ds(c+l,r),sub:(c,l)=>ds(c-l,r),mul:(c,l)=>ds(c*l,r),pow:(c,l)=>b$e(a,c,l),div:(c,l)=>ds(c*ZI(l,r),r),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>ZI(c,r),sqrt:n.sqrt||(c=>o(a,c)),invertBatch:c=>v$e(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>t?$N(c,i):M1(c,i),fromBytes:c=>{if(c.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${c.length}`);return t?MN(c):Rd(c)}});return Object.freeze(a)}function yte(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function mte(r){const e=yte(r);return e+Math.ceil(e/2)}function x$e(r,e,t=!1){const n=r.length,s=yte(e),i=mte(e);if(n<16||n<i||n>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${n}`);const o=t?Rd(r):MN(r),a=ds(o,e-hr)+hr;return t?$N(a,s):M1(a,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const A$e=BigInt(0),rx=BigInt(1);function S$e(r,e){const t=(s,i)=>{const o=i.negate();return s?o:i},n=s=>{const i=Math.ceil(e/s)+1,o=2**(s-1);return{windows:i,windowSize:o}};return{constTimeNegate:t,unsafeLadder(s,i){let o=r.ZERO,a=s;for(;i>A$e;)i&rx&&(o=o.add(a)),a=a.double(),i>>=rx;return o},precomputeWindow(s,i){const{windows:o,windowSize:a}=n(i),c=[];let l=s,u=l;for(let d=0;d<o;d++){u=l,c.push(u);for(let p=1;p<a;p++)u=u.add(l),c.push(u);l=u.double()}return c},wNAF(s,i,o){const{windows:a,windowSize:c}=n(s);let l=r.ZERO,u=r.BASE;const d=BigInt(2**s-1),p=2**s,y=BigInt(s);for(let f=0;f<a;f++){const g=f*c;let w=Number(o&d);o>>=y,w>c&&(w-=p,o+=rx);const m=g,b=g+Math.abs(w)-1,v=f%2!==0,E=w<0;w===0?u=u.add(t(v,i[m])):l=l.add(t(E,i[b]))}return{p:l,f:u}},wNAFCached(s,i,o,a){const c=s._WINDOW_SIZE||1;let l=i.get(s);return l||(l=this.precomputeWindow(s,c),c!==1&&i.set(s,a(l))),this.wNAF(c,l,o)}}}function wte(r){return w$e(r.Fp),hw(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...gte(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function C$e(r){const e=wte(r);hw(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:n,a:s}=e;if(t){if(!n.eql(s,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:I$e,hexToBytes:k$e}=d$e,Qh={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(r){const{Err:e}=Qh;if(r.length<2||r[0]!==2)throw new e("Invalid signature integer tag");const t=r[1],n=r.subarray(2,t+2);if(!t||n.length!==t)throw new e("Invalid signature integer: wrong length");if(n[0]&128)throw new e("Invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:I$e(n),l:r.subarray(t+2)}},toSig(r){const{Err:e}=Qh,t=typeof r=="string"?k$e(r):r;if(!(t instanceof Uint8Array))throw new Error("ui8a expected");let n=t.length;if(n<2||t[0]!=48)throw new e("Invalid signature tag");if(t[1]!==n-2)throw new e("Invalid signature: incorrect length");const{d:s,l:i}=Qh._parseInt(t.subarray(2)),{d:o,l:a}=Qh._parseInt(i);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:s,s:o}},hexFromSig(r){const e=l=>Number.parseInt(l[0],16)&8?"00"+l:l,t=l=>{const u=l.toString(16);return u.length&1?`0${u}`:u},n=e(t(r.s)),s=e(t(r.r)),i=n.length/2,o=s.length/2,a=t(i),c=t(o);return`30${t(o+i+4)}02${c}${s}02${a}${n}`}},fc=BigInt(0),Si=BigInt(1);BigInt(2);const OF=BigInt(3);BigInt(4);function T$e(r){const e=C$e(r),{Fp:t}=e,n=e.toBytes||((f,g,w)=>{const m=g.toAffine();return jy(Uint8Array.from([4]),t.toBytes(m.x),t.toBytes(m.y))}),s=e.fromBytes||(f=>{const g=f.subarray(1),w=t.fromBytes(g.subarray(0,t.BYTES)),m=t.fromBytes(g.subarray(t.BYTES,2*t.BYTES));return{x:w,y:m}});function i(f){const{a:g,b:w}=e,m=t.sqr(f),b=t.mul(m,f);return t.add(t.add(b,t.mul(f,g)),w)}if(!t.eql(t.sqr(e.Gy),i(e.Gx)))throw new Error("bad generator point: equation left != right");function o(f){return typeof f=="bigint"&&fc<f&&f<e.n}function a(f){if(!o(f))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(f){const{allowedPrivateKeyLengths:g,nByteLength:w,wrapPrivateKey:m,n:b}=e;if(g&&typeof f!="bigint"){if(f instanceof Uint8Array&&(f=R1(f)),typeof f!="string"||!g.includes(f.length))throw new Error("Invalid key");f=f.padStart(w*2,"0")}let v;try{v=typeof f=="bigint"?f:Rd(so("private key",f,w))}catch{throw new Error(`private key must be ${w} bytes, hex or bigint, not ${typeof f}`)}return m&&(v=ds(v,b)),a(v),v}const l=new Map;function u(f){if(!(f instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(g,w,m){if(this.px=g,this.py=w,this.pz=m,g==null||!t.isValid(g))throw new Error("x required");if(w==null||!t.isValid(w))throw new Error("y required");if(m==null||!t.isValid(m))throw new Error("z required")}static fromAffine(g){const{x:w,y:m}=g||{};if(!g||!t.isValid(w)||!t.isValid(m))throw new Error("invalid affine point");if(g instanceof d)throw new Error("projective point not allowed");const b=v=>t.eql(v,t.ZERO);return b(w)&&b(m)?d.ZERO:new d(w,m,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){const w=t.invertBatch(g.map(m=>m.pz));return g.map((m,b)=>m.toAffine(w[b])).map(d.fromAffine)}static fromHex(g){const w=d.fromAffine(s(so("pointHex",g)));return w.assertValidity(),w}static fromPrivateKey(g){return d.BASE.multiply(c(g))}_setWindowSize(g){this._WINDOW_SIZE=g,l.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!t.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:g,y:w}=this.toAffine();if(!t.isValid(g)||!t.isValid(w))throw new Error("bad point: x or y not FE");const m=t.sqr(w),b=i(g);if(!t.eql(m,b))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:g}=this.toAffine();if(t.isOdd)return!t.isOdd(g);throw new Error("Field doesn't support isOdd")}equals(g){u(g);const{px:w,py:m,pz:b}=this,{px:v,py:E,pz:S}=g,I=t.eql(t.mul(w,S),t.mul(v,b)),x=t.eql(t.mul(m,S),t.mul(E,b));return I&&x}negate(){return new d(this.px,t.neg(this.py),this.pz)}double(){const{a:g,b:w}=e,m=t.mul(w,OF),{px:b,py:v,pz:E}=this;let S=t.ZERO,I=t.ZERO,x=t.ZERO,C=t.mul(b,b),P=t.mul(v,v),L=t.mul(E,E),K=t.mul(b,v);return K=t.add(K,K),x=t.mul(b,E),x=t.add(x,x),S=t.mul(g,x),I=t.mul(m,L),I=t.add(S,I),S=t.sub(P,I),I=t.add(P,I),I=t.mul(S,I),S=t.mul(K,S),x=t.mul(m,x),L=t.mul(g,L),K=t.sub(C,L),K=t.mul(g,K),K=t.add(K,x),x=t.add(C,C),C=t.add(x,C),C=t.add(C,L),C=t.mul(C,K),I=t.add(I,C),L=t.mul(v,E),L=t.add(L,L),C=t.mul(L,K),S=t.sub(S,C),x=t.mul(L,P),x=t.add(x,x),x=t.add(x,x),new d(S,I,x)}add(g){u(g);const{px:w,py:m,pz:b}=this,{px:v,py:E,pz:S}=g;let I=t.ZERO,x=t.ZERO,C=t.ZERO;const P=e.a,L=t.mul(e.b,OF);let K=t.mul(w,v),V=t.mul(m,E),Z=t.mul(b,S),Y=t.add(w,m),U=t.add(v,E);Y=t.mul(Y,U),U=t.add(K,V),Y=t.sub(Y,U),U=t.add(w,b);let H=t.add(v,S);return U=t.mul(U,H),H=t.add(K,Z),U=t.sub(U,H),H=t.add(m,b),I=t.add(E,S),H=t.mul(H,I),I=t.add(V,Z),H=t.sub(H,I),C=t.mul(P,U),I=t.mul(L,Z),C=t.add(I,C),I=t.sub(V,C),C=t.add(V,C),x=t.mul(I,C),V=t.add(K,K),V=t.add(V,K),Z=t.mul(P,Z),U=t.mul(L,U),V=t.add(V,Z),Z=t.sub(K,Z),Z=t.mul(P,Z),U=t.add(U,Z),K=t.mul(V,U),x=t.add(x,K),K=t.mul(H,U),I=t.mul(Y,I),I=t.sub(I,K),K=t.mul(Y,V),C=t.mul(H,C),C=t.add(C,K),new d(I,x,C)}subtract(g){return this.add(g.negate())}is0(){return this.equals(d.ZERO)}wNAF(g){return y.wNAFCached(this,l,g,w=>{const m=t.invertBatch(w.map(b=>b.pz));return w.map((b,v)=>b.toAffine(m[v])).map(d.fromAffine)})}multiplyUnsafe(g){const w=d.ZERO;if(g===fc)return w;if(a(g),g===Si)return this;const{endo:m}=e;if(!m)return y.unsafeLadder(this,g);let{k1neg:b,k1:v,k2neg:E,k2:S}=m.splitScalar(g),I=w,x=w,C=this;for(;v>fc||S>fc;)v&Si&&(I=I.add(C)),S&Si&&(x=x.add(C)),C=C.double(),v>>=Si,S>>=Si;return b&&(I=I.negate()),E&&(x=x.negate()),x=new d(t.mul(x.px,m.beta),x.py,x.pz),I.add(x)}multiply(g){a(g);let w=g,m,b;const{endo:v}=e;if(v){const{k1neg:E,k1:S,k2neg:I,k2:x}=v.splitScalar(w);let{p:C,f:P}=this.wNAF(S),{p:L,f:K}=this.wNAF(x);C=y.constTimeNegate(E,C),L=y.constTimeNegate(I,L),L=new d(t.mul(L.px,v.beta),L.py,L.pz),m=C.add(L),b=P.add(K)}else{const{p:E,f:S}=this.wNAF(w);m=E,b=S}return d.normalizeZ([m,b])[0]}multiplyAndAddUnsafe(g,w,m){const b=d.BASE,v=(S,I)=>I===fc||I===Si||!S.equals(b)?S.multiplyUnsafe(I):S.multiply(I),E=v(this,w).add(v(g,m));return E.is0()?void 0:E}toAffine(g){const{px:w,py:m,pz:b}=this,v=this.is0();g==null&&(g=v?t.ONE:t.inv(b));const E=t.mul(w,g),S=t.mul(m,g),I=t.mul(b,g);if(v)return{x:t.ZERO,y:t.ZERO};if(!t.eql(I,t.ONE))throw new Error("invZ was invalid");return{x:E,y:S}}isTorsionFree(){const{h:g,isTorsionFree:w}=e;if(g===Si)return!0;if(w)return w(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:g,clearCofactor:w}=e;return g===Si?this:w?w(d,this):this.multiplyUnsafe(e.h)}toRawBytes(g=!0){return this.assertValidity(),n(d,this,g)}toHex(g=!0){return R1(this.toRawBytes(g))}}d.BASE=new d(e.Gx,e.Gy,t.ONE),d.ZERO=new d(t.ZERO,t.ONE,t.ZERO);const p=e.nBitLength,y=S$e(d,e.endo?Math.ceil(p/2):p);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:i,isWithinCurveOrder:o}}function _$e(r){const e=wte(r);return hw(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function P$e(r){const e=_$e(r),{Fp:t,n}=e,s=t.BYTES+1,i=2*t.BYTES+1;function o(U){return fc<U&&U<t.ORDER}function a(U){return ds(U,n)}function c(U){return ZI(U,n)}const{ProjectivePoint:l,normPrivateKeyToScalar:u,weierstrassEquation:d,isWithinCurveOrder:p}=T$e({...e,toBytes(U,H,G){const $=H.toAffine(),z=t.toBytes($.x),W=jy;return G?W(Uint8Array.from([H.hasEvenY()?2:3]),z):W(Uint8Array.from([4]),z,t.toBytes($.y))},fromBytes(U){const H=U.length,G=U[0],$=U.subarray(1);if(H===s&&(G===2||G===3)){const z=Rd($);if(!o(z))throw new Error("Point is not on curve");const W=d(z);let ee=t.sqrt(W);const J=(ee&Si)===Si;return(G&1)===1!==J&&(ee=t.neg(ee)),{x:z,y:ee}}else if(H===i&&G===4){const z=t.fromBytes($.subarray(0,t.BYTES)),W=t.fromBytes($.subarray(t.BYTES,2*t.BYTES));return{x:z,y:W}}else throw new Error(`Point of length ${H} was invalid. Expected ${s} compressed bytes or ${i} uncompressed bytes`)}}),y=U=>R1(M1(U,e.nByteLength));function f(U){const H=n>>Si;return U>H}function g(U){return f(U)?a(-U):U}const w=(U,H,G)=>Rd(U.slice(H,G));class m{constructor(H,G,$){this.r=H,this.s=G,this.recovery=$,this.assertValidity()}static fromCompact(H){const G=e.nByteLength;return H=so("compactSignature",H,G*2),new m(w(H,0,G),w(H,G,2*G))}static fromDER(H){const{r:G,s:$}=Qh.toSig(so("DER",H));return new m(G,$)}assertValidity(){if(!p(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!p(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(H){return new m(this.r,this.s,H)}recoverPublicKey(H){const{r:G,s:$,recovery:z}=this,W=x(so("msgHash",H));if(z==null||![0,1,2,3].includes(z))throw new Error("recovery id invalid");const ee=z===2||z===3?G+e.n:G;if(ee>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const J=z&1?"03":"02",le=l.fromHex(J+y(ee)),ye=c(ee),de=a(-W*ye),fe=a($*ye),De=l.BASE.multiplyAndAddUnsafe(le,de,fe);if(!De)throw new Error("point at infinify");return De.assertValidity(),De}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return B1(this.toDERHex())}toDERHex(){return Qh.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return B1(this.toCompactHex())}toCompactHex(){return y(this.r)+y(this.s)}}const b={isValidPrivateKey(U){try{return u(U),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const U=mte(e.n);return x$e(e.randomBytes(U),e.n)},precompute(U=8,H=l.BASE){return H._setWindowSize(U),H.multiply(BigInt(3)),H}};function v(U,H=!0){return l.fromPrivateKey(U).toRawBytes(H)}function E(U){const H=U instanceof Uint8Array,G=typeof U=="string",$=(H||G)&&U.length;return H?$===s||$===i:G?$===2*s||$===2*i:U instanceof l}function S(U,H,G=!0){if(E(U))throw new Error("first arg must be private key");if(!E(H))throw new Error("second arg must be public key");return l.fromHex(H).multiply(u(U)).toRawBytes(G)}const I=e.bits2int||function(U){const H=Rd(U),G=U.length*8-e.nBitLength;return G>0?H>>BigInt(G):H},x=e.bits2int_modN||function(U){return a(I(U))},C=LN(e.nBitLength);function P(U){if(typeof U!="bigint")throw new Error("bigint expected");if(!(fc<=U&&U<C))throw new Error(`bigint expected < 2^${e.nBitLength}`);return M1(U,e.nByteLength)}function L(U,H,G=K){if(["recovered","canonical"].some(qe=>qe in G))throw new Error("sign() legacy options not supported");const{hash:$,randomBytes:z}=e;let{lowS:W,prehash:ee,extraEntropy:J}=G;W==null&&(W=!0),U=so("msgHash",U),ee&&(U=so("prehashed msgHash",$(U)));const le=x(U),ye=u(H),de=[P(ye),P(le)];if(J!=null){const qe=J===!0?z(t.BYTES):J;de.push(so("extraEntropy",qe))}const fe=jy(...de),De=le;function $e(qe){const et=I(qe);if(!p(et))return;const Nt=c(et),bt=l.BASE.multiply(et).toAffine(),at=a(bt.x);if(at===fc)return;const Ut=a(Nt*a(De+at*ye));if(Ut===fc)return;let kr=(bt.x===at?0:2)|Number(bt.y&Si),Ro=Ut;return W&&f(Ut)&&(Ro=g(Ut),kr^=1),new m(at,Ro,kr)}return{seed:fe,k2sig:$e}}const K={lowS:e.lowS,prehash:!1},V={lowS:e.lowS,prehash:!1};function Z(U,H,G=K){const{seed:$,k2sig:z}=L(U,H,G),W=e;return pte(W.hash.outputLen,W.nByteLength,W.hmac)($,z)}l.BASE._setWindowSize(8);function Y(U,H,G,$=V){var bt;const z=U;if(H=so("msgHash",H),G=so("publicKey",G),"strict"in $)throw new Error("options.strict was renamed to lowS");const{lowS:W,prehash:ee}=$;let J,le;try{if(typeof z=="string"||z instanceof Uint8Array)try{J=m.fromDER(z)}catch(at){if(!(at instanceof Qh.Err))throw at;J=m.fromCompact(z)}else if(typeof z=="object"&&typeof z.r=="bigint"&&typeof z.s=="bigint"){const{r:at,s:Ut}=z;J=new m(at,Ut)}else throw new Error("PARSE");le=l.fromHex(G)}catch(at){if(at.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(W&&J.hasHighS())return!1;ee&&(H=e.hash(H));const{r:ye,s:de}=J,fe=x(H),De=c(de),$e=a(fe*De),qe=a(ye*De),et=(bt=l.BASE.multiplyAndAddUnsafe(le,$e,qe))==null?void 0:bt.toAffine();return et?a(et.x)===ye:!1}return{CURVE:e,getPublicKey:v,getSharedSecret:S,sign:Z,verify:Y,ProjectivePoint:l,Signature:m,utils:b}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function N$e(r){return{hash:r,hmac:(e,...t)=>Wee(r,e,wMe(...t)),randomBytes:bMe}}function D$e(r,e){const t=n=>P$e({...r,...N$e(n)});return Object.freeze({...t(e),create:t})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const bte=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),RF=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),O$e=BigInt(1),ek=BigInt(2),BF=(r,e)=>(r+e/ek)/e;function R$e(r){const e=bte,t=BigInt(3),n=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=r*r*r%e,u=l*l*r%e,d=di(u,t,e)*u%e,p=di(d,t,e)*u%e,y=di(p,ek,e)*l%e,f=di(y,s,e)*y%e,g=di(f,i,e)*f%e,w=di(g,a,e)*g%e,m=di(w,c,e)*w%e,b=di(m,a,e)*g%e,v=di(b,t,e)*u%e,E=di(v,o,e)*f%e,S=di(E,n,e)*l%e,I=di(S,ek,e);if(!tk.eql(tk.sqr(I),r))throw new Error("Cannot find square root");return I}const tk=E$e(bte,void 0,void 0,{sqrt:R$e}),Sl=D$e({a:BigInt(0),b:BigInt(7),Fp:tk,n:RF,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const e=RF,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-O$e*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=t,o=BigInt("0x100000000000000000000000000000000"),a=BF(i*r,e),c=BF(-n*r,e);let l=ds(r-a*t-c*s,e),u=ds(-a*n-c*i,e);const d=l>o,p=u>o;if(d&&(l=e-l),p&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:d,k1:l,k2neg:p,k2:u}}}},Jee);BigInt(0);Sl.ProjectivePoint;const qy="0x0000000000000000000000000000000000000000",MF="0x0000000000000000000000000000000000000000000000000000000000000000",$F=BigInt(0),LF=BigInt(1),UF=BigInt(2),FF=BigInt(27),zF=BigInt(28),P3=BigInt(35),Zf={};function VF(r){return hf(Hn(r),32)}var h0,d0,f0,ud;const ro=class ro{constructor(e,t,n,s){Q(this,h0);Q(this,d0);Q(this,f0);Q(this,ud);I7(e,Zf,"Signature"),M(this,h0,t),M(this,d0,n),M(this,f0,s),M(this,ud,null)}get r(){return T(this,h0)}set r(e){q(Kp(e)===32,"invalid r","value",e),M(this,h0,ke(e))}get s(){return T(this,d0)}set s(e){q(Kp(e)===32,"invalid s","value",e);const t=ke(e);q(parseInt(t.substring(0,3))<8,"non-canonical s","value",t),M(this,d0,t)}get v(){return T(this,f0)}set v(e){const t=Ze(e,"value");q(t===27||t===28,"invalid v","v",e),M(this,f0,t)}get networkV(){return T(this,ud)}get legacyChainId(){const e=this.networkV;return e==null?null:ro.getChainId(e)}get yParity(){return this.v===27?0:1}get yParityAndS(){const e=dt(this.s);return this.yParity&&(e[0]|=128),ke(e)}get compactSerialized(){return pr([this.r,this.yParityAndS])}get serialized(){return pr([this.r,this.s,this.yParity?"0x1c":"0x1b"])}[Symbol.for("nodejs.util.inspect.custom")](){return`Signature { r: "${this.r}", s: "${this.s}", yParity: ${this.yParity}, networkV: ${this.networkV} }`}clone(){const e=new ro(Zf,this.r,this.s,this.v);return this.networkV&&M(e,ud,this.networkV),e}toJSON(){const e=this.networkV;return{_type:"signature",networkV:e!=null?e.toString():null,r:this.r,s:this.s,v:this.v}}static getChainId(e){const t=Pe(e,"v");return t==FF||t==zF?$F:(q(t>=P3,"invalid EIP-155 v","v",e),(t-P3)/UF)}static getChainIdV(e,t){return Pe(e)*UF+BigInt(35+t-27)}static getNormalizedV(e){const t=Pe(e);return t===$F||t===FF?27:t===LF||t===zF?28:(q(t>=P3,"invalid v","v",e),t&LF?27:28)}static from(e){function t(l,u){q(l,u,"signature",e)}if(e==null)return new ro(Zf,MF,MF,27);if(typeof e=="string"){const l=dt(e,"signature");if(l.length===64){const u=ke(l.slice(0,32)),d=l.slice(32,64),p=d[0]&128?28:27;return d[0]&=127,new ro(Zf,u,ke(d),p)}if(l.length===65){const u=ke(l.slice(0,32)),d=l.slice(32,64);t((d[0]&128)===0,"non-canonical s");const p=ro.getNormalizedV(l[64]);return new ro(Zf,u,ke(d),p)}t(!1,"invalid raw signature length")}if(e instanceof ro)return e.clone();const n=e.r;t(n!=null,"missing r");const s=VF(n),i=function(l,u){if(l!=null)return VF(l);if(u!=null){t($t(u,32),"invalid yParityAndS");const d=dt(u);return d[0]&=127,ke(d)}t(!1,"missing s")}(e.s,e.yParityAndS);t((dt(i)[0]&128)==0,"non-canonical s");const{networkV:o,v:a}=function(l,u,d){if(l!=null){const p=Pe(l);return{networkV:p>=P3?p:void 0,v:ro.getNormalizedV(p)}}if(u!=null)return t($t(u,32),"invalid yParityAndS"),{v:dt(u)[0]&128?28:27};if(d!=null){switch(Ze(d,"sig.yParity")){case 0:return{v:27};case 1:return{v:28}}t(!1,"invalid yParity")}t(!1,"missing v")}(e.v,e.yParityAndS,e.yParity),c=new ro(Zf,s,i,a);return o&&M(c,ud,o),t(e.yParity==null||Ze(e.yParity,"sig.yParity")===c.yParity,"yParity mismatch"),t(e.yParityAndS==null||e.yParityAndS===c.yParityAndS,"yParityAndS mismatch"),c}};h0=new WeakMap,d0=new WeakMap,f0=new WeakMap,ud=new WeakMap;let To=ro;var tc;const Lh=class Lh{constructor(e){Q(this,tc);q(Kp(e)===32,"invalid private key","privateKey","[REDACTED]"),M(this,tc,ke(e))}get privateKey(){return T(this,tc)}get publicKey(){return Lh.computePublicKey(T(this,tc))}get compressedPublicKey(){return Lh.computePublicKey(T(this,tc),!0)}sign(e){q(Kp(e)===32,"invalid digest length","digest",e);const t=Sl.sign(zn(e),zn(T(this,tc)),{lowS:!0});return To.from({r:Ju(t.r,32),s:Ju(t.s,32),v:t.recovery?28:27})}computeSharedSecret(e){const t=Lh.computePublicKey(e);return ke(Sl.getSharedSecret(zn(T(this,tc)),dt(t),!1))}static computePublicKey(e,t){let n=dt(e,"key");if(n.length===32){const i=Sl.getPublicKey(n,!!t);return ke(i)}if(n.length===64){const i=new Uint8Array(65);i[0]=4,i.set(n,1),n=i}const s=Sl.ProjectivePoint.fromHex(n);return ke(s.toRawBytes(t))}static recoverPublicKey(e,t){q(Kp(e)===32,"invalid digest length","digest",e);const n=To.from(t);let s=Sl.Signature.fromCompact(zn(pr([n.r,n.s])));s=s.addRecoveryBit(n.yParity);const i=s.recoverPublicKey(zn(e));return q(i!=null,"invalid signautre for digest","signature",t),"0x"+i.toHex(!1)}static addPoints(e,t,n){const s=Sl.ProjectivePoint.fromHex(Lh.computePublicKey(e).substring(2)),i=Sl.ProjectivePoint.fromHex(Lh.computePublicKey(t).substring(2));return"0x"+s.add(i).toHex(!!n)}};tc=new WeakMap;let Wy=Lh;const B$e=BigInt(0),M$e=BigInt(36);function HF(r){r=r.toLowerCase();const e=r.substring(2).split(""),t=new Uint8Array(40);for(let s=0;s<40;s++)t[s]=e[s].charCodeAt(0);const n=dt(br(t));for(let s=0;s<40;s+=2)n[s>>1]>>4>=8&&(e[s]=e[s].toUpperCase()),(n[s>>1]&15)>=8&&(e[s+1]=e[s+1].toUpperCase());return"0x"+e.join("")}const UN={};for(let r=0;r<10;r++)UN[String(r)]=String(r);for(let r=0;r<26;r++)UN[String.fromCharCode(65+r)]=String(10+r);const KF=15;function $$e(r){r=r.toUpperCase(),r=r.substring(4)+r.substring(0,2)+"00";let e=r.split("").map(n=>UN[n]).join("");for(;e.length>=KF;){let n=e.substring(0,KF);e=parseInt(n,10)%97+e.substring(n.length)}let t=String(98-parseInt(e,10)%97);for(;t.length<2;)t="0"+t;return t}const L$e=function(){const r={};for(let e=0;e<36;e++){const t="0123456789abcdefghijklmnopqrstuvwxyz"[e];r[t]=BigInt(e)}return r}();function U$e(r){r=r.toLowerCase();let e=B$e;for(let t=0;t<r.length;t++)e=e*M$e+L$e[r[t]];return e}function _t(r){if(q(typeof r=="string","invalid address","address",r),r.match(/^(0x)?[0-9a-fA-F]{40}$/)){r.startsWith("0x")||(r="0x"+r);const e=HF(r);return q(!r.match(/([A-F].*[a-f])|([a-f].*[A-F])/)||e===r,"bad address checksum","address",r),e}if(r.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){q(r.substring(2,4)===$$e(r),"bad icap checksum","address",r);let e=U$e(r.substring(4)).toString(16);for(;e.length<40;)e="0"+e;return HF("0x"+e)}q(!1,"invalid address","address",r)}function F$e(r){const e=_t(r.from);let n=Pe(r.nonce,"tx.nonce").toString(16);return n==="0"?n="0x":n.length%2?n="0x0"+n:n="0x"+n,_t(sr(br(df([e,n])),12))}function vte(r){return r&&typeof r.getAddress=="function"}async function nx(r,e){const t=await e;return(t==null||t==="0x0000000000000000000000000000000000000000")&&(se(typeof r!="string","unconfigured name","UNCONFIGURED_NAME",{value:r}),q(!1,"invalid AddressLike value; did not resolve to a value address","target",r)),_t(t)}function Gn(r,e){if(typeof r=="string")return r.match(/^0x[0-9a-f]{40}$/i)?_t(r):(se(e!=null,"ENS resolution requires a provider","UNSUPPORTED_OPERATION",{operation:"resolveName"}),nx(r,e.resolveName(r)));if(vte(r))return nx(r,r.getAddress());if(r&&typeof r.then=="function")return nx(r,r);q(!1,"unsupported addressable value","target",r)}const Fa={};function Se(r,e){let t=!1;return e<0&&(t=!0,e*=-1),new Dn(Fa,`${t?"":"u"}int${e}`,r,{signed:t,width:e})}function pt(r,e){return new Dn(Fa,`bytes${e||""}`,r,{size:e})}const GF=Symbol.for("_ethers_typed");var hd;const Va=class Va{constructor(e,t,n,s){h(this,"type");h(this,"value");Q(this,hd);h(this,"_typedSymbol");s==null&&(s=null),I7(Fa,e,"Typed"),Me(this,{_typedSymbol:GF,type:t,value:n}),M(this,hd,s),this.format()}format(){if(this.type==="array")throw new Error("");if(this.type==="dynamicArray")throw new Error("");return this.type==="tuple"?`tuple(${this.value.map(e=>e.format()).join(",")})`:this.type}defaultValue(){return 0}minValue(){return 0}maxValue(){return 0}isBigInt(){return!!this.type.match(/^u?int[0-9]+$/)}isData(){return this.type.startsWith("bytes")}isString(){return this.type==="string"}get tupleName(){if(this.type!=="tuple")throw TypeError("not a tuple");return T(this,hd)}get arrayLength(){if(this.type!=="array")throw TypeError("not an array");return T(this,hd)===!0?-1:T(this,hd)===!1?this.value.length:null}static from(e,t){return new Va(Fa,e,t)}static uint8(e){return Se(e,8)}static uint16(e){return Se(e,16)}static uint24(e){return Se(e,24)}static uint32(e){return Se(e,32)}static uint40(e){return Se(e,40)}static uint48(e){return Se(e,48)}static uint56(e){return Se(e,56)}static uint64(e){return Se(e,64)}static uint72(e){return Se(e,72)}static uint80(e){return Se(e,80)}static uint88(e){return Se(e,88)}static uint96(e){return Se(e,96)}static uint104(e){return Se(e,104)}static uint112(e){return Se(e,112)}static uint120(e){return Se(e,120)}static uint128(e){return Se(e,128)}static uint136(e){return Se(e,136)}static uint144(e){return Se(e,144)}static uint152(e){return Se(e,152)}static uint160(e){return Se(e,160)}static uint168(e){return Se(e,168)}static uint176(e){return Se(e,176)}static uint184(e){return Se(e,184)}static uint192(e){return Se(e,192)}static uint200(e){return Se(e,200)}static uint208(e){return Se(e,208)}static uint216(e){return Se(e,216)}static uint224(e){return Se(e,224)}static uint232(e){return Se(e,232)}static uint240(e){return Se(e,240)}static uint248(e){return Se(e,248)}static uint256(e){return Se(e,256)}static uint(e){return Se(e,256)}static int8(e){return Se(e,-8)}static int16(e){return Se(e,-16)}static int24(e){return Se(e,-24)}static int32(e){return Se(e,-32)}static int40(e){return Se(e,-40)}static int48(e){return Se(e,-48)}static int56(e){return Se(e,-56)}static int64(e){return Se(e,-64)}static int72(e){return Se(e,-72)}static int80(e){return Se(e,-80)}static int88(e){return Se(e,-88)}static int96(e){return Se(e,-96)}static int104(e){return Se(e,-104)}static int112(e){return Se(e,-112)}static int120(e){return Se(e,-120)}static int128(e){return Se(e,-128)}static int136(e){return Se(e,-136)}static int144(e){return Se(e,-144)}static int152(e){return Se(e,-152)}static int160(e){return Se(e,-160)}static int168(e){return Se(e,-168)}static int176(e){return Se(e,-176)}static int184(e){return Se(e,-184)}static int192(e){return Se(e,-192)}static int200(e){return Se(e,-200)}static int208(e){return Se(e,-208)}static int216(e){return Se(e,-216)}static int224(e){return Se(e,-224)}static int232(e){return Se(e,-232)}static int240(e){return Se(e,-240)}static int248(e){return Se(e,-248)}static int256(e){return Se(e,-256)}static int(e){return Se(e,-256)}static bytes1(e){return pt(e,1)}static bytes2(e){return pt(e,2)}static bytes3(e){return pt(e,3)}static bytes4(e){return pt(e,4)}static bytes5(e){return pt(e,5)}static bytes6(e){return pt(e,6)}static bytes7(e){return pt(e,7)}static bytes8(e){return pt(e,8)}static bytes9(e){return pt(e,9)}static bytes10(e){return pt(e,10)}static bytes11(e){return pt(e,11)}static bytes12(e){return pt(e,12)}static bytes13(e){return pt(e,13)}static bytes14(e){return pt(e,14)}static bytes15(e){return pt(e,15)}static bytes16(e){return pt(e,16)}static bytes17(e){return pt(e,17)}static bytes18(e){return pt(e,18)}static bytes19(e){return pt(e,19)}static bytes20(e){return pt(e,20)}static bytes21(e){return pt(e,21)}static bytes22(e){return pt(e,22)}static bytes23(e){return pt(e,23)}static bytes24(e){return pt(e,24)}static bytes25(e){return pt(e,25)}static bytes26(e){return pt(e,26)}static bytes27(e){return pt(e,27)}static bytes28(e){return pt(e,28)}static bytes29(e){return pt(e,29)}static bytes30(e){return pt(e,30)}static bytes31(e){return pt(e,31)}static bytes32(e){return pt(e,32)}static address(e){return new Va(Fa,"address",e)}static bool(e){return new Va(Fa,"bool",!!e)}static bytes(e){return new Va(Fa,"bytes",e)}static string(e){return new Va(Fa,"string",e)}static array(e,t){throw new Error("not implemented yet")}static tuple(e,t){throw new Error("not implemented yet")}static overrides(e){return new Va(Fa,"overrides",Object.assign({},e))}static isTyped(e){return e&&typeof e=="object"&&"_typedSymbol"in e&&e._typedSymbol===GF}static dereference(e,t){if(Va.isTyped(e)){if(e.type!==t)throw new Error(`invalid type: expecetd ${t}, got ${e.type}`);return e.value}return e}};hd=new WeakMap;let Dn=Va;class z$e extends rl{constructor(e){super("address","address",e,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(e,t){let n=Dn.dereference(t,"string");try{n=_t(n)}catch(s){return this._throwError(s.message,t)}return e.writeValue(n)}decode(e){return _t(Ju(e.readValue(),20))}}class V$e extends rl{constructor(t){super(t.name,t.type,"_",t.dynamic);h(this,"coder");this.coder=t}defaultValue(){return this.coder.defaultValue()}encode(t,n){return this.coder.encode(t,n)}decode(t){return this.coder.decode(t)}}function Ete(r,e,t){let n=[];if(Array.isArray(t))n=t;else if(t&&typeof t=="object"){let c={};n=e.map(l=>{const u=l.localName;return se(u,"cannot encode object for signature with missing names","INVALID_ARGUMENT",{argument:"values",info:{coder:l},value:t}),se(!c[u],"cannot encode object for signature with duplicate names","INVALID_ARGUMENT",{argument:"values",info:{coder:l},value:t}),c[u]=!0,t[u]})}else q(!1,"invalid tuple value","tuple",t);q(e.length===n.length,"types/value length mismatch","tuple",t);let s=new WI,i=new WI,o=[];e.forEach((c,l)=>{let u=n[l];if(c.dynamic){let d=i.length;c.encode(i,u);let p=s.writeUpdatableValue();o.push(y=>{p(y+d)})}else c.encode(s,u)}),o.forEach(c=>{c(s.length)});let a=r.appendWriter(s);return a+=r.appendWriter(i),a}function xte(r,e){let t=[],n=[],s=r.subReader(0);return e.forEach(i=>{let o=null;if(i.dynamic){let a=r.readIndex(),c=s.subReader(a);try{o=i.decode(c)}catch(l){if(qr(l,"BUFFER_OVERRUN"))throw l;o=l,o.baseType=i.name,o.name=i.localName,o.type=i.type}}else try{o=i.decode(r)}catch(a){if(qr(a,"BUFFER_OVERRUN"))throw a;o=a,o.baseType=i.name,o.name=i.localName,o.type=i.type}if(o==null)throw new Error("investigate");t.push(o),n.push(i.localName||null)}),D1.fromItems(t,n)}class H$e extends rl{constructor(t,n,s){const i=t.type+"["+(n>=0?n:"")+"]",o=n===-1||t.dynamic;super("array",i,s,o);h(this,"coder");h(this,"length");Me(this,{coder:t,length:n})}defaultValue(){const t=this.coder.defaultValue(),n=[];for(let s=0;s<this.length;s++)n.push(t);return n}encode(t,n){const s=Dn.dereference(n,"array");Array.isArray(s)||this._throwError("expected array value",s);let i=this.length;i===-1&&(i=s.length,t.writeValue(s.length)),Nee(s.length,i,"coder array"+(this.localName?" "+this.localName:""));let o=[];for(let a=0;a<s.length;a++)o.push(this.coder);return Ete(t,o,s)}decode(t){let n=this.length;n===-1&&(n=t.readIndex(),se(n*Kn<=t.dataLength,"insufficient data length","BUFFER_OVERRUN",{buffer:t.bytes,offset:n*Kn,length:t.dataLength}));let s=[];for(let i=0;i<n;i++)s.push(new V$e(this.coder));return xte(t,s)}}class K$e extends rl{constructor(e){super("bool","bool",e,!1)}defaultValue(){return!1}encode(e,t){const n=Dn.dereference(t,"bool");return e.writeValue(n?1:0)}decode(e){return!!e.readValue()}}class Ate extends rl{constructor(e,t){super(e,e,t,!0)}defaultValue(){return"0x"}encode(e,t){t=zn(t);let n=e.writeValue(t.length);return n+=e.writeBytes(t),n}decode(e){return e.readBytes(e.readIndex(),!0)}}class G$e extends Ate{constructor(e){super("bytes",e)}decode(e){return ke(super.decode(e))}}class j$e extends rl{constructor(t,n){let s="bytes"+String(t);super(s,s,n,!1);h(this,"size");Me(this,{size:t},{size:"number"})}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+this.size*2)}encode(t,n){let s=zn(Dn.dereference(n,this.type));return s.length!==this.size&&this._throwError("incorrect data length",n),t.writeBytes(s)}decode(t){return ke(t.readBytes(this.size))}}const q$e=new Uint8Array([]);class W$e extends rl{constructor(e){super("null","",e,!1)}defaultValue(){return null}encode(e,t){return t!=null&&this._throwError("not null",t),e.writeBytes(q$e)}decode(e){return e.readBytes(0),null}}const Q$e=BigInt(0),J$e=BigInt(1),Y$e=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");class X$e extends rl{constructor(t,n,s){const i=(n?"int":"uint")+t*8;super(i,i,s,!1);h(this,"size");h(this,"signed");Me(this,{size:t,signed:n},{size:"number",signed:"boolean"})}defaultValue(){return 0}encode(t,n){let s=Pe(Dn.dereference(n,this.type)),i=g2(Y$e,Kn*8);if(this.signed){let o=g2(i,this.size*8-1);(s>o||s<-(o+J$e))&&this._throwError("value out-of-bounds",n),s=Ree(s,8*Kn)}else(s<Q$e||s>g2(i,this.size*8))&&this._throwError("value out-of-bounds",n);return t.writeValue(s)}decode(t){let n=g2(t.readValue(),this.size*8);return this.signed&&(n=QBe(n,this.size*8)),n}}class Z$e extends Ate{constructor(e){super("string",e)}defaultValue(){return""}encode(e,t){return super.encode(e,Sc(Dn.dereference(t,"string")))}decode(e){return O6(super.decode(e))}}class N3 extends rl{constructor(t,n){let s=!1;const i=[];t.forEach(a=>{a.dynamic&&(s=!0),i.push(a.type)});const o="tuple("+i.join(",")+")";super("tuple",o,n,s);h(this,"coders");Me(this,{coders:Object.freeze(t.slice())})}defaultValue(){const t=[];this.coders.forEach(s=>{t.push(s.defaultValue())});const n=this.coders.reduce((s,i)=>{const o=i.localName;return o&&(s[o]||(s[o]=0),s[o]++),s},{});return this.coders.forEach((s,i)=>{let o=s.localName;!o||n[o]!==1||(o==="length"&&(o="_length"),t[o]==null&&(t[o]=t[i]))}),Object.freeze(t)}encode(t,n){const s=Dn.dereference(n,"tuple");return Ete(t,this.coders,s)}decode(t){return xte(t,this.coders)}}function ff(r){return br(Sc(r))}var eLe="AEEUdwmgDS8BxQKKAP4BOgDjATAAngDUAIMAoABoAOAAagCOAEQAhABMAHIAOwA9ACsANgAmAGIAHgAuACgAJwAXAC0AGgAjAB8ALwAUACkAEgAeAAkAGwARABkAFgA5ACgALQArADcAFQApABAAHgAiABAAGgAeABMAGAUhBe8BFxREN8sF2wC5AK5HAW8ArQkDzQCuhzc3NzcBP68NEfMABQdHBuw5BV8FYAA9MzkI9r4ZBg7QyQAWA9CeOwLNCjcCjqkChuA/lm+RAsXTAoP6ASfnEQDytQFJAjWVCkeXAOsA6godAB/cwdAUE0WlBCN/AQUCQRjFD/MRBjHxDQSJbw0jBzUAswBxme+tnIcAYwabAysG8QAjAEMMmxcDqgPKQyDXCMMxA7kUQwD3NXOrAKmFIAAfBC0D3x4BJQDBGdUFAhEgVD8JnwmQJiNWYUzrg0oAGwAUAB0AFnNcACkAFgBP9h3gPfsDOWDKneY2ChglX1UDYD30ABsAFAAdABZzIGRAnwDD8wAjAEEMzRbDqgMB2sAFYwXqAtCnAsS4AwpUJKRtFHsadUz9AMMVbwLpABM1NJEX0ZkCgYMBEyMAxRVvAukAEzUBUFAtmUwSAy4DBTER33EftQHfSwB5MxJ/AjkWKQLzL8E/cwBB6QH9LQDPDtO9ASNriQC5DQANAwCK21EFI91zHwCoL9kBqQcHBwcHKzUDowBvAQohPvU3fAQgHwCyAc8CKQMA5zMSezr7ULgFmDp/LzVQBgEGAi8FYQVgt8AFcTtlQhpCWEmfe5tmZ6IAExsDzQ8t+X8rBKtTAltbAn0jsy8Bl6utPWMDTR8Ei2kRANkDBrNHNysDBzECQWUAcwFpJ3kAiyUhAJ0BUb8AL3EfAbfNAz81KUsFWwF3YQZtAm0A+VEfAzEJDQBRSQCzAQBlAHsAM70GD/v3IZWHBwARKQAxALsjTwHZAeMPEzmXgIHwABIAGQA8AEUAQDt3gdvIEGcQZAkGTRFMdEIVEwK0D64L7REdDNkq09PgADSxB/MDWwfzA1sDWwfzB/MDWwfzA1sDWwNbA1scEvAi28gQZw9QBHUFlgWTBN4IiyZREYkHMAjaVBV0JhxPA00BBCMtSSQ7mzMTJUpMFE0LCAQ2SmyvfUADTzGzVP2QqgPTMlc5dAkGHnkSqAAyD3skNb1OhnpPcagKU0+2tYdJak5vAsY6sEAACikJm2/Dd1YGRRAfJ6kQ+ww3AbkBPw3xS9wE9QY/BM0fgRkdD9GVoAipLeEM8SbnLqWAXiP5KocF8Uv4POELUVFsD10LaQnnOmeBUgMlAREijwrhDT0IcRD3Cs1vDekRSQc9A9lJngCpBwULFR05FbkmFGKwCw05ewb/GvoLkyazEy17AAXXGiUGUQEtGwMA0y7rhbRaNVwgT2MGBwspI8sUrFAkDSlAu3hMGh8HGSWtApVDdEqLUToelyH6PEENai4XUYAH+TwJGVMLhTyiRq9FEhHWPpE9TCJNTDAEOYMsMyePCdMPiQy9fHYBXQklCbUMdRM1ERs3yQg9Bx0xlygnGQglRplgngT7owP3E9UDDwVDCUUHFwO5HDETMhUtBRGBKNsC9zbZLrcCk1aEARsFzw8pH+MQVEfkDu0InwJpA4cl7wAxFSUAGyKfCEdnAGOP3FMJLs8Iy2pwI3gDaxTrZRF3B5UOWwerHDcVwxzlcMxeD4YMKKezCV8BeQmdAWME5wgNNV+MpCBFZ1eLXBifIGVBQ14AAjUMaRWjRMGHfAKPD28SHwE5AXcHPQ0FAnsR8RFvEJkI74YINbkz/DopBFMhhyAVCisDU2zSCysm/Qz8bQGnEmYDEDRBd/Jnr2C6KBgBBx0yyUFkIfULlk/RDKAaxRhGVDIZ6AfDA/ca9yfuQVsGAwOnBxc6UTPyBMELbQiPCUMATQ6nGwfbGG4KdYzUATWPAbudA1uVhwJzkwY7Bw8Aaw+LBX3pACECqwinAAkA0wNbAD0CsQehAB0AiUUBQQMrMwEl6QKTA5cINc8BmTMB9y0EH8cMGQD7O25OAsO1AoBuZqYF4VwCkgJNOQFRKQQJUktVA7N15QDfAE8GF+NLARmvTs8e50cB43MvAMsA/wAJOQcJRQHRAfdxALsBYws1Caa3uQFR7S0AhwAZbwHbAo0A4QA5AIP1AVcAUQVd/QXXAlNNARU1HC9bZQG/AyMBNwERAH0Gz5GpzQsjBHEH1wIQHxXlAu8yB7kFAyLjE9FCyQK94lkAMhoKPAqrCqpgX2Q3CjV2PVQAEh+sPss/UgVVO1c7XDtXO1w7VztcO1c7XDtXO1wDm8Pmw+YKcF9JYe8Mqg3YRMw6TRPfYFVgNhPMLbsUxRXSJVoZQRrAJwkl6FUNDwgt12Y0CDA0eRfAAEMpbINFY4oeNApPHOtTlVT8LR8AtUumM7MNsBsZREQFS3XxYi4WEgomAmSFAmJGX1GzAV83JAKh+wJonAJmDQKfiDgfDwJmPwJmKgRyBIMDfxcDfpY5Cjl7GzmGOicnAmwhAjI6OA4CbcsCbbLzjgM3a0kvAWsA4gDlAE4JB5wMkQECD8YAEbkCdzMCdqZDAnlPRwJ4viFg30WyRvcCfEMCeswCfQ0CfPRIBEiBZygALxlJXEpfGRtK0ALRBQLQ0EsrA4hTA4fqRMmRNgLypV0HAwOyS9JMMSkH001QTbMCi0MCitzFHwshR2sJuwKOOwKOYESbhQKO3QKOYHxRuFM5AQ5S2FSJApP/ApMQAO0AIFUiVbNV1AosHymZijLleGpFPz0Cl6MC77ZYJawAXSkClpMCloCgAK1ZsFoNhVEAPwKWuQKWUlxIXNUCmc8CmWhczl0LHQKcnznGOqECnBoCn58CnryOACETNS4TAp31Ap6WALlBYThh8wKe1wKgcgGtAp6jIwKeUqljzGQrKS8CJ7MCJoICoP8CoFDbAqYzAqXSAqgDAIECp/ZogGi1AAdNaiBq1QKs5wKssgKtawKtBgJXIQJV4AKx5dsDH1JsmwKywRECsuwbbORtZ21MYwMl0QK2YD9DbpQDKUkCuGICuUsZArkue3A6cOUCvR0DLbYDMhUCvoxyBgMzdQK+HnMmc1MCw88CwwhzhnRPOUl05AM8qwEDPJ4DPcMCxYACxksCxhSNAshtVQLISALJUwLJMgJkoQLd1nh9ZXiyeSlL1AMYp2cGAmH4GfeVKHsPXpZevxUCz28Cz3AzT1fW9xejAMqxAs93AS3uA04Wfk8JAtwrAtuOAtJTA1JgA1NjAQUDVZCAjUMEzxrxZEl5A4LSg5EC2ssC2eKEFIRNp0ADhqkAMwNkEoZ1Xf0AWQLfaQLevHd7AuIz7RgB8zQrAfSfAfLWiwLr9wLpdH0DAur9AuroAP1LAb0C7o0C66CWrpcHAu5DA4XkmH1w5HGlAvMHAG0DjhqZlwL3FwORcgOSiwL3nAL53QL4apogmq+/O5siA52HAv7+AR8APZ8gAZ+3AwWRA6ZuA6bdANXJAwZuoYyiCQ0DDE0BEwEjB3EGZb1rCQC/BG/DFY8etxEAG3k9ACcDNxJRA42DAWcrJQCM8wAlAOanC6OVCLsGI6fJBgCvBRnDBvElRUYFFoAFcD9GSDNCKUK8X3kZX8QAls0FOgCQVCGbwTsuYDoZutcONxjOGJHJ/gVfBWAFXwVgBWsFYAVfBWAFXwVgBV8FYAVfBWBOHQjfjW8KCgoKbF7xMwTRA7kGN8PDAMMEr8MA70gxFroFTj5xPnhCR0K+X30/X/AAWBkzswCNBsxzzASm70aCRS4rDDMeLz49fnXfcsH5GcoscQFz13Y4HwVnBXLJycnACNdRYwgICAqEXoWTxgA7P4kACxbZBu21Kw0AjMsTAwkVAOVtJUUsJ1JCuULESUArXy9gPi9AKwnJRQYKTD9LPoA+iT54PnkCkULEUUpDX9NWV3JVEjQAc1w3A3IBE3YnX+g7QiMJb6MKaiszRCUuQrNCxDPMCcwEX9EWJzYREBEEBwIHKn6l33JCNVIfybPJtAltydPUCmhBZw/tEKsZAJOVJU1CLRuxbUHOQAo7P0s+eEJHHA8SJVRPdGM0NVrpvBoKhfUlM0JHHGUQUhEWO1xLSj8MO0ucNAqJIzVCRxv9EFsqKyA4OQgNj2nwZgp5ZNFgE2A1K3YHS2AhQQojJmC7DgpzGG1WYFUZCQYHZO9gHWCdYIVgu2BTYJlwFh8GvRbcXbG8YgtDHrMBwzPVyQonHQgkCyYBgQJ0Ajc4nVqIAwGSCsBPIgDsK3SWEtIVBa5N8gGjAo+kVwVIZwD/AEUSCDweX4ITrRQsJ8K3TwBXFDwEAB0TvzVcAtoTS20RIwDgVgZ9BBImYgA5AL4Coi8LFnezOkCnIQFjAY4KBAPh9RcGsgZSBsEAJctdsWIRu2kTkQstRw7DAcMBKgpPBGIGMDAwKCYnKTQaLg4AKRSVAFwCdl+YUZ0JdicFD3lPAdt1F9ZZKCGxuE3yBxkFVGcA/wBFEgiCBwAOLHQSjxOtQDg1z7deFRMAZ8QTAGtKb1ApIiPHADkAvgKiLy1DFtYCmBiDAlDDWNB0eo7fpaMO/aEVRRv0ATEQZBIODyMEAc8JQhCbDRgzFD4TAEMAu9YBCgCsAOkAm5I3ABwAYxvONnR+MhXJAxgKQyxL2+kkJhMbhQKDBMkSsvF0AD9BNQ6uQC7WqSQHwxEAEEIu1hkhAH2z4iQPwyJPHNWpdyYBRSpnJALzoBAEVPPsH20MxA0CCEQKRgAFyAtFAlMNwwjEDUQJRArELtapMg7DDZgJIw+TGukEIwvDFkMAqAtDEMMMBhioe+QAO3MMRAACrgnEBSPY9Q0FDnbSBoMAB8MSYxkSxAEJAPIJAAB8FWMOFtMc/HcXwxhDAC7DAvOowwAewwJdKDKHAAHDAALrFUQVwwAbwyvzpWMWv8wA/ABpAy++bcYDUKPD0KhDCwKmJ1MAAmMA5+UZwxAagwipBRL/eADfw6fDGOMCGsOjk3l6BwOpo4sAEsMOGxMAA5sAbcMOAAvDp0MJGkMDwgipnNIPAwfIqUMGAOGDAAPzABXDAAcDAAnDAGmTABrDAA7DChjDjnEWAwABYwAOcwAuUyYABsMAF8MIKQANUgC6wy4AA8MADqMq8wCyYgAcIwAB8wqpAAXOCx0V4wAHowBCwwEKAGnDAAuDAB3DAAjDCakABdIAbqcZ3QCZCCkABdIAAAFDAAfjAB2jCCkABqIACYMAGzMAbSMA5sOIAAhjAAhDABTDBAkpAAbSAOOTAAlDC6kOzPtnAAdDAG6kQFAATwAKwwwAA0MACbUDPwAHIwAZgwACE6cDAAojAApDAAoDp/MGwwAJIwADEwAQQwgAFEMAEXMAD5MADfMADcMAGRMOFiMAFUMAbqMWuwHDAMIAE0MLAGkzEgDhUwACQwAEWgAXgwUjAAbYABjDBSYBgzBaAEFNALcQBxUMegAwMngBrA0IZgJ0KxQHBREPd1N0ZzKRJwaIHAZqNT4DqQq8BwngAB4DAwt2AX56T1ocKQNXAh1GATQGC3tOxYNagkgAMQA5CQADAQEAWxLjAIOYNAEzAH7tFRk6TglSAF8NAAlYAQ+S1ACAQwQorQBiAN4dAJ1wPyeTANVzuQDX3AIeEMp9eyMgXiUAEdkBkJizKltbVVAaRMqRAAEAhyQ/SDEz6BmfVwB6ATEsOClKIRcDOF0E/832AFNt5AByAnkCRxGCOs94NjXdAwINGBonDBwPALW2AwICAgAAAAAAAAYDBQMDARrUAwAtAAAAAgEGBgYGBgYFBQUFBQUEBQYHCAkEBQUFBQQAAAICAAAAIgCNAJAAlT0A6gC7ANwApEQAwgCyAK0AqADuAKYA2gCjAOcBCAEDAMcAgQBiANIA1AEDAN4A8gCQAKkBMQDqAN8A3AsBCQ8yO9ra2tq8xuLT1tRJOB0BUgFcNU0BWgFpAWgBWwFMUUlLbhMBUxsNEAs6PhMOACcUKy0vMj5AQENDQ0RFFEYGJFdXV1dZWVhZL1pbXVxcI2NnZ2ZoZypsbnZ1eHh4eHh4enp6enp6enp6enp8fH18e2IARPIASQCaAHgAMgBm+ACOAFcAVwA3AnbvAIsABfj4AGQAk/IAnwBPAGIAZP//sACFAIUAaQBWALEAJAC2AIMCQAJDAPwA5wD+AP4A6AD/AOkA6QDoAOYALwJ7AVEBQAE+AVQBPgE+AT4BOQE4ATgBOAEcAVgXADEQCAEAUx8SHgsdHhYAjgCWAKYAUQBqIAIxAHYAbwCXAxUDJzIDIUlGTzEAkQJPAMcCVwKkAMAClgKWApYClgKWApYCiwKWApYClgKWApYClgKVApUCmAKgApcClgKWApQClAKUApQCkgKVAnUB1AKXAp8ClgKWApUeAIETBQD+DQOfAmECOh8BVBg9AuIZEjMbAU4/G1WZAXusRAFpYQEFA0FPAQYAmTEeIJdyADFoAHEANgCRA5zMk/C2jGINwjMWygIZCaXdfDILBCs5dAE7YnQBugDlhoiHhoiGiYqKhouOjIaNkI6Ij4qQipGGkoaThpSSlYaWhpeKmIaZhpqGm4aci52QnoqfhuIC4XTpAt90AIp0LHSoAIsAdHQEQwRABEIERQRDBEkERgRBBEcESQRIBEQERgRJAJ5udACrA490ALxuAQ10ANFZdHQA13QCFHQA/mJ0AP4BIQD+APwA/AD9APwDhGZ03ASMK23HAP4A/AD8AP0A/CR0dACRYnQA/gCRASEA/gCRAvQA/gCRA4RmdNwEjCttxyR0AP9idAEhAP4A/gD8APwA/QD8AP8A/AD8AP0A/AOEZnTcBIwrbcckdHQAkWJ0ASEA/gCRAP4AkQL0AP4AkQOEZnTcBIwrbcckdAJLAT50AlIBQXQCU8l0dAJfdHQDpgL0A6YDpgOnA6cDpwOnA4RmdNwEjCttxyR0dACRYnQBIQOmAJEDpgCRAvQDpgCRA4RmdNwEjCttxyR0BDh0AJEEOQCRDpU5dSgCADR03gV2CwArdAEFAM5iCnR0AF1iAAYcOgp0dACRCnQAXAEIwWZ0CnRmdHQAkWZ0CnRmdEXgAFF03gp0dEY0tlT2u3SOAQTwscwhjZZKrhYcBSfFp9XNbKiVDOD2b+cpe4/Z17mQnbtzzhaeQtE2GGj0IDNTjRUSyTxxw/RPHW/+vS7d1NfRt9z9QPZg4X7QFfhCnkvgNPIItOsC2eV6hPannZNHlZ9xrwZXIMOlu3jSoQSq78WEjwLjw1ELSlF1aBvfzwk5ZX7AUvQzjPQKbDuQ+sm4wNOp4A6AdVuRS0t1y/DZpg4R6m7FNjM9HgvW7Bi88zaMjOo6lM8wtBBdj8LP4ylv3zCXPhebMKJc066o9sF71oFW/8JXu86HJbwDID5lzw5GWLR/LhT0Qqnp2JQxNZNfcbLIzPy+YypqRm/lBmGmex+82+PisxUumSeJkALIT6rJezxMH+CTJmQtt5uwTVbL3ptmjDUQzlSIvWi8Tl7ng1NpuRn1Ng4n14Qc+3Iil7OwkvNWogLSPkn3pihIFytyIGmMhOe3n1tWsuMy9BdKyqF4Z3v2SgggTL9KVvMXPnCbRe+oOuFFP3HejBG/w9gvmfNYvg6JuWia2lcSSN1uIjBktzoIazOHPJZ7kKHPz8mRWVdW3lA8WGF9dQF6Bm673boov3BUWDU2JNcahR23GtfHKLOz/viZ+rYnZFaIznXO67CYEJ1fXuTRpZhYZkKe54xeoagkNGLs+NTZHE0rX45/XvQ2RGADX6vcAvdxIUBV27wxGm2zjZo4X3ILgAlrOFheuZ6wtsvaIj4yLY7qqawlliaIcrz2G+c3vscAnCkCuMzMmZvMfu9lLwTvfX+3cVSyPdN9ZwgDZhfjRgNJcLiJ67b9xx8JHswprbiE3v9UphotAPIgnXVIN5KmMc0piXhc6cChPnN+MRhG9adtdttQTTwSIpl8I4/j//d3sz1326qTBTpPRM/Hgh3kzqEXs8ZAk4ErQhNO8hzrQ0DLkWMA/N+91tn2MdOJnWC2FCZehkQrwzwbKOjhvZsbM95QoeL9skYyMf4srVPVJSgg7pOLUtr/n9eT99oe9nLtFRpjA9okV2Kj8h9k5HaC0oivRD8VyXkJ81tcd4fHNXPCfloIQasxsuO18/46dR2jgul/UIet2G0kRvnyONMKhHs6J26FEoqSqd+rfYjeEGwHWVDpX1fh1jBBcKGMqRepju9Y00mDVHC+Xdij/j44rKfvfjGinNs1jO/0F3jB83XCDINN/HB84axlP+3E/klktRo+vl3U/aiyMJbIodE1XSsDn6UAzIoMtUObY2+k/4gY/l+AkZJ5Sj2vQrkyLm3FoxjhDX+31UXBFf9XrAH31fFqoBmDEZvhvvpnZ87N+oZEu7U9O/nnk+QWj3x8uyoRbEnf+O5UMr9i0nHP38IF5AvzrBW8YWBUR0mIAzIvndQq9N3v/Jto3aPjPXUPl8ASdPPyAp7jENf8bk7VMM9ol9XGmlBmeDMuGqt+WzuL6CXAxXjIhCPM5vACchgMJ/8XBGLO/D1isVvGhwwHHr1DLaI5mn2Jr/b1pUD90uciDaS8cXNDzCWvNmT/PhQe5e8nTnnnkt8Ds/SIjibcum/fqDhKopxAY8AkSrPn+IGDEKOO+U3XOP6djFs2H5N9+orhOahiQk5KnEUWa+CzkVzhp8bMHRbg81qhjjXuIKbHjSLSIBKWqockGtKinY+z4/RdBUF6pcc3JmnlxVcNgrI4SEzKUZSwcD2QCyxzKve+gAmg6ZuSRkpPFa6mfThu7LJNu3H5K42uCpNvPAsoedolKV/LHe/eJ+BbaG5MG0NaSGVPRUmNFMFFSSpXEcXwbVh7UETOZZtoVNRGOIbbkig3McEtR68cG0RZAoJevWYo7Dg/lZ1CQzblWeUvVHmr8fY4Nqd9JJiH/zEX24mJviH60fAyFr0A3c4bC1j3yZU60VgJxXn8JgJXLUIsiBnmKmMYz+7yBQFBvqb2eYnuW59joZBf56/wXvWIR4R8wTmV80i1mZy+S4+BUES+hzjk0uXpC///z/IlqHZ1monzlXp8aCfhGKMti73FI1KbL1q6IKO4fuBuZ59gagjn5xU79muMpHXg6S+e+gDM/U9BKLHbl9l6o8czQKl4RUkJJiqftQG2i3BMg/TQlUYFkJDYBOOvAugYuzYSDnZbDDd/aSd9x0Oe6F+bJcHfl9+gp6L5/TgA+BdFFovbfCrQ40s5vMPw8866pNX8zyFGeFWdxIpPVp9Rg1UPOVFbFZrvaFq/YAzHQgqMWpahMYfqHpmwXfHL1/kpYmGuHFwT55mQu0dylfNuq2Oq0hTMCPwqfxnuBIPLXfci4Y1ANy+1CUipQxld/izVh16WyG2Q0CQQ9NqtAnx1HCHwDj7sYxOSB0wopZSnOzxQOcExmxrVTF2BkOthVpGfuhaGECfCJpJKpjnihY+xOT2QJxN61+9K6QSqtv2Shr82I3jgJrqBg0wELFZPjvHpvzTtaJnLK6Vb97Yn933koO/saN7fsjwNKzp4l2lJVx2orjCGzC/4ZL4zCver6aQYtC5sdoychuFE6ufOiog+VWi5UDkbmvmtah/3aArEBIi39s5ILUnlFLgilcGuz9CQshEY7fw2ouoILAYPVT/gyAIq3TFAIwVsl+ktkRz/qGfnCDGrm5gsl/l9QdvCWGsjPz3dU7XuqKfdUrr/6XIgjp4rey6AJBmCmUJMjITHVdFb5m1p+dLMCL8t55zD42cmftmLEJC0Da04YiRCVUBLLa8D071/N5UBNBXDh0LFsmhV/5B5ExOB4j3WVG/S3lfK5o+V6ELHvy6RR9n4ac+VsK4VE4yphPvV+kG9FegTBH4ZRXL2HytUHCduJazB/KykjfetYxOXTLws267aGOd+I+JhKP//+VnXmS90OD/jvLcVu0asyqcuYN1mSb6XTlCkqv1vigZPIYwNF/zpWcT1GR/6aEIRjkh0yhg4LXJfaGobYJTY4JI58KiAKgmmgAKWdl5nYCeLqavRJGQNuYuZtZFGx+IkI4w4NS2xwbetNMunOjBu/hmKCI/w7tfiiyUd//4rbTeWt4izBY8YvGIN6vyKYmP/8X8wHKCeN+WRcKM70+tXKNGyevU9H2Dg5BsljnTf8YbsJ1TmMs74Ce2XlHisleguhyeg44rQOHZuw/6HTkhnnurK2d62q6yS7210SsAIaR+jXMQA+svkrLpsUY+F30Uw89uOdGAR6vo4FIME0EfVVeHTu6eKicfhSqOeXJhbftcd08sWEnNUL1C9fnprTgd83IMut8onVUF0hvqzZfHduPjbjwEXIcoYmy+P6tcJZHmeOv6VrvEdkHDJecjHuHeWANe79VG662qTjA/HCvumVv3qL+LrOcpqGps2ZGwQdFJ7PU4iuyRlBrwfO+xnPyr47s2cXVbWzAyznDiBGjCM3ksxjjqM62GE9C8f5U38kB3VjtabKp/nRdvMESPGDG90bWRLAt1Qk5DyLuazRR1YzdC1c+hZXvAWV8xA72S4A8B67vjVhbba3MMop293FeEXpe7zItMWrJG/LOH9ByOXmYnNJfjmfuX9KbrpgLOba4nZ+fl8Gbdv/ihv+6wFGKHCYrVwmhFC0J3V2bn2tIB1wCc1CST3d3X2OyxhguXcs4sm679UngzofuSeBewMFJboIQHbUh/m2JhW2hG9DIvG2t7yZIzKBTz9wBtnNC+2pCRYhSIuQ1j8xsz5VvqnyUIthvuoyyu7fNIrg/KQUVmGQaqkqZk/Vx5b33/gsEs8yX7SC1J+NV4icz6bvIE7C5G6McBaI8rVg56q5QBJWxn/87Q1sPK4+sQa8fLU5gXo4paaq4cOcQ4wR0VBHPGjKh+UlPCbA1nLXyEUX45qZ8J7/Ln4FPJE2TdzD0Z8MLSNQiykMMmSyOCiFfy84Rq60emYB2vD09KjYwsoIpeDcBDTElBbXxND72yhd9pC/1CMid/5HUMvAL27OtcIJDzNKpRPNqPOpyt2aPGz9QWIs9hQ9LiX5s8m9hjTUu/f7MyIatjjd+tSfQ3ufZxPpmJhTaBtZtKLUcfOCUqADuO+QoH8B9v6U+P0HV1GLQmtoNFTb3s74ivZgjES0qfK+8RdGgBbcCMSy8eBvh98+et1KIFqSe1KQPyXULBMTsIYnysIwiZBJYdI20vseV+wuJkcqGemehKjaAb9L57xZm3g2zX0bZ2xk/fU+bCo7TlnbW7JuF1YdURo/2Gw7VclDG1W7LOtas2LX4upifZ/23rzpsnY/ALfRgrcWP5hYmV9VxVOQA1fZvp9F2UNU+7d7xRyVm5wiLp3/0dlV7vdw1PMiZrbDAYzIVqEjRY2YU03sJhPnlwIPcZUG5ltL6S8XCxU1eYS5cjr34veBmXAvy7yN4ZjArIG0dfD/5UpBNlX1ZPoxJOwyqRi3wQWtOzd4oNKh0LkoTm8cwqgIfKhqqGOhwo71I+zXnMemTv2B2AUzABWyFztGgGULjDDzWYwJUVBTjKCn5K2QGMK1CQT7SzziOjo+BhAmqBjzuc3xYym2eedGeOIRJVyTwDw37iCMe4g5Vbnsb5ZBdxOAnMT7HU4DHpxWGuQ7GeiY30Cpbvzss55+5Km1YsbD5ea3NI9QNYIXol5apgSu9dZ8f8xS5dtHpido5BclDuLWY4lhik0tbJa07yJhH0BOyEut/GRbYTS6RfiTYWGMCkNpfSHi7HvdiTglEVHKZXaVhezH4kkXiIvKopYAlPusftpE4a5IZwvw1x/eLvoDIh/zpo9FiQInsTb2SAkKHV42XYBjpJDg4374XiVb3ws4qM0s9eSQ5HzsMU4OZJKuopFjBM+dAZEl8RUMx5uU2N486Kr141tVsGQfGjORYMCJAMsxELeNT4RmWjRcpdTGBwcx6XN9drWqPmJzcrGrH4+DRc7+n1w3kPZwu0BkNr6hQrqgo7JTB9A5kdJ/H7P4cWBMwsmuixAzJB3yrQpnGIq90lxAXLzDCdn1LPibsRt7rHNjgQBklRgPZ8vTbjXdgXrTWQsK5MdrXXQVPp0Rinq3frzZKJ0qD6Qhc40VzAraUXlob1gvkhK3vpmHgI6FRlQZNx6eRqkp0zy4AQlX813fAPtL3jMRaitGFFjo0zmErloC+h+YYdVQ6k4F/epxAoF0BmqEoKNTt6j4vQZNQ2BoqF9Vj53TOIoNmDiu9Xp15RkIgQIGcoLpfoIbenzpGUAtqFJp5W+LLnx38jHeECTJ/navKY1NWfN0sY1T8/pB8kIH3DU3DX+u6W3YwpypBMYOhbSxGjq84RZ84fWJow8pyHqn4S/9J15EcCMsXqrfwyd9mhiu3+rEo9pPpoJkdZqHjra4NvzFwuThNKy6hao/SlLw3ZADUcUp3w3SRVfW2rhl80zOgTYnKE0Hs2qp1J6H3xqPqIkvUDRMFDYyRbsFI3M9MEyovPk8rlw7/0a81cDVLmBsR2ze2pBuKb23fbeZC0uXoIvDppfTwIDxk1Oq2dGesGc+oJXWJLGkOha3CX+DUnzgAp9HGH9RsPZN63Hn4RMA5eSVhPHO+9RcRb/IOgtW31V1Q5IPGtoxPjC+MEJbVlIMYADd9aHYWUIQKopuPOHmoqSkubnAKnzgKHqgIOfW5RdAgotN6BN+O2ZYHkuemLnvQ8U9THVrS1RtLmKbcC7PeeDsYznvqzeg6VCNwmr0Yyx1wnLjyT84BZz3EJyCptD3yeueAyDWIs0L2qs/VQ3HUyqfrja0V1LdDzqAikeWuV4sc7RLIB69jEIBjCkyZedoUHqCrOvShVzyd73OdrJW0hPOuQv2qOoHDc9xVb6Yu6uq3Xqp2ZaH46A7lzevbxQEmfrzvAYSJuZ4WDk1Hz3QX1LVdiUK0EvlAGAYlG3Md30r7dcPN63yqBCIj25prpvZP0nI4+EgWoFG95V596CurXpKRBGRjQlHCvy5Ib/iW8nZJWwrET3mgd6mEhfP4KCuaLjopWs7h+MdXFdIv8dHQJgg1xi1eYqB0uDYjxwVmri0Sv5XKut/onqapC+FQiC2C1lvYJ9MVco6yDYsS3AANUfMtvtbYI2hfwZatiSsnoUeMZd34GVjkMMKA+XnjJpXgRW2SHTZplVowPmJsvXy6w3cfO1AK2dvtZEKTkC/TY9LFiKHCG0DnrMQdGm2lzlBHM9iEYynH2UcVMhUEjsc0oDBTgo2ZSQ1gzkAHeWeBXYFjYLuuf8yzTCy7/RFR81WDjXMbq2BOH5dURnxo6oivmxL3cKzKInlZkD31nvpHB9Kk7GfcfE1t+1V64b9LtgeJGlpRFxQCAqWJ5DoY77ski8gsOEOr2uywZaoO/NGa0X0y1pNQHBi3b2SUGNpcZxDT7rLbBf1FSnQ8guxGW3W+36BW0gBje4DOz6Ba6SVk0xiKgt+q2JOFyr4SYfnu+Ic1QZYIuwHBrgzr6UvOcSCzPTOo7D6IC4ISeS7zkl4h+2VoeHpnG/uWR3+ysNgPcOIXQbv0n4mr3BwQcdKJxgPSeyuP/z1Jjg4e9nUvoXegqQVIE30EHx5GHv+FAVUNTowYDJgyFhf5IvlYmEqRif6+WN1MkEJmDcQITx9FX23a4mxy1AQRsOHO/+eImX9l8EMJI3oPWzVXxSOeHU1dUWYr2uAA7AMb+vAEZSbU3qob9ibCyXeypEMpZ6863o6QPqlqGHZkuWABSTVNd4cOh9hv3qEpSx2Zy/DJMP6cItEmiBJ5PFqQnDEIt3NrA3COlOSgz43D7gpNFNJ5MBh4oFzhDPiglC2ypsNU4ISywY2erkyb1NC3Qh/IfWj0eDgZI4/ln8WPfBsT3meTjq1Uqt1E7Zl/qftqkx6aM9KueMCekSnMrcHj1CqTWWzEzPsZGcDe3Ue4Ws+XFYVxNbOFF8ezkvQGR6ZOtOLU2lQEnMBStx47vE6Pb7AYMBRj2OOfZXfisjJnpTfSNjo6sZ6qSvNxZNmDeS7Gk3yYyCk1HtKN2UnhMIjOXUzAqDv90lx9O/q/AT1ZMnit5XQe9wmQxnE/WSH0CqZ9/2Hy+Sfmpeg8RwsHI5Z8kC8H293m/LHVVM/BA7HaTJYg5Enk7M/xWpq0192ACfBai2LA/qrCjCr6Dh1BIMzMXINBmX96MJ5Hn2nxln/RXPFhwHxUmSV0EV2V0jm86/dxxuYSU1W7sVkEbN9EzkG0QFwPhyHKyb3t+Fj5WoUUTErcazE/N6EW6Lvp0d//SDPj7EV9UdJN+Amnf3Wwk3A0SlJ9Z00yvXZ7n3z70G47Hfsow8Wq1JXcfwnA+Yxa5mFsgV464KKP4T31wqIgzFPd3eCe3j5ory5fBF2hgCFyVFrLzI9eetNXvM7oQqyFgDo4CTp/hDV9NMX9JDHQ/nyHTLvZLNLF6ftn2OxjGm8+PqOwhxnPHWipkE/8wbtyri80Sr7pMNkQGMfo4ZYK9OcCC4ESVFFbLMIvlxSoRqWie0wxqnLfcLSXMSpMMQEJYDVObYsXIQNv4TGNwjq1kvT1UOkicTrG3IaBZ3XdScS3u8sgeZPVpOLkbiF940FjbCeNRINNvDbd01EPBrTCPpm12m43ze1bBB59Ia6Ovhnur/Nvx3IxwSWol+3H2qfCJR8df6aQf4v6WiONxkK+IqT4pKQrZK/LplgDI/PJZbOep8dtbV7oCr6CgfpWa8NczOkPx81iSHbsNhVSJBOtrLIMrL31LK9TqHqAbAHe0RLmmV806kRLDLNEhUEJfm9u0sxpkL93Zgd6rw+tqBfTMi59xqXHLXSHwSbSBl0EK0+loECOPtrl+/nsaFe197di4yUgoe4jKoAJDXc6DGDjrQOoFDWZJ9HXwt8xDrQP+7aRwWKWI1GF8s8O4KzxWBBcwnl3vnl1Oez3oh6Ea1vjR7/z7DDTrFtqU2W/KAEzAuXDNZ7MY73MF216dzdSbWmUp4lcm7keJfWaMHgut9x5C9mj66Z0lJ+yhsjVvyiWrfk1lzPOTdhG15Y7gQlXtacvI7qv/XNSscDwqkgwHT/gUsD5yB7LdRRvJxQGYINn9hTpodKFVSTPrtGvyQw+HlRFXIkodErAGu9Iy1YpfSPc3jkFh5CX3lPxv7aqjE/JAfTIpEjGb/H7MO0e2vsViSW1qa/Lmi4/n4DEI3g7lYrcanspDfEpKkdV1OjSLOy0BCUqVoECaB55vs06rXl4jqmLsPsFM/7vYJ0vrBhDCm/00A/H81l1uekJ/6Lml3Hb9+NKiLqATJmDpyzfYZFHumEjC662L0Bwkxi7E9U4cQA0XMVDuMYAIeLMPgQaMVOd8fmt5SflFIfuBoszeAw7ow5gXPE2Y/yBc/7jExARUf/BxIHQBF5Sn3i61w4z5xJdCyO1F1X3+3ax+JSvMeZ7S6QSKp1Fp/sjYz6Z+VgCZzibGeEoujryfMulH7Rai5kAft9ebcW50DyJr2uo2z97mTWIu45YsSnNSMrrNUuG1XsYBtD9TDYzQffKB87vWbkM4EbPAFgoBV4GQS+vtFDUqOFAoi1nTtmIOvg38N4hT2Sn8r8clmBCXspBlMBYTnrqFJGBT3wZOzAyJDre9dHH7+x7qaaKDOB4UQALD5ecS0DE4obubQEiuJZ0EpBVpLuYcce8Aa4PYd/V4DLDAJBYKQPCWTcrEaZ5HYbJi11Gd6hjGom1ii18VHYnG28NKpkz2UKVPxlhYSp8uZr367iOmoy7zsxehW9wzcy2zG0a80PBMCRQMb32hnaHeOR8fnNDzZhaNYhkOdDsBUZ3loDMa1YP0uS0cjUP3b/6DBlqmZOeNABDsLl5BI5QJups8uxAuWJdkUB/pO6Zax6tsg7fN5mjjDgMGngO+DPcKqiHIDbFIGudxtPTIyDi9SFMKBDcfdGQRv41q1AqmxgkVfJMnP8w/Bc7N9/TR6C7mGObFqFkIEom8sKi2xYqJLTCHK7cxzaZvqODo22c3wisBCP4HeAgcRbNPAsBkNRhSmD48dHupdBRw4mIvtS5oeF6zeT1KMCyhMnmhpkFAGWnGscoNkwvQ8ZM5lE/vgTHFYL99OuNxdFBxTEDd5v2qLR8y9WkXsWgG6kZNndFG+pO/UAkOCipqIhL3hq7cRSdrCq7YhUsTocEcnaFa6nVkhnSeRYUA1YO0z5itF9Sly3VlxYDw239TJJH6f3EUfYO5lb7bcFcz8Bp7Oo8QmnsUHOz/fagVUBtKEw1iT88j+aKkv8cscKNkMxjYr8344D1kFoZ7/td1W6LCNYN594301tUGRmFjAzeRg5vyoM1F6+bJZ/Q54jN/k8SFd3DxPTYaAUsivsBfgTn7Mx8H2SpPt4GOdYRnEJOH6jHM2p6SgB0gzIRq6fHxGMmSmqaPCmlfwxiuloaVIitLGN8wie2CDWhkzLoCJcODh7KIOAqbHEvXdUxaS4TTTs07Clzj/6GmVs9kiZDerMxEnhUB6QQPlcfqkG9882RqHoLiHGBoHfQuXIsAG8GTAtao2KVwRnvvam8jo1e312GQAKWEa4sUVEAMG4G6ckcONDwRcg1e2D3+ohXgY4UAWF8wHKQMrSnzCgfFpsxh+aHXMGtPQroQasRY4U6UdG0rz1Vjbka0MekOGRZQEvqQFlxseFor8zWFgHek3v29+WqN6gaK5gZOTOMZzpQIC1201LkMCXild3vWXSc5UX9xcFYfbRPzGFa1FDcPfPB/jUEq/FeGt419CI3YmBlVoHsa4KdcwQP5ZSwHHhFJ7/Ph/Rap/4vmG91eDwPP0lDfCDRCLszTqfzM71xpmiKi2HwS4WlqvGNwtvwF5Dqpn6KTq8ax00UMPkxDcZrEEEsIvHiUXXEphdb4GB4FymlPwBz4Gperqq5pW7TQ6/yNRhW8VT5NhuP0udlxo4gILq5ZxAZk8ZGh3g4CqxJlPKY7AQxupfUcVpWT5VItp1+30UqoyP4wWsRo3olRRgkWZZ2ZN6VC3OZFeXB8NbnUrSdikNptD1QiGuKkr8EmSR/AK9Rw+FF3s5uwuPbvHGiPeFOViltMK7AUaOsq9+x9cndk3iJEE5LKZRlWJbKOZweROzmPNVPkjE3K/TyA57Rs68TkZ3MR8akKpm7cFjnjPd/DdkWjgYoKHSr5Wu5ssoBYU4acRs5g2DHxUmdq8VXOXRbunD8QN0LhgkssgahcdoYsNvuXGUK/KXD/7oFb+VGdhqIn02veuM5bLudJOc2Ky0GMaG4W/xWBxIJcL7yliJOXOpx0AkBqUgzlDczmLT4iILXDxxtRR1oZa2JWFgiAb43obrJnG/TZC2KSK2wqOzRZTXavZZFMb1f3bXvVaNaK828w9TO610gk8JNf3gMfETzXXsbcvRGCG9JWQZ6+cDPqc4466Yo2RcKH+PILeKOqtnlbInR3MmBeGG3FH10yzkybuqEC2HSQwpA0An7d9+73BkDUTm30bZmoP/RGbgFN+GrCOfADgqr0WbI1a1okpFms8iHYw9hm0zUvlEMivBRxModrbJJ+9/p3jUdQQ9BCtQdxnOGrT5dzRUmw0593/mbRSdBg0nRvRZM5/E16m7ZHmDEtWhwvfdZCZ8J8M12W0yRMszXamWfQTwIZ4ayYktrnscQuWr8idp3PjT2eF/jmtdhIfcpMnb+IfZY2FebW6UY/AK3jP4u3Tu4zE4qlnQgLFbM19EBIsNf7KhjdbqQ/D6yiDb+NlEi2SKD+ivXVUK8ib0oBo366gXkR8ZxGjpJIDcEgZPa9TcYe0TIbiPl/rPUQDu3XBJ9X/GNq3FAUsKsll57DzaGMrjcT+gctp+9MLYXCq+sqP81eVQ0r9lt+gcQfZbACRbEjvlMskztZG8gbC8Qn9tt26Q7y7nDrbZq/LEz7kR6Jc6pg3N9rVX8Y5MJrGlML9p9lU4jbTkKqCveeZUJjHB03m2KRKR2TytoFkTXOLg7keU1s1lrPMQJpoOKLuAAC+y1HlJucU6ysB5hsXhvSPPLq5J7JtnqHKZ4vYjC4Vy8153QY+6780xDuGARsGbOs1WqzH0QS765rnSKEbbKlkO8oI/VDwUd0is13tKpqILu1mDJFNy/iJAWcvDgjxvusIT+PGz3ST/J9r9Mtfd0jpaGeiLYIqXc7DiHSS8TcjFVksi66PEkxW1z6ujbLLUGNNYnzOWpH8BZGK4bCK7iR+MbIv8ncDAz1u4StN3vTTzewr9IQjk9wxFxn+6N1ddKs0vffJiS08N3a4G1SVrlZ97Q/M+8G9fe5AP6d9/Qq4WRnORVhofPIKEdCr3llspUfE0oKIIYoByBRPh+bX1HLS3JWGJRhIvE1aW4NTd8ePi4Z+kXb+Z8snYfSNcqijhAgVsx4RCM54cXUiYkjeBmmC4ajOHrChoELscJJC7+9jjMjw5BagZKlgRMiSNYz7h7vvZIoQqbtQmspc0cUk1G/73iXtSpROl5wtLgQi0mW2Ex8i3WULhcggx6E1LMVHUsdc9GHI1PH3U2Ko0PyGdn9KdVOLm7FPBui0i9a0HpA60MsewVE4z8CAt5d401Gv6zXlIT5Ybit1VIA0FCs7wtvYreru1fUyW3oLAZ/+aTnZrOcYRNVA8spoRtlRoWflsRClFcgzkqiHOrf0/SVw+EpVaFlJ0g4Kxq1MMOmiQdpMNpte8lMMQqm6cIFXlnGbfJllysKDi+0JJMotkqgIxOSQgU9dn/lWkeVf8nUm3iwX2Nl3WDw9i6AUK3vBAbZZrcJpDQ/N64AVwjT07Jef30GSSmtNu2WlW7YoyW2FlWfZFQUwk867EdLYKk9VG6JgEnBiBxkY7LMo4YLQJJlAo9l/oTvJkSARDF/XtyAzM8O2t3eT/iXa6wDN3WewNmQHdPfsxChU/KtLG2Mn8i4ZqKdSlIaBZadxJmRzVS/o4yA65RTSViq60oa395Lqw0pzY4SipwE0SXXsKV+GZraGSkr/RW08wPRvqvSUkYBMA9lPx4m24az+IHmCbXA+0faxTRE9wuGeO06DIXa6QlKJ3puIyiuAVfPr736vzo2pBirS+Vxel3TMm3JKhz9o2ZoRvaFVpIkykb0Hcm4oHFBMcNSNj7/4GJt43ogonY2Vg4nsDQIWxAcorpXACzgBqQPjYsE/VUpXpwNManEru4NwMCFPkXvMoqvoeLN3qyu/N1eWEHttMD65v19l/0kH2mR35iv/FI+yjoHJ9gPMz67af3Mq/BoWXqu3rphiWMXVkmnPSEkpGpUI2h1MThideGFEOK6YZHPwYzMBvpNC7+ZHxPb7epfefGyIB4JzO9DTNEYnDLVVHdQyvOEVefrk6Uv5kTQYVYWWdqrdcIl7yljwwIWdfQ/y+2QB3eR/qxYObuYyB4gTbo2in4PzarU1sO9nETkmj9/AoxDA+JM3GMqQtJR4jtduHtnoCLxd1gQUscHRB/MoRYIEsP2pDZ9KvHgtlk1iTbWWbHhohwFEYX7y51fUV2nuUmnoUcqnWIQAAgl9LTVX+Bc0QGNEhChxHR4YjfE51PUdGfsSFE6ck7BL3/hTf9jLq4G1IafINxOLKeAtO7quulYvH5YOBc+zX7CrMgWnW47/jfRsWnJjYYoE7xMfWV2HN2iyIqLI";const jF=new Map([[8217,"apostrophe"],[8260,"fraction slash"],[12539,"middle dot"]]),qF=4;function tLe(r){let e=0;function t(){return r[e++]<<8|r[e++]}let n=t(),s=1,i=[0,1];for(let S=1;S<n;S++)i.push(s+=t());let o=t(),a=e;e+=o;let c=0,l=0;function u(){return c==0&&(l=l<<8|r[e++],c=8),l>>--c&1}const d=31,p=2**d,y=p>>>1,f=y>>1,g=p-1;let w=0;for(let S=0;S<d;S++)w=w<<1|u();let m=[],b=0,v=p;for(;;){let S=Math.floor(((w-b+1)*s-1)/v),I=0,x=n;for(;x-I>1;){let L=I+x>>>1;S<i[L]?x=L:I=L}if(I==0)break;m.push(I);let C=b+Math.floor(v*i[I]/s),P=b+Math.floor(v*i[I+1]/s)-1;for(;!((C^P)&y);)w=w<<1&g|u(),C=C<<1&g,P=P<<1&g|1;for(;C&~P&f;)w=w&y|w<<1&g>>>1|u(),C=C<<1^y,P=(P^y)<<1|y|1;b=C,v=1+P-C}let E=n-4;return m.map(S=>{switch(S-E){case 3:return E+65792+(r[a++]<<16|r[a++]<<8|r[a++]);case 2:return E+256+(r[a++]<<8|r[a++]);case 1:return E+r[a++];default:return S-1}})}function rLe(r){let e=0;return()=>r[e++]}function Ste(r){return rLe(tLe(nLe(r)))}function nLe(r){let e=[];[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"].forEach((s,i)=>e[s.charCodeAt(0)]=i);let t=r.length,n=new Uint8Array(6*t>>3);for(let s=0,i=0,o=0,a=0;s<t;s++)a=a<<6|e[r.charCodeAt(s)],o+=6,o>=8&&(n[i++]=a>>(o-=8));return n}function sLe(r){return r&1?~r>>1:r>>1}function iLe(r,e){let t=Array(r);for(let n=0,s=0;n<r;n++)t[n]=s+=sLe(e());return t}function Qy(r,e=0){let t=[];for(;;){let n=r(),s=r();if(!s)break;e+=n;for(let i=0;i<s;i++)t.push(e+i);e+=s+1}return t}function Cte(r){return Jy(()=>{let e=Qy(r);if(e.length)return e})}function Ite(r){let e=[];for(;;){let t=r();if(t==0)break;e.push(oLe(t,r))}for(;;){let t=r()-1;if(t<0)break;e.push(aLe(t,r))}return e.flat()}function Jy(r){let e=[];for(;;){let t=r(e.length);if(!t)break;e.push(t)}return e}function kte(r,e,t){let n=Array(r).fill().map(()=>[]);for(let s=0;s<e;s++)iLe(r,t).forEach((i,o)=>n[o].push(i));return n}function oLe(r,e){let t=1+e(),n=e(),s=Jy(e);return kte(s.length,1+r,e).flatMap((o,a)=>{let[c,...l]=o;return Array(s[a]).fill().map((u,d)=>{let p=d*n;return[c+d*t,l.map(y=>y+p)]})})}function aLe(r,e){let t=1+e();return kte(t,1+r,e).map(s=>[s[0],s.slice(1)])}function cLe(r){let e=[],t=Qy(r);return s(n([]),[]),e;function n(i){let o=r(),a=Jy(()=>{let c=Qy(r).map(l=>t[l]);if(c.length)return n(c)});return{S:o,B:a,Q:i}}function s({S:i,B:o},a,c){if(!(i&4&&c===a[a.length-1])){i&2&&(c=a[a.length-1]),i&1&&e.push(a);for(let l of o)for(let u of l.Q)s(l,[...a,u],c)}}}function lLe(r){return r.toString(16).toUpperCase().padStart(2,"0")}function Tte(r){return`{${lLe(r)}}`}function uLe(r){let e=[];for(let t=0,n=r.length;t<n;){let s=r.codePointAt(t);t+=s<65536?1:2,e.push(s)}return e}function $1(r){let t=r.length;if(t<4096)return String.fromCodePoint(...r);let n=[];for(let s=0;s<t;)n.push(String.fromCodePoint(...r.slice(s,s+=4096)));return n.join("")}function hLe(r,e){let t=r.length,n=t-e.length;for(let s=0;n==0&&s<t;s++)n=r[s]-e[s];return n}var dLe="AEUDTAHBCFQATQDRADAAcgAgADQAFAAsABQAHwAOACQADQARAAoAFwAHABIACAAPAAUACwAFAAwABAAQAAMABwAEAAoABQAIAAIACgABAAQAFAALAAIACwABAAIAAQAHAAMAAwAEAAsADAAMAAwACgANAA0AAwAKAAkABAAdAAYAZwDSAdsDJgC0CkMB8xhZAqfoC190UGcThgBurwf7PT09Pb09AjgJum8OjDllxHYUKXAPxzq6tABAxgK8ysUvWAgMPT09PT09PSs6LT2HcgWXWwFLoSMEEEl5RFVMKvO0XQ8ExDdJMnIgsj26PTQyy8FfEQ8AY8IPAGcEbwRwBHEEcgRzBHQEdQR2BHcEeAR6BHsEfAR+BIAEgfndBQoBYgULAWIFDAFiBNcE2ATZBRAFEQUvBdALFAsVDPcNBw13DYcOMA4xDjMB4BllHI0B2grbAMDpHLkQ7QHVAPRNQQFnGRUEg0yEB2uaJF8AJpIBpob5AERSMAKNoAXqaQLUBMCzEiACnwRZEkkVsS7tANAsBG0RuAQLEPABv9HICTUBXigPZwRBApMDOwAamhtaABqEAY8KvKx3LQ4ArAB8UhwEBAVSagD8AEFZADkBIadVj2UMUgx5Il4ANQC9AxIB1BlbEPMAs30CGxlXAhwZKQIECBc6EbsCoxngzv7UzRQA8M0BawL6ZwkN7wABAD33OQRcsgLJCjMCjqUChtw/km+NAsXPAoP2BT84PwURAK0RAvptb6cApQS/OMMey5HJS84UdxpxTPkCogVFITaTOwERAK5pAvkNBOVyA7q3BKlOJSALAgUIBRcEdASpBXqzABXFSWZOawLCOqw//AolCZdvv3dSBkEQGyelEPcMMwG1ATsN7UvYBPEGOwTJH30ZGQ/NlZwIpS3dDO0m4y6hgFoj9SqDBe1L9DzdC01RaA9ZC2UJ4zpjgU4DIQENIosK3Q05CG0Q8wrJaw3lEUUHOQPVSZoApQcBCxEdNRW1JhBirAsJOXcG+xr2C48mrxMpevwF0xohBk0BKRr/AM8u54WwWjFcHE9fBgMLJSPHFKhQIA0lQLd4SBobBxUlqQKRQ3BKh1E2HpMh9jw9DWYuE1F8B/U8BRlPC4E8nkarRQ4R0j6NPUgiSUwsBDV/LC8niwnPD4UMuXxyAVkJIQmxDHETMREXN8UIOQcZLZckJxUIIUaVYJoE958D8xPRAwsFPwlBBxMDtRwtEy4VKQUNgSTXAvM21S6zAo9WgAEXBcsPJR/fEFBH4A7pCJsCZQODJesALRUhABcimwhDYwBfj9hTBS7LCMdqbCN0A2cU52ERcweRDlcHpxwzFb8c4XDIXguGCCijrwlbAXUJmQFfBOMICTVbjKAgQWdTi1gYmyBhQT9d/AIxDGUVn0S9h3gCiw9rEhsBNQFzBzkNAQJ3Ee0RaxCVCOuGBDW1M/g6JQRPIYMgEQonA09szgsnJvkM+GkBoxJiAww0PXfuZ6tgtiQX/QcZMsVBYCHxC5JPzQycGsEYQlQuGeQHvwPzGvMn6kFXBf8DowMTOk0z7gS9C2kIiwk/AEkOoxcH1xhqCnGM0AExiwG3mQNXkYMCb48GNwcLAGcLhwV55QAdAqcIowAFAM8DVwA5Aq0HnQAZAIVBAT0DJy8BIeUCjwOTCDHLAZUvAfMpBBvDDBUA9zduSgLDsQKAamaiBd1YAo4CSTUBTSUEBU5HUQOvceEA2wBLBhPfRwEVq0rLGuNDAd9vKwDHAPsABTUHBUEBzQHzbQC3AV8LMQmis7UBTekpAIMAFWsB1wKJAN0ANQB/8QFTAE0FWfkF0wJPSQERMRgrV2EBuwMfATMBDQB5BsuNpckHHwRtB9MCEBsV4QLvLge1AQMi3xPNQsUCvd5VoWACZIECYkJbTa9bNyACofcCaJgCZgkCn4Q4GwsCZjsCZiYEbgR/A38TA36SOQY5dxc5gjojIwJsHQIyNjgKAm3HAm2u74ozZ0UrAWcA3gDhAEoFB5gMjQD+C8IADbUCdy8CdqI/AnlLQwJ4uh1c20WuRtcCfD8CesgCfQkCfPAFWQUgSABIfWMkAoFtAoAAAoAFAn+uSVhKWxUXSswC0QEC0MxLJwOITwOH5kTFkTIC8qFdAwMDrkvOTC0lA89NTE2vAos/AorYwRsHHUNnBbcCjjcCjlxAl4ECjtkCjlx4UbRTNQpS1FSFApP7ApMMAOkAHFUeVa9V0AYsGymVhjLheGZFOzkCl58C77JYIagAWSUClo8ClnycAKlZrFoJgU0AOwKWtQKWTlxEXNECmcsCmWRcyl0HGQKcmznCOp0CnBYCn5sCnriKAB0PMSoPAp3xAp6SALU9YTRh7wKe0wKgbgGpAp6fHwKeTqVjyGQnJSsCJ68CJn4CoPsCoEwCot0CocQCpi8Cpc4Cp/8AfQKn8mh8aLEAA0lqHGrRAqzjAqyuAq1nAq0CAlcdAlXcArHh1wMfTmyXArK9DQKy6Bds4G1jbUhfAyXNArZcOz9ukAMpRQK4XgK5RxUCuSp3cDZw4QK9GQK72nCWAzIRAr6IcgIDM3ECvhpzInNPAsPLAsMEc4J0SzVFdOADPKcDPJoDPb8CxXwCxkcCxhCJAshpUQLIRALJTwLJLgJknQLd0nh5YXiueSVL0AMYo2cCAmH0GfOVJHsLXpJeuxECz2sCz2wvS1PS8xOfAMatAs9zASnqA04SfksFAtwnAtuKAtJPA1JcA1NfAQEDVYyAiT8AyxbtYEWCHILTgs6DjQLaxwLZ3oQQhEmnPAOGpQAvA2QOhnFZ+QBVAt9lAt64c3cC4i/tFAHzMCcB9JsB8tKHAuvzAulweQLq+QLq5AD5RwG5Au6JAuuclqqXAwLuPwOF4Jh5cOBxoQLzAwBpA44WmZMC9xMDkW4DkocC95gC+dkC+GaaHJqruzebHgOdgwL++gEbADmfHJ+zAwWNA6ZqA6bZANHFAwZqoYiiBQkDDEkCwAA/AwDhQRdTARHzA2sHl2cFAJMtK7evvdsBiZkUfxEEOQH7KQUhDp0JnwCS/SlXxQL3AZ0AtwW5AG8LbUEuFCaNLgFDAYD8AbUmAHUDDgRtACwCFgyhAAAKAj0CagPdA34EkQEgRQUhfAoABQBEABMANhICdwEABdUDa+8KxQIA9wqfJ7+xt+UBkSFBQgHpFH8RNMCJAAQAGwBaAkUChIsABjpTOpSNbQC4Oo860ACNOME63AClAOgAywE6gTo7Ofw5+Tt2iTpbO56JOm85GAFWATMBbAUvNV01njWtNWY1dTW2NcU1gjWRNdI14TWeNa017jX9NbI1wTYCNhE1xjXVNhY2JzXeNe02LjY9Ni41LSE2OjY9Njw2yTcIBJA8VzY4Nt03IDcPNsogN4k3MAoEsDxnNiQ3GTdsOo03IULUQwdC4EMLHA8PCZsobShRVQYA6X8A6bABFCnXAukBowC9BbcAbwNzBL8MDAMMAQgDAAkKCwsLCQoGBAVVBI/DvwDz9b29kaUCb0QtsRTNLt4eGBcSHAMZFhYZEhYEARAEBUEcQRxBHEEcQRxBHEEaQRxBHEFCSTxBPElISUhBNkM2QTYbNklISVmBVIgBFLWZAu0BhQCjBcEAbykBvwGJAaQcEZ0ePCklMAAhMvAIMAL54gC7Bm8EescjzQMpARQpKgDUABavAj626xQAJP0A3etzuf4NNRA7efy2Z9NQrCnC0OSyANz5BBIbJ5IFDR6miIavYS6tprjjmuKebxm5C74Q225X1pkaYYPb6f1DK4k3xMEBb9S2WMjEibTNWhsRJIA+vwNVEiXTE5iXs/wezV66oFLfp9NZGYW+Gk19J2+bCT6Ye2w6LDYdgzKMUabk595eLBCXANz9HUpWbATq9vqXVx9XDg+Pc9Xp4+bsS005SVM/BJBM4687WUuf+Uj9dEi8aDNaPxtpbDxcG1THTImUMZq4UCaaNYpsVqraNyKLJXDYsFZ/5jl7bLRtO88t7P3xZaAxhb5OdPMXqsSkp1WCieG8jXm1U99+blvLlXzPCS+M93VnJCiK+09LfaSaBAVBomyDgJua8dfUzR7ga34IvR2Nvj+A9heJ6lsl1KG4NkI1032Cnff1m1wof2B9oHJK4bi6JkEdSqeNeiuo6QoZZincoc73/TH9SXF8sCE7XyuYyW8WSgbGFCjPV0ihLKhdPs08Tx82fYAkLLc4I2wdl4apY7GU5lHRFzRWJep7Ww3wbeA3qmd59/86P4xuNaqDpygXt6M85glSBHOCGgJDnt+pN9bK7HApMguX6+06RZNjzVmcZJ+wcUrJ9//bpRNxNuKpNl9uFds+S9tdx7LaM5ZkIrPj6nIU9mnbFtVbs9s/uLgl8MVczAwet+iOEzzBlYW7RCMgE6gyNLeq6+1tIx4dpgZnd0DksJS5f+JNDpwwcPNXaaVspq1fbQajOrJgK0ofKtJ1Ne90L6VO4MOl5S886p7u6xo7OLjG8TGL+HU1JXGJgppg4nNbNJ5nlzSpuPYy21JUEcUA94PoFiZfjZue+QnyQ80ekOuZVkxx4g+cvhJfHgNl4hy1/a6+RKcKlar/J29y//EztlbVPHVUeQ1zX86eQVAjR/M3dA9w4W8LfaXp4EgM85wOWasli837PzVMOnsLzR+k3o75/lRPAJSE1xAKQzEi5v10ke+VBvRt1cwQRMd+U5mLCTGVd6XiZtgBG5cDi0w22GKcVNvHiu5LQbZEDVtz0onn7k5+heuKXVsZtSzilkLRAUmjMXEMB3J9YC50XBxPiz53SC+EhnPl9WsKCv92SM/OFFIMJZYfl0WW8tIO3UxYcwdMAj7FSmgrsZ2aAZO03BOhP1bNNZItyXYQFTpC3SG1VuPDqH9GkiCDmE+JwxyIVSO5siDErAOpEXFgjy6PQtOVDj+s6e1r8heWVvmZnTciuf4EiNZzCAd7SOMhXERIOlsHIMG399i9aLTy3m2hRLZjJVDNLS53iGIK11dPqQt0zBDyg6qc7YqkDm2M5Ve6dCWCaCbTXX2rToaIgz6+zh4lYUi/+6nqcFMAkQJKHYLK0wYk5N9szV6xihDbDDFr45lN1K4aCXBq/FitPSud9gLt5ZVn+ZqGX7cwm2z5EGMgfFpIFyhGGuDPmso6TItTMwny+7uPnLCf4W6goFQFV0oQSsc9VfMmVLcLr6ZetDZbaSFTLqnSO/bIPjA3/zAUoqgGFAEQS4IhuMzEp2I3jJzbzkk/IEmyax+rhZTwd6f+CGtwPixu8IvzACquPWPREu9ZvGkUzpRwvRRuaNN6cr0W1wWits9ICdYJ7ltbgMiSL3sTPeufgNcVqMVWFkCPDH4jG2jA0XcVgQj62Cb29v9f/z/+2KbYvIv/zzjpQAPkliaVDzNrW57TZ/ZOyZD0nlfMmAIBIAGAI0D3k/mdN4xr9v85ZbZbbqfH2jGd5hUqNZWwl5SPfoGmfElmazUIeNL1j/mkF7VNAzTq4jNt8JoQ11NQOcmhprXoxSxfRGJ9LDEOAQ+dmxAQH90iti9e2u/MoeuaGcDTHoC+xsmEeWmxEKefQuIzHbpw5Tc5cEocboAD09oipWQhtTO1wivf/O+DRe2rpl/E9wlrzBorjJsOeG1B/XPW4EaJEFdNlECEZga5ZoGRHXgYouGRuVkm8tDESiEyFNo+3s5M5puSdTyUL2llnINVHEt91XUNW4ewdMgJ4boJfEyt/iY5WXqbA+A2Fkt5Z0lutiWhe9nZIyIUjyXDC3UsaG1t+eNx6z4W/OYoTB7A6x+dNSTOi9AInctbESqm5gvOLww7OWXPrmHwVZasrl4eD113pm+JtT7JVOvnCXqdzzdTRHgJ0PiGTFYW5Gvt9R9LD6Lzfs0v/TZZHSmyVNq7viIHE6DBK7Qp07Iz55EM8SYtQvZf/obBniTWi5C2/ovHfw4VndkE5XYdjOhCMRjDeOEfXeN/CwfGduiUIfsoFeUxXeQXba7c7972XNv8w+dTjjUM0QeNAReW+J014dKAD/McQYXT7c0GQPIkn3Ll6R7gGjuiQoZD0TEeEqQpKoZ15g/0OPQI17QiSv9AUROa/V/TQN3dvLArec3RrsYlvBm1b8LWzltdugsC50lNKYLEp2a+ZZYqPejULRlOJh5zj/LVMyTDvwKhMxxwuDkxJ1QpoNI0OTWLom4Z71SNzI9TV1iXJrIu9Wcnd+MCaAw8o1jSXd94YU/1gnkrC9BUEOtQvEIQ7g0i6h+KL2JKk8Ydl7HruvgWMSAmNe+LshGhV4qnWHhO9/RIPQzY1tHRj2VqOyNsDpK0cww+56AdDC4gsWwY0XxoucIWIqs/GcwnWqlaT0KPr8mbK5U94/301i1WLt4YINTVvCFBrFZbIbY8eycOdeJ2teD5IfPLCRg7jjcFTwlMFNl9zdh/o3E/hHPwj7BWg0MU09pPrBLbrCgm54A6H+I6v27+jL5gkjWg/iYdks9jbfVP5y/n0dlgWEMlKasl7JvFZd56LfybW1eeaVO0gxTfXZwD8G4SI116yx7UKVRgui6Ya1YpixqXeNLc8IxtAwCU5IhwQgn+NqHnRaDv61CxKhOq4pOX7M6pkA+Pmpd4j1vn6ACUALoLLc4vpXci8VidLxzm7qFBe7s+quuJs6ETYmnpgS3LwSZxPIltgBDXz8M1k/W2ySNv2f9/NPhxLGK2D21dkHeSGmenRT3Yqcdl0m/h3OYr8V+lXNYGf8aCCpd4bWjE4QIPj7vUKN4Nrfs7ML6Y2OyS830JCnofg/k7lpFpt4SqZc5HGg1HCOrHvOdC8bP6FGDbE/VV0mX4IakzbdS/op+Kt3G24/8QbBV7y86sGSQ/vZzU8FXs7u6jIvwchsEP2BpIhW3G8uWNwa3HmjfH/ZjhhCWvluAcF+nMf14ClKg5hGgtPLJ98ueNAkc5Hs2WZlk2QHvfreCK1CCGO6nMZVSb99VM/ajr8WHTte9JSmkXq/i/U943HEbdzW6Re/S88dKgg8pGOLlAeNiqrcLkUR3/aClFpMXcOUP3rmETcWSfMXZE3TUOi8i+fqRnTYLflVx/Vb/6GJ7eIRZUA6k3RYR3iFSK9c4iDdNwJuZL2FKz/IK5VimcNWEqdXjSoxSgmF0UPlDoUlNrPcM7ftmA8Y9gKiqKEHuWN+AZRIwtVSxye2Kf8rM3lhJ5XcBXU9n4v0Oy1RU2M+4qM8AQPVwse8ErNSob5oFPWxuqZnVzo1qB/IBxkM3EVUKFUUlO3e51259GgNcJbCmlvrdjtoTW7rChm1wyCKzpCTwozUUEOIcWLneRLgMXh+SjGSFkAllzbGS5HK7LlfCMRNRDSvbQPjcXaenNYxCvu2Qyznz6StuxVj66SgI0T8B6/sfHAJYZaZ78thjOSIFumNWLQbeZixDCCC+v0YBtkxiBB3jefHqZ/dFHU+crbj6OvS1x/JDD7vlm7zOVPwpUC01nhxZuY/63E7g";const Yy=44032,B6=4352,M6=4449,$6=4519,_te=19,Pte=21,L1=28,L6=Pte*L1,fLe=_te*L6,pLe=Yy+fLe,gLe=B6+_te,yLe=M6+Pte,mLe=$6+L1;function m2(r){return r>>24&255}function Nte(r){return r&16777215}let rk,WF,nk,_4;function wLe(){let r=Ste(dLe);rk=new Map(Cte(r).flatMap((e,t)=>e.map(n=>[n,t+1<<24]))),WF=new Set(Qy(r)),nk=new Map,_4=new Map;for(let[e,t]of Ite(r)){if(!WF.has(e)&&t.length==2){let[n,s]=t,i=_4.get(n);i||(i=new Map,_4.set(n,i)),i.set(s,e)}nk.set(e,t.reverse())}}function Dte(r){return r>=Yy&&r<pLe}function bLe(r,e){if(r>=B6&&r<gLe&&e>=M6&&e<yLe)return Yy+(r-B6)*L6+(e-M6)*L1;if(Dte(r)&&e>$6&&e<mLe&&(r-Yy)%L1==0)return r+(e-$6);{let t=_4.get(r);return t&&(t=t.get(e),t)?t:-1}}function Ote(r){rk||wLe();let e=[],t=[],n=!1;function s(i){let o=rk.get(i);o&&(n=!0,i|=o),e.push(i)}for(let i of r)for(;;){if(i<128)e.push(i);else if(Dte(i)){let o=i-Yy,a=o/L6|0,c=o%L6/L1|0,l=o%L1;s(B6+a),s(M6+c),l>0&&s($6+l)}else{let o=nk.get(i);o?t.push(...o):s(i)}if(!t.length)break;i=t.pop()}if(n&&e.length>1){let i=m2(e[0]);for(let o=1;o<e.length;o++){let a=m2(e[o]);if(a==0||i<=a){i=a;continue}let c=o-1;for(;;){let l=e[c+1];if(e[c+1]=e[c],e[c]=l,!c||(i=m2(e[--c]),i<=a))break}i=m2(e[o])}}return e}function vLe(r){let e=[],t=[],n=-1,s=0;for(let i of r){let o=m2(i),a=Nte(i);if(n==-1)o==0?n=a:e.push(a);else if(s>0&&s>=o)o==0?(e.push(n,...t),t.length=0,n=a):t.push(a),s=o;else{let c=bLe(n,a);c>=0?n=c:s==0&&o==0?(e.push(n),n=a):(t.push(a),s=o)}}return n>=0&&e.push(n,...t),e}function Rte(r){return Ote(r).map(Nte)}function ELe(r){return vLe(Ote(r))}const QF=45,Bte=".",Mte=65039,$te=1,U6=r=>Array.from(r);function Xy(r,e){return r.P.has(e)||r.Q.has(e)}class xLe extends Array{get is_emoji(){return!0}}let sk,Lte,Jh,ik,Ute,Gp,sx,rp,Th,JF,ok;function FN(){if(sk)return;let r=Ste(eLe);const e=()=>Qy(r),t=()=>new Set(e()),n=(u,d)=>d.forEach(p=>u.add(p));sk=new Map(Ite(r)),Lte=t(),Jh=e(),ik=new Set(e().map(u=>Jh[u])),Jh=new Set(Jh),Ute=t(),t();let s=Cte(r),i=r();const o=()=>{let u=new Set;return e().forEach(d=>n(u,s[d])),n(u,e()),u};Gp=Jy(u=>{let d=Jy(r).map(p=>p+96);if(d.length){let p=u>=i;d[0]-=32,d=$1(d),p&&(d=`Restricted[${d}]`);let y=o(),f=o(),g=!r();return{N:d,P:y,Q:f,M:g,R:p}}}),sx=t(),rp=new Map;let a=e().concat(U6(sx)).sort((u,d)=>u-d);a.forEach((u,d)=>{let p=r(),y=a[d]=p?a[d-p]:{V:[],M:new Map};y.V.push(u),sx.has(u)||rp.set(u,y)});for(let{V:u,M:d}of new Set(rp.values())){let p=[];for(let f of u){let g=Gp.filter(m=>Xy(m,f)),w=p.find(({G:m})=>g.some(b=>m.has(b)));w||(w={G:new Set,V:[]},p.push(w)),w.V.push(f),n(w.G,g)}let y=p.flatMap(f=>U6(f.G));for(let{G:f,V:g}of p){let w=new Set(y.filter(m=>!f.has(m)));for(let m of g)d.set(m,w)}}Th=new Set;let c=new Set;const l=u=>Th.has(u)?c.add(u):Th.add(u);for(let u of Gp){for(let d of u.P)l(d);for(let d of u.Q)l(d)}for(let u of Th)!rp.has(u)&&!c.has(u)&&rp.set(u,$te);n(Th,Rte(Th)),JF=cLe(r).map(u=>xLe.from(u)).sort(hLe),ok=new Map;for(let u of JF){let d=[ok];for(let p of u){let y=d.map(f=>{let g=f.get(p);return g||(g=new Map,f.set(p,g)),g});p===Mte?d.push(...y):d=y}for(let p of d)p.V=u}}function zN(r){return(Fte(r)?"":`${VN(O7([r]))} `)+Tte(r)}function VN(r){return`"${r}"`}function ALe(r){if(r.length>=4&&r[2]==QF&&r[3]==QF)throw new Error(`invalid label extension: "${$1(r.slice(0,4))}"`)}function SLe(r){for(let t=r.lastIndexOf(95);t>0;)if(r[--t]!==95)throw new Error("underscore allowed only at start")}function CLe(r){let e=r[0],t=jF.get(e);if(t)throw G2(`leading ${t}`);let n=r.length,s=-1;for(let i=1;i<n;i++){e=r[i];let o=jF.get(e);if(o){if(s==i)throw G2(`${t} + ${o}`);s=i+1,t=o}}if(s==n)throw G2(`trailing ${t}`)}function O7(r,e=1/0,t=Tte){let n=[];ILe(r[0])&&n.push(""),r.length>e&&(e>>=1,r=[...r.slice(0,e),8230,...r.slice(-e)]);let s=0,i=r.length;for(let o=0;o<i;o++){let a=r[o];Fte(a)&&(n.push($1(r.slice(s,o))),n.push(t(a)),s=o+1)}return n.push($1(r.slice(s,i))),n.join("")}function ILe(r){return FN(),Jh.has(r)}function Fte(r){return FN(),Ute.has(r)}function kLe(r){return NLe(TLe(r,ELe,RLe))}function TLe(r,e,t){if(!r)return[];FN();let n=0;return r.split(Bte).map(s=>{let i=uLe(s),o={input:i,offset:n};n+=i.length+1;try{let a=o.tokens=OLe(i,e,t),c=a.length,l;if(!c)throw new Error("empty label");let u=o.output=a.flat();if(SLe(u),!(o.emoji=c>1||a[0].is_emoji)&&u.every(p=>p<128))ALe(u),l="ASCII";else{let p=a.flatMap(y=>y.is_emoji?[]:y);if(!p.length)l="Emoji";else{if(Jh.has(u[0]))throw G2("leading combining mark");for(let g=1;g<c;g++){let w=a[g];if(!w.is_emoji&&Jh.has(w[0]))throw G2(`emoji + combining mark: "${$1(a[g-1])} + ${O7([w[0]])}"`)}CLe(u);let y=U6(new Set(p)),[f]=PLe(y);DLe(f,p),_Le(f,y),l=f.N}}o.type=l}catch(a){o.error=a}return o})}function _Le(r,e){let t,n=[];for(let s of e){let i=rp.get(s);if(i===$te)return;if(i){let o=i.M.get(s);if(t=t?t.filter(a=>o.has(a)):U6(o),!t.length)return}else n.push(s)}if(t){for(let s of t)if(n.every(i=>Xy(s,i)))throw new Error(`whole-script confusable: ${r.N}/${s.N}`)}}function PLe(r){let e=Gp;for(let t of r){let n=e.filter(s=>Xy(s,t));if(!n.length)throw Gp.some(s=>Xy(s,t))?Vte(e[0],t):zte(t);if(e=n,n.length==1)break}return e}function NLe(r){return r.map(({input:e,error:t,output:n})=>{if(t){let s=t.message;throw new Error(r.length==1?s:`Invalid label ${VN(O7(e,63))}: ${s}`)}return $1(n)}).join(Bte)}function zte(r){return new Error(`disallowed character: ${zN(r)}`)}function Vte(r,e){let t=zN(e),n=Gp.find(s=>s.P.has(e));return n&&(t=`${n.N} ${t}`),new Error(`illegal mixture: ${r.N} + ${t}`)}function G2(r){return new Error(`illegal placement: ${r}`)}function DLe(r,e){for(let t of e)if(!Xy(r,t))throw Vte(r,t);if(r.M){let t=Rte(e);for(let n=1,s=t.length;n<s;n++)if(ik.has(t[n])){let i=n+1;for(let o;i<s&&ik.has(o=t[i]);i++)for(let a=n;a<i;a++)if(t[a]==o)throw new Error(`duplicate non-spacing marks: ${zN(o)}`);if(i-n>qF)throw new Error(`excessive non-spacing marks: ${VN(O7(t.slice(n-1,i)))} (${i-n}/${qF})`);n=i}}}function OLe(r,e,t){let n=[],s=[];for(r=r.slice().reverse();r.length;){let i=BLe(r);if(i)s.length&&(n.push(e(s)),s=[]),n.push(t(i));else{let o=r.pop();if(Th.has(o))s.push(o);else{let a=sk.get(o);if(a)s.push(...a);else if(!Lte.has(o))throw zte(o)}}}return s.length&&n.push(e(s)),n}function RLe(r){return r.filter(e=>e!=Mte)}function BLe(r,e){let t=ok,n,s=r.length;for(;s&&(t=t.get(r[--s]),!!t);){let{V:i}=t;i&&(n=i,r.length=s)}return n}const Hte=new Uint8Array(32);Hte.fill(0);function YF(r){return q(r.length!==0,"invalid ENS name; empty component","comp",r),r}function Kte(r){const e=Sc(MLe(r)),t=[];if(r.length===0)return t;let n=0;for(let s=0;s<e.length;s++)e[s]===46&&(t.push(YF(e.slice(n,s))),n=s+1);return q(n<e.length,"invalid ENS name; empty component","name",r),t.push(YF(e.slice(n))),t}function MLe(r){try{if(r.length===0)throw new Error("empty label");return kLe(r)}catch(e){q(!1,`invalid ENS name (${e.message})`,"name",r)}}function ak(r){q(typeof r=="string","invalid ENS name; not a string","name",r),q(r.length,"invalid ENS name (empty label)","name",r);let e=Hte;const t=Kte(r);for(;t.length;)e=br(pr([e,br(t.pop())]));return ke(e)}function $Le(r,e){const t=e;return q(t<=255,"DNS encoded label cannot exceed 255","length",t),ke(pr(Kte(r).map(n=>{q(n.length<=t,`label ${JSON.stringify(r)} exceeds ${t} bytes`,"name",r);const s=new Uint8Array(n.length+1);return s.set(n,1),s[0]=s.length-1,s})))+"00"}function ix(r,e){return{address:_t(r),storageKeys:e.map((t,n)=>(q($t(t,32),"invalid slot",`storageKeys[${n}]`,t),t.toLowerCase()))}}function Nf(r){if(Array.isArray(r))return r.map((t,n)=>Array.isArray(t)?(q(t.length===2,"invalid slot set",`value[${n}]`,t),ix(t[0],t[1])):(q(t!=null&&typeof t=="object","invalid address-slot set","value",r),ix(t.address,t.storageKeys)));q(r!=null&&typeof r=="object","invalid access list","value",r);const e=Object.keys(r).map(t=>{const n=r[t].reduce((s,i)=>(s[i]=!0,s),{});return ix(t,Object.keys(n).sort())});return e.sort((t,n)=>t.address.localeCompare(n.address)),e}function LLe(r){let e;return typeof r=="string"?e=Wy.computePublicKey(r,!1):e=r.publicKey,_t(br("0x"+e.substring(4)).substring(26))}function ULe(r,e){return LLe(Wy.recoverPublicKey(r,e))}const Rr=BigInt(0),FLe=BigInt(2),zLe=BigInt(27),VLe=BigInt(28),HLe=BigInt(35),KLe=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),ox=4096*32;function XF(r,e){let t=r.toString(16);for(;t.length<2;)t="0"+t;return t+=fg(e).substring(4),"0x"+t}function R7(r){return r==="0x"?null:_t(r)}function HN(r,e){try{return Nf(r)}catch(t){q(!1,t.message,e,r)}}function dw(r,e){return r==="0x"?0:Ze(r,e)}function dr(r,e){if(r==="0x")return Rr;const t=Pe(r,e);return q(t<=KLe,"value exceeds uint size",e,t),t}function Vt(r,e){const t=Pe(r,"value"),n=Hn(t);return q(n.length<=32,"value too large",`tx.${e}`,t),n}function KN(r){return Nf(r).map(e=>[e.address,e.storageKeys])}function GLe(r,e){q(Array.isArray(r),`invalid ${e}`,"value",r);for(let t=0;t<r.length;t++)q($t(r[t],32),"invalid ${ param } hash",`value[${t}]`,r[t]);return r}function jLe(r){const e=_7(r);q(Array.isArray(e)&&(e.length===9||e.length===6),"invalid field count for legacy transaction","data",r);const t={type:0,nonce:dw(e[0],"nonce"),gasPrice:dr(e[1],"gasPrice"),gasLimit:dr(e[2],"gasLimit"),to:R7(e[3]),value:dr(e[4],"value"),data:ke(e[5]),chainId:Rr};if(e.length===6)return t;const n=dr(e[6],"v"),s=dr(e[7],"r"),i=dr(e[8],"s");if(s===Rr&&i===Rr)t.chainId=n;else{let o=(n-HLe)/FLe;o<Rr&&(o=Rr),t.chainId=o,q(o!==Rr||n===zLe||n===VLe,"non-canonical legacy v","v",e[6]),t.signature=To.from({r:hf(e[7],32),s:hf(e[8],32),v:n})}return t}function qLe(r,e){const t=[Vt(r.nonce,"nonce"),Vt(r.gasPrice||0,"gasPrice"),Vt(r.gasLimit,"gasLimit"),r.to||"0x",Vt(r.value,"value"),r.data];let n=Rr;if(r.chainId!=Rr)n=Pe(r.chainId,"tx.chainId"),q(!e||e.networkV==null||e.legacyChainId===n,"tx.chainId/sig.v mismatch","sig",e);else if(r.signature){const i=r.signature.legacyChainId;i!=null&&(n=i)}if(!e)return n!==Rr&&(t.push(Hn(n)),t.push("0x"),t.push("0x")),df(t);let s=BigInt(27+e.yParity);return n!==Rr?s=To.getChainIdV(n,e.v):BigInt(e.v)!==s&&q(!1,"tx.chainId/sig.v mismatch","sig",e),t.push(Hn(s)),t.push(Hn(e.r)),t.push(Hn(e.s)),df(t)}function GN(r,e){let t;try{if(t=dw(e[0],"yParity"),t!==0&&t!==1)throw new Error("bad yParity")}catch{q(!1,"invalid yParity","yParity",e[0])}const n=hf(e[1],32),s=hf(e[2],32),i=To.from({r:n,s,yParity:t});r.signature=i}function WLe(r){const e=_7(dt(r).slice(1));q(Array.isArray(e)&&(e.length===9||e.length===12),"invalid field count for transaction type: 2","data",ke(r));const t={type:2,chainId:dr(e[0],"chainId"),nonce:dw(e[1],"nonce"),maxPriorityFeePerGas:dr(e[2],"maxPriorityFeePerGas"),maxFeePerGas:dr(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:dr(e[4],"gasLimit"),to:R7(e[5]),value:dr(e[6],"value"),data:ke(e[7]),accessList:HN(e[8],"accessList")};return e.length===9||GN(t,e.slice(9)),t}function QLe(r,e){const t=[Vt(r.chainId,"chainId"),Vt(r.nonce,"nonce"),Vt(r.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),Vt(r.maxFeePerGas||0,"maxFeePerGas"),Vt(r.gasLimit,"gasLimit"),r.to||"0x",Vt(r.value,"value"),r.data,KN(r.accessList||[])];return e&&(t.push(Vt(e.yParity,"yParity")),t.push(Hn(e.r)),t.push(Hn(e.s))),pr(["0x02",df(t)])}function JLe(r){const e=_7(dt(r).slice(1));q(Array.isArray(e)&&(e.length===8||e.length===11),"invalid field count for transaction type: 1","data",ke(r));const t={type:1,chainId:dr(e[0],"chainId"),nonce:dw(e[1],"nonce"),gasPrice:dr(e[2],"gasPrice"),gasLimit:dr(e[3],"gasLimit"),to:R7(e[4]),value:dr(e[5],"value"),data:ke(e[6]),accessList:HN(e[7],"accessList")};return e.length===8||GN(t,e.slice(8)),t}function YLe(r,e){const t=[Vt(r.chainId,"chainId"),Vt(r.nonce,"nonce"),Vt(r.gasPrice||0,"gasPrice"),Vt(r.gasLimit,"gasLimit"),r.to||"0x",Vt(r.value,"value"),r.data,KN(r.accessList||[])];return e&&(t.push(Vt(e.yParity,"recoveryParam")),t.push(Hn(e.r)),t.push(Hn(e.s))),pr(["0x01",df(t)])}function XLe(r){let e=_7(dt(r).slice(1)),t="3",n=null;if(e.length===4&&Array.isArray(e[0])){t="3 (network format)";const i=e[1],o=e[2],a=e[3];q(Array.isArray(i),"invalid network format: blobs not an array","fields[1]",i),q(Array.isArray(o),"invalid network format: commitments not an array","fields[2]",o),q(Array.isArray(a),"invalid network format: proofs not an array","fields[3]",a),q(i.length===o.length,"invalid network format: blobs/commitments length mismatch","fields",e),q(i.length===a.length,"invalid network format: blobs/proofs length mismatch","fields",e),n=[];for(let c=0;c<e[1].length;c++)n.push({data:i[c],commitment:o[c],proof:a[c]});e=e[0]}q(Array.isArray(e)&&(e.length===11||e.length===14),`invalid field count for transaction type: ${t}`,"data",ke(r));const s={type:3,chainId:dr(e[0],"chainId"),nonce:dw(e[1],"nonce"),maxPriorityFeePerGas:dr(e[2],"maxPriorityFeePerGas"),maxFeePerGas:dr(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:dr(e[4],"gasLimit"),to:R7(e[5]),value:dr(e[6],"value"),data:ke(e[7]),accessList:HN(e[8],"accessList"),maxFeePerBlobGas:dr(e[9],"maxFeePerBlobGas"),blobVersionedHashes:e[10]};n&&(s.blobs=n),q(s.to!=null,`invalid address for transaction type: ${t}`,"data",r),q(Array.isArray(s.blobVersionedHashes),"invalid blobVersionedHashes: must be an array","data",r);for(let i=0;i<s.blobVersionedHashes.length;i++)q($t(s.blobVersionedHashes[i],32),`invalid blobVersionedHash at index ${i}: must be length 32`,"data",r);return e.length===11||GN(s,e.slice(11)),s}function ZLe(r,e,t){const n=[Vt(r.chainId,"chainId"),Vt(r.nonce,"nonce"),Vt(r.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),Vt(r.maxFeePerGas||0,"maxFeePerGas"),Vt(r.gasLimit,"gasLimit"),r.to||qy,Vt(r.value,"value"),r.data,KN(r.accessList||[]),Vt(r.maxFeePerBlobGas||0,"maxFeePerBlobGas"),GLe(r.blobVersionedHashes||[],"blobVersionedHashes")];return e&&(n.push(Vt(e.yParity,"yParity")),n.push(Hn(e.r)),n.push(Hn(e.s)),t)?pr(["0x03",df([n,t.map(s=>s.data),t.map(s=>s.commitment),t.map(s=>s.proof)])]):pr(["0x03",df(n)])}var Jo,p0,g0,y0,m0,w0,b0,v0,E0,x0,A0,S0,dd,Wl,rc,Ql,C0,P4;const Ha=class Ha{constructor(){Q(this,C0);Q(this,Jo);Q(this,p0);Q(this,g0);Q(this,y0);Q(this,m0);Q(this,w0);Q(this,b0);Q(this,v0);Q(this,E0);Q(this,x0);Q(this,A0);Q(this,S0);Q(this,dd);Q(this,Wl);Q(this,rc);Q(this,Ql);M(this,Jo,null),M(this,p0,null),M(this,y0,0),M(this,m0,Rr),M(this,w0,null),M(this,b0,null),M(this,v0,null),M(this,g0,"0x"),M(this,E0,Rr),M(this,x0,Rr),M(this,A0,null),M(this,S0,null),M(this,dd,null),M(this,Wl,null),M(this,Ql,null),M(this,rc,null)}get type(){return T(this,Jo)}set type(e){switch(e){case null:M(this,Jo,null);break;case 0:case"legacy":M(this,Jo,0);break;case 1:case"berlin":case"eip-2930":M(this,Jo,1);break;case 2:case"london":case"eip-1559":M(this,Jo,2);break;case 3:case"cancun":case"eip-4844":M(this,Jo,3);break;default:q(!1,"unsupported transaction type","type",e)}}get typeName(){switch(this.type){case 0:return"legacy";case 1:return"eip-2930";case 2:return"eip-1559";case 3:return"eip-4844"}return null}get to(){const e=T(this,p0);return e==null&&this.type===3?qy:e}set to(e){M(this,p0,e==null?null:_t(e))}get nonce(){return T(this,y0)}set nonce(e){M(this,y0,Ze(e,"value"))}get gasLimit(){return T(this,m0)}set gasLimit(e){M(this,m0,Pe(e))}get gasPrice(){const e=T(this,w0);return e==null&&(this.type===0||this.type===1)?Rr:e}set gasPrice(e){M(this,w0,e==null?null:Pe(e,"gasPrice"))}get maxPriorityFeePerGas(){const e=T(this,b0);return e??(this.type===2||this.type===3?Rr:null)}set maxPriorityFeePerGas(e){M(this,b0,e==null?null:Pe(e,"maxPriorityFeePerGas"))}get maxFeePerGas(){const e=T(this,v0);return e??(this.type===2||this.type===3?Rr:null)}set maxFeePerGas(e){M(this,v0,e==null?null:Pe(e,"maxFeePerGas"))}get data(){return T(this,g0)}set data(e){M(this,g0,ke(e))}get value(){return T(this,E0)}set value(e){M(this,E0,Pe(e,"value"))}get chainId(){return T(this,x0)}set chainId(e){M(this,x0,Pe(e))}get signature(){return T(this,A0)||null}set signature(e){M(this,A0,e==null?null:To.from(e))}get accessList(){const e=T(this,S0)||null;return e??(this.type===1||this.type===2||this.type===3?[]:null)}set accessList(e){M(this,S0,e==null?null:Nf(e))}get maxFeePerBlobGas(){const e=T(this,dd);return e==null&&this.type===3?Rr:e}set maxFeePerBlobGas(e){M(this,dd,e==null?null:Pe(e,"maxFeePerBlobGas"))}get blobVersionedHashes(){let e=T(this,Wl);return e==null&&this.type===3?[]:e}set blobVersionedHashes(e){if(e!=null){q(Array.isArray(e),"blobVersionedHashes must be an Array","value",e),e=e.slice();for(let t=0;t<e.length;t++)q($t(e[t],32),"invalid blobVersionedHash",`value[${t}]`,e[t])}M(this,Wl,e)}get blobs(){return T(this,Ql)==null?null:T(this,Ql).map(e=>Object.assign({},e))}set blobs(e){if(e==null){M(this,Ql,null);return}const t=[],n=[];for(let s=0;s<e.length;s++){const i=e[s];if(_N(i)){se(T(this,rc),"adding a raw blob requires a KZG library","UNSUPPORTED_OPERATION",{operation:"set blobs()"});let o=dt(i);if(q(o.length<=ox,"blob is too large",`blobs[${s}]`,i),o.length!==ox){const l=new Uint8Array(ox);l.set(o),o=l}const a=T(this,rc).blobToKzgCommitment(o),c=ke(T(this,rc).computeBlobKzgProof(o,a));t.push({data:ke(o),commitment:ke(a),proof:c}),n.push(XF(1,a))}else{const o=ke(i.commitment);t.push({data:ke(i.data),commitment:o,proof:ke(i.proof)}),n.push(XF(1,o))}}M(this,Ql,t),M(this,Wl,n)}get kzg(){return T(this,rc)}set kzg(e){M(this,rc,e)}get hash(){return this.signature==null?null:br(te(this,C0,P4).call(this,!0,!1))}get unsignedHash(){return br(this.unsignedSerialized)}get from(){return this.signature==null?null:ULe(this.unsignedHash,this.signature)}get fromPublicKey(){return this.signature==null?null:Wy.recoverPublicKey(this.unsignedHash,this.signature)}isSigned(){return this.signature!=null}get serialized(){return te(this,C0,P4).call(this,!0,!0)}get unsignedSerialized(){return te(this,C0,P4).call(this,!1,!1)}inferType(){const e=this.inferTypes();return e.indexOf(2)>=0?2:e.pop()}inferTypes(){const e=this.gasPrice!=null,t=this.maxFeePerGas!=null||this.maxPriorityFeePerGas!=null,n=this.accessList!=null,s=T(this,dd)!=null||T(this,Wl);this.maxFeePerGas!=null&&this.maxPriorityFeePerGas!=null&&se(this.maxFeePerGas>=this.maxPriorityFeePerGas,"priorityFee cannot be more than maxFee","BAD_DATA",{value:this}),se(!t||this.type!==0&&this.type!==1,"transaction type cannot have maxFeePerGas or maxPriorityFeePerGas","BAD_DATA",{value:this}),se(this.type!==0||!n,"legacy transaction cannot have accessList","BAD_DATA",{value:this});const i=[];return this.type!=null?i.push(this.type):t?i.push(2):e?(i.push(1),n||i.push(0)):n?(i.push(1),i.push(2)):(s&&this.to||(i.push(0),i.push(1),i.push(2)),i.push(3)),i.sort(),i}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}clone(){return Ha.from(this)}toJSON(){const e=t=>t==null?null:t.toString();return{type:this.type,to:this.to,data:this.data,nonce:this.nonce,gasLimit:e(this.gasLimit),gasPrice:e(this.gasPrice),maxPriorityFeePerGas:e(this.maxPriorityFeePerGas),maxFeePerGas:e(this.maxFeePerGas),value:e(this.value),chainId:e(this.chainId),sig:this.signature?this.signature.toJSON():null,accessList:this.accessList}}static from(e){if(e==null)return new Ha;if(typeof e=="string"){const n=dt(e);if(n[0]>=127)return Ha.from(jLe(n));switch(n[0]){case 1:return Ha.from(JLe(n));case 2:return Ha.from(WLe(n));case 3:return Ha.from(XLe(n))}se(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:"from"})}const t=new Ha;return e.type!=null&&(t.type=e.type),e.to!=null&&(t.to=e.to),e.nonce!=null&&(t.nonce=e.nonce),e.gasLimit!=null&&(t.gasLimit=e.gasLimit),e.gasPrice!=null&&(t.gasPrice=e.gasPrice),e.maxPriorityFeePerGas!=null&&(t.maxPriorityFeePerGas=e.maxPriorityFeePerGas),e.maxFeePerGas!=null&&(t.maxFeePerGas=e.maxFeePerGas),e.maxFeePerBlobGas!=null&&(t.maxFeePerBlobGas=e.maxFeePerBlobGas),e.data!=null&&(t.data=e.data),e.value!=null&&(t.value=e.value),e.chainId!=null&&(t.chainId=e.chainId),e.signature!=null&&(t.signature=To.from(e.signature)),e.accessList!=null&&(t.accessList=e.accessList),e.blobVersionedHashes!=null&&(t.blobVersionedHashes=e.blobVersionedHashes),e.kzg!=null&&(t.kzg=e.kzg),e.blobs!=null&&(t.blobs=e.blobs),e.hash!=null&&(q(t.isSigned(),"unsigned transaction cannot define '.hash'","tx",e),q(t.hash===e.hash,"hash mismatch","tx",e)),e.from!=null&&(q(t.isSigned(),"unsigned transaction cannot define '.from'","tx",e),q(t.from.toLowerCase()===(e.from||"").toLowerCase(),"from mismatch","tx",e)),t}};Jo=new WeakMap,p0=new WeakMap,g0=new WeakMap,y0=new WeakMap,m0=new WeakMap,w0=new WeakMap,b0=new WeakMap,v0=new WeakMap,E0=new WeakMap,x0=new WeakMap,A0=new WeakMap,S0=new WeakMap,dd=new WeakMap,Wl=new WeakMap,rc=new WeakMap,Ql=new WeakMap,C0=new WeakSet,P4=function(e,t){se(!e||this.signature!=null,"cannot serialize unsigned transaction; maybe you meant .unsignedSerialized","UNSUPPORTED_OPERATION",{operation:".serialized"});const n=e?this.signature:null;switch(this.inferType()){case 0:return qLe(this,n);case 1:return YLe(this,n);case 2:return QLe(this,n);case 3:return ZLe(this,n,t?this.blobs:null)}se(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:".serialized"})};let F6=Ha;const Gte=new Uint8Array(32);Gte.fill(0);const eUe=BigInt(-1),jte=BigInt(0),qte=BigInt(1),tUe=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function rUe(r){const e=dt(r),t=e.length%32;return t?pr([e,Gte.slice(t)]):ke(e)}const nUe=Ju(qte,32),sUe=Ju(jte,32),ZF={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},ax=["name","version","chainId","verifyingContract","salt"];function ez(r){return function(e){return q(typeof e=="string",`invalid domain value for ${JSON.stringify(r)}`,`domain.${r}`,e),e}}const iUe={name:ez("name"),version:ez("version"),chainId:function(r){const e=Pe(r,"domain.chainId");return q(e>=0,"invalid chain ID","domain.chainId",r),Number.isSafeInteger(e)?Number(e):Ep(e)},verifyingContract:function(r){try{return _t(r).toLowerCase()}catch{}q(!1,'invalid domain value "verifyingContract"',"domain.verifyingContract",r)},salt:function(r){const e=dt(r,"domain.salt");return q(e.length===32,'invalid domain value "salt"',"domain.salt",r),ke(e)}};function cx(r){{const e=r.match(/^(u?)int(\d+)$/);if(e){const t=e[1]==="",n=parseInt(e[2]);q(n%8===0&&n!==0&&n<=256&&e[2]===String(n),"invalid numeric width","type",r);const s=g2(tUe,t?n-1:n),i=t?(s+qte)*eUe:jte;return function(o){const a=Pe(o,"value");return q(a>=i&&a<=s,`value out-of-bounds for ${r}`,"value",a),Ju(t?Ree(a,256):a,32)}}}{const e=r.match(/^bytes(\d+)$/);if(e){const t=parseInt(e[1]);return q(t!==0&&t<=32&&e[1]===String(t),"invalid bytes width","type",r),function(n){const s=dt(n);return q(s.length===t,`invalid length for ${r}`,"value",n),rUe(n)}}}switch(r){case"address":return function(e){return hf(_t(e),32)};case"bool":return function(e){return e?nUe:sUe};case"bytes":return function(e){return br(e)};case"string":return function(e){return ff(e)}}return null}function tz(r,e){return`${r}(${e.map(({name:t,type:n})=>n+" "+t).join(",")})`}function D3(r){const e=r.match(/^([^\x5b]*)((\x5b\d*\x5d)*)(\x5b(\d*)\x5d)$/);return e?{base:e[1],index:e[2]+e[4],array:{base:e[1],prefix:e[1]+e[2],count:e[5]?parseInt(e[5]):-1}}:{base:r}}var dm,nc,I0,Q6,Wte;const pi=class pi{constructor(e){Q(this,Q6);h(this,"primaryType");Q(this,dm);Q(this,nc);Q(this,I0);M(this,nc,new Map),M(this,I0,new Map);const t=new Map,n=new Map,s=new Map,i={};Object.keys(e).forEach(c=>{i[c]=e[c].map(({name:l,type:u})=>{let{base:d,index:p}=D3(u);return d==="int"&&!e.int&&(d="int256"),d==="uint"&&!e.uint&&(d="uint256"),{name:l,type:d+(p||"")}}),t.set(c,new Set),n.set(c,[]),s.set(c,new Set)}),M(this,dm,JSON.stringify(i));for(const c in i){const l=new Set;for(const u of i[c]){q(!l.has(u.name),`duplicate variable name ${JSON.stringify(u.name)} in ${JSON.stringify(c)}`,"types",e),l.add(u.name);const d=D3(u.type).base;q(d!==c,`circular type reference to ${JSON.stringify(d)}`,"types",e),!cx(d)&&(q(n.has(d),`unknown type ${JSON.stringify(d)}`,"types",e),n.get(d).push(c),t.get(c).add(d))}}const o=Array.from(n.keys()).filter(c=>n.get(c).length===0);q(o.length!==0,"missing primary type","types",e),q(o.length===1,`ambiguous primary types or unused types: ${o.map(c=>JSON.stringify(c)).join(", ")}`,"types",e),Me(this,{primaryType:o[0]});function a(c,l){q(!l.has(c),`circular type reference to ${JSON.stringify(c)}`,"types",e),l.add(c);for(const u of t.get(c))if(n.has(u)){a(u,l);for(const d of l)s.get(d).add(u)}l.delete(c)}a(this.primaryType,new Set);for(const[c,l]of s){const u=Array.from(l);u.sort(),T(this,nc).set(c,tz(c,i[c])+u.map(d=>tz(d,i[d])).join(""))}}get types(){return JSON.parse(T(this,dm))}getEncoder(e){let t=T(this,I0).get(e);return t||(t=te(this,Q6,Wte).call(this,e),T(this,I0).set(e,t)),t}encodeType(e){const t=T(this,nc).get(e);return q(t,`unknown type: ${JSON.stringify(e)}`,"name",e),t}encodeData(e,t){return this.getEncoder(e)(t)}hashStruct(e,t){return br(this.encodeData(e,t))}encode(e){return this.encodeData(this.primaryType,e)}hash(e){return this.hashStruct(this.primaryType,e)}_visit(e,t,n){if(cx(e))return n(e,t);const s=D3(e).array;if(s)return q(s.count===-1||s.count===t.length,`array length mismatch; expected length ${s.count}`,"value",t),t.map(o=>this._visit(s.prefix,o,n));const i=this.types[e];if(i)return i.reduce((o,{name:a,type:c})=>(o[a]=this._visit(c,t[a],n),o),{});q(!1,`unknown type: ${e}`,"type",e)}visit(e,t){return this._visit(this.primaryType,e,t)}static from(e){return new pi(e)}static getPrimaryType(e){return pi.from(e).primaryType}static hashStruct(e,t,n){return pi.from(t).hashStruct(e,n)}static hashDomain(e){const t=[];for(const n in e){if(e[n]==null)continue;const s=ZF[n];q(s,`invalid typed-data domain key: ${JSON.stringify(n)}`,"domain",e),t.push({name:n,type:s})}return t.sort((n,s)=>ax.indexOf(n.name)-ax.indexOf(s.name)),pi.hashStruct("EIP712Domain",{EIP712Domain:t},e)}static encode(e,t,n){return pr(["0x1901",pi.hashDomain(e),pi.from(t).hash(n)])}static hash(e,t,n){return br(pi.encode(e,t,n))}static async resolveNames(e,t,n,s){e=Object.assign({},e);for(const a in e)e[a]==null&&delete e[a];const i={};e.verifyingContract&&!$t(e.verifyingContract,20)&&(i[e.verifyingContract]="0x");const o=pi.from(t);o.visit(n,(a,c)=>(a==="address"&&!$t(c,20)&&(i[c]="0x"),c));for(const a in i)i[a]=await s(a);return e.verifyingContract&&i[e.verifyingContract]&&(e.verifyingContract=i[e.verifyingContract]),n=o.visit(n,(a,c)=>a==="address"&&i[c]?i[c]:c),{domain:e,value:n}}static getPayload(e,t,n){pi.hashDomain(e);const s={},i=[];ax.forEach(c=>{const l=e[c];l!=null&&(s[c]=iUe[c](l),i.push({name:c,type:ZF[c]}))});const o=pi.from(t);t=o.types;const a=Object.assign({},t);return q(a.EIP712Domain==null,"types must not contain EIP712Domain type","types.EIP712Domain",t),a.EIP712Domain=i,o.encode(n),{types:a,domain:s,primaryType:o.primaryType,message:o.visit(n,(c,l)=>{if(c.match(/^bytes(\d*)/))return ke(dt(l));if(c.match(/^u?int/))return Pe(l).toString();switch(c){case"address":return l.toLowerCase();case"bool":return!!l;case"string":return q(typeof l=="string","invalid string","value",l),l}q(!1,"unsupported type","type",c)})}}};dm=new WeakMap,nc=new WeakMap,I0=new WeakMap,Q6=new WeakSet,Wte=function(e){{const s=cx(e);if(s)return s}const t=D3(e).array;if(t){const s=t.prefix,i=this.getEncoder(s);return o=>{q(t.count===-1||t.count===o.length,`array length mismatch; expected length ${t.count}`,"value",o);let a=o.map(i);return T(this,nc).has(s)&&(a=a.map(br)),br(pr(a))}}const n=this.types[e];if(n){const s=ff(T(this,nc).get(e));return i=>{const o=n.map(({name:a,type:c})=>{const l=this.getEncoder(c)(i[a]);return T(this,nc).has(c)?br(l):l});return o.unshift(s),pr(o)}}q(!1,`unknown type: ${e}`,"type",e)};let z6=pi;function jn(r){const e=new Set;return r.forEach(t=>e.add(t)),Object.freeze(e)}const oUe="external public payable override",aUe=jn(oUe.split(" ")),Qte="constant external internal payable private public pure view override",cUe=jn(Qte.split(" ")),Jte="constructor error event fallback function receive struct",Yte=jn(Jte.split(" ")),Xte="calldata memory storage payable indexed",lUe=jn(Xte.split(" ")),uUe="tuple returns",hUe=[Jte,Xte,uUe,Qte].join(" "),dUe=jn(hUe.split(" ")),fUe={"(":"OPEN_PAREN",")":"CLOSE_PAREN","[":"OPEN_BRACKET","]":"CLOSE_BRACKET",",":"COMMA","@":"AT"},pUe=new RegExp("^(\\s*)"),gUe=new RegExp("^([0-9]+)"),yUe=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)"),Zte=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)$"),ere=new RegExp("^(address|bool|bytes([0-9]*)|string|u?int([0-9]*))$");var Vr,ao,fm,ck;const J6=class J6{constructor(e){Q(this,fm);Q(this,Vr);Q(this,ao);M(this,Vr,0),M(this,ao,e.slice())}get offset(){return T(this,Vr)}get length(){return T(this,ao).length-T(this,Vr)}clone(){return new J6(T(this,ao))}reset(){M(this,Vr,0)}popKeyword(e){const t=this.peek();if(t.type!=="KEYWORD"||!e.has(t.text))throw new Error(`expected keyword ${t.text}`);return this.pop().text}popType(e){if(this.peek().type!==e){const t=this.peek();throw new Error(`expected ${e}; got ${t.type} ${JSON.stringify(t.text)}`)}return this.pop().text}popParen(){const e=this.peek();if(e.type!=="OPEN_PAREN")throw new Error("bad start");const t=te(this,fm,ck).call(this,T(this,Vr)+1,e.match+1);return M(this,Vr,e.match+1),t}popParams(){const e=this.peek();if(e.type!=="OPEN_PAREN")throw new Error("bad start");const t=[];for(;T(this,Vr)<e.match-1;){const n=this.peek().linkNext;t.push(te(this,fm,ck).call(this,T(this,Vr)+1,n)),M(this,Vr,n)}return M(this,Vr,e.match+1),t}peek(){if(T(this,Vr)>=T(this,ao).length)throw new Error("out-of-bounds");return T(this,ao)[T(this,Vr)]}peekKeyword(e){const t=this.peekType("KEYWORD");return t!=null&&e.has(t)?t:null}peekType(e){if(this.length===0)return null;const t=this.peek();return t.type===e?t.text:null}pop(){const e=this.peek();return ts(this,Vr)._++,e}toString(){const e=[];for(let t=T(this,Vr);t<T(this,ao).length;t++){const n=T(this,ao)[t];e.push(`${n.type}:${n.text}`)}return`<TokenString ${e.join(" ")}>`}};Vr=new WeakMap,ao=new WeakMap,fm=new WeakSet,ck=function(e=0,t=0){return new J6(T(this,ao).slice(e,t).map(n=>Object.freeze(Object.assign({},n,{match:n.match-e,linkBack:n.linkBack-e,linkNext:n.linkNext-e}))))};let _o=J6;function hh(r){const e=[],t=o=>{const a=i<r.length?JSON.stringify(r[i]):"$EOI";throw new Error(`invalid token ${a} at ${i}: ${o}`)};let n=[],s=[],i=0;for(;i<r.length;){let o=r.substring(i),a=o.match(pUe);a&&(i+=a[1].length,o=r.substring(i));const c={depth:n.length,linkBack:-1,linkNext:-1,match:-1,type:"",text:"",offset:i,value:-1};e.push(c);let l=fUe[o[0]]||"";if(l){if(c.type=l,c.text=o[0],i++,l==="OPEN_PAREN")n.push(e.length-1),s.push(e.length-1);else if(l=="CLOSE_PAREN")n.length===0&&t("no matching open bracket"),c.match=n.pop(),e[c.match].match=e.length-1,c.depth--,c.linkBack=s.pop(),e[c.linkBack].linkNext=e.length-1;else if(l==="COMMA")c.linkBack=s.pop(),e[c.linkBack].linkNext=e.length-1,s.push(e.length-1);else if(l==="OPEN_BRACKET")c.type="BRACKET";else if(l==="CLOSE_BRACKET"){let u=e.pop().text;if(e.length>0&&e[e.length-1].type==="NUMBER"){const d=e.pop().text;u=d+u,e[e.length-1].value=Ze(d)}if(e.length===0||e[e.length-1].type!=="BRACKET")throw new Error("missing opening bracket");e[e.length-1].text+=u}continue}if(a=o.match(yUe),a){if(c.text=a[1],i+=c.text.length,dUe.has(c.text)){c.type="KEYWORD";continue}if(c.text.match(ere)){c.type="TYPE";continue}c.type="ID";continue}if(a=o.match(gUe),a){c.text=a[1],c.type="NUMBER",i+=c.text.length;continue}throw new Error(`unexpected token ${JSON.stringify(o[0])} at position ${i}`)}return new _o(e.map(o=>Object.freeze(o)))}function rz(r,e){let t=[];for(const n in e.keys())r.has(n)&&t.push(n);if(t.length>1)throw new Error(`conflicting types: ${t.join(", ")}`)}function B7(r,e){if(e.peekKeyword(Yte)){const t=e.pop().text;if(t!==r)throw new Error(`expected ${r}, got ${t}`)}return e.popType("ID")}function Fc(r,e){const t=new Set;for(;;){const n=r.peekType("KEYWORD");if(n==null||e&&!e.has(n))break;if(r.pop(),t.has(n))throw new Error(`duplicate keywords: ${JSON.stringify(n)}`);t.add(n)}return Object.freeze(t)}function tre(r){let e=Fc(r,cUe);return rz(e,jn("constant payable nonpayable".split(" "))),rz(e,jn("pure view payable nonpayable".split(" "))),e.has("view")?"view":e.has("pure")?"pure":e.has("payable")?"payable":e.has("nonpayable")?"nonpayable":e.has("constant")?"view":"nonpayable"}function Cc(r,e){return r.popParams().map(t=>Yr.from(t,e))}function rre(r){if(r.peekType("AT")){if(r.pop(),r.peekType("NUMBER"))return Pe(r.pop().text);throw new Error("invalid gas")}return null}function pf(r){if(r.length)throw new Error(`unexpected tokens at offset ${r.offset}: ${r.toString()}`)}const mUe=new RegExp(/^(.*)\[([0-9]*)\]$/);function nz(r){const e=r.match(ere);if(q(e,"invalid type","type",r),r==="uint")return"uint256";if(r==="int")return"int256";if(e[2]){const t=parseInt(e[2]);q(t!==0&&t<=32,"invalid bytes length","type",r)}else if(e[3]){const t=parseInt(e[3]);q(t!==0&&t<=256&&t%8===0,"invalid numeric width","type",r)}return r}const Xt={},Ts=Symbol.for("_ethers_internal"),sz="_ParamTypeInternal",iz="_ErrorInternal",oz="_EventInternal",az="_ConstructorInternal",cz="_FallbackInternal",lz="_FunctionInternal",uz="_StructInternal";var k0,N4;const gi=class gi{constructor(e,t,n,s,i,o,a,c){Q(this,k0);h(this,"name");h(this,"type");h(this,"baseType");h(this,"indexed");h(this,"components");h(this,"arrayLength");h(this,"arrayChildren");if(I7(e,Xt,"ParamType"),Object.defineProperty(this,Ts,{value:sz}),o&&(o=Object.freeze(o.slice())),s==="array"){if(a==null||c==null)throw new Error("")}else if(a!=null||c!=null)throw new Error("");if(s==="tuple"){if(o==null)throw new Error("")}else if(o!=null)throw new Error("");Me(this,{name:t,type:n,baseType:s,indexed:i,components:o,arrayLength:a,arrayChildren:c})}format(e){if(e==null&&(e="sighash"),e==="json"){const n=this.name||"";if(this.isArray()){const i=JSON.parse(this.arrayChildren.format("json"));return i.name=n,i.type+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`,JSON.stringify(i)}const s={type:this.baseType==="tuple"?"tuple":this.type,name:n};return typeof this.indexed=="boolean"&&(s.indexed=this.indexed),this.isTuple()&&(s.components=this.components.map(i=>JSON.parse(i.format(e)))),JSON.stringify(s)}let t="";return this.isArray()?(t+=this.arrayChildren.format(e),t+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`):this.isTuple()?t+="("+this.components.map(n=>n.format(e)).join(e==="full"?", ":",")+")":t+=this.type,e!=="sighash"&&(this.indexed===!0&&(t+=" indexed"),e==="full"&&this.name&&(t+=" "+this.name)),t}isArray(){return this.baseType==="array"}isTuple(){return this.baseType==="tuple"}isIndexable(){return this.indexed!=null}walk(e,t){if(this.isArray()){if(!Array.isArray(e))throw new Error("invalid array value");if(this.arrayLength!==-1&&e.length!==this.arrayLength)throw new Error("array is wrong length");const n=this;return e.map(s=>n.arrayChildren.walk(s,t))}if(this.isTuple()){if(!Array.isArray(e))throw new Error("invalid tuple value");if(e.length!==this.components.length)throw new Error("array is wrong length");const n=this;return e.map((s,i)=>n.components[i].walk(s,t))}return t(this.type,e)}async walkAsync(e,t){const n=[],s=[e];return te(this,k0,N4).call(this,n,e,t,i=>{s[0]=i}),n.length&&await Promise.all(n),s[0]}static from(e,t){if(gi.isParamType(e))return e;if(typeof e=="string")try{return gi.from(hh(e),t)}catch{q(!1,"invalid param type","obj",e)}else if(e instanceof _o){let a="",c="",l=null;Fc(e,jn(["tuple"])).has("tuple")||e.peekType("OPEN_PAREN")?(c="tuple",l=e.popParams().map(g=>gi.from(g)),a=`tuple(${l.map(g=>g.format()).join(",")})`):(a=nz(e.popType("TYPE")),c=a);let u=null,d=null;for(;e.length&&e.peekType("BRACKET");){const g=e.pop();u=new gi(Xt,"",a,c,null,l,d,u),d=g.value,a+=g.text,c="array",l=null}let p=null;if(Fc(e,lUe).has("indexed")){if(!t)throw new Error("");p=!0}const f=e.peekType("ID")?e.pop().text:"";if(e.length)throw new Error("leftover tokens");return new gi(Xt,f,a,c,p,l,d,u)}const n=e.name;q(!n||typeof n=="string"&&n.match(Zte),"invalid name","obj.name",n);let s=e.indexed;s!=null&&(q(t,"parameter cannot be indexed","obj.indexed",e.indexed),s=!!s);let i=e.type,o=i.match(mUe);if(o){const a=parseInt(o[2]||"-1"),c=gi.from({type:o[1],components:e.components});return new gi(Xt,n||"",i,"array",s,null,a,c)}if(i==="tuple"||i.startsWith("tuple(")||i.startsWith("(")){const a=e.components!=null?e.components.map(l=>gi.from(l)):null;return new gi(Xt,n||"",i,"tuple",s,a,null,null)}return i=nz(e.type),new gi(Xt,n||"",i,i,s,null,null,null)}static isParamType(e){return e&&e[Ts]===sz}};k0=new WeakSet,N4=function(e,t,n,s){if(this.isArray()){if(!Array.isArray(t))throw new Error("invalid array value");if(this.arrayLength!==-1&&t.length!==this.arrayLength)throw new Error("array is wrong length");const o=this.arrayChildren,a=t.slice();a.forEach((c,l)=>{var u;te(u=o,k0,N4).call(u,e,c,n,d=>{a[l]=d})}),s(a);return}if(this.isTuple()){const o=this.components;let a;if(Array.isArray(t))a=t.slice();else{if(t==null||typeof t!="object")throw new Error("invalid tuple value");a=o.map(c=>{if(!c.name)throw new Error("cannot use object value with unnamed components");if(!(c.name in t))throw new Error(`missing value for component ${c.name}`);return t[c.name]})}if(a.length!==this.components.length)throw new Error("array is wrong length");a.forEach((c,l)=>{var u;te(u=o[l],k0,N4).call(u,e,c,n,d=>{a[l]=d})}),s(a);return}const i=n(this.type,t);i.then?e.push(async function(){s(await i)}()):s(i)};let Yr=gi;class gf{constructor(e,t,n){h(this,"type");h(this,"inputs");I7(e,Xt,"Fragment"),n=Object.freeze(n.slice()),Me(this,{type:t,inputs:n})}static from(e){if(typeof e=="string"){try{gf.from(JSON.parse(e))}catch{}return gf.from(hh(e))}if(e instanceof _o)switch(e.peekKeyword(Yte)){case"constructor":return mc.from(e);case"error":return gs.from(e);case"event":return aa.from(e);case"fallback":case"receive":return Ja.from(e);case"function":return ca.from(e);case"struct":return Bd.from(e)}else if(typeof e=="object"){switch(e.type){case"constructor":return mc.from(e);case"error":return gs.from(e);case"event":return aa.from(e);case"fallback":case"receive":return Ja.from(e);case"function":return ca.from(e);case"struct":return Bd.from(e)}se(!1,`unsupported type: ${e.type}`,"UNSUPPORTED_OPERATION",{operation:"Fragment.from"})}q(!1,"unsupported frgament object","obj",e)}static isConstructor(e){return mc.isFragment(e)}static isError(e){return gs.isFragment(e)}static isEvent(e){return aa.isFragment(e)}static isFunction(e){return ca.isFragment(e)}static isStruct(e){return Bd.isFragment(e)}}class M7 extends gf{constructor(t,n,s,i){super(t,n,i);h(this,"name");q(typeof s=="string"&&s.match(Zte),"invalid identifier","name",s),i=Object.freeze(i.slice()),Me(this,{name:s})}}function Zy(r,e){return"("+e.map(t=>t.format(r)).join(r==="full"?", ":",")+")"}class gs extends M7{constructor(e,t,n){super(e,"error",t,n),Object.defineProperty(this,Ts,{value:iz})}get selector(){return ff(this.format("sighash")).substring(0,10)}format(e){if(e==null&&(e="sighash"),e==="json")return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map(n=>JSON.parse(n.format(e)))});const t=[];return e!=="sighash"&&t.push("error"),t.push(this.name+Zy(e,this.inputs)),t.join(" ")}static from(e){if(gs.isFragment(e))return e;if(typeof e=="string")return gs.from(hh(e));if(e instanceof _o){const t=B7("error",e),n=Cc(e);return pf(e),new gs(Xt,t,n)}return new gs(Xt,e.name,e.inputs?e.inputs.map(Yr.from):[])}static isFragment(e){return e&&e[Ts]===iz}}class aa extends M7{constructor(t,n,s,i){super(t,"event",n,s);h(this,"anonymous");Object.defineProperty(this,Ts,{value:oz}),Me(this,{anonymous:i})}get topicHash(){return ff(this.format("sighash"))}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map(s=>JSON.parse(s.format(t)))});const n=[];return t!=="sighash"&&n.push("event"),n.push(this.name+Zy(t,this.inputs)),t!=="sighash"&&this.anonymous&&n.push("anonymous"),n.join(" ")}static getTopicHash(t,n){return n=(n||[]).map(i=>Yr.from(i)),new aa(Xt,t,n,!1).topicHash}static from(t){if(aa.isFragment(t))return t;if(typeof t=="string")try{return aa.from(hh(t))}catch{q(!1,"invalid event fragment","obj",t)}else if(t instanceof _o){const n=B7("event",t),s=Cc(t,!0),i=!!Fc(t,jn(["anonymous"])).has("anonymous");return pf(t),new aa(Xt,n,s,i)}return new aa(Xt,t.name,t.inputs?t.inputs.map(n=>Yr.from(n,!0)):[],!!t.anonymous)}static isFragment(t){return t&&t[Ts]===oz}}class mc extends gf{constructor(t,n,s,i,o){super(t,n,s);h(this,"payable");h(this,"gas");Object.defineProperty(this,Ts,{value:az}),Me(this,{payable:i,gas:o})}format(t){if(se(t!=null&&t!=="sighash","cannot format a constructor for sighash","UNSUPPORTED_OPERATION",{operation:"format(sighash)"}),t==="json")return JSON.stringify({type:"constructor",stateMutability:this.payable?"payable":"undefined",payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(s=>JSON.parse(s.format(t)))});const n=[`constructor${Zy(t,this.inputs)}`];return this.payable&&n.push("payable"),this.gas!=null&&n.push(`@${this.gas.toString()}`),n.join(" ")}static from(t){if(mc.isFragment(t))return t;if(typeof t=="string")try{return mc.from(hh(t))}catch{q(!1,"invalid constuctor fragment","obj",t)}else if(t instanceof _o){Fc(t,jn(["constructor"]));const n=Cc(t),s=!!Fc(t,aUe).has("payable"),i=rre(t);return pf(t),new mc(Xt,"constructor",n,s,i)}return new mc(Xt,"constructor",t.inputs?t.inputs.map(Yr.from):[],!!t.payable,t.gas!=null?t.gas:null)}static isFragment(t){return t&&t[Ts]===az}}class Ja extends gf{constructor(t,n,s){super(t,"fallback",n);h(this,"payable");Object.defineProperty(this,Ts,{value:cz}),Me(this,{payable:s})}format(t){const n=this.inputs.length===0?"receive":"fallback";if(t==="json"){const s=this.payable?"payable":"nonpayable";return JSON.stringify({type:n,stateMutability:s})}return`${n}()${this.payable?" payable":""}`}static from(t){if(Ja.isFragment(t))return t;if(typeof t=="string")try{return Ja.from(hh(t))}catch{q(!1,"invalid fallback fragment","obj",t)}else if(t instanceof _o){const n=t.toString(),s=t.peekKeyword(jn(["fallback","receive"]));if(q(s,"type must be fallback or receive","obj",n),t.popKeyword(jn(["fallback","receive"]))==="receive"){const c=Cc(t);return q(c.length===0,"receive cannot have arguments","obj.inputs",c),Fc(t,jn(["payable"])),pf(t),new Ja(Xt,[],!0)}let o=Cc(t);o.length?q(o.length===1&&o[0].type==="bytes","invalid fallback inputs","obj.inputs",o.map(c=>c.format("minimal")).join(", ")):o=[Yr.from("bytes")];const a=tre(t);if(q(a==="nonpayable"||a==="payable","fallback cannot be constants","obj.stateMutability",a),Fc(t,jn(["returns"])).has("returns")){const c=Cc(t);q(c.length===1&&c[0].type==="bytes","invalid fallback outputs","obj.outputs",c.map(l=>l.format("minimal")).join(", "))}return pf(t),new Ja(Xt,o,a==="payable")}if(t.type==="receive")return new Ja(Xt,[],!0);if(t.type==="fallback"){const n=[Yr.from("bytes")],s=t.stateMutability==="payable";return new Ja(Xt,n,s)}q(!1,"invalid fallback description","obj",t)}static isFragment(t){return t&&t[Ts]===cz}}class ca extends M7{constructor(t,n,s,i,o,a){super(t,"function",n,i);h(this,"constant");h(this,"outputs");h(this,"stateMutability");h(this,"payable");h(this,"gas");Object.defineProperty(this,Ts,{value:lz}),o=Object.freeze(o.slice()),Me(this,{constant:s==="view"||s==="pure",gas:a,outputs:o,payable:s==="payable",stateMutability:s})}get selector(){return ff(this.format("sighash")).substring(0,10)}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:this.stateMutability!=="nonpayable"?this.stateMutability:void 0,payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(s=>JSON.parse(s.format(t))),outputs:this.outputs.map(s=>JSON.parse(s.format(t)))});const n=[];return t!=="sighash"&&n.push("function"),n.push(this.name+Zy(t,this.inputs)),t!=="sighash"&&(this.stateMutability!=="nonpayable"&&n.push(this.stateMutability),this.outputs&&this.outputs.length&&(n.push("returns"),n.push(Zy(t,this.outputs))),this.gas!=null&&n.push(`@${this.gas.toString()}`)),n.join(" ")}static getSelector(t,n){return n=(n||[]).map(i=>Yr.from(i)),new ca(Xt,t,"view",n,[],null).selector}static from(t){if(ca.isFragment(t))return t;if(typeof t=="string")try{return ca.from(hh(t))}catch{q(!1,"invalid function fragment","obj",t)}else if(t instanceof _o){const s=B7("function",t),i=Cc(t),o=tre(t);let a=[];Fc(t,jn(["returns"])).has("returns")&&(a=Cc(t));const c=rre(t);return pf(t),new ca(Xt,s,o,i,a,c)}let n=t.stateMutability;return n==null&&(n="payable",typeof t.constant=="boolean"?(n="view",t.constant||(n="payable",typeof t.payable=="boolean"&&!t.payable&&(n="nonpayable"))):typeof t.payable=="boolean"&&!t.payable&&(n="nonpayable")),new ca(Xt,t.name,n,t.inputs?t.inputs.map(Yr.from):[],t.outputs?t.outputs.map(Yr.from):[],t.gas!=null?t.gas:null)}static isFragment(t){return t&&t[Ts]===lz}}class Bd extends M7{constructor(e,t,n){super(e,"struct",t,n),Object.defineProperty(this,Ts,{value:uz})}format(){throw new Error("@TODO")}static from(e){if(typeof e=="string")try{return Bd.from(hh(e))}catch{q(!1,"invalid struct fragment","obj",e)}else if(e instanceof _o){const t=B7("struct",e),n=Cc(e);return pf(e),new Bd(Xt,t,n)}return new Bd(Xt,e.name,e.inputs?e.inputs.map(Yr.from):[])}static isFragment(e){return e&&e[Ts]===uz}}const Oo=new Map;Oo.set(0,"GENERIC_PANIC");Oo.set(1,"ASSERT_FALSE");Oo.set(17,"OVERFLOW");Oo.set(18,"DIVIDE_BY_ZERO");Oo.set(33,"ENUM_RANGE_ERROR");Oo.set(34,"BAD_STORAGE_DATA");Oo.set(49,"STACK_UNDERFLOW");Oo.set(50,"ARRAY_RANGE_ERROR");Oo.set(65,"OUT_OF_MEMORY");Oo.set(81,"UNINITIALIZED_FUNCTION_CALL");const wUe=new RegExp(/^bytes([0-9]*)$/),bUe=new RegExp(/^(u?int)([0-9]*)$/);let lx=null,hz=1024;function vUe(r,e,t,n){let s="missing revert data",i=null;const o=null;let a=null;if(t){s="execution reverted";const l=dt(t);if(t=ke(t),l.length===0)s+=" (no data present; likely require(false) occurred",i="require(false)";else if(l.length%32!==4)s+=" (could not decode reason; invalid data length)";else if(ke(l.slice(0,4))==="0x08c379a0")try{i=n.decode(["string"],l.slice(4))[0],a={signature:"Error(string)",name:"Error",args:[i]},s+=`: ${JSON.stringify(i)}`}catch{s+=" (could not decode reason; invalid string data)"}else if(ke(l.slice(0,4))==="0x4e487b71")try{const u=Number(n.decode(["uint256"],l.slice(4))[0]);a={signature:"Panic(uint256)",name:"Panic",args:[u]},i=`Panic due to ${Oo.get(u)||"UNKNOWN"}(${u})`,s+=`: ${i}`}catch{s+=" (could not decode panic code)"}else s+=" (unknown custom error)"}const c={to:e.to?_t(e.to):null,data:e.data||"0x"};return e.from&&(c.from=_t(e.from)),rr(s,"CALL_EXCEPTION",{action:r,data:t,reason:i,transaction:c,invocation:o,revert:a})}var Jl,np;const Y6=class Y6{constructor(){Q(this,Jl)}getDefaultValue(e){const t=e.map(s=>te(this,Jl,np).call(this,Yr.from(s)));return new N3(t,"_").defaultValue()}encode(e,t){Nee(t.length,e.length,"types/values length mismatch");const n=e.map(o=>te(this,Jl,np).call(this,Yr.from(o))),s=new N3(n,"_"),i=new WI;return s.encode(i,t),i.data}decode(e,t,n){const s=e.map(o=>te(this,Jl,np).call(this,Yr.from(o)));return new N3(s,"_").decode(new QI(t,n,hz))}static _setDefaultMaxInflation(e){q(typeof e=="number"&&Number.isInteger(e),"invalid defaultMaxInflation factor","value",e),hz=e}static defaultAbiCoder(){return lx==null&&(lx=new Y6),lx}static getBuiltinCallException(e,t,n){return vUe(e,t,n,Y6.defaultAbiCoder())}};Jl=new WeakSet,np=function(e){if(e.isArray())return new H$e(te(this,Jl,np).call(this,e.arrayChildren),e.arrayLength,e.name);if(e.isTuple())return new N3(e.components.map(n=>te(this,Jl,np).call(this,n)),e.name);switch(e.baseType){case"address":return new z$e(e.name);case"bool":return new K$e(e.name);case"string":return new Z$e(e.name);case"bytes":return new G$e(e.name);case"":return new W$e(e.name)}let t=e.type.match(bUe);if(t){let n=parseInt(t[2]||"256");return q(n!==0&&n<=256&&n%8===0,"invalid "+t[1]+" bit length","param",e),new X$e(n/8,t[1]==="int",e.name)}if(t=e.type.match(wUe),t){let n=parseInt(t[1]);return q(n!==0&&n<=32,"invalid bytes length","param",e),new j$e(n,e.name)}q(!1,"invalid type","type",e.type)};let em=Y6;class EUe{constructor(e,t,n){h(this,"fragment");h(this,"name");h(this,"signature");h(this,"topic");h(this,"args");const s=e.name,i=e.format();Me(this,{fragment:e,name:s,signature:i,topic:t,args:n})}}class xUe{constructor(e,t,n,s){h(this,"fragment");h(this,"name");h(this,"args");h(this,"signature");h(this,"selector");h(this,"value");const i=e.name,o=e.format();Me(this,{fragment:e,name:i,args:n,signature:o,selector:t,value:s})}}class AUe{constructor(e,t,n){h(this,"fragment");h(this,"name");h(this,"args");h(this,"signature");h(this,"selector");const s=e.name,i=e.format();Me(this,{fragment:e,name:s,args:n,signature:i,selector:t})}}class dz{constructor(e){h(this,"hash");h(this,"_isIndexed");Me(this,{hash:e,_isIndexed:!0})}static isIndexed(e){return!!(e&&e._isIndexed)}}const fz={0:"generic panic",1:"assert(false)",17:"arithmetic overflow",18:"division or modulo by zero",33:"enum overflow",34:"invalid encoded storage byte array accessed",49:"out-of-bounds array access; popping on an empty array",50:"out-of-bounds access of an array or bytesN",65:"out of memory",81:"uninitialized function"},pz={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:r=>`reverted with reason string ${JSON.stringify(r)}`},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"],reason:r=>{let e="unknown panic code";return r>=0&&r<=255&&fz[r.toString()]&&(e=fz[r.toString()]),`reverted with panic code 0x${r.toString(16)} (${e})`}}};var Yo,Xo,Zo,An,ma,D4,O4;const Uh=class Uh{constructor(e){Q(this,ma);h(this,"fragments");h(this,"deploy");h(this,"fallback");h(this,"receive");Q(this,Yo);Q(this,Xo);Q(this,Zo);Q(this,An);let t=[];typeof e=="string"?t=JSON.parse(e):t=e,M(this,Zo,new Map),M(this,Yo,new Map),M(this,Xo,new Map);const n=[];for(const o of t)try{n.push(gf.from(o))}catch(a){console.log(`[Warning] Invalid Fragment ${JSON.stringify(o)}:`,a.message)}Me(this,{fragments:Object.freeze(n)});let s=null,i=!1;M(this,An,this.getAbiCoder()),this.fragments.forEach((o,a)=>{let c;switch(o.type){case"constructor":if(this.deploy){console.log("duplicate definition - constructor");return}Me(this,{deploy:o});return;case"fallback":o.inputs.length===0?i=!0:(q(!s||o.payable!==s.payable,"conflicting fallback fragments",`fragments[${a}]`,o),s=o,i=s.payable);return;case"function":c=T(this,Zo);break;case"event":c=T(this,Xo);break;case"error":c=T(this,Yo);break;default:return}const l=o.format();c.has(l)||c.set(l,o)}),this.deploy||Me(this,{deploy:mc.from("constructor()")}),Me(this,{fallback:s,receive:i})}format(e){const t=e?"minimal":"full";return this.fragments.map(s=>s.format(t))}formatJson(){const e=this.fragments.map(t=>t.format("json"));return JSON.stringify(e.map(t=>JSON.parse(t)))}getAbiCoder(){return em.defaultAbiCoder()}getFunctionName(e){const t=te(this,ma,D4).call(this,e,null,!1);return q(t,"no matching function","key",e),t.name}hasFunction(e){return!!te(this,ma,D4).call(this,e,null,!1)}getFunction(e,t){return te(this,ma,D4).call(this,e,t||null,!0)}forEachFunction(e){const t=Array.from(T(this,Zo).keys());t.sort((n,s)=>n.localeCompare(s));for(let n=0;n<t.length;n++){const s=t[n];e(T(this,Zo).get(s),n)}}getEventName(e){const t=te(this,ma,O4).call(this,e,null,!1);return q(t,"no matching event","key",e),t.name}hasEvent(e){return!!te(this,ma,O4).call(this,e,null,!1)}getEvent(e,t){return te(this,ma,O4).call(this,e,t||null,!0)}forEachEvent(e){const t=Array.from(T(this,Xo).keys());t.sort((n,s)=>n.localeCompare(s));for(let n=0;n<t.length;n++){const s=t[n];e(T(this,Xo).get(s),n)}}getError(e,t){if($t(e)){const s=e.toLowerCase();if(pz[s])return gs.from(pz[s].signature);for(const i of T(this,Yo).values())if(s===i.selector)return i;return null}if(e.indexOf("(")===-1){const s=[];for(const[i,o]of T(this,Yo))i.split("(")[0]===e&&s.push(o);if(s.length===0)return e==="Error"?gs.from("error Error(string)"):e==="Panic"?gs.from("error Panic(uint256)"):null;if(s.length>1){const i=s.map(o=>JSON.stringify(o.format())).join(", ");q(!1,`ambiguous error description (i.e. ${i})`,"name",e)}return s[0]}if(e=gs.from(e).format(),e==="Error(string)")return gs.from("error Error(string)");if(e==="Panic(uint256)")return gs.from("error Panic(uint256)");const n=T(this,Yo).get(e);return n||null}forEachError(e){const t=Array.from(T(this,Yo).keys());t.sort((n,s)=>n.localeCompare(s));for(let n=0;n<t.length;n++){const s=t[n];e(T(this,Yo).get(s),n)}}_decodeParams(e,t){return T(this,An).decode(e,t)}_encodeParams(e,t){return T(this,An).encode(e,t)}encodeDeploy(e){return this._encodeParams(this.deploy.inputs,e||[])}decodeErrorResult(e,t){if(typeof e=="string"){const n=this.getError(e);q(n,"unknown error","fragment",e),e=n}return q(sr(t,0,4)===e.selector,`data signature does not match error ${e.name}.`,"data",t),this._decodeParams(e.inputs,sr(t,4))}encodeErrorResult(e,t){if(typeof e=="string"){const n=this.getError(e);q(n,"unknown error","fragment",e),e=n}return pr([e.selector,this._encodeParams(e.inputs,t||[])])}decodeFunctionData(e,t){if(typeof e=="string"){const n=this.getFunction(e);q(n,"unknown function","fragment",e),e=n}return q(sr(t,0,4)===e.selector,`data signature does not match function ${e.name}.`,"data",t),this._decodeParams(e.inputs,sr(t,4))}encodeFunctionData(e,t){if(typeof e=="string"){const n=this.getFunction(e);q(n,"unknown function","fragment",e),e=n}return pr([e.selector,this._encodeParams(e.inputs,t||[])])}decodeFunctionResult(e,t){if(typeof e=="string"){const i=this.getFunction(e);q(i,"unknown function","fragment",e),e=i}let n="invalid length for result data";const s=zn(t);if(s.length%32===0)try{return T(this,An).decode(e.outputs,s)}catch{n="could not decode result data"}se(!1,n,"BAD_DATA",{value:ke(s),info:{method:e.name,signature:e.format()}})}makeError(e,t){const n=dt(e,"data"),s=em.getBuiltinCallException("call",t,n);if(s.message.startsWith("execution reverted (unknown custom error)")){const a=ke(n.slice(0,4)),c=this.getError(a);if(c)try{const l=T(this,An).decode(c.inputs,n.slice(4));s.revert={name:c.name,signature:c.format(),args:l},s.reason=s.revert.signature,s.message=`execution reverted: ${s.reason}`}catch{s.message="execution reverted (coult not decode custom error)"}}const o=this.parseTransaction(t);return o&&(s.invocation={method:o.name,signature:o.signature,args:o.args}),s}encodeFunctionResult(e,t){if(typeof e=="string"){const n=this.getFunction(e);q(n,"unknown function","fragment",e),e=n}return ke(T(this,An).encode(e.outputs,t||[]))}encodeFilterTopics(e,t){if(typeof e=="string"){const i=this.getEvent(e);q(i,"unknown event","eventFragment",e),e=i}se(t.length<=e.inputs.length,`too many arguments for ${e.format()}`,"UNEXPECTED_ARGUMENT",{count:t.length,expectedCount:e.inputs.length});const n=[];e.anonymous||n.push(e.topicHash);const s=(i,o)=>i.type==="string"?ff(o):i.type==="bytes"?br(ke(o)):(i.type==="bool"&&typeof o=="boolean"?o=o?"0x01":"0x00":i.type.match(/^u?int/)?o=Ju(o):i.type.match(/^bytes/)?o=WBe(o,32):i.type==="address"&&T(this,An).encode(["address"],[o]),hf(ke(o),32));for(t.forEach((i,o)=>{const a=e.inputs[o];if(!a.indexed){q(i==null,"cannot filter non-indexed parameters; must be null","contract."+a.name,i);return}i==null?n.push(null):a.baseType==="array"||a.baseType==="tuple"?q(!1,"filtering with tuples or arrays not supported","contract."+a.name,i):Array.isArray(i)?n.push(i.map(c=>s(a,c))):n.push(s(a,i))});n.length&&n[n.length-1]===null;)n.pop();return n}encodeEventLog(e,t){if(typeof e=="string"){const o=this.getEvent(e);q(o,"unknown event","eventFragment",e),e=o}const n=[],s=[],i=[];return e.anonymous||n.push(e.topicHash),q(t.length===e.inputs.length,"event arguments/values mismatch","values",t),e.inputs.forEach((o,a)=>{const c=t[a];if(o.indexed)if(o.type==="string")n.push(ff(c));else if(o.type==="bytes")n.push(br(c));else{if(o.baseType==="tuple"||o.baseType==="array")throw new Error("not implemented");n.push(T(this,An).encode([o.type],[c]))}else s.push(o),i.push(c)}),{data:T(this,An).encode(s,i),topics:n}}decodeEventLog(e,t,n){if(typeof e=="string"){const y=this.getEvent(e);q(y,"unknown event","eventFragment",e),e=y}if(n!=null&&!e.anonymous){const y=e.topicHash;q($t(n[0],32)&&n[0].toLowerCase()===y,"fragment/topic mismatch","topics[0]",n[0]),n=n.slice(1)}const s=[],i=[],o=[];e.inputs.forEach((y,f)=>{y.indexed?y.type==="string"||y.type==="bytes"||y.baseType==="tuple"||y.baseType==="array"?(s.push(Yr.from({type:"bytes32",name:y.name})),o.push(!0)):(s.push(y),o.push(!1)):(i.push(y),o.push(!1))});const a=n!=null?T(this,An).decode(s,pr(n)):null,c=T(this,An).decode(i,t,!0),l=[],u=[];let d=0,p=0;return e.inputs.forEach((y,f)=>{let g=null;if(y.indexed)if(a==null)g=new dz(null);else if(o[f])g=new dz(a[p++]);else try{g=a[p++]}catch(w){g=w}else try{g=c[d++]}catch(w){g=w}l.push(g),u.push(y.name||null)}),D1.fromItems(l,u)}parseTransaction(e){const t=dt(e.data,"tx.data"),n=Pe(e.value!=null?e.value:0,"tx.value"),s=this.getFunction(ke(t.slice(0,4)));if(!s)return null;const i=T(this,An).decode(s.inputs,t.slice(4));return new xUe(s,s.selector,i,n)}parseCallResult(e){throw new Error("@TODO")}parseLog(e){const t=this.getEvent(e.topics[0]);return!t||t.anonymous?null:new EUe(t,t.topicHash,this.decodeEventLog(t,e.data,e.topics))}parseError(e){const t=ke(e),n=this.getError(sr(t,0,4));if(!n)return null;const s=T(this,An).decode(n.inputs,sr(t,4));return new AUe(n,n.selector,s)}static from(e){return e instanceof Uh?e:typeof e=="string"?new Uh(JSON.parse(e)):typeof e.formatJson=="function"?new Uh(e.formatJson()):typeof e.format=="function"?new Uh(e.format("json")):new Uh(e)}};Yo=new WeakMap,Xo=new WeakMap,Zo=new WeakMap,An=new WeakMap,ma=new WeakSet,D4=function(e,t,n){if($t(e)){const i=e.toLowerCase();for(const o of T(this,Zo).values())if(i===o.selector)return o;return null}if(e.indexOf("(")===-1){const i=[];for(const[o,a]of T(this,Zo))o.split("(")[0]===e&&i.push(a);if(t){const o=t.length>0?t[t.length-1]:null;let a=t.length,c=!0;Dn.isTyped(o)&&o.type==="overrides"&&(c=!1,a--);for(let l=i.length-1;l>=0;l--){const u=i[l].inputs.length;u!==a&&(!c||u!==a-1)&&i.splice(l,1)}for(let l=i.length-1;l>=0;l--){const u=i[l].inputs;for(let d=0;d<t.length;d++)if(Dn.isTyped(t[d])){if(d>=u.length){if(t[d].type==="overrides")continue;i.splice(l,1);break}if(t[d].type!==u[d].baseType){i.splice(l,1);break}}}}if(i.length===1&&t&&t.length!==i[0].inputs.length){const o=t[t.length-1];(o==null||Array.isArray(o)||typeof o!="object")&&i.splice(0,1)}if(i.length===0)return null;if(i.length>1&&n){const o=i.map(a=>JSON.stringify(a.format())).join(", ");q(!1,`ambiguous function description (i.e. matches ${o})`,"key",e)}return i[0]}const s=T(this,Zo).get(ca.from(e).format());return s||null},O4=function(e,t,n){if($t(e)){const i=e.toLowerCase();for(const o of T(this,Xo).values())if(i===o.topicHash)return o;return null}if(e.indexOf("(")===-1){const i=[];for(const[o,a]of T(this,Xo))o.split("(")[0]===e&&i.push(a);if(t){for(let o=i.length-1;o>=0;o--)i[o].inputs.length<t.length&&i.splice(o,1);for(let o=i.length-1;o>=0;o--){const a=i[o].inputs;for(let c=0;c<t.length;c++)if(Dn.isTyped(t[c])&&t[c].type!==a[c].baseType){i.splice(o,1);break}}}if(i.length===0)return null;if(i.length>1&&n){const o=i.map(a=>JSON.stringify(a.format())).join(", ");q(!1,`ambiguous event description (i.e. matches ${o})`,"key",e)}return i[0]}const s=T(this,Xo).get(aa.from(e).format());return s||null};let lk=Uh;const nre=BigInt(0);function jp(r){return r??null}function lr(r){return r==null?null:r.toString()}class gz{constructor(e,t,n){h(this,"gasPrice");h(this,"maxFeePerGas");h(this,"maxPriorityFeePerGas");Me(this,{gasPrice:jp(e),maxFeePerGas:jp(t),maxPriorityFeePerGas:jp(n)})}toJSON(){const{gasPrice:e,maxFeePerGas:t,maxPriorityFeePerGas:n}=this;return{_type:"FeeData",gasPrice:lr(e),maxFeePerGas:lr(t),maxPriorityFeePerGas:lr(n)}}}function V6(r){const e={};r.to&&(e.to=r.to),r.from&&(e.from=r.from),r.data&&(e.data=ke(r.data));const t="chainId,gasLimit,gasPrice,maxFeePerBlobGas,maxFeePerGas,maxPriorityFeePerGas,value".split(/,/);for(const s of t)!(s in r)||r[s]==null||(e[s]=Pe(r[s],`request.${s}`));const n="type,nonce".split(/,/);for(const s of n)!(s in r)||r[s]==null||(e[s]=Ze(r[s],`request.${s}`));return r.accessList&&(e.accessList=Nf(r.accessList)),"blockTag"in r&&(e.blockTag=r.blockTag),"enableCcipRead"in r&&(e.enableCcipRead=!!r.enableCcipRead),"customData"in r&&(e.customData=r.customData),"blobVersionedHashes"in r&&r.blobVersionedHashes&&(e.blobVersionedHashes=r.blobVersionedHashes.slice()),"kzg"in r&&(e.kzg=r.kzg),"blobs"in r&&r.blobs&&(e.blobs=r.blobs.map(s=>_N(s)?ke(s):Object.assign({},s))),e}var sc;class SUe{constructor(e,t){h(this,"provider");h(this,"number");h(this,"hash");h(this,"timestamp");h(this,"parentHash");h(this,"parentBeaconBlockRoot");h(this,"nonce");h(this,"difficulty");h(this,"gasLimit");h(this,"gasUsed");h(this,"stateRoot");h(this,"receiptsRoot");h(this,"blobGasUsed");h(this,"excessBlobGas");h(this,"miner");h(this,"prevRandao");h(this,"extraData");h(this,"baseFeePerGas");Q(this,sc);M(this,sc,e.transactions.map(n=>typeof n!="string"?new tm(n,t):n)),Me(this,{provider:t,hash:jp(e.hash),number:e.number,timestamp:e.timestamp,parentHash:e.parentHash,parentBeaconBlockRoot:e.parentBeaconBlockRoot,nonce:e.nonce,difficulty:e.difficulty,gasLimit:e.gasLimit,gasUsed:e.gasUsed,blobGasUsed:e.blobGasUsed,excessBlobGas:e.excessBlobGas,miner:e.miner,prevRandao:jp(e.prevRandao),extraData:e.extraData,baseFeePerGas:jp(e.baseFeePerGas),stateRoot:e.stateRoot,receiptsRoot:e.receiptsRoot})}get transactions(){return T(this,sc).map(e=>typeof e=="string"?e:e.hash)}get prefetchedTransactions(){const e=T(this,sc).slice();return e.length===0?[]:(se(typeof e[0]=="object","transactions were not prefetched with block request","UNSUPPORTED_OPERATION",{operation:"transactionResponses()"}),e)}toJSON(){const{baseFeePerGas:e,difficulty:t,extraData:n,gasLimit:s,gasUsed:i,hash:o,miner:a,prevRandao:c,nonce:l,number:u,parentHash:d,parentBeaconBlockRoot:p,stateRoot:y,receiptsRoot:f,timestamp:g,transactions:w}=this;return{_type:"Block",baseFeePerGas:lr(e),difficulty:lr(t),extraData:n,gasLimit:lr(s),gasUsed:lr(i),blobGasUsed:lr(this.blobGasUsed),excessBlobGas:lr(this.excessBlobGas),hash:o,miner:a,prevRandao:c,nonce:l,number:u,parentHash:d,timestamp:g,parentBeaconBlockRoot:p,stateRoot:y,receiptsRoot:f,transactions:w}}[Symbol.iterator](){let e=0;const t=this.transactions;return{next:()=>e<this.length?{value:t[e++],done:!1}:{value:void 0,done:!0}}}get length(){return T(this,sc).length}get date(){return this.timestamp==null?null:new Date(this.timestamp*1e3)}async getTransaction(e){let t;if(typeof e=="number")t=T(this,sc)[e];else{const n=e.toLowerCase();for(const s of T(this,sc))if(typeof s=="string"){if(s!==n)continue;t=s;break}else{if(s.hash!==n)continue;t=s;break}}if(t==null)throw new Error("no such tx");return typeof t=="string"?await this.provider.getTransaction(t):t}getPrefetchedTransaction(e){const t=this.prefetchedTransactions;if(typeof e=="number")return t[e];e=e.toLowerCase();for(const n of t)if(n.hash===e)return n;q(!1,"no matching transaction","indexOrHash",e)}isMined(){return!!this.hash}isLondon(){return!!this.baseFeePerGas}orphanedEvent(){if(!this.isMined())throw new Error("");return CUe(this)}}sc=new WeakMap;class fw{constructor(e,t){h(this,"provider");h(this,"transactionHash");h(this,"blockHash");h(this,"blockNumber");h(this,"removed");h(this,"address");h(this,"data");h(this,"topics");h(this,"index");h(this,"transactionIndex");this.provider=t;const n=Object.freeze(e.topics.slice());Me(this,{transactionHash:e.transactionHash,blockHash:e.blockHash,blockNumber:e.blockNumber,removed:e.removed,address:e.address,data:e.data,topics:n,index:e.index,transactionIndex:e.transactionIndex})}toJSON(){const{address:e,blockHash:t,blockNumber:n,data:s,index:i,removed:o,topics:a,transactionHash:c,transactionIndex:l}=this;return{_type:"log",address:e,blockHash:t,blockNumber:n,data:s,index:i,removed:o,topics:a,transactionHash:c,transactionIndex:l}}async getBlock(){const e=await this.provider.getBlock(this.blockHash);return se(!!e,"failed to find transaction","UNKNOWN_ERROR",{}),e}async getTransaction(){const e=await this.provider.getTransaction(this.transactionHash);return se(!!e,"failed to find transaction","UNKNOWN_ERROR",{}),e}async getTransactionReceipt(){const e=await this.provider.getTransactionReceipt(this.transactionHash);return se(!!e,"failed to find transaction receipt","UNKNOWN_ERROR",{}),e}removedEvent(){return IUe(this)}}var pm;class sre{constructor(e,t){h(this,"provider");h(this,"to");h(this,"from");h(this,"contractAddress");h(this,"hash");h(this,"index");h(this,"blockHash");h(this,"blockNumber");h(this,"logsBloom");h(this,"gasUsed");h(this,"blobGasUsed");h(this,"cumulativeGasUsed");h(this,"gasPrice");h(this,"blobGasPrice");h(this,"type");h(this,"status");h(this,"root");Q(this,pm);M(this,pm,Object.freeze(e.logs.map(s=>new fw(s,t))));let n=nre;e.effectiveGasPrice!=null?n=e.effectiveGasPrice:e.gasPrice!=null&&(n=e.gasPrice),Me(this,{provider:t,to:e.to,from:e.from,contractAddress:e.contractAddress,hash:e.hash,index:e.index,blockHash:e.blockHash,blockNumber:e.blockNumber,logsBloom:e.logsBloom,gasUsed:e.gasUsed,cumulativeGasUsed:e.cumulativeGasUsed,blobGasUsed:e.blobGasUsed,gasPrice:n,blobGasPrice:e.blobGasPrice,type:e.type,status:e.status,root:e.root})}get logs(){return T(this,pm)}toJSON(){const{to:e,from:t,contractAddress:n,hash:s,index:i,blockHash:o,blockNumber:a,logsBloom:c,logs:l,status:u,root:d}=this;return{_type:"TransactionReceipt",blockHash:o,blockNumber:a,contractAddress:n,cumulativeGasUsed:lr(this.cumulativeGasUsed),from:t,gasPrice:lr(this.gasPrice),blobGasUsed:lr(this.blobGasUsed),blobGasPrice:lr(this.blobGasPrice),gasUsed:lr(this.gasUsed),hash:s,index:i,logs:l,logsBloom:c,root:d,status:u,to:e}}get length(){return this.logs.length}[Symbol.iterator](){let e=0;return{next:()=>e<this.length?{value:this.logs[e++],done:!1}:{value:void 0,done:!0}}}get fee(){return this.gasUsed*this.gasPrice}async getBlock(){const e=await this.provider.getBlock(this.blockHash);if(e==null)throw new Error("TODO");return e}async getTransaction(){const e=await this.provider.getTransaction(this.hash);if(e==null)throw new Error("TODO");return e}async getResult(){return await this.provider.getTransactionResult(this.hash)}async confirmations(){return await this.provider.getBlockNumber()-this.blockNumber+1}removedEvent(){return ore(this)}reorderedEvent(e){return se(!e||e.isMined(),"unmined 'other' transction cannot be orphaned","UNSUPPORTED_OPERATION",{operation:"reorderedEvent(other)"}),ire(this,e)}}pm=new WeakMap;var Yl;const ZN=class ZN{constructor(e,t){h(this,"provider");h(this,"blockNumber");h(this,"blockHash");h(this,"index");h(this,"hash");h(this,"type");h(this,"to");h(this,"from");h(this,"nonce");h(this,"gasLimit");h(this,"gasPrice");h(this,"maxPriorityFeePerGas");h(this,"maxFeePerGas");h(this,"maxFeePerBlobGas");h(this,"data");h(this,"value");h(this,"chainId");h(this,"signature");h(this,"accessList");h(this,"blobVersionedHashes");Q(this,Yl);this.provider=t,this.blockNumber=e.blockNumber!=null?e.blockNumber:null,this.blockHash=e.blockHash!=null?e.blockHash:null,this.hash=e.hash,this.index=e.index,this.type=e.type,this.from=e.from,this.to=e.to||null,this.gasLimit=e.gasLimit,this.nonce=e.nonce,this.data=e.data,this.value=e.value,this.gasPrice=e.gasPrice,this.maxPriorityFeePerGas=e.maxPriorityFeePerGas!=null?e.maxPriorityFeePerGas:null,this.maxFeePerGas=e.maxFeePerGas!=null?e.maxFeePerGas:null,this.maxFeePerBlobGas=e.maxFeePerBlobGas!=null?e.maxFeePerBlobGas:null,this.chainId=e.chainId,this.signature=e.signature,this.accessList=e.accessList!=null?e.accessList:null,this.blobVersionedHashes=e.blobVersionedHashes!=null?e.blobVersionedHashes:null,M(this,Yl,-1)}toJSON(){const{blockNumber:e,blockHash:t,index:n,hash:s,type:i,to:o,from:a,nonce:c,data:l,signature:u,accessList:d,blobVersionedHashes:p}=this;return{_type:"TransactionResponse",accessList:d,blockNumber:e,blockHash:t,blobVersionedHashes:p,chainId:lr(this.chainId),data:l,from:a,gasLimit:lr(this.gasLimit),gasPrice:lr(this.gasPrice),hash:s,maxFeePerGas:lr(this.maxFeePerGas),maxPriorityFeePerGas:lr(this.maxPriorityFeePerGas),maxFeePerBlobGas:lr(this.maxFeePerBlobGas),nonce:c,signature:u,to:o,index:n,type:i,value:lr(this.value)}}async getBlock(){let e=this.blockNumber;if(e==null){const n=await this.getTransaction();n&&(e=n.blockNumber)}if(e==null)return null;const t=this.provider.getBlock(e);if(t==null)throw new Error("TODO");return t}async getTransaction(){return this.provider.getTransaction(this.hash)}async confirmations(){if(this.blockNumber==null){const{tx:t,blockNumber:n}=await Ln({tx:this.getTransaction(),blockNumber:this.provider.getBlockNumber()});return t==null||t.blockNumber==null?0:n-t.blockNumber+1}return await this.provider.getBlockNumber()-this.blockNumber+1}async wait(e,t){const n=e??1,s=t??0;let i=T(this,Yl),o=-1,a=i===-1;const c=async()=>{if(a)return null;const{blockNumber:p,nonce:y}=await Ln({blockNumber:this.provider.getBlockNumber(),nonce:this.provider.getTransactionCount(this.from)});if(y<this.nonce){i=p;return}if(a)return null;const f=await this.getTransaction();if(!(f&&f.blockNumber!=null))for(o===-1&&(o=i-3,o<T(this,Yl)&&(o=T(this,Yl)));o<=p;){if(a)return null;const g=await this.provider.getBlock(o,!0);if(g==null)return;for(const w of g)if(w===this.hash)return;for(let w=0;w<g.length;w++){const m=await g.getTransaction(w);if(m.from===this.from&&m.nonce===this.nonce){if(a)return null;const b=await this.provider.getTransactionReceipt(m.hash);if(b==null||p-b.blockNumber+1<n)return;let v="replaced";m.data===this.data&&m.to===this.to&&m.value===this.value?v="repriced":m.data==="0x"&&m.from===m.to&&m.value===nre&&(v="cancelled"),se(!1,"transaction was replaced","TRANSACTION_REPLACED",{cancelled:v==="replaced"||v==="cancelled",reason:v,replacement:m.replaceableTransaction(i),hash:m.hash,receipt:b})}}o++}},l=p=>{if(p==null||p.status!==0)return p;se(!1,"transaction execution reverted","CALL_EXCEPTION",{action:"sendTransaction",data:null,reason:null,invocation:null,revert:null,transaction:{to:p.to,from:p.from,data:""},receipt:p})},u=await this.provider.getTransactionReceipt(this.hash);if(n===0)return l(u);if(u){if(await u.confirmations()>=n)return l(u)}else if(await c(),n===0)return null;return await new Promise((p,y)=>{const f=[],g=()=>{f.forEach(m=>m())};if(f.push(()=>{a=!0}),s>0){const m=setTimeout(()=>{g(),y(rr("wait for transaction timeout","TIMEOUT"))},s);f.push(()=>{clearTimeout(m)})}const w=async m=>{if(await m.confirmations()>=n){g();try{p(l(m))}catch(b){y(b)}}};if(f.push(()=>{this.provider.off(this.hash,w)}),this.provider.on(this.hash,w),i>=0){const m=async()=>{try{await c()}catch(b){if(qr(b,"TRANSACTION_REPLACED")){g(),y(b);return}}a||this.provider.once("block",m)};f.push(()=>{this.provider.off("block",m)}),this.provider.once("block",m)}})}isMined(){return this.blockHash!=null}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}removedEvent(){return se(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),ore(this)}reorderedEvent(e){return se(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),se(!e||e.isMined(),"unmined 'other' transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),ire(this,e)}replaceableTransaction(e){q(Number.isInteger(e)&&e>=0,"invalid startBlock","startBlock",e);const t=new ZN(this,this.provider);return M(t,Yl,e),t}};Yl=new WeakMap;let tm=ZN;function CUe(r){return{orphan:"drop-block",hash:r.hash,number:r.number}}function ire(r,e){return{orphan:"reorder-transaction",tx:r,other:e}}function ore(r){return{orphan:"drop-transaction",tx:r}}function IUe(r){return{orphan:"drop-log",log:{transactionHash:r.transactionHash,blockHash:r.blockHash,blockNumber:r.blockNumber,address:r.address,data:r.data,topics:Object.freeze(r.topics.slice()),index:r.index}}}class jN extends fw{constructor(t,n,s){super(t,t.provider);h(this,"interface");h(this,"fragment");h(this,"args");const i=n.decodeEventLog(s,t.data,t.topics);Me(this,{args:i,fragment:s,interface:n})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}class are extends fw{constructor(t,n){super(t,t.provider);h(this,"error");Me(this,{error:n})}}var T0;class kUe extends sre{constructor(t,n,s){super(s,n);Q(this,T0);M(this,T0,t)}get logs(){return super.logs.map(t=>{const n=t.topics.length?T(this,T0).getEvent(t.topics[0]):null;if(n)try{return new jN(t,T(this,T0),n)}catch(s){return new are(t,s)}return t})}}T0=new WeakMap;var gm;class qN extends tm{constructor(t,n,s){super(s,n);Q(this,gm);M(this,gm,t)}async wait(t,n){const s=await super.wait(t,n);return s==null?null:new kUe(T(this,gm),this.provider,s)}}gm=new WeakMap;class cre extends Bee{constructor(t,n,s,i){super(t,n,s);h(this,"log");Me(this,{log:i})}async getBlock(){return await this.log.getBlock()}async getTransaction(){return await this.log.getTransaction()}async getTransactionReceipt(){return await this.log.getTransactionReceipt()}}class TUe extends cre{constructor(e,t,n,s,i){super(e,t,n,new jN(i,e.interface,s));const o=e.interface.decodeEventLog(s,this.log.data,this.log.topics);Me(this,{args:o,fragment:s})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}const yz=BigInt(0);function lre(r){return r&&typeof r.call=="function"}function ure(r){return r&&typeof r.estimateGas=="function"}function $7(r){return r&&typeof r.resolveName=="function"}function hre(r){return r&&typeof r.sendTransaction=="function"}function dre(r){if(r!=null){if($7(r))return r;if(r.provider)return r.provider}}var ym;class _Ue{constructor(e,t,n){Q(this,ym);h(this,"fragment");if(Me(this,{fragment:t}),t.inputs.length<n.length)throw new Error("too many arguments");const s=yf(e.runner,"resolveName"),i=$7(s)?s:null;M(this,ym,async function(){const o=await Promise.all(t.inputs.map((a,c)=>n[c]==null?null:a.walkAsync(n[c],(u,d)=>u==="address"?Array.isArray(d)?Promise.all(d.map(p=>Gn(p,i))):Gn(d,i):d)));return e.interface.encodeFilterTopics(t,o)}())}getTopicFilter(){return T(this,ym)}}ym=new WeakMap;function yf(r,e){return r==null?null:typeof r[e]=="function"?r:r.provider&&typeof r.provider[e]=="function"?r.provider:null}function Yh(r){return r==null?null:r.provider||null}async function fre(r,e){const t=Dn.dereference(r,"overrides");q(typeof t=="object","invalid overrides parameter","overrides",r);const n=V6(t);return q(n.to==null||(e||[]).indexOf("to")>=0,"cannot override to","overrides.to",n.to),q(n.data==null||(e||[]).indexOf("data")>=0,"cannot override data","overrides.data",n.data),n.from&&(n.from=n.from),n}async function PUe(r,e,t){const n=yf(r,"resolveName"),s=$7(n)?n:null;return await Promise.all(e.map((i,o)=>i.walkAsync(t[o],(a,c)=>(c=Dn.dereference(c,a),a==="address"?Gn(c,s):c))))}function NUe(r){const e=async function(o){const a=await fre(o,["data"]);a.to=await r.getAddress(),a.from&&(a.from=await Gn(a.from,dre(r.runner)));const c=r.interface,l=Pe(a.value||yz,"overrides.value")===yz,u=(a.data||"0x")==="0x";c.fallback&&!c.fallback.payable&&c.receive&&!u&&!l&&q(!1,"cannot send data to receive or send value to non-payable fallback","overrides",o),q(c.fallback||u,"cannot send data to receive-only contract","overrides.data",a.data);const d=c.receive||c.fallback&&c.fallback.payable;return q(d||l,"cannot send value to non-payable fallback","overrides.value",a.value),q(c.fallback||u,"cannot send data to receive-only contract","overrides.data",a.data),a},t=async function(o){const a=yf(r.runner,"call");se(lre(a),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const c=await e(o);try{return await a.call(c)}catch(l){throw TN(l)&&l.data?r.interface.makeError(l.data,c):l}},n=async function(o){const a=r.runner;se(hre(a),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const c=await a.sendTransaction(await e(o)),l=Yh(r.runner);return new qN(r.interface,l,c)},s=async function(o){const a=yf(r.runner,"estimateGas");return se(ure(a),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await a.estimateGas(await e(o))},i=async o=>await n(o);return Me(i,{_contract:r,estimateGas:s,populateTransaction:e,send:n,staticCall:t}),i}function DUe(r,e){const t=function(...l){const u=r.interface.getFunction(e,l);return se(u,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e,args:l}}),u},n=async function(...l){const u=t(...l);let d={};if(u.inputs.length+1===l.length&&(d=await fre(l.pop()),d.from&&(d.from=await Gn(d.from,dre(r.runner)))),u.inputs.length!==l.length)throw new Error("internal error: fragment inputs doesn't match arguments; should not happen");const p=await PUe(r.runner,u.inputs,l);return Object.assign({},d,await Ln({to:r.getAddress(),data:r.interface.encodeFunctionData(u,p)}))},s=async function(...l){const u=await a(...l);return u.length===1?u[0]:u},i=async function(...l){const u=r.runner;se(hre(u),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const d=await u.sendTransaction(await n(...l)),p=Yh(r.runner);return new qN(r.interface,p,d)},o=async function(...l){const u=yf(r.runner,"estimateGas");return se(ure(u),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await u.estimateGas(await n(...l))},a=async function(...l){const u=yf(r.runner,"call");se(lre(u),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const d=await n(...l);let p="0x";try{p=await u.call(d)}catch(f){throw TN(f)&&f.data?r.interface.makeError(f.data,d):f}const y=t(...l);return r.interface.decodeFunctionResult(y,p)},c=async(...l)=>t(...l).constant?await s(...l):await i(...l);return Me(c,{name:r.interface.getFunctionName(e),_contract:r,_key:e,getFragment:t,estimateGas:o,populateTransaction:n,send:i,staticCall:s,staticCallResult:a}),Object.defineProperty(c,"fragment",{configurable:!1,enumerable:!0,get:()=>{const l=r.interface.getFunction(e);return se(l,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e}}),l}}),c}function OUe(r,e){const t=function(...s){const i=r.interface.getEvent(e,s);return se(i,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e,args:s}}),i},n=function(...s){return new _Ue(r,t(...s),s)};return Me(n,{name:r.interface.getEventName(e),_contract:r,_key:e,getFragment:t}),Object.defineProperty(n,"fragment",{configurable:!1,enumerable:!0,get:()=>{const s=r.interface.getEvent(e);return se(s,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e}}),s}}),n}const H6=Symbol.for("_ethersInternal_contract"),pre=new WeakMap;function RUe(r,e){pre.set(r[H6],e)}function Bs(r){return pre.get(r[H6])}function BUe(r){return r&&typeof r=="object"&&"getTopicFilter"in r&&typeof r.getTopicFilter=="function"&&r.fragment}async function WN(r,e){let t,n=null;if(Array.isArray(e)){const i=function(o){if($t(o,32))return o;const a=r.interface.getEvent(o);return q(a,"unknown fragment","name",o),a.topicHash};t=e.map(o=>o==null?null:Array.isArray(o)?o.map(i):i(o))}else e==="*"?t=[null]:typeof e=="string"?$t(e,32)?t=[e]:(n=r.interface.getEvent(e),q(n,"unknown fragment","event",e),t=[n.topicHash]):BUe(e)?t=await e.getTopicFilter():"fragment"in e?(n=e.fragment,t=[n.topicHash]):q(!1,"unknown event name","event",e);t=t.map(i=>{if(i==null)return null;if(Array.isArray(i)){const o=Array.from(new Set(i.map(a=>a.toLowerCase())).values());return o.length===1?o[0]:(o.sort(),o)}return i.toLowerCase()});const s=t.map(i=>i==null?"null":Array.isArray(i)?i.join("|"):i).join("&");return{fragment:n,tag:s,topics:t}}async function w2(r,e){const{subs:t}=Bs(r);return t.get((await WN(r,e)).tag)||null}async function mz(r,e,t){const n=Yh(r.runner);se(n,"contract runner does not support subscribing","UNSUPPORTED_OPERATION",{operation:e});const{fragment:s,tag:i,topics:o}=await WN(r,t),{addr:a,subs:c}=Bs(r);let l=c.get(i);if(!l){const d={address:a||r,topics:o},p=w=>{let m=s;if(m==null)try{m=r.interface.getEvent(w.topics[0])}catch{}if(m){const b=m,v=s?r.interface.decodeEventLog(s,w.data,w.topics):[];hk(r,t,v,E=>new TUe(r,E,t,b,w))}else hk(r,t,[],b=>new cre(r,b,t,w))};let y=[];l={tag:i,listeners:[],start:()=>{y.length||y.push(n.on(d,p))},stop:async()=>{if(y.length==0)return;let w=y;y=[],await Promise.all(w),n.off(d,p)}},c.set(i,l)}return l}let uk=Promise.resolve();async function MUe(r,e,t,n){await uk;const s=await w2(r,e);if(!s)return!1;const i=s.listeners.length;return s.listeners=s.listeners.filter(({listener:o,once:a})=>{const c=Array.from(t);n&&c.push(n(a?null:o));try{o.call(r,...c)}catch{}return!a}),s.listeners.length===0&&(s.stop(),Bs(r).subs.delete(s.tag)),i>0}async function hk(r,e,t,n){try{await uk}catch{}const s=MUe(r,e,t,n);return uk=s,await s}const O3=["then"];var eH;eH=H6;const q2=class q2{constructor(e,t,n,s){h(this,"target");h(this,"interface");h(this,"runner");h(this,"filters");h(this,eH);h(this,"fallback");q(typeof e=="string"||vte(e),"invalid value for Contract target","target",e),n==null&&(n=null);const i=lk.from(t);Me(this,{target:e,runner:n,interface:i}),Object.defineProperty(this,H6,{value:{}});let o,a=null,c=null;if(s){const d=Yh(n);c=new qN(this.interface,d,s)}let l=new Map;if(typeof e=="string")if($t(e))a=e,o=Promise.resolve(e);else{const d=yf(n,"resolveName");if(!$7(d))throw rr("contract runner does not support name resolution","UNSUPPORTED_OPERATION",{operation:"resolveName"});o=d.resolveName(e).then(p=>{if(p==null)throw rr("an ENS name used for a contract target must be correctly configured","UNCONFIGURED_NAME",{value:e});return Bs(this).addr=p,p})}else o=e.getAddress().then(d=>{if(d==null)throw new Error("TODO");return Bs(this).addr=d,d});RUe(this,{addrPromise:o,addr:a,deployTx:c,subs:l});const u=new Proxy({},{get:(d,p,y)=>{if(typeof p=="symbol"||O3.indexOf(p)>=0)return Reflect.get(d,p,y);try{return this.getEvent(p)}catch(f){if(!qr(f,"INVALID_ARGUMENT")||f.argument!=="key")throw f}},has:(d,p)=>O3.indexOf(p)>=0?Reflect.has(d,p):Reflect.has(d,p)||this.interface.hasEvent(String(p))});return Me(this,{filters:u}),Me(this,{fallback:i.receive||i.fallback?NUe(this):null}),new Proxy(this,{get:(d,p,y)=>{if(typeof p=="symbol"||p in d||O3.indexOf(p)>=0)return Reflect.get(d,p,y);try{return d.getFunction(p)}catch(f){if(!qr(f,"INVALID_ARGUMENT")||f.argument!=="key")throw f}},has:(d,p)=>typeof p=="symbol"||p in d||O3.indexOf(p)>=0?Reflect.has(d,p):d.interface.hasFunction(p)})}connect(e){return new q2(this.target,this.interface,e)}attach(e){return new q2(e,this.interface,this.runner)}async getAddress(){return await Bs(this).addrPromise}async getDeployedCode(){const e=Yh(this.runner);se(e,"runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"getDeployedCode"});const t=await e.getCode(await this.getAddress());return t==="0x"?null:t}async waitForDeployment(){const e=this.deploymentTransaction();if(e)return await e.wait(),this;if(await this.getDeployedCode()!=null)return this;const n=Yh(this.runner);return se(n!=null,"contract runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"waitForDeployment"}),new Promise((s,i)=>{const o=async()=>{try{if(await this.getDeployedCode()!=null)return s(this);n.once("block",o)}catch(a){i(a)}};o()})}deploymentTransaction(){return Bs(this).deployTx}getFunction(e){return typeof e!="string"&&(e=e.format()),DUe(this,e)}getEvent(e){return typeof e!="string"&&(e=e.format()),OUe(this,e)}async queryTransaction(e){throw new Error("@TODO")}async queryFilter(e,t,n){t==null&&(t=0),n==null&&(n="latest");const{addr:s,addrPromise:i}=Bs(this),o=s||await i,{fragment:a,topics:c}=await WN(this,e),l={address:o,topics:c,fromBlock:t,toBlock:n},u=Yh(this.runner);return se(u,"contract runner does not have a provider","UNSUPPORTED_OPERATION",{operation:"queryFilter"}),(await u.getLogs(l)).map(d=>{let p=a;if(p==null)try{p=this.interface.getEvent(d.topics[0])}catch{}if(p)try{return new jN(d,this.interface,p)}catch(y){return new are(d,y)}return new fw(d,u)})}async on(e,t){const n=await mz(this,"on",e);return n.listeners.push({listener:t,once:!1}),n.start(),this}async once(e,t){const n=await mz(this,"once",e);return n.listeners.push({listener:t,once:!0}),n.start(),this}async emit(e,...t){return await hk(this,e,t,null)}async listenerCount(e){if(e){const s=await w2(this,e);return s?s.listeners.length:0}const{subs:t}=Bs(this);let n=0;for(const{listeners:s}of t.values())n+=s.length;return n}async listeners(e){if(e){const s=await w2(this,e);return s?s.listeners.map(({listener:i})=>i):[]}const{subs:t}=Bs(this);let n=[];for(const{listeners:s}of t.values())n=n.concat(s.map(({listener:i})=>i));return n}async off(e,t){const n=await w2(this,e);if(!n)return this;if(t){const s=n.listeners.map(({listener:i})=>i).indexOf(t);s>=0&&n.listeners.splice(s,1)}return(t==null||n.listeners.length===0)&&(n.stop(),Bs(this).subs.delete(n.tag)),this}async removeAllListeners(e){if(e){const t=await w2(this,e);if(!t)return this;t.stop(),Bs(this).subs.delete(t.tag)}else{const{subs:t}=Bs(this);for(const{tag:n,stop:s}of t.values())s(),t.delete(n)}return this}async addListener(e,t){return await this.on(e,t)}async removeListener(e,t){return await this.off(e,t)}static buildClass(e){class t extends q2{constructor(s,i=null){super(s,e,i)}}return t}static from(e,t,n){return n==null&&(n=null),new this(e,t,n)}};let dk=q2;function $Ue(){return dk}class j2 extends $Ue(){}function ux(r){return r.match(/^ipfs:\/\/ipfs\//i)?r=r.substring(12):r.match(/^ipfs:\/\//i)?r=r.substring(7):q(!1,"unsupported IPFS format","link",r),`https://gateway.ipfs.io/ipfs/${r}`}class LUe{constructor(e){h(this,"name");Me(this,{name:e})}connect(e){return this}supportsCoinType(e){return!1}async encodeAddress(e,t){throw new Error("unsupported coin")}async decodeAddress(e,t){throw new Error("unsupported coin")}}const gre=new RegExp("^(ipfs)://(.*)$","i"),wz=[new RegExp("^(https)://(.*)$","i"),new RegExp("^(data):(.*)$","i"),gre,new RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")];var Xl,fd,Zl,sp,X6,yre;const Cp=class Cp{constructor(e,t,n){Q(this,Zl);h(this,"provider");h(this,"address");h(this,"name");Q(this,Xl);Q(this,fd);Me(this,{provider:e,address:t,name:n}),M(this,Xl,null),M(this,fd,new j2(t,["function supportsInterface(bytes4) view returns (bool)","function resolve(bytes, bytes) view returns (bytes)","function addr(bytes32) view returns (address)","function addr(bytes32, uint) view returns (bytes)","function text(bytes32, string) view returns (string)","function contenthash(bytes32) view returns (bytes)"],e))}async supportsWildcard(){return T(this,Xl)==null&&M(this,Xl,(async()=>{try{return await T(this,fd).supportsInterface("0x9061b923")}catch(e){if(qr(e,"CALL_EXCEPTION"))return!1;throw M(this,Xl,null),e}})()),await T(this,Xl)}async getAddress(e){if(e==null&&(e=60),e===60)try{const i=await te(this,Zl,sp).call(this,"addr(bytes32)");return i==null||i===qy?null:i}catch(i){if(qr(i,"CALL_EXCEPTION"))return null;throw i}if(e>=0&&e<2147483648){let i=e+2147483648;const o=await te(this,Zl,sp).call(this,"addr(bytes32,uint)",[i]);if($t(o,20))return _t(o)}let t=null;for(const i of this.provider.plugins)if(i instanceof LUe&&i.supportsCoinType(e)){t=i;break}if(t==null)return null;const n=await te(this,Zl,sp).call(this,"addr(bytes32,uint)",[e]);if(n==null||n==="0x")return null;const s=await t.decodeAddress(e,n);if(s!=null)return s;se(!1,"invalid coin data","UNSUPPORTED_OPERATION",{operation:`getAddress(${e})`,info:{coinType:e,data:n}})}async getText(e){const t=await te(this,Zl,sp).call(this,"text(bytes32,string)",[e]);return t==null||t==="0x"?null:t}async getContentHash(){const e=await te(this,Zl,sp).call(this,"contenthash(bytes32)");if(e==null||e==="0x")return null;const t=e.match(/^0x(e3010170|e5010172)(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(t){const s=t[1]==="e3010170"?"ipfs":"ipns",i=parseInt(t[4],16);if(t[5].length===i*2)return`${s}://${YBe("0x"+t[2])}`}const n=e.match(/^0xe40101fa011b20([0-9a-f]*)$/);if(n&&n[1].length===64)return`bzz://${n[1]}`;se(!1,"invalid or unsupported content hash data","UNSUPPORTED_OPERATION",{operation:"getContentHash()",info:{data:e}})}async getAvatar(){return(await this._getAvatar()).url}async _getAvatar(){const e=[{type:"name",value:this.name}];try{const t=await this.getText("avatar");if(t==null)return e.push({type:"!avatar",value:""}),{url:null,linkage:e};e.push({type:"avatar",value:t});for(let n=0;n<wz.length;n++){const s=t.match(wz[n]);if(s==null)continue;const i=s[1].toLowerCase();switch(i){case"https":case"data":return e.push({type:"url",value:t}),{linkage:e,url:t};case"ipfs":{const o=ux(t);return e.push({type:"ipfs",value:t}),e.push({type:"url",value:o}),{linkage:e,url:o}}case"erc721":case"erc1155":{const o=i==="erc721"?"tokenURI(uint256)":"uri(uint256)";e.push({type:i,value:t});const a=await this.getAddress();if(a==null)return e.push({type:"!owner",value:""}),{url:null,linkage:e};const c=(s[2]||"").split("/");if(c.length!==2)return e.push({type:`!${i}caip`,value:s[2]||""}),{url:null,linkage:e};const l=c[1],u=new j2(c[0],["function tokenURI(uint) view returns (string)","function ownerOf(uint) view returns (address)","function uri(uint) view returns (string)","function balanceOf(address, uint256) view returns (uint)"],this.provider);if(i==="erc721"){const g=await u.ownerOf(l);if(a!==g)return e.push({type:"!owner",value:g}),{url:null,linkage:e};e.push({type:"owner",value:g})}else if(i==="erc1155"){const g=await u.balanceOf(a,l);if(!g)return e.push({type:"!balance",value:"0"}),{url:null,linkage:e};e.push({type:"balance",value:g.toString()})}let d=await u[o](l);if(d==null||d==="0x")return e.push({type:"!metadata-url",value:""}),{url:null,linkage:e};e.push({type:"metadata-url-base",value:d}),i==="erc1155"&&(d=d.replace("{id}",Ju(l,32).substring(2)),e.push({type:"metadata-url-expanded",value:d})),d.match(/^ipfs:/i)&&(d=ux(d)),e.push({type:"metadata-url",value:d});let p={};const y=await new Yu(d).send();y.assertOk();try{p=y.bodyJson}catch{try{e.push({type:"!metadata",value:y.bodyText})}catch{const m=y.body;return m&&e.push({type:"!metadata",value:ke(m)}),{url:null,linkage:e}}return{url:null,linkage:e}}if(!p)return e.push({type:"!metadata",value:""}),{url:null,linkage:e};e.push({type:"metadata",value:JSON.stringify(p)});let f=p.image;if(typeof f!="string")return e.push({type:"!imageUrl",value:""}),{url:null,linkage:e};if(!f.match(/^(https:\/\/|data:)/i)){if(f.match(gre)==null)return e.push({type:"!imageUrl-ipfs",value:f}),{url:null,linkage:e};e.push({type:"imageUrl-ipfs",value:f}),f=ux(f)}return e.push({type:"url",value:f}),{linkage:e,url:f}}}}}catch{}return{linkage:e,url:null}}static async getEnsAddress(e){const t=await e.getNetwork(),n=t.getPlugin("org.ethers.plugins.network.Ens");return se(n,"network does not support ENS","UNSUPPORTED_OPERATION",{operation:"getEnsAddress",info:{network:t}}),n.address}static async fromName(e,t){var s;let n=t;for(;;){if(n===""||n==="."||t!=="eth"&&n==="eth")return null;const i=await te(s=Cp,X6,yre).call(s,e,n);if(i!=null){const o=new Cp(e,i,t);return n!==t&&!await o.supportsWildcard()?null:o}n=n.split(".").slice(1).join(".")}}};Xl=new WeakMap,fd=new WeakMap,Zl=new WeakSet,sp=async function(e,t){t=(t||[]).slice();const n=T(this,fd).interface;t.unshift(ak(this.name));let s=null;await this.supportsWildcard()&&(s=n.getFunction(e),se(s,"missing fragment","UNKNOWN_ERROR",{info:{funcName:e}}),t=[$Le(this.name,255),n.encodeFunctionData(s,t)],e="resolve(bytes,bytes)"),t.push({enableCcipRead:!0});try{const i=await T(this,fd)[e](...t);return s?n.decodeFunctionResult(s,i)[0]:i}catch(i){if(!qr(i,"CALL_EXCEPTION"))throw i}return null},X6=new WeakSet,yre=async function(e,t){const n=await Cp.getEnsAddress(e);try{const i=await new j2(n,["function resolver(bytes32) view returns (address)"],e).resolver(ak(t),{enableCcipRead:!0});return i===qy?null:i}catch(s){throw s}return null},Q(Cp,X6);let K6=Cp;const bz=BigInt(0);function ct(r,e){return function(t){return t==null?e:r(t)}}function L7(r,e){return t=>{if(e&&t==null)return null;if(!Array.isArray(t))throw new Error("not an array");return t.map(n=>r(n))}}function pw(r,e){return t=>{const n={};for(const s in r){let i=s;if(e&&s in e&&!(i in t)){for(const o of e[s])if(o in t){i=o;break}}try{const o=r[s](t[i]);o!==void 0&&(n[s]=o)}catch(o){const a=o instanceof Error?o.message:"not-an-error";se(!1,`invalid value for value.${s} (${a})`,"BAD_DATA",{value:t})}}return n}}function UUe(r){switch(r){case!0:case"true":return!0;case!1:case"false":return!1}q(!1,`invalid boolean; ${JSON.stringify(r)}`,"value",r)}function U1(r){return q($t(r,!0),"invalid data","value",r),r}function Gr(r){return q($t(r,32),"invalid hash","value",r),r}const FUe=pw({address:_t,blockHash:Gr,blockNumber:Ze,data:U1,index:Ze,removed:ct(UUe,!1),topics:L7(Gr),transactionHash:Gr,transactionIndex:Ze},{index:["logIndex"]});function zUe(r){return FUe(r)}const VUe=pw({hash:ct(Gr),parentHash:Gr,parentBeaconBlockRoot:ct(Gr,null),number:Ze,timestamp:Ze,nonce:ct(U1),difficulty:Pe,gasLimit:Pe,gasUsed:Pe,stateRoot:ct(Gr,null),receiptsRoot:ct(Gr,null),blobGasUsed:ct(Pe,null),excessBlobGas:ct(Pe,null),miner:ct(_t),prevRandao:ct(Gr,null),extraData:U1,baseFeePerGas:ct(Pe)},{prevRandao:["mixHash"]});function HUe(r){const e=VUe(r);return e.transactions=r.transactions.map(t=>typeof t=="string"?t:mre(t)),e}const KUe=pw({transactionIndex:Ze,blockNumber:Ze,transactionHash:Gr,address:_t,topics:L7(Gr),data:U1,index:Ze,blockHash:Gr},{index:["logIndex"]});function GUe(r){return KUe(r)}const jUe=pw({to:ct(_t,null),from:ct(_t,null),contractAddress:ct(_t,null),index:Ze,root:ct(ke),gasUsed:Pe,blobGasUsed:ct(Pe,null),logsBloom:ct(U1),blockHash:Gr,hash:Gr,logs:L7(GUe),blockNumber:Ze,cumulativeGasUsed:Pe,effectiveGasPrice:ct(Pe),blobGasPrice:ct(Pe,null),status:ct(Ze),type:ct(Ze,0)},{effectiveGasPrice:["gasPrice"],hash:["transactionHash"],index:["transactionIndex"]});function qUe(r){return jUe(r)}function mre(r){r.to&&Pe(r.to)===bz&&(r.to="0x0000000000000000000000000000000000000000");const e=pw({hash:Gr,index:ct(Ze,void 0),type:t=>t==="0x"||t==null?0:Ze(t),accessList:ct(Nf,null),blobVersionedHashes:ct(L7(Gr,!0),null),blockHash:ct(Gr,null),blockNumber:ct(Ze,null),transactionIndex:ct(Ze,null),from:_t,gasPrice:ct(Pe),maxPriorityFeePerGas:ct(Pe),maxFeePerGas:ct(Pe),maxFeePerBlobGas:ct(Pe,null),gasLimit:Pe,to:ct(_t,null),value:Pe,nonce:Ze,data:U1,creates:ct(_t,null),chainId:ct(Pe,null)},{data:["input"],gasLimit:["gas"],index:["transactionIndex"]})(r);if(e.to==null&&e.creates==null&&(e.creates=F$e(e)),(r.type===1||r.type===2)&&r.accessList==null&&(e.accessList=[]),r.signature?e.signature=To.from(r.signature):e.signature=To.from(r),e.chainId==null){const t=e.signature.legacyChainId;t!=null&&(e.chainId=t)}return e.blockHash&&Pe(e.blockHash)===bz&&(e.blockHash=null),e}const WUe="0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";class gw{constructor(e){h(this,"name");Me(this,{name:e})}clone(){return new gw(this.name)}}class U7 extends gw{constructor(t,n){t==null&&(t=0);super(`org.ethers.network.plugins.GasCost#${t||0}`);h(this,"effectiveBlock");h(this,"txBase");h(this,"txCreate");h(this,"txDataZero");h(this,"txDataNonzero");h(this,"txAccessListStorageKey");h(this,"txAccessListAddress");const s={effectiveBlock:t};function i(o,a){let c=(n||{})[o];c==null&&(c=a),q(typeof c=="number",`invalud value for ${o}`,"costs",n),s[o]=c}i("txBase",21e3),i("txCreate",32e3),i("txDataZero",4),i("txDataNonzero",16),i("txAccessListStorageKey",1900),i("txAccessListAddress",2400),Me(this,s)}clone(){return new U7(this.effectiveBlock,this)}}class F7 extends gw{constructor(t,n){super("org.ethers.plugins.network.Ens");h(this,"address");h(this,"targetNetwork");Me(this,{address:t||WUe,targetNetwork:n??1})}clone(){return new F7(this.address,this.targetNetwork)}}var mm,wm;class QUe extends gw{constructor(t,n){super("org.ethers.plugins.network.FetchUrlFeeDataPlugin");Q(this,mm);Q(this,wm);M(this,mm,t),M(this,wm,n)}get url(){return T(this,mm)}get processFunc(){return T(this,wm)}clone(){return this}}mm=new WeakMap,wm=new WeakMap;const hx=new Map;var _0,P0,eu;const Ip=class Ip{constructor(e,t){Q(this,_0);Q(this,P0);Q(this,eu);M(this,_0,e),M(this,P0,Pe(t)),M(this,eu,new Map)}toJSON(){return{name:this.name,chainId:String(this.chainId)}}get name(){return T(this,_0)}set name(e){M(this,_0,e)}get chainId(){return T(this,P0)}set chainId(e){M(this,P0,Pe(e,"chainId"))}matches(e){if(e==null)return!1;if(typeof e=="string"){try{return this.chainId===Pe(e)}catch{}return this.name===e}if(typeof e=="number"||typeof e=="bigint"){try{return this.chainId===Pe(e)}catch{}return!1}if(typeof e=="object"){if(e.chainId!=null){try{return this.chainId===Pe(e.chainId)}catch{}return!1}return e.name!=null?this.name===e.name:!1}return!1}get plugins(){return Array.from(T(this,eu).values())}attachPlugin(e){if(T(this,eu).get(e.name))throw new Error(`cannot replace existing plugin: ${e.name} `);return T(this,eu).set(e.name,e.clone()),this}getPlugin(e){return T(this,eu).get(e)||null}getPlugins(e){return this.plugins.filter(t=>t.name.split("#")[0]===e)}clone(){const e=new Ip(this.name,this.chainId);return this.plugins.forEach(t=>{e.attachPlugin(t.clone())}),e}computeIntrinsicGas(e){const t=this.getPlugin("org.ethers.plugins.network.GasCost")||new U7;let n=t.txBase;if(e.to==null&&(n+=t.txCreate),e.data)for(let s=2;s<e.data.length;s+=2)e.data.substring(s,s+2)==="00"?n+=t.txDataZero:n+=t.txDataNonzero;if(e.accessList){const s=Nf(e.accessList);for(const i in s)n+=t.txAccessListAddress+t.txAccessListStorageKey*s[i].storageKeys.length}return n}static from(e){if(JUe(),e==null)return Ip.from("mainnet");if(typeof e=="number"&&(e=BigInt(e)),typeof e=="string"||typeof e=="bigint"){const t=hx.get(e);if(t)return t();if(typeof e=="bigint")return new Ip("unknown",e);q(!1,"unknown network","network",e)}if(typeof e.clone=="function")return e.clone();if(typeof e=="object"){q(typeof e.name=="string"&&typeof e.chainId=="number","invalid network object name or chainId","network",e);const t=new Ip(e.name,e.chainId);return(e.ensAddress||e.ensNetwork!=null)&&t.attachPlugin(new F7(e.ensAddress,e.ensNetwork)),t}q(!1,"invalid network","network",e)}static register(e,t){typeof e=="number"&&(e=BigInt(e));const n=hx.get(e);n&&q(!1,`conflicting network for ${JSON.stringify(n.name)}`,"nameOrChainId",e),hx.set(e,t)}};_0=new WeakMap,P0=new WeakMap,eu=new WeakMap;let ua=Ip;function vz(r,e){const t=String(r);if(!t.match(/^[0-9.]+$/))throw new Error(`invalid gwei value: ${r}`);const n=t.split(".");if(n.length===1&&n.push(""),n.length!==2)throw new Error(`invalid gwei value: ${r}`);for(;n[1].length<e;)n[1]+="0";if(n[1].length>9){let s=BigInt(n[1].substring(0,9));n[1].substring(9).match(/^0+$/)||s++,n[1]=s.toString()}return BigInt(n[0]+n[1])}function Ez(r){return new QUe(r,async(e,t,n)=>{n.setHeader("User-Agent","ethers");let s;try{const[i,o]=await Promise.all([n.send(),e()]);s=i;const a=s.bodyJson.standard;return{gasPrice:o.gasPrice,maxFeePerGas:vz(a.maxFee,9),maxPriorityFeePerGas:vz(a.maxPriorityFee,9)}}catch(i){se(!1,`error encountered with polygon gas station (${JSON.stringify(n.url)})`,"SERVER_ERROR",{request:n,response:s,error:i})}})}let xz=!1;function JUe(){if(xz)return;xz=!0;function r(e,t,n){const s=function(){const i=new ua(e,t);return n.ensNetwork!=null&&i.attachPlugin(new F7(null,n.ensNetwork)),i.attachPlugin(new U7),(n.plugins||[]).forEach(o=>{i.attachPlugin(o)}),i};ua.register(e,s),ua.register(t,s),n.altNames&&n.altNames.forEach(i=>{ua.register(i,s)})}r("mainnet",1,{ensNetwork:1,altNames:["homestead"]}),r("ropsten",3,{ensNetwork:3}),r("rinkeby",4,{ensNetwork:4}),r("goerli",5,{ensNetwork:5}),r("kovan",42,{ensNetwork:42}),r("sepolia",11155111,{ensNetwork:11155111}),r("holesky",17e3,{ensNetwork:17e3}),r("classic",61,{}),r("classicKotti",6,{}),r("arbitrum",42161,{ensNetwork:1}),r("arbitrum-goerli",421613,{}),r("arbitrum-sepolia",421614,{}),r("base",8453,{ensNetwork:1}),r("base-goerli",84531,{}),r("base-sepolia",84532,{}),r("bnb",56,{ensNetwork:1}),r("bnbt",97,{}),r("linea",59144,{ensNetwork:1}),r("linea-goerli",59140,{}),r("linea-sepolia",59141,{}),r("matic",137,{ensNetwork:1,plugins:[Ez("https://gasstation.polygon.technology/v2")]}),r("matic-amoy",80002,{}),r("matic-mumbai",80001,{altNames:["maticMumbai","maticmum"],plugins:[Ez("https://gasstation-testnet.polygon.technology/v2")]}),r("optimism",10,{ensNetwork:1,plugins:[]}),r("optimism-goerli",420,{}),r("optimism-sepolia",11155420,{}),r("xdai",100,{ensNetwork:1})}function fk(r){return JSON.parse(JSON.stringify(r))}var ic,vi,tu,ea,N0,R4;class YUe{constructor(e){Q(this,N0);Q(this,ic);Q(this,vi);Q(this,tu);Q(this,ea);M(this,ic,e),M(this,vi,null),M(this,tu,4e3),M(this,ea,-2)}get pollingInterval(){return T(this,tu)}set pollingInterval(e){M(this,tu,e)}start(){T(this,vi)||(M(this,vi,T(this,ic)._setTimeout(te(this,N0,R4).bind(this),T(this,tu))),te(this,N0,R4).call(this))}stop(){T(this,vi)&&(T(this,ic)._clearTimeout(T(this,vi)),M(this,vi,null))}pause(e){this.stop(),e&&M(this,ea,-2)}resume(){this.start()}}ic=new WeakMap,vi=new WeakMap,tu=new WeakMap,ea=new WeakMap,N0=new WeakSet,R4=async function(){try{const e=await T(this,ic).getBlockNumber();if(T(this,ea)===-2){M(this,ea,e);return}if(e!==T(this,ea)){for(let t=T(this,ea)+1;t<=e;t++){if(T(this,vi)==null)return;await T(this,ic).emit("block",t)}M(this,ea,e)}}catch{}T(this,vi)!=null&&M(this,vi,T(this,ic)._setTimeout(te(this,N0,R4).bind(this),T(this,tu)))};var pd,gd,ru;class QN{constructor(e){Q(this,pd);Q(this,gd);Q(this,ru);M(this,pd,e),M(this,ru,!1),M(this,gd,t=>{this._poll(t,T(this,pd))})}async _poll(e,t){throw new Error("sub-classes must override this")}start(){T(this,ru)||(M(this,ru,!0),T(this,gd).call(this,-2),T(this,pd).on("block",T(this,gd)))}stop(){T(this,ru)&&(M(this,ru,!1),T(this,pd).off("block",T(this,gd)))}pause(e){this.stop()}resume(){this.start()}}pd=new WeakMap,gd=new WeakMap,ru=new WeakMap;var D0,oc;class XUe extends QN{constructor(t,n){super(t);Q(this,D0);Q(this,oc);M(this,D0,n),M(this,oc,-2)}pause(t){t&&M(this,oc,-2),super.pause(t)}async _poll(t,n){const s=await n.getBlock(T(this,D0));s!=null&&(T(this,oc)===-2?M(this,oc,s.number):s.number>T(this,oc)&&(n.emit(T(this,D0),s.number),M(this,oc,s.number)))}}D0=new WeakMap,oc=new WeakMap;var Z6;class ZUe extends QN{constructor(t,n){super(t);Q(this,Z6);M(this,Z6,fk(n))}async _poll(t,n){throw new Error("@TODO")}}Z6=new WeakMap;var O0;class eFe extends QN{constructor(t,n){super(t);Q(this,O0);M(this,O0,n)}async _poll(t,n){const s=await n.getTransactionReceipt(T(this,O0));s&&n.emit(T(this,O0),s)}}O0=new WeakMap;var ac,R0,B0,nu,Ei,e5,wre;class JN{constructor(e,t){Q(this,e5);Q(this,ac);Q(this,R0);Q(this,B0);Q(this,nu);Q(this,Ei);M(this,ac,e),M(this,R0,fk(t)),M(this,B0,te(this,e5,wre).bind(this)),M(this,nu,!1),M(this,Ei,-2)}start(){T(this,nu)||(M(this,nu,!0),T(this,Ei)===-2&&T(this,ac).getBlockNumber().then(e=>{M(this,Ei,e)}),T(this,ac).on("block",T(this,B0)))}stop(){T(this,nu)&&(M(this,nu,!1),T(this,ac).off("block",T(this,B0)))}pause(e){this.stop(),e&&M(this,Ei,-2)}resume(){this.start()}}ac=new WeakMap,R0=new WeakMap,B0=new WeakMap,nu=new WeakMap,Ei=new WeakMap,e5=new WeakSet,wre=async function(e){if(T(this,Ei)===-2)return;const t=fk(T(this,R0));t.fromBlock=T(this,Ei)+1,t.toBlock=e;const n=await T(this,ac).getLogs(t);if(n.length===0){T(this,Ei)<e-60&&M(this,Ei,e-60);return}for(const s of n)T(this,ac).emit(T(this,R0),s),M(this,Ei,s.blockNumber)};const tFe=BigInt(2),rFe=10;function R3(r){return r&&typeof r.then=="function"}function B4(r,e){return r+":"+JSON.stringify(e,(t,n)=>{if(n==null)return"null";if(typeof n=="bigint")return`bigint:${n.toString()}`;if(typeof n=="string")return n.toLowerCase();if(typeof n=="object"&&!Array.isArray(n)){const s=Object.keys(n);return s.sort(),s.reduce((i,o)=>(i[o]=n[o],i),{})}return n})}class bre{constructor(e){h(this,"name");Me(this,{name:e})}start(){}stop(){}pause(e){}resume(){}}function nFe(r){return JSON.parse(JSON.stringify(r))}function pk(r){return r=Array.from(new Set(r).values()),r.sort(),r}async function dx(r,e){if(r==null)throw new Error("invalid event");if(Array.isArray(r)&&(r={topics:r}),typeof r=="string")switch(r){case"block":case"debug":case"error":case"finalized":case"network":case"pending":case"safe":return{type:r,tag:r}}if($t(r,32)){const t=r.toLowerCase();return{type:"transaction",tag:B4("tx",{hash:t}),hash:t}}if(r.orphan){const t=r;return{type:"orphan",tag:B4("orphan",t),filter:nFe(t)}}if(r.address||r.topics){const t=r,n={topics:(t.topics||[]).map(s=>s==null?null:Array.isArray(s)?pk(s.map(i=>i.toLowerCase())):s.toLowerCase())};if(t.address){const s=[],i=[],o=a=>{$t(a)?s.push(a):i.push((async()=>{s.push(await Gn(a,e))})())};Array.isArray(t.address)?t.address.forEach(o):o(t.address),i.length&&await Promise.all(i),n.address=pk(s.map(a=>a.toLowerCase()))}return{filter:n,tag:B4("event",n),type:"event"}}q(!1,"unknown ProviderEvent","event",r)}function fx(){return new Date().getTime()}const sFe={cacheTimeout:250,pollingInterval:4e3};var Sn,su,Cn,M0,Us,yd,iu,cc,bm,xi,$0,L0,Xe,Os,gk,yk,b2,mk,v2,M4;class iFe{constructor(e,t){Q(this,Xe);Q(this,Sn);Q(this,su);Q(this,Cn);Q(this,M0);Q(this,Us);Q(this,yd);Q(this,iu);Q(this,cc);Q(this,bm);Q(this,xi);Q(this,$0);Q(this,L0);if(M(this,L0,Object.assign({},sFe,t||{})),e==="any")M(this,yd,!0),M(this,Us,null);else if(e){const n=ua.from(e);M(this,yd,!1),M(this,Us,Promise.resolve(n)),setTimeout(()=>{this.emit("network",n,null)},0)}else M(this,yd,!1),M(this,Us,null);M(this,cc,-1),M(this,iu,new Map),M(this,Sn,new Map),M(this,su,new Map),M(this,Cn,null),M(this,M0,!1),M(this,bm,1),M(this,xi,new Map),M(this,$0,!1)}get pollingInterval(){return T(this,L0).pollingInterval}get provider(){return this}get plugins(){return Array.from(T(this,su).values())}attachPlugin(e){if(T(this,su).get(e.name))throw new Error(`cannot replace existing plugin: ${e.name} `);return T(this,su).set(e.name,e.connect(this)),this}getPlugin(e){return T(this,su).get(e)||null}get disableCcipRead(){return T(this,$0)}set disableCcipRead(e){M(this,$0,!!e)}async ccipReadFetch(e,t,n){if(this.disableCcipRead||n.length===0||e.to==null)return null;const s=e.to.toLowerCase(),i=t.toLowerCase(),o=[];for(let a=0;a<n.length;a++){const c=n[a],l=c.replace("{sender}",s).replace("{data}",i),u=new Yu(l);c.indexOf("{data}")===-1&&(u.body={data:i,sender:s}),this.emit("debug",{action:"sendCcipReadFetchRequest",request:u,index:a,urls:n});let d="unknown error",p;try{p=await u.send()}catch(y){o.push(y.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:u,result:{error:y}});continue}try{const y=p.bodyJson;if(y.data)return this.emit("debug",{action:"receiveCcipReadFetchResult",request:u,result:y}),y.data;y.message&&(d=y.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:u,result:y})}catch{}se(p.statusCode<400||p.statusCode>=500,`response not found during CCIP fetch: ${d}`,"OFFCHAIN_FAULT",{reason:"404_MISSING_RESOURCE",transaction:e,info:{url:c,errorMessage:d}}),o.push(d)}se(!1,`error encountered during CCIP fetch: ${o.map(a=>JSON.stringify(a)).join(", ")}`,"OFFCHAIN_FAULT",{reason:"500_SERVER_ERROR",transaction:e,info:{urls:n,errorMessages:o}})}_wrapBlock(e,t){return new SUe(HUe(e),this)}_wrapLog(e,t){return new fw(zUe(e),this)}_wrapTransactionReceipt(e,t){return new sre(qUe(e),this)}_wrapTransactionResponse(e,t){return new tm(mre(e),this)}_detectNetwork(){se(!1,"sub-classes must implement this","UNSUPPORTED_OPERATION",{operation:"_detectNetwork"})}async _perform(e){se(!1,`unsupported method: ${e.method}`,"UNSUPPORTED_OPERATION",{operation:e.method,info:e})}async getBlockNumber(){const e=Ze(await te(this,Xe,Os).call(this,{method:"getBlockNumber"}),"%response");return T(this,cc)>=0&&M(this,cc,e),e}_getAddress(e){return Gn(e,this)}_getBlockTag(e){if(e==null)return"latest";switch(e){case"earliest":return"0x0";case"finalized":case"latest":case"pending":case"safe":return e}if($t(e))return $t(e,32)?e:Ep(e);if(typeof e=="bigint"&&(e=Ze(e,"blockTag")),typeof e=="number")return e>=0?Ep(e):T(this,cc)>=0?Ep(T(this,cc)+e):this.getBlockNumber().then(t=>Ep(t+e));q(!1,"invalid blockTag","blockTag",e)}_getFilter(e){const t=(e.topics||[]).map(c=>c==null?null:Array.isArray(c)?pk(c.map(l=>l.toLowerCase())):c.toLowerCase()),n="blockHash"in e?e.blockHash:void 0,s=(c,l,u)=>{let d;switch(c.length){case 0:break;case 1:d=c[0];break;default:c.sort(),d=c}if(n&&(l!=null||u!=null))throw new Error("invalid filter");const p={};return d&&(p.address=d),t.length&&(p.topics=t),l&&(p.fromBlock=l),u&&(p.toBlock=u),n&&(p.blockHash=n),p};let i=[];if(e.address)if(Array.isArray(e.address))for(const c of e.address)i.push(this._getAddress(c));else i.push(this._getAddress(e.address));let o;"fromBlock"in e&&(o=this._getBlockTag(e.fromBlock));let a;return"toBlock"in e&&(a=this._getBlockTag(e.toBlock)),i.filter(c=>typeof c!="string").length||o!=null&&typeof o!="string"||a!=null&&typeof a!="string"?Promise.all([Promise.all(i),o,a]).then(c=>s(c[0],c[1],c[2])):s(i,o,a)}_getTransactionRequest(e){const t=V6(e),n=[];if(["to","from"].forEach(s=>{if(t[s]==null)return;const i=Gn(t[s],this);R3(i)?n.push(async function(){t[s]=await i}()):t[s]=i}),t.blockTag!=null){const s=this._getBlockTag(t.blockTag);R3(s)?n.push(async function(){t.blockTag=await s}()):t.blockTag=s}return n.length?async function(){return await Promise.all(n),t}():t}async getNetwork(){if(T(this,Us)==null){const s=(async()=>{try{const i=await this._detectNetwork();return this.emit("network",i,null),i}catch(i){throw T(this,Us)===s&&M(this,Us,null),i}})();return M(this,Us,s),(await s).clone()}const e=T(this,Us),[t,n]=await Promise.all([e,this._detectNetwork()]);return t.chainId!==n.chainId&&(T(this,yd)?(this.emit("network",n,t),T(this,Us)===e&&M(this,Us,Promise.resolve(n))):se(!1,`network changed: ${t.chainId} => ${n.chainId} `,"NETWORK_ERROR",{event:"changed"})),t.clone()}async getFeeData(){const e=await this.getNetwork(),t=async()=>{const{_block:s,gasPrice:i,priorityFee:o}=await Ln({_block:te(this,Xe,mk).call(this,"latest",!1),gasPrice:(async()=>{try{const u=await te(this,Xe,Os).call(this,{method:"getGasPrice"});return Pe(u,"%response")}catch{}return null})(),priorityFee:(async()=>{try{const u=await te(this,Xe,Os).call(this,{method:"getPriorityFee"});return Pe(u,"%response")}catch{}return null})()});let a=null,c=null;const l=this._wrapBlock(s,e);return l&&l.baseFeePerGas&&(c=o??BigInt("1000000000"),a=l.baseFeePerGas*tFe+c),new gz(i,a,c)},n=e.getPlugin("org.ethers.plugins.network.FetchUrlFeeDataPlugin");if(n){const s=new Yu(n.url),i=await n.processFunc(t,this,s);return new gz(i.gasPrice,i.maxFeePerGas,i.maxPriorityFeePerGas)}return await t()}async estimateGas(e){let t=this._getTransactionRequest(e);return R3(t)&&(t=await t),Pe(await te(this,Xe,Os).call(this,{method:"estimateGas",transaction:t}),"%response")}async call(e){const{tx:t,blockTag:n}=await Ln({tx:this._getTransactionRequest(e),blockTag:this._getBlockTag(e.blockTag)});return await te(this,Xe,yk).call(this,te(this,Xe,gk).call(this,t,n,e.enableCcipRead?0:-1))}async getBalance(e,t){return Pe(await te(this,Xe,b2).call(this,{method:"getBalance"},e,t),"%response")}async getTransactionCount(e,t){return Ze(await te(this,Xe,b2).call(this,{method:"getTransactionCount"},e,t),"%response")}async getCode(e,t){return ke(await te(this,Xe,b2).call(this,{method:"getCode"},e,t))}async getStorage(e,t,n){const s=Pe(t,"position");return ke(await te(this,Xe,b2).call(this,{method:"getStorage",position:s},e,n))}async broadcastTransaction(e){const{blockNumber:t,hash:n,network:s}=await Ln({blockNumber:this.getBlockNumber(),hash:this._perform({method:"broadcastTransaction",signedTransaction:e}),network:this.getNetwork()}),i=F6.from(e);if(i.hash!==n)throw new Error("@TODO: the returned hash did not match");return this._wrapTransactionResponse(i,s).replaceableTransaction(t)}async getBlock(e,t){const{network:n,params:s}=await Ln({network:this.getNetwork(),params:te(this,Xe,mk).call(this,e,!!t)});return s==null?null:this._wrapBlock(s,n)}async getTransaction(e){const{network:t,params:n}=await Ln({network:this.getNetwork(),params:te(this,Xe,Os).call(this,{method:"getTransaction",hash:e})});return n==null?null:this._wrapTransactionResponse(n,t)}async getTransactionReceipt(e){const{network:t,params:n}=await Ln({network:this.getNetwork(),params:te(this,Xe,Os).call(this,{method:"getTransactionReceipt",hash:e})});if(n==null)return null;if(n.gasPrice==null&&n.effectiveGasPrice==null){const s=await te(this,Xe,Os).call(this,{method:"getTransaction",hash:e});if(s==null)throw new Error("report this; could not find tx or effectiveGasPrice");n.effectiveGasPrice=s.gasPrice}return this._wrapTransactionReceipt(n,t)}async getTransactionResult(e){const{result:t}=await Ln({network:this.getNetwork(),result:te(this,Xe,Os).call(this,{method:"getTransactionResult",hash:e})});return t==null?null:ke(t)}async getLogs(e){let t=this._getFilter(e);R3(t)&&(t=await t);const{network:n,params:s}=await Ln({network:this.getNetwork(),params:te(this,Xe,Os).call(this,{method:"getLogs",filter:t})});return s.map(i=>this._wrapLog(i,n))}_getProvider(e){se(!1,"provider cannot connect to target network","UNSUPPORTED_OPERATION",{operation:"_getProvider()"})}async getResolver(e){return await K6.fromName(this,e)}async getAvatar(e){const t=await this.getResolver(e);return t?await t.getAvatar():null}async resolveName(e){const t=await this.getResolver(e);return t?await t.getAddress():null}async lookupAddress(e){e=_t(e);const t=ak(e.substring(2).toLowerCase()+".addr.reverse");try{const n=await K6.getEnsAddress(this),i=await new j2(n,["function resolver(bytes32) view returns (address)"],this).resolver(t);if(i==null||i===qy)return null;const a=await new j2(i,["function name(bytes32) view returns (string)"],this).name(t);return await this.resolveName(a)!==e?null:a}catch(n){if(qr(n,"BAD_DATA")&&n.value==="0x"||qr(n,"CALL_EXCEPTION"))return null;throw n}return null}async waitForTransaction(e,t,n){const s=t??1;return s===0?this.getTransactionReceipt(e):new Promise(async(i,o)=>{let a=null;const c=async l=>{try{const u=await this.getTransactionReceipt(e);if(u!=null&&l-u.blockNumber+1>=s){i(u),a&&(clearTimeout(a),a=null);return}}catch(u){console.log("EEE",u)}this.once("block",c)};n!=null&&(a=setTimeout(()=>{a!=null&&(a=null,this.off("block",c),o(rr("timeout","TIMEOUT",{reason:"timeout"})))},n)),c(await this.getBlockNumber())})}async waitForBlock(e){se(!1,"not implemented yet","NOT_IMPLEMENTED",{operation:"waitForBlock"})}_clearTimeout(e){const t=T(this,xi).get(e);t&&(t.timer&&clearTimeout(t.timer),T(this,xi).delete(e))}_setTimeout(e,t){t==null&&(t=0);const n=ts(this,bm)._++,s=()=>{T(this,xi).delete(n),e()};if(this.paused)T(this,xi).set(n,{timer:null,func:s,time:t});else{const i=setTimeout(s,t);T(this,xi).set(n,{timer:i,func:s,time:fx()})}return n}_forEachSubscriber(e){for(const t of T(this,Sn).values())e(t.subscriber)}_getSubscriber(e){switch(e.type){case"debug":case"error":case"network":return new bre(e.type);case"block":{const t=new YUe(this);return t.pollingInterval=this.pollingInterval,t}case"safe":case"finalized":return new XUe(this,e.type);case"event":return new JN(this,e.filter);case"transaction":return new eFe(this,e.hash);case"orphan":return new ZUe(this,e.filter)}throw new Error(`unsupported event: ${e.type}`)}_recoverSubscriber(e,t){for(const n of T(this,Sn).values())if(n.subscriber===e){n.started&&n.subscriber.stop(),n.subscriber=t,n.started&&t.start(),T(this,Cn)!=null&&t.pause(T(this,Cn));break}}async on(e,t){const n=await te(this,Xe,M4).call(this,e);return n.listeners.push({listener:t,once:!1}),n.started||(n.subscriber.start(),n.started=!0,T(this,Cn)!=null&&n.subscriber.pause(T(this,Cn))),this}async once(e,t){const n=await te(this,Xe,M4).call(this,e);return n.listeners.push({listener:t,once:!0}),n.started||(n.subscriber.start(),n.started=!0,T(this,Cn)!=null&&n.subscriber.pause(T(this,Cn))),this}async emit(e,...t){const n=await te(this,Xe,v2).call(this,e,t);if(!n||n.listeners.length===0)return!1;const s=n.listeners.length;return n.listeners=n.listeners.filter(({listener:i,once:o})=>{const a=new Bee(this,o?null:i,e);try{i.call(this,...t,a)}catch{}return!o}),n.listeners.length===0&&(n.started&&n.subscriber.stop(),T(this,Sn).delete(n.tag)),s>0}async listenerCount(e){if(e){const n=await te(this,Xe,v2).call(this,e);return n?n.listeners.length:0}let t=0;for(const{listeners:n}of T(this,Sn).values())t+=n.length;return t}async listeners(e){if(e){const n=await te(this,Xe,v2).call(this,e);return n?n.listeners.map(({listener:s})=>s):[]}let t=[];for(const{listeners:n}of T(this,Sn).values())t=t.concat(n.map(({listener:s})=>s));return t}async off(e,t){const n=await te(this,Xe,v2).call(this,e);if(!n)return this;if(t){const s=n.listeners.map(({listener:i})=>i).indexOf(t);s>=0&&n.listeners.splice(s,1)}return(!t||n.listeners.length===0)&&(n.started&&n.subscriber.stop(),T(this,Sn).delete(n.tag)),this}async removeAllListeners(e){if(e){const{tag:t,started:n,subscriber:s}=await te(this,Xe,M4).call(this,e);n&&s.stop(),T(this,Sn).delete(t)}else for(const[t,{started:n,subscriber:s}]of T(this,Sn))n&&s.stop(),T(this,Sn).delete(t);return this}async addListener(e,t){return await this.on(e,t)}async removeListener(e,t){return this.off(e,t)}get destroyed(){return T(this,M0)}destroy(){this.removeAllListeners();for(const e of T(this,xi).keys())this._clearTimeout(e);M(this,M0,!0)}get paused(){return T(this,Cn)!=null}set paused(e){!!e!==this.paused&&(this.paused?this.resume():this.pause(!1))}pause(e){if(M(this,cc,-1),T(this,Cn)!=null){if(T(this,Cn)==!!e)return;se(!1,"cannot change pause type; resume first","UNSUPPORTED_OPERATION",{operation:"pause"})}this._forEachSubscriber(t=>t.pause(e)),M(this,Cn,!!e);for(const t of T(this,xi).values())t.timer&&clearTimeout(t.timer),t.time=fx()-t.time}resume(){if(T(this,Cn)!=null){this._forEachSubscriber(e=>e.resume()),M(this,Cn,null);for(const e of T(this,xi).values()){let t=e.time;t<0&&(t=0),e.time=fx(),setTimeout(e.func,t)}}}}Sn=new WeakMap,su=new WeakMap,Cn=new WeakMap,M0=new WeakMap,Us=new WeakMap,yd=new WeakMap,iu=new WeakMap,cc=new WeakMap,bm=new WeakMap,xi=new WeakMap,$0=new WeakMap,L0=new WeakMap,Xe=new WeakSet,Os=async function(e){const t=T(this,L0).cacheTimeout;if(t<0)return await this._perform(e);const n=B4(e.method,e);let s=T(this,iu).get(n);return s||(s=this._perform(e),T(this,iu).set(n,s),setTimeout(()=>{T(this,iu).get(n)===s&&T(this,iu).delete(n)},t)),await s},gk=async function(e,t,n){se(n<rFe,"CCIP read exceeded maximum redirections","OFFCHAIN_FAULT",{reason:"TOO_MANY_REDIRECTS",transaction:Object.assign({},e,{blockTag:t,enableCcipRead:!0})});const s=V6(e);try{return ke(await this._perform({method:"call",transaction:s,blockTag:t}))}catch(i){if(!this.disableCcipRead&&TN(i)&&i.data&&n>=0&&t==="latest"&&s.to!=null&&sr(i.data,0,4)==="0x556f1830"){const o=i.data,a=await Gn(s.to,this);let c;try{c=uFe(sr(i.data,4))}catch(d){se(!1,d.message,"OFFCHAIN_FAULT",{reason:"BAD_DATA",transaction:s,info:{data:o}})}se(c.sender.toLowerCase()===a.toLowerCase(),"CCIP Read sender mismatch","CALL_EXCEPTION",{action:"call",data:o,reason:"OffchainLookup",transaction:s,invocation:null,revert:{signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",name:"OffchainLookup",args:c.errorArgs}});const l=await this.ccipReadFetch(s,c.calldata,c.urls);se(l!=null,"CCIP Read failed to fetch data","OFFCHAIN_FAULT",{reason:"FETCH_FAILED",transaction:s,info:{data:i.data,errorArgs:c.errorArgs}});const u={to:a,data:pr([c.selector,lFe([l,c.extraData])])};this.emit("debug",{action:"sendCcipReadCall",transaction:u});try{const d=await te(this,Xe,gk).call(this,u,t,n+1);return this.emit("debug",{action:"receiveCcipReadCallResult",transaction:Object.assign({},u),result:d}),d}catch(d){throw this.emit("debug",{action:"receiveCcipReadCallError",transaction:Object.assign({},u),error:d}),d}}throw i}},yk=async function(e){const{value:t}=await Ln({network:this.getNetwork(),value:e});return t},b2=async function(e,t,n){let s=this._getAddress(t),i=this._getBlockTag(n);return(typeof s!="string"||typeof i!="string")&&([s,i]=await Promise.all([s,i])),await te(this,Xe,yk).call(this,te(this,Xe,Os).call(this,Object.assign(e,{address:s,blockTag:i})))},mk=async function(e,t){if($t(e,32))return await te(this,Xe,Os).call(this,{method:"getBlock",blockHash:e,includeTransactions:t});let n=this._getBlockTag(e);return typeof n!="string"&&(n=await n),await te(this,Xe,Os).call(this,{method:"getBlock",blockTag:n,includeTransactions:t})},v2=async function(e,t){let n=await dx(e,this);return n.type==="event"&&t&&t.length>0&&t[0].removed===!0&&(n=await dx({orphan:"drop-log",log:t[0]},this)),T(this,Sn).get(n.tag)||null},M4=async function(e){const t=await dx(e,this),n=t.tag;let s=T(this,Sn).get(n);return s||(s={subscriber:this._getSubscriber(t),tag:n,addressableMap:new WeakMap,nameMap:new Map,started:!1,listeners:[]},T(this,Sn).set(n,s)),s};function oFe(r,e){try{const t=wk(r,e);if(t)return O6(t)}catch{}return null}function wk(r,e){if(r==="0x")return null;try{const t=Ze(sr(r,e,e+32)),n=Ze(sr(r,t,t+32));return sr(r,t+32,t+32+n)}catch{}return null}function Az(r){const e=Hn(r);if(e.length>32)throw new Error("internal; should not happen");const t=new Uint8Array(32);return t.set(e,32-e.length),t}function aFe(r){if(r.length%32===0)return r;const e=new Uint8Array(Math.ceil(r.length/32)*32);return e.set(r),e}const cFe=new Uint8Array([]);function lFe(r){const e=[];let t=0;for(let n=0;n<r.length;n++)e.push(cFe),t+=32;for(let n=0;n<r.length;n++){const s=dt(r[n]);e[n]=Az(t),e.push(Az(s.length)),e.push(aFe(s)),t+=32+Math.ceil(s.length/32)*32}return pr(e)}const Sz="0x0000000000000000000000000000000000000000000000000000000000000000";function uFe(r){const e={sender:"",urls:[],calldata:"",selector:"",extraData:"",errorArgs:[]};se(Kp(r)>=5*32,"insufficient OffchainLookup data","OFFCHAIN_FAULT",{reason:"insufficient OffchainLookup data"});const t=sr(r,0,32);se(sr(t,0,12)===sr(Sz,0,12),"corrupt OffchainLookup sender","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup sender"}),e.sender=sr(t,12);try{const n=[],s=Ze(sr(r,32,64)),i=Ze(sr(r,s,s+32)),o=sr(r,s+32);for(let a=0;a<i;a++){const c=oFe(o,a*32);if(c==null)throw new Error("abort");n.push(c)}e.urls=n}catch{se(!1,"corrupt OffchainLookup urls","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup urls"})}try{const n=wk(r,64);if(n==null)throw new Error("abort");e.calldata=n}catch{se(!1,"corrupt OffchainLookup calldata","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup calldata"})}se(sr(r,100,128)===sr(Sz,0,28),"corrupt OffchainLookup callbaackSelector","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup callbaackSelector"}),e.selector=sr(r,96,100);try{const n=wk(r,128);if(n==null)throw new Error("abort");e.extraData=n}catch{se(!1,"corrupt OffchainLookup extraData","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup extraData"})}return e.errorArgs="sender,urls,calldata,selector,extraData".split(/,/).map(n=>e[n]),e}function ep(r,e){if(r.provider)return r.provider;se(!1,"missing provider","UNSUPPORTED_OPERATION",{operation:e})}async function Cz(r,e){let t=V6(e);if(t.to!=null&&(t.to=Gn(t.to,r)),t.from!=null){const n=t.from;t.from=Promise.all([r.getAddress(),Gn(n,r)]).then(([s,i])=>(q(s.toLowerCase()===i.toLowerCase(),"transaction from mismatch","tx.from",i),s))}else t.from=r.getAddress();return await Ln(t)}class hFe{constructor(e){h(this,"provider");Me(this,{provider:e||null})}async getNonce(e){return ep(this,"getTransactionCount").getTransactionCount(await this.getAddress(),e)}async populateCall(e){return await Cz(this,e)}async populateTransaction(e){const t=ep(this,"populateTransaction"),n=await Cz(this,e);n.nonce==null&&(n.nonce=await this.getNonce("pending")),n.gasLimit==null&&(n.gasLimit=await this.estimateGas(n));const s=await this.provider.getNetwork();if(n.chainId!=null){const o=Pe(n.chainId);q(o===s.chainId,"transaction chainId mismatch","tx.chainId",e.chainId)}else n.chainId=s.chainId;const i=n.maxFeePerGas!=null||n.maxPriorityFeePerGas!=null;if(n.gasPrice!=null&&(n.type===2||i)?q(!1,"eip-1559 transaction do not support gasPrice","tx",e):(n.type===0||n.type===1)&&i&&q(!1,"pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","tx",e),(n.type===2||n.type==null)&&n.maxFeePerGas!=null&&n.maxPriorityFeePerGas!=null)n.type=2;else if(n.type===0||n.type===1){const o=await t.getFeeData();se(o.gasPrice!=null,"network does not support gasPrice","UNSUPPORTED_OPERATION",{operation:"getGasPrice"}),n.gasPrice==null&&(n.gasPrice=o.gasPrice)}else{const o=await t.getFeeData();if(n.type==null)if(o.maxFeePerGas!=null&&o.maxPriorityFeePerGas!=null)if(n.type=2,n.gasPrice!=null){const a=n.gasPrice;delete n.gasPrice,n.maxFeePerGas=a,n.maxPriorityFeePerGas=a}else n.maxFeePerGas==null&&(n.maxFeePerGas=o.maxFeePerGas),n.maxPriorityFeePerGas==null&&(n.maxPriorityFeePerGas=o.maxPriorityFeePerGas);else o.gasPrice!=null?(se(!i,"network does not support EIP-1559","UNSUPPORTED_OPERATION",{operation:"populateTransaction"}),n.gasPrice==null&&(n.gasPrice=o.gasPrice),n.type=0):se(!1,"failed to get consistent fee data","UNSUPPORTED_OPERATION",{operation:"signer.getFeeData"});else(n.type===2||n.type===3)&&(n.maxFeePerGas==null&&(n.maxFeePerGas=o.maxFeePerGas),n.maxPriorityFeePerGas==null&&(n.maxPriorityFeePerGas=o.maxPriorityFeePerGas))}return await Ln(n)}async estimateGas(e){return ep(this,"estimateGas").estimateGas(await this.populateCall(e))}async call(e){return ep(this,"call").call(await this.populateCall(e))}async resolveName(e){return await ep(this,"resolveName").resolveName(e)}async sendTransaction(e){const t=ep(this,"sendTransaction"),n=await this.populateTransaction(e);delete n.from;const s=F6.from(n);return await t.broadcastTransaction(await this.signTransaction(s))}}function dFe(r){return JSON.parse(JSON.stringify(r))}var Mn,ta,md,ou,wd,U0,Xu,bk,vk;class vre{constructor(e){Q(this,Xu);Q(this,Mn);Q(this,ta);Q(this,md);Q(this,ou);Q(this,wd);Q(this,U0);M(this,Mn,e),M(this,ta,null),M(this,md,te(this,Xu,bk).bind(this)),M(this,ou,!1),M(this,wd,null),M(this,U0,!1)}_subscribe(e){throw new Error("subclasses must override this")}_emitResults(e,t){throw new Error("subclasses must override this")}_recover(e){throw new Error("subclasses must override this")}start(){T(this,ou)||(M(this,ou,!0),te(this,Xu,bk).call(this,-2))}stop(){T(this,ou)&&(M(this,ou,!1),M(this,U0,!0),te(this,Xu,vk).call(this),T(this,Mn).off("block",T(this,md)))}pause(e){e&&te(this,Xu,vk).call(this),T(this,Mn).off("block",T(this,md))}resume(){this.start()}}Mn=new WeakMap,ta=new WeakMap,md=new WeakMap,ou=new WeakMap,wd=new WeakMap,U0=new WeakMap,Xu=new WeakSet,bk=async function(e){try{T(this,ta)==null&&M(this,ta,this._subscribe(T(this,Mn)));let t=null;try{t=await T(this,ta)}catch(i){if(!qr(i,"UNSUPPORTED_OPERATION")||i.operation!=="eth_newFilter")throw i}if(t==null){M(this,ta,null),T(this,Mn)._recoverSubscriber(this,this._recover(T(this,Mn)));return}const n=await T(this,Mn).getNetwork();if(T(this,wd)||M(this,wd,n),T(this,wd).chainId!==n.chainId)throw new Error("chaid changed");if(T(this,U0))return;const s=await T(this,Mn).send("eth_getFilterChanges",[t]);await this._emitResults(T(this,Mn),s)}catch(t){console.log("@TODO",t)}T(this,Mn).once("block",T(this,md))},vk=function(){const e=T(this,ta);e&&(M(this,ta,null),e.then(t=>{T(this,Mn).destroyed||T(this,Mn).send("eth_uninstallFilter",[t])}))};var bd;class fFe extends vre{constructor(t,n){super(t);Q(this,bd);M(this,bd,dFe(n))}_recover(t){return new JN(t,T(this,bd))}async _subscribe(t){return await t.send("eth_newFilter",[T(this,bd)])}async _emitResults(t,n){for(const s of n)t.emit(T(this,bd),t._wrapLog(s,t._network))}}bd=new WeakMap;class pFe extends vre{async _subscribe(e){return await e.send("eth_newPendingTransactionFilter",[])}async _emitResults(e,t){for(const n of t)e.emit("pending",n)}}const gFe="bigint,boolean,function,number,string,symbol".split(/,/g);function $4(r){if(r==null||gFe.indexOf(typeof r)>=0||typeof r.getAddress=="function")return r;if(Array.isArray(r))return r.map($4);if(typeof r=="object")return Object.keys(r).reduce((e,t)=>(e[t]=r[t],e),{});throw new Error(`should not happen: ${r} (${typeof r})`)}function yFe(r){return new Promise(e=>{setTimeout(e,r)})}function tp(r){return r&&r.toLowerCase()}function Iz(r){return r&&typeof r.pollingInterval=="number"}const Ere={polling:!1,staticNetwork:null,batchStallTime:10,batchMaxSize:1<<20,batchMaxCount:100,cacheTimeout:250,pollingInterval:4e3};class px extends hFe{constructor(t,n){super(t);h(this,"address");n=_t(n),Me(this,{address:n})}connect(t){se(!1,"cannot reconnect JsonRpcSigner","UNSUPPORTED_OPERATION",{operation:"signer.connect"})}async getAddress(){return this.address}async populateTransaction(t){return await this.populateCall(t)}async sendUncheckedTransaction(t){const n=$4(t),s=[];if(n.from){const o=n.from;s.push((async()=>{const a=await Gn(o,this.provider);q(a!=null&&a.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),n.from=a})())}else n.from=this.address;if(n.gasLimit==null&&s.push((async()=>{n.gasLimit=await this.provider.estimateGas({...n,from:this.address})})()),n.to!=null){const o=n.to;s.push((async()=>{n.to=await Gn(o,this.provider)})())}s.length&&await Promise.all(s);const i=this.provider.getRpcTransaction(n);return this.provider.send("eth_sendTransaction",[i])}async sendTransaction(t){const n=await this.provider.getBlockNumber(),s=await this.sendUncheckedTransaction(t);return await new Promise((i,o)=>{const a=[1e3,100];let c=0;const l=async()=>{try{const u=await this.provider.getTransaction(s);if(u!=null){i(u.replaceableTransaction(n));return}}catch(u){if(qr(u,"CANCELLED")||qr(u,"BAD_DATA")||qr(u,"NETWORK_ERROR")||qr(u,"UNSUPPORTED_OPERATION")){u.info==null&&(u.info={}),u.info.sendTransactionHash=s,o(u);return}if(qr(u,"INVALID_ARGUMENT")&&(c++,u.info==null&&(u.info={}),u.info.sendTransactionHash=s,c>10)){o(u);return}this.provider.emit("error",rr("failed to fetch transation after sending (will try again)","UNKNOWN_ERROR",{error:u}))}this.provider._setTimeout(()=>{l()},a.pop()||4e3)};l()})}async signTransaction(t){const n=$4(t);if(n.from){const i=await Gn(n.from,this.provider);q(i!=null&&i.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),n.from=i}else n.from=this.address;const s=this.provider.getRpcTransaction(n);return await this.provider.send("eth_signTransaction",[s])}async signMessage(t){const n=typeof t=="string"?Sc(t):t;return await this.provider.send("personal_sign",[ke(n),this.address.toLowerCase()])}async signTypedData(t,n,s){const i=$4(s),o=await z6.resolveNames(t,n,i,async a=>{const c=await Gn(a);return q(c!=null,"TypedData does not support null address","value",a),c});return await this.provider.send("eth_signTypedData_v4",[this.address.toLowerCase(),JSON.stringify(z6.getPayload(o.domain,n,o.value))])}async unlock(t){return this.provider.send("personal_unlockAccount",[this.address.toLowerCase(),t,null])}async _legacySignMessage(t){const n=typeof t=="string"?Sc(t):t;return await this.provider.send("eth_sign",[this.address.toLowerCase(),ke(n)])}}var vd,F0,lc,ra,co,Ai,cs,vm,Ek;class mFe extends iFe{constructor(t,n){super(t,n);Q(this,vm);Q(this,vd);Q(this,F0);Q(this,lc);Q(this,ra);Q(this,co);Q(this,Ai);Q(this,cs);M(this,F0,1),M(this,vd,Object.assign({},Ere,n||{})),M(this,lc,[]),M(this,ra,null),M(this,Ai,null),M(this,cs,null);{let i=null;const o=new Promise(a=>{i=a});M(this,co,{promise:o,resolve:i})}const s=this._getOption("staticNetwork");typeof s=="boolean"?(q(!s||t!=="any","staticNetwork cannot be used on special network 'any'","options",n),s&&t!=null&&M(this,Ai,ua.from(t))):s&&(q(t==null||s.matches(t),"staticNetwork MUST match network object","options",n),M(this,Ai,s))}_getOption(t){return T(this,vd)[t]}get _network(){return se(T(this,Ai),"network is not available yet","NETWORK_ERROR"),T(this,Ai)}async _perform(t){if(t.method==="call"||t.method==="estimateGas"){let s=t.transaction;if(s&&s.type!=null&&Pe(s.type)&&s.maxFeePerGas==null&&s.maxPriorityFeePerGas==null){const i=await this.getFeeData();i.maxFeePerGas==null&&i.maxPriorityFeePerGas==null&&(t=Object.assign({},t,{transaction:Object.assign({},s,{type:void 0})}))}}const n=this.getRpcRequest(t);return n!=null?await this.send(n.method,n.args):super._perform(t)}async _detectNetwork(){const t=this._getOption("staticNetwork");if(t)if(t===!0){if(T(this,Ai))return T(this,Ai)}else return t;return T(this,cs)?await T(this,cs):this.ready?(M(this,cs,(async()=>{try{const n=ua.from(Pe(await this.send("eth_chainId",[])));return M(this,cs,null),n}catch(n){throw M(this,cs,null),n}})()),await T(this,cs)):(M(this,cs,(async()=>{const n={id:ts(this,F0)._++,method:"eth_chainId",params:[],jsonrpc:"2.0"};this.emit("debug",{action:"sendRpcPayload",payload:n});let s;try{s=(await this._send(n))[0],M(this,cs,null)}catch(i){throw M(this,cs,null),this.emit("debug",{action:"receiveRpcError",error:i}),i}if(this.emit("debug",{action:"receiveRpcResult",result:s}),"result"in s)return ua.from(Pe(s.result));throw this.getRpcError(n,s)})()),await T(this,cs))}_start(){T(this,co)==null||T(this,co).resolve==null||(T(this,co).resolve(),M(this,co,null),(async()=>{for(;T(this,Ai)==null&&!this.destroyed;)try{M(this,Ai,await this._detectNetwork())}catch(t){if(this.destroyed)break;console.log("JsonRpcProvider failed to detect network and cannot start up; retry in 1s (perhaps the URL is wrong or the node is not started)"),this.emit("error",rr("failed to bootstrap network detection","NETWORK_ERROR",{event:"initial-network-discovery",info:{error:t}})),await yFe(1e3)}te(this,vm,Ek).call(this)})())}async _waitUntilReady(){if(T(this,co)!=null)return await T(this,co).promise}_getSubscriber(t){return t.type==="pending"?new pFe(this):t.type==="event"?this._getOption("polling")?new JN(this,t.filter):new fFe(this,t.filter):t.type==="orphan"&&t.filter.orphan==="drop-log"?new bre("orphan"):super._getSubscriber(t)}get ready(){return T(this,co)==null}getRpcTransaction(t){const n={};return["chainId","gasLimit","gasPrice","type","maxFeePerGas","maxPriorityFeePerGas","nonce","value"].forEach(s=>{if(t[s]==null)return;let i=s;s==="gasLimit"&&(i="gas"),n[i]=Ep(Pe(t[s],`tx.${s}`))}),["from","to","data"].forEach(s=>{t[s]!=null&&(n[s]=ke(t[s]))}),t.accessList&&(n.accessList=Nf(t.accessList)),t.blobVersionedHashes&&(n.blobVersionedHashes=t.blobVersionedHashes.map(s=>s.toLowerCase())),n}getRpcRequest(t){switch(t.method){case"chainId":return{method:"eth_chainId",args:[]};case"getBlockNumber":return{method:"eth_blockNumber",args:[]};case"getGasPrice":return{method:"eth_gasPrice",args:[]};case"getPriorityFee":return{method:"eth_maxPriorityFeePerGas",args:[]};case"getBalance":return{method:"eth_getBalance",args:[tp(t.address),t.blockTag]};case"getTransactionCount":return{method:"eth_getTransactionCount",args:[tp(t.address),t.blockTag]};case"getCode":return{method:"eth_getCode",args:[tp(t.address),t.blockTag]};case"getStorage":return{method:"eth_getStorageAt",args:[tp(t.address),"0x"+t.position.toString(16),t.blockTag]};case"broadcastTransaction":return{method:"eth_sendRawTransaction",args:[t.signedTransaction]};case"getBlock":if("blockTag"in t)return{method:"eth_getBlockByNumber",args:[t.blockTag,!!t.includeTransactions]};if("blockHash"in t)return{method:"eth_getBlockByHash",args:[t.blockHash,!!t.includeTransactions]};break;case"getTransaction":return{method:"eth_getTransactionByHash",args:[t.hash]};case"getTransactionReceipt":return{method:"eth_getTransactionReceipt",args:[t.hash]};case"call":return{method:"eth_call",args:[this.getRpcTransaction(t.transaction),t.blockTag]};case"estimateGas":return{method:"eth_estimateGas",args:[this.getRpcTransaction(t.transaction)]};case"getLogs":return t.filter&&t.filter.address!=null&&(Array.isArray(t.filter.address)?t.filter.address=t.filter.address.map(tp):t.filter.address=tp(t.filter.address)),{method:"eth_getLogs",args:[t.filter]}}return null}getRpcError(t,n){const{method:s}=t,{error:i}=n;if(s==="eth_estimateGas"&&i.message){const c=i.message;if(!c.match(/revert/i)&&c.match(/insufficient funds/i))return rr("insufficient funds","INSUFFICIENT_FUNDS",{transaction:t.params[0],info:{payload:t,error:i}})}if(s==="eth_call"||s==="eth_estimateGas"){const c=xk(i),l=em.getBuiltinCallException(s==="eth_call"?"call":"estimateGas",t.params[0],c?c.data:null);return l.info={error:i,payload:t},l}const o=JSON.stringify(bFe(i));if(typeof i.message=="string"&&i.message.match(/user denied|ethers-user-denied/i))return rr("user rejected action","ACTION_REJECTED",{action:{eth_sign:"signMessage",personal_sign:"signMessage",eth_signTypedData_v4:"signTypedData",eth_signTransaction:"signTransaction",eth_sendTransaction:"sendTransaction",eth_requestAccounts:"requestAccess",wallet_requestAccounts:"requestAccess"}[s]||"unknown",reason:"rejected",info:{payload:t,error:i}});if(s==="eth_sendRawTransaction"||s==="eth_sendTransaction"){const c=t.params[0];if(o.match(/insufficient funds|base fee exceeds gas limit/i))return rr("insufficient funds for intrinsic transaction cost","INSUFFICIENT_FUNDS",{transaction:c,info:{error:i}});if(o.match(/nonce/i)&&o.match(/too low/i))return rr("nonce has already been used","NONCE_EXPIRED",{transaction:c,info:{error:i}});if(o.match(/replacement transaction/i)&&o.match(/underpriced/i))return rr("replacement fee too low","REPLACEMENT_UNDERPRICED",{transaction:c,info:{error:i}});if(o.match(/only replay-protected/i))return rr("legacy pre-eip-155 transactions not supported","UNSUPPORTED_OPERATION",{operation:s,info:{transaction:c,info:{error:i}}})}let a=!!o.match(/the method .* does not exist/i);return a||i&&i.details&&i.details.startsWith("Unauthorized method:")&&(a=!0),a?rr("unsupported operation","UNSUPPORTED_OPERATION",{operation:t.method,info:{error:i,payload:t}}):rr("could not coalesce error","UNKNOWN_ERROR",{error:i,payload:t})}send(t,n){if(this.destroyed)return Promise.reject(rr("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t}));const s=ts(this,F0)._++,i=new Promise((o,a)=>{T(this,lc).push({resolve:o,reject:a,payload:{method:t,params:n,id:s,jsonrpc:"2.0"}})});return te(this,vm,Ek).call(this),i}async getSigner(t){t==null&&(t=0);const n=this.send("eth_accounts",[]);if(typeof t=="number"){const i=await n;if(t>=i.length)throw new Error("no such account");return new px(this,i[t])}const{accounts:s}=await Ln({network:this.getNetwork(),accounts:n});t=_t(t);for(const i of s)if(_t(i)===t)return new px(this,t);throw new Error("invalid account")}async listAccounts(){return(await this.send("eth_accounts",[])).map(n=>new px(this,n))}destroy(){T(this,ra)&&(clearTimeout(T(this,ra)),M(this,ra,null));for(const{payload:t,reject:n}of T(this,lc))n(rr("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t.method}));M(this,lc,[]),super.destroy()}}vd=new WeakMap,F0=new WeakMap,lc=new WeakMap,ra=new WeakMap,co=new WeakMap,Ai=new WeakMap,cs=new WeakMap,vm=new WeakSet,Ek=function(){if(T(this,ra))return;const t=this._getOption("batchMaxCount")===1?0:this._getOption("batchStallTime");M(this,ra,setTimeout(()=>{M(this,ra,null);const n=T(this,lc);for(M(this,lc,[]);n.length;){const s=[n.shift()];for(;n.length&&s.length!==T(this,vd).batchMaxCount;)if(s.push(n.shift()),JSON.stringify(s.map(o=>o.payload)).length>T(this,vd).batchMaxSize){n.unshift(s.pop());break}(async()=>{const i=s.length===1?s[0].payload:s.map(o=>o.payload);this.emit("debug",{action:"sendRpcPayload",payload:i});try{const o=await this._send(i);this.emit("debug",{action:"receiveRpcResult",result:o});for(const{resolve:a,reject:c,payload:l}of s){if(this.destroyed){c(rr("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:l.method}));continue}const u=o.filter(d=>d.id===l.id)[0];if(u==null){const d=rr("missing response for request","BAD_DATA",{value:o,info:{payload:l}});this.emit("error",d),c(d);continue}if("error"in u){c(this.getRpcError(l,u));continue}a(u.result)}}catch(o){this.emit("debug",{action:"receiveRpcError",error:o});for(const{reject:a}of s)a(o)}})()}},t))};var au;class wFe extends mFe{constructor(t,n){super(t,n);Q(this,au);let s=this._getOption("pollingInterval");s==null&&(s=Ere.pollingInterval),M(this,au,s)}_getSubscriber(t){const n=super._getSubscriber(t);return Iz(n)&&(n.pollingInterval=T(this,au)),n}get pollingInterval(){return T(this,au)}set pollingInterval(t){if(!Number.isInteger(t)||t<0)throw new Error("invalid interval");M(this,au,t),this._forEachSubscriber(n=>{Iz(n)&&(n.pollingInterval=T(this,au))})}}au=new WeakMap;function xk(r){if(r==null)return null;if(typeof r.message=="string"&&r.message.match(/revert/i)&&$t(r.data))return{message:r.message,data:r.data};if(typeof r=="object"){for(const e in r){const t=xk(r[e]);if(t)return t}return null}if(typeof r=="string")try{return xk(JSON.parse(r))}catch{}return null}function Ak(r,e){if(r!=null){if(typeof r.message=="string"&&e.push(r.message),typeof r=="object")for(const t in r)Ak(r[t],e);if(typeof r=="string")try{return Ak(JSON.parse(r),e)}catch{}}}function bFe(r){const e=[];return Ak(r,e),e}var z0;class kz extends wFe{constructor(t,n,s){const i=Object.assign({},s??{},{batchMaxCount:1});q(t&&t.request,"invalid EIP-1193 provider","ethereum",t);super(n,i);Q(this,z0);M(this,z0,async(o,a)=>{const c={method:o,params:a};this.emit("debug",{action:"sendEip1193Request",payload:c});try{const l=await t.request(c);return this.emit("debug",{action:"receiveEip1193Result",result:l}),l}catch(l){const u=new Error(l.message);throw u.code=l.code,u.data=l.data,u.payload=c,this.emit("debug",{action:"receiveEip1193Error",error:u}),u}})}async send(t,n){return await this._start(),await super.send(t,n)}async _send(t){q(!Array.isArray(t),"EIP-1193 does not support batch request","payload",t);try{const n=await T(this,z0).call(this,t.method,t.params||[]);return[{id:t.id,result:n}]}catch(n){return[{id:t.id,error:{code:n.code,data:n.data,message:n.message}}]}}getRpcError(t,n){switch(n=JSON.parse(JSON.stringify(n)),n.error.code||-1){case 4001:n.error.message=`ethers-user-denied: ${n.error.message}`;break;case 4200:n.error.message=`ethers-unsupported: ${n.error.message}`;break}return super.getRpcError(t,n)}async hasSigner(t){t==null&&(t=0);const n=await this.send("eth_accounts",[]);return typeof t=="number"?n.length>t:(t=t.toLowerCase(),n.filter(s=>s.toLowerCase()===t).length!==0)}async getSigner(t){if(t==null&&(t=0),!await this.hasSigner(t))try{await T(this,z0).call(this,"eth_requestAccounts",[])}catch(n){const s=n.payload;throw this.getRpcError(s,{id:s.id,error:n})}return await super.getSigner(t)}}z0=new WeakMap;const vFe=()=>{const[r,e]=ws.useState(null),[t,n]=ws.useState(null),s=async(a=10,c=500)=>{let l=0;for(;l<a;){if(window.ethereum)return window.ethereum;l++,await new Promise(u=>setTimeout(u,c))}throw new Error("Please install MetaMask or another Ethereum wallet provider.")},i=async()=>{try{const a=await s(),c=new kz(a);await c.send("eth_requestAccounts",[]);const u=await(await c.getSigner()).getAddress();e(u),n(null)}catch(a){n(a.message),e(null)}},o=()=>{e(null),n(null)};return ws.useEffect(()=>{(async()=>{try{const l=await s(),d=await new kz(l).listAccounts();d.length>0&&e(d[0].address)}catch(l){console.error("Failed to check wallet connection:",l)}})();const c=l=>{l.length>0?e(l[0]):e(null)};if(window.ethereum)window.ethereum.on("accountsChanged",c);else{const l=setInterval(()=>{window.ethereum&&(window.ethereum.on("accountsChanged",c),clearInterval(l))},500);return()=>clearInterval(l)}return()=>{window.ethereum&&window.ethereum.removeListener("accountsChanged",c)}},[]),{walletAddress:r,connectWallet:i,signOut:o,error:t}},EFe=({annotations:r,onDelete:e})=>r.length===0?cr.jsx("p",{style:{margin:0,color:"#666"},children:"No annotations yet."}):cr.jsx("ul",{style:{margin:0,padding:0,listStyle:"none"},children:r.map(t=>cr.jsxs("li",{style:{padding:"5px 0",borderBottom:"1px solid #eee",wordBreak:"break-word",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[cr.jsxs("span",{children:[t.text," ",cr.jsxs("small",{children:["(",new Date(t.timestamp).toLocaleString(),")"]})]}),cr.jsx("button",{onClick:()=>e(t._id),style:{padding:"2px 5px",background:"#ff0000",color:"#fff",border:"none",borderRadius:"3px",cursor:"pointer"},children:"Delete"})]},t._id))}),xFe=({url:r})=>{const[e,t]=ws.useState(""),{walletAddress:n,connectWallet:s,signOut:i,error:o}=vFe(),{db:a,error:c}=KBe(r),{annotations:l,error:u,handleSaveAnnotation:d,handleDeleteAnnotation:p}=GBe(r,a),y=o||c||u,f=async()=>{await d(e),t("")};return cr.jsxs("div",{style:{padding:"16px",maxWidth:"300px"},children:[cr.jsx("h1",{style:{fontSize:"1.5rem",fontWeight:"bold",margin:"0 0 8px 0"},children:"CitizenX Annotations"}),n?cr.jsxs("div",{style:{marginBottom:"8px"},children:[cr.jsxs("p",{style:{margin:"0",fontSize:"0.9rem"},children:["Connected: ",n.slice(0,6),"...",n.slice(-4)]}),cr.jsx("button",{onClick:i,style:{padding:"5px 10px",background:"#ff0000",color:"#fff",border:"none",borderRadius:"3px",cursor:"pointer"},children:"Disconnect Wallet"})]}):cr.jsx("div",{style:{marginBottom:"8px"},children:cr.jsx("button",{onClick:s,style:{padding:"5px 10px",background:"#007bff",color:"#fff",border:"none",borderRadius:"3px",cursor:"pointer"},children:"Connect Wallet"})}),y&&cr.jsx("p",{style:{color:"red",margin:"0 0 8px 0"},children:y}),cr.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[cr.jsx("input",{type:"text",value:e,onChange:g=>t(g.target.value),placeholder:"Enter annotation...",style:{flex:1,padding:"5px",border:"1px solid #ccc",borderRadius:"3px"}}),cr.jsx("button",{onClick:f,disabled:!a,style:{padding:"5px 10px",background:a?"#007bff":"#ccc",color:"#fff",border:"none",borderRadius:"3px",cursor:a?"pointer":"not-allowed"},children:"Save"})]}),cr.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:cr.jsx(EFe,{annotations:l,onDelete:p})})]})},AFe=()=>{const[r,e]=ws.useState("");return ws.useEffect(()=>{const t=()=>{chrome.tabs.query({active:!0,currentWindow:!0},i=>{var o;(o=i[0])!=null&&o.url?e(i[0].url):(console.error("Failed to get current tab URL"),e(""))})};t();const n=(i,o,a)=>{o.url&&a.active&&e(o.url)};chrome.tabs.onUpdated.addListener(n);const s=()=>{t()};return chrome.tabs.onActivated.addListener(s),()=>{chrome.tabs.onUpdated.removeListener(n),chrome.tabs.onActivated.removeListener(s)}},[]),cr.jsx(xFe,{url:r})},Tz=document.getElementById("root");Tz?fG(Tz).render(cr.jsx(AFe,{})):console.error("Root element not found");
