var fq=Object.defineProperty;var VA=r=>{throw TypeError(r)};var pq=(r,e,t)=>e in r?fq(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var u=(r,e,t)=>pq(r,typeof e!="symbol"?e+"":e,t),V4=(r,e,t)=>e.has(r)||VA("Cannot "+t);var he=(r,e,t)=>(V4(r,e,"read from private field"),t?t.call(r):e.get(r)),et=(r,e,t)=>e.has(r)?VA("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),kt=(r,e,t,n)=>(V4(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),De=(r,e,t)=>(V4(r,e,"access private method"),t);var Es=(r,e,t,n)=>({set _(i){kt(r,e,i,t)},get _(){return he(r,e,n)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var E1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Qs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function gq(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var DO={exports:{}},v3={},$O={exports:{}},Je={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kp=Symbol.for("react.element"),yq=Symbol.for("react.portal"),mq=Symbol.for("react.fragment"),wq=Symbol.for("react.strict_mode"),vq=Symbol.for("react.profiler"),bq=Symbol.for("react.provider"),Eq=Symbol.for("react.context"),Sq=Symbol.for("react.forward_ref"),xq=Symbol.for("react.suspense"),Aq=Symbol.for("react.memo"),Iq=Symbol.for("react.lazy"),KA=Symbol.iterator;function Cq(r){return r===null||typeof r!="object"?null:(r=KA&&r[KA]||r["@@iterator"],typeof r=="function"?r:null)}var NO={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},OO=Object.assign,MO={};function Ah(r,e,t){this.props=r,this.context=e,this.refs=MO,this.updater=t||NO}Ah.prototype.isReactComponent={};Ah.prototype.setState=function(r,e){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,e,"setState")};Ah.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function RO(){}RO.prototype=Ah.prototype;function $9(r,e,t){this.props=r,this.context=e,this.refs=MO,this.updater=t||NO}var N9=$9.prototype=new RO;N9.constructor=$9;OO(N9,Ah.prototype);N9.isPureReactComponent=!0;var HA=Array.isArray,LO=Object.prototype.hasOwnProperty,O9={current:null},BO={key:!0,ref:!0,__self:!0,__source:!0};function UO(r,e,t){var n,i={},s=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)LO.call(e,n)&&!BO.hasOwnProperty(n)&&(i[n]=e[n]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(r&&r.defaultProps)for(n in a=r.defaultProps,a)i[n]===void 0&&(i[n]=a[n]);return{$$typeof:kp,type:r,key:s,ref:o,props:i,_owner:O9.current}}function kq(r,e){return{$$typeof:kp,type:r.type,key:e,ref:r.ref,props:r.props,_owner:r._owner}}function M9(r){return typeof r=="object"&&r!==null&&r.$$typeof===kp}function _q(r){var e={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(t){return e[t]})}var jA=/\/+/g;function K4(r,e){return typeof r=="object"&&r!==null&&r.key!=null?_q(""+r.key):e.toString(36)}function Tg(r,e,t,n,i){var s=typeof r;(s==="undefined"||s==="boolean")&&(r=null);var o=!1;if(r===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(r.$$typeof){case kp:case yq:o=!0}}if(o)return o=r,i=i(o),r=n===""?"."+K4(o,0):n,HA(i)?(t="",r!=null&&(t=r.replace(jA,"$&/")+"/"),Tg(i,e,t,"",function(l){return l})):i!=null&&(M9(i)&&(i=kq(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(jA,"$&/")+"/")+r)),e.push(i)),1;if(o=0,n=n===""?".":n+":",HA(r))for(var a=0;a<r.length;a++){s=r[a];var c=n+K4(s,a);o+=Tg(s,e,t,c,i)}else if(c=Cq(r),typeof c=="function")for(r=c.call(r),a=0;!(s=r.next()).done;)s=s.value,c=n+K4(s,a++),o+=Tg(s,e,t,c,i);else if(s==="object")throw e=String(r),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function v0(r,e,t){if(r==null)return r;var n=[],i=0;return Tg(r,n,"","",function(s){return e.call(t,s,i++)}),n}function Tq(r){if(r._status===-1){var e=r._result;e=e(),e.then(function(t){(r._status===0||r._status===-1)&&(r._status=1,r._result=t)},function(t){(r._status===0||r._status===-1)&&(r._status=2,r._result=t)}),r._status===-1&&(r._status=0,r._result=e)}if(r._status===1)return r._result.default;throw r._result}var mn={current:null},Pg={transition:null},Pq={ReactCurrentDispatcher:mn,ReactCurrentBatchConfig:Pg,ReactCurrentOwner:O9};function FO(){throw Error("act(...) is not supported in production builds of React.")}Je.Children={map:v0,forEach:function(r,e,t){v0(r,function(){e.apply(this,arguments)},t)},count:function(r){var e=0;return v0(r,function(){e++}),e},toArray:function(r){return v0(r,function(e){return e})||[]},only:function(r){if(!M9(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};Je.Component=Ah;Je.Fragment=mq;Je.Profiler=vq;Je.PureComponent=$9;Je.StrictMode=wq;Je.Suspense=xq;Je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Pq;Je.act=FO;Je.cloneElement=function(r,e,t){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var n=OO({},r.props),i=r.key,s=r.ref,o=r._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=O9.current),e.key!==void 0&&(i=""+e.key),r.type&&r.type.defaultProps)var a=r.type.defaultProps;for(c in e)LO.call(e,c)&&!BO.hasOwnProperty(c)&&(n[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)n.children=t;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];n.children=a}return{$$typeof:kp,type:r.type,key:i,ref:s,props:n,_owner:o}};Je.createContext=function(r){return r={$$typeof:Eq,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:bq,_context:r},r.Consumer=r};Je.createElement=UO;Je.createFactory=function(r){var e=UO.bind(null,r);return e.type=r,e};Je.createRef=function(){return{current:null}};Je.forwardRef=function(r){return{$$typeof:Sq,render:r}};Je.isValidElement=M9;Je.lazy=function(r){return{$$typeof:Iq,_payload:{_status:-1,_result:r},_init:Tq}};Je.memo=function(r,e){return{$$typeof:Aq,type:r,compare:e===void 0?null:e}};Je.startTransition=function(r){var e=Pg.transition;Pg.transition={};try{r()}finally{Pg.transition=e}};Je.unstable_act=FO;Je.useCallback=function(r,e){return mn.current.useCallback(r,e)};Je.useContext=function(r){return mn.current.useContext(r)};Je.useDebugValue=function(){};Je.useDeferredValue=function(r){return mn.current.useDeferredValue(r)};Je.useEffect=function(r,e){return mn.current.useEffect(r,e)};Je.useId=function(){return mn.current.useId()};Je.useImperativeHandle=function(r,e,t){return mn.current.useImperativeHandle(r,e,t)};Je.useInsertionEffect=function(r,e){return mn.current.useInsertionEffect(r,e)};Je.useLayoutEffect=function(r,e){return mn.current.useLayoutEffect(r,e)};Je.useMemo=function(r,e){return mn.current.useMemo(r,e)};Je.useReducer=function(r,e,t){return mn.current.useReducer(r,e,t)};Je.useRef=function(r){return mn.current.useRef(r)};Je.useState=function(r){return mn.current.useState(r)};Je.useSyncExternalStore=function(r,e,t){return mn.current.useSyncExternalStore(r,e,t)};Je.useTransition=function(){return mn.current.useTransition()};Je.version="18.3.1";$O.exports=Je;var Ua=$O.exports;const Dq=Qs(Ua);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $q=Ua,Nq=Symbol.for("react.element"),Oq=Symbol.for("react.fragment"),Mq=Object.prototype.hasOwnProperty,Rq=$q.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Lq={key:!0,ref:!0,__self:!0,__source:!0};function zO(r,e,t){var n,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)Mq.call(e,n)&&!Lq.hasOwnProperty(n)&&(i[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)i[n]===void 0&&(i[n]=e[n]);return{$$typeof:Nq,type:r,key:s,ref:o,props:i,_owner:Rq.current}}v3.Fragment=Oq;v3.jsx=zO;v3.jsxs=zO;DO.exports=v3;var jn=DO.exports,n5={},VO={exports:{}},oi={},KO={exports:{}},HO={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function e(B,V){var W=B.length;B.push(V);e:for(;0<W;){var ee=W-1>>>1,Y=B[ee];if(0<i(Y,V))B[ee]=V,B[W]=Y,W=ee;else break e}}function t(B){return B.length===0?null:B[0]}function n(B){if(B.length===0)return null;var V=B[0],W=B.pop();if(W!==V){B[0]=W;e:for(var ee=0,Y=B.length,ce=Y>>>1;ee<ce;){var pe=2*(ee+1)-1,ue=B[pe],le=pe+1,Me=B[le];if(0>i(ue,W))le<Y&&0>i(Me,ue)?(B[ee]=Me,B[le]=W,ee=le):(B[ee]=ue,B[pe]=W,ee=pe);else if(le<Y&&0>i(Me,W))B[ee]=Me,B[le]=W,ee=le;else break e}}return V}function i(B,V){var W=B.sortIndex-V.sortIndex;return W!==0?W:B.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();r.unstable_now=function(){return o.now()-a}}var c=[],l=[],d=1,h=null,p=3,w=!1,f=!1,g=!1,v=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(B){for(var V=t(l);V!==null;){if(V.callback===null)n(l);else if(V.startTime<=B)n(l),V.sortIndex=V.expirationTime,e(c,V);else break;V=t(l)}}function S(B){if(g=!1,b(B),!f)if(t(c)!==null)f=!0,J(I);else{var V=t(l);V!==null&&q(S,V.startTime-B)}}function I(B,V){f=!1,g&&(g=!1,y(_),_=-1),w=!0;var W=p;try{for(b(V),h=t(c);h!==null&&(!(h.expirationTime>V)||B&&!j());){var ee=h.callback;if(typeof ee=="function"){h.callback=null,p=h.priorityLevel;var Y=ee(h.expirationTime<=V);V=r.unstable_now(),typeof Y=="function"?h.callback=Y:h===t(c)&&n(c),b(V)}else n(c);h=t(c)}if(h!==null)var ce=!0;else{var pe=t(l);pe!==null&&q(S,pe.startTime-V),ce=!1}return ce}finally{h=null,p=W,w=!1}}var T=!1,A=null,_=-1,$=5,z=-1;function j(){return!(r.unstable_now()-z<$)}function K(){if(A!==null){var B=r.unstable_now();z=B;var V=!0;try{V=A(!0,B)}finally{V?Z():(T=!1,A=null)}}else T=!1}var Z;if(typeof m=="function")Z=function(){m(K)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,Q=G.port2;G.port1.onmessage=K,Z=function(){Q.postMessage(null)}}else Z=function(){v(K,0)};function J(B){A=B,T||(T=!0,Z())}function q(B,V){_=v(function(){B(r.unstable_now())},V)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(B){B.callback=null},r.unstable_continueExecution=function(){f||w||(f=!0,J(I))},r.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<B?Math.floor(1e3/B):5},r.unstable_getCurrentPriorityLevel=function(){return p},r.unstable_getFirstCallbackNode=function(){return t(c)},r.unstable_next=function(B){switch(p){case 1:case 2:case 3:var V=3;break;default:V=p}var W=p;p=V;try{return B()}finally{p=W}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(B,V){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var W=p;p=B;try{return V()}finally{p=W}},r.unstable_scheduleCallback=function(B,V,W){var ee=r.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?ee+W:ee):W=ee,B){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=W+Y,B={id:d++,callback:V,priorityLevel:B,startTime:W,expirationTime:Y,sortIndex:-1},W>ee?(B.sortIndex=W,e(l,B),t(c)===null&&B===t(l)&&(g?(y(_),_=-1):g=!0,q(S,W-ee))):(B.sortIndex=Y,e(c,B),f||w||(f=!0,J(I))),B},r.unstable_shouldYield=j,r.unstable_wrapCallback=function(B){var V=p;return function(){var W=p;p=V;try{return B.apply(this,arguments)}finally{p=W}}}})(HO);KO.exports=HO;var Bq=KO.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uq=Ua,ni=Bq;function se(r){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+r,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+r+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var jO=new Set,S1={};function hu(r,e){Od(r,e),Od(r+"Capture",e)}function Od(r,e){for(S1[r]=e,r=0;r<e.length;r++)jO.add(e[r])}var Lo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),i5=Object.prototype.hasOwnProperty,Fq=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qA={},WA={};function zq(r){return i5.call(WA,r)?!0:i5.call(qA,r)?!1:Fq.test(r)?WA[r]=!0:(qA[r]=!0,!1)}function Vq(r,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function Kq(r,e,t,n){if(e===null||typeof e>"u"||Vq(r,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function wn(r,e,t,n,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=r,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var _r={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){_r[r]=new wn(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var e=r[0];_r[e]=new wn(e,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){_r[r]=new wn(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){_r[r]=new wn(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){_r[r]=new wn(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){_r[r]=new wn(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){_r[r]=new wn(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){_r[r]=new wn(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){_r[r]=new wn(r,5,!1,r.toLowerCase(),null,!1,!1)});var R9=/[\-:]([a-z])/g;function L9(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var e=r.replace(R9,L9);_r[e]=new wn(e,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var e=r.replace(R9,L9);_r[e]=new wn(e,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var e=r.replace(R9,L9);_r[e]=new wn(e,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){_r[r]=new wn(r,1,!1,r.toLowerCase(),null,!1,!1)});_r.xlinkHref=new wn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){_r[r]=new wn(r,1,!1,r.toLowerCase(),null,!0,!0)});function B9(r,e,t,n){var i=_r.hasOwnProperty(e)?_r[e]:null;(i!==null?i.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Kq(e,t,i,n)&&(t=null),n||i===null?zq(e)&&(t===null?r.removeAttribute(e):r.setAttribute(e,""+t)):i.mustUseProperty?r[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,n=i.attributeNamespace,t===null?r.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,n?r.setAttributeNS(n,e,t):r.setAttribute(e,t))))}var Yo=Uq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b0=Symbol.for("react.element"),Hu=Symbol.for("react.portal"),ju=Symbol.for("react.fragment"),U9=Symbol.for("react.strict_mode"),s5=Symbol.for("react.profiler"),qO=Symbol.for("react.provider"),WO=Symbol.for("react.context"),F9=Symbol.for("react.forward_ref"),o5=Symbol.for("react.suspense"),a5=Symbol.for("react.suspense_list"),z9=Symbol.for("react.memo"),Ca=Symbol.for("react.lazy"),GO=Symbol.for("react.offscreen"),GA=Symbol.iterator;function Jh(r){return r===null||typeof r!="object"?null:(r=GA&&r[GA]||r["@@iterator"],typeof r=="function"?r:null)}var qt=Object.assign,H4;function Lf(r){if(H4===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);H4=e&&e[1]||""}return`
`+H4+r}var j4=!1;function q4(r,e){if(!r||j4)return"";j4=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var n=l}Reflect.construct(r,[],e)}else{try{e.call()}catch(l){n=l}r.call(e.prototype)}else{try{throw Error()}catch(l){n=l}r()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),s=n.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var c=`
`+i[o].replace(" at new "," at ");return r.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",r.displayName)),c}while(1<=o&&0<=a);break}}}finally{j4=!1,Error.prepareStackTrace=t}return(r=r?r.displayName||r.name:"")?Lf(r):""}function Hq(r){switch(r.tag){case 5:return Lf(r.type);case 16:return Lf("Lazy");case 13:return Lf("Suspense");case 19:return Lf("SuspenseList");case 0:case 2:case 15:return r=q4(r.type,!1),r;case 11:return r=q4(r.type.render,!1),r;case 1:return r=q4(r.type,!0),r;default:return""}}function c5(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case ju:return"Fragment";case Hu:return"Portal";case s5:return"Profiler";case U9:return"StrictMode";case o5:return"Suspense";case a5:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case WO:return(r.displayName||"Context")+".Consumer";case qO:return(r._context.displayName||"Context")+".Provider";case F9:var e=r.render;return r=r.displayName,r||(r=e.displayName||e.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case z9:return e=r.displayName||null,e!==null?e:c5(r.type)||"Memo";case Ca:e=r._payload,r=r._init;try{return c5(r(e))}catch{}}return null}function jq(r){var e=r.type;switch(r.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=e.render,r=r.displayName||r.name||"",e.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return c5(e);case 8:return e===U9?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function mc(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function QO(r){var e=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function qq(r){var e=QO(r)?"checked":"value",t=Object.getOwnPropertyDescriptor(r.constructor.prototype,e),n=""+r[e];if(!r.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(r,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){n=""+o,s.call(this,o)}}),Object.defineProperty(r,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){r._valueTracker=null,delete r[e]}}}}function E0(r){r._valueTracker||(r._valueTracker=qq(r))}function YO(r){if(!r)return!1;var e=r._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return r&&(n=QO(r)?r.checked?"true":"false":r.value),r=n,r!==t?(e.setValue(r),!0):!1}function S2(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function l5(r,e){var t=e.checked;return qt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??r._wrapperState.initialChecked})}function QA(r,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=mc(e.value!=null?e.value:t),r._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function XO(r,e){e=e.checked,e!=null&&B9(r,"checked",e,!1)}function u5(r,e){XO(r,e);var t=mc(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&r.value===""||r.value!=t)&&(r.value=""+t):r.value!==""+t&&(r.value=""+t);else if(n==="submit"||n==="reset"){r.removeAttribute("value");return}e.hasOwnProperty("value")?d5(r,e.type,t):e.hasOwnProperty("defaultValue")&&d5(r,e.type,mc(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(r.defaultChecked=!!e.defaultChecked)}function YA(r,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+r._wrapperState.initialValue,t||e===r.value||(r.value=e),r.defaultValue=e}t=r.name,t!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,t!==""&&(r.name=t)}function d5(r,e,t){(e!=="number"||S2(r.ownerDocument)!==r)&&(t==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+t&&(r.defaultValue=""+t))}var Bf=Array.isArray;function ad(r,e,t,n){if(r=r.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<r.length;t++)i=e.hasOwnProperty("$"+r[t].value),r[t].selected!==i&&(r[t].selected=i),i&&n&&(r[t].defaultSelected=!0)}else{for(t=""+mc(t),e=null,i=0;i<r.length;i++){if(r[i].value===t){r[i].selected=!0,n&&(r[i].defaultSelected=!0);return}e!==null||r[i].disabled||(e=r[i])}e!==null&&(e.selected=!0)}}function h5(r,e){if(e.dangerouslySetInnerHTML!=null)throw Error(se(91));return qt({},e,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function XA(r,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(se(92));if(Bf(t)){if(1<t.length)throw Error(se(93));t=t[0]}e=t}e==null&&(e=""),t=e}r._wrapperState={initialValue:mc(t)}}function JO(r,e){var t=mc(e.value),n=mc(e.defaultValue);t!=null&&(t=""+t,t!==r.value&&(r.value=t),e.defaultValue==null&&r.defaultValue!==t&&(r.defaultValue=t)),n!=null&&(r.defaultValue=""+n)}function JA(r){var e=r.textContent;e===r._wrapperState.initialValue&&e!==""&&e!==null&&(r.value=e)}function ZO(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function f5(r,e){return r==null||r==="http://www.w3.org/1999/xhtml"?ZO(e):r==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var S0,eM=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return r(e,t,n,i)})}:r}(function(r,e){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=e;else{for(S0=S0||document.createElement("div"),S0.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=S0.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;e.firstChild;)r.appendChild(e.firstChild)}});function x1(r,e){if(e){var t=r.firstChild;if(t&&t===r.lastChild&&t.nodeType===3){t.nodeValue=e;return}}r.textContent=e}var Xf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Wq=["Webkit","ms","Moz","O"];Object.keys(Xf).forEach(function(r){Wq.forEach(function(e){e=e+r.charAt(0).toUpperCase()+r.substring(1),Xf[e]=Xf[r]})});function tM(r,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Xf.hasOwnProperty(r)&&Xf[r]?(""+e).trim():e+"px"}function rM(r,e){r=r.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,i=tM(t,e[t],n);t==="float"&&(t="cssFloat"),n?r.setProperty(t,i):r[t]=i}}var Gq=qt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function p5(r,e){if(e){if(Gq[r]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(se(137,r));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(se(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(se(61))}if(e.style!=null&&typeof e.style!="object")throw Error(se(62))}}function g5(r,e){if(r.indexOf("-")===-1)return typeof e.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var y5=null;function V9(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var m5=null,cd=null,ld=null;function ZA(r){if(r=Pp(r)){if(typeof m5!="function")throw Error(se(280));var e=r.stateNode;e&&(e=A3(e),m5(r.stateNode,r.type,e))}}function nM(r){cd?ld?ld.push(r):ld=[r]:cd=r}function iM(){if(cd){var r=cd,e=ld;if(ld=cd=null,ZA(r),e)for(r=0;r<e.length;r++)ZA(e[r])}}function sM(r,e){return r(e)}function oM(){}var W4=!1;function aM(r,e,t){if(W4)return r(e,t);W4=!0;try{return sM(r,e,t)}finally{W4=!1,(cd!==null||ld!==null)&&(oM(),iM())}}function A1(r,e){var t=r.stateNode;if(t===null)return null;var n=A3(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(r=r.type,n=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!n;break e;default:r=!1}if(r)return null;if(t&&typeof t!="function")throw Error(se(231,e,typeof t));return t}var w5=!1;if(Lo)try{var Zh={};Object.defineProperty(Zh,"passive",{get:function(){w5=!0}}),window.addEventListener("test",Zh,Zh),window.removeEventListener("test",Zh,Zh)}catch{w5=!1}function Qq(r,e,t,n,i,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(d){this.onError(d)}}var Jf=!1,x2=null,A2=!1,v5=null,Yq={onError:function(r){Jf=!0,x2=r}};function Xq(r,e,t,n,i,s,o,a,c){Jf=!1,x2=null,Qq.apply(Yq,arguments)}function Jq(r,e,t,n,i,s,o,a,c){if(Xq.apply(this,arguments),Jf){if(Jf){var l=x2;Jf=!1,x2=null}else throw Error(se(198));A2||(A2=!0,v5=l)}}function fu(r){var e=r,t=r;if(r.alternate)for(;e.return;)e=e.return;else{r=e;do e=r,e.flags&4098&&(t=e.return),r=e.return;while(r)}return e.tag===3?t:null}function cM(r){if(r.tag===13){var e=r.memoizedState;if(e===null&&(r=r.alternate,r!==null&&(e=r.memoizedState)),e!==null)return e.dehydrated}return null}function eI(r){if(fu(r)!==r)throw Error(se(188))}function Zq(r){var e=r.alternate;if(!e){if(e=fu(r),e===null)throw Error(se(188));return e!==r?null:r}for(var t=r,n=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(n=i.return,n!==null){t=n;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return eI(i),r;if(s===n)return eI(i),e;s=s.sibling}throw Error(se(188))}if(t.return!==n.return)t=i,n=s;else{for(var o=!1,a=i.child;a;){if(a===t){o=!0,t=i,n=s;break}if(a===n){o=!0,n=i,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,n=i;break}if(a===n){o=!0,n=s,t=i;break}a=a.sibling}if(!o)throw Error(se(189))}}if(t.alternate!==n)throw Error(se(190))}if(t.tag!==3)throw Error(se(188));return t.stateNode.current===t?r:e}function lM(r){return r=Zq(r),r!==null?uM(r):null}function uM(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var e=uM(r);if(e!==null)return e;r=r.sibling}return null}var dM=ni.unstable_scheduleCallback,tI=ni.unstable_cancelCallback,eW=ni.unstable_shouldYield,tW=ni.unstable_requestPaint,Jt=ni.unstable_now,rW=ni.unstable_getCurrentPriorityLevel,K9=ni.unstable_ImmediatePriority,hM=ni.unstable_UserBlockingPriority,I2=ni.unstable_NormalPriority,nW=ni.unstable_LowPriority,fM=ni.unstable_IdlePriority,b3=null,Us=null;function iW(r){if(Us&&typeof Us.onCommitFiberRoot=="function")try{Us.onCommitFiberRoot(b3,r,void 0,(r.current.flags&128)===128)}catch{}}var cs=Math.clz32?Math.clz32:aW,sW=Math.log,oW=Math.LN2;function aW(r){return r>>>=0,r===0?32:31-(sW(r)/oW|0)|0}var x0=64,A0=4194304;function Uf(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function C2(r,e){var t=r.pendingLanes;if(t===0)return 0;var n=0,i=r.suspendedLanes,s=r.pingedLanes,o=t&268435455;if(o!==0){var a=o&~i;a!==0?n=Uf(a):(s&=o,s!==0&&(n=Uf(s)))}else o=t&~i,o!==0?n=Uf(o):s!==0&&(n=Uf(s));if(n===0)return 0;if(e!==0&&e!==n&&!(e&i)&&(i=n&-n,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(n&4&&(n|=t&16),e=r.entangledLanes,e!==0)for(r=r.entanglements,e&=n;0<e;)t=31-cs(e),i=1<<t,n|=r[t],e&=~i;return n}function cW(r,e){switch(r){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function lW(r,e){for(var t=r.suspendedLanes,n=r.pingedLanes,i=r.expirationTimes,s=r.pendingLanes;0<s;){var o=31-cs(s),a=1<<o,c=i[o];c===-1?(!(a&t)||a&n)&&(i[o]=cW(a,e)):c<=e&&(r.expiredLanes|=a),s&=~a}}function b5(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function pM(){var r=x0;return x0<<=1,!(x0&4194240)&&(x0=64),r}function G4(r){for(var e=[],t=0;31>t;t++)e.push(r);return e}function _p(r,e,t){r.pendingLanes|=e,e!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,e=31-cs(e),r[e]=t}function uW(r,e){var t=r.pendingLanes&~e;r.pendingLanes=e,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=e,r.mutableReadLanes&=e,r.entangledLanes&=e,e=r.entanglements;var n=r.eventTimes;for(r=r.expirationTimes;0<t;){var i=31-cs(t),s=1<<i;e[i]=0,n[i]=-1,r[i]=-1,t&=~s}}function H9(r,e){var t=r.entangledLanes|=e;for(r=r.entanglements;t;){var n=31-cs(t),i=1<<n;i&e|r[n]&e&&(r[n]|=e),t&=~i}}var Et=0;function gM(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var yM,j9,mM,wM,vM,E5=!1,I0=[],tc=null,rc=null,nc=null,I1=new Map,C1=new Map,Fa=[],dW="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function rI(r,e){switch(r){case"focusin":case"focusout":tc=null;break;case"dragenter":case"dragleave":rc=null;break;case"mouseover":case"mouseout":nc=null;break;case"pointerover":case"pointerout":I1.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":C1.delete(e.pointerId)}}function ef(r,e,t,n,i,s){return r===null||r.nativeEvent!==s?(r={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Pp(e),e!==null&&j9(e)),r):(r.eventSystemFlags|=n,e=r.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),r)}function hW(r,e,t,n,i){switch(e){case"focusin":return tc=ef(tc,r,e,t,n,i),!0;case"dragenter":return rc=ef(rc,r,e,t,n,i),!0;case"mouseover":return nc=ef(nc,r,e,t,n,i),!0;case"pointerover":var s=i.pointerId;return I1.set(s,ef(I1.get(s)||null,r,e,t,n,i)),!0;case"gotpointercapture":return s=i.pointerId,C1.set(s,ef(C1.get(s)||null,r,e,t,n,i)),!0}return!1}function bM(r){var e=pl(r.target);if(e!==null){var t=fu(e);if(t!==null){if(e=t.tag,e===13){if(e=cM(t),e!==null){r.blockedOn=e,vM(r.priority,function(){mM(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){r.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Dg(r){if(r.blockedOn!==null)return!1;for(var e=r.targetContainers;0<e.length;){var t=S5(r.domEventName,r.eventSystemFlags,e[0],r.nativeEvent);if(t===null){t=r.nativeEvent;var n=new t.constructor(t.type,t);y5=n,t.target.dispatchEvent(n),y5=null}else return e=Pp(t),e!==null&&j9(e),r.blockedOn=t,!1;e.shift()}return!0}function nI(r,e,t){Dg(r)&&t.delete(e)}function fW(){E5=!1,tc!==null&&Dg(tc)&&(tc=null),rc!==null&&Dg(rc)&&(rc=null),nc!==null&&Dg(nc)&&(nc=null),I1.forEach(nI),C1.forEach(nI)}function tf(r,e){r.blockedOn===e&&(r.blockedOn=null,E5||(E5=!0,ni.unstable_scheduleCallback(ni.unstable_NormalPriority,fW)))}function k1(r){function e(i){return tf(i,r)}if(0<I0.length){tf(I0[0],r);for(var t=1;t<I0.length;t++){var n=I0[t];n.blockedOn===r&&(n.blockedOn=null)}}for(tc!==null&&tf(tc,r),rc!==null&&tf(rc,r),nc!==null&&tf(nc,r),I1.forEach(e),C1.forEach(e),t=0;t<Fa.length;t++)n=Fa[t],n.blockedOn===r&&(n.blockedOn=null);for(;0<Fa.length&&(t=Fa[0],t.blockedOn===null);)bM(t),t.blockedOn===null&&Fa.shift()}var ud=Yo.ReactCurrentBatchConfig,k2=!0;function pW(r,e,t,n){var i=Et,s=ud.transition;ud.transition=null;try{Et=1,q9(r,e,t,n)}finally{Et=i,ud.transition=s}}function gW(r,e,t,n){var i=Et,s=ud.transition;ud.transition=null;try{Et=4,q9(r,e,t,n)}finally{Et=i,ud.transition=s}}function q9(r,e,t,n){if(k2){var i=S5(r,e,t,n);if(i===null)i8(r,e,n,_2,t),rI(r,n);else if(hW(i,r,e,t,n))n.stopPropagation();else if(rI(r,n),e&4&&-1<dW.indexOf(r)){for(;i!==null;){var s=Pp(i);if(s!==null&&yM(s),s=S5(r,e,t,n),s===null&&i8(r,e,n,_2,t),s===i)break;i=s}i!==null&&n.stopPropagation()}else i8(r,e,n,null,t)}}var _2=null;function S5(r,e,t,n){if(_2=null,r=V9(n),r=pl(r),r!==null)if(e=fu(r),e===null)r=null;else if(t=e.tag,t===13){if(r=cM(e),r!==null)return r;r=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;r=null}else e!==r&&(r=null);return _2=r,null}function EM(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(rW()){case K9:return 1;case hM:return 4;case I2:case nW:return 16;case fM:return 536870912;default:return 16}default:return 16}}var Wa=null,W9=null,$g=null;function SM(){if($g)return $g;var r,e=W9,t=e.length,n,i="value"in Wa?Wa.value:Wa.textContent,s=i.length;for(r=0;r<t&&e[r]===i[r];r++);var o=t-r;for(n=1;n<=o&&e[t-n]===i[s-n];n++);return $g=i.slice(r,1<n?1-n:void 0)}function Ng(r){var e=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&e===13&&(r=13)):r=e,r===10&&(r=13),32<=r||r===13?r:0}function C0(){return!0}function iI(){return!1}function ai(r){function e(t,n,i,s,o){this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in r)r.hasOwnProperty(a)&&(t=r[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?C0:iI,this.isPropagationStopped=iI,this}return qt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=C0)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=C0)},persist:function(){},isPersistent:C0}),e}var Ih={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},G9=ai(Ih),Tp=qt({},Ih,{view:0,detail:0}),yW=ai(Tp),Q4,Y4,rf,E3=qt({},Tp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Q9,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==rf&&(rf&&r.type==="mousemove"?(Q4=r.screenX-rf.screenX,Y4=r.screenY-rf.screenY):Y4=Q4=0,rf=r),Q4)},movementY:function(r){return"movementY"in r?r.movementY:Y4}}),sI=ai(E3),mW=qt({},E3,{dataTransfer:0}),wW=ai(mW),vW=qt({},Tp,{relatedTarget:0}),X4=ai(vW),bW=qt({},Ih,{animationName:0,elapsedTime:0,pseudoElement:0}),EW=ai(bW),SW=qt({},Ih,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),xW=ai(SW),AW=qt({},Ih,{data:0}),oI=ai(AW),IW={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},CW={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kW={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _W(r){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(r):(r=kW[r])?!!e[r]:!1}function Q9(){return _W}var TW=qt({},Tp,{key:function(r){if(r.key){var e=IW[r.key]||r.key;if(e!=="Unidentified")return e}return r.type==="keypress"?(r=Ng(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?CW[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Q9,charCode:function(r){return r.type==="keypress"?Ng(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Ng(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),PW=ai(TW),DW=qt({},E3,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),aI=ai(DW),$W=qt({},Tp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Q9}),NW=ai($W),OW=qt({},Ih,{propertyName:0,elapsedTime:0,pseudoElement:0}),MW=ai(OW),RW=qt({},E3,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),LW=ai(RW),BW=[9,13,27,32],Y9=Lo&&"CompositionEvent"in window,Zf=null;Lo&&"documentMode"in document&&(Zf=document.documentMode);var UW=Lo&&"TextEvent"in window&&!Zf,xM=Lo&&(!Y9||Zf&&8<Zf&&11>=Zf),cI=" ",lI=!1;function AM(r,e){switch(r){case"keyup":return BW.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function IM(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var qu=!1;function FW(r,e){switch(r){case"compositionend":return IM(e);case"keypress":return e.which!==32?null:(lI=!0,cI);case"textInput":return r=e.data,r===cI&&lI?null:r;default:return null}}function zW(r,e){if(qu)return r==="compositionend"||!Y9&&AM(r,e)?(r=SM(),$g=W9=Wa=null,qu=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return xM&&e.locale!=="ko"?null:e.data;default:return null}}var VW={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function uI(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e==="input"?!!VW[r.type]:e==="textarea"}function CM(r,e,t,n){nM(n),e=T2(e,"onChange"),0<e.length&&(t=new G9("onChange","change",null,t,n),r.push({event:t,listeners:e}))}var e1=null,_1=null;function KW(r){LM(r,0)}function S3(r){var e=Qu(r);if(YO(e))return r}function HW(r,e){if(r==="change")return e}var kM=!1;if(Lo){var J4;if(Lo){var Z4="oninput"in document;if(!Z4){var dI=document.createElement("div");dI.setAttribute("oninput","return;"),Z4=typeof dI.oninput=="function"}J4=Z4}else J4=!1;kM=J4&&(!document.documentMode||9<document.documentMode)}function hI(){e1&&(e1.detachEvent("onpropertychange",_M),_1=e1=null)}function _M(r){if(r.propertyName==="value"&&S3(_1)){var e=[];CM(e,_1,r,V9(r)),aM(KW,e)}}function jW(r,e,t){r==="focusin"?(hI(),e1=e,_1=t,e1.attachEvent("onpropertychange",_M)):r==="focusout"&&hI()}function qW(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return S3(_1)}function WW(r,e){if(r==="click")return S3(e)}function GW(r,e){if(r==="input"||r==="change")return S3(e)}function QW(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var ps=typeof Object.is=="function"?Object.is:QW;function T1(r,e){if(ps(r,e))return!0;if(typeof r!="object"||r===null||typeof e!="object"||e===null)return!1;var t=Object.keys(r),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var i=t[n];if(!i5.call(e,i)||!ps(r[i],e[i]))return!1}return!0}function fI(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function pI(r,e){var t=fI(r);r=0;for(var n;t;){if(t.nodeType===3){if(n=r+t.textContent.length,r<=e&&n>=e)return{node:t,offset:e-r};r=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=fI(t)}}function TM(r,e){return r&&e?r===e?!0:r&&r.nodeType===3?!1:e&&e.nodeType===3?TM(r,e.parentNode):"contains"in r?r.contains(e):r.compareDocumentPosition?!!(r.compareDocumentPosition(e)&16):!1:!1}function PM(){for(var r=window,e=S2();e instanceof r.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)r=e.contentWindow;else break;e=S2(r.document)}return e}function X9(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e&&(e==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||e==="textarea"||r.contentEditable==="true")}function YW(r){var e=PM(),t=r.focusedElem,n=r.selectionRange;if(e!==t&&t&&t.ownerDocument&&TM(t.ownerDocument.documentElement,t)){if(n!==null&&X9(t)){if(e=n.start,r=n.end,r===void 0&&(r=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(r,t.value.length);else if(r=(e=t.ownerDocument||document)&&e.defaultView||window,r.getSelection){r=r.getSelection();var i=t.textContent.length,s=Math.min(n.start,i);n=n.end===void 0?s:Math.min(n.end,i),!r.extend&&s>n&&(i=n,n=s,s=i),i=pI(t,s);var o=pI(t,n);i&&o&&(r.rangeCount!==1||r.anchorNode!==i.node||r.anchorOffset!==i.offset||r.focusNode!==o.node||r.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),r.removeAllRanges(),s>n?(r.addRange(e),r.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),r.addRange(e)))}}for(e=[],r=t;r=r.parentNode;)r.nodeType===1&&e.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)r=e[t],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var XW=Lo&&"documentMode"in document&&11>=document.documentMode,Wu=null,x5=null,t1=null,A5=!1;function gI(r,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;A5||Wu==null||Wu!==S2(n)||(n=Wu,"selectionStart"in n&&X9(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),t1&&T1(t1,n)||(t1=n,n=T2(x5,"onSelect"),0<n.length&&(e=new G9("onSelect","select",null,e,t),r.push({event:e,listeners:n}),e.target=Wu)))}function k0(r,e){var t={};return t[r.toLowerCase()]=e.toLowerCase(),t["Webkit"+r]="webkit"+e,t["Moz"+r]="moz"+e,t}var Gu={animationend:k0("Animation","AnimationEnd"),animationiteration:k0("Animation","AnimationIteration"),animationstart:k0("Animation","AnimationStart"),transitionend:k0("Transition","TransitionEnd")},e8={},DM={};Lo&&(DM=document.createElement("div").style,"AnimationEvent"in window||(delete Gu.animationend.animation,delete Gu.animationiteration.animation,delete Gu.animationstart.animation),"TransitionEvent"in window||delete Gu.transitionend.transition);function x3(r){if(e8[r])return e8[r];if(!Gu[r])return r;var e=Gu[r],t;for(t in e)if(e.hasOwnProperty(t)&&t in DM)return e8[r]=e[t];return r}var $M=x3("animationend"),NM=x3("animationiteration"),OM=x3("animationstart"),MM=x3("transitionend"),RM=new Map,yI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Mc(r,e){RM.set(r,e),hu(e,[r])}for(var t8=0;t8<yI.length;t8++){var r8=yI[t8],JW=r8.toLowerCase(),ZW=r8[0].toUpperCase()+r8.slice(1);Mc(JW,"on"+ZW)}Mc($M,"onAnimationEnd");Mc(NM,"onAnimationIteration");Mc(OM,"onAnimationStart");Mc("dblclick","onDoubleClick");Mc("focusin","onFocus");Mc("focusout","onBlur");Mc(MM,"onTransitionEnd");Od("onMouseEnter",["mouseout","mouseover"]);Od("onMouseLeave",["mouseout","mouseover"]);Od("onPointerEnter",["pointerout","pointerover"]);Od("onPointerLeave",["pointerout","pointerover"]);hu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));hu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));hu("onBeforeInput",["compositionend","keypress","textInput","paste"]);hu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));hu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));hu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ff="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),eG=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ff));function mI(r,e,t){var n=r.type||"unknown-event";r.currentTarget=t,Jq(n,e,void 0,r),r.currentTarget=null}function LM(r,e){e=(e&4)!==0;for(var t=0;t<r.length;t++){var n=r[t],i=n.event;n=n.listeners;e:{var s=void 0;if(e)for(var o=n.length-1;0<=o;o--){var a=n[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&i.isPropagationStopped())break e;mI(i,a,l),s=c}else for(o=0;o<n.length;o++){if(a=n[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&i.isPropagationStopped())break e;mI(i,a,l),s=c}}}if(A2)throw r=v5,A2=!1,v5=null,r}function Mt(r,e){var t=e[T5];t===void 0&&(t=e[T5]=new Set);var n=r+"__bubble";t.has(n)||(BM(e,r,2,!1),t.add(n))}function n8(r,e,t){var n=0;e&&(n|=4),BM(t,r,n,e)}var _0="_reactListening"+Math.random().toString(36).slice(2);function P1(r){if(!r[_0]){r[_0]=!0,jO.forEach(function(t){t!=="selectionchange"&&(eG.has(t)||n8(t,!1,r),n8(t,!0,r))});var e=r.nodeType===9?r:r.ownerDocument;e===null||e[_0]||(e[_0]=!0,n8("selectionchange",!1,e))}}function BM(r,e,t,n){switch(EM(e)){case 1:var i=pW;break;case 4:i=gW;break;default:i=q9}t=i.bind(null,e,t,r),i=void 0,!w5||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),n?i!==void 0?r.addEventListener(e,t,{capture:!0,passive:i}):r.addEventListener(e,t,!0):i!==void 0?r.addEventListener(e,t,{passive:i}):r.addEventListener(e,t,!1)}function i8(r,e,t,n,i){var s=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var a=n.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=n.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;a!==null;){if(o=pl(a),o===null)return;if(c=o.tag,c===5||c===6){n=s=o;continue e}a=a.parentNode}}n=n.return}aM(function(){var l=s,d=V9(t),h=[];e:{var p=RM.get(r);if(p!==void 0){var w=G9,f=r;switch(r){case"keypress":if(Ng(t)===0)break e;case"keydown":case"keyup":w=PW;break;case"focusin":f="focus",w=X4;break;case"focusout":f="blur",w=X4;break;case"beforeblur":case"afterblur":w=X4;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":w=sI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":w=wW;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":w=NW;break;case $M:case NM:case OM:w=EW;break;case MM:w=MW;break;case"scroll":w=yW;break;case"wheel":w=LW;break;case"copy":case"cut":case"paste":w=xW;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":w=aI}var g=(e&4)!==0,v=!g&&r==="scroll",y=g?p!==null?p+"Capture":null:p;g=[];for(var m=l,b;m!==null;){b=m;var S=b.stateNode;if(b.tag===5&&S!==null&&(b=S,y!==null&&(S=A1(m,y),S!=null&&g.push(D1(m,S,b)))),v)break;m=m.return}0<g.length&&(p=new w(p,f,null,t,d),h.push({event:p,listeners:g}))}}if(!(e&7)){e:{if(p=r==="mouseover"||r==="pointerover",w=r==="mouseout"||r==="pointerout",p&&t!==y5&&(f=t.relatedTarget||t.fromElement)&&(pl(f)||f[Bo]))break e;if((w||p)&&(p=d.window===d?d:(p=d.ownerDocument)?p.defaultView||p.parentWindow:window,w?(f=t.relatedTarget||t.toElement,w=l,f=f?pl(f):null,f!==null&&(v=fu(f),f!==v||f.tag!==5&&f.tag!==6)&&(f=null)):(w=null,f=l),w!==f)){if(g=sI,S="onMouseLeave",y="onMouseEnter",m="mouse",(r==="pointerout"||r==="pointerover")&&(g=aI,S="onPointerLeave",y="onPointerEnter",m="pointer"),v=w==null?p:Qu(w),b=f==null?p:Qu(f),p=new g(S,m+"leave",w,t,d),p.target=v,p.relatedTarget=b,S=null,pl(d)===l&&(g=new g(y,m+"enter",f,t,d),g.target=b,g.relatedTarget=v,S=g),v=S,w&&f)t:{for(g=w,y=f,m=0,b=g;b;b=Iu(b))m++;for(b=0,S=y;S;S=Iu(S))b++;for(;0<m-b;)g=Iu(g),m--;for(;0<b-m;)y=Iu(y),b--;for(;m--;){if(g===y||y!==null&&g===y.alternate)break t;g=Iu(g),y=Iu(y)}g=null}else g=null;w!==null&&wI(h,p,w,g,!1),f!==null&&v!==null&&wI(h,v,f,g,!0)}}e:{if(p=l?Qu(l):window,w=p.nodeName&&p.nodeName.toLowerCase(),w==="select"||w==="input"&&p.type==="file")var I=HW;else if(uI(p))if(kM)I=GW;else{I=qW;var T=jW}else(w=p.nodeName)&&w.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(I=WW);if(I&&(I=I(r,l))){CM(h,I,t,d);break e}T&&T(r,p,l),r==="focusout"&&(T=p._wrapperState)&&T.controlled&&p.type==="number"&&d5(p,"number",p.value)}switch(T=l?Qu(l):window,r){case"focusin":(uI(T)||T.contentEditable==="true")&&(Wu=T,x5=l,t1=null);break;case"focusout":t1=x5=Wu=null;break;case"mousedown":A5=!0;break;case"contextmenu":case"mouseup":case"dragend":A5=!1,gI(h,t,d);break;case"selectionchange":if(XW)break;case"keydown":case"keyup":gI(h,t,d)}var A;if(Y9)e:{switch(r){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else qu?AM(r,t)&&(_="onCompositionEnd"):r==="keydown"&&t.keyCode===229&&(_="onCompositionStart");_&&(xM&&t.locale!=="ko"&&(qu||_!=="onCompositionStart"?_==="onCompositionEnd"&&qu&&(A=SM()):(Wa=d,W9="value"in Wa?Wa.value:Wa.textContent,qu=!0)),T=T2(l,_),0<T.length&&(_=new oI(_,r,null,t,d),h.push({event:_,listeners:T}),A?_.data=A:(A=IM(t),A!==null&&(_.data=A)))),(A=UW?FW(r,t):zW(r,t))&&(l=T2(l,"onBeforeInput"),0<l.length&&(d=new oI("onBeforeInput","beforeinput",null,t,d),h.push({event:d,listeners:l}),d.data=A))}LM(h,e)})}function D1(r,e,t){return{instance:r,listener:e,currentTarget:t}}function T2(r,e){for(var t=e+"Capture",n=[];r!==null;){var i=r,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=A1(r,t),s!=null&&n.unshift(D1(r,s,i)),s=A1(r,e),s!=null&&n.push(D1(r,s,i))),r=r.return}return n}function Iu(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function wI(r,e,t,n,i){for(var s=e._reactName,o=[];t!==null&&t!==n;){var a=t,c=a.alternate,l=a.stateNode;if(c!==null&&c===n)break;a.tag===5&&l!==null&&(a=l,i?(c=A1(t,s),c!=null&&o.unshift(D1(t,c,a))):i||(c=A1(t,s),c!=null&&o.push(D1(t,c,a)))),t=t.return}o.length!==0&&r.push({event:e,listeners:o})}var tG=/\r\n?/g,rG=/\u0000|\uFFFD/g;function vI(r){return(typeof r=="string"?r:""+r).replace(tG,`
`).replace(rG,"")}function T0(r,e,t){if(e=vI(e),vI(r)!==e&&t)throw Error(se(425))}function P2(){}var I5=null,C5=null;function k5(r,e){return r==="textarea"||r==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var _5=typeof setTimeout=="function"?setTimeout:void 0,nG=typeof clearTimeout=="function"?clearTimeout:void 0,bI=typeof Promise=="function"?Promise:void 0,iG=typeof queueMicrotask=="function"?queueMicrotask:typeof bI<"u"?function(r){return bI.resolve(null).then(r).catch(sG)}:_5;function sG(r){setTimeout(function(){throw r})}function s8(r,e){var t=e,n=0;do{var i=t.nextSibling;if(r.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(n===0){r.removeChild(i),k1(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=i}while(t);k1(e)}function ic(r){for(;r!=null;r=r.nextSibling){var e=r.nodeType;if(e===1||e===3)break;if(e===8){if(e=r.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return r}function EI(r){r=r.previousSibling;for(var e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return r;e--}else t==="/$"&&e++}r=r.previousSibling}return null}var Ch=Math.random().toString(36).slice(2),Rs="__reactFiber$"+Ch,$1="__reactProps$"+Ch,Bo="__reactContainer$"+Ch,T5="__reactEvents$"+Ch,oG="__reactListeners$"+Ch,aG="__reactHandles$"+Ch;function pl(r){var e=r[Rs];if(e)return e;for(var t=r.parentNode;t;){if(e=t[Bo]||t[Rs]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(r=EI(r);r!==null;){if(t=r[Rs])return t;r=EI(r)}return e}r=t,t=r.parentNode}return null}function Pp(r){return r=r[Rs]||r[Bo],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Qu(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(se(33))}function A3(r){return r[$1]||null}var P5=[],Yu=-1;function Rc(r){return{current:r}}function Rt(r){0>Yu||(r.current=P5[Yu],P5[Yu]=null,Yu--)}function $t(r,e){Yu++,P5[Yu]=r.current,r.current=e}var wc={},sn=Rc(wc),$n=Rc(!1),Ul=wc;function Md(r,e){var t=r.type.contextTypes;if(!t)return wc;var n=r.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=e,r.__reactInternalMemoizedMaskedChildContext=i),i}function Nn(r){return r=r.childContextTypes,r!=null}function D2(){Rt($n),Rt(sn)}function SI(r,e,t){if(sn.current!==wc)throw Error(se(168));$t(sn,e),$t($n,t)}function UM(r,e,t){var n=r.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var i in n)if(!(i in e))throw Error(se(108,jq(r)||"Unknown",i));return qt({},t,n)}function $2(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||wc,Ul=sn.current,$t(sn,r),$t($n,$n.current),!0}function xI(r,e,t){var n=r.stateNode;if(!n)throw Error(se(169));t?(r=UM(r,e,Ul),n.__reactInternalMemoizedMergedChildContext=r,Rt($n),Rt(sn),$t(sn,r)):Rt($n),$t($n,t)}var mo=null,I3=!1,o8=!1;function FM(r){mo===null?mo=[r]:mo.push(r)}function cG(r){I3=!0,FM(r)}function Lc(){if(!o8&&mo!==null){o8=!0;var r=0,e=Et;try{var t=mo;for(Et=1;r<t.length;r++){var n=t[r];do n=n(!0);while(n!==null)}mo=null,I3=!1}catch(i){throw mo!==null&&(mo=mo.slice(r+1)),dM(K9,Lc),i}finally{Et=e,o8=!1}}return null}var Xu=[],Ju=0,N2=null,O2=0,xi=[],Ai=0,Fl=null,ko=1,_o="";function il(r,e){Xu[Ju++]=O2,Xu[Ju++]=N2,N2=r,O2=e}function zM(r,e,t){xi[Ai++]=ko,xi[Ai++]=_o,xi[Ai++]=Fl,Fl=r;var n=ko;r=_o;var i=32-cs(n)-1;n&=~(1<<i),t+=1;var s=32-cs(e)+i;if(30<s){var o=i-i%5;s=(n&(1<<o)-1).toString(32),n>>=o,i-=o,ko=1<<32-cs(e)+i|t<<i|n,_o=s+r}else ko=1<<s|t<<i|n,_o=r}function J9(r){r.return!==null&&(il(r,1),zM(r,1,0))}function Z9(r){for(;r===N2;)N2=Xu[--Ju],Xu[Ju]=null,O2=Xu[--Ju],Xu[Ju]=null;for(;r===Fl;)Fl=xi[--Ai],xi[Ai]=null,_o=xi[--Ai],xi[Ai]=null,ko=xi[--Ai],xi[Ai]=null}var ri=null,ti=null,Ut=!1,ns=null;function VM(r,e){var t=_i(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=r,e=r.deletions,e===null?(r.deletions=[t],r.flags|=16):e.push(t)}function AI(r,e){switch(r.tag){case 5:var t=r.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(r.stateNode=e,ri=r,ti=ic(e.firstChild),!0):!1;case 6:return e=r.pendingProps===""||e.nodeType!==3?null:e,e!==null?(r.stateNode=e,ri=r,ti=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Fl!==null?{id:ko,overflow:_o}:null,r.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=_i(18,null,null,0),t.stateNode=e,t.return=r,r.child=t,ri=r,ti=null,!0):!1;default:return!1}}function D5(r){return(r.mode&1)!==0&&(r.flags&128)===0}function $5(r){if(Ut){var e=ti;if(e){var t=e;if(!AI(r,e)){if(D5(r))throw Error(se(418));e=ic(t.nextSibling);var n=ri;e&&AI(r,e)?VM(n,t):(r.flags=r.flags&-4097|2,Ut=!1,ri=r)}}else{if(D5(r))throw Error(se(418));r.flags=r.flags&-4097|2,Ut=!1,ri=r}}}function II(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;ri=r}function P0(r){if(r!==ri)return!1;if(!Ut)return II(r),Ut=!0,!1;var e;if((e=r.tag!==3)&&!(e=r.tag!==5)&&(e=r.type,e=e!=="head"&&e!=="body"&&!k5(r.type,r.memoizedProps)),e&&(e=ti)){if(D5(r))throw KM(),Error(se(418));for(;e;)VM(r,e),e=ic(e.nextSibling)}if(II(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(se(317));e:{for(r=r.nextSibling,e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="/$"){if(e===0){ti=ic(r.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}r=r.nextSibling}ti=null}}else ti=ri?ic(r.stateNode.nextSibling):null;return!0}function KM(){for(var r=ti;r;)r=ic(r.nextSibling)}function Rd(){ti=ri=null,Ut=!1}function eE(r){ns===null?ns=[r]:ns.push(r)}var lG=Yo.ReactCurrentBatchConfig;function nf(r,e,t){if(r=t.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(se(309));var n=t.stateNode}if(!n)throw Error(se(147,r));var i=n,s=""+r;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof r!="string")throw Error(se(284));if(!t._owner)throw Error(se(290,r))}return r}function D0(r,e){throw r=Object.prototype.toString.call(e),Error(se(31,r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r))}function CI(r){var e=r._init;return e(r._payload)}function HM(r){function e(y,m){if(r){var b=y.deletions;b===null?(y.deletions=[m],y.flags|=16):b.push(m)}}function t(y,m){if(!r)return null;for(;m!==null;)e(y,m),m=m.sibling;return null}function n(y,m){for(y=new Map;m!==null;)m.key!==null?y.set(m.key,m):y.set(m.index,m),m=m.sibling;return y}function i(y,m){return y=cc(y,m),y.index=0,y.sibling=null,y}function s(y,m,b){return y.index=b,r?(b=y.alternate,b!==null?(b=b.index,b<m?(y.flags|=2,m):b):(y.flags|=2,m)):(y.flags|=1048576,m)}function o(y){return r&&y.alternate===null&&(y.flags|=2),y}function a(y,m,b,S){return m===null||m.tag!==6?(m=f8(b,y.mode,S),m.return=y,m):(m=i(m,b),m.return=y,m)}function c(y,m,b,S){var I=b.type;return I===ju?d(y,m,b.props.children,S,b.key):m!==null&&(m.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===Ca&&CI(I)===m.type)?(S=i(m,b.props),S.ref=nf(y,m,b),S.return=y,S):(S=Fg(b.type,b.key,b.props,null,y.mode,S),S.ref=nf(y,m,b),S.return=y,S)}function l(y,m,b,S){return m===null||m.tag!==4||m.stateNode.containerInfo!==b.containerInfo||m.stateNode.implementation!==b.implementation?(m=p8(b,y.mode,S),m.return=y,m):(m=i(m,b.children||[]),m.return=y,m)}function d(y,m,b,S,I){return m===null||m.tag!==7?(m=kl(b,y.mode,S,I),m.return=y,m):(m=i(m,b),m.return=y,m)}function h(y,m,b){if(typeof m=="string"&&m!==""||typeof m=="number")return m=f8(""+m,y.mode,b),m.return=y,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case b0:return b=Fg(m.type,m.key,m.props,null,y.mode,b),b.ref=nf(y,null,m),b.return=y,b;case Hu:return m=p8(m,y.mode,b),m.return=y,m;case Ca:var S=m._init;return h(y,S(m._payload),b)}if(Bf(m)||Jh(m))return m=kl(m,y.mode,b,null),m.return=y,m;D0(y,m)}return null}function p(y,m,b,S){var I=m!==null?m.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return I!==null?null:a(y,m,""+b,S);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case b0:return b.key===I?c(y,m,b,S):null;case Hu:return b.key===I?l(y,m,b,S):null;case Ca:return I=b._init,p(y,m,I(b._payload),S)}if(Bf(b)||Jh(b))return I!==null?null:d(y,m,b,S,null);D0(y,b)}return null}function w(y,m,b,S,I){if(typeof S=="string"&&S!==""||typeof S=="number")return y=y.get(b)||null,a(m,y,""+S,I);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case b0:return y=y.get(S.key===null?b:S.key)||null,c(m,y,S,I);case Hu:return y=y.get(S.key===null?b:S.key)||null,l(m,y,S,I);case Ca:var T=S._init;return w(y,m,b,T(S._payload),I)}if(Bf(S)||Jh(S))return y=y.get(b)||null,d(m,y,S,I,null);D0(m,S)}return null}function f(y,m,b,S){for(var I=null,T=null,A=m,_=m=0,$=null;A!==null&&_<b.length;_++){A.index>_?($=A,A=null):$=A.sibling;var z=p(y,A,b[_],S);if(z===null){A===null&&(A=$);break}r&&A&&z.alternate===null&&e(y,A),m=s(z,m,_),T===null?I=z:T.sibling=z,T=z,A=$}if(_===b.length)return t(y,A),Ut&&il(y,_),I;if(A===null){for(;_<b.length;_++)A=h(y,b[_],S),A!==null&&(m=s(A,m,_),T===null?I=A:T.sibling=A,T=A);return Ut&&il(y,_),I}for(A=n(y,A);_<b.length;_++)$=w(A,y,_,b[_],S),$!==null&&(r&&$.alternate!==null&&A.delete($.key===null?_:$.key),m=s($,m,_),T===null?I=$:T.sibling=$,T=$);return r&&A.forEach(function(j){return e(y,j)}),Ut&&il(y,_),I}function g(y,m,b,S){var I=Jh(b);if(typeof I!="function")throw Error(se(150));if(b=I.call(b),b==null)throw Error(se(151));for(var T=I=null,A=m,_=m=0,$=null,z=b.next();A!==null&&!z.done;_++,z=b.next()){A.index>_?($=A,A=null):$=A.sibling;var j=p(y,A,z.value,S);if(j===null){A===null&&(A=$);break}r&&A&&j.alternate===null&&e(y,A),m=s(j,m,_),T===null?I=j:T.sibling=j,T=j,A=$}if(z.done)return t(y,A),Ut&&il(y,_),I;if(A===null){for(;!z.done;_++,z=b.next())z=h(y,z.value,S),z!==null&&(m=s(z,m,_),T===null?I=z:T.sibling=z,T=z);return Ut&&il(y,_),I}for(A=n(y,A);!z.done;_++,z=b.next())z=w(A,y,_,z.value,S),z!==null&&(r&&z.alternate!==null&&A.delete(z.key===null?_:z.key),m=s(z,m,_),T===null?I=z:T.sibling=z,T=z);return r&&A.forEach(function(K){return e(y,K)}),Ut&&il(y,_),I}function v(y,m,b,S){if(typeof b=="object"&&b!==null&&b.type===ju&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case b0:e:{for(var I=b.key,T=m;T!==null;){if(T.key===I){if(I=b.type,I===ju){if(T.tag===7){t(y,T.sibling),m=i(T,b.props.children),m.return=y,y=m;break e}}else if(T.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===Ca&&CI(I)===T.type){t(y,T.sibling),m=i(T,b.props),m.ref=nf(y,T,b),m.return=y,y=m;break e}t(y,T);break}else e(y,T);T=T.sibling}b.type===ju?(m=kl(b.props.children,y.mode,S,b.key),m.return=y,y=m):(S=Fg(b.type,b.key,b.props,null,y.mode,S),S.ref=nf(y,m,b),S.return=y,y=S)}return o(y);case Hu:e:{for(T=b.key;m!==null;){if(m.key===T)if(m.tag===4&&m.stateNode.containerInfo===b.containerInfo&&m.stateNode.implementation===b.implementation){t(y,m.sibling),m=i(m,b.children||[]),m.return=y,y=m;break e}else{t(y,m);break}else e(y,m);m=m.sibling}m=p8(b,y.mode,S),m.return=y,y=m}return o(y);case Ca:return T=b._init,v(y,m,T(b._payload),S)}if(Bf(b))return f(y,m,b,S);if(Jh(b))return g(y,m,b,S);D0(y,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,m!==null&&m.tag===6?(t(y,m.sibling),m=i(m,b),m.return=y,y=m):(t(y,m),m=f8(b,y.mode,S),m.return=y,y=m),o(y)):t(y,m)}return v}var Ld=HM(!0),jM=HM(!1),M2=Rc(null),R2=null,Zu=null,tE=null;function rE(){tE=Zu=R2=null}function nE(r){var e=M2.current;Rt(M2),r._currentValue=e}function N5(r,e,t){for(;r!==null;){var n=r.alternate;if((r.childLanes&e)!==e?(r.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),r===t)break;r=r.return}}function dd(r,e){R2=r,tE=Zu=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&e&&(Pn=!0),r.firstContext=null)}function Ri(r){var e=r._currentValue;if(tE!==r)if(r={context:r,memoizedValue:e,next:null},Zu===null){if(R2===null)throw Error(se(308));Zu=r,R2.dependencies={lanes:0,firstContext:r}}else Zu=Zu.next=r;return e}var gl=null;function iE(r){gl===null?gl=[r]:gl.push(r)}function qM(r,e,t,n){var i=e.interleaved;return i===null?(t.next=t,iE(e)):(t.next=i.next,i.next=t),e.interleaved=t,Uo(r,n)}function Uo(r,e){r.lanes|=e;var t=r.alternate;for(t!==null&&(t.lanes|=e),t=r,r=r.return;r!==null;)r.childLanes|=e,t=r.alternate,t!==null&&(t.childLanes|=e),t=r,r=r.return;return t.tag===3?t.stateNode:null}var ka=!1;function sE(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function WM(r,e){r=r.updateQueue,e.updateQueue===r&&(e.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Po(r,e){return{eventTime:r,lane:e,tag:0,payload:null,callback:null,next:null}}function sc(r,e,t){var n=r.updateQueue;if(n===null)return null;if(n=n.shared,st&2){var i=n.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),n.pending=e,Uo(r,t)}return i=n.interleaved,i===null?(e.next=e,iE(n)):(e.next=i.next,i.next=e),n.interleaved=e,Uo(r,t)}function Og(r,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,H9(r,t)}}function kI(r,e){var t=r.updateQueue,n=r.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:n.shared,effects:n.effects},r.updateQueue=t;return}r=t.lastBaseUpdate,r===null?t.firstBaseUpdate=e:r.next=e,t.lastBaseUpdate=e}function L2(r,e,t,n){var i=r.updateQueue;ka=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var d=r.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=l:a.next=l,d.lastBaseUpdate=c))}if(s!==null){var h=i.baseState;o=0,d=l=c=null,a=s;do{var p=a.lane,w=a.eventTime;if((n&p)===p){d!==null&&(d=d.next={eventTime:w,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=r,g=a;switch(p=e,w=t,g.tag){case 1:if(f=g.payload,typeof f=="function"){h=f.call(w,h,p);break e}h=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=g.payload,p=typeof f=="function"?f.call(w,h,p):f,p==null)break e;h=qt({},h,p);break e;case 2:ka=!0}}a.callback!==null&&a.lane!==0&&(r.flags|=64,p=i.effects,p===null?i.effects=[a]:p.push(a))}else w={eventTime:w,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(l=d=w,c=h):d=d.next=w,o|=p;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;p=a,a=p.next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}while(!0);if(d===null&&(c=h),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=d,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);Vl|=o,r.lanes=o,r.memoizedState=h}}function _I(r,e,t){if(r=e.effects,e.effects=null,r!==null)for(e=0;e<r.length;e++){var n=r[e],i=n.callback;if(i!==null){if(n.callback=null,n=t,typeof i!="function")throw Error(se(191,i));i.call(n)}}}var Dp={},Fs=Rc(Dp),N1=Rc(Dp),O1=Rc(Dp);function yl(r){if(r===Dp)throw Error(se(174));return r}function oE(r,e){switch($t(O1,e),$t(N1,r),$t(Fs,Dp),r=e.nodeType,r){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:f5(null,"");break;default:r=r===8?e.parentNode:e,e=r.namespaceURI||null,r=r.tagName,e=f5(e,r)}Rt(Fs),$t(Fs,e)}function Bd(){Rt(Fs),Rt(N1),Rt(O1)}function GM(r){yl(O1.current);var e=yl(Fs.current),t=f5(e,r.type);e!==t&&($t(N1,r),$t(Fs,t))}function aE(r){N1.current===r&&(Rt(Fs),Rt(N1))}var Kt=Rc(0);function B2(r){for(var e=r;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var a8=[];function cE(){for(var r=0;r<a8.length;r++)a8[r]._workInProgressVersionPrimary=null;a8.length=0}var Mg=Yo.ReactCurrentDispatcher,c8=Yo.ReactCurrentBatchConfig,zl=0,jt=null,ar=null,yr=null,U2=!1,r1=!1,M1=0,uG=0;function Mr(){throw Error(se(321))}function lE(r,e){if(e===null)return!1;for(var t=0;t<e.length&&t<r.length;t++)if(!ps(r[t],e[t]))return!1;return!0}function uE(r,e,t,n,i,s){if(zl=s,jt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Mg.current=r===null||r.memoizedState===null?pG:gG,r=t(n,i),r1){s=0;do{if(r1=!1,M1=0,25<=s)throw Error(se(301));s+=1,yr=ar=null,e.updateQueue=null,Mg.current=yG,r=t(n,i)}while(r1)}if(Mg.current=F2,e=ar!==null&&ar.next!==null,zl=0,yr=ar=jt=null,U2=!1,e)throw Error(se(300));return r}function dE(){var r=M1!==0;return M1=0,r}function Ps(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yr===null?jt.memoizedState=yr=r:yr=yr.next=r,yr}function Li(){if(ar===null){var r=jt.alternate;r=r!==null?r.memoizedState:null}else r=ar.next;var e=yr===null?jt.memoizedState:yr.next;if(e!==null)yr=e,ar=r;else{if(r===null)throw Error(se(310));ar=r,r={memoizedState:ar.memoizedState,baseState:ar.baseState,baseQueue:ar.baseQueue,queue:ar.queue,next:null},yr===null?jt.memoizedState=yr=r:yr=yr.next=r}return yr}function R1(r,e){return typeof e=="function"?e(r):e}function l8(r){var e=Li(),t=e.queue;if(t===null)throw Error(se(311));t.lastRenderedReducer=r;var n=ar,i=n.baseQueue,s=t.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}n.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,n=n.baseState;var a=o=null,c=null,l=s;do{var d=l.lane;if((zl&d)===d)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:r(n,l.action);else{var h={lane:d,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=h,o=n):c=c.next=h,jt.lanes|=d,Vl|=d}l=l.next}while(l!==null&&l!==s);c===null?o=n:c.next=a,ps(n,e.memoizedState)||(Pn=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=c,t.lastRenderedState=n}if(r=t.interleaved,r!==null){i=r;do s=i.lane,jt.lanes|=s,Vl|=s,i=i.next;while(i!==r)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function u8(r){var e=Li(),t=e.queue;if(t===null)throw Error(se(311));t.lastRenderedReducer=r;var n=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do s=r(s,o.action),o=o.next;while(o!==i);ps(s,e.memoizedState)||(Pn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,n]}function QM(){}function YM(r,e){var t=jt,n=Li(),i=e(),s=!ps(n.memoizedState,i);if(s&&(n.memoizedState=i,Pn=!0),n=n.queue,hE(ZM.bind(null,t,n,r),[r]),n.getSnapshot!==e||s||yr!==null&&yr.memoizedState.tag&1){if(t.flags|=2048,L1(9,JM.bind(null,t,n,i,e),void 0,null),wr===null)throw Error(se(349));zl&30||XM(t,e,i)}return i}function XM(r,e,t){r.flags|=16384,r={getSnapshot:e,value:t},e=jt.updateQueue,e===null?(e={lastEffect:null,stores:null},jt.updateQueue=e,e.stores=[r]):(t=e.stores,t===null?e.stores=[r]:t.push(r))}function JM(r,e,t,n){e.value=t,e.getSnapshot=n,eR(e)&&tR(r)}function ZM(r,e,t){return t(function(){eR(e)&&tR(r)})}function eR(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!ps(r,t)}catch{return!0}}function tR(r){var e=Uo(r,1);e!==null&&ls(e,r,1,-1)}function TI(r){var e=Ps();return typeof r=="function"&&(r=r()),e.memoizedState=e.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:R1,lastRenderedState:r},e.queue=r,r=r.dispatch=fG.bind(null,jt,r),[e.memoizedState,r]}function L1(r,e,t,n){return r={tag:r,create:e,destroy:t,deps:n,next:null},e=jt.updateQueue,e===null?(e={lastEffect:null,stores:null},jt.updateQueue=e,e.lastEffect=r.next=r):(t=e.lastEffect,t===null?e.lastEffect=r.next=r:(n=t.next,t.next=r,r.next=n,e.lastEffect=r)),r}function rR(){return Li().memoizedState}function Rg(r,e,t,n){var i=Ps();jt.flags|=r,i.memoizedState=L1(1|e,t,void 0,n===void 0?null:n)}function C3(r,e,t,n){var i=Li();n=n===void 0?null:n;var s=void 0;if(ar!==null){var o=ar.memoizedState;if(s=o.destroy,n!==null&&lE(n,o.deps)){i.memoizedState=L1(e,t,s,n);return}}jt.flags|=r,i.memoizedState=L1(1|e,t,s,n)}function PI(r,e){return Rg(8390656,8,r,e)}function hE(r,e){return C3(2048,8,r,e)}function nR(r,e){return C3(4,2,r,e)}function iR(r,e){return C3(4,4,r,e)}function sR(r,e){if(typeof e=="function")return r=r(),e(r),function(){e(null)};if(e!=null)return r=r(),e.current=r,function(){e.current=null}}function oR(r,e,t){return t=t!=null?t.concat([r]):null,C3(4,4,sR.bind(null,e,r),t)}function fE(){}function aR(r,e){var t=Li();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&lE(e,n[1])?n[0]:(t.memoizedState=[r,e],r)}function cR(r,e){var t=Li();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&lE(e,n[1])?n[0]:(r=r(),t.memoizedState=[r,e],r)}function lR(r,e,t){return zl&21?(ps(t,e)||(t=pM(),jt.lanes|=t,Vl|=t,r.baseState=!0),e):(r.baseState&&(r.baseState=!1,Pn=!0),r.memoizedState=t)}function dG(r,e){var t=Et;Et=t!==0&&4>t?t:4,r(!0);var n=c8.transition;c8.transition={};try{r(!1),e()}finally{Et=t,c8.transition=n}}function uR(){return Li().memoizedState}function hG(r,e,t){var n=ac(r);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},dR(r))hR(e,t);else if(t=qM(r,e,t,n),t!==null){var i=fn();ls(t,r,n,i),fR(t,e,n)}}function fG(r,e,t){var n=ac(r),i={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(dR(r))hR(e,i);else{var s=r.alternate;if(r.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(i.hasEagerState=!0,i.eagerState=a,ps(a,o)){var c=e.interleaved;c===null?(i.next=i,iE(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}t=qM(r,e,i,n),t!==null&&(i=fn(),ls(t,r,n,i),fR(t,e,n))}}function dR(r){var e=r.alternate;return r===jt||e!==null&&e===jt}function hR(r,e){r1=U2=!0;var t=r.pending;t===null?e.next=e:(e.next=t.next,t.next=e),r.pending=e}function fR(r,e,t){if(t&4194240){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,H9(r,t)}}var F2={readContext:Ri,useCallback:Mr,useContext:Mr,useEffect:Mr,useImperativeHandle:Mr,useInsertionEffect:Mr,useLayoutEffect:Mr,useMemo:Mr,useReducer:Mr,useRef:Mr,useState:Mr,useDebugValue:Mr,useDeferredValue:Mr,useTransition:Mr,useMutableSource:Mr,useSyncExternalStore:Mr,useId:Mr,unstable_isNewReconciler:!1},pG={readContext:Ri,useCallback:function(r,e){return Ps().memoizedState=[r,e===void 0?null:e],r},useContext:Ri,useEffect:PI,useImperativeHandle:function(r,e,t){return t=t!=null?t.concat([r]):null,Rg(4194308,4,sR.bind(null,e,r),t)},useLayoutEffect:function(r,e){return Rg(4194308,4,r,e)},useInsertionEffect:function(r,e){return Rg(4,2,r,e)},useMemo:function(r,e){var t=Ps();return e=e===void 0?null:e,r=r(),t.memoizedState=[r,e],r},useReducer:function(r,e,t){var n=Ps();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:e},n.queue=r,r=r.dispatch=hG.bind(null,jt,r),[n.memoizedState,r]},useRef:function(r){var e=Ps();return r={current:r},e.memoizedState=r},useState:TI,useDebugValue:fE,useDeferredValue:function(r){return Ps().memoizedState=r},useTransition:function(){var r=TI(!1),e=r[0];return r=dG.bind(null,r[1]),Ps().memoizedState=r,[e,r]},useMutableSource:function(){},useSyncExternalStore:function(r,e,t){var n=jt,i=Ps();if(Ut){if(t===void 0)throw Error(se(407));t=t()}else{if(t=e(),wr===null)throw Error(se(349));zl&30||XM(n,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,PI(ZM.bind(null,n,s,r),[r]),n.flags|=2048,L1(9,JM.bind(null,n,s,t,e),void 0,null),t},useId:function(){var r=Ps(),e=wr.identifierPrefix;if(Ut){var t=_o,n=ko;t=(n&~(1<<32-cs(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=M1++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=uG++,e=":"+e+"r"+t.toString(32)+":";return r.memoizedState=e},unstable_isNewReconciler:!1},gG={readContext:Ri,useCallback:aR,useContext:Ri,useEffect:hE,useImperativeHandle:oR,useInsertionEffect:nR,useLayoutEffect:iR,useMemo:cR,useReducer:l8,useRef:rR,useState:function(){return l8(R1)},useDebugValue:fE,useDeferredValue:function(r){var e=Li();return lR(e,ar.memoizedState,r)},useTransition:function(){var r=l8(R1)[0],e=Li().memoizedState;return[r,e]},useMutableSource:QM,useSyncExternalStore:YM,useId:uR,unstable_isNewReconciler:!1},yG={readContext:Ri,useCallback:aR,useContext:Ri,useEffect:hE,useImperativeHandle:oR,useInsertionEffect:nR,useLayoutEffect:iR,useMemo:cR,useReducer:u8,useRef:rR,useState:function(){return u8(R1)},useDebugValue:fE,useDeferredValue:function(r){var e=Li();return ar===null?e.memoizedState=r:lR(e,ar.memoizedState,r)},useTransition:function(){var r=u8(R1)[0],e=Li().memoizedState;return[r,e]},useMutableSource:QM,useSyncExternalStore:YM,useId:uR,unstable_isNewReconciler:!1};function Zi(r,e){if(r&&r.defaultProps){e=qt({},e),r=r.defaultProps;for(var t in r)e[t]===void 0&&(e[t]=r[t]);return e}return e}function O5(r,e,t,n){e=r.memoizedState,t=t(n,e),t=t==null?e:qt({},e,t),r.memoizedState=t,r.lanes===0&&(r.updateQueue.baseState=t)}var k3={isMounted:function(r){return(r=r._reactInternals)?fu(r)===r:!1},enqueueSetState:function(r,e,t){r=r._reactInternals;var n=fn(),i=ac(r),s=Po(n,i);s.payload=e,t!=null&&(s.callback=t),e=sc(r,s,i),e!==null&&(ls(e,r,i,n),Og(e,r,i))},enqueueReplaceState:function(r,e,t){r=r._reactInternals;var n=fn(),i=ac(r),s=Po(n,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=sc(r,s,i),e!==null&&(ls(e,r,i,n),Og(e,r,i))},enqueueForceUpdate:function(r,e){r=r._reactInternals;var t=fn(),n=ac(r),i=Po(t,n);i.tag=2,e!=null&&(i.callback=e),e=sc(r,i,n),e!==null&&(ls(e,r,n,t),Og(e,r,n))}};function DI(r,e,t,n,i,s,o){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(n,s,o):e.prototype&&e.prototype.isPureReactComponent?!T1(t,n)||!T1(i,s):!0}function pR(r,e,t){var n=!1,i=wc,s=e.contextType;return typeof s=="object"&&s!==null?s=Ri(s):(i=Nn(e)?Ul:sn.current,n=e.contextTypes,s=(n=n!=null)?Md(r,i):wc),e=new e(t,s),r.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=k3,r.stateNode=e,e._reactInternals=r,n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=i,r.__reactInternalMemoizedMaskedChildContext=s),e}function $I(r,e,t,n){r=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==r&&k3.enqueueReplaceState(e,e.state,null)}function M5(r,e,t,n){var i=r.stateNode;i.props=t,i.state=r.memoizedState,i.refs={},sE(r);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Ri(s):(s=Nn(e)?Ul:sn.current,i.context=Md(r,s)),i.state=r.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(O5(r,e,s,t),i.state=r.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&k3.enqueueReplaceState(i,i.state,null),L2(r,t,i,n),i.state=r.memoizedState),typeof i.componentDidMount=="function"&&(r.flags|=4194308)}function Ud(r,e){try{var t="",n=e;do t+=Hq(n),n=n.return;while(n);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:r,source:e,stack:i,digest:null}}function d8(r,e,t){return{value:r,source:null,stack:t??null,digest:e??null}}function R5(r,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var mG=typeof WeakMap=="function"?WeakMap:Map;function gR(r,e,t){t=Po(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){V2||(V2=!0,q5=n),R5(r,e)},t}function yR(r,e,t){t=Po(-1,t),t.tag=3;var n=r.type.getDerivedStateFromError;if(typeof n=="function"){var i=e.value;t.payload=function(){return n(i)},t.callback=function(){R5(r,e)}}var s=r.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){R5(r,e),typeof n!="function"&&(oc===null?oc=new Set([this]):oc.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function NI(r,e,t){var n=r.pingCache;if(n===null){n=r.pingCache=new mG;var i=new Set;n.set(e,i)}else i=n.get(e),i===void 0&&(i=new Set,n.set(e,i));i.has(t)||(i.add(t),r=DG.bind(null,r,e,t),e.then(r,r))}function OI(r){do{var e;if((e=r.tag===13)&&(e=r.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return r;r=r.return}while(r!==null);return null}function MI(r,e,t,n,i){return r.mode&1?(r.flags|=65536,r.lanes=i,r):(r===e?r.flags|=65536:(r.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Po(-1,1),e.tag=2,sc(t,e,1))),t.lanes|=1),r)}var wG=Yo.ReactCurrentOwner,Pn=!1;function cn(r,e,t,n){e.child=r===null?jM(e,null,t,n):Ld(e,r.child,t,n)}function RI(r,e,t,n,i){t=t.render;var s=e.ref;return dd(e,i),n=uE(r,e,t,n,s,i),t=dE(),r!==null&&!Pn?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~i,Fo(r,e,i)):(Ut&&t&&J9(e),e.flags|=1,cn(r,e,n,i),e.child)}function LI(r,e,t,n,i){if(r===null){var s=t.type;return typeof s=="function"&&!EE(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,mR(r,e,s,n,i)):(r=Fg(t.type,null,n,e,e.mode,i),r.ref=e.ref,r.return=e,e.child=r)}if(s=r.child,!(r.lanes&i)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:T1,t(o,n)&&r.ref===e.ref)return Fo(r,e,i)}return e.flags|=1,r=cc(s,n),r.ref=e.ref,r.return=e,e.child=r}function mR(r,e,t,n,i){if(r!==null){var s=r.memoizedProps;if(T1(s,n)&&r.ref===e.ref)if(Pn=!1,e.pendingProps=n=s,(r.lanes&i)!==0)r.flags&131072&&(Pn=!0);else return e.lanes=r.lanes,Fo(r,e,i)}return L5(r,e,t,n,i)}function wR(r,e,t){var n=e.pendingProps,i=n.children,s=r!==null?r.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},$t(td,Qn),Qn|=t;else{if(!(t&1073741824))return r=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:r,cachePool:null,transitions:null},e.updateQueue=null,$t(td,Qn),Qn|=r,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:t,$t(td,Qn),Qn|=n}else s!==null?(n=s.baseLanes|t,e.memoizedState=null):n=t,$t(td,Qn),Qn|=n;return cn(r,e,i,t),e.child}function vR(r,e){var t=e.ref;(r===null&&t!==null||r!==null&&r.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function L5(r,e,t,n,i){var s=Nn(t)?Ul:sn.current;return s=Md(e,s),dd(e,i),t=uE(r,e,t,n,s,i),n=dE(),r!==null&&!Pn?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~i,Fo(r,e,i)):(Ut&&n&&J9(e),e.flags|=1,cn(r,e,t,i),e.child)}function BI(r,e,t,n,i){if(Nn(t)){var s=!0;$2(e)}else s=!1;if(dd(e,i),e.stateNode===null)Lg(r,e),pR(e,t,n),M5(e,t,n,i),n=!0;else if(r===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=t.contextType;typeof l=="object"&&l!==null?l=Ri(l):(l=Nn(t)?Ul:sn.current,l=Md(e,l));var d=t.getDerivedStateFromProps,h=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==n||c!==l)&&$I(e,o,n,l),ka=!1;var p=e.memoizedState;o.state=p,L2(e,n,o,i),c=e.memoizedState,a!==n||p!==c||$n.current||ka?(typeof d=="function"&&(O5(e,t,d,n),c=e.memoizedState),(a=ka||DI(e,t,a,n,p,c,l))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=c),o.props=n,o.state=c,o.context=l,n=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,WM(r,e),a=e.memoizedProps,l=e.type===e.elementType?a:Zi(e.type,a),o.props=l,h=e.pendingProps,p=o.context,c=t.contextType,typeof c=="object"&&c!==null?c=Ri(c):(c=Nn(t)?Ul:sn.current,c=Md(e,c));var w=t.getDerivedStateFromProps;(d=typeof w=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||p!==c)&&$I(e,o,n,c),ka=!1,p=e.memoizedState,o.state=p,L2(e,n,o,i);var f=e.memoizedState;a!==h||p!==f||$n.current||ka?(typeof w=="function"&&(O5(e,t,w,n),f=e.memoizedState),(l=ka||DI(e,t,l,n,p,f,c)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,f,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,f,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=f),o.props=n,o.state=f,o.context=c,n=l):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=1024),n=!1)}return B5(r,e,t,n,s,i)}function B5(r,e,t,n,i,s){vR(r,e);var o=(e.flags&128)!==0;if(!n&&!o)return i&&xI(e,t,!1),Fo(r,e,s);n=e.stateNode,wG.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,r!==null&&o?(e.child=Ld(e,r.child,null,s),e.child=Ld(e,null,a,s)):cn(r,e,a,s),e.memoizedState=n.state,i&&xI(e,t,!0),e.child}function bR(r){var e=r.stateNode;e.pendingContext?SI(r,e.pendingContext,e.pendingContext!==e.context):e.context&&SI(r,e.context,!1),oE(r,e.containerInfo)}function UI(r,e,t,n,i){return Rd(),eE(i),e.flags|=256,cn(r,e,t,n),e.child}var U5={dehydrated:null,treeContext:null,retryLane:0};function F5(r){return{baseLanes:r,cachePool:null,transitions:null}}function ER(r,e,t){var n=e.pendingProps,i=Kt.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=r!==null&&r.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(r===null||r.memoizedState!==null)&&(i|=1),$t(Kt,i&1),r===null)return $5(e),r=e.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(e.mode&1?r.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,r=n.fallback,s?(n=e.mode,s=e.child,o={mode:"hidden",children:o},!(n&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=P3(o,n,0,null),r=kl(r,n,t,null),s.return=e,r.return=e,s.sibling=r,e.child=s,e.child.memoizedState=F5(t),e.memoizedState=U5,r):pE(e,o));if(i=r.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return vG(r,e,o,n,a,i,t);if(s){s=n.fallback,o=e.mode,i=r.child,a=i.sibling;var c={mode:"hidden",children:n.children};return!(o&1)&&e.child!==i?(n=e.child,n.childLanes=0,n.pendingProps=c,e.deletions=null):(n=cc(i,c),n.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=cc(a,s):(s=kl(s,o,t,null),s.flags|=2),s.return=e,n.return=e,n.sibling=s,e.child=n,n=s,s=e.child,o=r.child.memoizedState,o=o===null?F5(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=r.childLanes&~t,e.memoizedState=U5,n}return s=r.child,r=s.sibling,n=cc(s,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,r!==null&&(t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)),e.child=n,e.memoizedState=null,n}function pE(r,e){return e=P3({mode:"visible",children:e},r.mode,0,null),e.return=r,r.child=e}function $0(r,e,t,n){return n!==null&&eE(n),Ld(e,r.child,null,t),r=pE(e,e.pendingProps.children),r.flags|=2,e.memoizedState=null,r}function vG(r,e,t,n,i,s,o){if(t)return e.flags&256?(e.flags&=-257,n=d8(Error(se(422))),$0(r,e,o,n)):e.memoizedState!==null?(e.child=r.child,e.flags|=128,null):(s=n.fallback,i=e.mode,n=P3({mode:"visible",children:n.children},i,0,null),s=kl(s,i,o,null),s.flags|=2,n.return=e,s.return=e,n.sibling=s,e.child=n,e.mode&1&&Ld(e,r.child,null,o),e.child.memoizedState=F5(o),e.memoizedState=U5,s);if(!(e.mode&1))return $0(r,e,o,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var a=n.dgst;return n=a,s=Error(se(419)),n=d8(s,n,void 0),$0(r,e,o,n)}if(a=(o&r.childLanes)!==0,Pn||a){if(n=wr,n!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Uo(r,i),ls(n,r,i,-1))}return bE(),n=d8(Error(se(421))),$0(r,e,o,n)}return i.data==="$?"?(e.flags|=128,e.child=r.child,e=$G.bind(null,r),i._reactRetry=e,null):(r=s.treeContext,ti=ic(i.nextSibling),ri=e,Ut=!0,ns=null,r!==null&&(xi[Ai++]=ko,xi[Ai++]=_o,xi[Ai++]=Fl,ko=r.id,_o=r.overflow,Fl=e),e=pE(e,n.children),e.flags|=4096,e)}function FI(r,e,t){r.lanes|=e;var n=r.alternate;n!==null&&(n.lanes|=e),N5(r.return,e,t)}function h8(r,e,t,n,i){var s=r.memoizedState;s===null?r.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=t,s.tailMode=i)}function SR(r,e,t){var n=e.pendingProps,i=n.revealOrder,s=n.tail;if(cn(r,e,n.children,t),n=Kt.current,n&2)n=n&1|2,e.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=e.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&FI(r,t,e);else if(r.tag===19)FI(r,t,e);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}n&=1}if($t(Kt,n),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)r=t.alternate,r!==null&&B2(r)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),h8(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(r=i.alternate,r!==null&&B2(r)===null){e.child=i;break}r=i.sibling,i.sibling=t,t=i,i=r}h8(e,!0,t,null,s);break;case"together":h8(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Lg(r,e){!(e.mode&1)&&r!==null&&(r.alternate=null,e.alternate=null,e.flags|=2)}function Fo(r,e,t){if(r!==null&&(e.dependencies=r.dependencies),Vl|=e.lanes,!(t&e.childLanes))return null;if(r!==null&&e.child!==r.child)throw Error(se(153));if(e.child!==null){for(r=e.child,t=cc(r,r.pendingProps),e.child=t,t.return=e;r.sibling!==null;)r=r.sibling,t=t.sibling=cc(r,r.pendingProps),t.return=e;t.sibling=null}return e.child}function bG(r,e,t){switch(e.tag){case 3:bR(e),Rd();break;case 5:GM(e);break;case 1:Nn(e.type)&&$2(e);break;case 4:oE(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,i=e.memoizedProps.value;$t(M2,n._currentValue),n._currentValue=i;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?($t(Kt,Kt.current&1),e.flags|=128,null):t&e.child.childLanes?ER(r,e,t):($t(Kt,Kt.current&1),r=Fo(r,e,t),r!==null?r.sibling:null);$t(Kt,Kt.current&1);break;case 19:if(n=(t&e.childLanes)!==0,r.flags&128){if(n)return SR(r,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),$t(Kt,Kt.current),n)break;return null;case 22:case 23:return e.lanes=0,wR(r,e,t)}return Fo(r,e,t)}var xR,z5,AR,IR;xR=function(r,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)r.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};z5=function(){};AR=function(r,e,t,n){var i=r.memoizedProps;if(i!==n){r=e.stateNode,yl(Fs.current);var s=null;switch(t){case"input":i=l5(r,i),n=l5(r,n),s=[];break;case"select":i=qt({},i,{value:void 0}),n=qt({},n,{value:void 0}),s=[];break;case"textarea":i=h5(r,i),n=h5(r,n),s=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(r.onclick=P2)}p5(t,n);var o;t=null;for(l in i)if(!n.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var a=i[l];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(S1.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in n){var c=n[l];if(a=i!=null?i[l]:void 0,n.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(s||(s=[]),s.push(l,t)),t=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(S1.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&Mt("scroll",r),s||a===c||(s=[])):(s=s||[]).push(l,c))}t&&(s=s||[]).push("style",t);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};IR=function(r,e,t,n){t!==n&&(e.flags|=4)};function sf(r,e){if(!Ut)switch(r.tailMode){case"hidden":e=r.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?r.tail=null:t.sibling=null;break;case"collapsed":t=r.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||r.tail===null?r.tail=null:r.tail.sibling=null:n.sibling=null}}function Rr(r){var e=r.alternate!==null&&r.alternate.child===r.child,t=0,n=0;if(e)for(var i=r.child;i!==null;)t|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=r,i=i.sibling;else for(i=r.child;i!==null;)t|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=r,i=i.sibling;return r.subtreeFlags|=n,r.childLanes=t,e}function EG(r,e,t){var n=e.pendingProps;switch(Z9(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rr(e),null;case 1:return Nn(e.type)&&D2(),Rr(e),null;case 3:return n=e.stateNode,Bd(),Rt($n),Rt(sn),cE(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(r===null||r.child===null)&&(P0(e)?e.flags|=4:r===null||r.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ns!==null&&(Q5(ns),ns=null))),z5(r,e),Rr(e),null;case 5:aE(e);var i=yl(O1.current);if(t=e.type,r!==null&&e.stateNode!=null)AR(r,e,t,n,i),r.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(se(166));return Rr(e),null}if(r=yl(Fs.current),P0(e)){n=e.stateNode,t=e.type;var s=e.memoizedProps;switch(n[Rs]=e,n[$1]=s,r=(e.mode&1)!==0,t){case"dialog":Mt("cancel",n),Mt("close",n);break;case"iframe":case"object":case"embed":Mt("load",n);break;case"video":case"audio":for(i=0;i<Ff.length;i++)Mt(Ff[i],n);break;case"source":Mt("error",n);break;case"img":case"image":case"link":Mt("error",n),Mt("load",n);break;case"details":Mt("toggle",n);break;case"input":QA(n,s),Mt("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},Mt("invalid",n);break;case"textarea":XA(n,s),Mt("invalid",n)}p5(t,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?n.textContent!==a&&(s.suppressHydrationWarning!==!0&&T0(n.textContent,a,r),i=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&T0(n.textContent,a,r),i=["children",""+a]):S1.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Mt("scroll",n)}switch(t){case"input":E0(n),YA(n,s,!0);break;case"textarea":E0(n),JA(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=P2)}n=i,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=ZO(t)),r==="http://www.w3.org/1999/xhtml"?t==="script"?(r=o.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof n.is=="string"?r=o.createElement(t,{is:n.is}):(r=o.createElement(t),t==="select"&&(o=r,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):r=o.createElementNS(r,t),r[Rs]=e,r[$1]=n,xR(r,e,!1,!1),e.stateNode=r;e:{switch(o=g5(t,n),t){case"dialog":Mt("cancel",r),Mt("close",r),i=n;break;case"iframe":case"object":case"embed":Mt("load",r),i=n;break;case"video":case"audio":for(i=0;i<Ff.length;i++)Mt(Ff[i],r);i=n;break;case"source":Mt("error",r),i=n;break;case"img":case"image":case"link":Mt("error",r),Mt("load",r),i=n;break;case"details":Mt("toggle",r),i=n;break;case"input":QA(r,n),i=l5(r,n),Mt("invalid",r);break;case"option":i=n;break;case"select":r._wrapperState={wasMultiple:!!n.multiple},i=qt({},n,{value:void 0}),Mt("invalid",r);break;case"textarea":XA(r,n),i=h5(r,n),Mt("invalid",r);break;default:i=n}p5(t,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?rM(r,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&eM(r,c)):s==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&x1(r,c):typeof c=="number"&&x1(r,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(S1.hasOwnProperty(s)?c!=null&&s==="onScroll"&&Mt("scroll",r):c!=null&&B9(r,s,c,o))}switch(t){case"input":E0(r),YA(r,n,!1);break;case"textarea":E0(r),JA(r);break;case"option":n.value!=null&&r.setAttribute("value",""+mc(n.value));break;case"select":r.multiple=!!n.multiple,s=n.value,s!=null?ad(r,!!n.multiple,s,!1):n.defaultValue!=null&&ad(r,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(r.onclick=P2)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Rr(e),null;case 6:if(r&&e.stateNode!=null)IR(r,e,r.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(se(166));if(t=yl(O1.current),yl(Fs.current),P0(e)){if(n=e.stateNode,t=e.memoizedProps,n[Rs]=e,(s=n.nodeValue!==t)&&(r=ri,r!==null))switch(r.tag){case 3:T0(n.nodeValue,t,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&T0(n.nodeValue,t,(r.mode&1)!==0)}s&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[Rs]=e,e.stateNode=n}return Rr(e),null;case 13:if(Rt(Kt),n=e.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(Ut&&ti!==null&&e.mode&1&&!(e.flags&128))KM(),Rd(),e.flags|=98560,s=!1;else if(s=P0(e),n!==null&&n.dehydrated!==null){if(r===null){if(!s)throw Error(se(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(se(317));s[Rs]=e}else Rd(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Rr(e),s=!1}else ns!==null&&(Q5(ns),ns=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(r!==null&&r.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(r===null||Kt.current&1?cr===0&&(cr=3):bE())),e.updateQueue!==null&&(e.flags|=4),Rr(e),null);case 4:return Bd(),z5(r,e),r===null&&P1(e.stateNode.containerInfo),Rr(e),null;case 10:return nE(e.type._context),Rr(e),null;case 17:return Nn(e.type)&&D2(),Rr(e),null;case 19:if(Rt(Kt),s=e.memoizedState,s===null)return Rr(e),null;if(n=(e.flags&128)!==0,o=s.rendering,o===null)if(n)sf(s,!1);else{if(cr!==0||r!==null&&r.flags&128)for(r=e.child;r!==null;){if(o=B2(r),o!==null){for(e.flags|=128,sf(s,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)s=t,r=n,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=r,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,r=o.dependencies,s.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t=t.sibling;return $t(Kt,Kt.current&1|2),e.child}r=r.sibling}s.tail!==null&&Jt()>Fd&&(e.flags|=128,n=!0,sf(s,!1),e.lanes=4194304)}else{if(!n)if(r=B2(o),r!==null){if(e.flags|=128,n=!0,t=r.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),sf(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Ut)return Rr(e),null}else 2*Jt()-s.renderingStartTime>Fd&&t!==1073741824&&(e.flags|=128,n=!0,sf(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Jt(),e.sibling=null,t=Kt.current,$t(Kt,n?t&1|2:t&1),e):(Rr(e),null);case 22:case 23:return vE(),n=e.memoizedState!==null,r!==null&&r.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Qn&1073741824&&(Rr(e),e.subtreeFlags&6&&(e.flags|=8192)):Rr(e),null;case 24:return null;case 25:return null}throw Error(se(156,e.tag))}function SG(r,e){switch(Z9(e),e.tag){case 1:return Nn(e.type)&&D2(),r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 3:return Bd(),Rt($n),Rt(sn),cE(),r=e.flags,r&65536&&!(r&128)?(e.flags=r&-65537|128,e):null;case 5:return aE(e),null;case 13:if(Rt(Kt),r=e.memoizedState,r!==null&&r.dehydrated!==null){if(e.alternate===null)throw Error(se(340));Rd()}return r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 19:return Rt(Kt),null;case 4:return Bd(),null;case 10:return nE(e.type._context),null;case 22:case 23:return vE(),null;case 24:return null;default:return null}}var N0=!1,en=!1,xG=typeof WeakSet=="function"?WeakSet:Set,Ae=null;function ed(r,e){var t=r.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){Qt(r,e,n)}else t.current=null}function V5(r,e,t){try{t()}catch(n){Qt(r,e,n)}}var zI=!1;function AG(r,e){if(I5=k2,r=PM(),X9(r)){if("selectionStart"in r)var t={start:r.selectionStart,end:r.selectionEnd};else e:{t=(t=r.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var i=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,c=-1,l=0,d=0,h=r,p=null;t:for(;;){for(var w;h!==t||i!==0&&h.nodeType!==3||(a=o+i),h!==s||n!==0&&h.nodeType!==3||(c=o+n),h.nodeType===3&&(o+=h.nodeValue.length),(w=h.firstChild)!==null;)p=h,h=w;for(;;){if(h===r)break t;if(p===t&&++l===i&&(a=o),p===s&&++d===n&&(c=o),(w=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=w}t=a===-1||c===-1?null:{start:a,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(C5={focusedElem:r,selectionRange:t},k2=!1,Ae=e;Ae!==null;)if(e=Ae,r=e.child,(e.subtreeFlags&1028)!==0&&r!==null)r.return=e,Ae=r;else for(;Ae!==null;){e=Ae;try{var f=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var g=f.memoizedProps,v=f.memoizedState,y=e.stateNode,m=y.getSnapshotBeforeUpdate(e.elementType===e.type?g:Zi(e.type,g),v);y.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(se(163))}}catch(S){Qt(e,e.return,S)}if(r=e.sibling,r!==null){r.return=e.return,Ae=r;break}Ae=e.return}return f=zI,zI=!1,f}function n1(r,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&r)===r){var s=i.destroy;i.destroy=void 0,s!==void 0&&V5(e,t,s)}i=i.next}while(i!==n)}}function _3(r,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&r)===r){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function K5(r){var e=r.ref;if(e!==null){var t=r.stateNode;switch(r.tag){case 5:r=t;break;default:r=t}typeof e=="function"?e(r):e.current=r}}function CR(r){var e=r.alternate;e!==null&&(r.alternate=null,CR(e)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(e=r.stateNode,e!==null&&(delete e[Rs],delete e[$1],delete e[T5],delete e[oG],delete e[aG])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function kR(r){return r.tag===5||r.tag===3||r.tag===4}function VI(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||kR(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function H5(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(r,e):t.insertBefore(r,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(r,t)):(e=t,e.appendChild(r)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=P2));else if(n!==4&&(r=r.child,r!==null))for(H5(r,e,t),r=r.sibling;r!==null;)H5(r,e,t),r=r.sibling}function j5(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.insertBefore(r,e):t.appendChild(r);else if(n!==4&&(r=r.child,r!==null))for(j5(r,e,t),r=r.sibling;r!==null;)j5(r,e,t),r=r.sibling}var Sr=null,es=!1;function da(r,e,t){for(t=t.child;t!==null;)_R(r,e,t),t=t.sibling}function _R(r,e,t){if(Us&&typeof Us.onCommitFiberUnmount=="function")try{Us.onCommitFiberUnmount(b3,t)}catch{}switch(t.tag){case 5:en||ed(t,e);case 6:var n=Sr,i=es;Sr=null,da(r,e,t),Sr=n,es=i,Sr!==null&&(es?(r=Sr,t=t.stateNode,r.nodeType===8?r.parentNode.removeChild(t):r.removeChild(t)):Sr.removeChild(t.stateNode));break;case 18:Sr!==null&&(es?(r=Sr,t=t.stateNode,r.nodeType===8?s8(r.parentNode,t):r.nodeType===1&&s8(r,t),k1(r)):s8(Sr,t.stateNode));break;case 4:n=Sr,i=es,Sr=t.stateNode.containerInfo,es=!0,da(r,e,t),Sr=n,es=i;break;case 0:case 11:case 14:case 15:if(!en&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&V5(t,e,o),i=i.next}while(i!==n)}da(r,e,t);break;case 1:if(!en&&(ed(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(a){Qt(t,e,a)}da(r,e,t);break;case 21:da(r,e,t);break;case 22:t.mode&1?(en=(n=en)||t.memoizedState!==null,da(r,e,t),en=n):da(r,e,t);break;default:da(r,e,t)}}function KI(r){var e=r.updateQueue;if(e!==null){r.updateQueue=null;var t=r.stateNode;t===null&&(t=r.stateNode=new xG),e.forEach(function(n){var i=NG.bind(null,r,n);t.has(n)||(t.add(n),n.then(i,i))})}}function ji(r,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var i=t[n];try{var s=r,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Sr=a.stateNode,es=!1;break e;case 3:Sr=a.stateNode.containerInfo,es=!0;break e;case 4:Sr=a.stateNode.containerInfo,es=!0;break e}a=a.return}if(Sr===null)throw Error(se(160));_R(s,o,i),Sr=null,es=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(l){Qt(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)TR(e,r),e=e.sibling}function TR(r,e){var t=r.alternate,n=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(ji(e,r),Ss(r),n&4){try{n1(3,r,r.return),_3(3,r)}catch(g){Qt(r,r.return,g)}try{n1(5,r,r.return)}catch(g){Qt(r,r.return,g)}}break;case 1:ji(e,r),Ss(r),n&512&&t!==null&&ed(t,t.return);break;case 5:if(ji(e,r),Ss(r),n&512&&t!==null&&ed(t,t.return),r.flags&32){var i=r.stateNode;try{x1(i,"")}catch(g){Qt(r,r.return,g)}}if(n&4&&(i=r.stateNode,i!=null)){var s=r.memoizedProps,o=t!==null?t.memoizedProps:s,a=r.type,c=r.updateQueue;if(r.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&XO(i,s),g5(a,o);var l=g5(a,s);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];d==="style"?rM(i,h):d==="dangerouslySetInnerHTML"?eM(i,h):d==="children"?x1(i,h):B9(i,d,h,l)}switch(a){case"input":u5(i,s);break;case"textarea":JO(i,s);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var w=s.value;w!=null?ad(i,!!s.multiple,w,!1):p!==!!s.multiple&&(s.defaultValue!=null?ad(i,!!s.multiple,s.defaultValue,!0):ad(i,!!s.multiple,s.multiple?[]:"",!1))}i[$1]=s}catch(g){Qt(r,r.return,g)}}break;case 6:if(ji(e,r),Ss(r),n&4){if(r.stateNode===null)throw Error(se(162));i=r.stateNode,s=r.memoizedProps;try{i.nodeValue=s}catch(g){Qt(r,r.return,g)}}break;case 3:if(ji(e,r),Ss(r),n&4&&t!==null&&t.memoizedState.isDehydrated)try{k1(e.containerInfo)}catch(g){Qt(r,r.return,g)}break;case 4:ji(e,r),Ss(r);break;case 13:ji(e,r),Ss(r),i=r.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(mE=Jt())),n&4&&KI(r);break;case 22:if(d=t!==null&&t.memoizedState!==null,r.mode&1?(en=(l=en)||d,ji(e,r),en=l):ji(e,r),Ss(r),n&8192){if(l=r.memoizedState!==null,(r.stateNode.isHidden=l)&&!d&&r.mode&1)for(Ae=r,d=r.child;d!==null;){for(h=Ae=d;Ae!==null;){switch(p=Ae,w=p.child,p.tag){case 0:case 11:case 14:case 15:n1(4,p,p.return);break;case 1:ed(p,p.return);var f=p.stateNode;if(typeof f.componentWillUnmount=="function"){n=p,t=p.return;try{e=n,f.props=e.memoizedProps,f.state=e.memoizedState,f.componentWillUnmount()}catch(g){Qt(n,t,g)}}break;case 5:ed(p,p.return);break;case 22:if(p.memoizedState!==null){jI(h);continue}}w!==null?(w.return=p,Ae=w):jI(h)}d=d.sibling}e:for(d=null,h=r;;){if(h.tag===5){if(d===null){d=h;try{i=h.stateNode,l?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=tM("display",o))}catch(g){Qt(r,r.return,g)}}}else if(h.tag===6){if(d===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(g){Qt(r,r.return,g)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===r)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===r)break e;for(;h.sibling===null;){if(h.return===null||h.return===r)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ji(e,r),Ss(r),n&4&&KI(r);break;case 21:break;default:ji(e,r),Ss(r)}}function Ss(r){var e=r.flags;if(e&2){try{e:{for(var t=r.return;t!==null;){if(kR(t)){var n=t;break e}t=t.return}throw Error(se(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(x1(i,""),n.flags&=-33);var s=VI(r);j5(r,s,i);break;case 3:case 4:var o=n.stateNode.containerInfo,a=VI(r);H5(r,a,o);break;default:throw Error(se(161))}}catch(c){Qt(r,r.return,c)}r.flags&=-3}e&4096&&(r.flags&=-4097)}function IG(r,e,t){Ae=r,PR(r)}function PR(r,e,t){for(var n=(r.mode&1)!==0;Ae!==null;){var i=Ae,s=i.child;if(i.tag===22&&n){var o=i.memoizedState!==null||N0;if(!o){var a=i.alternate,c=a!==null&&a.memoizedState!==null||en;a=N0;var l=en;if(N0=o,(en=c)&&!l)for(Ae=i;Ae!==null;)o=Ae,c=o.child,o.tag===22&&o.memoizedState!==null?qI(i):c!==null?(c.return=o,Ae=c):qI(i);for(;s!==null;)Ae=s,PR(s),s=s.sibling;Ae=i,N0=a,en=l}HI(r)}else i.subtreeFlags&8772&&s!==null?(s.return=i,Ae=s):HI(r)}}function HI(r){for(;Ae!==null;){var e=Ae;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:en||_3(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!en)if(t===null)n.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Zi(e.type,t.memoizedProps);n.componentDidUpdate(i,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&_I(e,s,n);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}_I(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var d=l.memoizedState;if(d!==null){var h=d.dehydrated;h!==null&&k1(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(se(163))}en||e.flags&512&&K5(e)}catch(p){Qt(e,e.return,p)}}if(e===r){Ae=null;break}if(t=e.sibling,t!==null){t.return=e.return,Ae=t;break}Ae=e.return}}function jI(r){for(;Ae!==null;){var e=Ae;if(e===r){Ae=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Ae=t;break}Ae=e.return}}function qI(r){for(;Ae!==null;){var e=Ae;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{_3(4,e)}catch(c){Qt(e,t,c)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var i=e.return;try{n.componentDidMount()}catch(c){Qt(e,i,c)}}var s=e.return;try{K5(e)}catch(c){Qt(e,s,c)}break;case 5:var o=e.return;try{K5(e)}catch(c){Qt(e,o,c)}}}catch(c){Qt(e,e.return,c)}if(e===r){Ae=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ae=a;break}Ae=e.return}}var CG=Math.ceil,z2=Yo.ReactCurrentDispatcher,gE=Yo.ReactCurrentOwner,Ni=Yo.ReactCurrentBatchConfig,st=0,wr=null,ir=null,Cr=0,Qn=0,td=Rc(0),cr=0,B1=null,Vl=0,T3=0,yE=0,i1=null,_n=null,mE=0,Fd=1/0,po=null,V2=!1,q5=null,oc=null,O0=!1,Ga=null,K2=0,s1=0,W5=null,Bg=-1,Ug=0;function fn(){return st&6?Jt():Bg!==-1?Bg:Bg=Jt()}function ac(r){return r.mode&1?st&2&&Cr!==0?Cr&-Cr:lG.transition!==null?(Ug===0&&(Ug=pM()),Ug):(r=Et,r!==0||(r=window.event,r=r===void 0?16:EM(r.type)),r):1}function ls(r,e,t,n){if(50<s1)throw s1=0,W5=null,Error(se(185));_p(r,t,n),(!(st&2)||r!==wr)&&(r===wr&&(!(st&2)&&(T3|=t),cr===4&&za(r,Cr)),On(r,n),t===1&&st===0&&!(e.mode&1)&&(Fd=Jt()+500,I3&&Lc()))}function On(r,e){var t=r.callbackNode;lW(r,e);var n=C2(r,r===wr?Cr:0);if(n===0)t!==null&&tI(t),r.callbackNode=null,r.callbackPriority=0;else if(e=n&-n,r.callbackPriority!==e){if(t!=null&&tI(t),e===1)r.tag===0?cG(WI.bind(null,r)):FM(WI.bind(null,r)),iG(function(){!(st&6)&&Lc()}),t=null;else{switch(gM(n)){case 1:t=K9;break;case 4:t=hM;break;case 16:t=I2;break;case 536870912:t=fM;break;default:t=I2}t=BR(t,DR.bind(null,r))}r.callbackPriority=e,r.callbackNode=t}}function DR(r,e){if(Bg=-1,Ug=0,st&6)throw Error(se(327));var t=r.callbackNode;if(hd()&&r.callbackNode!==t)return null;var n=C2(r,r===wr?Cr:0);if(n===0)return null;if(n&30||n&r.expiredLanes||e)e=H2(r,n);else{e=n;var i=st;st|=2;var s=NR();(wr!==r||Cr!==e)&&(po=null,Fd=Jt()+500,Cl(r,e));do try{TG();break}catch(a){$R(r,a)}while(!0);rE(),z2.current=s,st=i,ir!==null?e=0:(wr=null,Cr=0,e=cr)}if(e!==0){if(e===2&&(i=b5(r),i!==0&&(n=i,e=G5(r,i))),e===1)throw t=B1,Cl(r,0),za(r,n),On(r,Jt()),t;if(e===6)za(r,n);else{if(i=r.current.alternate,!(n&30)&&!kG(i)&&(e=H2(r,n),e===2&&(s=b5(r),s!==0&&(n=s,e=G5(r,s))),e===1))throw t=B1,Cl(r,0),za(r,n),On(r,Jt()),t;switch(r.finishedWork=i,r.finishedLanes=n,e){case 0:case 1:throw Error(se(345));case 2:sl(r,_n,po);break;case 3:if(za(r,n),(n&130023424)===n&&(e=mE+500-Jt(),10<e)){if(C2(r,0)!==0)break;if(i=r.suspendedLanes,(i&n)!==n){fn(),r.pingedLanes|=r.suspendedLanes&i;break}r.timeoutHandle=_5(sl.bind(null,r,_n,po),e);break}sl(r,_n,po);break;case 4:if(za(r,n),(n&4194240)===n)break;for(e=r.eventTimes,i=-1;0<n;){var o=31-cs(n);s=1<<o,o=e[o],o>i&&(i=o),n&=~s}if(n=i,n=Jt()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*CG(n/1960))-n,10<n){r.timeoutHandle=_5(sl.bind(null,r,_n,po),n);break}sl(r,_n,po);break;case 5:sl(r,_n,po);break;default:throw Error(se(329))}}}return On(r,Jt()),r.callbackNode===t?DR.bind(null,r):null}function G5(r,e){var t=i1;return r.current.memoizedState.isDehydrated&&(Cl(r,e).flags|=256),r=H2(r,e),r!==2&&(e=_n,_n=t,e!==null&&Q5(e)),r}function Q5(r){_n===null?_n=r:_n.push.apply(_n,r)}function kG(r){for(var e=r;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var i=t[n],s=i.getSnapshot;i=i.value;try{if(!ps(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function za(r,e){for(e&=~yE,e&=~T3,r.suspendedLanes|=e,r.pingedLanes&=~e,r=r.expirationTimes;0<e;){var t=31-cs(e),n=1<<t;r[t]=-1,e&=~n}}function WI(r){if(st&6)throw Error(se(327));hd();var e=C2(r,0);if(!(e&1))return On(r,Jt()),null;var t=H2(r,e);if(r.tag!==0&&t===2){var n=b5(r);n!==0&&(e=n,t=G5(r,n))}if(t===1)throw t=B1,Cl(r,0),za(r,e),On(r,Jt()),t;if(t===6)throw Error(se(345));return r.finishedWork=r.current.alternate,r.finishedLanes=e,sl(r,_n,po),On(r,Jt()),null}function wE(r,e){var t=st;st|=1;try{return r(e)}finally{st=t,st===0&&(Fd=Jt()+500,I3&&Lc())}}function Kl(r){Ga!==null&&Ga.tag===0&&!(st&6)&&hd();var e=st;st|=1;var t=Ni.transition,n=Et;try{if(Ni.transition=null,Et=1,r)return r()}finally{Et=n,Ni.transition=t,st=e,!(st&6)&&Lc()}}function vE(){Qn=td.current,Rt(td)}function Cl(r,e){r.finishedWork=null,r.finishedLanes=0;var t=r.timeoutHandle;if(t!==-1&&(r.timeoutHandle=-1,nG(t)),ir!==null)for(t=ir.return;t!==null;){var n=t;switch(Z9(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&D2();break;case 3:Bd(),Rt($n),Rt(sn),cE();break;case 5:aE(n);break;case 4:Bd();break;case 13:Rt(Kt);break;case 19:Rt(Kt);break;case 10:nE(n.type._context);break;case 22:case 23:vE()}t=t.return}if(wr=r,ir=r=cc(r.current,null),Cr=Qn=e,cr=0,B1=null,yE=T3=Vl=0,_n=i1=null,gl!==null){for(e=0;e<gl.length;e++)if(t=gl[e],n=t.interleaved,n!==null){t.interleaved=null;var i=n.next,s=t.pending;if(s!==null){var o=s.next;s.next=i,n.next=o}t.pending=n}gl=null}return r}function $R(r,e){do{var t=ir;try{if(rE(),Mg.current=F2,U2){for(var n=jt.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}U2=!1}if(zl=0,yr=ar=jt=null,r1=!1,M1=0,gE.current=null,t===null||t.return===null){cr=1,B1=e,ir=null;break}e:{var s=r,o=t.return,a=t,c=e;if(e=Cr,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,d=a,h=d.tag;if(!(d.mode&1)&&(h===0||h===11||h===15)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var w=OI(o);if(w!==null){w.flags&=-257,MI(w,o,a,s,e),w.mode&1&&NI(s,l,e),e=w,c=l;var f=e.updateQueue;if(f===null){var g=new Set;g.add(c),e.updateQueue=g}else f.add(c);break e}else{if(!(e&1)){NI(s,l,e),bE();break e}c=Error(se(426))}}else if(Ut&&a.mode&1){var v=OI(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),MI(v,o,a,s,e),eE(Ud(c,a));break e}}s=c=Ud(c,a),cr!==4&&(cr=2),i1===null?i1=[s]:i1.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var y=gR(s,c,e);kI(s,y);break e;case 1:a=c;var m=s.type,b=s.stateNode;if(!(s.flags&128)&&(typeof m.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(oc===null||!oc.has(b)))){s.flags|=65536,e&=-e,s.lanes|=e;var S=yR(s,a,e);kI(s,S);break e}}s=s.return}while(s!==null)}MR(t)}catch(I){e=I,ir===t&&t!==null&&(ir=t=t.return);continue}break}while(!0)}function NR(){var r=z2.current;return z2.current=F2,r===null?F2:r}function bE(){(cr===0||cr===3||cr===2)&&(cr=4),wr===null||!(Vl&268435455)&&!(T3&268435455)||za(wr,Cr)}function H2(r,e){var t=st;st|=2;var n=NR();(wr!==r||Cr!==e)&&(po=null,Cl(r,e));do try{_G();break}catch(i){$R(r,i)}while(!0);if(rE(),st=t,z2.current=n,ir!==null)throw Error(se(261));return wr=null,Cr=0,cr}function _G(){for(;ir!==null;)OR(ir)}function TG(){for(;ir!==null&&!eW();)OR(ir)}function OR(r){var e=LR(r.alternate,r,Qn);r.memoizedProps=r.pendingProps,e===null?MR(r):ir=e,gE.current=null}function MR(r){var e=r;do{var t=e.alternate;if(r=e.return,e.flags&32768){if(t=SG(t,e),t!==null){t.flags&=32767,ir=t;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{cr=6,ir=null;return}}else if(t=EG(t,e,Qn),t!==null){ir=t;return}if(e=e.sibling,e!==null){ir=e;return}ir=e=r}while(e!==null);cr===0&&(cr=5)}function sl(r,e,t){var n=Et,i=Ni.transition;try{Ni.transition=null,Et=1,PG(r,e,t,n)}finally{Ni.transition=i,Et=n}return null}function PG(r,e,t,n){do hd();while(Ga!==null);if(st&6)throw Error(se(327));t=r.finishedWork;var i=r.finishedLanes;if(t===null)return null;if(r.finishedWork=null,r.finishedLanes=0,t===r.current)throw Error(se(177));r.callbackNode=null,r.callbackPriority=0;var s=t.lanes|t.childLanes;if(uW(r,s),r===wr&&(ir=wr=null,Cr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||O0||(O0=!0,BR(I2,function(){return hd(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Ni.transition,Ni.transition=null;var o=Et;Et=1;var a=st;st|=4,gE.current=null,AG(r,t),TR(t,r),YW(C5),k2=!!I5,C5=I5=null,r.current=t,IG(t),tW(),st=a,Et=o,Ni.transition=s}else r.current=t;if(O0&&(O0=!1,Ga=r,K2=i),s=r.pendingLanes,s===0&&(oc=null),iW(t.stateNode),On(r,Jt()),e!==null)for(n=r.onRecoverableError,t=0;t<e.length;t++)i=e[t],n(i.value,{componentStack:i.stack,digest:i.digest});if(V2)throw V2=!1,r=q5,q5=null,r;return K2&1&&r.tag!==0&&hd(),s=r.pendingLanes,s&1?r===W5?s1++:(s1=0,W5=r):s1=0,Lc(),null}function hd(){if(Ga!==null){var r=gM(K2),e=Ni.transition,t=Et;try{if(Ni.transition=null,Et=16>r?16:r,Ga===null)var n=!1;else{if(r=Ga,Ga=null,K2=0,st&6)throw Error(se(331));var i=st;for(st|=4,Ae=r.current;Ae!==null;){var s=Ae,o=s.child;if(Ae.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(Ae=l;Ae!==null;){var d=Ae;switch(d.tag){case 0:case 11:case 15:n1(8,d,s)}var h=d.child;if(h!==null)h.return=d,Ae=h;else for(;Ae!==null;){d=Ae;var p=d.sibling,w=d.return;if(CR(d),d===l){Ae=null;break}if(p!==null){p.return=w,Ae=p;break}Ae=w}}}var f=s.alternate;if(f!==null){var g=f.child;if(g!==null){f.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(g!==null)}}Ae=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,Ae=o;else e:for(;Ae!==null;){if(s=Ae,s.flags&2048)switch(s.tag){case 0:case 11:case 15:n1(9,s,s.return)}var y=s.sibling;if(y!==null){y.return=s.return,Ae=y;break e}Ae=s.return}}var m=r.current;for(Ae=m;Ae!==null;){o=Ae;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,Ae=b;else e:for(o=m;Ae!==null;){if(a=Ae,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:_3(9,a)}}catch(I){Qt(a,a.return,I)}if(a===o){Ae=null;break e}var S=a.sibling;if(S!==null){S.return=a.return,Ae=S;break e}Ae=a.return}}if(st=i,Lc(),Us&&typeof Us.onPostCommitFiberRoot=="function")try{Us.onPostCommitFiberRoot(b3,r)}catch{}n=!0}return n}finally{Et=t,Ni.transition=e}}return!1}function GI(r,e,t){e=Ud(t,e),e=gR(r,e,1),r=sc(r,e,1),e=fn(),r!==null&&(_p(r,1,e),On(r,e))}function Qt(r,e,t){if(r.tag===3)GI(r,r,t);else for(;e!==null;){if(e.tag===3){GI(e,r,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(oc===null||!oc.has(n))){r=Ud(t,r),r=yR(e,r,1),e=sc(e,r,1),r=fn(),e!==null&&(_p(e,1,r),On(e,r));break}}e=e.return}}function DG(r,e,t){var n=r.pingCache;n!==null&&n.delete(e),e=fn(),r.pingedLanes|=r.suspendedLanes&t,wr===r&&(Cr&t)===t&&(cr===4||cr===3&&(Cr&130023424)===Cr&&500>Jt()-mE?Cl(r,0):yE|=t),On(r,e)}function RR(r,e){e===0&&(r.mode&1?(e=A0,A0<<=1,!(A0&130023424)&&(A0=4194304)):e=1);var t=fn();r=Uo(r,e),r!==null&&(_p(r,e,t),On(r,t))}function $G(r){var e=r.memoizedState,t=0;e!==null&&(t=e.retryLane),RR(r,t)}function NG(r,e){var t=0;switch(r.tag){case 13:var n=r.stateNode,i=r.memoizedState;i!==null&&(t=i.retryLane);break;case 19:n=r.stateNode;break;default:throw Error(se(314))}n!==null&&n.delete(e),RR(r,t)}var LR;LR=function(r,e,t){if(r!==null)if(r.memoizedProps!==e.pendingProps||$n.current)Pn=!0;else{if(!(r.lanes&t)&&!(e.flags&128))return Pn=!1,bG(r,e,t);Pn=!!(r.flags&131072)}else Pn=!1,Ut&&e.flags&1048576&&zM(e,O2,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Lg(r,e),r=e.pendingProps;var i=Md(e,sn.current);dd(e,t),i=uE(null,e,n,r,i,t);var s=dE();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Nn(n)?(s=!0,$2(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,sE(e),i.updater=k3,e.stateNode=i,i._reactInternals=e,M5(e,n,r,t),e=B5(null,e,n,!0,s,t)):(e.tag=0,Ut&&s&&J9(e),cn(null,e,i,t),e=e.child),e;case 16:n=e.elementType;e:{switch(Lg(r,e),r=e.pendingProps,i=n._init,n=i(n._payload),e.type=n,i=e.tag=MG(n),r=Zi(n,r),i){case 0:e=L5(null,e,n,r,t);break e;case 1:e=BI(null,e,n,r,t);break e;case 11:e=RI(null,e,n,r,t);break e;case 14:e=LI(null,e,n,Zi(n.type,r),t);break e}throw Error(se(306,n,""))}return e;case 0:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Zi(n,i),L5(r,e,n,i,t);case 1:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Zi(n,i),BI(r,e,n,i,t);case 3:e:{if(bR(e),r===null)throw Error(se(387));n=e.pendingProps,s=e.memoizedState,i=s.element,WM(r,e),L2(e,n,null,t);var o=e.memoizedState;if(n=o.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Ud(Error(se(423)),e),e=UI(r,e,n,t,i);break e}else if(n!==i){i=Ud(Error(se(424)),e),e=UI(r,e,n,t,i);break e}else for(ti=ic(e.stateNode.containerInfo.firstChild),ri=e,Ut=!0,ns=null,t=jM(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Rd(),n===i){e=Fo(r,e,t);break e}cn(r,e,n,t)}e=e.child}return e;case 5:return GM(e),r===null&&$5(e),n=e.type,i=e.pendingProps,s=r!==null?r.memoizedProps:null,o=i.children,k5(n,i)?o=null:s!==null&&k5(n,s)&&(e.flags|=32),vR(r,e),cn(r,e,o,t),e.child;case 6:return r===null&&$5(e),null;case 13:return ER(r,e,t);case 4:return oE(e,e.stateNode.containerInfo),n=e.pendingProps,r===null?e.child=Ld(e,null,n,t):cn(r,e,n,t),e.child;case 11:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Zi(n,i),RI(r,e,n,i,t);case 7:return cn(r,e,e.pendingProps,t),e.child;case 8:return cn(r,e,e.pendingProps.children,t),e.child;case 12:return cn(r,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,$t(M2,n._currentValue),n._currentValue=o,s!==null)if(ps(s.value,o)){if(s.children===i.children&&!$n.current){e=Fo(r,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===n){if(s.tag===1){c=Po(-1,t&-t),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var d=l.pending;d===null?c.next=c:(c.next=d.next,d.next=c),l.pending=c}}s.lanes|=t,c=s.alternate,c!==null&&(c.lanes|=t),N5(s.return,t,e),a.lanes|=t;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(se(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),N5(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}cn(r,e,i.children,t),e=e.child}return e;case 9:return i=e.type,n=e.pendingProps.children,dd(e,t),i=Ri(i),n=n(i),e.flags|=1,cn(r,e,n,t),e.child;case 14:return n=e.type,i=Zi(n,e.pendingProps),i=Zi(n.type,i),LI(r,e,n,i,t);case 15:return mR(r,e,e.type,e.pendingProps,t);case 17:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Zi(n,i),Lg(r,e),e.tag=1,Nn(n)?(r=!0,$2(e)):r=!1,dd(e,t),pR(e,n,i),M5(e,n,i,t),B5(null,e,n,!0,r,t);case 19:return SR(r,e,t);case 22:return wR(r,e,t)}throw Error(se(156,e.tag))};function BR(r,e){return dM(r,e)}function OG(r,e,t,n){this.tag=r,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _i(r,e,t,n){return new OG(r,e,t,n)}function EE(r){return r=r.prototype,!(!r||!r.isReactComponent)}function MG(r){if(typeof r=="function")return EE(r)?1:0;if(r!=null){if(r=r.$$typeof,r===F9)return 11;if(r===z9)return 14}return 2}function cc(r,e){var t=r.alternate;return t===null?(t=_i(r.tag,e,r.key,r.mode),t.elementType=r.elementType,t.type=r.type,t.stateNode=r.stateNode,t.alternate=r,r.alternate=t):(t.pendingProps=e,t.type=r.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=r.flags&14680064,t.childLanes=r.childLanes,t.lanes=r.lanes,t.child=r.child,t.memoizedProps=r.memoizedProps,t.memoizedState=r.memoizedState,t.updateQueue=r.updateQueue,e=r.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=r.sibling,t.index=r.index,t.ref=r.ref,t}function Fg(r,e,t,n,i,s){var o=2;if(n=r,typeof r=="function")EE(r)&&(o=1);else if(typeof r=="string")o=5;else e:switch(r){case ju:return kl(t.children,i,s,e);case U9:o=8,i|=8;break;case s5:return r=_i(12,t,e,i|2),r.elementType=s5,r.lanes=s,r;case o5:return r=_i(13,t,e,i),r.elementType=o5,r.lanes=s,r;case a5:return r=_i(19,t,e,i),r.elementType=a5,r.lanes=s,r;case GO:return P3(t,i,s,e);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case qO:o=10;break e;case WO:o=9;break e;case F9:o=11;break e;case z9:o=14;break e;case Ca:o=16,n=null;break e}throw Error(se(130,r==null?r:typeof r,""))}return e=_i(o,t,e,i),e.elementType=r,e.type=n,e.lanes=s,e}function kl(r,e,t,n){return r=_i(7,r,n,e),r.lanes=t,r}function P3(r,e,t,n){return r=_i(22,r,n,e),r.elementType=GO,r.lanes=t,r.stateNode={isHidden:!1},r}function f8(r,e,t){return r=_i(6,r,null,e),r.lanes=t,r}function p8(r,e,t){return e=_i(4,r.children!==null?r.children:[],r.key,e),e.lanes=t,e.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},e}function RG(r,e,t,n,i){this.tag=e,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=G4(0),this.expirationTimes=G4(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=G4(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function SE(r,e,t,n,i,s,o,a,c){return r=new RG(r,e,t,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=_i(3,null,null,e),r.current=s,s.stateNode=r,s.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},sE(s),r}function LG(r,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Hu,key:n==null?null:""+n,children:r,containerInfo:e,implementation:t}}function UR(r){if(!r)return wc;r=r._reactInternals;e:{if(fu(r)!==r||r.tag!==1)throw Error(se(170));var e=r;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Nn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(se(171))}if(r.tag===1){var t=r.type;if(Nn(t))return UM(r,t,e)}return e}function FR(r,e,t,n,i,s,o,a,c){return r=SE(t,n,!0,r,i,s,o,a,c),r.context=UR(null),t=r.current,n=fn(),i=ac(t),s=Po(n,i),s.callback=e??null,sc(t,s,i),r.current.lanes=i,_p(r,i,n),On(r,n),r}function D3(r,e,t,n){var i=e.current,s=fn(),o=ac(i);return t=UR(t),e.context===null?e.context=t:e.pendingContext=t,e=Po(s,o),e.payload={element:r},n=n===void 0?null:n,n!==null&&(e.callback=n),r=sc(i,e,o),r!==null&&(ls(r,i,o,s),Og(r,i,o)),o}function j2(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function QI(r,e){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var t=r.retryLane;r.retryLane=t!==0&&t<e?t:e}}function xE(r,e){QI(r,e),(r=r.alternate)&&QI(r,e)}function BG(){return null}var zR=typeof reportError=="function"?reportError:function(r){console.error(r)};function AE(r){this._internalRoot=r}$3.prototype.render=AE.prototype.render=function(r){var e=this._internalRoot;if(e===null)throw Error(se(409));D3(r,e,null,null)};$3.prototype.unmount=AE.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var e=r.containerInfo;Kl(function(){D3(null,r,null,null)}),e[Bo]=null}};function $3(r){this._internalRoot=r}$3.prototype.unstable_scheduleHydration=function(r){if(r){var e=wM();r={blockedOn:null,target:r,priority:e};for(var t=0;t<Fa.length&&e!==0&&e<Fa[t].priority;t++);Fa.splice(t,0,r),t===0&&bM(r)}};function IE(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function N3(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function YI(){}function UG(r,e,t,n,i){if(i){if(typeof n=="function"){var s=n;n=function(){var l=j2(o);s.call(l)}}var o=FR(e,n,r,0,null,!1,!1,"",YI);return r._reactRootContainer=o,r[Bo]=o.current,P1(r.nodeType===8?r.parentNode:r),Kl(),o}for(;i=r.lastChild;)r.removeChild(i);if(typeof n=="function"){var a=n;n=function(){var l=j2(c);a.call(l)}}var c=SE(r,0,!1,null,null,!1,!1,"",YI);return r._reactRootContainer=c,r[Bo]=c.current,P1(r.nodeType===8?r.parentNode:r),Kl(function(){D3(e,c,t,n)}),c}function O3(r,e,t,n,i){var s=t._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var c=j2(o);a.call(c)}}D3(e,o,r,i)}else o=UG(t,e,r,i,n);return j2(o)}yM=function(r){switch(r.tag){case 3:var e=r.stateNode;if(e.current.memoizedState.isDehydrated){var t=Uf(e.pendingLanes);t!==0&&(H9(e,t|1),On(e,Jt()),!(st&6)&&(Fd=Jt()+500,Lc()))}break;case 13:Kl(function(){var n=Uo(r,1);if(n!==null){var i=fn();ls(n,r,1,i)}}),xE(r,1)}};j9=function(r){if(r.tag===13){var e=Uo(r,134217728);if(e!==null){var t=fn();ls(e,r,134217728,t)}xE(r,134217728)}};mM=function(r){if(r.tag===13){var e=ac(r),t=Uo(r,e);if(t!==null){var n=fn();ls(t,r,e,n)}xE(r,e)}};wM=function(){return Et};vM=function(r,e){var t=Et;try{return Et=r,e()}finally{Et=t}};m5=function(r,e,t){switch(e){case"input":if(u5(r,t),e=t.name,t.type==="radio"&&e!=null){for(t=r;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==r&&n.form===r.form){var i=A3(n);if(!i)throw Error(se(90));YO(n),u5(n,i)}}}break;case"textarea":JO(r,t);break;case"select":e=t.value,e!=null&&ad(r,!!t.multiple,e,!1)}};sM=wE;oM=Kl;var FG={usingClientEntryPoint:!1,Events:[Pp,Qu,A3,nM,iM,wE]},of={findFiberByHostInstance:pl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},zG={bundleType:of.bundleType,version:of.version,rendererPackageName:of.rendererPackageName,rendererConfig:of.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Yo.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=lM(r),r===null?null:r.stateNode},findFiberByHostInstance:of.findFiberByHostInstance||BG,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var M0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!M0.isDisabled&&M0.supportsFiber)try{b3=M0.inject(zG),Us=M0}catch{}}oi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=FG;oi.createPortal=function(r,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!IE(e))throw Error(se(200));return LG(r,e,null,t)};oi.createRoot=function(r,e){if(!IE(r))throw Error(se(299));var t=!1,n="",i=zR;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=SE(r,1,!1,null,null,t,!1,n,i),r[Bo]=e.current,P1(r.nodeType===8?r.parentNode:r),new AE(e)};oi.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var e=r._reactInternals;if(e===void 0)throw typeof r.render=="function"?Error(se(188)):(r=Object.keys(r).join(","),Error(se(268,r)));return r=lM(e),r=r===null?null:r.stateNode,r};oi.flushSync=function(r){return Kl(r)};oi.hydrate=function(r,e,t){if(!N3(e))throw Error(se(200));return O3(null,r,e,!0,t)};oi.hydrateRoot=function(r,e,t){if(!IE(r))throw Error(se(405));var n=t!=null&&t.hydratedSources||null,i=!1,s="",o=zR;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=FR(e,null,r,1,t??null,i,!1,s,o),r[Bo]=e.current,P1(r),n)for(r=0;r<n.length;r++)t=n[r],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new $3(e)};oi.render=function(r,e,t){if(!N3(e))throw Error(se(200));return O3(null,r,e,!1,t)};oi.unmountComponentAtNode=function(r){if(!N3(r))throw Error(se(40));return r._reactRootContainer?(Kl(function(){O3(null,null,r,!1,function(){r._reactRootContainer=null,r[Bo]=null})}),!0):!1};oi.unstable_batchedUpdates=wE;oi.unstable_renderSubtreeIntoContainer=function(r,e,t,n){if(!N3(t))throw Error(se(200));if(r==null||r._reactInternals===void 0)throw Error(se(38));return O3(r,e,t,!1,n)};oi.version="18.3.1-next-f1338f8080-20240426";function VR(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(VR)}catch(r){console.error(r)}}VR(),VO.exports=oi;var VG=VO.exports,XI=VG;n5.createRoot=XI.createRoot,n5.hydrateRoot=XI.hydrateRoot;var CE={exports:{}},fd=typeof Reflect=="object"?Reflect:null,JI=fd&&typeof fd.apply=="function"?fd.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},zg;fd&&typeof fd.ownKeys=="function"?zg=fd.ownKeys:Object.getOwnPropertySymbols?zg=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:zg=function(e){return Object.getOwnPropertyNames(e)};function KG(r){console&&console.warn&&console.warn(r)}var KR=Number.isNaN||function(e){return e!==e};function Ct(){Ct.init.call(this)}CE.exports=Ct;CE.exports.once=WG;Ct.EventEmitter=Ct;Ct.prototype._events=void 0;Ct.prototype._eventsCount=0;Ct.prototype._maxListeners=void 0;var ZI=10;function M3(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(Ct,"defaultMaxListeners",{enumerable:!0,get:function(){return ZI},set:function(r){if(typeof r!="number"||r<0||KR(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");ZI=r}});Ct.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ct.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||KR(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function HR(r){return r._maxListeners===void 0?Ct.defaultMaxListeners:r._maxListeners}Ct.prototype.getMaxListeners=function(){return HR(this)};Ct.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")JI(c,this,t);else for(var l=c.length,d=QR(c,l),n=0;n<l;++n)JI(d[n],this,t);return!0};function jR(r,e,t,n){var i,s,o;if(M3(t),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),s=r._events),o=s[e]),o===void 0)o=s[e]=t,++r._eventsCount;else if(typeof o=="function"?o=s[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),i=HR(r),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=o.length,KG(a)}return r}Ct.prototype.addListener=function(e,t){return jR(this,e,t,!1)};Ct.prototype.on=Ct.prototype.addListener;Ct.prototype.prependListener=function(e,t){return jR(this,e,t,!0)};function HG(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function qR(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=HG.bind(n);return i.listener=t,n.wrapFn=i,i}Ct.prototype.once=function(e,t){return M3(t),this.on(e,qR(this,e,t)),this};Ct.prototype.prependOnceListener=function(e,t){return M3(t),this.prependListener(e,qR(this,e,t)),this};Ct.prototype.removeListener=function(e,t){var n,i,s,o,a;if(M3(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():jG(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};Ct.prototype.off=Ct.prototype.removeListener;Ct.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function WR(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?qG(i):QR(i,i.length)}Ct.prototype.listeners=function(e){return WR(this,e,!0)};Ct.prototype.rawListeners=function(e){return WR(this,e,!1)};Ct.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):GR.call(r,e)};Ct.prototype.listenerCount=GR;function GR(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}Ct.prototype.eventNames=function(){return this._eventsCount>0?zg(this._events):[]};function QR(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function jG(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function qG(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function WG(r,e){return new Promise(function(t,n){function i(o){r.removeListener(e,s),n(o)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}YR(r,e,s,{once:!0}),e!=="error"&&GG(r,i,{once:!0})})}function GG(r,e,t){typeof r.on=="function"&&YR(r,"error",e,t)}function YR(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(s){n.once&&r.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var $p=CE.exports,XR={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(c,l,d){this.fn=c,this.context=l,this.once=d||!1}function s(c,l,d,h,p){if(typeof d!="function")throw new TypeError("The listener must be a function");var w=new i(d,h||c,p),f=t?t+l:l;return c._events[f]?c._events[f].fn?c._events[f]=[c._events[f],w]:c._events[f].push(w):(c._events[f]=w,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new n:delete c._events[l]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],d,h;if(this._eventsCount===0)return l;for(h in d=this._events)e.call(d,h)&&l.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},a.prototype.listeners=function(l){var d=t?t+l:l,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var p=0,w=h.length,f=new Array(w);p<w;p++)f[p]=h[p].fn;return f},a.prototype.listenerCount=function(l){var d=t?t+l:l,h=this._events[d];return h?h.fn?1:h.length:0},a.prototype.emit=function(l,d,h,p,w,f){var g=t?t+l:l;if(!this._events[g])return!1;var v=this._events[g],y=arguments.length,m,b;if(v.fn){switch(v.once&&this.removeListener(l,v.fn,void 0,!0),y){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,d),!0;case 3:return v.fn.call(v.context,d,h),!0;case 4:return v.fn.call(v.context,d,h,p),!0;case 5:return v.fn.call(v.context,d,h,p,w),!0;case 6:return v.fn.call(v.context,d,h,p,w,f),!0}for(b=1,m=new Array(y-1);b<y;b++)m[b-1]=arguments[b];v.fn.apply(v.context,m)}else{var S=v.length,I;for(b=0;b<S;b++)switch(v[b].once&&this.removeListener(l,v[b].fn,void 0,!0),y){case 1:v[b].fn.call(v[b].context);break;case 2:v[b].fn.call(v[b].context,d);break;case 3:v[b].fn.call(v[b].context,d,h);break;case 4:v[b].fn.call(v[b].context,d,h,p);break;default:if(!m)for(I=1,m=new Array(y-1);I<y;I++)m[I-1]=arguments[I];v[b].fn.apply(v[b].context,m)}}return!0},a.prototype.on=function(l,d,h){return s(this,l,d,h,!1)},a.prototype.once=function(l,d,h){return s(this,l,d,h,!0)},a.prototype.removeListener=function(l,d,h,p){var w=t?t+l:l;if(!this._events[w])return this;if(!d)return o(this,w),this;var f=this._events[w];if(f.fn)f.fn===d&&(!p||f.once)&&(!h||f.context===h)&&o(this,w);else{for(var g=0,v=[],y=f.length;g<y;g++)(f[g].fn!==d||p&&!f[g].once||h&&f[g].context!==h)&&v.push(f[g]);v.length?this._events[w]=v.length===1?v[0]:v:o(this,w)}return this},a.prototype.removeAllListeners=function(l){var d;return l?(d=t?t+l:l,this._events[d]&&o(this,d)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a})(XR);var QG=XR.exports;const YG=Qs(QG);let JR=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},XG=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const eC=r=>globalThis.DOMException===void 0?new XG(r):new DOMException(r),tC=r=>{const e=r.reason===void 0?eC("This operation was aborted."):r.reason;return e instanceof Error?e:eC(e)};function Np(r,e){const{milliseconds:t,fallback:n,message:i,customTimers:s={setTimeout,clearTimeout}}=e;let o,a;const l=new Promise((d,h)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:w}=e;w.aborted&&h(tC(w)),a=()=>{h(tC(w))},w.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){r.then(d,h);return}const p=new JR;o=s.setTimeout.call(void 0,()=>{if(n){try{d(n())}catch(w){h(w)}return}typeof r.cancel=="function"&&r.cancel(),i===!1?d():i instanceof Error?h(i):(p.message=i??`Promise timed out after ${t} milliseconds`,h(p))},t),(async()=>{try{d(await r)}catch(w){h(w)}})()}).finally(()=>{l.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return l.clear=()=>{s.clearTimeout.call(void 0,o),o=void 0},l}function JG(r,e,t){let n=0,i=r.length;for(;i>0;){const s=Math.trunc(i/2);let o=n+s;t(r[o],e)<=0?(n=++o,i-=s+1):i=s}return n}var vi,rN;let ZG=(rN=class{constructor(){et(this,vi,[])}enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,id:t.id,run:e};if(this.size===0||he(this,vi)[this.size-1].priority>=t.priority){he(this,vi).push(n);return}const i=JG(he(this,vi),n,(s,o)=>o.priority-s.priority);he(this,vi).splice(i,0,n)}setPriority(e,t){const n=he(this,vi).findIndex(s=>s.id===e);if(n===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[i]=he(this,vi).splice(n,1);this.enqueue(i.run,{priority:t,id:e})}dequeue(){const e=he(this,vi).shift();return e==null?void 0:e.run}filter(e){return he(this,vi).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return he(this,vi).length}},vi=new WeakMap,rN);var Ad,Id,ja,bp,Cd,Ep,bi,kd,an,Sp,Ei,_d,xo,xp,y3,dt,ZR,eL,tL,rL,nL,Vg,Y5,X5,Kg,iL,Hg;class vc extends YG{constructor(t){var n,i;super();et(this,dt);et(this,Ad);et(this,Id);et(this,ja,0);et(this,bp);et(this,Cd);et(this,Ep,0);et(this,bi);et(this,kd);et(this,an);et(this,Sp);et(this,Ei,0);et(this,_d);et(this,xo);et(this,xp);et(this,y3,1n);u(this,"timeout");if(t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:ZG,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((n=t.intervalCap)==null?void 0:n.toString())??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((i=t.interval)==null?void 0:i.toString())??""}\` (${typeof t.interval})`);kt(this,Ad,t.carryoverConcurrencyCount),kt(this,Id,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),kt(this,bp,t.intervalCap),kt(this,Cd,t.interval),kt(this,an,new t.queueClass),kt(this,Sp,t.queueClass),this.concurrency=t.concurrency,this.timeout=t.timeout,kt(this,xp,t.throwOnTimeout===!0),kt(this,xo,t.autoStart===!1)}get concurrency(){return he(this,_d)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);kt(this,_d,t),De(this,dt,Kg).call(this)}setPriority(t,n){he(this,an).setPriority(t,n)}async add(t,n={}){return n.id??(n.id=(Es(this,y3)._++).toString()),n={timeout:this.timeout,throwOnTimeout:he(this,xp),...n},new Promise((i,s)=>{he(this,an).enqueue(async()=>{var o;Es(this,Ei)._++,Es(this,ja)._++;try{(o=n.signal)==null||o.throwIfAborted();let a=t({signal:n.signal});n.timeout&&(a=Np(Promise.resolve(a),{milliseconds:n.timeout})),n.signal&&(a=Promise.race([a,De(this,dt,iL).call(this,n.signal)]));const c=await a;i(c),this.emit("completed",c)}catch(a){if(a instanceof JR&&!n.throwOnTimeout){i();return}s(a),this.emit("error",a)}finally{De(this,dt,tL).call(this)}},n),this.emit("add"),De(this,dt,Vg).call(this)})}async addAll(t,n){return Promise.all(t.map(async i=>this.add(i,n)))}start(){return he(this,xo)?(kt(this,xo,!1),De(this,dt,Kg).call(this),this):this}pause(){kt(this,xo,!0)}clear(){kt(this,an,new(he(this,Sp)))}async onEmpty(){he(this,an).size!==0&&await De(this,dt,Hg).call(this,"empty")}async onSizeLessThan(t){he(this,an).size<t||await De(this,dt,Hg).call(this,"next",()=>he(this,an).size<t)}async onIdle(){he(this,Ei)===0&&he(this,an).size===0||await De(this,dt,Hg).call(this,"idle")}get size(){return he(this,an).size}sizeBy(t){return he(this,an).filter(t).length}get pending(){return he(this,Ei)}get isPaused(){return he(this,xo)}}Ad=new WeakMap,Id=new WeakMap,ja=new WeakMap,bp=new WeakMap,Cd=new WeakMap,Ep=new WeakMap,bi=new WeakMap,kd=new WeakMap,an=new WeakMap,Sp=new WeakMap,Ei=new WeakMap,_d=new WeakMap,xo=new WeakMap,xp=new WeakMap,y3=new WeakMap,dt=new WeakSet,ZR=function(){return he(this,Id)||he(this,ja)<he(this,bp)},eL=function(){return he(this,Ei)<he(this,_d)},tL=function(){Es(this,Ei)._--,De(this,dt,Vg).call(this),this.emit("next")},rL=function(){De(this,dt,X5).call(this),De(this,dt,Y5).call(this),kt(this,kd,void 0)},nL=function(){const t=Date.now();if(he(this,bi)===void 0){const n=he(this,Ep)-t;if(n<0)kt(this,ja,he(this,Ad)?he(this,Ei):0);else return he(this,kd)===void 0&&kt(this,kd,setTimeout(()=>{De(this,dt,rL).call(this)},n)),!0}return!1},Vg=function(){if(he(this,an).size===0)return he(this,bi)&&clearInterval(he(this,bi)),kt(this,bi,void 0),this.emit("empty"),he(this,Ei)===0&&this.emit("idle"),!1;if(!he(this,xo)){const t=!he(this,dt,nL);if(he(this,dt,ZR)&&he(this,dt,eL)){const n=he(this,an).dequeue();return n?(this.emit("active"),n(),t&&De(this,dt,Y5).call(this),!0):!1}}return!1},Y5=function(){he(this,Id)||he(this,bi)!==void 0||(kt(this,bi,setInterval(()=>{De(this,dt,X5).call(this)},he(this,Cd))),kt(this,Ep,Date.now()+he(this,Cd)))},X5=function(){he(this,ja)===0&&he(this,Ei)===0&&he(this,bi)&&(clearInterval(he(this,bi)),kt(this,bi,void 0)),kt(this,ja,he(this,Ad)?he(this,Ei):0),De(this,dt,Kg).call(this)},Kg=function(){for(;De(this,dt,Vg).call(this););},iL=async function(t){return new Promise((n,i)=>{t.addEventListener("abort",()=>{i(t.reason)},{once:!0})})},Hg=async function(t,n){return new Promise(i=>{const s=()=>{n&&!n()||(this.off(t,s),i())};this.on(t,s)})};function Ve(){const r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}class rC{constructor(e){u(this,"buffer");u(this,"mask");u(this,"top");u(this,"btm");u(this,"next");if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class g8{constructor(e={}){u(this,"size");u(this,"hwm");u(this,"head");u(this,"tail");this.hwm=e.splitLimit??16,this.head=new rC(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new rC(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let eQ=class extends Error{constructor(t,n){super(t??"The operation was aborted");u(this,"type");u(this,"code");this.type="aborted",this.code=n??"ABORT_ERR"}};function zo(r={}){return tQ(t=>{const n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function tQ(r,e){e=e??{};let t=e.onEnd,n=new g8,i,s,o,a=Ve();const c=async()=>{try{return n.isEmpty()?o?{done:!0}:await new Promise((v,y)=>{s=m=>{s=null,n.push(m);try{v(r(n))}catch(b){y(b)}return i}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=Ve()})}},l=v=>s!=null?s(v):(n.push(v),i),d=v=>(n=new g8,s!=null?s({error:v}):(n.push({error:v}),i)),h=v=>{if(o)return i;if((e==null?void 0:e.objectMode)!==!0&&(v==null?void 0:v.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:v})},p=v=>o?i:(o=!0,v!=null?d(v):l({done:!0})),w=()=>(n=new g8,p(),{done:!0}),f=v=>(p(v),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:c,return:w,throw:f,push:h,end:p,get readableLength(){return n.size},onEmpty:async v=>{const y=v==null?void 0:v.signal;if(y==null||y.throwIfAborted(),n.isEmpty())return;let m,b;y!=null&&(m=new Promise((S,I)=>{b=()=>{I(new eQ)},y.addEventListener("abort",b)}));try{await Promise.race([a.promise,m])}finally{b!=null&&y!=null&&(y==null||y.removeEventListener("abort",b))}}},t==null)return i;const g=i;return i={[Symbol.asyncIterator](){return this},next(){return g.next()},throw(v){return g.throw(v),t!=null&&(t(v),t=void 0),{done:!0}},return(){return g.return(),t!=null&&(t(),t=void 0),{done:!0}},push:h,end(v){return g.end(v),t!=null&&(t(v),t=void 0),i},get readableLength(){return g.readableLength},onEmpty:v=>g.onEmpty(v)},i}let nC=class extends Error{constructor(t,n,i){super(t??"The operation was aborted");u(this,"type");u(this,"code");this.type="aborted",this.name=i??"AbortError",this.code=n??"ABORT_ERR"}};async function dn(r,e,t){if(e==null)return r;if(e.aborted)return r.catch(()=>{}),Promise.reject(new nC(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName));let n;const i=new nC(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName);try{return await Promise.race([r,new Promise((s,o)=>{n=()=>{o(i)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}}let rQ=class{constructor(){u(this,"readNext");u(this,"haveNext");u(this,"ended");u(this,"nextResult");u(this,"error");this.ended=!1,this.readNext=Ve(),this.haveNext=Ve()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Ve(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Ve(),await dn(this.readNext.promise,t==null?void 0:t.signal,t)}};function nQ(){return new rQ}function iQ(r){return r[Symbol.asyncIterator]!=null}async function sQ(r,e){try{await Promise.all(r.map(async t=>{for await(const n of t)await e.push(n)})),await e.end()}catch(t){await e.end(t).catch(()=>{})}}async function*oQ(r){const e=nQ();sQ(r,e).catch(()=>{}),yield*e}function*aQ(r){for(const e of r)yield*e}function lc(...r){const e=[];for(const t of r)iQ(t)||e.push(t);return e.length===r.length?aQ(e):oQ(r)}function gn(r,...e){if(r==null)throw new Error("Empty pipeline");if(y8(r)){const n=r;r=()=>n.source}else if(oL(r)||sL(r)){const n=r;r=()=>n}const t=[r,...e];if(t.length>1&&y8(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)y8(t[n])&&(t[n]=lQ(t[n]));return cQ(...t)}const cQ=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},sL=r=>(r==null?void 0:r[Symbol.asyncIterator])!=null,oL=r=>(r==null?void 0:r[Symbol.iterator])!=null,y8=r=>r==null?!1:r.sink!=null&&r.source!=null,lQ=r=>e=>{const t=r.sink(e);if((t==null?void 0:t.then)!=null){const n=zo({objectMode:!0});t.then(()=>{n.end()},o=>{n.end(o)});let i;const s=r.source;if(sL(s))i=async function*(){yield*s,n.end()};else if(oL(s))i=function*(){yield*s,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return lc(n,i())}return r.source};var uQ=function(){return Date.now()};const R0=uQ;class dQ{constructor(e,t,n){const i=this;this._started=R0(),this._rescheduled=0,this._scheduled=t,this._args=n,this._triggered=!1,this._timerWrapper=()=>{i._rescheduled>0?(i._scheduled=i._rescheduled-(R0()-i._started),i._schedule(i._scheduled)):(i._triggered=!0,e.apply(null,i._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);const t=R0();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=R0(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}}function hQ(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("timeout needed");let r;if(arguments.length>0){r=new Array(arguments.length-2);for(var e=0;e<r.length;e++)r[e]=arguments[e+2]}return new dQ(arguments[0],arguments[1],r)}var fQ=hQ;const{AbortController:pQ}=globalThis,iC=fQ;class kE extends pQ{constructor(e){super(),this._ms=e,this._timer=iC(()=>this.abort(),e),Object.setPrototypeOf(this,kE.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=iC(()=>this.abort(),this._ms)}}var J5={TimeoutController:kE};const uc=(...r)=>r.join("/").replace(new RegExp("((?<=\\/)\\/+)|(^\\.\\/)|((?<=\\/)\\.\\/)","g"),"")||".",gQ=3e4,yQ=async({ipfs:r,log:e,events:t,onSynced:n,start:i,timeout:s})=>{if(!r)throw new Error("An instance of ipfs is required.");if(!e)throw new Error("An instance of log is required.");const o=r.libp2p,a=r.libp2p.services.pubsub,c=e.id,l=uc("/orbitdb/heads/",c),d=new vc({concurrency:1}),h=new Set;t=t||new $p.EventEmitter,s=s||gQ;let p=!1;const w=async A=>{const _=await e.heads();t.emit("join",A,_)},f=A=>async function*(){const _=await e.heads();for await(const{bytes:$}of _)yield $}(),g=A=>async _=>{for await(const $ of _){const z=$.subarray();z&&n&&await n(z)}p&&await w(A)},v=async({connection:A,stream:_})=>{const $=String(A.remotePeer);try{h.add($),await gn(_,g($),f,_)}catch(z){h.delete($),t.emit("error",z)}},y=async A=>{const _=async()=>{const{peerId:$,subscriptions:z}=A.detail,j=String($),K=z.find(Z=>Z.topic===c);if(K)if(K.subscribe){if(h.has(j))return;const Z=new J5.TimeoutController(s),{signal:G}=Z;try{h.add(j);const Q=await o.dialProtocol($,l,{signal:G});await gn(f,Q,g(j))}catch(Q){h.delete(j),Q.name==="UnsupportedProtocolError"||t.emit("error",Q)}finally{Z&&Z.clear()}}else h.delete(j),t.emit("leave",j)};d.add(_)},m=async A=>{const{topic:_,data:$}=A.detail,z=async()=>{try{$&&n&&await n($)}catch(j){t.emit("error",j)}};_===c&&d.add(z)},b=async A=>{h.delete(A.detail.toString())},S=async A=>{p&&await a.publish(c,A.bytes)},I=async()=>{p&&(p=!1,await d.onIdle(),a.removeEventListener("subscription-change",y),a.removeEventListener("message",m),await o.unhandle(l),await a.unsubscribe(c),o.removeEventListener("peer:disconnect",b),h.clear())},T=async()=>{p||(await o.handle(l,v),a.addEventListener("subscription-change",y),a.addEventListener("message",m),await a.subscribe(c),o.addEventListener("peer:disconnect",b),p=!0)};return i!==!1&&await T(),{add:S,stop:I,start:T,events:t,peers:h}};var Z5={exports:{}};typeof Object.create=="function"?Z5.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:Z5.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}};var mQ=Z5.exports,aL=$p,wQ=mQ,vQ=ii;function ii(r){if(!(this instanceof ii))return new ii(r);typeof r=="number"&&(r={max:r}),r||(r={}),aL.EventEmitter.call(this),this.cache={},this.head=this.tail=null,this.length=0,this.max=r.max||1e3,this.maxAge=r.maxAge||0}wQ(ii,aL.EventEmitter);Object.defineProperty(ii.prototype,"keys",{get:function(){return Object.keys(this.cache)}});ii.prototype.clear=function(){this.cache={},this.head=this.tail=null,this.length=0};ii.prototype.remove=function(r){if(typeof r!="string"&&(r=""+r),!!this.cache.hasOwnProperty(r)){var e=this.cache[r];return delete this.cache[r],this._unlink(r,e.prev,e.next),e.value}};ii.prototype._unlink=function(r,e,t){this.length--,this.length===0?this.head=this.tail=null:this.head===r?(this.head=e,this.cache[this.head].next=null):this.tail===r?(this.tail=t,this.cache[this.tail].prev=null):(this.cache[e].next=t,this.cache[t].prev=e)};ii.prototype.peek=function(r){if(this.cache.hasOwnProperty(r)){var e=this.cache[r];if(this._checkAge(r,e))return e.value}};ii.prototype.set=function(r,e){typeof r!="string"&&(r=""+r);var t;if(this.cache.hasOwnProperty(r)){if(t=this.cache[r],t.value=e,this.maxAge&&(t.modified=Date.now()),r===this.head)return e;this._unlink(r,t.prev,t.next)}else t={value:e,modified:0,next:null,prev:null},this.maxAge&&(t.modified=Date.now()),this.cache[r]=t,this.length===this.max&&this.evict();return this.length++,t.next=null,t.prev=this.head,this.head&&(this.cache[this.head].next=r),this.head=r,this.tail||(this.tail=r),e};ii.prototype._checkAge=function(r,e){return this.maxAge&&Date.now()-e.modified>this.maxAge?(this.remove(r),this.emit("evict",{key:r,value:e.value}),!1):!0};ii.prototype.get=function(r){if(typeof r!="string"&&(r=""+r),!!this.cache.hasOwnProperty(r)){var e=this.cache[r];if(this._checkAge(r,e))return this.head!==r&&(r===this.tail?(this.tail=e.next,this.cache[this.tail].prev=null):this.cache[e.prev].next=e.next,this.cache[e.next].prev=e.prev,this.cache[this.head].next=r,e.prev=this.head,e.next=null,this.head=r),e.value}};ii.prototype.evict=function(){if(this.tail){var r=this.tail,e=this.remove(this.tail);this.emit("evict",{key:r,value:e})}};const ev=Qs(vQ),bQ=(r,e)=>{const t=r.time-e.time;return t===0&&r.id!==e.id?r.id<e.id?-1:1:t},EQ=r=>R3(r.id,++r.time),R3=(r,e)=>(e=e||0,{id:r,time:e}),SQ=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},_E=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};function xQ(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var AQ=xQ,IQ=AQ;let CQ=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},kQ=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return cL(this,e)}},_Q=class{constructor(e){this.decoders=e}or(e){return cL(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const cL=(r,e)=>new _Q({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let TQ=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new CQ(e,t,n),this.decoder=new kQ(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const lL=({name:r,prefix:e,encode:t,decode:n})=>new TQ(r,e,t,n),uL=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:i}=IQ(t,e);return lL({prefix:r,name:e,encode:n,decode:s=>_E(i(s))})},PQ=(r,e,t,n)=>{const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},DQ=(r,e,t)=>{const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s},Xo=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>lL({prefix:e,name:r,encode(i){return DQ(i,n,t)},decode(i){return PQ(i,n,t,r)}}),jg=Xo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Xo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Xo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Xo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Xo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Xo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Xo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Xo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Xo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const ln=uL({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});uL({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var $Q=dL,sC=128,NQ=-128,OQ=Math.pow(2,31);function dL(r,e,t){e=e||[],t=t||0;for(var n=t;r>=OQ;)e[t++]=r&255|sC,r/=128;for(;r&NQ;)e[t++]=r&255|sC,r>>>=7;return e[t]=r|0,dL.bytes=t-n+1,e}var MQ=tv,RQ=128,oC=127;function tv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw tv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&oC)<<i:(o&oC)*Math.pow(2,i),i+=7}while(o>=RQ);return tv.bytes=s-n,t}var LQ=Math.pow(2,7),BQ=Math.pow(2,14),UQ=Math.pow(2,21),FQ=Math.pow(2,28),zQ=Math.pow(2,35),VQ=Math.pow(2,42),KQ=Math.pow(2,49),HQ=Math.pow(2,56),jQ=Math.pow(2,63),qQ=function(r){return r<LQ?1:r<BQ?2:r<UQ?3:r<FQ?4:r<zQ?5:r<VQ?6:r<KQ?7:r<HQ?8:r<jQ?9:10},WQ={encode:$Q,decode:MQ,encodingLength:qQ},q2=WQ;const rv=(r,e=0)=>[q2.decode(r,e),q2.decode.bytes],W2=(r,e,t=0)=>(q2.encode(r,e,t),e),G2=r=>q2.encodingLength(r),nv=(r,e)=>{const t=e.byteLength,n=G2(r),i=n+G2(t),s=new Uint8Array(i+t);return W2(r,s,0),W2(t,s,n),s.set(e,i),new TE(r,t,e,s)},GQ=r=>{const e=_E(r),[t,n]=rv(e),[i,s]=rv(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new TE(t,i,o,e)},QQ=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&SQ(r.bytes,t.bytes)}};let TE=class{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}};const aC=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return XQ(t,iv(r),e||ln.encoder);default:return JQ(t,iv(r),e||jg.encoder)}},cC=new WeakMap,iv=r=>{const e=cC.get(r);if(e==null){const t=new Map;return cC.set(r,t),t}return e};let gs=class Br{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==af)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==ZQ)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Br.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=nv(e,t);return Br.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Br.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&QQ(e.multihash,n.multihash)}toString(e){return aC(this,e)}toJSON(){return{"/":aC(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Br)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Br(n,i,s,o||lC(n,i,s.bytes))}else if(t[eY]===!0){const{version:n,multihash:i,code:s}=t,o=GQ(i);return Br.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==af)throw new Error(`Version 0 CID must use dag-pb (code: ${af}) block encoding`);return new Br(e,t,n,n.bytes)}case 1:{const i=lC(e,t,n.bytes);return new Br(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Br.create(0,af,e)}static createV1(e,t){return Br.create(1,e,t)}static decode(e){const[t,n]=Br.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Br.inspectBytes(e),n=t.size-t.multihashSize,i=_E(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new TE(t.multihashCode,t.digestSize,s,i);return[t.version===0?Br.createV0(o):Br.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=rv(e.subarray(t));return t+=p,h};let i=n(),s=af;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=YQ(e,t),s=Br.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return iv(s).set(n,e),s}};const YQ=(r,e)=>{switch(r[0]){case"Q":{const t=e||ln;return[ln.prefix,t.decode(`${ln.prefix}${r}`)]}case ln.prefix:{const t=e||ln;return[ln.prefix,t.decode(r)]}case jg.prefix:{const t=e||jg;return[jg.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},XQ=(r,e,t)=>{const{prefix:n}=t;if(n!==ln.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i},JQ=(r,e,t)=>{const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i},af=112,ZQ=18,lC=(r,e,t)=>{const n=G2(r),i=n+G2(e),s=new Uint8Array(i+t.byteLength);return W2(r,s,0),W2(e,s,n),s.set(t,i),s},eY=Symbol.for("@ipld/js-cid/CID"),tY=({name:r,code:e,encode:t})=>new rY(r,e,t);let rY=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?nv(this.code,t):t.then(n=>nv(this.code,n))}else throw Error("Unknown type, must be binary type")}};function L0({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*nY(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t],s=gs.asCID(n);s?yield[i.join("/"),s]:typeof n=="object"&&(yield*sv(n,i))}else{const t=gs.asCID(e);t?yield[r.join("/"),t]:yield*sv(e,r)}}function*sv(r,e){if(r==null||r instanceof Uint8Array)return;const t=gs.asCID(r);t&&(yield[e.join("/"),t]);for(const[n,i]of Object.entries(r)){const s=[...e,n];yield*nY(s,i)}}function*iY(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t];yield i.join("/"),typeof n=="object"&&!gs.asCID(n)&&(yield*ov(n,i))}else yield*ov(e,r)}function*ov(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const i=[...e,t];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!gs.asCID(n)&&(yield*iY(i,n))}}function sY(r,e){let t=r;for(const[n,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);const s=gs.asCID(t);if(s)return{value:s,remaining:e.slice(n+1).join("/")}}return{value:t}}let hL=class{constructor({cid:e,bytes:t,value:n}){if(!e||!t||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:L0(),bytes:L0(),value:L0(),asBlock:L0()})}links(){return sv(this.value,[])}tree(){return ov(this.value,[])}get(e="/"){return sY(this.value,e.split("/").filter(Boolean))}};async function kh({value:r,codec:e,hasher:t}){if(typeof r>"u")throw new Error('Missing required argument "value"');if(!e||!t)throw new Error("Missing required argument: codec or hasher");const n=e.encode(r),i=await t.digest(n),s=gs.create(1,e.code,i);return new hL({value:r,bytes:n,cid:s})}async function L3({bytes:r,codec:e,hasher:t}){if(!r)throw new Error('Missing required argument "bytes"');if(!e||!t)throw new Error("Missing required argument: codec or hasher");const n=e.decode(r),i=await t.digest(r),s=gs.create(1,e.code,i);return new hL({value:n,bytes:r,cid:s})}const oY=["string","number","bigint","symbol"],aY=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function cY(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";const e=typeof r;if(oY.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(lY(r))return"Buffer";const t=uY(r);return t||"Object"}function lY(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function uY(r){const e=Object.prototype.toString.call(r).slice(8,-1);if(aY.includes(e))return e}class X{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}X.uint=new X(0,"uint",!0);X.negint=new X(1,"negint",!0);X.bytes=new X(2,"bytes",!0);X.string=new X(3,"string",!0);X.array=new X(4,"array",!1);X.map=new X(5,"map",!1);X.tag=new X(6,"tag",!1);X.float=new X(7,"float",!0);X.false=new X(7,"false",!0);X.true=new X(7,"true",!0);X.null=new X(7,"null",!0);X.undefined=new X(7,"undefined",!0);X.break=new X(7,"break",!0);class de{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const _h=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",dY=new TextDecoder,hY=new TextEncoder;function Q2(r){return _h&&globalThis.Buffer.isBuffer(r)}function PE(r){return r instanceof Uint8Array?Q2(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}const fY=_h?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):dC(r,e,t):(r,e,t)=>t-e>64?dY.decode(r.subarray(e,t)):dC(r,e,t),fL=_h?r=>r.length>64?globalThis.Buffer.from(r):uC(r):r=>r.length>64?hY.encode(r):uC(r),no=r=>Uint8Array.from(r),DE=_h?(r,e,t)=>Q2(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),pY=_h?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),PE(globalThis.Buffer.concat(r,e))):(r,e)=>{const t=new Uint8Array(e);let n=0;for(let i of r)n+i.length>t.length&&(i=i.subarray(0,t.length-n)),t.set(i,n),n+=i.length;return t},gY=_h?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function yY(r,e){if(Q2(r)&&Q2(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function uC(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e}function dC(r,e,t){const n=[];for(;e<t;){const i=r[e];let s=null,o=i>239?4:i>223?3:i>191?2:1;if(e+o<=t){let a,c,l,d;switch(o){case 1:i<128&&(s=i);break;case 2:a=r[e+1],(a&192)===128&&(d=(i&31)<<6|a&63,d>127&&(s=d));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(d=(i&15)<<12|(a&63)<<6|c&63,d>2047&&(d<55296||d>57343)&&(s=d));break;case 4:a=r[e+1],c=r[e+2],l=r[e+3],(a&192)===128&&(c&192)===128&&(l&192)===128&&(d=(i&15)<<18|(a&63)<<12|(c&63)<<6|l&63,d>65535&&d<1114112&&(s=d))}}s===null?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|s&1023),n.push(s),e+=o}return pL(n)}const hC=4096;function pL(r){const e=r.length;if(e<=hC)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=hC));return t}const mY=256;class gL{constructor(e=mY){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const i=t.length-(this.maxCursor-this.cursor)-1;t.set(e,i)}else{if(t){const i=t.length-(this.maxCursor-this.cursor)-1;i<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,i),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=gY(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=DE(n,0,this.cursor)}else t=pY(this.chunks,this.cursor);return e&&this.reset(),t}}const $e="CBOR decode error:",_l="CBOR encode error:";function Th(r,e,t){if(r.length-e<t)throw new Error(`${$e} not enough data for type`)}const Ar=[24,256,65536,4294967296,BigInt("18446744073709551616")];function pu(r,e,t){Th(r,e,1);const n=r[e];if(t.strict===!0&&n<Ar[0])throw new Error(`${$e} integer encoded in more bytes than necessary (strict decode)`);return n}function gu(r,e,t){Th(r,e,2);const n=r[e]<<8|r[e+1];if(t.strict===!0&&n<Ar[1])throw new Error(`${$e} integer encoded in more bytes than necessary (strict decode)`);return n}function yu(r,e,t){Th(r,e,4);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<Ar[2])throw new Error(`${$e} integer encoded in more bytes than necessary (strict decode)`);return n}function mu(r,e,t){Th(r,e,8);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],i=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],s=(BigInt(n)<<BigInt(32))+BigInt(i);if(t.strict===!0&&s<Ar[3])throw new Error(`${$e} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(t.allowBigInt===!0)return s;throw new Error(`${$e} integers outside of the safe integer range are not supported`)}function wY(r,e,t,n){return new de(X.uint,pu(r,e+1,n),2)}function vY(r,e,t,n){return new de(X.uint,gu(r,e+1,n),3)}function bY(r,e,t,n){return new de(X.uint,yu(r,e+1,n),5)}function EY(r,e,t,n){return new de(X.uint,mu(r,e+1,n),9)}function wu(r,e){return Fi(r,0,e.value)}function Fi(r,e,t){if(t<Ar[0]){const n=Number(t);r.push([e|n])}else if(t<Ar[1]){const n=Number(t);r.push([e|24,n])}else if(t<Ar[2]){const n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<Ar[3]){const n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{const n=BigInt(t);if(n<Ar[4]){const i=[e|27,0,0,0,0,0,0,0];let s=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=s&255,s=s>>8,i[7]=s&255,s=s>>8,i[6]=s&255,s=s>>8,i[5]=s&255,i[4]=o&255,o=o>>8,i[3]=o&255,o=o>>8,i[2]=o&255,o=o>>8,i[1]=o&255,r.push(i)}else throw new Error(`${$e} encountered BigInt larger than allowable range`)}}wu.encodedSize=function(e){return Fi.encodedSize(e.value)};Fi.encodedSize=function(e){return e<Ar[0]?1:e<Ar[1]?2:e<Ar[2]?3:e<Ar[3]?5:9};wu.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function SY(r,e,t,n){return new de(X.negint,-1-pu(r,e+1,n),2)}function xY(r,e,t,n){return new de(X.negint,-1-gu(r,e+1,n),3)}function AY(r,e,t,n){return new de(X.negint,-1-yu(r,e+1,n),5)}const $E=BigInt(-1),yL=BigInt(1);function IY(r,e,t,n){const i=mu(r,e+1,n);if(typeof i!="bigint"){const s=-1-i;if(s>=Number.MIN_SAFE_INTEGER)return new de(X.negint,s,9)}if(n.allowBigInt!==!0)throw new Error(`${$e} integers outside of the safe integer range are not supported`);return new de(X.negint,$E-BigInt(i),9)}function NE(r,e){const t=e.value,n=typeof t=="bigint"?t*$E-yL:t*-1-1;Fi(r,e.type.majorEncoded,n)}NE.encodedSize=function(e){const t=e.value,n=typeof t=="bigint"?t*$E-yL:t*-1-1;return n<Ar[0]?1:n<Ar[1]?2:n<Ar[2]?3:n<Ar[3]?5:9};NE.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function Op(r,e,t,n){Th(r,e,t+n);const i=DE(r,e+t,e+t+n);return new de(X.bytes,i,t+n)}function CY(r,e,t,n){return Op(r,e,1,t)}function kY(r,e,t,n){return Op(r,e,2,pu(r,e+1,n))}function _Y(r,e,t,n){return Op(r,e,3,gu(r,e+1,n))}function TY(r,e,t,n){return Op(r,e,5,yu(r,e+1,n))}function PY(r,e,t,n){const i=mu(r,e+1,n);if(typeof i=="bigint")throw new Error(`${$e} 64-bit integer bytes lengths not supported`);return Op(r,e,9,i)}function Y2(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===X.string?fL(r.value):r.value),r.encodedBytes}function B3(r,e){const t=Y2(e);Fi(r,e.type.majorEncoded,t.length),r.push(t)}B3.encodedSize=function(e){const t=Y2(e);return Fi.encodedSize(t.length)+t.length};B3.compareTokens=function(e,t){return DY(Y2(e),Y2(t))};function DY(r,e){return r.length<e.length?-1:r.length>e.length?1:yY(r,e)}function Mp(r,e,t,n,i){const s=t+n;Th(r,e,s);const o=new de(X.string,fY(r,e+t,e+s),s);return i.retainStringBytes===!0&&(o.byteValue=DE(r,e+t,e+s)),o}function $Y(r,e,t,n){return Mp(r,e,1,t,n)}function NY(r,e,t,n){return Mp(r,e,2,pu(r,e+1,n),n)}function OY(r,e,t,n){return Mp(r,e,3,gu(r,e+1,n),n)}function MY(r,e,t,n){return Mp(r,e,5,yu(r,e+1,n),n)}function RY(r,e,t,n){const i=mu(r,e+1,n);if(typeof i=="bigint")throw new Error(`${$e} 64-bit integer string lengths not supported`);return Mp(r,e,9,i,n)}const LY=B3;function Ph(r,e,t,n){return new de(X.array,n,t)}function BY(r,e,t,n){return Ph(r,e,1,t)}function UY(r,e,t,n){return Ph(r,e,2,pu(r,e+1,n))}function FY(r,e,t,n){return Ph(r,e,3,gu(r,e+1,n))}function zY(r,e,t,n){return Ph(r,e,5,yu(r,e+1,n))}function VY(r,e,t,n){const i=mu(r,e+1,n);if(typeof i=="bigint")throw new Error(`${$e} 64-bit integer array lengths not supported`);return Ph(r,e,9,i)}function KY(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${$e} indefinite length items not allowed`);return Ph(r,e,1,1/0)}function OE(r,e){Fi(r,X.array.majorEncoded,e.value)}OE.compareTokens=wu.compareTokens;OE.encodedSize=function(e){return Fi.encodedSize(e.value)};function Dh(r,e,t,n){return new de(X.map,n,t)}function HY(r,e,t,n){return Dh(r,e,1,t)}function jY(r,e,t,n){return Dh(r,e,2,pu(r,e+1,n))}function qY(r,e,t,n){return Dh(r,e,3,gu(r,e+1,n))}function WY(r,e,t,n){return Dh(r,e,5,yu(r,e+1,n))}function GY(r,e,t,n){const i=mu(r,e+1,n);if(typeof i=="bigint")throw new Error(`${$e} 64-bit integer map lengths not supported`);return Dh(r,e,9,i)}function QY(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${$e} indefinite length items not allowed`);return Dh(r,e,1,1/0)}function ME(r,e){Fi(r,X.map.majorEncoded,e.value)}ME.compareTokens=wu.compareTokens;ME.encodedSize=function(e){return Fi.encodedSize(e.value)};function YY(r,e,t,n){return new de(X.tag,t,1)}function XY(r,e,t,n){return new de(X.tag,pu(r,e+1,n),2)}function JY(r,e,t,n){return new de(X.tag,gu(r,e+1,n),3)}function ZY(r,e,t,n){return new de(X.tag,yu(r,e+1,n),5)}function eX(r,e,t,n){return new de(X.tag,mu(r,e+1,n),9)}function RE(r,e){Fi(r,X.tag.majorEncoded,e.value)}RE.compareTokens=wu.compareTokens;RE.encodedSize=function(e){return Fi.encodedSize(e.value)};const tX=20,rX=21,nX=22,iX=23;function sX(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${$e} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new de(X.null,null,1):new de(X.undefined,void 0,1)}function oX(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${$e} indefinite length items not allowed`);return new de(X.break,void 0,1)}function LE(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${$e} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${$e} Infinity values are not supported`)}return new de(X.float,r,e)}function aX(r,e,t,n){return LE(UE(r,e+1),3,n)}function cX(r,e,t,n){return LE(FE(r,e+1),5,n)}function lX(r,e,t,n){return LE(bL(r,e+1),9,n)}function BE(r,e,t){const n=e.value;if(n===!1)r.push([X.float.majorEncoded|tX]);else if(n===!0)r.push([X.float.majorEncoded|rX]);else if(n===null)r.push([X.float.majorEncoded|nX]);else if(n===void 0)r.push([X.float.majorEncoded|iX]);else{let i,s=!1;(!t||t.float64!==!0)&&(wL(n),i=UE(Yi,1),n===i||Number.isNaN(n)?(Yi[0]=249,r.push(Yi.slice(0,3)),s=!0):(vL(n),i=FE(Yi,1),n===i&&(Yi[0]=250,r.push(Yi.slice(0,5)),s=!0))),s||(uX(n),i=bL(Yi,1),Yi[0]=251,r.push(Yi.slice(0,9)))}}BE.encodedSize=function(e,t){const n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){wL(n);let i=UE(Yi,1);if(n===i||Number.isNaN(n))return 3;if(vL(n),i=FE(Yi,1),n===i)return 5}return 9};const mL=new ArrayBuffer(9),mi=new DataView(mL,1),Yi=new Uint8Array(mL,0);function wL(r){if(r===1/0)mi.setUint16(0,31744,!1);else if(r===-1/0)mi.setUint16(0,64512,!1);else if(Number.isNaN(r))mi.setUint16(0,32256,!1);else{mi.setFloat32(0,r);const e=mi.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)mi.setUint16(0,31744,!1);else if(t===0)mi.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{const i=t-127;i<-24?mi.setUint16(0,0):i<-14?mi.setUint16(0,(e&2147483648)>>16|1<<24+i,!1):mi.setUint16(0,(e&2147483648)>>16|i+15<<10|n>>13,!1)}}}function UE(r,e){if(r.length-e<2)throw new Error(`${$e} not enough data for float16`);const t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const n=t>>10&31,i=t&1023;let s;return n===0?s=i*2**-24:n!==31?s=(i+1024)*2**(n-25):s=i===0?1/0:NaN,t&32768?-s:s}function vL(r){mi.setFloat32(0,r,!1)}function FE(r,e){if(r.length-e<4)throw new Error(`${$e} not enough data for float32`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function uX(r){mi.setFloat64(0,r,!1)}function bL(r,e){if(r.length-e<8)throw new Error(`${$e} not enough data for float64`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}BE.compareTokens=wu.compareTokens;function ht(r,e,t){throw new Error(`${$e} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function U3(r){return()=>{throw new Error(`${$e} ${r}`)}}const ye=[];for(let r=0;r<=23;r++)ye[r]=ht;ye[24]=wY;ye[25]=vY;ye[26]=bY;ye[27]=EY;ye[28]=ht;ye[29]=ht;ye[30]=ht;ye[31]=ht;for(let r=32;r<=55;r++)ye[r]=ht;ye[56]=SY;ye[57]=xY;ye[58]=AY;ye[59]=IY;ye[60]=ht;ye[61]=ht;ye[62]=ht;ye[63]=ht;for(let r=64;r<=87;r++)ye[r]=CY;ye[88]=kY;ye[89]=_Y;ye[90]=TY;ye[91]=PY;ye[92]=ht;ye[93]=ht;ye[94]=ht;ye[95]=U3("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)ye[r]=$Y;ye[120]=NY;ye[121]=OY;ye[122]=MY;ye[123]=RY;ye[124]=ht;ye[125]=ht;ye[126]=ht;ye[127]=U3("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)ye[r]=BY;ye[152]=UY;ye[153]=FY;ye[154]=zY;ye[155]=VY;ye[156]=ht;ye[157]=ht;ye[158]=ht;ye[159]=KY;for(let r=160;r<=183;r++)ye[r]=HY;ye[184]=jY;ye[185]=qY;ye[186]=WY;ye[187]=GY;ye[188]=ht;ye[189]=ht;ye[190]=ht;ye[191]=QY;for(let r=192;r<=215;r++)ye[r]=YY;ye[216]=XY;ye[217]=JY;ye[218]=ZY;ye[219]=eX;ye[220]=ht;ye[221]=ht;ye[222]=ht;ye[223]=ht;for(let r=224;r<=243;r++)ye[r]=U3("simple values are not supported");ye[244]=ht;ye[245]=ht;ye[246]=ht;ye[247]=sX;ye[248]=U3("simple values are not supported");ye[249]=aX;ye[250]=cX;ye[251]=lX;ye[252]=ht;ye[253]=ht;ye[254]=ht;ye[255]=oX;const Ys=[];for(let r=0;r<24;r++)Ys[r]=new de(X.uint,r,1);for(let r=-1;r>=-24;r--)Ys[31-r]=new de(X.negint,r,1);Ys[64]=new de(X.bytes,new Uint8Array(0),1);Ys[96]=new de(X.string,"",1);Ys[128]=new de(X.array,0,1);Ys[160]=new de(X.map,0,1);Ys[244]=new de(X.false,!1,1);Ys[245]=new de(X.true,!0,1);Ys[246]=new de(X.null,null,1);function dX(r){switch(r.type){case X.false:return no([244]);case X.true:return no([245]);case X.null:return no([246]);case X.bytes:return r.value.length?void 0:no([64]);case X.string:return r.value===""?no([96]):void 0;case X.array:return r.value===0?no([128]):void 0;case X.map:return r.value===0?no([160]):void 0;case X.uint:return r.value<24?no([Number(r.value)]):void 0;case X.negint:if(r.value>=-24)return no([31-Number(r.value)])}}const hX={float64:!1,mapSorter:gX,quickEncodeToken:dX};function fX(){const r=[];return r[X.uint.major]=wu,r[X.negint.major]=NE,r[X.bytes.major]=B3,r[X.string.major]=LY,r[X.array.major]=OE,r[X.map.major]=ME,r[X.tag.major]=RE,r[X.float.major]=BE,r}const EL=fX(),m8=new gL;class X2{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${_l} object contains circular references`);return new X2(t,e)}}const ha={null:new de(X.null,null),undefined:new de(X.undefined,void 0),true:new de(X.true,!0),false:new de(X.false,!1),emptyArray:new de(X.array,0),emptyMap:new de(X.map,0)},bc={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new de(X.float,r):r>=0?new de(X.uint,r):new de(X.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new de(X.uint,r):new de(X.negint,r)},Uint8Array(r,e,t,n){return new de(X.bytes,r)},string(r,e,t,n){return new de(X.string,r)},boolean(r,e,t,n){return r?ha.true:ha.false},null(r,e,t,n){return ha.null},undefined(r,e,t,n){return ha.undefined},ArrayBuffer(r,e,t,n){return new de(X.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new de(X.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[ha.emptyArray,new de(X.break)]:ha.emptyArray;n=X2.createCheck(n,r);const i=[];let s=0;for(const o of r)i[s++]=qg(o,t,n);return t.addBreakTokens?[new de(X.array,r.length),i,new de(X.break)]:[new de(X.array,r.length),i]},Object(r,e,t,n){const i=e!=="Object",s=i?r.keys():Object.keys(r),o=i?r.size:s.length;if(!o)return t.addBreakTokens===!0?[ha.emptyMap,new de(X.break)]:ha.emptyMap;n=X2.createCheck(n,r);const a=[];let c=0;for(const l of s)a[c++]=[qg(l,t,n),qg(i?r.get(l):r[l],t,n)];return pX(a,t),t.addBreakTokens?[new de(X.map,o),a,new de(X.break)]:[new de(X.map,o),a]}};bc.Map=bc.Object;bc.Buffer=bc.Uint8Array;for(const r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))bc[`${r}Array`]=bc.DataView;function qg(r,e={},t){const n=cY(r),i=e&&e.typeEncoders&&e.typeEncoders[n]||bc[n];if(typeof i=="function"){const o=i(r,n,e,t);if(o!=null)return o}const s=bc[n];if(!s)throw new Error(`${_l} unsupported type: ${n}`);return s(r,n,e,t)}function pX(r,e){e.mapSorter&&r.sort(e.mapSorter)}function gX(r,e){const t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);const i=t.type.major,s=EL[i].compareTokens(t,n);return s===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),s}function SL(r,e,t,n){if(Array.isArray(e))for(const i of e)SL(r,i,t,n);else t[e.type.major](r,e,n)}function xL(r,e,t){const n=qg(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){const i=t.quickEncodeToken(n);if(i)return i;const s=e[n.type.major];if(s.encodedSize){const o=s.encodedSize(n,t),a=new gL(o);if(s(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return PE(a.chunks[0])}}return m8.reset(),SL(m8,n,e,t),m8.toBytes(!0)}function Wg(r,e){return e=Object.assign({},hX,e),xL(r,EL,e)}const yX={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class mX{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=Ys[e];if(t===void 0){const n=ye[e];if(!n)throw new Error(`${$e} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const i=e&31;t=n(this.data,this._pos,i,this.options)}return this._pos+=t.encodedLength,t}}const U1=Symbol.for("DONE"),F3=Symbol.for("BREAK");function wX(r,e,t){const n=[];for(let i=0;i<r.value;i++){const s=F1(e,t);if(s===F3){if(r.value===1/0)break;throw new Error(`${$e} got unexpected break to lengthed array`)}if(s===U1)throw new Error(`${$e} found array but not enough entries (got ${i}, expected ${r.value})`);n[i]=s}return n}function vX(r,e,t){const n=t.useMaps===!0,i=n?void 0:{},s=n?new Map:void 0;for(let o=0;o<r.value;o++){const a=F1(e,t);if(a===F3){if(r.value===1/0)break;throw new Error(`${$e} got unexpected break to lengthed map`)}if(a===U1)throw new Error(`${$e} found map but not enough entries (got ${o} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${$e} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&s.has(a)||!n&&a in i))throw new Error(`${$e} found repeat map key "${a}"`);const c=F1(e,t);if(c===U1)throw new Error(`${$e} found map but not enough entries (got ${o} [no value], expected ${r.value})`);n?s.set(a,c):i[a]=c}return n?s:i}function F1(r,e){if(r.done())return U1;const t=r.next();if(t.type===X.break)return F3;if(t.type.terminal)return t.value;if(t.type===X.array)return wX(t,r,e);if(t.type===X.map)return vX(t,r,e);if(t.type===X.tag){if(e.tags&&typeof e.tags[t.value]=="function"){const n=F1(r,e);return e.tags[t.value](n)}throw new Error(`${$e} tag not supported (${t.value})`)}throw new Error("unsupported")}function bX(r,e){if(!(r instanceof Uint8Array))throw new Error(`${$e} data to decode must be a Uint8Array`);e=Object.assign({},yX,e);const t=e.tokenizer||new mX(r,e),n=F1(t,e);if(n===U1)throw new Error(`${$e} did not find any content to decode`);if(n===F3)throw new Error(`${$e} got unexpected break`);return[n,r.subarray(t.pos())]}function Va(r,e){const[t,n]=bX(r,e);if(n.length>0)throw new Error(`${$e} too many terminals, data makes no sense`);return t}function EX(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function zE(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function SX(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var xX=SX,AX=xX;let IX=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},CX=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return AL(this,e)}},kX=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return AL(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function AL(r,e){return new kX({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let _X=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new IX(e,t,n),this.decoder=new CX(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function IL({name:r,prefix:e,encode:t,decode:n}){return new _X(r,e,t,n)}function z3({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=AX(t,r);return IL({prefix:e,name:r,encode:n,decode:s=>zE(i(s))})}function TX(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function PX(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Jo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return IL({prefix:e,name:r,encode(i){return PX(i,n,t)},decode(i){return TX(i,n,t,r)}})}const Gg=Jo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Jo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Jo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Jo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Jo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Jo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Jo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Jo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Jo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const w8=z3({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});z3({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const _a=z3({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});z3({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var DX=CL,fC=128,$X=-128,NX=Math.pow(2,31);function CL(r,e,t){e=e||[],t=t||0;for(var n=t;r>=NX;)e[t++]=r&255|fC,r/=128;for(;r&$X;)e[t++]=r&255|fC,r>>>=7;return e[t]=r|0,CL.bytes=t-n+1,e}var OX=av,MX=128,pC=127;function av(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw av.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&pC)<<i:(o&pC)*Math.pow(2,i),i+=7}while(o>=MX);return av.bytes=s-n,t}var RX=Math.pow(2,7),LX=Math.pow(2,14),BX=Math.pow(2,21),UX=Math.pow(2,28),FX=Math.pow(2,35),zX=Math.pow(2,42),VX=Math.pow(2,49),KX=Math.pow(2,56),HX=Math.pow(2,63),jX=function(r){return r<RX?1:r<LX?2:r<BX?3:r<UX?4:r<FX?5:r<zX?6:r<VX?7:r<KX?8:r<HX?9:10},qX={encode:DX,decode:OX,encodingLength:jX},J2=qX;function cv(r,e=0){return[J2.decode(r,e),J2.decode.bytes]}function Z2(r,e,t=0){return J2.encode(r,e,t),e}function ey(r){return J2.encodingLength(r)}function WX(r,e){const t=e.byteLength,n=ey(r),i=n+ey(t),s=new Uint8Array(i+t);return Z2(r,s,0),Z2(t,s,n),s.set(e,i),new VE(r,t,e,s)}function GX(r){const e=zE(r),[t,n]=cv(e),[i,s]=cv(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new VE(t,i,o,e)}function QX(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&EX(r.bytes,t.bytes)}}let VE=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function gC(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return XX(t,lv(r),e??_a.encoder);default:return JX(t,lv(r),e??Gg.encoder)}}const yC=new WeakMap;function lv(r){const e=yC.get(r);if(e==null){const t=new Map;return yC.set(r,t),t}return e}var nN;let kL=class Ur{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,nN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==cf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==ZX)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Ur.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=WX(e,t);return Ur.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Ur.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&QX(e.multihash,n.multihash)}toString(e){return gC(this,e)}toJSON(){return{"/":gC(this)}}link(){return this}[(nN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Ur)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Ur(n,i,s,o??mC(n,i,s.bytes))}else if(t[eJ]===!0){const{version:n,multihash:i,code:s}=t,o=GX(i);return Ur.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==cf)throw new Error(`Version 0 CID must use dag-pb (code: ${cf}) block encoding`);return new Ur(e,t,n,n.bytes)}case 1:{const i=mC(e,t,n.bytes);return new Ur(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Ur.create(0,cf,e)}static createV1(e,t){return Ur.create(1,e,t)}static decode(e){const[t,n]=Ur.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Ur.inspectBytes(e),n=t.size-t.multihashSize,i=zE(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new VE(t.multihashCode,t.digestSize,s,i);return[t.version===0?Ur.createV0(o):Ur.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=cv(e.subarray(t));return t+=p,h};let i=n(),s=cf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=YX(e,t),s=Ur.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return lv(s).set(n,e),s}};function YX(r,e){switch(r[0]){case"Q":{const t=e??_a;return[_a.prefix,t.decode(`${_a.prefix}${r}`)]}case _a.prefix:{const t=e??_a;return[_a.prefix,t.decode(r)]}case Gg.prefix:{const t=e??Gg;return[Gg.prefix,t.decode(r)]}case w8.prefix:{const t=e??w8;return[w8.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function XX(r,e,t){const{prefix:n}=t;if(n!==_a.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function JX(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const cf=112,ZX=18;function mC(r,e,t){const n=ey(r),i=n+ey(e),s=new Uint8Array(i+t.byteLength);return Z2(r,s,0),Z2(e,s,n),s.set(t,i),s}const eJ=Symbol.for("@ipld/js-cid/CID"),_L=42;function TL(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function tJ(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=kL.asCID(r);if(!e)return null;const t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new de(X.tag,_L),new de(X.bytes,t)]}function rJ(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function nJ(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const uv={float64:!0,typeEncoders:{Object:tJ,undefined:rJ,number:nJ}},iJ={...uv,typeEncoders:{...uv.typeEncoders}};function sJ(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return kL.decode(r.subarray(1))}const ty={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};ty.tags[_L]=sJ;const oJ={...ty,tags:ty.tags.slice()},aJ="dag-cbor",PL=113,cJ=r=>Wg(r,uv),lJ=r=>Va(TL(r),ty),Rp=Object.freeze(Object.defineProperty({__proto__:null,code:PL,decode:lJ,decodeOptions:oJ,encode:cJ,encodeOptions:iJ,name:aJ,toByteView:TL},Symbol.toStringTag,{value:"Module"})),uJ=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),V3=tY({name:"sha2-256",code:18,encode:uJ("SHA-256")}),K3=Rp,H3=V3,DL=ln,dJ=async(r,e,t,n=null,i=[],s=[])=>{if(r==null)throw new Error("Identity is required, cannot create entry");if(e==null)throw new Error("Entry requires an id");if(t==null)throw new Error("Entry requires a payload");if(i==null||!Array.isArray(i))throw new Error("'next' argument is not an array");n=n||R3(r.publicKey);const o={id:e,payload:t,next:i,refs:s,clock:n,v:2},{bytes:a}=await kh({value:o,codec:K3,hasher:H3}),c=await r.sign(r,a);return o.key=r.publicKey,o.identity=r.hash,o.sig=c,NL(o)},hJ=async(r,e)=>{if(!r)throw new Error("Identities is required, cannot verify entry");if(!$L(e))throw new Error("Invalid Log entry");if(!e.key)throw new Error("Entry doesn't have a key");if(!e.sig)throw new Error("Entry doesn't have a signature");const t={id:e.id,payload:e.payload,next:e.next,refs:e.refs,clock:e.clock,v:e.v},{bytes:n}=await kh({value:t,codec:K3,hasher:H3});return r.verify(e.sig,e.key,n)},$L=r=>r&&r.id!==void 0&&r.next!==void 0&&r.payload!==void 0&&r.v!==void 0&&r.clock!==void 0&&r.refs!==void 0,fJ=(r,e)=>r&&e&&r.hash===e.hash,pJ=async r=>{const{cid:e,value:t}=await L3({bytes:r,codec:K3,hasher:H3}),n=e.toString(DL);return{...t,hash:n,bytes:r}},NL=async r=>{const{cid:e,bytes:t}=await kh({value:r,codec:K3,hasher:H3}),n=e.toString(DL),i=R3(r.clock.id,r.clock.time);return{...r,clock:i,hash:n,bytes:t}},wo={create:dJ,verify:hJ,decode:pJ,encode:NL,isEntry:$L,isEqual:fJ},KE=async()=>{let r={};const e=async(c,l)=>{r[c]=l};return{put:e,del:async c=>{delete r[c]},get:async c=>r[c],iterator:async function*(){for await(const[c,l]of Object.entries(r))yield[c,l]},merge:async c=>{if(c)for await(const[l,d]of c.iterator())e(l,d)},clear:async()=>{r={}},close:async()=>{}}},gJ=KE,yJ=async({storage:r,heads:e})=>{r=r||await gJ();const t=async d=>{d=wC(d);for(const h of d)await r.put(h.hash,h.bytes)},n=async d=>{await r.clear(),await t(d)},i=async d=>{const h=await a();if(h.find(w=>wo.isEqual(w,d)))return;const p=wC([...h,d]);return await n(p),p},s=async d=>{const p=(await a()).filter(w=>w.hash!==d);await n(p)},o=async function*(){const d=r.iterator();for await(const[,h]of d)yield await wo.decode(h)},a=async()=>{const d=[];for await(const h of o())d.push(h);return d},c=async()=>{await r.clear()},l=async()=>{await r.close()};return await t(e||[]),{put:t,set:n,add:i,remove:s,iterator:o,all:a,clear:c,close:l}},wC=r=>{r=new Set(r);const e={};for(const n of r)for(const i of n.next)e[i]=n.hash;const t=[];for(const n of r)e[n.hash]||t.push(n);return t};function mJ(r,e){const t=(s,o)=>s,n=(s,o)=>vJ(s,o,t);return((s,o)=>wJ(s,o,n))(r,e)}function wJ(r,e,t){const n=bQ(r.clock,e.clock);return n===0?t(r,e):n}function vJ(r,e,t){return r.clock.id===e.clock.id?t(r,e):r.clock.id<e.clock.id?-1:1}function bJ(r){const e=`Your log's tiebreaker function, ${r.name}, has returned zero and therefore cannot be`;return(n,i)=>{const s=r(n,i);if(s===0)throw Error(e);return s}}const EJ={LastWriteWins:mJ,NoZeroes:bJ},{LastWriteWins:SJ,NoZeroes:xJ}=EJ,AJ=()=>new Date().getTime().toString(),IJ=(r,e)=>Math.max(r,e.clock.time),v8=KE,CJ=async()=>({canAppend:async r=>!0}),kJ=async(r,{logId:e,logHeads:t,access:n,entryStorage:i,headsStorage:s,indexStorage:o,sortFn:a}={})=>{if(r==null)throw new Error("Identity is required");if(t!=null&&!Array.isArray(t))throw new Error("'logHeads' argument must be an array");const c=e||AJ();n=n||await CJ();const l=i||await v8(),d=o||await v8();s=s||await v8();const h=await yJ({storage:s,heads:t});a=xJ(a||SJ);const p=new vc({concurrency:1}),w=new vc({concurrency:1}),f=async()=>{const K=Math.max(0,(await g()).reduce(IJ,0));return R3(r.publicKey,K)},g=async()=>(await h.all()).sort(a).reverse(),v=async()=>{const K=[];for await(const Z of T())K.unshift(Z);return K},y=async K=>{const Z=await l.get(K);if(Z)return await wo.decode(Z)},m=async K=>await d.get(K)!=null,b=async(K,Z={referencesCount:0})=>{const G=async()=>{const Q=await g(),J=Q.map(W=>W.hash),q=await j(Q,Z.referencesCount+Q.length),B=await wo.create(r,c,K,EQ(await f()),J,q);if(!await n.canAppend(B))throw new Error(`Could not append entry:
Key "${r.hash}" is not allowed to write to the log`);return await h.set([B]),await l.put(B.hash,B.bytes),await d.put(B.hash,!0),B};return p.add(G)},S=async K=>{if(!K)throw new Error("Log instance not defined");if(!z(K))throw new Error("Given argument is not an instance of Log");l.merge&&await l.merge(K.storage);const Z=await K.heads();for(const G of Z)await I(G)},I=async K=>{const Z=async()=>{if(await m(K.hash))return!1;const Q=async ee=>{if(ee.id!==c)throw new Error(`Entry's id (${ee.id}) doesn't match the log's id (${c}).`);if(!await n.canAppend(ee))throw new Error(`Could not append entry:
Key "${ee.identity}" is not allowed to write to the log`);if(!await wo.verify(r,ee))throw new Error(`Could not validate signature for entry "${ee.hash}"`)};await Q(K);const J=(await g()).map(ee=>ee.hash),q=new Set([K.hash]),B=new Set([...K.next,...K.refs]),V=new Set,W=async()=>{const ee=Array.from(B.values()).filter(m).map(y),Y=await Promise.all(ee);for(const ce of Y){B.delete(ce.hash),await Q(ce),q.add(ce.hash);for(const pe of[...ce.next,...ce.refs])!await m(pe)&&!q.has(pe)?B.add(pe):J.includes(pe)&&V.add(pe)}B.size>0&&await W()};await W();for(const ee of q.values())await d.put(ee,!0);for(const ee of V.values())await h.remove(ee);return await l.put(K.hash,K.bytes),await h.add(K),!0};return w.add(Z)},T=async function*(K,Z){Z=Z||(()=>!1),K=K||await g();let Q=K.sort(a);const J={};let q=[];const B={},V=ee=>!(J[ee]||B[ee]);let W;for(;Q.length>0;)if(Q=Q.sort(a),W=Q.pop(),W){const{hash:ee,next:Y}=W;if(!J[ee]){if(yield W,await Z(W)===!0)break;J[ee]=!0,B[ee]=!0,q=[...q,...Y].filter(V);const pe=le=>{if(!J[le]&&!B[le])return B[le]=!0,y(le)},ue=await Promise.all(q.map(pe));q=ue.filter(le=>le!=null).reduce((le,Me)=>Array.from(new Set([...le,...Me.next])),[]).filter(V),Q=[...ue,...Q]}}},A=async function*({amount:K=-1,gt:Z,gte:G,lt:Q,lte:J}={}){if(K===0)return;if(typeof J=="string"&&(J=[await y(J)]),typeof Q=="string"){const le=await y(Q);Q=await Promise.all(le.next.map(_e=>y(_e)))}if(Q!=null&&!Array.isArray(Q))throw new Error("lt must be a string or an array of Entries");if(J!=null&&!Array.isArray(J))throw new Error("lte must be a string or an array of Entries");const q=(Q||J||await g()).filter(le=>le!=null),B=Z||G?await y(Z||G):null,V=B||K===-1?-1:K;let W=0;const ee=async le=>(W++,le?!!(W>=V&&V!==-1||B&&wo.isEqual(le,B)):!1),Y=B&&K!==-1&&!Q&&!J,ce=Y?new ev(K+2):null;let pe=0;const ue=T(q,ee);for await(const le of ue){const Me=Q&&wo.isEqual(le,q),_e=Z&&wo.isEqual(le,B);Me||_e||(Y?ce.set(pe++,le.hash):yield le)}if(Y){const le=ce.keys.length,Me=le>K?le-K:0,_e=ce.keys.slice(Me,le);for(const ze of _e){const Qe=ce.get(ze);yield await y(Qe)}}},_=async()=>{await d.clear(),await h.clear(),await l.clear()},$=async()=>{await d.close(),await h.close(),await l.close()},z=K=>K&&K.id!==void 0&&K.clock!==void 0&&K.heads!==void 0&&K.values!==void 0&&K.access!==void 0&&K.identity!==void 0&&K.storage!==void 0,j=async(K,Z=0)=>{let G=[];const Q=async J=>G.length>=Z&&Z!==-1;for await(const{hash:J}of T(K,Q))G.push(J);return G=G.slice(K.length+1,Z),G};return{id:c,clock:f,heads:g,values:v,all:v,get:y,has:m,append:b,join:S,joinEntry:I,traverse:T,iterator:A,clear:_,close:$,access:n,identity:r,storage:l}},Tl=async(r,e)=>({put:async(l,d)=>{await r.put(l,d),await e.put(l,d)},get:async l=>{let d=await r.get(l);return d||(d=await e.get(l),d&&await r.put(l,d)),d},del:async l=>{await r.del(l),await e.del(l)},iterator:async function*({amount:l,reverse:d}={}){const h=[],p={amount:l||-1,reverse:d||!1};for(const w of[r,e])for await(const[f,g]of w.iterator(p))h[f]||(h[f]=!0,yield[f,g])},merge:async l=>{await r.merge(l),await e.merge(l),await l.merge(r),await l.merge(e)},clear:async()=>{await r.clear(),await e.clear()},close:async()=>{await r.close(),await e.close()}});function _J(r){return r[Symbol.asyncIterator]!=null}function Vo(r){if(_J(r))return(async()=>{for await(const e of r);})();for(const e of r);}const vC=3e4,j3=async({ipfs:r,pin:e,timeout:t}={})=>{if(!r)throw new Error("An instance of ipfs is required.");return{put:async(d,h)=>{const p=gs.parse(d,ln),{signal:w}=new J5.TimeoutController(t||vC);await r.blockstore.put(p,h,{signal:w}),e&&!await r.pins.isPinned(p)&&await Vo(r.pins.add(p))},del:async d=>{},get:async d=>{const h=gs.parse(d,ln),{signal:p}=new J5.TimeoutController(t||vC),w=await r.blockstore.get(h,{signal:p});if(w)return w},iterator:async function*(){},merge:async d=>{},clear:async()=>{},close:async()=>{}}};var OL={},Bc={},q3={},ML={};ML.supports=function(...e){const t=e.reduce((n,i)=>Object.assign(n,i),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})};var RL={},Xs=class extends Error{constructor(e,t){super(e||""),typeof t=="object"&&t!==null&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},vu={},Lp={},W3={};W3.byteLength=DJ;W3.toByteArray=NJ;W3.fromByteArray=RJ;var Ls=[],wi=[],TJ=typeof Uint8Array<"u"?Uint8Array:Array,b8="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Cu=0,PJ=b8.length;Cu<PJ;++Cu)Ls[Cu]=b8[Cu],wi[b8.charCodeAt(Cu)]=Cu;wi[45]=62;wi[95]=63;function LL(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function DJ(r){var e=LL(r),t=e[0],n=e[1];return(t+n)*3/4-n}function $J(r,e,t){return(e+t)*3/4-t}function NJ(r){var e,t=LL(r),n=t[0],i=t[1],s=new TJ($J(r,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=wi[r.charCodeAt(c)]<<18|wi[r.charCodeAt(c+1)]<<12|wi[r.charCodeAt(c+2)]<<6|wi[r.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=wi[r.charCodeAt(c)]<<2|wi[r.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=wi[r.charCodeAt(c)]<<10|wi[r.charCodeAt(c+1)]<<4|wi[r.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function OJ(r){return Ls[r>>18&63]+Ls[r>>12&63]+Ls[r>>6&63]+Ls[r&63]}function MJ(r,e,t){for(var n,i=[],s=e;s<t;s+=3)n=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),i.push(OJ(n));return i.join("")}function RJ(r){for(var e,t=r.length,n=t%3,i=[],s=16383,o=0,a=t-n;o<a;o+=s)i.push(MJ(r,o,o+s>a?a:o+s));return n===1?(e=r[t-1],i.push(Ls[e>>2]+Ls[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],i.push(Ls[e>>10]+Ls[e>>4&63]+Ls[e<<2&63]+"=")),i.join("")}var HE={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */HE.read=function(r,e,t,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,l=c>>1,d=-7,h=t?i-1:0,p=t?-1:1,w=r[e+h];for(h+=p,s=w&(1<<-d)-1,w>>=-d,d+=a;d>0;s=s*256+r[e+h],h+=p,d-=8);for(o=s&(1<<-d)-1,s>>=-d,d+=n;d>0;o=o*256+r[e+h],h+=p,d-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(w?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-l}return(w?-1:1)*o*Math.pow(2,s-n)};HE.write=function(r,e,t,n,i,s){var o,a,c,l=s*8-i-1,d=(1<<l)-1,h=d>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=n?0:s-1,f=n?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=d):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?e+=p/c:e+=p*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=d?(a=0,o=d):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;r[t+w]=a&255,w+=f,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;r[t+w]=o&255,w+=f,o/=256,l-=8);r[t+w-f]|=g*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(r){const e=W3,t=HE,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=a,r.SlowBuffer=m,r.INSPECT_MAX_BYTES=50;const i=2147483647;r.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const O=new Uint8Array(1),x={foo:function(){return 42}};return Object.setPrototypeOf(x,Uint8Array.prototype),Object.setPrototypeOf(O,x),O.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(O){if(O>i)throw new RangeError('The value "'+O+'" is invalid for option "size"');const x=new Uint8Array(O);return Object.setPrototypeOf(x,a.prototype),x}function a(O,x,k){if(typeof O=="number"){if(typeof x=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return h(O)}return c(O,x,k)}a.poolSize=8192;function c(O,x,k){if(typeof O=="string")return p(O,x);if(ArrayBuffer.isView(O))return f(O);if(O==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O);if(vt(O,ArrayBuffer)||O&&vt(O.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(vt(O,SharedArrayBuffer)||O&&vt(O.buffer,SharedArrayBuffer)))return g(O,x,k);if(typeof O=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const L=O.valueOf&&O.valueOf();if(L!=null&&L!==O)return a.from(L,x,k);const N=v(O);if(N)return N;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof O[Symbol.toPrimitive]=="function")return a.from(O[Symbol.toPrimitive]("string"),x,k);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O)}a.from=function(O,x,k){return c(O,x,k)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function l(O){if(typeof O!="number")throw new TypeError('"size" argument must be of type number');if(O<0)throw new RangeError('The value "'+O+'" is invalid for option "size"')}function d(O,x,k){return l(O),O<=0?o(O):x!==void 0?typeof k=="string"?o(O).fill(x,k):o(O).fill(x):o(O)}a.alloc=function(O,x,k){return d(O,x,k)};function h(O){return l(O),o(O<0?0:y(O)|0)}a.allocUnsafe=function(O){return h(O)},a.allocUnsafeSlow=function(O){return h(O)};function p(O,x){if((typeof x!="string"||x==="")&&(x="utf8"),!a.isEncoding(x))throw new TypeError("Unknown encoding: "+x);const k=b(O,x)|0;let L=o(k);const N=L.write(O,x);return N!==k&&(L=L.slice(0,N)),L}function w(O){const x=O.length<0?0:y(O.length)|0,k=o(x);for(let L=0;L<x;L+=1)k[L]=O[L]&255;return k}function f(O){if(vt(O,Uint8Array)){const x=new Uint8Array(O);return g(x.buffer,x.byteOffset,x.byteLength)}return w(O)}function g(O,x,k){if(x<0||O.byteLength<x)throw new RangeError('"offset" is outside of buffer bounds');if(O.byteLength<x+(k||0))throw new RangeError('"length" is outside of buffer bounds');let L;return x===void 0&&k===void 0?L=new Uint8Array(O):k===void 0?L=new Uint8Array(O,x):L=new Uint8Array(O,x,k),Object.setPrototypeOf(L,a.prototype),L}function v(O){if(a.isBuffer(O)){const x=y(O.length)|0,k=o(x);return k.length===0||O.copy(k,0,0,x),k}if(O.length!==void 0)return typeof O.length!="number"||ro(O.length)?o(0):w(O);if(O.type==="Buffer"&&Array.isArray(O.data))return w(O.data)}function y(O){if(O>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return O|0}function m(O){return+O!=O&&(O=0),a.alloc(+O)}a.isBuffer=function(x){return x!=null&&x._isBuffer===!0&&x!==a.prototype},a.compare=function(x,k){if(vt(x,Uint8Array)&&(x=a.from(x,x.offset,x.byteLength)),vt(k,Uint8Array)&&(k=a.from(k,k.offset,k.byteLength)),!a.isBuffer(x)||!a.isBuffer(k))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(x===k)return 0;let L=x.length,N=k.length;for(let R=0,F=Math.min(L,N);R<F;++R)if(x[R]!==k[R]){L=x[R],N=k[R];break}return L<N?-1:N<L?1:0},a.isEncoding=function(x){switch(String(x).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(x,k){if(!Array.isArray(x))throw new TypeError('"list" argument must be an Array of Buffers');if(x.length===0)return a.alloc(0);let L;if(k===void 0)for(k=0,L=0;L<x.length;++L)k+=x[L].length;const N=a.allocUnsafe(k);let R=0;for(L=0;L<x.length;++L){let F=x[L];if(vt(F,Uint8Array))R+F.length>N.length?(a.isBuffer(F)||(F=a.from(F)),F.copy(N,R)):Uint8Array.prototype.set.call(N,F,R);else if(a.isBuffer(F))F.copy(N,R);else throw new TypeError('"list" argument must be an Array of Buffers');R+=F.length}return N};function b(O,x){if(a.isBuffer(O))return O.length;if(ArrayBuffer.isView(O)||vt(O,ArrayBuffer))return O.byteLength;if(typeof O!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof O);const k=O.length,L=arguments.length>2&&arguments[2]===!0;if(!L&&k===0)return 0;let N=!1;for(;;)switch(x){case"ascii":case"latin1":case"binary":return k;case"utf8":case"utf-8":return te(O).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k*2;case"hex":return k>>>1;case"base64":return at(O).length;default:if(N)return L?-1:te(O).length;x=(""+x).toLowerCase(),N=!0}}a.byteLength=b;function S(O,x,k){let L=!1;if((x===void 0||x<0)&&(x=0),x>this.length||((k===void 0||k>this.length)&&(k=this.length),k<=0)||(k>>>=0,x>>>=0,k<=x))return"";for(O||(O="utf8");;)switch(O){case"hex":return V(this,x,k);case"utf8":case"utf-8":return G(this,x,k);case"ascii":return q(this,x,k);case"latin1":case"binary":return B(this,x,k);case"base64":return Z(this,x,k);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return W(this,x,k);default:if(L)throw new TypeError("Unknown encoding: "+O);O=(O+"").toLowerCase(),L=!0}}a.prototype._isBuffer=!0;function I(O,x,k){const L=O[x];O[x]=O[k],O[k]=L}a.prototype.swap16=function(){const x=this.length;if(x%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let k=0;k<x;k+=2)I(this,k,k+1);return this},a.prototype.swap32=function(){const x=this.length;if(x%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let k=0;k<x;k+=4)I(this,k,k+3),I(this,k+1,k+2);return this},a.prototype.swap64=function(){const x=this.length;if(x%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let k=0;k<x;k+=8)I(this,k,k+7),I(this,k+1,k+6),I(this,k+2,k+5),I(this,k+3,k+4);return this},a.prototype.toString=function(){const x=this.length;return x===0?"":arguments.length===0?G(this,0,x):S.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(x){if(!a.isBuffer(x))throw new TypeError("Argument must be a Buffer");return this===x?!0:a.compare(this,x)===0},a.prototype.inspect=function(){let x="";const k=r.INSPECT_MAX_BYTES;return x=this.toString("hex",0,k).replace(/(.{2})/g,"$1 ").trim(),this.length>k&&(x+=" ... "),"<Buffer "+x+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(x,k,L,N,R){if(vt(x,Uint8Array)&&(x=a.from(x,x.offset,x.byteLength)),!a.isBuffer(x))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof x);if(k===void 0&&(k=0),L===void 0&&(L=x?x.length:0),N===void 0&&(N=0),R===void 0&&(R=this.length),k<0||L>x.length||N<0||R>this.length)throw new RangeError("out of range index");if(N>=R&&k>=L)return 0;if(N>=R)return-1;if(k>=L)return 1;if(k>>>=0,L>>>=0,N>>>=0,R>>>=0,this===x)return 0;let F=R-N,re=L-k;const we=Math.min(F,re),Ue=this.slice(N,R),je=x.slice(k,L);for(let Ie=0;Ie<we;++Ie)if(Ue[Ie]!==je[Ie]){F=Ue[Ie],re=je[Ie];break}return F<re?-1:re<F?1:0};function T(O,x,k,L,N){if(O.length===0)return-1;if(typeof k=="string"?(L=k,k=0):k>2147483647?k=2147483647:k<-2147483648&&(k=-2147483648),k=+k,ro(k)&&(k=N?0:O.length-1),k<0&&(k=O.length+k),k>=O.length){if(N)return-1;k=O.length-1}else if(k<0)if(N)k=0;else return-1;if(typeof x=="string"&&(x=a.from(x,L)),a.isBuffer(x))return x.length===0?-1:A(O,x,k,L,N);if(typeof x=="number")return x=x&255,typeof Uint8Array.prototype.indexOf=="function"?N?Uint8Array.prototype.indexOf.call(O,x,k):Uint8Array.prototype.lastIndexOf.call(O,x,k):A(O,[x],k,L,N);throw new TypeError("val must be string, number or Buffer")}function A(O,x,k,L,N){let R=1,F=O.length,re=x.length;if(L!==void 0&&(L=String(L).toLowerCase(),L==="ucs2"||L==="ucs-2"||L==="utf16le"||L==="utf-16le")){if(O.length<2||x.length<2)return-1;R=2,F/=2,re/=2,k/=2}function we(je,Ie){return R===1?je[Ie]:je.readUInt16BE(Ie*R)}let Ue;if(N){let je=-1;for(Ue=k;Ue<F;Ue++)if(we(O,Ue)===we(x,je===-1?0:Ue-je)){if(je===-1&&(je=Ue),Ue-je+1===re)return je*R}else je!==-1&&(Ue-=Ue-je),je=-1}else for(k+re>F&&(k=F-re),Ue=k;Ue>=0;Ue--){let je=!0;for(let Ie=0;Ie<re;Ie++)if(we(O,Ue+Ie)!==we(x,Ie)){je=!1;break}if(je)return Ue}return-1}a.prototype.includes=function(x,k,L){return this.indexOf(x,k,L)!==-1},a.prototype.indexOf=function(x,k,L){return T(this,x,k,L,!0)},a.prototype.lastIndexOf=function(x,k,L){return T(this,x,k,L,!1)};function _(O,x,k,L){k=Number(k)||0;const N=O.length-k;L?(L=Number(L),L>N&&(L=N)):L=N;const R=x.length;L>R/2&&(L=R/2);let F;for(F=0;F<L;++F){const re=parseInt(x.substr(F*2,2),16);if(ro(re))return F;O[k+F]=re}return F}function $(O,x,k,L){return ft(te(x,O.length-k),O,k,L)}function z(O,x,k,L){return ft(Te(x),O,k,L)}function j(O,x,k,L){return ft(at(x),O,k,L)}function K(O,x,k,L){return ft(ot(x,O.length-k),O,k,L)}a.prototype.write=function(x,k,L,N){if(k===void 0)N="utf8",L=this.length,k=0;else if(L===void 0&&typeof k=="string")N=k,L=this.length,k=0;else if(isFinite(k))k=k>>>0,isFinite(L)?(L=L>>>0,N===void 0&&(N="utf8")):(N=L,L=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const R=this.length-k;if((L===void 0||L>R)&&(L=R),x.length>0&&(L<0||k<0)||k>this.length)throw new RangeError("Attempt to write outside buffer bounds");N||(N="utf8");let F=!1;for(;;)switch(N){case"hex":return _(this,x,k,L);case"utf8":case"utf-8":return $(this,x,k,L);case"ascii":case"latin1":case"binary":return z(this,x,k,L);case"base64":return j(this,x,k,L);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return K(this,x,k,L);default:if(F)throw new TypeError("Unknown encoding: "+N);N=(""+N).toLowerCase(),F=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Z(O,x,k){return x===0&&k===O.length?e.fromByteArray(O):e.fromByteArray(O.slice(x,k))}function G(O,x,k){k=Math.min(O.length,k);const L=[];let N=x;for(;N<k;){const R=O[N];let F=null,re=R>239?4:R>223?3:R>191?2:1;if(N+re<=k){let we,Ue,je,Ie;switch(re){case 1:R<128&&(F=R);break;case 2:we=O[N+1],(we&192)===128&&(Ie=(R&31)<<6|we&63,Ie>127&&(F=Ie));break;case 3:we=O[N+1],Ue=O[N+2],(we&192)===128&&(Ue&192)===128&&(Ie=(R&15)<<12|(we&63)<<6|Ue&63,Ie>2047&&(Ie<55296||Ie>57343)&&(F=Ie));break;case 4:we=O[N+1],Ue=O[N+2],je=O[N+3],(we&192)===128&&(Ue&192)===128&&(je&192)===128&&(Ie=(R&15)<<18|(we&63)<<12|(Ue&63)<<6|je&63,Ie>65535&&Ie<1114112&&(F=Ie))}}F===null?(F=65533,re=1):F>65535&&(F-=65536,L.push(F>>>10&1023|55296),F=56320|F&1023),L.push(F),N+=re}return J(L)}const Q=4096;function J(O){const x=O.length;if(x<=Q)return String.fromCharCode.apply(String,O);let k="",L=0;for(;L<x;)k+=String.fromCharCode.apply(String,O.slice(L,L+=Q));return k}function q(O,x,k){let L="";k=Math.min(O.length,k);for(let N=x;N<k;++N)L+=String.fromCharCode(O[N]&127);return L}function B(O,x,k){let L="";k=Math.min(O.length,k);for(let N=x;N<k;++N)L+=String.fromCharCode(O[N]);return L}function V(O,x,k){const L=O.length;(!x||x<0)&&(x=0),(!k||k<0||k>L)&&(k=L);let N="";for(let R=x;R<k;++R)N+=Xh[O[R]];return N}function W(O,x,k){const L=O.slice(x,k);let N="";for(let R=0;R<L.length-1;R+=2)N+=String.fromCharCode(L[R]+L[R+1]*256);return N}a.prototype.slice=function(x,k){const L=this.length;x=~~x,k=k===void 0?L:~~k,x<0?(x+=L,x<0&&(x=0)):x>L&&(x=L),k<0?(k+=L,k<0&&(k=0)):k>L&&(k=L),k<x&&(k=x);const N=this.subarray(x,k);return Object.setPrototypeOf(N,a.prototype),N};function ee(O,x,k){if(O%1!==0||O<0)throw new RangeError("offset is not uint");if(O+x>k)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(x,k,L){x=x>>>0,k=k>>>0,L||ee(x,k,this.length);let N=this[x],R=1,F=0;for(;++F<k&&(R*=256);)N+=this[x+F]*R;return N},a.prototype.readUintBE=a.prototype.readUIntBE=function(x,k,L){x=x>>>0,k=k>>>0,L||ee(x,k,this.length);let N=this[x+--k],R=1;for(;k>0&&(R*=256);)N+=this[x+--k]*R;return N},a.prototype.readUint8=a.prototype.readUInt8=function(x,k){return x=x>>>0,k||ee(x,1,this.length),this[x]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(x,k){return x=x>>>0,k||ee(x,2,this.length),this[x]|this[x+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(x,k){return x=x>>>0,k||ee(x,2,this.length),this[x]<<8|this[x+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(x,k){return x=x>>>0,k||ee(x,4,this.length),(this[x]|this[x+1]<<8|this[x+2]<<16)+this[x+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(x,k){return x=x>>>0,k||ee(x,4,this.length),this[x]*16777216+(this[x+1]<<16|this[x+2]<<8|this[x+3])},a.prototype.readBigUInt64LE=bs(function(x){x=x>>>0,P(x,"offset");const k=this[x],L=this[x+7];(k===void 0||L===void 0)&&E(x,this.length-8);const N=k+this[++x]*2**8+this[++x]*2**16+this[++x]*2**24,R=this[++x]+this[++x]*2**8+this[++x]*2**16+L*2**24;return BigInt(N)+(BigInt(R)<<BigInt(32))}),a.prototype.readBigUInt64BE=bs(function(x){x=x>>>0,P(x,"offset");const k=this[x],L=this[x+7];(k===void 0||L===void 0)&&E(x,this.length-8);const N=k*2**24+this[++x]*2**16+this[++x]*2**8+this[++x],R=this[++x]*2**24+this[++x]*2**16+this[++x]*2**8+L;return(BigInt(N)<<BigInt(32))+BigInt(R)}),a.prototype.readIntLE=function(x,k,L){x=x>>>0,k=k>>>0,L||ee(x,k,this.length);let N=this[x],R=1,F=0;for(;++F<k&&(R*=256);)N+=this[x+F]*R;return R*=128,N>=R&&(N-=Math.pow(2,8*k)),N},a.prototype.readIntBE=function(x,k,L){x=x>>>0,k=k>>>0,L||ee(x,k,this.length);let N=k,R=1,F=this[x+--N];for(;N>0&&(R*=256);)F+=this[x+--N]*R;return R*=128,F>=R&&(F-=Math.pow(2,8*k)),F},a.prototype.readInt8=function(x,k){return x=x>>>0,k||ee(x,1,this.length),this[x]&128?(255-this[x]+1)*-1:this[x]},a.prototype.readInt16LE=function(x,k){x=x>>>0,k||ee(x,2,this.length);const L=this[x]|this[x+1]<<8;return L&32768?L|4294901760:L},a.prototype.readInt16BE=function(x,k){x=x>>>0,k||ee(x,2,this.length);const L=this[x+1]|this[x]<<8;return L&32768?L|4294901760:L},a.prototype.readInt32LE=function(x,k){return x=x>>>0,k||ee(x,4,this.length),this[x]|this[x+1]<<8|this[x+2]<<16|this[x+3]<<24},a.prototype.readInt32BE=function(x,k){return x=x>>>0,k||ee(x,4,this.length),this[x]<<24|this[x+1]<<16|this[x+2]<<8|this[x+3]},a.prototype.readBigInt64LE=bs(function(x){x=x>>>0,P(x,"offset");const k=this[x],L=this[x+7];(k===void 0||L===void 0)&&E(x,this.length-8);const N=this[x+4]+this[x+5]*2**8+this[x+6]*2**16+(L<<24);return(BigInt(N)<<BigInt(32))+BigInt(k+this[++x]*2**8+this[++x]*2**16+this[++x]*2**24)}),a.prototype.readBigInt64BE=bs(function(x){x=x>>>0,P(x,"offset");const k=this[x],L=this[x+7];(k===void 0||L===void 0)&&E(x,this.length-8);const N=(k<<24)+this[++x]*2**16+this[++x]*2**8+this[++x];return(BigInt(N)<<BigInt(32))+BigInt(this[++x]*2**24+this[++x]*2**16+this[++x]*2**8+L)}),a.prototype.readFloatLE=function(x,k){return x=x>>>0,k||ee(x,4,this.length),t.read(this,x,!0,23,4)},a.prototype.readFloatBE=function(x,k){return x=x>>>0,k||ee(x,4,this.length),t.read(this,x,!1,23,4)},a.prototype.readDoubleLE=function(x,k){return x=x>>>0,k||ee(x,8,this.length),t.read(this,x,!0,52,8)},a.prototype.readDoubleBE=function(x,k){return x=x>>>0,k||ee(x,8,this.length),t.read(this,x,!1,52,8)};function Y(O,x,k,L,N,R){if(!a.isBuffer(O))throw new TypeError('"buffer" argument must be a Buffer instance');if(x>N||x<R)throw new RangeError('"value" argument is out of bounds');if(k+L>O.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(x,k,L,N){if(x=+x,k=k>>>0,L=L>>>0,!N){const re=Math.pow(2,8*L)-1;Y(this,x,k,L,re,0)}let R=1,F=0;for(this[k]=x&255;++F<L&&(R*=256);)this[k+F]=x/R&255;return k+L},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(x,k,L,N){if(x=+x,k=k>>>0,L=L>>>0,!N){const re=Math.pow(2,8*L)-1;Y(this,x,k,L,re,0)}let R=L-1,F=1;for(this[k+R]=x&255;--R>=0&&(F*=256);)this[k+R]=x/F&255;return k+L},a.prototype.writeUint8=a.prototype.writeUInt8=function(x,k,L){return x=+x,k=k>>>0,L||Y(this,x,k,1,255,0),this[k]=x&255,k+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(x,k,L){return x=+x,k=k>>>0,L||Y(this,x,k,2,65535,0),this[k]=x&255,this[k+1]=x>>>8,k+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(x,k,L){return x=+x,k=k>>>0,L||Y(this,x,k,2,65535,0),this[k]=x>>>8,this[k+1]=x&255,k+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(x,k,L){return x=+x,k=k>>>0,L||Y(this,x,k,4,4294967295,0),this[k+3]=x>>>24,this[k+2]=x>>>16,this[k+1]=x>>>8,this[k]=x&255,k+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(x,k,L){return x=+x,k=k>>>0,L||Y(this,x,k,4,4294967295,0),this[k]=x>>>24,this[k+1]=x>>>16,this[k+2]=x>>>8,this[k+3]=x&255,k+4};function ce(O,x,k,L,N){wt(x,L,N,O,k,7);let R=Number(x&BigInt(4294967295));O[k++]=R,R=R>>8,O[k++]=R,R=R>>8,O[k++]=R,R=R>>8,O[k++]=R;let F=Number(x>>BigInt(32)&BigInt(4294967295));return O[k++]=F,F=F>>8,O[k++]=F,F=F>>8,O[k++]=F,F=F>>8,O[k++]=F,k}function pe(O,x,k,L,N){wt(x,L,N,O,k,7);let R=Number(x&BigInt(4294967295));O[k+7]=R,R=R>>8,O[k+6]=R,R=R>>8,O[k+5]=R,R=R>>8,O[k+4]=R;let F=Number(x>>BigInt(32)&BigInt(4294967295));return O[k+3]=F,F=F>>8,O[k+2]=F,F=F>>8,O[k+1]=F,F=F>>8,O[k]=F,k+8}a.prototype.writeBigUInt64LE=bs(function(x,k=0){return ce(this,x,k,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=bs(function(x,k=0){return pe(this,x,k,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(x,k,L,N){if(x=+x,k=k>>>0,!N){const we=Math.pow(2,8*L-1);Y(this,x,k,L,we-1,-we)}let R=0,F=1,re=0;for(this[k]=x&255;++R<L&&(F*=256);)x<0&&re===0&&this[k+R-1]!==0&&(re=1),this[k+R]=(x/F>>0)-re&255;return k+L},a.prototype.writeIntBE=function(x,k,L,N){if(x=+x,k=k>>>0,!N){const we=Math.pow(2,8*L-1);Y(this,x,k,L,we-1,-we)}let R=L-1,F=1,re=0;for(this[k+R]=x&255;--R>=0&&(F*=256);)x<0&&re===0&&this[k+R+1]!==0&&(re=1),this[k+R]=(x/F>>0)-re&255;return k+L},a.prototype.writeInt8=function(x,k,L){return x=+x,k=k>>>0,L||Y(this,x,k,1,127,-128),x<0&&(x=255+x+1),this[k]=x&255,k+1},a.prototype.writeInt16LE=function(x,k,L){return x=+x,k=k>>>0,L||Y(this,x,k,2,32767,-32768),this[k]=x&255,this[k+1]=x>>>8,k+2},a.prototype.writeInt16BE=function(x,k,L){return x=+x,k=k>>>0,L||Y(this,x,k,2,32767,-32768),this[k]=x>>>8,this[k+1]=x&255,k+2},a.prototype.writeInt32LE=function(x,k,L){return x=+x,k=k>>>0,L||Y(this,x,k,4,2147483647,-2147483648),this[k]=x&255,this[k+1]=x>>>8,this[k+2]=x>>>16,this[k+3]=x>>>24,k+4},a.prototype.writeInt32BE=function(x,k,L){return x=+x,k=k>>>0,L||Y(this,x,k,4,2147483647,-2147483648),x<0&&(x=4294967295+x+1),this[k]=x>>>24,this[k+1]=x>>>16,this[k+2]=x>>>8,this[k+3]=x&255,k+4},a.prototype.writeBigInt64LE=bs(function(x,k=0){return ce(this,x,k,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=bs(function(x,k=0){return pe(this,x,k,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ue(O,x,k,L,N,R){if(k+L>O.length)throw new RangeError("Index out of range");if(k<0)throw new RangeError("Index out of range")}function le(O,x,k,L,N){return x=+x,k=k>>>0,N||ue(O,x,k,4),t.write(O,x,k,L,23,4),k+4}a.prototype.writeFloatLE=function(x,k,L){return le(this,x,k,!0,L)},a.prototype.writeFloatBE=function(x,k,L){return le(this,x,k,!1,L)};function Me(O,x,k,L,N){return x=+x,k=k>>>0,N||ue(O,x,k,8),t.write(O,x,k,L,52,8),k+8}a.prototype.writeDoubleLE=function(x,k,L){return Me(this,x,k,!0,L)},a.prototype.writeDoubleBE=function(x,k,L){return Me(this,x,k,!1,L)},a.prototype.copy=function(x,k,L,N){if(!a.isBuffer(x))throw new TypeError("argument should be a Buffer");if(L||(L=0),!N&&N!==0&&(N=this.length),k>=x.length&&(k=x.length),k||(k=0),N>0&&N<L&&(N=L),N===L||x.length===0||this.length===0)return 0;if(k<0)throw new RangeError("targetStart out of bounds");if(L<0||L>=this.length)throw new RangeError("Index out of range");if(N<0)throw new RangeError("sourceEnd out of bounds");N>this.length&&(N=this.length),x.length-k<N-L&&(N=x.length-k+L);const R=N-L;return this===x&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(k,L,N):Uint8Array.prototype.set.call(x,this.subarray(L,N),k),R},a.prototype.fill=function(x,k,L,N){if(typeof x=="string"){if(typeof k=="string"?(N=k,k=0,L=this.length):typeof L=="string"&&(N=L,L=this.length),N!==void 0&&typeof N!="string")throw new TypeError("encoding must be a string");if(typeof N=="string"&&!a.isEncoding(N))throw new TypeError("Unknown encoding: "+N);if(x.length===1){const F=x.charCodeAt(0);(N==="utf8"&&F<128||N==="latin1")&&(x=F)}}else typeof x=="number"?x=x&255:typeof x=="boolean"&&(x=Number(x));if(k<0||this.length<k||this.length<L)throw new RangeError("Out of range index");if(L<=k)return this;k=k>>>0,L=L===void 0?this.length:L>>>0,x||(x=0);let R;if(typeof x=="number")for(R=k;R<L;++R)this[R]=x;else{const F=a.isBuffer(x)?x:a.from(x,N),re=F.length;if(re===0)throw new TypeError('The value "'+x+'" is invalid for argument "value"');for(R=0;R<L-k;++R)this[R+k]=F[R%re]}return this};const _e={};function ze(O,x,k){_e[O]=class extends k{constructor(){super(),Object.defineProperty(this,"message",{value:x.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${O}]`,this.stack,delete this.name}get code(){return O}set code(N){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:N,writable:!0})}toString(){return`${this.name} [${O}]: ${this.message}`}}}ze("ERR_BUFFER_OUT_OF_BOUNDS",function(O){return O?`${O} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ze("ERR_INVALID_ARG_TYPE",function(O,x){return`The "${O}" argument must be of type number. Received type ${typeof x}`},TypeError),ze("ERR_OUT_OF_RANGE",function(O,x,k){let L=`The value of "${O}" is out of range.`,N=k;return Number.isInteger(k)&&Math.abs(k)>2**32?N=Qe(String(k)):typeof k=="bigint"&&(N=String(k),(k>BigInt(2)**BigInt(32)||k<-(BigInt(2)**BigInt(32)))&&(N=Qe(N)),N+="n"),L+=` It must be ${x}. Received ${N}`,L},RangeError);function Qe(O){let x="",k=O.length;const L=O[0]==="-"?1:0;for(;k>=L+4;k-=3)x=`_${O.slice(k-3,k)}${x}`;return`${O.slice(0,k)}${x}`}function pt(O,x,k){P(x,"offset"),(O[x]===void 0||O[x+k]===void 0)&&E(x,O.length-(k+1))}function wt(O,x,k,L,N,R){if(O>k||O<x){const F=typeof x=="bigint"?"n":"";let re;throw x===0||x===BigInt(0)?re=`>= 0${F} and < 2${F} ** ${(R+1)*8}${F}`:re=`>= -(2${F} ** ${(R+1)*8-1}${F}) and < 2 ** ${(R+1)*8-1}${F}`,new _e.ERR_OUT_OF_RANGE("value",re,O)}pt(L,N,R)}function P(O,x){if(typeof O!="number")throw new _e.ERR_INVALID_ARG_TYPE(x,"number",O)}function E(O,x,k){throw Math.floor(O)!==O?(P(O,k),new _e.ERR_OUT_OF_RANGE("offset","an integer",O)):x<0?new _e.ERR_BUFFER_OUT_OF_BOUNDS:new _e.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${x}`,O)}const C=/[^+/0-9A-Za-z-_]/g;function U(O){if(O=O.split("=")[0],O=O.trim().replace(C,""),O.length<2)return"";for(;O.length%4!==0;)O=O+"=";return O}function te(O,x){x=x||1/0;let k;const L=O.length;let N=null;const R=[];for(let F=0;F<L;++F){if(k=O.charCodeAt(F),k>55295&&k<57344){if(!N){if(k>56319){(x-=3)>-1&&R.push(239,191,189);continue}else if(F+1===L){(x-=3)>-1&&R.push(239,191,189);continue}N=k;continue}if(k<56320){(x-=3)>-1&&R.push(239,191,189),N=k;continue}k=(N-55296<<10|k-56320)+65536}else N&&(x-=3)>-1&&R.push(239,191,189);if(N=null,k<128){if((x-=1)<0)break;R.push(k)}else if(k<2048){if((x-=2)<0)break;R.push(k>>6|192,k&63|128)}else if(k<65536){if((x-=3)<0)break;R.push(k>>12|224,k>>6&63|128,k&63|128)}else if(k<1114112){if((x-=4)<0)break;R.push(k>>18|240,k>>12&63|128,k>>6&63|128,k&63|128)}else throw new Error("Invalid code point")}return R}function Te(O){const x=[];for(let k=0;k<O.length;++k)x.push(O.charCodeAt(k)&255);return x}function ot(O,x){let k,L,N;const R=[];for(let F=0;F<O.length&&!((x-=2)<0);++F)k=O.charCodeAt(F),L=k>>8,N=k%256,R.push(N),R.push(L);return R}function at(O){return e.toByteArray(U(O))}function ft(O,x,k,L){let N;for(N=0;N<L&&!(N+k>=x.length||N>=O.length);++N)x[N+k]=O[N];return N}function vt(O,x){return O instanceof x||O!=null&&O.constructor!=null&&O.constructor.name!=null&&O.constructor.name===x.name}function ro(O){return O!==O}const Xh=function(){const O="0123456789abcdef",x=new Array(256);for(let k=0;k<16;++k){const L=k*16;for(let N=0;N<16;++N)x[L+N]=O[k]+O[N]}return x}();function bs(O){return typeof BigInt>"u"?qc:O}function qc(){throw new Error("BigInt not supported")}})(Lp);let E8=null;var BL=function(){return E8===null&&(E8={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),E8},Bp={},jE={};const S8=Xs,LJ=new Set(["buffer","view","utf8"]);let BJ=class{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!LJ.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new S8(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new S8(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new S8(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};jE.Encoding=BJ;const{Buffer:qE}=Lp||{},{Encoding:WE}=jE,UJ=BL;let GE=class extends WE{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new QE({encode:this.encode,decode:e=>this.decode(qE.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},QE=class extends WE{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new GE({encode:e=>{const t=this.encode(e);return qE.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},FJ=class extends WE{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new GE({encode:e=>qE.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){const{textEncoder:e,textDecoder:t}=UJ();return new QE({encode:n=>e.encode(this.encode(n)),decode:n=>this.decode(t.decode(n)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};Bp.BufferFormat=GE;Bp.ViewFormat=QE;Bp.UTF8Format=FJ;const{Buffer:rn}=Lp||{Buffer:{isBuffer:()=>!1}},{textEncoder:UL,textDecoder:bC}=BL(),{BufferFormat:Up,ViewFormat:YE,UTF8Format:FL}=Bp,ry=r=>r;vu.utf8=new FL({encode:function(r){return rn.isBuffer(r)?r.toString("utf8"):ArrayBuffer.isView(r)?bC.decode(r):String(r)},decode:ry,name:"utf8",createViewTranscoder(){return new YE({encode:function(r){return ArrayBuffer.isView(r)?r:UL.encode(r)},decode:function(r){return bC.decode(r)},name:`${this.name}+view`})},createBufferTranscoder(){return new Up({encode:function(r){return rn.isBuffer(r)?r:ArrayBuffer.isView(r)?rn.from(r.buffer,r.byteOffset,r.byteLength):rn.from(String(r),"utf8")},decode:function(r){return r.toString("utf8")},name:`${this.name}+buffer`})}});vu.json=new FL({encode:JSON.stringify,decode:JSON.parse,name:"json"});vu.buffer=new Up({encode:function(r){return rn.isBuffer(r)?r:ArrayBuffer.isView(r)?rn.from(r.buffer,r.byteOffset,r.byteLength):rn.from(String(r),"utf8")},decode:ry,name:"buffer",createViewTranscoder(){return new YE({encode:function(r){return ArrayBuffer.isView(r)?r:rn.from(String(r),"utf8")},decode:function(r){return rn.from(r.buffer,r.byteOffset,r.byteLength)},name:`${this.name}+view`})}});vu.view=new YE({encode:function(r){return ArrayBuffer.isView(r)?r:UL.encode(r)},decode:ry,name:"view",createBufferTranscoder(){return new Up({encode:function(r){return rn.isBuffer(r)?r:ArrayBuffer.isView(r)?rn.from(r.buffer,r.byteOffset,r.byteLength):rn.from(String(r),"utf8")},decode:ry,name:`${this.name}+buffer`})}});vu.hex=new Up({encode:function(r){return rn.isBuffer(r)?r:rn.from(String(r),"hex")},decode:function(r){return r.toString("hex")},name:"hex"});vu.base64=new Up({encode:function(r){return rn.isBuffer(r)?r:rn.from(String(r),"base64")},decode:function(r){return r.toString("base64")},name:"base64"});const EC=Xs,ny=vu,{Encoding:zJ}=jE,{BufferFormat:VJ,ViewFormat:KJ,UTF8Format:HJ}=Bp,lf=Symbol("formats"),B0=Symbol("encodings"),jJ=new Set(["buffer","view","utf8"]);let qJ=class{constructor(e){if(Array.isArray(e)){if(!e.every(t=>jJ.has(t)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[B0]=new Map,this[lf]=new Set(e);for(const t in ny)try{this.encoding(t)}catch(n){if(n.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw n}}encodings(){return Array.from(new Set(this[B0].values()))}encoding(e){let t=this[B0].get(e);if(t===void 0){if(typeof e=="string"&&e!==""){if(t=YJ[e],!t)throw new EC(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof e!="object"||e===null)throw new TypeError("First argument 'encoding' must be a string or object");t=WJ(e)}const{name:n,format:i}=t;if(!this[lf].has(i))if(this[lf].has("view"))t=t.createViewTranscoder();else if(this[lf].has("buffer"))t=t.createBufferTranscoder();else if(this[lf].has("utf8"))t=t.createUTF8Transcoder();else throw new EC(`Encoding '${n}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(const s of[e,n,t.name,t.commonName])this[B0].set(s,t)}return t}};RL.Transcoder=qJ;function WJ(r){if(r instanceof zJ)return r;const e="type"in r&&typeof r.type=="string"?r.type:void 0,t=r.name||e||`anonymous-${XJ++}`;switch(GJ(r)){case"view":return new KJ({...r,name:t});case"utf8":return new HJ({...r,name:t});case"buffer":return new VJ({...r,name:t});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function GJ(r){return"format"in r&&r.format!==void 0?r.format:"buffer"in r&&typeof r.buffer=="boolean"?r.buffer?"buffer":"utf8":"code"in r&&Number.isInteger(r.code)?"view":"buffer"}const QJ={binary:ny.buffer,"utf-8":ny.utf8},YJ={...ny,...QJ};let XJ=0;var $h={},JJ=typeof queueMicrotask=="function"?queueMicrotask:r=>Promise.resolve().then(r),SC=JJ;$h.fromCallback=function(r,e){if(r===void 0){var t=new Promise(function(n,i){r=function(s,o){s?i(s):n(o)}});r[e!==void 0?e:"promise"]=t}else if(typeof r!="function")throw new TypeError("Callback must be a function");return r};$h.fromPromise=function(r,e){if(e===void 0)return r;r.then(function(t){SC(()=>e(null,t))}).catch(function(t){SC(()=>e(t))})};var Js={},Fp={};Fp.getCallback=function(r,e){return typeof r=="function"?r:e};Fp.getOptions=function(r,e){return typeof r=="object"&&r!==null?r:e!==void 0?e:{}};const{fromCallback:x8}=$h,Wn=Xs,{getOptions:A8,getCallback:xC}=Fp,Wc=Symbol("promise"),ku=Symbol("callback"),xs=Symbol("working"),ml=Symbol("handleOne"),vo=Symbol("handleMany"),I8=Symbol("autoClose"),Ec=Symbol("finishWork"),zs=Symbol("returnMany"),fa=Symbol("closing"),uf=Symbol("handleClose"),U0=Symbol("closed"),df=Symbol("closeCallbacks"),dc=Symbol("keyEncoding"),Hl=Symbol("valueEncoding"),C8=Symbol("abortOnClose"),F0=Symbol("legacy"),k8=Symbol("keys"),_8=Symbol("values"),pa=Symbol("limit"),Ii=Symbol("count"),z0=Object.freeze({}),ZJ=()=>{};let AC=!1;class XE{constructor(e,t,n){if(typeof e!="object"||e===null){const i=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${i}`)}if(typeof t!="object"||t===null)throw new TypeError("The second argument must be an options object");this[U0]=!1,this[df]=[],this[xs]=!1,this[fa]=!1,this[I8]=!1,this[ku]=null,this[ml]=this[ml].bind(this),this[vo]=this[vo].bind(this),this[uf]=this[uf].bind(this),this[dc]=t[dc],this[Hl]=t[Hl],this[F0]=n,this[pa]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[Ii]=0,this[C8]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[Ii]}get limit(){return this[pa]}next(e){let t;if(e===void 0)t=new Promise((n,i)=>{e=(s,o,a)=>{s?i(s):this[F0]?o===void 0&&a===void 0?n():n([o,a]):n(o)}});else if(typeof e!="function")throw new TypeError("Callback must be a function");return this[fa]?this.nextTick(e,new Wn("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[xs]?this.nextTick(e,new Wn("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[xs]=!0,this[ku]=e,this[Ii]>=this[pa]?this.nextTick(this[ml],null):this._next(this[ml])),t}_next(e){this.nextTick(e)}nextv(e,t,n){return n=xC(t,n),n=x8(n,Wc),t=A8(t,z0),Number.isInteger(e)?(this[fa]?this.nextTick(n,new Wn("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[xs]?this.nextTick(n,new Wn("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[pa]<1/0&&(e=Math.min(e,this[pa]-this[Ii])),this[xs]=!0,this[ku]=n,e<=0?this.nextTick(this[vo],null,[]):this._nextv(e,t,this[vo])),n[Wc]):(this.nextTick(n,new TypeError("The first argument 'size' must be an integer")),n[Wc])}_nextv(e,t,n){const i=[],s=(o,a,c)=>{if(o)return n(o);if(this[F0]?a===void 0&&c===void 0:a===void 0)return n(null,i);i.push(this[F0]?[a,c]:a),i.length===e?n(null,i):this._next(s)};this._next(s)}all(e,t){return t=xC(e,t),t=x8(t,Wc),e=A8(e,z0),this[fa]?this.nextTick(t,new Wn("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[xs]?this.nextTick(t,new Wn("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[xs]=!0,this[ku]=t,this[I8]=!0,this[Ii]>=this[pa]?this.nextTick(this[vo],null,[]):this._all(e,this[vo])),t[Wc]}_all(e,t){let n=this[Ii];const i=[],s=()=>{const a=this[pa]<1/0?Math.min(1e3,this[pa]-n):1e3;a<=0?this.nextTick(t,null,i):this._nextv(a,z0,o)},o=(a,c)=>{a?t(a):c.length===0?t(null,i):(i.push.apply(i,c),n+=c.length,s())};s()}[Ec](){const e=this[ku];return this[C8]&&e===null?ZJ:(this[xs]=!1,this[ku]=null,this[fa]&&this._close(this[uf]),e)}[zs](e,t,n){this[I8]?this.close(e.bind(null,t,n)):e(t,n)}seek(e,t){if(t=A8(t,z0),!this[fa]){if(this[xs])throw new Wn("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const n=this.db.keyEncoding(t.keyEncoding||this[dc]),i=n.format;t.keyEncoding!==i&&(t={...t,keyEncoding:i});const s=this.db.prefixKey(n.encode(e),i);this._seek(s,t)}}}_seek(e,t){throw new Wn("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){return e=x8(e,Wc),this[U0]?this.nextTick(e):this[fa]?this[df].push(e):(this[fa]=!0,this[df].push(e),this[xs]?this[C8]&&this[Ec]()(new Wn("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[uf])),e[Wc]}_close(e){this.nextTick(e)}[uf](){this[U0]=!0,this.db.detachResource(this);const e=this[df];this[df]=[];for(const t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;(e=await this.next())!==void 0;)yield e}finally{this[U0]||await this.close()}}}let G3=class extends XE{constructor(e,t){super(e,t,!0),this[k8]=t.keys!==!1,this[_8]=t.values!==!1}[ml](e,t,n){const i=this[Ec]();if(e)return i(e);try{t=this[k8]&&t!==void 0?this[dc].decode(t):void 0,n=this[_8]&&n!==void 0?this[Hl].decode(n):void 0}catch(s){return i(new zd("entry",s))}t===void 0&&n===void 0||this[Ii]++,i(null,t,n)}[vo](e,t){const n=this[Ec]();if(e)return this[zs](n,e);try{for(const i of t){const s=i[0],o=i[1];i[0]=this[k8]&&s!==void 0?this[dc].decode(s):void 0,i[1]=this[_8]&&o!==void 0?this[Hl].decode(o):void 0}}catch(i){return this[zs](n,new zd("entries",i))}this[Ii]+=t.length,this[zs](n,null,t)}end(e){return!AC&&typeof console<"u"&&(AC=!0,console.warn(new Wn("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}},eZ=class extends XE{constructor(e,t){super(e,t,!1)}[ml](e,t){const n=this[Ec]();if(e)return n(e);try{t=t!==void 0?this[dc].decode(t):void 0}catch(i){return n(new zd("key",i))}t!==void 0&&this[Ii]++,n(null,t)}[vo](e,t){const n=this[Ec]();if(e)return this[zs](n,e);try{for(let i=0;i<t.length;i++){const s=t[i];t[i]=s!==void 0?this[dc].decode(s):void 0}}catch(i){return this[zs](n,new zd("keys",i))}this[Ii]+=t.length,this[zs](n,null,t)}},tZ=class extends XE{constructor(e,t){super(e,t,!1)}[ml](e,t){const n=this[Ec]();if(e)return n(e);try{t=t!==void 0?this[Hl].decode(t):void 0}catch(i){return n(new zd("value",i))}t!==void 0&&this[Ii]++,n(null,t)}[vo](e,t){const n=this[Ec]();if(e)return this[zs](n,e);try{for(let i=0;i<t.length;i++){const s=t[i];t[i]=s!==void 0?this[Hl].decode(s):void 0}}catch(i){return this[zs](n,new zd("values",i))}this[Ii]+=t.length,this[zs](n,null,t)}};class zd extends Wn{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}}for(const r of["_ended property","_nexting property","_end method"])Object.defineProperty(G3.prototype,r.split(" ")[0],{get(){throw new Wn(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new Wn(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})}});G3.keyEncoding=dc;G3.valueEncoding=Hl;Js.AbstractIterator=G3;Js.AbstractKeyIterator=eZ;Js.AbstractValueIterator=tZ;var JE={};const{AbstractKeyIterator:rZ,AbstractValueIterator:nZ}=Js,al=Symbol("iterator"),hf=Symbol("callback"),Vd=Symbol("handleOne"),Pl=Symbol("handleMany");let dv=class extends rZ{constructor(e,t){super(e,t),this[al]=e.iterator({...t,keys:!0,values:!1}),this[Vd]=this[Vd].bind(this),this[Pl]=this[Pl].bind(this)}},zL=class extends nZ{constructor(e,t){super(e,t),this[al]=e.iterator({...t,keys:!1,values:!0}),this[Vd]=this[Vd].bind(this),this[Pl]=this[Pl].bind(this)}};for(const r of[dv,zL]){const e=r===dv,t=e?n=>n[0]:n=>n[1];r.prototype._next=function(n){this[hf]=n,this[al].next(this[Vd])},r.prototype[Vd]=function(n,i,s){const o=this[hf];n?o(n):o(null,e?i:s)},r.prototype._nextv=function(n,i,s){this[hf]=s,this[al].nextv(n,i,this[Pl])},r.prototype._all=function(n,i){this[hf]=i,this[al].all(n,this[Pl])},r.prototype[Pl]=function(n,i){const s=this[hf];n?s(n):s(null,i.map(t))},r.prototype._seek=function(n,i){this[al].seek(n,i)},r.prototype._close=function(n){this[al].close(n)}}JE.DefaultKeyIterator=dv;JE.DefaultValueIterator=zL;var Q3={};const{AbstractIterator:iZ,AbstractKeyIterator:sZ,AbstractValueIterator:oZ}=Js,T8=Xs,En=Symbol("nut"),Y3=Symbol("undefer"),X3=Symbol("factory");let VL=class extends iZ{constructor(e,t){super(e,t),this[En]=null,this[X3]=()=>e.iterator(t),this.db.defer(()=>this[Y3]())}},KL=class extends sZ{constructor(e,t){super(e,t),this[En]=null,this[X3]=()=>e.keys(t),this.db.defer(()=>this[Y3]())}},HL=class extends oZ{constructor(e,t){super(e,t),this[En]=null,this[X3]=()=>e.values(t),this.db.defer(()=>this[Y3]())}};for(const r of[VL,KL,HL])r.prototype[Y3]=function(){this.db.status==="open"&&(this[En]=this[X3]())},r.prototype._next=function(e){this[En]!==null?this[En].next(e):this.db.status==="opening"?this.db.defer(()=>this._next(e)):this.nextTick(e,new T8("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._nextv=function(e,t,n){this[En]!==null?this[En].nextv(e,t,n):this.db.status==="opening"?this.db.defer(()=>this._nextv(e,t,n)):this.nextTick(n,new T8("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._all=function(e,t){this[En]!==null?this[En].all(t):this.db.status==="opening"?this.db.defer(()=>this._all(e,t)):this.nextTick(t,new T8("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._seek=function(e,t){this[En]!==null?this[En]._seek(e,t):this.db.status==="opening"&&this.db.defer(()=>this._seek(e,t))},r.prototype._close=function(e){this[En]!==null?this[En].close(e):this.db.status==="opening"?this.db.defer(()=>this._close(e)):this.nextTick(e)};Q3.DeferredIterator=VL;Q3.DeferredKeyIterator=KL;Q3.DeferredValueIterator=HL;var jL={},ZE={};const{fromCallback:IC}=$h,V0=Xs,{getCallback:aZ,getOptions:cZ}=Fp,K0=Symbol("promise"),yi=Symbol("status"),_u=Symbol("operations"),ff=Symbol("finishClose"),Tu=Symbol("closeCallbacks");let lZ=class{constructor(e){if(typeof e!="object"||e===null){const t=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${t}`)}this[_u]=[],this[Tu]=[],this[yi]="open",this[ff]=this[ff].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[_u].length}put(e,t,n){if(this[yi]!=="open")throw new V0("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const i=this.db._checkKey(e)||this.db._checkValue(t);if(i)throw i;const s=n&&n.sublevel!=null?n.sublevel:this.db,o=n,a=s.keyEncoding(n&&n.keyEncoding),c=s.valueEncoding(n&&n.valueEncoding),l=a.format;n={...n,keyEncoding:l,valueEncoding:c.format},s!==this.db&&(n.sublevel=null);const d=s.prefixKey(a.encode(e),l),h=c.encode(t);return this._put(d,h,n),this[_u].push({...o,type:"put",key:e,value:t}),this}_put(e,t,n){}del(e,t){if(this[yi]!=="open")throw new V0("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const n=this.db._checkKey(e);if(n)throw n;const i=t&&t.sublevel!=null?t.sublevel:this.db,s=t,o=i.keyEncoding(t&&t.keyEncoding),a=o.format;return t={...t,keyEncoding:a},i!==this.db&&(t.sublevel=null),this._del(i.prefixKey(o.encode(e),a),t),this[_u].push({...s,type:"del",key:e}),this}_del(e,t){}clear(){if(this[yi]!=="open")throw new V0("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[_u]=[],this}_clear(){}write(e,t){return t=aZ(e,t),t=IC(t,K0),e=cZ(e),this[yi]!=="open"?this.nextTick(t,new V0("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(t):(this[yi]="writing",this._write(e,n=>{this[yi]="closing",this[Tu].push(()=>t(n)),n||this.db.emit("batch",this[_u]),this._close(this[ff])})),t[K0]}_write(e,t){}close(e){return e=IC(e,K0),this[yi]==="closing"?this[Tu].push(e):this[yi]==="closed"?this.nextTick(e):(this[Tu].push(e),this[yi]!=="writing"&&(this[yi]="closing",this._close(this[ff]))),e[K0]}_close(e){this.nextTick(e)}[ff](){this[yi]="closed",this.db.detachResource(this);const e=this[Tu];this[Tu]=[];for(const t of e)t()}};ZE.AbstractChainedBatch=lZ;const{AbstractChainedBatch:uZ}=ZE,dZ=Xs,Pu=Symbol("encoded");let hZ=class extends uZ{constructor(e){super(e),this[Pu]=[]}_put(e,t,n){this[Pu].push({...n,type:"put",key:e,value:t})}_del(e,t){this[Pu].push({...t,type:"del",key:e})}_clear(){this[Pu]=[]}_write(e,t){this.db.status==="opening"?this.db.defer(()=>this._write(e,t)):this.db.status==="open"?this[Pu].length===0?this.nextTick(t):this.db._batch(this[Pu],e,t):this.nextTick(t,new dZ("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};jL.DefaultChainedBatch=hZ;const CC=Xs,fZ=Object.prototype.hasOwnProperty,pZ=new Set(["lt","lte","gt","gte"]);var gZ=function(r,e){const t={};for(const n in r)if(fZ.call(r,n)&&!(n==="keyEncoding"||n==="valueEncoding")){if(n==="start"||n==="end")throw new CC(`The legacy range option '${n}' has been removed`,{code:"LEVEL_LEGACY"});if(n==="encoding")throw new CC("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});pZ.has(n)?t[n]=e.encode(r[n]):t[n]=r[n]}return t.reverse=!!t.reverse,t.limit=Number.isInteger(t.limit)&&t.limit>=0?t.limit:-1,t};/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let kC;var qL=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:E1):r=>(kC||(kC=Promise.resolve())).then(r).catch(e=>setTimeout(()=>{throw e},0)),P8,_C;function yZ(){if(_C)return P8;_C=1;const r=qL;return P8=function(e,...t){t.length===0?r(e):r(()=>e(...t))},P8}var pf={},TC;function mZ(){if(TC)return pf;TC=1;const{AbstractIterator:r,AbstractKeyIterator:e,AbstractValueIterator:t}=Js,n=Symbol("unfix"),i=Symbol("iterator"),s=Symbol("handleOne"),o=Symbol("handleMany"),a=Symbol("callback");class c extends r{constructor(p,w,f,g){super(p,w),this[i]=f,this[n]=g,this[s]=this[s].bind(this),this[o]=this[o].bind(this),this[a]=null}[s](p,w,f){const g=this[a];if(p)return g(p);w!==void 0&&(w=this[n](w)),g(p,w,f)}[o](p,w){const f=this[a];if(p)return f(p);for(const g of w){const v=g[0];v!==void 0&&(g[0]=this[n](v))}f(p,w)}}class l extends e{constructor(p,w,f,g){super(p,w),this[i]=f,this[n]=g,this[s]=this[s].bind(this),this[o]=this[o].bind(this),this[a]=null}[s](p,w){const f=this[a];if(p)return f(p);w!==void 0&&(w=this[n](w)),f(p,w)}[o](p,w){const f=this[a];if(p)return f(p);for(let g=0;g<w.length;g++){const v=w[g];v!==void 0&&(w[g]=this[n](v))}f(p,w)}}class d extends t{constructor(p,w,f){super(p,w),this[i]=f}}for(const h of[c,l])h.prototype._next=function(p){this[a]=p,this[i].next(this[s])},h.prototype._nextv=function(p,w,f){this[a]=f,this[i].nextv(p,w,this[o])},h.prototype._all=function(p,w){this[a]=w,this[i].all(p,this[o])};for(const h of[d])h.prototype._next=function(p){this[i].next(p)},h.prototype._nextv=function(p,w,f){this[i].nextv(p,w,f)},h.prototype._all=function(p,w){this[i].all(p,w)};for(const h of[c,l,d])h.prototype._seek=function(p,w){this[i].seek(p,w)},h.prototype._close=function(p){this[i].close(p)};return pf.AbstractSublevelIterator=c,pf.AbstractSublevelKeyIterator=l,pf.AbstractSublevelValueIterator=d,pf}var D8,PC;function wZ(){if(PC)return D8;PC=1;const r=Xs,{Buffer:e}=Lp||{},{AbstractSublevelIterator:t,AbstractSublevelKeyIterator:n,AbstractSublevelValueIterator:i}=mZ(),s=Symbol("prefix"),o=Symbol("upperBound"),a=Symbol("prefixRange"),c=Symbol("parent"),l=Symbol("unfix"),d=new TextEncoder,h={separator:"!"};D8=function({AbstractLevel:y}){class m extends y{static defaults(S){if(typeof S=="string")throw new r("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(S&&S.open)throw new r("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return S==null?h:S.separator?S:{...S,separator:"!"}}constructor(S,I,T){const{separator:A,manifest:_,...$}=m.defaults(T);I=v(I,A);const z=A.charCodeAt(0)+1,j=S[c]||S;if(!d.encode(I).every(G=>G>z&&G<127))throw new r(`Prefix must use bytes > ${z} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(p(j,_),$);const K=(S.prefix||"")+A+I+A,Z=K.slice(0,-1)+String.fromCharCode(z);this[c]=j,this[s]=new f(K),this[o]=new f(Z),this[l]=new g,this.nextTick=j.nextTick}prefixKey(S,I){if(I==="utf8")return this[s].utf8+S;if(S.byteLength===0)return this[s][I];if(I==="view"){const T=this[s].view,A=new Uint8Array(T.byteLength+S.byteLength);return A.set(T,0),A.set(S,T.byteLength),A}else{const T=this[s].buffer;return e.concat([T,S],T.byteLength+S.byteLength)}}[a](S,I){S.gte!==void 0?S.gte=this.prefixKey(S.gte,I):S.gt!==void 0?S.gt=this.prefixKey(S.gt,I):S.gte=this[s][I],S.lte!==void 0?S.lte=this.prefixKey(S.lte,I):S.lt!==void 0?S.lt=this.prefixKey(S.lt,I):S.lte=this[o][I]}get prefix(){return this[s].utf8}get db(){return this[c]}_open(S,I){this[c].open({passive:!0},I)}_put(S,I,T,A){this[c].put(S,I,T,A)}_get(S,I,T){this[c].get(S,I,T)}_getMany(S,I,T){this[c].getMany(S,I,T)}_del(S,I,T){this[c].del(S,I,T)}_batch(S,I,T){this[c].batch(S,I,T)}_clear(S,I){this[a](S,S.keyEncoding),this[c].clear(S,I)}_iterator(S){this[a](S,S.keyEncoding);const I=this[c].iterator(S),T=this[l].get(this[s].utf8.length,S.keyEncoding);return new t(this,S,I,T)}_keys(S){this[a](S,S.keyEncoding);const I=this[c].keys(S),T=this[l].get(this[s].utf8.length,S.keyEncoding);return new n(this,S,I,T)}_values(S){this[a](S,S.keyEncoding);const I=this[c].values(S);return new i(this,S,I)}}return{AbstractSublevel:m}};const p=function(y,m){return{...y.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...m,encodings:{utf8:w(y,"utf8"),buffer:w(y,"buffer"),view:w(y,"view")}}},w=function(y,m){return y.supports.encodings[m]?y.keyEncoding(m).name===m:!1};class f{constructor(m){this.utf8=m,this.view=d.encode(m),this.buffer=e?e.from(this.view.buffer,0,this.view.byteLength):{}}}class g{constructor(){this.cache=new Map}get(m,b){let S=this.cache.get(b);return S===void 0&&(b==="view"?S=(function(I,T){return T.subarray(I)}).bind(null,m):S=(function(I,T){return T.slice(I)}).bind(null,m),this.cache.set(b,S)),S}}const v=function(y,m){let b=0,S=y.length;for(;b<S&&y[b]===m;)b++;for(;S>b&&y[S-1]===m;)S--;return y.slice(b,S)};return D8}const{supports:vZ}=ML,{Transcoder:bZ}=RL,{EventEmitter:EZ}=$p,{fromCallback:ga}=$h,Qi=Xs,{AbstractIterator:Gc}=Js,{DefaultKeyIterator:SZ,DefaultValueIterator:xZ}=JE,{DeferredIterator:AZ,DeferredKeyIterator:IZ,DeferredValueIterator:CZ}=Q3,{DefaultChainedBatch:DC}=jL,{getCallback:Qc,getOptions:ya}=Fp,H0=gZ,We=Symbol("promise"),io=Symbol("landed"),Yc=Symbol("resources"),$8=Symbol("closeResources"),gf=Symbol("operations"),yf=Symbol("undefer"),j0=Symbol("deferOpen"),$C=Symbol("options"),Ye=Symbol("status"),Xc=Symbol("defaultOptions"),Du=Symbol("transcoder"),q0=Symbol("keyEncoding"),N8=Symbol("valueEncoding"),kZ=()=>{};let eS=class extends EZ{constructor(e,t){if(super(),typeof e!="object"||e===null)throw new TypeError("The first argument 'manifest' must be an object");t=ya(t);const{keyEncoding:n,valueEncoding:i,passive:s,...o}=t;this[Yc]=new Set,this[gf]=[],this[j0]=!0,this[$C]=o,this[Ye]="opening",this.supports=vZ(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:e.snapshots!==!1,permanence:e.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[Du]=new bZ(_Z(this)),this[q0]=this[Du].encoding(n||"utf8"),this[N8]=this[Du].encoding(i||"utf8");for(const a of this[Du].encodings())this.supports.encodings[a.commonName]||(this.supports.encodings[a.commonName]=!0);this[Xc]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[q0].commonName,valueEncoding:this[N8].commonName}),key:Object.freeze({keyEncoding:this[q0].commonName})},this.nextTick(()=>{this[j0]&&this.open({passive:!1},kZ)})}get status(){return this[Ye]}keyEncoding(e){return this[Du].encoding(e??this[q0])}valueEncoding(e){return this[Du].encoding(e??this[N8])}open(e,t){t=Qc(e,t),t=ga(t,We),e={...this[$C],...ya(e)},e.createIfMissing=e.createIfMissing!==!1,e.errorIfExists=!!e.errorIfExists;const n=i=>{this[Ye]==="closing"||this[Ye]==="opening"?this.once(io,i?()=>n(i):n):this[Ye]!=="open"?t(new Qi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:i})):t()};return e.passive?this[Ye]==="opening"?this.once(io,n):this.nextTick(n):this[Ye]==="closed"||this[j0]?(this[j0]=!1,this[Ye]="opening",this.emit("opening"),this._open(e,i=>{if(i){this[Ye]="closed",this[$8](()=>{this.emit(io),n(i)}),this[yf]();return}this[Ye]="open",this[yf](),this.emit(io),this[Ye]==="open"&&this.emit("open"),this[Ye]==="open"&&this.emit("ready"),n()})):this[Ye]==="open"?this.nextTick(n):this.once(io,()=>this.open(e,t)),t[We]}_open(e,t){this.nextTick(t)}close(e){e=ga(e,We);const t=n=>{this[Ye]==="opening"||this[Ye]==="closing"?this.once(io,n?t(n):t):this[Ye]!=="closed"?e(new Qi("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:n})):e()};if(this[Ye]==="open"){this[Ye]="closing",this.emit("closing");const n=i=>{this[Ye]="open",this[yf](),this.emit(io),t(i)};this[$8](()=>{this._close(i=>{if(i)return n(i);this[Ye]="closed",this[yf](),this.emit(io),this[Ye]==="closed"&&this.emit("closed"),t()})})}else this[Ye]==="closed"?this.nextTick(t):this.once(io,()=>this.close(e));return e[We]}[$8](e){if(this[Yc].size===0)return this.nextTick(e);let t=this[Yc].size,n=!0;const i=()=>{--t===0&&(n?this.nextTick(e):e())};for(const s of this[Yc])s.close(i);n=!1,this[Yc].clear()}_close(e){this.nextTick(e)}get(e,t,n){if(n=Qc(t,n),n=ga(n,We),t=ya(t,this[Xc].entry),this[Ye]==="opening")return this.defer(()=>this.get(e,t,n)),n[We];if($u(this,n))return n[We];const i=this._checkKey(e);if(i)return this.nextTick(n,i),n[We];const s=this.keyEncoding(t.keyEncoding),o=this.valueEncoding(t.valueEncoding),a=s.format,c=o.format;return(t.keyEncoding!==a||t.valueEncoding!==c)&&(t=Object.assign({},t,{keyEncoding:a,valueEncoding:c})),this._get(this.prefixKey(s.encode(e),a),t,(l,d)=>{if(l)return(l.code==="LEVEL_NOT_FOUND"||l.notFound||/NotFound/i.test(l))&&(l.code||(l.code="LEVEL_NOT_FOUND"),l.notFound||(l.notFound=!0),l.status||(l.status=404)),n(l);try{d=o.decode(d)}catch(h){return n(new Qi("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:h}))}n(null,d)}),n[We]}_get(e,t,n){this.nextTick(n,new Error("NotFound"))}getMany(e,t,n){if(n=Qc(t,n),n=ga(n,We),t=ya(t,this[Xc].entry),this[Ye]==="opening")return this.defer(()=>this.getMany(e,t,n)),n[We];if($u(this,n))return n[We];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'keys' must be an array")),n[We];if(e.length===0)return this.nextTick(n,null,[]),n[We];const i=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),o=i.format,a=s.format;(t.keyEncoding!==o||t.valueEncoding!==a)&&(t=Object.assign({},t,{keyEncoding:o,valueEncoding:a}));const c=new Array(e.length);for(let l=0;l<e.length;l++){const d=e[l],h=this._checkKey(d);if(h)return this.nextTick(n,h),n[We];c[l]=this.prefixKey(i.encode(d),o)}return this._getMany(c,t,(l,d)=>{if(l)return n(l);try{for(let h=0;h<d.length;h++)d[h]!==void 0&&(d[h]=s.decode(d[h]))}catch(h){return n(new Qi(`Could not decode one or more of ${d.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:h}))}n(null,d)}),n[We]}_getMany(e,t,n){this.nextTick(n,null,new Array(e.length).fill(void 0))}put(e,t,n,i){if(i=Qc(n,i),i=ga(i,We),n=ya(n,this[Xc].entry),this[Ye]==="opening")return this.defer(()=>this.put(e,t,n,i)),i[We];if($u(this,i))return i[We];const s=this._checkKey(e)||this._checkValue(t);if(s)return this.nextTick(i,s),i[We];const o=this.keyEncoding(n.keyEncoding),a=this.valueEncoding(n.valueEncoding),c=o.format,l=a.format;(n.keyEncoding!==c||n.valueEncoding!==l)&&(n=Object.assign({},n,{keyEncoding:c,valueEncoding:l}));const d=this.prefixKey(o.encode(e),c),h=a.encode(t);return this._put(d,h,n,p=>{if(p)return i(p);this.emit("put",e,t),i()}),i[We]}_put(e,t,n,i){this.nextTick(i)}del(e,t,n){if(n=Qc(t,n),n=ga(n,We),t=ya(t,this[Xc].key),this[Ye]==="opening")return this.defer(()=>this.del(e,t,n)),n[We];if($u(this,n))return n[We];const i=this._checkKey(e);if(i)return this.nextTick(n,i),n[We];const s=this.keyEncoding(t.keyEncoding),o=s.format;return t.keyEncoding!==o&&(t=Object.assign({},t,{keyEncoding:o})),this._del(this.prefixKey(s.encode(e),o),t,a=>{if(a)return n(a);this.emit("del",e),n()}),n[We]}_del(e,t,n){this.nextTick(n)}batch(e,t,n){if(!arguments.length){if(this[Ye]==="opening")return new DC(this);if(this[Ye]!=="open")throw new Qi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof e=="function"?n=e:n=Qc(t,n),n=ga(n,We),t=ya(t,this[Xc].empty),this[Ye]==="opening")return this.defer(()=>this.batch(e,t,n)),n[We];if($u(this,n))return n[We];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'operations' must be an array")),n[We];if(e.length===0)return this.nextTick(n),n[We];const i=new Array(e.length),{keyEncoding:s,valueEncoding:o,...a}=t;for(let c=0;c<e.length;c++){if(typeof e[c]!="object"||e[c]===null)return this.nextTick(n,new TypeError("A batch operation must be an object")),n[We];const l=Object.assign({},e[c]);if(l.type!=="put"&&l.type!=="del")return this.nextTick(n,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),n[We];const d=this._checkKey(l.key);if(d)return this.nextTick(n,d),n[We];const h=l.sublevel!=null?l.sublevel:this,p=h.keyEncoding(l.keyEncoding||s),w=p.format;if(l.key=h.prefixKey(p.encode(l.key),w),l.keyEncoding=w,l.type==="put"){const f=this._checkValue(l.value);if(f)return this.nextTick(n,f),n[We];const g=h.valueEncoding(l.valueEncoding||o);l.value=g.encode(l.value),l.valueEncoding=g.format}h!==this&&(l.sublevel=null),i[c]=l}return this._batch(i,a,c=>{if(c)return n(c);this.emit("batch",e),n()}),n[We]}_batch(e,t,n){this.nextTick(n)}sublevel(e,t){return this._sublevel(e,hv.defaults(t))}_sublevel(e,t){return new hv(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=Qc(e,t),t=ga(t,We),e=ya(e,this[Xc].empty),this[Ye]==="opening")return this.defer(()=>this.clear(e,t)),t[We];if($u(this,t))return t[We];const n=e,i=this.keyEncoding(e.keyEncoding);return e=H0(e,i),e.keyEncoding=i.format,e.limit===0?this.nextTick(t):this._clear(e,s=>{if(s)return t(s);this.emit("clear",n),t()}),t[We]}_clear(e,t){this.nextTick(t)}iterator(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=H0(e,t),e.keys=e.keys!==!1,e.values=e.values!==!1,e[Gc.keyEncoding]=t,e[Gc.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[Ye]==="opening")return new AZ(this,e);if(this[Ye]!=="open")throw new Qi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new Gc(this,e)}keys(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=H0(e,t),e[Gc.keyEncoding]=t,e[Gc.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[Ye]==="opening")return new IZ(this,e);if(this[Ye]!=="open")throw new Qi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new SZ(this,e)}values(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=H0(e,t),e[Gc.keyEncoding]=t,e[Gc.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[Ye]==="opening")return new CZ(this,e);if(this[Ye]!=="open")throw new Qi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new xZ(this,e)}defer(e){if(typeof e!="function")throw new TypeError("The first argument must be a function");this[gf].push(e)}[yf](){if(this[gf].length===0)return;const e=this[gf];this[gf]=[];for(const t of e)t()}attachResource(e){if(typeof e!="object"||e===null||typeof e.close!="function")throw new TypeError("The first argument must be a resource object");this[Yc].add(e)}detachResource(e){this[Yc].delete(e)}_chainedBatch(){return new DC(this)}_checkKey(e){if(e==null)return new Qi("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(e==null)return new Qi("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};eS.prototype.nextTick=yZ();const{AbstractSublevel:hv}=wZ()({AbstractLevel:eS});q3.AbstractLevel=eS;q3.AbstractSublevel=hv;const $u=function(r,e){return r[Ye]!=="open"?(r.nextTick(e,new Qi("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},_Z=function(r){return Object.keys(r.supports.encodings).filter(e=>!!r.supports.encodings[e])};Bc.AbstractLevel=q3.AbstractLevel;Bc.AbstractSublevel=q3.AbstractSublevel;Bc.AbstractIterator=Js.AbstractIterator;Bc.AbstractKeyIterator=Js.AbstractKeyIterator;Bc.AbstractValueIterator=Js.AbstractValueIterator;Bc.AbstractChainedBatch=ZE.AbstractChainedBatch;/*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var TZ=DZ;const PZ=qL;function DZ(r,e,t){if(typeof e!="number")throw new Error("second argument must be a Number");let n,i,s,o,a,c=!0,l;Array.isArray(r)?(n=[],s=i=r.length):(o=Object.keys(r),n={},s=i=o.length);function d(p){function w(){t&&t(p,n),t=null}c?PZ(w):w()}function h(p,w,f){if(n[p]=f,w&&(a=!0),--s===0||w)d(w);else if(!a&&l<i){let g;o?(g=o[l],l+=1,r[g](function(v,y){h(g,v,y)})):(g=l,l+=1,r[g](function(v,y){h(g,v,y)}))}}l=e,s?o?o.some(function(p,w){return r[p](function(f,g){h(p,f,g)}),w===e-1}):r.some(function(p,w){return p(function(f,g){h(w,f,g)}),w===e-1}):d(null),c=!1}var WL={},GL=function(e){const t=e.gte!==void 0?e.gte:e.gt!==void 0?e.gt:void 0,n=e.lte!==void 0?e.lte:e.lt!==void 0?e.lt:void 0,i=e.gte===void 0,s=e.lte===void 0;return t!==void 0&&n!==void 0?IDBKeyRange.bound(t,n,i,s):t!==void 0?IDBKeyRange.lowerBound(t,i):n!==void 0?IDBKeyRange.upperBound(n,s):null};const $Z=new TextEncoder;var QL=function(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):$Z.encode(r)};const{AbstractIterator:NZ}=Bc,NC=GL,W0=QL,As=Symbol("cache"),so=Symbol("finished"),Kn=Symbol("options"),oo=Symbol("currentOptions"),Jc=Symbol("position"),O8=Symbol("location"),Nu=Symbol("first"),OC={};let OZ=class extends NZ{constructor(e,t,n){super(e,n),this[As]=[],this[so]=this.limit===0,this[Kn]=n,this[oo]={...n},this[Jc]=void 0,this[O8]=t,this[Nu]=!0}_nextv(e,t,n){if(this[Nu]=!1,this[so])return this.nextTick(n,null,[]);if(this[As].length>0)return e=Math.min(e,this[As].length),this.nextTick(n,null,this[As].splice(0,e));this[Jc]!==void 0&&(this[Kn].reverse?(this[oo].lt=this[Jc],this[oo].lte=void 0):(this[oo].gt=this[Jc],this[oo].gte=void 0));let i;try{i=NC(this[oo])}catch{return this[so]=!0,this.nextTick(n,null,[])}const s=this.db.db.transaction([this[O8]],"readonly"),o=s.objectStore(this[O8]),a=[];if(this[Kn].reverse){const c=!this[Kn].values&&o.openKeyCursor?"openKeyCursor":"openCursor";o[c](i,"prev").onsuccess=l=>{const d=l.target.result;if(d){const{key:h,value:p}=d;this[Jc]=h,a.push([this[Kn].keys&&h!==void 0?W0(h):void 0,this[Kn].values&&p!==void 0?W0(p):void 0]),a.length<e?d.continue():MC(s)}else this[so]=!0}}else{let c,l;const d=()=>{if(c===void 0||l===void 0)return;const h=Math.max(c.length,l.length);h===0||e===1/0?this[so]=!0:this[Jc]=c[h-1],a.length=h;for(let p=0;p<h;p++){const w=c[p],f=l[p];a[p]=[this[Kn].keys&&w!==void 0?W0(w):void 0,this[Kn].values&&f!==void 0?W0(f):void 0]}MC(s)};this[Kn].keys||e<1/0?o.getAllKeys(i,e<1/0?e:void 0).onsuccess=h=>{c=h.target.result,d()}:(c=[],this.nextTick(d)),this[Kn].values?o.getAll(i,e<1/0?e:void 0).onsuccess=h=>{l=h.target.result,d()}:(l=[],this.nextTick(d))}s.onabort=()=>{n(s.error||new Error("aborted by user")),n=null},s.oncomplete=()=>{n(null,a),n=null}}_next(e){if(this[As].length>0){const[t,n]=this[As].shift();this.nextTick(e,null,t,n)}else if(this[so])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[Nu]&&(this[Nu]=!1,t=1),this._nextv(t,OC,(n,i)=>{if(n)return e(n);this[As]=i,this._next(e)})}}_all(e,t){this[Nu]=!1;const n=this[As].splice(0,this[As].length),i=this.limit-this.count-n.length;if(i<=0)return this.nextTick(t,null,n);this._nextv(i,OC,(s,o)=>{if(s)return t(s);n.length>0&&(o=n.concat(o)),t(null,o)})}_seek(e,t){this[Nu]=!0,this[As]=[],this[so]=!1,this[Jc]=void 0,this[oo]={...this[Kn]};let n;try{n=NC(this[Kn])}catch{this[so]=!0;return}n!==null&&!n.includes(e)?this[so]=!0:this[Kn].reverse?this[oo].lte=e:this[oo].gte=e}};WL.Iterator=OZ;function MC(r){typeof r.commit=="function"&&r.commit()}var MZ=function(e,t,n,i,s){if(i.limit===0)return e.nextTick(s);const o=e.db.transaction([t],"readwrite"),a=o.objectStore(t);let c=0;o.oncomplete=function(){s()},o.onabort=function(){s(o.error||new Error("aborted by user"))};const l=a.openKeyCursor?"openKeyCursor":"openCursor",d=i.reverse?"prev":"next";a[l](n,d).onsuccess=function(h){const p=h.target.result;p&&(a.delete(p.key).onsuccess=function(){(i.limit<=0||++c<i.limit)&&p.continue()})}};const{AbstractLevel:RZ}=Bc,RC=Xs,LZ=TZ,{fromCallback:BZ}=$h,{Iterator:UZ}=WL,LC=QL,FZ=MZ,zZ=GL,YL="level-js-",mf=Symbol("idb"),M8=Symbol("namePrefix"),ao=Symbol("location"),R8=Symbol("version"),Zc=Symbol("store"),wf=Symbol("onComplete"),BC=Symbol("promise");class XL extends RZ{constructor(e,t,n){if(typeof t=="function"||typeof n=="function")throw new RC("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:i,version:s,...o}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),typeof e!="string")throw new Error("constructor requires a location string argument");this[ao]=e,this[M8]=i??YL,this[R8]=parseInt(s||1,10),this[mf]=null}get location(){return this[ao]}get namePrefix(){return this[M8]}get version(){return this[R8]}get db(){return this[mf]}get type(){return"browser-level"}_open(e,t){const n=indexedDB.open(this[M8]+this[ao],this[R8]);n.onerror=function(){t(n.error||new Error("unknown error"))},n.onsuccess=()=>{this[mf]=n.result,t()},n.onupgradeneeded=i=>{const s=i.target.result;s.objectStoreNames.contains(this[ao])||s.createObjectStore(this[ao])}}[Zc](e){return this[mf].transaction([this[ao]],e).objectStore(this[ao])}[wf](e,t){const n=e.transaction;n.onabort=function(){t(n.error||new Error("aborted by user"))},n.oncomplete=function(){t(null,e.result)}}_get(e,t,n){const i=this[Zc]("readonly");let s;try{s=i.get(e)}catch(o){return this.nextTick(n,o)}this[wf](s,function(o,a){if(o)return n(o);if(a===void 0)return n(new RC("Entry not found",{code:"LEVEL_NOT_FOUND"}));n(null,LC(a))})}_getMany(e,t,n){const i=this[Zc]("readonly"),s=e.map(o=>a=>{let c;try{c=i.get(o)}catch(l){return a(l)}c.onsuccess=()=>{const l=c.result;a(null,l===void 0?l:LC(l))},c.onerror=l=>{l.stopPropagation(),a(c.error)}});LZ(s,16,n)}_del(e,t,n){const i=this[Zc]("readwrite");let s;try{s=i.delete(e)}catch(o){return this.nextTick(n,o)}this[wf](s,n)}_put(e,t,n,i){const s=this[Zc]("readwrite");let o;try{o=s.put(t,e)}catch(a){return this.nextTick(i,a)}this[wf](o,i)}_iterator(e){return new UZ(this,this[ao],e)}_batch(e,t,n){const i=this[Zc]("readwrite"),s=i.transaction;let o=0,a;s.onabort=function(){n(a||s.error||new Error("aborted by user"))},s.oncomplete=function(){n()};function c(){const l=e[o++],d=l.key;let h;try{h=l.type==="del"?i.delete(d):i.put(l.value,d)}catch(p){a=p,s.abort();return}o<e.length?h.onsuccess=c:typeof s.commit=="function"&&s.commit()}c()}_clear(e,t){let n,i;try{n=zZ(e)}catch{return this.nextTick(t)}if(e.limit>=0)return FZ(this,this[ao],n,e,t);try{const s=this[Zc]("readwrite");i=n?s.delete(n):s.clear()}catch(s){return this.nextTick(t,s)}this[wf](i,t)}_close(e){this[mf].close(),this.nextTick(e)}}XL.destroy=function(r,e,t){typeof e=="function"&&(t=e,e=YL),t=BZ(t,BC);const n=indexedDB.deleteDatabase(e+r);return n.onsuccess=function(){t()},n.onerror=function(i){t(i)},t[BC]};OL.BrowserLevel=XL;var VZ=OL.BrowserLevel;const KZ="./level",HZ="view",fv=async({path:r,valueEncoding:e}={})=>{r=r||KZ,e=e||HZ;const t=new VZ(r,{valueEncoding:e,passive:!0});return await t.open(),{put:async(d,h)=>{await t.put(d,h)},del:async d=>{await t.del(d)},get:async d=>{try{const h=await t.get(d);if(h)return h}catch{}},iterator:async function*({amount:d,reverse:h}={}){const p={limit:d||-1,reverse:h||!1};for await(const[w,f]of t.iterator(p))yield[w,f]},merge:async d=>{},clear:async()=>{await t.clear()},close:async()=>{await t.close()}}},UC=1e6,Vs=async({size:r}={})=>{let e=new ev(r||UC);return{put:async(l,d)=>{e.set(l,d)},del:async l=>{e.remove(l)},get:async l=>e.get(l),iterator:async function*(){for await(const l of e.keys){const d=e.get(l);yield[l,d]}},merge:async l=>{if(l)for await(const[d,h]of l.iterator())e.set(d,h)},clear:async()=>{e=new ev(r||UC)},close:async()=>{}}},jZ=16,L8=1e3,tS=async({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p})=>{s=uc(s||"./orbitdb",`./${t}/`),o=o||{},d=Number(d)>-1?d:jZ,c=c||await Tl(await Vs({size:L8}),await j3({ipfs:r,pin:!0})),a=a||await Tl(await Vs({size:L8}),await fv({path:uc(s,"/log/_heads/")})),l=l||await Tl(await Vs({size:L8}),await fv({path:uc(s,"/log/_index/")}));const w=await kJ(e,{logId:t,access:i,entryStorage:c,headsStorage:a,indexStorage:l}),f=new $p.EventEmitter,g=new vc({concurrency:1}),v=async I=>{const T=async()=>{const _=await w.append(I,{referencesCount:d});return await S.add(_),p&&await p(w,_),f.emit("update",_),_.hash},A=await g.add(T);return await g.onIdle(),A},y=async I=>{const T=async()=>{const A=await wo.decode(I);A&&await w.joinEntry(A)&&(p&&await p(w,A),f.emit("update",A))};await g.add(T)},m=async()=>{await S.stop(),await g.onIdle(),await w.close(),i&&i.close&&await i.close(),f.emit("close")},b=async()=>{await g.onIdle(),await w.clear(),i&&i.drop&&await i.drop(),f.emit("drop")},S=await yQ({ipfs:r,log:w,events:f,onSynced:y,start:h});return{address:t,name:n,identity:e,meta:o,close:m,drop:b,addOperation:v,log:w,sync:S,peers:S.peers,events:f,access:i}},JL="documents",qZ={indexBy:"_id"},ZL=({indexBy:r}=qZ)=>async({ipfs:e,identity:t,address:n,name:i,access:s,directory:o,meta:a,headsStorage:c,entryStorage:l,indexStorage:d,referencesCount:h,syncAutomatically:p,onUpdate:w})=>{const f=await tS({ipfs:e,identity:t,address:n,name:i,access:s,directory:o,meta:a,headsStorage:c,entryStorage:l,indexStorage:d,referencesCount:h,syncAutomatically:p}),{addOperation:g,log:v}=f,y=async A=>{const _=A[r];if(!_)throw new Error(`The provided document doesn't contain field '${r}'`);return g({op:"PUT",key:_,value:A})},m=async A=>{if(!await b(A))throw new Error(`No document with key '${A}' in the database`);return g({op:"DEL",key:A,value:null})},b=async A=>{for await(const _ of I())if(A===_.key)return _},S=async A=>{const _=[];for await(const $ of I())A($.value)&&_.push($.value);return _},I=async function*({amount:A}={}){const _={};let $=0;for await(const z of v.iterator()){const{op:j,key:K,value:Z}=z.payload;if(j==="PUT"&&!_[K]?(_[K]=!0,$++,yield{hash:z.hash,key:K,value:Z}):j==="DEL"&&!_[K]&&(_[K]=!0),$>=A)break}};return{...f,type:JL,put:y,del:m,get:b,iterator:I,query:S,indexBy:r,all:async()=>{const A=[];for await(const _ of I())A.unshift(_);return A}}};ZL.type=JL;const eB="events",tB=()=>async({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p})=>{const w=await tS({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p}),{addOperation:f,log:g}=w,v=async S=>f({op:"ADD",key:null,value:S}),y=async S=>(await g.get(S)).payload.value,m=async function*({gt:S,gte:I,lt:T,lte:A,amount:_}={}){const $=g.iterator({gt:S,gte:I,lt:T,lte:A,amount:_});for await(const z of $){const j=z.hash,K=z.payload.value;yield{hash:j,value:K}}};return{...w,type:eB,add:v,get:y,iterator:m,all:async()=>{const S=[];for await(const I of m())S.unshift(I);return S}}};tB.type=eB;const rB="keyvalue",nB=()=>async({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p})=>{const w=await tS({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p}),{addOperation:f,log:g}=w,v=async(I,T)=>f({op:"PUT",key:I,value:T}),y=async I=>f({op:"DEL",key:I,value:null}),m=async I=>{for await(const T of g.traverse()){const{op:A,key:_,value:$}=T.payload;if(A==="PUT"&&_===I)return $;if(A==="DEL"&&_===I)return}},b=async function*({amount:I}={}){const T={};let A=0;for await(const _ of g.traverse()){const{op:$,key:z,value:j}=_.payload;if($==="PUT"&&!T[z]){T[z]=!0,A++;const K=_.hash;yield{key:z,value:j,hash:K}}else $==="DEL"&&!T[z]&&(T[z]=!0);if(A>=I)break}};return{...w,type:rB,put:v,set:v,del:y,get:m,iterator:b,all:async()=>{const I=[];for await(const T of b())I.unshift(T);return I}}};nB.type=rB;const pv={},rS=r=>{if(!r.type)throw new Error("Database type does not contain required field 'type'.");pv[r.type]=r},WZ=r=>{if(!r)throw new Error("Type not specified");if(!pv[r])throw new Error(`Unsupported database type: '${r}'`);return pv[r]};rS(tB);rS(ZL);rS(nB);const GZ=Symbol.for("@libp2p/connection"),Kd=Symbol.for("@libp2p/content-routing"),z1=Symbol.for("@libp2p/peer-discovery"),nS=Symbol.for("@libp2p/peer-id");function iB(r){return!!(r!=null&&r[nS])}const Hd=Symbol.for("@libp2p/peer-routing"),J3="keep-alive",iy="StrictSign",iS="StrictNoSign";var ki;(function(r){r.Accept="accept",r.Ignore="ignore",r.Reject="reject"})(ki||(ki={}));const Z3=Symbol.for("@libp2p/transport");var jd;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(jd||(jd={}));var e5;let jl=(e5=class extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}},u(e5,"name","AbortError"),e5);class sB extends Error{constructor(e="Unexpected Peer"){super(e),this.name="UnexpectedPeerError"}}u(sB,"name","UnexpectedPeerError");var t5;let QZ=(t5=class extends Error{constructor(e="Invalid crypto exchange"){super(e),this.name="InvalidCryptoExchangeError"}},u(t5,"name","InvalidCryptoExchangeError"),t5);class ie extends Error{constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}}u(ie,"name","InvalidParametersError");class V1 extends Error{constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}u(V1,"name","InvalidPublicKeyError");class sS extends Error{constructor(e="Invalid private key"){super(e),this.name="InvalidPrivateKeyError"}}u(sS,"name","InvalidPrivateKeyError");class oB extends Error{constructor(e="The connection is closing"){super(e),this.name="ConnectionClosingError"}}u(oB,"name","ConnectionClosingError");class oS extends Error{constructor(e="The connection is closed"){super(e),this.name="ConnectionClosedError"}}u(oS,"name","ConnectionClosedError");class aS extends Error{constructor(e="Connection failed"){super(e),this.name="ConnectionFailedError"}}u(aS,"name","ConnectionFailedError");class cl extends Error{constructor(e="The muxer is closed"){super(e),this.name="MuxerClosedError"}}u(cl,"name","MuxerClosedError");class aB extends Error{constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}}u(aB,"name","StreamResetError");class sy extends Error{constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}}u(sy,"name","StreamStateError");var r5;let sr=(r5=class extends Error{constructor(e="Not found"){super(e),this.name="NotFoundError"}},u(r5,"name","NotFoundError"),r5);class cS extends Error{constructor(e="Invalid PeerID"){super(e),this.name="InvalidPeerIdError"}}u(cS,"name","InvalidPeerIdError");class ew extends Error{constructor(e="Invalid multiaddr"){super(e),this.name="InvalidMultiaddrError"}}u(ew,"name","InvalidMultiaddrError");class cB extends Error{constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}u(cB,"name","InvalidCIDError");class tw extends Error{constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}u(tw,"name","InvalidMultihashError");class zp extends Error{constructor(e="Unsupported protocol error"){super(e),this.name="UnsupportedProtocolError"}}u(zp,"name","UnsupportedProtocolError");class Pt extends Error{constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}}u(Pt,"name","InvalidMessageError");class lB extends Error{constructor(e="Protocol error"){super(e),this.name="ProtocolError"}}u(lB,"name","ProtocolError");class Vp extends Error{constructor(e="Timed out"){super(e),this.name="TimeoutError"}}u(Vp,"name","TimeoutError");class ql extends Error{constructor(e="Not started"){super(e),this.name="NotStartedError"}}u(ql,"name","NotStartedError");class pd extends Error{constructor(e="Dial error"){super(e),this.name="DialError"}}u(pd,"name","DialError");class oy extends Error{constructor(e="Listen error"){super(e),this.name="ListenError"}}u(oy,"name","ListenError");class lS extends Error{constructor(e="Limited connection"){super(e),this.name="LimitedConnectionError"}}u(lS,"name","LimitedConnectionError");class uB extends Error{constructor(e="Too many inbound protocol streams"){super(e),this.name="TooManyInboundProtocolStreamsError"}}u(uB,"name","TooManyInboundProtocolStreamsError");class rw extends Error{constructor(e="Too many outbound protocol streams"){super(e),this.name="TooManyOutboundProtocolStreamsError"}}u(rw,"name","TooManyOutboundProtocolStreamsError");class bu extends Error{constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}u(bu,"name","UnsupportedKeyTypeError");var Ns;class tr extends EventTarget{constructor(){super();et(this,Ns,new Map)}listenerCount(t){const n=he(this,Ns).get(t);return n==null?0:n.length}addEventListener(t,n,i){super.addEventListener(t,n,i);let s=he(this,Ns).get(t);s==null&&(s=[],he(this,Ns).set(t,s)),s.push({callback:n,once:(i!==!0&&i!==!1&&(i==null?void 0:i.once))??!1})}removeEventListener(t,n,i){super.removeEventListener(t.toString(),n??null,i);let s=he(this,Ns).get(t);s!=null&&(s=s.filter(({callback:o})=>o!==n),he(this,Ns).set(t,s))}dispatchEvent(t){const n=super.dispatchEvent(t);let i=he(this,Ns).get(t.type);return i==null||(i=i.filter(({once:s})=>!s),he(this,Ns).set(t.type,i)),n}safeDispatchEvent(t,n={}){return this.dispatchEvent(new CustomEvent(t,n))}}Ns=new WeakMap;function uS(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}async function Ko(...r){const e=[];for(const t of r)uS(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStart!=null&&await t.beforeStart()})),await Promise.all(e.map(async t=>{await t.start()})),await Promise.all(e.map(async t=>{t.afterStart!=null&&await t.afterStart()}))}async function Uc(...r){const e=[];for(const t of r)uS(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStop!=null&&await t.beforeStop()})),await Promise.all(e.map(async t=>{await t.stop()})),await Promise.all(e.map(async t=>{t.afterStop!=null&&await t.afterStop()}))}const lr=Symbol.for("@libp2p/service-capabilities"),Sc=Symbol.for("@libp2p/service-dependencies");function YZ(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function nw(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function XZ(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var JZ=XZ,ZZ=JZ;let eee=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},tee=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return dB(this,e)}},ree=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return dB(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function dB(r,e){return new ree({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let nee=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new eee(e,t,n),this.decoder=new tee(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function hB({name:r,prefix:e,encode:t,decode:n}){return new nee(r,e,t,n)}function iw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=ZZ(t,r);return hB({prefix:e,name:r,encode:n,decode:s=>nw(i(s))})}function iee(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function see(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function ci({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return hB({prefix:e,name:r,encode(i){return see(i,n,t)},decode(i){return iee(i,n,t,r)}})}const Ci=iw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});iw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const Qg=ci({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ci({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});ci({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});ci({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});ci({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});ci({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});ci({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});ci({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});ci({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const B8=iw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});iw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var oee=fB,FC=128,aee=-128,cee=Math.pow(2,31);function fB(r,e,t){e=e||[],t=t||0;for(var n=t;r>=cee;)e[t++]=r&255|FC,r/=128;for(;r&aee;)e[t++]=r&255|FC,r>>>=7;return e[t]=r|0,fB.bytes=t-n+1,e}var lee=gv,uee=128,zC=127;function gv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw gv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&zC)<<i:(o&zC)*Math.pow(2,i),i+=7}while(o>=uee);return gv.bytes=s-n,t}var dee=Math.pow(2,7),hee=Math.pow(2,14),fee=Math.pow(2,21),pee=Math.pow(2,28),gee=Math.pow(2,35),yee=Math.pow(2,42),mee=Math.pow(2,49),wee=Math.pow(2,56),vee=Math.pow(2,63),bee=function(r){return r<dee?1:r<hee?2:r<fee?3:r<pee?4:r<gee?5:r<yee?6:r<mee?7:r<wee?8:r<vee?9:10},Eee={encode:oee,decode:lee,encodingLength:bee},ay=Eee;function yv(r,e=0){return[ay.decode(r,e),ay.decode.bytes]}function cy(r,e,t=0){return ay.encode(r,e,t),e}function ly(r){return ay.encodingLength(r)}function Wl(r,e){const t=e.byteLength,n=ly(r),i=n+ly(t),s=new Uint8Array(i+t);return cy(r,s,0),cy(t,s,n),s.set(e,i),new dS(r,t,e,s)}function See(r){const e=nw(r),[t,n]=yv(e),[i,s]=yv(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new dS(t,i,o,e)}function xee(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&YZ(r.bytes,t.bytes)}}let dS=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function VC(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Iee(t,mv(r),e??Ci.encoder);default:return Cee(t,mv(r),e??Qg.encoder)}}const KC=new WeakMap;function mv(r){const e=KC.get(r);if(e==null){const t=new Map;return KC.set(r,t),t}return e}var iN;let sw=class Fr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,iN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==vf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==kee)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Fr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Wl(e,t);return Fr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Fr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&xee(e.multihash,n.multihash)}toString(e){return VC(this,e)}toJSON(){return{"/":VC(this)}}link(){return this}[(iN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Fr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Fr(n,i,s,o??HC(n,i,s.bytes))}else if(t[_ee]===!0){const{version:n,multihash:i,code:s}=t,o=See(i);return Fr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==vf)throw new Error(`Version 0 CID must use dag-pb (code: ${vf}) block encoding`);return new Fr(e,t,n,n.bytes)}case 1:{const i=HC(e,t,n.bytes);return new Fr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Fr.create(0,vf,e)}static createV1(e,t){return Fr.create(1,e,t)}static decode(e){const[t,n]=Fr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Fr.inspectBytes(e),n=t.size-t.multihashSize,i=nw(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new dS(t.multihashCode,t.digestSize,s,i);return[t.version===0?Fr.createV0(o):Fr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=yv(e.subarray(t));return t+=p,h};let i=n(),s=vf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Aee(e,t),s=Fr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return mv(s).set(n,e),s}};function Aee(r,e){switch(r[0]){case"Q":{const t=e??Ci;return[Ci.prefix,t.decode(`${Ci.prefix}${r}`)]}case Ci.prefix:{const t=e??Ci;return[Ci.prefix,t.decode(r)]}case Qg.prefix:{const t=e??Qg;return[Qg.prefix,t.decode(r)]}case B8.prefix:{const t=e??B8;return[B8.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Iee(r,e,t){const{prefix:n}=t;if(n!==Ci.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Cee(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const vf=112,kee=18;function HC(r,e,t){const n=ly(r),i=n+ly(e),s=new Uint8Array(i+t.byteLength);return cy(r,s,0),cy(e,s,n),s.set(t,i),s}const _ee=Symbol.for("@ipld/js-cid/CID"),pB=0,Tee="identity",gB=nw;function Pee(r){return Wl(pB,gB(r))}const hS={code:pB,name:Tee,encode:gB,digest:Pee};function Xe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function tt(r=0){return new Uint8Array(r)}function Ln(r=0){return new Uint8Array(r)}function ur(r,e){e==null&&(e=r.reduce((i,s)=>i+s.length,0));const t=Ln(e);let n=0;for(const i of r)t.set(i,n),n+=i.length;return t}const yB=Symbol.for("@achingbrain/uint8arraylist");function jC(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(const n of r){const i=t+n.byteLength;if(e<i)return{buf:n,index:e-t};t=i}throw new RangeError("index is out of bounds")}function zf(r){return!!(r!=null&&r[yB])}var sN;class He{constructor(...e){u(this,"bufs");u(this,"length");u(this,sN,!0);this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[(sN=yB,Symbol.iterator)](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(zf(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(zf(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){const t=jC(this.bufs,e);return t.buf[t.index]}set(e,t){const n=jC(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(zf(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){const{bufs:n,length:i}=this._subList(e,t);return ur(n,i)}subarray(e,t){const{bufs:n,length:i}=this._subList(e,t);return n.length===1?n[0]:ur(n,i)}sublist(e,t){const{bufs:n,length:i}=this._subList(e,t),s=new He;return s.length=i,s.bufs=[...n],s}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};const n=[];let i=0;for(let s=0;s<this.bufs.length;s++){const o=this.bufs[s],a=i,c=a+o.byteLength;if(i=c,e>=c)continue;const l=e>=a&&e<c,d=t>a&&t<=c;if(l&&d){if(e===a&&t===c){n.push(o);break}const h=e-a;n.push(o.subarray(h,h+(t-e)));break}if(l){if(e===0){n.push(o);continue}n.push(o.subarray(e-a));continue}if(d){if(t===c){n.push(o);break}n.push(o.subarray(0,t-a));break}n.push(o)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!zf(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const i=n.byteLength;if(i===0)throw new TypeError("search must be at least 1 byte long");const s=256,o=new Int32Array(s);for(let h=0;h<s;h++)o[h]=-1;for(let h=0;h<i;h++)o[n[h]]=h;const a=o,c=this.byteLength-n.byteLength,l=n.byteLength-1;let d;for(let h=t;h<=c;h+=d){d=0;for(let p=l;p>=0;p--){const w=this.get(h+p);if(n[p]!==w){d=Math.max(1,p-a[w]);break}}if(d===0)return h}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const n=Ln(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){const i=tt(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,t,n),this.write(i,e)}getInt32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){const i=tt(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,t,n),this.write(i,e)}getBigInt64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){const i=tt(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,t,n),this.write(i,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const n=Ln(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){const i=tt(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,t,n),this.write(i,e)}getUint32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){const i=tt(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,t,n),this.write(i,e)}getBigUint64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){const i=tt(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,t,n),this.write(i,e)}getFloat32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){const i=tt(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,t,n),this.write(i,e)}getFloat64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){const i=tt(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,t,n),this.write(i,e)}equals(e){if(e==null||!(e instanceof He)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!Xe(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const n=new He;return n.bufs=e,t==null&&(t=e.reduce((i,s)=>i+s.byteLength,0)),n.length=t,n}}function Dee(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function $ee(r){return new TextEncoder().encode(r)}function Nee(r){return new TextDecoder().decode(r)}function Oee(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var Mee=Oee,Ree=Mee;let Lee=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Bee=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return mB(this,e)}},Uee=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return mB(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function mB(r,e){return new Uee({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Fee=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Lee(e,t,n),this.decoder=new Bee(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function ow({name:r,prefix:e,encode:t,decode:n}){return new Fee(r,e,t,n)}function Kp({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Ree(t,r);return ow({prefix:e,name:r,encode:n,decode:s=>Dee(i(s))})}function zee(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Vee(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function $r({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return ow({prefix:e,name:r,encode(i){return Vee(i,n,t)},decode(i){return zee(i,n,t,r)}})}const Kee=Kp({prefix:"9",name:"base10",alphabet:"0123456789"}),Hee=Object.freeze(Object.defineProperty({__proto__:null,base10:Kee},Symbol.toStringTag,{value:"Module"})),jee=$r({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),qee=$r({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Wee=Object.freeze(Object.defineProperty({__proto__:null,base16:jee,base16upper:qee},Symbol.toStringTag,{value:"Module"})),Gee=$r({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Qee=Object.freeze(Object.defineProperty({__proto__:null,base2:Gee},Symbol.toStringTag,{value:"Module"})),wB=Array.from(""),Yee=wB.reduce((r,e,t)=>(r[t]=e,r),[]),Xee=wB.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function Jee(r){return r.reduce((e,t)=>(e+=Yee[t],e),"")}function Zee(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const i=Xee[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const ete=ow({prefix:"",name:"base256emoji",encode:Jee,decode:Zee}),tte=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:ete},Symbol.toStringTag,{value:"Module"})),rte=$r({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),nte=$r({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ite=$r({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ste=$r({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ote=$r({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ate=$r({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),cte=$r({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),lte=$r({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ute=$r({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),dte=Object.freeze(Object.defineProperty({__proto__:null,base32:rte,base32hex:ote,base32hexpad:cte,base32hexpadupper:lte,base32hexupper:ate,base32pad:ite,base32padupper:ste,base32upper:nte,base32z:ute},Symbol.toStringTag,{value:"Module"})),hte=Kp({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),fte=Kp({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),pte=Object.freeze(Object.defineProperty({__proto__:null,base36:hte,base36upper:fte},Symbol.toStringTag,{value:"Module"})),gte=Kp({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),yte=Kp({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),mte=Object.freeze(Object.defineProperty({__proto__:null,base58btc:gte,base58flickr:yte},Symbol.toStringTag,{value:"Module"})),wte=$r({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),vte=$r({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),bte=$r({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ete=$r({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Ste=Object.freeze(Object.defineProperty({__proto__:null,base64:wte,base64pad:vte,base64url:bte,base64urlpad:Ete},Symbol.toStringTag,{value:"Module"})),xte=$r({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Ate=Object.freeze(Object.defineProperty({__proto__:null,base8:xte},Symbol.toStringTag,{value:"Module"})),Ite=ow({prefix:"\0",name:"identity",encode:r=>Nee(r),decode:r=>$ee(r)}),Cte=Object.freeze(Object.defineProperty({__proto__:null,identity:Ite},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const qC={...Cte,...Qee,...Ate,...Hee,...Wee,...dte,...pte,...mte,...Ste,...tte};function vB(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const WC=vB("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),U8=vB("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=Ln(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),bB={utf8:WC,"utf-8":WC,hex:qC.base16,latin1:U8,ascii:U8,binary:U8,...qC};function fe(r,e="utf8"){const t=bB[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}function ae(r,e="utf8"){const t=bB[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}const kte=parseInt("11111",2),wv=parseInt("10000000",2),_te=parseInt("01111111",2),GC={0:bf,1:bf,2:Tte,3:$te,4:Nte,5:Dte,6:Pte,16:bf,22:bf,48:bf};function Fc(r,e={offset:0}){const t=r[e.offset]&kte;if(e.offset++,GC[t]!=null)return GC[t](r,e);throw new Error("No decoder for tag "+t)}function Hp(r,e){let t=0;if((r[e.offset]&wv)===wv){const n=r[e.offset]&_te;let i="0x";e.offset++;for(let s=0;s<n;s++,e.offset++)i+=r[e.offset].toString(16).padStart(2,"0");t=parseInt(i,16)}else t=r[e.offset],e.offset++;return t}function bf(r,e){Hp(r,e);const t=[];for(;!(e.offset>=r.byteLength);){const n=Fc(r,e);if(n===null)break;t.push(n)}return t}function Tte(r,e){const t=Hp(r,e),n=e.offset,i=e.offset+t,s=[];for(let o=n;o<i;o++)o===n&&r[o]===0||s.push(r[o]);return e.offset+=t,Uint8Array.from(s)}function Pte(r,e){const t=Hp(r,e),n=e.offset+t,i=r[e.offset];e.offset++;let s=0,o=0;i<40?(s=0,o=i):i<80?(s=1,o=i-40):(s=2,o=i-80);let a=`${s}.${o}`,c=[];for(;e.offset<n;){const l=r[e.offset];if(e.offset++,c.push(l&127),l<128){c.reverse();let d=0;for(let h=0;h<c.length;h++)d+=c[h]<<h*7;a+=`.${d}`,c=[]}}return a}function Dte(r,e){return e.offset++,null}function $te(r,e){const t=Hp(r,e),n=r[e.offset];e.offset++;const i=r.subarray(e.offset,e.offset+t-1);if(e.offset+=t,n!==0)throw new Error("Unused bits in bit string is unimplemented");return i}function Nte(r,e){const t=Hp(r,e),n=r.subarray(e.offset,e.offset+t);return e.offset+=t,n}function Ote(r){let e=r.toString(16);e.length%2===1&&(e="0"+e);const t=new He;for(let n=0;n<e.length;n+=2)t.append(Uint8Array.from([parseInt(`${e[n]}${e[n+1]}`,16)]));return t}function aw(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);const e=Ote(r.byteLength);return new He(Uint8Array.from([e.byteLength|wv]),e)}function Gn(r){const e=new He,t=128;return(r.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(r),new He(Uint8Array.from([2]),aw(e),e)}function fS(r){const e=Uint8Array.from([0]),t=new He(e,r);return new He(Uint8Array.from([3]),aw(t),t)}function Mte(r){return new He(Uint8Array.from([4]),aw(r),r)}function Do(r,e=48){const t=new He;for(const n of r)t.append(n);return new He(Uint8Array.from([e]),aw(t),t)}const EB="1.2.840.10045.3.1.7",SB="1.3.132.0.34",xB="1.3.132.0.35";async function Rte(r="P-256"){const e=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:r},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",e.publicKey),privateKey:await crypto.subtle.exportKey("jwk",e.privateKey)}}async function Lte(r,e){const t=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["sign"]),n=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},t,e.subarray());return new Uint8Array(n,0,n.byteLength)}async function Bte(r,e,t){const n=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["verify"]);return crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},n,e,t.subarray())}const Ute=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),Fte=Uint8Array.from([6,5,43,129,4,0,34]),zte=Uint8Array.from([6,5,43,129,4,0,35]),AB={ext:!0,kty:"EC",crv:"P-256"},IB={ext:!0,kty:"EC",crv:"P-384"},CB={ext:!0,kty:"EC",crv:"P-521"},gd=32,yd=48,md=66;function Vte(r){const e=Fc(r);return kB(e)}function kB(r){const e=r[1],t=ae(e,"base64url"),n=r[2][1][0],i=1;let s,o;if(e.byteLength===gd)return s=ae(n.subarray(i,i+gd),"base64url"),o=ae(n.subarray(i+gd),"base64url"),new Xg({...AB,key_ops:["sign"],d:t,x:s,y:o});if(e.byteLength===yd)return s=ae(n.subarray(i,i+yd),"base64url"),o=ae(n.subarray(i+yd),"base64url"),new Xg({...IB,key_ops:["sign"],d:t,x:s,y:o});if(e.byteLength===md)return s=ae(n.subarray(i,i+md),"base64url"),o=ae(n.subarray(i+md),"base64url"),new Xg({...CB,key_ops:["sign"],d:t,x:s,y:o});throw new ie(`Private key length was wrong length, got ${e.byteLength}, expected 32, 48 or 66`)}function _B(r){const e=Fc(r);return TB(e)}function TB(r){const e=r[1][1][0],t=1;let n,i;if(e.byteLength===gd*2+1)return n=ae(e.subarray(t,t+gd),"base64url"),i=ae(e.subarray(t+gd),"base64url"),new Yg({...AB,key_ops:["verify"],x:n,y:i});if(e.byteLength===yd*2+1)return n=ae(e.subarray(t,t+yd),"base64url"),i=ae(e.subarray(t+yd),"base64url"),new Yg({...IB,key_ops:["verify"],x:n,y:i});if(e.byteLength===md*2+1)return n=ae(e.subarray(t,t+md),"base64url"),i=ae(e.subarray(t+md),"base64url"),new Yg({...CB,key_ops:["verify"],x:n,y:i});throw new ie(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function Kte(r){return Do([Gn(Uint8Array.from([1])),Mte(fe(r.d??"","base64url")),Do([PB(r.crv)],160),Do([fS(new He(Uint8Array.from([4]),fe(r.x??"","base64url"),fe(r.y??"","base64url")))],161)]).subarray()}function Hte(r){return Do([Gn(Uint8Array.from([1])),Do([PB(r.crv)],160),Do([fS(new He(Uint8Array.from([4]),fe(r.x??"","base64url"),fe(r.y??"","base64url")))],161)]).subarray()}function PB(r){if(r==="P-256")return Ute;if(r==="P-384")return Fte;if(r==="P-521")return zte;throw new ie(`Invalid curve ${r}`)}async function jte(r="P-256"){const e=await Rte(r);return new Xg(e.privateKey)}class Yg{constructor(e){u(this,"type","ECDSA");u(this,"jwk");u(this,"_raw");this.jwk=e}get raw(){return this._raw==null&&(this._raw=Hte(this.jwk)),this._raw}toMultihash(){return hS.digest(Oi(this))}toCID(){return sw.createV1(114,this.toMultihash())}toString(){return Ci.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Xe(this.raw,e.raw)}async verify(e,t){return Bte(this.jwk,t,e)}}class Xg{constructor(e){u(this,"type","ECDSA");u(this,"jwk");u(this,"publicKey");u(this,"_raw");this.jwk=e,this.publicKey=new Yg({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){return this._raw==null&&(this._raw=Kte(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Xe(this.raw,e.raw)}async sign(e){return Lte(this.jwk,e)}}function QC(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function qte(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function cw(r,...e){if(!qte(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Wte(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");QC(r.outputLen),QC(r.blockLen)}function uy(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Gte(r,e){cw(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const Ou=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function F8(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function Is(r,e){return r<<32-e|r>>>e}typeof Uint8Array.from([]).toHex=="function"&&Uint8Array.fromHex;function Qte(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function pS(r){return typeof r=="string"&&(r=Qte(r)),cw(r),r}function Yte(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];cw(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const s=r[n];t.set(s,i),i+=s.length}return t}let DB=class{clone(){return this._cloneInto()}};function $B(r){const e=n=>r().update(pS(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function gS(r=32){if(Ou&&typeof Ou.getRandomValues=="function")return Ou.getRandomValues(new Uint8Array(r));if(Ou&&typeof Ou.randomBytes=="function")return Uint8Array.from(Ou.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function Xte(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function Jte(r,e,t){return r&e^~r&t}function Zte(r,e,t){return r&e^r&t^e&t}let NB=class extends DB{constructor(e,t,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=F8(this.buffer)}update(e){uy(this);const{view:t,buffer:n,blockLen:i}=this;e=pS(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=F8(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){uy(this),Gte(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)t[h]=0;Xte(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=F8(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,d[h],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%t&&e.buffer.set(n),e}};const ere=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ma=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),wa=new Uint32Array(64);let tre=class extends NB{constructor(e=32){super(64,e,8,!1),this.A=ma[0]|0,this.B=ma[1]|0,this.C=ma[2]|0,this.D=ma[3]|0,this.E=ma[4]|0,this.F=ma[5]|0,this.G=ma[6]|0,this.H=ma[7]|0}get(){const{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)wa[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const p=wa[h-15],w=wa[h-2],f=Is(p,7)^Is(p,18)^p>>>3,g=Is(w,17)^Is(w,19)^w>>>10;wa[h]=g+wa[h-7]+f+wa[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:l,H:d}=this;for(let h=0;h<64;h++){const p=Is(a,6)^Is(a,11)^Is(a,25),w=d+p+Jte(a,c,l)+ere[h]+wa[h]|0,g=(Is(n,2)^Is(n,13)^Is(n,22))+Zte(n,i,s)|0;d=l,l=c,c=a,a=o+w|0,o=s,s=i,i=n,n=w+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(n,i,s,o,a,c,l,d)}roundClean(){wa.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const rre=$B(()=>new tre),G0=BigInt(2**32-1),vv=BigInt(32);function OB(r,e=!1){return e?{h:Number(r&G0),l:Number(r>>vv&G0)}:{h:Number(r>>vv&G0)|0,l:Number(r&G0)|0}}function nre(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let i=0;i<r.length;i++){const{h:s,l:o}=OB(r[i],e);[t[i],n[i]]=[s,o]}return[t,n]}const ire=(r,e)=>BigInt(r>>>0)<<vv|BigInt(e>>>0),sre=(r,e,t)=>r>>>t,ore=(r,e,t)=>r<<32-t|e>>>t,are=(r,e,t)=>r>>>t|e<<32-t,cre=(r,e,t)=>r<<32-t|e>>>t,lre=(r,e,t)=>r<<64-t|e>>>t-32,ure=(r,e,t)=>r>>>t-32|e<<64-t,dre=(r,e)=>e,hre=(r,e)=>r,fre=(r,e,t)=>r<<t|e>>>32-t,pre=(r,e,t)=>e<<t|r>>>32-t,gre=(r,e,t)=>e<<t-32|r>>>64-t,yre=(r,e,t)=>r<<t-32|e>>>64-t;function mre(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}const wre=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),vre=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,bre=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),Ere=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,Sre=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0),xre=(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0,Ge={fromBig:OB,split:nre,toBig:ire,shrSH:sre,shrSL:ore,rotrSH:are,rotrSL:cre,rotrBH:lre,rotrBL:ure,rotr32H:dre,rotr32L:hre,rotlSH:fre,rotlSL:pre,rotlBH:gre,rotlBL:yre,add:mre,add3L:wre,add3H:vre,add4L:bre,add4H:Ere,add5H:xre,add5L:Sre},[Are,Ire]=Ge.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),va=new Uint32Array(80),ba=new Uint32Array(80);let Cre=class extends NB{constructor(e=64){super(128,e,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:d,Fh:h,Fl:p,Gh:w,Gl:f,Hh:g,Hl:v}=this;return[e,t,n,i,s,o,a,c,l,d,h,p,w,f,g,v]}set(e,t,n,i,s,o,a,c,l,d,h,p,w,f,g,v){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=d|0,this.Fh=h|0,this.Fl=p|0,this.Gh=w|0,this.Gl=f|0,this.Hh=g|0,this.Hl=v|0}process(e,t){for(let b=0;b<16;b++,t+=4)va[b]=e.getUint32(t),ba[b]=e.getUint32(t+=4);for(let b=16;b<80;b++){const S=va[b-15]|0,I=ba[b-15]|0,T=Ge.rotrSH(S,I,1)^Ge.rotrSH(S,I,8)^Ge.shrSH(S,I,7),A=Ge.rotrSL(S,I,1)^Ge.rotrSL(S,I,8)^Ge.shrSL(S,I,7),_=va[b-2]|0,$=ba[b-2]|0,z=Ge.rotrSH(_,$,19)^Ge.rotrBH(_,$,61)^Ge.shrSH(_,$,6),j=Ge.rotrSL(_,$,19)^Ge.rotrBL(_,$,61)^Ge.shrSL(_,$,6),K=Ge.add4L(A,j,ba[b-7],ba[b-16]),Z=Ge.add4H(K,T,z,va[b-7],va[b-16]);va[b]=Z|0,ba[b]=K|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:d,Eh:h,El:p,Fh:w,Fl:f,Gh:g,Gl:v,Hh:y,Hl:m}=this;for(let b=0;b<80;b++){const S=Ge.rotrSH(h,p,14)^Ge.rotrSH(h,p,18)^Ge.rotrBH(h,p,41),I=Ge.rotrSL(h,p,14)^Ge.rotrSL(h,p,18)^Ge.rotrBL(h,p,41),T=h&w^~h&g,A=p&f^~p&v,_=Ge.add5L(m,I,A,Ire[b],ba[b]),$=Ge.add5H(_,y,S,T,Are[b],va[b]),z=_|0,j=Ge.rotrSH(n,i,28)^Ge.rotrBH(n,i,34)^Ge.rotrBH(n,i,39),K=Ge.rotrSL(n,i,28)^Ge.rotrBL(n,i,34)^Ge.rotrBL(n,i,39),Z=n&s^n&a^s&a,G=i&o^i&c^o&c;y=g|0,m=v|0,g=w|0,v=f|0,w=h|0,f=p|0,{h,l:p}=Ge.add(l|0,d|0,$|0,z|0),l=a|0,d=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const Q=Ge.add3L(z,K,G);n=Ge.add3H(Q,$,j,Z),i=Q|0}({h:n,l:i}=Ge.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=Ge.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Ge.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:d}=Ge.add(this.Dh|0,this.Dl|0,l|0,d|0),{h,l:p}=Ge.add(this.Eh|0,this.El|0,h|0,p|0),{h:w,l:f}=Ge.add(this.Fh|0,this.Fl|0,w|0,f|0),{h:g,l:v}=Ge.add(this.Gh|0,this.Gl|0,g|0,v|0),{h:y,l:m}=Ge.add(this.Hh|0,this.Hl|0,y|0,m|0),this.set(n,i,s,o,a,c,l,d,h,p,w,f,g,v,y,m)}roundClean(){va.fill(0),ba.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const kre=$B(()=>new Cre);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const yS=BigInt(0),bv=BigInt(1);function qd(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function mS(r){if(!qd(r))throw new Error("Uint8Array expected")}function hc(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}function Q0(r){const e=r.toString(16);return e.length&1?"0"+e:e}function MB(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?yS:BigInt("0x"+r)}const RB=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",_re=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Wd(r){if(mS(r),RB)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=_re[r[t]];return e}const co={_0:48,_9:57,A:65,F:70,a:97,f:102};function YC(r){if(r>=co._0&&r<=co._9)return r-co._0;if(r>=co.A&&r<=co.F)return r-(co.A-10);if(r>=co.a&&r<=co.f)return r-(co.a-10)}function dy(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(RB)return Uint8Array.fromHex(r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let i=0,s=0;i<t;i++,s+=2){const o=YC(r.charCodeAt(s)),a=YC(r.charCodeAt(s+1));if(o===void 0||a===void 0){const c=r[s]+r[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function Dl(r){return MB(Wd(r))}function $l(r){return mS(r),MB(Wd(Uint8Array.from(r).reverse()))}function K1(r,e){return dy(r.toString(16).padStart(e*2,"0"))}function H1(r,e){return K1(r,e).reverse()}function Yt(r,e,t){let n;if(typeof e=="string")try{n=dy(e)}catch(s){throw new Error(r+" must be hex string or Uint8Array, cause: "+s)}else if(qd(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const i=n.length;if(typeof t=="number"&&i!==t)throw new Error(r+" of length "+t+" expected, got "+i);return n}function Gd(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];mS(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const s=r[n];t.set(s,i),i+=s.length}return t}const z8=r=>typeof r=="bigint"&&yS<=r;function wS(r,e,t){return z8(r)&&z8(e)&&z8(t)&&e<=r&&r<t}function Jn(r,e,t,n){if(!wS(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function Tre(r){let e;for(e=0;r>yS;r>>=bv,e+=1);return e}const lw=r=>(bv<<BigInt(r))-bv,V8=r=>new Uint8Array(r),XC=r=>Uint8Array.from(r);function Pre(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=V8(r),i=V8(r),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...h)=>t(i,n,...h),c=(h=V8(0))=>{i=a(XC([0]),h),n=a(),h.length!==0&&(i=a(XC([1]),h),n=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const p=[];for(;h<e;){n=a();const w=n.slice();p.push(w),h+=n.length}return Gd(...p)};return(h,p)=>{o(),c(h);let w;for(;!(w=p(l()));)c();return o(),w}}const Dre={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||qd(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function Nh(r,e,t={}){const n=(i,s,o)=>{const a=Dre[s];if(typeof a!="function")throw new Error("invalid validator function");const c=r[i];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(t))n(i,s,!0);return r}function hy(r){const e=new WeakMap;return(t,...n)=>{const i=e.get(t);if(i!==void 0)return i;const s=r(t,...n);return e.set(t,s),s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const mr=BigInt(0),Ht=BigInt(1),ll=BigInt(2),$re=BigInt(3),Ev=BigInt(4),JC=BigInt(5),ZC=BigInt(8);function Tt(r,e){const t=r%e;return t>=mr?t:e+t}function LB(r,e,t){if(e<mr)throw new Error("invalid exponent, negatives unsupported");if(t<=mr)throw new Error("invalid modulus");if(t===Ht)return mr;let n=Ht;for(;e>mr;)e&Ht&&(n=n*r%t),r=r*r%t,e>>=Ht;return n}function Vt(r,e,t){let n=r;for(;e-- >mr;)n*=n,n%=t;return n}function Sv(r,e){if(r===mr)throw new Error("invert: expected non-zero number");if(e<=mr)throw new Error("invert: expected positive modulus, got "+e);let t=Tt(r,e),n=e,i=mr,s=Ht;for(;t!==mr;){const a=n/t,c=n%t,l=i-s*a;n=t,t=c,i=s,s=l}if(n!==Ht)throw new Error("invert: does not exist");return Tt(i,e)}function Nre(r){const e=(r-Ht)/ll;let t,n,i;for(t=r-Ht,n=0;t%ll===mr;t/=ll,n++);for(i=ll;i<r&&LB(i,e,r)!==r-Ht;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(r+Ht)/Ev;return function(c,l){const d=c.pow(l,o);if(!c.eql(c.sqr(d),l))throw new Error("Cannot find square root");return d}}const s=(t+Ht)/ll;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=n,d=a.pow(a.mul(a.ONE,i),t),h=a.pow(c,s),p=a.pow(c,t);for(;!a.eql(p,a.ONE);){if(a.eql(p,a.ZERO))return a.ZERO;let w=1;for(let g=a.sqr(p);w<l&&!a.eql(g,a.ONE);w++)g=a.sqr(g);const f=a.pow(d,Ht<<BigInt(l-w-1));d=a.sqr(f),h=a.mul(h,f),p=a.mul(p,d),l=w}return h}}function Ore(r){if(r%Ev===$re){const e=(r+Ht)/Ev;return function(n,i){const s=n.pow(i,e);if(!n.eql(n.sqr(s),i))throw new Error("Cannot find square root");return s}}if(r%ZC===JC){const e=(r-JC)/ZC;return function(n,i){const s=n.mul(i,ll),o=n.pow(s,e),a=n.mul(i,o),c=n.mul(n.mul(a,ll),o),l=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(l),i))throw new Error("Cannot find square root");return l}}return Nre(r)}const Mre=(r,e)=>(Tt(r,e)&Ht)===Ht,Rre=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Lre(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=Rre.reduce((n,i)=>(n[i]="function",n),e);return Nh(r,t)}function Bre(r,e,t){if(t<mr)throw new Error("invalid exponent, negatives unsupported");if(t===mr)return r.ONE;if(t===Ht)return e;let n=r.ONE,i=e;for(;t>mr;)t&Ht&&(n=r.mul(n,i)),i=r.sqr(i),t>>=Ht;return n}function Ure(r,e){const t=new Array(e.length),n=e.reduce((s,o,a)=>r.is0(o)?s:(t[a]=s,r.mul(s,o)),r.ONE),i=r.inv(n);return e.reduceRight((s,o,a)=>r.is0(o)?s:(t[a]=r.mul(s,t[a]),r.mul(s,o)),i),t}function BB(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function uw(r,e,t=!1,n={}){if(r<=mr)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:i,nByteLength:s}=BB(r,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:r,isLE:t,BITS:i,BYTES:s,MASK:lw(i),ZERO:mr,ONE:Ht,create:c=>Tt(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return mr<=c&&c<r},is0:c=>c===mr,isOdd:c=>(c&Ht)===Ht,neg:c=>Tt(-c,r),eql:(c,l)=>c===l,sqr:c=>Tt(c*c,r),add:(c,l)=>Tt(c+l,r),sub:(c,l)=>Tt(c-l,r),mul:(c,l)=>Tt(c*l,r),pow:(c,l)=>Bre(a,c,l),div:(c,l)=>Tt(c*Sv(l,r),r),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Sv(c,r),sqrt:n.sqrt||(c=>(o||(o=Ore(r)),o(a,c))),invertBatch:c=>Ure(a,c),cmov:(c,l,d)=>d?l:c,toBytes:c=>t?H1(c,s):K1(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return t?$l(c):Dl(c)}});return Object.freeze(a)}function UB(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function FB(r){const e=UB(r);return e+Math.ceil(e/2)}function Fre(r,e,t=!1){const n=r.length,i=UB(e),s=FB(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=t?$l(r):Dl(r),a=Tt(o,e-Ht)+Ht;return t?H1(a,i):K1(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ek=BigInt(0),xv=BigInt(1);function K8(r,e){const t=e.negate();return r?t:e}function zB(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function H8(r,e){zB(r,e);const t=Math.ceil(e/r)+1,n=2**(r-1),i=2**r,s=lw(r),o=BigInt(r);return{windows:t,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function tk(r,e,t){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=t;let a=Number(r&i),c=r>>o;a>n&&(a-=s,c+=xv);const l=e*n,d=l+Math.abs(a)-1,h=a===0,p=a<0,w=e%2!==0;return{nextN:c,offset:d,isZero:h,isNeg:p,isNegF:w,offsetF:l}}function zre(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function Vre(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}const j8=new WeakMap,VB=new WeakMap;function q8(r){return VB.get(r)||1}function KB(r,e){return{constTimeNegate:K8,hasPrecomputes(t){return q8(t)!==1},unsafeLadder(t,n,i=r.ZERO){let s=t;for(;n>ek;)n&xv&&(i=i.add(s)),s=s.double(),n>>=xv;return i},precomputeWindow(t,n){const{windows:i,windowSize:s}=H8(n,e),o=[];let a=t,c=a;for(let l=0;l<i;l++){c=a,o.push(c);for(let d=1;d<s;d++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,n,i){let s=r.ZERO,o=r.BASE;const a=H8(t,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:d,isZero:h,isNeg:p,isNegF:w,offsetF:f}=tk(i,c,a);i=l,h?o=o.add(K8(w,n[f])):s=s.add(K8(p,n[d]))}return{p:s,f:o}},wNAFUnsafe(t,n,i,s=r.ZERO){const o=H8(t,e);for(let a=0;a<o.windows&&i!==ek;a++){const{nextN:c,offset:l,isZero:d,isNeg:h}=tk(i,a,o);if(i=c,!d){const p=n[l];s=s.add(h?p.negate():p)}}return s},getPrecomputes(t,n,i){let s=j8.get(n);return s||(s=this.precomputeWindow(n,t),t!==1&&j8.set(n,i(s))),s},wNAFCached(t,n,i){const s=q8(t);return this.wNAF(s,this.getPrecomputes(s,t,i),n)},wNAFCachedUnsafe(t,n,i,s){const o=q8(t);return o===1?this.unsafeLadder(t,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,t,i),n,s)},setWindowSize(t,n){zB(n,e),VB.set(t,n),j8.delete(t)}}}function HB(r,e,t,n){if(zre(t,r),Vre(n,e),t.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=r.ZERO,s=Tre(BigInt(t.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=lw(o),c=new Array(Number(a)+1).fill(i),l=Math.floor((e.BITS-1)/o)*o;let d=i;for(let h=l;h>=0;h-=o){c.fill(i);for(let w=0;w<n.length;w++){const f=n[w],g=Number(f>>BigInt(h)&a);c[g]=c[g].add(t[w])}let p=i;for(let w=c.length-1,f=i;w>0;w--)f=f.add(c[w]),p=p.add(f);if(d=d.add(p),h!==0)for(let w=0;w<o;w++)d=d.double()}return d}function vS(r){return Lre(r.Fp),Nh(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...BB(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Cs=BigInt(0),on=BigInt(1),rk=BigInt(2),Kre=BigInt(8),Hre={zip215:!0};function jre(r){const e=vS(r);return Nh(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function qre(r){const e=jre(r),{Fp:t,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,l=rk<<BigInt(a*8)-on,d=t.create,h=uw(e.n,e.nBitLength),p=e.uvRatio||((q,B)=>{try{return{isValid:!0,value:t.sqrt(q*t.inv(B))}}catch{return{isValid:!1,value:Cs}}}),w=e.adjustScalarBytes||(q=>q),f=e.domain||((q,B,V)=>{if(hc("phflag",V),B.length||V)throw new Error("Contexts/pre-hash are not supported");return q});function g(q,B,V=!1){const W=V?on:Cs;Jn("coordinate "+q,B,W,l)}function v(q){if(!(q instanceof b))throw new Error("ExtendedPoint expected")}const y=hy((q,B)=>{const{ex:V,ey:W,ez:ee}=q,Y=q.is0();B==null&&(B=Y?Kre:t.inv(ee));const ce=d(V*B),pe=d(W*B),ue=d(ee*B);if(Y)return{x:Cs,y:on};if(ue!==on)throw new Error("invZ was invalid");return{x:ce,y:pe}}),m=hy(q=>{const{a:B,d:V}=e;if(q.is0())throw new Error("bad point: ZERO");const{ex:W,ey:ee,ez:Y,et:ce}=q,pe=d(W*W),ue=d(ee*ee),le=d(Y*Y),Me=d(le*le),_e=d(pe*B),ze=d(le*d(_e+ue)),Qe=d(Me+d(V*d(pe*ue)));if(ze!==Qe)throw new Error("bad point: equation left != right (1)");const pt=d(W*ee),wt=d(Y*ce);if(pt!==wt)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(B,V,W,ee){g("x",B),g("y",V),g("z",W,!0),g("t",ee),this.ex=B,this.ey=V,this.ez=W,this.et=ee,Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(B){if(B instanceof b)throw new Error("extended point not allowed");const{x:V,y:W}=B||{};return g("x",V),g("y",W),new b(V,W,on,d(V*W))}static normalizeZ(B){const V=t.invertBatch(B.map(W=>W.ez));return B.map((W,ee)=>W.toAffine(V[ee])).map(b.fromAffine)}static msm(B,V){return HB(b,h,B,V)}_setWindowSize(B){T.setWindowSize(this,B)}assertValidity(){m(this)}equals(B){v(B);const{ex:V,ey:W,ez:ee}=this,{ex:Y,ey:ce,ez:pe}=B,ue=d(V*pe),le=d(Y*ee),Me=d(W*pe),_e=d(ce*ee);return ue===le&&Me===_e}is0(){return this.equals(b.ZERO)}negate(){return new b(d(-this.ex),this.ey,this.ez,d(-this.et))}double(){const{a:B}=e,{ex:V,ey:W,ez:ee}=this,Y=d(V*V),ce=d(W*W),pe=d(rk*d(ee*ee)),ue=d(B*Y),le=V+W,Me=d(d(le*le)-Y-ce),_e=ue+ce,ze=_e-pe,Qe=ue-ce,pt=d(Me*ze),wt=d(_e*Qe),P=d(Me*Qe),E=d(ze*_e);return new b(pt,wt,E,P)}add(B){v(B);const{a:V,d:W}=e,{ex:ee,ey:Y,ez:ce,et:pe}=this,{ex:ue,ey:le,ez:Me,et:_e}=B,ze=d(ee*ue),Qe=d(Y*le),pt=d(pe*W*_e),wt=d(ce*Me),P=d((ee+Y)*(ue+le)-ze-Qe),E=wt-pt,C=wt+pt,U=d(Qe-V*ze),te=d(P*E),Te=d(C*U),ot=d(P*U),at=d(E*C);return new b(te,Te,at,ot)}subtract(B){return this.add(B.negate())}wNAF(B){return T.wNAFCached(this,B,b.normalizeZ)}multiply(B){const V=B;Jn("scalar",V,on,n);const{p:W,f:ee}=this.wNAF(V);return b.normalizeZ([W,ee])[0]}multiplyUnsafe(B,V=b.ZERO){const W=B;return Jn("scalar",W,Cs,n),W===Cs?I:this.is0()||W===on?this:T.wNAFCachedUnsafe(this,W,b.normalizeZ,V)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return T.unsafeLadder(this,n).is0()}toAffine(B){return y(this,B)}clearCofactor(){const{h:B}=e;return B===on?this:this.multiplyUnsafe(B)}static fromHex(B,V=!1){const{d:W,a:ee}=e,Y=t.BYTES;B=Yt("pointHex",B,Y),hc("zip215",V);const ce=B.slice(),pe=B[Y-1];ce[Y-1]=pe&-129;const ue=$l(ce),le=V?l:t.ORDER;Jn("pointHex.y",ue,Cs,le);const Me=d(ue*ue),_e=d(Me-on),ze=d(W*Me-ee);let{isValid:Qe,value:pt}=p(_e,ze);if(!Qe)throw new Error("Point.fromHex: invalid y coordinate");const wt=(pt&on)===on,P=(pe&128)!==0;if(!V&&pt===Cs&&P)throw new Error("Point.fromHex: x=0 and x_0=1");return P!==wt&&(pt=d(-pt)),b.fromAffine({x:pt,y:ue})}static fromPrivateKey(B){const{scalar:V}=$(B);return S.multiply(V)}toRawBytes(){const{x:B,y:V}=this.toAffine(),W=H1(V,t.BYTES);return W[W.length-1]|=B&on?128:0,W}toHex(){return Wd(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,on,d(e.Gx*e.Gy)),b.ZERO=new b(Cs,on,on,Cs);const{BASE:S,ZERO:I}=b,T=KB(b,a*8);function A(q){return Tt(q,n)}function _(q){return A($l(q))}function $(q){const B=t.BYTES;q=Yt("private key",q,B);const V=Yt("hashed private key",s(q),2*B),W=w(V.slice(0,B)),ee=V.slice(B,2*B),Y=_(W);return{head:W,prefix:ee,scalar:Y}}function z(q){const{head:B,prefix:V,scalar:W}=$(q),ee=S.multiply(W),Y=ee.toRawBytes();return{head:B,prefix:V,scalar:W,point:ee,pointBytes:Y}}function j(q){return z(q).pointBytes}function K(q=new Uint8Array,...B){const V=Gd(...B);return _(s(f(V,Yt("context",q),!!i)))}function Z(q,B,V={}){q=Yt("message",q),i&&(q=i(q));const{prefix:W,scalar:ee,pointBytes:Y}=z(B),ce=K(V.context,W,q),pe=S.multiply(ce).toRawBytes(),ue=K(V.context,pe,Y,q),le=A(ce+ue*ee);Jn("signature.s",le,Cs,n);const Me=Gd(pe,H1(le,t.BYTES));return Yt("result",Me,t.BYTES*2)}const G=Hre;function Q(q,B,V,W=G){const{context:ee,zip215:Y}=W,ce=t.BYTES;q=Yt("signature",q,2*ce),B=Yt("message",B),V=Yt("publicKey",V,ce),Y!==void 0&&hc("zip215",Y),i&&(B=i(B));const pe=$l(q.slice(ce,2*ce));let ue,le,Me;try{ue=b.fromHex(V,Y),le=b.fromHex(q.slice(0,ce),Y),Me=S.multiplyUnsafe(pe)}catch{return!1}if(!Y&&ue.isSmallOrder())return!1;const _e=K(ee,le.toRawBytes(),ue.toRawBytes(),B);return le.add(ue.multiplyUnsafe(_e)).subtract(Me).clearCofactor().equals(b.ZERO)}return S._setWindowSize(8),{CURVE:e,getPublicKey:j,sign:Z,verify:Q,ExtendedPoint:b,utils:{getExtendedPublicKey:z,randomPrivateKey:()=>o(t.BYTES),precompute(q=8,B=b.BASE){return B._setWindowSize(q),B.multiply(BigInt(3)),B}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Mu=BigInt(0),W8=BigInt(1);function Wre(r){return Nh(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function Gre(r){const e=Wre(r),{P:t}=e,n=m=>Tt(m,t),i=e.montgomeryBits,s=Math.ceil(i/8),o=e.nByteLength,a=e.adjustScalarBytes||(m=>m),c=e.powPminus2||(m=>LB(m,t-BigInt(2),t));function l(m,b,S){const I=n(m*(b-S));return b=n(b-I),S=n(S+I),[b,S]}const d=(e.a-BigInt(2))/BigInt(4);function h(m,b){Jn("u",m,Mu,t),Jn("scalar",b,Mu,t);const S=b,I=m;let T=W8,A=Mu,_=m,$=W8,z=Mu,j;for(let Z=BigInt(i-1);Z>=Mu;Z--){const G=S>>Z&W8;z^=G,j=l(z,T,_),T=j[0],_=j[1],j=l(z,A,$),A=j[0],$=j[1],z=G;const Q=T+A,J=n(Q*Q),q=T-A,B=n(q*q),V=J-B,W=_+$,ee=_-$,Y=n(ee*Q),ce=n(W*q),pe=Y+ce,ue=Y-ce;_=n(pe*pe),$=n(I*n(ue*ue)),T=n(J*B),A=n(V*(J+n(d*V)))}j=l(z,T,_),T=j[0],_=j[1],j=l(z,A,$),A=j[0],$=j[1];const K=c(A);return n(T*K)}function p(m){return H1(n(m),s)}function w(m){const b=Yt("u coordinate",m,s);return o===32&&(b[31]&=127),$l(b)}function f(m){const b=Yt("scalar",m),S=b.length;if(S!==s&&S!==o){let I=""+s+" or "+o;throw new Error("invalid scalar, expected "+I+" bytes, got "+S)}return $l(a(b))}function g(m,b){const S=w(b),I=f(m),T=h(S,I);if(T===Mu)throw new Error("invalid private or public key received");return p(T)}const v=p(e.Gu);function y(m){return g(m,v)}return{scalarMult:g,scalarMultBase:y,getSharedSecret:(m,b)=>g(m,b),getPublicKey:m=>y(m),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:v}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const j1=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),nk=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Qre=BigInt(1),ik=BigInt(2),Yre=BigInt(3),Xre=BigInt(5),Jre=BigInt(8);function jB(r){const e=BigInt(10),t=BigInt(20),n=BigInt(40),i=BigInt(80),s=j1,a=r*r%s*r%s,c=Vt(a,ik,s)*a%s,l=Vt(c,Qre,s)*r%s,d=Vt(l,Xre,s)*l%s,h=Vt(d,e,s)*d%s,p=Vt(h,t,s)*h%s,w=Vt(p,n,s)*p%s,f=Vt(w,i,s)*w%s,g=Vt(f,i,s)*w%s,v=Vt(g,e,s)*d%s;return{pow_p_5_8:Vt(v,ik,s)*r%s,b2:a}}function qB(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function Zre(r,e){const t=j1,n=Tt(e*e*e,t),i=Tt(n*n*e,t),s=jB(r*i).pow_p_5_8;let o=Tt(r*n*s,t);const a=Tt(e*o*o,t),c=o,l=Tt(o*nk,t),d=a===r,h=a===Tt(-r,t),p=a===Tt(-r*nk,t);return d&&(o=c),(h||p)&&(o=l),Mre(o,t)&&(o=Tt(-o,t)),{isValid:d||h,value:o}}const sk=uw(j1,void 0,!0),ene={a:sk.create(BigInt(-1)),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:sk,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Jre,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:kre,randomBytes:gS,adjustScalarBytes:qB,uvRatio:Zre},fy=qre(ene),Y0=Gre({P:j1,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{const e=j1,{pow_p_5_8:t,b2:n}=jB(r);return Tt(Vt(t,Yre,e)*n,e)},adjustScalarBytes:qB,randomBytes:gS}),q1=32,bo=64,Av=32;function tne(){const r=fy.utils.randomPrivateKey(),e=fy.getPublicKey(r);return{privateKey:ine(r,e),publicKey:e}}function rne(r,e){const t=r.subarray(0,Av);return fy.sign(e instanceof Uint8Array?e:e.subarray(),t)}function nne(r,e,t){return fy.verify(e,t instanceof Uint8Array?t:t.subarray(),r)}function ine(r,e){const t=new Uint8Array(bo);for(let n=0;n<Av;n++)t[n]=r[n],t[Av+n]=e[n];return t}class WB{constructor(e){u(this,"type","Ed25519");u(this,"raw");this.raw=W1(e,q1)}toMultihash(){return hS.digest(Oi(this))}toCID(){return sw.createV1(114,this.toMultihash())}toString(){return Ci.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Xe(this.raw,e.raw)}verify(e,t){return nne(this.raw,t,e)}}class Iv{constructor(e,t){u(this,"type","Ed25519");u(this,"raw");u(this,"publicKey");this.raw=W1(e,bo),this.publicKey=new WB(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Xe(this.raw,e.raw)}sign(e){return rne(this.raw,e)}}function GB(r){if(r.length>bo){r=W1(r,bo+q1);const n=r.subarray(0,bo),i=r.subarray(bo,r.length);return new Iv(n,i)}r=W1(r,bo);const e=r.subarray(0,bo),t=r.subarray(q1);return new Iv(e,t)}function bS(r){return r=W1(r,q1),new WB(r)}async function sne(){const{privateKey:r,publicKey:e}=tne();return new Iv(r,e)}function W1(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new ie(`Key must be a Uint8Array of length ${e}, got ${r.length}`);return r}const one=Math.pow(2,7),ane=Math.pow(2,14),cne=Math.pow(2,21),ES=Math.pow(2,28),SS=Math.pow(2,35),xS=Math.pow(2,42),AS=Math.pow(2,49),gt=128,Jr=127;function At(r){if(r<one)return 1;if(r<ane)return 2;if(r<cne)return 3;if(r<ES)return 4;if(r<SS)return 5;if(r<xS)return 6;if(r<AS)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function QB(r,e,t=0){switch(At(r)){case 8:e[t++]=r&255|gt,r/=128;case 7:e[t++]=r&255|gt,r/=128;case 6:e[t++]=r&255|gt,r/=128;case 5:e[t++]=r&255|gt,r/=128;case 4:e[t++]=r&255|gt,r>>>=7;case 3:e[t++]=r&255|gt,r>>>=7;case 2:e[t++]=r&255|gt,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function lne(r,e,t=0){switch(At(r)){case 8:e.set(t++,r&255|gt),r/=128;case 7:e.set(t++,r&255|gt),r/=128;case 6:e.set(t++,r&255|gt),r/=128;case 5:e.set(t++,r&255|gt),r/=128;case 4:e.set(t++,r&255|gt),r>>>=7;case 3:e.set(t++,r&255|gt),r>>>=7;case 2:e.set(t++,r&255|gt),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function YB(r,e){let t=r[e],n=0;if(n+=t&Jr,t<gt||(t=r[e+1],n+=(t&Jr)<<7,t<gt)||(t=r[e+2],n+=(t&Jr)<<14,t<gt)||(t=r[e+3],n+=(t&Jr)<<21,t<gt)||(t=r[e+4],n+=(t&Jr)*ES,t<gt)||(t=r[e+5],n+=(t&Jr)*SS,t<gt)||(t=r[e+6],n+=(t&Jr)*xS,t<gt)||(t=r[e+7],n+=(t&Jr)*AS,t<gt))return n;throw new RangeError("Could not decode varint")}function une(r,e){let t=r.get(e),n=0;if(n+=t&Jr,t<gt||(t=r.get(e+1),n+=(t&Jr)<<7,t<gt)||(t=r.get(e+2),n+=(t&Jr)<<14,t<gt)||(t=r.get(e+3),n+=(t&Jr)<<21,t<gt)||(t=r.get(e+4),n+=(t&Jr)*ES,t<gt)||(t=r.get(e+5),n+=(t&Jr)*SS,t<gt)||(t=r.get(e+6),n+=(t&Jr)*xS,t<gt)||(t=r.get(e+7),n+=(t&Jr)*AS,t<gt))return n;throw new RangeError("Could not decode varint")}function kr(r,e,t=0){return e==null&&(e=Ln(At(r))),e instanceof Uint8Array?QB(r,e,t):lne(r,e,t)}function ms(r,e=0){return r instanceof Uint8Array?YB(r,e):une(r,e)}const IS=new Float32Array([-0]),Qa=new Uint8Array(IS.buffer);function dne(r,e,t){IS[0]=r,e[t]=Qa[0],e[t+1]=Qa[1],e[t+2]=Qa[2],e[t+3]=Qa[3]}function hne(r,e){return Qa[0]=r[e],Qa[1]=r[e+1],Qa[2]=r[e+2],Qa[3]=r[e+3],IS[0]}const CS=new Float64Array([-0]),Zr=new Uint8Array(CS.buffer);function fne(r,e,t){CS[0]=r,e[t]=Zr[0],e[t+1]=Zr[1],e[t+2]=Zr[2],e[t+3]=Zr[3],e[t+4]=Zr[4],e[t+5]=Zr[5],e[t+6]=Zr[6],e[t+7]=Zr[7]}function pne(r,e){return Zr[0]=r[e],Zr[1]=r[e+1],Zr[2]=r[e+2],Zr[3]=r[e+3],Zr[4]=r[e+4],Zr[5]=r[e+5],Zr[6]=r[e+6],Zr[7]=r[e+7],CS[0]}const gne=BigInt(Number.MAX_SAFE_INTEGER),yne=BigInt(Number.MIN_SAFE_INTEGER);class tn{constructor(e,t){u(this,"lo");u(this,"hi");this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return Nl;if(e<gne&&e>yne)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let n=e>>32n,i=e-(n<<32n);return t&&(n=~n|0n,i=~i|0n,++i>ok&&(i=0n,++n>ok&&(n=0n))),new tn(Number(i),Number(n))}static fromNumber(e){if(e===0)return Nl;const t=e<0;t&&(e=-e);let n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new tn(n,i)}static from(e){return typeof e=="number"?tn.fromNumber(e):typeof e=="bigint"?tn.fromBigInt(e):typeof e=="string"?tn.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new tn(e.low>>>0,e.high>>>0):Nl}}const Nl=new tn(0,0);Nl.toBigInt=function(){return 0n};Nl.zzEncode=Nl.zzDecode=function(){return this};Nl.length=function(){return 1};const ok=4294967296n;function mne(r){let e=0,t=0;for(let n=0;n<r.length;++n)t=r.charCodeAt(n),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function wne(r,e,t){if(t-e<1)return"";let i;const s=[];let o=0,a;for(;e<t;)a=r[e++],a<128?s[o++]=a:a>191&&a<224?s[o++]=(a&31)<<6|r[e++]&63:a>239&&a<365?(a=((a&7)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,s[o++]=55296+(a>>10),s[o++]=56320+(a&1023)):s[o++]=(a&15)<<12|(r[e++]&63)<<6|r[e++]&63,o>8191&&((i??(i=[])).push(String.fromCharCode.apply(String,s)),o=0);return i!=null?(o>0&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))}function XB(r,e,t){const n=t;let i,s;for(let o=0;o<r.length;++o)i=r.charCodeAt(o),i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&((s=r.charCodeAt(o+1))&64512)===56320?(i=65536+((i&1023)<<10)+(s&1023),++o,e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128);return t-n}function qi(r,e){return RangeError(`index out of range: ${r.pos} + ${e??1} > ${r.len}`)}function X0(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}class vne{constructor(e){u(this,"buf");u(this,"pos");u(this,"len");u(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,qi(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw qi(this,4);return X0(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw qi(this,4);return X0(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw qi(this,4);const e=hne(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw qi(this,4);const e=pne(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw qi(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){const e=this.bytes();return wne(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw qi(this,e);this.pos+=e}else do if(this.pos>=this.len)throw qi(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new tn(0,0);let t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw qi(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw qi(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw qi(this,8);const e=X0(this.buf,this.pos+=4),t=X0(this.buf,this.pos+=4);return new tn(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=YB(this.buf,this.pos);return this.pos+=At(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function bne(r){return new vne(r instanceof Uint8Array?r:r.subarray())}function Re(r,e,t){const n=bne(r);return e.decode(n,void 0,t)}function Ene(r){let n,i=8192;return function(o){if(o<1||o>4096)return Ln(o);i+o>8192&&(n=Ln(8192),i=0);const a=n.subarray(i,i+=o);return i&7&&(i=(i|7)+1),a}}class Vf{constructor(e,t,n){u(this,"fn");u(this,"len");u(this,"next");u(this,"val");this.fn=e,this.len=t,this.next=void 0,this.val=n}}function G8(){}class Sne{constructor(e){u(this,"head");u(this,"tail");u(this,"len");u(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const xne=Ene();function Ane(r){return globalThis.Buffer!=null?Ln(r):xne(r)}class Cv{constructor(){u(this,"len");u(this,"head");u(this,"tail");u(this,"states");this.len=0,this.head=new Vf(G8,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new Vf(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new Cne((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(J0,10,tn.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=tn.fromBigInt(e);return this._push(J0,t.length(),t)}uint64Number(e){return this._push(QB,At(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=tn.fromBigInt(e).zzEncode();return this._push(J0,t.length(),t)}sint64Number(e){const t=tn.fromNumber(e).zzEncode();return this._push(J0,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(Q8,1,e?1:0)}fixed32(e){return this._push(Ef,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=tn.fromBigInt(e);return this._push(Ef,4,t.lo)._push(Ef,4,t.hi)}fixed64Number(e){const t=tn.fromNumber(e);return this._push(Ef,4,t.lo)._push(Ef,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(dne,4,e)}double(e){return this._push(fne,8,e)}bytes(e){const t=e.length>>>0;return t===0?this._push(Q8,1,0):this.uint32(t)._push(kne,t,e)}string(e){const t=mne(e);return t!==0?this.uint32(t)._push(XB,t,e):this._push(Q8,1,0)}fork(){return this.states=new Sne(this),this.head=this.tail=new Vf(G8,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Vf(G8,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next;const t=Ane(this.len);let n=0;for(;e!=null;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}}function Q8(r,e,t){e[t]=r&255}function Ine(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}class Cne extends Vf{constructor(t,n){super(Ine,t,n);u(this,"next");this.next=void 0}}function J0(r,e,t){for(;r.hi!==0;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}function Ef(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function kne(r,e,t){e.set(r,t)}globalThis.Buffer!=null&&(Cv.prototype.bytes=function(r){const e=r.length>>>0;return this.uint32(e),e>0&&this._push(_ne,e,r),this},Cv.prototype.string=function(r){const e=globalThis.Buffer.byteLength(r);return this.uint32(e),e>0&&this._push(Tne,e,r),this});function _ne(r,e,t){e.set(r,t)}function Tne(r,e,t){r.length<40?XB(r,e,t):e.utf8Write!=null?e.utf8Write(r,t):e.set(fe(r),t)}function Pne(){return new Cv}function Le(r,e){const t=Pne();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var py;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(py||(py={}));function JB(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function Bn(r){function e(i){if(r[i.toString()]==null)throw new Error("Invalid enum value");return r[i]}const t=function(s,o){const a=e(s);o.int32(a)},n=function(s){const o=s.int32();return e(o)};return JB("enum",py.VARINT,t,n)}function Be(r,e){return JB("message",py.LENGTH_DELIMITED,r,e)}class xt extends Error{constructor(){super(...arguments);u(this,"code","ERR_MAX_LENGTH");u(this,"name","MaxLengthError")}}class ak extends Error{constructor(){super(...arguments);u(this,"code","ERR_MAX_SIZE");u(this,"name","MaxSizeError")}}var Ft;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.ECDSA="ECDSA"})(Ft||(Ft={}));var kv;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1",r[r.ECDSA=3]="ECDSA"})(kv||(kv={}));(function(r){r.codec=()=>Bn(kv)})(Ft||(Ft={}));var xc;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Ft.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=Ft.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(xc||(xc={}));var gy;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Ft.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=Ft.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(gy||(gy={}));const Ru=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Dne(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function wd(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function jp(r,...e){if(!Dne(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function dw(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");wd(r.outputLen),wd(r.blockLen)}function yy(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function $ne(r,e){jp(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function js(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function o1(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function ks(r,e){return r<<32-e|r>>>e}function Y8(r,e){return r<<e|r>>>32-e>>>0}const Nne=async()=>{};async function One(r,e,t){let n=Date.now();for(let i=0;i<r;i++){t(i);const s=Date.now()-n;s>=0&&s<e||(await Nne(),n+=s)}}function ZB(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function G1(r){return typeof r=="string"&&(r=ZB(r)),jp(r),r}function ck(r){return typeof r=="string"&&(r=ZB(r)),jp(r),r}function Mne(r,e){if(e!==void 0&&{}.toString.call(e)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(r,e)}class eU{}function kS(r){const e=n=>r().update(G1(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Rne(r=32){if(Ru&&typeof Ru.getRandomValues=="function")return Ru.getRandomValues(new Uint8Array(r));if(Ru&&typeof Ru.randomBytes=="function")return Uint8Array.from(Ru.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function Ac(r){if(isNaN(r)||r<=0)throw new ie("random bytes length must be a Number bigger than 0");return Rne(r)}class lk extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}}class uk extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class Lne extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}const qs={get(r=globalThis){const e=r.crypto;if((e==null?void 0:e.subtle)==null)throw new Lne("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}};function Bne(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function tU(r,e,t){return r&e^~r&t}function rU(r,e,t){return r&e^r&t^e&t}class _S extends eU{constructor(e,t,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=o1(this.buffer)}update(e){yy(this),e=G1(e),jp(e);const{view:t,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=o1(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){yy(this),$ne(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,js(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)t[h]=0;Bne(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=o1(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,d[h],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const Ea=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Lr=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Z0=BigInt(2**32-1),dk=BigInt(32);function Une(r,e=!1){return e?{h:Number(r&Z0),l:Number(r>>dk&Z0)}:{h:Number(r>>dk&Z0)|0,l:Number(r&Z0)|0}}function Fne(r,e=!1){const t=r.length;let n=new Uint32Array(t),i=new Uint32Array(t);for(let s=0;s<t;s++){const{h:o,l:a}=Une(r[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const hk=(r,e,t)=>r>>>t,fk=(r,e,t)=>r<<32-t|e>>>t,Lu=(r,e,t)=>r>>>t|e<<32-t,Bu=(r,e,t)=>r<<32-t|e>>>t,eg=(r,e,t)=>r<<64-t|e>>>t-32,tg=(r,e,t)=>r>>>t-32|e<<64-t;function lo(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}const zne=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),Vne=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,Kne=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),Hne=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,jne=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0),qne=(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0,Wne=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Sa=new Uint32Array(64);class Gne extends _S{constructor(e=32){super(64,e,8,!1),this.A=Ea[0]|0,this.B=Ea[1]|0,this.C=Ea[2]|0,this.D=Ea[3]|0,this.E=Ea[4]|0,this.F=Ea[5]|0,this.G=Ea[6]|0,this.H=Ea[7]|0}get(){const{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)Sa[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const p=Sa[h-15],w=Sa[h-2],f=ks(p,7)^ks(p,18)^p>>>3,g=ks(w,17)^ks(w,19)^w>>>10;Sa[h]=g+Sa[h-7]+f+Sa[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:l,H:d}=this;for(let h=0;h<64;h++){const p=ks(a,6)^ks(a,11)^ks(a,25),w=d+p+tU(a,c,l)+Wne[h]+Sa[h]|0,g=(ks(n,2)^ks(n,13)^ks(n,22))+rU(n,i,s)|0;d=l,l=c,c=a,a=o+w|0,o=s,s=i,i=n,n=w+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(n,i,s,o,a,c,l,d)}roundClean(){js(Sa)}destroy(){this.set(0,0,0,0,0,0,0,0),js(this.buffer)}}const nU=Fne(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Qne=nU[0],Yne=nU[1],xa=new Uint32Array(80),Aa=new Uint32Array(80);class Xne extends _S{constructor(e=64){super(128,e,16,!1),this.Ah=Lr[0]|0,this.Al=Lr[1]|0,this.Bh=Lr[2]|0,this.Bl=Lr[3]|0,this.Ch=Lr[4]|0,this.Cl=Lr[5]|0,this.Dh=Lr[6]|0,this.Dl=Lr[7]|0,this.Eh=Lr[8]|0,this.El=Lr[9]|0,this.Fh=Lr[10]|0,this.Fl=Lr[11]|0,this.Gh=Lr[12]|0,this.Gl=Lr[13]|0,this.Hh=Lr[14]|0,this.Hl=Lr[15]|0}get(){const{Ah:e,Al:t,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:d,Fh:h,Fl:p,Gh:w,Gl:f,Hh:g,Hl:v}=this;return[e,t,n,i,s,o,a,c,l,d,h,p,w,f,g,v]}set(e,t,n,i,s,o,a,c,l,d,h,p,w,f,g,v){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=d|0,this.Fh=h|0,this.Fl=p|0,this.Gh=w|0,this.Gl=f|0,this.Hh=g|0,this.Hl=v|0}process(e,t){for(let b=0;b<16;b++,t+=4)xa[b]=e.getUint32(t),Aa[b]=e.getUint32(t+=4);for(let b=16;b<80;b++){const S=xa[b-15]|0,I=Aa[b-15]|0,T=Lu(S,I,1)^Lu(S,I,8)^hk(S,I,7),A=Bu(S,I,1)^Bu(S,I,8)^fk(S,I,7),_=xa[b-2]|0,$=Aa[b-2]|0,z=Lu(_,$,19)^eg(_,$,61)^hk(_,$,6),j=Bu(_,$,19)^tg(_,$,61)^fk(_,$,6),K=Kne(A,j,Aa[b-7],Aa[b-16]),Z=Hne(K,T,z,xa[b-7],xa[b-16]);xa[b]=Z|0,Aa[b]=K|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:d,Eh:h,El:p,Fh:w,Fl:f,Gh:g,Gl:v,Hh:y,Hl:m}=this;for(let b=0;b<80;b++){const S=Lu(h,p,14)^Lu(h,p,18)^eg(h,p,41),I=Bu(h,p,14)^Bu(h,p,18)^tg(h,p,41),T=h&w^~h&g,A=p&f^~p&v,_=jne(m,I,A,Yne[b],Aa[b]),$=qne(_,y,S,T,Qne[b],xa[b]),z=_|0,j=Lu(n,i,28)^eg(n,i,34)^eg(n,i,39),K=Bu(n,i,28)^tg(n,i,34)^tg(n,i,39),Z=n&s^n&a^s&a,G=i&o^i&c^o&c;y=g|0,m=v|0,g=w|0,v=f|0,w=h|0,f=p|0,{h,l:p}=lo(l|0,d|0,$|0,z|0),l=a|0,d=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const Q=zne(z,K,G);n=Vne(Q,$,j,Z),i=Q|0}({h:n,l:i}=lo(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=lo(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=lo(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:d}=lo(this.Dh|0,this.Dl|0,l|0,d|0),{h,l:p}=lo(this.Eh|0,this.El|0,h|0,p|0),{h:w,l:f}=lo(this.Fh|0,this.Fl|0,w|0,f|0),{h:g,l:v}=lo(this.Gh|0,this.Gl|0,g|0,v|0),{h:y,l:m}=lo(this.Hh|0,this.Hl|0,y|0,m|0),this.set(n,i,s,o,a,c,l,d,h,p,w,f,g,v,y,m)}roundClean(){js(xa,Aa)}destroy(){js(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Jne=kS(()=>new Gne),Zne=kS(()=>new Xne),Ol=Jne;let TS=class{constructor(e,t){u(this,"type","RSA");u(this,"jwk");u(this,"_raw");u(this,"_multihash");this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=DS(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return sw.createV1(114,this._multihash)}toString(){return Ci.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Xe(this.raw,e.raw)}verify(e,t){return fie(this.jwk,t,e)}},iU=class{constructor(e,t){u(this,"type","RSA");u(this,"jwk");u(this,"_raw");u(this,"publicKey");this.jwk=e,this.publicKey=t}get raw(){return this._raw==null&&(this._raw=nie(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Xe(this.raw,e.raw)}sign(e){return hie(this.jwk,e)}};const sU=8192,PS=18,eie=1062,tie=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function rie(r){return{n:ae(r[1],"base64url"),e:ae(r[2],"base64url"),d:ae(r[3],"base64url"),p:ae(r[4],"base64url"),q:ae(r[5],"base64url"),dp:ae(r[6],"base64url"),dq:ae(r[7],"base64url"),qi:ae(r[8],"base64url"),kty:"RSA"}}function nie(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new ie("JWK was missing components");return Do([Gn(Uint8Array.from([0])),Gn(fe(r.n,"base64url")),Gn(fe(r.e,"base64url")),Gn(fe(r.d,"base64url")),Gn(fe(r.p,"base64url")),Gn(fe(r.q,"base64url")),Gn(fe(r.dp,"base64url")),Gn(fe(r.dq,"base64url")),Gn(fe(r.qi,"base64url"))]).subarray()}function iie(r){const e=Fc(r[1],{offset:0});return{kty:"RSA",n:ae(e[0],"base64url"),e:ae(e[1],"base64url")}}function DS(r){if(r.n==null||r.e==null)throw new ie("JWK was missing components");return Do([tie,fS(Do([Gn(fe(r.n,"base64url")),Gn(fe(r.e,"base64url"))]))]).subarray()}function sie(r){const e=Fc(r);return oU(e)}function oU(r){const e=rie(r);return aie(e)}function oie(r,e){if(r.byteLength>=eie)throw new V1("Key size is too large");const t=Fc(r,{offset:0});return aU(t,r,e)}function aU(r,e,t){const n=iie(r);if(t==null){const i=Ol(xc.encode({Type:Ft.RSA,Data:e}));t=Wl(PS,i)}return new TS(n,t)}function aie(r){if(gie(r)>sU)throw new ie("Key size is too large");const e=lie(r),t=Ol(xc.encode({Type:Ft.RSA,Data:DS(e.publicKey)})),n=Wl(PS,t);return new iU(e.privateKey,new TS(e.publicKey,n))}async function cie(r){if(r>sU)throw new ie("Key size is too large");const e=await die(r),t=Ol(xc.encode({Type:Ft.RSA,Data:DS(e.publicKey)})),n=Wl(PS,t);return new iU(e.privateKey,new TS(e.publicKey,n))}function lie(r){if(r==null)throw new ie("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}const uie="1.2.840.113549.1.1.1";async function die(r){const e=await qs.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await pie(e);return{privateKey:t[0],publicKey:t[1]}}async function hie(r,e){const t=await qs.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await qs.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(n,0,n.byteLength)}async function fie(r,e,t){const n=await qs.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return qs.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,t instanceof Uint8Array?t:t.subarray())}async function pie(r){if(r.privateKey==null||r.publicKey==null)throw new ie("Private and public key are required");return Promise.all([qs.get().subtle.exportKey("jwk",r.privateKey),qs.get().subtle.exportKey("jwk",r.publicKey)])}function gie(r){if(r.kty!=="RSA")throw new ie("invalid key type");if(r.n==null)throw new ie("invalid key modulus");return fe(r.n,"base64url").length*8}let cU=class extends DB{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Wte(e);const n=pS(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return uy(this),this.iHash.update(e),this}digestInto(e){uy(this),cw(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const lU=(r,e,t)=>new cU(r,e).update(t).digest();lU.create=(r,e)=>new cU(r,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function pk(r){r.lowS!==void 0&&hc("lowS",r.lowS),r.prehash!==void 0&&hc("prehash",r.prehash)}function yie(r){const e=vS(r);Nh(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:n,a:i}=e;if(t){if(!n.eql(i,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}class mie extends Error{constructor(e=""){super(e)}}const Eo={Err:mie,_tlv:{encode:(r,e)=>{const{Err:t}=Eo;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const n=e.length/2,i=Q0(n);if(i.length/2&128)throw new t("tlv.encode: long form length too big");const s=n>127?Q0(i.length/2|128):"";return Q0(r)+s+i+e},decode(r,e){const{Err:t}=Eo;let n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const d of l)o=o<<8|d;if(n+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(r){const{Err:e}=Eo;if(r<Ao)throw new e("integer: negative integers are not allowed");let t=Q0(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=Eo;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Dl(r)}},toSig(r){const{Err:e,_int:t,_tlv:n}=Eo,i=Yt("signature",r),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:l,l:d}=n.decode(2,c);if(d.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(r){const{_tlv:e,_int:t}=Eo,n=e.encode(2,t.encode(r.r)),i=e.encode(2,t.encode(r.s)),s=n+i;return e.encode(48,s)}},Ao=BigInt(0),fr=BigInt(1);BigInt(2);const gk=BigInt(3);BigInt(4);function wie(r){const e=yie(r),{Fp:t}=e,n=uw(e.n,e.nBitLength),i=e.toBytes||((g,v,y)=>{const m=v.toAffine();return Gd(Uint8Array.from([4]),t.toBytes(m.x),t.toBytes(m.y))}),s=e.fromBytes||(g=>{const v=g.subarray(1),y=t.fromBytes(v.subarray(0,t.BYTES)),m=t.fromBytes(v.subarray(t.BYTES,2*t.BYTES));return{x:y,y:m}});function o(g){const{a:v,b:y}=e,m=t.sqr(g),b=t.mul(m,g);return t.add(t.add(b,t.mul(g,v)),y)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(g){return wS(g,fr,e.n)}function c(g){const{allowedPrivateKeyLengths:v,nByteLength:y,wrapPrivateKey:m,n:b}=e;if(v&&typeof g!="bigint"){if(qd(g)&&(g=Wd(g)),typeof g!="string"||!v.includes(g.length))throw new Error("invalid private key");g=g.padStart(y*2,"0")}let S;try{S=typeof g=="bigint"?g:Dl(Yt("private key",g,y))}catch{throw new Error("invalid private key, expected hex or "+y+" bytes, got "+typeof g)}return m&&(S=Tt(S,b)),Jn("private key",S,fr,b),S}function l(g){if(!(g instanceof p))throw new Error("ProjectivePoint expected")}const d=hy((g,v)=>{const{px:y,py:m,pz:b}=g;if(t.eql(b,t.ONE))return{x:y,y:m};const S=g.is0();v==null&&(v=S?t.ONE:t.inv(b));const I=t.mul(y,v),T=t.mul(m,v),A=t.mul(b,v);if(S)return{x:t.ZERO,y:t.ZERO};if(!t.eql(A,t.ONE))throw new Error("invZ was invalid");return{x:I,y:T}}),h=hy(g=>{if(g.is0()){if(e.allowInfinityPoint&&!t.is0(g.py))return;throw new Error("bad point: ZERO")}const{x:v,y}=g.toAffine();if(!t.isValid(v)||!t.isValid(y))throw new Error("bad point: x or y not FE");const m=t.sqr(y),b=o(v);if(!t.eql(m,b))throw new Error("bad point: equation left != right");if(!g.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class p{constructor(v,y,m){if(v==null||!t.isValid(v))throw new Error("x required");if(y==null||!t.isValid(y))throw new Error("y required");if(m==null||!t.isValid(m))throw new Error("z required");this.px=v,this.py=y,this.pz=m,Object.freeze(this)}static fromAffine(v){const{x:y,y:m}=v||{};if(!v||!t.isValid(y)||!t.isValid(m))throw new Error("invalid affine point");if(v instanceof p)throw new Error("projective point not allowed");const b=S=>t.eql(S,t.ZERO);return b(y)&&b(m)?p.ZERO:new p(y,m,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(v){const y=t.invertBatch(v.map(m=>m.pz));return v.map((m,b)=>m.toAffine(y[b])).map(p.fromAffine)}static fromHex(v){const y=p.fromAffine(s(Yt("pointHex",v)));return y.assertValidity(),y}static fromPrivateKey(v){return p.BASE.multiply(c(v))}static msm(v,y){return HB(p,n,v,y)}_setWindowSize(v){f.setWindowSize(this,v)}assertValidity(){h(this)}hasEvenY(){const{y:v}=this.toAffine();if(t.isOdd)return!t.isOdd(v);throw new Error("Field doesn't support isOdd")}equals(v){l(v);const{px:y,py:m,pz:b}=this,{px:S,py:I,pz:T}=v,A=t.eql(t.mul(y,T),t.mul(S,b)),_=t.eql(t.mul(m,T),t.mul(I,b));return A&&_}negate(){return new p(this.px,t.neg(this.py),this.pz)}double(){const{a:v,b:y}=e,m=t.mul(y,gk),{px:b,py:S,pz:I}=this;let T=t.ZERO,A=t.ZERO,_=t.ZERO,$=t.mul(b,b),z=t.mul(S,S),j=t.mul(I,I),K=t.mul(b,S);return K=t.add(K,K),_=t.mul(b,I),_=t.add(_,_),T=t.mul(v,_),A=t.mul(m,j),A=t.add(T,A),T=t.sub(z,A),A=t.add(z,A),A=t.mul(T,A),T=t.mul(K,T),_=t.mul(m,_),j=t.mul(v,j),K=t.sub($,j),K=t.mul(v,K),K=t.add(K,_),_=t.add($,$),$=t.add(_,$),$=t.add($,j),$=t.mul($,K),A=t.add(A,$),j=t.mul(S,I),j=t.add(j,j),$=t.mul(j,K),T=t.sub(T,$),_=t.mul(j,z),_=t.add(_,_),_=t.add(_,_),new p(T,A,_)}add(v){l(v);const{px:y,py:m,pz:b}=this,{px:S,py:I,pz:T}=v;let A=t.ZERO,_=t.ZERO,$=t.ZERO;const z=e.a,j=t.mul(e.b,gk);let K=t.mul(y,S),Z=t.mul(m,I),G=t.mul(b,T),Q=t.add(y,m),J=t.add(S,I);Q=t.mul(Q,J),J=t.add(K,Z),Q=t.sub(Q,J),J=t.add(y,b);let q=t.add(S,T);return J=t.mul(J,q),q=t.add(K,G),J=t.sub(J,q),q=t.add(m,b),A=t.add(I,T),q=t.mul(q,A),A=t.add(Z,G),q=t.sub(q,A),$=t.mul(z,J),A=t.mul(j,G),$=t.add(A,$),A=t.sub(Z,$),$=t.add(Z,$),_=t.mul(A,$),Z=t.add(K,K),Z=t.add(Z,K),G=t.mul(z,G),J=t.mul(j,J),Z=t.add(Z,G),G=t.sub(K,G),G=t.mul(z,G),J=t.add(J,G),K=t.mul(Z,J),_=t.add(_,K),K=t.mul(q,J),A=t.mul(Q,A),A=t.sub(A,K),K=t.mul(Q,Z),$=t.mul(q,$),$=t.add($,K),new p(A,_,$)}subtract(v){return this.add(v.negate())}is0(){return this.equals(p.ZERO)}wNAF(v){return f.wNAFCached(this,v,p.normalizeZ)}multiplyUnsafe(v){const{endo:y,n:m}=e;Jn("scalar",v,Ao,m);const b=p.ZERO;if(v===Ao)return b;if(this.is0()||v===fr)return this;if(!y||f.hasPrecomputes(this))return f.wNAFCachedUnsafe(this,v,p.normalizeZ);let{k1neg:S,k1:I,k2neg:T,k2:A}=y.splitScalar(v),_=b,$=b,z=this;for(;I>Ao||A>Ao;)I&fr&&(_=_.add(z)),A&fr&&($=$.add(z)),z=z.double(),I>>=fr,A>>=fr;return S&&(_=_.negate()),T&&($=$.negate()),$=new p(t.mul($.px,y.beta),$.py,$.pz),_.add($)}multiply(v){const{endo:y,n:m}=e;Jn("scalar",v,fr,m);let b,S;if(y){const{k1neg:I,k1:T,k2neg:A,k2:_}=y.splitScalar(v);let{p:$,f:z}=this.wNAF(T),{p:j,f:K}=this.wNAF(_);$=f.constTimeNegate(I,$),j=f.constTimeNegate(A,j),j=new p(t.mul(j.px,y.beta),j.py,j.pz),b=$.add(j),S=z.add(K)}else{const{p:I,f:T}=this.wNAF(v);b=I,S=T}return p.normalizeZ([b,S])[0]}multiplyAndAddUnsafe(v,y,m){const b=p.BASE,S=(T,A)=>A===Ao||A===fr||!T.equals(b)?T.multiplyUnsafe(A):T.multiply(A),I=S(this,y).add(S(v,m));return I.is0()?void 0:I}toAffine(v){return d(this,v)}isTorsionFree(){const{h:v,isTorsionFree:y}=e;if(v===fr)return!0;if(y)return y(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:v,clearCofactor:y}=e;return v===fr?this:y?y(p,this):this.multiplyUnsafe(e.h)}toRawBytes(v=!0){return hc("isCompressed",v),this.assertValidity(),i(p,this,v)}toHex(v=!0){return hc("isCompressed",v),Wd(this.toRawBytes(v))}}p.BASE=new p(e.Gx,e.Gy,t.ONE),p.ZERO=new p(t.ZERO,t.ONE,t.ZERO);const w=e.nBitLength,f=KB(p,e.endo?Math.ceil(w/2):w);return{CURVE:e,ProjectivePoint:p,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function vie(r){const e=vS(r);return Nh(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function bie(r){const e=vie(r),{Fp:t,n}=e,i=t.BYTES+1,s=2*t.BYTES+1;function o(G){return Tt(G,n)}function a(G){return Sv(G,n)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:d,isWithinCurveOrder:h}=wie({...e,toBytes(G,Q,J){const q=Q.toAffine(),B=t.toBytes(q.x),V=Gd;return hc("isCompressed",J),J?V(Uint8Array.from([Q.hasEvenY()?2:3]),B):V(Uint8Array.from([4]),B,t.toBytes(q.y))},fromBytes(G){const Q=G.length,J=G[0],q=G.subarray(1);if(Q===i&&(J===2||J===3)){const B=Dl(q);if(!wS(B,fr,t.ORDER))throw new Error("Point is not on curve");const V=d(B);let W;try{W=t.sqrt(V)}catch(ce){const pe=ce instanceof Error?": "+ce.message:"";throw new Error("Point is not on curve"+pe)}const ee=(W&fr)===fr;return(J&1)===1!==ee&&(W=t.neg(W)),{x:B,y:W}}else if(Q===s&&J===4){const B=t.fromBytes(q.subarray(0,t.BYTES)),V=t.fromBytes(q.subarray(t.BYTES,2*t.BYTES));return{x:B,y:V}}else{const B=i,V=s;throw new Error("invalid Point, expected length of "+B+", or uncompressed "+V+", got "+Q)}}}),p=G=>Wd(K1(G,e.nByteLength));function w(G){const Q=n>>fr;return G>Q}function f(G){return w(G)?o(-G):G}const g=(G,Q,J)=>Dl(G.slice(Q,J));class v{constructor(Q,J,q){Jn("r",Q,fr,n),Jn("s",J,fr,n),this.r=Q,this.s=J,q!=null&&(this.recovery=q),Object.freeze(this)}static fromCompact(Q){const J=e.nByteLength;return Q=Yt("compactSignature",Q,J*2),new v(g(Q,0,J),g(Q,J,2*J))}static fromDER(Q){const{r:J,s:q}=Eo.toSig(Yt("DER",Q));return new v(J,q)}assertValidity(){}addRecoveryBit(Q){return new v(this.r,this.s,Q)}recoverPublicKey(Q){const{r:J,s:q,recovery:B}=this,V=T(Yt("msgHash",Q));if(B==null||![0,1,2,3].includes(B))throw new Error("recovery id invalid");const W=B===2||B===3?J+e.n:J;if(W>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const ee=B&1?"03":"02",Y=c.fromHex(ee+p(W)),ce=a(W),pe=o(-V*ce),ue=o(q*ce),le=c.BASE.multiplyAndAddUnsafe(Y,pe,ue);if(!le)throw new Error("point at infinify");return le.assertValidity(),le}hasHighS(){return w(this.s)}normalizeS(){return this.hasHighS()?new v(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return dy(this.toDERHex())}toDERHex(){return Eo.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return dy(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}}const y={isValidPrivateKey(G){try{return l(G),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const G=FB(e.n);return Fre(e.randomBytes(G),e.n)},precompute(G=8,Q=c.BASE){return Q._setWindowSize(G),Q.multiply(BigInt(3)),Q}};function m(G,Q=!0){return c.fromPrivateKey(G).toRawBytes(Q)}function b(G){const Q=qd(G),J=typeof G=="string",q=(Q||J)&&G.length;return Q?q===i||q===s:J?q===2*i||q===2*s:G instanceof c}function S(G,Q,J=!0){if(b(G))throw new Error("first arg must be private key");if(!b(Q))throw new Error("second arg must be public key");return c.fromHex(Q).multiply(l(G)).toRawBytes(J)}const I=e.bits2int||function(G){if(G.length>8192)throw new Error("input is too large");const Q=Dl(G),J=G.length*8-e.nBitLength;return J>0?Q>>BigInt(J):Q},T=e.bits2int_modN||function(G){return o(I(G))},A=lw(e.nBitLength);function _(G){return Jn("num < 2^"+e.nBitLength,G,Ao,A),K1(G,e.nByteLength)}function $(G,Q,J=z){if(["recovered","canonical"].some(_e=>_e in J))throw new Error("sign() legacy options not supported");const{hash:q,randomBytes:B}=e;let{lowS:V,prehash:W,extraEntropy:ee}=J;V==null&&(V=!0),G=Yt("msgHash",G),pk(J),W&&(G=Yt("prehashed msgHash",q(G)));const Y=T(G),ce=l(Q),pe=[_(ce),_(Y)];if(ee!=null&&ee!==!1){const _e=ee===!0?B(t.BYTES):ee;pe.push(Yt("extraEntropy",_e))}const ue=Gd(...pe),le=Y;function Me(_e){const ze=I(_e);if(!h(ze))return;const Qe=a(ze),pt=c.BASE.multiply(ze).toAffine(),wt=o(pt.x);if(wt===Ao)return;const P=o(Qe*o(le+wt*ce));if(P===Ao)return;let E=(pt.x===wt?0:2)|Number(pt.y&fr),C=P;return V&&w(P)&&(C=f(P),E^=1),new v(wt,C,E)}return{seed:ue,k2sig:Me}}const z={lowS:e.lowS,prehash:!1},j={lowS:e.lowS,prehash:!1};function K(G,Q,J=z){const{seed:q,k2sig:B}=$(G,Q,J),V=e;return Pre(V.hash.outputLen,V.nByteLength,V.hmac)(q,B)}c.BASE._setWindowSize(8);function Z(G,Q,J,q=j){var E;const B=G;Q=Yt("msgHash",Q),J=Yt("publicKey",J);const{lowS:V,prehash:W,format:ee}=q;if(pk(q),"strict"in q)throw new Error("options.strict was renamed to lowS");if(ee!==void 0&&ee!=="compact"&&ee!=="der")throw new Error("format must be compact or der");const Y=typeof B=="string"||qd(B),ce=!Y&&!ee&&typeof B=="object"&&B!==null&&typeof B.r=="bigint"&&typeof B.s=="bigint";if(!Y&&!ce)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let pe,ue;try{if(ce&&(pe=new v(B.r,B.s)),Y){try{ee!=="compact"&&(pe=v.fromDER(B))}catch(C){if(!(C instanceof Eo.Err))throw C}!pe&&ee!=="der"&&(pe=v.fromCompact(B))}ue=c.fromHex(J)}catch{return!1}if(!pe||V&&pe.hasHighS())return!1;W&&(Q=e.hash(Q));const{r:le,s:Me}=pe,_e=T(Q),ze=a(Me),Qe=o(_e*ze),pt=o(le*ze),wt=(E=c.BASE.multiplyAndAddUnsafe(ue,Qe,pt))==null?void 0:E.toAffine();return wt?o(wt.x)===le:!1}return{CURVE:e,getPublicKey:m,getSharedSecret:S,sign:K,verify:Z,ProjectivePoint:c,Signature:v,utils:y}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Eie(r){return{hash:r,hmac:(e,...t)=>lU(r,e,Yte(...t)),randomBytes:gS}}function Sie(r,e){const t=n=>bie({...r,...Eie(n)});return{...t(e),create:t}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const uU=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),yk=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),xie=BigInt(1),_v=BigInt(2),mk=(r,e)=>(r+e/_v)/e;function Aie(r){const e=uU,t=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=r*r*r%e,d=l*l*r%e,h=Vt(d,t,e)*d%e,p=Vt(h,t,e)*d%e,w=Vt(p,_v,e)*l%e,f=Vt(w,i,e)*w%e,g=Vt(f,s,e)*f%e,v=Vt(g,a,e)*g%e,y=Vt(v,c,e)*v%e,m=Vt(y,a,e)*g%e,b=Vt(m,t,e)*d%e,S=Vt(b,o,e)*f%e,I=Vt(S,n,e)*l%e,T=Vt(I,_v,e);if(!Tv.eql(Tv.sqr(T),r))throw new Error("Cannot find square root");return T}const Tv=uw(uU,void 0,void 0,{sqrt:Aie}),Ws=Sie({a:BigInt(0),b:BigInt(7),Fp:Tv,n:yk,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const e=yk,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-xie*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=t,o=BigInt("0x100000000000000000000000000000000"),a=mk(s*r,e),c=mk(-n*r,e);let l=Tt(r-a*t-c*i,e),d=Tt(-a*n-c*s,e);const h=l>o,p=d>o;if(h&&(l=e-l),p&&(d=e-d),l>o||d>o)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:h,k1:l,k2neg:p,k2:d}}}},rre);BigInt(0);Ws.ProjectivePoint;function Iie({name:r,code:e,encode:t}){return new Cie(r,e,t)}let Cie=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Wl(this.code,t):t.then(n=>Wl(this.code,n))}else throw Error("Unknown type, must be binary type")}};function kie(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const dU=Iie({name:"sha2-256",code:18,encode:kie("SHA-256")});function hU(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}const _ie=33,Tie=32;function Pie(r,e){const t=dU.digest(e instanceof Uint8Array?e:e.subarray());if(hU(t))return t.then(({digest:n})=>Ws.sign(n,r).toDERRawBytes()).catch(n=>{throw new lk(String(n))});try{return Ws.sign(t.digest,r).toDERRawBytes()}catch(n){throw new lk(String(n))}}function Die(r,e,t){const n=dU.digest(t instanceof Uint8Array?t:t.subarray());if(hU(n))return n.then(({digest:i})=>Ws.verify(e,i,r)).catch(i=>{throw new uk(String(i))});try{return Ws.verify(e,n.digest,r)}catch(i){throw new uk(String(i))}}class fU{constructor(e){u(this,"type","secp256k1");u(this,"raw");u(this,"_key");this._key=Mie(e),this.raw=Nie(this._key)}toMultihash(){return hS.digest(Oi(this))}toCID(){return sw.createV1(114,this.toMultihash())}toString(){return Ci.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Xe(this.raw,e.raw)}verify(e,t){return Die(this._key,t,e)}}class pU{constructor(e,t){u(this,"type","secp256k1");u(this,"raw");u(this,"publicKey");this.raw=Oie(e),this.publicKey=new fU(t??Rie(e))}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Xe(this.raw,e.raw)}sign(e){return Pie(this.raw,e)}}function gU(r){return new pU(r)}function $S(r){return new fU(r)}async function $ie(){const r=Lie();return new pU(r)}function Nie(r){return Ws.ProjectivePoint.fromHex(r).toRawBytes(!0)}function Oie(r){try{return Ws.getPublicKey(r,!0),r}catch(e){throw new sS(String(e))}}function Mie(r){try{return Ws.ProjectivePoint.fromHex(r),r}catch(e){throw new V1(String(e))}}function Rie(r){try{return Ws.getPublicKey(r,!0)}catch(e){throw new sS(String(e))}}function Lie(){return Ws.utils.randomPrivateKey()}async function hw(r,e){if(r==="Ed25519")return sne();if(r==="secp256k1")return $ie();if(r==="RSA")return cie(Fie(e));if(r==="ECDSA")return jte(zie(e));throw new bu}function Un(r,e){const{Type:t,Data:n}=xc.decode(r),i=n??new Uint8Array;switch(t){case Ft.RSA:return oie(i,e);case Ft.Ed25519:return bS(i);case Ft.secp256k1:return $S(i);case Ft.ECDSA:return _B(i);default:throw new bu}}function Bie(r){var n,i;if(r.byteLength===q1)return bS(r);if(r.byteLength===_ie)return $S(r);const e=Fc(r),t=(n=e[1])==null?void 0:n[0];if(t===EB||t===SB||t===xB)return TB(e);if(((i=e[0])==null?void 0:i[0])===uie)return aU(e,r);throw new ie("Could not extract public key from raw bytes")}function yU(r){const{Type:e,Data:t}=xc.decode(r.digest),n=t??new Uint8Array;switch(e){case Ft.Ed25519:return bS(n);case Ft.secp256k1:return $S(n);case Ft.ECDSA:return _B(n);default:throw new bu}}function Oi(r){return xc.encode({Type:Ft[r.type],Data:r.raw})}function Uie(r){const e=gy.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case Ft.RSA:return sie(t);case Ft.Ed25519:return GB(t);case Ft.secp256k1:return gU(t);case Ft.ECDSA:return Vte(t);default:throw new bu}}function Pv(r){var n;if(r.byteLength===bo)return GB(r);if(r.byteLength===Tie)return gU(r);const e=Fc(r),t=(n=e[2])==null?void 0:n[0];if(t===EB||t===SB||t===xB)return kB(e);if(e.length>8)return oU(e);throw new ie("Could not extract private key from raw bytes")}function qp(r){return gy.encode({Type:Ft[r.type],Data:r.raw})}function Fie(r){return r==null?2048:parseInt(r,10)}function zie(r){if(r==="P-256"||r==null)return"P-256";if(r==="P-384")return"P-384";if(r==="P-521")return"P-521";throw new ie("Unsupported curve, should be P-256, P-384 or P-521")}async function mU(r){if(r.type==="RSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if(r.type==="ECDSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"ECDSA",namedCurve:r.jwk.crv??"P-256"},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"ECDSA",namedCurve:r.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new ie("Only RSA and ECDSA keys are supported")}function Vie(r,e){for(let t=0;t<r.byteLength;t++){if(r[t]<e[t])return-1;if(r[t]>e[t])return 1}return r.byteLength>e.byteLength?1:r.byteLength<e.byteLength?-1:0}const Kie=async(r,e,t)=>{if(!r)throw new Error("No signature given");if(!e)throw new Error("Given publicKey was undefined");if(!t)throw new Error("Given input data was undefined");t instanceof Uint8Array||(t=typeof t=="string"?fe(t):new Uint8Array(t));const n=(s,o,a)=>s.verify(o,a);let i=!1;try{const s=Bie(fe(e,"base16"));i=await n(s,t,fe(r,"base16"))}catch{}return Promise.resolve(i)},Dv=async(r,e)=>{if(!r)throw new Error("No signing key given");if(!e)throw new Error("Given input data was undefined");return e instanceof Uint8Array||(e=typeof e=="string"?fe(e):new Uint8Array(e)),ae(await r.sign(e),"base16")},Hie=Vs({size:1e3}),wU=async(r,e,t)=>{const n=await Hie,i=await n.get(r);let s=!1;if(i){const o=(a,c)=>c instanceof Uint8Array?Vie(a,c)===0:a.toString()===c.toString();s=i.publicKey===e&&o(i.data,t)}else{const o=await Kie(r,e,t);s=o,o&&await n.put(r,{publicKey:e,data:t})}return s},jie="./keystore",vU=async({storage:r,path:e}={})=>{r=r||await Tl(await Vs({size:1e3}),await fv({path:e||jie}));const t=await Vs({size:1e3}),n=async()=>{await r.close(),await t.close()},i=async()=>{await r.clear(),await t.clear()},s=async d=>{if(!d)throw new Error("id needed to check a key");let h=!1,p=await t.get(d);if(p)h=!0;else try{p=await r.get("private_"+d),h=p!=null}catch{console.error("Error: ENOENT: no such file or directory")}return h},o=async(d,h)=>{const{privateKey:p}=h;await r.put("private_"+d,p);const w=Pv(p);await t.put(d,w)};return{clear:i,close:n,hasKey:s,addKey:o,createKey:async d=>{if(!d)throw new Error("id needed to create a key");const h=await hw("secp256k1"),p={publicKey:h.publicKey.raw,privateKey:h.raw};return await o(d,p),h},getKey:async d=>{if(!d)throw new Error("id needed to get a key");let h=await t.get(d);if(!h){let p;try{p=await r.get("private_"+d)}catch{}if(!p)return;h=Pv(p),await t.put(d,h)}return h},getPublic:(d,h={})=>{const p=["hex","buffer"],w=h.format||"hex";if(p.indexOf(w)===-1)throw new Error("Supported formats are `hex` and `buffer`");const f=d.publicKey.raw;return w==="buffer"?f:ae(f,"base16")}}},bU=Rp,EU=V3,qie=ln,SU=async({id:r,publicKey:e,signatures:t,type:n,sign:i,verify:s}={})=>{if(!r)throw new Error("Identity id is required");if(!e)throw new Error("Invalid public key");if(!t)throw new Error("Signatures object is required");if(!t.id)throw new Error("Signature of id is required");if(!t.publicKey)throw new Error("Signature of publicKey+id is required");if(!n)throw new Error("Identity type is required");t=Object.assign({},t);const o={id:r,publicKey:e,signatures:t,type:n,sign:i,verify:s},{hash:a,bytes:c}=await Wie(o);return o.hash=a,o.bytes=c,o},Wie=async r=>{const{id:e,publicKey:t,signatures:n,type:i}=r,s={id:e,publicKey:t,signatures:n,type:i},{cid:o,bytes:a}=await kh({value:s,codec:bU,hasher:EU});return{hash:o.toString(qie),bytes:Uint8Array.from(a)}},Gie=async r=>{const{value:e}=await L3({bytes:r,codec:bU,hasher:EU});return SU({...e})},Qie=r=>!!(r.id&&r.hash&&r.bytes&&r.publicKey&&r.signatures&&r.signatures.id&&r.signatures.publicKey&&r.type),Yie=(r,e)=>r.id===e.id&&r.hash===e.hash&&r.type===e.type&&r.publicKey===e.publicKey&&r.signatures.id===e.signatures.id&&r.signatures.publicKey===e.signatures.publicKey,xU="publickey",Xie=async r=>{const{id:e,publicKey:t,signatures:n}=r;return wU(n.publicKey,e,t+n.id)},NS=({keystore:r})=>async()=>{if(!r)throw new Error("PublicKeyIdentityProvider requires a keystore parameter");return{type:xU,getId:async({id:n}={})=>{if(!n)throw new Error("id is required");const i=await r.getKey(n)||await r.createKey(n);return ae(i.publicKey.raw,"base16")},signIdentity:async(n,{id:i}={})=>{if(!i)throw new Error("id is required");const s=await r.getKey(i);if(!s)throw new Error(`Signing key for '${i}' not found`);return Dv(s,n)}}};NS.verifyIdentity=Xie;NS.type=xU;const OS={},Jie=r=>Object.keys(OS).includes(r),X8=r=>{if(!Jie(r))throw new Error(`IdentityProvider type '${r}' is not supported`);return OS[r]},Zie=r=>{if(!r.type||typeof r.type!="string")throw new Error("Given IdentityProvider doesn't have a field 'type'.");if(!r.verifyIdentity)throw new Error("Given IdentityProvider doesn't have a function 'verifyIdentity'.");OS[r.type]=r};Zie(NS);const ese=uc("./orbitdb","identities"),tse=async({keystore:r,path:e,storage:t,ipfs:n}={})=>{r=r||await vU({path:e||ese}),t||(t=n?await Tl(await Vs({size:1e3}),await j3({ipfs:n,pin:!0})):await KE());const i=await Vs({size:1e3}),s=async d=>{const h=await t.get(d);if(h)return Gie(h)},o=async(d={})=>{d.keystore=r;const h=X8("publickey"),w=await(d.provider||h({keystore:r}))();if(!X8(w.type))throw new Error("Identity provider is unknown. Use useIdentityProvider(provider) to register the identity provider");const f=await w.getId(d),g=await r.getKey(f)||await r.createKey(f),v=r.getPublic(g),y=await Dv(g,f),m=await w.signIdentity(v+y,d),S=await SU({id:f,publicKey:v,signatures:{id:y,publicKey:m},type:w.type,sign:c,verify:l});return await t.put(S.hash,S.bytes),S},a=async d=>{if(!Qie(d))return!1;const{id:h,publicKey:p,signatures:w}=d;if(!await l(w.id,p,h))return!1;const g=await i.get(w.id);if(g)return Yie(d,g);const y=await X8(d.type).verifyIdentity(d);return y&&await i.put(w.id,d),y},c=async(d,h)=>{const p=await r.getKey(d.id);if(!p)throw new Error("Private signing key not found from KeyStore");return await Dv(p,h)},l=async(d,h,p)=>await wU(d,h,p);return{createIdentity:o,verifyIdentity:a,getIdentity:s,sign:c,verify:l,keystore:r}},rse=r=>{if(r=r.toString(),!r.startsWith("/orbitdb")&&!r.startsWith("\\orbitdb"))return!1;r=r.replaceAll("/orbitdb/",""),r=r.replaceAll("\\orbitdb\\",""),r=r.replaceAll("/",""),r=r.replaceAll("\\","");let e;try{e=gs.parse(r,ln)}catch{return!1}return e!==void 0},wk=r=>{if(r&&r.protocol==="orbitdb"&&r.hash)return r;const e="orbitdb",t=r.replace("/orbitdb/","").replace("\\orbitdb\\","");return{protocol:e,hash:t,address:r,toString:()=>uc("/",e,t)}},vk=Rp,bk=V3,nse=ln,ise=async({ipfs:r,storage:e}={})=>(e=e||await Tl(await Vs({size:1e5}),await j3({ipfs:r,pin:!0})),{get:async s=>{const o=await e.get(s),{value:a}=await L3({bytes:o,codec:vk,hasher:bk});return a&&await e.put(s,o),a},create:async({name:s,type:o,accessController:a,meta:c})=>{if(!s)throw new Error("name is required");if(!o)throw new Error("type is required");if(!a)throw new Error("accessController is required");const l=Object.assign({name:s,type:o,accessController:a},c!==void 0?{meta:c}:{}),{cid:d,bytes:h}=await kh({value:l,codec:vk,hasher:bk}),p=d.toString(nse);return await e.put(p,h),{hash:p,manifest:l}},close:async()=>{await e.close()}}),AU=async(r=32)=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="",n=0;for(;n<r;)t+=e.charAt(Math.floor(Math.random()*e.length)),n+=1;return t},IU=Rp,CU=V3,sse=ln,ose=async({storage:r,type:e,params:t})=>{const n={type:e,...t},{cid:i,bytes:s}=await kh({value:n,codec:IU,hasher:CU}),o=i.toString(sse);return await r.put(o,s),o},Jg="ipfs",fw=({write:r,storage:e}={})=>async({orbitdb:t,identities:n,address:i})=>{if(e=e||await Tl(await Vs({size:1e3}),await j3({ipfs:t.ipfs,pin:!0})),r=r||[t.identity.id],i){const o=await e.get(i.replaceAll("/ipfs/","")),{value:a}=await L3({bytes:o,codec:IU,hasher:CU});r=a.write}else i=await ose({storage:e,type:Jg,params:{write:r}}),i=uc("/",Jg,i);return{type:Jg,address:i,write:r,canAppend:async o=>{const a=await n.getIdentity(o.identity);if(!a)return!1;const{id:c}=a;return r.includes(c)||r.includes("*")?await n.verifyIdentity(a):!1}}};fw.type=Jg;const kU="orbitdb",_U=({write:r}={})=>async({orbitdb:e,identities:t,address:n,name:i})=>{n=n||i||await AU(64),r=r||[e.identity.id];const s=await e.open(n,{type:"keyvalue",AccessController:fw({write:r})});n=s.address;const o=async f=>{const g=await t.getIdentity(f.identity);if(!g)return!1;const{id:v}=g;return await h("write",v)||await h("admin",v)?await t.verifyIdentity(g):!1},a=async()=>{const f=[];for await(const v of s.iterator())f[v.key]=v.value;const g=v=>{const y=v[0];f[y]=new Set([...f[y]||[],...v[1]])};return Object.entries({...f,admin:new Set([...f.admin||[],...s.access.write])}).forEach(g),f},c=async f=>(await a())[f]||new Set([]),l=async()=>{await s.close()},d=async()=>{await s.drop()},h=async(f,g)=>{const v=new Set(await c(f));return v.has(g)||v.has("*")};return{type:kU,address:n,write:r,canAppend:o,capabilities:a,get:c,grant:async(f,g)=>{const v=new Set([...await s.get(f)||[],g]);await s.put(f,Array.from(v.values()))},revoke:async(f,g)=>{const v=new Set(await s.get(f)||[]);v.delete(g),v.size>0?await s.put(f,Array.from(v.values())):await s.del(f)},close:l,drop:d,events:s.events}};_U.type=kU;const $v={},ase=r=>{if(!$v[r])throw new Error(`AccessController type '${r}' is not supported`);return $v[r]},TU=r=>{if(!r.type)throw new Error("AccessController does not contain required field 'type'.");$v[r.type]=r};TU(fw);TU(_U);const cse="events",lse=fw,use=async({ipfs:r,id:e,identity:t,identities:n,directory:i}={})=>{if(r==null)throw new Error("IPFS instance is a required argument.");e=e||await AU();const s=r.libp2p.peerId;i=i||"./orbitdb";let o;n?o=n.keystore:(o=await vU({path:uc(i,"./keystore")}),n=await tse({ipfs:r,keystore:o})),t?t.provider&&(t=await n.createIdentity({...t})):t=await n.createIdentity({id:e});const a=await ise({ipfs:r});let c={};const l=async(p,{type:w,meta:f,sync:g,Database:v,AccessController:y,headsStorage:m,entryStorage:b,indexStorage:S,referencesCount:I}={})=>{let T,A,_;if(c[p])return c[p];if(rse(p)){const z=wk(p);A=await a.get(z.hash);const j=A.accessController.split("/",2).pop();y=ase(j)(),_=await y({orbitdb:{open:l,identity:t,ipfs:r},identities:n,address:A.accessController}),T=A.name,w=w||A.type,f=A.meta}else{w=w||cse,y=y||lse(),_=await y({orbitdb:{open:l,identity:t,ipfs:r},identities:n,name:p});const z=await a.create({name:p,type:w,accessController:_.address,meta:f});if(A=z.manifest,p=wk(z.hash),T=A.name,f=A.meta,c[p])return c[p]}if(v=v||WZ(w)(),!v)throw new Error(`Unsupported database type: '${w}'`);p=p.toString();const $=await v({ipfs:r,identity:t,address:p,name:T,access:_,directory:i,meta:f,syncAutomatically:g,headsStorage:m,entryStorage:b,indexStorage:S,referencesCount:I});return $.events.on("close",d(p)),c[p]=$,$},d=p=>()=>{delete c[p]};return{id:e,open:l,stop:async()=>{for(const p of Object.values(c))await p.close();o&&await o.close(),a&&await a.close(),c={}},ipfs:r,directory:i,keystore:o,identities:n,identity:t,peerId:s}};function bt(r){const e=new globalThis.AbortController;function t(){e.abort();for(const s of r)(s==null?void 0:s.removeEventListener)!=null&&s.removeEventListener("abort",t)}for(const s of r){if((s==null?void 0:s.aborted)===!0){t();break}(s==null?void 0:s.addEventListener)!=null&&s.addEventListener("abort",t)}function n(){for(const s of r)(s==null?void 0:s.removeEventListener)!=null&&s.removeEventListener("abort",t)}const i=e.signal;return i.clear=n,i}let dse=class extends Error{constructor(t,n){super(t??"The operation was aborted");u(this,"type");u(this,"code");this.type="aborted",this.name="AbortError",this.code=n??"ABORT_ERR"}};async function Ti(r,e,t,n){const i=new dse(n==null?void 0:n.errorMessage,n==null?void 0:n.errorCode);return(t==null?void 0:t.aborted)===!0?Promise.reject(i):new Promise((s,o)=>{function a(){t==null||t.removeEventListener("abort",d),r.removeEventListener(e,c),(n==null?void 0:n.errorEvent)!=null&&r.removeEventListener(n.errorEvent,l)}const c=h=>{var p;try{if(((p=n==null?void 0:n.filter)==null?void 0:p.call(n,h))===!1)return}catch(w){a(),o(w);return}a(),s(h)},l=h=>{a(),o(h.detail)},d=()=>{a(),o(i)};t==null||t.addEventListener("abort",d),r.addEventListener(e,c),(n==null?void 0:n.errorEvent)!=null&&r.addEventListener(n.errorEvent,l)})}class hse extends Error{constructor(t="Rate limit exceeded",n){super(t);u(this,"remainingPoints");u(this,"msBeforeNext");u(this,"consumedPoints");u(this,"isFirstInDuration");this.name="RateLimitError",this.remainingPoints=n.remainingPoints,this.msBeforeNext=n.msBeforeNext,this.consumedPoints=n.consumedPoints,this.isFirstInDuration=n.isFirstInDuration}}class PU extends Error{constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}u(PU,"name","QueueFullError");class fse{constructor(e){u(this,"deferred");u(this,"signal");var t;this.signal=e,this.deferred=Ve(),this.onAbort=this.onAbort.bind(this),(t=this.signal)==null||t.addEventListener("abort",this.onAbort)}onAbort(){var e;this.deferred.reject(((e=this.signal)==null?void 0:e.reason)??new jl)}cleanup(){var e;(e=this.signal)==null||e.removeEventListener("abort",this.onAbort)}}function pse(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}class gse{constructor(e,t){u(this,"id");u(this,"fn");u(this,"options");u(this,"recipients");u(this,"status");u(this,"timeline");u(this,"controller");this.id=pse(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,n)=>{var i;return t&&((i=n.signal)==null?void 0:i.aborted)===!0},!0)&&(this.controller.abort(new jl),this.cleanup())}async join(e={}){var n;const t=new fse(e.signal);return this.recipients.push(t),(n=e.signal)==null||n.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await dn(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{var t;e.cleanup(),(t=e.signal)==null||t.removeEventListener("abort",this.onAbort)})}}class Gl extends tr{constructor(t={}){var n;super();u(this,"concurrency");u(this,"maxSize");u(this,"queue");u(this,"pending");u(this,"sort");this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.maxSize=t.maxSize??Number.POSITIVE_INFINITY,this.pending=0,t.metricName!=null&&((n=t.metrics)==null||n.registerMetricGroup(t.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})})),this.sort=t.sort,this.queue=[]}tryToStartAnother(){if(this.size===0)return queueMicrotask(()=>{this.safeDispatchEvent("empty")}),this.running===0&&queueMicrotask(()=>{this.safeDispatchEvent("idle")}),!1;if(this.pending<this.concurrency){let t;for(const n of this.queue)if(n.status==="queued"){t=n;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let n=0;n<this.queue.length;n++)if(this.queue[n]===t){this.queue.splice(n,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(t){this.queue.push(t),this.sort!=null&&this.queue.sort(this.sort)}async add(t,n){var s;if((s=n==null?void 0:n.signal)==null||s.throwIfAborted(),this.size===this.maxSize)throw new PU;const i=new gse(t,n);return this.enqueue(i),this.safeDispatchEvent("add"),this.tryToStartAnother(),i.join(n).then(o=>(this.safeDispatchEvent("completed",{detail:o}),this.safeDispatchEvent("success",{detail:{job:i,result:o}}),o)).catch(o=>{if(i.status==="queued"){for(let a=0;a<this.queue.length;a++)if(this.queue[a]===i){this.queue.splice(a,1);break}}throw this.safeDispatchEvent("error",{detail:o}),this.safeDispatchEvent("failure",{detail:{job:i,error:o}}),o})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new jl)}),this.clear()}async onEmpty(t){this.size!==0&&await Ti(this,"empty",t==null?void 0:t.signal)}async onSizeLessThan(t,n){this.size<t||await Ti(this,"next",n==null?void 0:n.signal,{filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await Ti(this,"idle",t==null?void 0:t.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){var l,d,h;(l=t==null?void 0:t.signal)==null||l.throwIfAborted();const n=zo({objectMode:!0}),i=p=>{p!=null?this.abort():this.clear(),n.end(p)},s=p=>{p.detail!=null&&n.push(p.detail)},o=p=>{i(p.detail)},a=()=>{i()},c=()=>{i(new jl("Queue aborted"))};this.addEventListener("completed",s),this.addEventListener("error",o),this.addEventListener("idle",a),(d=t==null?void 0:t.signal)==null||d.addEventListener("abort",c);try{yield*n}finally{this.removeEventListener("completed",s),this.removeEventListener("error",o),this.removeEventListener("idle",a),(h=t==null?void 0:t.signal)==null||h.removeEventListener("abort",c),i()}}}class Ic extends Gl{has(e){return this.find(e)!=null}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}const yse=8,MS=1024*1024*4;let mse=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}},DU=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}},wse=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}},Ek=class extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}};function $U(r){return r[Symbol.asyncIterator]!=null}function NU(r,e){if(r.byteLength>e)throw new DU("Message length too long")}const pw=r=>{const e=At(r),t=Ln(e);return kr(r,t),pw.bytes=e,t};pw.bytes=0;function Qd(r,e){e=e??{};const t=e.lengthEncoder??pw,n=(e==null?void 0:e.maxDataLength)??MS;function*i(s){NU(s,n);const o=t(s.byteLength);o instanceof Uint8Array?yield o:yield*o,s instanceof Uint8Array?yield s:yield*s}return $U(r)?async function*(){for await(const s of r)yield*i(s)}():function*(){for(const s of r)yield*i(s)}()}Qd.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??pw,n=(e==null?void 0:e.maxDataLength)??MS;return NU(r,n),new He(t(r.byteLength),r)};var ul;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(ul||(ul={}));const RS=r=>{const e=ms(r);return RS.bytes=At(e),e};RS.bytes=0;function Yd(r,e){const t=new He;let n=ul.LENGTH,i=-1;const s=(e==null?void 0:e.lengthDecoder)??RS,o=(e==null?void 0:e.maxLengthLength)??yse,a=(e==null?void 0:e.maxDataLength)??MS;function*c(){for(;t.byteLength>0;){if(n===ul.LENGTH)try{if(i=s(t),i<0)throw new mse("Invalid message length");if(i>a)throw new DU("Message length too long");const l=s.bytes;t.consume(l),(e==null?void 0:e.onLength)!=null&&e.onLength(i),n=ul.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>o)throw new wse("Message length length too long");break}throw l}if(n===ul.DATA){if(t.byteLength<i)break;const l=t.sublist(0,i);t.consume(i),(e==null?void 0:e.onData)!=null&&e.onData(l),yield l,n=ul.LENGTH}}}return $U(r)?async function*(){for await(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new Ek("Unexpected end of input")}():function*(){for(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new Ek("Unexpected end of input")}()}Yd.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:s,value:o}=await r.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return Yd(n,{...e??{},onLength:s=>{t=s}})};function LS(r){const[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:i=>{n.push(i)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}function vse(r){return r[Symbol.asyncIterator]!=null}function Oh(r,e){let t=0;if(vse(r))return async function*(){for await(const c of r)yield e(c,t++)}();const n=LS(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof o.then=="function")return async function*(){yield await o;for await(const c of n)yield e(c,t++)}();const a=e;return function*(){yield o;for(const c of n)yield a(c,t++)}()}function bse(r){return r[Symbol.asyncIterator]!=null}function my(r,e){return bse(r)?async function*(){let t=0;if(!(e<1)){for await(const n of r)if(yield n,t++,t===e)return}}():function*(){let t=0;if(!(e<1)){for(const n of r)if(yield n,t++,t===e)return}}()}class Ne extends Event{constructor(t,n){super(t);u(this,"type");u(this,"detail");this.type=t,this.detail=n}}const rg="/ipfs/bitswap/1.2.0",Ese=1024,Sse=1024,xse=1024,Ase=5e3,Ise=10,Cse=50,kse=!1,_se=3,OU=1024*1024*4,Tse=OU;var pr;(function(r){r.WantBlock="WantBlock",r.WantHave="WantHave"})(pr||(pr={}));var Nv;(function(r){r[r.WantBlock=0]="WantBlock",r[r.WantHave=1]="WantHave"})(Nv||(Nv={}));(function(r){r.codec=()=>Bn(Nv)})(pr||(pr={}));var Q1;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.priority!=null&&t.priority!==0&&(n.uint32(16),n.int32(t.priority)),t.cancel!=null&&(n.uint32(24),n.bool(t.cancel)),t.wantType!=null&&(n.uint32(32),pr.codec().encode(t.wantType,n)),t.sendDontHave!=null&&(n.uint32(40),n.bool(t.sendDontHave)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={cid:tt(0),priority:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.cid=t.bytes();break}case 2:{s.priority=t.int32();break}case 3:{s.cancel=t.bool();break}case 4:{s.wantType=pr.codec().decode(t);break}case 5:{s.sendDontHave=t.bool();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(Q1||(Q1={}));var wy;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.entries!=null)for(const s of t.entries)n.uint32(10),Q1.codec().encode(s,n);t.full!=null&&(n.uint32(16),n.bool(t.full)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={entries:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{if(((a=i.limits)==null?void 0:a.entries)!=null&&s.entries.length===i.limits.entries)throw new xt('Decode error - map field "entries" had too many elements');s.entries.push(Q1.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.entries$}));break}case 2:{s.full=t.bool();break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(wy||(wy={}));var Y1;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.prefix!=null&&t.prefix.byteLength>0&&(n.uint32(10),n.bytes(t.prefix)),t.data!=null&&t.data.byteLength>0&&(n.uint32(18),n.bytes(t.data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={prefix:tt(0),data:tt(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.prefix=t.bytes();break}case 2:{s.data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(Y1||(Y1={}));var Ks;(function(r){r.HaveBlock="HaveBlock",r.DoNotHaveBlock="DoNotHaveBlock"})(Ks||(Ks={}));var vy;(function(r){r[r.HaveBlock=0]="HaveBlock",r[r.DoNotHaveBlock=1]="DoNotHaveBlock"})(vy||(vy={}));(function(r){r.codec=()=>Bn(vy)})(Ks||(Ks={}));var X1;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.type!=null&&vy[t.type]!==0&&(n.uint32(16),Ks.codec().encode(t.type,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={cid:tt(0),type:Ks.HaveBlock},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.cid=t.bytes();break}case 2:{s.type=Ks.codec().decode(t);break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(X1||(X1={}));var J1;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.wantlist!=null&&(n.uint32(10),wy.codec().encode(t.wantlist,n)),t.blocks!=null)for(const s of t.blocks)n.uint32(26),Y1.codec().encode(s,n);if(t.blockPresences!=null)for(const s of t.blockPresences)n.uint32(34),X1.codec().encode(s,n);t.pendingBytes!=null&&t.pendingBytes!==0&&(n.uint32(40),n.int32(t.pendingBytes)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,d,h;const s={blocks:[],blockPresences:[],pendingBytes:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const p=t.uint32();switch(p>>>3){case 1:{s.wantlist=wy.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.wantlist});break}case 3:{if(((c=i.limits)==null?void 0:c.blocks)!=null&&s.blocks.length===i.limits.blocks)throw new xt('Decode error - map field "blocks" had too many elements');s.blocks.push(Y1.codec().decode(t,t.uint32(),{limits:(l=i.limits)==null?void 0:l.blocks$}));break}case 4:{if(((d=i.limits)==null?void 0:d.blockPresences)!=null&&s.blockPresences.length===i.limits.blockPresences)throw new xt('Decode error - map field "blockPresences" had too many elements');s.blockPresences.push(X1.codec().decode(t,t.uint32(),{limits:(h=i.limits)==null?void 0:h.blockPresences$}));break}case 5:{s.pendingBytes=t.int32();break}default:{t.skipType(p&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(J1||(J1={}));function Pse(r,e){for(const[t,n]of e.wantlist.entries()){const i=r.wantlist.get(t);i!=null&&(i.priority>n.priority&&(n.priority=i.priority),n.cancel=n.cancel??i.cancel,n.wantType=n.wantType??i.wantType,n.sendDontHave=n.sendDontHave??i.sendDontHave),r.wantlist.set(t,n)}for(const[t,n]of e.blockPresences.entries())r.blockPresences.set(t,n);for(const[t,n]of e.blocks.entries())r.blocks.set(t,n);return e.full&&!r.full&&(r.full=!0),r}class MU extends Error{constructor(e="Block too large"){super(e),this.name="BlockTooLargeError"}}u(MU,"name","BlockTooLargeError");const Dse=4193648,$se=Dse+16;function*Nse(r,e){const t=[...r.wantlist.values()],n=[...r.blockPresences.values()],i=[...r.blocks.values()];let s=0,o=0,a=0,c=!1;for(;;){const l={wantlist:{full:r.full??!1,entries:[]},blockPresences:[],blocks:[],pendingBytes:0};let d=J1.encode(l).byteLength,{added:h,hasMore:p,newSize:w}=J8(i,l.blocks,a,e,d,Ose);a+=h,d=w;const f=p;({added:h,hasMore:p,newSize:w}=J8(n,l.blockPresences,o,e,d,Mse)),o+=h,d=w;const g=p;if({added:h,hasMore:p,newSize:w}=J8(t,l.wantlist.entries,s,e,d,Rse),s+=h,d=w,c=!f&&!g&&!p,c||(l.wantlist.full=!1),yield J1.encode(l),c)break}}function J8(r,e,t,n,i,s){let o=0,a=!1;for(let c=t;c<r.length;c++){const l=r[c],d=s(l);if(d>$se)throw new MU("Cannot send block as after encoding it is over the max message size");const h=i+d;if(h>n){a=!0;break}e.push(l),o++,i=h}return{hasMore:a,added:o,newSize:i}}function Ose(r){return BS(3,Y1.encode(r))}function Mse(r){return BS(4,X1.encode(r))}function Rse(r){return BS(1,Q1.encode(r))}function BS(r,e){const t=At(r),n=At(e.byteLength);return t+n+e.byteLength}let Lse=class extends tr{constructor(t,n={}){var i,s;super();u(this,"log");u(this,"libp2p");u(this,"routing");u(this,"protocols");u(this,"running");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"messageReceiveTimeout");u(this,"registrarIds");u(this,"metrics");u(this,"sendQueue");u(this,"runOnLimitedConnections");u(this,"maxOutgoingMessageSize");u(this,"maxIncomingMessageSize");this.log=t.logger.forComponent("helia:bitswap:network"),this.libp2p=t.libp2p,this.routing=t.routing,this.protocols=n.protocols??[rg],this.registrarIds=[],this.running=!1,this._onStream=this._onStream.bind(this),this.maxInboundStreams=n.maxInboundStreams??Sse,this.maxOutboundStreams=n.maxOutboundStreams??xse,this.messageReceiveTimeout=n.messageReceiveTimeout??Ase,this.runOnLimitedConnections=n.runOnLimitedConnections??kse,this.maxIncomingMessageSize=n.maxIncomingMessageSize??OU,this.maxOutgoingMessageSize=n.maxOutgoingMessageSize??n.maxIncomingMessageSize??Tse,this.metrics={blocksSent:(i=t.metrics)==null?void 0:i.registerCounter("helia_bitswap_sent_blocks_total"),dataSent:(s=t.metrics)==null?void 0:s.registerCounter("helia_bitswap_sent_data_bytes_total")},this.sendQueue=new Ic({concurrency:n.messageSendConcurrency??Cse,metrics:t.metrics,metricName:"helia_bitswap_message_send_queue"}),this.sendQueue.addEventListener("error",o=>{this.log.error("error sending wantlist to peer",o.detail)})}async start(){if(this.running)return;this.running=!0,await this.libp2p.handle(this.protocols,this._onStream,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnections});const t={onConnect:n=>{this.safeDispatchEvent("peer:connected",{detail:n})},onDisconnect:n=>{this.safeDispatchEvent("peer:disconnected",{detail:n})}};this.registrarIds=[];for(const n of this.protocols)this.registrarIds.push(await this.libp2p.register(n,t));this.libp2p.getConnections().forEach(n=>{this.safeDispatchEvent("peer:connected",{detail:n.remotePeer})})}async stop(){if(this.running=!1,await this.libp2p.unhandle(this.protocols),this.registrarIds!=null){for(const t of this.registrarIds)this.libp2p.unregister(t);this.registrarIds=[]}}_onStream(t){if(!this.running)return;const{stream:n,connection:i}=t;Promise.resolve().then(async()=>{this.log("incoming new bitswap %s stream from %p",n.protocol,i.remotePeer);const s=()=>{n.status==="open"?n.abort(new Vp(`Incoming Bitswap stream timed out after ${this.messageReceiveTimeout}ms`)):this.log("stream aborted with status %s",n.status)};let o=AbortSignal.timeout(this.messageReceiveTimeout);o.addEventListener("abort",s),await n.closeWrite(),await gn(n,a=>Yd(a,{maxDataLength:this.maxIncomingMessageSize}),async a=>{for await(const c of a)try{const l=J1.decode(c);this.log("incoming new bitswap %s message from %p on stream",n.protocol,i.remotePeer,n.id),this.safeDispatchEvent("bitswap:message",{detail:{peer:i.remotePeer,message:l}}),o.removeEventListener("abort",s),o=AbortSignal.timeout(this.messageReceiveTimeout),o.addEventListener("abort",s)}catch(l){this.log.error("error reading incoming bitswap message from %p on stream",i.remotePeer,n.id,l),n.abort(l);break}})}).catch(s=>{this.log.error("error handling incoming stream from %p",i.remotePeer,s),n.abort(s)})}async*findProviders(t,n){var i;(i=n==null?void 0:n.onProgress)==null||i.call(n,new Ne("bitswap:network:find-providers",t));for await(const s of this.routing.findProviders(t,n))await this.libp2p.isDialable(s.multiaddrs,{runOnLimitedConnection:this.runOnLimitedConnections})&&(yield s)}async findAndConnect(t,n){await Vo(Oh(my(this.findProviders(t,n),(n==null?void 0:n.maxProviders)??_se),async i=>this.connectTo(i.id,n))).catch(i=>{this.log.error(i)})}async sendMessage(t,n,i){if(!this.running)throw new Error("network isn't running");const s=this.sendQueue.queue.find(o=>t.equals(o.options.peerId)&&o.status==="queued");if(s!=null){s.options.message=Pse(s.options.message,n),await s.join({signal:i==null?void 0:i.signal});return}await this.sendQueue.add(async o=>{var l,d;const a=o==null?void 0:o.message;if(a==null)throw new ie("No message to send");this.log("sendMessage to %p",t),(l=o==null?void 0:o.onProgress)==null||l.call(o,new Ne("bitswap:network:send-wantlist",t));const c=await this.libp2p.dialProtocol(t,rg,o);await c.closeRead();try{await gn(Nse(a,this.maxOutgoingMessageSize),h=>Qd(h),c),await c.close(o)}catch(h){(d=o==null?void 0:o.onProgress)==null||d.call(o,new Ne("bitswap:network:send-wantlist:error",{peer:t,error:h})),this.log.error("error sending message to %p",t,h),c.abort(h)}this._updateSentStats(a.blocks)},{peerId:t,signal:i==null?void 0:i.signal,message:n})}async connectTo(t,n){var s;if(!this.running)throw new ql("Network isn't running");(s=n==null?void 0:n.onProgress)==null||s.call(n,new Ne("bitswap:network:dial",t));const[i]=await Promise.all([this.libp2p.dial(t,n),Ti(this.libp2p,"peer:identify",n==null?void 0:n.signal,{filter:o=>{if(!o.detail.peerId.equals(t))return!1;if(o.detail.protocols.includes(rg))return!0;throw new zp(`${t} did not support ${rg}`)}})]);return i}_updateSentStats(t){var i,s;let n=0;for(const o of t.values())n+=o.data.byteLength;(i=this.metrics.dataSent)==null||i.increment(n),(s=this.metrics.blocksSent)==null||s.increment(t.size)}};function Bse(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function gw(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Use(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var Fse=Use,zse=Fse;let Vse=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Kse=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return RU(this,e)}},Hse=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return RU(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function RU(r,e){return new Hse({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let jse=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Vse(e,t,n),this.decoder=new Kse(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function LU({name:r,prefix:e,encode:t,decode:n}){return new jse(r,e,t,n)}function yw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=zse(t,r);return LU({prefix:e,name:r,encode:n,decode:s=>gw(i(s))})}function qse(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Wse(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Zo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return LU({prefix:e,name:r,encode(i){return Wse(i,n,t)},decode(i){return qse(i,n,t,r)}})}const Os=yw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});yw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const Zg=Zo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Zo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Zo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Zo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Zo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Zo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Zo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Zo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Zo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Z8=yw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});yw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Gse=BU,Sk=128,Qse=-128,Yse=Math.pow(2,31);function BU(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Yse;)e[t++]=r&255|Sk,r/=128;for(;r&Qse;)e[t++]=r&255|Sk,r>>>=7;return e[t]=r|0,BU.bytes=t-n+1,e}var Xse=Ov,Jse=128,xk=127;function Ov(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Ov.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&xk)<<i:(o&xk)*Math.pow(2,i),i+=7}while(o>=Jse);return Ov.bytes=s-n,t}var Zse=Math.pow(2,7),eoe=Math.pow(2,14),toe=Math.pow(2,21),roe=Math.pow(2,28),noe=Math.pow(2,35),ioe=Math.pow(2,42),soe=Math.pow(2,49),ooe=Math.pow(2,56),aoe=Math.pow(2,63),coe=function(r){return r<Zse?1:r<eoe?2:r<toe?3:r<roe?4:r<noe?5:r<ioe?6:r<soe?7:r<ooe?8:r<aoe?9:10},loe={encode:Gse,decode:Xse,encodingLength:coe},by=loe;function Mv(r,e=0){return[by.decode(r,e),by.decode.bytes]}function Ey(r,e,t=0){return by.encode(r,e,t),e}function Sy(r){return by.encodingLength(r)}function xy(r,e){const t=e.byteLength,n=Sy(r),i=n+Sy(t),s=new Uint8Array(i+t);return Ey(r,s,0),Ey(t,s,n),s.set(e,i),new US(r,t,e,s)}function UU(r){const e=gw(r),[t,n]=Mv(e),[i,s]=Mv(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new US(t,i,o,e)}function uoe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Bse(r.bytes,t.bytes)}}let US=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function Ak(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return hoe(t,Rv(r),e??Os.encoder);default:return foe(t,Rv(r),e??Zg.encoder)}}const Ik=new WeakMap;function Rv(r){const e=Ik.get(r);if(e==null){const t=new Map;return Ik.set(r,t),t}return e}var oN;let FS=class zr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,oN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Sf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==poe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return zr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=xy(e,t);return zr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return zr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&uoe(e.multihash,n.multihash)}toString(e){return Ak(this,e)}toJSON(){return{"/":Ak(this)}}link(){return this}[(oN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof zr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new zr(n,i,s,o??Ck(n,i,s.bytes))}else if(t[goe]===!0){const{version:n,multihash:i,code:s}=t,o=UU(i);return zr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Sf)throw new Error(`Version 0 CID must use dag-pb (code: ${Sf}) block encoding`);return new zr(e,t,n,n.bytes)}case 1:{const i=Ck(e,t,n.bytes);return new zr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return zr.create(0,Sf,e)}static createV1(e,t){return zr.create(1,e,t)}static decode(e){const[t,n]=zr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=zr.inspectBytes(e),n=t.size-t.multihashSize,i=gw(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new US(t.multihashCode,t.digestSize,s,i);return[t.version===0?zr.createV0(o):zr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=Mv(e.subarray(t));return t+=p,h};let i=n(),s=Sf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=doe(e,t),s=zr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Rv(s).set(n,e),s}};function doe(r,e){switch(r[0]){case"Q":{const t=e??Os;return[Os.prefix,t.decode(`${Os.prefix}${r}`)]}case Os.prefix:{const t=e??Os;return[Os.prefix,t.decode(r)]}case Zg.prefix:{const t=e??Zg;return[Zg.prefix,t.decode(r)]}case Z8.prefix:{const t=e??Z8;return[Z8.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function hoe(r,e,t){const{prefix:n}=t;if(n!==Os.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function foe(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Sf=112,poe=18;function Ck(r,e,t){const n=Sy(r),i=n+Sy(e),s=new Uint8Array(i+t.byteLength);return Ey(r,s,0),Ey(e,s,n),s.set(t,i),s}const goe=Symbol.for("@ipld/js-cid/CID"),FU=0,yoe="identity",zU=gw;function moe(r){return xy(FU,zU(r))}const VU={code:FU,name:yoe,encode:zU,digest:moe};function woe({name:r,code:e,encode:t}){return new voe(r,e,t)}let voe=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?xy(this.code,t):t.then(n=>xy(this.code,n))}else throw Error("Unknown type, must be binary type")}};function boe(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const Eoe=woe({name:"sha2-256",code:18,encode:boe("SHA-256")}),KU=Symbol.for("nodejs.util.inspect.custom"),Soe=114;var aN;class zS{constructor(e){u(this,"type");u(this,"multihash");u(this,"publicKey");u(this,"string");u(this,aN,!0);this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=Os.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return FS.createV1(Soe,this.multihash)}toJSON(){return this.toString()}equals(e){var t;if(e==null)return!1;if(e instanceof Uint8Array)return Xe(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(((t=e==null?void 0:e.toMultihash())==null?void 0:t.bytes)!=null)return Xe(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[(aN=nS,KU)](){return`PeerId(${this.toString()})`}}class HU extends zS{constructor(t){super({...t,type:"RSA"});u(this,"type","RSA");u(this,"publicKey");this.publicKey=t.publicKey}}class jU extends zS{constructor(t){super({...t,type:"Ed25519"});u(this,"type","Ed25519");u(this,"publicKey");this.publicKey=t.publicKey}}class qU extends zS{constructor(t){super({...t,type:"secp256k1"});u(this,"type","secp256k1");u(this,"publicKey");this.publicKey=t.publicKey}}const xoe=2336;var cN,lN;class WU{constructor(e){u(this,"type","url");u(this,"multihash");u(this,"publicKey");u(this,"url");u(this,cN,!0);this.url=e.toString(),this.multihash=VU.digest(fe(this.url))}[(lN=KU,cN=nS,lN)](){return`PeerId(${this.url})`}toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return FS.createV1(xoe,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=ae(e)),e.toString()===this.toString())}}const Aoe=114,kk=2336;function Zt(r,e){let t;if(r.charAt(0)==="1"||r.charAt(0)==="Q")t=UU(Os.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return Mh(FS.parse(r));throw new ie('Please pass a multibase decoder for strings that do not start with "1" or "Q"')}return li(t)}function Xd(r){if(r.type==="Ed25519")return new jU({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new qU({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new HU({multihash:r.toCID().multihash,publicKey:r});throw new bu}function Ioe(r){return Xd(r.publicKey)}function li(r){if(koe(r))return new HU({multihash:r});if(Coe(r))try{const e=yU(r);if(e.type==="Ed25519")return new jU({multihash:r,publicKey:e});if(e.type==="secp256k1")return new qU({multihash:r,publicKey:e})}catch{const t=ae(r.digest);return new WU(new URL(t))}throw new tw("Supplied PeerID Multihash is invalid")}function Mh(r){if((r==null?void 0:r.multihash)==null||r.version==null||r.version===1&&r.code!==Aoe&&r.code!==kk)throw new cB("Supplied PeerID CID is invalid");if(r.code===kk){const e=ae(r.multihash.digest);return new WU(new URL(e))}return li(r.multihash)}function Coe(r){return r.code===VU.code}function koe(r){return r.code===Eoe.code}function GU(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function _oe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var Toe=_oe,Poe=Toe;let Doe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},$oe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return QU(this,e)}},Noe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return QU(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function QU(r,e){return new Noe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Ooe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Doe(e,t,n),this.decoder=new $oe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Moe({name:r,prefix:e,encode:t,decode:n}){return new Ooe(r,e,t,n)}function YU({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Poe(t,r);return Moe({prefix:e,name:r,encode:n,decode:s=>GU(i(s))})}const Roe=YU({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});YU({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Loe=XU,_k=128,Boe=-128,Uoe=Math.pow(2,31);function XU(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Uoe;)e[t++]=r&255|_k,r/=128;for(;r&Boe;)e[t++]=r&255|_k,r>>>=7;return e[t]=r|0,XU.bytes=t-n+1,e}var Foe=Lv,zoe=128,Tk=127;function Lv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Lv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&Tk)<<i:(o&Tk)*Math.pow(2,i),i+=7}while(o>=zoe);return Lv.bytes=s-n,t}var Voe=Math.pow(2,7),Koe=Math.pow(2,14),Hoe=Math.pow(2,21),joe=Math.pow(2,28),qoe=Math.pow(2,35),Woe=Math.pow(2,42),Goe=Math.pow(2,49),Qoe=Math.pow(2,56),Yoe=Math.pow(2,63),Xoe=function(r){return r<Voe?1:r<Koe?2:r<Hoe?3:r<joe?4:r<qoe?5:r<Woe?6:r<Goe?7:r<Qoe?8:r<Yoe?9:10},Joe={encode:Loe,decode:Foe,encodingLength:Xoe},Pk=Joe;function Dk(r,e=0){return[Pk.decode(r,e),Pk.decode.bytes]}function Zoe(r){const e=GU(r),[t,n]=Dk(e),[i,s]=Dk(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new eae(t,i,o,e)}let eae=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function a1(r,e){const t={[Symbol.iterator]:()=>t,next:()=>{const n=r.next(),i=n.value;return n.done===!0||i==null?{done:!0,value:void 0}:{done:!1,value:e(i)}}};return t}function e6(r){const e=Zoe(Roe.decode(`z${r}`));return li(e)}class zc{constructor(e){u(this,"map");if(this.map=new Map,e!=null)for(const[t,n]of e.entries())this.map.set(t.toString(),{key:t,value:n})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return a1(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,n)=>{e(t.value,t.key,this)})}get(e){var t;return(t=this.map.get(e.toString()))==null?void 0:t.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return a1(this.map.values(),e=>e.key)}values(){return a1(this.map.values(),e=>e.value)}get size(){return this.map.size}}class us{constructor(e){u(this,"set");if(this.set=new Set,e!=null)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return a1(this.set.entries(),e=>{const t=e6(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{const n=e6(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return a1(this.set.values(),e=>e6(e))}intersection(e){const t=new us;for(const n of e)this.has(n)&&t.add(n);return t}difference(e){const t=new us;for(const n of this)e.has(n)||t.add(n);return t}union(e){const t=new us;for(const n of e)t.add(n);for(const n of this)t.add(n);return t}}function tae(){return new us}class JU extends eU{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,dw(e);const n=G1(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),js(s)}update(e){return yy(this),this.iHash.update(e),this}digestInto(e){yy(this),jp(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const mw=(r,e,t)=>new JU(r,e).update(t).digest();mw.create=(r,e)=>new JU(r,e);function ZU(r,e,t,n){dw(r);const i=Mne({dkLen:32,asyncTick:10},n),{c:s,dkLen:o,asyncTick:a}=i;if(wd(s),wd(o),wd(a),s<1)throw new Error("iterations (c) should be >= 1");const c=ck(e),l=ck(t),d=new Uint8Array(o),h=mw.create(r,c),p=h._cloneInto().update(l);return{c:s,dkLen:o,asyncTick:a,DK:d,PRF:h,PRFSalt:p}}function eF(r,e,t,n,i){return r.destroy(),e.destroy(),n&&n.destroy(),js(i),t}function rae(r,e,t,n){const{c:i,dkLen:s,DK:o,PRF:a,PRFSalt:c}=ZU(r,e,t,n);let l;const d=new Uint8Array(4),h=o1(d),p=new Uint8Array(a.outputLen);for(let w=1,f=0;f<s;w++,f+=a.outputLen){const g=o.subarray(f,f+a.outputLen);h.setInt32(0,w,!1),(l=c._cloneInto(l)).update(d).digestInto(p),g.set(p.subarray(0,g.length));for(let v=1;v<i;v++){a._cloneInto(l).update(p).digestInto(p);for(let y=0;y<g.length;y++)g[y]^=p[y]}}return eF(a,c,o,l,p)}async function tF(r,e,t,n){const{c:i,dkLen:s,asyncTick:o,DK:a,PRF:c,PRFSalt:l}=ZU(r,e,t,n);let d;const h=new Uint8Array(4),p=o1(h),w=new Uint8Array(c.outputLen);for(let f=1,g=0;g<s;f++,g+=c.outputLen){const v=a.subarray(g,g+c.outputLen);p.setInt32(0,f,!1),(d=l._cloneInto(d)).update(h).digestInto(w),v.set(w.subarray(0,v.length)),await One(i-1,o,()=>{c._cloneInto(d).update(w).digestInto(w);for(let y=0;y<v.length;y++)v[y]^=w[y]})}return eF(c,l,a,d,w)}const xf=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),Ia=new Uint32Array(80);class nae extends _S{constructor(){super(64,20,8,!1),this.A=xf[0]|0,this.B=xf[1]|0,this.C=xf[2]|0,this.D=xf[3]|0,this.E=xf[4]|0}get(){const{A:e,B:t,C:n,D:i,E:s}=this;return[e,t,n,i,s]}set(e,t,n,i,s){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0}process(e,t){for(let c=0;c<16;c++,t+=4)Ia[c]=e.getUint32(t,!1);for(let c=16;c<80;c++)Ia[c]=Y8(Ia[c-3]^Ia[c-8]^Ia[c-14]^Ia[c-16],1);let{A:n,B:i,C:s,D:o,E:a}=this;for(let c=0;c<80;c++){let l,d;c<20?(l=tU(i,s,o),d=1518500249):c<40?(l=i^s^o,d=1859775393):c<60?(l=rU(i,s,o),d=2400959708):(l=i^s^o,d=3395469782);const h=Y8(n,5)+l+a+d+Ia[c]|0;a=o,o=s,s=Y8(i,30),i=n,n=h}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,this.set(n,i,s,o,a)}roundClean(){js(Ia)}destroy(){this.set(0,0,0,0,0),js(this.buffer)}}const iae=kS(()=>new nae),sae=iae,VS=Zne,oae=ci({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});ci({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});ci({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});ci({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const $k={sha1:sae,"sha2-256":Ol,"sha2-512":VS};function Nk(r,e,t,n,i){if(i!=="sha1"&&i!=="sha2-256"&&i!=="sha2-512"){const a=Object.keys($k).join(" / ");throw new ie(`Hash '${i}' is unknown or not supported. Must be ${a}`)}const s=$k[i],o=rae(s,r,e,{c:t,dkLen:n});return oae.encode(o).substring(1)}const KS={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},rF={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},nF=new globalThis.TextEncoder;function aae(r,e){const t=KS[e];let n=rF[e];for(let i=0;i<r.length;i++)n^=BigInt(r[i]),n=BigInt.asUintN(e,n*t);return n}function cae(r,e,t){if(t.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");const n=KS[e];let i=rF[e],s=r;for(;s.length>0;){const o=nF.encodeInto(s,t);s=s.slice(o.read);for(let a=0;a<o.written;a++)i^=BigInt(t[a]),i=BigInt.asUintN(e,i*n)}return i}function lae(r,{size:e=32,utf8Buffer:t}={}){if(!KS[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof r=="string"){if(t)return cae(r,e,t);r=nF.encode(r)}return aae(r,e)}const HS={hash:r=>Number(lae(r,{size:32})),hashV:(r,e)=>uae(HS.hash(r,e))};function uae(r){let e=r.toString(16);return e.length%2===1&&(e=`0${e}`),fe(e,"base16")}const iF=64;class wl{constructor(e,t,n,i=2){u(this,"fp");u(this,"h");u(this,"seed");if(i>iF)throw new TypeError("Invalid Fingerprint Size");const s=t.hashV(e,n),o=tt(i);for(let a=0;a<o.length;a++)o[a]=s[a];o.length===0&&(o[0]=7),this.fp=o,this.h=t,this.seed=n}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return(e==null?void 0:e.fp)instanceof Uint8Array?Xe(this.fp,e.fp):!1}}function Ay(r,e){return Math.floor(Math.random()*(e-r))+r}class ng{constructor(e){u(this,"contents");this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof wl))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof wl))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof wl))throw new TypeError("Invalid Fingerprint");const t=Ay(0,this.contents.length-1),n=this.contents[t];return this.contents[t]=e,n}remove(e){if(!(e instanceof wl))throw new TypeError("Invalid Fingerprint");const t=this.contents.findIndex(n=>e.equals(n));return t>-1?(this.contents[t]=null,!0):!1}}const dae=500;class Ok{constructor(e){u(this,"bucketSize");u(this,"filterSize");u(this,"fingerprintSize");u(this,"buckets");u(this,"count");u(this,"hash");u(this,"seed");this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??HS,this.seed=e.seed??Ay(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=fe(e));const t=new wl(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=(n^t.hash())%this.filterSize;if(this.buckets[n]==null&&(this.buckets[n]=new ng(this.bucketSize)),this.buckets[i]==null&&(this.buckets[i]=new ng(this.bucketSize)),this.buckets[n].add(t)||this.buckets[i].add(t))return this.count++,!0;const s=[n,i];let o=s[Ay(0,s.length-1)];this.buckets[o]==null&&(this.buckets[o]=new ng(this.bucketSize));for(let a=0;a<dae;a++){const c=this.buckets[o].swap(t);if(c!=null&&(o=(o^c.hash())%this.filterSize,this.buckets[o]==null&&(this.buckets[o]=new ng(this.bucketSize)),this.buckets[o].add(c)))return this.count++,!0}return!1}has(e){var o,a;typeof e=="string"&&(e=fe(e));const t=new wl(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=((o=this.buckets[n])==null?void 0:o.has(t))??!1;if(i)return i;const s=(n^t.hash())%this.filterSize;return((a=this.buckets[s])==null?void 0:a.has(t))??!1}remove(e){var a,c;typeof e=="string"&&(e=fe(e));const t=new wl(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=((a=this.buckets[n])==null?void 0:a.remove(t))??!1;if(i)return this.count--,i;const s=(n^t.hash())%this.filterSize,o=((c=this.buckets[s])==null?void 0:c.remove(t))??!1;return o&&this.count--,o}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}}const hae={1:.5,2:.84,4:.95,8:.98};function fae(r=.001){return r>.002?2:r>1e-5?4:8}function pae(r,e=.001){const t=fae(e),n=hae[t],i=Math.round(r/n),s=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),iF);return{filterSize:i,bucketSize:t,fingerprintSize:s}}class gae{constructor(e){u(this,"filterSize");u(this,"bucketSize");u(this,"fingerprintSize");u(this,"scale");u(this,"filterSeries");u(this,"hash");u(this,"seed");this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??HS,this.seed=e.seed??Ay(0,Math.pow(2,10)),this.filterSeries=[new Ok({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=fe(e)),this.has(e))return!0;let t=this.filterSeries.find(n=>n.reliable);if(t==null){const n=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new Ok({filterSize:n,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=fe(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=fe(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}function Ql(r,e=.001,t){return new gae({...pae(r,e)})}class yae{constructor(e,t){u(this,"filter");this.filter=Ql(e,t)}has(e){return this.filter.has(e.toMultihash().bytes)}add(e){this.filter.add(e.toMultihash().bytes)}remove(e){var t,n;(n=(t=this.filter).remove)==null||n.call(t,e.toMultihash().bytes)}}function mae(r,e=.001){return new yae(r,e)}class wae extends zc{constructor(t){super();u(this,"metric");const{name:n,metrics:i}=t;this.metric=i.registerMetric(n),this.updateComponentMetric()}set(t,n){return super.set(t,n),this.updateComponentMetric(),this}delete(t){const n=super.delete(t);return this.updateComponentMetric(),n}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function sF(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new wae({name:e,metrics:t}):n=new zc,n}function vae(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function jS(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function bae(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var Eae=bae,Sae=Eae;let xae=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Aae=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return oF(this,e)}},Iae=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return oF(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function oF(r,e){return new Iae({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Cae=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new xae(e,t,n),this.decoder=new Aae(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function aF({name:r,prefix:e,encode:t,decode:n}){return new Cae(r,e,t,n)}function ww({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Sae(t,r);return aF({prefix:e,name:r,encode:n,decode:s=>jS(i(s))})}function kae(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function _ae(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function ui({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return aF({prefix:e,name:r,encode(i){return _ae(i,n,t)},decode(i){return kae(i,n,t,r)}})}const e2=ui({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ui({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});ui({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});ui({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});ui({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});ui({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});ui({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});ui({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});ui({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const t6=ww({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});ww({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Ta=ww({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});ww({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Tae=cF,Mk=128,Pae=-128,Dae=Math.pow(2,31);function cF(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Dae;)e[t++]=r&255|Mk,r/=128;for(;r&Pae;)e[t++]=r&255|Mk,r>>>=7;return e[t]=r|0,cF.bytes=t-n+1,e}var $ae=Bv,Nae=128,Rk=127;function Bv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Bv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&Rk)<<i:(o&Rk)*Math.pow(2,i),i+=7}while(o>=Nae);return Bv.bytes=s-n,t}var Oae=Math.pow(2,7),Mae=Math.pow(2,14),Rae=Math.pow(2,21),Lae=Math.pow(2,28),Bae=Math.pow(2,35),Uae=Math.pow(2,42),Fae=Math.pow(2,49),zae=Math.pow(2,56),Vae=Math.pow(2,63),Kae=function(r){return r<Oae?1:r<Mae?2:r<Rae?3:r<Lae?4:r<Bae?5:r<Uae?6:r<Fae?7:r<zae?8:r<Vae?9:10},Hae={encode:Tae,decode:$ae,encodingLength:Kae},Iy=Hae;function Uv(r,e=0){return[Iy.decode(r,e),Iy.decode.bytes]}function Cy(r,e,t=0){return Iy.encode(r,e,t),e}function ky(r){return Iy.encodingLength(r)}function Fv(r,e){const t=e.byteLength,n=ky(r),i=n+ky(t),s=new Uint8Array(i+t);return Cy(r,s,0),Cy(t,s,n),s.set(e,i),new qS(r,t,e,s)}function jae(r){const e=jS(r),[t,n]=Uv(e),[i,s]=Uv(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new qS(t,i,o,e)}function qae(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&vae(r.bytes,t.bytes)}}let qS=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function Lk(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Gae(t,zv(r),e??Ta.encoder);default:return Qae(t,zv(r),e??e2.encoder)}}const Bk=new WeakMap;function zv(r){const e=Bk.get(r);if(e==null){const t=new Map;return Bk.set(r,t),t}return e}var uN;let Vv=class Vr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,uN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Af)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Yae)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Vr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Fv(e,t);return Vr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Vr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&qae(e.multihash,n.multihash)}toString(e){return Lk(this,e)}toJSON(){return{"/":Lk(this)}}link(){return this}[(uN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Vr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Vr(n,i,s,o??Uk(n,i,s.bytes))}else if(t[Xae]===!0){const{version:n,multihash:i,code:s}=t,o=jae(i);return Vr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Af)throw new Error(`Version 0 CID must use dag-pb (code: ${Af}) block encoding`);return new Vr(e,t,n,n.bytes)}case 1:{const i=Uk(e,t,n.bytes);return new Vr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Vr.create(0,Af,e)}static createV1(e,t){return Vr.create(1,e,t)}static decode(e){const[t,n]=Vr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Vr.inspectBytes(e),n=t.size-t.multihashSize,i=jS(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new qS(t.multihashCode,t.digestSize,s,i);return[t.version===0?Vr.createV0(o):Vr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=Uv(e.subarray(t));return t+=p,h};let i=n(),s=Af;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Wae(e,t),s=Vr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return zv(s).set(n,e),s}};function Wae(r,e){switch(r[0]){case"Q":{const t=e??Ta;return[Ta.prefix,t.decode(`${Ta.prefix}${r}`)]}case Ta.prefix:{const t=e??Ta;return[Ta.prefix,t.decode(r)]}case e2.prefix:{const t=e??e2;return[e2.prefix,t.decode(r)]}case t6.prefix:{const t=e??t6;return[t6.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Gae(r,e,t){const{prefix:n}=t;if(n!==Ta.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Qae(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Af=112,Yae=18;function Uk(r,e,t){const n=ky(r),i=n+ky(e),s=new Uint8Array(i+t.byteLength);return Cy(r,s,0),Cy(e,s,n),s.set(t,i),s}const Xae=Symbol.for("@ipld/js-cid/CID"),r6=ui({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});ui({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});ui({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});ui({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});class Kf{constructor(e=!1,t=0){u(this,"full");u(this,"pendingBytes");u(this,"wantlist");u(this,"blocks");u(this,"blockPresences");this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}addWantlistEntry(e,t){const n=r6.encode(e.multihash.bytes);this.wantlist.set(n,t)}addBlockPresence(e,t){const n=r6.encode(e.multihash.bytes);this.blockPresences.set(n,t)}addBlock(e,t){const n=r6.encode(e.multihash.bytes);this.blocks.set(n,t)}}function Jae(r){let e=new Uint8Array(r.reduce((n,i)=>n+At(i),0)),t=0;for(const n of r)e=kr(n,e,t),t+=At(n);return e}function Fk(r){return Jae([r.version,r.code,r.multihash.code,r.multihash.digest.byteLength])}class Zae{constructor(e,t){u(this,"peerId");u(this,"blockstore");u(this,"network");u(this,"wants");u(this,"exchangeCount");u(this,"bytesSent");u(this,"bytesReceived");u(this,"lastExchange");u(this,"maxSizeReplaceHasWithBlock");u(this,"log");this.peerId=e.peerId,this.blockstore=e.blockstore,this.network=e.network,this.wants=new Map,this.log=e.logger.forComponent(`helia:bitswap:ledger:${e.peerId}`),this.exchangeCount=0,this.bytesSent=0,this.bytesReceived=0,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock??Ese}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesReceived+=e}debtRatio(){return this.bytesSent/(this.bytesReceived+1)}async sendBlocksToPeer(e){const t=new Kf,n=new Set;for(const[i,s]of this.wants.entries())try{const o=await this.blockstore.get(s.cid,e);s.wantType===pr.WantHave?o.byteLength<this.maxSizeReplaceHasWithBlock?(this.log("sending have and block for %c",s.cid),n.add(i),t.addBlock(s.cid,{data:o,prefix:Fk(s.cid)})):(this.log("sending have for %c",s.cid),t.addBlockPresence(s.cid,{cid:s.cid.bytes,type:Ks.HaveBlock})):(this.log("sending block for %c",s.cid),n.add(i),t.addBlock(s.cid,{data:o,prefix:Fk(s.cid)}))}catch(o){if(o.name!=="NotFoundError")throw o;if(this.log("do not have block for %c",s.cid),!s.sendDontHave||s.sentDoNotHave===!0)continue;s.sentDoNotHave=!0,t.addBlockPresence(s.cid,{cid:s.cid.bytes,type:Ks.DoNotHaveBlock})}if(t.blocks.size>0||t.blockPresences.size>0){this.log("sending message"),await this.network.sendMessage(this.peerId,t,e),this.log("sent message"),this.sentBytes([...t.blocks.values()].reduce((i,s)=>i+s.data.byteLength,0));for(const i of n)this.wants.delete(i)}}}class ece{constructor(e,t={}){u(this,"blockstore");u(this,"network");u(this,"ledgerMap");u(this,"maxSizeReplaceHasWithBlock");u(this,"log");u(this,"logger");this.blockstore=e.blockstore,this.network=e.network,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock,this.log=e.logger.forComponent("helia:bitswap:peer-want-lists"),this.logger=e.logger,this.ledgerMap=sF({name:"helia_bitswap_ledger_map",metrics:e.metrics}),this.network.addEventListener("bitswap:message",n=>{this.receiveMessage(n.detail.peer,n.detail.message).catch(i=>{this.log.error("error receiving bitswap message from %p",n.detail.peer,i)})}),this.network.addEventListener("peer:disconnected",n=>{this.peerDisconnected(n.detail)})}ledgerForPeer(e){const t=this.ledgerMap.get(e);if(t!=null)return{peer:t.peerId,value:t.debtRatio(),sent:t.bytesSent,received:t.bytesReceived,exchanged:t.exchangeCount}}wantListForPeer(e){const t=this.ledgerMap.get(e);if(t!=null)return[...t.wants.values()]}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.peerId)}async receiveMessage(e,t){var i;let n=this.ledgerMap.get(e);if(n==null&&(n=new Zae({peerId:e,blockstore:this.blockstore,network:this.network,logger:this.logger},{maxSizeReplaceHasWithBlock:this.maxSizeReplaceHasWithBlock}),this.ledgerMap.set(e,n)),n.receivedBytes(((i=t.blocks)==null?void 0:i.reduce((s,o)=>s+o.data.byteLength,0))??0),t.wantlist!=null){t.wantlist.full===!0&&n.wants.clear();for(const s of t.wantlist.entries){const o=Vv.decode(s.cid),a=ae(o.multihash.bytes,"base64");s.cancel===!0?(this.log("peer %p cancelled want of block for %c",e,o),n.wants.delete(a)):(s.wantType===pr.WantHave?this.log("peer %p wanted block presence for %c",e,o):this.log("peer %p wanted block for %c",e,o),n.wants.set(a,{cid:o,priority:s.priority,wantType:s.wantType??pr.WantBlock,sendDontHave:s.sendDontHave??!1}))}}this.log("send blocks to peer"),await n.sendBlocksToPeer()}async receivedBlock(e,t){const n=ae(e.multihash.bytes,"base64"),i=[];for(const s of this.ledgerMap.values())s.wants.has(n)&&i.push(s);await Promise.all(i.map(async s=>s.sendBlocksToPeer(t)))}peerDisconnected(e){this.ledgerMap.delete(e)}}function tce(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function rce(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var nce=rce,ice=nce;let sce=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},oce=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return lF(this,e)}},ace=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return lF(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function lF(r,e){return new ace({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let cce=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new sce(e,t,n),this.decoder=new oce(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function uF({name:r,prefix:e,encode:t,decode:n}){return new cce(r,e,t,n)}function dF({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=ice(t,r);return uF({prefix:e,name:r,encode:n,decode:s=>tce(i(s))})}function lce(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function uce(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function di({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return uF({prefix:e,name:r,encode(i){return uce(i,n,t)},decode(i){return lce(i,n,t,r)}})}const dce=di({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});di({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});di({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});di({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});di({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});di({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});di({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});di({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});di({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const hce=dF({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});dF({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const fce=di({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});di({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});di({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});di({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const Jd=1e3,Zd=Jd*60,eh=Zd*60,Yl=eh*24,pce=Yl*7,gce=Yl*365.25;function hF(r,e){try{if(typeof r=="string"&&r.length>0)return yce(r);if(typeof r=="number"&&isFinite(r))return e!=null&&e.long?wce(r):mce(r);throw new Error("Value is not a string or number.")}catch(t){const n=vce(t)?`${t.message}. value=${JSON.stringify(r)}`:"An unknown error has occured.";throw new Error(n)}}function yce(r){if(r=String(r),r.length>100)throw new Error("Value exceeds the maximum length of 100 characters.");const e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!e)return NaN;const t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*gce;case"weeks":case"week":case"w":return t*pce;case"days":case"day":case"d":return t*Yl;case"hours":case"hour":case"hrs":case"hr":case"h":return t*eh;case"minutes":case"minute":case"mins":case"min":case"m":return t*Zd;case"seconds":case"second":case"secs":case"sec":case"s":return t*Jd;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:throw new Error(`The unit ${n} was matched, but no matching case exists.`)}}function mce(r){const e=Math.abs(r);return e>=Yl?`${Math.round(r/Yl)}d`:e>=eh?`${Math.round(r/eh)}h`:e>=Zd?`${Math.round(r/Zd)}m`:e>=Jd?`${Math.round(r/Jd)}s`:`${r}ms`}function wce(r){const e=Math.abs(r);return e>=Yl?ig(r,e,Yl,"day"):e>=eh?ig(r,e,eh,"hour"):e>=Zd?ig(r,e,Zd,"minute"):e>=Jd?ig(r,e,Jd,"second"):`${r} ms`}function ig(r,e,t,n){const i=e>=t*1.5;return`${Math.round(r/t)} ${n}${i?"s":""}`}function vce(r){return typeof r=="object"&&r!==null&&"message"in r}function bce(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=i,t.enabled=o,t.humanize=hF,t.destroy=l,Object.keys(r).forEach(d=>{t[d]=r[d]}),t.names=[],t.skips=[],t.formatters={};function e(d){let h=0;for(let p=0;p<d.length;p++)h=(h<<5)-h+d.charCodeAt(p),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=e;function t(d){let h,p=null,w,f;function g(...v){if(!g.enabled)return;const y=g,m=Number(new Date),b=m-(h||m);y.diff=b,y.prev=h,y.curr=m,h=m,v[0]=t.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let S=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(T,A)=>{if(T==="%%")return"%";S++;const _=t.formatters[A];if(typeof _=="function"){const $=v[S];T=_.call(y,$),v.splice(S,1),S--}return T}),t.formatArgs.call(y,v),(y.log||t.log).apply(y,v)}return g.namespace=d,g.useColors=t.useColors(),g.color=t.selectColor(d),g.extend=n,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(w!==t.namespaces&&(w=t.namespaces,f=t.enabled(d)),f),set:v=>{p=v}}),typeof t.init=="function"&&t.init(g),g}function n(d,h){const p=t(this.namespace+(typeof h>"u"?":":h)+d);return p.log=this.log,p}function i(d){t.save(d),t.namespaces=d,t.names=[],t.skips=[];let h;const p=(typeof d=="string"?d:"").split(/[\s,]+/),w=p.length;for(h=0;h<w;h++)p[h]&&(d=p[h].replace(/\*/g,".*?"),d[0]==="-"?t.skips.push(new RegExp("^"+d.substr(1)+"$")):t.names.push(new RegExp("^"+d+"$")))}function s(){const d=[...t.names.map(a),...t.skips.map(a).map(h=>"-"+h)].join(",");return t.enable(""),d}function o(d){if(d[d.length-1]==="*")return!0;let h,p;for(h=0,p=t.skips.length;h<p;h++)if(t.skips[h].test(d))return!1;for(h=0,p=t.names.length;h<p;h++)if(t.names[h].test(d))return!0;return!1}function a(d){return d.toString().substring(2,d.toString().length-2).replace(/\.\*\?$/,"*")}function c(d){return d instanceof Error?d.stack??d.message:d}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.setupFormatters(t.formatters),t.enable(t.load()),t}var Ece={};const Ms=_ce(),Sce=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function xce(){var r,e,t,n,i;return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&((r=navigator.userAgent)==null?void 0:r.toLowerCase().match(/(edge|trident)\/(\d+)/))!=null?!1:typeof document<"u"&&((t=(e=document.documentElement)==null?void 0:e.style)==null?void 0:t.WebkitAppearance)||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&((n=navigator.userAgent)==null?void 0:n.toLowerCase().match(/firefox\/(\d+)/))!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&((i=navigator.userAgent)==null?void 0:i.toLowerCase().match(/applewebkit\/(\d+)/))}function Ace(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+hF(this.diff),!this.useColors)return;const e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}const Ice=console.debug??console.log??(()=>{});function Cce(r){try{r?Ms==null||Ms.setItem("debug",r):Ms==null||Ms.removeItem("debug")}catch{}}function kce(){let r;try{r=Ms==null?void 0:Ms.getItem("debug")}catch{}return!r&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(r=Ece.DEBUG),r}function _ce(){try{return localStorage}catch{}}function Tce(r){r.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}const Zn=bce({formatArgs:Ace,save:Cce,load:kce,useColors:xce,setupFormatters:Tce,colors:Sce,storage:Ms,log:Ice});Zn.formatters.b=r=>r==null?"undefined":hce.baseEncode(r);Zn.formatters.t=r=>r==null?"undefined":dce.baseEncode(r);Zn.formatters.m=r=>r==null?"undefined":fce.baseEncode(r);Zn.formatters.p=r=>r==null?"undefined":r.toString();Zn.formatters.c=r=>r==null?"undefined":r.toString();Zn.formatters.k=r=>r==null?"undefined":r.toString();Zn.formatters.a=r=>r==null?"undefined":r.toString();Zn.formatters.e=r=>r==null?"undefined":zk(r.stack)??zk(r.message)??r.toString();function Pce(r){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function vw(){return{forComponent(r){return Rh(r)}}}function Rh(r){let e=Pce(`${r}:trace`);return Zn.enabled(`${r}:trace`)&&Zn.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=Zn(`${r}:trace`)),Object.assign(Zn(r),{error:Zn(`${r}:error`),trace:e})}function zk(r){if(r!=null&&(r=r.trim(),r.length!==0))return r}function fF(r){const e=[Cc.A];return r==null?e:Array.isArray(r)?r.length===0?e:r:[r]}const pF=60;function gF(r){return{Status:r.Status??0,TC:r.TC??r.flag_tc??!1,RD:r.RD??r.flag_rd??!1,RA:r.RA??r.flag_ra??!1,AD:r.AD??r.flag_ad??!1,CD:r.CD??r.flag_cd??!1,Question:(r.Question??r.questions??[]).map(e=>({name:e.name,type:Cc[e.type]})),Answer:(r.Answer??r.answers??[]).map(e=>({name:e.name,type:Cc[e.type],TTL:e.TTL??e.ttl??pF,data:e.data instanceof Uint8Array?ae(e.data):e.data}))}}const Dce=4;function Vk(r,e={}){const t=new vc({concurrency:e.queryConcurrency??Dce});return async(n,i={})=>{var a;const s=new URLSearchParams;s.set("name",n),fF(i.types).forEach(c=>{s.append("type",Cc[c])}),(a=i.onProgress)==null||a.call(i,new Ne("dns:query",{detail:n}));const o=await t.add(async()=>{var d;const c=await fetch(`${r}?${s}`,{headers:{accept:"application/dns-json"},signal:i==null?void 0:i.signal});if(c.status!==200)throw new Error(`Unexpected HTTP status: ${c.status} - ${c.statusText}`);const l=gF(await c.json());return(d=i.onProgress)==null||d.call(i,new Ne("dns:response",{detail:l})),l},{signal:i.signal});if(o==null)throw new Error("No DNS response received");return o}}function $ce(){return[Vk("https://cloudflare-dns.com/dns-query"),Vk("https://dns.google/resolve")]}var Nce=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),n=Object.create(null);function i(s,o){t[s]=o,e++,e>=r&&(e=0,n=t,t=Object.create(null))}return{has:function(s){return t[s]!==void 0||n[s]!==void 0},remove:function(s){t[s]!==void 0&&(t[s]=void 0),n[s]!==void 0&&(n[s]=void 0)},get:function(s){var o=t[s];if(o!==void 0)return o;if((o=n[s])!==void 0)return i(s,o),o},set:function(s,o){t[s]!==void 0?t[s]=o:i(s,o)},clear:function(){t=Object.create(null),n=Object.create(null)}}};const Oce=Qs(Nce);class Mce{constructor(e){u(this,"lru");this.lru=Oce(e)}get(e,t){let n=!0;const i=[];for(const s of t){const o=this.getAnswers(e,s);if(o.length===0){n=!1;break}i.push(...o)}if(n)return gF({answers:i})}getAnswers(e,t){const n=`${e.toLowerCase()}-${t}`,i=this.lru.get(n);if(i!=null){const s=i.filter(o=>o.expires>Date.now()).map(({expires:o,value:a})=>({...a,TTL:Math.round((o-Date.now())/1e3),type:Cc[a.type]}));return s.length===0&&this.lru.remove(n),s}return[]}add(e,t){const n=`${e.toLowerCase()}-${t.type}`,i=this.lru.get(n)??[];i.push({expires:Date.now()+(t.TTL??pF)*1e3,value:t}),this.lru.set(n,i)}remove(e,t){const n=`${e.toLowerCase()}-${t}`;this.lru.remove(n)}clear(){this.lru.clear()}}function Rce(r){return new Mce(r)}const Lce=1e3;let Bce=class{constructor(e){u(this,"resolvers");u(this,"cache");this.resolvers={},this.cache=Rce(e.cacheSize??Lce),Object.entries(e.resolvers??{}).forEach(([t,n])=>{Array.isArray(n)||(n=[n]),t.endsWith(".")||(t=`${t}.`),this.resolvers[t]=n}),this.resolvers["."]==null&&(this.resolvers["."]=$ce())}async query(e,t={}){var c,l,d;const n=fF(t.types),i=t.cached!==!1?this.cache.get(e,n):void 0;if(i!=null)return(c=t.onProgress)==null||c.call(t,new Ne("dns:cache",{detail:i})),i;const s=`${e.split(".").pop()}.`,o=(this.resolvers[s]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),a=[];for(const h of o){if(((l=t.signal)==null?void 0:l.aborted)===!0)break;try{const p=await h(e,{...t,types:n});for(const w of p.Answer)this.cache.add(e,w);return p}catch(p){a.push(p),(d=t.onProgress)==null||d.call(t,new Ne("dns:error",{detail:p}))}}throw a.length===1?a[0]:new AggregateError(a,`DNS lookup of ${e} ${n} failed`)}};var Cc;(function(r){r[r.A=1]="A",r[r.CNAME=5]="CNAME",r[r.TXT=16]="TXT",r[r.AAAA=28]="AAAA"})(Cc||(Cc={}));function yF(r={}){return new Bce(r)}const ho="/",mF=new TextEncoder().encode(ho),sg=mF[0];class _t{constructor(e,t){u(this,"_buf");if(typeof e=="string")this._buf=fe(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==sg)throw new Error("Invalid key")}toString(e="utf8"){return ae(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new _t(e.join(ho))}static random(){return new _t(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new _t(e):typeof e.uint8Array=="function"?new _t(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=mF),this._buf[0]!==sg){const e=new Uint8Array(this._buf.byteLength+1);e.fill(sg,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===sg;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;const s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return _t.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(ho).slice(1)}type(){return Uce(this.baseNamespace())}name(){return Fce(this.baseNamespace())}instance(e){return new _t(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(ho)||(e+=ho),e+=this.type(),new _t(e)}parent(){const e=this.list();return e.length===1?new _t(ho):new _t(e.slice(0,-1).join(ho))}child(e){return this.toString()===ho?e:e.toString()===ho?this:new _t(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return _t.withNamespaces([...this.namespaces(),...zce(e.map(t=>t.namespaces()))])}}function Uce(r){const e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function Fce(r){const e=r.split(":");return e[e.length-1]}function zce(r){return[].concat(...r)}function Vce(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Lh(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Kce(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var Hce=Kce,jce=Hce;let qce=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Wce=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return wF(this,e)}},Gce=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return wF(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function wF(r,e){return new Gce({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Qce=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new qce(e,t,n),this.decoder=new Wce(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function vF({name:r,prefix:e,encode:t,decode:n}){return new Qce(r,e,t,n)}function bw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=jce(t,r);return vF({prefix:e,name:r,encode:n,decode:s=>Lh(i(s))})}function Yce(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Xce(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function hi({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return vF({prefix:e,name:r,encode(i){return Xce(i,n,t)},decode(i){return Yce(i,n,t,r)}})}const vd=bw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});bw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const t2=hi({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});hi({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});hi({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});hi({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});hi({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});hi({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});hi({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});hi({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});hi({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Pa=bw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});bw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Jce=bF,Kk=128,Zce=-128,ele=Math.pow(2,31);function bF(r,e,t){e=e||[],t=t||0;for(var n=t;r>=ele;)e[t++]=r&255|Kk,r/=128;for(;r&Zce;)e[t++]=r&255|Kk,r>>>=7;return e[t]=r|0,bF.bytes=t-n+1,e}var tle=Kv,rle=128,Hk=127;function Kv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Kv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&Hk)<<i:(o&Hk)*Math.pow(2,i),i+=7}while(o>=rle);return Kv.bytes=s-n,t}var nle=Math.pow(2,7),ile=Math.pow(2,14),sle=Math.pow(2,21),ole=Math.pow(2,28),ale=Math.pow(2,35),cle=Math.pow(2,42),lle=Math.pow(2,49),ule=Math.pow(2,56),dle=Math.pow(2,63),hle=function(r){return r<nle?1:r<ile?2:r<sle?3:r<ole?4:r<ale?5:r<cle?6:r<lle?7:r<ule?8:r<dle?9:10},fle={encode:Jce,decode:tle,encodingLength:hle},_y=fle;function Hv(r,e=0){return[_y.decode(r,e),_y.decode.bytes]}function Ty(r,e,t=0){return _y.encode(r,e,t),e}function Py(r){return _y.encodingLength(r)}function Dy(r,e){const t=e.byteLength,n=Py(r),i=n+Py(t),s=new Uint8Array(i+t);return Ty(r,s,0),Ty(t,s,n),s.set(e,i),new WS(r,t,e,s)}function ple(r){const e=Lh(r),[t,n]=Hv(e),[i,s]=Hv(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new WS(t,i,o,e)}function gle(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Vce(r.bytes,t.bytes)}}let WS=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function jk(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return mle(t,jv(r),e??Pa.encoder);default:return wle(t,jv(r),e??t2.encoder)}}const qk=new WeakMap;function jv(r){const e=qk.get(r);if(e==null){const t=new Map;return qk.set(r,t),t}return e}var dN;let Xl=class Kr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,dN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==If)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==vle)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Kr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Dy(e,t);return Kr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Kr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&gle(e.multihash,n.multihash)}toString(e){return jk(this,e)}toJSON(){return{"/":jk(this)}}link(){return this}[(dN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Kr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Kr(n,i,s,o??Wk(n,i,s.bytes))}else if(t[ble]===!0){const{version:n,multihash:i,code:s}=t,o=ple(i);return Kr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==If)throw new Error(`Version 0 CID must use dag-pb (code: ${If}) block encoding`);return new Kr(e,t,n,n.bytes)}case 1:{const i=Wk(e,t,n.bytes);return new Kr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Kr.create(0,If,e)}static createV1(e,t){return Kr.create(1,e,t)}static decode(e){const[t,n]=Kr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Kr.inspectBytes(e),n=t.size-t.multihashSize,i=Lh(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new WS(t.multihashCode,t.digestSize,s,i);return[t.version===0?Kr.createV0(o):Kr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=Hv(e.subarray(t));return t+=p,h};let i=n(),s=If;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=yle(e,t),s=Kr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return jv(s).set(n,e),s}};function yle(r,e){switch(r[0]){case"Q":{const t=e??Pa;return[Pa.prefix,t.decode(`${Pa.prefix}${r}`)]}case Pa.prefix:{const t=e??Pa;return[Pa.prefix,t.decode(r)]}case t2.prefix:{const t=e??t2;return[t2.prefix,t.decode(r)]}case vd.prefix:{const t=e??vd;return[vd.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function mle(r,e,t){const{prefix:n}=t;if(n!==Pa.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function wle(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const If=112,vle=18;function Wk(r,e,t){const n=Py(r),i=n+Py(e),s=new Uint8Array(i+t.byteLength);return Ty(r,s,0),Ty(e,s,n),s.set(t,i),s}const ble=Symbol.for("@ipld/js-cid/CID");function EF({name:r,code:e,encode:t}){return new Ele(r,e,t)}let Ele=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Dy(this.code,t):t.then(n=>Dy(this.code,n))}else throw Error("Unknown type, must be binary type")}};function og({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*Sle(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t],s=Xl.asCID(n);s!=null?yield[i.join("/"),s]:typeof n=="object"&&(yield*qv(n,i))}else{const t=Xl.asCID(e);t!=null?yield[r.join("/"),t]:yield*qv(e,r)}}function*qv(r,e){if(r==null||r instanceof Uint8Array)return;const t=Xl.asCID(r);t!=null&&(yield[e.join("/"),t]);for(const[n,i]of Object.entries(r)){const s=[...e,n];yield*Sle(s,i)}}function*xle(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t];yield i.join("/"),typeof n=="object"&&Xl.asCID(n)==null&&(yield*Wv(n,i))}else yield*Wv(e,r)}function*Wv(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const i=[...e,t];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&Xl.asCID(n)==null&&(yield*xle(i,n))}}function Ale(r,e){let t=r;for(const[n,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);const s=Xl.asCID(t);if(s!=null)return{value:s,remaining:e.slice(n+1).join("/")}}return{value:t}}class Ile{constructor({cid:e,bytes:t,value:n}){u(this,"cid");u(this,"bytes");u(this,"value");u(this,"asBlock");if(e==null||t==null||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:og(),bytes:og(),value:og(),asBlock:og()})}links(){return qv(this.value,[])}tree(){return Wv(this.value,[])}get(e="/"){return Ale(this.value,e.split("/").filter(Boolean))}}function Cle({bytes:r,cid:e,value:t,codec:n}){const i=t!==void 0?t:n==null?void 0:n.decode(r);if(i===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new Ile({cid:e,bytes:r,value:i})}const SF="/pin/",Gk="/pinned-block/",Gv=vd,Qk=1;function ag(r){return r.version===0&&(r=r.toV1()),new _t(`${SF}${r.toString(Gv)}`)}var Ro,r2,Qv;class kle{constructor(e,t,n){et(this,Ro);u(this,"datastore");u(this,"blockstore");u(this,"getCodec");this.datastore=e,this.blockstore=t,this.getCodec=n}async*add(e,t={}){const n=ag(e);if(await this.datastore.has(n))throw new Error("Already pinned");const i=Math.round(t.depth??1/0);if(i<0)throw new Error("Depth must be greater than or equal to 0");const s=new Gl({concurrency:Qk});for await(const a of De(this,Ro,r2).call(this,e,s,{...t,depth:i}))await De(this,Ro,Qv).call(this,a,c=>c.pinnedBy.find(l=>Xe(l,e.bytes))!=null?!1:(c.pinCount++,c.pinnedBy.push(e.bytes),!0),t),yield a;const o={depth:i,metadata:t.metadata??{}};await this.datastore.put(n,Wg(o),t)}async*rm(e,t={}){const n=ag(e),i=await this.datastore.get(n,t),s=Va(i);await this.datastore.delete(n,t);const o=new Gl({concurrency:Qk});for await(const a of De(this,Ro,r2).call(this,e,o,{...t,depth:s.depth}))await De(this,Ro,Qv).call(this,a,c=>(c.pinCount--,c.pinnedBy=c.pinnedBy.filter(l=>Xe(l,e.bytes)),!0),{...t,depth:s.depth}),yield a}async*ls(e={}){for await(const{key:t,value:n}of this.datastore.query({prefix:SF+(e.cid!=null?`${e.cid.toString(vd)}`:"")},e)){const i=Xl.parse(t.toString().substring(5),vd),s=Va(n);yield{cid:i,...s}}}async isPinned(e,t={}){const n=new _t(`${Gk}${Gv.encode(e.multihash.bytes)}`);return this.datastore.has(n,t)}async get(e,t){const n=ag(e),i=await this.datastore.get(n,t);return Va(i)}async setMetadata(e,t,n){const i=ag(e),s=await this.datastore.get(i,n),o=Va(s);o.metadata=t??{},await this.datastore.put(i,Wg(o),n)}}Ro=new WeakSet,r2=async function*(e,t,n){if(n.depth===-1)return;const i=await this.getCodec(e.code),s=await this.blockstore.get(e,n),o=Cle({bytes:s,cid:e,codec:i});yield e;for await(const[,a]of o.links())yield*await t.add(async()=>De(this,Ro,r2).call(this,a,t,{...n,depth:n.depth-1}))},Qv=async function(e,t,n){var a;const i=new _t(`${Gk}${Gv.encode(e.multihash.bytes)}`);let s={pinCount:0,pinnedBy:[]};try{s=Va(await this.datastore.get(i,n))}catch(c){if(c.name!=="NotFoundError")throw c}if(t(s)){if(s.pinCount===0&&await this.datastore.has(i)){await this.datastore.delete(i);return}await this.datastore.put(i,Wg(s),n),(a=n.onProgress)==null||a.call(n,new Ne("helia:pin:add",e))}};const _le=1,Tle=5;class xF extends Error{constructor(e="Insufficient providers found"){super(e),this.name="InsufficientProvidersError"}}u(xF,"name","InsufficientProvidersError");class Hf extends Error{constructor(e="No routers available"){super(e),this.name="NoRoutersAvailableError"}}u(Hf,"name","NoRoutersAvailableError");class AF extends Error{constructor(e="Unknown hash algorithm"){super(e),this.name="UnknownHashAlgorithmError"}}u(AF,"name","UnknownHashAlgorithmError");class IF extends Error{constructor(e="Unknown codec"){super(e),this.name="UnknownCodecError"}}u(IF,"name","UnknownCodecError");const Ple=5;class Dle{constructor(e,t){u(this,"log");u(this,"routers");u(this,"providerLookupConcurrency");var n,i,s,o,a,c,l;this.log=e.logger.forComponent("helia:routing"),this.routers=t.routers??[],this.providerLookupConcurrency=t.providerLookupConcurrency??Ple,this.findProviders=((n=e.metrics)==null?void 0:n.traceFunction("helia.routing.findProviders",this.findProviders.bind(this),{optionsIndex:1}))??this.findProviders,this.provide=((i=e.metrics)==null?void 0:i.traceFunction("helia.routing.provide",this.provide.bind(this),{optionsIndex:1}))??this.provide,this.cancelReprovide=((s=e.metrics)==null?void 0:s.traceFunction("helia.routing.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1}))??this.cancelReprovide,this.put=((o=e.metrics)==null?void 0:o.traceFunction("helia.routing.put",this.put.bind(this),{optionsIndex:2}))??this.put,this.get=((a=e.metrics)==null?void 0:a.traceFunction("helia.routing.get",this.get.bind(this),{optionsIndex:1}))??this.get,this.findPeer=((c=e.metrics)==null?void 0:c.traceFunction("helia.routing.findPeer",this.findPeer.bind(this),{optionsIndex:1}))??this.findPeer,this.getClosestPeers=((l=e.metrics)==null?void 0:l.traceFunction("helia.routing.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1}))??this.getClosestPeers}async start(){await Ko(...this.routers)}async stop(){await Uc(...this.routers)}async*findProviders(e,t={}){if(this.routers.length===0)throw new Hf("No content routers available");const n=new Ic({concurrency:this.providerLookupConcurrency});n.addEventListener("error",()=>{});for await(const i of lc(n.toGenerator(),...el(this.routers,"findProviders").map(s=>s.findProviders(e,t))))if(i!=null){if(i.multiaddrs.length===0){if(n.find(i.id)!=null)continue;n.add(async()=>{try{const s=await this.findPeer(i.id,t);return s.multiaddrs.length===0?null:s}catch(s){return this.log.error("could not load multiaddrs for peer %p",i.id,s),null}},{peerId:i.id,signal:t.signal}).catch(s=>{this.log.error("could not load multiaddrs for peer %p",i.id,s)})}yield i}}async provide(e,t={}){if(this.routers.length===0)throw new Hf("No content routers available");await Promise.all(el(this.routers,"provide").map(async n=>{await n.provide(e,t)}))}async cancelReprovide(e,t={}){await Promise.all(el(this.routers,"cancelReprovide").map(async n=>{await n.cancelReprovide(e,t)}))}async put(e,t,n){await Promise.all(el(this.routers,"put").map(async i=>{await i.put(e,t,n)}))}async get(e,t){return Promise.any(el(this.routers,"get").map(async n=>n.get(e,t)))}async findPeer(e,t){if(this.routers.length===0)throw new Hf("No peer routers available");const n=this,i=lc(...el(this.routers,"findPeer").map(s=>async function*(){try{yield await s.findPeer(e,t)}catch(o){n.log.error(o)}}()));for await(const s of i)if(s!=null)return s;throw new sr("Could not find peer in routing")}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new Hf("No peer routers available");for await(const n of lc(...el(this.routers,"getClosestPeers").map(i=>i.getClosestPeers(e,t))))n!=null&&(yield n)}}function el(r,e){return r.filter(t=>t[e]!=null)}const fc={},Jl=r=>{r.addEventListener("message",e=>{Jl.dispatchEvent("message",r,e)}),r.port!=null&&r.port.addEventListener("message",e=>{Jl.dispatchEvent("message",r,e)})};Jl.addEventListener=(r,e)=>{fc[r]==null&&(fc[r]=[]),fc[r].push(e)};Jl.removeEventListener=(r,e)=>{fc[r]!=null&&(fc[r]=fc[r].filter(t=>t===e))};Jl.dispatchEvent=function(r,e,t){fc[r]!=null&&fc[r].forEach(n=>n(e,t))};const Yk="lock:worker:request-read",Xk="lock:worker:release-read",Jk="lock:master:grant-read",Zk="lock:worker:request-write",e_="lock:worker:release-write",t_="lock:master:grant-write",$le=(r=21)=>Math.random().toString().substring(2),r_=(r,e,t,n,i)=>(s,o)=>{if(o.data.type!==t)return;const a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};r.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>{s.postMessage({type:i,name:a.name,identifier:a.identifier}),await new Promise(c=>{const l=d=>{if((d==null?void 0:d.data)==null)return;const h={type:d.data.type,name:d.data.name,identifier:d.data.identifier};h.type===n&&h.identifier===a.identifier&&(s.removeEventListener("message",l),c())};s.addEventListener("message",l)})}}}))},n_=(r,e,t,n)=>async()=>{const i=$le();return globalThis.postMessage({type:e,identifier:i,name:r}),new Promise(s=>{const o=a=>{if((a==null?void 0:a.data)==null)return;const c={type:a.data.type,identifier:a.data.identifier};c.type===t&&c.identifier===i&&(globalThis.removeEventListener("message",o),s(()=>{globalThis.postMessage({type:n,identifier:i,name:r})}))};globalThis.addEventListener("message",o)})},Nle={singleProcess:!1},Ole=r=>{if(r=Object.assign({},Nle,r),!!globalThis.document||r.singleProcess){const t=new EventTarget;return Jl.addEventListener("message",r_(t,"requestReadLock",Yk,Xk,Jk)),Jl.addEventListener("message",r_(t,"requestWriteLock",Zk,e_,t_)),t}return{isWorker:!0,readLock:t=>n_(t,Yk,Jk,Xk),writeLock:t=>n_(t,Zk,t_,e_)}},tl={};let Ka;async function n6(r,e){let t;const n=new Promise(i=>{t=i});return r.add(async()=>Np((async()=>{await new Promise(i=>{t(()=>{i()})})})(),{milliseconds:e.timeout})),n}const Mle=(r,e)=>{if(Ka.isWorker===!0)return{readLock:Ka.readLock(r,e),writeLock:Ka.writeLock(r,e)};const t=new vc({concurrency:1});let n;return{async readLock(){if(n!=null)return n6(n,e);n=new vc({concurrency:e.concurrency,autoStart:!1});const i=n,s=n6(n,e);return t.add(async()=>{i.start(),await i.onIdle().then(()=>{n===i&&(n=null)})}),s},async writeLock(){return n=null,n6(t,e)}}},Rle={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function GS(r){const e=Object.assign({},Rle,r);return Ka==null&&(Ka=Ole(e),Ka.isWorker!==!0&&(Ka.addEventListener("requestReadLock",t=>{tl[t.data.name]!=null&&tl[t.data.name].readLock().then(async n=>t.data.handler().finally(()=>{n()}))}),Ka.addEventListener("requestWriteLock",async t=>{tl[t.data.name]!=null&&tl[t.data.name].writeLock().then(async n=>t.data.handler().finally(()=>{n()}))}))),tl[e.name]==null&&(tl[e.name]=Mle(e.name,e)),tl[e.name]}class Lle{constructor(e,t,n={}){u(this,"lock");u(this,"child");u(this,"pins");u(this,"started");this.child=e,this.pins=t,this.lock=GS({singleProcess:n.holdGcLock}),this.started=!1}isStarted(){return this.started}async start(){await Ko(this.child),this.started=!0}async stop(){await Uc(this.child),this.started=!1}unwrap(){return this.child}async put(e,t,n={}){var s;(s=n==null?void 0:n.signal)==null||s.throwIfAborted();const i=await this.lock.readLock();try{return await this.child.put(e,t,n)}finally{i()}}async*putMany(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.putMany(e,t)}finally{n()}}async get(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{return await this.child.get(e,t)}finally{n()}}async*getMany(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.getMany(e,t)}finally{n()}}async delete(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.writeLock();try{if(await this.pins.isPinned(e))throw new Error("CID was pinned");await this.child.delete(e,t)}finally{n()}}async*deleteMany(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.writeLock();try{const s=this;yield*this.child.deleteMany(async function*(){for await(const o of e){if(await s.pins.isPinned(o))throw new Error("CID was pinned");yield o}}(),t)}finally{n()}}async has(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{return await this.child.has(e,t)}finally{n()}}async*getAll(e={}){var n;(n=e==null?void 0:e.signal)==null||n.throwIfAborted();const t=await this.lock.readLock();try{yield*this.child.getAll(e)}finally{t()}}createSession(e,t){var n;return(n=t==null?void 0:t.signal)==null||n.throwIfAborted(),this.child.createSession(e,t)}}const i6=new _t("/version"),i_=1;async function Ble(r){if(!await r.has(i6)){await r.put(i6,fe(`${i_}`));return}const e=await r.get(i6),t=ae(e);if(parseInt(t,10)!==i_)throw new Error("Unknown datastore version, a datastore migration may be required")}class Ule extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===X.array&&(t.elements++,t.elements!==1&&e.push([44])),t.type===X.map&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[X.uint.major](e,t){this.prefix(e);const n=String(t.value),i=[];for(let s=0;s<n.length;s++)i[s]=n.charCodeAt(s);e.push(i)}[X.negint.major](e,t){this[X.uint.major](e,t)}[X.bytes.major](e,t){throw new Error(`${_l} unsupported type: Uint8Array`)}[X.string.major](e,t){this.prefix(e);const n=fL(JSON.stringify(t.value));e.push(n.length>32?PE(n):n)}[X.array.major](e,t){this.prefix(e),this.inRecursive.push({type:X.array,elements:0}),e.push([91])}[X.map.major](e,t){this.prefix(e),this.inRecursive.push({type:X.map,elements:0}),e.push([123])}[X.tag.major](e,t){}[X.float.major](e,t){if(t.type.name==="break"){const o=this.inRecursive.pop();if(o){if(o.type===X.array)e.push([93]);else if(o.type===X.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${_l} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}const n=String(t.value),i=[];let s=!1;for(let o=0;o<n.length;o++)i[o]=n.charCodeAt(o),!s&&(i[o]===46||i[o]===101||i[o]===69)&&(s=!0);s||(i.push(46),i.push(48)),e.push(i)}}function Fle(r,e){if(Array.isArray(r[0])||Array.isArray(e[0]))throw new Error(`${_l} complex map keys are not supported`);const t=r[0],n=e[0];if(t.type!==X.string||n.type!==X.string)throw new Error(`${_l} non-string map keys are not supported`);if(t<n)return-1;if(t>n)return 1;throw new Error(`${_l} unexpected duplicate map keys, this is not supported`)}const zle={addBreakTokens:!0,mapSorter:Fle};function Vle(r,e){return e=Object.assign({},zle,e),xL(r,new Ule,e)}class CF{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error(`${$e} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw new Error(`${$e} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this._pos;let t=!1,n=!1;const i=a=>{for(;!this.done();){const c=this.ch();if(a.includes(c))this._pos++;else break}};if(this.ch()===45&&(t=!0,this._pos++),this.ch()===48)if(this._pos++,this.ch()===46)this._pos++,n=!0;else return new de(X.uint,0,this._pos-e);if(i([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw new Error(`${$e} unexpected token at position ${this._pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${$e} unexpected token at position ${this._pos}`);n=!0,this._pos++,i([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this._pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this._pos++,i([48,49,50,51,52,53,54,55,56,57]));const s=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),o=parseFloat(s);return n?new de(X.float,o,this._pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(o)?new de(o>=0?X.uint:X.negint,o,this._pos-e):new de(o>=0?X.uint:X.negint,BigInt(s),this._pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${$e} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let s=this._pos,o=0;s<this.data.length&&o<65536;s++,o++){const a=this.data[s];if(a===92||a<32||a>=128)break;if(a===34){const c=String.fromCharCode.apply(null,this.data.subarray(this._pos,s));return this._pos=s+1,new de(X.string,c,o)}}const e=this._pos,t=[],n=()=>{if(this._pos+4>=this.data.length)throw new Error(`${$e} unexpected end of unicode escape sequence at position ${this._pos}`);let s=0;for(let o=0;o<4;o++){let a=this.ch();if(a>=48&&a<=57)a-=48;else if(a>=97&&a<=102)a=a-97+10;else if(a>=65&&a<=70)a=a-65+10;else throw new Error(`${$e} unexpected unicode escape character at position ${this._pos}`);s=s*16+a,this._pos++}return s},i=()=>{const s=this.ch();let o=null,a=s>239?4:s>223?3:s>191?2:1;if(this._pos+a>this.data.length)throw new Error(`${$e} unexpected unicode sequence at position ${this._pos}`);let c,l,d,h;switch(a){case 1:s<128&&(o=s);break;case 2:c=this.data[this._pos+1],(c&192)===128&&(h=(s&31)<<6|c&63,h>127&&(o=h));break;case 3:c=this.data[this._pos+1],l=this.data[this._pos+2],(c&192)===128&&(l&192)===128&&(h=(s&15)<<12|(c&63)<<6|l&63,h>2047&&(h<55296||h>57343)&&(o=h));break;case 4:c=this.data[this._pos+1],l=this.data[this._pos+2],d=this.data[this._pos+3],(c&192)===128&&(l&192)===128&&(d&192)===128&&(h=(s&15)<<18|(c&63)<<12|(l&63)<<6|d&63,h>65535&&h<1114112&&(o=h))}o===null?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|o&1023),t.push(o),this._pos+=a};for(;!this.done();){const s=this.ch();let o;switch(s){case 92:if(this._pos++,this.done())throw new Error(`${$e} unexpected string termination at position ${this._pos}`);switch(o=this.ch(),this._pos++,o){case 34:case 39:case 92:case 47:t.push(o);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${$e} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new de(X.string,pL(t),this._pos-e);default:if(s<32)throw new Error(`${$e} invalid control character at position ${this._pos}`);s<128?(t.push(s),this._pos++):i()}}throw new Error(`${$e} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new de(X.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new de(X.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new de(X.null,null,4);case 102:return this.expect([102,97,108,115,101]),new de(X.false,!1,5);case 116:return this.expect([116,114,117,101]),new de(X.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${$e} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this._pos++,this.skipWhitespace(),new de(X.break,void 0,1);if(this.ch()!==44)throw new Error(`${$e} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this._pos++,this.skipWhitespace(),new de(X.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new de(X.break,void 0,1);if(this.ch()!==44)throw new Error(`${$e} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this._pos++,this.skipWhitespace(),new de(X.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${$e} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${$e} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}}function Kle(r,e){return e=Object.assign({tokenizer:new CF(r,e)},e),Va(r,e)}function Hle(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function QS(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function jle(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var qle=jle,Wle=qle;let Gle=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Qle=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return kF(this,e)}},Yle=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return kF(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function kF(r,e){return new Yle({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Xle=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Gle(e,t,n),this.decoder=new Qle(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function _F({name:r,prefix:e,encode:t,decode:n}){return new Xle(r,e,t,n)}function Ew({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Wle(t,r);return _F({prefix:e,name:r,encode:n,decode:s=>QS(i(s))})}function Jle(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Zle(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function fi({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return _F({prefix:e,name:r,encode(i){return Zle(i,n,t)},decode(i){return Jle(i,n,t,r)}})}const n2=fi({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});fi({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});fi({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});fi({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});fi({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});fi({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});fi({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});fi({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});fi({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const s6=Ew({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Ew({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Da=Ew({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Ew({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var eue=TF,s_=128,tue=-128,rue=Math.pow(2,31);function TF(r,e,t){e=e||[],t=t||0;for(var n=t;r>=rue;)e[t++]=r&255|s_,r/=128;for(;r&tue;)e[t++]=r&255|s_,r>>>=7;return e[t]=r|0,TF.bytes=t-n+1,e}var nue=Yv,iue=128,o_=127;function Yv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Yv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&o_)<<i:(o&o_)*Math.pow(2,i),i+=7}while(o>=iue);return Yv.bytes=s-n,t}var sue=Math.pow(2,7),oue=Math.pow(2,14),aue=Math.pow(2,21),cue=Math.pow(2,28),lue=Math.pow(2,35),uue=Math.pow(2,42),due=Math.pow(2,49),hue=Math.pow(2,56),fue=Math.pow(2,63),pue=function(r){return r<sue?1:r<oue?2:r<aue?3:r<cue?4:r<lue?5:r<uue?6:r<due?7:r<hue?8:r<fue?9:10},gue={encode:eue,decode:nue,encodingLength:pue},$y=gue;function Xv(r,e=0){return[$y.decode(r,e),$y.decode.bytes]}function Ny(r,e,t=0){return $y.encode(r,e,t),e}function Oy(r){return $y.encodingLength(r)}function yue(r,e){const t=e.byteLength,n=Oy(r),i=n+Oy(t),s=new Uint8Array(i+t);return Ny(r,s,0),Ny(t,s,n),s.set(e,i),new YS(r,t,e,s)}function mue(r){const e=QS(r),[t,n]=Xv(e),[i,s]=Xv(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new YS(t,i,o,e)}function wue(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Hle(r.bytes,t.bytes)}}let YS=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function a_(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return bue(t,Jv(r),e??Da.encoder);default:return Eue(t,Jv(r),e??n2.encoder)}}const c_=new WeakMap;function Jv(r){const e=c_.get(r);if(e==null){const t=new Map;return c_.set(r,t),t}return e}var hN;let PF=class Hr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,hN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Cf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Sue)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Hr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=yue(e,t);return Hr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Hr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&wue(e.multihash,n.multihash)}toString(e){return a_(this,e)}toJSON(){return{"/":a_(this)}}link(){return this}[(hN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Hr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Hr(n,i,s,o??l_(n,i,s.bytes))}else if(t[xue]===!0){const{version:n,multihash:i,code:s}=t,o=mue(i);return Hr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Cf)throw new Error(`Version 0 CID must use dag-pb (code: ${Cf}) block encoding`);return new Hr(e,t,n,n.bytes)}case 1:{const i=l_(e,t,n.bytes);return new Hr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Hr.create(0,Cf,e)}static createV1(e,t){return Hr.create(1,e,t)}static decode(e){const[t,n]=Hr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Hr.inspectBytes(e),n=t.size-t.multihashSize,i=QS(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new YS(t.multihashCode,t.digestSize,s,i);return[t.version===0?Hr.createV0(o):Hr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=Xv(e.subarray(t));return t+=p,h};let i=n(),s=Cf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=vue(e,t),s=Hr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Jv(s).set(n,e),s}};function vue(r,e){switch(r[0]){case"Q":{const t=e??Da;return[Da.prefix,t.decode(`${Da.prefix}${r}`)]}case Da.prefix:{const t=e??Da;return[Da.prefix,t.decode(r)]}case n2.prefix:{const t=e??n2;return[n2.prefix,t.decode(r)]}case s6.prefix:{const t=e??s6;return[s6.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function bue(r,e,t){const{prefix:n}=t;if(n!==Da.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Eue(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Cf=112,Sue=18;function l_(r,e,t){const n=Oy(r),i=n+Oy(e),s=new Uint8Array(i+t.byteLength);return Ny(r,s,0),Ny(e,s,n),s.set(t,i),s}const xue=Symbol.for("@ipld/js-cid/CID"),DF=fi({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});fi({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});fi({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});fi({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function Aue(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function Iue(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=PF.asCID(r);if(!e)return null;const t=e.toString();return[new de(X.map,1/0,1),new de(X.string,"/",1),new de(X.string,t,t.length),new de(X.break,void 0,1)]}function My(r){const e=DF.encode(r).slice(1);return[new de(X.map,1/0,1),new de(X.string,"/",1),new de(X.map,1/0,1),new de(X.string,"bytes",5),new de(X.string,e,e.length),new de(X.break,void 0,1),new de(X.break,void 0,1)]}function Wi(r){return My(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}function Cue(r){return My(new Uint8Array(r))}function kue(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function _ue(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const Tue={typeEncoders:{Object:Iue,Buffer:My,Uint8Array:My,Int8Array:Wi,Uint16Array:Wi,Int16Array:Wi,Uint32Array:Wi,Int32Array:Wi,Float32Array:Wi,Float64Array:Wi,Uint8ClampedArray:Wi,BigInt64Array:Wi,BigUint64Array:Wi,DataView:Wi,ArrayBuffer:Cue,undefined:kue,number:_ue}};class Pue extends CF{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(e.type===X.map){const t=this._next();if(t.type===X.string&&t.value==="/"){const n=this._next();if(n.type===X.string){if(this._next().type!==X.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new de(X.tag,42,0)}if(n.type===X.map){const i=this._next();if(i.type===X.string&&i.value==="bytes"){const s=this._next();if(s.type===X.string){for(let a=0;a<2;a++)if(this._next().type!==X.break)throw new Error("Invalid encoded Bytes form");const o=DF.decode(`m${s.value}`);return new de(X.bytes,o,s.value.length)}this.tokenBuffer.push(s)}this.tokenBuffer.push(i)}this.tokenBuffer.push(n)}this.tokenBuffer.push(t)}return e}}const Zv={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Zv.tags[42]=PF.parse;const Due="dag-json",$F=297,NF=r=>Vle(r,Tue),OF=r=>{const e=Aue(r),t=Object.assign(Zv,{tokenizer:new Pue(e,Zv)});return Kle(e,t)},u_=r=>$ue.decode(NF(r)),$ue=new TextDecoder,Nue=r=>OF(Oue.encode(r)),Oue=new TextEncoder,Mue=Object.freeze(Object.defineProperty({__proto__:null,code:$F,decode:OF,encode:NF,format:u_,name:Due,parse:Nue,stringify:u_},Symbol.toStringTag,{value:"Module"}));function Rue(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function XS(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Lue(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var Bue=Lue,Uue=Bue;let Fue=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},zue=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return MF(this,e)}},Vue=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return MF(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function MF(r,e){return new Vue({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Kue=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Fue(e,t,n),this.decoder=new zue(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function RF({name:r,prefix:e,encode:t,decode:n}){return new Kue(r,e,t,n)}function Sw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Uue(t,r);return RF({prefix:e,name:r,encode:n,decode:s=>XS(i(s))})}function Hue(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function jue(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function ea({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return RF({prefix:e,name:r,encode(i){return jue(i,n,t)},decode(i){return Hue(i,n,t,r)}})}const i2=ea({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ea({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});ea({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});ea({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});ea({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});ea({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});ea({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});ea({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});ea({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const o6=Sw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Sw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const $a=Sw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Sw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var que=LF,d_=128,Wue=-128,Gue=Math.pow(2,31);function LF(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Gue;)e[t++]=r&255|d_,r/=128;for(;r&Wue;)e[t++]=r&255|d_,r>>>=7;return e[t]=r|0,LF.bytes=t-n+1,e}var Que=eb,Yue=128,h_=127;function eb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw eb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&h_)<<i:(o&h_)*Math.pow(2,i),i+=7}while(o>=Yue);return eb.bytes=s-n,t}var Xue=Math.pow(2,7),Jue=Math.pow(2,14),Zue=Math.pow(2,21),ede=Math.pow(2,28),tde=Math.pow(2,35),rde=Math.pow(2,42),nde=Math.pow(2,49),ide=Math.pow(2,56),sde=Math.pow(2,63),ode=function(r){return r<Xue?1:r<Jue?2:r<Zue?3:r<ede?4:r<tde?5:r<rde?6:r<nde?7:r<ide?8:r<sde?9:10},ade={encode:que,decode:Que,encodingLength:ode},Ry=ade;function tb(r,e=0){return[Ry.decode(r,e),Ry.decode.bytes]}function Ly(r,e,t=0){return Ry.encode(r,e,t),e}function By(r){return Ry.encodingLength(r)}function cde(r,e){const t=e.byteLength,n=By(r),i=n+By(t),s=new Uint8Array(i+t);return Ly(r,s,0),Ly(t,s,n),s.set(e,i),new JS(r,t,e,s)}function lde(r){const e=XS(r),[t,n]=tb(e),[i,s]=tb(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new JS(t,i,o,e)}function ude(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Rue(r.bytes,t.bytes)}}let JS=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function f_(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return hde(t,rb(r),e??$a.encoder);default:return fde(t,rb(r),e??i2.encoder)}}const p_=new WeakMap;function rb(r){const e=p_.get(r);if(e==null){const t=new Map;return p_.set(r,t),t}return e}var fN;let jf=class jr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,fN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==kf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==pde)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return jr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=cde(e,t);return jr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return jr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&ude(e.multihash,n.multihash)}toString(e){return f_(this,e)}toJSON(){return{"/":f_(this)}}link(){return this}[(fN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof jr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new jr(n,i,s,o??g_(n,i,s.bytes))}else if(t[gde]===!0){const{version:n,multihash:i,code:s}=t,o=lde(i);return jr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==kf)throw new Error(`Version 0 CID must use dag-pb (code: ${kf}) block encoding`);return new jr(e,t,n,n.bytes)}case 1:{const i=g_(e,t,n.bytes);return new jr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return jr.create(0,kf,e)}static createV1(e,t){return jr.create(1,e,t)}static decode(e){const[t,n]=jr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=jr.inspectBytes(e),n=t.size-t.multihashSize,i=XS(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new JS(t.multihashCode,t.digestSize,s,i);return[t.version===0?jr.createV0(o):jr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=tb(e.subarray(t));return t+=p,h};let i=n(),s=kf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=dde(e,t),s=jr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return rb(s).set(n,e),s}};function dde(r,e){switch(r[0]){case"Q":{const t=e??$a;return[$a.prefix,t.decode(`${$a.prefix}${r}`)]}case $a.prefix:{const t=e??$a;return[$a.prefix,t.decode(r)]}case i2.prefix:{const t=e??i2;return[i2.prefix,t.decode(r)]}case o6.prefix:{const t=e??o6;return[o6.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function hde(r,e,t){const{prefix:n}=t;if(n!==$a.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function fde(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const kf=112,pde=18;function g_(r,e,t){const n=By(r),i=n+By(e),s=new Uint8Array(i+t.byteLength);return Ly(r,s,0),Ly(e,s,n),s.set(t,i),s}const gde=Symbol.for("@ipld/js-cid/CID"),yde=new TextDecoder;function ZS(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");const i=r[e++];if(t+=n<28?(i&127)<<n:(i&127)*2**n,i<128)break}return[t,e]}function Uy(r,e){let t;[t,e]=ZS(r,e);const n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function BF(r,e){let t;return[t,e]=ZS(r,e),[t&7,t>>3,e]}function mde(r){const e={},t=r.length;let n=0;for(;n<t;){let i,s;if([i,s,n]=BF(r,n),s===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=Uy(r,n)}else if(s===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=Uy(r,n),e.Name=yde.decode(o)}else if(s===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(i!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Tsize`);[e.Tsize,n]=ZS(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${s}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function wde(r){const e=r.length;let t=0,n,i=!1,s;for(;t<e;){let a,c;if([a,c,t]=BF(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(s)throw new Error("protobuf: (PBNode) duplicate Data section");[s,t]=Uy(r,t),n&&(i=!0)}else if(c===2){if(i)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let l;[l,t]=Uy(r,t),n.push(mde(l))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");const o={};return s&&(o.Data=s),o.Links=n||[],o}const UF=new TextEncoder,y_=2**32,vde=2**31;function bde(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=c1(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){const n=UF.encode(r.Name);t-=n.length,e.set(n,t),t=c1(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=c1(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function Ede(r){const e=xde(r),t=new Uint8Array(e);let n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=c1(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let i=r.Links.length-1;i>=0;i--){const s=bde(r.Links[i],t.subarray(0,n));n-=s,n=c1(t,n,s)-1,t[n]=18}return t}function Sde(r){let e=0;if(r.Hash){const t=r.Hash.length;e+=1+t+bd(t)}if(typeof r.Name=="string"){const t=UF.encode(r.Name).length;e+=1+t+bd(t)}return typeof r.Tsize=="number"&&(e+=1+bd(r.Tsize)),e}function xde(r){let e=0;if(r.Data){const t=r.Data.length;e+=1+t+bd(t)}if(r.Links)for(const t of r.Links){const n=Sde(t);e+=1+n+bd(n)}return e}function c1(r,e,t){e-=bd(t);const n=e;for(;t>=vde;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function bd(r){return r%2===0&&r++,Math.floor((Ade(r)+6)/7)}function Ade(r){let e=0;return r>=y_&&(r=Math.floor(r/y_),e=32),r>=65536&&(r>>>=16,e+=16),r>=256&&(r>>>=8,e+=8),e+Ide[r]}const Ide=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],Cde=["Data","Links"],kde=["Hash","Name","Tsize"],nb=new TextEncoder;function FF(r,e){if(r===e)return 0;const t=r.Name?nb.encode(r.Name):[],n=e.Name?nb.encode(e.Name):[];let i=t.length,s=n.length;for(let o=0,a=Math.min(i,s);o<a;++o)if(t[o]!==n[o]){i=t[o],s=n[o];break}return i<s?-1:s<i?1:0}function m_(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function zF(r){if(typeof r.asCID=="object"){const t=jf.asCID(r);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Hash){let t=jf.asCID(r.Hash);try{t||(typeof r.Hash=="string"?t=jf.parse(r.Hash):r.Hash instanceof Uint8Array&&(t=jf.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(e.Name=r.Name),typeof r.Tsize=="number"&&(e.Tsize=r.Tsize),e}function VF(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Data!==void 0)if(typeof r.Data=="string")e.Data=nb.encode(r.Data);else if(r.Data instanceof Uint8Array)e.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))e.Links=r.Links.map(zF),e.Links.sort(FF);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function KF(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!m_(r,Cde))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<r.Links.length;e++){const t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!m_(t,kde))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash==null||!t.Hash["/"]||t.Hash["/"]!==t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0){if(typeof t.Tsize!="number"||t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&FF(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function _de(r,e=[]){return VF({Data:r,Links:e})}function Tde(r,e,t){return zF({Hash:t,Name:r,Tsize:e})}function Pde(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}const Dde="dag-pb",HF=112;function $de(r){KF(r);const e={};return r.Links&&(e.Links=r.Links.map(t=>{const n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),Ede(e)}function Nde(r){const e=Pde(r),t=wde(e),n={};return t.Data&&(n.Data=t.Data),t.Links&&(n.Links=t.Links.map(i=>{const s={};try{s.Hash=jf.decode(i.Hash)}catch{}if(!s.Hash)throw new Error("Invalid Hash field found in link, expected CID");return i.Name!==void 0&&(s.Name=i.Name),i.Tsize!==void 0&&(s.Tsize=i.Tsize),s})),n}const Ode=Object.freeze(Object.defineProperty({__proto__:null,code:HF,createLink:Tde,createNode:_de,decode:Nde,encode:$de,name:Dde,prepare:VF,validate:KF},Symbol.toStringTag,{value:"Module"})),Mde=new TextEncoder,Rde=new TextDecoder,Lde="json",jF=512;function Bde(r){return Mde.encode(JSON.stringify(r))}function Ude(r){return JSON.parse(Rde.decode(r))}const Fde=Object.freeze(Object.defineProperty({__proto__:null,code:jF,decode:Ude,encode:Bde,name:Lde},Symbol.toStringTag,{value:"Module"})),zde="raw",qF=85;function Vde(r){return Lh(r)}function Kde(r){return Lh(r)}const Hde=Object.freeze(Object.defineProperty({__proto__:null,code:qF,decode:Kde,encode:Vde,name:zde},Symbol.toStringTag,{value:"Module"}));function ex(r){return(r==null?void 0:r.then)!=null}function jde(r=[],e){const t={[HF]:Ode,[qF]:Hde,[PL]:Rp,[$F]:Mue,[jF]:Fde};return r.forEach(n=>{t[n.code]=n}),async n=>{let i=t[n];if(i==null&&e!=null){const s=e(n);ex(s)?i=await s:i=s,t[i.code]=i}if(i!=null)return i;throw new IF(`Could not load codec for ${n}`)}}const WF=0,qde="identity",GF=Lh;function Wde(r){return Dy(WF,GF(r))}const w_={code:WF,name:qde,encode:GF,digest:Wde};function QF(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const v_=EF({name:"sha2-256",code:18,encode:QF("SHA-256")}),b_=EF({name:"sha2-512",code:19,encode:QF("SHA-512")});function Gde(r=[],e){const t={[v_.code]:v_,[b_.code]:b_,[w_.code]:w_};return r.forEach(n=>{t[n.code]=n}),async n=>{let i=t[n];if(i==null&&e!=null){const s=e(n);ex(s)?i=await s:i=s,t[i.code]=i}if(i!=null)return i;throw new AF(`No hasher configured for multihash code 0x${n.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)}}const sd=class sd extends Error{constructor(t="Not Found"){super(t);u(this,"name",sd.name);u(this,"code",sd.code)}};u(sd,"name","NotFoundError"),u(sd,"code","ERR_NOT_FOUND");let Z1=sd;class YF{has(e,t){return Promise.reject(new Error(".has is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}async*putMany(e,t){for await(const{cid:n,block:i}of e)await this.put(n,i,t),yield n}get(e,t){return Promise.reject(new Error(".get is not implemented"))}async*getMany(e,t){for await(const n of e)yield{cid:n,block:await this.get(n,t)}}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(e,t){for await(const n of e)await this.delete(n,t),yield n}async*getAll(e){throw new Error(".getAll is not implemented")}}const cg=0;class Qde extends YF{constructor(t){super();u(this,"child");this.child=t}put(t,n){return t.multihash.code===cg||this.child==null?t:this.child.put(t,n)}get(t){if(t.multihash.code===cg)return t.multihash.digest;if(this.child==null)throw new Z1;return this.child.get(t)}has(t){return t.multihash.code===cg?!0:this.child==null?!1:this.child.has(t)}delete(t){if(t.code!==cg&&this.child!=null)return this.child.delete(t)}getAll(t){return this.child!=null?this.child.getAll(t):[]}}function Yde(r){return r[Symbol.asyncIterator]!=null}function ol(r,e){let t=0;if(Yde(r))return async function*(){for await(const c of r)await e(c,t++)&&(yield c)}();const n=LS(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof o.then=="function")return async function*(){await o&&(yield i);for await(const c of n)await e(c,t++)&&(yield c)}();const a=e;return function*(){o===!0&&(yield i);for(const c of n)a(c,t++)&&(yield c)}()}function Xde(r){return r[Symbol.asyncIterator]!=null}function E_(r){return(r==null?void 0:r.then)!=null}function Fy(r,e){let t=0;if(Xde(r))return async function*(){for await(const c of r){const l=e(c,t++);E_(l)&&await l,yield c}}();const n=LS(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof(o==null?void 0:o.then)=="function")return async function*(){yield i;for await(const c of n){const l=e(c,t++);E_(l)&&await l,yield c}}();const a=e;return function*(){yield i;for(const c of n)a(c,t++),yield c}()}class XF{constructor(e){u(this,"child");u(this,"getHasher");u(this,"log");u(this,"logger");u(this,"components");this.log=e.logger.forComponent("helia:networked-storage"),this.logger=e.logger,this.components=e,this.child=new Qde(e.blockstore),this.getHasher=e.getHasher}async put(e,t,n={}){var i,s,o;return await this.child.has(e,n)?((i=n.onProgress)==null||i.call(n,new Ne("blocks:put:duplicate",e)),e):((s=n.onProgress)==null||s.call(n,new Ne("blocks:put:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async a=>{var c;return(c=a.announce)==null?void 0:c.call(a,e,t,n)})),(o=n.onProgress)==null||o.call(n,new Ne("blocks:put:blockstore:put",e)),this.child.put(e,t,n))}async*putMany(e,t={}){var s;const n=ol(e,async({cid:o})=>{var c;const a=await this.child.has(o,t);return a&&((c=t.onProgress)==null||c.call(t,new Ne("blocks:put-many:duplicate",o))),!a}),i=Fy(n,async({cid:o,block:a})=>{var c;(c=t.onProgress)==null||c.call(t,new Ne("blocks:put-many:providers:notify",o)),await Promise.all(this.components.blockBrokers.map(async l=>{var d;return(d=l.announce)==null?void 0:d.call(l,o,a,t)}))});(s=t.onProgress)==null||s.call(t,new Ne("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(i,t)}async get(e,t={}){var n,i,s,o;if(t.offline!==!0&&!await this.child.has(e,t)){const a=await this.getHasher(e.multihash.code);(n=t.onProgress)==null||n.call(t,new Ne("blocks:get:providers:get",e));const c=await S_(e,this.components.blockBrokers,a,{...t,log:this.log});return(i=t.onProgress)==null||i.call(t,new Ne("blocks:get:blockstore:put",e)),await this.child.put(e,c,t),(s=t.onProgress)==null||s.call(t,new Ne("blocks:get:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async l=>{var d;return(d=l.announce)==null?void 0:d.call(l,e,c,t)})),c}return(o=t.onProgress)==null||o.call(t,new Ne("blocks:get:blockstore:get",e)),this.child.get(e,t)}async*getMany(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new Ne("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(Fy(e,async i=>{var s,o,a;if(t.offline!==!0&&!await this.child.has(i,t)){const c=await this.getHasher(i.multihash.code);(s=t.onProgress)==null||s.call(t,new Ne("blocks:get-many:providers:get",i));const l=await S_(i,this.components.blockBrokers,c,{...t,log:this.log});(o=t.onProgress)==null||o.call(t,new Ne("blocks:get-many:blockstore:put",i)),await this.child.put(i,l,t),(a=t.onProgress)==null||a.call(t,new Ne("blocks:get-many:providers:notify",i)),await Promise.all(this.components.blockBrokers.map(async d=>{var h;return(h=d.announce)==null?void 0:h.call(d,i,l,t)}))}}))}async delete(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new Ne("blocks:delete:blockstore:delete",e)),await this.child.delete(e,t)}async*deleteMany(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new Ne("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(const i of e)yield i}(),t)}async has(e,t={}){return this.child.has(e,t)}async*getAll(e={}){var t;(t=e.onProgress)==null||t.call(e,new Ne("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(e)}}class Jde extends XF{constructor(t){super(t);u(this,"started");this.started=!1}isStarted(){return this.started}async start(){await Ko(this.child,...this.components.blockBrokers),this.started=!0}async stop(){await Uc(this.child,...this.components.blockBrokers),this.started=!1}unwrap(){return this.child}createSession(t,n){const i=this.components.blockBrokers.map(s=>s.createSession==null?s:s.createSession(n));return new Zde({blockstore:this.child,blockBrokers:i,getHasher:this.getHasher,logger:this.logger},{root:t})}}class Zde extends XF{constructor(t,n){super(t);u(this,"closeController");this.closeController=new AbortController,this.closeController.signal,this.log=t.logger.forComponent(`helia:session-storage:${n.root}`)}close(){this.closeController.abort()}async put(t,n,i={}){const s=bt([this.closeController.signal,i.signal]);try{return await super.put(t,n,{...i,signal:s})}finally{s.clear()}}async*putMany(t,n={}){const i=bt([this.closeController.signal,n.signal]);try{yield*super.putMany(t,{...n,signal:i})}finally{i.clear()}}async get(t,n={}){const i=bt([this.closeController.signal,n.signal]);try{return await super.get(t,{...n,signal:i})}finally{i.clear()}}async*getMany(t,n={}){const i=bt([this.closeController.signal,n.signal]);try{yield*super.getMany(t,{...n,signal:i})}finally{i.clear()}}async delete(t,n={}){const i=bt([this.closeController.signal,n.signal]);try{await super.delete(t,{...n,signal:i})}finally{i.clear()}}async*deleteMany(t,n={}){const i=bt([this.closeController.signal,n.signal]);try{yield*super.deleteMany(t,{...n,signal:i})}finally{i.clear()}}async has(t,n={}){const i=bt([this.closeController.signal,n.signal]);try{return await super.has(t,{...n,signal:i})}finally{i.clear()}}async*getAll(t={}){const n=bt([this.closeController.signal,t.signal]);try{yield*super.getAll({...t,signal:n})}finally{n.clear()}}}function ehe(r){return typeof r.retrieve=="function"}const the=(r,e)=>{if(e==null)throw new ie(`No hasher configured for multihash code 0x${r.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`);return async t=>{let n;const i=e.digest(t);if(ex(i)?n=await i:n=i,!Xe(n.digest,r.multihash.digest))throw new tw("Hash of downloaded block did not match multihash from passed CID")}};async function S_(r,e,t,n){const i=the(r,t),s=new AbortController,o=bt([s.signal,n.signal]);s.signal;const a=[];for(const c of e)ehe(c)&&a.push(c);try{return await Promise.any(a.map(async c=>{try{let l=!1;const d=await c.retrieve(r,{...n,signal:o,validateFn:async h=>{await i(h),l=!0}});return l||await i(d),d}catch(l){throw n.log.error("could not retrieve verified block for %c",r,l),l}}))}finally{s.abort(),o.clear()}}const rhe=hi({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});hi({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});hi({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});hi({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});class JF extends tr{constructor(t,n){super();u(this,"initialPeerSearchComplete");u(this,"requests");u(this,"name");u(this,"log");u(this,"logger");u(this,"minProviders");u(this,"maxProviders");u(this,"providers");u(this,"evictionFilter");this.name=n.name,this.logger=t.logger,this.log=t.logger.forComponent(this.name),this.requests=new Map,this.minProviders=n.minProviders??_le,this.maxProviders=n.maxProviders??Tle,this.providers=[],this.evictionFilter=Ql(this.maxProviders)}async retrieve(t,n={}){const i=rhe.encode(t.multihash.bytes),s=this.requests.get(i);if(s!=null)return this.log("join existing request for %c",t),s;const o=Ve();if(this.requests.set(i,o.promise),this.providers.length===0){let d=!1;this.initialPeerSearchComplete==null&&(d=!0,this.log=this.logger.forComponent(`${this.name}:${t}`),this.initialPeerSearchComplete=this.findProviders(t,this.minProviders,n)),await this.initialPeerSearchComplete,d&&this.log("found initial session peers for %c",t)}let a=!1;const c=new Gl({concurrency:this.maxProviders});c.addEventListener("error",()=>{}),c.addEventListener("failure",d=>{this.log.error("error querying provider %o, evicting from session",d.detail.job.options.provider,d.detail.error),this.evict(d.detail.job.options.provider)}),c.addEventListener("success",d=>{a=!0,o.resolve(d.detail.result)}),c.addEventListener("idle",()=>{var d;a||((d=n.signal)==null?void 0:d.aborted)===!0||Promise.resolve().then(async()=>{this.log("no session peers had block for for %c, finding new providers",t);for(let h=0;h<this.minProviders&&this.providers.length!==0;h++){const p=this.providers[Math.floor(Math.random()*this.providers.length)];this.evict(p)}await this.findProviders(t,this.minProviders,n),this.log("found new providers re-retrieving %c",t),this.requests.delete(i),o.resolve(await this.retrieve(t,n))}).catch(h=>{this.log.error("could not find new providers for %c",t,h),o.reject(h)})});const l=d=>{c.add(async()=>this.queryProvider(t,d.detail,n),{provider:d.detail}).catch(h=>{var p;((p=n.signal)==null?void 0:p.aborted)!==!0&&this.log.error("error retrieving session block for %c",t,h)})};this.addEventListener("provider",l),Promise.all([...this.providers].map(async d=>c.add(async()=>this.queryProvider(t,d,n),{provider:d}))).catch(d=>{var h;((h=n.signal)==null?void 0:h.aborted)!==!0&&this.log.error("error retrieving session block for %c",t,d)});try{return await o.promise}finally{this.removeEventListener("provider",l),c.clear(),this.requests.delete(i)}}evict(t){this.evictionFilter.add(this.toEvictionKey(t));const n=this.providers.findIndex(i=>this.equals(i,t));n!==-1&&this.providers.splice(n,1)}isEvicted(t){return this.evictionFilter.has(this.toEvictionKey(t))}hasProvider(t){return!!(this.providers.find(n=>this.equals(n,t))!=null||this.isEvicted(t))}async findProviders(t,n,i){const s=Ve();let o=0;return Promise.resolve().then(async()=>{var a;this.log("finding %d-%d new provider(s) for %c",n,this.maxProviders,t);for await(const c of this.findNewProviders(t,i)){if(o===this.maxProviders||((a=i.signal)==null?void 0:a.aborted)===!0)break;if(!this.hasProvider(c)&&(this.log("found %d/%d new providers",o,this.maxProviders),this.providers.push(c),this.safeDispatchEvent("provider",{detail:c}),o++,o===n&&(this.log("session is ready"),s.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",o);break}}if(this.log("found %d/%d new session peers",o,this.maxProviders),o<n)throw new xF(`Found ${o} of ${n} ${this.name} providers for ${t}`)}).catch(a=>{this.log.error("error searching routing for potential session peers for %c",t,a.errors??a),s.reject(a)}),s.promise}}class nhe{constructor(e){u(this,"blockstore");u(this,"datastore");u(this,"pins");u(this,"logger");u(this,"routing");u(this,"getCodec");u(this,"getHasher");u(this,"dns");u(this,"metrics");u(this,"log");this.logger=e.logger??vw(),this.log=this.logger.forComponent("helia"),this.getHasher=Gde(e.hashers,e.loadHasher),this.getCodec=jde(e.codecs,e.loadCodec),this.dns=e.dns??yF(),this.metrics=e.metrics;const t={blockstore:e.blockstore,datastore:e.datastore,logger:this.logger,blockBrokers:[],getHasher:this.getHasher,getCodec:this.getCodec,dns:this.dns,metrics:this.metrics,...e.components??{}};this.routing=t.routing=new Dle(t,{routers:(e.routers??[]).flatMap(i=>{const s=[i];return i[Kd]!=null&&s.push(i[Kd]),i[Hd]!=null&&s.push(i[Hd]),s}),providerLookupConcurrency:e.providerLookupConcurrency});const n=new Jde(t);this.pins=new kle(e.datastore,n,this.getCodec),this.blockstore=new Lle(n,this.pins,{holdGcLock:e.holdGcLock??!0}),this.datastore=e.datastore,t.blockBrokers=e.blockBrokers.map(i=>i(t))}async start(){await Ble(this.datastore),await Ko(this.blockstore,this.datastore,this.routing)}async stop(){await Uc(this.blockstore,this.datastore,this.routing)}async gc(e={}){const t=await this.blockstore.lock.writeLock();try{const n=this,i=this.blockstore.unwrap();this.log("gc start"),await Vo(i.deleteMany(async function*(){var s,o;for await(const{cid:a}of i.getAll())try{if(await n.pins.isPinned(a,e))continue;yield a,(s=e.onProgress)==null||s.call(e,new Ne("helia:gc:deleted",a))}catch(c){n.log.error("Error during gc",c),(o=e.onProgress)==null||o.call(e,new Ne("helia:gc:error",c))}}()))}finally{t()}this.log("gc finished")}}class ihe extends JF{constructor(t,n){super(t,{...n,name:"helia:bitswap:session"});u(this,"wantList");u(this,"network");this.wantList=t.wantList,this.network=t.network}async queryProvider(t,n,i){this.log("sending WANT-BLOCK for %c to %p",t,n);const s=await this.wantList.wantSessionBlock(t,n,i);if(this.log("%p %s %c",n,s.has?"has":"does not have",t),s.has&&s.block!=null)return s.block;throw new Error("Provider did not have block")}async*findNewProviders(t,n={}){for await(const i of this.network.findProviders(t,n))yield i.id}toEvictionKey(t){return t.toMultihash().bytes}equals(t,n){return t.equals(n)}}function she(r,e){return new ihe(r,e)}class ohe{constructor(e){u(this,"blocksReceived");u(this,"duplicateBlocksReceived");u(this,"dataReceived");u(this,"duplicateDataReceived");var t,n,i,s;this.blocksReceived=(t=e.metrics)==null?void 0:t.registerMetricGroup("helia_bitswap_received_blocks"),this.duplicateBlocksReceived=(n=e.metrics)==null?void 0:n.registerMetricGroup("helia_bitswap_duplicate_received_blocks"),this.dataReceived=(i=e.metrics)==null?void 0:i.registerMetricGroup("helia_bitswap_data_received_bytes"),this.duplicateDataReceived=(s=e.metrics)==null?void 0:s.registerMetricGroup("helia_bitswap_duplicate_data_received_bytes")}updateBlocksReceived(e=1,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.blocksReceived)==null||i.increment(n)}updateDuplicateBlocksReceived(e=1,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.duplicateBlocksReceived)==null||i.increment(n)}updateDataReceived(e,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.dataReceived)==null||i.increment(n)}updateDuplicateDataReceived(e,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.duplicateDataReceived)==null||i.increment(n)}}class ahe extends Map{constructor(t){super();u(this,"metric");const{name:n,metrics:i}=t;this.metric=i.registerMetric(n),this.updateComponentMetric()}set(t,n){return super.set(t,n),this.updateComponentMetric(),this}delete(t){const n=super.delete(t);return this.updateComponentMetric(),n}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function ZF(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new ahe({name:e,metrics:t}):n=new Map,n}function che({name:r,code:e,encode:t}){return new lhe(r,e,t)}let lhe=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Fv(this.code,t):t.then(n=>Fv(this.code,n))}else throw Error("Unknown type, must be binary type")}};function uhe(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const x_=che({name:"sha2-256",code:18,encode:uhe("SHA-256")});function dhe(r){if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");const e=[];for(;r.length>0;){const t=ms(r);e.push(t),r=r.slice(At(t))}return e}class hhe extends tr{constructor(t,n={}){super();u(this,"peers");u(this,"wants");u(this,"network");u(this,"log");u(this,"sendMessagesDelay");u(this,"sendMessagesTimeout");u(this,"hashLoader");u(this,"sendingMessages");this.peers=sF({name:"helia_bitswap_peers",metrics:t.metrics}),this.wants=ZF({name:"helia_bitswap_wantlist",metrics:t.metrics}),this.network=t.network,this.sendMessagesDelay=n.sendMessagesDelay??Ise,this.log=t.logger.forComponent("helia:bitswap:wantlist"),this.hashLoader=n.hashLoader,this.network.addEventListener("bitswap:message",i=>{this.receiveMessage(i.detail.peer,i.detail.message).catch(s=>{this.log.error("error receiving bitswap message from %p",i.detail.peer,s)})}),this.network.addEventListener("peer:connected",i=>{this.peerConnected(i.detail).catch(s=>{this.log.error("error processing newly connected bitswap peer %p",i.detail,s)})}),this.network.addEventListener("peer:disconnected",i=>{this.peerDisconnected(i.detail)})}async addEntry(t,n){var o;const i=ae(t.multihash.bytes,"base64");let s=this.wants.get(i);s==null&&(s={cid:t,priority:n.priority??1,wantType:n.wantType??pr.WantBlock,cancel:!1,sendDontHave:!0},this.wants.set(i,s)),s.wantType===pr.WantHave&&n.wantType===pr.WantBlock&&(s.wantType=pr.WantBlock),await this.sendMessagesDebounced();try{return n.wantType===pr.WantBlock?(await Ti(this,"block",n==null?void 0:n.signal,{filter:l=>Xe(t.multihash.digest,l.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail:(await Ti(this,"presence",n==null?void 0:n.signal,{filter:c=>Xe(t.multihash.digest,c.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail}finally{((o=n.signal)==null?void 0:o.aborted)===!0&&(this.log("want for %c was aborted, cancelling want",t),s.cancel=!0,await this.sendMessagesDebounced())}}async sendMessagesDebounced(){var t;await((t=this.sendingMessages)==null?void 0:t.promise),clearTimeout(this.sendMessagesTimeout),this.sendMessagesTimeout=setTimeout(()=>{this.sendMessages().catch(n=>{this.log("error sending messages to peers",n)})},this.sendMessagesDelay)}async sendMessages(){this.sendingMessages=Ve(),await Promise.all([...this.peers.entries()].map(async([t,n])=>{const i=new Set,s=new Kf;for(const[o,a]of this.wants.entries())n.has(o)||a.cancel||(i.add(o),s.addWantlistEntry(a.cid,{cid:a.cid.bytes,priority:a.priority,wantType:a.wantType,cancel:a.cancel,sendDontHave:a.sendDontHave}));if(s.wantlist.size!==0)try{await this.network.sendMessage(t,s);for(const o of i)n.add(o)}catch(o){this.log.error("error sending full wantlist to new peer",o)}})).catch(t=>{this.log.error("error sending messages",t)});for(const[t,n]of this.wants)if(n.cancel){this.wants.delete(t);for(const i of this.peers.values())i.delete(t)}this.sendingMessages.resolve()}has(t){const n=ae(t.multihash.bytes,"base64");return this.wants.has(n)}async wantSessionPresence(t,n,i={}){const s=new Kf;return s.addWantlistEntry(t,{cid:t.bytes,sendDontHave:!0,wantType:pr.WantHave,priority:1}),await this.network.sendMessage(n,s),(await Ti(this,"presence",i.signal,{filter:a=>n.equals(a.detail.sender)&&Xe(t.multihash.digest,a.detail.cid.multihash.digest)})).detail}async wantBlock(t,n={}){return this.addEntry(t,{...n,wantType:pr.WantBlock})}async wantSessionBlock(t,n,i={}){const s=new Kf;return s.addWantlistEntry(t,{cid:t.bytes,sendDontHave:!0,wantType:pr.WantBlock,priority:1}),await this.network.sendMessage(n,s),(await Ti(this,"presence",i.signal,{filter:a=>n.equals(a.detail.sender)&&Xe(t.multihash.digest,a.detail.cid.multihash.digest)})).detail}async receivedBlock(t,n){const i=ae(t.multihash.bytes,"base64"),s=this.wants.get(i);s!=null&&(s.cancel=!0,await this.sendMessagesDebounced())}async receiveMessage(t,n){var s;this.log("received message from %p with %d blocks",t,n.blocks.length);let i=!1;for(const o of n.blocks){if(o.prefix==null||o.data==null)continue;const a=dhe(o.prefix),c=a[0],l=a[1],d=a[2],h=d===x_.code?x_:await((s=this.hashLoader)==null?void 0:s.getHasher(d));if(h==null){this.log.error("unknown hash algorithm",d);continue}let p=h.digest(o.data);p.then!=null&&(p=await p);const w=Vv.create(c===0?0:1,l,p);this.log("received block from %p for %c",t,w),this.safeDispatchEvent("block",{detail:{sender:t,cid:w,block:o.data}}),this.safeDispatchEvent("presence",{detail:{sender:t,cid:w,has:!0,block:o.data}});const f=ae(w.multihash.bytes,"base64"),g=this.wants.get(f);g!=null&&(g.cancel=!0,i=!0)}for(const{cid:o,type:a}of n.blockPresences){const c=Vv.decode(o);this.log("received %s from %p for %c",a,t,c),this.safeDispatchEvent("presence",{detail:{sender:t,cid:c,has:a===Ks.HaveBlock}})}i&&await this.sendMessagesDebounced()}async peerConnected(t){const n=new Set,i=new Kf(!0);for(const[s,o]of this.wants.entries())o.cancel||(n.add(s),i.addWantlistEntry(o.cid,{cid:o.cid.bytes,priority:1,wantType:pr.WantBlock,cancel:!1,sendDontHave:!1}));if(i.wantlist.size===0){this.peers.set(t,n);return}try{await this.network.sendMessage(t,i),this.peers.set(t,n)}catch(s){this.log.error("error sending full wantlist to new peer %p",t,s)}}peerDisconnected(t){this.peers.delete(t)}start(){}stop(){this.peers.clear(),clearTimeout(this.sendMessagesTimeout)}}class fhe{constructor(e,t={}){u(this,"log");u(this,"logger");u(this,"stats");u(this,"network");u(this,"blockstore");u(this,"peerWantLists");u(this,"wantList");this.logger=e.logger,this.log=e.logger.forComponent("helia:bitswap"),this.blockstore=e.blockstore,this.stats=new ohe(e),this.network=new Lse(e,t),this.peerWantLists=new ece({...e,network:this.network},t),this.wantList=new hhe({...e,network:this.network},t)}createSession(e={}){return she({wantList:this.wantList,network:this.network,logger:this.logger},e)}async want(e,t={}){const n=new AbortController,i=bt([n.signal,t.signal]);n.signal,this.network.findAndConnect(e,{...t,signal:i}).catch(s=>{n.signal.aborted||this.log.error("error during finding and connect for cid %c",e,s)});try{return(await this.wantList.wantBlock(e,{...t,signal:i})).block}finally{n.abort(),i.clear()}}async notify(e,t,n={}){await Promise.all([this.peerWantLists.receivedBlock(e,n),this.wantList.receivedBlock(e,n)])}getWantlist(){return[...this.wantList.wants.values()].filter(e=>!e.cancel).map(e=>({cid:e.cid,priority:e.priority,wantType:e.wantType}))}getPeerWantlist(e){return this.peerWantLists.wantListForPeer(e)}async start(){this.wantList.start(),await this.network.start()}async stop(){this.wantList.stop(),await this.network.stop()}}const phe=(r,e={})=>new fhe(r,e);class ghe{constructor(e,t={}){u(this,"bitswap");u(this,"started");const{getHasher:n}=e;this.bitswap=phe(e,{hashLoader:{getHasher:async i=>n(i)},...t}),this.started=!1}isStarted(){return this.started}async start(){await this.bitswap.start(),this.started=!0}async stop(){await this.bitswap.stop(),this.started=!1}async announce(e,t,n){await this.bitswap.notify(e,t,n)}async retrieve(e,t={}){return this.bitswap.want(e,t)}createSession(e){const t=this.bitswap.createSession(e);return{announce:async(n,i,s)=>{await this.bitswap.notify(n,i,s)},retrieve:async(n,i)=>t.retrieve(n,i)}}}function yhe(r={}){return e=>new ghe(e,r)}class mhe{constructor(){u(this,"index",0);u(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,i){return this.readAtomically(()=>{let s=0,o=0;const a=this.peekChar();if(a===void 0)return;const c=a==="0",l=2**(8*i)-1;for(;;){const d=this.readAtomically(()=>{const h=this.readChar();if(h===void 0)return;const p=Number.parseInt(h,e);if(!Number.isNaN(p))return p});if(d===void 0)break;if(s*=e,s+=d,s>l||(o+=1,t!==void 0&&o>t))return}if(o!==0)return!n&&c&&o>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){const e=t=>{for(let n=0;n<t.length/2;n++){const i=n*2;if(n<t.length-3){const o=this.readSeparator(":",n,()=>this.readIPv4Addr());if(o!==void 0)return t[i]=o[0],t[i+1]=o[1],t[i+2]=o[2],t[i+3]=o[3],[i+4,!0]}const s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[i,!1];t[i]=s>>8,t[i+1]=s&255}return[t.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[n,i]=e(t);if(n===16)return t;if(i||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const s=new Uint8Array(14),o=16-(n+2),[a]=e(s.subarray(0,o));return t.set(s.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const ez=45,whe=15,th=new mhe;function tz(r){if(!(r.length>whe))return th.new(r).parseWith(()=>th.readIPv4Addr())}function rz(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>ez))return th.new(r).parseWith(()=>th.readIPv6Addr())}function zy(r,e=!1){if(r.includes("%")&&(r=r.split("%")[0]),r.length>ez)return;const t=th.new(r).parseWith(()=>th.readIPAddr());if(t)return e&&t.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,t[0],t[1],t[2],t[3]]):t}function rh(r){return!!tz(r)}function tx(r){return!!rz(r)}function nz(r){return!!zy(r)}var iz;(function(){var r,e,t,n,i,s,o,a;a=function(c){var l,d,h,p;return l=(c&255<<24)>>>24,d=(c&255<<16)>>>16,h=(c&65280)>>>8,p=c&255,[l,d,h,p].join(".")},o=function(c){var l,d,h,p,w,f;for(l=[],h=p=0;p<=3&&c.length!==0;h=++p){if(h>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}f=e(c),w=f[0],d=f[1],c=c.substring(d),l.push(w)}if(c.length!==0)throw new Error("Invalid IP");switch(l.length){case 1:if(l[0]>4294967295)throw new Error("Invalid IP");return l[0]>>>0;case 2:if(l[0]>255||l[1]>16777215)throw new Error("Invalid IP");return(l[0]<<24|l[1])>>>0;case 3:if(l[0]>255||l[1]>255||l[2]>65535)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2])>>>0;case 4:if(l[0]>255||l[1]>255||l[2]>255||l[3]>255)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2]<<8|l[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},n=t("0"),s=t("a"),i=t("A"),e=function(c){var l,d,h,p,w;for(p=0,l=10,d="9",h=0,c.length>1&&c[h]==="0"&&(c[h+1]==="x"||c[h+1]==="X"?(h+=2,l=16):"0"<=c[h+1]&&c[h+1]<="9"&&(h++,l=8,d="7")),w=h;h<c.length;){if("0"<=c[h]&&c[h]<=d)p=p*l+(t(c[h])-n)>>>0;else if(l===16)if("a"<=c[h]&&c[h]<="f")p=p*l+(10+t(c[h])-s)>>>0;else if("A"<=c[h]&&c[h]<="F")p=p*l+(10+t(c[h])-i)>>>0;else break;else break;if(p>4294967295)throw new Error("too large");h++}if(h===w)throw new Error("empty octet");return[p,h]},r=function(){function c(l,d){var h,p,w;if(typeof l!="string")throw new Error("Missing `net' parameter");if(d||(w=l.split("/",2),l=w[0],d=w[1]),d||(d=32),typeof d=="string"&&d.indexOf(".")>-1){try{this.maskLong=o(d)}catch{throw new Error("Invalid mask: "+d)}for(h=p=32;p>=0;h=--p)if(this.maskLong===4294967295<<32-h>>>0){this.bitmask=h;break}}else if(d||d===0)this.bitmask=parseInt(d,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(o(l)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+l)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+d);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(l){return typeof l=="string"&&(l.indexOf("/")>0||l.split(".").length!==4)&&(l=new c(l)),l instanceof c?this.contains(l.base)&&this.contains(l.broadcast||l.last):(o(l)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(l){return l==null&&(l=1),new c(a(this.netLong+this.size*l),this.mask)},c.prototype.forEach=function(l){var d,h,p;for(p=o(this.first),h=o(this.last),d=0;p<=h;)l(a(p),p,d),d++,p++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),iz=r}).call(E1);const vhe=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],bhe=vhe.map(r=>new iz(r));function rx(r){for(const e of bhe)if(e.contains(r))return!0;return!1}function Ehe(r){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(r)}function She(r){const e=r.split(":");if(e.length<2)return!1;const t=e[e.length-1].padStart(4,"0"),n=e[e.length-2].padStart(4,"0"),i=`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(t.substring(0,2),16)}.${parseInt(t.substring(2),16)}`;return rx(i)}function xhe(r){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)}function Ahe(r){const e=r.split(":"),t=e[e.length-1];return rx(t)}function Ihe(r){return/^::$/.test(r)||/^::1$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}function Vc(r){return rh(r)?rx(r):Ehe(r)?She(r):xhe(r)?Ahe(r):tx(r)?Ihe(r):void 0}function Che(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function khe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var _he=khe,The=_he;let Phe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Dhe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return sz(this,e)}},$he=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return sz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function sz(r,e){return new $he({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Nhe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Phe(e,t,n),this.decoder=new Dhe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function oz({name:r,prefix:e,encode:t,decode:n}){return new Nhe(r,e,t,n)}function az({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=The(t,r);return oz({prefix:e,name:r,encode:n,decode:s=>Che(i(s))})}function Ohe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Mhe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function xw({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return oz({prefix:e,name:r,encode(i){return Mhe(i,n,t)},decode(i){return Ohe(i,n,t,r)}})}const Rhe=az({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});az({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});xw({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});xw({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});const Lhe=xw({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});xw({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const Bhe=r=>r.toString().split("/").slice(1),Wp=r=>({match:e=>e.length<1?!1:r(e[0])?e.slice(1):!1,pattern:"fn"}),rt=r=>({match:e=>Wp(t=>t===r).match(e),pattern:r}),Bh=()=>({match:r=>Wp(e=>typeof e=="string").match(r),pattern:"{string}"}),Aw=()=>({match:r=>Wp(e=>!isNaN(parseInt(e))).match(r),pattern:"{number}"}),It=()=>({match:r=>{if(r.length<2||r[0]!=="p2p"&&r[0]!=="ipfs")return!1;if(r[1].startsWith("Q")||r[1].startsWith("1"))try{Rhe.decode(`z${r[1]}`)}catch{return!1}else return!1;return r.slice(2)},pattern:"/p2p/{peerid}"}),Vy=()=>({match:r=>{if(r.length<2||r[0]!=="certhash")return!1;try{Lhe.decode(r[1])}catch{return!1}return r.slice(2)},pattern:"/certhash/{certhash}"}),yt=r=>({match:e=>{const t=r.match(e);return t===!1?e:t},pattern:`optional(${r.pattern})`}),yn=(...r)=>({match:e=>{let t;for(const n of r){const i=n.match(e);i!==!1&&(t==null||i.length<t.length)&&(t=i)}return t??!1},pattern:`or(${r.map(e=>e.pattern).join(", ")})`}),nt=(...r)=>({match:e=>{for(const t of r){const n=t.match(e);if(n===!1)return!1;e=n}return e},pattern:`and(${r.map(e=>e.pattern).join(", ")})`});function Nt(...r){function e(i){let s=Bhe(i);for(const o of r){const a=o.match(s);if(a===!1)return!1;s=a}return s}function t(i){return e(i)!==!1}function n(i){const s=e(i);return s===!1?!1:s.length===0}return{matchers:r,matches:t,exactMatch:n}}const Uhe=It(),Fhe=Nt(Uhe),Iw=nt(rt("dns4"),Bh()),Cw=nt(rt("dns6"),Bh()),kw=nt(rt("dnsaddr"),Bh()),nx=nt(rt("dns"),Bh());Nt(Iw,yt(It()));Nt(Cw,yt(It()));Nt(kw,yt(It()));const cz=Nt(yn(nx,kw,Iw,Cw),yt(It())),lz=nt(rt("ip4"),Wp(rh)),uz=nt(rt("ip6"),Wp(tx)),ix=yn(lz,uz),$o=yn(ix,nx,Iw,Cw,kw),zhe=Nt(yn(ix,nt(yn(nx,kw,Iw,Cw),yt(It())))),A_=Nt(lz),I_=Nt(uz),Vhe=Nt(ix),sx=nt($o,rt("tcp"),Aw()),Gp=nt($o,rt("udp"),Aw()),Ky=Nt(nt(sx,yt(It())));Nt(Gp);const ox=nt(Gp,rt("quic"),yt(It())),_w=nt(Gp,rt("quic-v1"),yt(It())),Khe=yn(ox,_w);Nt(ox);const Hhe=Nt(_w),ib=yn($o,sx,Gp,ox,_w),dz=yn(nt(ib,rt("ws"),yt(It()))),ep=Nt(dz),hz=yn(nt(ib,rt("wss"),yt(It())),nt(ib,rt("tls"),yt(nt(rt("sni"),Bh())),rt("ws"),yt(It()))),Hy=Nt(hz),fz=nt(Gp,rt("webrtc-direct"),yt(Vy()),yt(Vy()),yt(It())),sb=Nt(fz),pz=nt(_w,rt("webtransport"),yt(Vy()),yt(Vy()),yt(It())),C_=Nt(pz),jy=yn(dz,hz,nt(sx,yt(It())),nt(Khe,yt(It())),nt($o,yt(It())),fz,pz,It()),gz=Nt(jy),jhe=nt(jy,rt("p2p-circuit"),It()),kc=Nt(jhe),qhe=yn(nt(jy,rt("p2p-circuit"),rt("webrtc"),yt(It())),nt(jy,rt("webrtc"),yt(It())),nt(rt("webrtc"),yt(It()))),ob=Nt(qhe),Whe=yn(nt($o,rt("tcp"),Aw(),rt("http"),yt(It())),nt($o,rt("http"),yt(It()))),Ghe=Nt(Whe),Qhe=yn(nt($o,rt("tcp"),yn(nt(rt("443"),rt("http")),nt(Aw(),rt("https"))),yt(It())),nt($o,rt("tls"),rt("http"),yt(It())),nt($o,rt("https"),yt(It()))),Yhe=Nt(Qhe),Xhe=yn(nt(rt("memory"),Bh(),yt(It())));Nt(Xhe);function Jhe(r,e,t){let n=0;for(const i of r)if(!(n<e)){if(n>t)break;if(i!==255)return!1;n++}return!0}function Zhe(r,e,t,n){let i=0;for(const s of r)if(!(i<t)){if(i>n)break;if(s!==e[i])return!1;i++}return!0}function efe(r){switch(r.length){case tp:return r.join(".");case rp:{const e=[];for(let t=0;t<r.length;t++)t%2===0&&e.push(r[t].toString(16).padStart(2,"0")+r[t+1].toString(16).padStart(2,"0"));return e.join(":")}default:throw new Error("Invalid ip length")}}function tfe(r){let e=0;for(let[t,n]of r.entries()){if(n===255){e+=8;continue}for(;n&128;)e++,n=n<<1;if(n&128)return-1;for(let i=t+1;i<r.length;i++)if(r[i]!=0)return-1;break}return e}function rfe(r){let e="0x";for(const t of r)e+=(t>>4).toString(16)+(t&15).toString(16);return e}const tp=4,rp=16,nfe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function yz(r,e){e.length===rp&&r.length===tp&&Jhe(e,0,11)&&(e=e.slice(12)),e.length===tp&&r.length===rp&&Zhe(r,nfe,0,11)&&(r=r.slice(12));const t=r.length;if(t!=e.length)throw new Error("Failed to mask ip");const n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=r[i]&e[i];return n}function ife(r,e){if(typeof e=="string"&&(e=zy(e)),e==null)throw new Error("Invalid ip");if(e.length!==r.network.length)return!1;for(let t=0;t<e.length;t++)if((r.network[t]&r.mask[t])!==(e[t]&r.mask[t]))return!1;return!0}function sfe(r){const[e,t]=r.split("/");if(!e||!t)throw new Error("Failed to parse given CIDR: "+r);let n=tp,i=tz(e);if(i==null&&(n=rp,i=rz(e),i==null))throw new Error("Failed to parse given CIDR: "+r);const s=parseInt(t,10);if(Number.isNaN(s)||String(s).length!==t.length||s<0||s>n*8)throw new Error("Failed to parse given CIDR: "+r);const o=mz(s,8*n);return{network:yz(i,o),mask:o}}function mz(r,e){if(e!==8*tp&&e!==8*rp)throw new Error("Invalid CIDR mask");if(r<0||r>e)throw new Error("Invalid CIDR mask");const t=e/8,n=new Uint8Array(t);for(let i=0;i<t;i++){if(r>=8){n[i]=255,r-=8;continue}n[i]=255-(255>>r),r=0}return n}class wz{constructor(e,t){if(t==null)({network:this.network,mask:this.mask}=sfe(e));else{const n=zy(e);if(n==null)throw new Error("Failed to parse network");t=String(t);const i=parseInt(t,10);if(Number.isNaN(i)||String(i).length!==t.length||i<0||i>n.length*8){const s=zy(t);if(s==null)throw new Error("Failed to parse mask");this.mask=s}else this.mask=mz(i,8*n.length);this.network=yz(n,this.mask)}}contains(e){return ife({network:this.network,mask:this.mask},e)}toString(){const e=tfe(this.mask),t=e!==-1?String(e):rfe(this.mask);return efe(this.network)+"/"+t}}function ofe(r,e){return new wz(r).contains(e)}function afe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function ax(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function cfe(r){return new TextEncoder().encode(r)}function lfe(r){return new TextDecoder().decode(r)}function ufe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var dfe=ufe,hfe=dfe;let ffe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},pfe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return vz(this,e)}},gfe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return vz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function vz(r,e){return new gfe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let yfe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new ffe(e,t,n),this.decoder=new pfe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Tw({name:r,prefix:e,encode:t,decode:n}){return new yfe(r,e,t,n)}function Qp({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=hfe(t,r);return Tw({prefix:e,name:r,encode:n,decode:s=>ax(i(s))})}function mfe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function wfe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Nr({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return Tw({prefix:e,name:r,encode(i){return wfe(i,n,t)},decode(i){return mfe(i,n,t,r)}})}const Ml=Nr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),vfe=Nr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),bfe=Nr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Efe=Nr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Sfe=Nr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),xfe=Nr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Afe=Nr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ife=Nr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Cfe=Nr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),kfe=Object.freeze(Object.defineProperty({__proto__:null,base32:Ml,base32hex:Sfe,base32hexpad:Afe,base32hexpadupper:Ife,base32hexupper:xfe,base32pad:bfe,base32padupper:Efe,base32upper:vfe,base32z:Cfe},Symbol.toStringTag,{value:"Module"})),is=Qp({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),_fe=Qp({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Tfe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:is,base58flickr:_fe},Symbol.toStringTag,{value:"Module"})),Pfe=Qp({prefix:"9",name:"base10",alphabet:"0123456789"}),Dfe=Object.freeze(Object.defineProperty({__proto__:null,base10:Pfe},Symbol.toStringTag,{value:"Module"})),$fe=Nr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Nfe=Nr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Ofe=Object.freeze(Object.defineProperty({__proto__:null,base16:$fe,base16upper:Nfe},Symbol.toStringTag,{value:"Module"})),Mfe=Nr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Rfe=Object.freeze(Object.defineProperty({__proto__:null,base2:Mfe},Symbol.toStringTag,{value:"Module"})),bz=Array.from(""),Lfe=bz.reduce((r,e,t)=>(r[t]=e,r),[]),Bfe=bz.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function Ufe(r){return r.reduce((e,t)=>(e+=Lfe[t],e),"")}function Ffe(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const i=Bfe[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const zfe=Tw({prefix:"",name:"base256emoji",encode:Ufe,decode:Ffe}),Vfe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:zfe},Symbol.toStringTag,{value:"Module"})),s2=Qp({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Kfe=Qp({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Hfe=Object.freeze(Object.defineProperty({__proto__:null,base36:s2,base36upper:Kfe},Symbol.toStringTag,{value:"Module"})),jfe=Nr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),qfe=Nr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Wfe=Nr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Gfe=Nr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Qfe=Object.freeze(Object.defineProperty({__proto__:null,base64:jfe,base64pad:qfe,base64url:Wfe,base64urlpad:Gfe},Symbol.toStringTag,{value:"Module"})),Yfe=Nr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Xfe=Object.freeze(Object.defineProperty({__proto__:null,base8:Yfe},Symbol.toStringTag,{value:"Module"})),Jfe=Tw({prefix:"\0",name:"identity",encode:r=>lfe(r),decode:r=>cfe(r)}),Zfe=Object.freeze(Object.defineProperty({__proto__:null,identity:Jfe},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;var e1e=Ez,k_=128,t1e=-128,r1e=Math.pow(2,31);function Ez(r,e,t){e=e||[],t=t||0;for(var n=t;r>=r1e;)e[t++]=r&255|k_,r/=128;for(;r&t1e;)e[t++]=r&255|k_,r>>>=7;return e[t]=r|0,Ez.bytes=t-n+1,e}var n1e=ab,i1e=128,__=127;function ab(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw ab.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&__)<<i:(o&__)*Math.pow(2,i),i+=7}while(o>=i1e);return ab.bytes=s-n,t}var s1e=Math.pow(2,7),o1e=Math.pow(2,14),a1e=Math.pow(2,21),c1e=Math.pow(2,28),l1e=Math.pow(2,35),u1e=Math.pow(2,42),d1e=Math.pow(2,49),h1e=Math.pow(2,56),f1e=Math.pow(2,63),p1e=function(r){return r<s1e?1:r<o1e?2:r<a1e?3:r<c1e?4:r<l1e?5:r<u1e?6:r<d1e?7:r<h1e?8:r<f1e?9:10},g1e={encode:e1e,decode:n1e,encodingLength:p1e},qy=g1e;function cb(r,e=0){return[qy.decode(r,e),qy.decode.bytes]}function Wy(r,e,t=0){return qy.encode(r,e,t),e}function Gy(r){return qy.encodingLength(r)}function y1e(r,e){const t=e.byteLength,n=Gy(r),i=n+Gy(t),s=new Uint8Array(i+t);return Wy(r,s,0),Wy(t,s,n),s.set(e,i),new cx(r,t,e,s)}function Sz(r){const e=ax(r),[t,n]=cb(e),[i,s]=cb(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new cx(t,i,o,e)}function m1e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&afe(r.bytes,t.bytes)}}let cx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function T_(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return v1e(t,lb(r),e??is.encoder);default:return b1e(t,lb(r),e??Ml.encoder)}}const P_=new WeakMap;function lb(r){const e=P_.get(r);if(e==null){const t=new Map;return P_.set(r,t),t}return e}var pN;let xz=class qr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,pN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==_f)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==E1e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return qr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=y1e(e,t);return qr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return qr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&m1e(e.multihash,n.multihash)}toString(e){return T_(this,e)}toJSON(){return{"/":T_(this)}}link(){return this}[(pN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof qr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new qr(n,i,s,o??D_(n,i,s.bytes))}else if(t[S1e]===!0){const{version:n,multihash:i,code:s}=t,o=Sz(i);return qr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==_f)throw new Error(`Version 0 CID must use dag-pb (code: ${_f}) block encoding`);return new qr(e,t,n,n.bytes)}case 1:{const i=D_(e,t,n.bytes);return new qr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return qr.create(0,_f,e)}static createV1(e,t){return qr.create(1,e,t)}static decode(e){const[t,n]=qr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=qr.inspectBytes(e),n=t.size-t.multihashSize,i=ax(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new cx(t.multihashCode,t.digestSize,s,i);return[t.version===0?qr.createV0(o):qr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=cb(e.subarray(t));return t+=p,h};let i=n(),s=_f;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=w1e(e,t),s=qr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return lb(s).set(n,e),s}};function w1e(r,e){switch(r[0]){case"Q":{const t=e??is;return[is.prefix,t.decode(`${is.prefix}${r}`)]}case is.prefix:{const t=e??is;return[is.prefix,t.decode(r)]}case Ml.prefix:{const t=e??Ml;return[Ml.prefix,t.decode(r)]}case s2.prefix:{const t=e??s2;return[s2.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function v1e(r,e,t){const{prefix:n}=t;if(n!==is.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function b1e(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const _f=112,E1e=18;function D_(r,e,t){const n=Gy(r),i=n+Gy(e),s=new Uint8Array(i+t.byteLength);return Wy(r,s,0),Wy(e,s,n),s.set(t,i),s}const S1e=Symbol.for("@ipld/js-cid/CID"),x1e={...Zfe,...Rfe,...Xfe,...Dfe,...Ofe,...kfe,...Hfe,...Tfe,...Qfe,...Vfe},$_=rh,A1e=tx,Az=function(r){let e=0;if(r=r.toString().trim(),$_(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(A1e(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const s=$_(t[n]);let o;s&&(o=Az(t[n]),t[n]=ae(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,ae(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const s=[n,1];for(n=9-t.length;n>0;n--)s.push("0");t.splice.apply(t,s)}const i=new Uint8Array(e+16);for(n=0;n<t.length;n++){const s=parseInt(t[n],16);i[e++]=s>>8&255,i[e++]=s&255}return i}throw new Error("invalid ip address")},I1e=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const i=[];for(let s=0;s<t;s++)i.push(r[e+s]);return i.join(".")}if(t===16){const i=[];for(let s=0;s<t;s+=2)i.push(n.getUint16(e+s).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Hn=-1,np={},ub={},C1e=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Hn,"ip6zone"],[43,8,"ipcidr"],[53,Hn,"dns",!0],[54,Hn,"dns4",!0],[55,Hn,"dns6",!0],[56,Hn,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Hn,"unix",!1,!0],[421,Hn,"ipfs"],[421,Hn,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Hn,"garlic64"],[448,0,"tls"],[449,Hn,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Hn,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,Hn,"http-path"],[777,Hn,"memory"]];C1e.forEach(r=>{const e=k1e(...r);ub[e.code]=e,np[e.name]=e});function k1e(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:!!n,path:!!i}}function qe(r){if(typeof r=="number"){if(ub[r]!=null)return ub[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(np[r]!=null)return np[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}const _1e=qe("ip4"),T1e=qe("ip6"),P1e=qe("ipcidr");function lx(r,e){switch(qe(r).code){case 4:case 41:return N1e(e);case 42:return l6(e);case 43:return ae(e,"base10");case 6:case 273:case 33:case 132:return Iz(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return l6(e);case 421:return L1e(e);case 444:return M_(e);case 445:return M_(e);case 466:return R1e(e);case 481:return globalThis.encodeURIComponent(l6(e));default:return ae(e,"base16")}}function N_(r,e){switch(qe(r).code){case 4:return O_(e);case 41:return O_(e);case 42:return c6(e);case 43:return fe(e,"base10");case 6:case 273:case 33:case 132:return ux(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return c6(e);case 421:return O1e(e);case 444:return B1e(e);case 445:return U1e(e);case 466:return M1e(e);case 481:return c6(globalThis.decodeURIComponent(e));default:return fe(e,"base16")}}function D1e(r){let e,t;if(r.stringTuples().forEach(([n,i])=>{(n===_1e.code||n===T1e.code)&&(t=i),n===P1e.code&&(e=i)}),e==null||t==null)throw new Error("Invalid multiaddr");return new wz(t,e)}const a6=Object.values(x1e).map(r=>r.decoder),$1e=function(){let r=a6[0].or(a6[1]);return a6.slice(2).forEach(e=>r=r.or(e)),r}();function O_(r){if(!nz(r))throw new Error("invalid ip address");return Az(r)}function N1e(r){const e=I1e(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!nz(e))throw new Error("invalid ip address");return e}function ux(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function Iz(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function c6(r){const e=fe(r),t=Uint8Array.from(kr(e.length));return ur([t,e],t.length+e.length)}function l6(r){const e=ms(r);if(r=r.slice(At(e)),r.length!==e)throw new Error("inconsistent lengths");return ae(r)}function O1e(r){let e;r[0]==="Q"||r[0]==="1"?e=Sz(is.decode(`z${r}`)).bytes:e=xz.parse(r).multihash.bytes;const t=Uint8Array.from(kr(e.length));return ur([t,e],t.length+e.length)}function M1e(r){const e=$1e.decode(r),t=Uint8Array.from(kr(e.length));return ur([t,e],t.length+e.length)}function R1e(r){const e=ms(r),t=r.slice(At(e));if(t.length!==e)throw new Error("inconsistent lengths");return"u"+ae(t,"base64url")}function L1e(r){const e=ms(r),t=r.slice(At(e));if(t.length!==e)throw new Error("inconsistent lengths");return ae(t,"base58btc")}function B1e(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Ml.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=ux(n);return ur([t,i],t.length+i.length)}function U1e(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=Ml.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=ux(n);return ur([t,i],t.length+i.length)}function M_(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=ae(e,"base32"),i=Iz(t);return`${n}:${i}`}function F1e(r){r=db(r);const e=[],t=[];let n=null;const i=r.split("/").slice(1);if(i.length===1&&i[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<i.length;s++){const o=i[s],a=qe(o);if(a.size===0){e.push([a.code]),t.push([a.code]);continue}if(s++,s>=i.length)throw new dx("invalid address: "+r);if(a.path===!0){n=db(i.slice(s).join("/")),e.push([a.code,N_(a.code,n)]),t.push([a.code,n]);break}const c=N_(a.code,i[s]);e.push([a.code,c]),t.push([a.code,lx(a.code,c)])}return{string:Cz(t),bytes:kz(e),tuples:e,stringTuples:t,path:n}}function R_(r){const e=[],t=[];let n=null,i=0;for(;i<r.length;){const s=ms(r,i),o=At(s),a=qe(s),c=z1e(a,r.slice(i+o));if(c===0){e.push([s]),t.push([s]),i+=o;continue}const l=r.slice(i+o,i+o+c);if(i+=c+o,i>r.length)throw new dx("Invalid address Uint8Array: "+ae(r,"base16"));e.push([s,l]);const d=lx(s,l);if(t.push([s,d]),a.path===!0){n=d;break}}return{bytes:Uint8Array.from(r),string:Cz(t),tuples:e,stringTuples:t,path:n}}function Cz(r){const e=[];return r.map(t=>{const n=qe(t[0]);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),db(e.join("/"))}function kz(r){return ur(r.map(e=>{const t=qe(e[0]);let n=Uint8Array.from(kr(t.code));return e.length>1&&e[1]!=null&&(n=ur([n,e[1]])),n}))}function z1e(r,e){if(r.size>0)return r.size/8;if(r.size===0)return 0;{const t=ms(e instanceof Uint8Array?e:Uint8Array.from(e));return t+At(t)}}function db(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}class dx extends Error{constructor(t){super(`Error parsing address: ${t}`);u(this,"name","ParseError")}}u(dx,"name","ParseError");const V1e=Symbol.for("nodejs.util.inspect.custom"),_z=Symbol.for("@multiformats/js-multiaddr/multiaddr"),K1e=[qe("dns").code,qe("dns4").code,qe("dns6").code,qe("dnsaddr").code];class H1e extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}var gN,Td,qa,Ap,Ip;const od=class od{constructor(e){u(this,"bytes");et(this,Td);et(this,qa);et(this,Ap);et(this,Ip);u(this,gN,!0);e==null&&(e="");let t;if(e instanceof Uint8Array)t=R_(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=F1e(e)}else if(Pw(e))t=R_(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,kt(this,Td,t.string),kt(this,qa,t.tuples),kt(this,Ap,t.stringTuples),kt(this,Ip,t.path)}toString(){return he(this,Td)}toJSON(){return this.toString()}toOptions(){let e,t,n,i,s="";const o=qe("tcp"),a=qe("udp"),c=qe("ip4"),l=qe("ip6"),d=qe("dns6"),h=qe("ip6zone");for(const[w,f]of this.stringTuples())w===h.code&&(s=`%${f??""}`),K1e.includes(w)&&(t=o.name==="tcp"?"tcp":"udp",i=443,n=`${f??""}${s}`,e=w===d.code?6:4),(w===o.code||w===a.code)&&(t=qe(w).name==="tcp"?"tcp":"udp",i=parseInt(f??"")),(w===c.code||w===l.code)&&(t=qe(w).name==="tcp"?"tcp":"udp",n=`${f??""}${s}`,e=w===l.code?6:4);if(e==null||t==null||n==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:i}}protos(){return he(this,qa).map(([e])=>Object.assign({},qe(e)))}protoCodes(){return he(this,qa).map(([e])=>e)}protoNames(){return he(this,qa).map(([e])=>qe(e).name)}tuples(){return he(this,qa).map(([e,t])=>t==null?[e]:[e,t])}stringTuples(){return he(this,Ap).map(([e,t])=>t==null?[e]:[e,t])}encapsulate(e){return e=new od(e),new od(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new od(n.slice(0,i))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new od(kz(t.slice(0,n)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([n,i])=>{n===np.p2p.code&&e.push([n,i]),n===np["p2p-circuit"].code&&(e=[])});const t=e.pop();if((t==null?void 0:t[1])!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?ae(is.decode(`z${n}`),"base58btc"):ae(xz.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return he(this,Ip)}equals(e){return Xe(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(s=>s.resolvable);if(t==null)return[this];const n=hx.get(t.name);if(n==null)throw new H1e(`no available resolver for ${t.name}`);return(await n(this,e)).map(s=>Fe(s))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(gN=_z,V1e)](){return`Multiaddr(${he(this,Td)})`}};Td=new WeakMap,qa=new WeakMap,Ap=new WeakMap,Ip=new WeakMap;let hb=od;const hx=new Map;function Pw(r){return!!(r!=null&&r[_z])}function Fe(r){return new hb(r)}const j1e=[qe("tcp").code,qe("dns").code,qe("dnsaddr").code,qe("dns4").code,qe("dns6").code];function L_(r){var e;return(e=Tz("sni",r))==null?void 0:e[1]}function B_(r){var t;const e=(t=Tz("tcp",r))==null?void 0:t[1];return e==null?"":`:${e}`}function Tz(r,e){let t;try{t=qe(r).code}catch{return}for(const[n,i]of e)if(n===t&&i!=null)return[n,i]}function U_(r){return r.some(([e,t])=>e===qe("tls").code)}function Gi(r,e,t){const n=Pz[qe(r).name];if(n==null)throw new Error(`Can't interpret protocol ${qe(r).name}`);const i=n(e,t);return r===qe("ip6").code?`[${i}]`:i}const Pz={ip4:(r,e)=>r,ip6:(r,e)=>e.length===0?r:`[${r}]`,tcp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`tcp://${Gi(t[0],t[1]??"",e)}:${r}`},udp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`udp://${Gi(t[0],t[1]??"",e)}:${r}`},dnsaddr:(r,e)=>r,dns4:(r,e)=>r,dns6:(r,e)=>r,dns:(r,e)=>r,ipfs:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${Gi(t[0],t[1]??"",e)}`},p2p:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${Gi(t[0],t[1]??"",e)}`},http:(r,e)=>{const t=U_(e),n=L_(e),i=B_(e);if(t&&n!=null)return`https://${n}${i}`;const s=t?"https://":"http://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=Gi(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${s}${a}`},"http-path":(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");const n=Gi(t[0],t[1]??"",e),i=decodeURIComponent(r);return`${n}/${i}`},tls:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return Gi(t[0],t[1]??"",e)},sni:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return Gi(t[0],t[1]??"",e)},https:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=Gi(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`https://${n}`},ws:(r,e)=>{const t=U_(e),n=L_(e),i=B_(e);if(t&&n!=null)return`wss://${n}${i}`;const s=t?"wss://":"ws://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=Gi(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${s}${a}`},wss:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=Gi(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`wss://${n}`}};function Dz(r,e){const n=Fe(r).stringTuples(),i=n.pop();if(i==null)throw new Error("Unexpected end of multiaddr");const s=qe(i[0]),o=Pz[s.name];if(o==null)throw new Error(`No interpreter found for ${s.name}`);let a=o(i[1]??"",n);return j1e.includes(i[0])&&(a=a.replace(/^.*:\/\//,""),i[1]==="443"?a=`https://${a}`:a=`http://${a}`),(a.startsWith("http://")||a.startsWith("https://")||a.startsWith("ws://")||a.startsWith("wss://"))&&(a=new URL(a).toString(),a.endsWith("/")&&(a=a.substring(0,a.length-1))),a}let q1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},W1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return $z(this,e)}},G1e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return $z(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function $z(r,e){return new G1e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Q1e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new q1e(e,t,n),this.decoder=new W1e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Y1e({name:r,prefix:e,encode:t,decode:n}){return new Q1e(r,e,t,n)}function X1e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function J1e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Dw({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return Y1e({prefix:e,name:r,encode(i){return J1e(i,n,t)},decode(i){return X1e(i,n,t,r)}})}const Z1e=Dw({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Dw({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});Dw({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});Dw({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var xl,Al,Pd,Dd,Il,m3,Nz;class epe{constructor(e,{logger:t,transformRequestInit:n}){et(this,m3);u(this,"url");et(this,xl,0);et(this,Al,0);et(this,Pd,0);et(this,Dd,0);et(this,Il,new Map);u(this,"log");u(this,"transformRequestInit");this.url=e instanceof URL?e:new URL(e),this.transformRequestInit=n,this.log=t.forComponent(`helia:trustless-gateway-block-broker:${this.url.hostname}`)}async getRawBlock(e,t){const n=new URL(this.url.toString());if(n.pathname=`/ipfs/${e.toString()}`,n.search="?format=raw",(t==null?void 0:t.aborted)===!0)throw new Error(`Signal to fetch raw block for CID ${e} from gateway ${this.url} was aborted prior to fetch`);const i=De(this,m3,Nz).call(this,e),s=new AbortController,o=()=>{s.abort()};t==null||t.addEventListener("abort",o);try{let a=he(this,Il).get(i);if(a==null){Es(this,xl)._++;const c={signal:s.signal,headers:{Accept:"application/vnd.ipld.raw"},cache:"force-cache"},l=this.transformRequestInit!=null?await this.transformRequestInit(c):c;a=fetch(n.toString(),l).then(async d=>{if(this.log("GET %s %d",n,d.status),!d.ok)throw Es(this,Al)._++,new Error(`unable to fetch raw block for CID ${e} from gateway ${this.url}`);return Es(this,Dd)._++,new Uint8Array(await d.arrayBuffer())}),he(this,Il).set(i,a)}return await a}catch{throw(t==null?void 0:t.aborted)===!0?new Error(`fetching raw block for CID ${e} from gateway ${this.url} was aborted`):(Es(this,Al)._++,new Error(`unable to fetch raw block for CID ${e}`))}finally{t==null||t.removeEventListener("abort",o),he(this,Il).delete(i)}}reliability(){return he(this,xl)===0?1:he(this,Pd)>0?-1/0:he(this,Dd)/(he(this,xl)+he(this,Al)*3)}incrementInvalidBlocks(){Es(this,Pd)._++}getStats(){return{attempts:he(this,xl),errors:he(this,Al),invalidBlocks:he(this,Pd),successes:he(this,Dd),pendingResponses:he(this,Il).size}}}xl=new WeakMap,Al=new WeakMap,Pd=new WeakMap,Dd=new WeakMap,Il=new WeakMap,m3=new WeakSet,Nz=function(e){const t=e.multihash.bytes;return Z1e.encode(t)};function tpe(r,e,t){return r.filter(n=>{if(Yhe.matches(n)||e&&Ghe.matches(n))return t||cz.matches(n)?!0:Vc(n.toOptions().host)===!1;if(!e&&t){const{host:i}=n.toOptions();if(i==="127.0.0.1"||i==="localhost"||i.endsWith(".localhost"))return!0}return!1})}async function*Oz(r,e,t,n,i,s={}){for await(const o of e.findProviders(r,s)){const a=tpe(o.multiaddrs,n,i);if(a.length===0)continue;const c=Dz(a[0]);yield new epe(c,{logger:t,transformRequestInit:s.transformRequestInit})}}class rpe extends JF{constructor(t,n){super(t,{...n,name:"helia:trustless-gateway:session"});u(this,"routing");u(this,"allowInsecure");u(this,"allowLocal");u(this,"transformRequestInit");this.routing=t.routing,this.allowInsecure=n.allowInsecure??Mz,this.allowLocal=n.allowLocal??Rz,this.transformRequestInit=n.transformRequestInit}async queryProvider(t,n,i){var o;this.log("fetching BLOCK for %c from %s",t,n.url);const s=await n.getRawBlock(t,i.signal);return this.log.trace("got block for %c from %s",t,n.url),await((o=i.validateFn)==null?void 0:o.call(i,s)),s}async*findNewProviders(t,n={}){yield*Oz(t,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...n,transformRequestInit:this.transformRequestInit})}toEvictionKey(t){return t.url.toString()}equals(t,n){return t.url.toString()===n.url.toString()}}function npe(r,e){return new rpe(r,e)}class ipe{constructor(e,t={}){u(this,"allowInsecure");u(this,"allowLocal");u(this,"transformRequestInit");u(this,"routing");u(this,"log");u(this,"logger");this.log=e.logger.forComponent("helia:trustless-gateway-block-broker"),this.logger=e.logger,this.routing=e.routing,this.allowInsecure=t.allowInsecure??Mz,this.allowLocal=t.allowLocal??Rz,this.transformRequestInit=t.transformRequestInit}async retrieve(e,t={}){var i,s;const n=[];for await(const o of Oz(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...t,transformRequestInit:this.transformRequestInit})){this.log("getting block for %c from %s",e,o.url);try{const a=await o.getRawBlock(e,t.signal);this.log.trace("got block for %c from %s",e,o.url);try{await((i=t.validateFn)==null?void 0:i.call(t,a))}catch(c){this.log.error("failed to validate block for %c from %s",e,o.url,c);continue}return a}catch(a){if(this.log.error("failed to get block for %c from %s",e,o.url,a),a instanceof Error?n.push(a):n.push(new Error(`Unable to fetch raw block for CID ${e} from gateway ${o.url}`)),((s=t.signal)==null?void 0:s.aborted)===!0){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",e,o.url);break}}}throw n.length>0?new AggregateError(n,`Unable to fetch raw block for CID ${e} from any gateway`):new Error(`Unable to fetch raw block for CID ${e} from any gateway`)}createSession(e={}){return npe({logger:this.logger,routing:this.routing},{...e,allowLocal:this.allowLocal,allowInsecure:this.allowInsecure,transformRequestInit:this.transformRequestInit})}}const Mz=!1,Rz=!1;function spe(r={}){return e=>new ipe(e,r)}async function*F_(r,e={}){const t=r.getReader();try{for(;;){const n=await t.read();if(n.done)return;yield n.value}}finally{e.preventCancel!==!0&&await t.cancel(),t.releaseLock()}}var Lz={exports:{}};(function(r){(function(){r.exports=v;var e=86400,t=3200,n=146097*t/400,i=e*n,s=1e3*i,o=864e13,a=4294967296,c=1e6,l="000000000",d=Math.trunc||function($){var z=$-$%1;return z==0&&($<0||$===0&&1/$!=1/0)?-0:z},h=v.prototype,p=(v.fromDate=function($){return new v(+$)},v.fromInt64BE=I(0,1,2,3,0,4),v.fromInt64LE=I(3,2,1,0,4,0),v.fromString=function(K){var z,j=new v,K=(K+="").replace(/^\s*[+\-]?\d+/,function(G){var G=+G,Q=1970+(G-1970)%400;return j.year=G-Q,Q}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(Z,G,Q){return G<0&&(Q*=-1),z=6e4*(60*+G+ +Q),""}).replace(/\.\d+$/,function(Z){return j.nano=+(Z+l).substr(1,9),""}).split(/\D+/);if(1<K.length?K[1]--:K[1]=0,j.time=z=Date.UTC.apply(Date,K)-(z||0),isNaN(z))throw new TypeError("Invalid Date");return y(j)},v.fromTimeT=function($){return b($,0)},h.year=0,h.time=0,h.nano=0,h.addNano=function($){return this.nano+=+$||0,this},h.getNano=function(){var $=y(this);return($.time%1e3*c+ +$.nano+1e9)%1e9},h.getTimeT=function(){var z=y(this),$=Math.floor(z.time/1e3),z=z.year;return z&&($+=z*n*e/t),$},h.getYear=function(){return this.toDate().getUTCFullYear()+this.year},h.toDate=function(){return m(y(this).time)},h.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},h.toString=function($){var z=this,j=z.toDate(),K={H:function(){return A(j.getUTCHours())},L:function(){return _(j.getUTCMilliseconds(),3)},M:function(){return A(j.getUTCMinutes())},N:function(){return _(z.getNano(),9)},S:function(){return A(j.getUTCSeconds())},Y:function(){var Z=z.getYear();return 999999<Z?"+"+Z:9999<Z?"+"+_(Z,6):0<=Z?_(Z,4):-999999<=Z?"-"+_(-Z,6):Z},a:function(){return f[j.getUTCDay()]},b:function(){return w[j.getUTCMonth()]},d:function(){return A(j.getUTCDate())},e:function(){return function(Z){return(9<Z?"":" ")+(0|Z)}(j.getUTCDate())},m:function(){return A(j.getUTCMonth()+1)}};return function Z(G){return G.replace(/%./g,function(Q){var q=Q[1],J=g[q],q=K[q];return J?Z(J):q?q():Q})}($||p)},h.writeInt64BE=S(0,1,2,3,0,4),h.writeInt64LE=S(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),w=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return v;function v($,z,j){var K=this;if(!(K instanceof v))return new v($,z,j);K.time=+$||0,K.nano=+z||0,K.year=+j||0,y(K)}function y($){var z,j,K,Z=$.year,G=$.time,Q=$.nano,J=((Q<0||c<=Q)&&(Q-=(j=Math.floor(Q/c))*c,G+=j,j=1),Z%t);return(G<-864e13||o<G||J)&&((z=d(G/s))&&(Z+=z*t,G-=z*s),(K=m(G)).setUTCFullYear(J+K.getUTCFullYear()),K=(G=+K)+(z=d((Z-=J)/t))*s,z&&-864e13<=K&&K<=o&&(Z-=z*t,G=K),j=1),j&&($.year=Z,$.time=G,$.nano=Q),$}function m($){var z=new Date(0);return z.setTime($),z}function b(Z,K){Z=+Z||0;var j=d((K=(K|0)*a)/i)+d(Z/i),K=K%i+Z%i,Z=d(K/i);return Z&&(j+=Z,K-=Z*i),new v(1e3*K,0,j*t)}function S($,z,j,K,Z,G){return function(J,q){var V=y(this);J=J||new Array(8),T(J,q|=0);var W=Math.floor(V.time/1e3),V=V.year*(n*e/t),B=d(V/a)+d(W/a),V=V%a+W%a,W=Math.floor(V/a);return W&&(B+=W,V-=W*a),Q(J,q+Z,B),Q(J,q+G,V),J};function Q(J,q,B){J[q+$]=B>>24&255,J[q+z]=B>>16&255,J[q+j]=B>>8&255,J[q+K]=255&B}}function I($,z,j,K,Z,G){return function(J,q){T(J,q|=0);var B=Q(J,q+Z);return b(Q(J,q+G),B)};function Q(J,q){return 16777216*J[q+$]+(J[q+z]<<16|J[q+j]<<8|J[q+K])}}function T($,z){if($=$&&$.length,$==null)throw new TypeError("Invalid Buffer");if($<z+8)throw new RangeError("Out of range")}function A($){return(9<$?"":"0")+(0|$)}function _($,z){return(l+(0|$)).substr(-z)}})()})(Lz);var ope=Lz.exports;const fb=Qs(ope);class Ha extends Error{constructor(e="Record signature verification failed"){super(e),this.name="SignatureVerificationError"}}u(Ha,"name","SignatureVerificationError");class Bz extends Error{constructor(e="Record has expired"){super(e),this.name="RecordExpiredError"}}u(Bz,"name","RecordExpiredError");class fx extends Error{constructor(e="The validity type is unsupported"){super(e),this.name="UnsupportedValidityError"}}u(fx,"name","UnsupportedValidityError");class Uz extends Error{constructor(e="The record is too large"){super(e),this.name="RecordTooLargeError"}}u(Uz,"name","RecordTooLargeError");class Fz extends Error{constructor(e="Value must be a valid content path starting with /"){super(e),this.name="InvalidValueError"}}u(Fz,"name","InvalidValueError");class zz extends Error{constructor(e="Invalid record data"){super(e),this.name="InvalidRecordDataError"}}u(zz,"name","InvalidRecordDataError");class pb extends Error{constructor(e="Invalid embedded public key"){super(e),this.name="InvalidEmbeddedPublicKeyError"}}u(pb,"name","InvalidEmbeddedPublicKeyError");var ds;(function(r){(function(n){n.EOL="EOL"})(r.ValidityType||(r.ValidityType={}));let e;(function(n){n[n.EOL=0]="EOL"})(e||(e={})),function(n){n.codec=()=>Bn(e)}(r.ValidityType||(r.ValidityType={}));let t;r.codec=()=>(t==null&&(t=Be((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.value!=null&&(i.uint32(10),i.bytes(n.value)),n.signatureV1!=null&&(i.uint32(18),i.bytes(n.signatureV1)),n.validityType!=null&&(i.uint32(24),r.ValidityType.codec().encode(n.validityType,i)),n.validity!=null&&(i.uint32(34),i.bytes(n.validity)),n.sequence!=null&&(i.uint32(40),i.uint64(n.sequence)),n.ttl!=null&&(i.uint32(48),i.uint64(n.ttl)),n.pubKey!=null&&(i.uint32(58),i.bytes(n.pubKey)),n.signatureV2!=null&&(i.uint32(66),i.bytes(n.signatureV2)),n.data!=null&&(i.uint32(74),i.bytes(n.data)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.value=n.bytes();break}case 2:{o.signatureV1=n.bytes();break}case 3:{o.validityType=r.ValidityType.codec().decode(n);break}case 4:{o.validity=n.bytes();break}case 5:{o.sequence=n.uint64();break}case 6:{o.ttl=n.uint64();break}case 7:{o.pubKey=n.bytes();break}case 8:{o.signatureV2=n.bytes();break}case 9:{o.data=n.bytes();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>Le(n,r.codec()),r.decode=(n,i)=>Re(n,r.codec(),i)})(ds||(ds={}));function ape(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function px(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function cpe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var lpe=cpe,upe=lpe;let dpe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},hpe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Vz(this,e)}},fpe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return Vz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Vz(r,e){return new fpe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let ppe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new dpe(e,t,n),this.decoder=new hpe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Kz({name:r,prefix:e,encode:t,decode:n}){return new ppe(r,e,t,n)}function $w({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=upe(t,r);return Kz({prefix:e,name:r,encode:n,decode:s=>px(i(s))})}function gpe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function ype(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function ta({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return Kz({prefix:e,name:r,encode(i){return ype(i,n,t)},decode(i){return gpe(i,n,t,r)}})}const u6=$w({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});$w({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const o2=ta({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ta({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});ta({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});ta({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});ta({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});ta({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});ta({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});ta({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});ta({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Na=$w({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});$w({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var mpe=Hz,z_=128,wpe=-128,vpe=Math.pow(2,31);function Hz(r,e,t){e=e||[],t=t||0;for(var n=t;r>=vpe;)e[t++]=r&255|z_,r/=128;for(;r&wpe;)e[t++]=r&255|z_,r>>>=7;return e[t]=r|0,Hz.bytes=t-n+1,e}var bpe=gb,Epe=128,V_=127;function gb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw gb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&V_)<<i:(o&V_)*Math.pow(2,i),i+=7}while(o>=Epe);return gb.bytes=s-n,t}var Spe=Math.pow(2,7),xpe=Math.pow(2,14),Ape=Math.pow(2,21),Ipe=Math.pow(2,28),Cpe=Math.pow(2,35),kpe=Math.pow(2,42),_pe=Math.pow(2,49),Tpe=Math.pow(2,56),Ppe=Math.pow(2,63),Dpe=function(r){return r<Spe?1:r<xpe?2:r<Ape?3:r<Ipe?4:r<Cpe?5:r<kpe?6:r<_pe?7:r<Tpe?8:r<Ppe?9:10},$pe={encode:mpe,decode:bpe,encodingLength:Dpe},Qy=$pe;function yb(r,e=0){return[Qy.decode(r,e),Qy.decode.bytes]}function Yy(r,e,t=0){return Qy.encode(r,e,t),e}function Xy(r){return Qy.encodingLength(r)}function Npe(r,e){const t=e.byteLength,n=Xy(r),i=n+Xy(t),s=new Uint8Array(i+t);return Yy(r,s,0),Yy(t,s,n),s.set(e,i),new gx(r,t,e,s)}function jz(r){const e=px(r),[t,n]=yb(e),[i,s]=yb(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new gx(t,i,o,e)}function Ope(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&ape(r.bytes,t.bytes)}}let gx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function K_(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Rpe(t,mb(r),e??Na.encoder);default:return Lpe(t,mb(r),e??o2.encoder)}}const H_=new WeakMap;function mb(r){const e=H_.get(r);if(e==null){const t=new Map;return H_.set(r,t),t}return e}var yN;let j_=class Wr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,yN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Tf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Bpe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Wr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Npe(e,t);return Wr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Wr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Ope(e.multihash,n.multihash)}toString(e){return K_(this,e)}toJSON(){return{"/":K_(this)}}link(){return this}[(yN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Wr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Wr(n,i,s,o??q_(n,i,s.bytes))}else if(t[Upe]===!0){const{version:n,multihash:i,code:s}=t,o=jz(i);return Wr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Tf)throw new Error(`Version 0 CID must use dag-pb (code: ${Tf}) block encoding`);return new Wr(e,t,n,n.bytes)}case 1:{const i=q_(e,t,n.bytes);return new Wr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Wr.create(0,Tf,e)}static createV1(e,t){return Wr.create(1,e,t)}static decode(e){const[t,n]=Wr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Wr.inspectBytes(e),n=t.size-t.multihashSize,i=px(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new gx(t.multihashCode,t.digestSize,s,i);return[t.version===0?Wr.createV0(o):Wr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=yb(e.subarray(t));return t+=p,h};let i=n(),s=Tf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Mpe(e,t),s=Wr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return mb(s).set(n,e),s}};function Mpe(r,e){switch(r[0]){case"Q":{const t=e??Na;return[Na.prefix,t.decode(`${Na.prefix}${r}`)]}case Na.prefix:{const t=e??Na;return[Na.prefix,t.decode(r)]}case o2.prefix:{const t=e??o2;return[o2.prefix,t.decode(r)]}case u6.prefix:{const t=e??u6;return[u6.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Rpe(r,e,t){const{prefix:n}=t;if(n!==Na.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Lpe(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Tf=112,Bpe=18;function q_(r,e,t){const n=Xy(r),i=n+Xy(e),s=new Uint8Array(i+t.byteLength);return Yy(r,s,0),Yy(e,s,n),s.set(t,i),s}const Upe=Symbol.for("@ipld/js-cid/CID"),Fpe=Rh("ipns:utils"),qz=fe("/ipns/"),zpe=0,Vpe=18;function Kpe(r){let e;if(r.pubKey!=null)try{e=Un(r.pubKey)}catch(t){throw Fpe.error(t),t}if(e!=null)return e}function Hpe(r){const e=fe("ipns-signature:");return ur([e,r])}function Wz(r){return"signatureV1"in r?ds.encode({value:fe(r.value),signatureV1:r.signatureV1,validityType:r.validityType,validity:fe(r.validity),sequence:r.sequence,ttl:r.ttl,pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data}):ds.encode({pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data})}function Yp(r){const e=ds.decode(r);if(e.sequence!=null&&(e.sequence=BigInt(e.sequence)),e.ttl!=null&&(e.ttl=BigInt(e.ttl)),e.signatureV2==null||e.data==null)throw new Ha("Missing data or signatureV2");const t=Qz(e.data),n=jpe(t.Value),i=ae(t.Validity);if(e.value!=null&&e.signatureV1!=null)return qpe(e),{value:n,validityType:ds.ValidityType.EOL,validity:i,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV1:e.signatureV1,signatureV2:e.signatureV2,data:e.data};if(e.signatureV2!=null)return{value:n,validityType:ds.ValidityType.EOL,validity:i,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}function Gz(r){return ur([qz,r.bytes])}function wb(r){const e=jz(r.slice(qz.length));if(!vb(e,zpe)&&!vb(e,Vpe))throw new tw("Multihash in IPNS key was not identity or sha2-256");return e}function Qz(r){const e=Va(r);if(e.ValidityType===0)e.ValidityType=ds.ValidityType.EOL;else throw new fx("The validity type is unsupported");return Number.isInteger(e.Sequence)&&(e.Sequence=BigInt(e.Sequence)),Number.isInteger(e.TTL)&&(e.TTL=BigInt(e.TTL)),e}function jpe(r){const e=ae(r).trim();if(e.startsWith("/"))return e;try{return`/ipfs/${j_.decode(r).toV1().toString()}`}catch{}try{return`/ipfs/${j_.parse(e).toV1().toString()}`}catch{}throw new Fz("Value must be a valid content path starting with /")}function qpe(r){if(r.data==null)throw new zz("Record data is missing");const e=Qz(r.data);if(!Xe(e.Value,r.value??new Uint8Array(0)))throw new Ha('Field "value" did not match between protobuf and CBOR');if(!Xe(e.Validity,r.validity??new Uint8Array(0)))throw new Ha('Field "validity" did not match between protobuf and CBOR');if(e.ValidityType!==r.validityType)throw new Ha('Field "validityType" did not match between protobuf and CBOR');if(e.Sequence!==r.sequence)throw new Ha('Field "sequence" did not match between protobuf and CBOR');if(e.TTL!==r.ttl)throw new Ha('Field "ttl" did not match between protobuf and CBOR')}function vb(r,e){return r.code===e}const lg=Rh("ipns:validator"),Wpe=1024*10,Gpe=async(r,e)=>{const t=Yp(e);let n;try{const i=Hpe(t.data);n=await r.verify(i,t.signatureV2)}catch{n=!1}if(!n)throw lg.error("record signature verification failed"),new Ha("Record signature verification failed");if(t.validityType===ds.ValidityType.EOL){if(fb.fromString(t.validity).toDate().getTime()<Date.now())throw lg.error("record has expired"),new Bz("record has expired")}else if(t.validityType!=null)throw lg.error("the validity type is unsupported"),new fx("The validity type is unsupported");lg("ipns record for %s is valid",t.value)};async function Yz(r,e){if(e.byteLength>Wpe)throw new Uz("The record is too large");const t=wb(r);let n;vb(t,0)&&(n=yU(t));const i=Yp(e),s=Kpe(i)??n;if(s==null)throw new pb("Could not extract public key from IPNS record or routing key");const o=Gz(s.toMultihash());if(!Xe(o,r))throw new pb("Embedded public key did not match routing key");await Gpe(s,e)}let Qpe=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MESSAGE_LENGTH")}};async function*W_(r,e={}){const t=/\r?\n/,n=new TextDecoder("utf8");let i="";for await(let s of r){if(typeof s=="string"&&(s=new TextEncoder().encode(s)),zf(s)&&(s=s.subarray()),i+=n.decode(s,{stream:!0}),i.length>((e==null?void 0:e.maxMessageLength)??i.length))throw new Qpe("Incoming message too long");const o=i.split(t);i=o.pop()??"";for(let a=0;a<o.length;a++)yield JSON.parse(o[a])}i+=n.decode(),i!==""&&(yield JSON.parse(i))}class a2 extends Error{constructor(e="Invalid request"){super(e),this.name="InvalidRequestError"}}u(a2,"name","InvalidRequestError");class fo extends Error{constructor(e="Bad response"){super(e),this.name="BadResponseError"}}u(fo,"name","BadResponseError");function Ype(r){return r[Symbol.asyncIterator]!=null}function Xpe(r){if(Ype(r))return(async()=>{for await(const e of r)return e})();for(const e of r)return e}function Jpe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function yx(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Zpe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var e0e=Zpe,t0e=e0e;let r0e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},n0e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Xz(this,e)}},i0e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return Xz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Xz(r,e){return new i0e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let s0e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new r0e(e,t,n),this.decoder=new n0e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Jz({name:r,prefix:e,encode:t,decode:n}){return new s0e(r,e,t,n)}function Nw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=t0e(t,r);return Jz({prefix:e,name:r,encode:n,decode:s=>yx(i(s))})}function o0e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function a0e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function ra({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return Jz({prefix:e,name:r,encode(i){return a0e(i,n,t)},decode(i){return o0e(i,n,t,r)}})}const c2=ra({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ra({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});ra({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});ra({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});ra({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});ra({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});ra({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});ra({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});ra({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const d6=Nw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Nw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Oa=Nw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Nw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var c0e=Zz,G_=128,l0e=-128,u0e=Math.pow(2,31);function Zz(r,e,t){e=e||[],t=t||0;for(var n=t;r>=u0e;)e[t++]=r&255|G_,r/=128;for(;r&l0e;)e[t++]=r&255|G_,r>>>=7;return e[t]=r|0,Zz.bytes=t-n+1,e}var d0e=bb,h0e=128,Q_=127;function bb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw bb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&Q_)<<i:(o&Q_)*Math.pow(2,i),i+=7}while(o>=h0e);return bb.bytes=s-n,t}var f0e=Math.pow(2,7),p0e=Math.pow(2,14),g0e=Math.pow(2,21),y0e=Math.pow(2,28),m0e=Math.pow(2,35),w0e=Math.pow(2,42),v0e=Math.pow(2,49),b0e=Math.pow(2,56),E0e=Math.pow(2,63),S0e=function(r){return r<f0e?1:r<p0e?2:r<g0e?3:r<y0e?4:r<m0e?5:r<w0e?6:r<v0e?7:r<b0e?8:r<E0e?9:10},x0e={encode:c0e,decode:d0e,encodingLength:S0e},Jy=x0e;function Eb(r,e=0){return[Jy.decode(r,e),Jy.decode.bytes]}function Zy(r,e,t=0){return Jy.encode(r,e,t),e}function em(r){return Jy.encodingLength(r)}function A0e(r,e){const t=e.byteLength,n=em(r),i=n+em(t),s=new Uint8Array(i+t);return Zy(r,s,0),Zy(t,s,n),s.set(e,i),new mx(r,t,e,s)}function I0e(r){const e=yx(r),[t,n]=Eb(e),[i,s]=Eb(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new mx(t,i,o,e)}function C0e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Jpe(r.bytes,t.bytes)}}let mx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function Y_(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return _0e(t,Sb(r),e??Oa.encoder);default:return T0e(t,Sb(r),e??c2.encoder)}}const X_=new WeakMap;function Sb(r){const e=X_.get(r);if(e==null){const t=new Map;return X_.set(r,t),t}return e}var mN;let J_=class Gr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,mN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Pf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==P0e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Gr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=A0e(e,t);return Gr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Gr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&C0e(e.multihash,n.multihash)}toString(e){return Y_(this,e)}toJSON(){return{"/":Y_(this)}}link(){return this}[(mN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Gr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Gr(n,i,s,o??Z_(n,i,s.bytes))}else if(t[D0e]===!0){const{version:n,multihash:i,code:s}=t,o=I0e(i);return Gr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Pf)throw new Error(`Version 0 CID must use dag-pb (code: ${Pf}) block encoding`);return new Gr(e,t,n,n.bytes)}case 1:{const i=Z_(e,t,n.bytes);return new Gr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Gr.create(0,Pf,e)}static createV1(e,t){return Gr.create(1,e,t)}static decode(e){const[t,n]=Gr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Gr.inspectBytes(e),n=t.size-t.multihashSize,i=yx(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new mx(t.multihashCode,t.digestSize,s,i);return[t.version===0?Gr.createV0(o):Gr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=Eb(e.subarray(t));return t+=p,h};let i=n(),s=Pf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=k0e(e,t),s=Gr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Sb(s).set(n,e),s}};function k0e(r,e){switch(r[0]){case"Q":{const t=e??Oa;return[Oa.prefix,t.decode(`${Oa.prefix}${r}`)]}case Oa.prefix:{const t=e??Oa;return[Oa.prefix,t.decode(r)]}case c2.prefix:{const t=e??c2;return[c2.prefix,t.decode(r)]}case d6.prefix:{const t=e??d6;return[d6.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function _0e(r,e,t){const{prefix:n}=t;if(n!==Oa.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function T0e(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Pf=112,P0e=18;function Z_(r,e,t){const n=em(r),i=n+em(e),s=new Uint8Array(i+t.byteLength);return Zy(r,s,0),Zy(e,s,n),s.set(t,i),s}const D0e=Symbol.for("@ipld/js-cid/CID"),eT=fe("/ipns/");function tT(r){return Xe(r.subarray(0,eT.byteLength),eT)}class $0e{constructor(e){u(this,"client");this.client=e}async*findProviders(e,t={}){yield*Oh(this.client.getProviders(e,t),n=>({id:n.ID,multiaddrs:n.Addrs??[]}))}async provide(){}async cancelReprovide(){}async put(e,t,n){if(!tT(e))return;const i=wb(e),s=J_.createV1(114,i),o=Yp(t);await this.client.putIPNS(s,o,n)}async get(e,t){if(!tT(e))throw new sr("Not found");const n=wb(e),i=J_.createV1(114,n);try{const s=await this.client.getIPNS(i,t);return Wz(s)}catch(s){throw s.name==="BadResponseError"?new sr("Not found"):s}}}class N0e{constructor(e){u(this,"client");this.client=e}async findPeer(e,t={}){const n=await Xpe(this.client.getPeers(e,t));if(n!=null)return{id:n.ID,multiaddrs:n.Addrs??[]};throw new sr("Not found")}async*getClosestPeers(e,t={}){}}const hr=Rh("delegated-routing-v1-http-api-client"),ug={concurrentRequests:4,timeout:3e4,cacheTTL:5*60*1e3,cacheName:"delegated-routing-v1-cache"};var hn,qf,xb,Wf;class O0e{constructor(e,t={}){et(this,hn);u(this,"started");u(this,"httpQueue");u(this,"shutDownController");u(this,"clientUrl");u(this,"timeout");u(this,"contentRouting");u(this,"peerRouting");u(this,"filterAddrs");u(this,"filterProtocols");u(this,"inFlightRequests");u(this,"cacheName");u(this,"cache");u(this,"cacheTTL");this.started=!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.httpQueue=new vc({concurrency:t.concurrentRequests??ug.concurrentRequests}),this.inFlightRequests=new Map,this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=t.timeout??ug.timeout,this.filterAddrs=t.filterAddrs,this.filterProtocols=t.filterProtocols,this.contentRouting=new $0e(this),this.peerRouting=new N0e(this),this.cacheName=t.cacheName??ug.cacheName,this.cacheTTL=t.cacheTTL??ug.cacheTTL}get[Kd](){return this.contentRouting}get[Hd](){return this.peerRouting}isStarted(){return this.started}async start(){var e;this.started||(this.started=!0,this.cacheTTL>0&&(this.cache=await((e=globalThis.caches)==null?void 0:e.open(this.cacheName)),this.cache!=null&&hr("cache enabled with ttl %d",this.cacheTTL)))}async stop(){var e;this.httpQueue.clear(),this.shutDownController.abort(),await((e=globalThis.caches)==null?void 0:e.delete(this.cacheName)),this.started=!1}async*getProviders(e,t={}){hr("getProviders starts: %c",e);const n=AbortSignal.timeout(this.timeout),i=bt([this.shutDownController.signal,n,t.signal]),s=Ve(),o=Ve();this.httpQueue.add(async()=>(s.resolve(),o.promise));try{await s.promise;const a=new URL(`${this.clientUrl}routing/v1/providers/${e.toString()}`);De(this,hn,xb).call(this,a,t.filterAddrs,t.filterProtocols);const c={headers:{Accept:"application/x-ndjson"},signal:i},l=await De(this,hn,Wf).call(this,a.toString(),c);if(l==null)throw new fo("No response received");if(!l.ok)throw l.status===404?new sr("No matching records found"):l.status===422?new a2("Request does not conform to schema or semantic constraints"):new fo(`Unexpected status code: ${l.status}`);if(l.body==null)throw new fo("Routing response had no body");const d=l.headers.get("Content-Type");if(d==null)throw new fo("No Content-Type header received");if(d!=null&&d.startsWith("application/json")){const h=await l.json();for(const p of h.Providers){const w=De(this,hn,qf).call(this,p);w!=null&&(yield w)}}else if(d.includes("application/x-ndjson"))for await(const h of W_(F_(l.body))){const p=De(this,hn,qf).call(this,h);p!=null&&(yield p)}else throw new fo(`Unsupported Content-Type: ${d}`)}catch(a){hr.error("getProviders errored:",a)}finally{i.clear(),o.resolve(),hr("getProviders finished: %c",e)}}async*getPeers(e,t={}){hr("getPeers starts: %c",e);const n=AbortSignal.timeout(this.timeout),i=bt([this.shutDownController.signal,n,t.signal]),s=Ve(),o=Ve();this.httpQueue.add(async()=>(s.resolve(),o.promise));try{await s.promise;const a=new URL(`${this.clientUrl}routing/v1/peers/${e.toCID().toString()}`);De(this,hn,xb).call(this,a,t.filterAddrs,t.filterProtocols);const c={headers:{Accept:"application/x-ndjson"},signal:i},l=await De(this,hn,Wf).call(this,a.toString(),c);if(l.status===404)throw new sr("No matching records found");if(l.status===422)throw new a2("Request does not conform to schema or semantic constraints");if(l.body==null)throw new fo("Routing response had no body");if(l.headers.get("Content-Type")==="application/json"){const h=await l.json();for(const p of h.Peers){const w=De(this,hn,qf).call(this,p);w!=null&&(yield w)}}else for await(const h of W_(F_(l.body))){const p=De(this,hn,qf).call(this,h);p!=null&&(yield p)}}catch(a){hr.error("getPeers errored:",a)}finally{i.clear(),o.resolve(),hr("getPeers finished: %c",e)}}async getIPNS(e,t={}){hr("getIPNS starts: %s",e);const n=AbortSignal.timeout(this.timeout),i=bt([this.shutDownController.signal,n,t.signal]),s=Ve(),o=Ve();this.httpQueue.add(async()=>(s.resolve(),o.promise));const a=`${this.clientUrl}routing/v1/ipns/${e}`;try{await s.promise;const c={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:i},l=await De(this,hn,Wf).call(this,a,c);if(hr("getIPNS GET %s %d",a,l.status),l.status===404)throw new sr("No matching records found");if(l.status===422)throw new a2("Request does not conform to schema or semantic constraints");if(l.body==null)throw new fo("GET ipns response had no body");const d=await l.arrayBuffer(),h=new Uint8Array(d,0,d.byteLength);return t.validate!==!1&&await Yz(Gz(e.multihash),h),Yp(h)}catch(c){throw hr.error("getIPNS GET %s error:",a,c),c}finally{i.clear(),o.resolve(),hr("getIPNS finished: %s",e)}}async putIPNS(e,t,n={}){hr("putIPNS starts: %c",e);const i=AbortSignal.timeout(this.timeout),s=bt([this.shutDownController.signal,i,n.signal]),o=Ve(),a=Ve();this.httpQueue.add(async()=>(o.resolve(),a.promise));const c=`${this.clientUrl}routing/v1/ipns/${e}`;try{await o.promise;const l=Wz(t),d={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:l,signal:s},h=await De(this,hn,Wf).call(this,c,d);if(hr("putIPNS PUT %s %d",c,h.status),h.status!==200)throw new fo("PUT ipns response had status other than 200")}catch(l){throw hr.error("putIPNS PUT %s error:",c,l.stack),l}finally{s.clear(),a.resolve(),hr("putIPNS finished: %c",e)}}}hn=new WeakSet,qf=function(e){var t;try{const n=[],i=((t=e.Addrs)==null?void 0:t.map(Fe))??[];return e.Protocols!=null&&n.push(...e.Protocols),e.Protocol!=null&&(n.push(e.Protocol),delete e.Protocol),{...e,Schema:"peer",ID:Zt(e.ID),Addrs:i,Protocols:n}}catch(n){hr.error("could not conform record to peer schema",n)}},xb=function(e,t,n){var i,s;if(t!=null||this.filterAddrs!=null){const o=(t==null?void 0:t.join(","))??((i=this.filterAddrs)==null?void 0:i.join(","))??"";o!==""&&e.searchParams.set("filter-addrs",o)}if(n!=null||this.filterProtocols!=null){const o=(n==null?void 0:n.join(","))??((s=this.filterProtocols)==null?void 0:s.join(","))??"";o!==""&&e.searchParams.set("filter-protocols",o)}},Wf=async function(e,t){var c,l;const n=t.method??"GET",i=`${n}-${e}`;if(n==="GET"){const d=await((c=this.cache)==null?void 0:c.match(e));if(d!=null){if(parseInt(d.headers.get("x-cache-expires")??"0",10)>Date.now())return hr("returning cached response for %s",i),d;await((l=this.cache)==null?void 0:l.delete(e))}}const s=this.inFlightRequests.get(i);if(s!=null){const d=await s;return hr("deduplicating outgoing request for %s",i),d.clone()}const o=fetch(e,t).then(async d=>{if(this.cache!=null&&d.ok&&n==="GET"){const h=Date.now()+this.cacheTTL,p=new Headers(d.headers);p.set("x-cache-expires",h.toString());const w=new Response(d.clone().body,{status:d.status,statusText:d.statusText,headers:p});await this.cache.put(e,w)}return d}).finally(()=>{this.inFlightRequests.delete(i)});return this.inFlightRequests.set(i,o),await o};function M0e(r,e={}){return new O0e(new URL(r),e)}function R0e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Ow(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function L0e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var B0e=L0e,U0e=B0e;let F0e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},z0e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return eV(this,e)}},V0e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return eV(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function eV(r,e){return new V0e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let K0e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new F0e(e,t,n),this.decoder=new z0e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function tV({name:r,prefix:e,encode:t,decode:n}){return new K0e(r,e,t,n)}function Mw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=U0e(t,r);return tV({prefix:e,name:r,encode:n,decode:s=>Ow(i(s))})}function H0e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function j0e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function na({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return tV({prefix:e,name:r,encode(i){return j0e(i,n,t)},decode(i){return H0e(i,n,t,r)}})}const l2=na({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});na({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});na({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});na({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});na({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});na({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});na({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});na({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});na({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const h6=Mw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Mw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Ma=Mw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Mw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var q0e=rV,rT=128,W0e=-128,G0e=Math.pow(2,31);function rV(r,e,t){e=e||[],t=t||0;for(var n=t;r>=G0e;)e[t++]=r&255|rT,r/=128;for(;r&W0e;)e[t++]=r&255|rT,r>>>=7;return e[t]=r|0,rV.bytes=t-n+1,e}var Q0e=Ab,Y0e=128,nT=127;function Ab(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Ab.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&nT)<<i:(o&nT)*Math.pow(2,i),i+=7}while(o>=Y0e);return Ab.bytes=s-n,t}var X0e=Math.pow(2,7),J0e=Math.pow(2,14),Z0e=Math.pow(2,21),ege=Math.pow(2,28),tge=Math.pow(2,35),rge=Math.pow(2,42),nge=Math.pow(2,49),ige=Math.pow(2,56),sge=Math.pow(2,63),oge=function(r){return r<X0e?1:r<J0e?2:r<Z0e?3:r<ege?4:r<tge?5:r<rge?6:r<nge?7:r<ige?8:r<sge?9:10},age={encode:q0e,decode:Q0e,encodingLength:oge},tm=age;function Ib(r,e=0){return[tm.decode(r,e),tm.decode.bytes]}function rm(r,e,t=0){return tm.encode(r,e,t),e}function nm(r){return tm.encodingLength(r)}function nV(r,e){const t=e.byteLength,n=nm(r),i=n+nm(t),s=new Uint8Array(i+t);return rm(r,s,0),rm(t,s,n),s.set(e,i),new wx(r,t,e,s)}function cge(r){const e=Ow(r),[t,n]=Ib(e),[i,s]=Ib(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new wx(t,i,o,e)}function lge(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&R0e(r.bytes,t.bytes)}}let wx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function iT(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return hge(t,Cb(r),e??Ma.encoder);default:return fge(t,Cb(r),e??l2.encoder)}}const sT=new WeakMap;function Cb(r){const e=sT.get(r);if(e==null){const t=new Map;return sT.set(r,t),t}return e}var wN;let uge=class Qr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,wN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Df)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==pge)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Qr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=nV(e,t);return Qr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Qr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&lge(e.multihash,n.multihash)}toString(e){return iT(this,e)}toJSON(){return{"/":iT(this)}}link(){return this}[(wN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Qr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Qr(n,i,s,o??oT(n,i,s.bytes))}else if(t[gge]===!0){const{version:n,multihash:i,code:s}=t,o=cge(i);return Qr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Df)throw new Error(`Version 0 CID must use dag-pb (code: ${Df}) block encoding`);return new Qr(e,t,n,n.bytes)}case 1:{const i=oT(e,t,n.bytes);return new Qr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Qr.create(0,Df,e)}static createV1(e,t){return Qr.create(1,e,t)}static decode(e){const[t,n]=Qr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Qr.inspectBytes(e),n=t.size-t.multihashSize,i=Ow(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new wx(t.multihashCode,t.digestSize,s,i);return[t.version===0?Qr.createV0(o):Qr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=Ib(e.subarray(t));return t+=p,h};let i=n(),s=Df;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=dge(e,t),s=Qr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Cb(s).set(n,e),s}};function dge(r,e){switch(r[0]){case"Q":{const t=e??Ma;return[Ma.prefix,t.decode(`${Ma.prefix}${r}`)]}case Ma.prefix:{const t=e??Ma;return[Ma.prefix,t.decode(r)]}case l2.prefix:{const t=e??l2;return[l2.prefix,t.decode(r)]}case h6.prefix:{const t=e??h6;return[h6.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function hge(r,e,t){const{prefix:n}=t;if(n!==Ma.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function fge(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Df=112,pge=18;function oT(r,e,t){const n=nm(r),i=n+nm(e),s=new Uint8Array(i+t.byteLength);return rm(r,s,0),rm(e,s,n),s.set(t,i),s}const gge=Symbol.for("@ipld/js-cid/CID");function yge(){return{filterProtocols:["unknown","transport-bitswap","transport-ipfs-gateway-http"],filterAddrs:["https","webtransport","webrtc","webrtc-direct","wss","tls"]}}const aT="[a-fA-F\\d:]",Ya=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${aT})|(?<=${aT})(?=\\s|$))`:"",ts="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",nr="[a-fA-F\\d]{1,4}",Rw=`
(?:
(?:${nr}:){7}(?:${nr}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${nr}:){6}(?:${ts}|:${nr}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${nr}:){5}(?::${ts}|(?::${nr}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${nr}:){4}(?:(?::${nr}){0,1}:${ts}|(?::${nr}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${nr}:){3}(?:(?::${nr}){0,2}:${ts}|(?::${nr}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${nr}:){2}(?:(?::${nr}){0,3}:${ts}|(?::${nr}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${nr}:){1}(?:(?::${nr}){0,4}:${ts}|(?::${nr}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${nr}){0,5}:${ts}|(?::${nr}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),mge=new RegExp(`(?:^${ts}$)|(?:^${Rw}$)`),wge=new RegExp(`^${ts}$`),vge=new RegExp(`^${Rw}$`),Lw=r=>r&&r.exact?mge:new RegExp(`(?:${Ya(r)}${ts}${Ya(r)})|(?:${Ya(r)}${Rw}${Ya(r)})`,"g");Lw.v4=r=>r&&r.exact?wge:new RegExp(`${Ya(r)}${ts}${Ya(r)}`,"g");Lw.v6=r=>r&&r.exact?vge:new RegExp(`${Ya(r)}${Rw}${Ya(r)}`,"g");function bge(r){const e=(...t)=>r(...t);return Object.defineProperty(e,"name",{value:`functionTimeout(${r.name||"<anonymous>"})`,configurable:!0}),e}const{toString:Ege}=Object.prototype;function Sge(r){return Ege.call(r)==="[object RegExp]"}const cT={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function xge(r,e={}){if(!Sge(r))throw new TypeError("Expected a RegExp instance");const t=Object.keys(cT).map(i=>(typeof e[i]=="boolean"?e[i]:r[i])?cT[i]:"").join(""),n=new RegExp(e.source||r.source,t);return n.lastIndex=typeof e.lastIndex=="number"?e.lastIndex:r.lastIndex,n}function iV(r,e,{timeout:t}={}){try{return bge(()=>xge(r).test(e),{timeout:t})()}catch(n){throw n}}const Age=15,Ige=45,sV={timeout:400};function lT(r){return r.length>Ige?!1:iV(Lw.v6({exact:!0}),r,sV)}function Cge(r){return r.length>Age?!1:iV(Lw.v4({exact:!0}),r,sV)}const uT={http:"80",https:"443",ws:"80",wss:"443"},kge=["http","https","ws","wss"];function _ge(r,e){e=e??{};const t=e.defaultDnsType??"dns4",{scheme:n,hostname:i,port:s,path:o}=Tge(r),a=[Pge(i,t),Dge(s,n),$ge(n)];o!=null&&a.push(Nge(o));const c="/"+a.filter(l=>!!l).reduce((l,d)=>l.concat(d),[]).join("/");return Fe(c)}function Tge(r){const[e]=r.split(":");kge.includes(e)||(r="http"+r.substring(e.length));let{protocol:t,hostname:n,port:i,pathname:s,search:o}=new URL(r);if(i==null||i===""){const c=Oge(e);c!=null&&(i=c),c==null&&t==="http:"&&(i="80")}let a;return s!=null&&s!==""&&s!=="/"&&(s.startsWith("/")&&(s=s.substring(1)),a=s),o!=null&&o!==""&&(a=a??"",a+=o),{scheme:e,hostname:n,port:i,path:a}}function Pge(r,e){if(!(r==null||r==="")){if(Cge(r))return["ip4",r];if(lT(r))return["ip6",r];if(r[0]==="["){const t=r.substring(1,r.length-1);if(lT(t))return["ip6",t]}return[e,r]}}function Dge(r,e){if(!(r==null||r===""))return e==="udp"?["udp",r]:["tcp",r]}function $ge(r){if(r.match(/^tcp$|^udp$/)==null)return[r]}function Nge(r){if(!(r==null||r===""))return["http-path",encodeURIComponent(r)]}function Oge(r){if(!(r==null||r===""||uT[r]==null))return uT[r]}const oV=0,Mge="identity",aV=Ow;function Rge(r){return nV(oV,aV(r))}const Lge={code:oV,name:Mge,encode:aV,digest:Rge},Bge=["https://trustless-gateway.link","https://4everland.io"],Uge=2336;function Fge(r){return r=r.toString(),{id:Mh(uge.createV1(Uge,Lge.digest(fe(r)))),multiaddrs:[_ge(r)]}}class zge{constructor(e={}){u(this,"gateways");this.gateways=(e.gateways??Bge).map(t=>Fge(t))}async*findProviders(e,t){yield*this.gateways.toSorted(()=>Math.random()>.5?1:-1).map(n=>({...n,protocols:["transport-ipfs-gateway-http"]}))}}function Vge(r={}){return new zge(r)}class Kge{constructor(e){u(this,"libp2p");this.libp2p=e}async provide(e,t){await this.libp2p.contentRouting.provide(e,t)}async cancelReprovide(e,t){await this.libp2p.contentRouting.cancelReprovide(e,t)}async*findProviders(e,t){yield*this.libp2p.contentRouting.findProviders(e,t)}async put(e,t,n){await this.libp2p.contentRouting.put(e,t,n)}async get(e,t){return this.libp2p.contentRouting.get(e,t)}async findPeer(e,t){return this.libp2p.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t){yield*this.libp2p.peerRouting.getClosestPeers(e,t)}}function Hge(r){return new Kge(r)}function jge(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function vx(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function qge(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var Wge=qge,Gge=Wge;let Qge=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Yge=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return cV(this,e)}},Xge=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return cV(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function cV(r,e){return new Xge({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Jge=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Qge(e,t,n),this.decoder=new Yge(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function lV({name:r,prefix:e,encode:t,decode:n}){return new Jge(r,e,t,n)}function Bw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Gge(t,r);return lV({prefix:e,name:r,encode:n,decode:s=>vx(i(s))})}function Zge(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function e2e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function ia({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return lV({prefix:e,name:r,encode(i){return e2e(i,n,t)},decode(i){return Zge(i,n,t,r)}})}const Io=ia({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ia({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});ia({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});ia({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});ia({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});ia({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});ia({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});ia({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});ia({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const f6=Bw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Bw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Ra=Bw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Bw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var t2e=uV,dT=128,r2e=-128,n2e=Math.pow(2,31);function uV(r,e,t){e=e||[],t=t||0;for(var n=t;r>=n2e;)e[t++]=r&255|dT,r/=128;for(;r&r2e;)e[t++]=r&255|dT,r>>>=7;return e[t]=r|0,uV.bytes=t-n+1,e}var i2e=kb,s2e=128,hT=127;function kb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw kb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&hT)<<i:(o&hT)*Math.pow(2,i),i+=7}while(o>=s2e);return kb.bytes=s-n,t}var o2e=Math.pow(2,7),a2e=Math.pow(2,14),c2e=Math.pow(2,21),l2e=Math.pow(2,28),u2e=Math.pow(2,35),d2e=Math.pow(2,42),h2e=Math.pow(2,49),f2e=Math.pow(2,56),p2e=Math.pow(2,63),g2e=function(r){return r<o2e?1:r<a2e?2:r<c2e?3:r<l2e?4:r<u2e?5:r<d2e?6:r<h2e?7:r<f2e?8:r<p2e?9:10},y2e={encode:t2e,decode:i2e,encodingLength:g2e},im=y2e;function _b(r,e=0){return[im.decode(r,e),im.decode.bytes]}function sm(r,e,t=0){return im.encode(r,e,t),e}function om(r){return im.encodingLength(r)}function m2e(r,e){const t=e.byteLength,n=om(r),i=n+om(t),s=new Uint8Array(i+t);return sm(r,s,0),sm(t,s,n),s.set(e,i),new bx(r,t,e,s)}function dV(r){const e=vx(r),[t,n]=_b(e),[i,s]=_b(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new bx(t,i,o,e)}function w2e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&jge(r.bytes,t.bytes)}}let bx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function fT(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return E2e(t,Tb(r),e??Ra.encoder);default:return S2e(t,Tb(r),e??Io.encoder)}}const pT=new WeakMap;function Tb(r){const e=pT.get(r);if(e==null){const t=new Map;return pT.set(r,t),t}return e}var vN;let v2e=class Yr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,vN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==$f)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==x2e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Yr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=m2e(e,t);return Yr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Yr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&w2e(e.multihash,n.multihash)}toString(e){return fT(this,e)}toJSON(){return{"/":fT(this)}}link(){return this}[(vN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Yr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Yr(n,i,s,o??gT(n,i,s.bytes))}else if(t[A2e]===!0){const{version:n,multihash:i,code:s}=t,o=dV(i);return Yr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==$f)throw new Error(`Version 0 CID must use dag-pb (code: ${$f}) block encoding`);return new Yr(e,t,n,n.bytes)}case 1:{const i=gT(e,t,n.bytes);return new Yr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Yr.create(0,$f,e)}static createV1(e,t){return Yr.create(1,e,t)}static decode(e){const[t,n]=Yr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Yr.inspectBytes(e),n=t.size-t.multihashSize,i=vx(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new bx(t.multihashCode,t.digestSize,s,i);return[t.version===0?Yr.createV0(o):Yr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=_b(e.subarray(t));return t+=p,h};let i=n(),s=$f;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=b2e(e,t),s=Yr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Tb(s).set(n,e),s}};function b2e(r,e){switch(r[0]){case"Q":{const t=e??Ra;return[Ra.prefix,t.decode(`${Ra.prefix}${r}`)]}case Ra.prefix:{const t=e??Ra;return[Ra.prefix,t.decode(r)]}case Io.prefix:{const t=e??Io;return[Io.prefix,t.decode(r)]}case f6.prefix:{const t=e??f6;return[f6.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function E2e(r,e,t){const{prefix:n}=t;if(n!==Ra.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function S2e(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const $f=112,x2e=18;function gT(r,e,t){const n=om(r),i=n+om(e),s=new Uint8Array(i+t.byteLength);return sm(r,s,0),sm(e,s,n),s.set(t,i),s}const A2e=Symbol.for("@ipld/js-cid/CID"),I2e=85;class C2e extends YF{constructor(){super();u(this,"data");this.data=new Map}put(t,n){return this.data.set(Io.encode(t.multihash.bytes),n),t}get(t){const n=this.data.get(Io.encode(t.multihash.bytes));if(n==null)throw new Z1;return n}has(t){return this.data.has(Io.encode(t.multihash.bytes))}async delete(t){this.data.delete(Io.encode(t.multihash.bytes))}async*getAll(){for(const[t,n]of this.data.entries())yield{cid:v2e.createV1(I2e,dV(Io.decode(t))),block:n}}}Rh("blockstore:core:tiered");const k2e="SHARDING";function _2e(r){return r[Symbol.asyncIterator]!=null}function am(r){if(_2e(r))return(async()=>{const t=[];for await(const n of r)t.push(n);return t})();const e=[];for(const t of r)e.push(t);return e}function T2e(r){return r[Symbol.asyncIterator]!=null}function yT(r,e){return T2e(r)?async function*(){yield*(await am(r)).sort(e)}():function*(){yield*am(r).sort(e)}()}class P2e{put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:i}of e)await this.put(n,i,t),yield n}async*getMany(e,t={}){for await(const n of e)yield{key:n,value:await this.get(n,t)}}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await Vo(this.putMany(e,n)),e=[],await Vo(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null){const i=e.prefix;n=ol(n,s=>s.key.toString().startsWith(i))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>ol(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>yT(i,s),n)),e.offset!=null){let i=0;const s=e.offset;n=ol(n,()=>i++>=s)}return e.limit!=null&&(n=my(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null){const i=e.prefix;n=ol(n,s=>s.toString().startsWith(i))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>ol(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>yT(i,s),n)),e.offset!=null){const i=e.offset;let s=0;n=ol(n,()=>s++>=i)}return e.limit!=null&&(n=my(n,e.limit)),n}}class hV extends P2e{constructor(){super();u(this,"data");this.data=new Map}put(t,n){return this.data.set(t.toString(),n),t}get(t){const n=this.data.get(t.toString());if(n==null)throw new Z1;return n}has(t){return this.data.has(t.toString())}delete(t){this.data.delete(t.toString())}*_all(){for(const[t,n]of this.data.entries())yield{key:new _t(t),value:n}}*_allKeys(){for(const t of this.data.keys())yield new _t(t)}}new _t(k2e);Rh("datastore:core:tiered");class D2e extends nhe{constructor(t){super({...t,components:{libp2p:t.libp2p}});u(this,"libp2p");this.libp2p=t.libp2p}async start(){await super.start(),await this.libp2p.start()}async stop(){await super.stop(),await this.libp2p.stop()}}let $2e=class{constructor(){u(this,"readNext");u(this,"haveNext");u(this,"ended");u(this,"nextResult");u(this,"error");this.ended=!1,this.readNext=Ve(),this.haveNext=Ve()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Ve(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Ve(),await dn(this.readNext.promise,t==null?void 0:t.signal,t)}};function N2e(){return new $2e}let O2e=class extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}};function cm(r,e){const t=N2e();r.sink(t).catch(async o=>{await t.end(o)}),r.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());const i=new He;return{read:async o=>{var c;if((c=o==null?void 0:o.signal)==null||c.throwIfAborted(),(o==null?void 0:o.bytes)==null){const{done:l,value:d}=await dn(n.next(),o==null?void 0:o.signal);return l===!0?null:d}for(;i.byteLength<o.bytes;){const{value:l,done:d}=await dn(n.next(),o==null?void 0:o.signal);if(d===!0)throw new O2e("unexpected end of input");i.append(l)}const a=i.sublist(0,o.bytes);return i.consume(o.bytes),a},write:async(o,a)=>{var c;(c=a==null?void 0:a.signal)==null||c.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(i.byteLength>0){const o=r.source;r.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield i:yield*i,yield*o}()}return r}}}let M2e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}},R2e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}},L2e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}};function nh(r,e={}){const t=cm(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=At(e.maxDataLength));const n=(e==null?void 0:e.lengthDecoder)??ms,i=(e==null?void 0:e.lengthEncoder)??kr;return{read:async o=>{let a=-1;const c=new He;for(;;){c.append(await t.read({...o,bytes:1}));try{a=n(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new M2e("Invalid message length");if((e==null?void 0:e.maxLengthLength)!=null&&c.byteLength>e.maxLengthLength)throw new L2e("message length length too long");if(a>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&a>e.maxDataLength)throw new R2e("message length too long");return t.read({...o,bytes:a})},write:async(o,a)=>{await t.write(new He(i(o.byteLength),o),a)},writeV:async(o,a)=>{const c=new He(...o.flatMap(l=>[i(l.byteLength),l]));await t.write(c,a)},unwrap:()=>t.unwrap()}}function mT(){const r=Ve();let e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,r.resolve(t)},source:async function*(){yield*await r.promise}()}}function B2e(){const r=mT(),e=mT();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}const ip=65535,wT=ip-16;var bN,EN;const Xp=!!((EN=(bN=globalThis.process)==null?void 0:bN.env)!=null&&EN.DUMP_SESSION_KEYS);function p6(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function fV(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Yn(r,...e){if(!fV(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function vT(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function U2e(r,e){Yn(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function bT(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const pc=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),F2e=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),z2e=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!z2e)throw new Error("Non little-endian hardware is not supported");function V2e(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function Pb(r){if(typeof r=="string")r=V2e(r);else if(fV(r))r=Db(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function K2e(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function H2e(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}const j2e=(r,e)=>{function t(n,...i){if(Yn(n),r.nonceLength!==void 0){const d=i[0];if(!d)throw new Error("nonce / iv required");r.varSizeNonce?Yn(d):Yn(d,r.nonceLength)}const s=r.tagLength;s&&i[1]!==void 0&&Yn(i[1]);const o=e(n,...i),a=(d,h)=>{if(h!==void 0){if(d!==2)throw new Error("cipher output not supported");Yn(h)}};let c=!1;return{encrypt(d,h){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Yn(d),a(o.encrypt.length,h),o.encrypt(d,h)},decrypt(d,h){if(Yn(d),s&&d.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,h),o.decrypt(d,h)}}}return Object.assign(t,r),t};function ET(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!q2e(e))throw new Error("invalid output, must be aligned");return e}function ST(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=4,l=0;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function q2e(r){return r.byteOffset%4===0}function Db(r){return Uint8Array.from(r)}function ih(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}const pV=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),W2e=pV("expand 16-byte k"),G2e=pV("expand 32-byte k"),Q2e=pc(W2e),Y2e=pc(G2e);function ct(r,e){return r<<e|r>>>32-e}function $b(r){return r.byteOffset%4===0}const dg=64,X2e=16,gV=2**32-1,xT=new Uint32Array;function J2e(r,e,t,n,i,s,o,a){const c=i.length,l=new Uint8Array(dg),d=pc(l),h=$b(i)&&$b(s),p=h?pc(i):xT,w=h?pc(s):xT;for(let f=0;f<c;o++){if(r(e,t,n,d,o,a),o>=gV)throw new Error("arx: counter overflow");const g=Math.min(dg,c-f);if(h&&g===dg){const v=f/4;if(f%4!==0)throw new Error("arx: invalid block position");for(let y=0,m;y<X2e;y++)m=v+y,w[m]=p[m]^d[y];f+=dg;continue}for(let v=0,y;v<g;v++)y=f+v,s[y]=i[y]^l[v];f+=g}}function Z2e(r,e){const{allowShortKeys:t,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=K2e({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return p6(i),p6(o),bT(s),bT(t),(a,c,l,d,h=0)=>{Yn(a),Yn(c),Yn(l);const p=l.length;if(d===void 0&&(d=new Uint8Array(p)),Yn(d),p6(h),h<0||h>=gV)throw new Error("arx: counter overflow");if(d.length<p)throw new Error(`arx: output (${d.length}) is shorter than data (${p})`);const w=[];let f=a.length,g,v;if(f===32)w.push(g=Db(a)),v=Y2e;else if(f===16&&t)g=new Uint8Array(32),g.set(a),g.set(a,16),v=Q2e,w.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${f}`);$b(c)||w.push(c=Db(c));const y=pc(g);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(v,y,pc(c.subarray(0,16)),y),c=c.subarray(16)}const m=16-i;if(m!==c.length)throw new Error(`arx: nonce must be ${m} or 16 bytes`);if(m!==12){const S=new Uint8Array(12);S.set(c,s?0:12-c.length),c=S,w.push(c)}const b=pc(c);return J2e(r,v,y,b,l,d,h,o),ih(...w),d}}const vr=(r,e)=>r[e++]&255|(r[e++]&255)<<8;class eye{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Pb(e),Yn(e,32);const t=vr(e,0),n=vr(e,2),i=vr(e,4),s=vr(e,6),o=vr(e,8),a=vr(e,10),c=vr(e,12),l=vr(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let d=0;d<8;d++)this.pad[d]=vr(e,16+2*d)}process(e,t,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],l=o[2],d=o[3],h=o[4],p=o[5],w=o[6],f=o[7],g=o[8],v=o[9],y=vr(e,t+0),m=vr(e,t+2),b=vr(e,t+4),S=vr(e,t+6),I=vr(e,t+8),T=vr(e,t+10),A=vr(e,t+12),_=vr(e,t+14);let $=s[0]+(y&8191),z=s[1]+((y>>>13|m<<3)&8191),j=s[2]+((m>>>10|b<<6)&8191),K=s[3]+((b>>>7|S<<9)&8191),Z=s[4]+((S>>>4|I<<12)&8191),G=s[5]+(I>>>1&8191),Q=s[6]+((I>>>14|T<<2)&8191),J=s[7]+((T>>>11|A<<5)&8191),q=s[8]+((A>>>8|_<<8)&8191),B=s[9]+(_>>>5|i),V=0,W=V+$*a+z*(5*v)+j*(5*g)+K*(5*f)+Z*(5*w);V=W>>>13,W&=8191,W+=G*(5*p)+Q*(5*h)+J*(5*d)+q*(5*l)+B*(5*c),V+=W>>>13,W&=8191;let ee=V+$*c+z*a+j*(5*v)+K*(5*g)+Z*(5*f);V=ee>>>13,ee&=8191,ee+=G*(5*w)+Q*(5*p)+J*(5*h)+q*(5*d)+B*(5*l),V+=ee>>>13,ee&=8191;let Y=V+$*l+z*c+j*a+K*(5*v)+Z*(5*g);V=Y>>>13,Y&=8191,Y+=G*(5*f)+Q*(5*w)+J*(5*p)+q*(5*h)+B*(5*d),V+=Y>>>13,Y&=8191;let ce=V+$*d+z*l+j*c+K*a+Z*(5*v);V=ce>>>13,ce&=8191,ce+=G*(5*g)+Q*(5*f)+J*(5*w)+q*(5*p)+B*(5*h),V+=ce>>>13,ce&=8191;let pe=V+$*h+z*d+j*l+K*c+Z*a;V=pe>>>13,pe&=8191,pe+=G*(5*v)+Q*(5*g)+J*(5*f)+q*(5*w)+B*(5*p),V+=pe>>>13,pe&=8191;let ue=V+$*p+z*h+j*d+K*l+Z*c;V=ue>>>13,ue&=8191,ue+=G*a+Q*(5*v)+J*(5*g)+q*(5*f)+B*(5*w),V+=ue>>>13,ue&=8191;let le=V+$*w+z*p+j*h+K*d+Z*l;V=le>>>13,le&=8191,le+=G*c+Q*a+J*(5*v)+q*(5*g)+B*(5*f),V+=le>>>13,le&=8191;let Me=V+$*f+z*w+j*p+K*h+Z*d;V=Me>>>13,Me&=8191,Me+=G*l+Q*c+J*a+q*(5*v)+B*(5*g),V+=Me>>>13,Me&=8191;let _e=V+$*g+z*f+j*w+K*p+Z*h;V=_e>>>13,_e&=8191,_e+=G*d+Q*l+J*c+q*a+B*(5*v),V+=_e>>>13,_e&=8191;let ze=V+$*v+z*g+j*f+K*w+Z*p;V=ze>>>13,ze&=8191,ze+=G*h+Q*d+J*l+q*c+B*a,V+=ze>>>13,ze&=8191,V=(V<<2)+V|0,V=V+W|0,W=V&8191,V=V>>>13,ee+=V,s[0]=W,s[1]=ee,s[2]=Y,s[3]=ce,s[4]=pe,s[5]=ue,s[6]=le,s[7]=Me,s[8]=_e,s[9]=ze}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;ih(n)}update(e){vT(this);const{buffer:t,blockLen:n}=this;e=Pb(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}t.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){ih(this.h,this.r,this.buffer,this.pad)}digestInto(e){vT(this),U2e(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}function tye(r){const e=(n,i)=>r(i).update(Pb(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}const rye=tye(r=>new eye(r));function nye(r,e,t,n,i,s=20){let o=r[0],a=r[1],c=r[2],l=r[3],d=e[0],h=e[1],p=e[2],w=e[3],f=e[4],g=e[5],v=e[6],y=e[7],m=i,b=t[0],S=t[1],I=t[2],T=o,A=a,_=c,$=l,z=d,j=h,K=p,Z=w,G=f,Q=g,J=v,q=y,B=m,V=b,W=S,ee=I;for(let ce=0;ce<s;ce+=2)T=T+z|0,B=ct(B^T,16),G=G+B|0,z=ct(z^G,12),T=T+z|0,B=ct(B^T,8),G=G+B|0,z=ct(z^G,7),A=A+j|0,V=ct(V^A,16),Q=Q+V|0,j=ct(j^Q,12),A=A+j|0,V=ct(V^A,8),Q=Q+V|0,j=ct(j^Q,7),_=_+K|0,W=ct(W^_,16),J=J+W|0,K=ct(K^J,12),_=_+K|0,W=ct(W^_,8),J=J+W|0,K=ct(K^J,7),$=$+Z|0,ee=ct(ee^$,16),q=q+ee|0,Z=ct(Z^q,12),$=$+Z|0,ee=ct(ee^$,8),q=q+ee|0,Z=ct(Z^q,7),T=T+j|0,ee=ct(ee^T,16),J=J+ee|0,j=ct(j^J,12),T=T+j|0,ee=ct(ee^T,8),J=J+ee|0,j=ct(j^J,7),A=A+K|0,B=ct(B^A,16),q=q+B|0,K=ct(K^q,12),A=A+K|0,B=ct(B^A,8),q=q+B|0,K=ct(K^q,7),_=_+Z|0,V=ct(V^_,16),G=G+V|0,Z=ct(Z^G,12),_=_+Z|0,V=ct(V^_,8),G=G+V|0,Z=ct(Z^G,7),$=$+z|0,W=ct(W^$,16),Q=Q+W|0,z=ct(z^Q,12),$=$+z|0,W=ct(W^$,8),Q=Q+W|0,z=ct(z^Q,7);let Y=0;n[Y++]=o+T|0,n[Y++]=a+A|0,n[Y++]=c+_|0,n[Y++]=l+$|0,n[Y++]=d+z|0,n[Y++]=h+j|0,n[Y++]=p+K|0,n[Y++]=w+Z|0,n[Y++]=f+G|0,n[Y++]=g+Q|0,n[Y++]=v+J|0,n[Y++]=y+q|0,n[Y++]=m+B|0,n[Y++]=b+V|0,n[Y++]=S+W|0,n[Y++]=I+ee|0}const iye=Z2e(nye,{counterRight:!1,counterLength:4,allowShortKeys:!1}),sye=new Uint8Array(16),AT=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(sye.subarray(t))},oye=new Uint8Array(32);function IT(r,e,t,n,i){const s=r(e,t,oye),o=rye.create(s);i&&AT(o,i),AT(o,n);const a=new Uint8Array(16),c=F2e(a);ST(c,0,BigInt(i?i.length:0),!0),ST(c,8,BigInt(n.length),!0),o.update(a);const l=o.digest();return ih(s,a),l}const aye=r=>(e,t,n)=>({encrypt(s,o){const a=s.length;o=ET(a+16,o,!1),o.set(s);const c=o.subarray(0,-16);r(e,t,c,c,1);const l=IT(r,e,t,c,n);return o.set(l,a),ih(l),o},decrypt(s,o){o=ET(s.length-16,o,!1);const a=s.subarray(0,-16),c=s.subarray(-16),l=IT(r,e,t,a,n);if(!H2e(c,l))throw new Error("invalid tag");return o.set(s.subarray(0,-16)),r(e,t,o,o,1),ih(l),o}}),CT=j2e({blockSize:64,nonceLength:12,tagLength:16},aye(iye));function cye(r,e,t){return dw(r),t===void 0&&(t=new Uint8Array(r.outputLen)),mw(r,G1(t),G1(e))}const g6=Uint8Array.from([0]),kT=Uint8Array.of();function lye(r,e,t,n=32){dw(r),wd(n);const i=r.outputLen;if(n>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(n/i);t===void 0&&(t=kT);const o=new Uint8Array(s*i),a=mw.create(r,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let d=0;d<s;d++)g6[0]=d+1,c.update(d===0?kT:l).update(t).update(g6).digestInto(l),o.set(l,i*d),a._cloneInto(c);return a.destroy(),c.destroy(),js(l,g6),o.slice(0,n)}const uye={hashSHA256(r){return Ol(r.subarray())},getHKDF(r,e){const t=cye(Ol,e,r),i=lye(Ol,t,void 0,96),s=i.subarray(0,32),o=i.subarray(32,64),a=i.subarray(64,96);return[s,o,a]},generateX25519KeyPair(){const r=Y0.utils.randomPrivateKey();return{publicKey:Y0.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:Y0.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,e){return Y0.getSharedSecret(r.subarray(),e.subarray())},chaCha20Poly1305Encrypt(r,e,t,n){return CT(n,e,t).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,e,t,n,i){return CT(n,e,t).decrypt(r.subarray(),i)}},dye=uye;function hye(r){return{generateKeypair:r.generateX25519KeyPair,dh:(e,t)=>r.generateX25519SharedKey(e.privateKey,t).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}const lm=r=>{const e=Ln(2);return e[0]=r>>8,e[1]=r,e};lm.bytes=2;const u2=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let e=0;return e+=r[0]<<8,e+=r[1],e}return r.getUint16(0)};u2.bytes=2;function fye(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function yV(r,e){!e.enabled||!Xp||(r?(e(`LOCAL_STATIC_PUBLIC_KEY ${ae(r.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${ae(r.privateKey,"hex")}`)):e("Missing local static keys."))}function mV(r,e){!e.enabled||!Xp||(r?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${ae(r.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${ae(r.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function pye(r,e){!e.enabled||!Xp||e(r?`REMOTE_STATIC_PUBLIC_KEY ${ae(r.subarray(),"hex")}`:"Missing remote static public key.")}function wV(r,e){!e.enabled||!Xp||e(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${ae(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function vV(r,e,t){!t.enabled||!Xp||(t(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&ae(r.k,"hex")}`),t(`CIPHER_STATE_2 ${e.n.getUint64()} ${e.k&&ae(e.k,"hex")}`))}function _c(r,e){if(r.length!==e.length)throw new Error("Inputs should have the same length");const t=Ln(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return t}const w3=class w3 extends Error{constructor(t="Invalid crypto exchange"){super(t);u(this,"code");this.code=w3.code}};u(w3,"code","ERR_INVALID_CRYPTO_EXCHANGE");let l1=w3;const gye=0,yye=4294967295,mye="Cipherstate has reached maximum n, a new handshake must be performed";class wye{constructor(e=gye){u(this,"n");u(this,"bytes");u(this,"view");this.n=e,this.bytes=tt(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>yye)throw new Error(mye)}}const Ed=tt(0);class hg{constructor(e,t=void 0,n=0){u(this,"k");u(this,"n");u(this,"crypto");this.crypto=e,this.k=t,this.n=new wye(n)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();const n=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),n}decryptWithAd(e,t,n){if(!this.hasKey())return t;this.n.assertValue();const i=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,n);return this.n.increment(),i}}class vye{constructor(e,t){u(this,"cs");u(this,"ck");u(this,"h");u(this,"crypto");this.crypto=e;const n=fe(t,"utf-8");this.h=Eye(e,n),this.ck=this.h,this.cs=new hg(e)}mixKey(e){const[t,n]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new hg(this.crypto,n)}mixHash(e){this.h=this.crypto.hash(new He(this.h,e))}encryptAndHash(e){const t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){const t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){const[e,t]=this.crypto.hkdf(this.ck,Ed);return[new hg(this.crypto,e),new hg(this.crypto,t)]}}class bye{constructor(e){u(this,"ss");u(this,"s");u(this,"e");u(this,"rs");u(this,"re");u(this,"initiator");u(this,"crypto");const{crypto:t,protocolName:n,prologue:i,initiator:s,s:o,e:a,rs:c,re:l}=e;this.crypto=t,this.ss=new vye(t,n),this.ss.mixHash(i),this.initiator=s,this.s=o,this.e=a,this.rs=c,this.re=l}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");const e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw new Error("remote static public key is already set");const n=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+n)throw new Error("message is not long enough");const i=e.sublist(t,t+n);return this.rs=this.ss.decryptAndHash(i),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class bV extends bye{writeMessageA(e){return new He(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){const t=this.writeE();this.writeEE();const n=this.writeS();return this.writeES(),new He(t,n,this.ss.encryptAndHash(e))}writeMessageC(e){const t=this.writeS();return this.writeSE(),new He(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(t){throw new l1(`handshake stage 0 validation fail: ${t.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();const t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(t){throw new l1(`handshake stage 1 validation fail: ${t.message}`)}}readMessageC(e){try{const t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(t){throw new l1(`handshake stage 2 validation fail: ${t.message}`)}}}function Eye(r,e){if(e.length<=32){const t=tt(32);return t.set(e),t}else return r.hash(e)}var um;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(const s of t.webtransportCerthashes)n.uint32(10),n.bytes(s);if(t.streamMuxers!=null)for(const s of t.streamMuxers)n.uint32(18),n.string(s);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={webtransportCerthashes:[],streamMuxers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{if(((a=i.limits)==null?void 0:a.webtransportCerthashes)!=null&&s.webtransportCerthashes.length===i.limits.webtransportCerthashes)throw new xt('Decode error - map field "webtransportCerthashes" had too many elements');s.webtransportCerthashes.push(t.bytes());break}case 2:{if(((c=i.limits)==null?void 0:c.streamMuxers)!=null&&s.streamMuxers.length===i.limits.streamMuxers)throw new xt('Decode error - map field "streamMuxers" had too many elements');s.streamMuxers.push(t.string());break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(um||(um={}));var dm;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.identityKey!=null&&t.identityKey.byteLength>0&&(n.uint32(10),n.bytes(t.identityKey)),t.identitySig!=null&&t.identitySig.byteLength>0&&(n.uint32(18),n.bytes(t.identitySig)),t.extensions!=null&&(n.uint32(34),um.codec().encode(t.extensions,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={identityKey:tt(0),identitySig:tt(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.identityKey=t.bytes();break}case 2:{s.identitySig=t.bytes();break}case 4:{s.extensions=um.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.extensions});break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(dm||(dm={}));async function EV(r,e,t){const n=await r.sign(xV(e));return dm.encode({identityKey:Oi(r.publicKey),identitySig:n,extensions:t})}async function SV(r,e,t){try{const n=dm.decode(r),i=Un(n.identityKey);if((t==null?void 0:t.equals(i))===!1)throw new Error(`Payload identity key ${i} does not match expected remote identity key ${t}`);if(!e)throw new Error("Remote static does not exist");const s=xV(e);if(!await i.verify(s,n.identitySig))throw new Error("Invalid payload signature");return n}catch(n){throw new sB(n.message)}}function xV(r){const e=fe("noise-libp2p-static-key:");return r instanceof Uint8Array?ur([e,r],e.length+r.length):(r.prepend(e),r)}async function Sye(r,e){const{log:t,connection:n,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=r,d=await EV(s,a.publicKey,l),h=new bV({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:o,s:a});yV(h.s,t),t.trace("Stage 0 - Initiator starting to send first message."),await n.write(h.writeMessageA(Ed),e),t.trace("Stage 0 - Initiator finished sending first message."),mV(h.e,t),t.trace("Stage 1 - Initiator waiting to receive first message from responder...");const p=h.readMessageB(await n.read(e));t.trace("Stage 1 - Initiator received the message."),wV(h.re,t),pye(h.rs,t),t.trace("Initiator going to check remote's signature...");const w=await SV(p,h.rs,c);t.trace("All good with the signature!"),t.trace("Stage 2 - Initiator sending third handshake message."),await n.write(h.writeMessageC(d),e),t.trace("Stage 2 - Initiator sent message with signed payload.");const[f,g]=h.ss.split();return vV(f,g,t),{payload:w,encrypt:v=>f.encryptWithAd(Ed,v),decrypt:(v,y)=>g.decryptWithAd(Ed,v,y)}}async function xye(r,e){const{log:t,connection:n,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=r,d=await EV(s,a.publicKey,l),h=new bV({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:o,s:a});yV(h.s,t),t.trace("Stage 0 - Responder waiting to receive first message."),h.readMessageA(await n.read(e)),t.trace("Stage 0 - Responder received first message."),wV(h.re,t),t.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(h.writeMessageB(d),e),t.trace("Stage 1 - Responder sent the second handshake message with signed payload."),mV(h.e,t),t.trace("Stage 2 - Responder waiting for third handshake message...");const p=h.readMessageC(await n.read(e));t.trace("Stage 2 - Responder received the message, finished handshake.");const w=await SV(p,h.rs,c),[f,g]=h.ss.split();return vV(f,g,t),{payload:w,encrypt:v=>g.encryptWithAd(Ed,v),decrypt:(v,y)=>f.decryptWithAd(Ed,v,y)}}const _T=16;function Aye(r,e){return async function*(t){for await(const n of t)for(let i=0;i<n.length;i+=wT){let s=i+wT;s>n.length&&(s=n.length);let o;n instanceof Uint8Array?o=r.encrypt(n.subarray(i,s)):o=r.encrypt(n.sublist(i,s)),e==null||e.encryptedPackets.increment(),yield new He(lm(o.byteLength),o)}}}function Iye(r,e){return async function*(t){for await(const n of t)for(let i=0;i<n.length;i+=ip){let s=i+ip;if(s>n.length&&(s=n.length),s-_T<i)throw new Error("Invalid chunk");const o=n.sublist(i,s),a=n.subarray(i,s-_T);try{const c=r.decrypt(o,a);e==null||e.decryptedPackets.increment(),yield c}catch(c){throw e==null||e.decryptErrors.increment(),c}}}}var SN,xN;xN=Symbol.toStringTag,SN=lr;class Cye{constructor(e,t={}){u(this,"protocol","/noise");u(this,"crypto");u(this,"prologue");u(this,"staticKey");u(this,"extensions");u(this,"metrics");u(this,"components");u(this,xN,"@chainsafe/libp2p-noise");u(this,SN,["@libp2p/connection-encryption","@chainsafe/libp2p-noise"]);const{staticNoiseKey:n,extensions:i,crypto:s,prologueBytes:o}=t,{metrics:a}=e;this.components=e;const c=s??dye;this.crypto=hye(c),this.extensions={webtransportCerthashes:[],...i},this.metrics=a?fye(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=o??tt(0)}async secureOutbound(e,t){var a,c;const n=nh(e,{lengthEncoder:lm,lengthDecoder:u2,maxDataLength:ip}),i=await this.performHandshakeInitiator(n,this.components.privateKey,(a=t==null?void 0:t.remotePeer)==null?void 0:a.publicKey,t),s=await this.createSecureConnection(n,i);e.source=s.source,e.sink=s.sink;const o=Un(i.payload.identityKey);return{conn:e,remoteExtensions:i.payload.extensions,remotePeer:Xd(o),streamMuxer:this.getStreamMuxer((c=i.payload.extensions)==null?void 0:c.streamMuxers)}}getStreamMuxer(e){if(e==null)return;const t=this.components.upgrader.getStreamMuxers();if(t!=null)for(const n of e){const i=t.get(n);if(i!=null)return i}if(e.length)throw new QZ("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(e,t){var a,c;const n=nh(e,{lengthEncoder:lm,lengthDecoder:u2,maxDataLength:ip}),i=await this.performHandshakeResponder(n,this.components.privateKey,(a=t==null?void 0:t.remotePeer)==null?void 0:a.publicKey,t),s=await this.createSecureConnection(n,i);e.source=s.source,e.sink=s.sink;const o=Un(i.payload.identityKey);return{conn:e,remoteExtensions:i.payload.extensions,remotePeer:Xd(o),streamMuxer:this.getStreamMuxer((c=i.payload.extensions)==null?void 0:c.streamMuxers)}}async performHandshakeInitiator(e,t,n,i){var o,a;let s;try{s=await Sye({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},i),(o=this.metrics)==null||o.xxHandshakeSuccesses.increment()}catch(c){throw(a=this.metrics)==null||a.xxHandshakeErrors.increment(),c}return s}async performHandshakeResponder(e,t,n,i){var o,a;let s;try{s=await xye({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},i),(o=this.metrics)==null||o.xxHandshakeSuccesses.increment()}catch(c){throw(a=this.metrics)==null||a.xxHandshakeErrors.increment(),c}return s}async createSecureConnection(e,t){const[n,i]=B2e(),s=e.unwrap();return await gn(n,Aye(t,this.metrics),s,o=>Yd(o,{lengthDecoder:u2}),Iye(t,this.metrics),n),i}}function AV(r={}){return e=>new Cye(e,r)}function IV(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}class vl extends Error{constructor(e="The frame was invalid"){super(e),this.name="InvalidFrameError"}}u(vl,"name","InvalidFrameError");class Ex extends Error{constructor(e="Unrequested ping error"){super(e),this.name="UnrequestedPingError"}}u(Ex,"name","UnrequestedPingError");class Sx extends Error{constructor(e="Unrequested ping error"){super(e),this.name="NotMatchingPingError"}}u(Sx,"name","NotMatchingPingError");class CV extends Error{constructor(e="Invalid state"){super(e),this.name="InvalidStateError"}}u(CV,"name","InvalidStateError");class kV extends Error{constructor(e="Strean already exists"){super(e),this.name="StreamAlreadyExistsError"}}u(kV,"name","StreamAlreadyExistsError");class _V extends Error{constructor(e="Decode invalid version"){super(e),this.name="DecodeInvalidVersionError"}}u(_V,"name","DecodeInvalidVersionError");class TV extends Error{constructor(e="Both clients"){super(e),this.name="BothClientsError"}}u(TV,"name","BothClientsError");class xx extends Error{constructor(e="Receive window exceeded"){super(e),this.name="ReceiveWindowExceededError"}}u(xx,"name","ReceiveWindowExceededError");const kye=new Set([vl.name,Ex.name,Sx.name,kV.name,_V.name,TV.name,xx.name]),Ax=256*1024,_ye=16*1024*1024,Tye={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:Ax,maxStreamWindowSize:_ye,maxMessageSize:64*1024};function Pye(r){if(r.keepAliveInterval<=0)throw new ie("keep-alive interval must be positive");if(r.maxInboundStreams<0)throw new ie("max inbound streams must be larger or equal 0");if(r.maxOutboundStreams<0)throw new ie("max outbound streams must be larger or equal 0");if(r.initialStreamWindowSize<Ax)throw new ie("InitialStreamWindowSize must be larger or equal 256 kB");if(r.maxStreamWindowSize<r.initialStreamWindowSize)throw new ie("MaxStreamWindowSize must be larger than the InitialStreamWindowSize");if(r.maxStreamWindowSize>2**32-1)throw new ie("MaxStreamWindowSize must be less than equal MAX_UINT32");if(r.maxMessageSize<1024)throw new ie("MaxMessageSize must be greater than a kilobyte")}var or;(function(r){r[r.Data=0]="Data",r[r.WindowUpdate=1]="WindowUpdate",r[r.Ping=2]="Ping",r[r.GoAway=3]="GoAway"})(or||(or={}));var Gt;(function(r){r[r.SYN=1]="SYN",r[r.ACK=2]="ACK",r[r.FIN=4]="FIN",r[r.RST=8]="RST"})(Gt||(Gt={}));Object.values(Gt).filter(r=>typeof r!="string");const Dye=0;var Ds;(function(r){r[r.NormalTermination=0]="NormalTermination",r[r.ProtocolError=1]="ProtocolError",r[r.InternalError=2]="InternalError"})(Ds||(Ds={}));const u1=12,TT=2**24;function $ye(r){if(r[0]!==Dye)throw new vl("Invalid frame version");return{type:r[1],flag:(r[2]<<8)+r[3],streamID:r[4]*TT+(r[5]<<16)+(r[6]<<8)+r[7],length:r[8]*TT+(r[9]<<16)+(r[10]<<8)+r[11]}}let Nye=class{constructor(e){u(this,"source");u(this,"buffer");u(this,"frameInProgress");this.source=Oye(e),this.buffer=new He,this.frameInProgress=!1}async*emitFrames(){for await(const e of this.source)for(this.buffer.append(e);;){const t=this.readHeader();if(t===void 0)break;const{type:n,length:i}=t;n===or.Data?(this.frameInProgress=!0,yield{header:t,readData:this.readBytes.bind(this,i)}):yield{header:t}}}readHeader(){if(this.frameInProgress)throw new CV("decoding frame already in progress");if(this.buffer.length<u1)return;const e=$ye(this.buffer.subarray(0,u1));return this.buffer.consume(u1),e}async readBytes(e){if(this.buffer.length<e){for await(const n of this.source)if(this.buffer.append(n),this.buffer.length>=e)break}const t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}};function Oye(r){if(r[Symbol.iterator]!==void 0){const e=r[Symbol.iterator]();return e.return=void 0,{[Symbol.iterator](){return e}}}else if(r[Symbol.asyncIterator]!==void 0){const e=r[Symbol.asyncIterator]();return e.return=void 0,{[Symbol.asyncIterator](){return e}}}else throw new Error("a source must be either an iterable or an async iterable")}function PT(r){const e=new Uint8Array(u1);return e[1]=r.type,e[2]=r.flag>>>8,e[3]=r.flag,e[4]=r.streamID>>>24,e[5]=r.streamID>>>16,e[6]=r.streamID>>>8,e[7]=r.streamID,e[8]=r.length>>>24,e[9]=r.length>>>16,e[10]=r.length>>>8,e[11]=r.length,e}function Mye(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function PV(r,e){var n,i;const t=(i=(n=IV(r)).return)==null?void 0:i.call(n);Mye(t)&&t.catch(s=>{e.error("could not cause iterator to return",s)})}const Rye=5e3;function y6(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}class Ix{constructor(e){u(this,"id");u(this,"direction");u(this,"timeline");u(this,"protocol");u(this,"metadata");u(this,"source");u(this,"status");u(this,"readStatus");u(this,"writeStatus");u(this,"log");u(this,"sinkController");u(this,"sinkEnd");u(this,"closed");u(this,"endErr");u(this,"streamSource");u(this,"onEnd");u(this,"onCloseRead");u(this,"onCloseWrite");u(this,"onReset");u(this,"onAbort");u(this,"sendCloseWriteTimeout");u(this,"sendingData");this.sinkController=new AbortController,this.sinkEnd=Ve(),this.closed=Ve(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??Rye,this.onEnd=e.onEnd,this.onCloseRead=e==null?void 0:e.onCloseRead,this.onCloseWrite=e==null?void 0:e.onCloseWrite,this.onReset=e==null?void 0:e.onReset,this.onAbort=e==null?void 0:e.onAbort,this.source=this.streamSource=zo({onEnd:t=>{t!=null?this.log.trace("source ended with error",t):this.log.trace("source ended"),this.onSourceEnd(t)}}),this.sink=this.sink.bind(this)}async sink(e){if(this.writeStatus!=="ready")throw new sy(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";const t={signal:this.sinkController.signal};if(this.direction==="outbound"){const i=this.sendNewStream(t);y6(i)&&await i}const n=()=>{PV(e,this.log)};try{this.sinkController.signal.addEventListener("abort",n),this.log.trace("sink reading from source");for await(let i of e){i=i instanceof Uint8Array?new He(i):i;const s=this.sendData(i,t);y6(s)&&(this.sendingData=Ve(),await s,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",n)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(t){throw this.log.trace("sink ended with error, calling abort with error",t),this.abort(t),t}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){var t;this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(t=this.onCloseRead)==null||t.call(this),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){var t;this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(t=this.onCloseWrite)==null||t.call(this),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.status==="open"&&(this.log.trace("closing gracefully"),this.status="closing",await dn(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e==null?void 0:e.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(e={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const t=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),t==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(e={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),await dn(this.sink([]),e.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&await dn(this.sendingData.promise,e.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await dn(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){var n;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",e),this.log("try to send reset to remote");const t=this.sendReset();y6(t)&&t.catch(i=>{this.log.error("error sending reset message",i)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),(n=this.onAbort)==null||n.call(this,e)}reset(){var t;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;const e=new aB("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),(t=this.onReset)==null||t.call(this)}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}var rs;(function(r){r[r.Init=0]="Init",r[r.SYNSent=1]="SYNSent",r[r.SYNReceived=2]="SYNReceived",r[r.Established=3]="Established",r[r.Finished=4]="Finished"})(rs||(rs={}));class Lye extends Ix{constructor(t){super({...t,onEnd:n=>{var i;this.state=rs.Finished,(i=t.onEnd)==null||i.call(t,n)}});u(this,"name");u(this,"state");u(this,"config");u(this,"_id");u(this,"sendWindowCapacity");u(this,"sendWindowCapacityUpdate");u(this,"recvWindow");u(this,"recvWindowCapacity");u(this,"epochStart");u(this,"getRTT");u(this,"sendFrame");this.config=t.config,this._id=parseInt(t.id,10),this.name=t.name,this.state=t.state,this.sendWindowCapacity=Ax,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=t.getRTT,this.sendFrame=t.sendFrame,this.source=Fy(this.source,()=>{this.sendWindowUpdate()})}async sendNewStream(){}async sendData(t,n={}){var i,s;for(t=t.sublist();t.byteLength!==0;){if(this.sendWindowCapacity===0&&((i=this.log)==null||i.trace("wait for send window capacity, status %s",this.status),await this.waitForSendWindowCapacity(n),this.status==="closed"||this.status==="aborted"||this.status==="reset")){(s=this.log)==null||s.trace("%s while waiting for send window capacity",this.status);return}const o=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-u1,t.length),a=this.getSendFlags();this.sendFrame({type:or.Data,flag:a,streamID:this._id,length:o},t.sublist(0,o)),this.sendWindowCapacity-=o,t.consume(o)}}async sendReset(){this.sendFrame({type:or.WindowUpdate,flag:Gt.RST,streamID:this._id,length:0})}async sendCloseWrite(){const t=this.getSendFlags()|Gt.FIN;this.sendFrame({type:or.WindowUpdate,flag:t,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(t={}){var o,a;if(this.sendWindowCapacity>0)return;let n,i;const s=()=>{this.status==="open"||this.status==="closing"?i(new jl("Stream aborted")):n()};(o=t.signal)==null||o.addEventListener("abort",s);try{await new Promise((c,l)=>{this.sendWindowCapacityUpdate=()=>{c()},i=l,n=c})}finally{(a=t.signal)==null||a.removeEventListener("abort",s)}}handleWindowUpdate(t){var i,s;(i=this.log)==null||i.trace("stream received window update id=%s",this._id),this.processFlags(t.flag);const n=this.sendWindowCapacity;this.sendWindowCapacity+=t.length,n===0&&t.length>0&&((s=this.sendWindowCapacityUpdate)==null||s.call(this))}async handleData(t,n){var s;if((s=this.log)==null||s.trace("stream received data id=%s",this._id),this.processFlags(t.flag),this.recvWindowCapacity<t.length)throw new xx("Receive window exceeded");const i=await n();this.recvWindowCapacity-=t.length,this.sourcePush(i)}processFlags(t){(t&Gt.ACK)===Gt.ACK&&this.state===rs.SYNSent&&(this.state=rs.Established),(t&Gt.FIN)===Gt.FIN&&this.remoteCloseWrite(),(t&Gt.RST)===Gt.RST&&this.reset()}getSendFlags(){switch(this.state){case rs.Init:return this.state=rs.SYNSent,Gt.SYN;case rs.SYNReceived:return this.state=rs.Established,Gt.ACK;default:return 0}}sendWindowUpdate(){const t=this.getSendFlags(),n=Date.now(),i=this.getRTT();if(t===0&&i>-1&&n-this.epochStart<i*4&&(this.recvWindow=Math.min(this.recvWindow*2,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&t===0)return;const s=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=n,this.sendFrame({type:or.WindowUpdate,flag:t,streamID:this._id,length:s})}}const DV="/yamux/1.0.0",Bye=500;var AN,IN;IN=Symbol.toStringTag,AN=lr;class Uye{constructor(e,t={}){u(this,"protocol",DV);u(this,"_components");u(this,"_init");u(this,IN,"@chainsafe/libp2p-yamux");u(this,AN,["@libp2p/stream-multiplexing"]);this._components=e,this._init=t}createStreamMuxer(e){return new Fye(this._components,{...this._init,...e})}}class Fye{constructor(e,t){u(this,"protocol",DV);u(this,"source");u(this,"sink");u(this,"config");u(this,"log");u(this,"logger");u(this,"closeController");u(this,"nextStreamID");u(this,"_streams");u(this,"nextPingID");u(this,"activePing");u(this,"rtt");u(this,"client");u(this,"localGoAway");u(this,"remoteGoAway");u(this,"numInboundStreams");u(this,"numOutboundStreams");u(this,"onIncomingStream");u(this,"onStreamEnd");var n;this.client=t.direction==="outbound",this.config={...Tye,...t},this.logger=e.logger,this.log=this.logger.forComponent("libp2p:yamux"),Pye(this.config),this.closeController=new AbortController,this.closeController.signal,this.onIncomingStream=t.onIncomingStream,this.onStreamEnd=t.onStreamEnd,this._streams=new Map,this.source=zo({onEnd:()=>{var i;(i=this.log)==null||i.trace("muxer source ended"),this._streams.forEach(s=>{s.destroy()})}}),this.sink=async i=>{var c,l,d;const s=()=>{const h=IV(i);if(h.return!=null){const p=h.return();zye(p)&&p.catch(w=>{var f;(f=this.log)==null||f.call(this,"could not cause sink source to return",w)})}};let o,a;try{const h=new Nye(i);try{this.closeController.signal.addEventListener("abort",s);for await(const p of h.emitFrames())await this.handleFrame(p.header,p.readData)}finally{this.closeController.signal.removeEventListener("abort",s)}o=Ds.NormalTermination}catch(h){kye.has(h.name)?((c=this.log)==null||c.error("protocol error in sink",h),o=Ds.ProtocolError):((l=this.log)==null||l.error("internal error in sink",h),o=Ds.InternalError),a=h}(d=this.log)==null||d.trace("muxer sink ended"),a!=null?this.abort(a,o):await this.close({reason:o})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,(n=this.log)==null||n.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("keepalive error: %s",i)}),this.ping().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("ping error: %s",i)})}get streams(){return Array.from(this._streams.values())}newStream(e){var i;if(this.remoteGoAway!==void 0)throw new cl("Muxer closed remotely");if(this.localGoAway!==void 0)throw new cl("Muxer closed locally");const t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new rw("max outbound streams exceeded");(i=this.log)==null||i.trace("new outgoing stream id=%s",t);const n=this._newStream(t,e,rs.Init,"outbound");return this._streams.set(t,n),this.numOutboundStreams++,n.sendWindowUpdate(),n}async ping(){if(this.remoteGoAway!==void 0)throw new cl("Muxer closed remotely");if(this.localGoAway!==void 0)throw new cl("Muxer closed locally");if(this.activePing===void 0){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((i,s)=>{const o=()=>{s(new cl("Muxer closed locally"))};this.closeController.signal.addEventListener("abort",o,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",o),i()}}),resolve:e};const t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const n=Date.now();this.rtt=n-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(e={}){var n;if(this.closeController.signal.aborted)return;const t=(e==null?void 0:e.reason)??Ds.NormalTermination;if((n=this.log)==null||n.trace("muxer close reason=%s",t),e.signal==null){const i=AbortSignal.timeout(Bye);e={...e,signal:i}}try{await Promise.all([...this._streams.values()].map(async i=>i.close(e))),this.sendGoAway(t),this._closeMuxer()}catch(i){this.abort(i)}}abort(e,t){var n;if(!this.closeController.signal.aborted){t=t??Ds.InternalError,(n=this.log)==null||n.error("muxer abort reason=%s error=%s",t,e);for(const i of this._streams.values())i.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,n,i){if(this._streams.get(e)!=null)throw new ie("Stream already exists with that id");const s=new Lye({id:e.toString(),name:t,state:n,direction:i,sendFrame:this.sendFrame.bind(this),onEnd:()=>{var o;this.closeStream(e),(o=this.onStreamEnd)==null||o.call(this,s)},log:this.logger.forComponent(`libp2p:yamux:${i}:${e}`),config:this.config,getRTT:this.getRTT.bind(this)});return s}closeStream(e){this.client===(e%2===0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){var t;const e=new Promise((n,i)=>{this.closeController.signal.addEventListener("abort",i,{once:!0})});for((t=this.log)==null||t.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let n;try{await Promise.race([e,new Promise(i=>{n=setTimeout(i,this.config.keepAliveInterval)})]),this.ping().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("ping error: %s",i)})}catch{clearInterval(n);return}}}async handleFrame(e,t){var o;const{streamID:n,type:i,length:s}=e;if((o=this.log)==null||o.trace("received frame %o",e),n===0)switch(i){case or.Ping:{this.handlePing(e);return}case or.GoAway:{this.handleGoAway(s);return}default:throw new vl("Invalid frame type")}else switch(e.type){case or.Data:case or.WindowUpdate:{await this.handleStreamMessage(e,t);return}default:throw new vl("Invalid frame type")}}handlePing(e){var t,n;if(e.flag===Gt.SYN)(t=this.log)==null||t.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,Gt.ACK);else if(e.flag===Gt.ACK)(n=this.log)==null||n.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length);else throw new vl("Invalid frame flag")}handlePingResponse(e){if(this.activePing===void 0)throw new Ex("ping not requested");if(this.activePing.id!==e)throw new Sx("ping doesn't match our id");this.activePing.resolve()}handleGoAway(e){var t;(t=this.log)==null||t.trace("received GoAway reason=%s",Ds[e]??"unknown"),this.remoteGoAway=e;for(const n of this._streams.values())n.reset();this._closeMuxer()}async handleStreamMessage(e,t){var a,c;const{streamID:n,flag:i,type:s}=e;(i&Gt.SYN)===Gt.SYN&&this.incomingStream(n);const o=this._streams.get(n);if(o===void 0){if(s===or.Data){if((a=this.log)==null||a.call(this,"discarding data for stream id=%s",n),t===void 0)throw new Error("unreachable");await t()}else(c=this.log)==null||c.trace("frame for missing stream id=%s",n);return}switch(s){case or.WindowUpdate:{o.handleWindowUpdate(e);return}case or.Data:{if(t===void 0)throw new Error("unreachable");await o.handleData(e,t);return}default:throw new Error("unreachable")}}incomingStream(e){var n,i,s;if(this.client!==(e%2===0))throw new ie("Both endpoints are clients");if(this._streams.has(e))return;if((n=this.log)==null||n.trace("new incoming stream id=%s",e),this.localGoAway!==void 0){this.sendFrame({type:or.WindowUpdate,flag:Gt.RST,streamID:e,length:0});return}if(this.numInboundStreams>=this.config.maxInboundStreams){(i=this.log)==null||i.call(this,"maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:or.WindowUpdate,flag:Gt.RST,streamID:e,length:0});return}const t=this._newStream(e,void 0,rs.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),(s=this.onIncomingStream)==null||s.call(this,t)}sendFrame(e,t){var n;if((n=this.log)==null||n.trace("sending frame %o",e),e.type===or.Data){if(t===void 0)throw new vl("Invalid frame");this.source.push(new He(PT(e),t))}else this.source.push(PT(e))}sendPing(e,t=Gt.SYN){var n,i;t===Gt.SYN?(n=this.log)==null||n.trace("sending ping request pingId=%s",e):(i=this.log)==null||i.trace("sending ping response pingId=%s",e),this.sendFrame({type:or.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=Ds.NormalTermination){var t;(t=this.log)==null||t.call(this,"sending GoAway reason=%s",Ds[e]),this.localGoAway=e,this.sendFrame({type:or.GoAway,flag:0,streamID:0,length:e})}}function zye(r){return r!=null&&typeof r.then=="function"}function Vye(r={}){return e=>new Uye(e,r)}const Kye=41;function $V(r){try{const[[e,t]]=r.stringTuples();if(t==null)return!1;if(e===Kye)return ofe("2000::/3",t)}catch{}return!1}const Hye=4,jye=41;function NV(r){try{const[[e]]=r.stringTuples();return e===Hye||e===jye}catch{}return!1}function Tc(r){try{if(!NV(r))return!1;const[[,e]]=r.stringTuples();return e==null?!1:Vc(e)??!1}catch{}return!0}function qye(r,e,t){let n,i;function s(){const a={signal:i.signal};if((t==null?void 0:t.timeout)!=null){const c=bt([i.signal,AbortSignal.timeout(t.timeout)]);a.signal=c}Promise.resolve().then(async()=>{await r(a)}).catch(()=>{}).finally(()=>{i.signal.aborted||(n=setTimeout(s,e))})}let o=!1;return{setInterval:a=>{e=a,n!=null&&(clearTimeout(n),n=setTimeout(s,e))},setTimeout:a=>{t==null&&(t={}),t.timeout=a},start:()=>{o||(o=!0,i=new AbortController,i.signal,(t==null?void 0:t.runImmediately)===!0?queueMicrotask(()=>{s()}):n=setTimeout(s,e))},stop:()=>{clearTimeout(n),i==null||i.abort(),o=!1}}}function si(r,e){const t=nh(r,e),n={read:async(i,s)=>{const o=await t.read(s);return i.decode(o)},write:async(i,s,o)=>{await t.write(s.encode(i),o)},writeV:async(i,s,o)=>{await t.writeV(i.map(a=>s.encode(a)),o)},pb:i=>({read:async s=>n.read(i,s),write:async(s,o)=>n.write(s,i,o),writeV:async(s,o)=>n.writeV(s,i,o),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}function Wye(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var Gye=OV,DT=128,Qye=-128,Yye=Math.pow(2,31);function OV(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Yye;)e[t++]=r&255|DT,r/=128;for(;r&Qye;)e[t++]=r&255|DT,r>>>=7;return e[t]=r|0,OV.bytes=t-n+1,e}var Xye=Nb,Jye=128,$T=127;function Nb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Nb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&$T)<<i:(o&$T)*Math.pow(2,i),i+=7}while(o>=Jye);return Nb.bytes=s-n,t}var Zye=Math.pow(2,7),eme=Math.pow(2,14),tme=Math.pow(2,21),rme=Math.pow(2,28),nme=Math.pow(2,35),ime=Math.pow(2,42),sme=Math.pow(2,49),ome=Math.pow(2,56),ame=Math.pow(2,63),cme=function(r){return r<Zye?1:r<eme?2:r<tme?3:r<rme?4:r<nme?5:r<ime?6:r<sme?7:r<ome?8:r<ame?9:10},lme={encode:Gye,decode:Xye,encodingLength:cme},NT=lme;function OT(r,e=0){return[NT.decode(r,e),NT.decode.bytes]}function ume(r){const e=Wye(r),[t,n]=OT(e),[i,s]=OT(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new dme(t,i,o,e)}let dme=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};const hme="libp2p",fme="autonat",pme="1.0.0",gme=3e4,yme=2,mme=20,wme=80,vme=8192;var Bt;(function(r){(function(i){i.DIAL="DIAL",i.DIAL_RESPONSE="DIAL_RESPONSE"})(r.MessageType||(r.MessageType={}));let e;(function(i){i[i.DIAL=0]="DIAL",i[i.DIAL_RESPONSE=1]="DIAL_RESPONSE"})(e||(e={})),function(i){i.codec=()=>Bn(e)}(r.MessageType||(r.MessageType={})),function(i){i.OK="OK",i.E_DIAL_ERROR="E_DIAL_ERROR",i.E_DIAL_REFUSED="E_DIAL_REFUSED",i.E_BAD_REQUEST="E_BAD_REQUEST",i.E_INTERNAL_ERROR="E_INTERNAL_ERROR"}(r.ResponseStatus||(r.ResponseStatus={}));let t;(function(i){i[i.OK=0]="OK",i[i.E_DIAL_ERROR=100]="E_DIAL_ERROR",i[i.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",i[i.E_BAD_REQUEST=200]="E_BAD_REQUEST",i[i.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"})(t||(t={})),function(i){i.codec=()=>Bn(t)}(r.ResponseStatus||(r.ResponseStatus={})),function(i){let s;i.codec=()=>(s==null&&(s=Be((o,a,c={})=>{if(c.lengthDelimited!==!1&&a.fork(),o.id!=null&&(a.uint32(10),a.bytes(o.id)),o.addrs!=null)for(const l of o.addrs)a.uint32(18),a.bytes(l);c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{var h;const l={addrs:[]},d=a==null?o.len:o.pos+a;for(;o.pos<d;){const p=o.uint32();switch(p>>>3){case 1:{l.id=o.bytes();break}case 2:{if(((h=c.limits)==null?void 0:h.addrs)!=null&&l.addrs.length===c.limits.addrs)throw new xt('Decode error - map field "addrs" had too many elements');l.addrs.push(o.bytes());break}default:{o.skipType(p&7);break}}}return l})),s),i.encode=o=>Le(o,i.codec()),i.decode=(o,a)=>Re(o,i.codec(),a)}(r.PeerInfo||(r.PeerInfo={})),function(i){let s;i.codec=()=>(s==null&&(s=Be((o,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),o.peer!=null&&(a.uint32(10),r.PeerInfo.codec().encode(o.peer,a)),c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{var h;const l={},d=a==null?o.len:o.pos+a;for(;o.pos<d;){const p=o.uint32();switch(p>>>3){case 1:{l.peer=r.PeerInfo.codec().decode(o,o.uint32(),{limits:(h=c.limits)==null?void 0:h.peer});break}default:{o.skipType(p&7);break}}}return l})),s),i.encode=o=>Le(o,i.codec()),i.decode=(o,a)=>Re(o,i.codec(),a)}(r.Dial||(r.Dial={})),function(i){let s;i.codec=()=>(s==null&&(s=Be((o,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),o.status!=null&&(a.uint32(8),r.ResponseStatus.codec().encode(o.status,a)),o.statusText!=null&&(a.uint32(18),a.string(o.statusText)),o.addr!=null&&(a.uint32(26),a.bytes(o.addr)),c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{const l={},d=a==null?o.len:o.pos+a;for(;o.pos<d;){const h=o.uint32();switch(h>>>3){case 1:{l.status=r.ResponseStatus.codec().decode(o);break}case 2:{l.statusText=o.string();break}case 3:{l.addr=o.bytes();break}default:{o.skipType(h&7);break}}}return l})),s),i.encode=o=>Le(o,i.codec()),i.decode=(o,a)=>Re(o,i.codec(),a)}(r.DialResponse||(r.DialResponse={}));let n;r.codec=()=>(n==null&&(n=Be((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.type!=null&&(s.uint32(8),r.MessageType.codec().encode(i.type,s)),i.dial!=null&&(s.uint32(18),r.Dial.codec().encode(i.dial,s)),i.dialResponse!=null&&(s.uint32(26),r.DialResponse.codec().encode(i.dialResponse,s)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l,d;const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const h=i.uint32();switch(h>>>3){case 1:{a.type=r.MessageType.codec().decode(i);break}case 2:{a.dial=r.Dial.codec().decode(i,i.uint32(),{limits:(l=o.limits)==null?void 0:l.dial});break}case 3:{a.dialResponse=r.DialResponse.codec().decode(i,i.uint32(),{limits:(d=o.limits)==null?void 0:d.dialResponse});break}default:{i.skipType(h&7);break}}}return a})),n),r.encode=i=>Le(i,r.codec()),r.decode=(i,s)=>Re(i,r.codec(),s)})(Bt||(Bt={}));const bme=4,Eme=8;var CN,kN;class Sme{constructor(e,t){u(this,"components");u(this,"protocol");u(this,"timeout");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"maxMessageSize");u(this,"started");u(this,"log");u(this,"topologyId");u(this,"dialResults");u(this,"findPeers");u(this,"addressFilter");u(this,"connectionThreshold");u(this,kN,"@libp2p/autonat");u(this,CN,["@libp2p/autonat"]);this.components=e,this.log=e.logger.forComponent("libp2p:auto-nat"),this.started=!1,this.protocol=`/${t.protocolPrefix??hme}/${fme}/${pme}`,this.timeout=t.timeout??gme,this.maxInboundStreams=t.maxInboundStreams??yme,this.maxOutboundStreams=t.maxOutboundStreams??mme,this.connectionThreshold=t.connectionThreshold??wme,this.maxMessageSize=t.maxMessageSize??vme,this.dialResults=new Map,this.findPeers=qye(this.findRandomPeers.bind(this),6e4),this.addressFilter=Ql(1024)}get[(kN=Symbol.toStringTag,CN=lr,Sc)](){return["@libp2p/identify"]}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,e=>{this.handleIncomingAutonatStream(e).catch(t=>{this.log.error("error handling incoming autonat stream - %e",t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.topologyId=await this.components.registrar.register(this.protocol,{onConnect:(e,t)=>{this.verifyExternalAddresses(t).catch(n=>{this.log.error("could not verify addresses - %e",n)})}}),this.findPeers.start(),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),this.topologyId!=null&&await this.components.registrar.unhandle(this.topologyId),this.dialResults.clear(),this.findPeers.stop(),this.started=!1}allAddressesAreVerified(){return this.components.addressManager.getAddressesWithMetadata().every(e=>e.expires>Date.now()?!0:e.verified)}async findRandomPeers(e){if(this.allAddressesAreVerified())return;const t=bt([AbortSignal.timeout(1e4),e==null?void 0:e.signal]);try{this.log("starting random walk to find peers to run AutoNAT");for await(const n of this.components.randomWalk.walk({signal:t})){if(!await this.components.connectionManager.isDialable(n.multiaddrs)){this.log.trace("random peer %p was not dialable %s",n.id,n.multiaddrs.map(i=>i.toString()).join(", "));continue}try{this.log.trace("dial random peer %p",n.id),await this.components.connectionManager.openConnection(n.multiaddrs,{signal:t})}catch{}if(this.allAddressesAreVerified()){this.log("stopping random walk, all addresses are verified");return}if(!this.hasConnectionCapacity()){this.log("stopping random walk, too close to max connections");return}}}catch{}}async handleIncomingAutonatStream(e){const t=AbortSignal.timeout(this.timeout),n=si(e.stream,{maxDataLength:this.maxMessageSize}).pb(Bt);try{const i=await n.read({signal:t}),s=await this.handleAutonatMessage(i,e.connection,{signal:t});await n.write(s,{signal:t}),await n.unwrap().unwrap().close({signal:t})}catch(i){this.log.error("error handling incoming autonat stream - %e",i),e.stream.abort(i)}}async handleAutonatMessage(e,t,n){const i=this.components.addressManager.getAddresses().map(h=>h.toOptions().host),s=e.dial;if(s==null)return this.log.error("dial was missing from message"),{type:Bt.MessageType.DIAL_RESPONSE,dialResponse:{status:Bt.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}};let o;const a=s.peer;if((a==null?void 0:a.id)==null)return this.log.error("PeerId missing from message"),{type:Bt.MessageType.DIAL_RESPONSE,dialResponse:{status:Bt.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}};try{const h=ume(a.id);o=li(h)}catch(h){return this.log.error("invalid PeerId - %e",h),{type:Bt.MessageType.DIAL_RESPONSE,dialResponse:{status:Bt.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}}if(this.log("incoming request from %p",o),!t.remotePeer.equals(o))return this.log("target peer %p did not equal sending peer %p",o,t.remotePeer),{type:Bt.MessageType.DIAL_RESPONSE,dialResponse:{status:Bt.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}};const c=a.addrs.map(h=>Fe(h)).filter(h=>{const p=h.toOptions();return Tc(h)?!1:p.host!==t.remoteAddr.toOptions().host?(this.log.trace("not dialing %a - target host did not match remote host %a",h,t.remoteAddr),!1):i.includes(p.host)?!1:this.components.transportManager.dialTransportForMultiaddr(h)==null?(this.log.trace("not dialing %a - transport unsupported",h),!1):!0}).map(h=>(h.getPeerId()==null&&(h=h.encapsulate(`/p2p/${o.toString()}`)),h));if(c.length===0)return this.log("refused to dial all multiaddrs for %p from message",o),{type:Bt.MessageType.DIAL_RESPONSE,dialResponse:{status:Bt.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}};this.log("dial multiaddrs %s for peer %p",c.map(h=>h.toString()).join(", "),o);let l="",d=c[0];for await(const h of c){let p;d=h;try{if(p=await this.components.connectionManager.openConnection(h,n),!p.remoteAddr.equals(h))throw this.log.error("tried to dial %a but dialed %a",h,p.remoteAddr),new Error("Unexpected remote address");return this.log("successfully dialed %p via %a",o,h),{type:Bt.MessageType.DIAL_RESPONSE,dialResponse:{status:Bt.ResponseStatus.OK,addr:p.remoteAddr.decapsulateCode(qe("p2p").code).bytes}}}catch(w){this.log.error("could not dial %p - %e",o,w),l=w.message}finally{p!=null&&await p.close()}}return{type:Bt.MessageType.DIAL_RESPONSE,dialResponse:{status:Bt.ResponseStatus.E_DIAL_ERROR,statusText:l,addr:d.bytes}}}getFirstUnverifiedMultiaddr(e,t){var i,s;const n=this.components.addressManager.getAddressesWithMetadata().sort((o,a)=>o.type==="observed"&&a.type!=="observed"?1:a.type==="observed"&&o.type!=="observed"?-1:0).filter(o=>!(!(o.expires<Date.now())||o.multiaddr.toOptions().family===6&&(!t||!$V(o.multiaddr))||Tc(o.multiaddr)));for(const o of n){const a=o.multiaddr.toString();let c=this.dialResults.get(a);if(c!=null){if(c.networkSegments.includes(e)){this.log.trace("%a already has a network segment result from %s",c.multiaddr,e);continue}if(c.queue.size>10){this.log.trace("%a already has enough peers queued",c.multiaddr);continue}}if(c==null){const l=o.expires<Date.now();if(l&&((s=(i=this.addressFilter).remove)==null||s.call(i,a)),this.addressFilter.has(a))continue;this.addressFilter.add(a),this.log.trace("creating dial result %s %s",l?"to revalidate":"for",a),c={multiaddr:o.multiaddr,success:0,failure:0,networkSegments:[],verifyingPeers:tae(),queue:new Ic({concurrency:3,maxSize:50}),type:o.type,lastVerified:o.lastVerified},this.dialResults.set(a,c)}return c}}removeOutdatedMultiaddrResults(){const e=new Set(this.components.addressManager.getAddressesWithMetadata().filter(({expires:t})=>t<Date.now()).map(({multiaddr:t})=>t.toString()));for(const t of this.dialResults.keys())e.has(t)||(this.log.trace("remove results for %a",t),this.dialResults.delete(t))}async verifyExternalAddresses(e){if(!this.isStarted())return;this.removeOutdatedMultiaddrResults();const n=(await this.components.peerStore.get(e.remotePeer)).addresses.some(({multiaddr:o})=>o.toOptions().family===6),i=this.getNetworkSegment(e.remoteAddr),s=this.getFirstUnverifiedMultiaddr(i,n);if(s==null){this.log.trace("no unverified public addresses found for peer %p to verify, not requesting verification",e.remotePeer);return}if(!this.hasConnectionCapacity()){s.lastVerified!=null?(this.log("automatically re-verifying %a because we are too close to the connection limit",s.multiaddr),this.confirmAddress(s)):this.log("skipping verifying %a because we are too close to the connection limit",s.multiaddr);return}s.queue.add(async o=>{await this.askPeerToVerify(e,i,o)},{peerId:e.remotePeer,multiaddr:s.multiaddr}).catch(o=>{(s==null?void 0:s.result)==null&&this.log.error("error from %p verifying address %a - %e",e.remotePeer,s==null?void 0:s.multiaddr,o)})}async askPeerToVerify(e,t,n){let i=this.dialResults.get(n.multiaddr.toString());if(i==null){this.log("%a was verified while %p was queued",n.multiaddr,e.remotePeer);return}const s=AbortSignal.timeout(this.timeout);this.log.trace("asking %p to verify multiaddr %s",e.remotePeer,n.multiaddr);const o=await e.newStream(this.protocol,{signal:s});try{const a=si(o).pb(Bt),[,c]=await Promise.all([a.write({type:Bt.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toMultihash().bytes,addrs:[n.multiaddr.bytes]}}},{signal:s}),a.read({signal:s})]);if(c.type!==Bt.MessageType.DIAL_RESPONSE||c.dialResponse==null){this.log("invalid autonat response from %p - %j",e.remotePeer,c);return}const l=c.dialResponse.status;if(this.log.trace("autonat response from %p for %a is %s",e.remotePeer,n.multiaddr,l),l!==Bt.ResponseStatus.OK&&l!==Bt.ResponseStatus.E_DIAL_ERROR)return;if(i=this.dialResults.get(n.multiaddr.toString()),i==null){this.log.trace("peer reported %a as %s but there is no result object",n.multiaddr,c.dialResponse.status);return}if(i.networkSegments.includes(t)){this.log.trace("%a results included network segment %s",n.multiaddr,t);return}if(i.result!=null){this.log.trace("already resolved result for %a, ignoring response from",n.multiaddr,e.remotePeer);return}if(i.verifyingPeers.has(e.remotePeer)){this.log.trace("peer %p has already verified %a, ignoring response",e.remotePeer,n.multiaddr);return}if(i.verifyingPeers.add(e.remotePeer),i.networkSegments.push(t),l===Bt.ResponseStatus.OK){if(i.success++,i.type!=="observed"){this.confirmAddress(i);return}}else l===Bt.ResponseStatus.E_DIAL_ERROR&&i.failure++;this.log("%a success %d failure %d",i.multiaddr,i.success,i.failure),i.success===bme&&this.confirmAddress(i),i.failure===Eme&&this.unconfirmAddress(i)}finally{try{await o.close({signal:s})}catch(a){o.abort(a)}}}hasConnectionCapacity(){const t=this.components.connectionManager.getConnections().length,n=this.components.connectionManager.getMaxConnections();return t/n*100<this.connectionThreshold}confirmAddress(e){this.log("%s address %a is externally dialable",e.type,e.multiaddr),this.components.addressManager.confirmObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!0,e.queue.abort()}unconfirmAddress(e){this.log("%s address %a is not externally dialable",e.type,e.multiaddr),this.components.addressManager.removeObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!1,e.queue.abort()}getNetworkSegment(e){const t=e.toOptions();return t.family===4?t.host.split(".")[0].padStart(3,"0"):t.host.split(":")[0].padStart(4,"0")}}function xme(r={}){return e=>new Sme(e,r)}const Ame=be("dns4"),Ime=be("dns6"),Cme=be("dnsaddr"),Zl=rr(be("dns"),Cme,Ame,Ime),Uw=rr(be("ip4"),be("ip6")),sh=rr(Oe(Uw,be("tcp")),Oe(Zl,be("tcp"))),Fw=Oe(Uw,be("udp")),kme=Oe(Fw,be("utp")),_me=Oe(Fw,be("quic")),Tme=Oe(Fw,be("quic-v1")),Ob=rr(Oe(sh,be("ws")),Oe(Zl,be("ws"))),hm=rr(Oe(Ob,be("p2p")),Ob),Mb=rr(Oe(sh,be("wss")),Oe(Zl,be("wss")),Oe(sh,be("tls"),be("ws")),Oe(Zl,be("tls"),be("ws"))),fm=rr(Oe(Mb,be("p2p")),Mb),Rb=rr(Oe(sh,be("http")),Oe(Uw,be("http")),Oe(Zl,be("http"))),Lb=rr(Oe(sh,be("https")),Oe(Uw,be("https")),Oe(Zl,be("https"))),MT=Oe(Fw,be("webrtc-direct"),be("certhash")),MV=rr(Oe(MT,be("p2p")),MT),RT=Oe(Tme,be("webtransport"),be("certhash"),be("certhash")),RV=rr(Oe(RT,be("p2p")),RT),LV=rr(Oe(hm,be("p2p-webrtc-star"),be("p2p")),Oe(fm,be("p2p-webrtc-star"),be("p2p")),Oe(hm,be("p2p-webrtc-star")),Oe(fm,be("p2p-webrtc-star")));rr(Oe(hm,be("p2p-websocket-star"),be("p2p")),Oe(fm,be("p2p-websocket-star"),be("p2p")),Oe(hm,be("p2p-websocket-star")),Oe(fm,be("p2p-websocket-star")));const BV=rr(Oe(Rb,be("p2p-webrtc-direct"),be("p2p")),Oe(Lb,be("p2p-webrtc-direct"),be("p2p")),Oe(Rb,be("p2p-webrtc-direct")),Oe(Lb,be("p2p-webrtc-direct"))),eu=rr(Ob,Mb,Rb,Lb,LV,BV,sh,kme,_me,Zl,MV,RV);rr(Oe(eu,be("p2p-stardust"),be("p2p")),Oe(eu,be("p2p-stardust")));const Xa=rr(Oe(eu,be("p2p")),LV,BV,MV,RV,be("p2p")),LT=rr(Oe(Xa,be("p2p-circuit"),Xa),Oe(Xa,be("p2p-circuit")),Oe(be("p2p-circuit"),Xa),Oe(eu,be("p2p-circuit")),Oe(be("p2p-circuit"),eu),be("p2p-circuit")),UV=()=>rr(Oe(LT,UV),LT),dl=UV(),Pme=rr(Oe(dl,Xa,dl),Oe(Xa,dl),Oe(dl,Xa),dl,Xa);rr(Oe(dl,be("webrtc"),be("p2p")),Oe(dl,be("webrtc")),Oe(eu,be("webrtc"),be("p2p")),Oe(eu,be("webrtc")),be("webrtc"));function FV(r){function e(t){let n;try{n=Fe(t)}catch{return!1}const i=r(n.protoNames());return i===null?!1:i===!0||i===!1?i:i.length===0}return e}function Oe(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(i=>(n=typeof i=="function"?i().partialMatch(t):i.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:FV(e),partialMatch:e}}function rr(...r){function e(n){let i=null;return r.some(s=>{const o=typeof s=="function"?s().partialMatch(n):s.partialMatch(n);return o!=null?(i=o,!0):!1}),i}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:FV(e),partialMatch:e}}function be(r){const e=r;function t(i){let s;try{s=Fe(i)}catch{return!1}const o=s.protoNames();return o.length===1&&o[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}const Dme="bootstrap",$me=50,Nme=1e3;var _N,TN,PN,DN;class zV extends(DN=tr,PN=z1,TN=Symbol.toStringTag,_N=lr,DN){constructor(t,n={list:[]}){if(n.list==null||n.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super();u(this,"log");u(this,"timer");u(this,"list");u(this,"timeout");u(this,"components");u(this,"_init");u(this,PN,this);u(this,TN,"@libp2p/bootstrap");u(this,_N,["@libp2p/peer-discovery"]);this.components=t,this.log=t.logger.forComponent("libp2p:bootstrap"),this.timeout=n.timeout??Nme,this.list=[];for(const i of n.list){if(!Pme.matches(i)){this.log.error("Invalid multiaddr");continue}const s=Fe(i),o=s.getPeerId();if(o==null){this.log.error("Invalid bootstrap multiaddr without peer id");continue}const a={id:Zt(o),multiaddrs:[s]};this.list.push(a)}this._init=n}isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(t=>{this.log.error(t)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(const t of this.list){if(await this.components.peerStore.merge(t.id,{tags:{[this._init.tagName??Dme]:{value:this._init.tagValue??$me,ttl:this._init.tagTTL}},multiaddrs:t.multiaddrs}),this.timer==null)return;this.safeDispatchEvent("peer",{detail:t}),this.components.connectionManager.openConnection(t.id).catch(n=>{this.log.error("could not dial bootstrap peer %p",t.id,n)})}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}}u(zV,"tag","bootstrap");function VV(r){return e=>new zV(e,r)}var pm;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(n.uint32(26),n.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={publicKey:tt(0),payloadType:tt(0),payload:tt(0),signature:tt(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.publicKey=t.bytes();break}case 2:{s.payloadType=t.bytes();break}case 3:{s.payload=t.bytes();break}case 5:{s.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(pm||(pm={}));class Ome extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}}const Ba=class Ba{constructor(e){u(this,"publicKey");u(this,"payloadType");u(this,"payload");u(this,"signature");u(this,"marshaled");const{publicKey:t,payloadType:n,payload:i,signature:s}=e;this.publicKey=t,this.payloadType=n,this.payload=i,this.signature=s}marshal(){return this.marshaled==null&&(this.marshaled=pm.encode({publicKey:Oi(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return Xe(this.marshal(),e.marshal())}async validate(e){const t=BT(e,this.payloadType,this.payload);return this.publicKey.verify(t.subarray(),this.signature)}};u(Ba,"createFromProtobuf",async e=>{const t=pm.decode(e),n=Un(t.publicKey);return new Ba({publicKey:n,payloadType:t.payloadType,payload:t.payload,signature:t.signature})}),u(Ba,"seal",async(e,t)=>{if(t==null)throw new Error("Missing private key");const n=e.domain,i=e.codec,s=e.marshal(),o=BT(n,i,s),a=await t.sign(o.subarray());return new Ba({publicKey:t.publicKey,payloadType:i,payload:s,signature:a})}),u(Ba,"openAndCertify",async(e,t)=>{const n=await Ba.createFromProtobuf(e);if(!await n.validate(t))throw new Ome("Envelope signature is not valid for the given domain");return n});let Pc=Ba;const BT=(r,e,t)=>{const n=fe(r),i=kr(n.byteLength),s=kr(e.length),o=kr(t.length);return new He(i,n,s,e,o,t)};function Mme(r,e){const t=(n,i)=>n.toString().localeCompare(i.toString());return r.length!==e.length?!1:(e.sort(t),r.sort(t).every((n,i)=>e[i].equals(n)))}function Rme(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var Lme=KV,UT=128,Bme=-128,Ume=Math.pow(2,31);function KV(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Ume;)e[t++]=r&255|UT,r/=128;for(;r&Bme;)e[t++]=r&255|UT,r>>>=7;return e[t]=r|0,KV.bytes=t-n+1,e}var Fme=Bb,zme=128,FT=127;function Bb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Bb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&FT)<<i:(o&FT)*Math.pow(2,i),i+=7}while(o>=zme);return Bb.bytes=s-n,t}var Vme=Math.pow(2,7),Kme=Math.pow(2,14),Hme=Math.pow(2,21),jme=Math.pow(2,28),qme=Math.pow(2,35),Wme=Math.pow(2,42),Gme=Math.pow(2,49),Qme=Math.pow(2,56),Yme=Math.pow(2,63),Xme=function(r){return r<Vme?1:r<Kme?2:r<Hme?3:r<jme?4:r<qme?5:r<Wme?6:r<Gme?7:r<Qme?8:r<Yme?9:10},Jme={encode:Lme,decode:Fme,encodingLength:Xme},zT=Jme;function VT(r,e=0){return[zT.decode(r,e),zT.decode.bytes]}function Zme(r){const e=Rme(r),[t,n]=VT(e),[i,s]=VT(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new e3e(t,i,o,e)}let e3e=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};const t3e="libp2p-peer-record",r3e=Uint8Array.from([3,1]);var gm;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=Be((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.multiaddr!=null&&i.multiaddr.byteLength>0&&(s.uint32(10),s.bytes(i.multiaddr)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={multiaddr:tt(0)},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.multiaddr=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>Le(i,t.codec()),t.decode=(i,s)=>Re(i,t.codec(),s)})(r.AddressInfo||(r.AddressInfo={}));let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.peerId!=null&&t.peerId.byteLength>0&&(n.uint32(10),n.bytes(t.peerId)),t.seq!=null&&t.seq!==0n&&(n.uint32(16),n.uint64(t.seq)),t.addresses!=null)for(const s of t.addresses)n.uint32(26),r.AddressInfo.codec().encode(s,n);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={peerId:tt(0),seq:0n,addresses:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.peerId=t.bytes();break}case 2:{s.seq=t.uint64();break}case 3:{if(((a=i.limits)==null?void 0:a.addresses)!=null&&s.addresses.length===i.limits.addresses)throw new xt('Decode error - map field "addresses" had too many elements');s.addresses.push(r.AddressInfo.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.addresses$}));break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(gm||(gm={}));const yo=class yo{constructor(e){u(this,"peerId");u(this,"multiaddrs");u(this,"seqNumber");u(this,"domain",yo.DOMAIN);u(this,"codec",yo.CODEC);u(this,"marshaled");const{peerId:t,multiaddrs:n,seqNumber:i}=e;this.peerId=t,this.multiaddrs=n??[],this.seqNumber=i??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=gm.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof yo)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!Mme(this.multiaddrs,e.multiaddrs))}};u(yo,"createFromProtobuf",e=>{const t=gm.decode(e),n=li(Zme(t.peerId)),i=(t.addresses??[]).map(o=>Fe(o.multiaddr)),s=t.seq;return new yo({peerId:n,multiaddrs:i,seqNumber:s})}),u(yo,"DOMAIN",t3e),u(yo,"CODEC",r3e);let Hs=yo;function HV(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var n3e=jV,KT=128,i3e=-128,s3e=Math.pow(2,31);function jV(r,e,t){e=e||[],t=t||0;for(var n=t;r>=s3e;)e[t++]=r&255|KT,r/=128;for(;r&i3e;)e[t++]=r&255|KT,r>>>=7;return e[t]=r|0,jV.bytes=t-n+1,e}var o3e=Ub,a3e=128,HT=127;function Ub(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Ub.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&HT)<<i:(o&HT)*Math.pow(2,i),i+=7}while(o>=a3e);return Ub.bytes=s-n,t}var c3e=Math.pow(2,7),l3e=Math.pow(2,14),u3e=Math.pow(2,21),d3e=Math.pow(2,28),h3e=Math.pow(2,35),f3e=Math.pow(2,42),p3e=Math.pow(2,49),g3e=Math.pow(2,56),y3e=Math.pow(2,63),m3e=function(r){return r<c3e?1:r<l3e?2:r<u3e?3:r<d3e?4:r<h3e?5:r<f3e?6:r<p3e?7:r<g3e?8:r<y3e?9:10},w3e={encode:n3e,decode:o3e,encodingLength:m3e},jT=w3e;function qT(r,e=0){return[jT.decode(r,e),jT.decode.bytes]}function v3e(r){const e=HV(r),[t,n]=qT(e),[i,s]=qT(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new b3e(t,i,o,e)}let b3e=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};const E3e=290,S3e=1,qV=2e3,x3e=100,fg=`${J3}-circuit-relay`;BigInt(1<<17);const ym="/libp2p/circuit/relay/0.2.0/hop",WT="/libp2p/circuit/relay/0.2.0/stop",GT=300,A3e=4096,I3e=.001;var oh;(function(r){(function(n){n.RESERVE="RESERVE",n.CONNECT="CONNECT",n.STATUS="STATUS"})(r.Type||(r.Type={}));let e;(function(n){n[n.RESERVE=0]="RESERVE",n[n.CONNECT=1]="CONNECT",n[n.STATUS=2]="STATUS"})(e||(e={})),function(n){n.codec=()=>Bn(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=Be((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.peer!=null&&(i.uint32(18),ah.codec().encode(n.peer,i)),n.reservation!=null&&(i.uint32(26),mm.codec().encode(n.reservation,i)),n.limit!=null&&(i.uint32(34),ch.codec().encode(n.limit,i)),n.status!=null&&(i.uint32(40),un.codec().encode(n.status,i)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{var c,l,d;const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const h=n.uint32();switch(h>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.peer=ah.codec().decode(n,n.uint32(),{limits:(c=s.limits)==null?void 0:c.peer});break}case 3:{o.reservation=mm.codec().decode(n,n.uint32(),{limits:(l=s.limits)==null?void 0:l.reservation});break}case 4:{o.limit=ch.codec().decode(n,n.uint32(),{limits:(d=s.limits)==null?void 0:d.limit});break}case 5:{o.status=un.codec().decode(n);break}default:{n.skipType(h&7);break}}}return o})),t),r.encode=n=>Le(n,r.codec()),r.decode=(n,i)=>Re(n,r.codec(),i)})(oh||(oh={}));var go;(function(r){(function(n){n.CONNECT="CONNECT",n.STATUS="STATUS"})(r.Type||(r.Type={}));let e;(function(n){n[n.CONNECT=0]="CONNECT",n[n.STATUS=1]="STATUS"})(e||(e={})),function(n){n.codec=()=>Bn(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=Be((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.peer!=null&&(i.uint32(18),ah.codec().encode(n.peer,i)),n.limit!=null&&(i.uint32(26),ch.codec().encode(n.limit,i)),n.status!=null&&(i.uint32(32),un.codec().encode(n.status,i)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{var c,l;const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const d=n.uint32();switch(d>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.peer=ah.codec().decode(n,n.uint32(),{limits:(c=s.limits)==null?void 0:c.peer});break}case 3:{o.limit=ch.codec().decode(n,n.uint32(),{limits:(l=s.limits)==null?void 0:l.limit});break}case 4:{o.status=un.codec().decode(n);break}default:{n.skipType(d&7);break}}}return o})),t),r.encode=n=>Le(n,r.codec()),r.decode=(n,i)=>Re(n,r.codec(),i)})(go||(go={}));var ah;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.addrs!=null)for(const s of t.addrs)n.uint32(18),n.bytes(s);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={id:tt(0),addrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.id=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.addrs)!=null&&s.addrs.length===i.limits.addrs)throw new xt('Decode error - map field "addrs" had too many elements');s.addrs.push(t.bytes());break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(ah||(ah={}));var mm;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.expire!=null&&t.expire!==0n&&(n.uint32(8),n.uint64(t.expire)),t.addrs!=null)for(const s of t.addrs)n.uint32(18),n.bytes(s);t.voucher!=null&&(n.uint32(26),vm.codec().encode(t.voucher,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={expire:0n,addrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.expire=t.uint64();break}case 2:{if(((a=i.limits)==null?void 0:a.addrs)!=null&&s.addrs.length===i.limits.addrs)throw new xt('Decode error - map field "addrs" had too many elements');s.addrs.push(t.bytes());break}case 3:{s.voucher=vm.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.voucher});break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(mm||(mm={}));var ch;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.duration!=null&&(n.uint32(8),n.uint32(t.duration)),t.data!=null&&(n.uint32(16),n.uint64(t.data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.duration=t.uint32();break}case 2:{s.data=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(ch||(ch={}));var un;(function(r){r.UNUSED="UNUSED",r.OK="OK",r.RESERVATION_REFUSED="RESERVATION_REFUSED",r.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONNECTION_FAILED="CONNECTION_FAILED",r.NO_RESERVATION="NO_RESERVATION",r.MALFORMED_MESSAGE="MALFORMED_MESSAGE",r.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"})(un||(un={}));var Fb;(function(r){r[r.UNUSED=0]="UNUSED",r[r.OK=100]="OK",r[r.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",r[r.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",r[r.PERMISSION_DENIED=202]="PERMISSION_DENIED",r[r.CONNECTION_FAILED=203]="CONNECTION_FAILED",r[r.NO_RESERVATION=204]="NO_RESERVATION",r[r.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",r[r.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"})(Fb||(Fb={}));(function(r){r.codec=()=>Bn(Fb)})(un||(un={}));var wm;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.relay!=null&&t.relay.byteLength>0&&(n.uint32(10),n.bytes(t.relay)),t.peer!=null&&t.peer.byteLength>0&&(n.uint32(18),n.bytes(t.peer)),t.expiration!=null&&t.expiration!==0n&&(n.uint32(24),n.uint64(t.expiration)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={relay:tt(0),peer:tt(0),expiration:0n},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.relay=t.bytes();break}case 2:{s.peer=t.bytes();break}case 3:{s.expiration=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(wm||(wm={}));var vm;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&(n.uint32(26),wm.codec().encode(t.payload,n)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={publicKey:tt(0),payloadType:tt(0),signature:tt(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.publicKey=t.bytes();break}case 2:{s.payloadType=t.bytes();break}case 3:{s.payload=wm.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.payload});break}case 5:{s.signature=t.bytes();break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(vm||(vm={}));function C3e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var k3e=C3e,_3e=k3e;let T3e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},P3e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return WV(this,e)}},D3e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return WV(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function WV(r,e){return new D3e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let $3e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new T3e(e,t,n),this.decoder=new P3e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function GV({name:r,prefix:e,encode:t,decode:n}){return new $3e(r,e,t,n)}function zw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=_3e(t,r);return GV({prefix:e,name:r,encode:n,decode:s=>HV(i(s))})}function N3e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function O3e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function sa({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return GV({prefix:e,name:r,encode(i){return O3e(i,n,t)},decode(i){return N3e(i,n,t,r)}})}sa({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});sa({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});sa({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});sa({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});sa({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});sa({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});sa({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});sa({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});sa({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});zw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});zw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});zw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});zw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});class zb extends Error{constructor(){super(...arguments);u(this,"name","HadEnoughRelaysError")}}u(zb,"name","HadEnoughRelaysError");class QV extends Error{constructor(){super(...arguments);u(this,"name","DoubleRelayError")}}u(QV,"name","DoubleRelayError");class YV extends Error{constructor(){super(...arguments);u(this,"name","RelayQueueFullError")}}u(YV,"name","RelayQueueFullError");function QT(r){const e=r*BigInt(1e3),t=new Date().getTime();return Number(e-BigInt(t))}class YT{constructor(e){u(this,"expires");u(this,"bytes");(e==null?void 0:e.duration)!=null&&(e==null?void 0:e.duration)!==0&&(this.expires=Date.now()+e.duration*1e3),this.bytes=e==null?void 0:e.data,this.bytes===0n&&(this.bytes=void 0),this.onData=this.onData.bind(this)}onData(e){this.bytes!=null&&(this.bytes-=BigInt(e.byteLength),this.bytes<0n&&(this.bytes=0n))}getLimits(){if(this.expires==null&&this.bytes==null)return;const e={};if(this.bytes!=null){const t=this;Object.defineProperty(e,"bytes",{get(){return t.bytes}})}if(this.expires!=null){const t=this;Object.defineProperty(e,"seconds",{get(){return Math.round(((t.expires??0)-Date.now())/1e3)}})}return e}}const XV=Nt(nt(gz.matchers[0],rt("p2p-circuit"))),JV=Nt(rt("p2p-circuit"));function XT(r){const{stream:e,remoteAddr:t,logger:n,onDataRead:i,onDataWrite:s}=r,o=n.forComponent("libp2p:stream:converter");let a=!1,c=!1;const l=e.close.bind(e);e.close=async f=>{await l(f),w(!0)};const d=e.abort.bind(e);e.abort=f=>{d(f),w(!0)};const h=e.sink.bind(e);e.sink=async f=>{try{await h(gn(f,g=>Fy(g,v=>s==null?void 0:s(v))))}catch(g){g.type!=="aborted"&&o.error("%s error in sink",t,g)}finally{c=!0,w()}};const p={log:o,sink:e.sink,source:async function*(){try{for await(const f of e.source)i==null||i(f),yield f}finally{a=!0,w()}}(),remoteAddr:t,timeline:{open:Date.now(),close:void 0},close:e.close,abort:e.abort};function w(f){f===!0&&(a=!0,c=!0),a&&c&&p.timeline.close==null&&(p.timeline.close=Date.now())}return p}class M3e extends tr{constructor(t,n={}){super();u(this,"peerStore");u(this,"registrar");u(this,"connectionManager");u(this,"randomWalk");u(this,"started");u(this,"running");u(this,"topologyId");u(this,"log");u(this,"discoveryController");u(this,"filter");u(this,"queue");this.log=t.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.started=!1,this.running=!1,this.peerStore=t.peerStore,this.registrar=t.registrar,this.connectionManager=t.connectionManager,this.randomWalk=t.randomWalk,this.filter=n.filter,this.discoveryController=new AbortController,this.discoveryController.signal}isStarted(){return this.started}async start(){this.topologyId=await this.registrar.register(ym,{filter:this.filter,onConnect:t=>{var n,i;this.log.trace("discovered relay %p queue (length: %d, active %d)",t,(n=this.queue)==null?void 0:n.size,(i=this.queue)==null?void 0:i.running),this.safeDispatchEvent("relay:discover",{detail:t})}}),this.started=!0}stop(){var t;this.topologyId!=null&&this.registrar.unregister(this.topologyId),(t=this.discoveryController)==null||t.abort(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,this.discoveryController.signal,Promise.resolve().then(async()=>{var i;this.log("searching peer store for relays");const t=await this.peerStore.all({filters:[s=>s.protocols.includes(ym)],orders:[()=>Math.random()<.5?1:-1,(s,o)=>{const a=JT(s),c=JT(o);return a>c?-1:c>a?1:0}]});for(const s of t)this.log.trace("found relay peer %p in peer store",s.id),this.safeDispatchEvent("relay:discover",{detail:s.id});this.log("found %d relay peers in peer store",t.length);const n=this.queue=new Ic({concurrency:5});this.log("start random walk");for await(const s of this.randomWalk.walk({signal:this.discoveryController.signal})){if(this.log.trace("found random peer %p",s.id),n.has(s.id)){this.log.trace("random peer %p was already in queue",s.id);continue}if(((i=this.connectionManager.getConnections(s.id))==null?void 0:i.length)>0){this.log.trace("random peer %p was already connected",s.id);continue}if(!await this.connectionManager.isDialable(s.multiaddrs)){this.log.trace("random peer %p was not dialable",s.id,s.multiaddrs.map(o=>o.toString()));continue}n.queued>10&&(this.log.trace("wait for space in queue for %p",s.id),await n.onSizeLessThan(10,{signal:this.discoveryController.signal})),this.log("adding random peer %p to dial queue (length: %d, active %d)",s.id,n.size,n.running),n.add(async()=>{const o=bt([this.discoveryController.signal,AbortSignal.timeout(5e3)]);try{await this.connectionManager.openConnection(s.id,{signal:o})}finally{o.clear()}},{peerId:s.id,signal:this.discoveryController.signal}).catch(o=>{this.log.error("error opening connection to random peer %p",s.id,o)})}this.log("stop random walk"),await n.onIdle()}).catch(t=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network",t)}))}stopDiscovery(){var t;this.log("stop discovery"),this.running=!1,(t=this.discoveryController)==null||t.abort()}}function JT(r){const e=r.metadata.get("last-dial-success");return e==null?0:new Date(ae(e)).getTime()}class R3e extends tr{constructor(t,n={}){super();u(this,"connectionManager");u(this,"addressManager");u(this,"reservationStore");u(this,"listeningAddrs");u(this,"log");u(this,"listenTimeout");u(this,"reservationId");u(this,"relay");u(this,"_onRemoveRelayPeer",t=>{var n,i;this.log("relay removed %p our relay %p",t.detail.relay,this.relay,(n=this.relay)==null?void 0:n.equals(t.detail.relay)),((i=this.relay)==null?void 0:i.equals(t.detail.relay))===!0&&(this.log("relay peer removed %p",t.detail.relay),this.listeningAddrs.forEach(s=>{this.addressManager.removeObservedAddr(s)}),this.listeningAddrs=[],this.safeDispatchEvent("listening"))});u(this,"_onAddRelayPeer",t=>{const{details:n}=t.detail;n.type!=="configured"&&n.id===this.reservationId&&this.addedRelay(t.detail)});this.log=t.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=t.connectionManager,this.addressManager=t.addressManager,this.reservationStore=t.reservationStore,this.listeningAddrs=[],this.listenTimeout=n.listenTimeout??qV,this.reservationStore.addEventListener("relay:removed",this._onRemoveRelayPeer),this.reservationStore.addEventListener("relay:created-reservation",this._onAddRelayPeer)}async listen(t){if(JV.exactMatch(t))this.log("searching for circuit relay servers"),this.reservationId=this.reservationStore.reserveRelay();else if(XV.exactMatch(t)){this.log("listen on specific relay server %a",t);const n=AbortSignal.timeout(this.listenTimeout),i=t.decapsulate("/p2p-circuit"),s=await this.connectionManager.openConnection(i,{signal:n});if(!this.reservationStore.hasReservation(s.remotePeer)){this.log("making reservation on peer %p",s.remotePeer);const o=await this.reservationStore.addRelay(s.remotePeer,"configured");this.addedRelay(o)}}else throw new oy(`Could not listen on p2p-circuit address "${t}"`)}getAddrs(){return[...this.listeningAddrs.values()].flat()}updateAnnounceAddrs(){}async close(){this.reservationStore.cancelReservations(),this.listeningAddrs=[],this.reservationStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),queueMicrotask(()=>{this.safeDispatchEvent("close")})}addedRelay(t){this.log("relay peer added %p",t.relay),this.relay=t.relay,this.listeningAddrs=t.details.reservation.addrs.map(n=>Fe(n).encapsulate("/p2p-circuit")),this.listeningAddrs.forEach(n=>{this.addressManager.confirmObservedAddr(n,{type:"transport"})}),queueMicrotask(()=>{this.safeDispatchEvent("listening")})}}function L3e(r){return new R3e(r)}const B3e="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let U3e=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=B3e[t[r]&63];return e};const F3e=60*1e3*10,z3e=60*1e3*5,V3e=30*1e3;var Dn,ZV,Gf,Qf;class K3e extends tr{constructor(t,n){super();et(this,Dn);u(this,"peerId");u(this,"connectionManager");u(this,"peerStore");u(this,"events");u(this,"reserveQueue");u(this,"reservations");u(this,"pendingReservations");u(this,"maxReservationQueueLength");u(this,"reservationCompletionTimeout");u(this,"started");u(this,"log");u(this,"relayFilter");this.log=t.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=t.peerId,this.connectionManager=t.connectionManager,this.peerStore=t.peerStore,this.events=t.events,this.reservations=new zc,this.pendingReservations=[],this.maxReservationQueueLength=(n==null?void 0:n.maxReservationQueueLength)??x3e,this.reservationCompletionTimeout=(n==null?void 0:n.reservationCompletionTimeout)??qV,this.started=!1,this.relayFilter=Ql(100),this.reserveQueue=new Ic({concurrency:(n==null?void 0:n.reservationConcurrency)??S3e,metricName:"libp2p_relay_reservation_queue",metrics:t.metrics}),this.events.addEventListener("connection:close",i=>{[...this.reservations.values()].find(o=>o.connection===i.detail.id)!=null&&De(this,Dn,Gf).call(this,i.detail.remotePeer).catch(o=>{this.log("could not remove relay %p - %e",i.detail,o)})})}isStarted(){return this.started}start(){this.started=!0}afterStart(){Promise.resolve().then(async()=>{const t=await this.peerStore.all({filters:[n=>n.tags.has(fg)]});this.log("removing tag from %d old relays",t.length),await Promise.all(t.map(async n=>{await this.peerStore.merge(n.id,{tags:{[fg]:void 0}})})),this.log("redialing %d old relays",t.length),await Promise.all(t.map(async n=>this.addRelay(n.id,"discovered"))),De(this,Dn,Qf).call(this)}).catch(t=>{this.log.error(t)})}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:t})=>{clearTimeout(t)}),this.reservations.clear(),this.started=!1}reserveRelay(){const t=U3e();return this.pendingReservations.push(t),De(this,Dn,Qf).call(this),t}async addRelay(t,n){if(this.peerId.equals(t))throw this.log.trace("not trying to use self as relay"),new oy("Cannot use self as relay");if(this.reserveQueue.size>this.maxReservationQueueLength)throw new YV("The reservation queue is full");const i=this.reserveQueue.find(t);if(i!=null)return this.log.trace("potential relay peer %p is already in the reservation queue",t),i.join();if(this.relayFilter.has(t.toMultihash().bytes))throw new oy("The relay was previously invalid");return this.log.trace("try to reserve relay slot with %p",t),this.reserveQueue.add(async()=>{const s=Date.now();try{const o=this.reservations.get(t);if(o!=null){const g=this.connectionManager.getConnections(t);let v=!1;if(g.length===0&&this.log("already have relay reservation with %p but we are no longer connected",t),g.map(y=>y.id).includes(o.connection)&&(this.log("already have relay reservation with %p and the original connection is still open",t),v=!0),v&&QT(o.reservation.expire)>F3e)return this.log("already have relay reservation with %p but we are still connected and it does not expire soon",t),{relay:t,details:o};await De(this,Dn,Gf).call(this,t)}if(n==="discovered"&&this.pendingReservations.length===0)throw new zb("Not making reservation on discovered relay because we do not need any more relays");const a=AbortSignal.timeout(this.reservationCompletionTimeout);const c=await this.connectionManager.openConnection(t,{signal:a});if(kc.matches(c.remoteAddr))throw new QV("not creating reservation over relayed connection");const l=await De(this,Dn,ZV).call(this,c,{signal:a}),d=QT(l.expire);this.log("created reservation on relay peer %p, expiry date is %s",t,new Date(Date.now()+d).toString());const h=Math.min(Math.max(d-z3e,V3e),Math.pow(2,31)-1),p=setTimeout(()=>{this.log("refresh reservation to relay %p",t),this.addRelay(t,n).catch(async g=>{this.log.error("could not refresh reservation to relay %p - %e",t,g),await De(this,Dn,Gf).call(this,t)}).catch(g=>{this.log.error("could not remove expired reservation to relay %p - %e",t,g)})},h);let w;if(n==="discovered"){const g=this.pendingReservations.pop();if(g==null)throw new zb("Made reservation on relay but did not need any more discovered relays");w={timeout:p,reservation:l,type:n,connection:c.id,id:g}}else w={timeout:p,reservation:l,type:n,connection:c.id};this.reservations.set(t,w),await this.peerStore.merge(t,{tags:{[fg]:{value:1,ttl:d}}}),De(this,Dn,Qf).call(this);const f={relay:t,details:w};return this.safeDispatchEvent("relay:created-reservation",{detail:f}),f}catch(o){throw n==="discovered"&&o.name==="HadEnoughRelaysError"||this.log.error("could not reserve slot on %p after %dms - %e",t,Date.now()-s,o),(o.name==="DialError"||o.name==="UnsupportedProtocolError")&&this.relayFilter.add(t.toMultihash().bytes),De(this,Dn,Gf).call(this,t).catch(a=>{this.log.error("could not remove reservation on %p after reserving slot failed - %e",t,a)}),o}},{peerId:t})}hasReservation(t){return this.reservations.has(t)}getReservation(t){var n;return(n=this.reservations.get(t))==null?void 0:n.reservation}reservationCount(t){return t==null?this.reservations.size:[...this.reservations.values()].reduce((n,i)=>(i.type===t&&n++,n),0)}cancelReservations(){[...this.reservations.values()].forEach(t=>{clearTimeout(t.timeout)}),this.reservations.clear()}}Dn=new WeakSet,ZV=async function(t,n){var l;(l=n.signal)==null||l.throwIfAborted(),this.log("requesting reservation from %p",t.remotePeer);const i=await t.newStream(ym,n),o=si(i).pb(oh);this.log.trace("send RESERVE to %p",t.remotePeer),await o.write({type:oh.Type.RESERVE},n);let a;try{this.log.trace("reading response from %p",t.remotePeer),a=await o.read(n)}catch(d){throw i.abort(d),d}finally{i.status!=="closed"&&await i.close(n)}if(this.log.trace("read response %o",a),a.status===un.OK&&a.reservation!=null){const d=new Set;d.add(t.remoteAddr.toString());for(const h of a.reservation.addrs){let p=Fe(h);p.getPeerId()==null&&(p=p.encapsulate(`/p2p/${t.remotePeer}`)),p=Fe(p.toString().replace(`/p2p/${t.remotePeer}/p2p/${t.remotePeer}`,`/p2p/${t.remotePeer}`)),d.add(p.toString())}return a.reservation.addrs=[...d].map(h=>Fe(h).bytes),a.reservation}const c=`reservation failed with status ${a.status??"undefined"}`;throw this.log.error(c),new Error(c)},Gf=async function(t){const n=this.reservations.get(t);n!=null&&(this.log("removing relay reservation with %p from local store",t),clearTimeout(n.timeout),this.reservations.delete(t),n.type==="discovered"&&this.pendingReservations.push(n.id),await this.peerStore.merge(t,{tags:{[fg]:void 0}}),this.safeDispatchEvent("relay:removed",{detail:{relay:t,details:n}}),De(this,Dn,Qf).call(this))},Qf=function(){if(this.pendingReservations.length===0){this.log.trace("have discovered enough relays"),this.reserveQueue.clear(),this.safeDispatchEvent("relay:found-enough-relays");return}this.relayFilter=Ql(100),this.log("not discovered enough relays %d/%d",this.reservations.size,this.pendingReservations.length),this.safeDispatchEvent("relay:not-enough-relays")};const H3e=r=>{if(r.peer==null)return!1;try{r.peer.addrs.forEach(Fe)}catch{return!1}return!0},ZT={maxInboundStopStreams:GT,maxOutboundStopStreams:GT};var $N,NN,ON,MN;class j3e{constructor(e,t={}){u(this,"discovery");u(this,"registrar");u(this,"peerStore");u(this,"connectionManager");u(this,"transportManager");u(this,"peerId");u(this,"upgrader");u(this,"addressManager");u(this,"connectionGater");u(this,"reservationStore");u(this,"logger");u(this,"maxInboundStopStreams");u(this,"maxOutboundStopStreams");u(this,"started");u(this,"log");u(this,"shutdownController");u(this,MN,"@libp2p/circuit-relay-v2-transport");u(this,ON,["@libp2p/transport","@libp2p/circuit-relay-v2-transport"]);u(this,$N,!0);this.log=e.logger.forComponent("libp2p:circuit-relay:transport"),this.registrar=e.registrar,this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.logger=e.logger,this.peerId=e.peerId,this.upgrader=e.upgrader,this.addressManager=e.addressManager,this.connectionGater=e.connectionGater,this.maxInboundStopStreams=t.maxInboundStopStreams??ZT.maxInboundStopStreams,this.maxOutboundStopStreams=t.maxOutboundStopStreams??ZT.maxOutboundStopStreams,this.shutdownController=new AbortController,this.discovery=new M3e(e,{filter:t.discoveryFilter??mae(A3e,I3e)}),this.discovery.addEventListener("relay:discover",n=>{this.reservationStore.addRelay(n.detail,"discovered").catch(i=>{i.name!=="HadEnoughRelaysError"&&i.name!=="RelayQueueFullError"&&this.log.error("could not add discovered relay %p",n.detail,i)})}),this.reservationStore=new K3e(e,t),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{var n;(n=this.discovery)==null||n.startDiscovery()}),this.reservationStore.addEventListener("relay:found-enough-relays",()=>{var n;(n=this.discovery)==null||n.stopDiscovery()}),this.started=!1}get[(MN=Symbol.toStringTag,ON=lr,NN=Sc,$N=Z3,NN)](){return this.discovery!=null?["@libp2p/identify"]:[]}isStarted(){return this.started}async start(){this.shutdownController=new AbortController,await this.registrar.handle(WT,e=>{const t=this.upgrader.createInboundAbortSignal(this.shutdownController.signal);this.onStop(e,t).catch(n=>{this.log.error("error while handling STOP protocol",n),e.stream.abort(n)}).finally(()=>{t.clear()})},{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0}),await Ko(this.discovery,this.reservationStore),this.started=!0}async stop(){this.shutdownController.abort(),await Uc(this.discovery,this.reservationStore),await this.registrar.unhandle(WT),this.started=!1}async dial(e,t){var w,f,g,v,y,m;if(e.protoCodes().filter(b=>b===E3e).length!==1){const b="Invalid circuit relay address";throw this.log.error(b,e),new pd(b)}const n=e.toString().split("/p2p-circuit"),i=Fe(n[0]),s=Fe(n[n.length-1]),o=i.getPeerId(),a=s.getPeerId();if(o==null||a==null){const b=`ircuit relay dial to ${e.toString()} failed as address did not have both relay and destination PeerIDs`;throw this.log.error(`c${b}`),new pd(`C${b}`)}const c=Zt(o),l=Zt(a);let h=this.connectionManager.getConnections(c)[0];h==null?(await this.peerStore.merge(c,{multiaddrs:[i]}),(w=t.onProgress)==null||w.call(t,new Ne("circuit-relay:open-connection")),h=await this.connectionManager.openConnection(c,t)):(f=t.onProgress)==null||f.call(t,new Ne("circuit-relay:reuse-connection"));let p;try{(g=t.onProgress)==null||g.call(t,new Ne("circuit-relay:open-hop-stream")),p=await h.newStream(ym,t);const b=si(p),S=b.pb(oh);(v=t.onProgress)==null||v.call(t,new Ne("circuit-relay:write-connect-message")),await S.write({type:oh.Type.CONNECT,peer:{id:l.toMultihash().bytes,addrs:[Fe(s).bytes]}},t),(y=t.onProgress)==null||y.call(t,new Ne("circuit-relay:read-connect-response"));const I=await S.read(t);if(I.status!==un.OK)throw new Pt(`failed to connect via relay with status ${((m=I==null?void 0:I.status)==null?void 0:m.toString())??"undefined"}`);const T=new YT(I.limit),A=XT({stream:b.unwrap(),remoteAddr:e,localAddr:i.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`),logger:this.logger,onDataRead:T.onData,onDataWrite:T.onData});return this.log("new outbound relayed connection %a",A.remoteAddr),await this.upgrader.upgradeOutbound(A,{...t,limits:T.getLimits()})}catch(b){throw this.log.error("circuit relay dial to destination %p via relay %p failed",l,c,b),p==null||p.abort(b),b}}createListener(e){return L3e({peerId:this.peerId,connectionManager:this.connectionManager,addressManager:this.addressManager,reservationStore:this.reservationStore,logger:this.logger})}listenFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>XV.exactMatch(t)||JV.exactMatch(t))}dialFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>kc.exactMatch(t))}async onStop({connection:e,stream:t},n){var d,h;if(!this.reservationStore.hasReservation(e.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.transportManager.listen([e.remoteAddr.encapsulate("/p2p-circuit")])}catch(p){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on",p)}const i=si(t).pb(go),s=await i.read({signal:n});if(this.log("new circuit relay v2 stop stream from %p with type %s",e.remotePeer,s.type),(s==null?void 0:s.type)===void 0){this.log.error("type was missing from circuit v2 stop protocol request from %s",e.remotePeer),await i.write({type:go.Type.STATUS,status:un.MALFORMED_MESSAGE},{signal:n}),await t.close();return}if(s.type!==go.Type.CONNECT){this.log.error("invalid stop connect request via peer %p",e.remotePeer),await i.write({type:go.Type.STATUS,status:un.UNEXPECTED_MESSAGE},{signal:n}),await t.close();return}if(!H3e(s)){this.log.error("invalid stop connect request via peer %p",e.remotePeer),await i.write({type:go.Type.STATUS,status:un.MALFORMED_MESSAGE},{signal:n}),await t.close({signal:n});return}const o=li(v3e(s.peer.id));if(await((h=(d=this.connectionGater).denyInboundRelayedConnection)==null?void 0:h.call(d,e.remotePeer,o))===!0){this.log.error("connection gater denied inbound relayed connection from %p",e.remotePeer),await i.write({type:go.Type.STATUS,status:un.PERMISSION_DENIED},{signal:n}),await t.close({signal:n});return}this.log.trace("sending success response to %p",e.remotePeer),await i.write({type:go.Type.STATUS,status:un.OK},{signal:n});const a=new YT(s.limit),c=e.remoteAddr.encapsulate(`/p2p-circuit/p2p/${o.toString()}`);this.addressManager.getAddresses()[0];const l=XT({stream:i.unwrap().unwrap(),remoteAddr:c,logger:this.logger,onDataRead:a.onData,onDataWrite:a.onData});this.log("new inbound relayed connection %a",l.remoteAddr),await this.upgrader.upgradeInbound(l,{limits:a.getLimits(),signal:n}),this.log("%s connection %a upgraded","inbound",l.remoteAddr)}}function eK(r={}){return e=>new j3e(e,r)}const eP=()=>{const r=new Error("Delay aborted");return r.name="AbortError",r},q3e=new WeakMap;function W3e({clearTimeout:r,setTimeout:e}={}){return(t,{value:n,signal:i}={})=>{if(i!=null&&i.aborted)return Promise.reject(eP());let s,o,a;const c=r??clearTimeout,l=()=>{c(s),a(eP())},d=()=>{i&&i.removeEventListener("abort",l)},h=new Promise((p,w)=>{o=()=>{d(),p(n)},a=w,s=(e??setTimeout)(o,t)});return i&&i.addEventListener("abort",l,{once:!0}),q3e.set(h,()=>{c(s),s=null,o()}),h}}const tK=W3e();var $s;(function(r){(function(n){n.UNUSED="UNUSED",n.CONNECT="CONNECT",n.SYNC="SYNC"})(r.Type||(r.Type={}));let e;(function(n){n[n.UNUSED=0]="UNUSED",n[n.CONNECT=100]="CONNECT",n[n.SYNC=300]="SYNC"})(e||(e={})),function(n){n.codec=()=>Bn(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=Be((n,i,s={})=>{if(s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.observedAddresses!=null)for(const o of n.observedAddresses)i.uint32(18),i.bytes(o);s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{var c;const o={observedAddresses:[]},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const l=n.uint32();switch(l>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{if(((c=s.limits)==null?void 0:c.observedAddresses)!=null&&o.observedAddresses.length===s.limits.observedAddresses)throw new xt('Decode error - map field "observedAddresses" had too many elements');o.observedAddresses.push(n.bytes());break}default:{n.skipType(l&7);break}}}return o})),t),r.encode=n=>Le(n,r.codec()),r.decode=(n,i)=>Re(n,r.codec(),i)})($s||($s={}));function tP(r,e){return kc.matches(r)||e.dialTransportForMultiaddr(r)==null?!1:cz.matches(r)?!0:Vhe.matches(r)?Vc(r.toOptions().host)===!1:!1}const rP=1024*4,nP=100,pg={timeout:5e3,retries:3,maxInboundStreams:1,maxOutboundStreams:1};var RN,LN;LN=Symbol.toStringTag,RN=Sc;class G3e{constructor(e,t){u(this,"started");u(this,"timeout");u(this,"retries");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"peerStore");u(this,"registrar");u(this,"connectionManager");u(this,"addressManager");u(this,"transportManager");u(this,"topologyId");u(this,"log");u(this,LN,"@libp2p/dcutr");u(this,RN,["@libp2p/identify"]);this.log=e.logger.forComponent("libp2p:dcutr"),this.started=!1,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.timeout=t.timeout??pg.timeout,this.retries=t.retries??pg.retries,this.maxInboundStreams=t.maxInboundStreams??pg.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??pg.maxOutboundStreams}isStarted(){return this.started}async start(){this.started||(this.topologyId=await this.registrar.register(gg,{notifyOnLimitedConnection:!0,onConnect:(e,t)=>{kc.exactMatch(t.remoteAddr)&&t.direction==="inbound"&&this.upgradeInbound(t).catch(n=>{this.log.error("error during outgoing DCUtR attempt",n)})}}),await this.registrar.handle(gg,e=>{this.handleIncomingUpgrade(e.stream,e.connection).catch(t=>{this.log.error("error during incoming DCUtR attempt",t),e.stream.abort(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:!0}),this.started=!0)}async stop(){await this.registrar.unhandle(gg),this.topologyId!=null&&this.registrar.unregister(this.topologyId),this.started=!1}async upgradeInbound(e){if(await this.attemptUnilateralConnectionUpgrade(e))return;let t;for(let n=0;n<this.retries;n++){const i={signal:AbortSignal.timeout(this.timeout)};try{t=await e.newStream([gg],{signal:i.signal,runOnLimitedConnection:!0});const s=si(t,{maxDataLength:rP}).pb($s);this.log("B sending connect to %p",e.remotePeer);const o=Date.now();await s.write({type:$s.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(h=>h.bytes)},i),this.log("B receiving connect from %p",e.remotePeer);const a=await s.read(i);if(a.type!==$s.Type.CONNECT)throw this.log("A sent wrong message type"),new Pt("DCUtR message type was incorrect");const c=this.getDialableMultiaddrs(a.observedAddresses);if(c.length===0)throw this.log("A did not have any dialable multiaddrs"),new Pt("DCUtR connect message had no multiaddrs");const l=Date.now()-o;this.log("A sending sync, rtt %dms",l),await s.write({type:$s.Type.SYNC,observedAddresses:[]},i),this.log("A waiting for half RTT"),await tK(l/2),this.log("B dialing",c);const d=await this.connectionManager.openConnection(c,{signal:i.signal,priority:nP,force:!0,initiator:!1});this.log("DCUtR to %p succeeded to address %a, closing relayed connection",e.remotePeer,d.remoteAddr),await e.close(i);break}catch(s){if(this.log.error("error while attempting DCUtR on attempt %d of %d",n+1,this.retries,s),t==null||t.abort(s),n===this.retries)throw s}finally{t!=null&&await t.close(i)}}}async attemptUnilateralConnectionUpgrade(e){const n=(await this.peerStore.get(e.remotePeer)).addresses.map(i=>{const s=i.multiaddr;return s.getPeerId()==null?s.encapsulate(`/p2p/${e.remotePeer}`):s}).filter(i=>tP(i,this.transportManager));if(n.length>0){const i=AbortSignal.timeout(this.timeout);try{this.log("attempting unilateral connection upgrade to %a",n);const s=await this.connectionManager.openConnection(n,{signal:i,force:!0});if(kc.exactMatch(s.remoteAddr))throw new Error("Could not open a new, non-limited, connection");return this.log("unilateral connection upgrade to %p succeeded via %a, closing relayed connection",e.remotePeer,s.remoteAddr),await e.close({signal:i}),!0}catch(s){this.log.error("unilateral connection upgrade to %p on addresses %a failed",e.remotePeer,n,s)}}else this.log("peer %p has no public addresses, not attempting unilateral connection upgrade",e.remotePeer);return!1}async handleIncomingUpgrade(e,t){const n={signal:AbortSignal.timeout(this.timeout)};try{const i=si(e,{maxDataLength:rP}).pb($s);this.log("A receiving connect");const s=await i.read(n);if(s.type!==$s.Type.CONNECT)throw this.log("B sent wrong message type"),new Pt("DCUtR message type was incorrect");if(s.observedAddresses.length===0)throw this.log("B sent no multiaddrs"),new Pt("DCUtR connect message had no multiaddrs");const o=this.getDialableMultiaddrs(s.observedAddresses);if(o.length===0)throw this.log("B had no dialable multiaddrs"),new Pt("DCUtR connect message had no dialable multiaddrs");if(this.log("A sending connect"),await i.write({type:$s.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(l=>l.bytes)}),this.log("A receiving sync"),(await i.read(n)).type!==$s.Type.SYNC)throw new Pt("DCUtR message type was incorrect");this.log("A dialing",o);const c=await this.connectionManager.openConnection(o,{signal:n.signal,priority:nP,force:!0});this.log("DCUtR to %p succeeded via %a, closing relayed connection",t.remotePeer,c.remoteAddr),await t.close(n)}catch(i){this.log.error("incoming DCUtR from %p failed",t.remotePeer,i),e.abort(i)}finally{await e.close(n)}}getDialableMultiaddrs(e){const t=[];for(const n of e)if(!(n==null||n.length===0))try{const i=Fe(n);if(!tP(i,this.transportManager))continue;t.push(i)}catch{}return t}}const gg="/libp2p/dcutr";function Q3e(r={}){return e=>new G3e(e,r)}const yg=globalThis.CustomEvent??Event;async function*Jp(r,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);const n=e.ordered??!1,i=new EventTarget,s=[];let o=Ve(),a=Ve(),c=!1,l,d=!1;i.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(const f of r){if(s.length===t&&(o=Ve(),await o.promise),d)break;const g={done:!1};s.push(g),f().then(v=>{g.done=!0,g.ok=!0,g.value=v,i.dispatchEvent(new yg("task-complete"))},v=>{g.done=!0,g.err=v,i.dispatchEvent(new yg("task-complete"))})}c=!0,i.dispatchEvent(new yg("task-complete"))}catch(f){l=f,i.dispatchEvent(new yg("task-complete"))}});function h(){var f;return n?(f=s[0])==null?void 0:f.done:!!s.find(g=>g.done)}function*p(){for(;s.length>0&&s[0].done;){const f=s[0];if(s.shift(),f.ok)yield f.value;else throw d=!0,o.resolve(),f.err;o.resolve()}}function*w(){for(;h();)for(let f=0;f<s.length;f++)if(s[f].done){const g=s[f];if(s.splice(f,1),f--,g.ok)yield g.value;else throw d=!0,o.resolve(),g.err;o.resolve()}}for(;;){if(h()||(a=Ve(),await a.promise),l!=null)throw l;if(n?yield*p():yield*w(),c&&s.length===0)break}}const Y3e="0.1.0",X3e="id",J3e="id/push",Z3e="1.0.0",ewe="1.0.0",twe=1024*8,rwe=32;var lh;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.protocolVersion!=null&&(n.uint32(42),n.string(t.protocolVersion)),t.agentVersion!=null&&(n.uint32(50),n.string(t.agentVersion)),t.publicKey!=null&&(n.uint32(10),n.bytes(t.publicKey)),t.listenAddrs!=null)for(const s of t.listenAddrs)n.uint32(18),n.bytes(s);if(t.observedAddr!=null&&(n.uint32(34),n.bytes(t.observedAddr)),t.protocols!=null)for(const s of t.protocols)n.uint32(26),n.string(s);t.signedPeerRecord!=null&&(n.uint32(66),n.bytes(t.signedPeerRecord)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={listenAddrs:[],protocols:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 5:{s.protocolVersion=t.string();break}case 6:{s.agentVersion=t.string();break}case 1:{s.publicKey=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.listenAddrs)!=null&&s.listenAddrs.length===i.limits.listenAddrs)throw new xt('Decode error - map field "listenAddrs" had too many elements');s.listenAddrs.push(t.bytes());break}case 4:{s.observedAddr=t.bytes();break}case 3:{if(((c=i.limits)==null?void 0:c.protocols)!=null&&s.protocols.length===i.limits.protocols)throw new xt('Decode error - map field "protocols" had too many elements');s.protocols.push(t.string());break}case 8:{s.signedPeerRecord=t.bytes();break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(lh||(lh={}));const Si={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:twe,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnLimitedConnection:!0,concurrency:rwe};function nwe(r){if(r!=null&&r.length>0)try{return Fe(r)}catch{}}function iwe(r,e){return e??r.userAgent}async function rK(r,e,t,n,i){if(t("received identify from %p",n.remotePeer),i==null)throw new Pt("message was null or undefined");const s={};if(i.listenAddrs.length>0&&(s.addresses=i.listenAddrs.map(c=>({isCertified:!1,multiaddr:Fe(c)}))),i.protocols.length>0&&(s.protocols=i.protocols),i.publicKey!=null){const c=Un(i.publicKey);if(!Xd(c).equals(n.remotePeer))throw new Pt("public key did not match remote PeerId");s.publicKey=c}let o;if(i.signedPeerRecord!=null){t.trace("received signedPeerRecord from %p",n.remotePeer);let c=i.signedPeerRecord;const l=await Pc.openAndCertify(c,Hs.DOMAIN);let d=Hs.createFromProtobuf(l.payload);const h=Mh(l.publicKey.toCID());if(!d.peerId.equals(h))throw new Pt("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(d.peerId))throw new Pt("signing key does not match remote PeerId");let p;try{p=await r.get(d.peerId)}catch(w){if(w.name!=="NotFoundError")throw w}if(p!=null&&(s.metadata=p.metadata,p.peerRecordEnvelope!=null)){const w=await Pc.createFromProtobuf(p.peerRecordEnvelope),f=Hs.createFromProtobuf(w.payload);f.seqNumber>=d.seqNumber&&(t("sequence number was lower or equal to existing sequence number - stored: %d received: %d",f.seqNumber,d.seqNumber),d=f,c=p.peerRecordEnvelope)}s.peerRecordEnvelope=c,s.addresses=d.multiaddrs.map(w=>({isCertified:!0,multiaddr:w})),o={seq:d.seqNumber,addresses:d.multiaddrs}}else t("%p did not send a signed peer record",n.remotePeer);if(t.trace("patching %p with",n.remotePeer,s),await r.patch(n.remotePeer,s),i.agentVersion!=null||i.protocolVersion!=null){const c={};i.agentVersion!=null&&(c.AgentVersion=fe(i.agentVersion)),i.protocolVersion!=null&&(c.ProtocolVersion=fe(i.protocolVersion)),t.trace("merging %p metadata",n.remotePeer,c),await r.merge(n.remotePeer,{metadata:c})}const a={peerId:n.remotePeer,protocolVersion:i.protocolVersion,agentVersion:i.agentVersion,publicKey:i.publicKey,listenAddrs:i.listenAddrs.map(c=>Fe(c)),observedAddr:i.observedAddr==null?void 0:Fe(i.observedAddr),protocols:i.protocols,signedPeerRecord:o,connection:n};return e.safeDispatchEvent("peer:identify",{detail:a}),a}class nK{constructor(e,t){u(this,"host");u(this,"protocol");u(this,"started");u(this,"timeout");u(this,"peerId");u(this,"privateKey");u(this,"peerStore");u(this,"registrar");u(this,"addressManager");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"maxMessageSize");u(this,"maxObservedAddresses");u(this,"events");u(this,"runOnLimitedConnection");u(this,"log");this.protocol=t.protocol,this.started=!1,this.peerId=e.peerId,this.privateKey=e.privateKey,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.events=e.events,this.log=t.log,this.timeout=t.timeout??Si.timeout,this.maxInboundStreams=t.maxInboundStreams??Si.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??Si.maxOutboundStreams,this.maxMessageSize=t.maxMessageSize??Si.maxMessageSize,this.maxObservedAddresses=t.maxObservedAddresses??Si.maxObservedAddresses,this.runOnLimitedConnection=t.runOnLimitedConnection??Si.runOnLimitedConnection,this.host={protocolVersion:`${t.protocolPrefix??Si.protocolPrefix}/${Y3e}`,agentVersion:iwe(e.nodeInfo,t.agentVersion)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:fe(this.host.agentVersion),ProtocolVersion:fe(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,e=>{this.handleProtocol(e).catch(t=>{this.log.error(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}}var BN,UN;class swe extends(UN=nK,BN=lr,UN){constructor(t,n={}){super(t,{...n,protocol:`/${n.protocolPrefix??Si.protocolPrefix}/${J3e}/${ewe}`,log:t.logger.forComponent("libp2p:identify-push")});u(this,"connectionManager");u(this,"concurrency");u(this,BN,["@libp2p/identify-push"]);this.connectionManager=t.connectionManager,this.concurrency=n.concurrency??Si.concurrency,(n.runOnSelfUpdate??Si.runOnSelfUpdate)&&t.events.addEventListener("self:peer:update",i=>{this.push().catch(s=>{this.log.error(s)})})}async push(){if(!this.isStarted())return;const t=this.addressManager.getAddresses().map(h=>h.decapsulateCode(qe("p2p").code)),n=new Hs({peerId:this.peerId,multiaddrs:t}),i=await Pc.seal(n,this.privateKey),s=this.registrar.getProtocols(),o=await this.peerStore.get(this.peerId),a=ae(o.metadata.get("AgentVersion")??fe(this.host.agentVersion)),c=ae(o.metadata.get("ProtocolVersion")??fe(this.host.protocolVersion)),l=this;async function*d(){for(const h of l.connectionManager.getConnections())(await l.peerStore.get(h.remotePeer)).protocols.includes(l.protocol)&&(yield async()=>{let w;const f=AbortSignal.timeout(l.timeout);try{w=await h.newStream(l.protocol,{signal:f,runOnLimitedConnection:l.runOnLimitedConnection}),await si(w,{maxDataLength:l.maxMessageSize}).pb(lh).write({listenAddrs:t.map(v=>v.bytes),signedPeerRecord:i.marshal(),protocols:s,agentVersion:a,protocolVersion:c},{signal:f}),await w.close({signal:f})}catch(g){l.log.error("could not push identify update to peer",g),w==null||w.abort(g)}})}await Vo(Jp(d(),{concurrency:this.concurrency}))}async handleProtocol(t){const{connection:n,stream:i}=t;try{if(this.peerId.equals(n.remotePeer))throw new Error("received push from ourselves?");const s={signal:AbortSignal.timeout(this.timeout)},a=await si(i,{maxDataLength:this.maxMessageSize}).pb(lh).read(s);await i.close(s),await rK(this.peerStore,this.events,this.log,n,a)}catch(s){this.log.error("received invalid message",s),i.abort(s);return}this.log.trace("handled push from %p",n.remotePeer)}}const owe=41;var FN,zN;class awe extends(zN=nK,FN=lr,zN){constructor(t,n={}){super(t,{...n,protocol:`/${n.protocolPrefix??Si.protocolPrefix}/${X3e}/${Z3e}`,log:t.logger.forComponent("libp2p:identify")});u(this,FN,["@libp2p/identify"]);(n.runOnConnectionOpen??Si.runOnConnectionOpen)&&t.events.addEventListener("connection:open",i=>{const s=i.detail;this.identify(s).catch(o=>{o.name!==zp.name&&this.log.error("error during identify trigged by connection:open",o)})})}async _identify(t,n={}){let i;if(n.signal==null){const s=AbortSignal.timeout(this.timeout);n={...n,signal:s}}try{i=await t.newStream(this.protocol,{...n,runOnLimitedConnection:this.runOnLimitedConnection});const o=await si(i,{maxDataLength:this.maxMessageSize}).pb(lh).read(n);return await i.close(n),o}catch(s){throw i==null||i.abort(s),s}}async identify(t,n={}){const i=await this._identify(t,n),{publicKey:s,protocols:o,observedAddr:a}=i;if(s==null)throw new Pt("public key was missing from identify message");const c=Un(s),l=Mh(c.toCID());if(!t.remotePeer.equals(l))throw new Pt("identified peer does not match the expected peer");if(this.peerId.equals(l))throw new Pt("identified peer is our own peer id?");return this.maybeAddObservedAddress(a),this.log("identify completed for peer %p and protocols %o",l,o),rK(this.peerStore,this.events,this.log,t,i)}maybeAddObservedAddress(t){const n=nwe(t);if(n==null)return;if(this.log.trace("our observed address was %a",n),Tc(n)){this.log.trace("our observed address was private");return}if(n.stringTuples()[0][0]===owe&&!$V(n)){this.log.trace("our observed address was IPv6 but not a global unicast address");return}Ky.exactMatch(n)||(this.log.trace("storing the observed address"),this.addressManager.addObservedAddr(n))}async handleProtocol(t){const{connection:n,stream:i}=t,s=AbortSignal.timeout(this.timeout);try{const o=await this.peerStore.get(this.peerId),a=this.addressManager.getAddresses().map(h=>h.decapsulateCode(qe("p2p").code));let c=o.peerRecordEnvelope;if(a.length>0&&c==null){const h=new Hs({peerId:this.peerId,multiaddrs:a});c=(await Pc.seal(h,this.privateKey)).marshal().subarray()}let l=n.remoteAddr.bytes;zhe.matches(n.remoteAddr)||(l=void 0),await si(i).pb(lh).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:Oi(this.privateKey.publicKey),listenAddrs:a.map(h=>h.bytes),signedPeerRecord:c,observedAddr:l,protocols:o.protocols},{signal:s}),await i.close({signal:s})}catch(o){this.log.error("could not respond to identify request",o),i.abort(o)}}}function iK(r={}){return e=>new awe(e,r)}function cwe(r={}){return e=>new swe(e,r)}const Zp=1e3,Cx=60*Zp,Vw=60*Cx,lwe=36*Vw,uwe="/ipfs/kad/1.0.0",dwe=48*Vw,hwe=24*Vw,fwe=10,pwe=16384,gwe=Vw,sK=20,kx=3,ywe=5*Cx,mwe=Zp,wwe=5*Zp,vwe=5*Cx,bwe=30*Zp,Ewe=180*Zp,iP=`${J3}-kad-dht`;var bm;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key.byteLength>0&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={key:tt(0),value:tt(0),timeReceived:""},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.key=t.bytes();break}case 2:{s.value=t.bytes();break}case 5:{s.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(bm||(bm={}));function Swe(r){const e=r.getUTCFullYear(),t=String(r.getUTCMonth()+1).padStart(2,"0"),n=String(r.getUTCDate()).padStart(2,"0"),i=String(r.getUTCHours()).padStart(2,"0"),s=String(r.getUTCMinutes()).padStart(2,"0"),o=String(r.getUTCSeconds()).padStart(2,"0"),a=r.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${n}T${i}:${s}:${o}.${c}Z`}function xwe(r){const e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");const n=parseInt(t[1],10),i=parseInt(t[2],10)-1,s=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),l=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,i,s,o,a,c,l))}class Mi{constructor(e,t,n){u(this,"key");u(this,"value");u(this,"timeReceived");if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return bm.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:Swe(this.timeReceived)}}static deserialize(e){const t=bm.decode(e);return new Mi(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=xwe(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new Mi(e.key,e.value,t)}}class Em extends Error{constructor(e="Query error"){super(e),this.name="QueryError"}}class Awe extends Error{constructor(e="Query aborted"){super(e),this.name="QueryAbortedError"}}class Iwe extends Error{constructor(e="Invalid record"){super(e),this.name="InvalidRecordError"}}class Cwe extends Error{constructor(e="No selector function configured for prefix"){super(e),this.name="MissingSelectorError"}}var sP;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&(n.uint32(18),n.bytes(t.value)),t.author!=null&&(n.uint32(26),n.bytes(t.author)),t.signature!=null&&(n.uint32(34),n.bytes(t.signature)),t.timeReceived!=null&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.key=t.bytes();break}case 2:{s.value=t.bytes();break}case 3:{s.author=t.bytes();break}case 4:{s.signature=t.bytes();break}case 5:{s.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(sP||(sP={}));var Dt;(function(r){r.PUT_VALUE="PUT_VALUE",r.GET_VALUE="GET_VALUE",r.ADD_PROVIDER="ADD_PROVIDER",r.GET_PROVIDERS="GET_PROVIDERS",r.FIND_NODE="FIND_NODE",r.PING="PING"})(Dt||(Dt={}));var Sm;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(Sm||(Sm={}));(function(r){r.codec=()=>Bn(Sm)})(Dt||(Dt={}));var uh;(function(r){r.NOT_CONNECTED="NOT_CONNECTED",r.CONNECTED="CONNECTED",r.CAN_CONNECT="CAN_CONNECT",r.CANNOT_CONNECT="CANNOT_CONNECT"})(uh||(uh={}));var Vb;(function(r){r[r.NOT_CONNECTED=0]="NOT_CONNECTED",r[r.CONNECTED=1]="CONNECTED",r[r.CAN_CONNECT=2]="CAN_CONNECT",r[r.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(Vb||(Vb={}));(function(r){r.codec=()=>Bn(Vb)})(uh||(uh={}));var rd;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.multiaddrs!=null)for(const s of t.multiaddrs)n.uint32(18),n.bytes(s);t.connection!=null&&(n.uint32(24),uh.codec().encode(t.connection,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={id:tt(0),multiaddrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.id=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.multiaddrs)!=null&&s.multiaddrs.length===i.limits.multiaddrs)throw new xt('Decode error - map field "multiaddrs" had too many elements');s.multiaddrs.push(t.bytes());break}case 3:{s.connection=uh.codec().decode(t);break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(rd||(rd={}));var Rl;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.type!=null&&Sm[t.type]!==0&&(n.uint32(8),Dt.codec().encode(t.type,n)),t.clusterLevel!=null&&(n.uint32(80),n.int32(t.clusterLevel)),t.key!=null&&(n.uint32(18),n.bytes(t.key)),t.record!=null&&(n.uint32(26),n.bytes(t.record)),t.closer!=null)for(const s of t.closer)n.uint32(66),rd.codec().encode(s,n);if(t.providers!=null)for(const s of t.providers)n.uint32(74),rd.codec().encode(s,n);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,d;const s={type:Dt.PUT_VALUE,closer:[],providers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const h=t.uint32();switch(h>>>3){case 1:{s.type=Dt.codec().decode(t);break}case 10:{s.clusterLevel=t.int32();break}case 2:{s.key=t.bytes();break}case 3:{s.record=t.bytes();break}case 8:{if(((a=i.limits)==null?void 0:a.closer)!=null&&s.closer.length===i.limits.closer)throw new xt('Decode error - map field "closer" had too many elements');s.closer.push(rd.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.closer$}));break}case 9:{if(((l=i.limits)==null?void 0:l.providers)!=null&&s.providers.length===i.limits.providers)throw new xt('Decode error - map field "providers" had too many elements');s.providers.push(rd.codec().decode(t,t.uint32(),{limits:(d=i.limits)==null?void 0:d.providers$}));break}default:{t.skipType(h&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(Rl||(Rl={}));function oP(r,e={}){var n;const t={...r,name:"SEND_QUERY",type:0,messageName:r.type,messageType:r.type};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:send-query",{detail:t})),t}function Kb(r,e={}){var n;const t={...r,name:"PEER_RESPONSE",type:1,messageName:r.messageType,closer:r.closer??[],providers:r.providers??[]};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:peer-response",{detail:t})),t}function m6(r,e={}){var n;const t={...r,name:"FINAL_PEER",type:2};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:final-peer",{detail:t})),t}function Dc(r,e={}){var n;const t={...r,name:"QUERY_ERROR",type:3};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:query-error",{detail:t})),t}function aP(r,e={}){var n;const t={...r,name:"PROVIDER",type:4};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:provider",{detail:t})),t}function Hb(r,e={}){var n;const t={...r,name:"VALUE",type:5};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:value",{detail:t})),t}function cP(r,e={}){var n;const t={...r,name:"DIAL_PEER",type:7};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:dial-peer",{detail:t})),t}function kwe(r,e,t){if(t.length===0)throw new ie("No records given");const i=ae(e).split("/");if(i.length<3)throw new ie("Record key does not have a selector function");const s=r[i[1].toString()];if(s==null)throw new Cwe(`No selector function configured for key type "${i[1]}"`);return t.length===1?0:s(e,t)}function _we(r,e){return 0}const Twe={pk:_we};async function _x(r,e){const t=e.key,i=ae(t).split("/");if(i.length<3)return;const s=r[i[1].toString()];if(s==null)throw new ie(`No validator available for key type "${i[1]}"`);await s(t,e.value)}const Pwe=async(r,e)=>{if(!(r instanceof Uint8Array))throw new ie('"key" must be a Uint8Array');if(r.byteLength<5)throw new ie("Invalid public key record");if(ae(r.subarray(0,4))!=="/pk/")throw new ie("key was not prefixed with /pk/");const n=Un(e),i=r.slice(4);if(!Xe(i,n.toMultihash().bytes))throw new ie("public key does not match passed in key")},Dwe={pk:Pwe};function $we(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Tx(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Nwe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var Owe=Nwe,Mwe=Owe;let Rwe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Lwe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return oK(this,e)}},Bwe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return oK(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function oK(r,e){return new Bwe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Uwe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Rwe(e,t,n),this.decoder=new Lwe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function aK({name:r,prefix:e,encode:t,decode:n}){return new Uwe(r,e,t,n)}function Kw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Mwe(t,r);return aK({prefix:e,name:r,encode:n,decode:s=>Tx(i(s))})}function Fwe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function zwe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function oa({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return aK({prefix:e,name:r,encode(i){return zwe(i,n,t)},decode(i){return Fwe(i,n,t,r)}})}const d2=oa({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});oa({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});oa({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});oa({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});oa({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});oa({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});oa({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});oa({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});oa({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const w6=Kw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Kw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const La=Kw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Kw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Vwe=cK,lP=128,Kwe=-128,Hwe=Math.pow(2,31);function cK(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Hwe;)e[t++]=r&255|lP,r/=128;for(;r&Kwe;)e[t++]=r&255|lP,r>>>=7;return e[t]=r|0,cK.bytes=t-n+1,e}var jwe=jb,qwe=128,uP=127;function jb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw jb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&uP)<<i:(o&uP)*Math.pow(2,i),i+=7}while(o>=qwe);return jb.bytes=s-n,t}var Wwe=Math.pow(2,7),Gwe=Math.pow(2,14),Qwe=Math.pow(2,21),Ywe=Math.pow(2,28),Xwe=Math.pow(2,35),Jwe=Math.pow(2,42),Zwe=Math.pow(2,49),e4e=Math.pow(2,56),t4e=Math.pow(2,63),r4e=function(r){return r<Wwe?1:r<Gwe?2:r<Qwe?3:r<Ywe?4:r<Xwe?5:r<Jwe?6:r<Zwe?7:r<e4e?8:r<t4e?9:10},n4e={encode:Vwe,decode:jwe,encodingLength:r4e},xm=n4e;function qb(r,e=0){return[xm.decode(r,e),xm.decode.bytes]}function Am(r,e,t=0){return xm.encode(r,e,t),e}function Im(r){return xm.encodingLength(r)}function Wb(r,e){const t=e.byteLength,n=Im(r),i=n+Im(t),s=new Uint8Array(i+t);return Am(r,s,0),Am(t,s,n),s.set(e,i),new Px(r,t,e,s)}function Eu(r){const e=Tx(r),[t,n]=qb(e),[i,s]=qb(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Px(t,i,o,e)}function i4e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&$we(r.bytes,t.bytes)}}let Px=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function dP(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return o4e(t,Gb(r),e??La.encoder);default:return a4e(t,Gb(r),e??d2.encoder)}}const hP=new WeakMap;function Gb(r){const e=hP.get(r);if(e==null){const t=new Map;return hP.set(r,t),t}return e}var VN;let Dx=class Xr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,VN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Nf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==c4e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Xr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Wb(e,t);return Xr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Xr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&i4e(e.multihash,n.multihash)}toString(e){return dP(this,e)}toJSON(){return{"/":dP(this)}}link(){return this}[(VN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Xr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Xr(n,i,s,o??fP(n,i,s.bytes))}else if(t[l4e]===!0){const{version:n,multihash:i,code:s}=t,o=Eu(i);return Xr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Nf)throw new Error(`Version 0 CID must use dag-pb (code: ${Nf}) block encoding`);return new Xr(e,t,n,n.bytes)}case 1:{const i=fP(e,t,n.bytes);return new Xr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Xr.create(0,Nf,e)}static createV1(e,t){return Xr.create(1,e,t)}static decode(e){const[t,n]=Xr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Xr.inspectBytes(e),n=t.size-t.multihashSize,i=Tx(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new Px(t.multihashCode,t.digestSize,s,i);return[t.version===0?Xr.createV0(o):Xr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=qb(e.subarray(t));return t+=p,h};let i=n(),s=Nf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=s4e(e,t),s=Xr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Gb(s).set(n,e),s}};function s4e(r,e){switch(r[0]){case"Q":{const t=e??La;return[La.prefix,t.decode(`${La.prefix}${r}`)]}case La.prefix:{const t=e??La;return[La.prefix,t.decode(r)]}case d2.prefix:{const t=e??d2;return[d2.prefix,t.decode(r)]}case w6.prefix:{const t=e??w6;return[w6.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function o4e(r,e,t){const{prefix:n}=t;if(n!==La.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function a4e(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Nf=112,c4e=18;function fP(r,e,t){const n=Im(r),i=n+Im(e),s=new Uint8Array(i+t.byteLength);return Am(r,s,0),Am(e,s,n),s.set(t,i),s}const l4e=Symbol.for("@ipld/js-cid/CID"),u4e=85;function d4e({name:r,code:e,encode:t}){return new h4e(r,e,t)}let h4e=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Wb(this.code,t):t.then(n=>Wb(this.code,n))}else throw Error("Unknown type, must be binary type")}};function f4e(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const lK=d4e({name:"sha2-256",code:18,encode:f4e("SHA-256")}),p4e=fe("/pk/");function g4e(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{const[[t,n]]=e.stringTuples();if(t===53||t===54||t===55)return n!=="localhost";if(t!==4&&t!==6||n==null)return!1;const i=Vc(n);return i==null?!0:!i})}}async function sp(r){return(await lK.digest(r)).digest}async function ys(r){return sp(r.toMultihash().bytes)}function d1(r,e){return new _t(`${r}/${ae(e,"base32")}`,!1)}function y4e(r){return ur([p4e,r.toMultihash().bytes])}function m4e(r){return ae(r.subarray(0,4))==="/pk/"}function w4e(r){const e=Eu(r.subarray(4));return li(e)}function pP(r,e){const t=new Date;return new Mi(r,e,t).serialize()}const v4e=290,b4e=54,E4e=55,S4e=56,x4e=4,A4e=41;function I4e(r){const e=r.stringTuples();for(const t of e)if(t[0]===v4e)return!1;if(e[0][0]===b4e||e[0][0]===E4e||e[0][0]===S4e)return!0;if(e[0][0]===x4e||e[0][0]===A4e){const t=Vc(`${e[0][1]}`);return t==null||!t}return!1}function uK(r){const e=r.toString().split("/"),t=e.pop(),n=e.pop();if(t==null||n==null)throw new Error(`incorrectly formatted provider entry key in datastore: ${r.toString()}`);return{cid:Dx.createV1(u4e,Eu(fe(n,"base32"))),peerId:Zt(t)}}function v6(r,e,t){const n=typeof e=="string"?e:ae(e.multihash.bytes,"base32"),i=[r,n];return t!=null&&i.push(t.toString()),new _t(i.join("/"))}function dK(r){return new Date(ms(r))}function Uu(r,e,t){return async function*(...n){var a,c,l,d,h;const i=(a=e.queryTime)==null?void 0:a.timer(t),s=(c=e.errorTime)==null?void 0:c.timer(t);let o=!1;try{(l=e.queries)==null||l.increment({[t]:!0}),yield*r(...n)}catch(p){throw o=!0,s==null||s(),(d=e.errors)==null||d.increment({[t]:!0}),p}finally{(h=e.queries)==null||h.decrement({[t]:!0}),o||i==null||i()}}}function hK(r,e,t){return async function(...n){var a,c,l,d,h;const i=(a=e==null?void 0:e.queryTime)==null?void 0:a.timer(t),s=(c=e==null?void 0:e.errorTime)==null?void 0:c.timer(t);let o=!1;try{return(l=e.queries)==null||l.increment({[t]:!0}),await r(...n)}catch(p){throw o=!0,s==null||s(),(d=e.errors)==null||d.increment({[t]:!0}),p}finally{(h=e.queries)==null||h.decrement({[t]:!0}),o||i==null||i()}}}class C4e{constructor(e,t){u(this,"log");u(this,"components");u(this,"validators");u(this,"selectors");u(this,"peerRouting");u(this,"queryManager");u(this,"network");u(this,"datastorePrefix");var l,d;const{validators:n,selectors:i,peerRouting:s,queryManager:o,network:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-fetching`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n,this.selectors=i,this.peerRouting=s,this.queryManager=o,this.network=a,this.get=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.get",this.get.bind(this),{optionsIndex:1}))??this.get,this.put=((d=e.metrics)==null?void 0:d.traceFunction("libp2p.kadDHT.put",this.put.bind(this),{optionsIndex:2}))??this.put}async getLocal(e){this.log("getLocal %b",e);const t=d1(this.datastorePrefix,e);this.log("fetching record for key %k",t);const n=await this.components.datastore.get(t);this.log("found %k in local datastore",t);const i=Mi.deserialize(n);return await _x(this.validators,i),i}async*sendCorrectionRecord(e,t,n,i={}){this.log("sendCorrection for %b",e);const s=pP(e,n);for(const{value:o,from:a}of t){if(Xe(o,n)){this.log("record was ok");continue}if(this.components.peerId.equals(a)){try{const d=d1(this.datastorePrefix,e);this.log(`Storing corrected record for key ${d.toString()}`),await this.components.datastore.put(d,s.subarray())}catch(d){this.log.error("Failed error correcting self",d)}continue}let c=!1;const l={type:Dt.PUT_VALUE,key:e,record:s};for await(const d of this.network.sendRequest(a,l,i))d.name==="PEER_RESPONSE"&&d.record!=null&&Xe(d.record.value,Mi.deserialize(s).value)&&(c=!0),yield d;c||(yield Dc({from:a,error:new Em("Value not put correctly")},i)),this.log.error("Failed error correcting entry")}}async*put(e,t,n={}){this.log("put key %b value %b",e,t);const i=pP(e,t),s=d1(this.datastorePrefix,e);this.log(`storing record for key ${s.toString()}`),await this.components.datastore.put(s,i.subarray()),yield*gn(this.peerRouting.getClosestPeers(e,{...n,signal:n.signal}),o=>Oh(o,a=>async()=>{if(a.name!=="FINAL_PEER")return[a];const c=[],l={type:Dt.PUT_VALUE,key:e,record:i};this.log("send put to %p",a.peer.id);for await(const d of this.network.sendRequest(a.peer.id,l,n))c.push(d),d.name==="PEER_RESPONSE"&&(d.record!=null&&Xe(d.record.value,Mi.deserialize(i).value)||c.push(Dc({from:a.peer.id,error:new Em("Value not put correctly")},n)));return c}),o=>Jp(o,{ordered:!1,concurrency:kx}),async function*(o){for await(const a of o)yield*a})}async*get(e,t={}){this.log("get %b",e);const n=[];for await(const a of this.getMany(e,t))a.name==="VALUE"&&n.push(a),yield a;if(n.length===0)return;const i=n.map(a=>a.value);let s=0;try{s=kwe(this.selectors,e,i)}catch(a){if(a.name!=="InvalidParametersError")throw a}const o=i[s];if(this.log("GetValue %b %b",e,o),o==null)throw new sr("Best value was not found");yield*this.sendCorrectionRecord(e,n,o,t),yield n[s]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{const s=await this.getLocal(e);yield Hb({value:s.value,from:this.components.peerId},t)}catch(s){this.log("error getting local value for %b",e,s)}const n=this,i=async function*({peer:s,signal:o}){for await(const a of n.peerRouting.getValueOrPeers(s,e,{...t,signal:o}))yield a,a.name==="PEER_RESPONSE"&&a.record!=null&&(yield Hb({from:s,value:a.record.value},t))};yield*this.queryManager.run(e,i,t)}}function k4e(r,e){return{id:r.id.toMultihash().bytes,multiaddrs:(r.multiaddrs??[]).map(n=>n.bytes),connection:e}}function mg(r){if(r.id==null)throw new Error("Invalid peer in message");const e=Eu(r.id);return{id:li(e),multiaddrs:(r.multiaddrs??[]).map(t=>Fe(t))}}class _4e{constructor(e,t){u(this,"log");u(this,"components");u(this,"network");u(this,"peerRouting");u(this,"queryManager");u(this,"routingTable");u(this,"providers");var l,d;const{network:n,peerRouting:i,queryManager:s,routingTable:o,providers:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-routing`),this.network=n,this.peerRouting=i,this.queryManager=s,this.routingTable=o,this.providers=a,this.findProviders=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(h,p)=>(h.name==="PROVIDER"&&(p.providers??(p.providers=[]),p.providers.push(...h.providers.map(w=>w.id.toString()))),p)}))??this.findProviders,this.provide=((d=e.metrics)==null?void 0:d.traceFunction("libp2p.kadDHT.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(h,p)=>(h.name==="PEER_RESPONSE"&&h.messageName==="ADD_PROVIDER"&&(p.providers??(p.providers=[]),p.providers.push(h.from.toString())),p)}))??this.provide}async*provide(e,t,n={}){this.log("provide %s",e);const i=e.multihash.bytes;await this.providers.addProvider(e,this.components.peerId);const s={type:Dt.ADD_PROVIDER,key:i,providers:[k4e({id:this.components.peerId,multiaddrs:t})]};let o=0;const a=c=>async()=>{if(c.name!=="FINAL_PEER")return[c];const l=[];this.log("putProvider %s to %p",e,c.peer.id);try{this.log("sending provider record for %s to %p",e,c.peer.id);for await(const d of this.network.sendMessage(c.peer.id,s,n))d.name==="PEER_RESPONSE"&&(this.log("sent provider record for %s to %p",e,c.peer.id),o++),l.push(d)}catch(d){this.log.error("error sending provide record to peer %p",c.peer.id,d),l.push(Dc({from:c.peer.id,error:d},n))}return l};yield*gn(this.peerRouting.getClosestPeers(i,n),c=>Oh(c,l=>a(l)),c=>Jp(c,{ordered:!1,concurrency:kx}),async function*(c){for await(const l of c)yield*l}),this.log("sent provider records to %d peers",o)}async*findProviders(e,t){const n=this.routingTable.kBucketSize;let i=0;const s=e.multihash.bytes,o=this;this.log("findProviders %c",e);const a=await this.providers.getProviders(e);if(a.length>0){const d=[];for(const h of a.slice(0,n))try{const p=await this.components.peerStore.get(h);d.push({id:h,multiaddrs:p.addresses.map(({multiaddr:w})=>w)})}catch(p){if(p.name!=="NotFoundError")throw p;this.log("no peer store entry for %p",h)}if(yield Kb({from:this.components.peerId,messageType:Dt.GET_PROVIDERS,providers:d},t),yield aP({from:this.components.peerId,providers:d},t),i+=d.length,i>=n)return}const c=async function*({peer:d,signal:h}){const p={type:Dt.GET_PROVIDERS,key:s};yield*o.network.sendRequest(d,p,{...t,signal:h})},l=new us(a);for await(const d of this.queryManager.run(s,c,t))if(yield d,d.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",d.providers.length,e,d.closer.length);const h=[];for(const p of d.providers)l.has(p.id)||(l.add(p.id),h.push(p));if(h.length>0&&(yield aP({from:d.from,providers:h},t),i+=h.length,i>=n))return}}}class b6{constructor(e){u(this,"movingAverage");u(this,"variance");u(this,"deviation");u(this,"forecast");u(this,"timeSpan");u(this,"previousTime");this.timeSpan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timeSpan)}push(e,t=Date.now()){if(this.previousTime!=null){const n=this.alpha(t,this.previousTime),i=e-this.movingAverage,s=n*i;this.movingAverage=n*e+(1-n)*this.movingAverage,this.variance=(1-n)*(this.variance+i*s),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+n*i}else this.movingAverage=e;this.previousTime=t}}const T4e=1.2,P4e=2,D4e=2e3;class op{constructor(e={}){u(this,"success");u(this,"failure");u(this,"next");u(this,"metric");u(this,"timeoutMultiplier");u(this,"failureMultiplier");u(this,"minTimeout");var t;this.success=new b6(e.interval??5e3),this.failure=new b6(e.interval??5e3),this.next=new b6(e.interval??5e3),this.failureMultiplier=e.failureMultiplier??P4e,this.timeoutMultiplier=e.timeoutMultiplier??T4e,this.minTimeout=e.minTimeout??D4e,e.metricName!=null&&(this.metric=(t=e.metrics)==null?void 0:t.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){const t=Math.max(Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier)),this.minTimeout),n=AbortSignal.timeout(t),i=bt([e.signal,n]);return i.start=Date.now(),i.timeout=t,i}cleanUp(e){var n,i;const t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),(n=this.metric)==null||n.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),(i=this.metric)==null||i.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}}class $4e{constructor(){u(this,"readNext");u(this,"haveNext");u(this,"ended");u(this,"nextResult");this.ended=!1,this.readNext=Ve(),this.haveNext=Ve()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Ve(),e}async throw(e){return this.ended=!0,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Ve(),await dn(this.readNext.promise,t==null?void 0:t.signal,t)}}function N4e(){return new $4e}let O4e=class extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}};class M4e extends Error{constructor(t,n){super(t);u(this,"code");this.code=n}}let R4e=class extends M4e{constructor(t){super(t,"ABORT_ERR");u(this,"type");this.type="aborted",this.name="AbortError"}};function L4e(r,e){const t=N4e();r.sink(t).catch(async o=>{await t.end(o)}),r.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());const i=new He;return{read:async(o,a)=>{var d,h;(d=a==null?void 0:a.signal)==null||d.throwIfAborted();let c;const l=new Promise((p,w)=>{var f;c=()=>{w(new R4e("Read aborted"))},(f=a==null?void 0:a.signal)==null||f.addEventListener("abort",c)});try{if(o==null){const{done:w,value:f}=await Promise.race([n.next(),l]);return w===!0?new He:f}for(;i.byteLength<o;){const{value:w,done:f}=await Promise.race([n.next(),l]);if(f===!0)throw new O4e("unexpected end of input");i.append(w)}const p=i.sublist(0,o);return i.consume(o),p}finally{c!=null&&((h=a==null?void 0:a.signal)==null||h.removeEventListener("abort",c))}},write:async(o,a)=>{var c;(c=a==null?void 0:a.signal)==null||c.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(i.byteLength>0){const o=r.source;r.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield i:yield*i,yield*o}()}return r}}}let B4e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}},U4e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}},F4e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}};function z4e(r,e={}){const t=L4e(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=At(e.maxDataLength));const n=(e==null?void 0:e.lengthDecoder)??ms,i=(e==null?void 0:e.lengthEncoder)??kr;return{read:async o=>{let a=-1;const c=new He;for(;;){c.append(await t.read(1,o));try{a=n(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new B4e("Invalid message length");if((e==null?void 0:e.maxLengthLength)!=null&&c.byteLength>e.maxLengthLength)throw new F4e("message length length too long");if(a>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&a>e.maxDataLength)throw new U4e("message length too long");return t.read(a,o)},write:async(o,a)=>{await t.write(new He(i(o.byteLength),o),a)},writeV:async(o,a)=>{const c=new He(...o.flatMap(l=>[i(l.byteLength),l]));await t.write(c,a)},unwrap:()=>t.unwrap()}}function gP(r,e){const t=z4e(r,e),n={read:async(i,s)=>{const o=await t.read(s);return i.decode(o)},write:async(i,s,o)=>{await t.write(s.encode(i),o)},writeV:async(i,s,o)=>{await t.writeV(i.map(a=>s.encode(a)),o)},pb:i=>({read:async s=>n.read(i,s),write:async(s,o)=>n.write(s,i,o),writeV:async(s,o)=>n.writeV(s,i,o),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}class V4e extends tr{constructor(t,n){var i,s,o,a;super();u(this,"log");u(this,"protocol");u(this,"running");u(this,"components");u(this,"timeout");u(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${n.logPrefix}:network`),this.running=!1,this.protocol=n.protocol,this.timeout=new op({...n.timeout??{},metrics:t.metrics,metricName:`${n.metricsPrefix}_network_message_send_times_milliseconds`}),this.metrics={operations:(i=t.metrics)==null?void 0:i.registerCounterGroup(`${n.metricsPrefix}_outbound_rpc_requests_total`),errors:(s=t.metrics)==null?void 0:s.registerCounterGroup(`${n.metricsPrefix}_outbound_rpc_errors_total`)},this.sendRequest=((o=t.metrics)==null?void 0:o.traceFunction("libp2p.kadDHT.sendRequest",this.sendRequest.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],d){return{...d,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((d,h)=>{l[`providers-${h}`]=d.id.toString()}),c.closer.length>0&&c.closer.forEach((d,h)=>{l[`closer-${h}`]=d.id.toString()})),l)}))??this.sendRequest,this.sendMessage=((a=t.metrics)==null?void 0:a.traceFunction("libp2p.kadDHT.sendMessage",this.sendMessage.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],d){return{...d,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((d,h)=>{l[`providers-${h}`]=d.id.toString()}),c.closer.length>0&&c.closer.forEach((d,h)=>{l[`closer-${h}`]=d.id.toString()})),l)}))??this.sendMessage}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(t,n,i={}){var c,l,d;if(!this.running)return;const s=n.type;if(s==null)throw new ie("Message type was missing");this.log("sending %s to %p",n.type,t),yield cP({peer:t},i),yield oP({to:t,type:s},i);let o;const a=this.timeout.getTimeoutSignal(i);i={...i,signal:a};try{(c=this.metrics.operations)==null||c.increment({[s]:!0}),o=await(await this.components.connectionManager.openConnection(t,i)).newStream(this.protocol,i);const p=await this._writeReadMessage(o,n,i);o.close(i).catch(w=>{this.log.error("error closing stream to %p",t,w),o==null||o.abort(w)}),yield Kb({from:t,messageType:p.type,closer:p.closer.map(mg),providers:p.providers.map(mg),record:p.record==null?void 0:Mi.deserialize(p.record)},i)}catch(h){(l=this.metrics.errors)==null||l.increment({[s]:!0}),o==null||o.abort(h),((d=i.signal)==null?void 0:d.aborted)!==!0&&this.log.error("could not send %s to %p - %e",n.type,t,h),yield Dc({from:t,error:h},i)}finally{this.timeout.cleanUp(a)}}async*sendMessage(t,n,i={}){var c,l;if(!this.running)return;const s=n.type;if(s==null)throw new ie("Message type was missing");this.log("sending %s to %p",n.type,t),yield cP({peer:t},i),yield oP({to:t,type:s},i);let o;const a=this.timeout.getTimeoutSignal(i);i={...i,signal:a};try{(c=this.metrics.operations)==null||c.increment({[s]:!0}),o=await(await this.components.connectionManager.openConnection(t,i)).newStream(this.protocol,i),await this._writeMessage(o,n,i),o.close(i).catch(h=>{this.log.error("error closing stream to %p",t,h),o==null||o.abort(h)}),yield Kb({from:t,messageType:s},i)}catch(d){(l=this.metrics.errors)==null||l.increment({[s]:!0}),o==null||o.abort(d),yield Dc({from:t,error:d},i)}finally{this.timeout.cleanUp(a)}}async _writeMessage(t,n,i){await gP(t).write(n,Rl,i)}async _writeReadMessage(t,n,i){const s=gP(t);await s.write(n,Rl,i);const o=await s.read(Rl,i);return o.closer.forEach(a=>{this.safeDispatchEvent("peer",{detail:mg(a)})}),o.providers.forEach(a=>{this.safeDispatchEvent("peer",{detail:mg(a)})}),o}}function ap(r,e){if(r.byteLength!==e.byteLength)throw new Error("Inputs should have the same length");for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}class $x{constructor(e,t){u(this,"originDhtKey");u(this,"capacity");u(this,"peerDistances");this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peer)}async add(e){const t=await ys(e.id);this.addWithKadId(e,t)}addWithKadId(e,t){if(this.peerDistances.find(s=>s.peer.id.equals(e.id))!=null)return;const n={peer:e,distance:_c(this.originDhtKey,t)};let i=!1;for(let s=0;s<this.peerDistances.length;s++){const o=ap(this.peerDistances[s].distance,n.distance);if(o===0||o===1){i=!0,this.peerDistances.splice(s,0,n);break}}i||this.peerDistances.push(n),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async isCloser(e){if(this.length===0)return!0;const t=await ys(e),n=_c(t,this.originDhtKey),i=this.peerDistances[this.peerDistances.length-1].distance;return ap(n,i)===-1}async anyCloser(e){return e.length===0?!1:Promise.any(e.map(async t=>this.isCloser(t)))}}class K4e{constructor(e,t){u(this,"log");u(this,"routingTable");u(this,"network");u(this,"validators");u(this,"queryManager");u(this,"peerStore");u(this,"peerId");var n,i;this.routingTable=t.routingTable,this.network=t.network,this.validators=t.validators,this.queryManager=t.queryManager,this.peerStore=e.peerStore,this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:peer-routing`),this.findPeer=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.kadDHT.findPeer",this.findPeer.bind(this),{optionsIndex:1}))??this.findPeer,this.getClosestPeers=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.kadDHT.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1}))??this.getClosestPeers}async findPeerLocal(e){let t;const n=await this.routingTable.find(e);if(n!=null){this.log("findPeerLocal found %p in routing table",e);try{t=await this.peerStore.get(n)}catch(i){if(i.name!=="NotFoundError")throw i}}if(t==null)try{t=await this.peerStore.get(e)}catch(i){if(i.name!=="NotFoundError")throw i}if(t!=null)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(i=>i.multiaddr)}}async*_getValueSingle(e,t,n={}){const i={type:Dt.GET_VALUE,key:t};yield*this.network.sendRequest(e,i,n)}async*getPublicKeyFromNode(e,t={}){const n=y4e(e);for await(const i of this._getValueSingle(e,n,t))if(yield i,i.name==="PEER_RESPONSE"&&i.record!=null){const s=Un(i.record.value),o=Xd(s);if(!o.equals(e))throw new V1("public key does not match id");if(o.publicKey==null)throw new V1("public key missing");yield Hb({from:e,value:i.record.value},t)}throw new Em(`Node not responding with its public key: ${e.toString()}`)}async*findPeer(e,t={}){if(this.log("findPeer %p",e),t.useCache!==!1){const i=await this.findPeerLocal(e);if(i!=null){this.log("found local"),yield m6({from:this.peerId,peer:i},t);return}}let n=!1;if(t.useNetwork!==!1){const i=this,s=async function*({peer:o,signal:a}){const c={type:Dt.FIND_NODE,key:e.toMultihash().bytes};for await(const l of i.network.sendRequest(o,c,{...t,signal:a}))if(yield l,l.name==="PEER_RESPONSE"){const d=l.closer.find(h=>h.id.equals(e));d!=null&&(yield m6({from:l.from,peer:d},t))}};for await(const o of this.queryManager.run(e.toMultihash().bytes,s,t))o.name==="FINAL_PEER"&&(n=!0),yield o}n||(yield Dc({from:this.peerId,error:new sr("Not found")},t))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);const n=await sp(e),i=this.routingTable.closestPeers(n),s=this,o=new $x(n,this.routingTable.kBucketSize);await Promise.all(i.map(async c=>{await o.add({id:c,multiaddrs:[]})}));const a=async function*({peer:c,signal:l}){s.log("closerPeersSingle %s from %p",ae(e,"base32"),c);const d={type:Dt.FIND_NODE,key:e};yield*s.network.sendRequest(c,d,{...t,signal:l})};for await(const c of this.queryManager.run(e,a,t))c.name==="PEER_RESPONSE"&&await Promise.all(c.closer.map(async l=>{await o.add(l)})),yield c;this.log("found %d peers close to %b",o.length,e);for(const c of o.peers)yield m6({from:this.peerId,peer:c},t)}async*getValueOrPeers(e,t,n={}){for await(const i of this._getValueSingle(e,t,n)){if(i.name==="PEER_RESPONSE"&&i.record!=null)try{await this._verifyRecordOnline(i.record)}catch{const o="invalid record received, discarded";this.log(o),yield Dc({from:i.from,error:new Em(o)},n);continue}yield i}}async _verifyRecordOnline(e){if(e.timeReceived==null)throw new Iwe("invalid record received");await _x(this.validators,new Mi(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){const n=[];try{const c=Eu(e),l=li(c),d=await this.peerStore.get(l);n.push({id:d.id,multiaddrs:d.addresses.map(({multiaddr:h})=>h)})}catch{}const i=await sp(e),s=this.routingTable.closestPeers(i),o=await ys(t),a=_c(o,i);for(const c of s){const l=await ys(c),d=_c(l,i);if(ap(d,a)===-1)try{const h=await this.peerStore.get(c);n.push({id:c,multiaddrs:h.addresses.map(({multiaddr:p})=>p)})}catch(h){if(h.name!=="NotFoundError")throw h}}return n.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",n.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p with %d peers in the routing table",e,t,this.routingTable.size),n}}class H4e{constructor(e,t){u(this,"log");u(this,"datastore");u(this,"datastorePrefix");u(this,"lock");this.log=e.logger.forComponent(`${t.logPrefix}:providers`),this.datastorePrefix=`${t.datastorePrefix}/provider`,this.datastore=e.datastore,this.lock=t.lock}async addProvider(e,t){const n=await this.lock.readLock();try{this.log("%p provides %s",t,e),await this.writeProviderEntry(e,t)}finally{n()}}async removeProvider(e,t){const n=await this.lock.writeLock();try{const i=v6(this.datastorePrefix,e,t);this.log("%p no longer provides %s",t,e),await this.datastore.delete(i)}finally{n()}}async getProviders(e){const t=await this.lock.readLock();try{this.log("get providers for %c",e);const n=await this.loadProviders(e);return this.log("got %d providers for %c",n.size,e),[...n.keys()]}finally{t()}}async writeProviderEntry(e,t,n=new Date){const i=v6(this.datastorePrefix,e,t),s=kr(n.getTime());await this.datastore.put(i,s)}async loadProviders(e){const t=new zc,n=v6(this.datastorePrefix,e);for await(const i of this.datastore.query({prefix:n.toString()})){const{peerId:s}=uK(i.key);t.set(s,dK(i.value))}return t}}async function*j4e(r){const{key:e,startingPeer:t,ourPeerId:n,signal:i,query:s,alpha:o,pathIndex:a,numPaths:c,queryFuncTimeout:l,log:d,peersSeen:h,connectionManager:p}=r,w=new Gl({concurrency:o,sort:(v,y)=>ap(v.options.distance,y.options.distance)}),f=await sp(e);function g(v,y){if(v==null)return;h.add(v);const m=_c(y,f);w.add(async()=>{const b=[i];l!=null&&b.push(AbortSignal.timeout(l));const S=bt(b);try{for await(const I of s({...r,key:e,peer:v,signal:S,pathIndex:a,numPaths:c})){if(S.aborted)return;if(I.name==="PEER_RESPONSE")for(const T of I.closer){if(h.has(T.id)){d.trace("already seen %p in query",T.id);continue}if(n.equals(T.id)){d("not querying ourselves");continue}if(!await p.isDialable(T.multiaddrs)){d("not querying undialable peer");continue}const A=await ys(T.id),_=_c(A,f);if(ap(_,m)!==-1){d.trace("skipping %p as they are not closer to %b than %p",T.id,e,v);continue}d.trace("querying closer peer %p",T.id),g(T.id,A)}w.safeDispatchEvent("completed",{detail:I})}}catch(I){if(!i.aborted)return Dc({from:v,error:I},r)}finally{S.clear()}},{distance:m}).catch(b=>{d.error(b)})}g(t,await ys(t));try{for await(const v of w.toGenerator({signal:i}))v!=null&&(yield v)}catch(v){throw i.aborted?new Awe("Query aborted"):v}}class q4e{constructor(e,t){u(this,"disjointPaths");u(this,"alpha");u(this,"shutDownController");u(this,"running");u(this,"logger");u(this,"peerId");u(this,"connectionManager");u(this,"routingTable");u(this,"initialQuerySelfHasRun");u(this,"logPrefix");this.logPrefix=t.logPrefix,this.disjointPaths=t.disjointPaths??sK,this.alpha=t.alpha??kx,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.shutDownController=new AbortController,this.shutDownController.signal,this.running=!1}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutDownController=new AbortController,this.shutDownController.signal,void 0)}async stop(){this.running=!1,this.shutDownController.abort()}async*run(e,t,n={}){if(!this.running)throw new Error("QueryManager not started");if(n.signal==null){const c=AbortSignal.timeout(Ewe);n={...n,signal:c}}const i=new AbortController,s=bt([this.shutDownController.signal,i.signal,n.signal]);i.signal;const o=this.logger.forComponent(`${this.logPrefix}:query:`+ae(e,"base58btc"));let a=!1;try{n.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(o("waiting for initial query-self query before continuing"),await dn(this.initialQuerySelfHasRun.promise,s),this.initialQuerySelfHasRun=void 0),o("query:start");const c=await sp(e),l=this.routingTable.closestPeers(c),d=l.slice(0,Math.min(this.disjointPaths,l.length));if(l.length===0){o.error("Running query with no peers");return}const h=new us,p=d.map((w,f)=>j4e({...n,key:e,startingPeer:w,ourPeerId:this.peerId,signal:s,query:t,pathIndex:f,numPaths:d.length,alpha:this.alpha,queryFuncTimeout:n.queryFuncTimeout,log:o,peersSeen:h,onProgress:n.onProgress,connectionManager:this.connectionManager}));for await(const w of lc(...p)){if(w.name==="QUERY_ERROR"&&o.error("query error",w.error),w.name==="PEER_RESPONSE")for(const f of[...w.closer,...w.providers])await this.connectionManager.isDialable(f.multiaddrs)&&await this.routingTable.add(f.id);yield w}a=!0}catch(c){if(!(!this.running&&c.name==="QueryAbortedError"))throw c}finally{a||(o("query exited early"),i.abort()),s.clear(),o("query:done")}}}function W4e(r){return r[Symbol.asyncIterator]!=null}function fK(r){if(W4e(r))return(async()=>{let e=0;for await(const t of r)e++;return e})();{let e=0;for(const t of r)e++;return e}}const G4e=r=>{const e=r.addEventListener||r.on||r.addListener,t=r.removeEventListener||r.off||r.removeListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function Q4e(r,e,t){let n;const i=new Promise((s,o)=>{var w;if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");(w=t.signal)==null||w.throwIfAborted();const a=[e].flat(),c=[],{addListener:l,removeListener:d}=G4e(r),h=(...f)=>{const g=t.multiArgs?f:f[0];t.filter&&!t.filter(g)||(c.push(g),t.count===c.length&&(n(),s(c)))},p=f=>{n(),o(f)};n=()=>{for(const f of a)d(f,h);for(const f of t.rejectionEvents)d(f,p)};for(const f of a)l(f,h);for(const f of t.rejectionEvents)l(f,p);t.signal&&t.signal.addEventListener("abort",()=>{p(t.signal.reason)},{once:!0}),t.resolveImmediately&&s(c)});if(i.cancel=n,typeof t.timeout=="number"){const s=Np(i,{milliseconds:t.timeout});return s.cancel=n,s}return i}function Y4e(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};const n=Q4e(r,e,t),i=n.then(s=>s[0]);return i.cancel=n.cancel,i}class X4e{constructor(e,t){u(this,"log");u(this,"peerId");u(this,"peerRouting");u(this,"routingTable");u(this,"count");u(this,"interval");u(this,"initialInterval");u(this,"queryTimeout");u(this,"running");u(this,"timeoutId");u(this,"controller");u(this,"initialQuerySelfHasRun");u(this,"querySelfPromise");this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:query-self`),this.running=!1,this.peerRouting=t.peerRouting,this.routingTable=t.routingTable,this.count=t.count??sK,this.interval=t.interval??ywe,this.initialInterval=t.initialInterval??mwe,this.queryTimeout=t.queryTimeout??wwe,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.querySelf=hK(this.querySelf.bind(this),t.operationMetrics,"SELF_QUERY")}isStarted(){return this.running}start(){this.running||(this.running=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.initialInterval))}stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}async querySelf(){if(!this.running){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=Ve(),this.running){this.controller=new AbortController;const e=[this.controller.signal];if(this.initialQuerySelfHasRun==null){const n=AbortSignal.timeout(this.queryTimeout);e.push(n)}const t=bt(e);this.controller.signal;try{this.routingTable.size===0&&(this.log("routing table was empty, waiting for some peers before running query"),await Y4e(this.routingTable,"peer:add",{signal:t,filter:s=>!this.peerId.equals(s.detail)}),this.log("routing table has peers, continuing with query")),this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);const n=Date.now(),i=await gn(this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes,{signal:t,isSelfQuery:!0}),s=>my(s,this.count),async s=>fK(s));this.log("self-query found %d peers in %dms",i,Date.now()-n)}catch(n){this.log.error("self-query error",n)}finally{t.clear(),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.running&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.interval))}}class J4e extends tr{constructor(t,n){super();u(this,"log");u(this,"reprovideQueue");u(this,"maxQueueSize");u(this,"datastore");u(this,"timeout");u(this,"reprovideTimeout");u(this,"running");u(this,"shutdownController");u(this,"reprovideThreshold");u(this,"contentRouting");u(this,"datastorePrefix");u(this,"addressManager");u(this,"validity");u(this,"interval");u(this,"lock");u(this,"peerId");this.log=t.logger.forComponent(`${n.logPrefix}:reprovider`),this.peerId=t.peerId,this.reprovideQueue=new Gl({concurrency:n.concurrency??fwe,metrics:t.metrics,metricName:`${n.metricsPrefix}_reprovide_queue`}),this.reprovideTimeout=new op({...n.timeout??{},metrics:t.metrics,metricName:`${n.metricsPrefix}_reprovide_timeout_milliseconds`}),this.datastore=t.datastore,this.addressManager=t.addressManager,this.datastorePrefix=`${n.datastorePrefix}/provider`,this.reprovideThreshold=n.threshold??hwe,this.maxQueueSize=n.maxQueueSize??pwe,this.validity=n.validity??dwe,this.interval=n.interval??gwe,this.contentRouting=n.contentRouting,this.lock=n.lock,this.running=!1,this.reprovide=hK(this.reprovide.bind(this),n.operationMetrics,"PROVIDE")}start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,this.timeout=setTimeout(()=>{this.cleanUp().catch(t=>{this.log.error("error running reprovide/cleanup - %e",t)})},this.interval))}stop(){var t;this.running=!1,this.reprovideQueue.clear(),clearTimeout(this.timeout),(t=this.shutdownController)==null||t.abort()}async cleanUp(){const t=await this.lock.writeLock();try{this.safeDispatchEvent("reprovide:start");for await(const n of this.datastore.query({prefix:this.datastorePrefix}))try{const{cid:i,peerId:s}=uK(n.key),o=dK(n.value).getTime(),a=o+this.validity,c=Date.now(),l=c>a;this.log.trace("comparing: %d < %d = %s %s",o,c-this.validity,l,l?"(expired)":""),l&&await this.datastore.delete(n.key),this.peerId.equals(s)&&c-a<this.reprovideThreshold&&this.queueReprovide(i).catch(d=>{this.log.error("could not reprovide %c - %e",i,d)})}catch(i){this.log.error("error processing datastore key %s - %e",n.key,i.message)}this.log("reprovide/cleanup successful")}finally{t(),this.safeDispatchEvent("reprovide:end"),this.running&&(this.timeout=setTimeout(()=>{this.cleanUp().catch(n=>{this.log.error("error running re-provide - %e",n)})},this.interval))}}async queueReprovide(t){var i;if(!this.running)return;this.log.trace("waiting for queue capacity before adding %c to re-provide queue",t),await this.reprovideQueue.onSizeLessThan(this.maxQueueSize);const n=this.reprovideQueue.queue.find(s=>s.options.cid.equals(t));if(n!=null)return this.log.trace("not adding %c to re-provide queue - already in queue",t),n.join();this.log.trace("adding %c to re-provide queue",t),this.reprovideQueue.add(async s=>{var a;if((a=s.signal)==null||a.throwIfAborted(),!this.running)return;this.log.trace("re-providing %c",t);const o=this.reprovideTimeout.getTimeoutSignal(s);try{await this.reprovide(s.cid,s)}finally{this.reprovideTimeout.cleanUp(o)}this.log.trace("re-provided %c",t)},{signal:(i=this.shutdownController)==null?void 0:i.signal,cid:t}).catch(s=>{this.log.error("could not re-provide key %c - %e",t,s)})}async reprovide(t,n){await Vo(this.contentRouting.provide(t,this.addressManager.getAddresses(),n))}}const Z4e=20,e8e=5e3,t8e="kad-close",r8e=50;class n8e{constructor(e,t){u(this,"routingTable");u(this,"components");u(this,"closestPeers");u(this,"newPeers");u(this,"refreshInterval");u(this,"peerSetSize");u(this,"timeout");u(this,"closeTagName");u(this,"closeTagValue");u(this,"log");u(this,"running");this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.routingTable=t.routingTable,this.refreshInterval=t.refreshInterval??e8e,this.peerSetSize=t.peerSetSize??Z4e,this.closeTagName=t.closeTagName??t8e,this.closeTagValue=t.closeTagValue??r8e,this.closestPeers=new us,this.onPeerPing=this.onPeerPing.bind(this),this.running=!1}async start(){if(this.running)return;this.running=!0;const e=await ys(this.components.peerId);this.newPeers=new $x(e,this.peerSetSize),this.routingTable.addEventListener("peer:ping",this.onPeerPing),this.timeout=setInterval(()=>{this.updatePeerTags().catch(t=>{this.log.error("error updating peer tags - %e",t)})},this.refreshInterval)}stop(){this.running=!1,this.routingTable.removeEventListener("peer:ping",this.onPeerPing),clearTimeout(this.timeout)}onPeerPing(e){var t;(t=this.newPeers)==null||t.add({id:e.detail,multiaddrs:[]}).catch(n=>{this.log.error("error adding peer to distance list - %e",n)})}async updatePeerTags(){var i;const e=new us((i=this.newPeers)==null?void 0:i.peers.map(s=>s.id)),t=e.difference(this.closestPeers),n=this.closestPeers.difference(e);this.closestPeers=e,await Promise.all([...[...t].map(async s=>{await this.components.peerStore.merge(s,{tags:{[this.closeTagName]:{value:this.closeTagValue},[iP]:{value:1}}})}),...[...n].map(async s=>{await this.components.peerStore.merge(s,{tags:{[this.closeTagName]:void 0,[iP]:void 0}})})])}}function h2(r){return Array.isArray(r==null?void 0:r.peers)}class i8e{constructor(e){u(this,"root");u(this,"localPeer");u(this,"prefixLength");u(this,"splitThreshold");u(this,"kBucketSize");u(this,"numberOfNodesToPing");u(this,"lastPingThreshold");u(this,"ping");u(this,"verify");u(this,"onAdd");u(this,"onRemove");u(this,"onMove");u(this,"addingPeerMap");this.prefixLength=e.prefixLength??a8e,this.kBucketSize=e.kBucketSize??pK,this.splitThreshold=e.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=e.numberOfOldContactsToPing??u8e,this.lastPingThreshold=e.lastPingThreshold??p8e,this.ping=e.ping,this.verify=e.verify,this.onAdd=e.onAdd,this.onRemove=e.onRemove,this.addingPeerMap=new zc,this.root={prefix:"",depth:0,peers:[]}}async addSelfPeer(e){this.localPeer={peerId:e,kadId:await ys(e),lastPing:Date.now()}}async add(e,t){const n={peerId:e,kadId:await ys(e),lastPing:0},i=this.addingPeerMap.get(e);if(i!=null)return i;try{const s=this._add(n,t);this.addingPeerMap.set(e,s),await s}finally{this.addingPeerMap.delete(e)}}async _add(e,t){var o;const n=this._determineBucket(e.kadId);if(this._indexOf(n,e.kadId)>-1)return;if(n.peers.length===this.splitThreshold&&n.depth<this.prefixLength){await this._split(n),await this._add(e,t);return}if(n.peers.length<this.kBucketSize){if(!o8e(e,this.lastPingThreshold)){n.peers.push(e),await((o=this.onAdd)==null?void 0:o.call(this,e,n));return}await this.verify(e,t)&&(e.lastPing=Date.now(),await this._add(e,t));return}const i=n.peers.filter(a=>{var c;return!(a.peerId.equals((c=this.localPeer)==null?void 0:c.peerId)||a.lastPing>Date.now()-this.lastPingThreshold)}).sort((a,c)=>a.lastPing<c.lastPing?-1:a.lastPing>c.lastPing?1:0).slice(0,this.numberOfNodesToPing);let s=!1;for await(const a of this.ping(i,t))s=!0,await this.remove(a.kadId);s&&await this._add(e,t)}*closest(e,t=this.kBucketSize){const n=new $x(e,t);for(const i of this.toIterable())n.addWithKadId({id:i.peerId,multiaddrs:[]},i.kadId);yield*Oh(n.peers,i=>i.id)}count(){function e(t){if(h2(t))return t.peers.length;let n=0;return t.left!=null&&(n+=e(t.left)),t.right!=null&&(n+=e(t.right)),n}return e(this.root)}get(e){const t=this._determineBucket(e),n=this._indexOf(t,e);return t.peers[n]}async remove(e){var i;const t=this._determineBucket(e),n=this._indexOf(t,e);if(n>-1){const s=t.peers.splice(n,1)[0];await((i=this.onRemove)==null?void 0:i.call(this,s,t))}}*toIterable(){function*e(t){if(h2(t)){yield*t.peers;return}yield*e(t.left),yield*e(t.right)}yield*e(this.root)}distance(e,t){return BigInt("0x"+ae(_c(e,t),"base16"))}_determineBucket(e){const t=ae(e,"base2");function n(i,s=0){return h2(i)?i:t[s]==="0"?n(i.left,s+1):n(i.right,s+1)}return n(this.root)}_indexOf(e,t){return e.peers.findIndex(n=>Xe(n.kadId,t))}async _split(e){var i,s;const t={prefix:"0",depth:e.depth+1,peers:[]},n={prefix:"1",depth:e.depth+1,peers:[]};for(const o of e.peers)ae(o.kadId,"base2")[e.depth]==="0"?(t.peers.push(o),await((i=this.onMove)==null?void 0:i.call(this,o,e,t))):(n.peers.push(o),await((s=this.onMove)==null?void 0:s.call(this,o,e,n)));s8e(e,t,n)}}function s8e(r,e,t){return delete r.peers,r.left=e,r.right=t,r.prefix===""&&(delete r.depth,delete r.prefix),!0}function o8e(r,e){return r.lastPing<Date.now()-e}const pK=20,a8e=6,c8e=20,l8e=100,u8e=3,d8e=20,h8e=100,yP="kad-peer",f8e=1,p8e=6e5,g8e=!0,y8e=1e3;class m8e extends tr{constructor(t,n){super();u(this,"kBucketSize");u(this,"kb");u(this,"network");u(this,"closestPeerTagger");u(this,"log");u(this,"components");u(this,"running");u(this,"pingNewContactTimeout");u(this,"pingNewContactQueue");u(this,"pingOldContactTimeout");u(this,"pingOldContactQueue");u(this,"populateFromDatastoreOnStart");u(this,"populateFromDatastoreLimit");u(this,"protocol");u(this,"peerTagName");u(this,"peerTagValue");u(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${n.logPrefix}:routing-table`),this.kBucketSize=n.kBucketSize??pK,this.running=!1,this.protocol=n.protocol,this.network=n.network,this.peerTagName=n.peerTagName??yP,this.peerTagValue=n.peerTagValue??f8e,this.pingOldContacts=this.pingOldContacts.bind(this),this.verifyNewContact=this.verifyNewContact.bind(this),this.peerAdded=this.peerAdded.bind(this),this.peerRemoved=this.peerRemoved.bind(this),this.populateFromDatastoreOnStart=n.populateFromDatastoreOnStart??g8e,this.populateFromDatastoreLimit=n.populateFromDatastoreLimit??y8e,this.pingOldContactQueue=new Ic({concurrency:n.pingOldContactConcurrency??d8e,metricName:`${n.metricsPrefix}_ping_old_contact_queue`,metrics:this.components.metrics,maxSize:n.pingOldContactMaxQueueSize??h8e}),this.pingOldContactTimeout=new op({...n.pingOldContactTimeout??{},metrics:this.components.metrics,metricName:`${n.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`}),this.pingNewContactQueue=new Ic({concurrency:n.pingNewContactConcurrency??c8e,metricName:`${n.metricsPrefix}_ping_new_contact_queue`,metrics:this.components.metrics,maxSize:n.pingNewContactMaxQueueSize??l8e}),this.pingNewContactTimeout=new op({...n.pingNewContactTimeout??{},metrics:this.components.metrics,metricName:`${n.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`}),this.kb=new i8e({kBucketSize:n.kBucketSize,prefixLength:n.prefixLength,splitThreshold:n.splitThreshold,numberOfOldContactsToPing:n.numberOfOldContactsToPing,lastPingThreshold:n.lastPingThreshold,ping:this.pingOldContacts,verify:this.verifyNewContact,onAdd:this.peerAdded,onRemove:this.peerRemoved}),this.closestPeerTagger=new n8e(this.components,{logPrefix:n.logPrefix,routingTable:this,peerSetSize:n.closestPeerSetSize,refreshInterval:n.closestPeerSetRefreshInterval,closeTagName:n.closeTagName,closeTagValue:n.closeTagValue}),this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMinOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),routingTableKadBucketMaxOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_max_depth`),kadBucketEvents:this.components.metrics.registerCounterGroup(`${n.metricsPrefix}_kad_bucket_events_total`)})}isStarted(){return this.running}async start(){this.running||(this.running=!0,await Ko(this.closestPeerTagger),await this.kb.addSelfPeer(this.components.peerId))}async afterStart(){Promise.resolve().then(async()=>{if(!this.populateFromDatastoreOnStart)return;let t=0;for(const n of await this.components.peerStore.all({filters:[i=>i.protocols.includes(this.protocol)&&i.tags.has(yP)],limit:this.populateFromDatastoreLimit})){if(!this.running)return;try{await this.add(n.id),t++}catch{this.log("failed to add peer %p to routing table, removing kad-dht peer tags - %e"),await this.components.peerStore.merge(n.id,{tags:{[this.peerTagName]:void 0}})}}this.log("added %d peer store peers to the routing table",t)}).catch(t=>{this.log.error("error adding peer store peers to the routing table %e",t)})}async stop(){this.running=!1,await Uc(this.closestPeerTagger),this.pingOldContactQueue.abort(),this.pingNewContactQueue.abort()}async peerAdded(t,n){var i;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:{value:this.peerTagValue}}}),this.updateMetrics(),(i=this.metrics)==null||i.kadBucketEvents.increment({peer_added:!0}),this.safeDispatchEvent("peer:add",{detail:t.peerId})}async peerRemoved(t,n){var i;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:void 0}}),this.updateMetrics(),(i=this.metrics)==null||i.kadBucketEvents.increment({peer_removed:!0}),this.safeDispatchEvent("peer:remove",{detail:t.peerId})}async*pingOldContacts(t,n){var s;if(!this.running)return;const i=[];for(const o of t){if(this.kb.get(o.kadId)==null){this.log("asked to ping contact %p that was not in routing table",o.peerId);continue}(s=this.metrics)==null||s.kadBucketEvents.increment({ping_old_contact:!0}),i.push(async()=>{const a=this.pingOldContactQueue.find(o.peerId);if(a!=null)return this.log("asked to ping contact %p was already being pinged",o.peerId),await a.join(n)?void 0:o;if(!await this.pingOldContactQueue.add(async l=>{var p;const d=this.pingOldContactTimeout.getTimeoutSignal(),h=bt([d,l==null?void 0:l.signal]);try{return await this.pingContact(o,l)}catch{return(p=this.metrics)==null||p.kadBucketEvents.increment({ping_old_contact_error:!0}),!0}finally{this.pingOldContactTimeout.cleanUp(d),h.clear()}},{peerId:o.peerId,signal:n==null?void 0:n.signal}))return o})}for await(const o of Jp(i))o!=null&&(yield o)}async verifyNewContact(t,n){var o;const i=this.pingNewContactTimeout.getTimeoutSignal(),s=bt([i,n==null?void 0:n.signal]);try{const a=this.pingNewContactQueue.find(t.peerId);return a!=null?(this.log("joining existing ping to add new peer %p to routing table",t.peerId),await a.join({signal:s})):await this.pingNewContactQueue.add(async c=>{var l;return(l=this.metrics)==null||l.kadBucketEvents.increment({ping_new_contact:!0}),this.log("pinging new peer %p before adding to routing table",t.peerId),this.pingContact(t,c)},{peerId:t.peerId,signal:s})}catch{return this.log.trace("tried to add peer %p but they were not online",t.peerId),(o=this.metrics)==null||o.kadBucketEvents.increment({ping_new_contact_error:!0}),!1}finally{this.pingNewContactTimeout.cleanUp(i),s.clear()}}async pingContact(t,n){try{this.log("pinging contact %p",t.peerId);for await(const i of this.network.sendRequest(t.peerId,{type:Dt.PING},n))if(i.type===Qb.PEER_RESPONSE)return i.messageType===Dt.PING?(this.log("contact %p ping ok",t.peerId),this.safeDispatchEvent("peer:ping",{detail:t.peerId}),!0):!1;return!1}catch(i){return this.log("error pinging old contact %p - %e",t.peerId,i),!1}}get size(){return this.kb==null?0:this.kb.count()}async find(t){var i;const n=await ys(t);return(i=this.kb.get(n))==null?void 0:i.peerId}closestPeer(t){const n=this.closestPeers(t,1);if(n.length>0)return n[0]}closestPeers(t,n=this.kBucketSize){return this.kb==null?[]:[...this.kb.closest(t,n)]}async add(t,n){if(this.kb==null)throw new Error("RoutingTable is not started");await this.kb.add(t,n)}async remove(t){if(this.kb==null)throw new Error("RoutingTable is not started");const n=await ys(t);await this.kb.remove(n)}updateMetrics(){if(this.metrics==null||this.kb==null)return;let t=0,n=0,i=0,s=20,o=0;function a(c){if(h2(c)){c.depth>i&&(i=c.depth),n++,t+=c.peers.length,c.peers.length<s&&(s=c.peers.length),c.peers.length>o&&(o=c.peers.length);return}a(c.left),a(c.right)}a(this.kb.root),this.metrics.routingTableSize.update(t),this.metrics.routingTableKadBucketTotal.update(n),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(t/n)),this.metrics.routingTableKadBucketMinOccupancy.update(s),this.metrics.routingTableKadBucketMaxOccupancy.update(o),this.metrics.routingTableKadBucketMaxDepth.update(i)}}const w8e=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],wg=15;class v8e{constructor(e,t){u(this,"log");u(this,"peerRouting");u(this,"routingTable");u(this,"refreshInterval");u(this,"refreshQueryTimeout");u(this,"commonPrefixLengthRefreshedAt");u(this,"refreshTimeoutId");const{peerRouting:n,routingTable:i,refreshInterval:s,refreshQueryTimeout:o,logPrefix:a}=t;this.log=e.logger.forComponent(`${a}:routing-table:refresh`),this.peerRouting=n,this.routingTable=i,this.refreshInterval=s??vwe,this.refreshQueryTimeout=o??bwe,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async afterStart(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");const t=this._maxCommonPrefix(),n=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${n.map(i=>i.toISOString()).join(", ")} ]`),Promise.all(n.map(async(i,s)=>{try{if(await this._refreshCommonPrefixLength(s,i,e),this._numPeersForCpl(t)===0){const o=Math.min(2*(s+1),n.length-1);for(let a=s+1;a<o+1;a++)try{await this._refreshCommonPrefixLength(a,i,e)}catch(c){this.log.error(c)}}}catch(o){this.log.error(o)}})).catch(i=>{this.log.error(i)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(i=>{this.log.error(i)})}async _refreshCommonPrefixLength(e,t,n){if(!n&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}const i=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,i,this.routingTable.size);const s=AbortSignal.timeout(this.refreshQueryTimeout),o=await fK(this.peerRouting.getClosestPeers(i.toMultihash().bytes,{signal:s}));this.log(`found ${o} peers that were close to imaginary peer %p`,i),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,i,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(e){e>wg&&(e=wg);const t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}async _generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");if(this.routingTable.kb.localPeer==null)throw new Error("Local peer not set");const t=Ac(2),n=(t[1]<<8)+t[0],i=await this._makePeerId(this.routingTable.kb.localPeer.kadId,n,e),s=Eu(i);return li(s)}async _makePeerId(e,t,n){if(n>wg)throw new Error(`Cannot generate peer ID for common prefix length greater than ${wg}`);const o=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>n,a=65535<<16-(n+1),c=o&a|t&~a,l=w8e[c],d=new ArrayBuffer(34),h=new DataView(d,0,d.byteLength);return h.setUint8(0,lK.code),h.setUint8(1,32),h.setUint32(2,l,!1),new Uint8Array(h.buffer,h.byteOffset,h.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){var e;if(((e=this.routingTable.kb)==null?void 0:e.localPeer)!=null)for(const{kadId:t}of this.routingTable.kb.toIterable()){const n=_c(this.routingTable.kb.localPeer.kadId,t);let i=0;for(const s of n)if(s===0)i++;else break;yield i}}}class b8e{constructor(e,t){u(this,"peerId");u(this,"providers");u(this,"peerStore");u(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:add-provider`),this.peerId=e.peerId,this.providers=t.providers,this.peerStore=e.peerStore}async handle(e,t){if(t.key==null||t.key.length===0)throw new Pt("Missing key");let n;try{n=Dx.decode(t.key)}catch{throw new Pt("Invalid CID")}(t.providers==null||t.providers.length===0)&&this.log.error("no providers found in message"),this.log("%p asked us, %p to store provider record for for %c",e,this.peerId,n),await Promise.all(t.providers.map(async i=>{const s=Eu(i.id),o=li(s),a=i.multiaddrs.map(c=>Fe(c));if(!e.equals(o)){this.log("invalid provider peer %p from %p",i.id,e);return}if(i.multiaddrs.length<1){this.log("no valid addresses for provider %p. Ignore",e);return}this.log.trace("received provider %p for %s (addrs %s)",e,n,a),await this.providers.addProvider(n,o),await this.peerStore.merge(o,{multiaddrs:a})}))}}class E8e{constructor(e,t){u(this,"peerRouting");u(this,"peerInfoMapper");u(this,"peerId");u(this,"addressManager");u(this,"log");const{peerRouting:n,logPrefix:i}=t;this.log=e.logger.forComponent(`${i}:rpc:handlers:find-node`),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=n,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(this.log("incoming request from %p for peers closer to %b",e,t.key),t.key==null)throw new Pt("Invalid FIND_NODE message received - key was missing");const n=await this.peerRouting.getCloserPeersOffline(t.key,e);Xe(this.peerId.toMultihash().bytes,t.key)&&n.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(s=>s.decapsulateCode(qe("p2p").code))});const i={type:Dt.FIND_NODE,clusterLevel:t.clusterLevel,closer:n.map(this.peerInfoMapper).filter(({multiaddrs:s})=>s.length).map(s=>({id:s.id.toMultihash().bytes,multiaddrs:s.multiaddrs.map(o=>o.bytes)})),providers:[]};return i.closer.length===0&&this.log("could not find any peers closer to %b than %p",t.key,e),i}}class S8e{constructor(e,t){u(this,"peerId");u(this,"peerRouting");u(this,"providers");u(this,"peerStore");u(this,"peerInfoMapper");u(this,"log");const{peerRouting:n,providers:i,logPrefix:s}=t;this.log=e.logger.forComponent(`${s}:rpc:handlers:get-providers`),this.peerId=e.peerId,this.peerStore=e.peerStore,this.peerRouting=n,this.providers=i,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(t.key==null)throw new Pt("Invalid GET_PROVIDERS message received - key was missing");let n;try{n=Dx.decode(t.key)}catch{throw new Pt("Invalid CID")}this.log("%p asking for providers for %s",e,n);const[i,s]=await Promise.all([am(Oh(await this.providers.getProviders(n),async a=>{const c=await this.peerStore.get(a);return{id:c.id,multiaddrs:c.addresses.map(({multiaddr:d})=>d)}})),this.peerRouting.getCloserPeersOffline(t.key,this.peerId)]),o={type:Dt.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:s.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)})),providers:i.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))};return this.log("got %s providers %s closerPeers",o.providers.length,o.closer.length),o}async _getAddresses(e){return[]}}class x8e{constructor(e,t){u(this,"peerStore");u(this,"datastore");u(this,"peerRouting");u(this,"log");u(this,"datastorePrefix");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:get-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}async handle(e,t){const n=t.key;if(this.log("%p asked for key %b",e,n),n==null||n.length===0)throw new Pt("Invalid key");const i={type:Dt.GET_VALUE,key:n,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(m4e(n)){this.log("is public key");const a=w4e(n);let c;try{const l=await this.peerStore.get(a);if(l.id.publicKey==null)throw new sr("No public key found in key book");c=Oi(l.id.publicKey)}catch(l){if(l.name!=="NotFoundError")throw l}if(c!=null)return this.log("returning found public key"),i.record=new Mi(n,c,new Date).serialize(),i}const[s,o]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getCloserPeersOffline(n,e)]);return s!=null&&(this.log("had record for %b in local datastore",n),i.record=s.serialize()),o.length>0&&(this.log("had %s closer peers in routing table",o.length),i.closer=o.map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))),i}async _checkLocalDatastore(e){this.log("checkLocalDatastore looking for %b",e);const t=d1(this.datastorePrefix,e);let n;try{n=await this.datastore.get(t)}catch(s){if(s.name==="NotFoundError")return;throw s}const i=Mi.deserialize(n);if(i.timeReceived==null||Date.now()-i.timeReceived.getTime()>lwe){await this.datastore.delete(t);return}return i}}class A8e{constructor(e,t){u(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:ping`)}async handle(e,t){return this.log("ping from %p",e),t}}class I8e{constructor(e,t){u(this,"components");u(this,"validators");u(this,"log");u(this,"datastorePrefix");const{validators:n}=t;this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:put-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n}async handle(e,t){const n=t.key;if(this.log("%p asked us to store value for key %b",e,n),t.record==null){const i=`Empty record from: ${e.toString()}`;throw this.log.error(i),new Pt(i)}try{const i=Mi.deserialize(t.record);await _x(this.validators,i),i.timeReceived=new Date;const s=d1(this.datastorePrefix,i.key);await this.components.datastore.put(s,i.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,s)}catch(i){this.log("did not put record for key %b into datastore %o",n,i)}return t}}let C8e=class{constructor(e,t){u(this,"handlers");u(this,"routingTable");u(this,"log");u(this,"metrics");var n,i;this.metrics={operations:(n=e.metrics)==null?void 0:n.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_requests_total`),errors:(i=e.metrics)==null?void 0:i.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_errors_total`)},this.log=e.logger.forComponent(`${t.logPrefix}:rpc`),this.routingTable=t.routingTable,this.handlers={[Dt.GET_VALUE.toString()]:new x8e(e,t),[Dt.PUT_VALUE.toString()]:new I8e(e,t),[Dt.FIND_NODE.toString()]:new E8e(e,t),[Dt.ADD_PROVIDER.toString()]:new b8e(e,t),[Dt.GET_PROVIDERS.toString()]:new S8e(e,t),[Dt.PING.toString()]:new A8e(e,t)}}async handleMessage(e,t){var i,s;const n=this.handlers[t.type];if(n==null){this.log.error(`no handler found for message type: ${t.type}`);return}try{return(i=this.metrics.operations)==null||i.increment({[t.type]:!0}),await n.handle(e,t)}catch{(s=this.metrics.errors)==null||s.increment({[t.type]:!0})}}onIncomingStream(e){let t="unknown";Promise.resolve().then(async()=>{const{stream:n,connection:i}=e,s=i.remotePeer,o=this;await gn(n,a=>Yd(a),async function*(a){for await(const c of a){const l=Rl.decode(c);t=l.type,o.log("incoming %s from %p",l.type,s);const d=await o.handleMessage(s,l);d!=null&&(yield Rl.encode(d))}},a=>Qd(a),n)}).catch(n=>{this.log.error("error handling %s RPC message from %p - %e",t,e.connection.remotePeer,n)})}};class k8e extends tr{constructor(t,n){super();u(this,"log");u(this,"components");u(this,"protocol");u(this,"running");u(this,"registrarId");const{protocol:i,logPrefix:s}=n;this.components=t,this.log=t.logger.forComponent(`${s}:topology-listener`),this.running=!1,this.protocol=i}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:t=>{this.log("observed peer %p with protocol %s",t,this.protocol),this.dispatchEvent(new CustomEvent("peer",{detail:t}))}}))}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class _8e{constructor(e){u(this,"dht");this.dht=e}async provide(e,t={}){await Vo(this.dht.provide(e,t))}async cancelReprovide(e){await this.dht.cancelReprovide(e)}async*findProviders(e,t={}){for await(const n of this.dht.findProviders(e,t))n.name==="PROVIDER"&&(yield*n.providers)}async put(e,t,n){await Vo(this.dht.put(e,t,n))}async get(e,t){for await(const n of this.dht.get(e,t))if(n.name==="VALUE")return n.value;throw new sr("Could not find value for key")}}class T8e{constructor(e){u(this,"dht");this.dht=e}async findPeer(e,t={}){for await(const n of this.dht.findPeer(e,t))if(n.name==="FINAL_PEER")return n.peer;throw new sr("Peer not found")}async*getClosestPeers(e,t={}){for await(const n of this.dht.getClosestPeers(e,t))n.name==="FINAL_PEER"&&(yield n.peer)}}const P8e=32,D8e=64;var KN,HN,jN;class $8e extends tr{constructor(t,n={}){var d,h,p,w;super();u(this,"protocol");u(this,"routingTable");u(this,"providers");u(this,"network");u(this,"peerRouting");u(this,"components");u(this,"log");u(this,"running");u(this,"kBucketSize");u(this,"clientMode");u(this,"validators");u(this,"selectors");u(this,"queryManager");u(this,"contentFetching");u(this,"contentRouting");u(this,"routingTableRefresh");u(this,"rpc");u(this,"topologyListener");u(this,"querySelf");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"dhtContentRouting");u(this,"dhtPeerRouting");u(this,"peerInfoMapper");u(this,"reprovider");u(this,jN,"@libp2p/kad-dht");u(this,HN,["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery"]);u(this,KN,["@libp2p/identify"]);const i=n.logPrefix??"libp2p:kad-dht",s=n.datastorePrefix??"/dht",o=n.metricsPrefix??"libp2p_kad_dht",a={queries:(d=t.metrics)==null?void 0:d.registerMetricGroup(`${o}_operations_total`,{label:"operation"}),errors:(h=t.metrics)==null?void 0:h.registerCounterGroup(`${o}_operation_errors_total`,{label:"operation"}),queryTime:(p=t.metrics)==null?void 0:p.registerMetricGroup(`${o}_operation_time_seconds`,{label:"operation"}),errorTime:(w=t.metrics)==null?void 0:w.registerMetricGroup(`${o}_operation_error_time_seconds`,{label:"operation"})};this.running=!1,this.components=t,this.log=t.logger.forComponent(i),this.protocol=n.protocol??uwe,this.kBucketSize=n.kBucketSize??20,this.clientMode=n.clientMode??!0,this.maxInboundStreams=n.maxInboundStreams??P8e,this.maxOutboundStreams=n.maxOutboundStreams??D8e,this.peerInfoMapper=n.peerInfoMapper??g4e;const c=GS();this.providers=new H4e(t,{...n.providers,logPrefix:i,datastorePrefix:s,lock:c}),this.validators={...Dwe,...n.validators},this.selectors={...Twe,...n.selectors},this.network=new V4e(t,{protocol:this.protocol,logPrefix:i,metricsPrefix:o}),this.routingTable=new m8e(t,{kBucketSize:n.kBucketSize,pingOldContactTimeout:n.pingOldContactTimeout,pingOldContactConcurrency:n.pingOldContactConcurrency,pingOldContactMaxQueueSize:n.pingOldContactMaxQueueSize,pingNewContactTimeout:n.pingNewContactTimeout,pingNewContactConcurrency:n.pingNewContactConcurrency,pingNewContactMaxQueueSize:n.pingNewContactMaxQueueSize,protocol:this.protocol,logPrefix:i,metricsPrefix:o,prefixLength:n.prefixLength,splitThreshold:n.kBucketSplitThreshold,network:this.network});const l=Ve();n.allowQueryWithZeroPeers===!0&&l.resolve(),this.queryManager=new q4e(t,{disjointPaths:Math.ceil(this.kBucketSize/2),logPrefix:i,metricsPrefix:o,initialQuerySelfHasRun:l,routingTable:this.routingTable}),this.peerRouting=new K4e(t,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:i}),this.contentFetching=new C4e(t,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:i,datastorePrefix:s}),this.contentRouting=new _4e(t,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:i}),this.routingTableRefresh=new v8e(t,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:i}),this.rpc=new C8e(t,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:i,metricsPrefix:o,datastorePrefix:s,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new k8e(t,{protocol:this.protocol,logPrefix:i}),this.querySelf=new X4e(t,{peerRouting:this.peerRouting,interval:n.querySelfInterval,initialInterval:n.initialQuerySelfInterval,logPrefix:i,initialQuerySelfHasRun:l,routingTable:this.routingTable,operationMetrics:a}),this.reprovider=new J4e(t,{...n.reprovide,logPrefix:i,metricsPrefix:o,datastorePrefix:s,contentRouting:this.contentRouting,lock:c,operationMetrics:a}),this.network.addEventListener("peer",f=>{const g=f.detail;this.onPeerConnect(g).catch(v=>{this.log.error("could not add %p to routing table",g.id,v)}),this.dispatchEvent(new CustomEvent("peer",{detail:g}))}),this.topologyListener.addEventListener("peer",f=>{const g=f.detail;Promise.resolve().then(async()=>{const v=await this.components.peerStore.get(g),y={id:g,multiaddrs:v.addresses.map(({multiaddr:m})=>m),protocols:v.protocols};await this.onPeerConnect(y)}).catch(v=>{this.log.error("could not add %p to routing table - %e",g,v)})}),this.dhtPeerRouting=new T8e(this),this.dhtContentRouting=new _8e(this),n.clientMode==null&&t.events.addEventListener("self:peer:update",f=>{this.log("received update of self-peer info"),Promise.resolve().then(async()=>{const g=f.detail.peer.addresses.some(({multiaddr:y})=>I4e(y)),v=this.getMode();g&&v==="client"?await this.setMode("server"):v==="server"&&!g&&await this.setMode("client")}).catch(g=>{this.log.error("error setting dht server mode",g)})}),this.get=Uu(this.get.bind(this),a,"GET_VALUE"),this.findProviders=Uu(this.findProviders.bind(this),a,"FIND_PROVIDERS"),this.findPeer=Uu(this.findPeer.bind(this),a,"FIND_PEER"),this.getClosestPeers=Uu(this.getClosestPeers.bind(this),a,"GET_CLOSEST_PEERS"),this.provide=Uu(this.provide.bind(this),a,"PROVIDE"),this.put=Uu(this.put.bind(this),a,"PUT_VALUE")}get[(jN=Symbol.toStringTag,HN=lr,KN=Sc,Kd)](){return this.dhtContentRouting}get[Hd](){return this.dhtPeerRouting}get[z1](){return this}async onPeerConnect(t){if(this.log.trace("peer %p connected",t.id),t=this.peerInfoMapper(t),t.multiaddrs.length===0){this.log.trace("ignoring %p as there were no valid addresses in %s after filtering",t.id,t.multiaddrs.map(n=>n.toString()));return}try{await this.routingTable.add(t.id)}catch(n){this.log.error("could not add %p to routing table",t.id,n)}}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(t,n=!1){if(t===this.getMode()&&!n){this.log("already in %s mode",t);return}if(await this.components.registrar.unhandle(this.protocol),t===this.getMode()&&!n){this.log("already in %s mode",t);return}t==="client"?(this.log("enabling client mode while in %s mode",this.getMode()),this.clientMode=!0):(this.log("enabling server mode while in %s mode",this.getMode()),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running||(this.running=!0,await this.setMode(this.clientMode?"client":"server",!0),await Ko(this.routingTable,this.queryManager,this.network,this.topologyListener,this.routingTableRefresh,this.reprovider),await Ko(this.querySelf))}async stop(){this.running=!1,await Uc(this.querySelf,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener,this.reprovider)}async*put(t,n,i={}){yield*this.contentFetching.put(t,n,i)}async*get(t,n={}){yield*this.contentFetching.get(t,n)}async*provide(t,n={}){yield*this.contentRouting.provide(t,this.components.addressManager.getAddresses(),n)}async cancelReprovide(t){await this.providers.removeProvider(t,this.components.peerId)}async*findProviders(t,n={}){yield*this.contentRouting.findProviders(t,n)}async*findPeer(t,n={}){yield*this.peerRouting.findPeer(t,n)}async*getClosestPeers(t,n={}){yield*this.peerRouting.getClosestPeers(t,n)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}}var Qb;(function(r){r[r.SEND_QUERY=0]="SEND_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADD_PEER=6]="ADD_PEER",r[r.DIAL_PEER=7]="DIAL_PEER"})(Qb||(Qb={}));function N8e(r={}){return e=>new $8e(e,r)}var O8e=r=>{if(Object.prototype.toString.call(r)!=="[object Object]")return!1;const e=Object.getPrototypeOf(r);return e===null||e===Object.prototype};const Cm=O8e,{hasOwnProperty:gK}=Object.prototype,{propertyIsEnumerable:M8e}=Object,dh=(r,e,t)=>Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),R8e=E1,mP={concatArrays:!1,ignoreUndefined:!1},Hw=r=>{const e=[];for(const t in r)gK.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){const t=Object.getOwnPropertySymbols(r);for(const n of t)M8e.call(r,n)&&e.push(n)}return e};function Uh(r){return Array.isArray(r)?L8e(r):Cm(r)?B8e(r):r}function L8e(r){const e=r.slice(0,0);return Hw(r).forEach(t=>{dh(e,t,Uh(r[t]))}),e}function B8e(r){const e=Object.getPrototypeOf(r)===null?Object.create(null):{};return Hw(r).forEach(t=>{dh(e,t,Uh(r[t]))}),e}const yK=(r,e,t,n)=>(t.forEach(i=>{typeof e[i]>"u"&&n.ignoreUndefined||(i in r&&r[i]!==Object.getPrototypeOf(r)?dh(r,i,Yb(r[i],e[i],n)):dh(r,i,Uh(e[i])))}),r),U8e=(r,e,t)=>{let n=r.slice(0,0),i=0;return[r,e].forEach(s=>{const o=[];for(let a=0;a<s.length;a++)gK.call(s,a)&&(o.push(String(a)),s===r?dh(n,i++,s[a]):dh(n,i++,Uh(s[a])));n=yK(n,s,Hw(s).filter(a=>!o.includes(a)),t)}),n};function Yb(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?U8e(r,e,t):!Cm(e)||!Cm(r)?Uh(e):yK(r,e,Hw(e),t)}var F8e=function(...r){const e=Yb(Uh(mP),this!==R8e&&this||{},mP);let t={_:{}};for(const n of r)if(n!==void 0){if(!Cm(n))throw new TypeError("`"+n+"` is not an Option Object");t=Yb(t,{_:n},e)}return t._};const Nx=Qs(F8e);function z8e(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function V8e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var K8e=V8e,H8e=K8e;let j8e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},q8e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return mK(this,e)}},W8e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return mK(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function mK(r,e){return new W8e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let G8e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new j8e(e,t,n),this.decoder=new q8e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function wK({name:r,prefix:e,encode:t,decode:n}){return new G8e(r,e,t,n)}function vK({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=H8e(t,r);return wK({prefix:e,name:r,encode:n,decode:s=>z8e(i(s))})}function Q8e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Y8e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function jw({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return wK({prefix:e,name:r,encode(i){return Y8e(i,n,t)},decode(i){return Q8e(i,n,t,r)}})}const X8e=vK({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});vK({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var J8e=bK,wP=128,Z8e=-128,e6e=Math.pow(2,31);function bK(r,e,t){e=e||[],t=t||0;for(var n=t;r>=e6e;)e[t++]=r&255|wP,r/=128;for(;r&Z8e;)e[t++]=r&255|wP,r>>>=7;return e[t]=r|0,bK.bytes=t-n+1,e}var t6e=Xb,r6e=128,vP=127;function Xb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Xb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&vP)<<i:(o&vP)*Math.pow(2,i),i+=7}while(o>=r6e);return Xb.bytes=s-n,t}var n6e=Math.pow(2,7),i6e=Math.pow(2,14),s6e=Math.pow(2,21),o6e=Math.pow(2,28),a6e=Math.pow(2,35),c6e=Math.pow(2,42),l6e=Math.pow(2,49),u6e=Math.pow(2,56),d6e=Math.pow(2,63),h6e=function(r){return r<n6e?1:r<i6e?2:r<s6e?3:r<o6e?4:r<a6e?5:r<c6e?6:r<l6e?7:r<u6e?8:r<d6e?9:10},f6e={encode:J8e,decode:t6e,encodingLength:h6e},EK=f6e;function bP(r,e,t=0){return EK.encode(r,e,t),e}function EP(r){return EK.encodingLength(r)}function SP(r,e){const t=e.byteLength,n=EP(r),i=n+EP(t),s=new Uint8Array(i+t);return bP(r,s,0),bP(t,s,n),s.set(e,i),new p6e(r,t,e,s)}let p6e=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function g6e({name:r,code:e,encode:t}){return new y6e(r,e,t)}let y6e=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?SP(this.code,t):t.then(n=>SP(this.code,n))}else throw Error("Unknown type, must be binary type")}};function m6e(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const w6e=g6e({name:"sha2-256",code:18,encode:m6e("SHA-256")});function v6e(r){return r>=55296&&r<=56319}function b6e(r){return r>=56320&&r<=57343}var E6e=function(e,t,n){if(typeof t!="string")throw new Error("Input must be string");for(var i=t.length,s=0,o,a,c=0;c<i;c+=1){if(o=t.charCodeAt(c),a=t[c],v6e(o)&&b6e(t.charCodeAt(c+1))&&(c+=1,a+=t[c]),s+=e(a),s===n)return t.slice(0,c+1);if(s>n)return t.slice(0,c-a.length+1)}return t};function S6e(r){return r>=55296&&r<=56319}function x6e(r){return r>=56320&&r<=57343}var A6e=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var t=e.length,n=0,i=null,s=null,o=0;o<t;o++)i=e.charCodeAt(o),x6e(i)?s!=null&&S6e(s)?n+=1:n+=3:i<=127?n+=1:i>=128&&i<=2047?n+=2:i>=2048&&i<=65535&&(n+=3),s=i;return n},I6e=E6e,C6e=A6e,k6e=I6e.bind(null,C6e),_6e=k6e,T6e=/[\/\?<>\\:\*\|"]/g,P6e=/[\x00-\x1f\x80-\x9f]/g,D6e=/^\.+$/,$6e=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,N6e=/[\. ]+$/;function xP(r,e){if(typeof r!="string")throw new Error("Input must be string");var t=r.replace(T6e,e).replace(P6e,e).replace(D6e,e).replace($6e,e).replace(N6e,e);return _6e(t,255)}var O6e=function(r,e){var t=e&&e.replacement||"",n=xP(r,t);return t===""?n:xP(n,"")};const M6e=Qs(O6e),E6={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function SK(r){const e="AES-GCM";let t=16;const n=12,i="SHA-256",s=16,o=32767,a=qs.get();t*=8;async function c(h,p){const w=a.getRandomValues(new Uint8Array(s)),f=a.getRandomValues(new Uint8Array(n)),g={name:e,iv:f};typeof p=="string"&&(p=fe(p));let v;if(p.length===0){v=await a.subtle.importKey("jwk",E6,{name:"AES-GCM"},!0,["encrypt"]);try{const m={name:"PBKDF2",salt:w,iterations:o,hash:{name:i}},b=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);v=await a.subtle.deriveKey(m,b,{name:e,length:t},!0,["encrypt"])}catch{v=await a.subtle.importKey("jwk",E6,{name:"AES-GCM"},!0,["encrypt"])}}else{const m={name:"PBKDF2",salt:w,iterations:o,hash:{name:i}},b=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);v=await a.subtle.deriveKey(m,b,{name:e,length:t},!0,["encrypt"])}const y=await a.subtle.encrypt(g,v,h);return ur([w,g.iv,new Uint8Array(y)])}async function l(h,p){const w=h.subarray(0,s),f=h.subarray(s,s+n),g=h.subarray(s+n),v={name:e,iv:f};typeof p=="string"&&(p=fe(p));let y;if(p.length===0)try{const b={name:"PBKDF2",salt:w,iterations:o,hash:{name:i}},S=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(b,S,{name:e,length:t},!0,["decrypt"])}catch{y=await a.subtle.importKey("jwk",E6,{name:"AES-GCM"},!0,["decrypt"])}else{const b={name:"PBKDF2",salt:w,iterations:o,hash:{name:i}},S=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(b,S,{name:e,length:t},!0,["decrypt"])}const m=await a.subtle.decrypt(v,y,g);return new Uint8Array(m)}return{encrypt:c,decrypt:l}}/*!
 * MIT License
 * 
 * Copyright (c) 2017-2024 Peculiar Ventures, LLC
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const R6e="[object ArrayBuffer]";class me{static isArrayBuffer(e){return Object.prototype.toString.call(e)===R6e}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const n=me.toUint8Array(e),i=me.toUint8Array(t);if(n.length!==i.byteLength)return!1;for(let s=0;s<n.length;s++)if(n[s]!==i[s])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let n=0;for(const o of t)n+=o.byteLength;const i=new Uint8Array(n);let s=0;for(const o of t){const a=this.toUint8Array(o);i.set(a,s),s+=a.length}return e[e.length-1]instanceof Function?this.toView(i,e[e.length-1]):i.buffer}}const S6="string",L6e=/^[0-9a-f\s]+$/i,B6e=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,U6e=/^[a-zA-Z0-9-_]+$/;class AP{static fromString(e){const t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n.buffer}static toString(e){const t=me.toUint8Array(e);let n="";for(let s=0;s<t.length;s++)n+=String.fromCharCode(t[s]);return decodeURIComponent(escape(n))}}class _s{static toString(e,t=!1){const n=me.toArrayBuffer(e),i=new DataView(n);let s="";for(let o=0;o<n.byteLength;o+=2){const a=i.getUint16(o,t);s+=String.fromCharCode(a)}return s}static fromString(e,t=!1){const n=new ArrayBuffer(e.length*2),i=new DataView(n);for(let s=0;s<e.length;s++)i.setUint16(s*2,e.charCodeAt(s),t);return n}}class Ce{static isHex(e){return typeof e===S6&&L6e.test(e)}static isBase64(e){return typeof e===S6&&B6e.test(e)}static isBase64Url(e){return typeof e===S6&&U6e.test(e)}static ToString(e,t="utf8"){const n=me.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return _s.toString(n,!0);case"utf16":case"utf16be":return _s.toString(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return _s.fromString(e,!0);case"utf16":case"utf16be":return _s.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=me.toUint8Array(e);if(typeof btoa<"u"){const n=this.ToString(t,"binary");return btoa(n)}else return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ce.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ce.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=Ce.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return AP.fromString(e);case"utf16":case"utf16be":return _s.fromString(e);case"utf16le":case"usc2":return _s.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=Ce.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return AP.toString(e);case"utf16":case"utf16be":return _s.toString(e);case"utf16le":case"usc2":return _s.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);return n.buffer}static ToBinary(e){const t=me.toUint8Array(e);let n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return n}static ToHex(e){const t=me.toUint8Array(e);let n="";const i=t.length;for(let s=0;s<i;s++){const o=t[s];o<16&&(n+="0"),n+=o.toString(16)}return n}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ce.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const n=new Uint8Array(t.length/2);for(let i=0;i<t.length;i=i+2){const s=t.slice(i,i+2);n[i/2]=parseInt(s,16)}return n.buffer}static ToUtf16String(e,t=!1){return _s.toString(e,t)}static FromUtf16String(e,t=!1){return _s.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}static formatString(e){return(e==null?void 0:e.replace(/[\n\r\t ]/g,""))||""}}Ce.DEFAULT_UTF8_ENCODING="utf8";function F6e(...r){const e=r.map(i=>i.byteLength).reduce((i,s)=>i+s),t=new Uint8Array(e);let n=0;return r.map(i=>new Uint8Array(i)).forEach(i=>{for(const s of i)t[n++]=s}),t.buffer}function xK(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<r.byteLength;i++)if(t[i]!==n[i])return!1;return!0}/*!
 Copyright (c) Peculiar Ventures, LLC
*/function hh(r,e){let t=0;if(r.length===1)return r[0];for(let n=r.length-1;n>=0;n--)t+=r[r.length-1-n]*Math.pow(2,e*n);return t}function tu(r,e,t=-1){const n=t;let i=r,s=0,o=Math.pow(2,e);for(let a=1;a<8;a++){if(r<o){let c;if(n<0)c=new ArrayBuffer(a),s=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),s=n}const l=new Uint8Array(c);for(let d=a-1;d>=0;d--){const h=Math.pow(2,d*e);l[s-d-1]=Math.floor(i/h),i-=l[s-d-1]*h}return c}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function Jb(...r){let e=0,t=0;for(const s of r)e+=s.length;const n=new ArrayBuffer(e),i=new Uint8Array(n);for(const s of r)i.set(s,t),t+=s.length;return i}function AK(){const r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const a=r[0]===255&&r[1]&128,c=r[0]===0&&(r[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=r[0]&128;const n=hh(t,8),i=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(i);for(let a=0;a<this.valueHex.byteLength;a++)s[a]=r[a];return s[0]&=127,hh(s,8)-n}function z6e(r){const e=r<0?r*-1:r;let t=128;for(let n=1;n<8;n++){if(e<=t){if(r<0){const o=t-e,a=tu(o,8,n),c=new Uint8Array(a);return c[0]|=128,a}let i=tu(e,8,n),s=new Uint8Array(i);if(s[0]&128){const o=i.slice(0),a=new Uint8Array(o);i=new ArrayBuffer(i.byteLength+1),s=new Uint8Array(i);for(let c=0;c<o.byteLength;c++)s[c+1]=a[c];s[0]=0}return i}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function V6e(r,e){if(r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<t.length;i++)if(t[i]!==n[i])return!1;return!0}function Xn(r,e){const t=r.toString(10);if(e<t.length)return"";const n=e-t.length,i=new Array(n);for(let o=0;o<n;o++)i[o]="0";return i.join("").concat(t)}/*!
 * Copyright (c) 2014, GMO GlobalSign
 * Copyright (c) 2015-2022, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */function km(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Ox(r){let e=0,t=0;for(let i=0;i<r.length;i++){const s=r[i];e+=s.byteLength}const n=new Uint8Array(e);for(let i=0;i<r.length;i++){const s=r[i];n.set(new Uint8Array(s),t),t+=s.byteLength}return n.buffer}function aa(r,e,t,n){return e instanceof Uint8Array?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class qw{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return Ox(this.items)}}const Of=[new Uint8Array([1])],IP="0123456789",x6="name",CP="valueHexView",K6e="isHexOnly",H6e="idBlock",j6e="tagClass",q6e="tagNumber",W6e="isConstructed",G6e="fromBER",Q6e="toBER",Y6e="local",Cn="",ws=new ArrayBuffer(0),Ww=new Uint8Array(0),cp="EndOfContent",IK="OCTET STRING",CK="BIT STRING";function Zs(r){var e;return e=class extends r{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}constructor(...n){var i;super(...n);const s=n[0]||{};this.isHexOnly=(i=s.isHexOnly)!==null&&i!==void 0?i:!1,this.valueHexView=s.valueHex?me.toUint8Array(s.valueHex):Ww}fromBER(n,i,s){const o=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!aa(this,o,i,s))return-1;const a=i+s;return this.valueHexView=o.subarray(i,a),this.valueHexView.length?(this.blockLength=s,a):(this.warnings.push("Zero buffer length"),i)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",ws)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:Ce.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class Su{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=Cn,warnings:n=[],valueBeforeDecode:i=Ww}={}){this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=me.toUint8Array(i)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Ce.ToHex(this.valueBeforeDecodeView)}}}Su.NAME="baseBlock";class vn extends Su{fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}vn.NAME="valueBlock";class kK extends Zs(Su){constructor({idBlock:e={}}={}){var t,n,i,s;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?me.toUint8Array(e.valueHex):Ww,this.tagClass=(n=e.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(i=e.tagNumber)!==null&&i!==void 0?i:-1,this.isConstructed=(s=e.isConstructed)!==null&&s!==void 0?s:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",ws}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const i=new Uint8Array(1);if(!e){let s=this.tagNumber;s&=31,t|=s,i[0]=t}return i.buffer}if(!this.isHexOnly){const i=tu(this.tagNumber,7),s=new Uint8Array(i),o=i.byteLength,a=new Uint8Array(o+1);if(a[0]=t|31,!e){for(let c=0;c<o-1;c++)a[c+1]=s[c]|128;a[o]=s[o-1]}return a.buffer}const n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=t|31,!e){const i=this.valueHexView;for(let s=0;s<i.length-1;s++)n[s+1]=i[s]|128;n[this.valueHexView.byteLength]=i[i.length-1]}return n.buffer}fromBER(e,t,n){const i=me.toUint8Array(e);if(!aa(this,i,t,n))return-1;const s=i.subarray(t,t+n);if(s.length===0)return this.error="Zero buffer length",-1;switch(s[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(s[0]&32)===32,this.isHexOnly=!1;const a=s[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,l=this.valueHexView=new Uint8Array(255),d=255;for(;s[c]&128;){if(l[c-1]=s[c]&127,c++,c>=s.length)return this.error="End of input reached before message was fully decoded",-1;if(c===d){d+=255;const p=new Uint8Array(d);for(let w=0;w<l.length;w++)p[w]=l[w];l=this.valueHexView=new Uint8Array(d)}}this.blockLength=c+1,l[c-1]=s[c]&127;const h=new Uint8Array(c);for(let p=0;p<c;p++)h[p]=l[p];l=this.valueHexView=new Uint8Array(c),l.set(h),this.blockLength<=9?this.tagNumber=hh(l,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}kK.NAME="identificationBlock";class _K extends Su{constructor({lenBlock:e={}}={}){var t,n,i;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(n=e.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(i=e.length)!==null&&i!==void 0?i:0}fromBER(e,t,n){const i=me.toUint8Array(e);if(!aa(this,i,t,n))return-1;const s=i.subarray(t,t+n);if(s.length===0)return this.error="Zero buffer length",-1;if(s[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=s[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(s[0]&128),this.longFormUsed===!1)return this.length=s[0],this.blockLength=1,t+this.blockLength;const o=s[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>s.length)return this.error="End of input reached before message was fully decoded",-1;const a=t+1,c=i.subarray(a,a+o);return c[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=hh(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(e=!1){let t,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=128),t;if(this.longFormUsed){const i=tu(this.length,8);if(i.byteLength>127)return this.error="Too big length",ws;if(t=new ArrayBuffer(i.byteLength+1),e)return t;const s=new Uint8Array(i);n=new Uint8Array(t),n[0]=i.byteLength|128;for(let o=0;o<i.byteLength;o++)n[o+1]=s[o];return t}return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}_K.NAME="lengthBlock";const Se={};class Tr extends Su{constructor({name:e=Cn,optional:t=!1,primitiveSchema:n,...i}={},s){super(i),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new kK(i),this.lenBlock=new _K(i),this.valueBlock=s?new s(i):new vn(i)}fromBER(e,t,n){const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}toBER(e,t){const n=t||new qw;t||TK(this);const i=this.idBlock.toBER(e);if(n.write(i),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{const s=this.valueBlock.toBER(e);this.lenBlock.length=s.byteLength;const o=this.lenBlock.toBER(e);n.write(o),n.write(s)}return t?ws:n.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():Ce.ToHex(this.toBER())}onAsciiEncoding(){const e=this.constructor.NAME,t=Ce.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),n=e.toBER();return V6e(t,n)}}Tr.NAME="BaseBlock";function TK(r){var e;if(r instanceof Se.Constructed)for(const t of r.valueBlock.value)TK(t)&&(r.lenBlock.isIndefiniteForm=!0);return!!(!((e=r.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}class Mx extends Tr{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=Cn,...t}={},n){super(t,n),e&&this.fromString(e)}fromBER(e,t,n){const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}Mx.NAME="BaseStringBlock";class PK extends Zs(vn){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}PK.NAME="PrimitiveValueBlock";var DK;class e0 extends Tr{constructor(e={}){super(e,PK),this.idBlock.isConstructed=!1}}DK=e0;Se.Primitive=DK;e0.NAME="PRIMITIVE";function X6e(r,e){if(r instanceof e)return r;const t=new e;return t.idBlock=r.idBlock,t.lenBlock=r.lenBlock,t.warnings=r.warnings,t.valueBeforeDecodeView=r.valueBeforeDecodeView,t}function Fh(r,e=0,t=r.length){const n=e;let i=new Tr({},vn);const s=new Su;if(!aa(s,r,e,t))return i.error=s.error,{offset:-1,result:i};if(!r.subarray(e,e+t).length)return i.error="Zero buffer length",{offset:-1,result:i};let a=i.idBlock.fromBER(r,e,t);if(i.idBlock.warnings.length&&i.warnings.concat(i.idBlock.warnings),a===-1)return i.error=i.idBlock.error,{offset:-1,result:i};if(e=a,t-=i.idBlock.blockLength,a=i.lenBlock.fromBER(r,e,t),i.lenBlock.warnings.length&&i.warnings.concat(i.lenBlock.warnings),a===-1)return i.error=i.lenBlock.error,{offset:-1,result:i};if(e=a,t-=i.lenBlock.blockLength,!i.idBlock.isConstructed&&i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};let c=Tr;switch(i.idBlock.tagClass){case 1:if(i.idBlock.tagNumber>=37&&i.idBlock.isHexOnly===!1)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};c=Se.EndOfContent;break;case 1:c=Se.Boolean;break;case 2:c=Se.Integer;break;case 3:c=Se.BitString;break;case 4:c=Se.OctetString;break;case 5:c=Se.Null;break;case 6:c=Se.ObjectIdentifier;break;case 10:c=Se.Enumerated;break;case 12:c=Se.Utf8String;break;case 13:c=Se.RelativeObjectIdentifier;break;case 14:c=Se.TIME;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:c=Se.Sequence;break;case 17:c=Se.Set;break;case 18:c=Se.NumericString;break;case 19:c=Se.PrintableString;break;case 20:c=Se.TeletexString;break;case 21:c=Se.VideotexString;break;case 22:c=Se.IA5String;break;case 23:c=Se.UTCTime;break;case 24:c=Se.GeneralizedTime;break;case 25:c=Se.GraphicString;break;case 26:c=Se.VisibleString;break;case 27:c=Se.GeneralString;break;case 28:c=Se.UniversalString;break;case 29:c=Se.CharacterString;break;case 30:c=Se.BmpString;break;case 31:c=Se.DATE;break;case 32:c=Se.TimeOfDay;break;case 33:c=Se.DateTime;break;case 34:c=Se.Duration;break;default:{const l=i.idBlock.isConstructed?new Se.Constructed:new Se.Primitive;l.idBlock=i.idBlock,l.lenBlock=i.lenBlock,l.warnings=i.warnings,i=l}}break;case 2:case 3:case 4:default:c=i.idBlock.isConstructed?Se.Constructed:Se.Primitive}return i=X6e(i,c),a=i.fromBER(r,e,i.lenBlock.isIndefiniteForm?t:i.lenBlock.length),i.valueBeforeDecodeView=r.subarray(n,n+i.blockLength),{offset:a,result:i}}function No(r){if(!r.byteLength){const e=new Tr({},vn);return e.error="Input buffer has zero length",{offset:-1,result:e}}return Fh(me.toUint8Array(r).slice(),0,r.byteLength)}function J6e(r,e){return r?1:e}class gc extends vn{constructor({value:e=[],isIndefiniteForm:t=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){const i=me.toUint8Array(e);if(!aa(this,i,t,n))return-1;if(this.valueBeforeDecodeView=i.subarray(t,t+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let s=t;for(;J6e(this.isIndefiniteForm,n)>0;){const o=Fh(i,s,n);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(s=o.offset,this.blockLength+=o.result.blockLength,n-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===cp)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===cp?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}toBER(e,t){const n=t||new qw;for(let i=0;i<this.value.length;i++)this.value[i].toBER(e,n);return t?ws:n.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}gc.NAME="ConstructedValueBlock";var $K;class Mn extends Tr{constructor(e={}){super(e,gc),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){const e=[];for(const n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(i=>`  ${i}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}$K=Mn;Se.Constructed=$K;Mn.NAME="CONSTRUCTED";class NK extends vn{fromBER(e,t,n){return t}toBER(e){return ws}}NK.override="EndOfContentValueBlock";var OK;class Rx extends Tr{constructor(e={}){super(e,NK),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}OK=Rx;Se.EndOfContent=OK;Rx.NAME=cp;var MK;class Ho extends Tr{constructor(e={}){super(e,vn),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){const n=new ArrayBuffer(2);if(!e){const i=new Uint8Array(n);i[0]=5,i[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}}MK=Ho;Se.Null=MK;Ho.NAME="NULL";class RK extends Zs(vn){get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=me.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,n){const i=me.toUint8Array(e);return aa(this,i,t,n)?(this.valueHexView=i.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,AK.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}RK.NAME="BooleanValueBlock";var LK;let Gw=class extends Tr{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,RK),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};LK=Gw;Se.Boolean=LK;Gw.NAME="BOOLEAN";class BK extends Zs(gc){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,n){let i=0;if(this.isConstructed){if(this.isHexOnly=!1,i=gc.prototype.fromBER.call(this,e,t,n),i===-1)return i;for(let s=0;s<this.value.length;s++){const o=this.value[s].constructor.NAME;if(o===cp){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==IK)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,i=super.fromBER(e,t,n),this.blockLength=n;return i}toBER(e,t){return this.isConstructed?gc.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}BK.NAME="OctetStringValueBlock";var Lx;let ss=class extends Tr{constructor({idBlock:e={},lenBlock:t={},...n}={}){var i,s;(i=n.isConstructed)!==null&&i!==void 0||(n.isConstructed=!!(!((s=n.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},BK),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const s=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(s.byteLength){const o=Fh(s,0,s.byteLength);o.offset!==-1&&o.offset===n&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Mn.prototype.onAsciiEncoding.call(this);const e=this.constructor.NAME,t=Ce.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof Lx&&e.push(t.valueBlock.valueHexView);return me.concat(e)}};Lx=ss;Se.OctetString=Lx;ss.NAME=IK;class UK extends Zs(gc){constructor({unusedBits:e=0,isConstructed:t=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let i=-1;if(this.isConstructed){if(i=gc.prototype.fromBER.call(this,e,t,n),i===-1)return i;for(const a of this.value){const c=a.constructor.NAME;if(c===cp){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==CK)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const l=a.valueBlock;if(this.unusedBits>0&&l.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=l.unusedBits}return i}const s=me.toUint8Array(e);if(!aa(this,s,t,n))return-1;const o=s.subarray(t,t+n);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const a=o.subarray(1);try{if(a.byteLength){const c=Fh(a,0,a.byteLength);c.offset!==-1&&c.offset===n-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+n}toBER(e,t){if(this.isConstructed)return gc.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return ws;const n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}UK.NAME="BitStringValueBlock";var FK;let Ll=class extends Tr{constructor({idBlock:e={},lenBlock:t={},...n}={}){var i,s;(i=n.isConstructed)!==null&&i!==void 0||(n.isConstructed=!!(!((s=n.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},UK),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Mn.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const o of t)e.push(o.toString(2).padStart(8,"0"));const n=e.join(""),i=this.constructor.NAME,s=n.substring(0,n.length-this.valueBlock.unusedBits);return`${i} : ${s}`}}};FK=Ll;Se.BitString=FK;Ll.NAME=CK;var zK;function Z6e(r,e){const t=new Uint8Array([0]),n=new Uint8Array(r),i=new Uint8Array(e);let s=n.slice(0);const o=s.length-1,a=i.slice(0),c=a.length-1;let l=0;const d=c<o?o:c;let h=0;for(let p=d;p>=0;p--,h++){switch(!0){case h<a.length:l=s[o-h]+a[c-h]+t[0];break;default:l=s[o-h]+t[0]}switch(t[0]=l/10,!0){case h>=s.length:s=Jb(new Uint8Array([l%10]),s);break;default:s[o-h]=l%10}}return t[0]>0&&(s=Jb(t,s)),s}function kP(r){if(r>=Of.length)for(let e=Of.length;e<=r;e++){const t=new Uint8Array([0]);let n=Of[e-1].slice(0);for(let i=n.length-1;i>=0;i--){const s=new Uint8Array([(n[i]<<1)+t[0]]);t[0]=s[0]/10,n[i]=s[0]%10}t[0]>0&&(n=Jb(t,n)),Of.push(n)}return Of[r]}function e5e(r,e){let t=0;const n=new Uint8Array(r),i=new Uint8Array(e),s=n.slice(0),o=s.length-1,a=i.slice(0),c=a.length-1;let l,d=0;for(let h=c;h>=0;h--,d++)switch(l=s[o-d]-a[c-d]-t,!0){case l<0:t=1,s[o-d]=l+10;break;default:t=0,s[o-d]=l}if(t>0)for(let h=o-c+1;h>=0;h--,d++)if(l=s[o-d]-t,l<0)t=1,s[o-d]=l+10;else{t=0,s[o-d]=l;break}return s.slice()}class Bx extends Zs(vn){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=AK.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(z6e(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,i=0){const s=this.fromBER(e,t,n);if(s===-1)return s;const o=this.valueHexView;return o[0]===0&&o[1]&128?this.valueHexView=o.subarray(1):i!==0&&o.length<i&&(i-o.length>1&&(i=o.length+1),this.valueHexView=o.subarray(i-o.length)),s}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(t,1),this.valueHexView=n}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,n){const i=super.fromBER(e,t,n);return i===-1||this.setValueHex(),i}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),n=0,i;const s=this.valueHexView;let o="",a=!1;for(let c=s.byteLength-1;c>=0;c--){i=s[c];for(let l=0;l<8;l++){if((i&1)===1)switch(n){case e:t=e5e(kP(n),t),o="-";break;default:t=Z6e(t,kP(n))}n++,i>>=1}}for(let c=0;c<t.length;c++)t[c]&&(a=!0),a&&(o+=IP.charAt(t[c]));return a===!1&&(o+=IP.charAt(0)),o}}zK=Bx;Bx.NAME="IntegerValueBlock";Object.defineProperty(zK.prototype,"valueHex",{set:function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var h1;class Oo extends Tr{constructor(e={}){super(e,Bx),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return km(),BigInt(this.valueBlock.toString())}static fromBigInt(e){km();const t=BigInt(e),n=new qw,i=t.toString(16).replace(/^-/,""),s=new Uint8Array(Ce.FromHex(i));if(t<0){const a=new Uint8Array(s.length+(s[0]&128?1:0));a[0]|=128;const l=BigInt(`0x${Ce.ToHex(a)}`)+t,d=me.toUint8Array(Ce.FromHex(l.toString(16)));d[0]|=128,n.write(d)}else s[0]&128&&n.write(new Uint8Array([0])),n.write(s);return new h1({valueHex:n.final()})}convertToDER(){const e=new h1({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new h1({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}h1=Oo;Se.Integer=h1;Oo.NAME="INTEGER";var VK;class Qw extends Oo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}VK=Qw;Se.Enumerated=VK;Qw.NAME="ENUMERATED";class Zb extends Zs(vn){constructor({valueDec:e=-1,isFirstSid:t=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;const i=me.toUint8Array(e);if(!aa(this,i,t,n))return-1;const s=i.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=s[a]&127,this.blockLength++,!!(s[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,s[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=hh(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){km();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const n=new Uint8Array(t.length/7);for(let i=0;i<n.length;i++)n[i]=parseInt(t.slice(i*7,i*7+7),2)+(i+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=i[o]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}const t=tu(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",ws;const n=new Uint8Array(t.byteLength);if(!e){const i=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)n[o]=i[o]|128;n[s]=i[s]}return n}toString(){let e="";if(this.isHexOnly)e=Ce.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}Zb.NAME="sidBlock";class KK extends vn{constructor({value:e=Cn,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let i=t;for(;n>0;){const s=new Zb;if(i=s.fromBER(e,i,n),i===-1)return this.blockLength=0,this.error=s.error,i;this.value.length===0&&(s.isFirstSid=!0),this.blockLength+=s.blockLength,n-=s.blockLength,this.value.push(s)}return i}toBER(e){const t=[];for(let n=0;n<this.value.length;n++){const i=this.value[n].toBER(e);if(i.byteLength===0)return this.error=this.value[n].error,ws;t.push(i)}return Ox(t)}fromString(e){this.value=[];let t=0,n=0,i="",s=!1;do if(n=e.indexOf(".",t),n===-1?i=e.substring(t):i=e.substring(t,n),t=n+1,s){const o=this.value[0];let a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}const c=parseInt(i,10);if(isNaN(c))return;o.valueDec=c+a,s=!1}else{const o=new Zb;if(i>Number.MAX_SAFE_INTEGER){km();const a=BigInt(i);o.valueBigInt=a}else if(o.valueDec=parseInt(i,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,s=!0),this.value.push(o)}while(n!==-1)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let i=this.value[n].toString();n!==0&&(e=`${e}.`),t?(i=`{${i}}`,this.value[n].isFirstSid?e=`2.{${i} - 80}`:e+=i):e+=i}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}KK.NAME="ObjectIdentifierValueBlock";var HK;class Co extends Tr{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,KK),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}HK=Co;Se.ObjectIdentifier=HK;Co.NAME="OBJECT IDENTIFIER";class e7 extends Zs(Su){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,n){if(n===0)return t;const i=me.toUint8Array(e);if(!aa(this,i,t,n))return-1;const s=i.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=s[a]&127,this.blockLength++,!!(s[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,s[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=hh(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=i[o]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}const t=tu(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",ws;const n=new Uint8Array(t.byteLength);if(!e){const i=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)n[o]=i[o]|128;n[s]=i[s]}return n.buffer}toString(){let e="";return this.isHexOnly?e=Ce.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}e7.NAME="relativeSidBlock";class jK extends vn{constructor({value:e=Cn,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let i=t;for(;n>0;){const s=new e7;if(i=s.fromBER(e,i,n),i===-1)return this.blockLength=0,this.error=s.error,i;this.blockLength+=s.blockLength,n-=s.blockLength,this.value.push(s)}return i}toBER(e,t){const n=[];for(let i=0;i<this.value.length;i++){const s=this.value[i].toBER(e);if(s.byteLength===0)return this.error=this.value[i].error,ws;n.push(s)}return Ox(n)}fromString(e){this.value=[];let t=0,n=0,i="";do{n=e.indexOf(".",t),n===-1?i=e.substring(t):i=e.substring(t,n),t=n+1;const s=new e7;if(s.valueDec=parseInt(i,10),isNaN(s.valueDec))return!0;this.value.push(s)}while(n!==-1);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let i=this.value[n].toString();n!==0&&(e=`${e}.`),t&&(i=`{${i}}`),e+=i}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}jK.NAME="RelativeObjectIdentifierValueBlock";var qK;class Ux extends Tr{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,jK),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}qK=Ux;Se.RelativeObjectIdentifier=qK;Ux.NAME="RelativeObjectIdentifier";var WK;class gr extends Mn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}WK=gr;Se.Sequence=WK;gr.NAME="SEQUENCE";var GK;let Mo=class extends Mn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};GK=Mo;Se.Set=GK;Mo.NAME="SET";class QK extends Zs(vn){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=Cn}toJSON(){return{...super.toJSON(),value:this.value}}}QK.NAME="StringValueBlock";class YK extends QK{}YK.NAME="SimpleStringValueBlock";class pi extends Mx{constructor({...e}={}){super(e,YK)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,me.toUint8Array(e))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);this.valueBlock.value=e}}pi.NAME="SIMPLE STRING";class XK extends pi{fromBuffer(e){this.valueBlock.valueHexView=me.toUint8Array(e);try{this.valueBlock.value=Ce.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=Ce.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(Ce.FromUtf8String(e)),this.valueBlock.value=e}}XK.NAME="Utf8StringValueBlock";var JK;class ca extends XK{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}JK=ca;Se.Utf8String=JK;ca.NAME="UTF8String";class ZK extends pi{fromBuffer(e){this.valueBlock.value=Ce.ToUtf16String(e),this.valueBlock.valueHexView=me.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(Ce.FromUtf16String(e))}}ZK.NAME="BmpStringValueBlock";var eH;class Yw extends ZK{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}eH=Yw;Se.BmpString=eH;Yw.NAME="BMPString";class tH extends pi{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let i=0;i<n.length;i+=4)n[i]=n[i+3],n[i+1]=n[i+2],n[i+2]=0,n[i+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let i=0;i<t;i++){const s=tu(e.charCodeAt(i),8),o=new Uint8Array(s);if(o.length>4)continue;const a=4-o.length;for(let c=o.length-1;c>=0;c--)n[i*4+c+a]=o[c]}this.valueBlock.value=e}}tH.NAME="UniversalStringValueBlock";var rH;class Xw extends tH{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}rH=Xw;Se.UniversalString=rH;Xw.NAME="UniversalString";var nH;class Jw extends pi{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}nH=Jw;Se.NumericString=nH;Jw.NAME="NumericString";var iH;class Zw extends pi{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}iH=Zw;Se.PrintableString=iH;Zw.NAME="PrintableString";var sH;class e4 extends pi{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}sH=e4;Se.TeletexString=sH;e4.NAME="TeletexString";var oH;class t4 extends pi{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}oH=t4;Se.VideotexString=oH;t4.NAME="VideotexString";var aH;class r4 extends pi{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}aH=r4;Se.IA5String=aH;r4.NAME="IA5String";var cH;class n4 extends pi{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}cH=n4;Se.GraphicString=cH;n4.NAME="GraphicString";var lH;class t0 extends pi{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}lH=t0;Se.VisibleString=lH;t0.NAME="VisibleString";var uH;class i4 extends pi{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}uH=i4;Se.GeneralString=uH;i4.NAME="GeneralString";var dH;class s4 extends pi{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}dH=s4;Se.CharacterString=dH;s4.NAME="CharacterString";var hH;class r0 extends t0{constructor({value:e,valueDate:t,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let i=0;i<e.length;i++)this.valueBlock.valueHexView[i]=e.charCodeAt(i)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,me.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}const i=parseInt(n[1],10);i>=50?this.year=1900+i:this.year=2e3+i,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=Xn(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=Xn(this.month,2),t[2]=Xn(this.day,2),t[3]=Xn(this.hour,2),t[4]=Xn(this.minute,2),t[5]=Xn(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}hH=r0;Se.UTCTime=hH;r0.NAME="UTCTime";var fH;class o4 extends r0{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){const e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,n="",i="",s=0,o,a=0,c=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),t=!0;else{const h=new Number(e[e.length-1]);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(t){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let h=1,p=n.indexOf("+"),w="";if(p===-1&&(p=n.indexOf("-"),h=-1),p!==-1){if(w=n.substring(p+1),n=n.substring(0,p),w.length!==2&&w.length!==4)throw new Error("Wrong input string for conversion");let f=parseInt(w.substring(0,2),10);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");if(a=h*f,w.length===4){if(f=parseInt(w.substring(2,4),10),isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");c=h*f}}}let l=n.indexOf(".");if(l===-1&&(l=n.indexOf(",")),l!==-1){const h=new Number(`0${n.substring(l)}`);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");s=h.valueOf(),i=n.substring(0,l)}else i=n;switch(!0){case i.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,l!==-1)throw new Error("Wrong input string for conversion");break;case i.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let h=60*s;this.minute=Math.floor(h),h=60*(h-this.minute),this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case i.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let h=60*s;this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case i.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){const h=1e3*s;this.millisecond=Math.floor(h)}break;default:throw new Error("Wrong input string for conversion")}const d=o.exec(i);if(d===null)throw new Error("Wrong input string for conversion");for(let h=1;h<d.length;h++)switch(h){case 1:this.year=parseInt(d[h],10);break;case 2:this.month=parseInt(d[h],10);break;case 3:this.day=parseInt(d[h],10);break;case 4:this.hour=parseInt(d[h],10)+a;break;case 5:this.minute=parseInt(d[h],10)+c;break;case 6:this.second=parseInt(d[h],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const h=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=h.getUTCFullYear(),this.month=h.getUTCMonth(),this.day=h.getUTCDay(),this.hour=h.getUTCHours(),this.minute=h.getUTCMinutes(),this.second=h.getUTCSeconds(),this.millisecond=h.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push(Xn(this.year,4)),t.push(Xn(this.month,2)),t.push(Xn(this.day,2)),t.push(Xn(this.hour,2)),t.push(Xn(this.minute,2)),t.push(Xn(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(Xn(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}fH=o4;Se.GeneralizedTime=fH;o4.NAME="GeneralizedTime";var pH;class Fx extends ca{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}pH=Fx;Se.DATE=pH;Fx.NAME="DATE";var gH;class zx extends ca{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}gH=zx;Se.TimeOfDay=gH;zx.NAME="TimeOfDay";var yH;class Vx extends ca{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}yH=Vx;Se.DateTime=yH;Vx.NAME="DateTime";var mH;class Kx extends ca{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}mH=Kx;Se.Duration=mH;Kx.NAME="Duration";var wH;class Hx extends ca{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}wH=Hx;Se.TIME=wH;Hx.NAME="TIME";class ru{constructor({name:e=Cn,optional:t=!1}={}){this.name=e,this.optional=t}}class jx extends ru{constructor({value:e=[],...t}={}){super(t),this.value=e}}class _m extends ru{constructor({value:e=new ru,local:t=!1,...n}={}){super(n),this.value=e,this.local=t}}class t5e{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=me.toUint8Array(e)}constructor({data:e=Ww}={}){this.dataView=me.toUint8Array(e)}fromBER(e,t,n){const i=t+n;return this.dataView=me.toUint8Array(e).subarray(t,i),i}toBER(e){return this.dataView.slice().buffer}}function bl(r,e,t){if(t instanceof jx){for(const s of t.value)if(bl(r,e,s).verified)return{verified:!0,result:r};{const s={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(x6)&&(s.name=t.name),s}}if(t instanceof ru)return t.hasOwnProperty(x6)&&(r[t.name]=e),{verified:!0,result:r};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(H6e in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(G6e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(Q6e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const n=t.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(j6e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(q6e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(W6e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:r};if(!(K6e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:r};if(t.idBlock.isHexOnly){if(!(CP in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const s=t.idBlock.valueHexView,o=e.idBlock.valueHexView;if(s.length!==o.length)return{verified:!1,result:r};for(let a=0;a<s.length;a++)if(s[a]!==o[1])return{verified:!1,result:r}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Cn),t.name&&(r[t.name]=e)),t instanceof Se.Constructed){let s=0,o={verified:!1,result:{error:"Unknown error"}},a=t.valueBlock.value.length;if(a>0&&t.valueBlock.value[0]instanceof _m&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:r};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let c=!0;for(let l=0;l<t.valueBlock.value.length;l++)c=c&&(t.valueBlock.value[l].optional||!1);return c?{verified:!0,result:r}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Cn),t.name&&delete r[t.name]),r.error="Inconsistent object length",{verified:!1,result:r})}for(let c=0;c<a;c++)if(c-s>=e.valueBlock.value.length){if(t.valueBlock.value[c].optional===!1){const l={verified:!1,result:r};return r.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Cn),t.name&&(delete r[t.name],l.name=t.name)),l}}else if(t.valueBlock.value[0]instanceof _m){if(o=bl(r,e.valueBlock.value[c],t.valueBlock.value[0].value),o.verified===!1)if(t.valueBlock.value[0].optional)s++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Cn),t.name&&delete r[t.name]),o;if(x6 in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let l={};Y6e in t.valueBlock.value[0]&&t.valueBlock.value[0].local?l=e:l=r,typeof l[t.valueBlock.value[0].name]>"u"&&(l[t.valueBlock.value[0].name]=[]),l[t.valueBlock.value[0].name].push(e.valueBlock.value[c])}}else if(o=bl(r,e.valueBlock.value[c-s],t.valueBlock.value[c]),o.verified===!1)if(t.valueBlock.value[c].optional)s++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Cn),t.name&&delete r[t.name]),o;if(o.verified===!1){const c={verified:!1,result:r};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Cn),t.name&&(delete r[t.name],c.name=t.name)),c}return{verified:!0,result:r}}if(t.primitiveSchema&&CP in e.valueBlock){const s=Fh(e.valueBlock.valueHexView);if(s.offset===-1){const o={verified:!1,result:s.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Cn),t.name&&(delete r[t.name],o.name=t.name)),o}return bl(r,s.result,t.primitiveSchema)}return{verified:!0,result:r}}function r5e(r,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};const t=Fh(me.toUint8Array(r));return t.offset===-1?{verified:!1,result:t.result}:bl(t.result,t.result,e)}const vH=Object.freeze(Object.defineProperty({__proto__:null,Any:ru,BaseBlock:Tr,BaseStringBlock:Mx,BitString:Ll,BmpString:Yw,Boolean:Gw,CharacterString:s4,Choice:jx,Constructed:Mn,DATE:Fx,DateTime:Vx,Duration:Kx,EndOfContent:Rx,Enumerated:Qw,GeneralString:i4,GeneralizedTime:o4,GraphicString:n4,HexBlock:Zs,IA5String:r4,Integer:Oo,Null:Ho,NumericString:Jw,ObjectIdentifier:Co,OctetString:ss,Primitive:e0,PrintableString:Zw,RawData:t5e,RelativeObjectIdentifier:Ux,Repeated:_m,Sequence:gr,Set:Mo,TIME:Hx,TeletexString:e4,TimeOfDay:zx,UTCTime:r0,UniversalString:Xw,Utf8String:ca,ValueBlock:vn,VideotexString:t4,ViewWriter:qw,VisibleString:t0,compareSchema:bl,fromBER:No,verifySchema:r5e},Symbol.toStringTag,{value:"Module"})),bH=jw({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});jw({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});jw({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});jw({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const n5e=16,t7=32,r7=1e4;async function a4(r,e){const n=await SK().encrypt(r,e);return bH.encode(n)}async function _P(r,e,t){if(r.type==="RSA")return a5e(r,e,t);if(r.type==="Ed25519")return i5e(r,e,t);if(r.type==="secp256k1")return s5e(r,e,t);if(r.type==="ECDSA")return o5e(r,e,t);throw new bu}async function i5e(r,e,t="libp2p-key"){if(t==="libp2p-key")return a4(qp(r),e);throw new ie(`export format '${t}' is not supported`)}async function s5e(r,e,t="libp2p-key"){if(t==="libp2p-key")return a4(qp(r),e);throw new ie("Export format is not supported")}async function o5e(r,e,t="libp2p-key"){if(t==="libp2p-key")return a4(qp(r),e);throw new ie(`export format '${t}' is not supported`)}async function a5e(r,e,t="pkcs-8"){if(t==="pkcs-8")return c5e(r,e);if(t==="libp2p-key")return a4(qp(r),e);throw new ie("Export format is not supported")}async function c5e(r,e){const t=qs.get(),i=new gr({value:[new Oo({value:0}),new gr({value:[new Co({value:"1.2.840.113549.1.1.1"}),new Ho]}),new ss({valueHex:r.raw})]}).toBER(),s=new Uint8Array(i,0,i.byteLength),o=Ac(n5e),a=await tF(VS,e,o,{c:r7,dkLen:t7}),c=Ac(16),l=await t.subtle.importKey("raw",a,"AES-CBC",!1,["encrypt"]),d=await t.subtle.encrypt({name:"AES-CBC",iv:c},l,s),h=new gr({value:[new ss({valueHex:o}),new Oo({value:r7}),new Oo({value:t7}),new gr({value:[new Co({value:"1.2.840.113549.2.11"}),new Ho]})]}),p=new gr({value:[new Co({value:"1.2.840.113549.1.5.13"}),new gr({value:[new gr({value:[new Co({value:"1.2.840.113549.1.5.12"}),h]}),new gr({value:[new Co({value:"2.16.840.1.101.3.4.1.42"}),new ss({valueHex:c})]})]})]}),f=new gr({value:[p,new ss({valueHex:d})]}).toBER(),g=new Uint8Array(f,0,f.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...ae(g,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join(`
`)}async function TP(r,e){try{const t=await l5e(r,e);return Uie(t)}catch{}if(!r.includes("BEGIN"))throw new ie("Encrypted key was not a libp2p-key or a PEM file");return u5e(r,e)}async function l5e(r,e){const t=bH.decode(r);return SK().decrypt(t,e)}async function u5e(r,e){const t=qs.get();let n;if(r.includes("-----BEGIN ENCRYPTED PRIVATE KEY-----")){const s=fe(r.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:o}=No(s),{iv:a,salt:c,iterations:l,keySize:d,cipherText:h}=d5e(o),p=await tF(VS,e,c,{c:l,dkLen:d}),w=await t.subtle.importKey("raw",p,"AES-CBC",!1,["decrypt"]),f=f1(await t.subtle.decrypt({name:"AES-CBC",iv:a},w,h)),{result:g}=No(f);n=PP(g)}else if(r.includes("-----BEGIN PRIVATE KEY-----")){const s=fe(r.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:o}=No(s);n=PP(o)}else throw new ie("Could not parse private key from PEM data");const i=Pv(n);if(i.type!=="RSA")throw new ie("Could not parse RSA private key from PEM data");return i}function d5e(r){const e=r.valueBlock.value[0];if(e.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.13")throw new ie("Only pkcs5PBES2 encrypted private keys are supported");const n=e.valueBlock.value[1].valueBlock.value[0];if(n.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.12")throw new ie("Only pkcs5PBKDF2 key derivation functions are supported");const s=n.valueBlock.value[1],o=f1(s.valueBlock.value[0].getValue());let a=r7,c=t7;if(s.valueBlock.value.length===3)a=Number(s.valueBlock.value[1].toBigInt()),c=Number(s.valueBlock.value[2].toBigInt());else if(s.valueBlock.value.length===2)throw new ie("Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key");const l=e.valueBlock.value[1].valueBlock.value[1],d=l.valueBlock.value[0].toString();if(d!=="OBJECT IDENTIFIER : 1.2.840.113549.3.7"){if(d!=="OBJECT IDENTIFIER : 1.3.14.3.2.7"){if(d!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2"){if(d!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22"){if(d!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42")throw new ie("Only AES-CBC encryption schemes are supported")}}}}const h=f1(l.valueBlock.value[1].getValue());return{cipherText:f1(r.valueBlock.value[1].getValue()),salt:o,iterations:a,keySize:c,iv:h}}function PP(r){return f1(r.valueBlock.value[2].getValue())}function f1(r){return new Uint8Array(r,0,r.byteLength)}const h5e="/pkcs8/",n7="/info/",Mf=new WeakMap,rl={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},A6={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function Fu(r){return r==null||typeof r!="string"?!1:r===M6e(r.trim())&&r.length>0}async function br(){const t=Math.random()*800+200;await new Promise(n=>setTimeout(n,t))}function nl(r){return new _t(h5e+r)}function zu(r){return new _t(n7+r)}async function f5e(r){const e=qp(r),t=await w6e.digest(e);return X8e.encode(t.bytes).substring(1)}var qN,WN;WN=Symbol.toStringTag,qN=lr;class p5e{constructor(e,t){u(this,"components");u(this,"init");u(this,"log");u(this,"self");u(this,WN,"@libp2p/keychain");u(this,qN,["@libp2p/keychain"]);var i,s,o,a,c,l,d,h,p,w;if(this.components=e,this.log=e.logger.forComponent("libp2p:keychain"),this.init=Nx(A6,t),this.self=t.selfKey??"self",this.init.pass!=null&&((i=this.init.pass)==null?void 0:i.length)<20)throw new Error("pass must be least 20 characters");if(((s=this.init.dek)==null?void 0:s.keyLength)!=null&&this.init.dek.keyLength<rl.minKeyLength)throw new Error(`dek.keyLength must be least ${rl.minKeyLength} bytes`);if(((a=(o=this.init.dek)==null?void 0:o.salt)==null?void 0:a.length)!=null&&this.init.dek.salt.length<rl.minSaltLength)throw new Error(`dek.saltLength must be least ${rl.minSaltLength} bytes`);if(((c=this.init.dek)==null?void 0:c.iterationCount)!=null&&this.init.dek.iterationCount<rl.minIterationCount)throw new Error(`dek.iterationCount must be least ${rl.minIterationCount}`);const n=this.init.pass!=null&&((l=this.init.dek)==null?void 0:l.salt)!=null?Nk(this.init.pass,(d=this.init.dek)==null?void 0:d.salt,(h=this.init.dek)==null?void 0:h.iterationCount,(p=this.init.dek)==null?void 0:p.keyLength,(w=this.init.dek)==null?void 0:w.hash):"";Mf.set(this,{dek:n})}static generateOptions(){const e=Object.assign({},A6),t=Math.ceil(rl.minSaltLength/3)*3;return e.dek.salt=ae(Ac(t),"base64"),e}static get options(){return A6}async findKeyByName(e){if(!Fu(e))throw await br(),new ie(`Invalid key name '${e}'`);const t=zu(e);try{const n=await this.components.datastore.get(t);return JSON.parse(ae(n))}catch(n){throw await br(),this.log.error(n),new sr(`Key '${e}' does not exist.`)}}async findKeyById(e){try{const t={prefix:n7};for await(const n of this.components.datastore.query(t)){const i=JSON.parse(ae(n.value));if(i.id===e)return i}throw new ie(`Key with id '${e}' does not exist.`)}catch(t){throw await br(),t}}async importKey(e,t){if(!Fu(e))throw await br(),new ie(`Invalid key name '${e}'`);if(t==null)throw await br(),new ie("Key is required");const n=nl(e);if(await this.components.datastore.has(n))throw await br(),new ie(`Key '${e}' already exists`);let s,o;try{s=await f5e(t);const l=Mf.get(this);if(l==null)throw new ie("dek missing");const d=l.dek;o=await _P(t,d,t.type==="RSA"?"pkcs-8":"libp2p-key")}catch(l){throw await br(),l}const a={name:e,id:s},c=this.components.datastore.batch();return c.put(n,fe(o)),c.put(zu(e),fe(JSON.stringify(a))),await c.commit(),a}async exportKey(e){if(!Fu(e))throw await br(),new ie(`Invalid key name '${e}'`);const t=nl(e);try{const n=await this.components.datastore.get(t),i=ae(n),s=Mf.get(this);if(s==null)throw new ie("dek missing");const o=s.dek;return await TP(i,o)}catch(n){throw await br(),n}}async removeKey(e){if(!Fu(e)||e===this.self)throw await br(),new ie(`Invalid key name '${e}'`);const t=nl(e),n=await this.findKeyByName(e),i=this.components.datastore.batch();return i.delete(t),i.delete(zu(e)),await i.commit(),n}async listKeys(){const e={prefix:n7},t=[];for await(const n of this.components.datastore.query(e))t.push(JSON.parse(ae(n.value)));return t}async renameKey(e,t){if(!Fu(e)||e===this.self)throw await br(),new ie(`Invalid old key name '${e}'`);if(!Fu(t)||t===this.self)throw await br(),new ie(`Invalid new key name '${t}'`);const n=nl(e),i=nl(t),s=zu(e),o=zu(t);if(await this.components.datastore.has(i))throw await br(),new ie(`Key '${t}' already exists`);try{const c=await this.components.datastore.get(n),l=await this.components.datastore.get(s),d=JSON.parse(ae(l));d.name=t;const h=this.components.datastore.batch();return h.put(i,c),h.put(o,fe(JSON.stringify(d))),h.delete(n),h.delete(s),await h.commit(),d}catch(c){throw await br(),c}}async rotateKeychainPass(e,t){var a,c,l,d;if(typeof e!="string")throw await br(),new ie(`Invalid old pass type '${typeof e}'`);if(typeof t!="string")throw await br(),new ie(`Invalid new pass type '${typeof t}'`);if(t.length<20)throw await br(),new ie(`Invalid pass length ${t.length}`);this.log("recreating keychain");const n=Mf.get(this);if(n==null)throw new ie("dek missing");const i=n.dek;this.init.pass=t;const s=t!=null&&((a=this.init.dek)==null?void 0:a.salt)!=null?Nk(t,this.init.dek.salt,(c=this.init.dek)==null?void 0:c.iterationCount,(l=this.init.dek)==null?void 0:l.keyLength,(d=this.init.dek)==null?void 0:d.hash):"";Mf.set(this,{dek:s});const o=await this.listKeys();for(const h of o){const p=await this.components.datastore.get(nl(h.name)),w=ae(p),f=await TP(w,i),g=s.toString(),v=await _P(f,g,f.type==="RSA"?"pkcs-8":"libp2p-key"),y=this.components.datastore.batch(),m={name:h.name,id:h.id};y.put(nl(h.name),fe(v)),y.put(zu(h.name),fe(JSON.stringify(m))),await y.commit()}this.log("keychain reconstructed")}}function EH(r={}){return e=>new p5e(e,r)}class SH{constructor(e={}){u(this,"memoryStorage");u(this,"points");u(this,"duration");u(this,"blockDuration");u(this,"execEvenly");u(this,"execEvenlyMinDelayMs");u(this,"keyPrefix");this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??this.duration*1e3/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new g5e}async consume(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n);let o=this.memoryStorage.incrby(i,t,s);if(o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.consumedPoints>this.points)throw this.blockDuration>0&&o.consumedPoints<=this.points+t&&(o=this.memoryStorage.set(i,o.consumedPoints,this.blockDuration)),new hse("Rate limit exceeded",o);if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let a=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));a<this.execEvenlyMinDelayMs&&(a=o.consumedPoints*this.execEvenlyMinDelayMs),await tK(a)}return o}penalty(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n),o=this.memoryStorage.incrby(i,t,s);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}reward(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n),o=this.memoryStorage.incrby(i,-t,s);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}block(e,t){const n=t*1e3,i=this.points+1;return this.memoryStorage.set(this.getKey(e),i,t),{remainingPoints:0,msBeforeNext:n===0?-1:n,consumedPoints:i,isFirstInDuration:!1}}set(e,t,n=0){const i=(n>=0?n:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,n),{remainingPoints:0,msBeforeNext:i===0?-1:i,consumedPoints:t,isFirstInDuration:!1}}get(e){const t=this.memoryStorage.get(this.getKey(e));return t!=null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return(e==null?void 0:e.customDuration)!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}}class g5e{constructor(){u(this,"storage");this.storage=new Map}incrby(e,t,n){const i=this.storage.get(e);if(i!=null){const s=i.expiresAt!=null?i.expiresAt.getTime()-new Date().getTime():-1;return i.expiresAt==null||s>0?(i.value+=t,{remainingPoints:0,msBeforeNext:s,consumedPoints:i.value,isFirstInDuration:!1}):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){const i=n*1e3,s=this.storage.get(e);s!=null&&clearTimeout(s.timeoutId);const o={value:t,expiresAt:i>0?new Date(Date.now()+i):void 0};return this.storage.set(e,o),i>0&&(o.timeoutId=setTimeout(()=>{this.storage.delete(e)},i),o.timeoutId.unref!=null&&o.timeoutId.unref()),{remainingPoints:0,msBeforeNext:i===0?-1:i,consumedPoints:o.value,isFirstInDuration:!0}}get(e){const t=this.storage.get(e);if(t!=null)return{remainingPoints:0,msBeforeNext:t.expiresAt!=null?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){const t=this.storage.get(e);return t!=null?(t.timeoutId!=null&&clearTimeout(t.timeoutId),this.storage.delete(e),!0):!1}}var lt;(function(r){r[r.NEW_STREAM=0]="NEW_STREAM",r[r.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",r[r.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",r[r.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",r[r.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",r[r.RESET_RECEIVER=5]="RESET_RECEIVER",r[r.RESET_INITIATOR=6]="RESET_INITIATOR"})(lt||(lt={}));const qx=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),DP=Object.freeze({NEW_STREAM:lt.NEW_STREAM,MESSAGE:lt.MESSAGE_INITIATOR,CLOSE:lt.CLOSE_INITIATOR,RESET:lt.RESET_INITIATOR}),y5e=Object.freeze({MESSAGE:lt.MESSAGE_RECEIVER,CLOSE:lt.CLOSE_RECEIVER,RESET:lt.RESET_RECEIVER}),xH=1<<20,m5e=4<<20;let w5e=class{constructor(e=xH,t=m5e){u(this,"_buffer");u(this,"_headerInfo");u(this,"_maxMessageSize");u(this,"_maxUnprocessedMessageQueueSize");this._buffer=new He,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw new Pt("Unprocessed message queue size too large!");const t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(l){if(l.name==="InvalidMessageError")throw l;break}const{id:n,type:i,length:s,offset:o}=this._headerInfo;if(this._buffer.length-o<s)break;const c={id:n,type:i};(i===lt.NEW_STREAM||i===lt.MESSAGE_INITIATOR||i===lt.MESSAGE_RECEIVER)&&(c.data=this._buffer.sublist(o,o+s)),t.push(c),this._buffer.consume(o+s),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:n}=NP(e),{value:i,offset:s}=NP(e,n),o=t&7;if(qx[o]==null)throw new Error(`Invalid type received: ${o}`);if(i>this._maxMessageSize)throw new Pt("Message size too large");return{id:t>>3,type:o,offset:n+s,length:i}}};const v5e=128,$P=127;function NP(r,e=0){let t=0,n=0,i=e,s;const o=r.length;do{if(i>=o||n>49)throw e=0,new RangeError("Could not decode varint");s=r.get(i++),t+=n<28?(s&$P)<<n:(s&$P)*Math.pow(2,n),n+=7}while(s>=v5e);return e=i-e,{value:t,offset:e}}const I6=10*1024;let b5e=class{constructor(){u(this,"_pool");u(this,"_poolOffset");this._pool=Ln(I6),this._poolOffset=0}write(e,t){const n=this._pool;let i=this._poolOffset;kr(e.id<<3|e.type,n,i),i+=At(e.id<<3|e.type),(e.type===lt.NEW_STREAM||e.type===lt.MESSAGE_INITIATOR||e.type===lt.MESSAGE_RECEIVER)&&e.data!=null?(kr(e.data.length,n,i),i+=At(e.data.length)):(kr(0,n,i),i+=At(0));const s=n.subarray(this._poolOffset,i);I6-i<100?(this._pool=Ln(I6),this._poolOffset=0):this._poolOffset=i,t.append(s),(e.type===lt.NEW_STREAM||e.type===lt.MESSAGE_INITIATOR||e.type===lt.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}};const E5e=new b5e;async function*S5e(r){for await(const e of r){const t=new He;E5e.write(e,t),yield t}}class x5e extends Error{constructor(e="Stream input buffer error"){super(e),this.name="StreamInputBufferError"}}class A5e extends Ix{constructor(t){super(t);u(this,"name");u(this,"streamId");u(this,"send");u(this,"types");u(this,"maxDataSize");this.types=t.direction==="outbound"?DP:y5e,this.send=t.send,this.name=t.name,this.streamId=t.streamId,this.maxDataSize=t.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:DP.NEW_STREAM,data:new He(fe(this.name))})}async sendData(t){for(t=t.sublist();t.byteLength>0;){const n=Math.min(t.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:t.sublist(0,n)}),t.consume(n)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}function I5e(r){const{id:e,name:t,send:n,onEnd:i,type:s="initiator",maxMsgSize:o=xH}=r;return new A5e({id:s==="initiator"?`i${e}`:`r${e}`,streamId:e,name:`${t??e}`,direction:s==="initiator"?"outbound":"inbound",maxDataSize:o,onEnd:i,send:n,log:r.logger.forComponent(`libp2p:mplex:stream:${s}:${e}`)})}const C5e=1024,k5e=1024,_5e=1024*1024*4,T5e=5,P5e=500;function OP(r){const e={...r,type:`${qx[r.type]} (${r.type})`};return r.type===lt.NEW_STREAM&&(e.data=ae(r.data instanceof Uint8Array?r.data:r.data.subarray())),(r.type===lt.MESSAGE_INITIATOR||r.type===lt.MESSAGE_RECEIVER)&&(e.data=ae(r.data instanceof Uint8Array?r.data:r.data.subarray(),"base16")),e}class D5e{constructor(e,t){u(this,"protocol","/mplex/6.7.0");u(this,"sink");u(this,"source");u(this,"log");u(this,"_streamId");u(this,"_streams");u(this,"_init");u(this,"_source");u(this,"closeController");u(this,"rateLimiter");u(this,"closeTimeout");u(this,"logger");t=t??{},this.log=e.logger.forComponent("libp2p:mplex"),this.logger=e.logger,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=t,this.closeTimeout=t.closeTimeout??P5e,this.sink=this._createSink(),this._source=zo({objectMode:!0,onEnd:()=>{for(const n of this._streams.initiators.values())n.destroy();for(const n of this._streams.receivers.values())n.destroy()}}),this.source=gn(this._source,n=>S5e(n)),this.closeController=new AbortController,this.rateLimiter=new SH({points:t.disconnectThreshold??T5e,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new cl("Muxer already closed");const t=this._streamId++;e=e==null?t.toString():e.toString();const n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}async close(e){if(this.closeController.signal.aborted)return;const t=(e==null?void 0:e.signal)??AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map(async n=>n.close({signal:t}))),this._source.end(),await this._source.onEmpty({signal:t}),this.closeController.abort()}catch(n){this.abort(n)}}abort(e){this.closeController.signal.aborted||(this.streams.forEach(t=>{t.abort(e)}),this.closeController.abort(e))}_newReceiverStream(e){const{id:t,name:n}=e,i=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:i})}_newStream(e){const{id:t,name:n,type:i,registry:s}=e;if(this.log("new %s stream %s",i,t),i==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??k5e))throw new rw("Too many outbound streams open");if(s.has(t))throw new Error(`${i} stream ${t} already exists!`);const c=I5e({id:t,name:n,send:async l=>{this.log.enabled&&this.log.trace("%s stream %s send",i,t,OP(l)),this._source.push(l)},type:i,onEnd:()=>{this.log("%s stream with id %s and protocol %s ended",i,t,c.protocol),s.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(c)},maxMsgSize:this._init.maxMsgSize,logger:this.logger});return s.set(t,c),c}_createSink(){return async t=>{const n=()=>{PV(t,this.log)};this.closeController.signal.addEventListener("abort",n);try{const i=new w5e(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const s of t)for(const o of i.write(s))await this._handleIncoming(o);this._source.end()}catch(i){this.log("error in sink",i),this._source.end(i)}finally{this.closeController.signal.removeEventListener("abort",n)}}}async _handleIncoming(e){const{id:t,type:n}=e;if(this.log.enabled&&this.log.trace("incoming message",OP(e)),e.type===lt.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??C5e)){this.log("too many inbound streams open"),this._source.push({id:t,type:lt.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(new Error("Too many open streams"));return}return}const a=this._newReceiverStream({id:t,name:ae(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(a);return}const s=((n&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(s==null){this.log("missing stream %s for message type %s",t,qx[n]);try{await this.rateLimiter.consume("missing-stream",1)}catch{this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(new Error("Too many messages for missing streams"));return}return}const o=this._init.maxStreamBufferSize??_5e;try{switch(n){case lt.MESSAGE_INITIATOR:case lt.MESSAGE_RECEIVER:if(s.sourceReadableLength()>o)throw this._source.push({id:e.id,type:n===lt.MESSAGE_INITIATOR?lt.RESET_RECEIVER:lt.RESET_INITIATOR}),new x5e("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers");s.sourcePush(e.data);break;case lt.CLOSE_INITIATOR:case lt.CLOSE_RECEIVER:s.remoteCloseWrite();break;case lt.RESET_INITIATOR:case lt.RESET_RECEIVER:s.reset();break;default:this.log("unknown message type %s",n)}}catch(a){this.log.error("error while processing message",a),s.abort(a)}}}var GN,QN;QN=Symbol.toStringTag,GN=lr;class $5e{constructor(e,t={}){u(this,"protocol","/mplex/6.7.0");u(this,"_init");u(this,"components");u(this,QN,"@libp2p/mplex");u(this,GN,["@libp2p/stream-multiplexing"]);this.components=e,this._init=t}createStreamMuxer(e={}){return new D5e(this.components,{...e,...this._init})}}function N5e(r={}){return e=>new $5e(e,r)}const C6=32,O5e="1.0.0",M5e="ping",R5e="ipfs",L5e=1e4,B5e=2,U5e=1;var YN,XN;XN=Symbol.toStringTag,YN=lr;class F5e{constructor(e,t={}){u(this,"protocol");u(this,"components");u(this,"started");u(this,"timeout");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"runOnLimitedConnection");u(this,"log");u(this,XN,"@libp2p/ping");u(this,YN,["@libp2p/ping"]);this.components=e,this.log=e.logger.forComponent("libp2p:ping"),this.started=!1,this.protocol=`/${t.protocolPrefix??R5e}/${M5e}/${O5e}`,this.timeout=t.timeout??L5e,this.maxInboundStreams=t.maxInboundStreams??B5e,this.maxOutboundStreams=t.maxOutboundStreams??U5e,this.runOnLimitedConnection=t.runOnLimitedConnection??!0,this.handleMessage=this.handleMessage.bind(this)}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){this.log("incoming ping from %p",e.connection.remotePeer);const{stream:t}=e,n=Date.now(),i=cm(t);let s=!1;Promise.resolve().then(async()=>{for(;;){const o=AbortSignal.timeout(this.timeout);o.addEventListener("abort",()=>{t==null||t.abort(new Vp("ping timeout"))});const a=await i.read({bytes:C6,signal:o});await i.write(a,{signal:o}),s=!0}}).catch(o=>{s&&o.name==="UnexpectedEOFError"&&t.readStatus!=="ready"||(this.log.error("incoming ping from %p failed with error - %e",e.connection.remotePeer,o),t==null||t.abort(o))}).finally(()=>{const o=Date.now()-n;this.log("incoming ping from %p complete in %dms",e.connection.remotePeer,o);const a=AbortSignal.timeout(this.timeout);t.close({signal:a}).catch(c=>{this.log.error("error closing ping stream from %p - %e",e.connection.remotePeer,c),t==null||t.abort(c)})})}async ping(e,t={}){this.log("pinging %p",e);const n=Date.now(),i=Ac(C6),s=await this.components.connectionManager.openConnection(e,t);let o;if(t.signal==null){const a=AbortSignal.timeout(this.timeout);t={...t,signal:a}}try{o=await s.newStream(this.protocol,{...t,runOnLimitedConnection:this.runOnLimitedConnection});const a=cm(o),[,c]=await Promise.all([a.write(i,t),a.read({...t,bytes:C6})]),l=Date.now()-n;if(!Xe(i,c.subarray()))throw new lB(`Received wrong ping ack after ${l}ms`);return this.log("ping %p complete in %dms",s.remotePeer,l),l}catch(a){throw this.log.error("error while pinging %p",s.remotePeer,a),o==null||o.abort(a),a}finally{o!=null&&await o.close(t)}}}function z5e(r={}){return e=>new F5e(e,r)}var Sn;(function(r){(function(n){n.FIN="FIN",n.STOP_SENDING="STOP_SENDING",n.RESET="RESET",n.FIN_ACK="FIN_ACK"})(r.Flag||(r.Flag={}));let e;(function(n){n[n.FIN=0]="FIN",n[n.STOP_SENDING=1]="STOP_SENDING",n[n.RESET=2]="RESET",n[n.FIN_ACK=3]="FIN_ACK"})(e||(e={})),function(n){n.codec=()=>Bn(e)}(r.Flag||(r.Flag={}));let t;r.codec=()=>(t==null&&(t=Be((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.flag!=null&&(i.uint32(8),r.Flag.codec().encode(n.flag,i)),n.message!=null&&(i.uint32(18),i.bytes(n.message)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.flag=r.Flag.codec().decode(n);break}case 2:{o.message=n.bytes();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>Le(n,r.codec()),r.decode=(n,i)=>Re(n,r.codec(),i)})(Sn||(Sn={}));const V5e=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],MP=Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),K5e="libp2p+webrtc+v1/",H5e=466,j5e=2*1024*1024,q5e=30*1e3,c4=16*1024;function W5e(r=c4){const e=At(r-At(r)),t=1+At(Object.keys(Sn.Flag).length-1),n=1,i=r-e-t-n,s=At(i);return e+t+n+s}const G5e=W5e(),Q5e=5e3,Y5e=5e3,X5e=3e4,AH="/webrtc",i7="/webrtc-signaling/0.0.1",J5e="/libp2p/webrtc-direct/certificate",Z5e="webrtc-direct-certificate-private-key",eve=12096e5,RP=864e5;var LP=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||Array.prototype.slice.call(e))},tve=function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r}(),rve=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}(),nve=function(){function r(e,t,n,i){this.name=e,this.version=t,this.os=n,this.bot=i,this.type="bot-device"}return r}(),ive=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),sve=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),ove=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,ave=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,BP=3,cve=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",ove]],UP=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function lve(r){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new sve:typeof navigator<"u"?dve(navigator.userAgent):fve()}function uve(r){return r!==""&&cve.reduce(function(e,t){var n=t[0],i=t[1];if(e)return e;var s=i.exec(r);return!!s&&[n,s]},!1)}function dve(r){var e=uve(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new ive;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<BP&&(i=LP(LP([],i,!0),pve(BP-i.length),!0)):i=[];var s=i.join("."),o=hve(r),a=ave.exec(r);return a&&a[1]?new nve(t,s,o,a[1]):new tve(t,s,o)}function hve(r){for(var e=0,t=UP.length;e<t;e++){var n=UP[e],i=n[0],s=n[1],o=s.exec(r);if(o)return i}return null}function fve(){var r=typeof process<"u"&&process.version;return r?new rve(process.version.slice(1)):null}function pve(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}const FP=lve(),Wx=FP!=null&&FP.name==="firefox",IH=async function*(){},CH=async r=>{};function gve(r,e,t=X5e,n){r.readyState==="open"&&Promise.resolve().then(async()=>{if(r.bufferedAmount>0){n.log("%s drain channel with %d buffered bytes",e,r.bufferedAmount);const i=Ve();let s=!1;r.bufferedAmountLowThreshold=0;const o=()=>{s||(n.log("%s drain channel closed before drain",e),i.resolve())};r.addEventListener("close",o,{once:!0}),r.addEventListener("bufferedamountlow",()=>{s=!0,r.removeEventListener("close",o),i.resolve()}),await Np(i.promise,{milliseconds:t})}}).then(async()=>{r.readyState==="open"&&r.close()}).catch(i=>{n.log.error("error closing outbound stream",i)})}async function zP(r){return r=r??{},typeof r=="function"&&(r=await r()),r.iceServers=r.iceServers??V5e.map(e=>({urls:[e]})),r}const yve=(r=32)=>K5e+[...Array(r)].map(()=>MP.at(Math.floor(Math.random()*MP.length))).join("");class s7{constructor(e,t){u(this,"log");u(this,"peerConnection");u(this,"remoteAddr");u(this,"timeline");u(this,"metrics");u(this,"source",IH());u(this,"sink",CH);this.log=e.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=t.remoteAddr,this.timeline=t.timeline,this.peerConnection=t.peerConnection;const n=this.peerConnection,i=n.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",n.connectionState,"initial state",i),(n.connectionState==="disconnected"||n.connectionState==="failed"||n.connectionState==="closed")&&(this.timeline.close=Date.now())}}async close(e){var t;this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),(t=this.metrics)==null||t.increment({close:!0})}abort(e){var t;this.log.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),(t=this.metrics)==null||t.increment({abort:!0})}}class mve extends Ix{constructor(t){const n=t.onEnd;t.onEnd=s=>{this.log.trace('readable and writeable ends closed with status "%s"',this.status),Promise.resolve(async()=>{if(!(this.timeline.abort!=null||this.timeline.reset!==null))try{await Np(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(o){this.log.error("error receiving FIN_ACK",o)}}).then(()=>{this.incomingData.end(),n==null||n(s)}).catch(o=>{this.log.error("error ending stream",o)}).finally(()=>{this.channel.close()})};super(t);u(this,"channel");u(this,"incomingData");u(this,"maxBufferedAmount");u(this,"bufferedAmountLowEventTimeout");u(this,"maxMessageSize");u(this,"receiveFinAck");u(this,"finAckTimeout");u(this,"openTimeout");u(this,"closeController");switch(this.channel=t.channel,this.channel.binaryType="arraybuffer",this.incomingData=zo(),this.bufferedAmountLowEventTimeout=t.bufferedAmountLowEventTimeout??q5e,this.maxBufferedAmount=t.maxBufferedAmount??j5e,this.maxMessageSize=(t.maxMessageSize??c4)-G5e,this.receiveFinAck=Ve(),this.finAckTimeout=t.closeTimeout??Q5e,this.openTimeout=t.openTimeout??Y5e,this.closeController=new AbortController,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(this.timeline.close===void 0||this.timeline.close===0)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new sy("Unknown datachannel state")}this.channel.onopen=s=>{this.timeline.open=new Date().getTime()},this.channel.onclose=s=>{this.log.trace("received onclose event"),this.closeController.abort(),this.receiveFinAck.resolve(),this.close().catch(o=>{this.log.error("error closing stream after channel closed",o)})},this.channel.onerror=s=>{this.log.trace("received onerror event"),this.closeController.abort();const o=s.error;this.abort(o)},this.channel.onmessage=async s=>{const{data:o}=s;o===null||o.byteLength===0||this.incomingData.push(new Uint8Array(o,0,o.byteLength))};const i=this;Promise.resolve().then(async()=>{for await(const s of Yd(this.incomingData)){const o=i.processIncomingProtobuf(s);o!=null&&i.sourcePush(new He(o))}}).catch(s=>{this.log.error("error processing incoming data channel messages",s)})}sendNewStream(){}async _sendMessage(t,n=!0){if(this.channel.readyState==="closed"||this.channel.readyState==="closing")throw new sy(`Invalid datachannel state - ${this.channel.readyState}`);if(this.channel.readyState!=="open"){const i=AbortSignal.timeout(this.openTimeout),s=bt([this.closeController.signal,i]);try{this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await Ti(this.channel,"open",s)}finally{s.clear()}this.log('channel state is now "%s", sending data',this.channel.readyState)}if(n&&this.channel.bufferedAmount>this.maxBufferedAmount){const i=AbortSignal.timeout(this.bufferedAmountLowEventTimeout),s=bt([this.closeController.signal,i]);try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await Ti(this.channel,"bufferedamountlow",s)}catch(o){throw i.aborted?new Vp(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`):o}finally{s.clear()}}try{this.log.trace('sending message, channel state "%s"',this.channel.readyState),this.channel.send(t.subarray())}catch(i){this.log.error("error while sending message",i)}}async sendData(t){const n=t.byteLength;for(t=t.sublist();t.byteLength>0;){const i=Math.min(t.byteLength,this.maxMessageSize),s=t.subarray(0,i),o=Sn.encode({message:s}),a=Qd.single(o);this.log.trace("sending %d/%d bytes on channel",s.byteLength,n),await this._sendMessage(a),t.consume(i)}this.log.trace('finished sending data, channel state "%s"',this.channel.readyState)}async sendReset(){try{await this._sendFlag(Sn.Flag.RESET)}catch(t){this.log.error("failed to send reset - %e",t)}finally{this.channel.close()}}async sendCloseWrite(t){if(this.channel.readyState!=="open"){this.receiveFinAck.resolve();return}if(await this._sendFlag(Sn.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await dn(this.receiveFinAck.promise,t==null?void 0:t.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorName:"FinAckNotReceivedError"})}catch(i){this.log.error("failed to await FIN_ACK",i)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){this.channel.readyState==="open"&&await this._sendFlag(Sn.Flag.STOP_SENDING)}processIncomingProtobuf(t){const n=Sn.decode(t);if(n.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',n.flag,this.writeStatus,this.readStatus),n.flag===Sn.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(Sn.Flag.FIN_ACK).catch(i=>{this.log.error("error sending FIN_ACK immediately",i)})),n.flag===Sn.Flag.RESET&&this.reset(),n.flag===Sn.Flag.STOP_SENDING&&this.remoteCloseRead(),n.flag===Sn.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),this.readStatus==="ready")return n.message}async _sendFlag(t){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',t.toString(),this.channel.readyState),!1;this.log.trace("sending flag %s",t.toString());const n=Sn.encode({flag:t}),i=Qd.single(n);try{return await this._sendMessage(i,!1),!0}catch(s){this.log.error("could not send flag %s - %e",t.toString(),s)}return!1}}function Tm(r){const{channel:e,direction:t,handshake:n}=r;return new mve({id:`${e.id}`,log:r.logger.forComponent(`libp2p:webrtc:stream:${n===!0?"handshake":t}:${e.id}`),...r})}class Gx{constructor(e,t){u(this,"protocol");u(this,"peerConnection");u(this,"bufferedStreams",[]);u(this,"metrics");u(this,"dataChannelOptions");u(this,"components");u(this,"log");this.components=e,this.peerConnection=t.peerConnection,this.metrics=t.metrics,this.protocol=t.protocol??AH,this.dataChannelOptions=t.dataChannelOptions??{},this.log=e.logger.forComponent("libp2p:webrtc:muxerfactory"),this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',n.id),n.label==="init"){this.log.trace("closing early init channel"),n.close();return}const i={},s=Tm({channel:n,direction:"inbound",onEnd:o=>{i.onEnd(o)},logger:e.logger,...this.dataChannelOptions});i.stream=s,i.channel=n,i.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(o=>o.stream.id!==s.id)},this.bufferedStreams.push(i)}}createStreamMuxer(e){return new wve(this.components,{...e,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}}var $d,f2;class wve{constructor(e,t){et(this,$d);u(this,"init");u(this,"streams");u(this,"protocol");u(this,"log");u(this,"peerConnection");u(this,"dataChannelOptions");u(this,"metrics");u(this,"logger");u(this,"source",IH());u(this,"sink",CH);this.init=t,this.log=e.logger.forComponent("libp2p:webrtc:muxer"),this.logger=e.logger,this.streams=t.streams.map(n=>n.stream),this.peerConnection=t.peerConnection,this.protocol=t.protocol??AH,this.metrics=t.metrics,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:n})=>{var o,a;if(this.log.trace("incoming datachannel with channel id %d",n.id),n.label==="init"){this.log.trace("closing init channel"),n.close();return}const i=n.id,s=Tm({channel:n,direction:"inbound",onEnd:()=>{De(this,$d,f2).call(this,s,n),this.log("incoming channel %s ended",i)},logger:this.logger,...this.dataChannelOptions});this.streams.push(s),(o=this.metrics)==null||o.increment({incoming_stream:!0}),(a=t==null?void 0:t.onIncomingStream)==null||a.call(t,s)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(n=>{var i,s,o;n.onEnd=()=>{this.log("incoming early channel %s ended with state %s",n.channel.id,n.channel.readyState),De(this,$d,f2).call(this,n.stream,n.channel)},(i=this.metrics)==null||i.increment({incoming_stream:!0}),(o=(s=this.init)==null?void 0:s.onIncomingStream)==null||o.call(s,n.stream)})})}async close(e){try{await Promise.all(this.streams.map(async t=>t.close(e)))}catch(t){this.abort(t)}}abort(e){for(const t of this.streams)t.abort(e)}newStream(){var i;const e=this.peerConnection.createDataChannel(""),t=e.id;this.log.trace("opened outgoing datachannel with channel id %s",t);const n=Tm({channel:e,direction:"outbound",onEnd:()=>{De(this,$d,f2).call(this,n,e),this.log("outgoing channel %s ended",t)},logger:this.logger,...this.dataChannelOptions});return this.streams.push(n),(i=this.metrics)==null||i.increment({outgoing_stream:!0}),n}}$d=new WeakSet,f2=function(e,t){var n,i,s;this.log.trace("stream %s %s %s onEnd",e.direction,e.id,e.protocol),gve(t,`${e.direction} ${e.id} ${e.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(o=>o.id!==e.id),(n=this.metrics)==null||n.increment({stream_end:!0}),(s=(i=this.init)==null?void 0:i.onStreamEnd)==null||s.call(i,e)};const kH=globalThis.RTCPeerConnection,_H=globalThis.RTCSessionDescription,vve=globalThis.RTCIceCandidate;class n0 extends Error{constructor(e){super(`WebRTC transport error: ${e}`),this.name="WebRTCTransportError"}}class Ja extends n0{constructor(e="SDP handshake failed"){super(e),this.name="SDPHandshakeFailedError"}}class bve extends n0{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`),this.name="WebRTC/InvalidFingerprintError"}}class Eve extends n0{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}}class Sve extends n0{constructor(e){super(`unsupported hash algorithm code: ${e} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}}var os;(function(r){(function(n){n.SDP_OFFER="SDP_OFFER",n.SDP_ANSWER="SDP_ANSWER",n.ICE_CANDIDATE="ICE_CANDIDATE"})(r.Type||(r.Type={}));let e;(function(n){n[n.SDP_OFFER=0]="SDP_OFFER",n[n.SDP_ANSWER=1]="SDP_ANSWER",n[n.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(e||(e={})),function(n){n.codec=()=>Bn(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=Be((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.data!=null&&(i.uint32(18),i.string(n.data)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.data=n.string();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>Le(n,r.codec()),r.decode=(n,i)=>Re(n,r.codec(),i)})(os||(os={}));const TH=async(r,e,t)=>{var n,i,s,o;try{const a=Ve();for(xve(r,a);;){const c=await Promise.race([a.promise,e.read({signal:t.signal}).catch(()=>{})]);if(c==null){(n=t.signal)==null||n.throwIfAborted();break}if(c.type!==os.Type.ICE_CANDIDATE)throw new Pt("ICE candidate message expected");const l=JSON.parse(c.data??"null");if(l===""||l===null){(i=t.onProgress)==null||i.call(t,new Ne("webrtc:end-of-ice-candidates")),t.log.trace("end-of-candidates received");continue}const d=new vve(l);t.log.trace("%s received new ICE candidate %o",t.direction,l);try{(s=t.onProgress)==null||s.call(t,new Ne("webrtc:add-ice-candidate",d.candidate)),await r.addIceCandidate(d)}catch(h){t.log.error("%s bad candidate received",t.direction,l,h)}}}catch(a){if(t.log.error("%s error parsing ICE candidate",t.direction,a),((o=t.signal)==null?void 0:o.aborted)===!0&&Qx(r)!=="connected")throw a}};function Qx(r){return Wx?r.iceConnectionState:r.connectionState}function xve(r,e){r[Wx?"oniceconnectionstatechange":"onconnectionstatechange"]=t=>{switch(Qx(r)){case"connected":e.resolve();break;case"failed":case"disconnected":case"closed":e.reject(new aS("RTCPeerConnection was closed"));break}}}async function Ave({rtcConfiguration:r,dataChannel:e,signal:t,metrics:n,multiaddr:i,connectionManager:s,transportManager:o,log:a,logger:c,onProgress:l}){const{baseAddr:d}=kve(i);n==null||n.dialerEvents.increment({open:!0}),a.trace("dialing base address: %a",d);const h=d.getPeerId();if(h==null)throw new ie("Relay peer was missing");const p=s.getConnections(Zt(h));let w,f=!1;p.length===0?(l==null||l(new Ne("webrtc:dial-relay")),w=await o.dial(d,{signal:t,onProgress:l}),f=!0):(l==null||l(new Ne("webrtc:reuse-relay-connection")),w=p[0]);try{l==null||l(new Ne("webrtc:open-signaling-stream"));const g=await w.newStream(i7,{signal:t,runOnLimitedConnection:!0}),v=si(g).pb(os),y=new kH(r),m=new Gx({logger:c},{peerConnection:y,dataChannelOptions:e});try{const b=y.createDataChannel("init");y.onicecandidate=({candidate:A})=>{const _=JSON.stringify((A==null?void 0:A.toJSON())??null);a.trace("initiator sending ICE candidate %o",A),v.write({type:os.Type.ICE_CANDIDATE,data:_},{signal:t}).catch($=>{a.error("error sending ICE candidate",$)})},y.onicecandidateerror=A=>{a.error("initiator ICE candidate error",A)};const S=await y.createOffer().catch(A=>{throw a.error("could not execute createOffer",A),new Ja("Failed to set createOffer")});a.trace("initiator send SDP offer %s",S.sdp),l==null||l(new Ne("webrtc:send-sdp-offer")),await v.write({type:os.Type.SDP_OFFER,data:S.sdp},{signal:t}),await y.setLocalDescription(S).catch(A=>{throw a.error("could not execute setLocalDescription",A),new Ja("Failed to set localDescription")}),l==null||l(new Ne("webrtc:read-sdp-answer")),a.trace("initiator read SDP answer");const I=await v.read({signal:t});if(I.type!==os.Type.SDP_ANSWER)throw new Ja("Remote should send an SDP answer");a.trace("initiator received SDP answer %s",I.data);const T=new _H({type:"answer",sdp:I.data});return await y.setRemoteDescription(T).catch(A=>{throw a.error("could not execute setRemoteDescription",A),new Ja("Failed to set remoteDescription")}),a.trace("initiator read candidates until connected"),l==null||l(new Ne("webrtc:read-ice-candidates")),await TH(y,v,{direction:"initiator",signal:t,log:a,onProgress:l}),a.trace("initiator connected, closing init channel"),b.close(),l==null||l(new Ne("webrtc:close-signaling-stream")),a.trace("closing signaling channel"),await g.close({signal:t}),a.trace("initiator connected to remote address %s",i),{remoteAddress:i,peerConnection:y,muxerFactory:m}}catch(b){throw a.error("outgoing signaling error",b),y.close(),g.abort(b),b}finally{y.onicecandidate=null,y.onicecandidateerror=null}}finally{if(f)try{await w.close({signal:t})}catch(g){w.abort(g)}}}const VP=Nt(gz.matchers[0],rt("p2p-circuit"));class Yx extends tr{constructor(t,n){super();u(this,"transportManager");u(this,"shutdownController");u(this,"events");this.transportManager=t.transportManager,this.events=t.events,this.shutdownController=n.shutdownController,this.onTransportListening=this.onTransportListening.bind(this)}async listen(){this.events.addEventListener("transport:listening",this.onTransportListening)}onTransportListening(t){t.detail.getAddrs().filter(i=>VP.exactMatch(i)).map(i=>i.encapsulate("/webrtc")).length>0&&this.safeDispatchEvent("listening")}getAddrs(){return this.transportManager.getListeners().filter(t=>!(t instanceof Yx)).map(t=>t.getAddrs().filter(n=>VP.exactMatch(n)).map(n=>n.encapsulate("/webrtc"))).flat()}updateAnnounceAddrs(){}async close(){this.events.removeEventListener("transport:listening",this.onTransportListening),this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})}}async function Ive({peerConnection:r,stream:e,signal:t,connection:n,log:i}){i.trace("new inbound signaling stream");const s=si(e).pb(os);try{r.onicecandidate=({candidate:d})=>{const h=JSON.stringify((d==null?void 0:d.toJSON())??null);i.trace("recipient sending ICE candidate %s",h),s.write({type:os.Type.ICE_CANDIDATE,data:h},{signal:t}).catch(p=>{i.error("error sending ICE candidate",p)})},i.trace("recipient read SDP offer");const a=await s.read({signal:t});if(a.type!==os.Type.SDP_OFFER)throw new Ja(`expected message type SDP_OFFER, received: ${a.type??"undefined"} `);i.trace("recipient received SDP offer %s",a.data);const c=new _H({type:"offer",sdp:a.data});await r.setRemoteDescription(c).catch(d=>{throw i.error("could not execute setRemoteDescription",d),new Ja("Failed to set remoteDescription")});const l=await r.createAnswer().catch(d=>{throw i.error("could not execute createAnswer",d),new Ja("Failed to create answer")});i.trace("recipient send SDP answer %s",l.sdp),await s.write({type:os.Type.SDP_ANSWER,data:l.sdp},{signal:t}),await r.setLocalDescription(l).catch(d=>{throw i.error("could not execute setLocalDescription",d),new Ja("Failed to set localDescription")}),i.trace("recipient read candidates until connected"),await TH(r,s,{direction:"recipient",signal:t,log:i})}catch(a){if(Qx(r)!=="connected")throw i.error("error while handling signaling stream from peer %a",n.remoteAddr,a),r.close(),a;i("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",n.remoteAddr,a)}const o=Fe(`/webrtc/p2p/${n.remoteAddr.getPeerId()}`);return i.trace("recipient connected to remote address %s",o),{remoteAddress:o}}var JN,ZN,eO,tO;tO=Z3,eO=Symbol.toStringTag,ZN=lr,JN=Sc;class Cve{constructor(e,t={}){u(this,"components");u(this,"init");u(this,"log");u(this,"_started",!1);u(this,"metrics");u(this,"shutdownController");u(this,tO,!0);u(this,eO,"@libp2p/webrtc");u(this,ZN,["@libp2p/transport"]);u(this,JN,["@libp2p/identify","@libp2p/circuit-relay-v2-transport"]);this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}isStarted(){return this._started}async start(){await this.components.registrar.handle(i7,e=>{const t=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);this._onProtocol(e,t).catch(n=>{this.log.error("failed to handle incoming connect from %p",e.connection.remotePeer,n)}).finally(()=>{t.clear()})},{runOnLimitedConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(i7),this._started=!1}createListener(e){return new Yx(this.components,{shutdownController:this.shutdownController})}listenFilter(e){return e.filter(ob.exactMatch)}dialFilter(e){return this.listenFilter(e)}async dial(e,t){var c;this.log.trace("dialing address: %a",e);const{remoteAddress:n,peerConnection:i,muxerFactory:s}=await Ave({rtcConfiguration:await zP(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:t.onProgress}),o=new s7(this.components,{peerConnection:i,timeline:{open:Date.now()},remoteAddr:n,metrics:(c=this.metrics)==null?void 0:c.dialerEvents}),a=await t.upgrader.upgradeOutbound(o,{skipProtection:!0,skipEncryption:!0,muxerFactory:s,onProgress:t.onProgress,signal:t.signal});return this._closeOnShutdown(i,o),a}async _onProtocol({connection:e,stream:t},n){var o;const i=new kH(await zP(this.init.rtcConfiguration)),s=new Gx(this.components,{peerConnection:i,dataChannelOptions:this.init.dataChannel});try{const{remoteAddress:a}=await Ive({peerConnection:i,connection:e,stream:t,signal:n,log:this.log});await t.close({signal:n});const c=new s7(this.components,{peerConnection:i,timeline:{open:new Date().getTime()},remoteAddr:a,metrics:(o=this.metrics)==null?void 0:o.listenerEvents});await this.components.upgrader.upgradeInbound(c,{skipEncryption:!0,skipProtection:!0,muxerFactory:s,signal:n}),this._closeOnShutdown(i,c)}catch(a){throw this.log.error("incoming signaling error",a),i.close(),t.abort(a),a}}_closeOnShutdown(e,t){const n=()=>{t.close().catch(i=>{this.log.error("could not close WebRTCMultiaddrConnection",i)})};this.shutdownController.signal.addEventListener("abort",n),e.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",n)})}}function kve(r){const e=r.toString().split("/webrtc/");if(e.length!==2)throw new ie("webrtc protocol was not present in multiaddr");if(!e[0].includes("/p2p-circuit"))throw new ie("p2p-circuit protocol was not present in multiaddr");let t=Fe(e[0]);const i=Fe("/"+e[1]).getPeerId();if(i==null)throw new ie("destination peer id was missing");const s=t.protos().pop();if(s===void 0)throw new ie("invalid multiaddr");return s.name!=="p2p"&&(t=t.encapsulate(`/p2p/${i}`)),{baseAddr:t,peerId:Zt(i)}}/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var KP;(function(r){(function(e){var t=typeof globalThis=="object"?globalThis:typeof E1=="object"?E1:typeof self=="object"?self:typeof this=="object"?this:a(),n=i(r);typeof t.Reflect<"u"&&(n=i(t.Reflect,n)),e(n,t),typeof t.Reflect>"u"&&(t.Reflect=r);function i(c,l){return function(d,h){Object.defineProperty(c,d,{configurable:!0,writable:!0,value:h}),l&&l(d,h)}}function s(){try{return Function("return this;")()}catch{}}function o(){try{return(0,eval)("(function() { return this; })()")}catch{}}function a(){return s()||o()}})(function(e,t){var n=Object.prototype.hasOwnProperty,i=typeof Symbol=="function",s=i&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=i&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",c={__proto__:[]}instanceof Array,l=!a&&!c,d={create:a?function(){return L(Object.create(null))}:c?function(){return L({__proto__:null})}:function(){return L({})},has:l?function(N,R){return n.call(N,R)}:function(N,R){return R in N},get:l?function(N,R){return n.call(N,R)?N[R]:void 0}:function(N,R){return N[R]}},h=Object.getPrototypeOf(Function),p=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:O(),w=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:x(),f=typeof WeakMap=="function"?WeakMap:k(),g=i?Symbol.for("@reflect-metadata:registry"):void 0,v=ro(),y=Xh(v);function m(N,R,F,re){if(Y(F)){if(!pt(N))throw new TypeError;if(!P(R))throw new TypeError;return K(N,R)}else{if(!pt(N))throw new TypeError;if(!ue(R))throw new TypeError;if(!ue(re)&&!Y(re)&&!ce(re))throw new TypeError;return ce(re)&&(re=void 0),F=Qe(F),Z(N,R,F,re)}}e("decorate",m);function b(N,R){function F(re,we){if(!ue(re))throw new TypeError;if(!Y(we)&&!E(we))throw new TypeError;B(N,R,re,we)}return F}e("metadata",b);function S(N,R,F,re){if(!ue(F))throw new TypeError;return Y(re)||(re=Qe(re)),B(N,R,F,re)}e("defineMetadata",S);function I(N,R,F){if(!ue(R))throw new TypeError;return Y(F)||(F=Qe(F)),G(N,R,F)}e("hasMetadata",I);function T(N,R,F){if(!ue(R))throw new TypeError;return Y(F)||(F=Qe(F)),Q(N,R,F)}e("hasOwnMetadata",T);function A(N,R,F){if(!ue(R))throw new TypeError;return Y(F)||(F=Qe(F)),J(N,R,F)}e("getMetadata",A);function _(N,R,F){if(!ue(R))throw new TypeError;return Y(F)||(F=Qe(F)),q(N,R,F)}e("getOwnMetadata",_);function $(N,R){if(!ue(N))throw new TypeError;return Y(R)||(R=Qe(R)),V(N,R)}e("getMetadataKeys",$);function z(N,R){if(!ue(N))throw new TypeError;return Y(R)||(R=Qe(R)),W(N,R)}e("getOwnMetadataKeys",z);function j(N,R,F){if(!ue(R))throw new TypeError;if(Y(F)||(F=Qe(F)),!ue(R))throw new TypeError;Y(F)||(F=Qe(F));var re=qc(R,F,!1);return Y(re)?!1:re.OrdinaryDeleteMetadata(N,R,F)}e("deleteMetadata",j);function K(N,R){for(var F=N.length-1;F>=0;--F){var re=N[F],we=re(R);if(!Y(we)&&!ce(we)){if(!P(we))throw new TypeError;R=we}}return R}function Z(N,R,F,re){for(var we=N.length-1;we>=0;--we){var Ue=N[we],je=Ue(R,F,re);if(!Y(je)&&!ce(je)){if(!ue(je))throw new TypeError;re=je}}return re}function G(N,R,F){var re=Q(N,R,F);if(re)return!0;var we=ft(R);return ce(we)?!1:G(N,we,F)}function Q(N,R,F){var re=qc(R,F,!1);return Y(re)?!1:_e(re.OrdinaryHasOwnMetadata(N,R,F))}function J(N,R,F){var re=Q(N,R,F);if(re)return q(N,R,F);var we=ft(R);if(!ce(we))return J(N,we,F)}function q(N,R,F){var re=qc(R,F,!1);if(!Y(re))return re.OrdinaryGetOwnMetadata(N,R,F)}function B(N,R,F,re){var we=qc(F,re,!0);we.OrdinaryDefineOwnMetadata(N,R,F,re)}function V(N,R){var F=W(N,R),re=ft(N);if(re===null)return F;var we=V(re,R);if(we.length<=0)return F;if(F.length<=0)return we;for(var Ue=new w,je=[],Ie=0,ve=F;Ie<ve.length;Ie++){var xe=ve[Ie],ke=Ue.has(xe);ke||(Ue.add(xe),je.push(xe))}for(var Pe=0,Ze=we;Pe<Ze.length;Pe++){var xe=Ze[Pe],ke=Ue.has(xe);ke||(Ue.add(xe),je.push(xe))}return je}function W(N,R){var F=qc(N,R,!1);return F?F.OrdinaryOwnMetadataKeys(N,R):[]}function ee(N){if(N===null)return 1;switch(typeof N){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return N===null?1:6;default:return 6}}function Y(N){return N===void 0}function ce(N){return N===null}function pe(N){return typeof N=="symbol"}function ue(N){return typeof N=="object"?N!==null:typeof N=="function"}function le(N,R){switch(ee(N)){case 0:return N;case 1:return N;case 2:return N;case 3:return N;case 4:return N;case 5:return N}var F="string",re=U(N,s);if(re!==void 0){var we=re.call(N,F);if(ue(we))throw new TypeError;return we}return Me(N)}function Me(N,R){var F,re,we;{var Ue=N.toString;if(wt(Ue)){var re=Ue.call(N);if(!ue(re))return re}var F=N.valueOf;if(wt(F)){var re=F.call(N);if(!ue(re))return re}}throw new TypeError}function _e(N){return!!N}function ze(N){return""+N}function Qe(N){var R=le(N);return pe(R)?R:ze(R)}function pt(N){return Array.isArray?Array.isArray(N):N instanceof Object?N instanceof Array:Object.prototype.toString.call(N)==="[object Array]"}function wt(N){return typeof N=="function"}function P(N){return typeof N=="function"}function E(N){switch(ee(N)){case 3:return!0;case 4:return!0;default:return!1}}function C(N,R){return N===R||N!==N&&R!==R}function U(N,R){var F=N[R];if(F!=null){if(!wt(F))throw new TypeError;return F}}function te(N){var R=U(N,o);if(!wt(R))throw new TypeError;var F=R.call(N);if(!ue(F))throw new TypeError;return F}function Te(N){return N.value}function ot(N){var R=N.next();return R.done?!1:R}function at(N){var R=N.return;R&&R.call(N)}function ft(N){var R=Object.getPrototypeOf(N);if(typeof N!="function"||N===h||R!==h)return R;var F=N.prototype,re=F&&Object.getPrototypeOf(F);if(re==null||re===Object.prototype)return R;var we=re.constructor;return typeof we!="function"||we===N?R:we}function vt(){var N;!Y(g)&&typeof t.Reflect<"u"&&!(g in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&(N=bs(t.Reflect));var R,F,re,we=new f,Ue={registerProvider:je,getProvider:ve,setProvider:ke};return Ue;function je(Pe){if(!Object.isExtensible(Ue))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case N===Pe:break;case Y(R):R=Pe;break;case R===Pe:break;case Y(F):F=Pe;break;case F===Pe:break;default:re===void 0&&(re=new w),re.add(Pe);break}}function Ie(Pe,Ze){if(!Y(R)){if(R.isProviderFor(Pe,Ze))return R;if(!Y(F)){if(F.isProviderFor(Pe,Ze))return R;if(!Y(re))for(var Ot=te(re);;){var Xt=ot(Ot);if(!Xt)return;var Hi=Te(Xt);if(Hi.isProviderFor(Pe,Ze))return at(Ot),Hi}}}if(!Y(N)&&N.isProviderFor(Pe,Ze))return N}function ve(Pe,Ze){var Ot=we.get(Pe),Xt;return Y(Ot)||(Xt=Ot.get(Ze)),Y(Xt)&&(Xt=Ie(Pe,Ze),Y(Xt)||(Y(Ot)&&(Ot=new p,we.set(Pe,Ot)),Ot.set(Ze,Xt))),Xt}function xe(Pe){if(Y(Pe))throw new TypeError;return R===Pe||F===Pe||!Y(re)&&re.has(Pe)}function ke(Pe,Ze,Ot){if(!xe(Ot))throw new Error("Metadata provider not registered.");var Xt=ve(Pe,Ze);if(Xt!==Ot){if(!Y(Xt))return!1;var Hi=we.get(Pe);Y(Hi)&&(Hi=new p,we.set(Pe,Hi)),Hi.set(Ze,Ot)}return!0}}function ro(){var N;return!Y(g)&&ue(t.Reflect)&&Object.isExtensible(t.Reflect)&&(N=t.Reflect[g]),Y(N)&&(N=vt()),!Y(g)&&ue(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,g,{enumerable:!1,configurable:!1,writable:!1,value:N}),N}function Xh(N){var R=new f,F={isProviderFor:function(xe,ke){var Pe=R.get(xe);return Y(Pe)?!1:Pe.has(ke)},OrdinaryDefineOwnMetadata:je,OrdinaryHasOwnMetadata:we,OrdinaryGetOwnMetadata:Ue,OrdinaryOwnMetadataKeys:Ie,OrdinaryDeleteMetadata:ve};return v.registerProvider(F),F;function re(xe,ke,Pe){var Ze=R.get(xe),Ot=!1;if(Y(Ze)){if(!Pe)return;Ze=new p,R.set(xe,Ze),Ot=!0}var Xt=Ze.get(ke);if(Y(Xt)){if(!Pe)return;if(Xt=new p,Ze.set(ke,Xt),!N.setProvider(xe,ke,F))throw Ze.delete(ke),Ot&&R.delete(xe),new Error("Wrong provider for target.")}return Xt}function we(xe,ke,Pe){var Ze=re(ke,Pe,!1);return Y(Ze)?!1:_e(Ze.has(xe))}function Ue(xe,ke,Pe){var Ze=re(ke,Pe,!1);if(!Y(Ze))return Ze.get(xe)}function je(xe,ke,Pe,Ze){var Ot=re(Pe,Ze,!0);Ot.set(xe,ke)}function Ie(xe,ke){var Pe=[],Ze=re(xe,ke,!1);if(Y(Ze))return Pe;for(var Ot=Ze.keys(),Xt=te(Ot),Hi=0;;){var zA=ot(Xt);if(!zA)return Pe.length=Hi,Pe;var dq=Te(zA);try{Pe[Hi]=dq}catch(hq){try{at(Xt)}finally{throw hq}}Hi++}}function ve(xe,ke,Pe){var Ze=re(ke,Pe,!1);if(Y(Ze)||!Ze.delete(xe))return!1;if(Ze.size===0){var Ot=R.get(ke);Y(Ot)||(Ot.delete(Pe),Ot.size===0&&R.delete(Ot))}return!0}}function bs(N){var R=N.defineMetadata,F=N.hasOwnMetadata,re=N.getOwnMetadata,we=N.getOwnMetadataKeys,Ue=N.deleteMetadata,je=new f,Ie={isProviderFor:function(ve,xe){var ke=je.get(ve);return!Y(ke)&&ke.has(xe)?!0:we(ve,xe).length?(Y(ke)&&(ke=new w,je.set(ve,ke)),ke.add(xe),!0):!1},OrdinaryDefineOwnMetadata:R,OrdinaryHasOwnMetadata:F,OrdinaryGetOwnMetadata:re,OrdinaryOwnMetadataKeys:we,OrdinaryDeleteMetadata:Ue};return Ie}function qc(N,R,F){var re=v.getProvider(N,R);if(!Y(re))return re;if(F){if(v.setProvider(N,R,y))return y;throw new Error("Illegal state.")}}function O(){var N={},R=[],F=function(){function Ie(ve,xe,ke){this._index=0,this._keys=ve,this._values=xe,this._selector=ke}return Ie.prototype["@@iterator"]=function(){return this},Ie.prototype[o]=function(){return this},Ie.prototype.next=function(){var ve=this._index;if(ve>=0&&ve<this._keys.length){var xe=this._selector(this._keys[ve],this._values[ve]);return ve+1>=this._keys.length?(this._index=-1,this._keys=R,this._values=R):this._index++,{value:xe,done:!1}}return{value:void 0,done:!0}},Ie.prototype.throw=function(ve){throw this._index>=0&&(this._index=-1,this._keys=R,this._values=R),ve},Ie.prototype.return=function(ve){return this._index>=0&&(this._index=-1,this._keys=R,this._values=R),{value:ve,done:!0}},Ie}(),re=function(){function Ie(){this._keys=[],this._values=[],this._cacheKey=N,this._cacheIndex=-2}return Object.defineProperty(Ie.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Ie.prototype.has=function(ve){return this._find(ve,!1)>=0},Ie.prototype.get=function(ve){var xe=this._find(ve,!1);return xe>=0?this._values[xe]:void 0},Ie.prototype.set=function(ve,xe){var ke=this._find(ve,!0);return this._values[ke]=xe,this},Ie.prototype.delete=function(ve){var xe=this._find(ve,!1);if(xe>=0){for(var ke=this._keys.length,Pe=xe+1;Pe<ke;Pe++)this._keys[Pe-1]=this._keys[Pe],this._values[Pe-1]=this._values[Pe];return this._keys.length--,this._values.length--,C(ve,this._cacheKey)&&(this._cacheKey=N,this._cacheIndex=-2),!0}return!1},Ie.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=N,this._cacheIndex=-2},Ie.prototype.keys=function(){return new F(this._keys,this._values,we)},Ie.prototype.values=function(){return new F(this._keys,this._values,Ue)},Ie.prototype.entries=function(){return new F(this._keys,this._values,je)},Ie.prototype["@@iterator"]=function(){return this.entries()},Ie.prototype[o]=function(){return this.entries()},Ie.prototype._find=function(ve,xe){if(!C(this._cacheKey,ve)){this._cacheIndex=-1;for(var ke=0;ke<this._keys.length;ke++)if(C(this._keys[ke],ve)){this._cacheIndex=ke;break}}return this._cacheIndex<0&&xe&&(this._cacheIndex=this._keys.length,this._keys.push(ve),this._values.push(void 0)),this._cacheIndex},Ie}();return re;function we(Ie,ve){return Ie}function Ue(Ie,ve){return ve}function je(Ie,ve){return[Ie,ve]}}function x(){var N=function(){function R(){this._map=new p}return Object.defineProperty(R.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),R.prototype.has=function(F){return this._map.has(F)},R.prototype.add=function(F){return this._map.set(F,F),this},R.prototype.delete=function(F){return this._map.delete(F)},R.prototype.clear=function(){this._map.clear()},R.prototype.keys=function(){return this._map.keys()},R.prototype.values=function(){return this._map.keys()},R.prototype.entries=function(){return this._map.entries()},R.prototype["@@iterator"]=function(){return this.keys()},R.prototype[o]=function(){return this.keys()},R}();return N}function k(){var N=16,R=d.create(),F=re();return function(){function ve(){this._key=re()}return ve.prototype.has=function(xe){var ke=we(xe,!1);return ke!==void 0?d.has(ke,this._key):!1},ve.prototype.get=function(xe){var ke=we(xe,!1);return ke!==void 0?d.get(ke,this._key):void 0},ve.prototype.set=function(xe,ke){var Pe=we(xe,!0);return Pe[this._key]=ke,this},ve.prototype.delete=function(xe){var ke=we(xe,!1);return ke!==void 0?delete ke[this._key]:!1},ve.prototype.clear=function(){this._key=re()},ve}();function re(){var ve;do ve="@@WeakMap@@"+Ie();while(d.has(R,ve));return R[ve]=!0,ve}function we(ve,xe){if(!n.call(ve,F)){if(!xe)return;Object.defineProperty(ve,F,{value:d.create()})}return ve[F]}function Ue(ve,xe){for(var ke=0;ke<xe;++ke)ve[ke]=Math.random()*255|0;return ve}function je(ve){if(typeof Uint8Array=="function"){var xe=new Uint8Array(ve);return typeof crypto<"u"?crypto.getRandomValues(xe):typeof msCrypto<"u"?msCrypto.getRandomValues(xe):Ue(xe,ve),xe}return Ue(new Array(ve),ve)}function Ie(){var ve=je(N);ve[6]=ve[6]&79|64,ve[8]=ve[8]&191|128;for(var xe="",ke=0;ke<N;++ke){var Pe=ve[ke];(ke===4||ke===6||ke===8)&&(xe+="-"),Pe<16&&(xe+="0"),xe+=Pe.toString(16).toLowerCase()}return xe}}function L(N){return N.__=void 0,delete N.__,N}})})(KP||(KP={}));var ne;(function(r){r[r.Sequence=0]="Sequence",r[r.Set=1]="Set",r[r.Choice=2]="Choice"})(ne||(ne={}));var H;(function(r){r[r.Any=1]="Any",r[r.Boolean=2]="Boolean",r[r.OctetString=3]="OctetString",r[r.BitString=4]="BitString",r[r.Integer=5]="Integer",r[r.Enumerated=6]="Enumerated",r[r.ObjectIdentifier=7]="ObjectIdentifier",r[r.Utf8String=8]="Utf8String",r[r.BmpString=9]="BmpString",r[r.UniversalString=10]="UniversalString",r[r.NumericString=11]="NumericString",r[r.PrintableString=12]="PrintableString",r[r.TeletexString=13]="TeletexString",r[r.VideotexString=14]="VideotexString",r[r.IA5String=15]="IA5String",r[r.GraphicString=16]="GraphicString",r[r.VisibleString=17]="VisibleString",r[r.GeneralString=18]="GeneralString",r[r.CharacterString=19]="CharacterString",r[r.UTCTime=20]="UTCTime",r[r.GeneralizedTime=21]="GeneralizedTime",r[r.DATE=22]="DATE",r[r.TimeOfDay=23]="TimeOfDay",r[r.DateTime=24]="DateTime",r[r.Duration=25]="Duration",r[r.TIME=26]="TIME",r[r.Null=27]="Null"})(H||(H={}));class l4{constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if(typeof e=="number")this.fromNumber(e);else if(me.isBufferSource(e))this.unusedBits=t,this.value=me.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof Ll))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new Ll({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new Ll({name:e})}toNumber(){let e="";const t=new Uint8Array(this.value);for(const n of t)e+=n.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2);const n=t.length+7>>3;this.unusedBits=(n<<3)-t.length;const i=new Uint8Array(n);t=t.padStart(n<<3,"0").split("").reverse().join("");let s=0;for(;s<n;)i[s]=parseInt(t.slice(s<<3,(s<<3)+8),2),s++;this.value=i.buffer}}class it{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){typeof e=="number"?this.buffer=new ArrayBuffer(e):me.isBufferSource(e)?this.buffer=me.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof ss))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new ss({valueHex:this.buffer})}toSchema(e){return new ss({name:e})}}const _ve={fromASN:r=>r instanceof Ho?null:r.valueBeforeDecodeView,toASN:r=>{if(r===null)return new Ho;const e=No(r);if(e.result.error)throw new Error(e.result.error);return e.result}},Tve={fromASN:r=>r.valueBlock.valueHexView.byteLength>=4?r.valueBlock.toString():r.valueBlock.valueDec,toASN:r=>new Oo({value:+r})},Pve={fromASN:r=>r.valueBlock.valueDec,toASN:r=>new Qw({value:r})},Lt={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Oo({valueHex:r})},Dve={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Ll({valueHex:r})},$ve={fromASN:r=>r.valueBlock.toString(),toASN:r=>new Co({value:r})},Nve={fromASN:r=>r.valueBlock.value,toASN:r=>new Gw({value:r})},Pm={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new ss({valueHex:r})},Ove={fromASN:r=>new it(r.getValue()),toASN:r=>r.toASN()};function zi(r){return{fromASN:e=>e.valueBlock.value,toASN:e=>new r({value:e})}}const PH=zi(ca),Mve=zi(Yw),Rve=zi(Xw),Lve=zi(Jw),Bve=zi(Zw),Uve=zi(e4),Fve=zi(t4),zve=zi(r4),Vve=zi(n4),Kve=zi(t0),Hve=zi(i4),jve=zi(s4),qve={fromASN:r=>r.toDate(),toASN:r=>new r0({valueDate:r})},Wve={fromASN:r=>r.toDate(),toASN:r=>new o4({valueDate:r})},Gve={fromASN:()=>null,toASN:()=>new Ho};function Xx(r){switch(r){case H.Any:return _ve;case H.BitString:return Dve;case H.BmpString:return Mve;case H.Boolean:return Nve;case H.CharacterString:return jve;case H.Enumerated:return Pve;case H.GeneralString:return Hve;case H.GeneralizedTime:return Wve;case H.GraphicString:return Vve;case H.IA5String:return zve;case H.Integer:return Tve;case H.Null:return Gve;case H.NumericString:return Lve;case H.ObjectIdentifier:return $ve;case H.OctetString:return Pm;case H.PrintableString:return Bve;case H.TeletexString:return Uve;case H.UTCTime:return qve;case H.UniversalString:return Rve;case H.Utf8String:return PH;case H.VideotexString:return Fve;case H.VisibleString:return Kve;default:return null}}function To(r){return typeof r=="function"&&r.prototype?r.prototype.toASN&&r.prototype.fromASN?!0:To(r.prototype):!!(r&&typeof r=="object"&&"toASN"in r&&"fromASN"in r)}function DH(r){var e;if(r){const t=Object.getPrototypeOf(r);return((e=t==null?void 0:t.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:DH(t)}return!1}function Qve(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<r.byteLength;i++)if(t[i]!==n[i])return!1;return!0}class Yve{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){const n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!n.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return n}cache(e){const t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){const t={type:ne.Sequence,items:{}},n=this.findParentSchema(e);return n&&(Object.assign(t,n),t.items=Object.assign({},t.items,n.items)),t}create(e,t){const n=this.items.get(e)||this.createDefault(e),i=[];for(const s in n.items){const o=n.items[s],a=t?s:"";let c;if(typeof o.type=="number"){const d=H[o.type],h=vH[d];if(!h)throw new Error(`Cannot get ASN1 class by name '${d}'`);c=new h({name:a})}else To(o.type)?c=new o.type().toSchema(a):o.optional?this.get(o.type).type===ne.Choice?c=new ru({name:a}):(c=this.create(o.type,!1),c.name=a):c=new ru({name:a});const l=!!o.optional||o.defaultValue!==void 0;if(o.repeated){c.name="";const d=o.repeated==="set"?Mo:gr;c=new d({name:"",value:[new _m({name:a,value:c})]})}if(o.context!==null&&o.context!==void 0)if(o.implicit)if(typeof o.type=="number"||To(o.type)){const d=o.repeated?Mn:e0;i.push(new d({name:a,optional:l,idBlock:{tagClass:3,tagNumber:o.context}}))}else{this.cache(o.type);const d=!!o.repeated;let h=d?c:this.get(o.type,!0).schema;h="valueBlock"in h?h.valueBlock.value:h.value,i.push(new Mn({name:d?"":a,optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:h}))}else i.push(new Mn({optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:[c]}));else c.optional=l,i.push(c)}switch(n.type){case ne.Sequence:return new gr({value:i,name:""});case ne.Set:return new Mo({value:i,name:""});case ne.Choice:return new jx({value:i,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){const t=Object.getPrototypeOf(e);return t?this.items.get(t)||this.findParentSchema(t):null}}const Pi=new Yve,oe=r=>e=>{let t;Pi.has(e)?t=Pi.get(e):(t=Pi.createDefault(e),Pi.set(e,t)),Object.assign(t,r)},M=r=>(e,t)=>{let n;Pi.has(e.constructor)?n=Pi.get(e.constructor):(n=Pi.createDefault(e.constructor),Pi.set(e.constructor,n));const i=Object.assign({},r);if(typeof i.type=="number"&&!i.converter){const s=Xx(r.type);if(!s)throw new Error(`Cannot get default converter for property '${t}' of ${e.constructor.name}`);i.converter=s}n.items[t]=i};class HP extends Error{constructor(){super(...arguments),this.schemas=[]}}class Xve{static parse(e,t){const n=No(e);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,t)}static fromASN(e,t){var n;try{if(To(t))return new t().fromASN(e);const i=Pi.get(t);Pi.cache(t);let s=i.schema;if(e.constructor===Mn&&i.type!==ne.Choice){s=new Mn({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:i.schema.valueBlock.value});for(const c in i.items)delete e[c]}const o=bl({},e,s);if(!o.verified)throw new HP(`Data does not match to ${t.name} ASN1 schema. ${o.result.error}`);const a=new t;if(DH(t)){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const c=i.itemType;if(typeof c=="number"){const l=Xx(c);if(!l)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);return t.from(e.valueBlock.value,d=>l.fromASN(d))}else return t.from(e.valueBlock.value,l=>this.fromASN(l,c))}for(const c in i.items){const l=o.result[c];if(!l)continue;const d=i.items[c],h=d.type;if(typeof h=="number"||To(h)){const p=(n=d.converter)!==null&&n!==void 0?n:To(h)?new h:null;if(!p)throw new Error("Converter is empty");if(d.repeated)if(d.implicit){const w=d.repeated==="sequence"?gr:Mo,f=new w;f.valueBlock=l.valueBlock;const g=No(f.toBER(!1));if(g.offset===-1)throw new Error(`Cannot parse the child item. ${g.result.error}`);if(!("value"in g.result.valueBlock&&Array.isArray(g.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const v=g.result.valueBlock.value;a[c]=Array.from(v,y=>p.fromASN(y))}else a[c]=Array.from(l,w=>p.fromASN(w));else{let w=l;if(d.implicit){let f;if(To(h))f=new h().toSchema("");else{const g=H[h],v=vH[g];if(!v)throw new Error(`Cannot get '${g}' class from asn1js module`);f=new v}f.valueBlock=w.valueBlock,w=No(f.toBER(!1)).result}a[c]=p.fromASN(w)}}else if(d.repeated){if(!Array.isArray(l))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");a[c]=Array.from(l,p=>this.fromASN(p,h))}else a[c]=this.fromASN(l,h)}return a}catch(i){throw i instanceof HP&&i.schemas.push(t.name),i}}}class Jx{static serialize(e){return e instanceof Tr?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&typeof e=="object"&&To(e))return e.toASN();if(!(e&&typeof e=="object"))throw new TypeError("Parameter 1 should be type of Object.");const t=e.constructor,n=Pi.get(t);Pi.cache(t);let i=[];if(n.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if(typeof n.itemType=="number"){const o=Xx(n.itemType);if(!o)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);i=e.map(a=>o.toASN(a))}else i=e.map(o=>this.toAsnItem({type:n.itemType},"[]",t,o))}else for(const o in n.items){const a=n.items[o],c=e[o];if(c===void 0||a.defaultValue===c||typeof a.defaultValue=="object"&&typeof c=="object"&&Qve(this.serialize(a.defaultValue),this.serialize(c)))continue;const l=Jx.toAsnItem(a,o,t,c);if(typeof a.context=="number")if(a.implicit)if(!a.repeated&&(typeof a.type=="number"||To(a.type))){const d={};d.valueHex=l instanceof Ho?l.valueBeforeDecodeView:l.valueBlock.toBER(),i.push(new e0({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},...d}))}else i.push(new Mn({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:l.valueBlock.value}));else i.push(new Mn({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:[l]}));else a.repeated?i=i.concat(l):i.push(l)}let s;switch(n.type){case ne.Sequence:s=new gr({value:i});break;case ne.Set:s=new Mo({value:i});break;case ne.Choice:if(!i[0])throw new Error(`Schema '${t.name}' has wrong data. Choice cannot be empty.`);s=i[0];break}return s}static toAsnItem(e,t,n,i){let s;if(typeof e.type=="number"){const o=e.converter;if(!o)throw new Error(`Property '${t}' doesn't have converter for type ${H[e.type]} in schema '${n.name}'`);if(e.repeated){if(!Array.isArray(i))throw new TypeError("Parameter 'objProp' should be type of Array.");const a=Array.from(i,l=>o.toASN(l)),c=e.repeated==="sequence"?gr:Mo;s=new c({value:a})}else s=o.toASN(i)}else if(e.repeated){if(!Array.isArray(i))throw new TypeError("Parameter 'objProp' should be type of Array.");const o=Array.from(i,c=>this.toASN(c)),a=e.repeated==="sequence"?gr:Mo;s=new a({value:o})}else s=this.toASN(i);return s}}class mt extends Array{constructor(e=[]){if(typeof e=="number")super(e);else{super();for(const t of e)this.push(t)}}}class ge{static serialize(e){return Jx.serialize(e)}static parse(e,t){return Xve.parse(e,t)}static toString(e){const t=me.isBufferSource(e)?me.toArrayBuffer(e):ge.serialize(e),n=No(t);if(n.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${n.result.error}`);return n.result.toString()}}function D(r,e,t,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}class jP{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){const t=e.split(".");if(t.length!==4)throw new Error("Invalid IPv4 address");return t.map(n=>{const i=parseInt(n,10);if(isNaN(i)||i<0||i>255)throw new Error("Invalid IPv4 address part");return i})}static parseIPv6(e){const n=this.expandIPv6(e).split(":");if(n.length!==8)throw new Error("Invalid IPv6 address");return n.reduce((i,s)=>{const o=parseInt(s,16);if(isNaN(o)||o<0||o>65535)throw new Error("Invalid IPv6 address part");return i.push(o>>8&255),i.push(o&255),i},[])}static expandIPv6(e){if(!e.includes("::"))return e;const t=e.split("::");if(t.length>2)throw new Error("Invalid IPv6 address");const n=t[0]?t[0].split(":"):[],i=t[1]?t[1].split(":"):[],s=8-(n.length+i.length);if(s<0)throw new Error("Invalid IPv6 address");return[...n,...Array(s).fill("0"),...i].join(":")}static formatIPv6(e){const t=[];for(let n=0;n<16;n+=2)t.push((e[n]<<8|e[n+1]).toString(16));return this.compressIPv6(t.join(":"))}static compressIPv6(e){const t=e.split(":");let n=-1,i=0,s=-1,o=0;for(let a=0;a<t.length;a++)t[a]==="0"?(s===-1&&(s=a),o++):(o>i&&(n=s,i=o),s=-1,o=0);if(o>i&&(n=s,i=o),i>1){const a=t.slice(0,n).join(":"),c=t.slice(n+i).join(":");return`${a}::${c}`}return e}static parseCIDR(e){const[t,n]=e.split("/"),i=parseInt(n,10);if(this.isIPv4(t)){if(i<0||i>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(t),i]}else{if(i<0||i>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(t),i]}}static decodeIP(e){if(e.length===64&&parseInt(e,16)===0)return"::/0";if(e.length!==16)return e;const t=parseInt(e.slice(8),16).toString(2).split("").reduce((i,s)=>i+ +s,0);let n=e.slice(0,8).replace(/(.{2})/g,i=>`${parseInt(i,16)}.`);return n=n.slice(0,-1),`${n}/${t}`}static toString(e){const t=new Uint8Array(e);if(t.length===4)return Array.from(t).join(".");if(t.length===16)return this.formatIPv6(t);if(t.length===8||t.length===32){const n=t.length/2,i=t.slice(0,n),s=t.slice(n);if(t.every(c=>c===0))return t.length===8?"0.0.0.0/0":"::/0";const a=s.reduce((c,l)=>c+(l.toString(2).match(/1/g)||[]).length,0);return t.length===8?`${Array.from(i).join(".")}/${a}`:`${this.formatIPv6(i)}/${a}`}return this.decodeIP(Ce.ToHex(e))}static fromString(e){if(e.includes("/")){const[n,i]=this.parseCIDR(e),s=new Uint8Array(n.length);let o=i;for(let c=0;c<s.length;c++)o>=8?(s[c]=255,o-=8):o>0&&(s[c]=255<<8-o,o=0);const a=new Uint8Array(n.length*2);return a.set(n,0),a.set(s,n.length),a.buffer}const t=this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e);return new Uint8Array(t).buffer}}var o7,a7,c7;let Pr=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};D([M({type:H.TeletexString})],Pr.prototype,"teletexString",void 0);D([M({type:H.PrintableString})],Pr.prototype,"printableString",void 0);D([M({type:H.UniversalString})],Pr.prototype,"universalString",void 0);D([M({type:H.Utf8String})],Pr.prototype,"utf8String",void 0);D([M({type:H.BmpString})],Pr.prototype,"bmpString",void 0);Pr=D([oe({type:ne.Choice})],Pr);let fh=class extends Pr{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?Ce.ToHex(this.anyValue):super.toString())}};D([M({type:H.IA5String})],fh.prototype,"ia5String",void 0);D([M({type:H.Any})],fh.prototype,"anyValue",void 0);fh=D([oe({type:ne.Choice})],fh);class u4{constructor(e={}){this.type="",this.value=new fh,Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],u4.prototype,"type",void 0);D([M({type:fh})],u4.prototype,"value",void 0);let ph=o7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,o7.prototype)}};ph=o7=D([oe({type:ne.Set,itemType:u4})],ph);let l7=a7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,a7.prototype)}};l7=a7=D([oe({type:ne.Sequence,itemType:ph})],l7);let er=c7=class extends l7{constructor(e){super(e),Object.setPrototypeOf(this,c7.prototype)}};er=c7=D([oe({type:ne.Sequence})],er);const Jve={fromASN:r=>jP.toString(Pm.fromASN(r)),toASN:r=>Pm.toASN(jP.fromString(r))};class lp{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],lp.prototype,"typeId",void 0);D([M({type:H.Any,context:0})],lp.prototype,"value",void 0);class Zx{constructor(e={}){this.partyName=new Pr,Object.assign(this,e)}}D([M({type:Pr,optional:!0,context:0,implicit:!0})],Zx.prototype,"nameAssigner",void 0);D([M({type:Pr,context:1,implicit:!0})],Zx.prototype,"partyName",void 0);let Ke=class{constructor(e={}){Object.assign(this,e)}};D([M({type:lp,context:0,implicit:!0})],Ke.prototype,"otherName",void 0);D([M({type:H.IA5String,context:1,implicit:!0})],Ke.prototype,"rfc822Name",void 0);D([M({type:H.IA5String,context:2,implicit:!0})],Ke.prototype,"dNSName",void 0);D([M({type:H.Any,context:3,implicit:!0})],Ke.prototype,"x400Address",void 0);D([M({type:er,context:4,implicit:!1})],Ke.prototype,"directoryName",void 0);D([M({type:Zx,context:5})],Ke.prototype,"ediPartyName",void 0);D([M({type:H.IA5String,context:6,implicit:!0})],Ke.prototype,"uniformResourceIdentifier",void 0);D([M({type:H.OctetString,context:7,implicit:!0,converter:Jve})],Ke.prototype,"iPAddress",void 0);D([M({type:H.ObjectIdentifier,context:8,implicit:!0})],Ke.prototype,"registeredID",void 0);Ke=D([oe({type:ne.Choice})],Ke);const eA="1.3.6.1.5.5.7",Zve=`${eA}.1`,zh=`${eA}.3`,d4=`${eA}.48`,qP=`${d4}.1`,WP=`${d4}.2`,GP=`${d4}.3`,QP=`${d4}.5`,Kc="2.5.29";var u7;const d7=`${Zve}.1`;class i0{constructor(e={}){this.accessMethod="",this.accessLocation=new Ke,Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],i0.prototype,"accessMethod",void 0);D([M({type:Ke})],i0.prototype,"accessLocation",void 0);let nd=u7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,u7.prototype)}};nd=u7=D([oe({type:ne.Sequence,itemType:i0})],nd);const h7=`${Kc}.35`;class tA extends it{}class El{constructor(e={}){e&&Object.assign(this,e)}}D([M({type:tA,context:0,optional:!0,implicit:!0})],El.prototype,"keyIdentifier",void 0);D([M({type:Ke,context:1,optional:!0,implicit:!0,repeated:"sequence"})],El.prototype,"authorityCertIssuer",void 0);D([M({type:H.Integer,context:2,optional:!0,implicit:!0,converter:Lt})],El.prototype,"authorityCertSerialNumber",void 0);const $H=`${Kc}.19`;class Dm{constructor(e={}){this.cA=!1,Object.assign(this,e)}}D([M({type:H.Boolean,defaultValue:!1})],Dm.prototype,"cA",void 0);D([M({type:H.Integer,optional:!0})],Dm.prototype,"pathLenConstraint",void 0);var f7;let pn=f7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,f7.prototype)}};pn=f7=D([oe({type:ne.Sequence,itemType:Ke})],pn);var p7;let YP=p7=class extends pn{constructor(e){super(e),Object.setPrototypeOf(this,p7.prototype)}};YP=p7=D([oe({type:ne.Sequence})],YP);var g7;const NH=`${Kc}.32`;let jo=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};D([M({type:H.IA5String})],jo.prototype,"ia5String",void 0);D([M({type:H.VisibleString})],jo.prototype,"visibleString",void 0);D([M({type:H.BmpString})],jo.prototype,"bmpString",void 0);D([M({type:H.Utf8String})],jo.prototype,"utf8String",void 0);jo=D([oe({type:ne.Choice})],jo);class rA{constructor(e={}){this.organization=new jo,this.noticeNumbers=[],Object.assign(this,e)}}D([M({type:jo})],rA.prototype,"organization",void 0);D([M({type:H.Integer,repeated:"sequence"})],rA.prototype,"noticeNumbers",void 0);class nA{constructor(e={}){Object.assign(this,e)}}D([M({type:rA,optional:!0})],nA.prototype,"noticeRef",void 0);D([M({type:jo,optional:!0})],nA.prototype,"explicitText",void 0);let $m=class{constructor(e={}){Object.assign(this,e)}};D([M({type:H.IA5String})],$m.prototype,"cPSuri",void 0);D([M({type:nA})],$m.prototype,"userNotice",void 0);$m=D([oe({type:ne.Choice})],$m);class iA{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],iA.prototype,"policyQualifierId",void 0);D([M({type:H.Any})],iA.prototype,"qualifier",void 0);class h4{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],h4.prototype,"policyIdentifier",void 0);D([M({type:iA,repeated:"sequence",optional:!0})],h4.prototype,"policyQualifiers",void 0);let Nm=g7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,g7.prototype)}};Nm=g7=D([oe({type:ne.Sequence,itemType:h4})],Nm);let Om=class{constructor(e=0){this.value=e}};D([M({type:H.Integer})],Om.prototype,"value",void 0);Om=D([oe({type:ne.Choice})],Om);let XP=class extends Om{};XP=D([oe({type:ne.Choice})],XP);var y7;const m7=`${Kc}.31`;var Xi;(function(r){r[r.unused=1]="unused",r[r.keyCompromise=2]="keyCompromise",r[r.cACompromise=4]="cACompromise",r[r.affiliationChanged=8]="affiliationChanged",r[r.superseded=16]="superseded",r[r.cessationOfOperation=32]="cessationOfOperation",r[r.certificateHold=64]="certificateHold",r[r.privilegeWithdrawn=128]="privilegeWithdrawn",r[r.aACompromise=256]="aACompromise"})(Xi||(Xi={}));class OH extends l4{toJSON(){const e=[],t=this.toNumber();return t&Xi.aACompromise&&e.push("aACompromise"),t&Xi.affiliationChanged&&e.push("affiliationChanged"),t&Xi.cACompromise&&e.push("cACompromise"),t&Xi.certificateHold&&e.push("certificateHold"),t&Xi.cessationOfOperation&&e.push("cessationOfOperation"),t&Xi.keyCompromise&&e.push("keyCompromise"),t&Xi.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&Xi.superseded&&e.push("superseded"),t&Xi.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}}let nu=class{constructor(e={}){Object.assign(this,e)}};D([M({type:Ke,context:0,repeated:"sequence",implicit:!0})],nu.prototype,"fullName",void 0);D([M({type:ph,context:1,implicit:!0})],nu.prototype,"nameRelativeToCRLIssuer",void 0);nu=D([oe({type:ne.Choice})],nu);class Vh{constructor(e={}){Object.assign(this,e)}}D([M({type:nu,context:0,optional:!0})],Vh.prototype,"distributionPoint",void 0);D([M({type:OH,context:1,optional:!0,implicit:!0})],Vh.prototype,"reasons",void 0);D([M({type:Ke,context:2,optional:!0,repeated:"sequence",implicit:!0})],Vh.prototype,"cRLIssuer",void 0);let Sd=y7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,y7.prototype)}};Sd=y7=D([oe({type:ne.Sequence,itemType:Vh})],Sd);var w7;let JP=w7=class extends Sd{constructor(e){super(e),Object.setPrototypeOf(this,w7.prototype)}};JP=w7=D([oe({type:ne.Sequence,itemType:Vh})],JP);class nn{constructor(e={}){this.onlyContainsUserCerts=nn.ONLY,this.onlyContainsCACerts=nn.ONLY,this.indirectCRL=nn.ONLY,this.onlyContainsAttributeCerts=nn.ONLY,Object.assign(this,e)}}nn.ONLY=!1;D([M({type:nu,context:0,optional:!0})],nn.prototype,"distributionPoint",void 0);D([M({type:H.Boolean,context:1,defaultValue:nn.ONLY,implicit:!0})],nn.prototype,"onlyContainsUserCerts",void 0);D([M({type:H.Boolean,context:2,defaultValue:nn.ONLY,implicit:!0})],nn.prototype,"onlyContainsCACerts",void 0);D([M({type:OH,context:3,optional:!0,implicit:!0})],nn.prototype,"onlySomeReasons",void 0);D([M({type:H.Boolean,context:4,defaultValue:nn.ONLY,implicit:!0})],nn.prototype,"indirectCRL",void 0);D([M({type:H.Boolean,context:5,defaultValue:nn.ONLY,implicit:!0})],nn.prototype,"onlyContainsAttributeCerts",void 0);var p1;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(p1||(p1={}));let v7=class{constructor(e=p1.unspecified){this.reason=p1.unspecified,this.reason=e}toJSON(){return p1[this.reason]}toString(){return this.toJSON()}};D([M({type:H.Enumerated})],v7.prototype,"reason",void 0);v7=D([oe({type:ne.Choice})],v7);var b7;const MH=`${Kc}.37`;let Mm=b7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,b7.prototype)}};Mm=b7=D([oe({type:ne.Sequence,itemType:H.ObjectIdentifier})],Mm);const ebe=`${zh}.1`,tbe=`${zh}.2`,rbe=`${zh}.3`,nbe=`${zh}.4`,ibe=`${zh}.8`,sbe=`${zh}.9`;let E7=class{constructor(e=new ArrayBuffer(0)){this.value=e}};D([M({type:H.Integer,converter:Lt})],E7.prototype,"value",void 0);E7=D([oe({type:ne.Choice})],E7);let S7=class{constructor(e){this.value=new Date,e&&(this.value=e)}};D([M({type:H.GeneralizedTime})],S7.prototype,"value",void 0);S7=D([oe({type:ne.Choice})],S7);var x7;let ZP=x7=class extends pn{constructor(e){super(e),Object.setPrototypeOf(this,x7.prototype)}};ZP=x7=D([oe({type:ne.Sequence})],ZP);const RH=`${Kc}.15`;var Ji;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(Ji||(Ji={}));class k6 extends l4{toJSON(){const e=this.toNumber(),t=[];return e&Ji.cRLSign&&t.push("crlSign"),e&Ji.dataEncipherment&&t.push("dataEncipherment"),e&Ji.decipherOnly&&t.push("decipherOnly"),e&Ji.digitalSignature&&t.push("digitalSignature"),e&Ji.encipherOnly&&t.push("encipherOnly"),e&Ji.keyAgreement&&t.push("keyAgreement"),e&Ji.keyCertSign&&t.push("keyCertSign"),e&Ji.keyEncipherment&&t.push("keyEncipherment"),e&Ji.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}}var A7;class f4{constructor(e={}){this.base=new Ke,this.minimum=0,Object.assign(this,e)}}D([M({type:Ke})],f4.prototype,"base",void 0);D([M({type:H.Integer,context:0,defaultValue:0,implicit:!0})],f4.prototype,"minimum",void 0);D([M({type:H.Integer,context:1,optional:!0,implicit:!0})],f4.prototype,"maximum",void 0);let Rm=A7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,A7.prototype)}};Rm=A7=D([oe({type:ne.Sequence,itemType:f4})],Rm);class LH{constructor(e={}){Object.assign(this,e)}}D([M({type:Rm,context:0,optional:!0,implicit:!0})],LH.prototype,"permittedSubtrees",void 0);D([M({type:Rm,context:1,optional:!0,implicit:!0})],LH.prototype,"excludedSubtrees",void 0);class BH{constructor(e={}){Object.assign(this,e)}}D([M({type:H.Integer,context:0,implicit:!0,optional:!0,converter:Lt})],BH.prototype,"requireExplicitPolicy",void 0);D([M({type:H.Integer,context:1,implicit:!0,optional:!0,converter:Lt})],BH.prototype,"inhibitPolicyMapping",void 0);var I7;class sA{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],sA.prototype,"issuerDomainPolicy",void 0);D([M({type:H.ObjectIdentifier})],sA.prototype,"subjectDomainPolicy",void 0);let eD=I7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,I7.prototype)}};eD=I7=D([oe({type:ne.Sequence,itemType:sA})],eD);var C7;const UH=`${Kc}.17`;let k7=C7=class extends pn{constructor(e){super(e),Object.setPrototypeOf(this,C7.prototype)}};k7=C7=D([oe({type:ne.Sequence})],k7);let qo=class{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}};D([M({type:H.ObjectIdentifier})],qo.prototype,"type",void 0);D([M({type:H.Any,repeated:"set"})],qo.prototype,"values",void 0);var _7;let tD=_7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,_7.prototype)}};tD=_7=D([oe({type:ne.Sequence,itemType:qo})],tD);const FH=`${Kc}.14`;class yc extends tA{}class zH{constructor(e={}){Object.assign(this,e)}}D([M({type:H.GeneralizedTime,context:0,implicit:!0,optional:!0})],zH.prototype,"notBefore",void 0);D([M({type:H.GeneralizedTime,context:1,implicit:!0,optional:!0})],zH.prototype,"notAfter",void 0);var g1;(function(r){r[r.keyUpdateAllowed=1]="keyUpdateAllowed",r[r.newExtensions=2]="newExtensions",r[r.pKIXCertificate=4]="pKIXCertificate"})(g1||(g1={}));class VH extends l4{toJSON(){const e=[],t=this.toNumber();return t&g1.pKIXCertificate&&e.push("pKIXCertificate"),t&g1.newExtensions&&e.push("newExtensions"),t&g1.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}}class KH{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new VH,Object.assign(this,e)}}D([M({type:H.GeneralString})],KH.prototype,"entrustVers",void 0);D([M({type:VH})],KH.prototype,"entrustInfoFlags",void 0);var T7;let rD=T7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,T7.prototype)}};rD=T7=D([oe({type:ne.Sequence,itemType:i0})],rD);class Ee{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof Ee&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&xK(e.parameters,this.parameters)||e.parameters===this.parameters)}}D([M({type:H.ObjectIdentifier})],Ee.prototype,"algorithm",void 0);D([M({type:H.Any,optional:!0})],Ee.prototype,"parameters",void 0);class as{constructor(e={}){this.algorithm=new Ee,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:Ee})],as.prototype,"algorithm",void 0);D([M({type:H.BitString})],as.prototype,"subjectPublicKey",void 0);let Ir=class{constructor(e){if(e)if(typeof e=="string"||typeof e=="number"||e instanceof Date){const t=new Date(e);t.getUTCFullYear()>2049?this.generalTime=t:this.utcTime=t}else Object.assign(this,e)}getTime(){const e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};D([M({type:H.UTCTime})],Ir.prototype,"utcTime",void 0);D([M({type:H.GeneralizedTime})],Ir.prototype,"generalTime",void 0);Ir=D([oe({type:ne.Choice})],Ir);class s0{constructor(e){this.notBefore=new Ir(new Date),this.notAfter=new Ir(new Date),e&&(this.notBefore=new Ir(e.notBefore),this.notAfter=new Ir(e.notAfter))}}D([M({type:Ir})],s0.prototype,"notBefore",void 0);D([M({type:Ir})],s0.prototype,"notAfter",void 0);var P7;let Bi=class HH{constructor(e={}){this.extnID="",this.critical=HH.CRITICAL,this.extnValue=new it,Object.assign(this,e)}};Bi.CRITICAL=!1;D([M({type:H.ObjectIdentifier})],Bi.prototype,"extnID",void 0);D([M({type:H.Boolean,defaultValue:Bi.CRITICAL})],Bi.prototype,"critical",void 0);D([M({type:it})],Bi.prototype,"extnValue",void 0);let $c=P7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,P7.prototype)}};$c=P7=D([oe({type:ne.Sequence,itemType:Bi})],$c);var iu;(function(r){r[r.v1=0]="v1",r[r.v2=1]="v2",r[r.v3=2]="v3"})(iu||(iu={}));class gi{constructor(e={}){this.version=iu.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new Ee,this.issuer=new er,this.validity=new s0,this.subject=new er,this.subjectPublicKeyInfo=new as,Object.assign(this,e)}}D([M({type:H.Integer,context:0,defaultValue:iu.v1})],gi.prototype,"version",void 0);D([M({type:H.Integer,converter:Lt})],gi.prototype,"serialNumber",void 0);D([M({type:Ee})],gi.prototype,"signature",void 0);D([M({type:er})],gi.prototype,"issuer",void 0);D([M({type:s0})],gi.prototype,"validity",void 0);D([M({type:er})],gi.prototype,"subject",void 0);D([M({type:as})],gi.prototype,"subjectPublicKeyInfo",void 0);D([M({type:H.BitString,context:1,implicit:!0,optional:!0})],gi.prototype,"issuerUniqueID",void 0);D([M({type:H.BitString,context:2,implicit:!0,optional:!0})],gi.prototype,"subjectUniqueID",void 0);D([M({type:$c,context:3,optional:!0})],gi.prototype,"extensions",void 0);class su{constructor(e={}){this.tbsCertificate=new gi,this.signatureAlgorithm=new Ee,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:gi})],su.prototype,"tbsCertificate",void 0);D([M({type:Ee})],su.prototype,"signatureAlgorithm",void 0);D([M({type:H.BitString})],su.prototype,"signatureValue",void 0);class p4{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new Ir,Object.assign(this,e)}}D([M({type:H.Integer,converter:Lt})],p4.prototype,"userCertificate",void 0);D([M({type:Ir})],p4.prototype,"revocationDate",void 0);D([M({type:Bi,optional:!0,repeated:"sequence"})],p4.prototype,"crlEntryExtensions",void 0);class la{constructor(e={}){this.signature=new Ee,this.issuer=new er,this.thisUpdate=new Ir,Object.assign(this,e)}}D([M({type:H.Integer,optional:!0})],la.prototype,"version",void 0);D([M({type:Ee})],la.prototype,"signature",void 0);D([M({type:er})],la.prototype,"issuer",void 0);D([M({type:Ir})],la.prototype,"thisUpdate",void 0);D([M({type:Ir,optional:!0})],la.prototype,"nextUpdate",void 0);D([M({type:p4,repeated:"sequence",optional:!0})],la.prototype,"revokedCertificates",void 0);D([M({type:Bi,optional:!0,context:0,repeated:"sequence"})],la.prototype,"crlExtensions",void 0);class oA{constructor(e={}){this.tbsCertList=new la,this.signatureAlgorithm=new Ee,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:la})],oA.prototype,"tbsCertList",void 0);D([M({type:Ee})],oA.prototype,"signatureAlgorithm",void 0);D([M({type:H.BitString})],oA.prototype,"signature",void 0);class Kh{constructor(e={}){this.issuer=new er,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:er})],Kh.prototype,"issuer",void 0);D([M({type:H.Integer,converter:Lt})],Kh.prototype,"serialNumber",void 0);let gh=class{constructor(e={}){Object.assign(this,e)}};D([M({type:yc,context:0,implicit:!0})],gh.prototype,"subjectKeyIdentifier",void 0);D([M({type:Kh})],gh.prototype,"issuerAndSerialNumber",void 0);gh=D([oe({type:ne.Choice})],gh);var Wo;(function(r){r[r.v0=0]="v0",r[r.v1=1]="v1",r[r.v2=2]="v2",r[r.v3=3]="v3",r[r.v4=4]="v4",r[r.v5=5]="v5"})(Wo||(Wo={}));let up=class extends Ee{};up=D([oe({type:ne.Sequence})],up);let Lm=class extends Ee{};Lm=D([oe({type:ne.Sequence})],Lm);let Gs=class extends Ee{};Gs=D([oe({type:ne.Sequence})],Gs);let Bm=class extends Ee{};Bm=D([oe({type:ne.Sequence})],Bm);let nD=class extends Ee{};nD=D([oe({type:ne.Sequence})],nD);let D7=class extends Ee{};D7=D([oe({type:ne.Sequence})],D7);let Hh=class{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}};D([M({type:H.ObjectIdentifier})],Hh.prototype,"attrType",void 0);D([M({type:H.Any,repeated:"set"})],Hh.prototype,"attrValues",void 0);var $7;class eo{constructor(e={}){this.version=Wo.v0,this.sid=new gh,this.digestAlgorithm=new up,this.signatureAlgorithm=new Lm,this.signature=new it,Object.assign(this,e)}}D([M({type:H.Integer})],eo.prototype,"version",void 0);D([M({type:gh})],eo.prototype,"sid",void 0);D([M({type:up})],eo.prototype,"digestAlgorithm",void 0);D([M({type:Hh,repeated:"set",context:0,implicit:!0,optional:!0})],eo.prototype,"signedAttrs",void 0);D([M({type:Lm})],eo.prototype,"signatureAlgorithm",void 0);D([M({type:it})],eo.prototype,"signature",void 0);D([M({type:Hh,repeated:"set",context:1,implicit:!0,optional:!0})],eo.prototype,"unsignedAttrs",void 0);let Um=$7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,$7.prototype)}};Um=$7=D([oe({type:ne.Set,itemType:eo})],Um);let iD=class extends Ir{};iD=D([oe({type:ne.Choice})],iD);let sD=class extends eo{};sD=D([oe({type:ne.Sequence})],sD);class aA{constructor(e={}){this.acIssuer=new Ke,this.acSerial=0,this.attrs=[],Object.assign(this,e)}}D([M({type:Ke})],aA.prototype,"acIssuer",void 0);D([M({type:H.Integer})],aA.prototype,"acSerial",void 0);D([M({type:qo,repeated:"sequence"})],aA.prototype,"attrs",void 0);var N7;let Fm=N7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,N7.prototype)}};Fm=N7=D([oe({type:ne.Sequence,itemType:H.ObjectIdentifier})],Fm);class g4{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}}D([M({type:H.Integer,optional:!0})],g4.prototype,"pathLenConstraint",void 0);D([M({type:Fm,implicit:!0,context:0,optional:!0})],g4.prototype,"permittedAttrs",void 0);D([M({type:Fm,implicit:!0,context:1,optional:!0})],g4.prototype,"excludedAttrs",void 0);D([M({type:H.Boolean,defaultValue:!0})],g4.prototype,"permitUnSpecified",void 0);class xu{constructor(e={}){this.issuer=new pn,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:pn})],xu.prototype,"issuer",void 0);D([M({type:H.Integer,converter:Lt})],xu.prototype,"serial",void 0);D([M({type:H.BitString,optional:!0})],xu.prototype,"issuerUID",void 0);var O7;(function(r){r[r.publicKey=0]="publicKey",r[r.publicKeyCert=1]="publicKeyCert",r[r.otherObjectTypes=2]="otherObjectTypes"})(O7||(O7={}));class Au{constructor(e={}){this.digestedObjectType=O7.publicKey,this.digestAlgorithm=new Ee,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:H.Enumerated})],Au.prototype,"digestedObjectType",void 0);D([M({type:H.ObjectIdentifier,optional:!0})],Au.prototype,"otherObjectTypeID",void 0);D([M({type:Ee})],Au.prototype,"digestAlgorithm",void 0);D([M({type:H.BitString})],Au.prototype,"objectDigest",void 0);class y4{constructor(e={}){Object.assign(this,e)}}D([M({type:pn,optional:!0})],y4.prototype,"issuerName",void 0);D([M({type:xu,context:0,implicit:!0,optional:!0})],y4.prototype,"baseCertificateID",void 0);D([M({type:Au,context:1,implicit:!0,optional:!0})],y4.prototype,"objectDigestInfo",void 0);let yh=class{constructor(e={}){Object.assign(this,e)}};D([M({type:Ke,repeated:"sequence"})],yh.prototype,"v1Form",void 0);D([M({type:y4,context:0,implicit:!0})],yh.prototype,"v2Form",void 0);yh=D([oe({type:ne.Choice})],yh);class m4{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}}D([M({type:H.GeneralizedTime})],m4.prototype,"notBeforeTime",void 0);D([M({type:H.GeneralizedTime})],m4.prototype,"notAfterTime",void 0);class o0{constructor(e={}){Object.assign(this,e)}}D([M({type:xu,implicit:!0,context:0,optional:!0})],o0.prototype,"baseCertificateID",void 0);D([M({type:pn,implicit:!0,context:1,optional:!0})],o0.prototype,"entityName",void 0);D([M({type:Au,implicit:!0,context:2,optional:!0})],o0.prototype,"objectDigestInfo",void 0);var M7;(function(r){r[r.v2=1]="v2"})(M7||(M7={}));class vs{constructor(e={}){this.version=M7.v2,this.holder=new o0,this.issuer=new yh,this.signature=new Ee,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new m4,this.attributes=[],Object.assign(this,e)}}D([M({type:H.Integer})],vs.prototype,"version",void 0);D([M({type:o0})],vs.prototype,"holder",void 0);D([M({type:yh})],vs.prototype,"issuer",void 0);D([M({type:Ee})],vs.prototype,"signature",void 0);D([M({type:H.Integer,converter:Lt})],vs.prototype,"serialNumber",void 0);D([M({type:m4})],vs.prototype,"attrCertValidityPeriod",void 0);D([M({type:qo,repeated:"sequence"})],vs.prototype,"attributes",void 0);D([M({type:H.BitString,optional:!0})],vs.prototype,"issuerUniqueID",void 0);D([M({type:$c,optional:!0})],vs.prototype,"extensions",void 0);class w4{constructor(e={}){this.acinfo=new vs,this.signatureAlgorithm=new Ee,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:vs})],w4.prototype,"acinfo",void 0);D([M({type:Ee})],w4.prototype,"signatureAlgorithm",void 0);D([M({type:H.BitString})],w4.prototype,"signatureValue",void 0);var zm;(function(r){r[r.unmarked=1]="unmarked",r[r.unclassified=2]="unclassified",r[r.restricted=4]="restricted",r[r.confidential=8]="confidential",r[r.secret=16]="secret",r[r.topSecret=32]="topSecret"})(zm||(zm={}));class R7 extends l4{}class cA{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:H.ObjectIdentifier,implicit:!0,context:0})],cA.prototype,"type",void 0);D([M({type:H.Any,implicit:!0,context:1})],cA.prototype,"value",void 0);class lA{constructor(e={}){this.policyId="",this.classList=new R7(zm.unclassified),Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],lA.prototype,"policyId",void 0);D([M({type:R7,defaultValue:new R7(zm.unclassified)})],lA.prototype,"classList",void 0);D([M({type:cA,repeated:"set"})],lA.prototype,"securityCategories",void 0);class v4{constructor(e={}){Object.assign(this,e)}}D([M({type:it})],v4.prototype,"cotets",void 0);D([M({type:H.ObjectIdentifier})],v4.prototype,"oid",void 0);D([M({type:H.Utf8String})],v4.prototype,"string",void 0);class jH{constructor(e={}){this.values=[],Object.assign(this,e)}}D([M({type:pn,implicit:!0,context:0,optional:!0})],jH.prototype,"policyAuthority",void 0);D([M({type:v4,repeated:"sequence"})],jH.prototype,"values",void 0);var L7;class b4{constructor(e={}){this.targetCertificate=new xu,Object.assign(this,e)}}D([M({type:xu})],b4.prototype,"targetCertificate",void 0);D([M({type:Ke,optional:!0})],b4.prototype,"targetName",void 0);D([M({type:Au,optional:!0})],b4.prototype,"certDigestInfo",void 0);let mh=class{constructor(e={}){Object.assign(this,e)}};D([M({type:Ke,context:0,implicit:!0})],mh.prototype,"targetName",void 0);D([M({type:Ke,context:1,implicit:!0})],mh.prototype,"targetGroup",void 0);D([M({type:b4,context:2,implicit:!0})],mh.prototype,"targetCert",void 0);mh=D([oe({type:ne.Choice})],mh);let B7=L7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,L7.prototype)}};B7=L7=D([oe({type:ne.Sequence,itemType:mh})],B7);var U7;let oD=U7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,U7.prototype)}};oD=U7=D([oe({type:ne.Sequence,itemType:B7})],oD);class qH{constructor(e={}){Object.assign(this,e)}}D([M({type:pn,implicit:!0,context:0,optional:!0})],qH.prototype,"roleAuthority",void 0);D([M({type:Ke,implicit:!0,context:1})],qH.prototype,"roleName",void 0);class uA{constructor(e={}){this.service=new Ke,this.ident=new Ke,Object.assign(this,e)}}D([M({type:Ke})],uA.prototype,"service",void 0);D([M({type:Ke})],uA.prototype,"ident",void 0);D([M({type:it,optional:!0})],uA.prototype,"authInfo",void 0);var F7;class dA{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],dA.prototype,"otherCertFormat",void 0);D([M({type:H.Any})],dA.prototype,"otherCert",void 0);let wh=class{constructor(e={}){Object.assign(this,e)}};D([M({type:su})],wh.prototype,"certificate",void 0);D([M({type:w4,context:2,implicit:!0})],wh.prototype,"v2AttrCert",void 0);D([M({type:dA,context:3,implicit:!0})],wh.prototype,"other",void 0);wh=D([oe({type:ne.Choice})],wh);let Vm=F7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,F7.prototype)}};Vm=F7=D([oe({type:ne.Set,itemType:wh})],Vm);class jh{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],jh.prototype,"contentType",void 0);D([M({type:H.Any,context:0})],jh.prototype,"content",void 0);let dp=class{constructor(e={}){Object.assign(this,e)}};D([M({type:it})],dp.prototype,"single",void 0);D([M({type:H.Any})],dp.prototype,"any",void 0);dp=D([oe({type:ne.Choice})],dp);class E4{constructor(e={}){this.eContentType="",Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],E4.prototype,"eContentType",void 0);D([M({type:dp,context:0,optional:!0})],E4.prototype,"eContent",void 0);let hp=class{constructor(e={}){Object.assign(this,e)}};D([M({type:it,context:0,implicit:!0,optional:!0})],hp.prototype,"value",void 0);D([M({type:it,converter:Ove,context:0,implicit:!0,optional:!0,repeated:"sequence"})],hp.prototype,"constructedValue",void 0);hp=D([oe({type:ne.Choice})],hp);class a0{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new Bm,Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],a0.prototype,"contentType",void 0);D([M({type:Bm})],a0.prototype,"contentEncryptionAlgorithm",void 0);D([M({type:hp,optional:!0})],a0.prototype,"encryptedContent",void 0);class S4{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],S4.prototype,"keyAttrId",void 0);D([M({type:H.Any,optional:!0})],S4.prototype,"keyAttr",void 0);var z7;class x4{constructor(e={}){this.subjectKeyIdentifier=new yc,Object.assign(this,e)}}D([M({type:yc})],x4.prototype,"subjectKeyIdentifier",void 0);D([M({type:H.GeneralizedTime,optional:!0})],x4.prototype,"date",void 0);D([M({type:S4,optional:!0})],x4.prototype,"other",void 0);let vh=class{constructor(e={}){Object.assign(this,e)}};D([M({type:x4,context:0,implicit:!0,optional:!0})],vh.prototype,"rKeyId",void 0);D([M({type:Kh,optional:!0})],vh.prototype,"issuerAndSerialNumber",void 0);vh=D([oe({type:ne.Choice})],vh);class hA{constructor(e={}){this.rid=new vh,this.encryptedKey=new it,Object.assign(this,e)}}D([M({type:vh})],hA.prototype,"rid",void 0);D([M({type:it})],hA.prototype,"encryptedKey",void 0);let Km=z7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,z7.prototype)}};Km=z7=D([oe({type:ne.Sequence,itemType:hA})],Km);class fA{constructor(e={}){this.algorithm=new Ee,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:Ee})],fA.prototype,"algorithm",void 0);D([M({type:H.BitString})],fA.prototype,"publicKey",void 0);let ou=class{constructor(e={}){Object.assign(this,e)}};D([M({type:yc,context:0,implicit:!0,optional:!0})],ou.prototype,"subjectKeyIdentifier",void 0);D([M({type:fA,context:1,implicit:!0,optional:!0})],ou.prototype,"originatorKey",void 0);D([M({type:Kh,optional:!0})],ou.prototype,"issuerAndSerialNumber",void 0);ou=D([oe({type:ne.Choice})],ou);class qh{constructor(e={}){this.version=Wo.v3,this.originator=new ou,this.keyEncryptionAlgorithm=new Gs,this.recipientEncryptedKeys=new Km,Object.assign(this,e)}}D([M({type:H.Integer})],qh.prototype,"version",void 0);D([M({type:ou,context:0})],qh.prototype,"originator",void 0);D([M({type:it,context:1,optional:!0})],qh.prototype,"ukm",void 0);D([M({type:Gs})],qh.prototype,"keyEncryptionAlgorithm",void 0);D([M({type:Km})],qh.prototype,"recipientEncryptedKeys",void 0);let bh=class{constructor(e={}){Object.assign(this,e)}};D([M({type:yc,context:0,implicit:!0})],bh.prototype,"subjectKeyIdentifier",void 0);D([M({type:Kh})],bh.prototype,"issuerAndSerialNumber",void 0);bh=D([oe({type:ne.Choice})],bh);class c0{constructor(e={}){this.version=Wo.v0,this.rid=new bh,this.keyEncryptionAlgorithm=new Gs,this.encryptedKey=new it,Object.assign(this,e)}}D([M({type:H.Integer})],c0.prototype,"version",void 0);D([M({type:bh})],c0.prototype,"rid",void 0);D([M({type:Gs})],c0.prototype,"keyEncryptionAlgorithm",void 0);D([M({type:it})],c0.prototype,"encryptedKey",void 0);class l0{constructor(e={}){this.keyIdentifier=new it,Object.assign(this,e)}}D([M({type:it})],l0.prototype,"keyIdentifier",void 0);D([M({type:H.GeneralizedTime,optional:!0})],l0.prototype,"date",void 0);D([M({type:S4,optional:!0})],l0.prototype,"other",void 0);class u0{constructor(e={}){this.version=Wo.v4,this.kekid=new l0,this.keyEncryptionAlgorithm=new Gs,this.encryptedKey=new it,Object.assign(this,e)}}D([M({type:H.Integer})],u0.prototype,"version",void 0);D([M({type:l0})],u0.prototype,"kekid",void 0);D([M({type:Gs})],u0.prototype,"keyEncryptionAlgorithm",void 0);D([M({type:it})],u0.prototype,"encryptedKey",void 0);class d0{constructor(e={}){this.version=Wo.v0,this.keyEncryptionAlgorithm=new Gs,this.encryptedKey=new it,Object.assign(this,e)}}D([M({type:H.Integer})],d0.prototype,"version",void 0);D([M({type:D7,context:0,optional:!0})],d0.prototype,"keyDerivationAlgorithm",void 0);D([M({type:Gs})],d0.prototype,"keyEncryptionAlgorithm",void 0);D([M({type:it})],d0.prototype,"encryptedKey",void 0);class pA{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],pA.prototype,"oriType",void 0);D([M({type:H.Any})],pA.prototype,"oriValue",void 0);let Nc=class{constructor(e={}){Object.assign(this,e)}};D([M({type:c0,optional:!0})],Nc.prototype,"ktri",void 0);D([M({type:qh,context:1,implicit:!0,optional:!0})],Nc.prototype,"kari",void 0);D([M({type:u0,context:2,implicit:!0,optional:!0})],Nc.prototype,"kekri",void 0);D([M({type:d0,context:3,implicit:!0,optional:!0})],Nc.prototype,"pwri",void 0);D([M({type:pA,context:4,implicit:!0,optional:!0})],Nc.prototype,"ori",void 0);Nc=D([oe({type:ne.Choice})],Nc);var V7;let Hm=V7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,V7.prototype)}};Hm=V7=D([oe({type:ne.Set,itemType:Nc})],Hm);var K7;class A4{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],A4.prototype,"otherRevInfoFormat",void 0);D([M({type:H.Any})],A4.prototype,"otherRevInfo",void 0);let jm=class{constructor(e={}){this.other=new A4,Object.assign(this,e)}};D([M({type:A4,context:1,implicit:!0})],jm.prototype,"other",void 0);jm=D([oe({type:ne.Choice})],jm);let qm=K7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,K7.prototype)}};qm=K7=D([oe({type:ne.Set,itemType:jm})],qm);class gA{constructor(e={}){Object.assign(this,e)}}D([M({type:Vm,context:0,implicit:!0,optional:!0})],gA.prototype,"certs",void 0);D([M({type:qm,context:1,implicit:!0,optional:!0})],gA.prototype,"crls",void 0);var H7;let j7=H7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,H7.prototype)}};j7=H7=D([oe({type:ne.Set,itemType:Hh})],j7);class h0{constructor(e={}){this.version=Wo.v0,this.recipientInfos=new Hm,this.encryptedContentInfo=new a0,Object.assign(this,e)}}D([M({type:H.Integer})],h0.prototype,"version",void 0);D([M({type:gA,context:0,implicit:!0,optional:!0})],h0.prototype,"originatorInfo",void 0);D([M({type:Hm})],h0.prototype,"recipientInfos",void 0);D([M({type:a0})],h0.prototype,"encryptedContentInfo",void 0);D([M({type:j7,context:1,implicit:!0,optional:!0})],h0.prototype,"unprotectedAttrs",void 0);const obe="1.2.840.113549.1.7.2";var q7;let Wm=q7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,q7.prototype)}};Wm=q7=D([oe({type:ne.Set,itemType:up})],Wm);class Wh{constructor(e={}){this.version=Wo.v0,this.digestAlgorithms=new Wm,this.encapContentInfo=new E4,this.signerInfos=new Um,Object.assign(this,e)}}D([M({type:H.Integer})],Wh.prototype,"version",void 0);D([M({type:Wm})],Wh.prototype,"digestAlgorithms",void 0);D([M({type:E4})],Wh.prototype,"encapContentInfo",void 0);D([M({type:Vm,context:0,implicit:!0,optional:!0})],Wh.prototype,"certificates",void 0);D([M({type:qm,context:1,implicit:!0,optional:!0})],Wh.prototype,"crls",void 0);D([M({type:Um})],Wh.prototype,"signerInfos",void 0);const fp="1.2.840.10045.2.1",yA="1.2.840.10045.4.1",WH="1.2.840.10045.4.3.1",mA="1.2.840.10045.4.3.2",wA="1.2.840.10045.4.3.3",vA="1.2.840.10045.4.3.4",aD="1.2.840.10045.3.1.7",cD="1.3.132.0.34",lD="1.3.132.0.35";function f0(r){return new Ee({algorithm:r})}const abe=f0(yA);f0(WH);const cbe=f0(mA),lbe=f0(wA),ube=f0(vA);let pp=class{constructor(e={}){Object.assign(this,e)}};D([M({type:H.ObjectIdentifier})],pp.prototype,"fieldType",void 0);D([M({type:H.Any})],pp.prototype,"parameters",void 0);pp=D([oe({type:ne.Sequence})],pp);class dbe extends it{}let Eh=class{constructor(e={}){Object.assign(this,e)}};D([M({type:H.OctetString})],Eh.prototype,"a",void 0);D([M({type:H.OctetString})],Eh.prototype,"b",void 0);D([M({type:H.BitString,optional:!0})],Eh.prototype,"seed",void 0);Eh=D([oe({type:ne.Sequence})],Eh);var W7;(function(r){r[r.ecpVer1=1]="ecpVer1"})(W7||(W7={}));let Go=class{constructor(e={}){this.version=W7.ecpVer1,Object.assign(this,e)}};D([M({type:H.Integer})],Go.prototype,"version",void 0);D([M({type:pp})],Go.prototype,"fieldID",void 0);D([M({type:Eh})],Go.prototype,"curve",void 0);D([M({type:dbe})],Go.prototype,"base",void 0);D([M({type:H.Integer,converter:Lt})],Go.prototype,"order",void 0);D([M({type:H.Integer,optional:!0})],Go.prototype,"cofactor",void 0);Go=D([oe({type:ne.Sequence})],Go);let Oc=class{constructor(e={}){Object.assign(this,e)}};D([M({type:H.ObjectIdentifier})],Oc.prototype,"namedCurve",void 0);D([M({type:H.Null})],Oc.prototype,"implicitCurve",void 0);D([M({type:Go})],Oc.prototype,"specifiedCurve",void 0);Oc=D([oe({type:ne.Choice})],Oc);class I4{constructor(e={}){this.version=1,this.privateKey=new it,Object.assign(this,e)}}D([M({type:H.Integer})],I4.prototype,"version",void 0);D([M({type:it})],I4.prototype,"privateKey",void 0);D([M({type:Oc,context:0,optional:!0})],I4.prototype,"parameters",void 0);D([M({type:H.BitString,context:1,optional:!0})],I4.prototype,"publicKey",void 0);class Gm{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:H.Integer,converter:Lt})],Gm.prototype,"r",void 0);D([M({type:H.Integer,converter:Lt})],Gm.prototype,"s",void 0);const zn="1.2.840.113549.1.1",au=`${zn}.1`,hbe=`${zn}.7`,fbe=`${zn}.9`,y1=`${zn}.10`,pbe=`${zn}.2`,gbe=`${zn}.4`,Qm=`${zn}.5`,ybe=`${zn}.14`,G7=`${zn}.11`,Ym=`${zn}.12`,Xm=`${zn}.13`,GH=`${zn}.15`,QH=`${zn}.16`,Jm="1.3.14.3.2.26",YH="2.16.840.1.101.3.4.2.4",Zm="2.16.840.1.101.3.4.2.1",e3="2.16.840.1.101.3.4.2.2",t3="2.16.840.1.101.3.4.2.3",mbe="2.16.840.1.101.3.4.2.5",wbe="2.16.840.1.101.3.4.2.6",vbe="1.2.840.113549.2.2",bbe="1.2.840.113549.2.5",C4=`${zn}.8`;function dr(r){return new Ee({algorithm:r,parameters:null})}dr(vbe);dr(bbe);const cu=dr(Jm);dr(YH);dr(Zm);dr(e3);dr(t3);dr(mbe);dr(wbe);const XH=new Ee({algorithm:C4,parameters:ge.serialize(cu)}),JH=new Ee({algorithm:fbe,parameters:ge.serialize(Pm.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))});dr(au);dr(pbe);dr(gbe);dr(Qm);dr(GH);dr(QH);dr(Ym);dr(Xm);dr(GH);dr(QH);class k4{constructor(e={}){this.hashAlgorithm=new Ee(cu),this.maskGenAlgorithm=new Ee({algorithm:C4,parameters:ge.serialize(cu)}),this.pSourceAlgorithm=new Ee(JH),Object.assign(this,e)}}D([M({type:Ee,context:0,defaultValue:cu})],k4.prototype,"hashAlgorithm",void 0);D([M({type:Ee,context:1,defaultValue:XH})],k4.prototype,"maskGenAlgorithm",void 0);D([M({type:Ee,context:2,defaultValue:JH})],k4.prototype,"pSourceAlgorithm",void 0);new Ee({algorithm:hbe,parameters:ge.serialize(new k4)});class lu{constructor(e={}){this.hashAlgorithm=new Ee(cu),this.maskGenAlgorithm=new Ee({algorithm:C4,parameters:ge.serialize(cu)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}}D([M({type:Ee,context:0,defaultValue:cu})],lu.prototype,"hashAlgorithm",void 0);D([M({type:Ee,context:1,defaultValue:XH})],lu.prototype,"maskGenAlgorithm",void 0);D([M({type:H.Integer,context:2,defaultValue:20})],lu.prototype,"saltLength",void 0);D([M({type:H.Integer,context:3,defaultValue:1})],lu.prototype,"trailerField",void 0);new Ee({algorithm:y1,parameters:ge.serialize(new lu)});class _4{constructor(e={}){this.digestAlgorithm=new Ee,this.digest=new it,Object.assign(this,e)}}D([M({type:Ee})],_4.prototype,"digestAlgorithm",void 0);D([M({type:it})],_4.prototype,"digest",void 0);var Q7;class T4{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:H.Integer,converter:Lt})],T4.prototype,"prime",void 0);D([M({type:H.Integer,converter:Lt})],T4.prototype,"exponent",void 0);D([M({type:H.Integer,converter:Lt})],T4.prototype,"coefficient",void 0);let Y7=Q7=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,Q7.prototype)}};Y7=Q7=D([oe({type:ne.Sequence,itemType:T4})],Y7);class to{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:H.Integer})],to.prototype,"version",void 0);D([M({type:H.Integer,converter:Lt})],to.prototype,"modulus",void 0);D([M({type:H.Integer,converter:Lt})],to.prototype,"publicExponent",void 0);D([M({type:H.Integer,converter:Lt})],to.prototype,"privateExponent",void 0);D([M({type:H.Integer,converter:Lt})],to.prototype,"prime1",void 0);D([M({type:H.Integer,converter:Lt})],to.prototype,"prime2",void 0);D([M({type:H.Integer,converter:Lt})],to.prototype,"exponent1",void 0);D([M({type:H.Integer,converter:Lt})],to.prototype,"exponent2",void 0);D([M({type:H.Integer,converter:Lt})],to.prototype,"coefficient",void 0);D([M({type:Y7,optional:!0})],to.prototype,"otherPrimeInfos",void 0);class bA{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:H.Integer,converter:Lt})],bA.prototype,"modulus",void 0);D([M({type:H.Integer,converter:Lt})],bA.prototype,"publicExponent",void 0);var X7;(function(r){r[r.Transient=0]="Transient",r[r.Singleton=1]="Singleton",r[r.ResolutionScoped=2]="ResolutionScoped",r[r.ContainerScoped=3]="ContainerScoped"})(X7||(X7={}));const bn=X7;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var J7=function(r,e){return J7=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},J7(r,e)};function EA(r,e){J7(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ebe(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(d){try{l(n.next(d))}catch(h){o(h)}}function c(d){try{l(n.throw(d))}catch(h){o(h)}}function l(d){d.done?s(d.value):i(d.value).then(a,c)}l((n=n.apply(r,[])).next())})}function Sbe(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(d){return c([l,d])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(d){l=[6,d],i=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function vg(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function r3(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s}function hl(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(r3(arguments[e]));return r}var xbe="injectionTokens";function Abe(r){var e=Reflect.getMetadata("design:paramtypes",r)||[],t=Reflect.getOwnMetadata(xbe,r)||{};return Object.keys(t).forEach(function(n){e[+n]=t[n]}),e}function ZH(r){return!!r.useClass}function Z7(r){return!!r.useFactory}var ej=function(){function r(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return r.prototype.createProxy=function(e){var t=this,n={},i=!1,s,o=function(){return i||(s=e(t.wrap()),i=!0),s};return new Proxy(n,this.createHandler(o))},r.prototype.createHandler=function(e){var t={},n=function(i){t[i]=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];s[0]=e();var a=Reflect[i];return a.apply(void 0,hl(s))}};return this.reflectMethods.forEach(n),t},r}();function Vu(r){return typeof r=="string"||typeof r=="symbol"}function Ibe(r){return typeof r=="object"&&"token"in r&&"multiple"in r}function uD(r){return typeof r=="object"&&"token"in r&&"transform"in r}function Cbe(r){return typeof r=="function"||r instanceof ej}function p2(r){return!!r.useToken}function g2(r){return r.useValue!=null}function kbe(r){return ZH(r)||g2(r)||p2(r)||Z7(r)}var SA=function(){function r(){this._registryMap=new Map}return r.prototype.entries=function(){return this._registryMap.entries()},r.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},r.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},r.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},r.prototype.setAll=function(e,t){this._registryMap.set(e,t)},r.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},r.prototype.clear=function(){this._registryMap.clear()},r.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},r}(),_be=function(r){EA(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(SA),bg=function(){function r(){this.scopedResolutions=new Map}return r}();function Tbe(r,e){if(r===null)return"at position #"+e;var t=r.split(",")[e].trim();return'"'+t+'" at position #'+e}function Pbe(r,e,t){return t===void 0&&(t="    "),hl([r],e.message.split(`
`).map(function(n){return t+n})).join(`
`)}function Dbe(r,e,t){var n=r3(r.toString().match(/constructor\(([\w, ]+)\)/)||[],2),i=n[1],s=i===void 0?null:i,o=Tbe(s,e);return Pbe("Cannot inject the dependency "+o+' of "'+r.name+'" constructor. Reason:',t)}function $be(r){if(typeof r.dispose!="function")return!1;var e=r.dispose;return!(e.length>0)}var Nbe=function(r){EA(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(SA),Obe=function(r){EA(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(SA),Mbe=function(){function r(){this.preResolution=new Nbe,this.postResolution=new Obe}return r}(),tj=new Map,Rbe=function(){function r(e){this.parent=e,this._registry=new _be,this.interceptors=new Mbe,this.disposed=!1,this.disposables=new Set}return r.prototype.register=function(e,t,n){n===void 0&&(n={lifecycle:bn.Transient}),this.ensureNotDisposed();var i;if(kbe(t)?i=t:i={useClass:t},p2(i))for(var s=[e],o=i;o!=null;){var a=o.useToken;if(s.includes(a))throw new Error("Token registration cycle detected! "+hl(s,[a]).join(" -> "));s.push(a);var c=this._registry.get(a);c&&p2(c.provider)?o=c.provider:o=null}if((n.lifecycle===bn.Singleton||n.lifecycle==bn.ContainerScoped||n.lifecycle==bn.ResolutionScoped)&&(g2(i)||Z7(i)))throw new Error('Cannot use lifecycle "'+bn[n.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:i,options:n}),this},r.prototype.registerType=function(e,t){return this.ensureNotDisposed(),Vu(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},r.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},r.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),Vu(e)){if(Vu(t))return this.register(e,{useToken:t},{lifecycle:bn.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:bn.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var n=e;return t&&!Vu(t)&&(n=t),this.register(e,{useClass:n},{lifecycle:bn.Singleton})},r.prototype.resolve=function(e,t,n){t===void 0&&(t=new bg),n===void 0&&(n=!1),this.ensureNotDisposed();var i=this.getRegistration(e);if(!i&&Vu(e)){if(n)return;throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"Single"),i){var s=this.resolveRegistration(i,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}if(Cbe(e)){var s=this.construct(e,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},r.prototype.executePreResolutionInterceptor=function(e,t){var n,i;if(this.interceptors.preResolution.has(e)){var s=[];try{for(var o=vg(this.interceptors.preResolution.getAll(e)),a=o.next();!a.done;a=o.next()){var c=a.value;c.options.frequency!="Once"&&s.push(c),c.callback(e,t)}}catch(l){n={error:l}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}this.interceptors.preResolution.setAll(e,s)}},r.prototype.executePostResolutionInterceptor=function(e,t,n){var i,s;if(this.interceptors.postResolution.has(e)){var o=[];try{for(var a=vg(this.interceptors.postResolution.getAll(e)),c=a.next();!c.done;c=a.next()){var l=c.value;l.options.frequency!="Once"&&o.push(l),l.callback(e,t,n)}}catch(d){i={error:d}}finally{try{c&&!c.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}this.interceptors.postResolution.setAll(e,o)}},r.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===bn.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var n=e.options.lifecycle===bn.Singleton,i=e.options.lifecycle===bn.ContainerScoped,s=n||i,o;return g2(e.provider)?o=e.provider.useValue:p2(e.provider)?o=s?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):ZH(e.provider)?o=s?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):Z7(e.provider)?o=e.provider.useFactory(this):o=this.construct(e.provider,t),e.options.lifecycle===bn.ResolutionScoped&&t.scopedResolutions.set(e,o),o},r.prototype.resolveAll=function(e,t,n){var i=this;t===void 0&&(t=new bg),n===void 0&&(n=!1),this.ensureNotDisposed();var s=this.getAllRegistrations(e);if(!s&&Vu(e)){if(n)return[];throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"All"),s){var o=s.map(function(c){return i.resolveRegistration(c,t)});return this.executePostResolutionInterceptor(e,o,"All"),o}var a=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,a,"All"),a},r.prototype.isRegistered=function(e,t){return t===void 0&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},r.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},r.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var n=vg(this._registry.entries()),i=n.next();!i.done;i=n.next()){var s=r3(i.value,2),o=s[0],a=s[1];this._registry.setAll(o,a.filter(function(c){return!g2(c.provider)}).map(function(c){return c.instance=void 0,c}))}}catch(c){e={error:c}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},r.prototype.createChildContainer=function(){var e,t;this.ensureNotDisposed();var n=new r(this);try{for(var i=vg(this._registry.entries()),s=i.next();!s.done;s=i.next()){var o=r3(s.value,2),a=o[0],c=o[1];c.some(function(l){var d=l.options;return d.lifecycle===bn.ContainerScoped})&&n._registry.setAll(a,c.map(function(l){return l.options.lifecycle===bn.ContainerScoped?{provider:l.provider,options:l.options}:l}))}}catch(l){e={error:l}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r.prototype.beforeResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:n})},r.prototype.afterResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:n})},r.prototype.dispose=function(){return Ebe(this,void 0,void 0,function(){var e;return Sbe(this,function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach(function(n){var i=n.dispose();i&&e.push(i)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},r.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},r.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},r.prototype.construct=function(e,t){var n=this;if(e instanceof ej)return e.createProxy(function(s){return n.resolve(s,t)});var i=function(){var s=tj.get(e);if(!s||s.length===0){if(e.length===0)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var o=s.map(n.resolveParams(t,e));return new(e.bind.apply(e,hl([void 0],o)))}();return $be(i)&&this.disposables.add(i),i},r.prototype.resolveParams=function(e,t){var n=this;return function(i,s){var o,a,c;try{return Ibe(i)?uD(i)?i.multiple?(o=n.resolve(i.transform)).transform.apply(o,hl([n.resolveAll(i.token,new bg,i.isOptional)],i.transformArgs)):(a=n.resolve(i.transform)).transform.apply(a,hl([n.resolve(i.token,e,i.isOptional)],i.transformArgs)):i.multiple?n.resolveAll(i.token,new bg,i.isOptional):n.resolve(i.token,e,i.isOptional):uD(i)?(c=n.resolve(i.transform,e)).transform.apply(c,hl([n.resolve(i.token,e)],i.transformArgs)):n.resolve(i,e)}catch(l){throw new Error(Dbe(t,s,l))}}},r.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},r}(),Dr=new Rbe;function P4(r){return function(e){tj.set(e,Abe(e))}}if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var e9;class D4{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}}D([M({type:H.ObjectIdentifier})],D4.prototype,"attrId",void 0);D([M({type:H.Any,repeated:"set"})],D4.prototype,"attrValues",void 0);let dD=e9=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,e9.prototype)}};dD=e9=D([oe({type:ne.Sequence,itemType:D4})],dD);var t9;let hD=t9=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,t9.prototype)}};hD=t9=D([oe({type:ne.Sequence,itemType:jh})],hD);class rj{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],rj.prototype,"certId",void 0);D([M({type:H.Any,context:0})],rj.prototype,"certValue",void 0);class nj{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],nj.prototype,"crlId",void 0);D([M({type:H.Any,context:0})],nj.prototype,"crltValue",void 0);class ij extends it{}let $4=class{constructor(e={}){this.encryptionAlgorithm=new Ee,this.encryptedData=new ij,Object.assign(this,e)}};D([M({type:Ee})],$4.prototype,"encryptionAlgorithm",void 0);D([M({type:ij})],$4.prototype,"encryptedData",void 0);var r9,n9;(function(r){r[r.v1=0]="v1"})(n9||(n9={}));class sj extends it{}let i9=r9=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,r9.prototype)}};i9=r9=D([oe({type:ne.Sequence,itemType:qo})],i9);class p0{constructor(e={}){this.version=n9.v1,this.privateKeyAlgorithm=new Ee,this.privateKey=new sj,Object.assign(this,e)}}D([M({type:H.Integer})],p0.prototype,"version",void 0);D([M({type:Ee})],p0.prototype,"privateKeyAlgorithm",void 0);D([M({type:sj})],p0.prototype,"privateKey",void 0);D([M({type:i9,implicit:!0,context:0,optional:!0})],p0.prototype,"attributes",void 0);let fD=class extends p0{};fD=D([oe({type:ne.Sequence})],fD);let pD=class extends $4{};pD=D([oe({type:ne.Sequence})],pD);class oj{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],oj.prototype,"secretTypeId",void 0);D([M({type:H.Any,context:0})],oj.prototype,"secretValue",void 0);class g0{constructor(e={}){this.mac=new _4,this.macSalt=new it,this.iterations=1,Object.assign(this,e)}}D([M({type:_4})],g0.prototype,"mac",void 0);D([M({type:it})],g0.prototype,"macSalt",void 0);D([M({type:H.Integer,defaultValue:1})],g0.prototype,"iterations",void 0);class N4{constructor(e={}){this.version=3,this.authSafe=new jh,this.macData=new g0,Object.assign(this,e)}}D([M({type:H.Integer})],N4.prototype,"version",void 0);D([M({type:jh})],N4.prototype,"authSafe",void 0);D([M({type:g0,optional:!0})],N4.prototype,"macData",void 0);var s9;class O4{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:H.ObjectIdentifier})],O4.prototype,"bagId",void 0);D([M({type:H.Any,context:0})],O4.prototype,"bagValue",void 0);D([M({type:D4,repeated:"set",optional:!0})],O4.prototype,"bagAttributes",void 0);let gD=s9=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,s9.prototype)}};gD=s9=D([oe({type:ne.Sequence,itemType:O4})],gD);var o9,a9,c9;const aj="1.2.840.113549.1.9",cj=`${aj}.7`,xA=`${aj}.14`;let n3=class extends Pr{constructor(e={}){super(e)}toString(){return this.ia5String||super.toString()}};D([M({type:H.IA5String})],n3.prototype,"ia5String",void 0);n3=D([oe({type:ne.Choice})],n3);let yD=class extends jh{};yD=D([oe({type:ne.Sequence})],yD);let mD=class extends N4{};mD=D([oe({type:ne.Sequence})],mD);let wD=class extends $4{};wD=D([oe({type:ne.Sequence})],wD);let l9=class{constructor(e=""){this.value=e}toString(){return this.value}};D([M({type:H.IA5String})],l9.prototype,"value",void 0);l9=D([oe({type:ne.Choice})],l9);let vD=class extends n3{};vD=D([oe({type:ne.Choice})],vD);let bD=class extends Pr{};bD=D([oe({type:ne.Choice})],bD);let u9=class{constructor(e=new Date){this.value=e}};D([M({type:H.GeneralizedTime})],u9.prototype,"value",void 0);u9=D([oe({type:ne.Choice})],u9);let ED=class extends Pr{};ED=D([oe({type:ne.Choice})],ED);let d9=class{constructor(e="M"){this.value=e}toString(){return this.value}};D([M({type:H.PrintableString})],d9.prototype,"value",void 0);d9=D([oe({type:ne.Choice})],d9);let i3=class{constructor(e=""){this.value=e}toString(){return this.value}};D([M({type:H.PrintableString})],i3.prototype,"value",void 0);i3=D([oe({type:ne.Choice})],i3);let SD=class extends i3{};SD=D([oe({type:ne.Choice})],SD);let xD=class extends Pr{};xD=D([oe({type:ne.Choice})],xD);let h9=class{constructor(e=""){this.value=e}toString(){return this.value}};D([M({type:H.ObjectIdentifier})],h9.prototype,"value",void 0);h9=D([oe({type:ne.Choice})],h9);let AD=class extends Ir{};AD=D([oe({type:ne.Choice})],AD);let f9=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};D([M({type:H.Integer})],f9.prototype,"value",void 0);f9=D([oe({type:ne.Choice})],f9);let ID=class extends eo{};ID=D([oe({type:ne.Sequence})],ID);let s3=class extends Pr{};s3=D([oe({type:ne.Choice})],s3);let CD=o9=class extends $c{constructor(e){super(e),Object.setPrototypeOf(this,o9.prototype)}};CD=o9=D([oe({type:ne.Sequence})],CD);let kD=a9=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,a9.prototype)}};kD=a9=D([oe({type:ne.Set,itemType:Hh})],kD);let p9=class{constructor(e=""){this.value=e}toString(){return this.value}};D([M({type:H.BmpString})],p9.prototype,"value",void 0);p9=D([oe({type:ne.Choice})],p9);let g9=class extends Ee{};g9=D([oe({type:ne.Sequence})],g9);let _D=c9=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,c9.prototype)}};_D=c9=D([oe({type:ne.Sequence,itemType:g9})],_D);var y9;let o3=y9=class extends mt{constructor(e){super(e),Object.setPrototypeOf(this,y9.prototype)}};o3=y9=D([oe({type:ne.Sequence,itemType:qo})],o3);class Gh{constructor(e={}){this.version=0,this.subject=new er,this.subjectPKInfo=new as,this.attributes=new o3,Object.assign(this,e)}}D([M({type:H.Integer})],Gh.prototype,"version",void 0);D([M({type:er})],Gh.prototype,"subject",void 0);D([M({type:as})],Gh.prototype,"subjectPKInfo",void 0);D([M({type:o3,implicit:!0,context:0})],Gh.prototype,"attributes",void 0);class gp{constructor(e={}){this.certificationRequestInfo=new Gh,this.signatureAlgorithm=new Ee,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}D([M({type:Gh})],gp.prototype,"certificationRequestInfo",void 0);D([M({type:Ee})],gp.prototype,"signatureAlgorithm",void 0);D([M({type:H.BitString})],gp.prototype,"signature",void 0);/*!
 * MIT License
 * 
 * Copyright (c) Peculiar Ventures. All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const y0="crypto.algorithm";class Lbe{getAlgorithms(){return Dr.resolveAll(y0)}toAsnAlgorithm(e){({...e});for(const t of this.getAlgorithms()){const n=t.toAsnAlgorithm(e);if(n)return n}if(/^[0-9.]+$/.test(e.name)){const t=new Ee({algorithm:e.name});if("parameters"in e){const n=e;t.parameters=n.parameters}return t}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(const n of this.getAlgorithms()){const i=n.toWebAlgorithm(e);if(i)return i}return{name:e.algorithm,parameters:e.parameters}}}const uu="crypto.algorithmProvider";Dr.registerSingleton(uu,Lbe);var y2;const Vn="1.3.36.3.3.2.8.1.1",TD=`${Vn}.1`,PD=`${Vn}.2`,DD=`${Vn}.3`,$D=`${Vn}.4`,ND=`${Vn}.5`,OD=`${Vn}.6`,MD=`${Vn}.7`,RD=`${Vn}.8`,LD=`${Vn}.9`,BD=`${Vn}.10`,UD=`${Vn}.11`,FD=`${Vn}.12`,zD=`${Vn}.13`,VD=`${Vn}.14`,KD="brainpoolP160r1",HD="brainpoolP160t1",jD="brainpoolP192r1",qD="brainpoolP192t1",WD="brainpoolP224r1",GD="brainpoolP224t1",QD="brainpoolP256r1",YD="brainpoolP256t1",XD="brainpoolP320r1",JD="brainpoolP320t1",ZD="brainpoolP384r1",e$="brainpoolP384t1",t$="brainpoolP512r1",r$="brainpoolP512t1",zt="ECDSA";let yp=y2=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case zt.toLowerCase():if("hash"in e)switch((typeof e.hash=="string"?e.hash:e.hash.name).toLowerCase()){case"sha-1":return abe;case"sha-256":return cbe;case"sha-384":return lbe;case"sha-512":return ube}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t=aD;break;case"K-256":t=y2.SECP256K1;break;case"P-384":t=cD;break;case"P-521":t=lD;break;case KD:t=TD;break;case HD:t=PD;break;case jD:t=DD;break;case qD:t=$D;break;case WD:t=ND;break;case GD:t=OD;break;case QD:t=MD;break;case YD:t=RD;break;case XD:t=LD;break;case JD:t=BD;break;case ZD:t=UD;break;case e$:t=FD;break;case t$:t=zD;break;case r$:t=VD;break}if(t)return new Ee({algorithm:fp,parameters:ge.serialize(new Oc({namedCurve:t}))})}}return null}toWebAlgorithm(e){switch(e.algorithm){case yA:return{name:zt,hash:{name:"SHA-1"}};case mA:return{name:zt,hash:{name:"SHA-256"}};case wA:return{name:zt,hash:{name:"SHA-384"}};case vA:return{name:zt,hash:{name:"SHA-512"}};case fp:{if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(ge.parse(e.parameters,Oc).namedCurve){case aD:return{name:zt,namedCurve:"P-256"};case y2.SECP256K1:return{name:zt,namedCurve:"K-256"};case cD:return{name:zt,namedCurve:"P-384"};case lD:return{name:zt,namedCurve:"P-521"};case TD:return{name:zt,namedCurve:KD};case PD:return{name:zt,namedCurve:HD};case DD:return{name:zt,namedCurve:jD};case $D:return{name:zt,namedCurve:qD};case ND:return{name:zt,namedCurve:WD};case OD:return{name:zt,namedCurve:GD};case MD:return{name:zt,namedCurve:QD};case RD:return{name:zt,namedCurve:YD};case LD:return{name:zt,namedCurve:XD};case BD:return{name:zt,namedCurve:JD};case UD:return{name:zt,namedCurve:ZD};case FD:return{name:zt,namedCurve:e$};case zD:return{name:zt,namedCurve:t$};case VD:return{name:zt,namedCurve:r$}}}}return null}};yp.SECP256K1="1.3.132.0.10";yp=y2=D([P4()],yp);Dr.registerSingleton(y0,yp);const lj=Symbol("name"),uj=Symbol("value");class ut{constructor(e,t={},n=""){this[lj]=e,this[uj]=n;for(const i in t)this[i]=t[i]}}ut.NAME=lj;ut.VALUE=uj;class Bbe{static toTextObject(e){const t=new ut("Algorithm Identifier",{},Hc.toString(e.algorithm));if(e.parameters)switch(e.algorithm){case fp:{const n=new yp().toWebAlgorithm(e);n&&"namedCurve"in n?t["Named Curve"]=n.namedCurve:t.Parameters=e.parameters;break}default:t.Parameters=e.parameters}return t}}class Hc{static toString(e){const t=this.items[e];return t||e}}Hc.items={[Jm]:"sha1",[YH]:"sha224",[Zm]:"sha256",[e3]:"sha384",[t3]:"sha512",[au]:"rsaEncryption",[Qm]:"sha1WithRSAEncryption",[ybe]:"sha224WithRSAEncryption",[G7]:"sha256WithRSAEncryption",[Ym]:"sha384WithRSAEncryption",[Xm]:"sha512WithRSAEncryption",[fp]:"ecPublicKey",[yA]:"ecdsaWithSHA1",[WH]:"ecdsaWithSHA224",[mA]:"ecdsaWithSHA256",[wA]:"ecdsaWithSHA384",[vA]:"ecdsaWithSHA512",[ebe]:"TLS WWW server authentication",[tbe]:"TLS WWW client authentication",[rbe]:"Code Signing",[nbe]:"E-mail Protection",[ibe]:"Time Stamping",[sbe]:"OCSP Signing",[obe]:"Signed Data"};class du{static serialize(e){return this.serializeObj(e).join(`
`)}static pad(e=0){return"".padStart(2*e," ")}static serializeObj(e,t=0){const n=[];let i=this.pad(t++),s="";const o=e[ut.VALUE];o&&(s=` ${o}`),n.push(`${i}${e[ut.NAME]}:${s}`),i=this.pad(t);for(const a in e){if(typeof a=="symbol")continue;const c=e[a],l=a?`${a}: `:"";if(typeof c=="string"||typeof c=="number"||typeof c=="boolean")n.push(`${i}${l}${c}`);else if(c instanceof Date)n.push(`${i}${l}${c.toUTCString()}`);else if(Array.isArray(c))for(const d of c)d[ut.NAME]=a,n.push(...this.serializeObj(d,t));else if(c instanceof ut)c[ut.NAME]=a,n.push(...this.serializeObj(c,t));else if(me.isBufferSource(c))a?(n.push(`${i}${l}`),n.push(...this.serializeBufferSource(c,t+1))):n.push(...this.serializeBufferSource(c,t));else if("toTextObject"in c){const d=c.toTextObject();d[ut.NAME]=a,n.push(...this.serializeObj(d,t))}else throw new TypeError("Cannot serialize data in text format. Unsupported type.")}return n}static serializeBufferSource(e,t=0){const n=this.pad(t),i=me.toUint8Array(e),s=[];for(let o=0;o<i.length;){const a=[];for(let c=0;c<16&&o<i.length;c++){c===8&&a.push("");const l=i[o++].toString(16).padStart(2,"0");a.push(l)}s.push(`${n}${a.join(" ")}`)}return s}static serializeAlgorithm(e){return this.algorithmSerializer.toTextObject(e)}}du.oidSerializer=Hc;du.algorithmSerializer=Bbe;class jc{constructor(...e){if(e.length===1){const t=e[0];this.rawData=ge.serialize(t),this.onInit(t)}else{const t=ge.parse(e[0],e[1]);this.rawData=me.toArrayBuffer(e[0]),this.onInit(t)}}equal(e){return e instanceof jc?xK(e.rawData,this.rawData):!1}toString(e="text"){switch(e){case"asn":return ge.toString(this.rawData);case"text":return du.serialize(this.toTextObject());case"hex":return Ce.ToHex(this.rawData);case"base64":return Ce.ToBase64(this.rawData);case"base64url":return Ce.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){const e=this.toTextObjectEmpty();return e[""]=this.rawData,e}toTextObjectEmpty(e){return new ut(this.getTextName(),{},e)}}jc.NAME="ASN";class Vi extends jc{constructor(...e){let t;me.isBufferSource(e[0])?t=me.toArrayBuffer(e[0]):t=ge.serialize(new Bi({extnID:e[0],critical:e[1],extnValue:new it(me.toArrayBuffer(e[2]))})),super(t,Bi)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[ut.NAME]===Vi.NAME&&(e[ut.NAME]=Hc.toString(this.type)),e}}var dj;class Za{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&e.extractable!==void 0}constructor(){this.items=new Map,this[dj]="CryptoProvider",typeof self<"u"&&typeof crypto<"u"?this.set(Za.DEFAULT,crypto):typeof global<"u"&&global.crypto&&global.crypto.subtle&&this.set(Za.DEFAULT,global.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,t){return this.items.forEach(e,t)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=Za.DEFAULT){const t=this.items.get(e.toLowerCase());if(!t)throw new Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if(typeof e=="string"){if(!t)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),t)}else this.items.set(Za.DEFAULT,e);return this}}dj=Symbol.toStringTag;Za.DEFAULT="default";const xr=new Za,Ube=/^[0-2](?:\.[1-9][0-9]*)+$/;function Fbe(r){return new RegExp(Ube).test(r)}class hj{constructor(e={}){this.items={};for(const t in e)this.register(t,e[t])}get(e){return this.items[e]||null}findId(e){return Fbe(e)?e:this.get(e)}register(e,t){this.items[e]=t,this.items[t]=e}}const Fn=new hj;Fn.register("CN","2.5.4.3");Fn.register("L","2.5.4.7");Fn.register("ST","2.5.4.8");Fn.register("O","2.5.4.10");Fn.register("OU","2.5.4.11");Fn.register("C","2.5.4.6");Fn.register("DC","0.9.2342.19200300.100.1.25");Fn.register("E","1.2.840.113549.1.9.1");Fn.register("G","2.5.4.42");Fn.register("I","2.5.4.43");Fn.register("SN","2.5.4.4");Fn.register("T","2.5.4.12");function zbe(r,e){return`\\${Ce.ToHex(Ce.FromUtf8String(e)).toUpperCase()}`}function Vbe(r){return r.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,zbe)}class Di{static isASCII(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!1;return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,t={}){this.extraNames=new hj,this.asn=new er;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const i=t[n];this.extraNames.register(n,i)}typeof e=="string"?this.asn=this.fromString(e):e instanceof er?this.asn=e:me.isBufferSource(e)?this.asn=ge.parse(e,er):this.asn=this.fromJSON(e)}getField(e){const t=this.extraNames.findId(e)||Fn.findId(e),n=[];for(const i of this.asn)for(const s of i)s.type===t&&n.push(s.value.toString());return n}getName(e){return this.extraNames.get(e)||Fn.get(e)}toString(){return this.asn.map(e=>e.map(t=>{const n=this.getName(t.type)||t.type,i=t.value.anyValue?`#${Ce.ToHex(t.value.anyValue)}`:Vbe(t.value.toString());return`${n}=${i}`}).join("+")).join(", ")}toJSON(){var e;const t=[];for(const n of this.asn){const i={};for(const s of n){const o=this.getName(s.type)||s.type;(e=i[o])!==null&&e!==void 0||(i[o]=[]),i[o].push(s.value.anyValue?`#${Ce.ToHex(s.value.anyValue)}`:s.value.toString())}t.push(i)}return t}fromString(e){const t=new er,n=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g;let i=null,s=",";for(;i=n.exec(`${e},`);){let[,o,a]=i;const c=a[a.length-1];(c===","||c==="+")&&(a=a.slice(0,a.length-1),i[3]=c);const l=i[3];o=this.getTypeOid(o);const d=this.createAttribute(o,a);s==="+"?t[t.length-1].push(d):t.push(new ph([d])),s=l}return t}fromJSON(e){const t=new er;for(const n of e){const i=new ph;for(const s in n){const o=this.getTypeOid(s),a=n[s];for(const c of a){const l=this.createAttribute(o,c);i.push(l)}}t.push(i)}return t}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,t){const n=new u4({type:e});if(typeof t=="object")for(const i in t)switch(i){case"ia5String":n.value.ia5String=t[i];break;case"utf8String":n.value.utf8String=t[i];break;case"universalString":n.value.universalString=t[i];break;case"bmpString":n.value.bmpString=t[i];break;case"printableString":n.value.printableString=t[i];break}else if(t[0]==="#")n.value.anyValue=Ce.FromHex(t.slice(1));else{const i=this.processStringValue(t);e===this.getName("E")||e===this.getName("DC")?n.value.ia5String=i:Di.isPrintableString(i)?n.value.printableString=i:n.value.utf8String=i}return n}processStringValue(e){const t=/"(.*?[^\\])?"/.exec(e);return t&&(e=t[1]),e.replace(/\\0a/ig,`
`).replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return ge.serialize(this.asn)}async getThumbprint(...e){var t;let n,i="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(i=e[0]||i,n=e[1]||xr.get()):n=e[0]||xr.get(),await n.subtle.digest(i,this.toArrayBuffer())}}const fj="Cannot initialize GeneralName from ASN.1 data.",n$=`${fj} Unsupported string format in use.`,Kbe=`${fj} Value doesn't match to GUID regular expression.`,i$=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,s$="1.3.6.1.4.1.311.25.1",o$="1.3.6.1.4.1.311.20.2.3",_6="dns",T6="dn",P6="email",D6="ip",$6="url",N6="guid",O6="upn",Eg="id";class ec extends jc{constructor(...e){let t;if(e.length===2)switch(e[0]){case T6:{const n=new Di(e[1]).toArrayBuffer(),i=ge.parse(n,er);t=new Ke({directoryName:i});break}case _6:t=new Ke({dNSName:e[1]});break;case P6:t=new Ke({rfc822Name:e[1]});break;case N6:{const n=new RegExp(i$,"i").exec(e[1]);if(!n)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");const i=n.slice(1).map((s,o)=>o<3?Ce.ToHex(new Uint8Array(Ce.FromHex(s)).reverse()):s).join("");t=new Ke({otherName:new lp({typeId:s$,value:ge.serialize(new it(Ce.FromHex(i)))})});break}case D6:t=new Ke({iPAddress:e[1]});break;case Eg:t=new Ke({registeredID:e[1]});break;case O6:{t=new Ke({otherName:new lp({typeId:o$,value:ge.serialize(PH.toASN(e[1]))})});break}case $6:t=new Ke({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else me.isBufferSource(e[0])?t=ge.parse(e[0],Ke):t=e[0];super(t)}onInit(e){if(e.dNSName!=null)this.type=_6,this.value=e.dNSName;else if(e.rfc822Name!=null)this.type=P6,this.value=e.rfc822Name;else if(e.iPAddress!=null)this.type=D6,this.value=e.iPAddress;else if(e.uniformResourceIdentifier!=null)this.type=$6,this.value=e.uniformResourceIdentifier;else if(e.registeredID!=null)this.type=Eg,this.value=e.registeredID;else if(e.directoryName!=null)this.type=T6,this.value=new Di(e.directoryName).toString();else if(e.otherName!=null)if(e.otherName.typeId===s$){this.type=N6;const t=ge.parse(e.otherName.value,it),n=new RegExp(i$,"i").exec(Ce.ToHex(t));if(!n)throw new Error(Kbe);this.value=n.slice(1).map((i,s)=>s<3?Ce.ToHex(new Uint8Array(Ce.FromHex(i)).reverse()):i).join("-")}else if(e.otherName.typeId===o$)this.type=O6,this.value=ge.parse(e.otherName.value,Pr).toString();else throw new Error(n$);else throw new Error(n$)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case T6:case _6:case N6:case D6:case Eg:case O6:case $6:e=this.type.toUpperCase();break;case P6:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let t=this.value;return this.type===Eg&&(t=Hc.toString(t)),new ut(e,void 0,t)}}class mp extends jc{constructor(e){let t;if(e instanceof pn)t=e;else if(Array.isArray(e)){const n=[];for(const i of e)if(i instanceof Ke)n.push(i);else{const s=ge.parse(new ec(i.type,i.value).rawData,Ke);n.push(s)}t=new pn(n)}else if(me.isBufferSource(e))t=ge.parse(e,pn);else throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(t)}onInit(e){const t=[];for(const n of e){let i=null;try{i=new ec(n)}catch{continue}t.push(i)}this.items=t}toJSON(){return this.items.map(e=>e.toJSON())}toTextObject(){const e=super.toTextObjectEmpty();for(const t of this.items){const n=t.toTextObject();let i=e[n[ut.NAME]];Array.isArray(i)||(i=[],e[n[ut.NAME]]=i),i.push(n)}return e}}mp.NAME="GeneralNames";const m1="-{5}",wp="\\n",Hbe=`[^${wp}]+`,jbe=`${m1}BEGIN (${Hbe}(?=${m1}))${m1}`,qbe=`${m1}END \\1${m1}`,Sh="\\n",Wbe=`[^:${wp}]+`,Gbe=`(?:[^${wp}]+${Sh}(?: +[^${wp}]+${Sh})*)`,Qbe="[a-zA-Z0-9=+/]+",Ybe=`(?:${Qbe}${Sh})+`,a$=`${jbe}${Sh}(?:((?:${Wbe}: ${Gbe})+))?${Sh}?(${Ybe})${qbe}`;class ei{static isPem(e){return typeof e=="string"&&new RegExp(a$,"g").test(e)}static decodeWithHeaders(e){e=e.replace(/\r/g,"");const t=new RegExp(a$,"g"),n=[];let i=null;for(;i=t.exec(e);){const s=i[3].replace(new RegExp(`[${wp}]+`,"g"),""),o={type:i[1],headers:[],rawData:Ce.FromBase64(s)},a=i[2];if(a){const c=a.split(new RegExp(Sh,"g"));let l=null;for(const d of c){const[h,p]=d.split(/:(.*)/);if(p===void 0){if(!l)throw new Error("Cannot parse PEM string. Incorrect header value");l.value+=h.trim()}else l&&o.headers.push(l),l={key:h,value:p.trim()}}l&&o.headers.push(l)}n.push(o)}return n}static decode(e){return this.decodeWithHeaders(e).map(n=>n.rawData)}static decodeFirst(e){const t=this.decode(e);if(!t.length)throw new RangeError("PEM string doesn't contain any objects");return t[0]}static encode(e,t){if(Array.isArray(e)){const n=new Array;return t?e.forEach(i=>{if(!me.isBufferSource(i))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");n.push(this.encodeStruct({type:t,rawData:me.toArrayBuffer(i)}))}):e.forEach(i=>{if(!("type"in i))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");n.push(this.encodeStruct(i))}),n.join(`
`)}else{if(!t)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:t,rawData:me.toArrayBuffer(e)})}}static encodeStruct(e){var t;const n=e.type.toLocaleUpperCase(),i=[];if(i.push(`-----BEGIN ${n}-----`),!((t=e.headers)===null||t===void 0)&&t.length){for(const l of e.headers)i.push(`${l.key}: ${l.value}`);i.push("")}const s=Ce.ToBase64(e.rawData);let o,a=0;const c=Array();for(;a<s.length&&(s.length-a<64?o=s.substring(a):(o=s.substring(a,a+64),a+=64),o.length!==0);)if(c.push(o),o.length<64)break;return i.push(...c),i.push(`-----END ${n}-----`),i.join(`
`)}}ei.CertificateTag="CERTIFICATE";ei.CrlTag="CRL";ei.CertificateRequestTag="CERTIFICATE REQUEST";ei.PublicKeyTag="PUBLIC KEY";ei.PrivateKeyTag="PRIVATE KEY";class Qo extends jc{static isAsnEncoded(e){return me.isBufferSource(e)||typeof e=="string"}static toArrayBuffer(e){if(typeof e=="string"){if(ei.isPem(e))return ei.decode(e)[0];if(Ce.isHex(e))return Ce.FromHex(e);if(Ce.isBase64(e))return Ce.FromBase64(e);if(Ce.isBase64Url(e))return Ce.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}else{const t=Ce.ToBinary(e);return ei.isPem(t)?ei.decode(t)[0]:Ce.isHex(t)?Ce.FromHex(t):Ce.isBase64(t)?Ce.FromBase64(t):Ce.isBase64Url(t)?Ce.FromBase64Url(t):me.toArrayBuffer(e)}}constructor(...e){Qo.isAsnEncoded(e[0])?super(Qo.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){switch(e){case"pem":return ei.encode(this.rawData,this.tag);default:return super.toString(e)}}}class hs extends Qo{static async create(e,t=xr.get()){if(e instanceof hs)return e;if(Za.isCryptoKey(e)){if(e.type!=="public")throw new TypeError("Public key is required");const n=await t.subtle.exportKey("spki",e);return new hs(n)}else{if(e.publicKey)return e.publicKey;if(me.isBufferSource(e))return new hs(e);throw new TypeError("Unsupported PublicKeyType")}}constructor(e){Qo.isAsnEncoded(e)?super(e,as):super(e),this.tag=ei.PublicKeyTag}async export(...e){let t,n=["verify"],i={hash:"SHA-256",...this.algorithm};e.length>1?(i=e[0]||i,n=e[1]||n,t=e[2]||xr.get()):t=e[0]||xr.get();let s=this.rawData;const o=ge.parse(this.rawData,as);return o.algorithm.algorithm===y1&&(s=Xbe(o,s)),t.subtle.importKey("spki",s,i,!0,n)}onInit(e){const t=Dr.resolve(uu),n=this.algorithm=t.toWebAlgorithm(e.algorithm);switch(e.algorithm.algorithm){case au:{const i=ge.parse(e.subjectPublicKey,bA),s=me.toUint8Array(i.modulus);n.publicExponent=me.toUint8Array(i.publicExponent),n.modulusLength=(s[0]?s:s.slice(1)).byteLength<<3;break}}}async getThumbprint(...e){var t;let n,i="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(i=e[0]||i,n=e[1]||xr.get()):n=e[0]||xr.get(),await n.subtle.digest(i,this.rawData)}async getKeyIdentifier(...e){let t,n="SHA-1";e.length===1?typeof e[0]=="string"?(n=e[0],t=xr.get()):t=e[0]:e.length===2?(n=e[0],t=e[1]):t=xr.get();const i=ge.parse(this.rawData,as);return await t.subtle.digest(n,i.subjectPublicKey)}toTextObject(){const e=this.toTextObjectEmpty(),t=ge.parse(this.rawData,as);switch(e.Algorithm=du.serializeAlgorithm(t.algorithm),t.algorithm.algorithm){case fp:e["EC Point"]=t.subjectPublicKey;break;case au:default:e["Raw Data"]=t.subjectPublicKey}return e}}function Xbe(r,e){return r.algorithm=new Ee({algorithm:au,parameters:null}),e=ge.serialize(r),e}class vp extends Vi{static async create(e,t=!1,n=xr.get()){if("name"in e&&"serialNumber"in e)return new vp(e,t);const s=await(await hs.create(e,n)).getKeyIdentifier(n);return new vp(Ce.ToHex(s),t)}constructor(...e){if(me.isBufferSource(e[0]))super(e[0]);else if(typeof e[0]=="string"){const t=new El({keyIdentifier:new tA(Ce.FromHex(e[0]))});super(h7,e[1],ge.serialize(t))}else{const t=e[0],n=t.name instanceof mp?ge.parse(t.name.rawData,pn):t.name,i=new El({authorityCertIssuer:n,authorityCertSerialNumber:Ce.FromHex(t.serialNumber)});super(h7,e[1],ge.serialize(i))}}onInit(e){super.onInit(e);const t=ge.parse(e.extnValue,El);t.keyIdentifier&&(this.keyId=Ce.ToHex(t.keyIdentifier)),(t.authorityCertIssuer||t.authorityCertSerialNumber)&&(this.certId={name:t.authorityCertIssuer||[],serialNumber:t.authorityCertSerialNumber?Ce.ToHex(t.authorityCertSerialNumber):""})}toTextObject(){const e=this.toTextObjectWithoutValue(),t=ge.parse(this.value,El);return t.authorityCertIssuer&&(e["Authority Issuer"]=new mp(t.authorityCertIssuer).toTextObject()),t.authorityCertSerialNumber&&(e["Authority Serial Number"]=t.authorityCertSerialNumber),t.keyIdentifier&&(e[""]=t.keyIdentifier),e}}vp.NAME="Authority Key Identifier";class AA extends Vi{constructor(...e){if(me.isBufferSource(e[0])){super(e[0]);const t=ge.parse(this.value,Dm);this.ca=t.cA,this.pathLength=t.pathLenConstraint}else{const t=new Dm({cA:e[0],pathLenConstraint:e[1]});super($H,e[2],ge.serialize(t)),this.ca=e[0],this.pathLength=e[1]}}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ca&&(e.CA=this.ca),this.pathLength!==void 0&&(e["Path Length"]=this.pathLength),e}}AA.NAME="Basic Constraints";var c$;(function(r){r.serverAuth="1.3.6.1.5.5.7.3.1",r.clientAuth="1.3.6.1.5.5.7.3.2",r.codeSigning="1.3.6.1.5.5.7.3.3",r.emailProtection="1.3.6.1.5.5.7.3.4",r.timeStamping="1.3.6.1.5.5.7.3.8",r.ocspSigning="1.3.6.1.5.5.7.3.9"})(c$||(c$={}));class pj extends Vi{constructor(...e){if(me.isBufferSource(e[0])){super(e[0]);const t=ge.parse(this.value,Mm);this.usages=t.map(n=>n)}else{const t=new Mm(e[0]);super(MH,e[1],ge.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.usages.map(t=>Hc.toString(t)).join(", "),e}}pj.NAME="Extended Key Usages";var l$;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(l$||(l$={}));class gj extends Vi{constructor(...e){if(me.isBufferSource(e[0])){super(e[0]);const t=ge.parse(this.value,k6);this.usages=t.toNumber()}else{const t=new k6(e[0]);super(RH,e[1],ge.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=ge.parse(this.value,k6);return e[""]=t.toJSON().join(", "),e}}gj.NAME="Key Usages";class M4 extends Vi{static async create(e,t=!1,n=xr.get()){const s=await(await hs.create(e,n)).getKeyIdentifier(n);return new M4(Ce.ToHex(s),t)}constructor(...e){if(me.isBufferSource(e[0])){super(e[0]);const t=ge.parse(this.value,yc);this.keyId=Ce.ToHex(t)}else{const t=typeof e[0]=="string"?Ce.FromHex(e[0]):e[0],n=new yc(t);super(FH,e[1],ge.serialize(n)),this.keyId=Ce.ToHex(t)}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=ge.parse(this.value,yc);return e[""]=t,e}}M4.NAME="Subject Key Identifier";class yj extends Vi{constructor(...e){me.isBufferSource(e[0])?super(e[0]):super(UH,e[1],new mp(e[0]||[]).rawData)}onInit(e){super.onInit(e);const t=ge.parse(e.extnValue,k7);this.names=new mp(t)}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.names.toTextObject();for(const n in t)e[n]=t[n];return e}}yj.NAME="Subject Alternative Name";class Ki{static register(e,t){this.items.set(e,t)}static create(e){const t=new Vi(e),n=this.items.get(t.type);return n?new n(e):t}}Ki.items=new Map;class mj extends Vi{constructor(...e){var t;if(me.isBufferSource(e[0])){super(e[0]);const n=ge.parse(this.value,Nm);this.policies=n.map(i=>i.policyIdentifier)}else{const n=e[0],i=(t=e[1])!==null&&t!==void 0?t:!1,s=new Nm(n.map(o=>new h4({policyIdentifier:o})));super(NH,i,ge.serialize(s)),this.policies=n}}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Policy=this.policies.map(t=>new ut("",{},Hc.toString(t))),e}}mj.NAME="Certificate Policies";Ki.register(NH,mj);class wj extends Vi{constructor(...e){var t;if(me.isBufferSource(e[0]))super(e[0]);else if(Array.isArray(e[0])&&typeof e[0][0]=="string"){const i=e[0].map(o=>new Vh({distributionPoint:new nu({fullName:[new Ke({uniformResourceIdentifier:o})]})})),s=new Sd(i);super(m7,e[1],ge.serialize(s))}else{const n=new Sd(e[0]);super(m7,e[1],ge.serialize(n))}(t=this.distributionPoints)!==null&&t!==void 0||(this.distributionPoints=[])}onInit(e){super.onInit(e);const t=ge.parse(e.extnValue,Sd);this.distributionPoints=t}toTextObject(){const e=this.toTextObjectWithoutValue();return e["Distribution Point"]=this.distributionPoints.map(t=>{var n;const i={};return t.distributionPoint&&(i[""]=(n=t.distributionPoint.fullName)===null||n===void 0?void 0:n.map(s=>new ec(s).toString()).join(", ")),t.reasons&&(i.Reasons=t.reasons.toString()),t.cRLIssuer&&(i["CRL Issuer"]=t.cRLIssuer.map(s=>s.toString()).join(", ")),i}),e}}wj.NAME="CRL Distribution Points";class vj extends Vi{constructor(...e){var t,n,i,s;if(me.isBufferSource(e[0]))super(e[0]);else if(e[0]instanceof nd){const o=new nd(e[0]);super(d7,e[1],ge.serialize(o))}else{const o=e[0],a=new nd;xg(a,o,qP,"ocsp"),xg(a,o,WP,"caIssuers"),xg(a,o,GP,"timeStamping"),xg(a,o,QP,"caRepository"),super(d7,e[1],ge.serialize(a))}(t=this.ocsp)!==null&&t!==void 0||(this.ocsp=[]),(n=this.caIssuers)!==null&&n!==void 0||(this.caIssuers=[]),(i=this.timeStamping)!==null&&i!==void 0||(this.timeStamping=[]),(s=this.caRepository)!==null&&s!==void 0||(this.caRepository=[])}onInit(e){super.onInit(e),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],ge.parse(e.extnValue,nd).forEach(n=>{switch(n.accessMethod){case qP:this.ocsp.push(new ec(n.accessLocation));break;case WP:this.caIssuers.push(new ec(n.accessLocation));break;case GP:this.timeStamping.push(new ec(n.accessLocation));break;case QP:this.caRepository.push(new ec(n.accessLocation));break}})}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ocsp.length&&Sg(e,"OCSP",this.ocsp),this.caIssuers.length&&Sg(e,"CA Issuers",this.caIssuers),this.timeStamping.length&&Sg(e,"Time Stamping",this.timeStamping),this.caRepository.length&&Sg(e,"CA Repository",this.caRepository),e}}vj.NAME="Authority Info Access";function Sg(r,e,t){if(t.length===1)r[e]=t[0].toTextObject();else{const n=new ut("");t.forEach((i,s)=>{const o=i.toTextObject(),a=`${o[ut.NAME]} ${s+1}`;let c=n[a];Array.isArray(c)||(c=[],n[a]=c),c.push(o)}),r[e]=n}}function xg(r,e,t,n){const i=e[n];i&&(Array.isArray(i)?i:[i]).forEach(o=>{typeof o=="string"&&(o=new ec("url",o)),r.push(new i0({accessMethod:t,accessLocation:ge.parse(o.rawData,Ke)}))})}class Qh extends jc{constructor(...e){let t;if(me.isBufferSource(e[0]))t=me.toArrayBuffer(e[0]);else{const n=e[0],i=Array.isArray(e[1])?e[1].map(s=>me.toArrayBuffer(s)):[];t=ge.serialize(new qo({type:n,values:i}))}super(t,qo)}onInit(e){this.type=e.type,this.values=e.values}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Value=this.values.map(t=>new ut("",{"":t})),e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty();return e[ut.NAME]===Qh.NAME&&(e[ut.NAME]=Hc.toString(this.type)),e}}Qh.NAME="Attribute";class bj extends Qh{constructor(...e){var t;if(me.isBufferSource(e[0]))super(e[0]);else{const n=new s3({printableString:e[0]});super(cj,[ge.serialize(n)])}(t=this.password)!==null&&t!==void 0||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){const t=ge.parse(this.values[0],s3);this.password=t.toString()}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[ut.VALUE]=this.password,e}}bj.NAME="Challenge Password";class IA extends Qh{constructor(...e){var t;if(me.isBufferSource(e[0]))super(e[0]);else{const n=e[0],i=new $c;for(const s of n)i.push(ge.parse(s.rawData,Bi));super(xA,[ge.serialize(i)])}(t=this.items)!==null&&t!==void 0||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){const t=ge.parse(this.values[0],$c);this.items=t.map(n=>Ki.create(ge.serialize(n)))}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.items.map(n=>n.toTextObject());for(const n of t)e[n[ut.NAME]]=n;return e}}IA.NAME="Extensions";class R4{static register(e,t){this.items.set(e,t)}static create(e){const t=new Qh(e),n=this.items.get(t.type);return n?new n(e):t}}R4.items=new Map;const m0="crypto.signatureFormatter";class Jbe{toAsnSignature(e,t){return me.toArrayBuffer(t)}toWebSignature(e,t){return me.toArrayBuffer(t)}}var m2;let m9=m2=class{static createPssParams(e,t){const n=m2.getHashAlgorithm(e);return n?new lu({hashAlgorithm:n,maskGenAlgorithm:new Ee({algorithm:C4,parameters:ge.serialize(n)}),saltLength:t}):null}static getHashAlgorithm(e){const t=Dr.resolve(uu);return typeof e=="string"?t.toAsnAlgorithm({name:e}):typeof e=="object"&&e&&"name"in e?t.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if("hash"in e){let t;if(typeof e.hash=="string")t=e.hash;else if(e.hash&&typeof e.hash=="object"&&"name"in e.hash&&typeof e.hash.name=="string")t=e.hash.name.toUpperCase();else throw new Error("Cannot get hash algorithm name");switch(t.toLowerCase()){case"sha-1":return new Ee({algorithm:Qm,parameters:null});case"sha-256":return new Ee({algorithm:G7,parameters:null});case"sha-384":return new Ee({algorithm:Ym,parameters:null});case"sha-512":return new Ee({algorithm:Xm,parameters:null})}}else return new Ee({algorithm:au,parameters:null});break;case"rsa-pss":if("hash"in e){if(!("saltLength"in e&&typeof e.saltLength=="number"))throw new Error("Cannot get 'saltLength' from 'alg' argument");const t=m2.createPssParams(e.hash,e.saltLength);if(!t)throw new Error("Cannot create PSS parameters");return new Ee({algorithm:y1,parameters:ge.serialize(t)})}else return new Ee({algorithm:y1,parameters:null})}return null}toWebAlgorithm(e){switch(e.algorithm){case au:return{name:"RSASSA-PKCS1-v1_5"};case Qm:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case G7:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case Ym:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case Xm:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case y1:if(e.parameters){const t=ge.parse(e.parameters,lu);return{name:"RSA-PSS",hash:Dr.resolve(uu).toWebAlgorithm(t.hashAlgorithm),saltLength:t.saltLength}}else return{name:"RSA-PSS"}}return null}};m9=m2=D([P4()],m9);Dr.registerSingleton(y0,m9);let w9=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new Ee({algorithm:Jm});case"sha-256":return new Ee({algorithm:Zm});case"sha-384":return new Ee({algorithm:e3});case"sha-512":return new Ee({algorithm:t3})}return null}toWebAlgorithm(e){switch(e.algorithm){case Jm:return{name:"SHA-1"};case Zm:return{name:"SHA-256"};case e3:return{name:"SHA-384"};case t3:return{name:"SHA-512"}}return null}};w9=D([P4()],w9);Dr.registerSingleton(y0,w9);class $i{addPadding(e,t){const n=me.toUint8Array(t),i=new Uint8Array(e);return i.set(n,e-n.length),i}removePadding(e,t=!1){let n=me.toUint8Array(e);for(let i=0;i<n.length;i++)if(n[i]){n=n.slice(i);break}if(t&&n[0]>127){const i=new Uint8Array(n.length+1);return i.set(n,1),i.buffer}return n.buffer}toAsnSignature(e,t){if(e.name==="ECDSA"){const n=e.namedCurve,i=$i.namedCurveSize.get(n)||$i.defaultNamedCurveSize,s=new Gm,o=me.toUint8Array(t);return s.r=this.removePadding(o.slice(0,i),!0),s.s=this.removePadding(o.slice(i,i+i),!0),ge.serialize(s)}return null}toWebSignature(e,t){if(e.name==="ECDSA"){const n=ge.parse(t,Gm),i=e.namedCurve,s=$i.namedCurveSize.get(i)||$i.defaultNamedCurveSize,o=this.addPadding(s,this.removePadding(n.r)),a=this.addPadding(s,this.removePadding(n.s));return F6e(o,a)}return null}}$i.namedCurveSize=new Map;$i.defaultNamedCurveSize=32;const M6="1.3.101.110",u$="1.3.101.111",R6="1.3.101.112",d$="1.3.101.113";let v9=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"ed25519":t=R6;break;case"x25519":t=M6;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t=R6;break;case"ed448":t=d$;break}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t=M6;break;case"x448":t=u$;break}}return t?new Ee({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case R6:return{name:"Ed25519"};case d$:return{name:"EdDSA",namedCurve:"Ed448"};case M6:return{name:"X25519"};case u$:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};v9=D([P4()],v9);Dr.registerSingleton(y0,v9);class Zbe extends Qo{constructor(e){Qo.isAsnEncoded(e)?super(e,gp):super(e),this.tag=ei.CertificateRequestTag}onInit(e){this.tbs=ge.serialize(e.certificationRequestInfo),this.publicKey=new hs(e.certificationRequestInfo.subjectPKInfo);const t=Dr.resolve(uu);this.signatureAlgorithm=t.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signature,this.attributes=e.certificationRequestInfo.attributes.map(i=>R4.create(ge.serialize(i)));const n=this.getAttribute(xA);this.extensions=[],n instanceof IA&&(this.extensions=n.items),this.subjectName=new Di(e.certificationRequestInfo.subject),this.subject=this.subjectName.toString()}getAttribute(e){for(const t of this.attributes)if(t.type===e)return t;return null}getAttributes(e){return this.attributes.filter(t=>t.type===e)}getExtension(e){for(const t of this.extensions)if(t.type===e)return t;return null}getExtensions(e){return this.extensions.filter(t=>t.type===e)}async verify(e=xr.get()){const t={...this.publicKey.algorithm,...this.signatureAlgorithm},n=await this.publicKey.export(t,["verify"],e),i=Dr.resolveAll(m0).reverse();let s=null;for(const a of i)if(s=a.toWebSignature(t,this.signature),s)break;if(!s)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await e.subtle.verify(this.signatureAlgorithm,n,s,this.tbs)}toTextObject(){const e=this.toTextObjectEmpty(),t=ge.parse(this.rawData,gp),n=t.certificationRequestInfo,i=new ut("",{Version:`${iu[n.version]} (${n.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){const s=new ut("");for(const o of this.attributes){const a=o.toTextObject();s[a[ut.NAME]]=a}i.Attributes=s}return e.Data=i,e.Signature=new ut("",{Algorithm:du.serializeAlgorithm(t.signatureAlgorithm),"":t.signature}),e}}Zbe.NAME="PKCS#10 Certificate Request";class CA extends Qo{constructor(e){Qo.isAsnEncoded(e)?super(e,su):super(e),this.tag=ei.CertificateTag}onInit(e){const t=e.tbsCertificate;this.tbs=ge.serialize(t),this.serialNumber=Ce.ToHex(t.serialNumber),this.subjectName=new Di(t.subject),this.subject=new Di(t.subject).toString(),this.issuerName=new Di(t.issuer),this.issuer=this.issuerName.toString();const n=Dr.resolve(uu);this.signatureAlgorithm=n.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signatureValue;const i=t.validity.notBefore.utcTime||t.validity.notBefore.generalTime;if(!i)throw new Error("Cannot get 'notBefore' value");this.notBefore=i;const s=t.validity.notAfter.utcTime||t.validity.notAfter.generalTime;if(!s)throw new Error("Cannot get 'notAfter' value");this.notAfter=s,this.extensions=[],t.extensions&&(this.extensions=t.extensions.map(o=>Ki.create(ge.serialize(o)))),this.publicKey=new hs(t.subjectPublicKeyInfo)}getExtension(e){for(const t of this.extensions)if(typeof e=="string"){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter(t=>typeof e=="string"?t.type===e:t instanceof e)}async verify(e={},t=xr.get()){let n,i;const s=e.publicKey;try{if(!s)n={...this.publicKey.algorithm,...this.signatureAlgorithm},i=await this.publicKey.export(n,["verify"],t);else if("publicKey"in s)n={...s.publicKey.algorithm,...this.signatureAlgorithm},i=await s.publicKey.export(n,["verify"],t);else if(s instanceof hs)n={...s.algorithm,...this.signatureAlgorithm},i=await s.export(n,["verify"],t);else if(me.isBufferSource(s)){const l=new hs(s);n={...l.algorithm,...this.signatureAlgorithm},i=await l.export(n,["verify"],t)}else n={...s.algorithm,...this.signatureAlgorithm},i=s}catch{return!1}const o=Dr.resolveAll(m0).reverse();let a=null;for(const l of o)if(a=l.toWebSignature(n,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");const c=await t.subtle.verify(this.signatureAlgorithm,i,a,this.tbs);if(e.signatureOnly)return c;{const d=(e.date||new Date).getTime();return c&&this.notBefore.getTime()<d&&d<this.notAfter.getTime()}}async getThumbprint(...e){let t,n="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(n=e[0]||n,t=e[1])),t??(t=xr.get()),await t.subtle.digest(n,this.rawData)}async isSelfSigned(e=xr.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},e)}toTextObject(){const e=this.toTextObjectEmpty(),t=ge.parse(this.rawData,su),n=t.tbsCertificate,i=new ut("",{Version:`${iu[n.version]} (${n.version})`,"Serial Number":n.serialNumber,"Signature Algorithm":du.serializeAlgorithm(n.signature),Issuer:this.issuer,Validity:new ut("",{"Not Before":n.validity.notBefore.getTime(),"Not After":n.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(n.issuerUniqueID&&(i["Issuer Unique ID"]=n.issuerUniqueID),n.subjectUniqueID&&(i["Subject Unique ID"]=n.subjectUniqueID),this.extensions.length){const s=new ut("");for(const o of this.extensions){const a=o.toTextObject();s[a[ut.NAME]]=a}i.Extensions=s}return e.Data=i,e.Signature=new ut("",{Algorithm:du.serializeAlgorithm(t.signatureAlgorithm),"":t.signatureValue}),e}}CA.NAME="Certificate";class e7e{static async createSelfSigned(e,t=xr.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},t)}static async create(e,t=xr.get()){var n;let i;e.publicKey instanceof hs?i=e.publicKey.rawData:"publicKey"in e.publicKey?i=e.publicKey.publicKey.rawData:me.isBufferSource(e.publicKey)?i=e.publicKey:i=await t.subtle.exportKey("spki",e.publicKey);const s=e.serialNumber?me.toUint8Array(Ce.FromHex(e.serialNumber)):t.getRandomValues(new Uint8Array(16));s[0]>127&&(s[0]&=127),s.length>1&&s[0]===0&&(s[1]|=128);const o=e.notBefore||new Date,a=e.notAfter||new Date(o.getTime()+31536e6),c=new su({tbsCertificate:new gi({version:iu.v3,serialNumber:s,validity:new s0({notBefore:o,notAfter:a}),extensions:new $c(((n=e.extensions)===null||n===void 0?void 0:n.map(v=>ge.parse(v.rawData,Bi)))||[]),subjectPublicKeyInfo:ge.parse(i,as)})});if(e.subject){const v=e.subject instanceof Di?e.subject:new Di(e.subject);c.tbsCertificate.subject=ge.parse(v.toArrayBuffer(),er)}if(e.issuer){const v=e.issuer instanceof Di?e.issuer:new Di(e.issuer);c.tbsCertificate.issuer=ge.parse(v.toArrayBuffer(),er)}const l={hash:"SHA-256"},d="signingKey"in e?{...l,...e.signingAlgorithm,...e.signingKey.algorithm}:{...l,...e.signingAlgorithm},h=Dr.resolve(uu);c.tbsCertificate.signature=c.signatureAlgorithm=h.toAsnAlgorithm(d);const p=ge.serialize(c.tbsCertificate),w="signingKey"in e?await t.subtle.sign(d,e.signingKey,p):e.signature,f=Dr.resolveAll(m0).reverse();let g=null;for(const v of f)if(g=v.toAsnSignature(d,w),g)break;if(!g)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return c.signatureValue=g,new CA(ge.serialize(c))}}var h$;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(h$||(h$={}));Ki.register($H,AA);Ki.register(MH,pj);Ki.register(RH,gj);Ki.register(FH,M4);Ki.register(h7,vp);Ki.register(UH,yj);Ki.register(m7,wj);Ki.register(d7,vj);R4.register(cj,bj);R4.register(xA,IA);Dr.registerSingleton(m0,Jbe);Dr.registerSingleton(m0,$i);$i.namedCurveSize.set("P-256",32);$i.namedCurveSize.set("K-256",32);$i.namedCurveSize.set("P-384",48);$i.namedCurveSize.set("P-521",66);function Ej(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function t7e(r){return new TextEncoder().encode(r)}function r7e(r){return new TextDecoder().decode(r)}function n7e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var i7e=n7e,s7e=i7e;let o7e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},a7e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Sj(this,e)}},c7e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return Sj(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Sj(r,e){return new c7e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let l7e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new o7e(e,t,n),this.decoder=new a7e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function L4({name:r,prefix:e,encode:t,decode:n}){return new l7e(r,e,t,n)}function w0({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=s7e(t,r);return L4({prefix:e,name:r,encode:n,decode:s=>Ej(i(s))})}function u7e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function d7e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Or({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return L4({prefix:e,name:r,encode(i){return d7e(i,n,t)},decode(i){return u7e(i,n,t,r)}})}const h7e=Or({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),f7e=Or({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),kA=Or({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),p7e=Or({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),g7e=Object.freeze(Object.defineProperty({__proto__:null,base64:h7e,base64pad:f7e,base64url:kA,base64urlpad:p7e},Symbol.toStringTag,{value:"Module"}));var y7e=xj,f$=128,m7e=-128,w7e=Math.pow(2,31);function xj(r,e,t){e=e||[],t=t||0;for(var n=t;r>=w7e;)e[t++]=r&255|f$,r/=128;for(;r&m7e;)e[t++]=r&255|f$,r>>>=7;return e[t]=r|0,xj.bytes=t-n+1,e}var v7e=b9,b7e=128,p$=127;function b9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw b9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&p$)<<i:(o&p$)*Math.pow(2,i),i+=7}while(o>=b7e);return b9.bytes=s-n,t}var E7e=Math.pow(2,7),S7e=Math.pow(2,14),x7e=Math.pow(2,21),A7e=Math.pow(2,28),I7e=Math.pow(2,35),C7e=Math.pow(2,42),k7e=Math.pow(2,49),_7e=Math.pow(2,56),T7e=Math.pow(2,63),P7e=function(r){return r<E7e?1:r<S7e?2:r<x7e?3:r<A7e?4:r<I7e?5:r<C7e?6:r<k7e?7:r<_7e?8:r<T7e?9:10},D7e={encode:y7e,decode:v7e,encodingLength:P7e},a3=D7e;function g$(r,e=0){return[a3.decode(r,e),a3.decode.bytes]}function y$(r,e,t=0){return a3.encode(r,e,t),e}function m$(r){return a3.encodingLength(r)}function c3(r,e){const t=e.byteLength,n=m$(r),i=n+m$(t),s=new Uint8Array(i+t);return y$(r,s,0),y$(t,s,n),s.set(e,i),new Aj(r,t,e,s)}function $7e(r){const e=Ej(r),[t,n]=g$(e),[i,s]=g$(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Aj(t,i,o,e)}let Aj=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function N7e({name:r,code:e,encode:t}){return new O7e(r,e,t)}let O7e=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?c3(this.code,t):t.then(n=>c3(this.code,n))}else throw Error("Unknown type, must be binary type")}};function M7e(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const _A=N7e({name:"sha2-256",code:18,encode:M7e("SHA-256")});class R7e extends tr{async listen(){throw new Eve("WebRTCTransport.createListener")}getAddrs(){return[]}updateAnnounceAddrs(){}async close(){}}const L7e=w0({prefix:"9",name:"base10",alphabet:"0123456789"}),B7e=Object.freeze(Object.defineProperty({__proto__:null,base10:L7e},Symbol.toStringTag,{value:"Module"})),U7e=Or({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),F7e=Or({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),z7e=Object.freeze(Object.defineProperty({__proto__:null,base16:U7e,base16upper:F7e},Symbol.toStringTag,{value:"Module"})),V7e=Or({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),K7e=Object.freeze(Object.defineProperty({__proto__:null,base2:V7e},Symbol.toStringTag,{value:"Module"})),Ij=Array.from(""),H7e=Ij.reduce((r,e,t)=>(r[t]=e,r),[]),j7e=Ij.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function q7e(r){return r.reduce((e,t)=>(e+=H7e[t],e),"")}function W7e(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const i=j7e[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const G7e=L4({prefix:"",name:"base256emoji",encode:q7e,decode:W7e}),Q7e=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:G7e},Symbol.toStringTag,{value:"Module"})),Y7e=Or({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),X7e=Or({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),J7e=Or({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Z7e=Or({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),e9e=Or({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),t9e=Or({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),r9e=Or({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),n9e=Or({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),i9e=Or({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),s9e=Object.freeze(Object.defineProperty({__proto__:null,base32:Y7e,base32hex:e9e,base32hexpad:r9e,base32hexpadupper:n9e,base32hexupper:t9e,base32pad:J7e,base32padupper:Z7e,base32upper:X7e,base32z:i9e},Symbol.toStringTag,{value:"Module"})),o9e=w0({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),a9e=w0({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),c9e=Object.freeze(Object.defineProperty({__proto__:null,base36:o9e,base36upper:a9e},Symbol.toStringTag,{value:"Module"})),l9e=w0({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),u9e=w0({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),d9e=Object.freeze(Object.defineProperty({__proto__:null,base58btc:l9e,base58flickr:u9e},Symbol.toStringTag,{value:"Module"})),h9e=Or({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),f9e=Object.freeze(Object.defineProperty({__proto__:null,base8:h9e},Symbol.toStringTag,{value:"Module"})),p9e=L4({prefix:"\0",name:"identity",encode:r=>r7e(r),decode:r=>t7e(r)}),g9e=Object.freeze(Object.defineProperty({__proto__:null,identity:p9e},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const y9e={...g9e,...K7e,...f9e,...B7e,...z7e,...s9e,...c9e,...d9e,...g7e,...Q7e},Cj=Object.values(y9e).map(r=>r.decoder).reduce((r,e)=>r.or(e)),m9e=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function w9e(r){var t;if(r==null)return;const e=r.match(m9e);return(t=e==null?void 0:e.groups)==null?void 0:t.fingerprint}function kj(r){const t=r.stringTuples().filter(n=>n[0]===H5e).map(n=>n[1])[0];if(t===void 0||t==="")throw new ie(`Couldn't find a certhash component of multiaddr: ${r.toString()}`);return t}function v9e(r){return $7e(Cj.decode(r))}function b9e(r){const e=v9e(kj(r)),t=S9e(e.code),n=e.digest.reduce((s,o)=>s+o.toString(16).padStart(2,"0"),""),i=n.match(/.{1,2}/g);if(i==null)throw new bve(n,r.toString());return`${t} ${i.join(":").toUpperCase()}`}function E9e(r){const e=r.split(":").map(i=>parseInt(i,16)),t=Uint8Array.from(e),n=c3(_A.code,t);return Fe(`/certhash/${kA.encode(n.bytes)}`)}function S9e(r){switch(r){case 17:return"sha-1";case 18:return"sha-256";case 19:return"sha-512";default:throw new Sve(r)}}function x9e(r,e){const{host:t,port:n,family:i}=r.toOptions(),s=b9e(r);return{type:"answer",sdp:`v=0
o=- 0 0 IN IP${i} ${t}
s=-
t=0 0
a=ice-lite
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
c=IN IP${i} ${t}
a=mid:0
a=ice-options:ice2
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:${s}
a=setup:passive
a=sctp-port:5000
a=max-message-size:${c4}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function A9e(r,e){const{host:t,port:n,family:i}=r.toOptions();return{type:"offer",sdp:`v=0
o=- 0 0 IN IP${i} ${t}
s=-
c=IN IP${i} ${t}
t=0 0
a=ice-options:ice2,trickle
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:active
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:sha-256 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
a=sctp-port:5000
a=max-message-size:${c4}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function w$(r,e){if(r.sdp===void 0)throw new ie("Can't munge a missing SDP");const t=r.sdp.includes(`\r
`)?`\r
`:`
`;return r.sdp=r.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,`
a=ice-ufrag:`+e+t).replace(/\na=ice-pwd:[^\n]*\n/,`
a=ice-pwd:`+e+t),r}const L6=fe("libp2p-webrtc-noise:");function I9e(r,e,t){const n=r.trim().toLowerCase().replaceAll(":",""),i=fe(n,"hex"),s=c3(_A.code,i),o=Cj.decode(kj(e)),a=L6.byteLength+s.bytes.byteLength+o.byteLength;return ur(t==="server"?[L6,o,s.bytes]:[L6,s.bytes,o],a)}const C9e=Wx?"iceconnectionstatechange":"connectionstatechange";async function k9e(r,e,t){var i,s,o;const n=r.createDataChannel("",{negotiated:!0,id:0});try{if(t.role==="client"){t.log.trace("client creating local offer");const f=await r.createOffer();t.log.trace("client created local offer %s",f.sdp);const g=w$(f,e);t.log.trace("client setting local offer %s",g.sdp),await r.setLocalDescription(g);const v=x9e(t.remoteAddr,e);t.log.trace("client setting server description %s",v.sdp),await r.setRemoteDescription(v)}else{const f=A9e(t.remoteAddr,e);t.log.trace("server setting client %s %s",f.type,f.sdp),await r.setRemoteDescription(f),t.log.trace("server creating local answer");const g=await r.createAnswer();t.log.trace("server created local answer");const v=w$(g,e);t.log.trace("server setting local description %s",g.sdp),await r.setLocalDescription(v)}if(n.readyState!=="open"&&(t.log.trace("%s wait for handshake channel to open, starting status %s",t.role,n.readyState),await Ti(n,"open",t.signal)),t.log.trace("%s handshake channel opened",t.role),t.role==="server"){const f=((i=r.remoteFingerprint())==null?void 0:i.value)??"";t.remoteAddr=t.remoteAddr.encapsulate(E9e(f))}const a=w9e((s=r.localDescription)==null?void 0:s.sdp);if(a==null)throw new n0("Could not get fingerprint from local description sdp");t.log.trace("%s performing noise handshake",t.role);const c=I9e(a,t.remoteAddr,t.role),l=AV({prologueBytes:c})(t),d=Tm({channel:n,direction:"outbound",handshake:!0,logger:t.logger,...t.dataChannel??{}}),h=new s7(t,{peerConnection:r,remoteAddr:t.remoteAddr,timeline:{open:Date.now()},metrics:t.events});r.addEventListener(C9e,()=>{switch(r.connectionState){case"failed":case"disconnected":case"closed":h.close().catch(f=>{t.log.error("error closing connection",f),h.abort(f)});break;default:break}}),(o=t.events)==null||o.increment({peer_connection:!0});const p=new Gx(t,{peerConnection:r,metrics:t.events,dataChannelOptions:t.dataChannel});if(t.role==="client")return t.log.trace("%s secure inbound",t.role),await l.secureInbound(d,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0}),t.log.trace("%s upgrade outbound",t.role),await t.upgrader.upgradeOutbound(h,{skipProtection:!0,skipEncryption:!0,muxerFactory:p,signal:t.signal});t.log.trace("%s secure outbound",t.role);const w=await l.secureOutbound(d,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0});h.remoteAddr=h.remoteAddr.encapsulate(`/p2p/${w.remotePeer}`),t.log.trace("%s upgrade inbound",t.role),await t.upgrader.upgradeInbound(h,{skipProtection:!0,skipEncryption:!0,muxerFactory:p,signal:t.signal})}catch(a){throw n.close(),a}}async function _9e(r,e,t,n){n==null&&(n=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"}));const i=typeof t=="function"?await t():t;return new RTCPeerConnection({...i??{},certificates:[n]})}async function T9e(r){const e=await mU(r),t=await crypto.subtle.exportKey("pkcs8",e.privateKey);return["-----BEGIN PRIVATE KEY-----",...ae(new Uint8Array(t),"base64pad").split(/(.{64})/).filter(Boolean),"-----END PRIVATE KEY-----"].join(`
`)}var rO,nO,iO;iO=Z3,nO=Symbol.toStringTag,rO=lr;class P9e{constructor(e,t={}){u(this,"log");u(this,"metrics");u(this,"components");u(this,"init");u(this,"certificate");u(this,"privateKey");u(this,"emitter");u(this,"renewCertificateTask");u(this,iO,!0);u(this,nO,"@libp2p/webrtc-direct");u(this,rO,["@libp2p/transport"]);if(this.log=e.logger.forComponent("libp2p:webrtc-direct"),this.components=e,this.init=t,this.emitter=new tr,t.certificateLifespan!=null&&t.certificateRenewalThreshold!=null&&t.certificateRenewalThreshold>=t.certificateLifespan)throw new ie("Certificate renewal threshold must be less than certificate lifespan");e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}async start(){this.certificate=await this.getCertificate()}async stop(){this.renewCertificateTask!=null&&clearTimeout(this.renewCertificateTask),this.certificate=void 0}async dial(e,t){var a;this.log("dial %a",e),t.signal.throwIfAborted();let n;const i=e.getPeerId();i!=null&&(n=Zt(i));const s=yve(),o=await _9e("client",s,typeof this.init.rtcConfiguration=="function"?await this.init.rtcConfiguration():this.init.rtcConfiguration??{});try{return await k9e(o,s,{role:"client",log:this.log,logger:this.components.logger,metrics:this.components.metrics,events:(a=this.metrics)==null?void 0:a.dialerEvents,signal:t.signal,remoteAddr:e,dataChannel:this.init.dataChannel,upgrader:t.upgrader,peerId:this.components.peerId,remotePeerId:n,privateKey:this.components.privateKey})}catch(c){throw o.close(),c}}createListener(e){if(this.certificate==null)throw new ql;return new R7e(this.components,{...this.init,...e,certificate:this.certificate,emitter:this.emitter})}listenFilter(e){return e.filter(sb.exactMatch)}dialFilter(e){return this.listenFilter(e)}async getCertificate(e){if(D9e(this.init.certificate))return this.log("using provided TLS certificate"),this.init.certificate;const t=await this.loadOrCreatePrivateKey(),{pem:n,certhash:i}=await this.loadOrCreateCertificate(t,e);return{privateKey:await T9e(t),pem:n,certhash:i}}async loadOrCreatePrivateKey(){if(this.privateKey!=null)return this.privateKey;const e=this.init.certificateKeychainName??Z5e,t=this.getKeychain();try{if(t==null)throw this.log("no keychain configured - not checking for stored private key"),new sr;this.log.trace("checking for stored private key"),this.privateKey=await t.exportKey(e)}catch(n){if(n.name!=="NotFoundError")throw n;this.log.trace("generating private key"),this.privateKey=await hw("ECDSA","P-256"),t!=null?(this.log.trace("storing private key"),await t.importKey(e,this.privateKey)):this.log("no keychain configured - not storing private key")}return this.privateKey}async loadOrCreateCertificate(e,t){if(this.certificate!=null&&t!==!0)return this.certificate;let n;const i=new _t(this.init.certificateDatastoreKey??J5e),s=await mU(e);try{if(t===!0)throw this.log.trace("forcing renewal of TLS certificate"),new sr;this.log.trace("checking for stored TLS certificate"),n=await this.loadCertificate(i,s)}catch(a){if(a.name!=="NotFoundError")throw a;this.log.trace("generating new TLS certificate"),n=await this.createCertificate(i,s)}let o=n.notAfter.getTime()-(this.init.certificateRenewalThreshold??RP)-Date.now();return o<0&&(o=100),this.log("will renew TLS certificate after %d ms",o),this.renewCertificateTask=setTimeout(()=>{this.log("renewing TLS certificate"),this.getCertificate(!0).then(a=>{this.certificate=a,this.emitter.safeDispatchEvent("certificate:renew",{detail:a})}).catch(a=>{this.log.error("could not renew certificate - %e",a)})},o),{pem:n.toString("pem"),certhash:kA.encode((await _A.digest(new Uint8Array(n.rawData))).bytes)}}async loadCertificate(e,t){const n=await this.components.datastore.get(e),i=new CA(n),s=i.notAfter.getTime()-(this.init.certificateRenewalThreshold??RP);if(Date.now()>s)throw this.log("stored TLS certificate has expired"),new sr;this.log("loaded certificate, expires in %d ms",s);const o=await i.publicKey.export(crypto),a=await crypto.subtle.exportKey("raw",o),c=await crypto.subtle.exportKey("raw",t.publicKey);if(!Xe(new Uint8Array(a,0,a.byteLength),new Uint8Array(c,0,c.byteLength)))throw this.log("stored TLS certificate public key did not match public key from private key"),new sr;return this.log("loaded certificate, expiry time is %o",s),i}async createCertificate(e,t){const n=new Date,i=new Date(Date.now()+(this.init.certificateLifespan??eve));n.setMilliseconds(0),i.setMilliseconds(0);const s=await e7e.createSelfSigned({serialNumber:(BigInt(Math.random().toString().replace(".",""))*100000n).toString(16),name:"CN=example.com, C=US, L=CA, O=example, ST=CA",notBefore:n,notAfter:i,keys:t,extensions:[new AA(!1,void 0,!0)]},crypto);return this.getKeychain()!=null?(this.log.trace("storing TLS certificate"),await this.components.datastore.put(e,fe(s.toString("pem")))):this.log("no keychain is configured so not storing TLS certificate since the private key will not be reused"),s}getKeychain(){try{return this.components.keychain}catch{}}}function D9e(r){return r==null?!1:typeof r.privateKey=="string"&&typeof r.pem=="string"&&typeof r.certhash=="string"}function $9e(r){return e=>new P9e(e,r)}function _j(r){return e=>new Cve(e,r)}const N9e=async r=>{if(r.readyState>=2)throw new Error("socket closed");r.readyState!==1&&await new Promise((e,t)=>{function n(){r.removeEventListener("open",i),r.removeEventListener("error",s)}function i(){n(),e()}function s(o){n(),t(o.error??new Error(`connect ECONNREFUSED ${r.url}`))}r.addEventListener("open",i),r.addEventListener("error",s)})},O9e=(r,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,async n=>{for await(const i of n){try{await N9e(r)}catch(s){if(s.message==="socket closed")break;throw s}if(r.readyState===r.CLOSING||r.readyState===r.CLOSED)break;r.send(i)}e.closeOnEnd!=null&&r.readyState<=1&&await new Promise((i,s)=>{r.addEventListener("close",o=>{if(o.wasClean||o.code===1006)i();else{const a=Object.assign(new Error("ws error"),{event:o});s(a)}}),setTimeout(()=>{r.close()})})});var B4={},U4={};Object.defineProperty(U4,"__esModule",{value:!0});class M9e{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const t={value:e,done:!1};if(this.pullQueue.length){const n=this.pullQueue.shift();n&&n.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{const t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{const t=this.pushQueue.shift();return t?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((n,i)=>{this.pullQueue.push({resolve:n,reject:i})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}let Tj=class{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){const i=new M9e;i.highWaterMark=t,i.lowWaterMark=n,i.removeCallback=e({push:s=>i.push(s),stop:()=>i.stop(),fail:s=>i.fail(s),on:(s,o)=>{i.eventHandlers[s]=o}})||(()=>{}),this[Symbol.asyncIterator]=()=>i[Symbol.asyncIterator](),Object.freeze(this)}};U4.EventIterator=Tj;U4.default=Tj;Object.defineProperty(B4,"__esModule",{value:!0});const TA=U4;var R9e=B4.EventIterator=TA.EventIterator;function L9e(r,e,t){return new TA.EventIterator(({push:n})=>(this.addEventListener(r,n,e),()=>this.removeEventListener(r,n,e)),t)}B4.subscribe=L9e;B4.default=TA.EventIterator;function v$(r){var e;return r instanceof ArrayBuffer||((e=r==null?void 0:r.constructor)==null?void 0:e.name)==="ArrayBuffer"&&typeof(r==null?void 0:r.byteLength)=="number"}const B9e=r=>{r.binaryType="arraybuffer";const e=async()=>{await new Promise((s,o)=>{if(n){s();return}if(i!=null){o(i);return}const a=d=>{r.removeEventListener("open",c),r.removeEventListener("error",l),d()},c=()=>{a(s)},l=d=>{a(()=>{o(d.error??new Error(`connect ECONNREFUSED ${r.url}`))})};r.addEventListener("open",c),r.addEventListener("error",l)})},t=async function*(){const s=new R9e(({push:o,stop:a,fail:c})=>{const l=h=>{let p=null;typeof h.data=="string"&&(p=fe(h.data)),v$(h.data)&&(p=new Uint8Array(h.data)),h.data instanceof Uint8Array&&(p=h.data),p!=null&&o(p)},d=h=>{c(h.error??new Error("Socket error"))};return r.addEventListener("message",l),r.addEventListener("error",d),r.addEventListener("close",a),()=>{r.removeEventListener("message",l),r.removeEventListener("error",d),r.removeEventListener("close",a)}},{highWaterMark:1/0});await e();for await(const o of s)yield v$(o)?new Uint8Array(o):o}();let n=r.readyState===1,i;return r.addEventListener("open",()=>{n=!0,i=null}),r.addEventListener("close",()=>{n=!1,i=null}),r.addEventListener("error",s=>{n||(i=s.error??new Error(`connect ECONNREFUSED ${r.url}`))}),Object.assign(t,{connected:e})},U9e=(r,e)=>{e=e??{};const t=B9e(r);let n=e.remoteAddress,i=e.remotePort;if(r.url!=null)try{const o=new URL(r.url);n=o.hostname,i=parseInt(o.port,10)}catch{}if(n==null||i==null)throw new Error("Remote connection did not have address and/or port");return{sink:O9e(r,e),source:t,connected:async()=>{await t.connected()},close:async()=>{(r.readyState===r.CONNECTING||r.readyState===r.OPEN)&&await new Promise(o=>{r.addEventListener("close",()=>{o()}),r.close()})},destroy:()=>{r.terminate!=null?r.terminate():r.close()},remoteAddress:n,remotePort:i,socket:r}},F9e=WebSocket,z9e={"http:":"ws:","https:":"wss:"},b$="ws:",V9e=(r,e)=>{if(r.startsWith("//")&&(r=`${(e==null?void 0:e.protocol)??b$}${r}`),r.startsWith("/")&&e!=null){const n=e.protocol??b$,i=e.host,s=e.port!=null&&(i==null?void 0:i.endsWith(`:${e.port}`))!==!0?`:${e.port}`:"";r=`${n}//${i}${s}${r}`}const t=new URL(r);for(const[n,i]of Object.entries(z9e))t.protocol===n&&(t.protocol=i);return t};function K9e(r,e){const t=typeof window>"u"?void 0:window.location;e=e??{};const n=V9e(r,t),i=new F9e(n.toString(),e.websocket);return U9e(i,e)}function H9e(r){return r.filter(e=>Hy.exactMatch(e)||ep.exactMatch(e))}function j9e(){throw new Error("WebSocket Servers can not be created in the browser!")}const q9e=500;function W9e(r,e,t){const n=t.logger.forComponent("libp2p:websockets:maconn"),i=t.metrics,s=t.metricPrefix??"",o={log:n,async sink(a){try{await r.sink(async function*(){for await(const c of a)c instanceof Uint8Array?yield c:yield c.subarray()}())}catch(c){c.type!=="aborted"&&n.error(c)}},source:r.source,remoteAddr:e,timeline:{open:Date.now()},async close(a={}){var d,h;const c=Date.now();if(a.signal==null){const p=AbortSignal.timeout(q9e);a={...a,signal:p}}const l=()=>{const{host:p,port:w}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s after %dms, destroying it manually",p,w,Date.now()-c),this.abort(new jl("Socket close timeout"))};(d=a.signal)==null||d.addEventListener("abort",l);try{await r.close()}catch(p){n.error("error closing WebSocket gracefully",p),this.abort(p)}finally{(h=a.signal)==null||h.removeEventListener("abort",l),o.timeline.close=Date.now()}},abort(a){const{host:c,port:l}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s due to error",c,l,a),r.destroy(),o.timeline.close=Date.now(),i==null||i.increment({[`${s}error`]:!0})}};return r.socket.addEventListener("close",()=>{i==null||i.increment({[`${s}close`]:!0}),o.timeline.close==null&&(o.timeline.close=Date.now())},{once:!0}),o}var sO,oO,aO;aO=Z3,oO=Symbol.toStringTag,sO=lr;class G9e{constructor(e,t={}){u(this,"log");u(this,"init");u(this,"logger");u(this,"metrics");u(this,"components");u(this,aO,!0);u(this,oO,"@libp2p/websockets");u(this,sO,["@libp2p/transport"]);this.log=e.logger.forComponent("libp2p:websockets"),this.logger=e.logger,this.components=e,this.init=t,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}async dial(e,t){var o;this.log("dialing %s",e),t=t??{};const n=await this._connect(e,t),i=W9e(n,e,{logger:this.logger,metrics:(o=this.metrics)==null?void 0:o.dialerEvents});this.log("new outbound connection %s",i.remoteAddr);const s=await t.upgrader.upgradeOutbound(i,t);return this.log("outbound connection %s upgraded",i.remoteAddr),s}async _connect(e,t){var o,a,c,l,d;(o=t==null?void 0:t.signal)==null||o.throwIfAborted();const n=e.toOptions();this.log("dialing %s:%s",n.host,n.port);const i=Ve(),s=K9e(Dz(e),this.init);s.socket.addEventListener("error",()=>{var p;const h=new aS(`Could not connect to ${e.toString()}`);this.log.error("connection error:",h),(p=this.metrics)==null||p.dialerEvents.increment({error:!0}),i.reject(h)});try{(a=t.onProgress)==null||a.call(t,new Ne("websockets:open-connection")),await dn(Promise.race([s.connected(),i.promise]),t.signal)}catch(h){throw(c=t.signal)!=null&&c.aborted&&((l=this.metrics)==null||l.dialerEvents.increment({abort:!0})),s.close().catch(p=>{this.log.error("error closing raw socket",p)}),h}return this.log("connected %s",e),(d=this.metrics)==null||d.dialerEvents.increment({connect:!0}),s}createListener(e){return j9e({logger:this.logger,events:this.components.events,metrics:this.components.metrics},{...this.init,...e})}listenFilter(e){var t,n;return e=Array.isArray(e)?e:[e],((t=this.init)==null?void 0:t.filter)!=null?(n=this.init)==null?void 0:n.filter(e):H9e(e)}dialFilter(e){return this.listenFilter(e)}}function Pj(r={}){return e=>new G9e(e,r)}function Q9e(r,e){const t=e.map((n,i)=>({record:Yp(n),index:i}));return t.sort((n,i)=>{const s=n.record.sequence,o=i.record.sequence;if(s>o)return-1;if(s<o)return 1;if(n.record.validityType===ds.ValidityType.EOL&&i.record.validityType===ds.ValidityType.EOL){const a=fb.fromString(n.record.validity).toDate(),c=fb.fromString(i.record.validity).toDate();if(a.getTime()>c.getTime())return-1;if(a.getTime()<c.getTime())return 1}return 0}),t[0].index}const Dj="2.8.5",$j="js-libp2p";function Nj(r,e){return`${r??$j}/${e??Dj} browser/${globalThis.navigator.userAgent}`}const Y9e="5.3.0",X9e="helia",J9e={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};function Z9e(r={}){const e=`${X9e}/${Y9e} ${Nj()}`;return{privateKey:r.privateKey,dns:r.dns,nodeInfo:{userAgent:e},addresses:{listen:["/p2p-circuit","/webrtc"]},transports:[eK(),_j(),$9e(),Pj()],connectionEncrypters:[AV()],streamMuxers:[Vye(),N5e()],peerDiscovery:[VV(J9e)],services:{autoNAT:xme(),dcutr:Q3e(),delegatedRouting:()=>M0e("https://delegated-ipfs.dev",yge()),dht:N8e({clientMode:!0,validators:{ipns:Yz},selectors:{ipns:Q9e}}),identify:iK(),identifyPush:cwe(),keychain:EH(r.keychain),ping:z5e()}}}async function eEe(r,e={}){const t=e.selfKey??"self",n=EH(e)({datastore:r,logger:vw()});let i;return await r.has(new _t(`/pkcs8/${t}`))?i=await n.exportKey(t):(i=await hw(e.keyType??"Ed25519"),await n.importKey(t,i)),i}const tEe=32,{code:rEe}=qe("dnsaddr");class nEe extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}}const Oj=async function(e,t={}){const n=t.maxRecursiveDepth??tEe;if(n===0)throw new nEe("Max recursive depth reached");const[,i]=e.stringTuples().find(([l])=>l===rEe)??[],o=await((t==null?void 0:t.dns)??yF()).query(`_dnsaddr.${i}`,{signal:t==null?void 0:t.signal,types:[Cc.TXT]}),a=e.getPeerId(),c=[];for(const l of o.Answer){const d=l.data.replace(/["']/g,"").trim().split("=")[1];if(d==null||a!=null&&!d.includes(a))continue;const h=Fe(d);if(d.startsWith("/dnsaddr")){const p=await h.resolve({...t,maxRecursiveDepth:n-1});c.push(...p.map(w=>w.toString()))}else c.push(h.toString())}return c},iEe={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:r=>r},connectionManager:{resolvers:{dnsaddr:Oj}},transportManager:{faultTolerance:jd.FATAL_ALL}};async function sEe(r){var t,n;const e=Nx(iEe,r);if(e.connectionProtector===null&&((n=(t=globalThis.process)==null?void 0:t.env)==null?void 0:n.LIBP2P_FORCE_PNET)!=null)throw new ie("Private network is enforced, but no protector was provided");return e}function oEe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function PA(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function aEe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,m=f.length;y!==m&&f[y]===0;)y++,g++;for(var b=(m-y)*d+1>>>0,S=new Uint8Array(b);y!==m;){for(var I=f[y],T=0,A=b-1;(I!==0||T<v)&&A!==-1;A--,T++)I+=256*S[A]>>>0,S[A]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");v=T,y++}for(var _=b-v;_!==b&&S[_]===0;)_++;for(var $=c.repeat(g);_<b;++_)$+=r.charAt(S[_]);return $}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var m=(f.length-g)*l+1>>>0,b=new Uint8Array(m);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var I=0,T=m-1;(S!==0||I<y)&&T!==-1;T--,I++)S+=a*b[T]>>>0,b[T]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");y=I,g++}if(f[g]!==" "){for(var A=m-y;A!==m&&b[A]===0;)A++;for(var _=new Uint8Array(v+(m-A)),$=v;A!==m;)_[$++]=b[A++];return _}}}function w(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:w}}var cEe=aEe,lEe=cEe;class uEe{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class dEe{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Mj(this,e)}}class hEe{constructor(e){u(this,"decoders");this.decoders=e}or(e){return Mj(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function Mj(r,e){return new hEe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}class fEe{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new uEe(e,t,n),this.decoder=new dEe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function Rj({name:r,prefix:e,encode:t,decode:n}){return new fEe(r,e,t,n)}function F4({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=lEe(t,r);return Rj({prefix:e,name:r,encode:n,decode:s=>PA(i(s))})}function pEe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function gEe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function ua({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return Rj({prefix:e,name:r,encode(i){return gEe(i,n,t)},decode(i){return pEe(i,n,t,r)}})}const w1=ua({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ua({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});ua({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});ua({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});ua({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});ua({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});ua({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});ua({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});ua({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const B6=F4({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});F4({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const So=F4({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});F4({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var yEe=Lj,E$=128,mEe=-128,wEe=Math.pow(2,31);function Lj(r,e,t){e=e||[],t=t||0;for(var n=t;r>=wEe;)e[t++]=r&255|E$,r/=128;for(;r&mEe;)e[t++]=r&255|E$,r>>>=7;return e[t]=r|0,Lj.bytes=t-n+1,e}var vEe=E9,bEe=128,S$=127;function E9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw E9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&S$)<<i:(o&S$)*Math.pow(2,i),i+=7}while(o>=bEe);return E9.bytes=s-n,t}var EEe=Math.pow(2,7),SEe=Math.pow(2,14),xEe=Math.pow(2,21),AEe=Math.pow(2,28),IEe=Math.pow(2,35),CEe=Math.pow(2,42),kEe=Math.pow(2,49),_Ee=Math.pow(2,56),TEe=Math.pow(2,63),PEe=function(r){return r<EEe?1:r<SEe?2:r<xEe?3:r<AEe?4:r<IEe?5:r<CEe?6:r<kEe?7:r<_Ee?8:r<TEe?9:10},DEe={encode:yEe,decode:vEe,encodingLength:PEe},l3=DEe;function S9(r,e=0){return[l3.decode(r,e),l3.decode.bytes]}function u3(r,e,t=0){return l3.encode(r,e,t),e}function d3(r){return l3.encodingLength(r)}function $Ee(r,e){const t=e.byteLength,n=d3(r),i=n+d3(t),s=new Uint8Array(i+t);return u3(r,s,0),u3(t,s,n),s.set(e,i),new DA(r,t,e,s)}function Bj(r){const e=PA(r),[t,n]=S9(e),[i,s]=S9(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new DA(t,i,o,e)}function NEe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&oEe(r.bytes,t.bytes)}}let DA=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function x$(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return MEe(t,x9(r),e??So.encoder);default:return REe(t,x9(r),e??w1.encoder)}}const A$=new WeakMap;function x9(r){const e=A$.get(r);if(e==null){const t=new Map;return A$.set(r,t),t}return e}var cO;class Er{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,cO,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Rf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==LEe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Er.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=$Ee(e,t);return Er.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Er.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&NEe(e.multihash,n.multihash)}toString(e){return x$(this,e)}toJSON(){return{"/":x$(this)}}link(){return this}[(cO=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Er)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Er(n,i,s,o??I$(n,i,s.bytes))}else if(t[BEe]===!0){const{version:n,multihash:i,code:s}=t,o=Bj(i);return Er.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Rf)throw new Error(`Version 0 CID must use dag-pb (code: ${Rf}) block encoding`);return new Er(e,t,n,n.bytes)}case 1:{const i=I$(e,t,n.bytes);return new Er(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Er.create(0,Rf,e)}static createV1(e,t){return Er.create(1,e,t)}static decode(e){const[t,n]=Er.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Er.inspectBytes(e),n=t.size-t.multihashSize,i=PA(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new DA(t.multihashCode,t.digestSize,s,i);return[t.version===0?Er.createV0(o):Er.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=S9(e.subarray(t));return t+=p,h};let i=n(),s=Rf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=OEe(e,t),s=Er.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return x9(s).set(n,e),s}}function OEe(r,e){switch(r[0]){case"Q":{const t=e??So;return[So.prefix,t.decode(`${So.prefix}${r}`)]}case So.prefix:{const t=e??So;return[So.prefix,t.decode(r)]}case w1.prefix:{const t=e??w1;return[w1.prefix,t.decode(r)]}case B6.prefix:{const t=e??B6;return[B6.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function MEe(r,e,t){const{prefix:n}=t;if(n!==So.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function REe(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Rf=112,LEe=18;function I$(r,e,t){const n=d3(r),i=n+d3(e),s=new Uint8Array(i+t.byteLength);return u3(r,s,0),u3(e,s,n),s.set(t,i),s}const BEe=Symbol.for("@ipld/js-cid/CID"),UEe=36e5,FEe=216e5;var Sl;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=Be((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.key!=null&&i.key!==""&&(s.uint32(10),s.string(i.key)),i.value!=null&&i.value.byteLength>0&&(s.uint32(18),s.bytes(i.value)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={key:"",value:tt(0)},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.key=i.string();break}case 2:{a.value=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>Le(i,t.codec()),t.decode=(i,s)=>Re(i,t.codec(),s)})(r.Peer$metadataEntry||(r.Peer$metadataEntry={})),function(t){let n;t.codec=()=>(n==null&&(n=Be((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.key!=null&&i.key!==""&&(s.uint32(10),s.string(i.key)),i.value!=null&&(s.uint32(18),f3.codec().encode(i.value,s)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={key:""},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:{a.key=i.string();break}case 2:{a.value=f3.codec().decode(i,i.uint32(),{limits:(l=o.limits)==null?void 0:l.value});break}default:{i.skipType(d&7);break}}}return a})),n),t.encode=i=>Le(i,t.codec()),t.decode=(i,s)=>Re(i,t.codec(),s)}(r.Peer$tagsEntry||(r.Peer$tagsEntry={}));let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.addresses!=null)for(const s of t.addresses)n.uint32(10),h3.codec().encode(s,n);if(t.protocols!=null)for(const s of t.protocols)n.uint32(18),n.string(s);if(t.publicKey!=null&&(n.uint32(34),n.bytes(t.publicKey)),t.peerRecordEnvelope!=null&&(n.uint32(42),n.bytes(t.peerRecordEnvelope)),t.metadata!=null&&t.metadata.size!==0)for(const[s,o]of t.metadata.entries())n.uint32(50),r.Peer$metadataEntry.codec().encode({key:s,value:o},n);if(t.tags!=null&&t.tags.size!==0)for(const[s,o]of t.tags.entries())n.uint32(58),r.Peer$tagsEntry.codec().encode({key:s,value:o},n);t.updated!=null&&(n.uint32(64),n.uint64Number(t.updated)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,d,h,p;const s={addresses:[],protocols:[],metadata:new Map,tags:new Map},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const w=t.uint32();switch(w>>>3){case 1:{if(((a=i.limits)==null?void 0:a.addresses)!=null&&s.addresses.length===i.limits.addresses)throw new xt('Decode error - map field "addresses" had too many elements');s.addresses.push(h3.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.addresses$}));break}case 2:{if(((l=i.limits)==null?void 0:l.protocols)!=null&&s.protocols.length===i.limits.protocols)throw new xt('Decode error - map field "protocols" had too many elements');s.protocols.push(t.string());break}case 4:{s.publicKey=t.bytes();break}case 5:{s.peerRecordEnvelope=t.bytes();break}case 6:{if(((d=i.limits)==null?void 0:d.metadata)!=null&&s.metadata.size===i.limits.metadata)throw new ak('Decode error - map field "metadata" had too many elements');const f=r.Peer$metadataEntry.codec().decode(t,t.uint32());s.metadata.set(f.key,f.value);break}case 7:{if(((h=i.limits)==null?void 0:h.tags)!=null&&s.tags.size===i.limits.tags)throw new ak('Decode error - map field "tags" had too many elements');const f=r.Peer$tagsEntry.codec().decode(t,t.uint32(),{limits:{value:(p=i.limits)==null?void 0:p.tags$value}});s.tags.set(f.key,f.value);break}case 8:{s.updated=t.uint64Number();break}default:{t.skipType(w&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(Sl||(Sl={}));var h3;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(n.uint32(10),n.bytes(t.multiaddr)),t.isCertified!=null&&(n.uint32(16),n.bool(t.isCertified)),t.observed!=null&&(n.uint32(24),n.uint64Number(t.observed)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={multiaddr:tt(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.multiaddr=t.bytes();break}case 2:{s.isCertified=t.bool();break}case 3:{s.observed=t.uint64Number();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(h3||(h3={}));var f3;(function(r){let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.value!=null&&t.value!==0&&(n.uint32(8),n.uint32(t.value)),t.expiry!=null&&(n.uint32(16),n.uint64(t.expiry)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={value:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.value=t.uint32();break}case 2:{s.expiry=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(f3||(f3={}));function zEe(r,e){if(r.publicKey!=null||e.publicKey==null)return r;let t;if(r.type==="RSA"){const i=So.decode(`z${r}`);t=Bj(i)}const n=Un(e.publicKey,t);return Xd(n)}function A9(r,e,t){const n=Sl.decode(e);return I9(r,n,t)}function I9(r,e,t){const n=new Map,i=BigInt(Date.now());for(const[s,o]of e.tags.entries())o.expiry!=null&&o.expiry<i||n.set(s,o);return{...e,id:zEe(r,e),addresses:e.addresses.filter(({observed:s})=>s!=null&&s>Date.now()-t).map(({multiaddr:s,isCertified:o})=>({multiaddr:Fe(s),isCertified:o??!1})),metadata:e.metadata,peerRecordEnvelope:e.peerRecordEnvelope??void 0,tags:n}}function VEe(r,e){return KEe(r.addresses,e.addresses)&&HEe(r.protocols,e.protocols)&&jEe(r.publicKey,e.publicKey)&&qEe(r.peerRecordEnvelope,e.peerRecordEnvelope)&&WEe(r.metadata,e.metadata)&&GEe(r.tags,e.tags)}function KEe(r,e){return Fj(r,e,(t,n)=>!(t.isCertified!==n.isCertified||!Xe(t.multiaddr,n.multiaddr)))}function HEe(r,e){return Fj(r,e,(t,n)=>t===n)}function jEe(r,e){return Uj(r,e)}function qEe(r,e){return Uj(r,e)}function WEe(r,e){return zj(r,e,(t,n)=>Xe(t,n))}function GEe(r,e){return zj(r,e,(t,n)=>t.value===n.value&&t.expiry===n.expiry)}function Uj(r,e){return r==null&&e==null?!0:r!=null&&e!=null?Xe(r,e):!1}function Fj(r,e,t){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!t(r[n],e[n]))return!1;return!0}function zj(r,e,t){if(r.size!==e.size)return!1;for(const[n,i]of r.entries()){const s=e.get(n);if(s==null||!t(i,s))return!1}return!0}const Vj="/peers/";function Ag(r){if(!iB(r)||r.type==null)throw new ie("Invalid PeerId");const e=r.toCID().toString();return new _t(`${Vj}${e}`)}async function QEe(r,e,t,n){const i=new Map;for(const s of t){if(s==null)continue;if(s.multiaddr instanceof Uint8Array&&(s.multiaddr=Fe(s.multiaddr)),!Pw(s.multiaddr))throw new ie("Multiaddr was invalid");if(!await e(r,s.multiaddr))continue;const o=s.isCertified??!1,a=s.multiaddr.toString(),c=i.get(a);c!=null?s.isCertified=c.isCertified||o:i.set(a,{multiaddr:s.multiaddr,isCertified:o})}return[...i.values()].sort((s,o)=>s.multiaddr.toString().localeCompare(o.multiaddr.toString())).map(({isCertified:s,multiaddr:o})=>({isCertified:s,multiaddr:o.bytes}))}async function U6(r,e,t,n){var p,w;if(e==null)throw new ie("Invalid PeerData");if(e.publicKey!=null&&r.publicKey!=null&&!e.publicKey.equals(r.publicKey))throw new ie("publicKey bytes do not match peer id publicKey bytes");const i=(p=n.existingPeer)==null?void 0:p.peer;if(i!=null&&!r.equals(i.id))throw new ie("peer id did not match existing peer id");let s=(i==null?void 0:i.addresses)??[],o=new Set((i==null?void 0:i.protocols)??[]),a=(i==null?void 0:i.metadata)??new Map,c=(i==null?void 0:i.tags)??new Map,l=i==null?void 0:i.peerRecordEnvelope;if(t==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(s=[],e.multiaddrs!=null&&s.push(...e.multiaddrs.map(f=>({isCertified:!1,multiaddr:f}))),e.addresses!=null&&s.push(...e.addresses)),e.protocols!=null&&(o=new Set(e.protocols)),e.metadata!=null){const f=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);a=Ig(f,{validate:C$})}if(e.tags!=null){const f=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);c=Ig(f,{validate:k$,map:_$})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}if(t==="merge"){if(e.multiaddrs!=null&&s.push(...e.multiaddrs.map(f=>({isCertified:!1,multiaddr:f}))),e.addresses!=null&&s.push(...e.addresses),e.protocols!=null&&(o=new Set([...o,...e.protocols])),e.metadata!=null){const f=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(const[g,v]of f)v==null?a.delete(g):a.set(g,v);a=Ig([...a.entries()],{validate:C$})}if(e.tags!=null){const f=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),g=new Map(c);for(const[v,y]of f)y==null?g.delete(v):g.set(v,y);c=Ig([...g.entries()],{validate:k$,map:_$})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}let d;(i==null?void 0:i.id.publicKey)!=null?d=Oi(i.id.publicKey):e.publicKey!=null?d=Oi(e.publicKey):r.publicKey!=null&&(d=Oi(r.publicKey));const h={addresses:await QEe(r,n.addressFilter??(async()=>!0),s,(w=n.existingPeer)==null?void 0:w.peerPB.addresses),protocols:[...o.values()].sort((f,g)=>f.localeCompare(g)),metadata:a,tags:c,publicKey:d,peerRecordEnvelope:l};return h.addresses.forEach(f=>{var g,v,y;f.observed=((y=(v=(g=n.existingPeer)==null?void 0:g.peerPB.addresses)==null?void 0:v.find(m=>Xe(m.multiaddr,m.multiaddr)))==null?void 0:y.observed)??Date.now()}),r.type!=="RSA"&&delete h.publicKey,h}function Ig(r,e){var n;const t=new Map;for(const[i,s]of r)s!=null&&e.validate(i,s);for(const[i,s]of r.sort(([o],[a])=>o.localeCompare(a)))s!=null&&t.set(i,((n=e.map)==null?void 0:n.call(e,i,s))??s);return t}function C$(r,e){if(typeof r!="string")throw new ie("Metadata key must be a string");if(!(e instanceof Uint8Array))throw new ie("Metadata value must be a Uint8Array")}function k$(r,e){if(typeof r!="string")throw new ie("Tag name must be a string");if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new ie("Tag value must be an integer");if(e.value<0||e.value>100)throw new ie("Tag value must be between 0-100")}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new ie("Tag ttl must be an integer");if(e.ttl<0)throw new ie("Tag ttl must be between greater than 0")}}function _$(r,e){let t;return e.expiry!=null&&(t=e.expiry),e.ttl!=null&&(t=BigInt(Date.now()+Number(e.ttl))),{value:e.value??0,expiry:t}}function Kj(r){const e=r.toString().split("/")[2],t=Er.parse(e,w1);return Mh(t)}function F6(r,e,t){const n=Kj(r);return A9(n,e,t)}function YEe(r,e){return{prefix:Vj,filters:(r.filters??[]).map(t=>({key:n,value:i})=>t(F6(n,i,e))),orders:(r.orders??[]).map(t=>(n,i)=>t(F6(n.key,n.value,e),F6(i.key,i.value,e)))}}var Rn,w2,v2,b2;class XEe{constructor(e,t={}){et(this,Rn);u(this,"peerId");u(this,"datastore");u(this,"lock");u(this,"addressFilter");u(this,"log");u(this,"maxAddressAge");u(this,"maxPeerAge");this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.lock=GS({name:"peer-store",singleProcess:!0}),this.maxAddressAge=t.maxAddressAge??UEe,this.maxPeerAge=t.maxPeerAge??FEe}async has(e){try{return await this.load(e),!0}catch(t){if(t.name!=="NotFoundError")throw t}return!1}async delete(e){this.peerId.equals(e)||await this.datastore.delete(Ag(e))}async load(e){const t=Ag(e),n=await this.datastore.get(t),i=Sl.decode(n);if(De(this,Rn,b2).call(this,e,i))throw await this.datastore.delete(t),new sr;return I9(e,i,this.peerId.equals(e)?1/0:this.maxAddressAge)}async save(e,t){const n=await De(this,Rn,w2).call(this,e),i=await U6(e,t,"patch",{addressFilter:this.addressFilter});return De(this,Rn,v2).call(this,e,i,n)}async patch(e,t){const n=await De(this,Rn,w2).call(this,e),i=await U6(e,t,"patch",{addressFilter:this.addressFilter,existingPeer:n});return De(this,Rn,v2).call(this,e,i,n)}async merge(e,t){const n=await De(this,Rn,w2).call(this,e),i=await U6(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:n});return De(this,Rn,v2).call(this,e,i,n)}async*all(e){for await(const{key:t,value:n}of this.datastore.query(YEe(e??{},this.maxAddressAge))){const i=Kj(t);if(i.equals(this.peerId))continue;const s=Sl.decode(n);if(De(this,Rn,b2).call(this,i,s)){await this.datastore.delete(t);continue}yield I9(i,s,this.peerId.equals(i)?1/0:this.maxAddressAge)}}}Rn=new WeakSet,w2=async function(e){try{const t=Ag(e),n=await this.datastore.get(t),i=Sl.decode(n);if(De(this,Rn,b2).call(this,e,i))throw await this.datastore.delete(t),new sr;return{peerPB:i,peer:A9(e,n,this.maxAddressAge)}}catch(t){t.name!=="NotFoundError"&&this.log.error("invalid peer data found in peer store - %e",t)}},v2=async function(e,t,n){t.updated=Date.now();const i=Sl.encode(t);return await this.datastore.put(Ag(e),i),{peer:A9(e,i,this.maxAddressAge),previous:n==null?void 0:n.peer,updated:n==null||!VEe(t,n.peerPB)}},b2=function(e,t){if(t.updated==null)return!0;if(this.peerId.equals(e))return!1;const n=t.updated<Date.now()-this.maxPeerAge,i=Date.now()-this.maxAddressAge,s=t.addresses.filter(o=>o.observed!=null&&o.observed>i);return n&&s.length===0};var lO,Nd,E2;lO=Symbol.toStringTag;class JEe{constructor(e,t={}){et(this,Nd);u(this,"store");u(this,"events");u(this,"peerId");u(this,"log");u(this,lO,"@libp2p/peer-store");this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new XEe(e,t)}async forEach(e,t){this.log.trace("forEach await read lock");const n=await this.store.lock.readLock();this.log.trace("forEach got read lock");try{for await(const i of this.store.all(t))e(i)}finally{this.log.trace("forEach release read lock"),n()}}async all(e){this.log.trace("all await read lock");const t=await this.store.lock.readLock();this.log.trace("all got read lock");try{return await am(this.store.all(e))}finally{this.log.trace("all release read lock"),t()}}async delete(e){this.log.trace("delete await write lock");const t=await this.store.lock.writeLock();this.log.trace("delete got write lock");try{await this.store.delete(e)}finally{this.log.trace("delete release write lock"),t()}}async has(e){this.log.trace("has await read lock");const t=await this.store.lock.readLock();this.log.trace("has got read lock");try{return await this.store.has(e)}finally{this.log.trace("has release read lock"),t()}}async get(e){this.log.trace("get await read lock");const t=await this.store.lock.readLock();this.log.trace("get got read lock");try{return await this.store.load(e)}finally{this.log.trace("get release read lock"),t()}}async save(e,t){this.log.trace("save await write lock");const n=await this.store.lock.writeLock();this.log.trace("save got write lock");try{const i=await this.store.save(e,t);return De(this,Nd,E2).call(this,e,i),i.peer}finally{this.log.trace("save release write lock"),n()}}async patch(e,t){this.log.trace("patch await write lock");const n=await this.store.lock.writeLock();this.log.trace("patch got write lock");try{const i=await this.store.patch(e,t);return De(this,Nd,E2).call(this,e,i),i.peer}finally{this.log.trace("patch release write lock"),n()}}async merge(e,t){this.log.trace("merge await write lock");const n=await this.store.lock.writeLock();this.log.trace("merge got write lock");try{const i=await this.store.merge(e,t);return De(this,Nd,E2).call(this,e,i),i.peer}finally{this.log.trace("merge release write lock"),n()}}async consumePeerRecord(e,t){const n=await Pc.openAndCertify(e,Hs.DOMAIN),i=Mh(n.publicKey.toCID());if((t==null?void 0:t.equals(i))===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",t,i),!1;const s=Hs.createFromProtobuf(n.payload);let o;try{o=await this.get(i)}catch(a){if(a.name!=="NotFoundError")throw a}if((o==null?void 0:o.peerRecordEnvelope)!=null){const a=await Pc.createFromProtobuf(o.peerRecordEnvelope),c=Hs.createFromProtobuf(a.payload);if(c.seqNumber>=s.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",c.seqNumber,s.seqNumber),!1}return await this.patch(s.peerId,{peerRecordEnvelope:e,addresses:s.multiaddrs.map(a=>({isCertified:!0,multiaddr:a}))}),!0}}Nd=new WeakSet,E2=function(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))};function ZEe(r,e={}){return new JEe(r,e)}function eSe(r,e){let t;const n=function(){const i=function(){t=void 0,r()};clearTimeout(t),t=setTimeout(i,e)};return n.start=()=>{},n.stop=()=>{clearTimeout(t)},n}const T$=864e13,tSe=448,z6=449,rSe=53,nSe=54,iSe=55,sSe=56;class oSe{constructor(e,t={}){u(this,"log");u(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=new Map}has(e){const t=this.findHost(e);for(const n of this.mappings.values())if(n.domain===t)return!0;return!1}add(e,t){t.forEach(n=>{this.log("add DNS mapping %s to %s",n,e);const i=Vc(n)===!0;this.mappings.set(n,{domain:e,verified:i,expires:i?T$-Date.now():0,lastVerified:i?T$-Date.now():void 0})})}remove(e){const t=this.findHost(e);let n=!1;for(const[i,s]of this.mappings.entries())s.domain===t&&(this.log("removing %s to %s DNS mapping %e",i,s.domain,new Error("where")),this.mappings.delete(i),n=n||s.verified);return n}getAll(e){const t=[];for(let n=0;n<e.length;n++){const s=e[n].multiaddr.stringTuples(),o=s[0][1];if(o!=null)for(const[a,c]of this.mappings.entries()){if(o!==a)continue;this.maybeAddSNITuple(s,c.domain)&&(e.splice(n,1),n--,t.push({multiaddr:Fe(`/${s.map(d=>[qe(d[0]).name,d[1]].join("/")).join("/")}`),verified:c.verified,type:"dns-mapping",expires:c.expires,lastVerified:c.lastVerified}))}}return t}maybeAddSNITuple(e,t){var n;for(let i=0;i<e.length;i++)if(e[i][0]===tSe&&((n=e[i+1])==null?void 0:n[0])!==z6)return e.splice(i+1,0,[z6,t]),!0;return!1}confirm(e,t){const n=this.findHost(e);let i=!1;for(const[s,o]of this.mappings.entries())o.domain===n&&(this.log("marking %s to %s DNS mapping as verified",s,o.domain),i=o.verified,o.verified=!0,o.expires=Date.now()+t,o.lastVerified=Date.now());return i}unconfirm(e,t){const n=this.findHost(e);let i=!1;for(const[s,o]of this.mappings.entries())o.domain===n&&(this.log("removing verification of %s to %s DNS mapping",s,o.domain),i=i||o.verified,o.verified=!1,o.expires=Date.now()+t);return i}findHost(e){for(const t of e.stringTuples())if(t[0]===z6||t[0]===rSe||t[0]===nSe||t[0]===iSe||t[0]===sSe)return t[1]}}const V6=4,K6=41,H6=6,aSe=273;class cSe{constructor(e,t={}){u(this,"log");u(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=new Map}has(e){const t=e.stringTuples();for(const n of this.mappings.values())for(const i of n)if(i.externalIp===t[0][1])return!0;return!1}add(e,t,n,i=t,s="tcp"){const o=`${e}-${t}-${s}`,a=this.mappings.get(o)??[],c={internalIp:e,internalPort:t,externalIp:n,externalPort:i,externalFamily:rh(n)?4:6,protocol:s,verified:!1,expires:0};a.push(c),this.mappings.set(o,a)}remove(e){const t=e.stringTuples(),n=t[0][1]??"",i=t[1][0]===H6?"tcp":"udp",s=parseInt(t[1][1]??"0");let o=!1;for(const[a,c]of this.mappings.entries()){for(let l=0;l<c.length;l++){const d=c[l];d.externalIp===n&&d.externalPort===s&&d.protocol===i&&(this.log("removing %s:%s to %s:%s %s IP mapping",d.externalIp,d.externalPort,n,s,i),o=o||d.verified,c.splice(l,1),l--)}c.length===0&&this.mappings.delete(a)}return o}getAll(e){const t=[];for(const{multiaddr:n}of e){const i=n.stringTuples();let s;if((i[0][0]===V6||i[0][0]===K6)&&i[1][0]===H6?s=`${i[0][1]}-${i[1][1]}-tcp`:(i[0][0]===V6||i[0][0]===K6)&&i[1][0]===aSe&&(s=`${i[0][1]}-${i[1][1]}-udp`),s==null)continue;const o=this.mappings.get(s);if(o!=null)for(const a of o)i[0][0]=a.externalFamily===4?V6:K6,i[0][1]=a.externalIp,i[1][1]=`${a.externalPort}`,t.push({multiaddr:Fe(`/${i.map(c=>[qe(c[0]).name,c[1]].join("/")).join("/")}`),verified:a.verified,type:"ip-mapping",expires:a.expires,lastVerified:a.lastVerified})}return t}confirm(e,t){const i=e.stringTuples()[0][1];let s=!1;for(const o of this.mappings.values())for(const a of o)a.externalIp===i&&(this.log("marking %s to %s IP mapping as verified",a.internalIp,a.externalIp),s=a.verified,a.verified=!0,a.expires=Date.now()+t,a.lastVerified=Date.now());return s}unconfirm(e,t){const n=e.stringTuples(),i=n[0][1]??"",s=n[1][0]===H6?"tcp":"udp",o=parseInt(n[1][1]??"0");let a=!1;for(const c of this.mappings.values())for(let l=0;l<c.length;l++){const d=c[l];d.externalIp===i&&d.externalPort===o&&d.protocol===s&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",d.externalIp,d.externalPort,i,o,s),a=a||d.verified,d.verified=!1,d.expires=Date.now()+t)}return a}}const lSe=4,uSe=41;function dSe(r){try{const[[e,t]]=r.stringTuples();if(t==null)return!1;if(e===lSe)return t.startsWith("169.254.");if(e===uSe)return t.toLowerCase().startsWith("fe80")}catch{}return!1}const hSe={maxObservedAddresses:10};class fSe{constructor(e,t={}){u(this,"log");u(this,"addresses");u(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??hSe.maxObservedAddresses}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(const t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&(Tc(e)||dSe(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:Fe(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){var n;const t=((n=this.addresses.get(e.toString()))==null?void 0:n.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){const n=e.toString(),i=this.addresses.get(n)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},s=i.verified;return i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now(),this.log("marking observed address %a as verified",n),this.addresses.set(n,i),s}}const pSe=4,gSe=41,ySe=53,mSe=54,wSe=55,vSe=56,bSe=[pSe,gSe,ySe,mSe,wSe,vSe];function P$(r){try{const[[e]]=r.stringTuples();return bSe.includes(e)}catch{}return!1}const ESe={maxObservedAddresses:10};class SSe{constructor(e,t={}){u(this,"log");u(this,"addresses");u(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??ESe.maxObservedAddresses}get(e,t){if(Tc(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};const n=this.toKey(e);let i=this.addresses.get(n);return i==null&&(i={verified:!P$(e),expires:0},this.addresses.set(n,i)),{multiaddr:e,verified:i.verified,type:"transport",expires:i.expires,lastVerified:i.lastVerified}}has(e){const t=this.toKey(e);return this.addresses.has(t)}remove(e){var i;const t=this.toKey(e),n=((i=this.addresses.get(t))==null?void 0:i.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),n}confirm(e,t){const n=this.toKey(e),i=this.addresses.get(n)??{verified:!1,expires:0,lastVerified:0},s=i.verified;return i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now(),this.addresses.set(n,i),s}unconfirm(e,t){const n=this.toKey(e),i=this.addresses.get(n)??{verified:!1,expires:0},s=i.verified;return i.verified=!1,i.expires=Date.now()+t,this.addresses.set(n,i),s}toKey(e){if(P$(e)){const t=e.toOptions();return`${t.host}-${t.port}-${t.transport}`}return e.toString()}}const D$=6e4,$$={addressVerificationTTL:D$*10,addressVerificationRetry:D$*5},xSe=r=>r;function j6(r,e){const t=r.getPeerId();return t!=null&&Zt(t).equals(e)&&(r=r.decapsulate(Fe(`/p2p/${e.toString()}`))),r}var uO;uO=Symbol.toStringTag;class ASe{constructor(e,t={}){u(this,"log");u(this,"components");u(this,"listen");u(this,"announce");u(this,"appendAnnounce");u(this,"announceFilter");u(this,"observed");u(this,"dnsMappings");u(this,"ipMappings");u(this,"transportAddresses");u(this,"observedAddressFilter");u(this,"addressVerificationTTL");u(this,"addressVerificationRetry");u(this,uO,"@libp2p/address-manager");const{listen:n=[],announce:i=[],appendAnnounce:s=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=n.map(o=>o.toString()),this.announce=new Set(i.map(o=>o.toString())),this.appendAnnounce=new Set(s.map(o=>o.toString())),this.observed=new fSe(e,t),this.dnsMappings=new oSe(e,t),this.ipMappings=new cSe(e,t),this.transportAddresses=new SSe(e,t),this.announceFilter=t.announceFilter??xSe,this.observedAddressFilter=Ql(1024),this.addressVerificationTTL=t.addressVerificationTTL??$$.addressVerificationTTL,this.addressVerificationRetry=t.addressVerificationRetry??$$.addressVerificationRetry,this._updatePeerStoreAddresses=eSe(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}_updatePeerStoreAddresses(){const e=this.getAddresses().map(t=>t.getPeerId()===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(t=>{this.log.error("error updating addresses",t)})}getListenAddrs(){return Array.from(this.listen).map(e=>Fe(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>Fe(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>Fe(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){const t=e.stringTuples(),n=`${t[0][1]}:${t[1][1]}`;this.observedAddressFilter.has(n)||(this.observedAddressFilter.add(n),e=j6(e,this.components.peerId),!this.ipMappings.has(e)&&(this.dnsMappings.has(e)||this.observed.add(e)))}confirmObservedAddr(e,t){e=j6(e,this.components.peerId);let n=!0;((t==null?void 0:t.type)==="transport"||this.transportAddresses.has(e))&&!this.transportAddresses.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="dns-mapping"||this.dnsMappings.has(e))&&!this.dnsMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="ip-mapping"||this.ipMappings.has(e))&&!this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="observed"||this.observed.has(e))&&(this.maybeUpgradeToIPMapping(e)?(this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL),n=!1):!this.observed.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1)),n||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=j6(e,this.components.peerId),this.observed.has(e)&&this.observed.remove(e),this.transportAddresses.has(e)&&this.transportAddresses.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.dnsMappings.has(e)&&this.dnsMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.ipMappings.has(e)&&this.ipMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry)}getAddresses(){const e=new Set,t=this.getAddressesWithMetadata().filter(n=>{if(!n.verified)return!1;const i=n.multiaddr.toString();return e.has(i)?!1:(e.add(i),!0)}).map(n=>n.multiaddr);return this.announceFilter(t.map(n=>{var s;const i=Fe(n);return((s=i.protos().pop())==null?void 0:s.path)===!0||i.getPeerId()===this.components.peerId.toString()?i:i.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){const e=this.getAnnounceAddrs();if(e.length>0)return this.components.transportManager.getListeners().forEach(i=>{i.updateAnnounceAddrs(e)}),e.map(i=>({multiaddr:i,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];t=t.concat(this.components.transportManager.getAddrs().map(i=>this.transportAddresses.get(i,this.addressVerificationTTL)));const n=this.getAppendAnnounceAddrs();return n.length>0&&(this.components.transportManager.getListeners().forEach(i=>{i.updateAnnounceAddrs(n)}),t=t.concat(n.map(i=>({multiaddr:i,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),t=t.concat(this.observed.getAll()),t=t.concat(this.ipMappings.getAll(t)),t=t.concat(this.dnsMappings.getAll(t)),t}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove(Fe(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,n,i=t,s="tcp"){this.ipMappings.add(e,t,n,i,s),this.observed.removePrefixed(`/ip${rh(n)?4:6}/${n}/${s}/${i}`)}removePublicAddressMapping(e,t,n,i=t,s="tcp"){this.ipMappings.remove(Fe(`/ip${rh(n)?4:6}/${n}/${s}/${i}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(e){if(this.ipMappings.has(e))return!1;const t=e.toOptions();if(t.family===6||t.host==="127.0.0.1"||Vc(t.host)===!0)return!1;const n=this.components.transportManager.getListeners(),i=[s=>ep.exactMatch(s)||Hy.exactMatch(s),s=>Ky.exactMatch(s),s=>Hhe.exactMatch(s)];for(const s of i){if(!s(e))continue;const o=n.filter(l=>l.getAddrs().filter(d=>d.toOptions().family===4&&s(d)).length>0);if(o.length!==1)continue;const a=o[0].getAddrs().filter(l=>l.toOptions().host!=="127.0.0.1").pop();if(a==null)continue;const c=a.toOptions();return this.observed.remove(e),this.ipMappings.add(c.host,c.port,t.host,t.port,t.transport),!0}return!1}}var N$;(function(r){r.NOT_STARTED_YET="The libp2p node is not started yet",r.NOT_FOUND="Not found"})(N$||(N$={}));class ISe extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}}class CSe extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}}class q6 extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}}class O$ extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}}class kSe extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}}class _Se extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}}class TSe extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}}class M$ extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}}class PSe extends Error{constructor(e="No transport was configured to listen on this address"){super(e),this.name="UnsupportedListenAddressError"}}class DSe extends Error{constructor(e="Configured listen addresses could not be listened on"){super(e),this.name="UnsupportedListenAddressesError"}}class $Se extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}}class NSe extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}}class OSe extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}}class Cg extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}}class kg extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}}class MSe extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}}class RSe{constructor(e={}){u(this,"components",{});u(this,"_started",!1);this.components={};for(const[t,n]of Object.entries(e))this.components[t]=n;this.components.logger==null&&(this.components.logger=vw())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(t=>uS(t)).map(async t=>{var n;await((n=t[e])==null?void 0:n.call(t))}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const LSe=["metrics","connectionProtector","dns"],BSe=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function USe(r={}){const e=new RSe(r);return new Proxy(e,{get(n,i,s){if(typeof i=="string"&&!BSe.includes(i)){const o=e.components[i];if(o==null&&!LSe.includes(i))throw new ISe(`${i} not set`);return o}return Reflect.get(n,i,s)},set(n,i,s){return typeof i=="string"?e.components[i]=s:Reflect.set(n,i,s),!0}})}function FSe(r){const e={};for(const t of Object.values(r.components))for(const n of zSe(t))e[n]=!0;for(const t of Object.values(r.components))for(const n of VSe(t))if(e[n]!==!0)throw new CSe(`Service "${KSe(t)}" required capability "${n}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function zSe(r){return Array.isArray(r==null?void 0:r[lr])?r[lr]:[]}function VSe(r){return Array.isArray(r==null?void 0:r[Sc])?r[Sc]:[]}function KSe(r){return(r==null?void 0:r[Symbol.toStringTag])??(r==null?void 0:r.toString())??"unknown"}const HSe=4,jSe=41;function qSe(r={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{if(ep.matches(e))return!1;const t=e.stringTuples();return t[0][0]===HSe||t[0][0]===jSe?!!Vc(`${t[0][1]}`):!1},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...r}}function Hj(r){if(iB(r))return{peerId:r,multiaddrs:[]};let e=Array.isArray(r)?r:[r],t;if(e.length>0){const n=e[0].getPeerId();t=n==null?void 0:Zt(n),e.forEach(i=>{if(!Pw(i))throw new ew("Invalid multiaddr");const s=i.getPeerId();if(s==null){if(t!=null)throw new ie("Multiaddrs must all have the same peer id or have no peer id")}else{const o=Zt(s);if((t==null?void 0:t.equals(o))!==!0)throw new ie("Multiaddrs must all have the same peer id or have no peer id")}})}return e=e.filter(n=>!Fhe.exactMatch(n)),{peerId:t,multiaddrs:e}}const WSe=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function GSe(r,e){var i;const t=((i=r==null?void 0:r.streams)==null?void 0:i.map(s=>s.protocol))??[],n=(e==null?void 0:e.closableProtocols)??WSe;if(!(t.filter(s=>s!=null&&!n.includes(s)).length>0))try{await(r==null?void 0:r.close(e))}catch(s){r==null||r.abort(s)}}const jj=1e4,QSe=1e4,R$=1e4,qj=25,YSe=5,XSe=10,JSe=5,ZSe="last-dial-failure",exe="last-dial-success",Wj=500,Gj=100,Qj=50;async function txe(r,e){let t=!1;for(const i of hx.keys())if(t=r.protoNames().includes(i),t)break;if(!t)return[r];const n=await r.resolve(e);return e.log("resolved %s to",r,n.map(i=>i.toString())),n}function C9(r){try{let e;if(typeof r=="string"?e=Fe(r):e=r,!e.protoNames().includes("ipcidr")){const n=e.protoNames().includes("ip6")?"/ipcidr/128":"/ipcidr/32";e=e.encapsulate(n)}return D1e(e)}catch{throw new Error(`Can't convert to IpNet, Invalid multiaddr format: ${r}`)}}const rxe={maxConnections:Gj};class nxe{constructor(e,t={}){u(this,"maxConnections");u(this,"connectionManager");u(this,"peerStore");u(this,"allow");u(this,"events");u(this,"log");this.maxConnections=t.maxConnections??rxe.maxConnections,this.allow=(t.allow??[]).map(n=>C9(n)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections %e",e)})}async _maybePruneConnections(){const e=this.connectionManager.getConnections(),t=e.length;if(this.log("checking max connections limit %d/%d",t,this.maxConnections),t<=this.maxConnections)return;const n=new zc;for(const a of e){const c=a.remotePeer;if(!n.has(c)){n.set(c,0);try{const l=await this.peerStore.get(c);n.set(c,[...l.tags.values()].reduce((d,h)=>d+h.value,0))}catch(l){l.name!=="NotFoundError"&&this.log.error("error loading peer tags",l)}}}const i=this.sortConnections(e,n),s=Math.max(t-this.maxConnections,0),o=[];for(const a of i)if(this.log("too many connections open - closing a connection to %p",a.remotePeer),this.allow.some(l=>l.contains(a.remoteAddr.nodeAddress().address))||o.push(a),o.length===s)break;await Promise.all(o.map(async a=>{await GSe(a,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:o})}sortConnections(e,t){return e.sort((n,i)=>{const s=n.timeline.open,o=i.timeline.open;return s<o?1:s>o?-1:0}).sort((n,i)=>n.direction==="outbound"&&i.direction==="inbound"?1:n.direction==="inbound"&&i.direction==="outbound"?-1:0).sort((n,i)=>n.streams.length>i.streams.length?1:n.streams.length<i.streams.length?-1:0).sort((n,i)=>{const s=t.get(n.remotePeer)??0,o=t.get(i.remotePeer)??0;return s>o?1:s<o?-1:0})}}class ixe extends Gl{constructor(e={}){super({...e,sort:(t,n)=>t.options.priority>n.options.priority?-1:t.options.priority<n.options.priority?1:0})}}function sxe(r){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r)||/^::1$/.test(r)}function L$(r){if(!NV(r))return!1;const{address:e}=r.nodeAddress();return sxe(e)}function oxe(r,e){const t=Ky.exactMatch(r.multiaddr),n=Ky.exactMatch(e.multiaddr);if(t&&!n)return-1;if(!t&&n)return 1;const i=Hy.exactMatch(r.multiaddr),s=Hy.exactMatch(e.multiaddr);if(i&&!s)return-1;if(!i&&s)return 1;const o=ep.exactMatch(r.multiaddr),a=ep.exactMatch(e.multiaddr);if(o&&!a)return-1;if(!o&&a)return 1;const c=ob.exactMatch(r.multiaddr),l=ob.exactMatch(e.multiaddr);if(c&&!l)return-1;if(!c&&l)return 1;const d=sb.exactMatch(r.multiaddr),h=sb.exactMatch(e.multiaddr);if(d&&!h)return-1;if(!d&&h)return 1;const p=C_.exactMatch(r.multiaddr),w=C_.exactMatch(e.multiaddr);return p&&!w?-1:!p&&w?1:0}function axe(r,e){const t=L$(r.multiaddr),n=L$(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function cxe(r,e){const t=Tc(r.multiaddr),n=Tc(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function lxe(r,e){return r.isCertified&&!e.isCertified?-1:!r.isCertified&&e.isCertified?1:0}function uxe(r,e){const t=kc.exactMatch(r.multiaddr),n=kc.exactMatch(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function dxe(r){return r.sort(oxe).sort(lxe).sort(uxe).sort(cxe).sort(axe)}const _g={maxParallelDials:Qj,maxDialQueueLength:Wj,maxPeerAddrsToDial:qj,dialTimeout:jj};class hxe{constructor(e,t={}){u(this,"queue");u(this,"components");u(this,"addressSorter");u(this,"maxPeerAddrsToDial");u(this,"maxDialQueueLength");u(this,"dialTimeout");u(this,"shutDownController");u(this,"connections");u(this,"log");this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??_g.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??_g.maxDialQueueLength,this.dialTimeout=t.dialTimeout??_g.dialTimeout,this.connections=t.connections??new zc,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.shutDownController=new AbortController,this.shutDownController.signal;for(const[n,i]of Object.entries(t.resolvers??{}))hx.set(n,i);this.queue=new ixe({concurrency:t.maxParallelDials??_g.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",n=>{var i;((i=n.detail)==null?void 0:i.name)!==jl.name&&this.log.error("error in dial queue - %e",n.detail)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e,t={}){var a,c,l;const{peerId:n,multiaddrs:i}=Hj(e),s=Array.from(this.connections.values()).flat().find(d=>t.force===!0?!1:d.remotePeer.equals(n)?!0:i.find(h=>h.equals(d.remoteAddr)));if((s==null?void 0:s.status)==="open")return this.log("already connected to %a",s.remoteAddr),(a=t.onProgress)==null||a.call(t,new Ne("dial-queue:already-connected")),s;const o=this.queue.queue.find(d=>{if((n==null?void 0:n.equals(d.options.peerId))===!0)return!0;const h=d.options.multiaddrs;if(h==null)return!1;for(const p of i)if(h.has(p.toString()))return!0;return!1});if(o!=null){this.log("joining existing dial target for %p",n);for(const d of i)o.options.multiaddrs.add(d.toString());return(c=t.onProgress)==null||c.call(t,new Ne("dial-queue:already-in-dial-queue")),o.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new pd("Dial queue is full");return this.log("creating dial target for %p",n,i.map(d=>d.toString())),(l=t.onProgress)==null||l.call(t,new Ne("dial-queue:add-to-dial-queue")),this.queue.add(async d=>{var p;(p=d.onProgress)==null||p.call(d,new Ne("dial-queue:start-dial"));const h=bt([this.shutDownController.signal,d.signal]);try{return await this.dialPeer(d,h)}finally{h.clear()}},{peerId:n,priority:t.priority??Xj,multiaddrs:new Set(i.map(d=>d.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})}async dialPeer(e,t){var d;const n=e.peerId,i=e.multiaddrs,s=new Set;let o=e.multiaddrs.size===0,a=0,c=0;const l=[];for(this.log("starting dial to %p",n);o||i.size>0;){c++,o=!1;const h=[],p=new Set(e.multiaddrs);i.clear(),this.log("calculating addrs to dial %p from %s",n,[...p]);const w=await this.calculateMultiaddrs(n,p,{...e,signal:t});for(const f of w){if(s.has(f.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",f.multiaddr,n);continue}h.push(f)}this.log("%s dial to %p with %s",c===1?"starting":"continuing",n,h.map(f=>f.multiaddr.toString())),(d=e==null?void 0:e.onProgress)==null||d.call(e,new Ne("dial-queue:calculated-addresses",h));for(const f of h){if(a===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",a,e.peerId),new pd("Peer had more than maxPeerAddrsToDial");a++;try{const g=await this.components.transportManager.dial(f.multiaddr,{...e,signal:t});this.log("dial to %a succeeded",f.multiaddr);try{await this.components.peerStore.merge(g.remotePeer,{multiaddrs:[g.remoteAddr],metadata:{[exe]:fe(Date.now().toString())}})}catch(v){this.log.error("could not update last dial failure key for %p",n,v)}return g}catch(g){if(this.log.error("dial failed to %a",f.multiaddr,g),s.add(f.multiaddr.toString()),n!=null)try{await this.components.peerStore.merge(n,{metadata:{[ZSe]:fe(Date.now().toString())}})}catch(v){this.log.error("could not update last dial failure key for %p",n,v)}if(t.aborted)throw new Vp(g.message);l.push(g)}}}throw l.length===1?l[0]:new AggregateError(l,"All multiaddr dials failed")}async calculateMultiaddrs(e,t=new Set,n={}){var h,p;const i=[...t].map(w=>({multiaddr:Fe(w),isCertified:!1}));if(e!=null){if(this.components.peerId.equals(e))throw new pd("Tried to dial self");if(await((p=(h=this.components.connectionGater).denyDialPeer)==null?void 0:p.call(h,e))===!0)throw new M$("The dial request is blocked by gater.allowDialPeer");if(i.length===0){this.log("loading multiaddrs for %p",e);try{const w=await this.components.peerStore.get(e);i.push(...w.addresses),this.log("loaded multiaddrs for %p",e,i.map(({multiaddr:f})=>f.toString()))}catch(w){if(w.name!=="NotFoundError")throw w}}if(i.length===0){this.log("looking up multiaddrs for %p in the peer routing",e);try{const w=await this.components.peerRouting.findPeer(e,n);this.log("found multiaddrs for %p in the peer routing",e,i.map(({multiaddr:f})=>f.toString())),i.push(...w.multiaddrs.map(f=>({multiaddr:f,isCertified:!1})))}catch(w){w.name==="NoPeerRoutersError"?this.log("no peer routers configured",e):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",e,w)}}}let s=(await Promise.all(i.map(async w=>{const f=await txe(w.multiaddr,{dns:this.components.dns,...n,log:this.log});return f.length===1&&f[0].equals(w.multiaddr)?w:f.map(g=>({multiaddr:g,isCertified:!1}))}))).flat();if(e!=null){const w=`/p2p/${e.toString()}`;s=s.map(f=>{const g=f.multiaddr.protos().pop();return(g==null?void 0:g.path)===!0?f:f.multiaddr.getPeerId()==null?{multiaddr:f.multiaddr.encapsulate(w),isCertified:f.isCertified}:f})}const o=s.filter(w=>{if(this.components.transportManager.dialTransportForMultiaddr(w.multiaddr)==null)return!1;const f=w.multiaddr.getPeerId();return e!=null&&f!=null?e.equals(f):!0}),a=new Map;for(const w of o){const f=w.multiaddr.toString(),g=a.get(f);if(g!=null){g.isCertified=g.isCertified||w.isCertified||!1;continue}a.set(f,w)}const c=[...a.values()];if(c.length===0)throw new $Se("The dial request has no valid addresses");const l=[];for(const w of c)this.components.connectionGater.denyDialMultiaddr!=null&&await this.components.connectionGater.denyDialMultiaddr(w.multiaddr)||l.push(w);const d=this.addressSorter==null?dxe(l):l.sort(this.addressSorter);if(d.length===0)throw new M$("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",s.map(({multiaddr:w})=>w.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",d.map(({multiaddr:w})=>w.toString())),d}async isDialable(e,t={}){Array.isArray(e)||(e=[e]);try{const n=await this.calculateMultiaddrs(void 0,new Set(e.map(i=>i.toString())),t);return t.runOnLimitedConnection===!1?n.find(i=>!kc.matches(i.multiaddr))!=null:!0}catch(n){this.log.trace("error calculating if multiaddr(s) were dialable",n)}return!1}}var Yj={};function Ui(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var fxe=Ui;Ui.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Ui.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Ui.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};Ui.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Ui.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};Ui.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};Ui.prototype.start=Ui.prototype.try;Ui.prototype.errors=function(){return this._errors};Ui.prototype.attempts=function(){return this._attempts};Ui.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var i=this._errors[n],s=i.message,o=(r[s]||0)+1;r[s]=o,o>=t&&(e=i,t=o)}return e};(function(r){var e=fxe;r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in t)n[i]=t[i];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],o=0;o<n.retries;o++)s.push(this.createTimeout(o,n));return t&&t.forever&&!s.length&&s.push(this.createTimeout(o,n)),s.sort(function(a,c){return a-c}),s},r.createTimeout=function(t,n){var i=n.randomize?Math.random()+1:1,s=Math.round(i*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return s=Math.min(s,n.maxTimeout),s},r.wrap=function(t,n,i){if(n instanceof Array&&(i=n,n=null),!i){i=[];for(var s in t)typeof t[s]=="function"&&i.push(s)}for(var o=0;o<i.length;o++){var a=i[o],c=t[a];t[a]=(function(d){var h=r.operation(n),p=Array.prototype.slice.call(arguments,1),w=p.pop();p.push(function(f){h.retry(f)||(f&&(arguments[0]=h.mainError()),w.apply(this,arguments))}),h.attempt(function(){d.apply(t,p)})}).bind(t,c),t[a].options=n}}})(Yj);var pxe=Yj;const gxe=Qs(pxe),yxe=Object.prototype.toString,mxe=r=>yxe.call(r)==="[object Error]",wxe=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function vxe(r){return r&&mxe(r)&&r.name==="TypeError"&&typeof r.message=="string"?r.message==="Load failed"?r.stack===void 0:wxe.has(r.message):!1}class bxe extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const B$=(r,e,t)=>{const n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r};async function Exe(r,e){return new Promise((t,n)=>{e={...e},e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.retries??(e.retries=10);const i=gxe.operation(e),s=()=>{var a;i.stop(),n((a=e.signal)==null?void 0:a.reason)};e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",s,{once:!0});const o=()=>{var a;(a=e.signal)==null||a.removeEventListener("abort",s),i.stop()};i.attempt(async a=>{try{const c=await r(a);o(),t(c)}catch(c){try{if(!(c instanceof Error))throw new TypeError(`Non-error was thrown: "${c}". You should only throw errors.`);if(c instanceof bxe)throw c.originalError;if(c instanceof TypeError&&!vxe(c))throw c;if(B$(c,a,e),await e.shouldRetry(c)||(i.stop(),n(c)),await e.onFailedAttempt(c),!i.retry(c))throw i.mainError()}catch(l){B$(l,a,e),o(),n(l)}}})})}class Sxe{constructor(e,t={}){u(this,"log");u(this,"queue");u(this,"started");u(this,"peerStore");u(this,"retries");u(this,"retryInterval");u(this,"backoffFactor");u(this,"connectionManager");u(this,"events");this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new Ic({concurrency:t.maxParallelReconnects??JSe,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",n=>{this.maybeReconnect(n.detail).catch(i=>{this.log.error("failed to maybe reconnect to %p - %e",n.detail,i)})})}async maybeReconnect(e){if(!this.started)return;const t=await this.peerStore.get(e);U$(t)&&(this.queue.has(e)||this.queue.add(async n=>{await Exe(async i=>{if(this.started)try{await this.connectionManager.openConnection(e,{signal:n==null?void 0:n.signal})}catch(s){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,i,this.retries,s),s}},{signal:n==null?void 0:n.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:e}).catch(async n=>{this.log.error("failed to reconnect to %p - %e",e,n);const i={};[...t.tags.keys()].forEach(s=>{s.startsWith(J3)&&(i[s]=void 0)}),await this.peerStore.merge(e,{tags:i}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})}).catch(async n=>{this.log.error("failed to remove keep-alive tag from %p - %e",e,n)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[t=>U$(t)]});await Promise.all(e.map(async t=>{await this.connectionManager.openConnection(t.id).catch(n=>{this.log.error(n)})}))}).catch(e=>{this.log.error(e)})}stop(){this.started=!1,this.queue.abort()}}function U$(r){for(const e of r.tags.keys())if(e.startsWith(J3))return!0;return!1}const Xj=50,W6={maxConnections:Gj,inboundConnectionThreshold:YSe,maxIncomingPendingConnections:XSe};var dO;dO=Symbol.toStringTag;class xxe{constructor(e,t={}){u(this,"started");u(this,"connections");u(this,"allow");u(this,"deny");u(this,"maxIncomingPendingConnections");u(this,"incomingPendingConnections");u(this,"outboundPendingConnections");u(this,"maxConnections");u(this,"dialQueue");u(this,"reconnectQueue");u(this,"connectionPruner");u(this,"inboundConnectionRateLimiter");u(this,"peerStore");u(this,"metrics");u(this,"events");u(this,"log");u(this,"peerId");u(this,dO,"@libp2p/connection-manager");var n;if(this.maxConnections=t.maxConnections??W6.maxConnections,this.maxConnections<1)throw new ie("Connection Manager maxConnections must be greater than 0");this.connections=new zc,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(i=>C9(i)),this.deny=(t.deny??[]).map(i=>C9(i)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??W6.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new SH({points:t.inboundConnectionThreshold??W6.inboundConnectionThreshold,duration:1}),this.connectionPruner=new nxe({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{maxConnections:this.maxConnections,allow:(n=t.allow)==null?void 0:n.map(i=>Fe(i))}),this.dialQueue=new hxe(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??Qj,maxDialQueueLength:t.maxDialQueueLength??Wj,maxPeerAddrsToDial:t.maxPeerAddrsToDial??qj,dialTimeout:t.dialTimeout??jj,resolvers:t.resolvers??{dnsaddr:Oj},connections:this.connections}),this.reconnectQueue=new Sxe({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}async start(){var e,t,n;(e=this.metrics)==null||e.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const i={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(const s of this.connections.values())for(const o of s)i[o.direction]++;return i}}),(t=this.metrics)==null||t.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const i={};for(const s of this.connections.values())for(const o of s)for(const a of o.streams){const c=`${a.direction} ${a.protocol??"unnegotiated"}`;i[c]=(i[c]??0)+1}return i}}),(n=this.metrics)==null||n.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const i={};for(const o of this.connections.values())for(const a of o){const c={};for(const l of a.streams){const d=`${l.direction} ${l.protocol??"unnegotiated"}`;c[d]=(c[d]??0)+1}for(const[l,d]of Object.entries(c))i[l]=i[l]??[],i[l].push(d)}const s={};for(let[o,a]of Object.entries(i)){a=a.sort((l,d)=>l-d);const c=Math.floor(a.length*.9);s[o]=a[c]}return s}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await Ko(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await Uc(this.reconnectQueue,this.dialQueue,this.connectionPruner);const e=[];for(const t of this.connections.values())for(const n of t)e.push((async()=>{try{await n.close()}catch(i){this.log.error(i)}})());this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}onConnect(e){this._onConnect(e).catch(t=>{this.log.error(t)})}async _onConnect(e){const{detail:t}=e;if(!this.started){await t.close();return}if(t.status!=="open")return;const n=t.remotePeer,i=!this.connections.has(n),s=this.connections.get(n)??[];s.push(t),this.connections.set(n,s),n.publicKey!=null&&n.type==="RSA"&&await this.peerStore.patch(n,{publicKey:n.publicKey}),i&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){const{detail:t}=e,n=t.remotePeer,s=(this.connections.get(n)??[]).filter(o=>o.id!==t.id);this.connections.set(n,s),s.length===0&&(this.log("onDisconnect remove all connections for peer %p",n),this.connections.delete(n),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let t=[];for(const n of this.connections.values())t=t.concat(n);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){var n,i;if(!this.started)throw new ql("Not started");this.outboundPendingConnections++;try{(n=t.signal)==null||n.throwIfAborted();const{peerId:s}=Hj(e);if(this.peerId.equals(s))throw new cS("Can not dial self");if(s!=null&&t.force!==!0){this.log("dial %p",s);const l=this.getConnections(s).find(d=>d.limits==null);if(l!=null)return this.log("had an existing non-limited connection to %p",s),(i=t.onProgress)==null||i.call(t,new Ne("dial-queue:already-connected")),l}const o=await this.dialQueue.dial(e,{...t,priority:t.priority??Xj});if(o.status!=="open")throw new oS("Remote closed connection during opening");let a=this.connections.get(o.remotePeer);a==null&&(a=[],this.connections.set(o.remotePeer,a));let c=!1;for(const l of a)if(l.id===o.id&&(c=!0),t.force!==!0&&l.id!==o.id&&l.remoteAddr.equals(o.remoteAddr))return o.abort(new ew("Duplicate multiaddr connection")),l;return c||a.push(o),o}finally{this.outboundPendingConnections--}}async closeConnections(e,t={}){const n=this.connections.get(e)??[];await Promise.all(n.map(async i=>{try{await i.close(t)}catch(s){i.abort(s)}}))}async acceptIncomingConnection(e){if(this.deny.some(i=>i.contains(e.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(i=>i.contains(e.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const i=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(i,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,i),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(n=>Fe(n))}))}async isDialable(e,t={}){return this.dialQueue.isDialable(e,t)}}const Axe=1e4,Ixe="1.0.0",Cxe="ping",kxe="ipfs",F$=32,_xe=!0;var hO,fO;fO=Symbol.toStringTag,hO=lr;class Txe{constructor(e,t={}){u(this,"protocol");u(this,"components");u(this,"log");u(this,"heartbeatInterval");u(this,"pingIntervalMs");u(this,"abortController");u(this,"timeout");u(this,"abortConnectionOnPingFailure");u(this,fO,"@libp2p/connection-monitor");u(this,hO,["@libp2p/connection-monitor"]);this.components=e,this.protocol=`/${t.protocolPrefix??kxe}/${Cxe}/${Ixe}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??Axe,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??_xe,this.timeout=new op({...t.pingTimeout??{},metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(async()=>{var n;let t=Date.now();try{const i=this.timeout.getTimeoutSignal({signal:(n=this.abortController)==null?void 0:n.signal}),s=await e.newStream(this.protocol,{signal:i,runOnLimitedConnection:!0}),o=cm(s);t=Date.now(),await Promise.all([o.write(Ac(F$),{signal:i}),o.read({bytes:F$,signal:i})]),e.rtt=Date.now()-t,await o.unwrap().close({signal:i})}catch(i){if(i.name!=="UnsupportedProtocolError")throw i;e.rtt=(Date.now()-t)/2}}).catch(t=>{this.log.error("error during heartbeat",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){var e;(e=this.abortController)==null||e.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}}var pO;pO=Symbol.toStringTag;class Pxe{constructor(e,t){u(this,"routers");u(this,"started");u(this,"components");u(this,pO,"@libp2p/content-routing");var n,i,s,o,a;this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()}),getAttributesFromYieldedValue:(c,l)=>({...l,providers:[...Array.isArray(l.providers)?l.providers:[],c.id.toString()]})}))??this.findProviders,this.provide=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.provide,this.cancelReprovide=((s=e.metrics)==null?void 0:s.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.cancelReprovide,this.put=((o=e.metrics)==null?void 0:o.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([c])=>({key:ae(c,"base36")})}))??this.put,this.get=((a=e.metrics)==null?void 0:a.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([c])=>({key:ae(c,"base36")})}))??this.get}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw new q6("No content routers available");const n=this,i=new us;for await(const s of lc(...n.routers.map(o=>o.findProviders(e,t))))s!=null&&(s.multiaddrs.length>0&&await this.components.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),!i.has(s.id)&&(i.add(s.id),yield s))}async provide(e,t={}){if(this.routers.length===0)throw new q6("No content routers available");await Promise.all(this.routers.map(async n=>{await n.provide(e,t)}))}async cancelReprovide(e,t={}){if(this.routers.length===0)throw new q6("No content routers available");await Promise.all(this.routers.map(async n=>{await n.cancelReprovide(e,t)}))}async put(e,t,n){if(!this.isStarted())throw new ql;await Promise.all(this.routers.map(async i=>{await i.put(e,t,n)}))}async get(e,t){if(!this.isStarted())throw new ql;return Promise.any(this.routers.map(async n=>n.get(e,t)))}}var gO;gO=Symbol.toStringTag;class Dxe{constructor(e,t={}){u(this,"log");u(this,"peerId");u(this,"peerStore");u(this,"routers");u(this,gO,"@libp2p/peer-routing");var n,i;this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([s],o)=>({...o,peer:s.toString()})}))??this.findPeer,this.getClosestPeers=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([s],o)=>({...o,key:ae(s,"base36")}),getAttributesFromYieldedValue:(s,o)=>({...o,peers:[...Array.isArray(o.peers)?o.peers:[],s.id.toString()]})}))??this.getClosestPeers}async findPeer(e,t){if(this.routers.length===0)throw new O$("No peer routers available");if(e.toString()===this.peerId.toString())throw new kSe("Should not try to find self");const n=this,i=lc(...this.routers.map(s=>async function*(){try{yield await s.findPeer(e,t)}catch(o){n.log.error(o)}}()));for await(const s of i)if(s!=null)return s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),s;throw new sr}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new O$("No peer routers available");const n=this,i=Ql(1024);for await(const s of Jp(async function*(){const o=lc(...n.routers.map(a=>a.getClosestPeers(e,t)));for await(let a of o)yield async()=>{if(a.multiaddrs.length===0)try{a=await n.findPeer(a.id,{...t,useCache:!1})}catch(c){n.log.error("could not find peer multiaddrs",c);return}return a}}()))s!=null&&(s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),!i.has(s.id.toMultihash().bytes)&&(i.add(s.id.toMultihash().bytes),yield s))}}var yO,mO;class $xe extends(mO=tr,yO=Symbol.toStringTag,mO){constructor(t){super();u(this,"peerRouting");u(this,"log");u(this,"walking");u(this,"walkers");u(this,"shutdownController");u(this,"walkController");u(this,"needNext");u(this,yO,"@libp2p/random-walk");this.log=t.logger.forComponent("libp2p:random-walk"),this.peerRouting=t.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}async*walk(t){var i,s;this.walking||this.startWalk(),this.walkers++;const n=bt([this.shutdownController.signal,t==null?void 0:t.signal]);try{for(;;)(i=this.needNext)==null||i.resolve(),this.needNext=Ve(),yield(await Ti(this,"walk:peer",n,{errorEvent:"walk:error"})).detail}finally{n.clear(),this.walkers--,this.walkers===0&&((s=this.walkController)==null||s.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;const t=bt([this.walkController.signal,this.shutdownController.signal]),n=Date.now();let i=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const s=Ac(32);let o=Date.now();for await(const a of this.peerRouting.getClosestPeers(s,{signal:t}))t.aborted&&this.log("aborting walk"),t.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",a.id,Date.now()-o,this.walkers),i++,this.safeDispatchEvent("walk:peer",{detail:a}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),await dn(this.needNext.promise,t)),o=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",s,this.walkers,i)}catch(s){this.log.error("random walk errored",s),this.safeDispatchEvent("walk:error",{detail:s})}this.log("no walkers left, ended walk")}).catch(s=>{this.log.error("random walk errored",s)}).finally(()=>{this.log("finished walk, found %d peers after %dms",i,Date.now()-n),this.walking=!1})}}const Jj=32,Zj=64;var wO;wO=Symbol.toStringTag;class Nxe{constructor(e){u(this,"log");u(this,"topologies");u(this,"handlers");u(this,"components");u(this,wO,"@libp2p/registrar");this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(t==null)throw new _Se(`No handler registered for protocol ${e}`);return t}getTopologies(e){const t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,n){if(this.handlers.has(e)&&(n==null?void 0:n.force)!==!0)throw new TSe(`Handler already registered for protocol ${e}`);const i=Nx.bind({ignoreUndefined:!0})({maxInboundStreams:Jj,maxOutboundStreams:Zj},n);this.handlers.set(e,{handler:t,options:i}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]})}async unhandle(e){(Array.isArray(e)?e:[e]).forEach(n=>{this.handlers.delete(n)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(e,t){if(t==null)throw new ie("invalid topology");const n=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let i=this.topologies.get(e);return i==null&&(i=new Map,this.topologies.set(e,i)),i.set(n,t),n}unregister(e){for(const[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),n.size===0&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail;this.components.peerStore.get(t).then(n=>{var i,s,o;for(const a of n.protocols){const c=this.topologies.get(a);if(c!=null)for(const l of c.values())((i=l.filter)==null?void 0:i.has(t))!==!1&&((s=l.filter)==null||s.remove(t),(o=l.onDisconnect)==null||o.call(l,t))}}).catch(n=>{n.name!=="NotFoundError"&&this.log.error("could not inform topologies of disconnecting peer %p",t,n)})}_onPeerUpdate(e){var s,o,a;const{peer:t,previous:n}=e.detail,i=((n==null?void 0:n.protocols)??[]).filter(c=>!t.protocols.includes(c));for(const c of i){const l=this.topologies.get(c);if(l!=null)for(const d of l.values())((s=d.filter)==null?void 0:s.has(t.id))!==!1&&((o=d.filter)==null||o.remove(t.id),(a=d.onDisconnect)==null||a.call(d,t.id))}}_onPeerIdentify(e){var s,o,a;const t=e.detail.protocols,n=e.detail.connection,i=e.detail.peerId;for(const c of t){const l=this.topologies.get(c);if(l!=null)for(const d of l.values())n.limits!=null&&d.notifyOnLimitedConnection!==!0||((s=d.filter)==null?void 0:s.has(i))!==!0&&((o=d.filter)==null||o.add(i),(a=d.onConnect)==null||a.call(d,i,n))}}}var vO;vO=Symbol.toStringTag;class Oxe{constructor(e,t={}){u(this,"log");u(this,"components");u(this,"transports");u(this,"listeners");u(this,"faultTolerance");u(this,"started");u(this,vO,"@libp2p/transport-manager");this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=new Map,this.listeners=ZF({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??jd.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(t==null)throw new ie("Transport must have a valid tag");if(this.transports.has(t))throw new ie(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[t,n]of this.listeners)for(this.log("closing listeners for %s",t);n.length>0;){const i=n.pop();i!=null&&e.push(i.close())}await Promise.all(e),this.log("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){var i;const n=this.dialTransportForMultiaddr(e);if(n==null)throw new MSe(`No transport available for address ${String(e)}`);return(i=t==null?void 0:t.onProgress)==null||i.call(t,new Ne("transport-manager:selected-transport",n[Symbol.toStringTag])),n.dial(e,{...t,upgrader:this.components.upgrader})}getAddrs(){let e=[];for(const t of this.listeners.values())for(const n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(const t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(const t of this.transports.values())if(t.listenFilter([e]).length>0)return t}async listen(e){if(!this.isStarted())throw new ql("Not started");if(e==null||e.length===0){this.log("no addresses were provided for listening, this node is dial only");return}const t={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};e.forEach(s=>{t.errors.set(s.toString(),new PSe)});const n=[];for(const[s,o]of this.transports.entries()){const a=o.listenFilter(e);for(const c of a){this.log("creating listener for %s on %a",s,c);const l=o.createListener({upgrader:this.components.upgrader});let d=this.listeners.get(s)??[];d==null&&(d=[],this.listeners.set(s,d)),d.push(l),l.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:l})}),l.addEventListener("close",()=>{const h=d.findIndex(p=>p===l);d.splice(h,1),this.components.events.safeDispatchEvent("transport:close",{detail:l})}),A_.matches(c)?t.ipv4.attempts++:I_.matches(c)&&t.ipv6.attempts++,n.push(l.listen(c).then(()=>{t.errors.delete(c.toString()),A_.matches(c)&&t.ipv4.success++,I_.matches(c)&&t.ipv6.success++},h=>{throw this.log.error("transport %s could not listen on address %a - %e",s,c,h),t.errors.set(c.toString(),h),h}))}}const i=await Promise.allSettled(n);if(!(i.length>0&&i.every(s=>s.status==="fulfilled"))){if(this.ipv6Unsupported(t)){this.log("all IPv4 addresses succeed but all IPv6 failed");return}if(this.faultTolerance===jd.NO_FATAL){this.log("failed to listen on any address but fault tolerance allows this");return}throw new DSe(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...t.errors.entries()].map(([s,o])=>`
  ${s}: ${`${o.stack??o}`.split(`
`).join(`
  `)}
`).join("")}`)}}ipv6Unsupported(e){if(e.ipv4.attempts===0||e.ipv6.attempts===0)return!1;const t=e.ipv4.attempts===e.ipv4.success,n=e.ipv6.success===0;return t&&n}async remove(e){const t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);const n=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){const i=t.pop();i!=null&&n.push(i.close())}await Promise.all(n),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}const kn="/multistream/1.0.0",$A=1024,Mxe=fe(`
`);async function Yf(r,e,t){await r.write(e,t)}async function Rxe(r,e,t){await r.writeV(e,t)}async function Lxe(r,e){const t=await r.read(e);if(t.byteLength===0||t.get(t.byteLength-1)!==Mxe[0])throw e.log.error("Invalid mss message - missing newline",t),new Pt("Missing newline");return t.sublist(0,-1)}async function xd(r,e){const t=await Lxe(r,e);return ae(t.subarray())}async function G6(r,e,t){if(e=Array.isArray(e)?[...e]:[e],e.length===1&&t.negotiateFully===!1)return Bxe(r,e[0],t);const n=nh(r,{...t,maxDataLength:$A}),i=e.shift();if(i==null)throw new Error("At least one protocol must be specified");t.log.trace('select: write ["%s", "%s"]',kn,i);const s=fe(`${kn}
`),o=fe(`${i}
`);await Rxe(n,[s,o],t),t.log.trace("select: reading multistream-select header");let a=await xd(n,t);if(t.log.trace('select: read "%s"',a),a===kn&&(t.log.trace("select: reading protocol response"),a=await xd(n,t),t.log.trace('select: read "%s"',a)),a===i)return{stream:n.unwrap(),protocol:i};for(const c of e){t.log.trace('select: write "%s"',c),await Yf(n,fe(`${c}
`),t),t.log.trace("select: reading protocol response");const l=await xd(n,t);if(t.log.trace('select: read "%s" for "%s"',l,c),l===c)return{stream:n.unwrap(),protocol:c}}throw new zp("protocol selection failed")}function Bxe(r,e,t){const n=r.sink.bind(r),i=r.source;let s=!1,o=!1;const a=Ve();let c=!1,l=!1;const d=Ve();let h=!1,p=!1;const w=Ve(),f=nh({sink:n,source:i},{...t,maxDataLength:$A});r.sink=async m=>{const{sink:b}=f.unwrap();await b(async function*(){let S=!1;for await(const I of m){if(l&&await d.promise,c)yield I;else{l=!0,t.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',kn,e,I.byteLength);const T=`${e}
`;yield new He(Uint8Array.from([19]),fe(`${kn}
`),kr(T.length),fe(T),I).subarray(),t.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',kn,e,I.byteLength),c=!0,l=!1,d.resolve(),g().catch(A=>{t.log.error("could not finish optimistic protocol negotiation of %s",e,A)})}S=!0}S||await g()}())};async function g(){if(o){t.log.trace("optimistic: already negotiating %s stream",e),await a.promise;return}o=!0;try{c||(t.log.trace("optimistic: doing send protocol for %s stream",e),await v()),h||(t.log.trace("optimistic: doing read protocol for %s stream",e),await y())}finally{o=!1,s=!0,a.resolve()}}async function v(){if(l){await d.promise;return}l=!0;try{t.log.trace('optimistic: write ["%s", "%s", data] in source',kn,e),await f.writeV([fe(`${kn}
`),fe(`${e}
`)]),t.log.trace('optimistic: wrote ["%s", "%s", data] in source',kn,e)}finally{c=!0,l=!1,d.resolve()}}async function y(){if(p){await w.promise;return}p=!0;try{t.log.trace("optimistic: reading multistream select header");let m=await xd(f,t);if(t.log.trace('optimistic: read multistream select header "%s"',m),m===kn&&(m=await xd(f,t)),t.log.trace('optimistic: read protocol "%s", expecting "%s"',m,e),m!==e)throw new zp("protocol selection failed")}finally{h=!0,p=!1,w.resolve()}}if(r.source=async function*(){await g(),t.log.trace('optimistic: reading data from "%s" stream',e),yield*f.unwrap().source}(),r.closeRead!=null){const m=r.closeRead.bind(r);r.closeRead=async b=>{s||await g().catch(S=>{t.log.error("could not negotiate protocol before close read",S)}),await m(b)}}if(r.closeWrite!=null){const m=r.closeWrite.bind(r);r.closeWrite=async b=>{s||await g().catch(S=>{t.log.error("could not negotiate protocol before close write",S)}),await m(b)}}if(r.close!=null){const m=r.close.bind(r);r.close=async b=>{const S=[];l&&S.push(d.promise),p&&S.push(w.promise),S.length>0?await dn(Promise.all(S),b==null?void 0:b.signal):(s=!0,o=!1,a.resolve()),await m(b)}}return{stream:r,protocol:e}}async function Q6(r,e,t){e=Array.isArray(e)?e:[e],t.log.trace("handle: available protocols %s",e);const n=nh(r,{...t,maxDataLength:$A,maxLengthLength:2});for(;;){t.log.trace("handle: reading incoming string");const i=await xd(n,t);if(t.log.trace('handle: read "%s"',i),i===kn){t.log.trace('handle: respond with "%s" for "%s"',kn,i),await Yf(n,fe(`${kn}
`),t),t.log.trace('handle: responded with "%s" for "%s"',kn,i);continue}if(e.includes(i))return t.log.trace('handle: respond with "%s" for "%s"',i,i),await Yf(n,fe(`${i}
`),t),t.log.trace('handle: responded with "%s" for "%s"',i,i),{stream:n.unwrap(),protocol:i};if(i==="ls"){const s=new He(...e.map(o=>Qd.single(fe(`${o}
`))),fe(`
`));t.log.trace('handle: respond with "%s" for %s',e,i),await Yf(n,s,t),t.log.trace('handle: responded with "%s" for %s',e,i);continue}t.log.trace('handle: respond with "na" for "%s"',i),await Yf(n,fe(`na
`),t),t.log('handle: responded with "na" for "%s"',i)}}const Uxe=500;var bO,EO;EO=Symbol.toStringTag,bO=GZ;class Fxe{constructor(e){u(this,"id");u(this,"remoteAddr");u(this,"remotePeer");u(this,"direction");u(this,"timeline");u(this,"multiplexer");u(this,"encryption");u(this,"status");u(this,"limits");u(this,"log");u(this,"tags");u(this,"_newStream");u(this,"_close");u(this,"_abort");u(this,"_getStreams");u(this,EO,"Connection");u(this,bO,!0);const{remoteAddr:t,remotePeer:n,newStream:i,close:s,abort:o,getStreams:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=n,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.limits=e.limits,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=i,this._close=s,this._abort=o,this._getStreams=a,this.tags=[]}get streams(){return this._getStreams()}async newStream(e,t){if(this.status==="closing")throw new oB("the connection is being closed");if(this.status==="closed")throw new oS("the connection is closed");if(Array.isArray(e)||(e=[e]),this.limits!=null&&(t==null?void 0:t.runOnLimitedConnection)!==!0)throw new lS("Cannot open protocol stream on limited connection");const n=await this._newStream(e,t);return n.direction="outbound",n}async close(e={}){if(!(this.status==="closed"||this.status==="closing")){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",e.signal==null){const t=AbortSignal.timeout(Uxe);e={...e,signal:t}}try{this.log.trace("closing underlying transport"),await this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(t){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,t),this.abort(t)}}}abort(e){this.status!=="closed"&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this._abort(e),this.status="closed",this.timeline.close=Date.now())}}function zxe(r){return new Fxe(r)}function Vxe(r,e){try{const{options:t}=e.getHandler(r);return t.maxInboundStreams}catch(t){if(t.name!=="UnhandledProtocolError")throw t}return Jj}function Kxe(r,e,t={}){try{const{options:n}=e.getHandler(r);if(n.maxOutboundStreams!=null)return n.maxOutboundStreams}catch(n){if(n.name!=="UnhandledProtocolError")throw n}return t.maxOutboundStreams??Zj}function z$(r,e,t){let n=0;return t.streams.forEach(i=>{i.direction===e&&i.protocol===r&&n++}),n}var SO;SO=Symbol.toStringTag;class Hxe{constructor(e,t){u(this,"components");u(this,"connectionEncrypters");u(this,"streamMuxers");u(this,"inboundUpgradeTimeout");u(this,"inboundStreamProtocolNegotiationTimeout");u(this,"outboundStreamProtocolNegotiationTimeout");u(this,"events");u(this,"metrics");u(this,SO,"@libp2p/upgrader");var n,i;this.components=e,this.connectionEncrypters=new Map,t.connectionEncrypters.forEach(s=>{this.connectionEncrypters.set(s.protocol,s)}),this.streamMuxers=new Map,t.streamMuxers.forEach(s=>{this.streamMuxers.set(s.protocol,s)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??QSe,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??R$,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??R$,this.events=e.events,this.metrics={dials:(n=e.metrics)==null?void 0:n.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:(i=e.metrics)==null?void 0:i.registerCounterGroup("libp2p_connection_manager_dial_errors_total")}}async shouldBlockConnection(e,...t){const n=this.components.connectionGater[e];if(n==null)return;if(await n.apply(this.components.connectionGater,t)===!0)throw new NSe(`The multiaddr connection is blocked by gater.${e}`)}createInboundAbortSignal(e){return bt([AbortSignal.timeout(this.inboundUpgradeTimeout),e])}async upgradeInbound(e,t){var s,o;let n=!1;const i=this.createInboundAbortSignal(t.signal);try{if((s=this.metrics.dials)==null||s.increment({inbound:!0}),n=await this.components.connectionManager.acceptIncomingConnection(e),!n)throw new OSe("Connection denied");await this.shouldBlockConnection("denyInboundConnection",e),await this._performUpgrade(e,"inbound",{...t,signal:i})}catch(a){throw(o=this.metrics.errors)==null||o.increment({inbound:!0}),a}finally{i.clear(),n&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){var n,i;try{(n=this.metrics.dials)==null||n.increment({outbound:!0});const s=e.remoteAddr.getPeerId();let o;s!=null&&(o=Zt(s),await this.shouldBlockConnection("denyOutboundConnection",o,e));let a="outbound";return t.initiator===!1&&(a="inbound"),await this._performUpgrade(e,a,t)}catch(s){throw(i=this.metrics.errors)==null||i.increment({outbound:!0}),s}}async _performUpgrade(e,t,n){var d,h,p;let i,s,o,a,c;(d=this.components.metrics)==null||d.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t);let l=e;if((n==null?void 0:n.skipProtection)!==!0){const w=this.components.connectionProtector;w!=null&&(e.log("protecting the %s connection",t),l=await w.protect(e,n))}try{if(i=l,(n==null?void 0:n.skipEncryption)!==!0){(h=n==null?void 0:n.onProgress)==null||h.call(n,new Ne(`upgrader:encrypt-${t}-connection`)),{conn:i,remotePeer:s,protocol:c,streamMuxer:a}=await(t==="inbound"?this._encryptInbound(l,n):this._encryptOutbound(l,n));const w={...l,...i};await this.shouldBlockConnection(t==="inbound"?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",s,w)}else{const w=e.remoteAddr.getPeerId();if(w==null)throw new ew(`${t} connection that skipped encryption must have a peer id`);const f=Zt(w);c="native",s=f}if(s.equals(this.components.peerId)){const w=new cS("Can not dial self");throw e.abort(w),w}if(o=i,(n==null?void 0:n.muxerFactory)!=null)a=n.muxerFactory;else if(a==null&&this.streamMuxers.size>0){(p=n==null?void 0:n.onProgress)==null||p.call(n,new Ne(`upgrader:multiplex-${t}-connection`));const w=await(t==="inbound"?this._multiplexInbound({...l,...i},this.streamMuxers,n):this._multiplexOutbound({...l,...i},this.streamMuxers,n));a=w.muxerFactory,o=w.stream}}catch(w){throw e.log.error("failed to upgrade inbound connection %s %a - %e",t==="inbound"?"from":"to",e.remoteAddr,w),w}return await this.shouldBlockConnection(t==="inbound"?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",s,e),e.log("successfully upgraded %s connection",t),this._createConnection({cryptoProtocol:c,direction:t,maConn:e,upgradedConn:o,muxerFactory:a,remotePeer:s,limits:n==null?void 0:n.limits})}_createConnection(e){const{cryptoProtocol:t,direction:n,maConn:i,upgradedConn:s,remotePeer:o,muxerFactory:a,limits:c}=e;let l,d,h;a!=null&&(l=a.createStreamMuxer({direction:n,onIncomingStream:f=>{h!=null&&Promise.resolve().then(async()=>{var I;const g=this.components.registrar.getProtocols(),v=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout),{stream:y,protocol:m}=await Q6(f,g,{signal:v,log:f.log,yieldBytes:!1});if(h==null)return;h.log("incoming stream opened on %s",m);const b=Vxe(m,this.components.registrar);if(z$(m,"inbound",h)===b){const T=new uB(`Too many inbound protocol streams for protocol "${m}" - limit ${b}`);throw f.abort(T),T}f.source=y.source,f.sink=y.sink,f.protocol=m,y.closeWrite!=null&&(f.closeWrite=y.closeWrite),y.closeRead!=null&&(f.closeRead=y.closeRead),y.close!=null&&(f.close=y.close),await this.components.peerStore.merge(o,{protocols:[m]}),(I=this.components.metrics)==null||I.trackProtocolStream(f,h),this._onStream({connection:h,stream:f,protocol:m})}).catch(async g=>{h.log.error("error handling incoming stream id %s - %e",f.id,g),f.timeline.close==null&&await f.close()})}}),d=async(f,g={})=>{var y;if(l==null)throw new Cg("Connection is not multiplexed");h.log.trace("starting new stream for protocols %s",f);const v=await l.newStream();h.log.trace("started new stream %s for protocols %s",v.id,f);try{if(g.signal==null){v.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",f);const T=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);g={...g,signal:T}}v.log.trace("selecting protocol from protocols %s",f);const{stream:m,protocol:b}=await G6(v,f,{...g,log:v.log,yieldBytes:!0});v.log.trace("selected protocol %s",b);const S=Kxe(b,this.components.registrar,g),I=z$(b,"outbound",h);if(I>=S){const T=new rw(`Too many outbound protocol streams for protocol "${b}" - ${I}/${S}`);throw v.abort(T),T}return await this.components.peerStore.merge(o,{protocols:[b]}),v.source=m.source,v.sink=m.sink,v.protocol=b,m.closeWrite!=null&&(v.closeWrite=m.closeWrite),m.closeRead!=null&&(v.closeRead=m.closeRead),m.close!=null&&(v.close=m.close),(y=this.components.metrics)==null||y.trackProtocolStream(v,h),v}catch(m){throw h.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e",n==="inbound"?"from":"to",e.maConn.remoteAddr,f,m),v.timeline.close==null&&v.abort(m),m}},Promise.all([l.sink(s.source),s.sink(l.source)]).catch(f=>{h.log.error("error piping data through muxer - %e",f)}));const p=i.timeline;i.timeline=new Proxy(p,{set:(...f)=>(f[1]==="close"&&f[2]!=null&&p.close==null&&(async()=>{try{h.status==="open"&&await h.close()}catch(g){h.log.error("error closing connection after timeline close %e",g)}finally{this.events.safeDispatchEvent("connection:close",{detail:h})}})().catch(g=>{h.log.error("error thrown while dispatching connection:close event %e",g)}),Reflect.set(...f))}),i.timeline.upgraded=Date.now();const w=()=>{throw new Cg("Connection is not multiplexed")};return h=zxe({remoteAddr:i.remoteAddr,remotePeer:o,status:"open",direction:n,timeline:i.timeline,multiplexer:l==null?void 0:l.protocol,encryption:t,limits:c,logger:this.components.logger,newStream:d??w,getStreams:()=>(l==null?void 0:l.streams)??[],close:async f=>{await(l==null?void 0:l.close(f)),await i.close(f)},abort:f=>{i.abort(f),l==null||l.abort(f)}}),this.events.safeDispatchEvent("connection:open",{detail:h}),h.__maConnTimeline=p,h}_onStream(e){const{connection:t,stream:n,protocol:i}=e,{handler:s,options:o}=this.components.registrar.getHandler(i);if(t.limits!=null&&o.runOnLimitedConnection!==!0)throw new lS("Cannot open protocol stream on limited connection");s({connection:t,stream:n})}async _encryptInbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{const{stream:i,protocol:s}=await Q6(e,n,{...t,log:e.log}),o=this.connectionEncrypters.get(s);if(o==null)throw new kg(`no crypto module found for ${s}`);return e.log("encrypting inbound connection to %a using %s",e.remoteAddr,s),{...await o.secureInbound(i,t),protocol:s}}catch(i){throw e.log.error("encrypting inbound connection from %a failed",e.remoteAddr,i),new kg(i.message)}}async _encryptOutbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",n);const{stream:i,protocol:s}=await G6(e,n,{...t,log:e.log,yieldBytes:!0}),o=this.connectionEncrypters.get(s);if(o==null)throw new kg(`no crypto module found for ${s}`);return e.log("encrypting outbound connection to %a using %s",e.remoteAddr,s),{...await o.secureOutbound(i,t),protocol:s}}catch(i){throw e.log.error("encrypting outbound connection to %a failed",e.remoteAddr,i),new kg(i.message)}}async _multiplexOutbound(e,t,n){const i=Array.from(t.keys());e.log("outbound selecting muxer %s",i);try{e.log.trace("selecting stream muxer from %s",i);const{stream:s,protocol:o}=await G6(e,i,{...n,log:e.log,yieldBytes:!0});e.log("selected %s as muxer protocol",o);const a=t.get(o);return{stream:s,muxerFactory:a}}catch(s){throw e.log.error("error multiplexing outbound connection",s),new Cg(String(s))}}async _multiplexInbound(e,t,n){const i=Array.from(t.keys());e.log("inbound handling muxers %s",i);try{const{stream:s,protocol:o}=await Q6(e,i,{...n,log:e.log}),a=t.get(o);return{stream:s,muxerFactory:a}}catch(s){throw e.log.error("error multiplexing inbound connection",s),new Cg(String(s))}}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}}var Cp,k9;class jxe extends tr{constructor(t){var d,h,p,w,f,g,v,y,m,b,S,I;super();et(this,Cp);u(this,"peerId");u(this,"peerStore");u(this,"contentRouting");u(this,"peerRouting");u(this,"metrics");u(this,"services");u(this,"logger");u(this,"status");u(this,"components");u(this,"log");this.status="stopped";const n=new tr,i=n.dispatchEvent.bind(n);n.dispatchEvent=T=>{const A=i(T),_=this.dispatchEvent(new CustomEvent(T.type,{detail:T.detail}));return A||_},this.peerId=t.peerId,this.logger=t.logger??vw(),this.log=this.logger.forComponent("libp2p"),this.services={};const s=((d=t.nodeInfo)==null?void 0:d.name)??$j,o=((h=t.nodeInfo)==null?void 0:h.version)??Dj,a=this.components=USe({peerId:t.peerId,privateKey:t.privateKey,nodeInfo:{name:s,version:o,userAgent:((p=t.nodeInfo)==null?void 0:p.userAgent)??Nj(s,o)},logger:this.logger,events:n,datastore:t.datastore??new hV,connectionGater:qSe(t.connectionGater),dns:t.dns});this.peerStore=this.configureComponent("peerStore",ZEe(a,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...t.peerStore})),t.metrics!=null&&(this.metrics=this.configureComponent("metrics",t.metrics(this.components))),a.events.addEventListener("peer:update",T=>{if(T.detail.previous==null){const A={id:T.detail.peer.id,multiaddrs:T.detail.peer.addresses.map(_=>_.multiaddr)};a.events.safeDispatchEvent("peer:discovery",{detail:A})}}),t.connectionProtector!=null&&this.configureComponent("connectionProtector",t.connectionProtector(a)),this.components.upgrader=new Hxe(this.components,{connectionEncrypters:(t.connectionEncrypters??[]).map((T,A)=>this.configureComponent(`connection-encryption-${A}`,T(this.components))),streamMuxers:(t.streamMuxers??[]).map((T,A)=>this.configureComponent(`stream-muxers-${A}`,T(this.components))),inboundUpgradeTimeout:(w=t.connectionManager)==null?void 0:w.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:((f=t.connectionManager)==null?void 0:f.inboundStreamProtocolNegotiationTimeout)??((g=t.connectionManager)==null?void 0:g.protocolNegotiationTimeout),outboundStreamProtocolNegotiationTimeout:((v=t.connectionManager)==null?void 0:v.outboundStreamProtocolNegotiationTimeout)??((y=t.connectionManager)==null?void 0:y.protocolNegotiationTimeout)}),this.configureComponent("transportManager",new Oxe(this.components,t.transportManager)),this.configureComponent("connectionManager",new xxe(this.components,t.connectionManager)),((m=t.connectionMonitor)==null?void 0:m.enabled)!==!1&&this.configureComponent("connectionMonitor",new Txe(this.components,t.connectionMonitor)),this.configureComponent("registrar",new Nxe(this.components)),this.configureComponent("addressManager",new ASe(this.components,t.addresses));const c=(t.peerRouters??[]).map((T,A)=>this.configureComponent(`peer-router-${A}`,T(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new Dxe(this.components,{routers:c}));const l=(t.contentRouters??[]).map((T,A)=>this.configureComponent(`content-router-${A}`,T(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new Pxe(this.components,{routers:l})),this.configureComponent("randomWalk",new $xe(this.components)),(t.peerDiscovery??[]).forEach((T,A)=>{this.configureComponent(`peer-discovery-${A}`,T(this.components)).addEventListener("peer",$=>{De(this,Cp,k9).call(this,$)})}),(b=t.transports)==null||b.forEach((T,A)=>{this.components.transportManager.add(this.configureComponent(`transport-${A}`,T(this.components)))}),t.services!=null)for(const T of Object.keys(t.services)){const A=t.services[T],_=A(this.components);if(_==null){this.log.error("service factory %s returned null or undefined instance",T);continue}this.services[T]=_,this.configureComponent(T,_),_[Kd]!=null&&(this.log("registering service %s for content routing",T),l.push(_[Kd])),_[Hd]!=null&&(this.log("registering service %s for peer routing",T),c.push(_[Hd])),_[z1]!=null&&(this.log("registering service %s for peer discovery",T),(I=(S=_[z1]).addEventListener)==null||I.call(S,"peer",$=>{De(this,Cp,k9).call(this,$)}))}FSe(a)}configureComponent(t,n){return n==null&&this.log.error("component %s was null or undefined",t),this.components[t]=n,n}async start(){var t,n,i,s;if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{await((n=(t=this.components).beforeStart)==null?void 0:n.call(t)),await this.components.start(),await((s=(i=this.components).afterStart)==null?void 0:s.call(i)),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(o){throw this.log.error("An error occurred starting libp2p",o),this.status="started",await this.stop(),o}}}async stop(){var t,n,i,s;this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",await((n=(t=this.components).beforeStop)==null?void 0:n.call(t)),await this.components.stop(),await((s=(i=this.components).afterStop)==null?void 0:s.call(i)),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(t){return this.components.connectionManager.getConnections(t)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const t=new us;for(const n of this.components.connectionManager.getConnections())t.add(n.remotePeer);return Array.from(t)}async dial(t,n={}){return this.components.connectionManager.openConnection(t,{priority:75,...n})}async dialProtocol(t,n,i={}){if(n==null)throw new ie("no protocols were provided to open a stream");if(n=Array.isArray(n)?n:[n],n.length===0)throw new ie("no protocols were provided to open a stream");return(await this.dial(t,i)).newStream(n,i)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(t,n={}){Pw(t)&&(t=Zt(t.getPeerId()??"")),await this.components.connectionManager.closeConnections(t,n)}async getPublicKey(t,n={}){if(this.log("getPublicKey %p",t),t.publicKey!=null)return t.publicKey;try{const a=await this.peerStore.get(t);if(a.id.publicKey!=null)return a.id.publicKey}catch(a){if(a.name!=="NotFoundError")throw a}const i=ur([fe("/pk/"),t.toMultihash().bytes]),s=await this.contentRouting.get(i,n),o=Un(s);return await this.peerStore.patch(t,{publicKey:o}),o}async handle(t,n,i){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async s=>{await this.components.registrar.handle(s,n,i)}))}async unhandle(t){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async n=>{await this.components.registrar.unhandle(n)}))}async register(t,n){return this.components.registrar.register(t,n)}unregister(t){this.components.registrar.unregister(t)}async isDialable(t,n={}){return this.components.connectionManager.isDialable(t,n)}}Cp=new WeakSet,k9=function(t){const{detail:n}=t;if(n.id.toString()===this.peerId.toString()){this.log.error("peer discovery mechanism discovered self");return}this.components.peerStore.merge(n.id,{multiaddrs:n.multiaddrs}).catch(i=>{this.log.error(i)})};async function qxe(r={}){r.privateKey??(r.privateKey=await hw("Ed25519"));const e=new jxe({...await sEe(r),peerId:Ioe(r.privateKey)});return r.start!==!1&&await e.start(),e}async function Wxe(r){const e=r.libp2p??{};e.privateKey==null&&r.datastore!=null&&(e.privateKey=await eEe(r.datastore,r.keychain));const t=Z9e(e);return t.datastore=t.datastore??r.datastore,await qxe({...t,...e,start:!1})}async function Gxe(r={}){const e=r.datastore??new hV,t=r.blockstore??new C2e;let n;Qxe(r.libp2p)?n=r.libp2p:n=await Wxe({...r,libp2p:{dns:r.dns,...r.libp2p,start:void 0},datastore:e});const i=new D2e({...r,libp2p:n,datastore:e,blockstore:t,blockBrokers:r.blockBrokers??[spe(),yhe()],routers:r.routers??[Hge(n),Vge()],metrics:n.metrics});return r.start!==!1&&await i.start(),i}function Qxe(r){return r==null?!1:["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"].every(t=>typeof r[t]=="function")}function eq(r){return r[Symbol.asyncIterator]!=null}const z4=r=>{const e=At(r),t=Ln(e);return kr(r,t),z4.bytes=e,t};z4.bytes=0;function NA(r,e){e=e??{};const t=e.lengthEncoder??z4;function*n(i){const s=t(i.byteLength);s instanceof Uint8Array?yield s:yield*s,i instanceof Uint8Array?yield i:yield*i}return eq(r)?async function*(){for await(const i of r)yield*n(i)}():function*(){for(const i of r)yield*n(i)}()}NA.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??z4;return new He(t(r.byteLength),r)};class Yxe extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}}class Xxe extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}}class Jxe extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}}class V$ extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}}const Zxe=8,eAe=1024*1024*4;var fl;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(fl||(fl={}));const OA=r=>{const e=ms(r);return OA.bytes=At(e),e};OA.bytes=0;function _9(r,e){const t=new He;let n=fl.LENGTH,i=-1;const s=(e==null?void 0:e.lengthDecoder)??OA,o=(e==null?void 0:e.maxLengthLength)??Zxe,a=(e==null?void 0:e.maxDataLength)??eAe;function*c(){for(;t.byteLength>0;){if(n===fl.LENGTH)try{if(i=s(t),i<0)throw new Yxe("Invalid message length");if(i>a)throw new Xxe("Message length too long");const l=s.bytes;t.consume(l),(e==null?void 0:e.onLength)!=null&&e.onLength(i),n=fl.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>o)throw new Jxe("Message length length too long");break}throw l}if(n===fl.DATA){if(t.byteLength<i)break;const l=t.sublist(0,i);t.consume(i),(e==null?void 0:e.onData)!=null&&e.onData(l),yield l,n=fl.LENGTH}}}return eq(r)?async function*(){for await(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new V$("Unexpected end of input")}():function*(){for(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new V$("Unexpected end of input")}()}_9.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:s,value:o}=await r.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return _9(n,{...e??{},onLength:s=>{t=s}})};function tAe(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var rAe=tq,K$=128,nAe=-128,iAe=Math.pow(2,31);function tq(r,e,t){e=e||[],t=t||0;for(var n=t;r>=iAe;)e[t++]=r&255|K$,r/=128;for(;r&nAe;)e[t++]=r&255|K$,r>>>=7;return e[t]=r|0,tq.bytes=t-n+1,e}var sAe=T9,oAe=128,H$=127;function T9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw T9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&H$)<<i:(o&H$)*Math.pow(2,i),i+=7}while(o>=oAe);return T9.bytes=s-n,t}var aAe=Math.pow(2,7),cAe=Math.pow(2,14),lAe=Math.pow(2,21),uAe=Math.pow(2,28),dAe=Math.pow(2,35),hAe=Math.pow(2,42),fAe=Math.pow(2,49),pAe=Math.pow(2,56),gAe=Math.pow(2,63),yAe=function(r){return r<aAe?1:r<cAe?2:r<lAe?3:r<uAe?4:r<dAe?5:r<hAe?6:r<fAe?7:r<pAe?8:r<gAe?9:10},mAe={encode:rAe,decode:sAe,encodingLength:yAe},p3=mAe;function j$(r,e=0){return[p3.decode(r,e),p3.decode.bytes]}function q$(r,e,t=0){return p3.encode(r,e,t),e}function W$(r){return p3.encodingLength(r)}function G$(r,e){const t=e.byteLength,n=W$(r),i=n+W$(t),s=new Uint8Array(i+t);return q$(r,s,0),q$(t,s,n),s.set(e,i),new nq(r,t,e,s)}function rq(r){const e=tAe(r),[t,n]=j$(e),[i,s]=j$(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new nq(t,i,o,e)}class nq{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}}const Yh=1e3,MA=60*Yh,Q$="/floodsub/1.0.0",Y$="/meshsub/1.0.0",wAe="/meshsub/1.1.0",Y6="/meshsub/1.2.0",vAe=6,bAe=4,EAe=12,SAe=4,xAe=2,AAe=5,IAe=3,CAe=6,kAe=.25,_Ae=3,X$=100,TAe=Yh,PAe=MA,DAe=16,$Ae=MA,NAe=10*Yh,OAe=15,MAe=300,RAe=Yh,LAe=60,BAe=2,UAe=10*Yh,Ku=5e3,FAe=10,zAe=3*Yh,VAe=2*MA,KAe=120*1e3,HAe="ERR_TOPIC_VALIDATOR_REJECT",jAe="ERR_TOPIC_VALIDATOR_IGNORE",qAe=0,WAe=128,GAe=1e3,QAe=1e3,YAe=1,XAe=512,JAe=512,ZAe={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxIdontwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};var Bl;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=Be((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.subscribe!=null&&(s.uint32(8),s.bool(i.subscribe)),i.topic!=null&&(s.uint32(18),s.string(i.topic)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.subscribe=i.bool();break}case 2:{a.topic=i.string();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>Le(i,t.codec()),t.decode=(i,s)=>Re(i,t.codec(),s)})(r.SubOpts||(r.SubOpts={})),function(t){let n;t.codec=()=>(n==null&&(n=Be((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.from!=null&&(s.uint32(10),s.bytes(i.from)),i.data!=null&&(s.uint32(18),s.bytes(i.data)),i.seqno!=null&&(s.uint32(26),s.bytes(i.seqno)),i.topic!=null&&i.topic!==""&&(s.uint32(34),s.string(i.topic)),i.signature!=null&&(s.uint32(42),s.bytes(i.signature)),i.key!=null&&(s.uint32(50),s.bytes(i.key)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={topic:""},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.from=i.bytes();break}case 2:{a.data=i.bytes();break}case 3:{a.seqno=i.bytes();break}case 4:{a.topic=i.string();break}case 5:{a.signature=i.bytes();break}case 6:{a.key=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>Le(i,t.codec()),t.decode=(i,s)=>Re(i,t.codec(),s)}(r.Message||(r.Message={})),function(t){let n;t.codec=()=>(n==null&&(n=Be((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.ihave!=null)for(const a of i.ihave)s.uint32(10),r.ControlIHave.codec().encode(a,s);if(i.iwant!=null)for(const a of i.iwant)s.uint32(18),r.ControlIWant.codec().encode(a,s);if(i.graft!=null)for(const a of i.graft)s.uint32(26),r.ControlGraft.codec().encode(a,s);if(i.prune!=null)for(const a of i.prune)s.uint32(34),r.ControlPrune.codec().encode(a,s);if(i.idontwant!=null)for(const a of i.idontwant)s.uint32(42),r.ControlIDontWant.codec().encode(a,s);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l,d,h,p,w,f,g,v,y,m;const a={ihave:[],iwant:[],graft:[],prune:[],idontwant:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const b=i.uint32();switch(b>>>3){case 1:{if(((l=o.limits)==null?void 0:l.ihave)!=null&&a.ihave.length===o.limits.ihave)throw new xt('Decode error - map field "ihave" had too many elements');a.ihave.push(r.ControlIHave.codec().decode(i,i.uint32(),{limits:(d=o.limits)==null?void 0:d.ihave$}));break}case 2:{if(((h=o.limits)==null?void 0:h.iwant)!=null&&a.iwant.length===o.limits.iwant)throw new xt('Decode error - map field "iwant" had too many elements');a.iwant.push(r.ControlIWant.codec().decode(i,i.uint32(),{limits:(p=o.limits)==null?void 0:p.iwant$}));break}case 3:{if(((w=o.limits)==null?void 0:w.graft)!=null&&a.graft.length===o.limits.graft)throw new xt('Decode error - map field "graft" had too many elements');a.graft.push(r.ControlGraft.codec().decode(i,i.uint32(),{limits:(f=o.limits)==null?void 0:f.graft$}));break}case 4:{if(((g=o.limits)==null?void 0:g.prune)!=null&&a.prune.length===o.limits.prune)throw new xt('Decode error - map field "prune" had too many elements');a.prune.push(r.ControlPrune.codec().decode(i,i.uint32(),{limits:(v=o.limits)==null?void 0:v.prune$}));break}case 5:{if(((y=o.limits)==null?void 0:y.idontwant)!=null&&a.idontwant.length===o.limits.idontwant)throw new xt('Decode error - map field "idontwant" had too many elements');a.idontwant.push(r.ControlIDontWant.codec().decode(i,i.uint32(),{limits:(m=o.limits)==null?void 0:m.idontwant$}));break}default:{i.skipType(b&7);break}}}return a})),n),t.encode=i=>Le(i,t.codec()),t.decode=(i,s)=>Re(i,t.codec(),s)}(r.ControlMessage||(r.ControlMessage={})),function(t){let n;t.codec=()=>(n==null&&(n=Be((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.topicID!=null&&(s.uint32(10),s.string(i.topicID)),i.messageIDs!=null)for(const a of i.messageIDs)s.uint32(18),s.bytes(a);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={messageIDs:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:{a.topicID=i.string();break}case 2:{if(((l=o.limits)==null?void 0:l.messageIDs)!=null&&a.messageIDs.length===o.limits.messageIDs)throw new xt('Decode error - map field "messageIDs" had too many elements');a.messageIDs.push(i.bytes());break}default:{i.skipType(d&7);break}}}return a})),n),t.encode=i=>Le(i,t.codec()),t.decode=(i,s)=>Re(i,t.codec(),s)}(r.ControlIHave||(r.ControlIHave={})),function(t){let n;t.codec=()=>(n==null&&(n=Be((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.messageIDs!=null)for(const a of i.messageIDs)s.uint32(10),s.bytes(a);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={messageIDs:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:{if(((l=o.limits)==null?void 0:l.messageIDs)!=null&&a.messageIDs.length===o.limits.messageIDs)throw new xt('Decode error - map field "messageIDs" had too many elements');a.messageIDs.push(i.bytes());break}default:{i.skipType(d&7);break}}}return a})),n),t.encode=i=>Le(i,t.codec()),t.decode=(i,s)=>Re(i,t.codec(),s)}(r.ControlIWant||(r.ControlIWant={})),function(t){let n;t.codec=()=>(n==null&&(n=Be((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.topicID!=null&&(s.uint32(10),s.string(i.topicID)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.topicID=i.string();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>Le(i,t.codec()),t.decode=(i,s)=>Re(i,t.codec(),s)}(r.ControlGraft||(r.ControlGraft={})),function(t){let n;t.codec=()=>(n==null&&(n=Be((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.topicID!=null&&(s.uint32(10),s.string(i.topicID)),i.peers!=null)for(const a of i.peers)s.uint32(18),r.PeerInfo.codec().encode(a,s);i.backoff!=null&&(s.uint32(24),s.uint64Number(i.backoff)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l,d;const a={peers:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const h=i.uint32();switch(h>>>3){case 1:{a.topicID=i.string();break}case 2:{if(((l=o.limits)==null?void 0:l.peers)!=null&&a.peers.length===o.limits.peers)throw new xt('Decode error - map field "peers" had too many elements');a.peers.push(r.PeerInfo.codec().decode(i,i.uint32(),{limits:(d=o.limits)==null?void 0:d.peers$}));break}case 3:{a.backoff=i.uint64Number();break}default:{i.skipType(h&7);break}}}return a})),n),t.encode=i=>Le(i,t.codec()),t.decode=(i,s)=>Re(i,t.codec(),s)}(r.ControlPrune||(r.ControlPrune={})),function(t){let n;t.codec=()=>(n==null&&(n=Be((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.peerID!=null&&(s.uint32(10),s.bytes(i.peerID)),i.signedPeerRecord!=null&&(s.uint32(18),s.bytes(i.signedPeerRecord)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.peerID=i.bytes();break}case 2:{a.signedPeerRecord=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>Le(i,t.codec()),t.decode=(i,s)=>Re(i,t.codec(),s)}(r.PeerInfo||(r.PeerInfo={})),function(t){let n;t.codec=()=>(n==null&&(n=Be((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.messageIDs!=null)for(const a of i.messageIDs)s.uint32(10),s.bytes(a);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={messageIDs:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:{if(((l=o.limits)==null?void 0:l.messageIDs)!=null&&a.messageIDs.length===o.limits.messageIDs)throw new xt('Decode error - map field "messageIDs" had too many elements');a.messageIDs.push(i.bytes());break}default:{i.skipType(d&7);break}}}return a})),n),t.encode=i=>Le(i,t.codec()),t.decode=(i,s)=>Re(i,t.codec(),s)}(r.ControlIDontWant||(r.ControlIDontWant={}));let e;r.codec=()=>(e==null&&(e=Be((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.subscriptions!=null)for(const s of t.subscriptions)n.uint32(10),r.SubOpts.codec().encode(s,n);if(t.messages!=null)for(const s of t.messages)n.uint32(18),r.Message.codec().encode(s,n);t.control!=null&&(n.uint32(26),r.ControlMessage.codec().encode(t.control,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,d,h;const s={subscriptions:[],messages:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const p=t.uint32();switch(p>>>3){case 1:{if(((a=i.limits)==null?void 0:a.subscriptions)!=null&&s.subscriptions.length===i.limits.subscriptions)throw new xt('Decode error - map field "subscriptions" had too many elements');s.subscriptions.push(r.SubOpts.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.subscriptions$}));break}case 2:{if(((l=i.limits)==null?void 0:l.messages)!=null&&s.messages.length===i.limits.messages)throw new xt('Decode error - map field "messages" had too many elements');s.messages.push(r.Message.codec().decode(t,t.uint32(),{limits:(d=i.limits)==null?void 0:d.messages$}));break}case 3:{s.control=r.ControlMessage.codec().decode(t,t.uint32(),{limits:(h=i.limits)==null?void 0:h.control});break}default:{t.skipType(p&7);break}}}return s})),e),r.encode=t=>Le(t,r.codec()),r.decode=(t,n)=>Re(t,r.codec(),n)})(Bl||(Bl={}));class eIe{constructor(e,t,n){u(this,"gossip");u(this,"msgs",new Map);u(this,"msgIdToStrFn");u(this,"history",[]);u(this,"notValidatedCount",0);this.gossip=e,this.msgIdToStrFn=n;for(let i=0;i<t;i++)this.history[i]=[]}get size(){return this.msgs.size}put(e,t,n=!1){const{msgIdStr:i}=e;return this.msgs.has(i)?!1:(this.msgs.set(i,{message:t,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),n||this.notValidatedCount++,!0)}observeDuplicate(e,t){const n=this.msgs.get(e);n!=null&&!n.validated&&n.originatingPeers.add(t)}get(e){var t;return(t=this.msgs.get(this.msgIdToStrFn(e)))==null?void 0:t.message}getWithIWantCount(e,t){const n=this.msgs.get(e);if(n==null)return null;const i=(n.iwantCounts.get(t)??0)+1;return n.iwantCounts.set(t,i),{msg:n.message,count:i}}getGossipIDs(e){const t=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach(i=>{const s=this.msgs.get(i.msgIdStr);if(((s==null?void 0:s.validated)??!1)&&e.has(i.topic)){let o=t.get(i.topic);o==null&&(o=[],t.set(i.topic,o)),o.push(i.msgId)}});return t}validate(e){const t=this.msgs.get(e);if(t==null)return null;t.validated||this.notValidatedCount--;const{message:n,originatingPeers:i}=t;return t.validated=!0,t.originatingPeers=new Set,{message:n,originatingPeers:i}}shift(){this.history[this.history.length-1].forEach(t=>{const n=this.msgs.get(t.msgIdStr);n!=null&&(this.msgs.delete(t.msgIdStr),n.validated||this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(e){const t=this.msgs.get(e);return t==null?null:(this.msgs.delete(e),t)}}var J$;(function(r){r.StrictSign="StrictSign",r.StrictNoSign="StrictNoSign"})(J$||(J$={}));var xh;(function(r){r[r.Signing=0]="Signing",r[r.Anonymous=1]="Anonymous"})(xh||(xh={}));var fs;(function(r){r.Error="error",r.Ignore="ignore",r.Reject="reject",r.Blacklisted="blacklisted"})(fs||(fs={}));var xn;(function(r){r.InvalidSignature="invalid_signature",r.InvalidSeqno="invalid_seqno",r.InvalidPeerId="invalid_peerid",r.SignaturePresent="signature_present",r.SeqnoPresent="seqno_present",r.FromPresent="from_present",r.TransformFailed="transform_failed"})(xn||(xn={}));var In;(function(r){r.duplicate="duplicate",r.invalid="invalid",r.valid="valid"})(In||(In={}));function Z$(r){switch(r){case ki.Ignore:return fs.Ignore;case ki.Reject:return fs.Reject;default:throw new Error("Unreachable")}}var eN;(function(r){r.forward="forward",r.publish="publish"})(eN||(eN={}));var Tn;(function(r){r.Fanout="fanout",r.Random="random",r.Subscribed="subscribed",r.Outbound="outbound",r.NotEnough="not_enough",r.Opportunistic="opportunistic"})(Tn||(Tn={}));var Bs;(function(r){r.Dc="disconnected",r.BadScore="bad_score",r.Prune="prune",r.Excess="excess"})(Bs||(Bs={}));var v1;(function(r){r.GraftBackoff="graft_backoff",r.BrokenPromise="broken_promise",r.MessageDeficit="message_deficit",r.IPColocation="IP_colocation"})(v1||(v1={}));var b1;(function(r){r.LowScore="low_score",r.MaxIhave="max_ihave",r.MaxIasked="max_iasked"})(b1||(b1={}));var id;(function(r){r.graylist="graylist",r.publish="publish",r.gossip="gossip",r.mesh="mesh"})(id||(id={}));function tIe(r,e,t){return{protocolsEnabled:r.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:r.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:r.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:r.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEventsFanout:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_fanout_total",help:"Number of times we include peers in a topic mesh for fanout reasons",labelNames:["topic"]}),meshPeerInclusionEventsRandom:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_random_total",help:"Number of times we include peers in a topic mesh for random reasons",labelNames:["topic"]}),meshPeerInclusionEventsSubscribed:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_subscribed_total",help:"Number of times we include peers in a topic mesh for subscribed reasons",labelNames:["topic"]}),meshPeerInclusionEventsOutbound:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_outbound_total",help:"Number of times we include peers in a topic mesh for outbound reasons",labelNames:["topic"]}),meshPeerInclusionEventsNotEnough:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_not_enough_total",help:"Number of times we include peers in a topic mesh for not_enough reasons",labelNames:["topic"]}),meshPeerInclusionEventsOpportunistic:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_opportunistic_total",help:"Number of times we include peers in a topic mesh for opportunistic reasons",labelNames:["topic"]}),meshPeerInclusionEventsUnknown:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_unknown_total",help:"Number of times we include peers in a topic mesh for unknown reasons",labelNames:["topic"]}),meshPeerChurnEventsDisconnected:r.gauge({name:"gossipsub_peer_churn_events_disconnected_total",help:"Number of times we remove peers in a topic mesh for disconnected reasons",labelNames:["topic"]}),meshPeerChurnEventsBadScore:r.gauge({name:"gossipsub_peer_churn_events_bad_score_total",help:"Number of times we remove peers in a topic mesh for bad_score reasons",labelNames:["topic"]}),meshPeerChurnEventsPrune:r.gauge({name:"gossipsub_peer_churn_events_prune_total",help:"Number of times we remove peers in a topic mesh for prune reasons",labelNames:["topic"]}),meshPeerChurnEventsExcess:r.gauge({name:"gossipsub_peer_churn_events_excess_total",help:"Number of times we remove peers in a topic mesh for excess reasons",labelNames:["topic"]}),meshPeerChurnEventsUnknown:r.gauge({name:"gossipsub_peer_churn_events_unknown_total",help:"Number of times we remove peers in a topic mesh for unknown reasons",labelNames:["topic"]}),peersPerProtocol:r.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:r.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:r.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),acceptedMessagesTotal:r.gauge({name:"gossipsub_accepted_messages_total",help:"Total accepted messages for each topic",labelNames:["topic"]}),ignoredMessagesTotal:r.gauge({name:"gossipsub_ignored_messages_total",help:"Total ignored messages for each topic",labelNames:["topic"]}),rejectedMessagesTotal:r.gauge({name:"gossipsub_rejected_messages_total",help:"Total rejected messages for each topic",labelNames:["topic"]}),unknownValidationResultsTotal:r.gauge({name:"gossipsub_unknown_validation_results_total",help:"Total unknown validation results for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:r.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),asyncValidationDelayFromFirstSeenSec:r.histogram({name:"gossipsub_async_validation_delay_from_first_seen",help:"Async validation report delay from first seen in second",buckets:[.01,.03,.1,.3,1,3,10]}),asyncValidationUnknownFirstSeen:r.gauge({name:"gossipsub_async_validation_unknown_first_seen_count_total",help:"Async validation report unknown first seen value for message"}),peerReadStreamError:r.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:r.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:r.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:r.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:r.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:r.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:r.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:r.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:r.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:r.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:r.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:r.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:r.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:r.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:r.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:r.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:r.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:r.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:r.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:r.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:r.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:r.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),rpcSentIDontWant:r.gauge({name:"gossipsub_rpc_sent_idontwant_total",help:"RPC sent"}),msgPublishCount:r.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:r.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),directPeersPublishedTotal:r.gauge({name:"gossipsub_direct_peers_published_total",help:"Total direct peers that we publish a msg to",labelNames:["topic"]}),floodsubPeersPublishedTotal:r.gauge({name:"gossipsub_floodsub_peers_published_total",help:"Total floodsub peers that we publish a msg to",labelNames:["topic"]}),meshPeersPublishedTotal:r.gauge({name:"gossipsub_mesh_peers_published_total",help:"Total mesh peers that we publish a msg to",labelNames:["topic"]}),fanoutPeersPublishedTotal:r.gauge({name:"gossipsub_fanout_peers_published_total",help:"Total fanout peers that we publish a msg to",labelNames:["topic"]}),msgPublishBytes:r.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgPublishTime:r.histogram({name:"gossipsub_msg_publish_seconds",help:"Total time in seconds to publish a message",buckets:[.001,.002,.005,.01,.1,.5,1],labelNames:["topic"]}),msgForwardCount:r.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:r.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:r.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:r.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),prevalidationInvalidTotal:r.gauge({name:"gossipsub_pre_validation_invalid_total",help:"Total count of invalid messages received",labelNames:["topic"]}),prevalidationValidTotal:r.gauge({name:"gossipsub_pre_validation_valid_total",help:"Total count of valid messages received",labelNames:["topic"]}),prevalidationDuplicateTotal:r.gauge({name:"gossipsub_pre_validation_duplicate_total",help:"Total count of duplicate messages received",labelNames:["topic"]}),prevalidationUnknownTotal:r.gauge({name:"gossipsub_pre_validation_unknown_status_total",help:"Total count of unknown_status messages received",labelNames:["topic"]}),msgReceivedInvalid:r.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:r.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:r.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*t.maxMeshMessageDeliveriesWindowSec,.5*t.maxMeshMessageDeliveriesWindowSec,Number(t.maxMeshMessageDeliveriesWindowSec),2*t.maxMeshMessageDeliveriesWindowSec,4*t.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:r.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:r.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:r.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:r.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:r.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:r.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:r.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:r.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:r.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:r.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:r.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*t.behaviourPenaltyThreshold,.5*t.behaviourPenaltyThreshold,Number(t.behaviourPenaltyThreshold),2*t.behaviourPenaltyThreshold,4*t.behaviourPenaltyThreshold]}),ihaveRcvIgnored:r.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:r.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:r.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:r.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:r.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),idontwantRcvMsgids:r.gauge({name:"gossipsub_idontwant_rcv_msgids_total",help:"Total received IDONTWANT messages"}),idontwantRcvDonthaveMsgids:r.gauge({name:"gossipsub_idontwant_rcv_dont_have_msgids_total",help:"Total received IDONTWANT messageIDs that we do not have in mcache"}),iwantPromiseStarted:r.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:r.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:r.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:r.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:r.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:r.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:r.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*t.gossipPromiseExpireSec,Number(t.gossipPromiseExpireSec),2*t.gossipPromiseExpireSec,4*t.gossipPromiseExpireSec]}),iwantPromiseUntracked:r.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),connectedPeersBackoffSec:r.histogram({name:"gossipsub_connected_peers_backoff_seconds",help:"Backoff time in seconds",buckets:[1,2,4,10,20,60,120]}),cacheSize:r.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:r.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:r.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:r.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:r.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:e,toTopic(n){return this.topicStrToLabel.get(n)??n},onJoin(n){this.topicSubscriptionStatus.set({topicStr:n},1),this.meshPeerCounts.set({topicStr:n},0)},onLeave(n){this.topicSubscriptionStatus.set({topicStr:n},0),this.meshPeerCounts.set({topicStr:n},0)},onAddToMesh(n,i,s){const o=this.toTopic(n);switch(i){case Tn.Fanout:this.meshPeerInclusionEventsFanout.inc({topic:o},s);break;case Tn.Random:this.meshPeerInclusionEventsRandom.inc({topic:o},s);break;case Tn.Subscribed:this.meshPeerInclusionEventsSubscribed.inc({topic:o},s);break;case Tn.Outbound:this.meshPeerInclusionEventsOutbound.inc({topic:o},s);break;case Tn.NotEnough:this.meshPeerInclusionEventsNotEnough.inc({topic:o},s);break;case Tn.Opportunistic:this.meshPeerInclusionEventsOpportunistic.inc({topic:o},s);break;default:this.meshPeerInclusionEventsUnknown.inc({topic:o},s);break}},onRemoveFromMesh(n,i,s){const o=this.toTopic(n);switch(i){case Bs.Dc:this.meshPeerChurnEventsDisconnected.inc({topic:o},s);break;case Bs.BadScore:this.meshPeerChurnEventsBadScore.inc({topic:o},s);break;case Bs.Prune:this.meshPeerChurnEventsPrune.inc({topic:o},s);break;case Bs.Excess:this.meshPeerChurnEventsExcess.inc({topic:o},s);break;default:this.meshPeerChurnEventsUnknown.inc({topic:o},s);break}},onReportValidation(n,i,s){if(this.asyncValidationMcacheHit.inc({hit:n!=null?"hit":"miss"}),n!=null){const o=this.toTopic(n.message.topic);switch(i){case ki.Accept:this.acceptedMessagesTotal.inc({topic:o});break;case ki.Ignore:this.ignoredMessagesTotal.inc({topic:o});break;case ki.Reject:this.rejectedMessagesTotal.inc({topic:o});break;default:this.unknownValidationResultsTotal.inc({topic:o});break}}s!=null?this.asyncValidationDelayFromFirstSeenSec.observe((Date.now()-s)/1e3):this.asyncValidationUnknownFirstSeen.inc()},onScorePenalty(n){this.scoringPenalties.inc({penalty:n},1)},onIhaveRcv(n,i,s){const o=this.toTopic(n);this.ihaveRcvMsgids.inc({topic:o},i),this.ihaveRcvNotSeenMsgids.inc({topic:o},s)},onIwantRcv(n,i){for(const[s,o]of n){const a=this.toTopic(s);this.iwantRcvMsgids.inc({topic:a},o)}this.iwantRcvDonthaveMsgids.inc(i)},onIdontwantRcv(n,i){this.idontwantRcvMsgids.inc(n),this.idontwantRcvDonthaveMsgids.inc(i)},onForwardMsg(n,i){const s=this.toTopic(n);this.msgForwardCount.inc({topic:s},1),this.msgForwardPeers.inc({topic:s},i)},onPublishMsg(n,i,s,o,a){const c=this.toTopic(n);this.msgPublishCount.inc({topic:c},1),this.msgPublishBytes.inc({topic:c},s*o),this.msgPublishPeersByTopic.inc({topic:c},s),this.directPeersPublishedTotal.inc({topic:c},i.direct),this.floodsubPeersPublishedTotal.inc({topic:c},i.floodsub),this.meshPeersPublishedTotal.inc({topic:c},i.mesh),this.fanoutPeersPublishedTotal.inc({topic:c},i.fanout),this.msgPublishTime.observe({topic:c},a/1e3)},onMsgRecvPreValidation(n){const i=this.toTopic(n);this.msgReceivedPreValidation.inc({topic:i},1)},onMsgRecvError(n){const i=this.toTopic(n);this.msgReceivedError.inc({topic:i},1)},onPrevalidationResult(n,i){const s=this.toTopic(n);switch(i){case In.duplicate:this.prevalidationDuplicateTotal.inc({topic:s});break;case In.invalid:this.prevalidationInvalidTotal.inc({topic:s});break;case In.valid:this.prevalidationValidTotal.inc({topic:s});break;default:this.prevalidationUnknownTotal.inc({topic:s});break}},onMsgRecvInvalid(n,i){const s=this.toTopic(n),o=i.reason===fs.Error?i.error:i.reason;this.msgReceivedInvalid.inc({error:o},1),this.msgReceivedInvalidByTopic.inc({topic:s},1)},onDuplicateMsgDelivery(n,i,s){const o=this.toTopic(n);this.duplicateMsgDeliveryDelay.observe({topic:o},i/1e3),s&&this.duplicateMsgLateDelivery.inc({topic:o},1)},onPublishDuplicateMsg(n){const i=this.toTopic(n);this.duplicateMsgIgnored.inc({topic:i},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(n,i){this.rpcRecvBytes.inc(i),this.rpcRecvCount.inc(1),n.subscriptions!=null&&this.rpcRecvSubscription.inc(n.subscriptions.length),n.messages!=null&&this.rpcRecvMessage.inc(n.messages.length),n.control!=null&&(this.rpcRecvControl.inc(1),n.control.ihave!=null&&this.rpcRecvIHave.inc(n.control.ihave.length),n.control.iwant!=null&&this.rpcRecvIWant.inc(n.control.iwant.length),n.control.graft!=null&&this.rpcRecvGraft.inc(n.control.graft.length),n.control.prune!=null&&this.rpcRecvPrune.inc(n.control.prune.length))},onRpcSent(n,i){var s,o,a,c,l;if(this.rpcSentBytes.inc(i),this.rpcSentCount.inc(1),n.subscriptions!=null&&this.rpcSentSubscription.inc(n.subscriptions.length),n.messages!=null&&this.rpcSentMessage.inc(n.messages.length),n.control!=null){const d=((s=n.control.ihave)==null?void 0:s.length)??0,h=((o=n.control.iwant)==null?void 0:o.length)??0,p=((a=n.control.graft)==null?void 0:a.length)??0,w=((c=n.control.prune)==null?void 0:c.length)??0,f=((l=n.control.idontwant)==null?void 0:l.length)??0;d>0&&this.rpcSentIHave.inc(d),h>0&&this.rpcSentIWant.inc(h),p>0&&this.rpcSentGraft.inc(p),w>0&&this.rpcSentPrune.inc(w),f>0&&this.rpcSentIDontWant.inc(f),(d>0||h>0||p>0||w>0||f>0)&&this.rpcSentControl.inc(1)}},registerScores(n,i){let s=0,o=0,a=0,c=0;for(const l of n)l>=i.graylistThreshold&&s++,l>=i.publishThreshold&&o++,l>=i.gossipThreshold&&a++,l>=0&&c++;this.peersByScoreThreshold.set({threshold:id.graylist},s),this.peersByScoreThreshold.set({threshold:id.publish},o),this.peersByScoreThreshold.set({threshold:id.gossip},a),this.peersByScoreThreshold.set({threshold:id.mesh},c),this.score.set(n)},registerScoreWeights(n){for(const[i,s]of n.byTopic)this.scoreWeights.set({topic:i,p:"p1"},s.p1w),this.scoreWeights.set({topic:i,p:"p2"},s.p2w),this.scoreWeights.set({topic:i,p:"p3"},s.p3w),this.scoreWeights.set({topic:i,p:"p3b"},s.p3bw),this.scoreWeights.set({topic:i,p:"p4"},s.p4w);this.scoreWeights.set({p:"p5"},n.p5w),this.scoreWeights.set({p:"p6"},n.p6w),this.scoreWeights.set({p:"p7"},n.p7w)},registerScorePerMesh(n,i){const s=new Map;n.forEach((o,a)=>{const c=this.topicStrToLabel.get(a)??"unknown";let l=s.get(c);l==null&&(l=new Set,s.set(c,l)),o.forEach(d=>l==null?void 0:l.add(d))});for(const[o,a]of s){const c=[];a.forEach(l=>{c.push(i.get(l)??0)}),this.scorePerMesh.set({topic:o},c)}}}}class St extends Error{constructor(e="Invalid peer score params"){super(e),this.name="InvalidPeerScoreParamsError"}}u(St,"name","InvalidPeerScoreParamsError");const rIe={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},nIe={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function iIe(r={}){return{...rIe,...r,topics:r.topics!=null?Object.entries(r.topics).reduce((e,[t,n])=>(e[t]=sIe(n),e),{}):{}}}function sIe(r={}){return{...nIe,...r}}function oIe(r){for(const[e,t]of Object.entries(r.topics))try{aIe(t)}catch(n){throw new St(`invalid score parameters for topic ${e}: ${n.message}`)}if(r.topicScoreCap<0)throw new St("invalid topic score cap; must be positive (or 0 for no cap)");if(r.appSpecificScore===null||r.appSpecificScore===void 0)throw new St("missing application specific score function");if(r.IPColocationFactorWeight>0)throw new St("invalid IPColocationFactorWeight; must be negative (or 0 to disable)");if(r.IPColocationFactorWeight!==0&&r.IPColocationFactorThreshold<1)throw new St("invalid IPColocationFactorThreshold; must be at least 1");if(r.behaviourPenaltyWeight>0)throw new St("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)");if(r.behaviourPenaltyWeight!==0&&(r.behaviourPenaltyDecay<=0||r.behaviourPenaltyDecay>=1))throw new St("invalid BehaviourPenaltyDecay; must be between 0 and 1");if(r.decayInterval<1e3)throw new St("invalid DecayInterval; must be at least 1s");if(r.decayToZero<=0||r.decayToZero>=1)throw new St("invalid DecayToZero; must be between 0 and 1")}function aIe(r){if(r.topicWeight<0)throw new St("invalid topic weight; must be >= 0");if(r.timeInMeshQuantum===0)throw new St("invalid TimeInMeshQuantum; must be non zero");if(r.timeInMeshWeight<0)throw new St("invalid TimeInMeshWeight; must be positive (or 0 to disable)");if(r.timeInMeshWeight!==0&&r.timeInMeshQuantum<=0)throw new St("invalid TimeInMeshQuantum; must be positive");if(r.timeInMeshWeight!==0&&r.timeInMeshCap<=0)throw new St("invalid TimeInMeshCap; must be positive");if(r.firstMessageDeliveriesWeight<0)throw new St("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)");if(r.firstMessageDeliveriesWeight!==0&&(r.firstMessageDeliveriesDecay<=0||r.firstMessageDeliveriesDecay>=1))throw new St("invalid FirstMessageDeliveriesDecay; must be between 0 and 1");if(r.firstMessageDeliveriesWeight!==0&&r.firstMessageDeliveriesCap<=0)throw new St("invalid FirstMessageDeliveriesCap; must be positive");if(r.meshMessageDeliveriesWeight>0)throw new St("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)");if(r.meshMessageDeliveriesWeight!==0&&(r.meshMessageDeliveriesDecay<=0||r.meshMessageDeliveriesDecay>=1))throw new St("invalid MeshMessageDeliveriesDecay; must be between 0 and 1");if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesCap<=0)throw new St("invalid MeshMessageDeliveriesCap; must be positive");if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesThreshold<=0)throw new St("invalid MeshMessageDeliveriesThreshold; must be positive");if(r.meshMessageDeliveriesWindow<0)throw new St("invalid MeshMessageDeliveriesWindow; must be non-negative");if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesActivation<1e3)throw new St("invalid MeshMessageDeliveriesActivation; must be at least 1s");if(r.meshFailurePenaltyWeight>0)throw new St("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)");if(r.meshFailurePenaltyWeight!==0&&(r.meshFailurePenaltyDecay<=0||r.meshFailurePenaltyDecay>=1))throw new St("invalid MeshFailurePenaltyDecay; must be between 0 and 1");if(r.invalidMessageDeliveriesWeight>0)throw new St("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)");if(r.invalidMessageDeliveriesDecay<=0||r.invalidMessageDeliveriesDecay>=1)throw new St("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1")}const cIe={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function lIe(r={}){return{...cIe,...r}}function P9(r,e,t=()=>!0){const n=new Set;if(e<=0)return n;for(const i of r){if(n.size>=e)break;t(i)&&(n.add(i),r.delete(i))}return n}function uIe(r,e){return P9(r,e,()=>!0)}class dIe extends Map{constructor(t){super();u(this,"getDefault");this.getDefault=t}getOrDefault(t){let n=super.get(t);return n===void 0&&(n=this.getDefault(),this.set(t,n)),n}}function hIe(r,e,t,n){let i=0;Object.entries(e.topics).forEach(([o,a])=>{const c=t.topics[o];if(c===void 0)return;let l=0;if(a.inMesh){let w=a.meshTime/c.timeInMeshQuantum;w>c.timeInMeshCap&&(w=c.timeInMeshCap),l+=w*c.timeInMeshWeight}let d=a.firstMessageDeliveries;if(d>c.firstMessageDeliveriesCap&&(d=c.firstMessageDeliveriesCap),l+=d*c.firstMessageDeliveriesWeight,a.meshMessageDeliveriesActive&&a.meshMessageDeliveries<c.meshMessageDeliveriesThreshold){const w=c.meshMessageDeliveriesThreshold-a.meshMessageDeliveries,f=w*w;l+=f*c.meshMessageDeliveriesWeight}const h=a.meshFailurePenalty;l+=h*c.meshFailurePenaltyWeight;const p=a.invalidMessageDeliveries*a.invalidMessageDeliveries;l+=p*c.invalidMessageDeliveriesWeight,i+=l*c.topicWeight}),t.topicScoreCap>0&&i>t.topicScoreCap&&(i=t.topicScoreCap);const s=t.appSpecificScore(r);if(i+=s*t.appSpecificWeight,e.knownIPs.forEach(o=>{if(t.IPColocationFactorWhitelist.has(o))return;const a=n.get(o),c=a!=null?a.size:0;if(c>t.IPColocationFactorThreshold){const l=c-t.IPColocationFactorThreshold,d=l*l;i+=d*t.IPColocationFactorWeight}}),e.behaviourPenalty>t.behaviourPenaltyThreshold){const o=e.behaviourPenalty-t.behaviourPenaltyThreshold,a=o*o;i+=a*t.behaviourPenaltyWeight}return i}function Wt(r,t){var t=t||{};this._capacity=t.capacity,this._head=0,this._tail=0,Array.isArray(r)?this._fromArray(r):(this._capacityMask=3,this._list=new Array(4))}Wt.prototype.peekAt=function(e){var t=e;if(t===(t|0)){var n=this.size();if(!(t>=n||t<-n))return t<0&&(t+=n),t=this._head+t&this._capacityMask,this._list[t]}};Wt.prototype.get=function(e){return this.peekAt(e)};Wt.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};Wt.prototype.peekFront=function(){return this.peek()};Wt.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(Wt.prototype,"length",{get:function(){return this.size()}});Wt.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Wt.prototype.unshift=function(e){if(arguments.length===0)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Wt.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}};Wt.prototype.push=function(e){if(arguments.length===0)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Wt.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),n}};Wt.prototype.removeOne=function(e){var t=e;if(t===(t|0)&&this._head!==this._tail){var n=this.size(),i=this._list.length;if(!(t>=n||t<-n)){t<0&&(t+=n),t=this._head+t&this._capacityMask;var s=this._list[t],o;if(e<n/2){for(o=e;o>0;o--)this._list[t]=this._list[t=t-1+i&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(o=n-1-e;o>0;o--)this._list[t]=this._list[t=t+1+i&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+i&this._capacityMask}return s}}};Wt.prototype.remove=function(e,t){var n=e,i,s=t;if(n===(n|0)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(n>=o||n<-o||t<1)){if(n<0&&(n+=o),t===1||!t)return i=new Array(1),i[0]=this.removeOne(n),i;if(n===0&&n+t>=o)return i=this.toArray(),this.clear(),i;n+t>o&&(t=o-n);var c;for(i=new Array(t),c=0;c<t;c++)i[c]=this._list[this._head+n+c&this._capacityMask];if(n=this._head+n&this._capacityMask,e+t===o){for(this._tail=this._tail-t+a&this._capacityMask,c=t;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(e===0){for(this._head=this._head+t+a&this._capacityMask,c=t-1;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(n<o/2){for(this._head=this._head+e+t+a&this._capacityMask,c=e;c>0;c--)this.unshift(this._list[n=n-1+a&this._capacityMask]);for(n=this._head-1+a&this._capacityMask;s>0;)this._list[n=n-1+a&this._capacityMask]=void 0,s--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+t+a&this._capacityMask,c=o-(t+e);c>0;c--)this.push(this._list[n++]);for(n=this._tail;s>0;)this._list[n=n+1+a&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),i}}};Wt.prototype.splice=function(e,t){var n=e;if(n===(n|0)){var i=this.size();if(n<0&&(n+=i),!(n>i))if(arguments.length>2){var s,o,a,c=arguments.length,l=this._list.length,d=2;if(!i||n<i/2){for(o=new Array(n),s=0;s<n;s++)o[s]=this._list[this._head+s&this._capacityMask];for(t===0?(a=[],n>0&&(this._head=this._head+n+l&this._capacityMask)):(a=this.remove(n,t),this._head=this._head+n+l&this._capacityMask);c>d;)this.unshift(arguments[--c]);for(s=n;s>0;s--)this.unshift(o[s-1])}else{o=new Array(i-(n+t));var h=o.length;for(s=0;s<h;s++)o[s]=this._list[this._head+n+t+s&this._capacityMask];for(t===0?(a=[],n!=i&&(this._tail=this._head+n+l&this._capacityMask)):(a=this.remove(n,t),this._tail=this._tail-h+l&this._capacityMask);d<c;)this.push(arguments[d++]);for(s=0;s<h;s++)this.push(o[s])}return a}else return this.remove(n,t)}};Wt.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0};Wt.prototype.isEmpty=function(){return this._head===this._tail};Wt.prototype.toArray=function(){return this._copyArray(!1)};Wt.prototype._fromArray=function(e){var t=e.length,n=this._nextPowerOf2(t);this._list=new Array(n),this._capacityMask=n-1,this._tail=t;for(var i=0;i<t;i++)this._list[i]=e[i]};Wt.prototype._copyArray=function(e,t){var n=this._list,i=n.length,s=this.length;if(t=t|s,t==s&&this._head<this._tail)return this._list.slice(this._head,this._tail);var o=new Array(t),a=0,c;if(e||this._head>this._tail){for(c=this._head;c<i;c++)o[a++]=n[c];for(c=0;c<this._tail;c++)o[a++]=n[c]}else for(c=this._head;c<this._tail;c++)o[a++]=n[c];return o};Wt.prototype._growArray=function(){if(this._head!=0){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1};Wt.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};Wt.prototype._nextPowerOf2=function(e){var t=Math.log(e)/Math.log(2),n=1<<t+1;return Math.max(n,4)};var fIe=Wt;const pIe=Qs(fIe);var An;(function(r){r[r.unknown=0]="unknown",r[r.valid=1]="valid",r[r.invalid=2]="invalid",r[r.ignored=3]="ignored"})(An||(An={}));class gIe{constructor(){u(this,"records");u(this,"queue");this.records=new Map,this.queue=new pIe}getRecord(e){return this.records.get(e)}ensureRecord(e){let t=this.records.get(e);if(t!=null)return t;t={status:An.unknown,firstSeenTsMs:Date.now(),validated:0,peers:new Set},this.records.set(e,t);const n={msgId:e,expire:Date.now()+KAe};return this.queue.push(n),t}gc(){const e=Date.now();let t=this.queue.peekFront();for(;t!=null&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}class yIe{constructor(e,t,n,i){u(this,"params");u(this,"metrics");u(this,"peerStats",new Map);u(this,"peerIPs",new dIe(()=>new Set));u(this,"scoreCache",new Map);u(this,"deliveryRecords",new gIe);u(this,"_backgroundInterval");u(this,"scoreCacheValidityMs");u(this,"computeScore");u(this,"log");this.params=e,this.metrics=t,oIe(e),this.scoreCacheValidityMs=i.scoreCacheValidityMs,this.computeScore=i.computeScore??hIe,this.log=n.forComponent("libp2p:gossipsub:score")}get size(){return this.peerStats.size}start(){if(this._backgroundInterval!=null){this.log("Peer score already running");return}this._backgroundInterval=setInterval(()=>{this.background()},this.params.decayInterval),this.log("started")}stop(){if(this._backgroundInterval==null){this.log("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),this.log("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,t])=>[e,t]))}messageFirstSeenTimestampMs(e){const t=this.deliveryRecords.getRecord(e);return t!=null?t.firstSeenTsMs:null}refreshScores(){const e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach((n,i)=>{if(!n.connected){e>n.expire&&(this.removeIPsForPeer(i,n.knownIPs),this.peerStats.delete(i),this.scoreCache.delete(i));return}Object.entries(n.topics).forEach(([s,o])=>{const a=this.params.topics[s];a!==void 0&&(o.firstMessageDeliveries*=a.firstMessageDeliveriesDecay,o.firstMessageDeliveries<t&&(o.firstMessageDeliveries=0),o.meshMessageDeliveries*=a.meshMessageDeliveriesDecay,o.meshMessageDeliveries<t&&(o.meshMessageDeliveries=0),o.meshFailurePenalty*=a.meshFailurePenaltyDecay,o.meshFailurePenalty<t&&(o.meshFailurePenalty=0),o.invalidMessageDeliveries*=a.invalidMessageDeliveriesDecay,o.invalidMessageDeliveries<t&&(o.invalidMessageDeliveries=0),o.inMesh&&(o.meshTime=e-o.graftTime,o.meshTime>a.meshMessageDeliveriesActivation&&(o.meshMessageDeliveriesActive=!0)))}),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<t&&(n.behaviourPenalty=0)})}score(e){var a,c,l;(a=this.metrics)==null||a.scoreFnCalls.inc();const t=this.peerStats.get(e);if(t==null)return 0;const n=Date.now(),i=this.scoreCache.get(e);if(i!=null&&i.cacheUntil>n)return i.score;(c=this.metrics)==null||c.scoreFnRuns.inc();const s=this.computeScore(e,t,this.params,this.peerIPs),o=n+this.scoreCacheValidityMs;return i!=null?((l=this.metrics)==null||l.scoreCachedDelta.observe(Math.abs(s-i.score)),i.score=s,i.cacheUntil=o):this.scoreCache.set(e,{score:s,cacheUntil:o}),s}addPenalty(e,t,n){var s;const i=this.peerStats.get(e);i!=null&&(i.behaviourPenalty+=t,(s=this.metrics)==null||s.onScorePenalty(n))}addPeer(e){const t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){const n=this.peerStats.get(e);n!=null&&n.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){const n=this.peerStats.get(e);n!=null&&n.knownIPs.delete(t);const i=this.peerIPs.get(t);i!=null&&(i.delete(e),i.size===0&&this.peerIPs.delete(t))}removePeer(e){const t=this.peerStats.get(e);if(t!=null){if(this.score(e)>0){this.removeIPsForPeer(e,t.knownIPs),this.peerStats.delete(e);return}Object.entries(t.topics).forEach(([n,i])=>{i.firstMessageDeliveries=0;const s=this.params.topics[n].meshMessageDeliveriesThreshold;if(i.inMesh&&i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<s){const o=s-i.meshMessageDeliveries;i.meshFailurePenalty+=o*o}i.inMesh=!1,i.meshMessageDeliveriesActive=!1}),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){const n=this.peerStats.get(e);if(n!=null){const i=this.getPtopicStats(n,t);i!=null&&(i.inMesh=!0,i.graftTime=Date.now(),i.meshTime=0,i.meshMessageDeliveriesActive=!1)}}prune(e,t){const n=this.peerStats.get(e);if(n!=null){const i=this.getPtopicStats(n,t);if(i!=null){const s=this.params.topics[t].meshMessageDeliveriesThreshold;if(i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<s){const o=s-i.meshMessageDeliveries;i.meshFailurePenalty+=o*o}i.meshMessageDeliveriesActive=!1,i.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,n){this.markFirstMessageDelivery(e,n);const i=this.deliveryRecords.ensureRecord(t),s=Date.now();if(i.status!==An.unknown){this.log("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,s-i.firstSeenTsMs,An[i.status]);return}i.status=An.valid,i.validated=s,i.peers.forEach(o=>{o!==e.toString()&&this.markDuplicateMessageDelivery(o,n)})}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,n,i){switch(i){case fs.Error:this.markInvalidMessageDelivery(e,n);return;case fs.Blacklisted:return}const s=this.deliveryRecords.ensureRecord(t);if(s.status!==An.unknown){this.log("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-s.firstSeenTsMs,An[s.status]);return}if(i===fs.Ignore){s.status=An.ignored,s.peers.clear();return}s.status=An.invalid,this.markInvalidMessageDelivery(e,n),s.peers.forEach(o=>{this.markInvalidMessageDelivery(o,n)}),s.peers.clear()}duplicateMessage(e,t,n){const i=this.deliveryRecords.ensureRecord(t);if(!i.peers.has(e))switch(i.status){case An.unknown:i.peers.add(e);break;case An.valid:i.peers.add(e),this.markDuplicateMessageDelivery(e,n,i.validated);break;case An.invalid:this.markInvalidMessageDelivery(e,n);break;case An.ignored:break}}markInvalidMessageDelivery(e,t){const n=this.peerStats.get(e);if(n!=null){const i=this.getPtopicStats(n,t);i!=null&&(i.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){const n=this.peerStats.get(e);if(n!=null){const i=this.getPtopicStats(n,t);if(i!=null){let s=this.params.topics[t].firstMessageDeliveriesCap;i.firstMessageDeliveries=Math.min(s,i.firstMessageDeliveries+1),i.inMesh&&(s=this.params.topics[t].meshMessageDeliveriesCap,i.meshMessageDeliveries=Math.min(s,i.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,n){var s;const i=this.peerStats.get(e);if(i!=null){const o=n!==void 0?Date.now():0,a=this.getPtopicStats(i,t);if(a!=null&&a.inMesh){const c=this.params.topics[t];if(n!==void 0){const d=o-n,h=d>c.meshMessageDeliveriesWindow;if((s=this.metrics)==null||s.onDuplicateMsgDelivery(t,d,h),h)return}const l=c.meshMessageDeliveriesCap;a.meshMessageDeliveries=Math.min(l,a.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(const n of t){const i=this.peerIPs.get(n);i!=null&&(i.delete(e),i.size===0&&this.peerIPs.delete(n))}}getPtopicStats(e,t){let n=e.topics[t];return n!==void 0?n:this.params.topics[t]!==void 0?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=n,n):null}}function mIe(r,e,t,n,i){let s=0;const o=new Map;if(Object.entries(e.topics).forEach(([p,w])=>{const f=i.get(p)??"unknown",g=t.topics[p];if(g===void 0)return;let v=o.get(f);v==null&&(v={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(f,v));let y=0,m=0,b=0,S=0,I=0;if(w.inMesh){const $=Math.max(w.meshTime/g.timeInMeshQuantum,g.timeInMeshCap);y+=$*g.timeInMeshWeight}let T=w.firstMessageDeliveries;if(T>g.firstMessageDeliveriesCap&&(T=g.firstMessageDeliveriesCap),m+=T*g.firstMessageDeliveriesWeight,w.meshMessageDeliveriesActive&&w.meshMessageDeliveries<g.meshMessageDeliveriesThreshold){const $=g.meshMessageDeliveriesThreshold-w.meshMessageDeliveries,z=$*$;b+=z*g.meshMessageDeliveriesWeight}const A=w.meshFailurePenalty;S+=A*g.meshFailurePenaltyWeight;const _=w.invalidMessageDeliveries*w.invalidMessageDeliveries;I+=_*g.invalidMessageDeliveriesWeight,s+=(y+m+b+S+I)*g.topicWeight,v.p1w+=y,v.p2w+=m,v.p3w+=b,v.p3bw+=S,v.p4w+=I}),t.topicScoreCap>0&&s>t.topicScoreCap){s=t.topicScoreCap;const p=t.topicScoreCap/s;for(const w of o.values())w.p1w*=p,w.p2w*=p,w.p3w*=p,w.p3bw*=p,w.p4w*=p}let a=0,c=0,l=0;const d=t.appSpecificScore(r);a+=d*t.appSpecificWeight,e.knownIPs.forEach(p=>{if(t.IPColocationFactorWhitelist.has(p))return;const w=n.get(p),f=w!=null?w.size:0;if(f>t.IPColocationFactorThreshold){const g=f-t.IPColocationFactorThreshold,v=g*g;c+=v*t.IPColocationFactorWeight}});const h=e.behaviourPenalty*e.behaviourPenalty;return l+=h*t.behaviourPenaltyWeight,s+=a+c+l,{byTopic:o,p5w:a,p6w:c,p7w:l,score:s}}function wIe(r,e,t,n,i){const s={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const o of r){const a=e.get(o);if(a!=null){const c=mIe(o,a,t,n,i);for(const[l,d]of c.byTopic){let h=s.byTopic.get(l);h==null&&(h={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},s.byTopic.set(l,h)),h.p1w.push(d.p1w),h.p2w.push(d.p2w),h.p3w.push(d.p3w),h.p3bw.push(d.p3bw),h.p4w.push(d.p4w)}s.p5w.push(c.p5w),s.p6w.push(c.p6w),s.p7w.push(c.p7w),s.score.push(c.score)}else s.p5w.push(0),s.p6w.push(0),s.p7w.push(0),s.score.push(0)}return s}class vIe{constructor(e,t,n){u(this,"rawStream");u(this,"pushable");u(this,"closeController");u(this,"maxBufferSize");this.rawStream=e,this.pushable=zo(),this.closeController=new AbortController,this.maxBufferSize=n.maxBufferSize??1/0,this.closeController.signal.addEventListener("abort",()=>{e.close().catch(i=>{e.abort(i)})}),gn(this.pushable,this.rawStream).catch(t)}get protocol(){return this.rawStream.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(NA.single(e))}pushPrefixed(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}async close(){this.closeController.abort(),await this.pushable.return()}}class bIe{constructor(e,t={}){u(this,"source");u(this,"rawStream");u(this,"closeController");this.rawStream=e,this.closeController=new AbortController,this.closeController.signal.addEventListener("abort",()=>{e.close().catch(n=>{e.abort(n)})}),this.source=gn(this.rawStream,n=>_9(n,t))}async close(){this.closeController.abort()}}class EIe{constructor(e,t,n){u(this,"gossipsubIWantFollowupMs");u(this,"msgIdToStrFn");u(this,"metrics");u(this,"promises",new Map);u(this,"requestMsByMsg",new Map);u(this,"requestMsByMsgExpire");this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=n,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){const n=Math.floor(Math.random()*t.length),i=t[n],s=this.msgIdToStrFn(i);let o=this.promises.get(s);o==null&&(o=new Map,this.promises.set(s,o));const a=Date.now();o.has(e)||(o.set(e,a+this.gossipsubIWantFollowupMs),this.metrics!=null&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(s)||this.requestMsByMsg.set(s,a)))}getBrokenPromises(){var i;const e=Date.now(),t=new Map;let n=0;return this.promises.forEach((s,o)=>{s.forEach((a,c)=>{a<e&&(t.set(c,(t.get(c)??0)+1),s.delete(c),n++)}),s.size===0&&this.promises.delete(o)}),(i=this.metrics)==null||i.iwantPromiseBroken.inc(n),t}deliverMessage(e,t=!1){this.trackMessage(e);const n=this.promises.get(e);n!=null&&(this.promises.delete(e),this.metrics!=null&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(n.size)))}rejectMessage(e,t){switch(this.trackMessage(e),t){case fs.Error:return}this.promises.delete(e)}clear(){this.promises.clear()}prune(){var n;const e=Date.now()-this.requestMsByMsgExpire;let t=0;for(const[i,s]of this.requestMsByMsg.entries())if(s<e)this.requestMsByMsg.delete(i),t++;else break;(n=this.metrics)==null||n.iwantMessagePruned.inc(t)}trackMessage(e){if(this.metrics!=null){const t=this.requestMsByMsg.get(e);t!==void 0&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}const iq=fe("libp2p-pubsub:");async function SIe(r,e,t,n){switch(r.type){case xh.Signing:{const i={from:r.author.toMultihash().bytes,data:n,seqno:Ac(8),topic:e,signature:void 0,key:void 0},s=ur([iq,Bl.Message.encode(i)]);i.signature=await r.privateKey.sign(s),i.key=r.key;const o={type:"signed",from:r.author,data:t,sequenceNumber:BigInt(`0x${ae(i.seqno??new Uint8Array(0),"base16")}`),topic:e,signature:i.signature,key:Un(i.key)};return{raw:i,msg:o}}case xh.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:e,signature:void 0,key:void 0},msg:{type:"unsigned",data:t,topic:e}};default:throw new Error("Unreachable")}}async function xIe(r,e){switch(r){case iS:return e.signature!=null?{valid:!1,error:xn.SignaturePresent}:e.seqno!=null?{valid:!1,error:xn.SeqnoPresent}:e.key!=null?{valid:!1,error:xn.FromPresent}:{valid:!0,message:{type:"unsigned",topic:e.topic,data:e.data??new Uint8Array(0)}};case iy:{if(e.seqno==null)return{valid:!1,error:xn.InvalidSeqno};if(e.seqno.length!==8)return{valid:!1,error:xn.InvalidSeqno};if(e.signature==null)return{valid:!1,error:xn.InvalidSignature};if(e.from==null)return{valid:!1,error:xn.InvalidPeerId};let t;try{t=li(rq(e.from))}catch{return{valid:!1,error:xn.InvalidPeerId}}let n;if(e.key!=null){if(n=Un(e.key),t.publicKey!==void 0&&!n.equals(t.publicKey))return{valid:!1,error:xn.InvalidPeerId}}else{if(t.publicKey==null)return{valid:!1,error:xn.InvalidPeerId};n=t.publicKey}const i={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},s=ur([iq,Bl.Message.encode(i)]);return await n.verify(s,e.signature)?{valid:!0,message:{type:"signed",from:t,data:e.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${ae(e.seqno,"base16")}`),topic:e.topic,signature:e.signature,key:e.key!=null?Un(e.key):n}}:{valid:!1,error:xn.InvalidSignature}}default:throw new Error("Unreachable")}}function Ts(r=[],e){return{subscriptions:[],messages:r,control:e!==void 0?{graft:e.graft??[],prune:e.prune??[],ihave:e.ihave??[],iwant:e.iwant??[],idontwant:e.idontwant??[]}:void 0}}function tN(r){return r.control===void 0&&(r.control={graft:[],prune:[],ihave:[],iwant:[],idontwant:[]}),r}function uo(r){if(r.length<=1)return r;const e=()=>Math.floor(Math.random()*Math.floor(r.length));for(let t=0;t<r.length;t++){const n=e(),i=r[t];r[t]=r[n],r[n]=i}return r}function AIe(r){return ae(r,"base64")}function IIe(r,e,t){switch(r){case iy:return{type:xh.Signing,author:e,key:Oi(t.publicKey),privateKey:t};case iS:return{type:xh.Anonymous};default:throw new Error(`Unknown signature policy "${r}"`)}}const CIe=(r,e)=>{const t=fe(e.toString(16).padStart(16,"0"),"base16"),n=Oi(r),i=new Uint8Array(n.byteLength+t.length);return i.set(n,0),i.set(t,n.byteLength),i};function kIe({name:r,code:e,encode:t}){return new _Ie(r,e,t)}class _Ie{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?G$(this.code,t):t.then(n=>G$(this.code,n))}else throw Error("Unknown type, must be binary type")}}function TIe(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const PIe=kIe({name:"sha2-256",code:18,encode:TIe("SHA-256")});function DIe(r){if(r.type!=="signed")throw new Error("expected signed message type");if(r.sequenceNumber==null)throw Error("missing seqno field");return CIe(r.from.publicKey??r.key,r.sequenceNumber)}async function $Ie(r){return PIe.encode(r.data)}var g3;(function(r){r[r.ip4=4]="ip4",r[r.ip6=41]="ip6"})(g3||(g3={}));function NIe(r){for(const e of r.tuples())switch(e[0]){case g3.ip4:case g3.ip6:return lx(e[0],e[1])}return null}class X6{constructor(e){u(this,"entries",new Map);u(this,"validityMs");this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return this.entries.has(e)?!0:(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){const e=Date.now();for(const[t,n]of this.entries.entries())if(n.validUntilMs<e)this.entries.delete(t);else break}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);return t!=null&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}var qn;(function(r){r[r.started=0]="started",r[r.stopped=1]="stopped"})(qn||(qn={}));var xO,AO,IO,CO;class sq extends(CO=tr,IO=Symbol.toStringTag,AO=lr,xO=Sc,CO){constructor(t,n={}){super();u(this,"globalSignaturePolicy");u(this,"multicodecs",[Y6,wAe,Y$]);u(this,"publishConfig");u(this,"dataTransform");u(this,"peers",new Map);u(this,"streamsInbound",new Map);u(this,"streamsOutbound",new Map);u(this,"outboundInflightQueue",zo({objectMode:!0}));u(this,"direct",new Set);u(this,"floodsubPeers",new Set);u(this,"seenCache");u(this,"acceptFromWhitelist",new Map);u(this,"topics",new Map);u(this,"subscriptions",new Set);u(this,"mesh",new Map);u(this,"fanout",new Map);u(this,"fanoutLastpub",new Map);u(this,"gossip",new Map);u(this,"control",new Map);u(this,"peerhave",new Map);u(this,"iasked",new Map);u(this,"backoff",new Map);u(this,"outbound",new Map);u(this,"msgIdFn");u(this,"fastMsgIdFn");u(this,"msgIdToStrFn");u(this,"fastMsgIdCache");u(this,"publishedMessageIds");u(this,"mcache");u(this,"score");u(this,"topicValidators",new Map);u(this,"log");u(this,"heartbeatTicks",0);u(this,"gossipTracer");u(this,"idontwantCounts",new Map);u(this,"idontwants",new Map);u(this,"components");u(this,"directPeerInitial",null);u(this,"opts");u(this,"decodeRpcLimits");u(this,"metrics");u(this,"status",{code:qn.stopped});u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"runOnLimitedConnection");u(this,"allowedTopics");u(this,"heartbeatTimer",null);u(this,IO,"@chainsafe/libp2p-gossipsub");u(this,AO,["@libp2p/pubsub"]);u(this,xO,["@libp2p/identify"]);u(this,"runHeartbeat",()=>{var n;const t=(n=this.metrics)==null?void 0:n.heartbeatDuration.startTimer();this.heartbeat().catch(i=>{this.log("Error running heartbeat",i)}).finally(()=>{var i;if(t!=null&&t(),this.status.code===qn.started){clearTimeout(this.status.heartbeatTimeout);let s=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;s<this.opts.heartbeatInterval*.25&&(s+=this.opts.heartbeatInterval,(i=this.metrics)==null||i.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,s)}})});u(this,"tagMeshPeer",t=>{const{peerId:n,topic:i}=t.detail;this.components.peerStore.merge(this.peers.get(n)??Zt(n),{tags:{[i]:{value:100}}}).catch(s=>{this.log.error("Error tagging peer %s with topic %s",n,i,s)})});u(this,"untagMeshPeer",t=>{const{peerId:n,topic:i}=t.detail;this.components.peerStore.merge(this.peers.get(n)??Zt(n),{tags:{[i]:void 0}}).catch(s=>{this.log.error("Error untagging peer %s with topic %s",n,i,s)})});const i={fallbackToFloodsub:!0,floodPublish:!0,batchPublish:!1,tagMeshPeers:!0,doPX:!1,directPeers:[],D:vAe,Dlo:bAe,Dhi:EAe,Dscore:SAe,Dout:xAe,Dlazy:CAe,heartbeatInterval:TAe,fanoutTTL:PAe,mcacheLength:AAe,mcacheGossip:IAe,seenTTL:VAe,gossipsubIWantFollowupMs:zAe,prunePeers:DAe,pruneBackoff:$Ae,unsubcribeBackoff:NAe,graftFloodThreshold:UAe,opportunisticGraftPeers:BAe,opportunisticGraftTicks:LAe,directConnectTicks:MAe,gossipFactor:kAe,idontwantMinDataSize:XAe,idontwantMaxMessages:JAe,...n,scoreParams:iIe(n.scoreParams),scoreThresholds:lIe(n.scoreThresholds)};if(this.components=t,this.decodeRpcLimits=i.decodeRpcLimits??ZAe,this.globalSignaturePolicy=i.globalSignaturePolicy??iy,i.fallbackToFloodsub&&this.multicodecs.push(Q$),this.log=t.logger.forComponent(i.debugName??"libp2p:gossipsub"),this.opts=i,this.direct=new Set(i.directPeers.map(s=>s.id.toString())),this.seenCache=new X6({validityMs:i.seenTTL}),this.publishedMessageIds=new X6({validityMs:i.seenTTL}),n.msgIdFn!=null)this.msgIdFn=n.msgIdFn;else switch(this.globalSignaturePolicy){case iy:this.msgIdFn=DIe;break;case iS:this.msgIdFn=$Ie;break;default:throw new Error(`Invalid globalSignaturePolicy: ${this.globalSignaturePolicy}`)}if(n.fastMsgIdFn!=null&&(this.fastMsgIdFn=n.fastMsgIdFn,this.fastMsgIdCache=new X6({validityMs:i.seenTTL})),this.msgIdToStrFn=n.msgIdToStrFn??AIe,this.mcache=n.messageCache??new eIe(i.mcacheGossip,i.mcacheLength,this.msgIdToStrFn),n.dataTransform!=null&&(this.dataTransform=n.dataTransform),n.metricsRegister!=null){if(n.metricsTopicStrToLabel==null)throw Error("Must set metricsTopicStrToLabel with metrics");const s=Math.max(...Object.values(i.scoreParams.topics).map(a=>a.meshMessageDeliveriesWindow),QAe),o=tIe(n.metricsRegister,n.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:i.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:s/1e3});o.mcacheSize.addCollect(()=>{this.onScrapeMetrics(o)});for(const a of this.multicodecs)o.protocolsEnabled.set({protocol:a},1);this.metrics=o}else this.metrics=null;this.gossipTracer=new EIe(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new yIe(this.opts.scoreParams,this.metrics,this.components.logger,{scoreCacheValidityMs:i.heartbeatInterval}),this.maxInboundStreams=n.maxInboundStreams,this.maxOutboundStreams=n.maxOutboundStreams,this.runOnLimitedConnection=n.runOnLimitedConnection,this.allowedTopics=i.allowedTopics!=null?new Set(i.allowedTopics):null}getPeers(){return[...this.peers.values()]}isStarted(){return this.status.code===qn.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=IIe(this.globalSignaturePolicy,this.components.peerId,this.components.privateKey),this.outboundInflightQueue=zo({objectMode:!0}),gn(this.outboundInflightQueue,async o=>{for await(const{peerId:a,connection:c}of o)await this.createOutboundStream(a,c)}).catch(o=>{this.log.error("outbound inflight queue error",o)}),await Promise.all(this.opts.directPeers.map(async o=>{await this.components.peerStore.merge(o.id,{multiaddrs:o.addrs})}));const t=this.components.registrar;await Promise.all(this.multicodecs.map(async o=>t.handle(o,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection})));const n={onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this),notifyOnLimitedConnection:this.runOnLimitedConnection},i=await Promise.all(this.multicodecs.map(async o=>t.register(o,n))),s=setTimeout(this.runHeartbeat,X$);this.status={code:qn.started,registrarTopologyIds:i,heartbeatTimeout:s,hearbeatStartMs:Date.now()+X$},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async o=>this.connect(o)))}).catch(o=>{this.log(o)})},RAe),this.opts.tagMeshPeers&&(this.addEventListener("gossipsub:graft",this.tagMeshPeer),this.addEventListener("gossipsub:prune",this.untagMeshPeer)),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==qn.started)return;const{registrarTopologyIds:t}=this.status;this.status={code:qn.stopped},this.opts.tagMeshPeers&&(this.removeEventListener("gossipsub:graft",this.tagMeshPeer),this.removeEventListener("gossipsub:prune",this.untagMeshPeer));const n=this.components.registrar;await Promise.all(this.multicodecs.map(async s=>n.unhandle(s))),t.forEach(s=>{n.unregister(s)}),this.outboundInflightQueue.end();const i=[];for(const s of this.streamsOutbound.values())i.push(s.close());this.streamsOutbound.clear();for(const s of this.streamsInbound.values())i.push(s.close());this.streamsInbound.clear(),await Promise.all(i),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer!=null&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache!=null&&this.fastMsgIdCache.clear(),this.directPeerInitial!=null&&clearTimeout(this.directPeerInitial),this.idontwantCounts.clear(),this.idontwants.clear(),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:t,connection:n}){if(!this.isStarted())return;const i=n.remotePeer;this.addPeer(i,n.direction,n.remoteAddr),this.createInboundStream(i,t),this.outboundInflightQueue.push({peerId:i,connection:n})}onPeerConnected(t,n){var i;(i=this.metrics)==null||i.newConnectionCount.inc({status:n.status}),!(!this.isStarted()||n.status!=="open")&&(this.addPeer(t,n.direction,n.remoteAddr),this.outboundInflightQueue.push({peerId:t,connection:n}))}onPeerDisconnected(t){this.log("connection ended %p",t),this.removePeer(t)}async createOutboundStream(t,n){var s;if(!this.isStarted())return;const i=t.toString();if(this.peers.has(i)&&!this.streamsOutbound.has(i))try{const o=new vIe(await n.newStream(this.multicodecs,{runOnLimitedConnection:this.runOnLimitedConnection}),c=>{this.log.error("outbound pipe error",c)},{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",t),this.streamsOutbound.set(i,o);const a=o.protocol;a===Q$&&this.floodsubPeers.add(i),(s=this.metrics)==null||s.peersPerProtocol.inc({protocol:a},1),this.subscriptions.size>0&&(this.log("send subscriptions to",i),this.sendSubscriptions(i,Array.from(this.subscriptions),!0))}catch(o){this.log.error("createOutboundStream error",o)}}createInboundStream(t,n){if(!this.isStarted())return;const i=t.toString();if(!this.peers.has(i))return;const s=this.streamsInbound.get(i);s!==void 0&&(this.log("replacing existing inbound steam %s",i),s.close().catch(a=>{this.log.error(a)})),this.log("create inbound stream %s",i);const o=new bIe(n,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(i,o),this.pipePeerReadStream(t,o.source).catch(a=>{this.log(a)})}addPeer(t,n,i){const s=t.toString();if(!this.peers.has(s)){this.log("new peer %p",t),this.peers.set(s,t),this.score.addPeer(s);const o=NIe(i);o!==null?this.score.addIP(s,o):this.log("Added peer has no IP in current address %s %s",s,i.toString()),this.outbound.has(s)||this.outbound.set(s,n==="outbound")}}removePeer(t){var o,a;const n=t.toString();if(!this.peers.has(n))return;this.log("delete peer %p",t),this.peers.delete(n);const i=this.streamsOutbound.get(n),s=this.streamsInbound.get(n);i!=null&&((o=this.metrics)==null||o.peersPerProtocol.inc({protocol:i.protocol},-1)),i==null||i.close().catch(c=>{this.log.error(c)}),s==null||s.close().catch(c=>{this.log.error(c)}),this.streamsOutbound.delete(n),this.streamsInbound.delete(n);for(const c of this.topics.values())c.delete(n);for(const[c,l]of this.mesh)l.delete(n)&&((a=this.metrics)==null||a.onRemoveFromMesh(c,Bs.Dc,1));for(const c of this.fanout.values())c.delete(n);this.floodsubPeers.delete(n),this.gossip.delete(n),this.control.delete(n),this.outbound.delete(n),this.idontwantCounts.delete(n),this.idontwants.delete(n),this.score.removePeer(n),this.acceptFromWhitelist.delete(n)}get started(){return this.status.code===qn.started}getMeshPeers(t){const n=this.mesh.get(t);return n!=null?Array.from(n):[]}getSubscribers(t){const n=this.topics.get(t);return(n!=null?Array.from(n):[]).map(i=>this.peers.get(i)??Zt(i))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(t,n){var i;try{await gn(n,async s=>{var o,a,c;for await(const l of s)try{const d=l.subarray(),h=Bl.decode(d,{limits:{subscriptions:this.decodeRpcLimits.maxSubscriptions,messages:this.decodeRpcLimits.maxMessages,control$:{ihave:this.decodeRpcLimits.maxIhaveMessageIDs,iwant:this.decodeRpcLimits.maxIwantMessageIDs,graft:this.decodeRpcLimits.maxControlMessages,prune:this.decodeRpcLimits.maxControlMessages,prune$:{peers:this.decodeRpcLimits.maxPeerInfos},idontwant:this.decodeRpcLimits.maxControlMessages,idontwant$:{messageIDs:this.decodeRpcLimits.maxIdontwantMessageIDs}}}});if((o=this.metrics)==null||o.onRpcRecv(h,d.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(t,h)}catch(p){(a=this.metrics)==null||a.onRpcRecvError(),this.log(p)}else this.handleReceivedRpc(t,h).catch(p=>{var w;(w=this.metrics)==null||w.onRpcRecvError(),this.log(p)})}catch(d){(c=this.metrics)==null||c.onRpcDataError(),this.log(d)}})}catch(s){(i=this.metrics)==null||i.onPeerReadStreamError(),this.handlePeerReadStreamError(s,t)}}handlePeerReadStreamError(t,n){this.log.error(t),this.onPeerDisconnected(n)}async handleReceivedRpc(t,n){var d;if(!this.acceptFrom(t.toString())){this.log("received message from unacceptable peer %p",t),(d=this.metrics)==null||d.rpcRecvNotAccepted.inc();return}const i=n.subscriptions!=null?n.subscriptions.length:0,s=n.messages!=null?n.messages.length:0;let o=0,a=0,c=0,l=0;if(n.control!=null&&(n.control.ihave!=null&&(o=n.control.ihave.length),n.control.iwant!=null&&(a=n.control.iwant.length),n.control.graft!=null&&(c=n.control.graft.length),n.control.prune!=null&&(l=n.control.prune.length)),this.log(`rpc.from ${t.toString()} subscriptions ${i} messages ${s} ihave ${o} iwant ${a} graft ${c} prune ${l}`),n.subscriptions!=null&&n.subscriptions.length>0){const h=[];n.subscriptions.forEach(p=>{const w=p.topic,f=p.subscribe===!0;if(w!=null){if(this.allowedTopics!=null&&!this.allowedTopics.has(w))return;this.handleReceivedSubscription(t,w,f),h.push({topic:w,subscribe:f})}}),this.safeDispatchEvent("subscription-change",{detail:{peerId:t,subscriptions:h}})}for(const h of n.messages){if(this.allowedTopics!=null&&!this.allowedTopics.has(h.topic))continue;const p=this.handleReceivedMessage(t,h).catch(w=>{var f;(f=this.metrics)==null||f.onMsgRecvError(h.topic),this.log(w)});this.opts.awaitRpcMessageHandler&&await p}n.control!=null&&await this.handleControlMessage(t.toString(),n.control)}handleReceivedSubscription(t,n,i){this.log("subscription update from %p topic %s",t,n);let s=this.topics.get(n);s==null&&(s=new Set,this.topics.set(n,s)),i?s.add(t.toString()):s.delete(t.toString())}async handleReceivedMessage(t,n){var o,a,c;(o=this.metrics)==null||o.onMsgRecvPreValidation(n.topic);const i=await this.validateReceivedMessage(t,n);(a=this.metrics)==null||a.onPrevalidationResult(n.topic,i.code);const s=i.code;switch(s){case In.duplicate:this.score.duplicateMessage(t.toString(),i.msgIdStr,n.topic),this.gossipTracer.deliverMessage(i.msgIdStr,!0),this.mcache.observeDuplicate(i.msgIdStr,t.toString());return;case In.invalid:if(i.msgIdStr!=null){const l=i.msgIdStr;this.score.rejectMessage(t.toString(),l,n.topic,i.reason),this.gossipTracer.rejectMessage(l,i.reason)}else this.score.rejectInvalidMessage(t.toString(),n.topic);(c=this.metrics)==null||c.onMsgRecvInvalid(n.topic,i);return;case In.valid:this.score.validateMessage(i.messageId.msgIdStr),this.gossipTracer.deliverMessage(i.messageId.msgIdStr),this.mcache.put(i.messageId,n,!this.opts.asyncValidation),this.subscriptions.has(n.topic)&&(!this.components.peerId.equals(t)||this.opts.emitSelf)&&(super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:t,msgId:i.messageId.msgIdStr,msg:i.msg}})),super.dispatchEvent(new CustomEvent("message",{detail:i.msg}))),this.opts.asyncValidation||this.forwardMessage(i.messageId.msgIdStr,n,t.toString());break;default:throw new Error(`Invalid validation result: ${s}`)}}async validateReceivedMessage(t,n){var p,w,f,g;const i=(p=this.fastMsgIdFn)==null?void 0:p.call(this,n),s=i!==void 0?(w=this.fastMsgIdCache)==null?void 0:w.get(i):void 0;if(s!=null)return{code:In.duplicate,msgIdStr:s};const o=await xIe(this.globalSignaturePolicy,n);if(!o.valid)return{code:In.invalid,reason:fs.Error,error:o.error};const a=o.message;try{this.dataTransform!=null&&(a.data=this.dataTransform.inboundTransform(n.topic,a.data))}catch(v){return this.log("Invalid message, transform failed",v),{code:In.invalid,reason:fs.Error,error:xn.TransformFailed}}const c=await this.msgIdFn(a),l=this.msgIdToStrFn(c),d={msgId:c,msgIdStr:l};if(i!==void 0&&this.fastMsgIdCache!=null&&this.fastMsgIdCache.put(i,l)&&((f=this.metrics)==null||f.fastMsgIdCacheCollision.inc()),this.seenCache.has(l))return{code:In.duplicate,msgIdStr:l};this.seenCache.put(l),(((g=n.data)==null?void 0:g.length)??0)>=this.opts.idontwantMinDataSize&&this.sendIDontWants(c,n.topic,t.toString());const h=this.topicValidators.get(n.topic);if(h!=null){let v;try{v=await h(t,a)}catch(y){const m=y.code;m===jAe&&(v=ki.Ignore),m===HAe?v=ki.Reject:v=ki.Ignore}if(v!==ki.Accept)return{code:In.invalid,reason:Z$(v),msgIdStr:l}}return{code:In.valid,messageId:d,msg:a}}getScore(t){return this.score.score(t)}sendSubscriptions(t,n,i){this.sendRpc(t,{subscriptions:n.map(s=>({topic:s,subscribe:i})),messages:[]})}async handleControlMessage(t,n){var l,d,h,p,w,f,g;if(n===void 0)return;const i=((l=n.ihave)==null?void 0:l.length)>0?this.handleIHave(t,n.ihave):[],s=((d=n.iwant)==null?void 0:d.length)>0?this.handleIWant(t,n.iwant):[],o=((h=n.graft)==null?void 0:h.length)>0?await this.handleGraft(t,n.graft):[];if(((p=n.prune)==null?void 0:p.length)>0&&await this.handlePrune(t,n.prune),((w=n.idontwant)==null?void 0:w.length)>0&&this.handleIdontwant(t,n.idontwant),i.length===0&&s.length===0&&o.length===0)return;const a=this.sendRpc(t,Ts(s,{iwant:i,prune:o})),c=(f=i[0])==null?void 0:f.messageIDs;c!=null&&(a?this.gossipTracer.addPromise(t,c):(g=this.metrics)==null||g.iwantPromiseUntracked.inc(1))}acceptFrom(t){if(this.direct.has(t))return!0;const n=Date.now(),i=this.acceptFromWhitelist.get(t);if(i!=null&&i.messagesAccepted<WAe&&i.acceptUntil>=n)return i.messagesAccepted+=1,!0;const s=this.score.score(t);return s>=qAe?this.acceptFromWhitelist.set(t,{messagesAccepted:0,acceptUntil:n+GAe}):this.acceptFromWhitelist.delete(t),s>=this.opts.scoreThresholds.graylistThreshold}handleIHave(t,n){var d,h,p;if(n.length===0)return[];const i=this.score.score(t);if(i<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",t,i),(d=this.metrics)==null||d.ihaveRcvIgnored.inc({reason:b1.LowScore}),[];const s=(this.peerhave.get(t)??0)+1;if(this.peerhave.set(t,s),s>FAe)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",t,s),(h=this.metrics)==null||h.ihaveRcvIgnored.inc({reason:b1.MaxIhave}),[];const o=this.iasked.get(t)??0;if(o>=Ku)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",t,o),(p=this.metrics)==null||p.ihaveRcvIgnored.inc({reason:b1.MaxIasked}),[];const a=new Map;if(n.forEach(({topicID:w,messageIDs:f})=>{var v;if(w==null||f==null||!this.mesh.has(w))return;let g=0;f.forEach(y=>{const m=this.msgIdToStrFn(y);this.seenCache.has(m)||(a.set(m,y),g++)}),(v=this.metrics)==null||v.onIhaveRcv(w,f.length,g)}),a.size===0)return[];let c=a.size;c+o>Ku&&(c=Ku-o),this.log("IHAVE: Asking for %d out of %d messages from %s",c,a.size,t);let l=Array.from(a.values());return uo(l),l=l.slice(0,c),this.iasked.set(t,o+c),[{messageIDs:l}]}handleIWant(t,n){var c;if(n.length===0)return[];const i=this.score.score(t);if(i<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",t,i),[];const s=new Map,o=new Map;let a=0;return n.forEach(({messageIDs:l})=>{l==null||l.forEach(d=>{const h=this.msgIdToStrFn(d),p=this.mcache.getWithIWantCount(h,t);if(p==null){a++;return}if(o.set(p.msg.topic,1+(o.get(p.msg.topic)??0)),p.count>_Ae){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",t,d);return}s.set(h,p.msg)})}),(c=this.metrics)==null||c.onIwantRcv(o,a),s.size===0?(this.log("IWANT: Could not provide any wanted messages to %s",t),[]):(this.log("IWANT: Sending %d messages to %s",s.size,t),Array.from(s.values()))}async handleGraft(t,n){const i=[],s=this.score.score(t),o=Date.now();let a=this.opts.doPX;if(n.forEach(({topicID:l})=>{var p,w;if(l==null)return;const d=this.mesh.get(l);if(d==null){a=!1;return}if(d.has(t))return;const h=(p=this.backoff.get(l))==null?void 0:p.get(t);if(this.direct.has(t))this.log("GRAFT: ignoring request from direct peer %s",t),i.push(l),a=!1;else if(typeof h=="number"&&o<h){this.log("GRAFT: ignoring backed off peer %s",t),this.score.addPenalty(t,1,v1.GraftBackoff),a=!1;const f=h+this.opts.graftFloodThreshold-this.opts.pruneBackoff;o<f&&this.score.addPenalty(t,1,v1.GraftBackoff),this.addBackoff(t,l),i.push(l)}else s<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",t,s,l),i.push(l),a=!1,this.addBackoff(t,l)):d.size>=this.opts.Dhi&&!(this.outbound.get(t)??!1)?(i.push(l),this.addBackoff(t,l)):(this.log("GRAFT: Add mesh link from %s in %s",t,l),this.score.graft(t,l),d.add(t),(w=this.metrics)==null||w.onAddToMesh(l,Tn.Subscribed,1));this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:t,topic:l,direction:"inbound"}})}),i.length===0)return[];const c=!1;return Promise.all(i.map(async l=>this.makePrune(t,l,a,c)))}async handlePrune(t,n){var s;const i=this.score.score(t);for(const{topicID:o,backoff:a,peers:c}of n){if(o==null)continue;const l=this.mesh.get(o);if(l==null)return;this.log("PRUNE: Remove mesh link to %s in %s",t,o),this.score.prune(t,o),l.has(t)&&(l.delete(t),(s=this.metrics)==null||s.onRemoveFromMesh(o,Bs.Prune,1)),typeof a=="number"&&a>0?this.doAddBackoff(t,o,a*1e3):this.addBackoff(t,o),c!=null&&c.length>0&&(i<this.opts.scoreThresholds.acceptPXThreshold?this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",t,i,o):await this.pxConnect(c)),this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:t,topic:o,direction:"inbound"}})}}handleIdontwant(t,n){var l;let i=this.idontwantCounts.get(t)??0;if(i>=this.opts.idontwantMaxMessages)return;const s=i;let o=this.idontwants.get(t);o==null&&(o=new Map,this.idontwants.set(t,o));let a=0;e:for(const{messageIDs:d}of n)for(const h of d){if(i>=this.opts.idontwantMaxMessages)break e;i++;const p=this.msgIdToStrFn(h);o.set(p,this.heartbeatTicks),this.mcache.msgs.has(p)||a++}this.idontwantCounts.set(t,i);const c=i-s;(l=this.metrics)==null||l.onIdontwantRcv(c,a)}addBackoff(t,n){this.doAddBackoff(t,n,this.opts.pruneBackoff)}doAddBackoff(t,n,i){let s=this.backoff.get(n);s==null&&(s=new Map,this.backoff.set(n,s));const o=Date.now()+i;(s.get(t)??0)<o&&s.set(t,o)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((t,n)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",n,t),this.score.addPenalty(n,t,v1.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%OAe!==0)return;const t=Date.now();this.backoff.forEach((n,i)=>{n.forEach((s,o)=>{s+YAe*this.opts.heartbeatInterval<t&&n.delete(o)}),n.size===0&&this.backoff.delete(i)})}async directConnect(){const t=[];this.direct.forEach(n=>{this.streamsOutbound.has(n)||t.push(n)}),await Promise.all(t.map(async n=>this.connect(n)))}async pxConnect(t){t.length>this.opts.prunePeers&&(uo(t),t=t.slice(0,this.opts.prunePeers));const n=[];await Promise.all(t.map(async i=>{if(i.peerID==null)return;const s=li(rq(i.peerID)),o=s.toString();if(!this.peers.has(o)){if(i.signedPeerRecord==null){n.push(o);return}try{if(!await this.components.peerStore.consumePeerRecord(i.signedPeerRecord,s)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}n.push(o)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),n.length!==0&&await Promise.all(n.map(async i=>this.connect(i)))}async connect(t){var s;this.log("Initiating connection with %s",t);const n=Zt(t),i=await this.components.connectionManager.openConnection(n);for(const o of this.multicodecs)for(const a of this.components.registrar.getTopologies(o))(s=a.onConnect)==null||s.call(a,n,i)}subscribe(t){if(this.status.code!==qn.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(t)){this.subscriptions.add(t);for(const n of this.peers.keys())this.sendSubscriptions(n,[t],!0)}this.join(t)}unsubscribe(t){if(this.status.code!==qn.started)throw new Error("Pubsub is not started");const n=this.subscriptions.delete(t);if(this.log("unsubscribe from %s - am subscribed %s",t,n),n)for(const i of this.peers.keys())this.sendSubscriptions(i,[t],!1);this.leave(t)}join(t){var o,a,c;if(this.status.code!==qn.started)throw new Error("Gossipsub has not started");if(this.mesh.has(t))return;this.log("JOIN %s",t),(o=this.metrics)==null||o.onJoin(t);const n=new Set,i=this.backoff.get(t),s=this.fanout.get(t);if(s!=null&&(this.fanout.delete(t),this.fanoutLastpub.delete(t),s.forEach(l=>{!this.direct.has(l)&&this.score.score(l)>=0&&(i==null?void 0:i.has(l))!==!0&&n.add(l)}),(a=this.metrics)==null||a.onAddToMesh(t,Tn.Fanout,n.size)),n.size<this.opts.D){const l=n.size;this.getRandomGossipPeers(t,this.opts.D,h=>!n.has(h)&&!this.direct.has(h)&&this.score.score(h)>=0&&(i==null?void 0:i.has(h))!==!0).forEach(h=>{n.add(h)}),(c=this.metrics)==null||c.onAddToMesh(t,Tn.Random,n.size-l)}this.mesh.set(t,n),n.forEach(l=>{this.log("JOIN: Add mesh link to %s in %s",l,t),this.sendGraft(l,t)})}leave(t){var i;if(this.status.code!==qn.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",t),(i=this.metrics)==null||i.onLeave(t);const n=this.mesh.get(t);n!=null&&(Promise.all(Array.from(n).map(async s=>{this.log("LEAVE: Remove mesh link to %s in %s",s,t),await this.sendPrune(s,t)})).catch(s=>{this.log("Error sending prunes to mesh peers",s)}),this.mesh.delete(t))}selectPeersToForward(t,n,i){const s=new Set,o=this.topics.get(t);o!=null&&(this.direct.forEach(c=>{o.has(c)&&n!==c&&!((i==null?void 0:i.has(c))??!1)&&s.add(c)}),this.floodsubPeers.forEach(c=>{o.has(c)&&n!==c&&!((i==null?void 0:i.has(c))??!1)&&this.score.score(c)>=this.opts.scoreThresholds.publishThreshold&&s.add(c)}));const a=this.mesh.get(t);return a!=null&&a.size>0&&a.forEach(c=>{n!==c&&!((i==null?void 0:i.has(c))??!1)&&s.add(c)}),s}selectPeersToPublish(t){const n=new Set,i={direct:0,floodsub:0,mesh:0,fanout:0},s=this.topics.get(t);if(s!=null)if(this.opts.floodPublish)s.forEach(o=>{this.direct.has(o)?(n.add(o),i.direct++):this.score.score(o)>=this.opts.scoreThresholds.publishThreshold&&(n.add(o),i.floodsub++)});else{this.direct.forEach(a=>{s.has(a)&&(n.add(a),i.direct++)}),this.floodsubPeers.forEach(a=>{s.has(a)&&this.score.score(a)>=this.opts.scoreThresholds.publishThreshold&&(n.add(a),i.floodsub++)});const o=this.mesh.get(t);if(o!=null&&o.size>0)o.forEach(a=>{n.add(a),i.mesh++}),o.size<this.opts.D&&this.getRandomGossipPeers(t,this.opts.D-o.size,c=>!o.has(c)&&!this.direct.has(c)&&!this.floodsubPeers.has(c)&&this.score.score(c)>=this.opts.scoreThresholds.publishThreshold).forEach(c=>{n.add(c),i.mesh++});else{const a=this.fanout.get(t);if(a!=null&&a.size>0)a.forEach(c=>{n.add(c),i.fanout++});else{const c=this.getRandomGossipPeers(t,this.opts.D,l=>this.score.score(l)>=this.opts.scoreThresholds.publishThreshold);c.size>0&&(this.fanout.set(t,c),c.forEach(l=>{n.add(l),i.fanout++}))}this.fanoutLastpub.set(t,Date.now())}}return{tosend:n,tosendCount:i}}forwardMessage(t,n,i,s){var a;i!=null&&this.score.deliverMessage(i,t,n.topic);const o=this.selectPeersToForward(n.topic,i,s);o.forEach(c=>{this.sendRpc(c,Ts([n]))}),(a=this.metrics)==null||a.onForwardMsg(n.topic,o.size)}async publish(t,n,i){var b,S;const s=Date.now(),o=this.dataTransform!=null?this.dataTransform.outboundTransform(t,n):n;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");const{raw:a,msg:c}=await SIe(this.publishConfig,t,n,o),l=await this.msgIdFn(c),d=this.msgIdToStrFn(l),h=(i==null?void 0:i.ignoreDuplicatePublishError)??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(d)){if(h)return(b=this.metrics)==null||b.onPublishDuplicateMsg(t),{recipients:[]};throw Error("PublishError.Duplicate")}const{tosend:p,tosendCount:w}=this.selectPeersToPublish(t),f=this.opts.emitSelf&&this.subscriptions.has(t),g=(i==null?void 0:i.allowPublishToZeroTopicPeers)??this.opts.allowPublishToZeroTopicPeers;if(p.size===0&&!g&&!f)throw Error("PublishError.NoPeersSubscribedToTopic");this.seenCache.put(d),this.mcache.put({msgId:l,msgIdStr:d},a,!0),this.publishedMessageIds.put(d);const v=(i==null?void 0:i.batchPublish)??this.opts.batchPublish,y=Ts([a]);if(v)this.sendRpcInBatch(p,y);else for(const I of p)this.sendRpc(I,y)||p.delete(I);const m=Date.now()-s;return(S=this.metrics)==null||S.onPublishMsg(t,w,p.size,a.data!=null?a.data.length:0,m),f&&(p.add(this.components.peerId.toString()),super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:d,msg:c}})),super.dispatchEvent(new CustomEvent("message",{detail:c}))),{recipients:Array.from(p.values()).map(I=>this.peers.get(I)??Zt(I))}}sendRpcInBatch(t,n){var o;const i=Bl.encode(n),s=NA.single(i);for(const a of t){const c=this.streamsOutbound.get(a);if(c==null){this.log(`Cannot send RPC to ${a} as there is no open stream to it available`),t.delete(a);continue}try{c.pushPrefixed(s)}catch(l){t.delete(a),this.log.error(`Cannot send rpc to ${a}`,l)}(o=this.metrics)==null||o.onRpcSent(n,i.length)}}reportMessageValidationResult(t,n,i){var a;let s;if(i===ki.Accept){if(s=this.mcache.validate(t),s!=null){const{message:c,originatingPeers:l}=s;this.score.deliverMessage(n,t,c.topic),this.forwardMessage(t,s.message,n,l)}}else if(s=this.mcache.remove(t),s!=null){const c=Z$(i),{message:l,originatingPeers:d}=s;this.score.rejectMessage(n,t,l.topic,c);for(const h of d)this.score.rejectMessage(h,t,l.topic,c)}const o=this.score.messageFirstSeenTimestampMs(t);(a=this.metrics)==null||a.onReportValidation(s,i,o)}sendGraft(t,n){const s=Ts([],{graft:[{topicID:n}]});this.sendRpc(t,s)}async sendPrune(t,n){const s=[await this.makePrune(t,n,this.opts.doPX,!0)],o=Ts([],{prune:s});this.sendRpc(t,o)}sendIDontWants(t,n,i){var c;const s=this.mesh.get(n);if(s==null)return;const o=new Set(s);o.delete(i);for(const l of o)((c=this.streamsOutbound.get(l))==null?void 0:c.protocol)!==Y6&&o.delete(l);const a=Ts([],{idontwant:[{messageIDs:[t]}]});this.sendRpcInBatch(o,a)}sendRpc(t,n){var c,l,d,h,p;const i=this.streamsOutbound.get(t);if(i==null)return this.log(`Cannot send RPC to ${t} as there is no open stream to it available`),!1;const s=this.control.get(t);s!=null&&(this.piggybackControl(t,n,s),this.control.delete(t));const o=this.gossip.get(t);o!=null&&(this.piggybackGossip(t,n,o),this.gossip.delete(t));const a=Bl.encode(n);try{i.push(a)}catch(w){return this.log.error(`Cannot send rpc to ${t}`,w),s!=null&&this.control.set(t,s),o!=null&&this.gossip.set(t,o),!1}if((c=this.metrics)==null||c.onRpcSent(n,a.length),((l=n.control)==null?void 0:l.graft)!=null)for(const w of(d=n.control)==null?void 0:d.graft)w.topicID!=null&&this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:t,topic:w.topicID,direction:"outbound"}});if(((h=n.control)==null?void 0:h.prune)!=null)for(const w of(p=n.control)==null?void 0:p.prune)w.topicID!=null&&this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:t,topic:w.topicID,direction:"outbound"}});return!0}piggybackControl(t,n,i){var o,a;const s=tN(n);for(const c of i.graft)c.topicID!=null&&(((o=this.mesh.get(c.topicID))==null?void 0:o.has(t))??!1)&&s.control.graft.push(c);for(const c of i.prune)c.topicID!=null&&!(((a=this.mesh.get(c.topicID))==null?void 0:a.has(t))??!1)&&s.control.prune.push(c)}piggybackGossip(t,n,i){const s=tN(n);s.control.ihave=i}async sendGraftPrune(t,n,i){const s=this.opts.doPX,o=!1;for(const[a,c]of t){const l=c.map(p=>({topicID:p}));let d=[];const h=n.get(a);h!=null&&(d=await Promise.all(h.map(async p=>this.makePrune(a,p,s&&!(i.get(a)??!1),o))),n.delete(a)),this.sendRpc(a,Ts([],{graft:l,prune:d}))}for(const[a,c]of n){const l=await Promise.all(c.map(async d=>this.makePrune(a,d,s&&!(i.get(a)??!1),o)));this.sendRpc(a,Ts([],{prune:l}))}}emitGossip(t){const n=this.mcache.getGossipIDs(new Set(t.keys()));for(const[i,s]of t)this.doEmitGossip(i,s,n.get(i)??[])}doEmitGossip(t,n,i){if(i.length===0||(uo(i),i.length>Ku&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",i.length),n.size===0))return;let s=this.opts.Dlazy;const a=this.opts.gossipFactor*n.size;let c=n;a>s&&(s=a),s>c.size?s=c.size:c=uo(Array.from(c)).slice(0,s),c.forEach(l=>{let d=i;i.length>Ku&&(d=uo(d.slice()).slice(0,Ku)),this.pushGossip(l,{topicID:t,messageIDs:d})})}flush(){for(const[t,n]of this.gossip.entries())this.gossip.delete(t),this.sendRpc(t,Ts([],{ihave:n}));for(const[t,n]of this.control.entries()){this.control.delete(t);const i=Ts([],{graft:n.graft,prune:n.prune});this.sendRpc(t,i)}}pushGossip(t,n){this.log("Add gossip to %s",t);const i=this.gossip.get(t)??[];this.gossip.set(t,i.concat(n))}async makePrune(t,n,i,s){var d;if(this.score.prune(t,n),((d=this.streamsOutbound.get(t))==null?void 0:d.protocol)===Y$)return{topicID:n,peers:[]};const o=s?this.opts.unsubcribeBackoff:this.opts.pruneBackoff,a=o/1e3;if(this.doAddBackoff(t,n,o),!i)return{topicID:n,peers:[],backoff:a};const c=this.getRandomGossipPeers(n,this.opts.prunePeers,h=>h!==t&&this.score.score(h)>=0),l=await Promise.all(Array.from(c).map(async h=>{const p=this.peers.get(h)??Zt(h);let w;try{w=await this.components.peerStore.get(p)}catch(f){if(f.name!=="NotFoundError")throw f}return{peerID:p.toMultihash().bytes,signedPeerRecord:w==null?void 0:w.peerRecordEnvelope}}));return{topicID:n,peers:l,backoff:a}}async heartbeat(){var g,v;const{D:t,Dlo:n,Dhi:i,Dscore:s,Dout:o,fanoutTTL:a}=this.opts;this.heartbeatTicks++;const c=new Map,l=y=>{let m=c.get(y);return m===void 0&&(m=this.score.score(y),c.set(y,m)),m},d=new Map,h=new Map,p=new Map;this.clearBackoff(),this.peerhave.clear(),(g=this.metrics)==null||g.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.idontwantCounts.clear();for(const y of this.idontwants.values())for(const[m,b]of y)this.heartbeatTicks-b>=this.opts.mcacheLength&&y.delete(m);this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),(v=this.fastMsgIdCache)==null||v.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const w=new Map;this.mesh.forEach((y,m)=>{const b=this.topics.get(m),S=new Set,I=new Set;if(w.set(m,I),b!=null){const _=uo(Array.from(b)),$=this.backoff.get(m);for(const z of _){const j=this.streamsOutbound.get(z);if(j!=null&&this.multicodecs.includes(j.protocol)&&!y.has(z)&&!this.direct.has(z)){const K=l(z);($==null?void 0:$.has(z))!==!0&&K>=0&&S.add(z),K>=this.opts.scoreThresholds.gossipThreshold&&I.add(z)}}}const T=(_,$)=>{var j;this.log("HEARTBEAT: Remove mesh link to %s in %s",_,m),this.addBackoff(_,m),y.delete(_),l(_)>=this.opts.scoreThresholds.gossipThreshold&&I.add(_),(j=this.metrics)==null||j.onRemoveFromMesh(m,$,1);const z=h.get(_);z==null?h.set(_,[m]):z.push(m)},A=(_,$)=>{var j;this.log("HEARTBEAT: Add mesh link to %s in %s",_,m),this.score.graft(_,m),y.add(_),I.delete(_),(j=this.metrics)==null||j.onAddToMesh(m,$,1);const z=d.get(_);z==null?d.set(_,[m]):z.push(m)};if(y.forEach(_=>{const $=l(_);$<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",_,$,m),T(_,Bs.BadScore),p.set(_,!0))}),y.size<n){const _=t-y.size;uIe(S,_).forEach(z=>{A(z,Tn.NotEnough)})}if(y.size>i){let _=Array.from(y);_.sort((z,j)=>l(j)-l(z)),_=_.slice(0,s).concat(uo(_.slice(s)));let $=0;if(_.slice(0,t).forEach(z=>{(this.outbound.get(z)??!1)&&$++}),$<o){const z=K=>{const Z=_[K];for(let G=K;G>0;G--)_[G]=_[G-1];_[0]=Z};if($>0){let K=$;for(let Z=1;Z<t&&K>0;Z++)(this.outbound.get(_[Z])??!1)&&(z(Z),K--)}let j=t-$;for(let K=t;K<_.length&&j>0;K++)(this.outbound.get(_[K])??!1)&&(z(K),j--)}_.slice(t).forEach(z=>{T(z,Bs.Excess)})}if(y.size>=n){let _=0;if(y.forEach($=>{(this.outbound.get($)??!1)&&_++}),_<o){const $=o-_;P9(S,$,j=>this.outbound.get(j)===!0).forEach(j=>{A(j,Tn.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&y.size>1){const _=Array.from(y).sort((j,K)=>l(j)-l(K)),$=Math.floor(y.size/2),z=l(_[$]);if(z<this.opts.scoreThresholds.opportunisticGraftThreshold){const j=this.opts.opportunisticGraftPeers,K=P9(S,j,Z=>l(Z)>z);for(const Z of K)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",Z,m),A(Z,Tn.Opportunistic)}}});const f=Date.now();this.fanoutLastpub.forEach((y,m)=>{y+a<f&&(this.fanout.delete(m),this.fanoutLastpub.delete(m))}),this.fanout.forEach((y,m)=>{const b=this.topics.get(m);y.forEach(A=>{(!((b==null?void 0:b.has(A))??!1)||l(A)<this.opts.scoreThresholds.publishThreshold)&&y.delete(A)});const S=this.topics.get(m),I=[],T=new Set;if(w.set(m,T),S!=null){const A=uo(Array.from(S));for(const _ of A){const $=this.streamsOutbound.get(_);if($!=null&&this.multicodecs.includes($.protocol)&&!y.has(_)&&!this.direct.has(_)){const z=l(_);z>=this.opts.scoreThresholds.publishThreshold&&I.push(_),z>=this.opts.scoreThresholds.gossipThreshold&&T.add(_)}}}if(y.size<t){const A=t-y.size;I.slice(0,A).forEach(_=>{y.add(_),T==null||T.delete(_)})}}),this.emitGossip(w),await this.sendGraftPrune(d,h,p),this.flush(),this.mcache.shift(),this.dispatchEvent(new CustomEvent("gossipsub:heartbeat"))}getRandomGossipPeers(t,n,i=()=>!0){const s=this.topics.get(t);if(s==null)return new Set;let o=[];return s.forEach(a=>{const c=this.streamsOutbound.get(a);c!=null&&this.multicodecs.includes(c.protocol)&&i(a)&&o.push(a)}),o=uo(o),n>0&&o.length>n&&(o=o.slice(0,n)),new Set(o)}onScrapeMetrics(t){var l,d;t.mcacheSize.set(this.mcache.size),t.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),t.cacheSize.set({cache:"direct"},this.direct.size),t.cacheSize.set({cache:"seenCache"},this.seenCache.size),t.cacheSize.set({cache:"fastMsgIdCache"},((l=this.fastMsgIdCache)==null?void 0:l.size)??0),t.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),t.cacheSize.set({cache:"mcache"},this.mcache.size),t.cacheSize.set({cache:"score"},this.score.size),t.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),t.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),t.cacheSize.set({cache:"topics"},this.topics.size),t.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),t.cacheSize.set({cache:"mesh"},this.mesh.size),t.cacheSize.set({cache:"fanout"},this.fanout.size),t.cacheSize.set({cache:"peers"},this.peers.size),t.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),t.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),t.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),t.cacheSize.set({cache:"gossip"},this.gossip.size),t.cacheSize.set({cache:"control"},this.control.size),t.cacheSize.set({cache:"peerhave"},this.peerhave.size),t.cacheSize.set({cache:"outbound"},this.outbound.size);let n=0;const i=Date.now();t.connectedPeersBackoffSec.reset();for(const h of this.backoff.values()){n+=h.size;for(const[p,w]of h.entries())this.peers.has(p)&&t.connectedPeersBackoffSec.observe(Math.max(0,w-i)/1e3)}t.cacheSize.set({cache:"backoff"},n);let s=0;for(const h of this.idontwants.values())s+=h.size;t.cacheSize.set({cache:"idontwants"},s);for(const[h,p]of this.topics)t.topicPeersCount.set({topicStr:h},p.size);for(const[h,p]of this.mesh)t.meshPeerCounts.set({topicStr:h},p.size);const o=[],a=new Map;t.behaviourPenalty.reset();for(const h of this.peers.keys()){const p=this.score.score(h);o.push(p),a.set(h,p),t.behaviourPenalty.observe(((d=this.score.peerStats.get(h))==null?void 0:d.behaviourPenalty)??0)}t.registerScores(o,this.opts.scoreThresholds),t.registerScorePerMesh(this.mesh,a);const c=wIe(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,t.topicStrToLabel);t.registerScoreWeights(c)}}u(sq,"multicodec",Y6);function OIe(r={}){return e=>new sq(e,r)}var oq={},RA={};RA.toString=function(r){switch(r){case 1:return"A";case 10:return"NULL";case 28:return"AAAA";case 18:return"AFSDB";case 42:return"APL";case 257:return"CAA";case 60:return"CDNSKEY";case 59:return"CDS";case 37:return"CERT";case 5:return"CNAME";case 49:return"DHCID";case 32769:return"DLV";case 39:return"DNAME";case 48:return"DNSKEY";case 43:return"DS";case 55:return"HIP";case 13:return"HINFO";case 45:return"IPSECKEY";case 25:return"KEY";case 36:return"KX";case 29:return"LOC";case 15:return"MX";case 35:return"NAPTR";case 2:return"NS";case 47:return"NSEC";case 50:return"NSEC3";case 51:return"NSEC3PARAM";case 12:return"PTR";case 46:return"RRSIG";case 17:return"RP";case 24:return"SIG";case 6:return"SOA";case 99:return"SPF";case 33:return"SRV";case 44:return"SSHFP";case 32768:return"TA";case 249:return"TKEY";case 52:return"TLSA";case 250:return"TSIG";case 16:return"TXT";case 252:return"AXFR";case 251:return"IXFR";case 41:return"OPT";case 255:return"ANY"}return"UNKNOWN_"+r};RA.toType=function(r){switch(r.toUpperCase()){case"A":return 1;case"NULL":return 10;case"AAAA":return 28;case"AFSDB":return 18;case"APL":return 42;case"CAA":return 257;case"CDNSKEY":return 60;case"CDS":return 59;case"CERT":return 37;case"CNAME":return 5;case"DHCID":return 49;case"DLV":return 32769;case"DNAME":return 39;case"DNSKEY":return 48;case"DS":return 43;case"HIP":return 55;case"HINFO":return 13;case"IPSECKEY":return 45;case"KEY":return 25;case"KX":return 36;case"LOC":return 29;case"MX":return 15;case"NAPTR":return 35;case"NS":return 2;case"NSEC":return 47;case"NSEC3":return 50;case"NSEC3PARAM":return 51;case"PTR":return 12;case"RRSIG":return 46;case"RP":return 17;case"SIG":return 24;case"SOA":return 6;case"SPF":return 99;case"SRV":return 33;case"SSHFP":return 44;case"TA":return 32768;case"TKEY":return 249;case"TLSA":return 52;case"TSIG":return 250;case"TXT":return 16;case"AXFR":return 252;case"IXFR":return 251;case"OPT":return 41;case"ANY":return 255;case"*":return 255}return r.toUpperCase().startsWith("UNKNOWN_")?parseInt(r.slice(8)):0};var LA={};LA.toString=function(r){switch(r){case 0:return"NOERROR";case 1:return"FORMERR";case 2:return"SERVFAIL";case 3:return"NXDOMAIN";case 4:return"NOTIMP";case 5:return"REFUSED";case 6:return"YXDOMAIN";case 7:return"YXRRSET";case 8:return"NXRRSET";case 9:return"NOTAUTH";case 10:return"NOTZONE";case 11:return"RCODE_11";case 12:return"RCODE_12";case 13:return"RCODE_13";case 14:return"RCODE_14";case 15:return"RCODE_15"}return"RCODE_"+r};LA.toRcode=function(r){switch(r.toUpperCase()){case"NOERROR":return 0;case"FORMERR":return 1;case"SERVFAIL":return 2;case"NXDOMAIN":return 3;case"NOTIMP":return 4;case"REFUSED":return 5;case"YXDOMAIN":return 6;case"YXRRSET":return 7;case"NXRRSET":return 8;case"NOTAUTH":return 9;case"NOTZONE":return 10;case"RCODE_11":return 11;case"RCODE_12":return 12;case"RCODE_13":return 13;case"RCODE_14":return 14;case"RCODE_15":return 15}return 0};var BA={};BA.toString=function(r){switch(r){case 0:return"QUERY";case 1:return"IQUERY";case 2:return"STATUS";case 3:return"OPCODE_3";case 4:return"NOTIFY";case 5:return"UPDATE";case 6:return"OPCODE_6";case 7:return"OPCODE_7";case 8:return"OPCODE_8";case 9:return"OPCODE_9";case 10:return"OPCODE_10";case 11:return"OPCODE_11";case 12:return"OPCODE_12";case 13:return"OPCODE_13";case 14:return"OPCODE_14";case 15:return"OPCODE_15"}return"OPCODE_"+r};BA.toOpcode=function(r){switch(r.toUpperCase()){case"QUERY":return 0;case"IQUERY":return 1;case"STATUS":return 2;case"OPCODE_3":return 3;case"NOTIFY":return 4;case"UPDATE":return 5;case"OPCODE_6":return 6;case"OPCODE_7":return 7;case"OPCODE_8":return 8;case"OPCODE_9":return 9;case"OPCODE_10":return 10;case"OPCODE_11":return 11;case"OPCODE_12":return 12;case"OPCODE_13":return 13;case"OPCODE_14":return 14;case"OPCODE_15":return 15}return 0};var UA={};UA.toString=function(r){switch(r){case 1:return"IN";case 2:return"CS";case 3:return"CH";case 4:return"HS";case 255:return"ANY"}return"UNKNOWN_"+r};UA.toClass=function(r){switch(r.toUpperCase()){case"IN":return 1;case"CS":return 2;case"CH":return 3;case"HS":return 4;case"ANY":return 255}return 0};var FA={};FA.toString=function(r){switch(r){case 1:return"LLQ";case 2:return"UL";case 3:return"NSID";case 5:return"DAU";case 6:return"DHU";case 7:return"N3U";case 8:return"CLIENT_SUBNET";case 9:return"EXPIRE";case 10:return"COOKIE";case 11:return"TCP_KEEPALIVE";case 12:return"PADDING";case 13:return"CHAIN";case 14:return"KEY_TAG";case 26946:return"DEVICEID"}return r<0?null:`OPTION_${r}`};FA.toCode=function(r){if(typeof r=="number")return r;if(!r)return-1;switch(r.toUpperCase()){case"OPTION_0":return 0;case"LLQ":return 1;case"UL":return 2;case"NSID":return 3;case"OPTION_4":return 4;case"DAU":return 5;case"DHU":return 6;case"N3U":return 7;case"CLIENT_SUBNET":return 8;case"EXPIRE":return 9;case"COOKIE":return 10;case"TCP_KEEPALIVE":return 11;case"PADDING":return 12;case"CHAIN":return 13;case"KEY_TAG":return 14;case"DEVICEID":return 26946;case"OPTION_65535":return 65535}const e=r.match(/_(\d+)$/);return e?parseInt(e[1],10):-1};var aq={exports:{}};(function(r,e){var t=function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.decode=f,n.encode=w,n.familyOf=p,n.name=void 0,n.sizeOf=h,n.v6=n.v4=void 0;const i=/^(\d{1,3}\.){3,3}\d{1,3}$/,s=4,o=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i,a=16,c={name:"v4",size:s,isFormat:g=>i.test(g),encode(g,v,y){y=~~y,v=v||new Uint8Array(y+s);const m=g.length;let b=0;for(let S=0;S<m;){const I=g.charCodeAt(S++);I===46?(v[y++]=b,b=0):b=b*10+(I-48)}return v[y]=b,v},decode(g,v){return v=~~v,`${g[v++]}.${g[v++]}.${g[v++]}.${g[v]}`}};n.v4=c;const l={name:"v6",size:a,isFormat:g=>g.length>0&&o.test(g),encode(g,v,y){y=~~y;let m=y+a,b=-1,S=0,I=0,T=!0,A=!1;v=v||new Uint8Array(y+a);for(let _=0;_<g.length;_++){let $=g.charCodeAt(_);$===58?(T?b!==-1?(y<m&&(v[y]=0),y<m-1&&(v[y+1]=0),y+=2):y<m&&(b=y):(A===!0?(y<m&&(v[y]=I),y++):(y<m&&(v[y]=S>>8),y<m-1&&(v[y+1]=S&255),y+=2),S=0,I=0),T=!0,A=!1):$===46?(y<m&&(v[y]=I),y++,I=0,S=0,T=!1,A=!0):(T=!1,$>=97?$-=87:$>=65?$-=55:($-=48,I=I*10+$),S=(S<<4)+$)}if(T===!1)A===!0?(y<m&&(v[y]=I),y++):(y<m&&(v[y]=S>>8),y<m-1&&(v[y+1]=S&255),y+=2);else if(b===0)y<m&&(v[y]=0),y<m-1&&(v[y+1]=0),y+=2;else if(b!==-1){y+=2;for(let _=Math.min(y-1,m-1);_>=b+2;_--)v[_]=v[_-2];v[b]=0,v[b+1]=0,b=y}if(b!==y&&b!==-1)for(y>m-2&&(y=m-2);m>b;)v[--m]=y<m&&y>b?v[--y]:0;else for(;y<m;)v[y++]=0;return v},decode(g,v){v=~~v;let y="";for(let m=0;m<a;m+=2)m!==0&&(y+=":"),y+=(g[v+m]<<8|g[v+m+1]).toString(16);return y.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}};n.v6=l;const d="ip";n.name=d;function h(g){if(c.isFormat(g))return c.size;if(l.isFormat(g))return l.size;throw Error(`Invalid ip address: ${g}`)}function p(g){return h(g)===c.size?1:2}function w(g,v,y){y=~~y;const m=h(g);return typeof v=="function"&&(v=v(y+m)),m===c.size?c.encode(g,v,y):l.encode(g,v,y)}function f(g,v,y){if(v=~~v,y=y||g.length-v,y===c.size)return c.decode(g,v,y);if(y===l.size)return l.decode(g,v,y);throw Error(`Invalid buffer size needs to be ${c.size} for v4 or ${l.size} for v6.`)}return"default"in n?n.default:n}({});r.exports=t})(aq);var MIe=aq.exports;(function(r){const e=Lp.Buffer,t=RA,n=LA,i=BA,s=UA,o=FA,a=MIe,c=0,l=32768,d=32768,h=-32769,p=32768,w=-32769,f=r.name={};f.encode=function(P,E,C,{mail:U=!1}={}){E||(E=e.alloc(f.encodingLength(P))),C||(C=0);const te=C,Te=P.replace(/^\.|\.$/gm,"");if(Te.length){let ot=[];if(U){let at="";Te.split(".").forEach(ft=>{ft.endsWith("\\")?at+=(at.length?".":"")+ft.slice(0,-1):ot.length===0&&at.length?ot.push(at+"."+ft):ot.push(ft)})}else ot=Te.split(".");for(let at=0;at<ot.length;at++){const ft=E.write(ot[at],C+1);E[C]=ft,C+=ft+1}}return E[C++]=0,f.encode.bytes=C-te,E},f.encode.bytes=0,f.decode=function(P,E,{mail:C=!1}={}){E||(E=0);const U=[];let te=E,Te=0,ot=0,at=!1;for(;;){if(E>=P.length)throw new Error("Cannot decode name (buffer overflow)");const ft=P[E++];if(ot+=at?0:1,ft===0)break;if(ft&192)if((ft&192)===192){if(E+1>P.length)throw new Error("Cannot decode name (buffer overflow)");const vt=P.readUInt16BE(E-1)-49152;if(vt>=te)throw new Error("Cannot decode name (bad pointer)");E=vt,te=vt,ot+=at?0:1,at=!0}else throw new Error("Cannot decode name (bad label)");else{if(E+ft>P.length)throw new Error("Cannot decode name (buffer overflow)");if(Te+=ft+1,Te>254)throw new Error("Cannot decode name (name too long)");let vt=P.toString("utf-8",E,E+ft);C&&(vt=vt.replace(/\./g,"\\.")),U.push(vt),E+=ft,ot+=at?0:ft}}return f.decode.bytes=ot,U.length===0?".":U.join(".")},f.decode.bytes=0,f.encodingLength=function(P){return P==="."||P===".."?1:e.byteLength(P.replace(/^\.|\.$/gm,""))+2};const g={};g.encode=function(P,E,C){E||(E=e.alloc(g.encodingLength(P))),C||(C=0);const U=E.write(P,C+1);return E[C]=U,g.encode.bytes=U+1,E},g.encode.bytes=0,g.decode=function(P,E){E||(E=0);const C=P[E],U=P.toString("utf-8",E+1,E+1+C);return g.decode.bytes=C+1,U},g.decode.bytes=0,g.encodingLength=function(P){return e.byteLength(P)+1};const v={};v.encode=function(P,E,C){E||(E=v.encodingLength(P)),C||(C=0);const U=(P.flags||0)&32767,te=P.type==="response"?l:c;return E.writeUInt16BE(P.id||0,C),E.writeUInt16BE(U|te,C+2),E.writeUInt16BE(P.questions.length,C+4),E.writeUInt16BE(P.answers.length,C+6),E.writeUInt16BE(P.authorities.length,C+8),E.writeUInt16BE(P.additionals.length,C+10),E},v.encode.bytes=12,v.decode=function(P,E){if(E||(E=0),P.length<12)throw new Error("Header must be 12 bytes");const C=P.readUInt16BE(E+2);return{id:P.readUInt16BE(E),type:C&l?"response":"query",flags:C&32767,flag_qr:(C>>15&1)===1,opcode:i.toString(C>>11&15),flag_aa:(C>>10&1)===1,flag_tc:(C>>9&1)===1,flag_rd:(C>>8&1)===1,flag_ra:(C>>7&1)===1,flag_z:(C>>6&1)===1,flag_ad:(C>>5&1)===1,flag_cd:(C>>4&1)===1,rcode:n.toString(C&15),questions:new Array(P.readUInt16BE(E+4)),answers:new Array(P.readUInt16BE(E+6)),authorities:new Array(P.readUInt16BE(E+8)),additionals:new Array(P.readUInt16BE(E+10))}},v.decode.bytes=12,v.encodingLength=function(){return 12};const y=r.unknown={};y.encode=function(P,E,C){return E||(E=e.alloc(y.encodingLength(P))),C||(C=0),E.writeUInt16BE(P.length,C),P.copy(E,C+2),y.encode.bytes=P.length+2,E},y.encode.bytes=0,y.decode=function(P,E){E||(E=0);const C=P.readUInt16BE(E),U=P.slice(E+2,E+2+C);return y.decode.bytes=C+2,U},y.decode.bytes=0,y.encodingLength=function(P){return P.length+2};const m=r.ns={};m.encode=function(P,E,C){return E||(E=e.alloc(m.encodingLength(P))),C||(C=0),f.encode(P,E,C+2),E.writeUInt16BE(f.encode.bytes,C),m.encode.bytes=f.encode.bytes+2,E},m.encode.bytes=0,m.decode=function(P,E){E||(E=0);const C=P.readUInt16BE(E),U=f.decode(P,E+2);return m.decode.bytes=C+2,U},m.decode.bytes=0,m.encodingLength=function(P){return f.encodingLength(P)+2};const b=r.soa={};b.encode=function(P,E,C){E||(E=e.alloc(b.encodingLength(P))),C||(C=0);const U=C;return C+=2,f.encode(P.mname,E,C),C+=f.encode.bytes,f.encode(P.rname,E,C,{mail:!0}),C+=f.encode.bytes,E.writeUInt32BE(P.serial||0,C),C+=4,E.writeUInt32BE(P.refresh||0,C),C+=4,E.writeUInt32BE(P.retry||0,C),C+=4,E.writeUInt32BE(P.expire||0,C),C+=4,E.writeUInt32BE(P.minimum||0,C),C+=4,E.writeUInt16BE(C-U-2,U),b.encode.bytes=C-U,E},b.encode.bytes=0,b.decode=function(P,E){E||(E=0);const C=E,U={};return E+=2,U.mname=f.decode(P,E),E+=f.decode.bytes,U.rname=f.decode(P,E,{mail:!0}),E+=f.decode.bytes,U.serial=P.readUInt32BE(E),E+=4,U.refresh=P.readUInt32BE(E),E+=4,U.retry=P.readUInt32BE(E),E+=4,U.expire=P.readUInt32BE(E),E+=4,U.minimum=P.readUInt32BE(E),E+=4,b.decode.bytes=E-C,U},b.decode.bytes=0,b.encodingLength=function(P){return 22+f.encodingLength(P.mname)+f.encodingLength(P.rname)};const S=r.txt={};S.encode=function(P,E,C){Array.isArray(P)||(P=[P]);for(let te=0;te<P.length;te++)if(typeof P[te]=="string"&&(P[te]=e.from(P[te])),!e.isBuffer(P[te]))throw new Error("Must be a Buffer");E||(E=e.alloc(S.encodingLength(P))),C||(C=0);const U=C;return C+=2,P.forEach(function(te){E[C++]=te.length,te.copy(E,C,0,te.length),C+=te.length}),E.writeUInt16BE(C-U-2,U),S.encode.bytes=C-U,E},S.encode.bytes=0,S.decode=function(P,E){E||(E=0);const C=E;let U=P.readUInt16BE(E);E+=2;let te=[];for(;U>0;){const Te=P[E++];if(--U,U<Te)throw new Error("Buffer overflow");te.push(P.slice(E,E+Te)),E+=Te,U-=Te}return S.decode.bytes=E-C,te},S.decode.bytes=0,S.encodingLength=function(P){Array.isArray(P)||(P=[P]);let E=2;return P.forEach(function(C){typeof C=="string"?E+=e.byteLength(C)+1:E+=C.length+1}),E};const I=r.null={};I.encode=function(P,E,C){E||(E=e.alloc(I.encodingLength(P))),C||(C=0),typeof P=="string"&&(P=e.from(P)),P||(P=e.alloc(0));const U=C;C+=2;const te=P.length;return P.copy(E,C,0,te),C+=te,E.writeUInt16BE(C-U-2,U),I.encode.bytes=C-U,E},I.encode.bytes=0,I.decode=function(P,E){E||(E=0);const C=E,U=P.readUInt16BE(E);E+=2;const te=P.slice(E,E+U);return E+=U,I.decode.bytes=E-C,te},I.decode.bytes=0,I.encodingLength=function(P){return P?(e.isBuffer(P)?P.length:e.byteLength(P))+2:2};const T=r.hinfo={};T.encode=function(P,E,C){E||(E=e.alloc(T.encodingLength(P))),C||(C=0);const U=C;return C+=2,g.encode(P.cpu,E,C),C+=g.encode.bytes,g.encode(P.os,E,C),C+=g.encode.bytes,E.writeUInt16BE(C-U-2,U),T.encode.bytes=C-U,E},T.encode.bytes=0,T.decode=function(P,E){E||(E=0);const C=E,U={};return E+=2,U.cpu=g.decode(P,E),E+=g.decode.bytes,U.os=g.decode(P,E),E+=g.decode.bytes,T.decode.bytes=E-C,U},T.decode.bytes=0,T.encodingLength=function(P){return g.encodingLength(P.cpu)+g.encodingLength(P.os)+2};const A=r.ptr={},_=r.cname=A,$=r.dname=A;A.encode=function(P,E,C){return E||(E=e.alloc(A.encodingLength(P))),C||(C=0),f.encode(P,E,C+2),E.writeUInt16BE(f.encode.bytes,C),A.encode.bytes=f.encode.bytes+2,E},A.encode.bytes=0,A.decode=function(P,E){E||(E=0);const C=f.decode(P,E+2);return A.decode.bytes=f.decode.bytes+2,C},A.decode.bytes=0,A.encodingLength=function(P){return f.encodingLength(P)+2};const z=r.srv={};z.encode=function(P,E,C){E||(E=e.alloc(z.encodingLength(P))),C||(C=0),E.writeUInt16BE(P.priority||0,C+2),E.writeUInt16BE(P.weight||0,C+4),E.writeUInt16BE(P.port||0,C+6),f.encode(P.target,E,C+8);const U=f.encode.bytes+6;return E.writeUInt16BE(U,C),z.encode.bytes=U+2,E},z.encode.bytes=0,z.decode=function(P,E){E||(E=0);const C=P.readUInt16BE(E),U={};return U.priority=P.readUInt16BE(E+2),U.weight=P.readUInt16BE(E+4),U.port=P.readUInt16BE(E+6),U.target=f.decode(P,E+8),z.decode.bytes=C+2,U},z.decode.bytes=0,z.encodingLength=function(P){return 8+f.encodingLength(P.target)};const j=r.caa={};j.ISSUER_CRITICAL=128,j.encode=function(P,E,C){const U=j.encodingLength(P);return E||(E=e.alloc(j.encodingLength(P))),C||(C=0),P.issuerCritical&&(P.flags=j.ISSUER_CRITICAL),E.writeUInt16BE(U-2,C),C+=2,E.writeUInt8(P.flags||0,C),C+=1,g.encode(P.tag,E,C),C+=g.encode.bytes,E.write(P.value,C),C+=e.byteLength(P.value),j.encode.bytes=U,E},j.encode.bytes=0,j.decode=function(P,E){E||(E=0);const C=P.readUInt16BE(E);E+=2;const U=E,te={};return te.flags=P.readUInt8(E),E+=1,te.tag=g.decode(P,E),E+=g.decode.bytes,te.value=P.toString("utf-8",E,U+C),te.issuerCritical=!!(te.flags&j.ISSUER_CRITICAL),j.decode.bytes=C+2,te},j.decode.bytes=0,j.encodingLength=function(P){return g.encodingLength(P.tag)+g.encodingLength(P.value)+2};const K=r.mx={};K.encode=function(P,E,C){E||(E=e.alloc(K.encodingLength(P))),C||(C=0);const U=C;return C+=2,E.writeUInt16BE(P.preference||0,C),C+=2,f.encode(P.exchange,E,C),C+=f.encode.bytes,E.writeUInt16BE(C-U-2,U),K.encode.bytes=C-U,E},K.encode.bytes=0,K.decode=function(P,E){E||(E=0);const C=E,U={};return E+=2,U.preference=P.readUInt16BE(E),E+=2,U.exchange=f.decode(P,E),E+=f.decode.bytes,K.decode.bytes=E-C,U},K.encodingLength=function(P){return 4+f.encodingLength(P.exchange)};const Z=r.a={};Z.encode=function(P,E,C){return E||(E=e.alloc(Z.encodingLength(P))),C||(C=0),E.writeUInt16BE(4,C),C+=2,a.v4.encode(P,E,C),Z.encode.bytes=6,E},Z.encode.bytes=0,Z.decode=function(P,E){E||(E=0),E+=2;const C=a.v4.decode(P,E);return Z.decode.bytes=6,C},Z.decode.bytes=0,Z.encodingLength=function(){return 6};const G=r.aaaa={};G.encode=function(P,E,C){return E||(E=e.alloc(G.encodingLength(P))),C||(C=0),E.writeUInt16BE(16,C),C+=2,a.v6.encode(P,E,C),G.encode.bytes=18,E},G.encode.bytes=0,G.decode=function(P,E){E||(E=0),E+=2;const C=a.v6.decode(P,E);return G.decode.bytes=18,C},G.decode.bytes=0,G.encodingLength=function(){return 18};const Q=r.option={};Q.encode=function(P,E,C){E||(E=e.alloc(Q.encodingLength(P))),C||(C=0);const U=C,te=o.toCode(P.code);if(E.writeUInt16BE(te,C),C+=2,P.data)E.writeUInt16BE(P.data.length,C),C+=2,P.data.copy(E,C),C+=P.data.length;else switch(te){case 8:const Te=P.sourcePrefixLength||0,ot=P.family||a.familyOf(P.ip),at=a.encode(P.ip,e.alloc),ft=Math.ceil(Te/8);E.writeUInt16BE(ft+4,C),C+=2,E.writeUInt16BE(ot,C),C+=2,E.writeUInt8(Te,C++),E.writeUInt8(P.scopePrefixLength||0,C++),at.copy(E,C,0,ft),C+=ft;break;case 11:P.timeout?(E.writeUInt16BE(2,C),C+=2,E.writeUInt16BE(P.timeout,C),C+=2):(E.writeUInt16BE(0,C),C+=2);break;case 12:const vt=P.length||0;E.writeUInt16BE(vt,C),C+=2,E.fill(0,C,C+vt),C+=vt;break;case 14:const ro=P.tags.length*2;E.writeUInt16BE(ro,C),C+=2;for(const Xh of P.tags)E.writeUInt16BE(Xh,C),C+=2;break;default:throw new Error(`Unknown roption code: ${P.code}`)}return Q.encode.bytes=C-U,E},Q.encode.bytes=0,Q.decode=function(P,E){E||(E=0);const C={};C.code=P.readUInt16BE(E),C.type=o.toString(C.code),E+=2;const U=P.readUInt16BE(E);switch(E+=2,C.data=P.slice(E,E+U),C.code){case 8:C.family=P.readUInt16BE(E),E+=2,C.sourcePrefixLength=P.readUInt8(E++),C.scopePrefixLength=P.readUInt8(E++);const te=e.alloc(C.family===1?4:16);P.copy(te,0,E,E+U-4),C.ip=a.decode(te);break;case 11:U>0&&(C.timeout=P.readUInt16BE(E),E+=2);break;case 14:C.tags=[];for(let Te=0;Te<U;Te+=2)C.tags.push(P.readUInt16BE(E)),E+=2}return Q.decode.bytes=U+4,C},Q.decode.bytes=0,Q.encodingLength=function(P){if(P.data)return P.data.length+4;switch(o.toCode(P.code)){case 8:const C=P.sourcePrefixLength||0;return Math.ceil(C/8)+8;case 11:return typeof P.timeout=="number"?6:4;case 12:return P.length+4;case 14:return 4+P.tags.length*2}throw new Error(`Unknown roption code: ${P.code}`)};const J=r.opt={};J.encode=function(P,E,C){E||(E=e.alloc(J.encodingLength(P))),C||(C=0);const U=C,te=Qe(P,Q);return E.writeUInt16BE(te,C),C=pt(P,Q,E,C+2),J.encode.bytes=C-U,E},J.encode.bytes=0,J.decode=function(P,E){E||(E=0);const C=E,U=[];let te=P.readUInt16BE(E);E+=2;let Te=0;for(;te>0;)U[Te++]=Q.decode(P,E),E+=Q.decode.bytes,te-=Q.decode.bytes;return J.decode.bytes=E-C,U},J.decode.bytes=0,J.encodingLength=function(P){return 2+Qe(P||[],Q)};const q=r.dnskey={};q.PROTOCOL_DNSSEC=3,q.ZONE_KEY=128,q.SECURE_ENTRYPOINT=32768,q.encode=function(P,E,C){E||(E=e.alloc(q.encodingLength(P))),C||(C=0);const U=C,te=P.key;if(!e.isBuffer(te))throw new Error("Key must be a Buffer");return C+=2,E.writeUInt16BE(P.flags,C),C+=2,E.writeUInt8(q.PROTOCOL_DNSSEC,C),C+=1,E.writeUInt8(P.algorithm,C),C+=1,te.copy(E,C,0,te.length),C+=te.length,q.encode.bytes=C-U,E.writeUInt16BE(q.encode.bytes-2,U),E},q.encode.bytes=0,q.decode=function(P,E){E||(E=0);const C=E;var U={},te=P.readUInt16BE(E);if(E+=2,U.flags=P.readUInt16BE(E),E+=2,P.readUInt8(E)!==q.PROTOCOL_DNSSEC)throw new Error("Protocol must be 3");return E+=1,U.algorithm=P.readUInt8(E),E+=1,U.key=P.slice(E,C+te+2),E+=U.key.length,q.decode.bytes=E-C,U},q.decode.bytes=0,q.encodingLength=function(P){return 6+e.byteLength(P.key)};const B=r.rrsig={};B.encode=function(P,E,C){E||(E=e.alloc(B.encodingLength(P))),C||(C=0);const U=C,te=P.signature;if(!e.isBuffer(te))throw new Error("Signature must be a Buffer");return C+=2,E.writeUInt16BE(t.toType(P.typeCovered),C),C+=2,E.writeUInt8(P.algorithm,C),C+=1,E.writeUInt8(P.labels,C),C+=1,E.writeUInt32BE(P.originalTTL,C),C+=4,E.writeUInt32BE(P.expiration,C),C+=4,E.writeUInt32BE(P.inception,C),C+=4,E.writeUInt16BE(P.keyTag,C),C+=2,f.encode(P.signersName,E,C),C+=f.encode.bytes,te.copy(E,C,0,te.length),C+=te.length,B.encode.bytes=C-U,E.writeUInt16BE(B.encode.bytes-2,U),E},B.encode.bytes=0,B.decode=function(P,E){E||(E=0);const C=E;var U={},te=P.readUInt16BE(E);return E+=2,U.typeCovered=t.toString(P.readUInt16BE(E)),E+=2,U.algorithm=P.readUInt8(E),E+=1,U.labels=P.readUInt8(E),E+=1,U.originalTTL=P.readUInt32BE(E),E+=4,U.expiration=P.readUInt32BE(E),E+=4,U.inception=P.readUInt32BE(E),E+=4,U.keyTag=P.readUInt16BE(E),E+=2,U.signersName=f.decode(P,E),E+=f.decode.bytes,U.signature=P.slice(E,C+te+2),E+=U.signature.length,B.decode.bytes=E-C,U},B.decode.bytes=0,B.encodingLength=function(P){return 20+f.encodingLength(P.signersName)+e.byteLength(P.signature)};const V=r.rp={};V.encode=function(P,E,C){E||(E=e.alloc(V.encodingLength(P))),C||(C=0);const U=C;return C+=2,f.encode(P.mbox||".",E,C,{mail:!0}),C+=f.encode.bytes,f.encode(P.txt||".",E,C),C+=f.encode.bytes,V.encode.bytes=C-U,E.writeUInt16BE(V.encode.bytes-2,U),E},V.encode.bytes=0,V.decode=function(P,E){E||(E=0);const C=E,U={};return E+=2,U.mbox=f.decode(P,E,{mail:!0})||".",E+=f.decode.bytes,U.txt=f.decode(P,E)||".",E+=f.decode.bytes,V.decode.bytes=E-C,U},V.decode.bytes=0,V.encodingLength=function(P){return 2+f.encodingLength(P.mbox||".")+f.encodingLength(P.txt||".")};const W={};W.encode=function(P,E,C){E||(E=e.alloc(W.encodingLength(P))),C||(C=0);const U=C;for(var te=[],Te=0;Te<P.length;Te++){var ot=t.toType(P[Te]);te[ot>>8]===void 0&&(te[ot>>8]=[]),te[ot>>8][ot>>3&31]|=1<<7-(ot&7)}for(Te=0;Te<te.length;Te++)if(te[Te]!==void 0){var at=e.from(te[Te]);E.writeUInt8(Te,C),C+=1,E.writeUInt8(at.length,C),C+=1,at.copy(E,C),C+=at.length}return W.encode.bytes=C-U,E},W.encode.bytes=0,W.decode=function(P,E,C){E||(E=0);const U=E;for(var te=[];E-U<C;){var Te=P.readUInt8(E);E+=1;var ot=P.readUInt8(E);E+=1;for(var at=0;at<ot;at++)for(var ft=P.readUInt8(E+at),vt=0;vt<8;vt++)if(ft&1<<7-vt){var ro=t.toString(Te<<8|at<<3|vt);te.push(ro)}E+=ot}return W.decode.bytes=E-U,te},W.decode.bytes=0,W.encodingLength=function(P){for(var E=[],C=0;C<P.length;C++){var U=t.toType(P[C]);E[U>>8]=Math.max(E[U>>8]||0,U&255)}var te=0;for(C=0;C<E.length;C++)E[C]!==void 0&&(te+=2+Math.ceil((E[C]+1)/8));return te};const ee=r.nsec={};ee.encode=function(P,E,C){E||(E=e.alloc(ee.encodingLength(P))),C||(C=0);const U=C;return C+=2,f.encode(P.nextDomain,E,C),C+=f.encode.bytes,W.encode(P.rrtypes,E,C),C+=W.encode.bytes,ee.encode.bytes=C-U,E.writeUInt16BE(ee.encode.bytes-2,U),E},ee.encode.bytes=0,ee.decode=function(P,E){E||(E=0);const C=E;var U={},te=P.readUInt16BE(E);return E+=2,U.nextDomain=f.decode(P,E),E+=f.decode.bytes,U.rrtypes=W.decode(P,E,te-(E-C)),E+=W.decode.bytes,ee.decode.bytes=E-C,U},ee.decode.bytes=0,ee.encodingLength=function(P){return 2+f.encodingLength(P.nextDomain)+W.encodingLength(P.rrtypes)};const Y=r.nsec3={};Y.encode=function(P,E,C){E||(E=e.alloc(Y.encodingLength(P))),C||(C=0);const U=C,te=P.salt;if(!e.isBuffer(te))throw new Error("salt must be a Buffer");const Te=P.nextDomain;if(!e.isBuffer(Te))throw new Error("nextDomain must be a Buffer");return C+=2,E.writeUInt8(P.algorithm,C),C+=1,E.writeUInt8(P.flags,C),C+=1,E.writeUInt16BE(P.iterations,C),C+=2,E.writeUInt8(te.length,C),C+=1,te.copy(E,C,0,te.length),C+=te.length,E.writeUInt8(Te.length,C),C+=1,Te.copy(E,C,0,Te.length),C+=Te.length,W.encode(P.rrtypes,E,C),C+=W.encode.bytes,Y.encode.bytes=C-U,E.writeUInt16BE(Y.encode.bytes-2,U),E},Y.encode.bytes=0,Y.decode=function(P,E){E||(E=0);const C=E;var U={},te=P.readUInt16BE(E);E+=2,U.algorithm=P.readUInt8(E),E+=1,U.flags=P.readUInt8(E),E+=1,U.iterations=P.readUInt16BE(E),E+=2;const Te=P.readUInt8(E);E+=1,U.salt=P.slice(E,E+Te),E+=Te;const ot=P.readUInt8(E);return E+=1,U.nextDomain=P.slice(E,E+ot),E+=ot,U.rrtypes=W.decode(P,E,te-(E-C)),E+=W.decode.bytes,Y.decode.bytes=E-C,U},Y.decode.bytes=0,Y.encodingLength=function(P){return 8+P.salt.length+P.nextDomain.length+W.encodingLength(P.rrtypes)};const ce=r.ds={};ce.encode=function(P,E,C){E||(E=e.alloc(ce.encodingLength(P))),C||(C=0);const U=C,te=P.digest;if(!e.isBuffer(te))throw new Error("Digest must be a Buffer");return C+=2,E.writeUInt16BE(P.keyTag,C),C+=2,E.writeUInt8(P.algorithm,C),C+=1,E.writeUInt8(P.digestType,C),C+=1,te.copy(E,C,0,te.length),C+=te.length,ce.encode.bytes=C-U,E.writeUInt16BE(ce.encode.bytes-2,U),E},ce.encode.bytes=0,ce.decode=function(P,E){E||(E=0);const C=E;var U={},te=P.readUInt16BE(E);return E+=2,U.keyTag=P.readUInt16BE(E),E+=2,U.algorithm=P.readUInt8(E),E+=1,U.digestType=P.readUInt8(E),E+=1,U.digest=P.slice(E,C+te+2),E+=U.digest.length,ce.decode.bytes=E-C,U},ce.decode.bytes=0,ce.encodingLength=function(P){return 6+e.byteLength(P.digest)};const pe=r.sshfp={};pe.getFingerprintLengthForHashType=function(E){switch(E){case 1:return 20;case 2:return 32}},pe.encode=function(E,C,U){C||(C=e.alloc(pe.encodingLength(E))),U||(U=0);const te=U;U+=2,C[U]=E.algorithm,U+=1,C[U]=E.hash,U+=1;const Te=e.from(E.fingerprint.toUpperCase(),"hex");if(Te.length!==pe.getFingerprintLengthForHashType(E.hash))throw new Error("Invalid fingerprint length");return Te.copy(C,U),U+=Te.byteLength,pe.encode.bytes=U-te,C.writeUInt16BE(pe.encode.bytes-2,te),C},pe.encode.bytes=0,pe.decode=function(E,C){C||(C=0);const U=C,te={};C+=2,te.algorithm=E[C],C+=1,te.hash=E[C],C+=1;const Te=pe.getFingerprintLengthForHashType(te.hash);return te.fingerprint=E.slice(C,C+Te).toString("hex").toUpperCase(),C+=Te,pe.decode.bytes=C-U,te},pe.decode.bytes=0,pe.encodingLength=function(P){return 4+e.from(P.fingerprint,"hex").byteLength};const ue=r.naptr={};ue.encode=function(P,E,C){E||(E=e.alloc(ue.encodingLength(P))),C||(C=0);const U=C;return C+=2,E.writeUInt16BE(P.order||0,C),C+=2,E.writeUInt16BE(P.preference||0,C),C+=2,g.encode(P.flags,E,C),C+=g.encode.bytes,g.encode(P.services,E,C),C+=g.encode.bytes,g.encode(P.regexp,E,C),C+=g.encode.bytes,f.encode(P.replacement,E,C),C+=f.encode.bytes,ue.encode.bytes=C-U,E.writeUInt16BE(ue.encode.bytes-2,U),E},ue.encode.bytes=0,ue.decode=function(P,E){E||(E=0);const C=E,U={};return E+=2,U.order=P.readUInt16BE(E),E+=2,U.preference=P.readUInt16BE(E),E+=2,U.flags=g.decode(P,E),E+=g.decode.bytes,U.services=g.decode(P,E),E+=g.decode.bytes,U.regexp=g.decode(P,E),E+=g.decode.bytes,U.replacement=f.decode(P,E),E+=f.decode.bytes,ue.decode.bytes=E-C,U},ue.decode.bytes=0,ue.encodingLength=function(P){return g.encodingLength(P.flags)+g.encodingLength(P.services)+g.encodingLength(P.regexp)+f.encodingLength(P.replacement)+6};const le=r.tlsa={};le.encode=function(P,E,C){E||(E=e.alloc(le.encodingLength(P))),C||(C=0);const U=C,te=P.certificate;if(!e.isBuffer(te))throw new Error("Certificate must be a Buffer");return C+=2,E.writeUInt8(P.usage,C),C+=1,E.writeUInt8(P.selector,C),C+=1,E.writeUInt8(P.matchingType,C),C+=1,te.copy(E,C,0,te.length),C+=te.length,le.encode.bytes=C-U,E.writeUInt16BE(le.encode.bytes-2,U),E},le.encode.bytes=0,le.decode=function(P,E){E||(E=0);const C=E,U={},te=P.readUInt16BE(E);return E+=2,U.usage=P.readUInt8(E),E+=1,U.selector=P.readUInt8(E),E+=1,U.matchingType=P.readUInt8(E),E+=1,U.certificate=P.slice(E,C+te+2),E+=U.certificate.length,le.decode.bytes=E-C,U},le.decode.bytes=0,le.encodingLength=function(P){return 5+e.byteLength(P.certificate)};const Me=r.record=function(P){switch(P.toUpperCase()){case"A":return Z;case"PTR":return A;case"CNAME":return _;case"DNAME":return $;case"TXT":return S;case"NULL":return I;case"AAAA":return G;case"SRV":return z;case"HINFO":return T;case"CAA":return j;case"NS":return m;case"SOA":return b;case"MX":return K;case"OPT":return J;case"DNSKEY":return q;case"RRSIG":return B;case"RP":return V;case"NSEC":return ee;case"NSEC3":return Y;case"SSHFP":return pe;case"DS":return ce;case"NAPTR":return ue;case"TLSA":return le}return y},_e=r.answer={};_e.encode=function(P,E,C){E||(E=e.alloc(_e.encodingLength(P))),C||(C=0);const U=C;if(f.encode(P.name,E,C),C+=f.encode.bytes,E.writeUInt16BE(t.toType(P.type),C),P.type.toUpperCase()==="OPT"){if(P.name!==".")throw new Error("OPT name must be root.");E.writeUInt16BE(P.udpPayloadSize||4096,C+2),E.writeUInt8(P.extendedRcode||0,C+4),E.writeUInt8(P.ednsVersion||0,C+5),E.writeUInt16BE(P.flags||0,C+6),C+=8,J.encode(P.options||[],E,C),C+=J.encode.bytes}else{let te=s.toClass(P.class===void 0?"IN":P.class);P.flush&&(te|=d),E.writeUInt16BE(te,C+2),E.writeUInt32BE(P.ttl||0,C+4),C+=8;const Te=Me(P.type);Te.encode(P.data,E,C),C+=Te.encode.bytes}return _e.encode.bytes=C-U,E},_e.encode.bytes=0,_e.decode=function(P,E){E||(E=0);const C={},U=E;if(C.name=f.decode(P,E),E+=f.decode.bytes,C.type=t.toString(P.readUInt16BE(E)),C.type==="OPT")C.udpPayloadSize=P.readUInt16BE(E+2),C.extendedRcode=P.readUInt8(E+4),C.ednsVersion=P.readUInt8(E+5),C.flags=P.readUInt16BE(E+6),C.flag_do=(C.flags>>15&1)===1,C.options=J.decode(P,E+8),E+=8+J.decode.bytes;else{const te=P.readUInt16BE(E+2);C.ttl=P.readUInt32BE(E+4),C.class=s.toString(te&h),C.flush=!!(te&d);const Te=Me(C.type);C.data=Te.decode(P,E+8),E+=8+Te.decode.bytes}return _e.decode.bytes=E-U,C},_e.decode.bytes=0,_e.encodingLength=function(P){const E=P.data!==null&&P.data!==void 0?P.data:P.options;return f.encodingLength(P.name)+8+Me(P.type).encodingLength(E)};const ze=r.question={};ze.encode=function(P,E,C){E||(E=e.alloc(ze.encodingLength(P))),C||(C=0);const U=C;return f.encode(P.name,E,C),C+=f.encode.bytes,E.writeUInt16BE(t.toType(P.type),C),C+=2,E.writeUInt16BE(s.toClass(P.class===void 0?"IN":P.class),C),C+=2,ze.encode.bytes=C-U,P},ze.encode.bytes=0,ze.decode=function(P,E){E||(E=0);const C=E,U={};return U.name=f.decode(P,E),E+=f.decode.bytes,U.type=t.toString(P.readUInt16BE(E)),E+=2,U.class=s.toString(P.readUInt16BE(E)),E+=2,!!(U.class&p)&&(U.class&=w),ze.decode.bytes=E-C,U},ze.decode.bytes=0,ze.encodingLength=function(P){return f.encodingLength(P.name)+4},r.AUTHORITATIVE_ANSWER=1024,r.TRUNCATED_RESPONSE=512,r.RECURSION_DESIRED=256,r.RECURSION_AVAILABLE=128,r.AUTHENTIC_DATA=32,r.CHECKING_DISABLED=16,r.DNSSEC_OK=32768,r.encode=function(P,E,C){const U=!E;U&&(E=e.alloc(r.encodingLength(P))),C||(C=0);const te=C;return P.questions||(P.questions=[]),P.answers||(P.answers=[]),P.authorities||(P.authorities=[]),P.additionals||(P.additionals=[]),v.encode(P,E,C),C+=v.encode.bytes,C=pt(P.questions,ze,E,C),C=pt(P.answers,_e,E,C),C=pt(P.authorities,_e,E,C),C=pt(P.additionals,_e,E,C),r.encode.bytes=C-te,U&&r.encode.bytes!==E.length?E.slice(0,r.encode.bytes):E},r.encode.bytes=0,r.decode=function(P,E){E||(E=0);const C=E,U=v.decode(P,E);return E+=v.decode.bytes,E=wt(U.questions,ze,P,E),E=wt(U.answers,_e,P,E),E=wt(U.authorities,_e,P,E),E=wt(U.additionals,_e,P,E),r.decode.bytes=E-C,U},r.decode.bytes=0,r.encodingLength=function(P){return v.encodingLength(P)+Qe(P.questions||[],ze)+Qe(P.answers||[],_e)+Qe(P.authorities||[],_e)+Qe(P.additionals||[],_e)},r.streamEncode=function(P){const E=r.encode(P),C=e.alloc(2);C.writeUInt16BE(E.byteLength);const U=e.concat([C,E]);return r.streamEncode.bytes=U.byteLength,U},r.streamEncode.bytes=0,r.streamDecode=function(P){const E=P.readUInt16BE(0);if(P.byteLength<E+2)return null;const C=r.decode(P.slice(2));return r.streamDecode.bytes=r.decode.bytes,C},r.streamDecode.bytes=0;function Qe(P,E){let C=0;for(let U=0;U<P.length;U++)C+=E.encodingLength(P[U]);return C}function pt(P,E,C,U){for(let te=0;te<P.length;te++)E.encode(P[te],C,U),U+=E.encode.bytes;return U}function wt(P,E,C,U){for(let te=0;te<P.length;te++)P[te]=E.decode(C,U),U+=E.decode.bytes;return U}})(oq);const RIe={},LIe=Object.freeze(Object.defineProperty({__proto__:null,default:RIe},Symbol.toStringTag,{value:"Module"})),cq=gq(LIe);var lq=HIe;process.nextTick(KIe,42);var BIe=UIe;function UIe(r){var e=n;return t;function t(i){e(i||zIe)}function n(i){var s=[i];e=o,r(a);function o(c){s.push(c)}function a(c){var l=arguments;for(e=FIe(c)?n:d;s.length;)d(s.shift());function d(h){lq(VIe,h,l)}}}}function FIe(r){return Object.prototype.toString.call(r)==="[object Error]"}function zIe(){}function VIe(r,e){r.apply(null,e)}function KIe(r){r===42&&(lq=process.nextTick)}function HIe(r,e,t){process.nextTick(function(){r(e,t)})}var J6=oq,jIe=cq,qIe=BIe,WIe=$p,D9=cq,Z6=function(){},GIe=function(r){r||(r={});var e=new WIe.EventEmitter,t=typeof r.port=="number"?r.port:5353,n=r.type||"udp4",i=r.ip||r.host||(n==="udp4"?"224.0.0.251":null),s={address:i,port:t},o={},a=!1,c=null;if(n==="udp6"&&(!i||!r.interface))throw new Error("For IPv6 multicast you must specify `ip` and `interface`");var l=r.socket||jIe.createSocket({type:n,reuseAddr:r.reuseAddr!==!1,toString:function(){return n}});l.on("error",function(h){h.code==="EACCES"||h.code==="EADDRINUSE"?e.emit("error",h):e.emit("warning",h)}),l.on("message",function(h,p){try{h=J6.decode(h)}catch(w){e.emit("warning",w);return}e.emit("packet",h,p),h.type==="query"&&e.emit("query",h,p),h.type==="response"&&e.emit("response",h,p)}),l.on("listening",function(){t||(t=s.port=l.address().port),r.multicast!==!1&&(e.update(),c=setInterval(e.update,5e3),l.setMulticastTTL(r.ttl||255),l.setMulticastLoopback(r.loopback!==!1))});var d=qIe(function(h){if(!t||r.bind===!1)return h(null);l.once("error",h),l.bind(t,r.bind||r.interface,function(){l.removeListener("error",h),h(null)})});return d(function(h){if(h)return e.emit("error",h);e.emit("ready")}),e.send=function(h,p,w){if(typeof p=="function")return e.send(h,null,p);w||(w=Z6),p?!p.host&&!p.address&&(p.address=s.address):p=s,d(f);function f(g){if(a)return w();if(g)return w(g);var v=J6.encode(h);l.send(v,0,v.length,p.port,p.address||p.host,w)}},e.response=e.respond=function(h,p,w){Array.isArray(h)&&(h={answers:h}),h.type="response",h.flags=(h.flags||0)|J6.AUTHORITATIVE_ANSWER,e.send(h,p,w)},e.query=function(h,p,w,f){if(typeof p=="function")return e.query(h,null,null,p);if(typeof p=="object"&&p&&p.port)return e.query(h,null,p,w);if(typeof w=="function")return e.query(h,p,null,w);f||(f=Z6),typeof h=="string"&&(h=[{name:h,type:p||"ANY"}]),Array.isArray(h)&&(h={type:"query",questions:h}),h.type="query",e.send(h,w,f)},e.destroy=function(h){if(h||(h=Z6),a)return process.nextTick(h);a=!0,clearInterval(c);for(var p in o)try{l.dropMembership(i,p)}catch{}o={},l.close(h)},e.update=function(){for(var h=r.interface?[].concat(r.interface):YIe(),p=!1,w=0;w<h.length;w++){var f=h[w];if(!o[f])try{l.addMembership(i,f),o[f]=!0,p=!0}catch(g){e.emit("warning",g)}}if(p){if(l.setMulticastInterface)try{l.setMulticastInterface(r.interface||QIe())}catch(g){e.emit("warning",g)}e.emit("networkInterface")}},e};function QIe(){for(var r=D9.networkInterfaces(),e=Object.keys(r),t=0;t<e.length;t++)for(var n=r[e[t]],i=0;i<n.length;i++){var s=n[i];if(uq(s.family)&&!s.internal)return D9.platform()==="darwin"&&e[t]==="en0"?s.address:"0.0.0.0"}return"127.0.0.1"}function YIe(){for(var r=D9.networkInterfaces(),e=Object.keys(r),t=[],n=0;n<e.length;n++)for(var i=r[e[n]],s=0;s<i.length;s++){var o=i[s];if(uq(o.family)){t.push(o.address);break}}return t}function uq(r){return r===4||r==="IPv4"}const XIe=Qs(GIe);function JIe(r,e,t,n){const i=()=>{n==null||n.log.trace("query",e),r.query({questions:[{name:e,type:"PTR"}]})};return i(),setInterval(i,t)}function ZIe(r,e,t,n){if(r.answers==null)return;let i;const s=[];if(r.answers.forEach(o=>{switch(o.type){case"PTR":i=o;break;case"TXT":s.push(o);break}}),r.additionals.forEach(o=>{switch(o.type){case"TXT":s.push(o);break}}),!(i==null||(i==null?void 0:i.name)!==t||s.length===0||i.data.startsWith(e)))try{const o=s.flatMap(c=>c.data).filter(c=>c.toString().startsWith("dnsaddr=")).map(c=>Fe(c.toString().substring(8))),a=o[0].getPeerId();if(a==null)throw new Error("Multiaddr doesn't contain PeerId");return n==null||n.log("peer found %p",a),{id:Zt(a),multiaddrs:o.map(c=>c.decapsulateCode(qe("p2p").code))}}catch(o){n==null||n.log.error("failed to parse mdns response",o)}}function eCe(r,e,t,n,i,s,o){if(!s){o==null||o.log("not responding to mDNS query as broadcast mode is false");return}if(n.length!==0&&r.questions[0]!=null&&r.questions[0].name===i){const a=[];a.push({name:i,type:"PTR",class:"IN",ttl:120,data:t+"."+i}),n.filter(tCe).forEach(c=>{const l="dnsaddr="+c.toString();if(l.length>255){o==null||o.log("multiaddr %a is too long to use in mDNS query response",c);return}if(c.getPeerId()==null){o==null||o.log("multiaddr %a did not have a peer ID so cannot be used in mDNS query response",c);return}a.push({name:t+"."+i,type:"TXT",class:"IN",ttl:120,data:l})}),o==null||o.log.trace("responding to query"),e.respond(a)}}function tCe(r){return!!Tc(r)}function rCe(r){let e="";const t="abcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<r;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}var kO,_O,TO,PO;class nCe extends(PO=tr,TO=z1,_O=Symbol.toStringTag,kO=lr,PO){constructor(t,n={}){super();u(this,"mdns");u(this,"log");u(this,"broadcast");u(this,"interval");u(this,"serviceTag");u(this,"peerName");u(this,"port");u(this,"ip");u(this,"_queryInterval");u(this,"components");u(this,TO,this);u(this,_O,"@libp2p/mdns");u(this,kO,["@libp2p/peer-discovery"]);if(this.log=t.logger.forComponent("libp2p:mdns"),this.broadcast=n.broadcast!==!1,this.interval=n.interval??1e3*10,this.serviceTag=n.serviceTag??"_p2p._udp.local",this.ip=n.ip??"224.0.0.251",this.peerName=n.peerName??rCe(63),this.peerName.length>=64)throw new Error("Peer name should be less than 64 chars long");this.port=n.port??5353,this.components=t,this._queryInterval=null,this._onMdnsQuery=this._onMdnsQuery.bind(this),this._onMdnsResponse=this._onMdnsResponse.bind(this),this._onMdnsWarning=this._onMdnsWarning.bind(this),this._onMdnsError=this._onMdnsError.bind(this)}isStarted(){return!!this.mdns}async start(){this.mdns==null&&(this.mdns=XIe({port:this.port,ip:this.ip}),this.mdns.on("query",this._onMdnsQuery),this.mdns.on("response",this._onMdnsResponse),this.mdns.on("warning",this._onMdnsWarning),this.mdns.on("error",this._onMdnsError),this._queryInterval=JIe(this.mdns,this.serviceTag,this.interval,{log:this.log}))}_onMdnsQuery(t){this.mdns!=null&&(this.log.trace("received incoming mDNS query"),eCe(t,this.mdns,this.peerName,this.components.addressManager.getAddresses(),this.serviceTag,this.broadcast,{log:this.log}))}_onMdnsResponse(t){this.log.trace("received mDNS query response");try{const n=ZIe(t,this.peerName,this.serviceTag,{log:this.log});n!=null&&(this.log("discovered peer in mDNS query response %p",n.id),this.dispatchEvent(new CustomEvent("peer",{detail:n})))}catch(n){this.log.error("Error processing peer response",n)}}_onMdnsWarning(t){this.log.error("mdns warning",t)}_onMdnsError(t){this.log.error("mdns error",t)}async stop(){this.mdns!=null&&(this.mdns.removeListener("query",this._onMdnsQuery),this.mdns.removeListener("response",this._onMdnsResponse),this.mdns.removeListener("warning",this._onMdnsWarning),this.mdns.removeListener("error",this._onMdnsError),this._queryInterval!=null&&(clearInterval(this._queryInterval),this._queryInterval=null),await new Promise(t=>{this.mdns!=null?this.mdns.destroy(t):t()}),this.mdns=void 0)}}function iCe(r={}){return e=>new nCe(e,r)}const sCe=()=>{const[r,e]=Ua.useState(""),[t,n]=Ua.useState([]),[i,s]=Ua.useState(null),[o,a]=Ua.useState(null);Ua.useEffect(()=>{async function l(){try{console.log("Starting OrbitDB initialization for GitHub Pages");let d;try{d=await Gxe({libp2p:{transports:[Pj(),_j(),eK()],transportManager:{faultTolerance:jd.NO_FATAL},peerDiscovery:[VV({list:["/dns4/bootstrap.libp2p.io/tcp/443/wss/p2p/12D3KooWQL1aS4qD3yCjmV7gNmx4F5gP7pNXG1qimV5DXe7tXUn","/dns4/bootstrap.libp2p.io/tcp/443/wss/p2p/12D3KooWAtfLqN4QmgjrZ9eZ9r4L1B7bH7d9eW8fA4n4bBAyKSm","/dns4/relay.libp2p.io/tcp/443/wss/p2p/12D3KooWAdNWhqW6zSMv1tW2aLKNvEfR7f2DubkXq56Y2uLmsdN"]}),iCe()],services:{identify:iK(),pubsub:OIe()}}}),d.libp2p.addEventListener("peer:connect",f=>{console.log("Connected to peer:",f.detail.toString())}),d.libp2p.addEventListener("peer:disconnect",f=>{console.log("Disconnected from peer:",f.detail.toString())})}catch(f){throw console.error("Failed to initialize Helia:",f),new Error("IPFS initialization failed")}if(console.log("IPFS initialized:",d),!d)throw new Error("IPFS instance is undefined");const h=await use({ipfs:d});console.log("OrbitDB instance created:",h);const p=await h.open("citizenx-annotations",{type:"documents"});console.log("Database opened:",p),s(p);const w=await p.all();n(w.map(f=>f.value)),p.events.on("update",async()=>{const f=await p.all();n(f.map(g=>g.value)),console.log("GitHub Pages database updated:",f)})}catch(d){console.error("OrbitDB initialization failed:",d),a("Failed to initialize decentralized storage")}}l()},[]);const c=async()=>{if(r.trim()&&i)try{const l={_id:Date.now().toString(),url:"sidepanel",text:r.trim(),timestamp:Date.now()};await i.put(l),e(""),console.log("Saved annotation to OrbitDB:",l)}catch(l){console.error("Failed to save annotation:",l),a("Failed to save annotation")}};return jn.jsxs("div",{style:{padding:"16px",maxWidth:"300px"},children:[jn.jsx("h1",{style:{fontSize:"1.5rem",fontWeight:"bold",margin:"0 0 8px 0"},children:"CitizenX Annotations"}),o&&jn.jsx("p",{style:{color:"red",margin:"0 0 8px 0"},children:o}),jn.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[jn.jsx("input",{type:"text",value:r,onChange:l=>e(l.target.value),placeholder:"Enter annotation...",style:{flex:1,padding:"5px",border:"1px solid #ccc",borderRadius:"3px"}}),jn.jsx("button",{onClick:c,disabled:!i,style:{padding:"5px 10px",background:i?"#007bff":"#ccc",color:"#fff",border:"none",borderRadius:"3px",cursor:i?"pointer":"not-allowed"},children:"Save"})]}),jn.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:t.length===0?jn.jsx("p",{style:{margin:0,color:"#666"},children:"No annotations yet."}):jn.jsx("ul",{style:{margin:0,padding:0,listStyle:"none"},children:t.map(l=>jn.jsxs("li",{style:{padding:"5px 0",borderBottom:"1px solid #eee",wordBreak:"break-word"},children:[l.text," ",jn.jsxs("small",{children:["(",new Date(l.timestamp).toLocaleString(),")"]})]},l._id))})})]})};n5.createRoot(document.getElementById("root")).render(jn.jsx(Dq.StrictMode,{children:jn.jsx(sCe,{})}));
