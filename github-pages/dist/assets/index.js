var Tj=Object.defineProperty;var QS=r=>{throw TypeError(r)};var $j=(r,e,t)=>e in r?Tj(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var u=(r,e,t)=>$j(r,typeof e!="symbol"?e+"":e,t),pw=(r,e,t)=>e.has(r)||QS("Cannot "+t);var ie=(r,e,t)=>(pw(r,e,"read from private field"),t?t.call(r):e.get(r)),qe=(r,e,t)=>e.has(r)?QS("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),dt=(r,e,t,n)=>(pw(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),Ae=(r,e,t)=>(pw(r,e,"access private method"),t);var ns=(r,e,t,n)=>({set _(i){dt(r,e,i,t)},get _(){return ie(r,e,n)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var Jf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Pj(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var pN={exports:{}},H3={},gN={exports:{}},je={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i0=Symbol.for("react.element"),Dj=Symbol.for("react.portal"),Nj=Symbol.for("react.fragment"),Oj=Symbol.for("react.strict_mode"),Rj=Symbol.for("react.profiler"),Bj=Symbol.for("react.provider"),Lj=Symbol.for("react.context"),Mj=Symbol.for("react.forward_ref"),Uj=Symbol.for("react.suspense"),Fj=Symbol.for("react.memo"),zj=Symbol.for("react.lazy"),YS=Symbol.iterator;function Vj(r){return r===null||typeof r!="object"?null:(r=YS&&r[YS]||r["@@iterator"],typeof r=="function"?r:null)}var yN={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},mN=Object.assign,wN={};function rh(r,e,t){this.props=r,this.context=e,this.refs=wN,this.updater=t||yN}rh.prototype.isReactComponent={};rh.prototype.setState=function(r,e){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,e,"setState")};rh.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function bN(){}bN.prototype=rh.prototype;function Y9(r,e,t){this.props=r,this.context=e,this.refs=wN,this.updater=t||yN}var J9=Y9.prototype=new bN;J9.constructor=Y9;mN(J9,rh.prototype);J9.isPureReactComponent=!0;var JS=Array.isArray,vN=Object.prototype.hasOwnProperty,X9={current:null},EN={key:!0,ref:!0,__self:!0,__source:!0};function xN(r,e,t){var n,i={},s=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)vN.call(e,n)&&!EN.hasOwnProperty(n)&&(i[n]=e[n]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(r&&r.defaultProps)for(n in a=r.defaultProps,a)i[n]===void 0&&(i[n]=a[n]);return{$$typeof:i0,type:r,key:s,ref:o,props:i,_owner:X9.current}}function Kj(r,e){return{$$typeof:i0,type:r.type,key:e,ref:r.ref,props:r.props,_owner:r._owner}}function Z9(r){return typeof r=="object"&&r!==null&&r.$$typeof===i0}function jj(r){var e={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(t){return e[t]})}var XS=/\/+/g;function gw(r,e){return typeof r=="object"&&r!==null&&r.key!=null?jj(""+r.key):e.toString(36)}function i2(r,e,t,n,i){var s=typeof r;(s==="undefined"||s==="boolean")&&(r=null);var o=!1;if(r===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(r.$$typeof){case i0:case Dj:o=!0}}if(o)return o=r,i=i(o),r=n===""?"."+gw(o,0):n,JS(i)?(t="",r!=null&&(t=r.replace(XS,"$&/")+"/"),i2(i,e,t,"",function(l){return l})):i!=null&&(Z9(i)&&(i=Kj(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(XS,"$&/")+"/")+r)),e.push(i)),1;if(o=0,n=n===""?".":n+":",JS(r))for(var a=0;a<r.length;a++){s=r[a];var c=n+gw(s,a);o+=i2(s,e,t,c,i)}else if(c=Vj(r),typeof c=="function")for(r=c.call(r),a=0;!(s=r.next()).done;)s=s.value,c=n+gw(s,a++),o+=i2(s,e,t,c,i);else if(s==="object")throw e=String(r),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function G0(r,e,t){if(r==null)return r;var n=[],i=0;return i2(r,n,"","",function(s){return e.call(t,s,i++)}),n}function Hj(r){if(r._status===-1){var e=r._result;e=e(),e.then(function(t){(r._status===0||r._status===-1)&&(r._status=1,r._result=t)},function(t){(r._status===0||r._status===-1)&&(r._status=2,r._result=t)}),r._status===-1&&(r._status=0,r._result=e)}if(r._status===1)return r._result.default;throw r._result}var sn={current:null},s2={transition:null},qj={ReactCurrentDispatcher:sn,ReactCurrentBatchConfig:s2,ReactCurrentOwner:X9};function SN(){throw Error("act(...) is not supported in production builds of React.")}je.Children={map:G0,forEach:function(r,e,t){G0(r,function(){e.apply(this,arguments)},t)},count:function(r){var e=0;return G0(r,function(){e++}),e},toArray:function(r){return G0(r,function(e){return e})||[]},only:function(r){if(!Z9(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};je.Component=rh;je.Fragment=Nj;je.Profiler=Rj;je.PureComponent=Y9;je.StrictMode=Oj;je.Suspense=Uj;je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qj;je.act=SN;je.cloneElement=function(r,e,t){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var n=mN({},r.props),i=r.key,s=r.ref,o=r._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=X9.current),e.key!==void 0&&(i=""+e.key),r.type&&r.type.defaultProps)var a=r.type.defaultProps;for(c in e)vN.call(e,c)&&!EN.hasOwnProperty(c)&&(n[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)n.children=t;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];n.children=a}return{$$typeof:i0,type:r.type,key:i,ref:s,props:n,_owner:o}};je.createContext=function(r){return r={$$typeof:Lj,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:Bj,_context:r},r.Consumer=r};je.createElement=xN;je.createFactory=function(r){var e=xN.bind(null,r);return e.type=r,e};je.createRef=function(){return{current:null}};je.forwardRef=function(r){return{$$typeof:Mj,render:r}};je.isValidElement=Z9;je.lazy=function(r){return{$$typeof:zj,_payload:{_status:-1,_result:r},_init:Hj}};je.memo=function(r,e){return{$$typeof:Fj,type:r,compare:e===void 0?null:e}};je.startTransition=function(r){var e=s2.transition;s2.transition={};try{r()}finally{s2.transition=e}};je.unstable_act=SN;je.useCallback=function(r,e){return sn.current.useCallback(r,e)};je.useContext=function(r){return sn.current.useContext(r)};je.useDebugValue=function(){};je.useDeferredValue=function(r){return sn.current.useDeferredValue(r)};je.useEffect=function(r,e){return sn.current.useEffect(r,e)};je.useId=function(){return sn.current.useId()};je.useImperativeHandle=function(r,e,t){return sn.current.useImperativeHandle(r,e,t)};je.useInsertionEffect=function(r,e){return sn.current.useInsertionEffect(r,e)};je.useLayoutEffect=function(r,e){return sn.current.useLayoutEffect(r,e)};je.useMemo=function(r,e){return sn.current.useMemo(r,e)};je.useReducer=function(r,e,t){return sn.current.useReducer(r,e,t)};je.useRef=function(r){return sn.current.useRef(r)};je.useState=function(r){return sn.current.useState(r)};je.useSyncExternalStore=function(r,e,t){return sn.current.useSyncExternalStore(r,e,t)};je.useTransition=function(){return sn.current.useTransition()};je.version="18.3.1";gN.exports=je;var ba=gN.exports;const Wj=hc(ba);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gj=ba,Qj=Symbol.for("react.element"),Yj=Symbol.for("react.fragment"),Jj=Object.prototype.hasOwnProperty,Xj=Gj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Zj={key:!0,ref:!0,__self:!0,__source:!0};function AN(r,e,t){var n,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)Jj.call(e,n)&&!Zj.hasOwnProperty(n)&&(i[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)i[n]===void 0&&(i[n]=e[n]);return{$$typeof:Qj,type:r,key:s,ref:o,props:i,_owner:Xj.current}}H3.Fragment=Yj;H3.jsx=AN;H3.jsxs=AN;pN.exports=H3;var _n=pN.exports,C5={},CN={exports:{}},Kn={},kN={exports:{}},IN={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function e(R,L){var q=R.length;R.push(L);e:for(;0<q;){var Q=q-1>>>1,K=R[Q];if(0<i(K,L))R[Q]=L,R[q]=K,q=Q;else break e}}function t(R){return R.length===0?null:R[0]}function n(R){if(R.length===0)return null;var L=R[0],q=R.pop();if(q!==L){R[0]=q;e:for(var Q=0,K=R.length,ce=K>>>1;Q<ce;){var me=2*(Q+1)-1,de=R[me],ue=me+1,$e=R[ue];if(0>i(de,q))ue<K&&0>i($e,de)?(R[Q]=$e,R[ue]=q,Q=ue):(R[Q]=de,R[me]=q,Q=me);else if(ue<K&&0>i($e,q))R[Q]=$e,R[ue]=q,Q=ue;else break e}}return L}function i(R,L){var q=R.sortIndex-L.sortIndex;return q!==0?q:R.id-L.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();r.unstable_now=function(){return o.now()-a}}var c=[],l=[],d=1,h=null,p=3,b=!1,f=!1,g=!1,v=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(R){for(var L=t(l);L!==null;){if(L.callback===null)n(l);else if(L.startTime<=R)n(l),L.sortIndex=L.expirationTime,e(c,L);else break;L=t(l)}}function E(R){if(g=!1,m(R),!f)if(t(c)!==null)f=!0,G(C);else{var L=t(l);L!==null&&V(E,L.startTime-R)}}function C(R,L){f=!1,g&&(g=!1,y(I),I=-1),b=!0;var q=p;try{for(m(L),h=t(c);h!==null&&(!(h.expirationTime>L)||R&&!W());){var Q=h.callback;if(typeof Q=="function"){h.callback=null,p=h.priorityLevel;var K=Q(h.expirationTime<=L);L=r.unstable_now(),typeof K=="function"?h.callback=K:h===t(c)&&n(c),m(L)}else n(c);h=t(c)}if(h!==null)var ce=!0;else{var me=t(l);me!==null&&V(E,me.startTime-L),ce=!1}return ce}finally{h=null,p=q,b=!1}}var k=!1,A=null,I=-1,D=5,F=-1;function W(){return!(r.unstable_now()-F<D)}function U(){if(A!==null){var R=r.unstable_now();F=R;var L=!0;try{L=A(!0,R)}finally{L?Y():(k=!1,A=null)}}else k=!1}var Y;if(typeof w=="function")Y=function(){w(U)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,H=j.port2;j.port1.onmessage=U,Y=function(){H.postMessage(null)}}else Y=function(){v(U,0)};function G(R){A=R,k||(k=!0,Y())}function V(R,L){I=v(function(){R(r.unstable_now())},L)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(R){R.callback=null},r.unstable_continueExecution=function(){f||b||(f=!0,G(C))},r.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<R?Math.floor(1e3/R):5},r.unstable_getCurrentPriorityLevel=function(){return p},r.unstable_getFirstCallbackNode=function(){return t(c)},r.unstable_next=function(R){switch(p){case 1:case 2:case 3:var L=3;break;default:L=p}var q=p;p=L;try{return R()}finally{p=q}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(R,L){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var q=p;p=R;try{return L()}finally{p=q}},r.unstable_scheduleCallback=function(R,L,q){var Q=r.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?Q+q:Q):q=Q,R){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=q+K,R={id:d++,callback:L,priorityLevel:R,startTime:q,expirationTime:K,sortIndex:-1},q>Q?(R.sortIndex=q,e(l,R),t(c)===null&&R===t(l)&&(g?(y(I),I=-1):g=!0,V(E,q-Q))):(R.sortIndex=K,e(c,R),f||b||(f=!0,G(C))),R},r.unstable_shouldYield=W,r.unstable_wrapCallback=function(R){var L=p;return function(){var q=p;p=L;try{return R.apply(this,arguments)}finally{p=q}}}})(IN);kN.exports=IN;var eH=kN.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tH=ba,Un=eH;function ee(r){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+r,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+r+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var _N=new Set,Xf={};function Wl(r,e){pd(r,e),pd(r+"Capture",e)}function pd(r,e){for(Xf[r]=e,r=0;r<e.length;r++)_N.add(e[r])}var yo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),k5=Object.prototype.hasOwnProperty,rH=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ZS={},eA={};function nH(r){return k5.call(eA,r)?!0:k5.call(ZS,r)?!1:rH.test(r)?eA[r]=!0:(ZS[r]=!0,!1)}function iH(r,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function sH(r,e,t,n){if(e===null||typeof e>"u"||iH(r,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function on(r,e,t,n,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=r,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var hr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){hr[r]=new on(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var e=r[0];hr[e]=new on(e,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){hr[r]=new on(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){hr[r]=new on(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){hr[r]=new on(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){hr[r]=new on(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){hr[r]=new on(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){hr[r]=new on(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){hr[r]=new on(r,5,!1,r.toLowerCase(),null,!1,!1)});var ev=/[\-:]([a-z])/g;function tv(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var e=r.replace(ev,tv);hr[e]=new on(e,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var e=r.replace(ev,tv);hr[e]=new on(e,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var e=r.replace(ev,tv);hr[e]=new on(e,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){hr[r]=new on(r,1,!1,r.toLowerCase(),null,!1,!1)});hr.xlinkHref=new on("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){hr[r]=new on(r,1,!1,r.toLowerCase(),null,!0,!0)});function rv(r,e,t,n){var i=hr.hasOwnProperty(e)?hr[e]:null;(i!==null?i.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(sH(e,t,i,n)&&(t=null),n||i===null?nH(e)&&(t===null?r.removeAttribute(e):r.setAttribute(e,""+t)):i.mustUseProperty?r[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,n=i.attributeNamespace,t===null?r.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,n?r.setAttributeNS(n,e,t):r.setAttribute(e,t))))}var _o=tH.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Q0=Symbol.for("react.element"),ku=Symbol.for("react.portal"),Iu=Symbol.for("react.fragment"),nv=Symbol.for("react.strict_mode"),I5=Symbol.for("react.profiler"),TN=Symbol.for("react.provider"),$N=Symbol.for("react.context"),iv=Symbol.for("react.forward_ref"),_5=Symbol.for("react.suspense"),T5=Symbol.for("react.suspense_list"),sv=Symbol.for("react.memo"),oa=Symbol.for("react.lazy"),PN=Symbol.for("react.offscreen"),tA=Symbol.iterator;function $h(r){return r===null||typeof r!="object"?null:(r=tA&&r[tA]||r["@@iterator"],typeof r=="function"?r:null)}var Ot=Object.assign,yw;function gf(r){if(yw===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);yw=e&&e[1]||""}return`
`+yw+r}var mw=!1;function ww(r,e){if(!r||mw)return"";mw=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var n=l}Reflect.construct(r,[],e)}else{try{e.call()}catch(l){n=l}r.call(e.prototype)}else{try{throw Error()}catch(l){n=l}r()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),s=n.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var c=`
`+i[o].replace(" at new "," at ");return r.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",r.displayName)),c}while(1<=o&&0<=a);break}}}finally{mw=!1,Error.prepareStackTrace=t}return(r=r?r.displayName||r.name:"")?gf(r):""}function oH(r){switch(r.tag){case 5:return gf(r.type);case 16:return gf("Lazy");case 13:return gf("Suspense");case 19:return gf("SuspenseList");case 0:case 2:case 15:return r=ww(r.type,!1),r;case 11:return r=ww(r.type.render,!1),r;case 1:return r=ww(r.type,!0),r;default:return""}}function $5(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Iu:return"Fragment";case ku:return"Portal";case I5:return"Profiler";case nv:return"StrictMode";case _5:return"Suspense";case T5:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case $N:return(r.displayName||"Context")+".Consumer";case TN:return(r._context.displayName||"Context")+".Provider";case iv:var e=r.render;return r=r.displayName,r||(r=e.displayName||e.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case sv:return e=r.displayName||null,e!==null?e:$5(r.type)||"Memo";case oa:e=r._payload,r=r._init;try{return $5(r(e))}catch{}}return null}function aH(r){var e=r.type;switch(r.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=e.render,r=r.displayName||r.name||"",e.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return $5(e);case 8:return e===nv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ja(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function DN(r){var e=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function cH(r){var e=DN(r)?"checked":"value",t=Object.getOwnPropertyDescriptor(r.constructor.prototype,e),n=""+r[e];if(!r.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(r,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){n=""+o,s.call(this,o)}}),Object.defineProperty(r,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){r._valueTracker=null,delete r[e]}}}}function Y0(r){r._valueTracker||(r._valueTracker=cH(r))}function NN(r){if(!r)return!1;var e=r._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return r&&(n=DN(r)?r.checked?"true":"false":r.value),r=n,r!==t?(e.setValue(r),!0):!1}function Y2(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function P5(r,e){var t=e.checked;return Ot({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??r._wrapperState.initialChecked})}function rA(r,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=Ja(e.value!=null?e.value:t),r._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function ON(r,e){e=e.checked,e!=null&&rv(r,"checked",e,!1)}function D5(r,e){ON(r,e);var t=Ja(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&r.value===""||r.value!=t)&&(r.value=""+t):r.value!==""+t&&(r.value=""+t);else if(n==="submit"||n==="reset"){r.removeAttribute("value");return}e.hasOwnProperty("value")?N5(r,e.type,t):e.hasOwnProperty("defaultValue")&&N5(r,e.type,Ja(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(r.defaultChecked=!!e.defaultChecked)}function nA(r,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+r._wrapperState.initialValue,t||e===r.value||(r.value=e),r.defaultValue=e}t=r.name,t!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,t!==""&&(r.name=t)}function N5(r,e,t){(e!=="number"||Y2(r.ownerDocument)!==r)&&(t==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+t&&(r.defaultValue=""+t))}var yf=Array.isArray;function Vu(r,e,t,n){if(r=r.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<r.length;t++)i=e.hasOwnProperty("$"+r[t].value),r[t].selected!==i&&(r[t].selected=i),i&&n&&(r[t].defaultSelected=!0)}else{for(t=""+Ja(t),e=null,i=0;i<r.length;i++){if(r[i].value===t){r[i].selected=!0,n&&(r[i].defaultSelected=!0);return}e!==null||r[i].disabled||(e=r[i])}e!==null&&(e.selected=!0)}}function O5(r,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ee(91));return Ot({},e,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function iA(r,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(ee(92));if(yf(t)){if(1<t.length)throw Error(ee(93));t=t[0]}e=t}e==null&&(e=""),t=e}r._wrapperState={initialValue:Ja(t)}}function RN(r,e){var t=Ja(e.value),n=Ja(e.defaultValue);t!=null&&(t=""+t,t!==r.value&&(r.value=t),e.defaultValue==null&&r.defaultValue!==t&&(r.defaultValue=t)),n!=null&&(r.defaultValue=""+n)}function sA(r){var e=r.textContent;e===r._wrapperState.initialValue&&e!==""&&e!==null&&(r.value=e)}function BN(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function R5(r,e){return r==null||r==="http://www.w3.org/1999/xhtml"?BN(e):r==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var J0,LN=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return r(e,t,n,i)})}:r}(function(r,e){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=e;else{for(J0=J0||document.createElement("div"),J0.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=J0.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;e.firstChild;)r.appendChild(e.firstChild)}});function Zf(r,e){if(e){var t=r.firstChild;if(t&&t===r.lastChild&&t.nodeType===3){t.nodeValue=e;return}}r.textContent=e}var Tf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},lH=["Webkit","ms","Moz","O"];Object.keys(Tf).forEach(function(r){lH.forEach(function(e){e=e+r.charAt(0).toUpperCase()+r.substring(1),Tf[e]=Tf[r]})});function MN(r,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Tf.hasOwnProperty(r)&&Tf[r]?(""+e).trim():e+"px"}function UN(r,e){r=r.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,i=MN(t,e[t],n);t==="float"&&(t="cssFloat"),n?r.setProperty(t,i):r[t]=i}}var uH=Ot({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function B5(r,e){if(e){if(uH[r]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ee(137,r));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ee(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ee(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ee(62))}}function L5(r,e){if(r.indexOf("-")===-1)return typeof e.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var M5=null;function ov(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var U5=null,Ku=null,ju=null;function oA(r){if(r=a0(r)){if(typeof U5!="function")throw Error(ee(280));var e=r.stateNode;e&&(e=Y3(e),U5(r.stateNode,r.type,e))}}function FN(r){Ku?ju?ju.push(r):ju=[r]:Ku=r}function zN(){if(Ku){var r=Ku,e=ju;if(ju=Ku=null,oA(r),e)for(r=0;r<e.length;r++)oA(e[r])}}function VN(r,e){return r(e)}function KN(){}var bw=!1;function jN(r,e,t){if(bw)return r(e,t);bw=!0;try{return VN(r,e,t)}finally{bw=!1,(Ku!==null||ju!==null)&&(KN(),zN())}}function e1(r,e){var t=r.stateNode;if(t===null)return null;var n=Y3(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(r=r.type,n=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!n;break e;default:r=!1}if(r)return null;if(t&&typeof t!="function")throw Error(ee(231,e,typeof t));return t}var F5=!1;if(yo)try{var Ph={};Object.defineProperty(Ph,"passive",{get:function(){F5=!0}}),window.addEventListener("test",Ph,Ph),window.removeEventListener("test",Ph,Ph)}catch{F5=!1}function dH(r,e,t,n,i,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(d){this.onError(d)}}var $f=!1,J2=null,X2=!1,z5=null,hH={onError:function(r){$f=!0,J2=r}};function fH(r,e,t,n,i,s,o,a,c){$f=!1,J2=null,dH.apply(hH,arguments)}function pH(r,e,t,n,i,s,o,a,c){if(fH.apply(this,arguments),$f){if($f){var l=J2;$f=!1,J2=null}else throw Error(ee(198));X2||(X2=!0,z5=l)}}function Gl(r){var e=r,t=r;if(r.alternate)for(;e.return;)e=e.return;else{r=e;do e=r,e.flags&4098&&(t=e.return),r=e.return;while(r)}return e.tag===3?t:null}function HN(r){if(r.tag===13){var e=r.memoizedState;if(e===null&&(r=r.alternate,r!==null&&(e=r.memoizedState)),e!==null)return e.dehydrated}return null}function aA(r){if(Gl(r)!==r)throw Error(ee(188))}function gH(r){var e=r.alternate;if(!e){if(e=Gl(r),e===null)throw Error(ee(188));return e!==r?null:r}for(var t=r,n=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(n=i.return,n!==null){t=n;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return aA(i),r;if(s===n)return aA(i),e;s=s.sibling}throw Error(ee(188))}if(t.return!==n.return)t=i,n=s;else{for(var o=!1,a=i.child;a;){if(a===t){o=!0,t=i,n=s;break}if(a===n){o=!0,n=i,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,n=i;break}if(a===n){o=!0,n=s,t=i;break}a=a.sibling}if(!o)throw Error(ee(189))}}if(t.alternate!==n)throw Error(ee(190))}if(t.tag!==3)throw Error(ee(188));return t.stateNode.current===t?r:e}function qN(r){return r=gH(r),r!==null?WN(r):null}function WN(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var e=WN(r);if(e!==null)return e;r=r.sibling}return null}var GN=Un.unstable_scheduleCallback,cA=Un.unstable_cancelCallback,yH=Un.unstable_shouldYield,mH=Un.unstable_requestPaint,Ut=Un.unstable_now,wH=Un.unstable_getCurrentPriorityLevel,av=Un.unstable_ImmediatePriority,QN=Un.unstable_UserBlockingPriority,Z2=Un.unstable_NormalPriority,bH=Un.unstable_LowPriority,YN=Un.unstable_IdlePriority,q3=null,bs=null;function vH(r){if(bs&&typeof bs.onCommitFiberRoot=="function")try{bs.onCommitFiberRoot(q3,r,void 0,(r.current.flags&128)===128)}catch{}}var Ki=Math.clz32?Math.clz32:SH,EH=Math.log,xH=Math.LN2;function SH(r){return r>>>=0,r===0?32:31-(EH(r)/xH|0)|0}var X0=64,Z0=4194304;function mf(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function eg(r,e){var t=r.pendingLanes;if(t===0)return 0;var n=0,i=r.suspendedLanes,s=r.pingedLanes,o=t&268435455;if(o!==0){var a=o&~i;a!==0?n=mf(a):(s&=o,s!==0&&(n=mf(s)))}else o=t&~i,o!==0?n=mf(o):s!==0&&(n=mf(s));if(n===0)return 0;if(e!==0&&e!==n&&!(e&i)&&(i=n&-n,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(n&4&&(n|=t&16),e=r.entangledLanes,e!==0)for(r=r.entanglements,e&=n;0<e;)t=31-Ki(e),i=1<<t,n|=r[t],e&=~i;return n}function AH(r,e){switch(r){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function CH(r,e){for(var t=r.suspendedLanes,n=r.pingedLanes,i=r.expirationTimes,s=r.pendingLanes;0<s;){var o=31-Ki(s),a=1<<o,c=i[o];c===-1?(!(a&t)||a&n)&&(i[o]=AH(a,e)):c<=e&&(r.expiredLanes|=a),s&=~a}}function V5(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function JN(){var r=X0;return X0<<=1,!(X0&4194240)&&(X0=64),r}function vw(r){for(var e=[],t=0;31>t;t++)e.push(r);return e}function s0(r,e,t){r.pendingLanes|=e,e!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,e=31-Ki(e),r[e]=t}function kH(r,e){var t=r.pendingLanes&~e;r.pendingLanes=e,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=e,r.mutableReadLanes&=e,r.entangledLanes&=e,e=r.entanglements;var n=r.eventTimes;for(r=r.expirationTimes;0<t;){var i=31-Ki(t),s=1<<i;e[i]=0,n[i]=-1,r[i]=-1,t&=~s}}function cv(r,e){var t=r.entangledLanes|=e;for(r=r.entanglements;t;){var n=31-Ki(t),i=1<<n;i&e|r[n]&e&&(r[n]|=e),t&=~i}}var lt=0;function XN(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var ZN,lv,eO,tO,rO,K5=!1,ep=[],Ra=null,Ba=null,La=null,t1=new Map,r1=new Map,va=[],IH="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function lA(r,e){switch(r){case"focusin":case"focusout":Ra=null;break;case"dragenter":case"dragleave":Ba=null;break;case"mouseover":case"mouseout":La=null;break;case"pointerover":case"pointerout":t1.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":r1.delete(e.pointerId)}}function Dh(r,e,t,n,i,s){return r===null||r.nativeEvent!==s?(r={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:s,targetContainers:[i]},e!==null&&(e=a0(e),e!==null&&lv(e)),r):(r.eventSystemFlags|=n,e=r.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),r)}function _H(r,e,t,n,i){switch(e){case"focusin":return Ra=Dh(Ra,r,e,t,n,i),!0;case"dragenter":return Ba=Dh(Ba,r,e,t,n,i),!0;case"mouseover":return La=Dh(La,r,e,t,n,i),!0;case"pointerover":var s=i.pointerId;return t1.set(s,Dh(t1.get(s)||null,r,e,t,n,i)),!0;case"gotpointercapture":return s=i.pointerId,r1.set(s,Dh(r1.get(s)||null,r,e,t,n,i)),!0}return!1}function nO(r){var e=Wc(r.target);if(e!==null){var t=Gl(e);if(t!==null){if(e=t.tag,e===13){if(e=HN(t),e!==null){r.blockedOn=e,rO(r.priority,function(){eO(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){r.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}r.blockedOn=null}function o2(r){if(r.blockedOn!==null)return!1;for(var e=r.targetContainers;0<e.length;){var t=j5(r.domEventName,r.eventSystemFlags,e[0],r.nativeEvent);if(t===null){t=r.nativeEvent;var n=new t.constructor(t.type,t);M5=n,t.target.dispatchEvent(n),M5=null}else return e=a0(t),e!==null&&lv(e),r.blockedOn=t,!1;e.shift()}return!0}function uA(r,e,t){o2(r)&&t.delete(e)}function TH(){K5=!1,Ra!==null&&o2(Ra)&&(Ra=null),Ba!==null&&o2(Ba)&&(Ba=null),La!==null&&o2(La)&&(La=null),t1.forEach(uA),r1.forEach(uA)}function Nh(r,e){r.blockedOn===e&&(r.blockedOn=null,K5||(K5=!0,Un.unstable_scheduleCallback(Un.unstable_NormalPriority,TH)))}function n1(r){function e(i){return Nh(i,r)}if(0<ep.length){Nh(ep[0],r);for(var t=1;t<ep.length;t++){var n=ep[t];n.blockedOn===r&&(n.blockedOn=null)}}for(Ra!==null&&Nh(Ra,r),Ba!==null&&Nh(Ba,r),La!==null&&Nh(La,r),t1.forEach(e),r1.forEach(e),t=0;t<va.length;t++)n=va[t],n.blockedOn===r&&(n.blockedOn=null);for(;0<va.length&&(t=va[0],t.blockedOn===null);)nO(t),t.blockedOn===null&&va.shift()}var Hu=_o.ReactCurrentBatchConfig,tg=!0;function $H(r,e,t,n){var i=lt,s=Hu.transition;Hu.transition=null;try{lt=1,uv(r,e,t,n)}finally{lt=i,Hu.transition=s}}function PH(r,e,t,n){var i=lt,s=Hu.transition;Hu.transition=null;try{lt=4,uv(r,e,t,n)}finally{lt=i,Hu.transition=s}}function uv(r,e,t,n){if(tg){var i=j5(r,e,t,n);if(i===null)$w(r,e,n,rg,t),lA(r,n);else if(_H(i,r,e,t,n))n.stopPropagation();else if(lA(r,n),e&4&&-1<IH.indexOf(r)){for(;i!==null;){var s=a0(i);if(s!==null&&ZN(s),s=j5(r,e,t,n),s===null&&$w(r,e,n,rg,t),s===i)break;i=s}i!==null&&n.stopPropagation()}else $w(r,e,n,null,t)}}var rg=null;function j5(r,e,t,n){if(rg=null,r=ov(n),r=Wc(r),r!==null)if(e=Gl(r),e===null)r=null;else if(t=e.tag,t===13){if(r=HN(e),r!==null)return r;r=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;r=null}else e!==r&&(r=null);return rg=r,null}function iO(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(wH()){case av:return 1;case QN:return 4;case Z2:case bH:return 16;case YN:return 536870912;default:return 16}default:return 16}}var Ia=null,dv=null,a2=null;function sO(){if(a2)return a2;var r,e=dv,t=e.length,n,i="value"in Ia?Ia.value:Ia.textContent,s=i.length;for(r=0;r<t&&e[r]===i[r];r++);var o=t-r;for(n=1;n<=o&&e[t-n]===i[s-n];n++);return a2=i.slice(r,1<n?1-n:void 0)}function c2(r){var e=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&e===13&&(r=13)):r=e,r===10&&(r=13),32<=r||r===13?r:0}function tp(){return!0}function dA(){return!1}function jn(r){function e(t,n,i,s,o){this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in r)r.hasOwnProperty(a)&&(t=r[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?tp:dA,this.isPropagationStopped=dA,this}return Ot(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=tp)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=tp)},persist:function(){},isPersistent:tp}),e}var nh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hv=jn(nh),o0=Ot({},nh,{view:0,detail:0}),DH=jn(o0),Ew,xw,Oh,W3=Ot({},o0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fv,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Oh&&(Oh&&r.type==="mousemove"?(Ew=r.screenX-Oh.screenX,xw=r.screenY-Oh.screenY):xw=Ew=0,Oh=r),Ew)},movementY:function(r){return"movementY"in r?r.movementY:xw}}),hA=jn(W3),NH=Ot({},W3,{dataTransfer:0}),OH=jn(NH),RH=Ot({},o0,{relatedTarget:0}),Sw=jn(RH),BH=Ot({},nh,{animationName:0,elapsedTime:0,pseudoElement:0}),LH=jn(BH),MH=Ot({},nh,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),UH=jn(MH),FH=Ot({},nh,{data:0}),fA=jn(FH),zH={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},VH={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},KH={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jH(r){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(r):(r=KH[r])?!!e[r]:!1}function fv(){return jH}var HH=Ot({},o0,{key:function(r){if(r.key){var e=zH[r.key]||r.key;if(e!=="Unidentified")return e}return r.type==="keypress"?(r=c2(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?VH[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fv,charCode:function(r){return r.type==="keypress"?c2(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?c2(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),qH=jn(HH),WH=Ot({},W3,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pA=jn(WH),GH=Ot({},o0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fv}),QH=jn(GH),YH=Ot({},nh,{propertyName:0,elapsedTime:0,pseudoElement:0}),JH=jn(YH),XH=Ot({},W3,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),ZH=jn(XH),eq=[9,13,27,32],pv=yo&&"CompositionEvent"in window,Pf=null;yo&&"documentMode"in document&&(Pf=document.documentMode);var tq=yo&&"TextEvent"in window&&!Pf,oO=yo&&(!pv||Pf&&8<Pf&&11>=Pf),gA=" ",yA=!1;function aO(r,e){switch(r){case"keyup":return eq.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function cO(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var _u=!1;function rq(r,e){switch(r){case"compositionend":return cO(e);case"keypress":return e.which!==32?null:(yA=!0,gA);case"textInput":return r=e.data,r===gA&&yA?null:r;default:return null}}function nq(r,e){if(_u)return r==="compositionend"||!pv&&aO(r,e)?(r=sO(),a2=dv=Ia=null,_u=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return oO&&e.locale!=="ko"?null:e.data;default:return null}}var iq={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mA(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e==="input"?!!iq[r.type]:e==="textarea"}function lO(r,e,t,n){FN(n),e=ng(e,"onChange"),0<e.length&&(t=new hv("onChange","change",null,t,n),r.push({event:t,listeners:e}))}var Df=null,i1=null;function sq(r){vO(r,0)}function G3(r){var e=Pu(r);if(NN(e))return r}function oq(r,e){if(r==="change")return e}var uO=!1;if(yo){var Aw;if(yo){var Cw="oninput"in document;if(!Cw){var wA=document.createElement("div");wA.setAttribute("oninput","return;"),Cw=typeof wA.oninput=="function"}Aw=Cw}else Aw=!1;uO=Aw&&(!document.documentMode||9<document.documentMode)}function bA(){Df&&(Df.detachEvent("onpropertychange",dO),i1=Df=null)}function dO(r){if(r.propertyName==="value"&&G3(i1)){var e=[];lO(e,i1,r,ov(r)),jN(sq,e)}}function aq(r,e,t){r==="focusin"?(bA(),Df=e,i1=t,Df.attachEvent("onpropertychange",dO)):r==="focusout"&&bA()}function cq(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return G3(i1)}function lq(r,e){if(r==="click")return G3(e)}function uq(r,e){if(r==="input"||r==="change")return G3(e)}function dq(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var Gi=typeof Object.is=="function"?Object.is:dq;function s1(r,e){if(Gi(r,e))return!0;if(typeof r!="object"||r===null||typeof e!="object"||e===null)return!1;var t=Object.keys(r),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var i=t[n];if(!k5.call(e,i)||!Gi(r[i],e[i]))return!1}return!0}function vA(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function EA(r,e){var t=vA(r);r=0;for(var n;t;){if(t.nodeType===3){if(n=r+t.textContent.length,r<=e&&n>=e)return{node:t,offset:e-r};r=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=vA(t)}}function hO(r,e){return r&&e?r===e?!0:r&&r.nodeType===3?!1:e&&e.nodeType===3?hO(r,e.parentNode):"contains"in r?r.contains(e):r.compareDocumentPosition?!!(r.compareDocumentPosition(e)&16):!1:!1}function fO(){for(var r=window,e=Y2();e instanceof r.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)r=e.contentWindow;else break;e=Y2(r.document)}return e}function gv(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e&&(e==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||e==="textarea"||r.contentEditable==="true")}function hq(r){var e=fO(),t=r.focusedElem,n=r.selectionRange;if(e!==t&&t&&t.ownerDocument&&hO(t.ownerDocument.documentElement,t)){if(n!==null&&gv(t)){if(e=n.start,r=n.end,r===void 0&&(r=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(r,t.value.length);else if(r=(e=t.ownerDocument||document)&&e.defaultView||window,r.getSelection){r=r.getSelection();var i=t.textContent.length,s=Math.min(n.start,i);n=n.end===void 0?s:Math.min(n.end,i),!r.extend&&s>n&&(i=n,n=s,s=i),i=EA(t,s);var o=EA(t,n);i&&o&&(r.rangeCount!==1||r.anchorNode!==i.node||r.anchorOffset!==i.offset||r.focusNode!==o.node||r.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),r.removeAllRanges(),s>n?(r.addRange(e),r.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),r.addRange(e)))}}for(e=[],r=t;r=r.parentNode;)r.nodeType===1&&e.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)r=e[t],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var fq=yo&&"documentMode"in document&&11>=document.documentMode,Tu=null,H5=null,Nf=null,q5=!1;function xA(r,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;q5||Tu==null||Tu!==Y2(n)||(n=Tu,"selectionStart"in n&&gv(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Nf&&s1(Nf,n)||(Nf=n,n=ng(H5,"onSelect"),0<n.length&&(e=new hv("onSelect","select",null,e,t),r.push({event:e,listeners:n}),e.target=Tu)))}function rp(r,e){var t={};return t[r.toLowerCase()]=e.toLowerCase(),t["Webkit"+r]="webkit"+e,t["Moz"+r]="moz"+e,t}var $u={animationend:rp("Animation","AnimationEnd"),animationiteration:rp("Animation","AnimationIteration"),animationstart:rp("Animation","AnimationStart"),transitionend:rp("Transition","TransitionEnd")},kw={},pO={};yo&&(pO=document.createElement("div").style,"AnimationEvent"in window||(delete $u.animationend.animation,delete $u.animationiteration.animation,delete $u.animationstart.animation),"TransitionEvent"in window||delete $u.transitionend.transition);function Q3(r){if(kw[r])return kw[r];if(!$u[r])return r;var e=$u[r],t;for(t in e)if(e.hasOwnProperty(t)&&t in pO)return kw[r]=e[t];return r}var gO=Q3("animationend"),yO=Q3("animationiteration"),mO=Q3("animationstart"),wO=Q3("transitionend"),bO=new Map,SA="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function fc(r,e){bO.set(r,e),Wl(e,[r])}for(var Iw=0;Iw<SA.length;Iw++){var _w=SA[Iw],pq=_w.toLowerCase(),gq=_w[0].toUpperCase()+_w.slice(1);fc(pq,"on"+gq)}fc(gO,"onAnimationEnd");fc(yO,"onAnimationIteration");fc(mO,"onAnimationStart");fc("dblclick","onDoubleClick");fc("focusin","onFocus");fc("focusout","onBlur");fc(wO,"onTransitionEnd");pd("onMouseEnter",["mouseout","mouseover"]);pd("onMouseLeave",["mouseout","mouseover"]);pd("onPointerEnter",["pointerout","pointerover"]);pd("onPointerLeave",["pointerout","pointerover"]);Wl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wl("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),yq=new Set("cancel close invalid load scroll toggle".split(" ").concat(wf));function AA(r,e,t){var n=r.type||"unknown-event";r.currentTarget=t,pH(n,e,void 0,r),r.currentTarget=null}function vO(r,e){e=(e&4)!==0;for(var t=0;t<r.length;t++){var n=r[t],i=n.event;n=n.listeners;e:{var s=void 0;if(e)for(var o=n.length-1;0<=o;o--){var a=n[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&i.isPropagationStopped())break e;AA(i,a,l),s=c}else for(o=0;o<n.length;o++){if(a=n[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&i.isPropagationStopped())break e;AA(i,a,l),s=c}}}if(X2)throw r=z5,X2=!1,z5=null,r}function vt(r,e){var t=e[J5];t===void 0&&(t=e[J5]=new Set);var n=r+"__bubble";t.has(n)||(EO(e,r,2,!1),t.add(n))}function Tw(r,e,t){var n=0;e&&(n|=4),EO(t,r,n,e)}var np="_reactListening"+Math.random().toString(36).slice(2);function o1(r){if(!r[np]){r[np]=!0,_N.forEach(function(t){t!=="selectionchange"&&(yq.has(t)||Tw(t,!1,r),Tw(t,!0,r))});var e=r.nodeType===9?r:r.ownerDocument;e===null||e[np]||(e[np]=!0,Tw("selectionchange",!1,e))}}function EO(r,e,t,n){switch(iO(e)){case 1:var i=$H;break;case 4:i=PH;break;default:i=uv}t=i.bind(null,e,t,r),i=void 0,!F5||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),n?i!==void 0?r.addEventListener(e,t,{capture:!0,passive:i}):r.addEventListener(e,t,!0):i!==void 0?r.addEventListener(e,t,{passive:i}):r.addEventListener(e,t,!1)}function $w(r,e,t,n,i){var s=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var a=n.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=n.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Wc(a),o===null)return;if(c=o.tag,c===5||c===6){n=s=o;continue e}a=a.parentNode}}n=n.return}jN(function(){var l=s,d=ov(t),h=[];e:{var p=bO.get(r);if(p!==void 0){var b=hv,f=r;switch(r){case"keypress":if(c2(t)===0)break e;case"keydown":case"keyup":b=qH;break;case"focusin":f="focus",b=Sw;break;case"focusout":f="blur",b=Sw;break;case"beforeblur":case"afterblur":b=Sw;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":b=hA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":b=OH;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":b=QH;break;case gO:case yO:case mO:b=LH;break;case wO:b=JH;break;case"scroll":b=DH;break;case"wheel":b=ZH;break;case"copy":case"cut":case"paste":b=UH;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":b=pA}var g=(e&4)!==0,v=!g&&r==="scroll",y=g?p!==null?p+"Capture":null:p;g=[];for(var w=l,m;w!==null;){m=w;var E=m.stateNode;if(m.tag===5&&E!==null&&(m=E,y!==null&&(E=e1(w,y),E!=null&&g.push(a1(w,E,m)))),v)break;w=w.return}0<g.length&&(p=new b(p,f,null,t,d),h.push({event:p,listeners:g}))}}if(!(e&7)){e:{if(p=r==="mouseover"||r==="pointerover",b=r==="mouseout"||r==="pointerout",p&&t!==M5&&(f=t.relatedTarget||t.fromElement)&&(Wc(f)||f[mo]))break e;if((b||p)&&(p=d.window===d?d:(p=d.ownerDocument)?p.defaultView||p.parentWindow:window,b?(f=t.relatedTarget||t.toElement,b=l,f=f?Wc(f):null,f!==null&&(v=Gl(f),f!==v||f.tag!==5&&f.tag!==6)&&(f=null)):(b=null,f=l),b!==f)){if(g=hA,E="onMouseLeave",y="onMouseEnter",w="mouse",(r==="pointerout"||r==="pointerover")&&(g=pA,E="onPointerLeave",y="onPointerEnter",w="pointer"),v=b==null?p:Pu(b),m=f==null?p:Pu(f),p=new g(E,w+"leave",b,t,d),p.target=v,p.relatedTarget=m,E=null,Wc(d)===l&&(g=new g(y,w+"enter",f,t,d),g.target=m,g.relatedTarget=v,E=g),v=E,b&&f)t:{for(g=b,y=f,w=0,m=g;m;m=cu(m))w++;for(m=0,E=y;E;E=cu(E))m++;for(;0<w-m;)g=cu(g),w--;for(;0<m-w;)y=cu(y),m--;for(;w--;){if(g===y||y!==null&&g===y.alternate)break t;g=cu(g),y=cu(y)}g=null}else g=null;b!==null&&CA(h,p,b,g,!1),f!==null&&v!==null&&CA(h,v,f,g,!0)}}e:{if(p=l?Pu(l):window,b=p.nodeName&&p.nodeName.toLowerCase(),b==="select"||b==="input"&&p.type==="file")var C=oq;else if(mA(p))if(uO)C=uq;else{C=cq;var k=aq}else(b=p.nodeName)&&b.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(C=lq);if(C&&(C=C(r,l))){lO(h,C,t,d);break e}k&&k(r,p,l),r==="focusout"&&(k=p._wrapperState)&&k.controlled&&p.type==="number"&&N5(p,"number",p.value)}switch(k=l?Pu(l):window,r){case"focusin":(mA(k)||k.contentEditable==="true")&&(Tu=k,H5=l,Nf=null);break;case"focusout":Nf=H5=Tu=null;break;case"mousedown":q5=!0;break;case"contextmenu":case"mouseup":case"dragend":q5=!1,xA(h,t,d);break;case"selectionchange":if(fq)break;case"keydown":case"keyup":xA(h,t,d)}var A;if(pv)e:{switch(r){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else _u?aO(r,t)&&(I="onCompositionEnd"):r==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(oO&&t.locale!=="ko"&&(_u||I!=="onCompositionStart"?I==="onCompositionEnd"&&_u&&(A=sO()):(Ia=d,dv="value"in Ia?Ia.value:Ia.textContent,_u=!0)),k=ng(l,I),0<k.length&&(I=new fA(I,r,null,t,d),h.push({event:I,listeners:k}),A?I.data=A:(A=cO(t),A!==null&&(I.data=A)))),(A=tq?rq(r,t):nq(r,t))&&(l=ng(l,"onBeforeInput"),0<l.length&&(d=new fA("onBeforeInput","beforeinput",null,t,d),h.push({event:d,listeners:l}),d.data=A))}vO(h,e)})}function a1(r,e,t){return{instance:r,listener:e,currentTarget:t}}function ng(r,e){for(var t=e+"Capture",n=[];r!==null;){var i=r,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=e1(r,t),s!=null&&n.unshift(a1(r,s,i)),s=e1(r,e),s!=null&&n.push(a1(r,s,i))),r=r.return}return n}function cu(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function CA(r,e,t,n,i){for(var s=e._reactName,o=[];t!==null&&t!==n;){var a=t,c=a.alternate,l=a.stateNode;if(c!==null&&c===n)break;a.tag===5&&l!==null&&(a=l,i?(c=e1(t,s),c!=null&&o.unshift(a1(t,c,a))):i||(c=e1(t,s),c!=null&&o.push(a1(t,c,a)))),t=t.return}o.length!==0&&r.push({event:e,listeners:o})}var mq=/\r\n?/g,wq=/\u0000|\uFFFD/g;function kA(r){return(typeof r=="string"?r:""+r).replace(mq,`
`).replace(wq,"")}function ip(r,e,t){if(e=kA(e),kA(r)!==e&&t)throw Error(ee(425))}function ig(){}var W5=null,G5=null;function Q5(r,e){return r==="textarea"||r==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Y5=typeof setTimeout=="function"?setTimeout:void 0,bq=typeof clearTimeout=="function"?clearTimeout:void 0,IA=typeof Promise=="function"?Promise:void 0,vq=typeof queueMicrotask=="function"?queueMicrotask:typeof IA<"u"?function(r){return IA.resolve(null).then(r).catch(Eq)}:Y5;function Eq(r){setTimeout(function(){throw r})}function Pw(r,e){var t=e,n=0;do{var i=t.nextSibling;if(r.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(n===0){r.removeChild(i),n1(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=i}while(t);n1(e)}function Ma(r){for(;r!=null;r=r.nextSibling){var e=r.nodeType;if(e===1||e===3)break;if(e===8){if(e=r.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return r}function _A(r){r=r.previousSibling;for(var e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return r;e--}else t==="/$"&&e++}r=r.previousSibling}return null}var ih=Math.random().toString(36).slice(2),ms="__reactFiber$"+ih,c1="__reactProps$"+ih,mo="__reactContainer$"+ih,J5="__reactEvents$"+ih,xq="__reactListeners$"+ih,Sq="__reactHandles$"+ih;function Wc(r){var e=r[ms];if(e)return e;for(var t=r.parentNode;t;){if(e=t[mo]||t[ms]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(r=_A(r);r!==null;){if(t=r[ms])return t;r=_A(r)}return e}r=t,t=r.parentNode}return null}function a0(r){return r=r[ms]||r[mo],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Pu(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(ee(33))}function Y3(r){return r[c1]||null}var X5=[],Du=-1;function pc(r){return{current:r}}function Et(r){0>Du||(r.current=X5[Du],X5[Du]=null,Du--)}function yt(r,e){Du++,X5[Du]=r.current,r.current=e}var Xa={},qr=pc(Xa),yn=pc(!1),ml=Xa;function gd(r,e){var t=r.type.contextTypes;if(!t)return Xa;var n=r.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=e,r.__reactInternalMemoizedMaskedChildContext=i),i}function mn(r){return r=r.childContextTypes,r!=null}function sg(){Et(yn),Et(qr)}function TA(r,e,t){if(qr.current!==Xa)throw Error(ee(168));yt(qr,e),yt(yn,t)}function xO(r,e,t){var n=r.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var i in n)if(!(i in e))throw Error(ee(108,aH(r)||"Unknown",i));return Ot({},t,n)}function og(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Xa,ml=qr.current,yt(qr,r),yt(yn,yn.current),!0}function $A(r,e,t){var n=r.stateNode;if(!n)throw Error(ee(169));t?(r=xO(r,e,ml),n.__reactInternalMemoizedMergedChildContext=r,Et(yn),Et(qr),yt(qr,r)):Et(yn),yt(yn,t)}var Qs=null,J3=!1,Dw=!1;function SO(r){Qs===null?Qs=[r]:Qs.push(r)}function Aq(r){J3=!0,SO(r)}function gc(){if(!Dw&&Qs!==null){Dw=!0;var r=0,e=lt;try{var t=Qs;for(lt=1;r<t.length;r++){var n=t[r];do n=n(!0);while(n!==null)}Qs=null,J3=!1}catch(i){throw Qs!==null&&(Qs=Qs.slice(r+1)),GN(av,gc),i}finally{lt=e,Dw=!1}}return null}var Nu=[],Ou=0,ag=null,cg=0,oi=[],ai=0,wl=null,so=1,oo="";function Mc(r,e){Nu[Ou++]=cg,Nu[Ou++]=ag,ag=r,cg=e}function AO(r,e,t){oi[ai++]=so,oi[ai++]=oo,oi[ai++]=wl,wl=r;var n=so;r=oo;var i=32-Ki(n)-1;n&=~(1<<i),t+=1;var s=32-Ki(e)+i;if(30<s){var o=i-i%5;s=(n&(1<<o)-1).toString(32),n>>=o,i-=o,so=1<<32-Ki(e)+i|t<<i|n,oo=s+r}else so=1<<s|t<<i|n,oo=r}function yv(r){r.return!==null&&(Mc(r,1),AO(r,1,0))}function mv(r){for(;r===ag;)ag=Nu[--Ou],Nu[Ou]=null,cg=Nu[--Ou],Nu[Ou]=null;for(;r===wl;)wl=oi[--ai],oi[ai]=null,oo=oi[--ai],oi[ai]=null,so=oi[--ai],oi[ai]=null}var Mn=null,Ln=null,kt=!1,Mi=null;function CO(r,e){var t=ui(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=r,e=r.deletions,e===null?(r.deletions=[t],r.flags|=16):e.push(t)}function PA(r,e){switch(r.tag){case 5:var t=r.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(r.stateNode=e,Mn=r,Ln=Ma(e.firstChild),!0):!1;case 6:return e=r.pendingProps===""||e.nodeType!==3?null:e,e!==null?(r.stateNode=e,Mn=r,Ln=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=wl!==null?{id:so,overflow:oo}:null,r.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=ui(18,null,null,0),t.stateNode=e,t.return=r,r.child=t,Mn=r,Ln=null,!0):!1;default:return!1}}function Z5(r){return(r.mode&1)!==0&&(r.flags&128)===0}function e6(r){if(kt){var e=Ln;if(e){var t=e;if(!PA(r,e)){if(Z5(r))throw Error(ee(418));e=Ma(t.nextSibling);var n=Mn;e&&PA(r,e)?CO(n,t):(r.flags=r.flags&-4097|2,kt=!1,Mn=r)}}else{if(Z5(r))throw Error(ee(418));r.flags=r.flags&-4097|2,kt=!1,Mn=r}}}function DA(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Mn=r}function sp(r){if(r!==Mn)return!1;if(!kt)return DA(r),kt=!0,!1;var e;if((e=r.tag!==3)&&!(e=r.tag!==5)&&(e=r.type,e=e!=="head"&&e!=="body"&&!Q5(r.type,r.memoizedProps)),e&&(e=Ln)){if(Z5(r))throw kO(),Error(ee(418));for(;e;)CO(r,e),e=Ma(e.nextSibling)}if(DA(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(ee(317));e:{for(r=r.nextSibling,e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="/$"){if(e===0){Ln=Ma(r.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}r=r.nextSibling}Ln=null}}else Ln=Mn?Ma(r.stateNode.nextSibling):null;return!0}function kO(){for(var r=Ln;r;)r=Ma(r.nextSibling)}function yd(){Ln=Mn=null,kt=!1}function wv(r){Mi===null?Mi=[r]:Mi.push(r)}var Cq=_o.ReactCurrentBatchConfig;function Rh(r,e,t){if(r=t.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(ee(309));var n=t.stateNode}if(!n)throw Error(ee(147,r));var i=n,s=""+r;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof r!="string")throw Error(ee(284));if(!t._owner)throw Error(ee(290,r))}return r}function op(r,e){throw r=Object.prototype.toString.call(e),Error(ee(31,r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r))}function NA(r){var e=r._init;return e(r._payload)}function IO(r){function e(y,w){if(r){var m=y.deletions;m===null?(y.deletions=[w],y.flags|=16):m.push(w)}}function t(y,w){if(!r)return null;for(;w!==null;)e(y,w),w=w.sibling;return null}function n(y,w){for(y=new Map;w!==null;)w.key!==null?y.set(w.key,w):y.set(w.index,w),w=w.sibling;return y}function i(y,w){return y=Va(y,w),y.index=0,y.sibling=null,y}function s(y,w,m){return y.index=m,r?(m=y.alternate,m!==null?(m=m.index,m<w?(y.flags|=2,w):m):(y.flags|=2,w)):(y.flags|=1048576,w)}function o(y){return r&&y.alternate===null&&(y.flags|=2),y}function a(y,w,m,E){return w===null||w.tag!==6?(w=Uw(m,y.mode,E),w.return=y,w):(w=i(w,m),w.return=y,w)}function c(y,w,m,E){var C=m.type;return C===Iu?d(y,w,m.props.children,E,m.key):w!==null&&(w.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===oa&&NA(C)===w.type)?(E=i(w,m.props),E.ref=Rh(y,w,m),E.return=y,E):(E=g2(m.type,m.key,m.props,null,y.mode,E),E.ref=Rh(y,w,m),E.return=y,E)}function l(y,w,m,E){return w===null||w.tag!==4||w.stateNode.containerInfo!==m.containerInfo||w.stateNode.implementation!==m.implementation?(w=Fw(m,y.mode,E),w.return=y,w):(w=i(w,m.children||[]),w.return=y,w)}function d(y,w,m,E,C){return w===null||w.tag!==7?(w=ol(m,y.mode,E,C),w.return=y,w):(w=i(w,m),w.return=y,w)}function h(y,w,m){if(typeof w=="string"&&w!==""||typeof w=="number")return w=Uw(""+w,y.mode,m),w.return=y,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Q0:return m=g2(w.type,w.key,w.props,null,y.mode,m),m.ref=Rh(y,null,w),m.return=y,m;case ku:return w=Fw(w,y.mode,m),w.return=y,w;case oa:var E=w._init;return h(y,E(w._payload),m)}if(yf(w)||$h(w))return w=ol(w,y.mode,m,null),w.return=y,w;op(y,w)}return null}function p(y,w,m,E){var C=w!==null?w.key:null;if(typeof m=="string"&&m!==""||typeof m=="number")return C!==null?null:a(y,w,""+m,E);if(typeof m=="object"&&m!==null){switch(m.$$typeof){case Q0:return m.key===C?c(y,w,m,E):null;case ku:return m.key===C?l(y,w,m,E):null;case oa:return C=m._init,p(y,w,C(m._payload),E)}if(yf(m)||$h(m))return C!==null?null:d(y,w,m,E,null);op(y,m)}return null}function b(y,w,m,E,C){if(typeof E=="string"&&E!==""||typeof E=="number")return y=y.get(m)||null,a(w,y,""+E,C);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Q0:return y=y.get(E.key===null?m:E.key)||null,c(w,y,E,C);case ku:return y=y.get(E.key===null?m:E.key)||null,l(w,y,E,C);case oa:var k=E._init;return b(y,w,m,k(E._payload),C)}if(yf(E)||$h(E))return y=y.get(m)||null,d(w,y,E,C,null);op(w,E)}return null}function f(y,w,m,E){for(var C=null,k=null,A=w,I=w=0,D=null;A!==null&&I<m.length;I++){A.index>I?(D=A,A=null):D=A.sibling;var F=p(y,A,m[I],E);if(F===null){A===null&&(A=D);break}r&&A&&F.alternate===null&&e(y,A),w=s(F,w,I),k===null?C=F:k.sibling=F,k=F,A=D}if(I===m.length)return t(y,A),kt&&Mc(y,I),C;if(A===null){for(;I<m.length;I++)A=h(y,m[I],E),A!==null&&(w=s(A,w,I),k===null?C=A:k.sibling=A,k=A);return kt&&Mc(y,I),C}for(A=n(y,A);I<m.length;I++)D=b(A,y,I,m[I],E),D!==null&&(r&&D.alternate!==null&&A.delete(D.key===null?I:D.key),w=s(D,w,I),k===null?C=D:k.sibling=D,k=D);return r&&A.forEach(function(W){return e(y,W)}),kt&&Mc(y,I),C}function g(y,w,m,E){var C=$h(m);if(typeof C!="function")throw Error(ee(150));if(m=C.call(m),m==null)throw Error(ee(151));for(var k=C=null,A=w,I=w=0,D=null,F=m.next();A!==null&&!F.done;I++,F=m.next()){A.index>I?(D=A,A=null):D=A.sibling;var W=p(y,A,F.value,E);if(W===null){A===null&&(A=D);break}r&&A&&W.alternate===null&&e(y,A),w=s(W,w,I),k===null?C=W:k.sibling=W,k=W,A=D}if(F.done)return t(y,A),kt&&Mc(y,I),C;if(A===null){for(;!F.done;I++,F=m.next())F=h(y,F.value,E),F!==null&&(w=s(F,w,I),k===null?C=F:k.sibling=F,k=F);return kt&&Mc(y,I),C}for(A=n(y,A);!F.done;I++,F=m.next())F=b(A,y,I,F.value,E),F!==null&&(r&&F.alternate!==null&&A.delete(F.key===null?I:F.key),w=s(F,w,I),k===null?C=F:k.sibling=F,k=F);return r&&A.forEach(function(U){return e(y,U)}),kt&&Mc(y,I),C}function v(y,w,m,E){if(typeof m=="object"&&m!==null&&m.type===Iu&&m.key===null&&(m=m.props.children),typeof m=="object"&&m!==null){switch(m.$$typeof){case Q0:e:{for(var C=m.key,k=w;k!==null;){if(k.key===C){if(C=m.type,C===Iu){if(k.tag===7){t(y,k.sibling),w=i(k,m.props.children),w.return=y,y=w;break e}}else if(k.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===oa&&NA(C)===k.type){t(y,k.sibling),w=i(k,m.props),w.ref=Rh(y,k,m),w.return=y,y=w;break e}t(y,k);break}else e(y,k);k=k.sibling}m.type===Iu?(w=ol(m.props.children,y.mode,E,m.key),w.return=y,y=w):(E=g2(m.type,m.key,m.props,null,y.mode,E),E.ref=Rh(y,w,m),E.return=y,y=E)}return o(y);case ku:e:{for(k=m.key;w!==null;){if(w.key===k)if(w.tag===4&&w.stateNode.containerInfo===m.containerInfo&&w.stateNode.implementation===m.implementation){t(y,w.sibling),w=i(w,m.children||[]),w.return=y,y=w;break e}else{t(y,w);break}else e(y,w);w=w.sibling}w=Fw(m,y.mode,E),w.return=y,y=w}return o(y);case oa:return k=m._init,v(y,w,k(m._payload),E)}if(yf(m))return f(y,w,m,E);if($h(m))return g(y,w,m,E);op(y,m)}return typeof m=="string"&&m!==""||typeof m=="number"?(m=""+m,w!==null&&w.tag===6?(t(y,w.sibling),w=i(w,m),w.return=y,y=w):(t(y,w),w=Uw(m,y.mode,E),w.return=y,y=w),o(y)):t(y,w)}return v}var md=IO(!0),_O=IO(!1),lg=pc(null),ug=null,Ru=null,bv=null;function vv(){bv=Ru=ug=null}function Ev(r){var e=lg.current;Et(lg),r._currentValue=e}function t6(r,e,t){for(;r!==null;){var n=r.alternate;if((r.childLanes&e)!==e?(r.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),r===t)break;r=r.return}}function qu(r,e){ug=r,bv=Ru=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&e&&(pn=!0),r.firstContext=null)}function mi(r){var e=r._currentValue;if(bv!==r)if(r={context:r,memoizedValue:e,next:null},Ru===null){if(ug===null)throw Error(ee(308));Ru=r,ug.dependencies={lanes:0,firstContext:r}}else Ru=Ru.next=r;return e}var Gc=null;function xv(r){Gc===null?Gc=[r]:Gc.push(r)}function TO(r,e,t,n){var i=e.interleaved;return i===null?(t.next=t,xv(e)):(t.next=i.next,i.next=t),e.interleaved=t,wo(r,n)}function wo(r,e){r.lanes|=e;var t=r.alternate;for(t!==null&&(t.lanes|=e),t=r,r=r.return;r!==null;)r.childLanes|=e,t=r.alternate,t!==null&&(t.childLanes|=e),t=r,r=r.return;return t.tag===3?t.stateNode:null}var aa=!1;function Sv(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function $O(r,e){r=r.updateQueue,e.updateQueue===r&&(e.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function co(r,e){return{eventTime:r,lane:e,tag:0,payload:null,callback:null,next:null}}function Ua(r,e,t){var n=r.updateQueue;if(n===null)return null;if(n=n.shared,Xe&2){var i=n.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),n.pending=e,wo(r,t)}return i=n.interleaved,i===null?(e.next=e,xv(n)):(e.next=i.next,i.next=e),n.interleaved=e,wo(r,t)}function l2(r,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,cv(r,t)}}function OA(r,e){var t=r.updateQueue,n=r.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:n.shared,effects:n.effects},r.updateQueue=t;return}r=t.lastBaseUpdate,r===null?t.firstBaseUpdate=e:r.next=e,t.lastBaseUpdate=e}function dg(r,e,t,n){var i=r.updateQueue;aa=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var d=r.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=l:a.next=l,d.lastBaseUpdate=c))}if(s!==null){var h=i.baseState;o=0,d=l=c=null,a=s;do{var p=a.lane,b=a.eventTime;if((n&p)===p){d!==null&&(d=d.next={eventTime:b,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=r,g=a;switch(p=e,b=t,g.tag){case 1:if(f=g.payload,typeof f=="function"){h=f.call(b,h,p);break e}h=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=g.payload,p=typeof f=="function"?f.call(b,h,p):f,p==null)break e;h=Ot({},h,p);break e;case 2:aa=!0}}a.callback!==null&&a.lane!==0&&(r.flags|=64,p=i.effects,p===null?i.effects=[a]:p.push(a))}else b={eventTime:b,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(l=d=b,c=h):d=d.next=b,o|=p;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;p=a,a=p.next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}while(!0);if(d===null&&(c=h),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=d,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);vl|=o,r.lanes=o,r.memoizedState=h}}function RA(r,e,t){if(r=e.effects,e.effects=null,r!==null)for(e=0;e<r.length;e++){var n=r[e],i=n.callback;if(i!==null){if(n.callback=null,n=t,typeof i!="function")throw Error(ee(191,i));i.call(n)}}}var c0={},vs=pc(c0),l1=pc(c0),u1=pc(c0);function Qc(r){if(r===c0)throw Error(ee(174));return r}function Av(r,e){switch(yt(u1,e),yt(l1,r),yt(vs,c0),r=e.nodeType,r){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:R5(null,"");break;default:r=r===8?e.parentNode:e,e=r.namespaceURI||null,r=r.tagName,e=R5(e,r)}Et(vs),yt(vs,e)}function wd(){Et(vs),Et(l1),Et(u1)}function PO(r){Qc(u1.current);var e=Qc(vs.current),t=R5(e,r.type);e!==t&&(yt(l1,r),yt(vs,t))}function Cv(r){l1.current===r&&(Et(vs),Et(l1))}var Pt=pc(0);function hg(r){for(var e=r;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Nw=[];function kv(){for(var r=0;r<Nw.length;r++)Nw[r]._workInProgressVersionPrimary=null;Nw.length=0}var u2=_o.ReactCurrentDispatcher,Ow=_o.ReactCurrentBatchConfig,bl=0,Nt=null,qt=null,tr=null,fg=!1,Of=!1,d1=0,kq=0;function xr(){throw Error(ee(321))}function Iv(r,e){if(e===null)return!1;for(var t=0;t<e.length&&t<r.length;t++)if(!Gi(r[t],e[t]))return!1;return!0}function _v(r,e,t,n,i,s){if(bl=s,Nt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,u2.current=r===null||r.memoizedState===null?$q:Pq,r=t(n,i),Of){s=0;do{if(Of=!1,d1=0,25<=s)throw Error(ee(301));s+=1,tr=qt=null,e.updateQueue=null,u2.current=Dq,r=t(n,i)}while(Of)}if(u2.current=pg,e=qt!==null&&qt.next!==null,bl=0,tr=qt=Nt=null,fg=!1,e)throw Error(ee(300));return r}function Tv(){var r=d1!==0;return d1=0,r}function ds(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return tr===null?Nt.memoizedState=tr=r:tr=tr.next=r,tr}function wi(){if(qt===null){var r=Nt.alternate;r=r!==null?r.memoizedState:null}else r=qt.next;var e=tr===null?Nt.memoizedState:tr.next;if(e!==null)tr=e,qt=r;else{if(r===null)throw Error(ee(310));qt=r,r={memoizedState:qt.memoizedState,baseState:qt.baseState,baseQueue:qt.baseQueue,queue:qt.queue,next:null},tr===null?Nt.memoizedState=tr=r:tr=tr.next=r}return tr}function h1(r,e){return typeof e=="function"?e(r):e}function Rw(r){var e=wi(),t=e.queue;if(t===null)throw Error(ee(311));t.lastRenderedReducer=r;var n=qt,i=n.baseQueue,s=t.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}n.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,n=n.baseState;var a=o=null,c=null,l=s;do{var d=l.lane;if((bl&d)===d)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:r(n,l.action);else{var h={lane:d,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=h,o=n):c=c.next=h,Nt.lanes|=d,vl|=d}l=l.next}while(l!==null&&l!==s);c===null?o=n:c.next=a,Gi(n,e.memoizedState)||(pn=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=c,t.lastRenderedState=n}if(r=t.interleaved,r!==null){i=r;do s=i.lane,Nt.lanes|=s,vl|=s,i=i.next;while(i!==r)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Bw(r){var e=wi(),t=e.queue;if(t===null)throw Error(ee(311));t.lastRenderedReducer=r;var n=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do s=r(s,o.action),o=o.next;while(o!==i);Gi(s,e.memoizedState)||(pn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,n]}function DO(){}function NO(r,e){var t=Nt,n=wi(),i=e(),s=!Gi(n.memoizedState,i);if(s&&(n.memoizedState=i,pn=!0),n=n.queue,$v(BO.bind(null,t,n,r),[r]),n.getSnapshot!==e||s||tr!==null&&tr.memoizedState.tag&1){if(t.flags|=2048,f1(9,RO.bind(null,t,n,i,e),void 0,null),nr===null)throw Error(ee(349));bl&30||OO(t,e,i)}return i}function OO(r,e,t){r.flags|=16384,r={getSnapshot:e,value:t},e=Nt.updateQueue,e===null?(e={lastEffect:null,stores:null},Nt.updateQueue=e,e.stores=[r]):(t=e.stores,t===null?e.stores=[r]:t.push(r))}function RO(r,e,t,n){e.value=t,e.getSnapshot=n,LO(e)&&MO(r)}function BO(r,e,t){return t(function(){LO(e)&&MO(r)})}function LO(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!Gi(r,t)}catch{return!0}}function MO(r){var e=wo(r,1);e!==null&&ji(e,r,1,-1)}function BA(r){var e=ds();return typeof r=="function"&&(r=r()),e.memoizedState=e.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:h1,lastRenderedState:r},e.queue=r,r=r.dispatch=Tq.bind(null,Nt,r),[e.memoizedState,r]}function f1(r,e,t,n){return r={tag:r,create:e,destroy:t,deps:n,next:null},e=Nt.updateQueue,e===null?(e={lastEffect:null,stores:null},Nt.updateQueue=e,e.lastEffect=r.next=r):(t=e.lastEffect,t===null?e.lastEffect=r.next=r:(n=t.next,t.next=r,r.next=n,e.lastEffect=r)),r}function UO(){return wi().memoizedState}function d2(r,e,t,n){var i=ds();Nt.flags|=r,i.memoizedState=f1(1|e,t,void 0,n===void 0?null:n)}function X3(r,e,t,n){var i=wi();n=n===void 0?null:n;var s=void 0;if(qt!==null){var o=qt.memoizedState;if(s=o.destroy,n!==null&&Iv(n,o.deps)){i.memoizedState=f1(e,t,s,n);return}}Nt.flags|=r,i.memoizedState=f1(1|e,t,s,n)}function LA(r,e){return d2(8390656,8,r,e)}function $v(r,e){return X3(2048,8,r,e)}function FO(r,e){return X3(4,2,r,e)}function zO(r,e){return X3(4,4,r,e)}function VO(r,e){if(typeof e=="function")return r=r(),e(r),function(){e(null)};if(e!=null)return r=r(),e.current=r,function(){e.current=null}}function KO(r,e,t){return t=t!=null?t.concat([r]):null,X3(4,4,VO.bind(null,e,r),t)}function Pv(){}function jO(r,e){var t=wi();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&Iv(e,n[1])?n[0]:(t.memoizedState=[r,e],r)}function HO(r,e){var t=wi();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&Iv(e,n[1])?n[0]:(r=r(),t.memoizedState=[r,e],r)}function qO(r,e,t){return bl&21?(Gi(t,e)||(t=JN(),Nt.lanes|=t,vl|=t,r.baseState=!0),e):(r.baseState&&(r.baseState=!1,pn=!0),r.memoizedState=t)}function Iq(r,e){var t=lt;lt=t!==0&&4>t?t:4,r(!0);var n=Ow.transition;Ow.transition={};try{r(!1),e()}finally{lt=t,Ow.transition=n}}function WO(){return wi().memoizedState}function _q(r,e,t){var n=za(r);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},GO(r))QO(e,t);else if(t=TO(r,e,t,n),t!==null){var i=tn();ji(t,r,n,i),YO(t,e,n)}}function Tq(r,e,t){var n=za(r),i={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(GO(r))QO(e,i);else{var s=r.alternate;if(r.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(i.hasEagerState=!0,i.eagerState=a,Gi(a,o)){var c=e.interleaved;c===null?(i.next=i,xv(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}t=TO(r,e,i,n),t!==null&&(i=tn(),ji(t,r,n,i),YO(t,e,n))}}function GO(r){var e=r.alternate;return r===Nt||e!==null&&e===Nt}function QO(r,e){Of=fg=!0;var t=r.pending;t===null?e.next=e:(e.next=t.next,t.next=e),r.pending=e}function YO(r,e,t){if(t&4194240){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,cv(r,t)}}var pg={readContext:mi,useCallback:xr,useContext:xr,useEffect:xr,useImperativeHandle:xr,useInsertionEffect:xr,useLayoutEffect:xr,useMemo:xr,useReducer:xr,useRef:xr,useState:xr,useDebugValue:xr,useDeferredValue:xr,useTransition:xr,useMutableSource:xr,useSyncExternalStore:xr,useId:xr,unstable_isNewReconciler:!1},$q={readContext:mi,useCallback:function(r,e){return ds().memoizedState=[r,e===void 0?null:e],r},useContext:mi,useEffect:LA,useImperativeHandle:function(r,e,t){return t=t!=null?t.concat([r]):null,d2(4194308,4,VO.bind(null,e,r),t)},useLayoutEffect:function(r,e){return d2(4194308,4,r,e)},useInsertionEffect:function(r,e){return d2(4,2,r,e)},useMemo:function(r,e){var t=ds();return e=e===void 0?null:e,r=r(),t.memoizedState=[r,e],r},useReducer:function(r,e,t){var n=ds();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:e},n.queue=r,r=r.dispatch=_q.bind(null,Nt,r),[n.memoizedState,r]},useRef:function(r){var e=ds();return r={current:r},e.memoizedState=r},useState:BA,useDebugValue:Pv,useDeferredValue:function(r){return ds().memoizedState=r},useTransition:function(){var r=BA(!1),e=r[0];return r=Iq.bind(null,r[1]),ds().memoizedState=r,[e,r]},useMutableSource:function(){},useSyncExternalStore:function(r,e,t){var n=Nt,i=ds();if(kt){if(t===void 0)throw Error(ee(407));t=t()}else{if(t=e(),nr===null)throw Error(ee(349));bl&30||OO(n,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,LA(BO.bind(null,n,s,r),[r]),n.flags|=2048,f1(9,RO.bind(null,n,s,t,e),void 0,null),t},useId:function(){var r=ds(),e=nr.identifierPrefix;if(kt){var t=oo,n=so;t=(n&~(1<<32-Ki(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=d1++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=kq++,e=":"+e+"r"+t.toString(32)+":";return r.memoizedState=e},unstable_isNewReconciler:!1},Pq={readContext:mi,useCallback:jO,useContext:mi,useEffect:$v,useImperativeHandle:KO,useInsertionEffect:FO,useLayoutEffect:zO,useMemo:HO,useReducer:Rw,useRef:UO,useState:function(){return Rw(h1)},useDebugValue:Pv,useDeferredValue:function(r){var e=wi();return qO(e,qt.memoizedState,r)},useTransition:function(){var r=Rw(h1)[0],e=wi().memoizedState;return[r,e]},useMutableSource:DO,useSyncExternalStore:NO,useId:WO,unstable_isNewReconciler:!1},Dq={readContext:mi,useCallback:jO,useContext:mi,useEffect:$v,useImperativeHandle:KO,useInsertionEffect:FO,useLayoutEffect:zO,useMemo:HO,useReducer:Bw,useRef:UO,useState:function(){return Bw(h1)},useDebugValue:Pv,useDeferredValue:function(r){var e=wi();return qt===null?e.memoizedState=r:qO(e,qt.memoizedState,r)},useTransition:function(){var r=Bw(h1)[0],e=wi().memoizedState;return[r,e]},useMutableSource:DO,useSyncExternalStore:NO,useId:WO,unstable_isNewReconciler:!1};function Oi(r,e){if(r&&r.defaultProps){e=Ot({},e),r=r.defaultProps;for(var t in r)e[t]===void 0&&(e[t]=r[t]);return e}return e}function r6(r,e,t,n){e=r.memoizedState,t=t(n,e),t=t==null?e:Ot({},e,t),r.memoizedState=t,r.lanes===0&&(r.updateQueue.baseState=t)}var Z3={isMounted:function(r){return(r=r._reactInternals)?Gl(r)===r:!1},enqueueSetState:function(r,e,t){r=r._reactInternals;var n=tn(),i=za(r),s=co(n,i);s.payload=e,t!=null&&(s.callback=t),e=Ua(r,s,i),e!==null&&(ji(e,r,i,n),l2(e,r,i))},enqueueReplaceState:function(r,e,t){r=r._reactInternals;var n=tn(),i=za(r),s=co(n,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=Ua(r,s,i),e!==null&&(ji(e,r,i,n),l2(e,r,i))},enqueueForceUpdate:function(r,e){r=r._reactInternals;var t=tn(),n=za(r),i=co(t,n);i.tag=2,e!=null&&(i.callback=e),e=Ua(r,i,n),e!==null&&(ji(e,r,n,t),l2(e,r,n))}};function MA(r,e,t,n,i,s,o){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(n,s,o):e.prototype&&e.prototype.isPureReactComponent?!s1(t,n)||!s1(i,s):!0}function JO(r,e,t){var n=!1,i=Xa,s=e.contextType;return typeof s=="object"&&s!==null?s=mi(s):(i=mn(e)?ml:qr.current,n=e.contextTypes,s=(n=n!=null)?gd(r,i):Xa),e=new e(t,s),r.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Z3,r.stateNode=e,e._reactInternals=r,n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=i,r.__reactInternalMemoizedMaskedChildContext=s),e}function UA(r,e,t,n){r=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==r&&Z3.enqueueReplaceState(e,e.state,null)}function n6(r,e,t,n){var i=r.stateNode;i.props=t,i.state=r.memoizedState,i.refs={},Sv(r);var s=e.contextType;typeof s=="object"&&s!==null?i.context=mi(s):(s=mn(e)?ml:qr.current,i.context=gd(r,s)),i.state=r.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(r6(r,e,s,t),i.state=r.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Z3.enqueueReplaceState(i,i.state,null),dg(r,t,i,n),i.state=r.memoizedState),typeof i.componentDidMount=="function"&&(r.flags|=4194308)}function bd(r,e){try{var t="",n=e;do t+=oH(n),n=n.return;while(n);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:r,source:e,stack:i,digest:null}}function Lw(r,e,t){return{value:r,source:null,stack:t??null,digest:e??null}}function i6(r,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var Nq=typeof WeakMap=="function"?WeakMap:Map;function XO(r,e,t){t=co(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){yg||(yg=!0,p6=n),i6(r,e)},t}function ZO(r,e,t){t=co(-1,t),t.tag=3;var n=r.type.getDerivedStateFromError;if(typeof n=="function"){var i=e.value;t.payload=function(){return n(i)},t.callback=function(){i6(r,e)}}var s=r.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){i6(r,e),typeof n!="function"&&(Fa===null?Fa=new Set([this]):Fa.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function FA(r,e,t){var n=r.pingCache;if(n===null){n=r.pingCache=new Nq;var i=new Set;n.set(e,i)}else i=n.get(e),i===void 0&&(i=new Set,n.set(e,i));i.has(t)||(i.add(t),r=Wq.bind(null,r,e,t),e.then(r,r))}function zA(r){do{var e;if((e=r.tag===13)&&(e=r.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return r;r=r.return}while(r!==null);return null}function VA(r,e,t,n,i){return r.mode&1?(r.flags|=65536,r.lanes=i,r):(r===e?r.flags|=65536:(r.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=co(-1,1),e.tag=2,Ua(t,e,1))),t.lanes|=1),r)}var Oq=_o.ReactCurrentOwner,pn=!1;function Yr(r,e,t,n){e.child=r===null?_O(e,null,t,n):md(e,r.child,t,n)}function KA(r,e,t,n,i){t=t.render;var s=e.ref;return qu(e,i),n=_v(r,e,t,n,s,i),t=Tv(),r!==null&&!pn?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~i,bo(r,e,i)):(kt&&t&&yv(e),e.flags|=1,Yr(r,e,n,i),e.child)}function jA(r,e,t,n,i){if(r===null){var s=t.type;return typeof s=="function"&&!Uv(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,eR(r,e,s,n,i)):(r=g2(t.type,null,n,e,e.mode,i),r.ref=e.ref,r.return=e,e.child=r)}if(s=r.child,!(r.lanes&i)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:s1,t(o,n)&&r.ref===e.ref)return bo(r,e,i)}return e.flags|=1,r=Va(s,n),r.ref=e.ref,r.return=e,e.child=r}function eR(r,e,t,n,i){if(r!==null){var s=r.memoizedProps;if(s1(s,n)&&r.ref===e.ref)if(pn=!1,e.pendingProps=n=s,(r.lanes&i)!==0)r.flags&131072&&(pn=!0);else return e.lanes=r.lanes,bo(r,e,i)}return s6(r,e,t,n,i)}function tR(r,e,t){var n=e.pendingProps,i=n.children,s=r!==null?r.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},yt(Lu,Pn),Pn|=t;else{if(!(t&1073741824))return r=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:r,cachePool:null,transitions:null},e.updateQueue=null,yt(Lu,Pn),Pn|=r,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:t,yt(Lu,Pn),Pn|=n}else s!==null?(n=s.baseLanes|t,e.memoizedState=null):n=t,yt(Lu,Pn),Pn|=n;return Yr(r,e,i,t),e.child}function rR(r,e){var t=e.ref;(r===null&&t!==null||r!==null&&r.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function s6(r,e,t,n,i){var s=mn(t)?ml:qr.current;return s=gd(e,s),qu(e,i),t=_v(r,e,t,n,s,i),n=Tv(),r!==null&&!pn?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~i,bo(r,e,i)):(kt&&n&&yv(e),e.flags|=1,Yr(r,e,t,i),e.child)}function HA(r,e,t,n,i){if(mn(t)){var s=!0;og(e)}else s=!1;if(qu(e,i),e.stateNode===null)h2(r,e),JO(e,t,n),n6(e,t,n,i),n=!0;else if(r===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=t.contextType;typeof l=="object"&&l!==null?l=mi(l):(l=mn(t)?ml:qr.current,l=gd(e,l));var d=t.getDerivedStateFromProps,h=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==n||c!==l)&&UA(e,o,n,l),aa=!1;var p=e.memoizedState;o.state=p,dg(e,n,o,i),c=e.memoizedState,a!==n||p!==c||yn.current||aa?(typeof d=="function"&&(r6(e,t,d,n),c=e.memoizedState),(a=aa||MA(e,t,a,n,p,c,l))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=c),o.props=n,o.state=c,o.context=l,n=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,$O(r,e),a=e.memoizedProps,l=e.type===e.elementType?a:Oi(e.type,a),o.props=l,h=e.pendingProps,p=o.context,c=t.contextType,typeof c=="object"&&c!==null?c=mi(c):(c=mn(t)?ml:qr.current,c=gd(e,c));var b=t.getDerivedStateFromProps;(d=typeof b=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||p!==c)&&UA(e,o,n,c),aa=!1,p=e.memoizedState,o.state=p,dg(e,n,o,i);var f=e.memoizedState;a!==h||p!==f||yn.current||aa?(typeof b=="function"&&(r6(e,t,b,n),f=e.memoizedState),(l=aa||MA(e,t,l,n,p,f,c)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,f,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,f,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=f),o.props=n,o.state=f,o.context=c,n=l):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=1024),n=!1)}return o6(r,e,t,n,s,i)}function o6(r,e,t,n,i,s){rR(r,e);var o=(e.flags&128)!==0;if(!n&&!o)return i&&$A(e,t,!1),bo(r,e,s);n=e.stateNode,Oq.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,r!==null&&o?(e.child=md(e,r.child,null,s),e.child=md(e,null,a,s)):Yr(r,e,a,s),e.memoizedState=n.state,i&&$A(e,t,!0),e.child}function nR(r){var e=r.stateNode;e.pendingContext?TA(r,e.pendingContext,e.pendingContext!==e.context):e.context&&TA(r,e.context,!1),Av(r,e.containerInfo)}function qA(r,e,t,n,i){return yd(),wv(i),e.flags|=256,Yr(r,e,t,n),e.child}var a6={dehydrated:null,treeContext:null,retryLane:0};function c6(r){return{baseLanes:r,cachePool:null,transitions:null}}function iR(r,e,t){var n=e.pendingProps,i=Pt.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=r!==null&&r.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(r===null||r.memoizedState!==null)&&(i|=1),yt(Pt,i&1),r===null)return e6(e),r=e.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(e.mode&1?r.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,r=n.fallback,s?(n=e.mode,s=e.child,o={mode:"hidden",children:o},!(n&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=rm(o,n,0,null),r=ol(r,n,t,null),s.return=e,r.return=e,s.sibling=r,e.child=s,e.child.memoizedState=c6(t),e.memoizedState=a6,r):Dv(e,o));if(i=r.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return Rq(r,e,o,n,a,i,t);if(s){s=n.fallback,o=e.mode,i=r.child,a=i.sibling;var c={mode:"hidden",children:n.children};return!(o&1)&&e.child!==i?(n=e.child,n.childLanes=0,n.pendingProps=c,e.deletions=null):(n=Va(i,c),n.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Va(a,s):(s=ol(s,o,t,null),s.flags|=2),s.return=e,n.return=e,n.sibling=s,e.child=n,n=s,s=e.child,o=r.child.memoizedState,o=o===null?c6(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=r.childLanes&~t,e.memoizedState=a6,n}return s=r.child,r=s.sibling,n=Va(s,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,r!==null&&(t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)),e.child=n,e.memoizedState=null,n}function Dv(r,e){return e=rm({mode:"visible",children:e},r.mode,0,null),e.return=r,r.child=e}function ap(r,e,t,n){return n!==null&&wv(n),md(e,r.child,null,t),r=Dv(e,e.pendingProps.children),r.flags|=2,e.memoizedState=null,r}function Rq(r,e,t,n,i,s,o){if(t)return e.flags&256?(e.flags&=-257,n=Lw(Error(ee(422))),ap(r,e,o,n)):e.memoizedState!==null?(e.child=r.child,e.flags|=128,null):(s=n.fallback,i=e.mode,n=rm({mode:"visible",children:n.children},i,0,null),s=ol(s,i,o,null),s.flags|=2,n.return=e,s.return=e,n.sibling=s,e.child=n,e.mode&1&&md(e,r.child,null,o),e.child.memoizedState=c6(o),e.memoizedState=a6,s);if(!(e.mode&1))return ap(r,e,o,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var a=n.dgst;return n=a,s=Error(ee(419)),n=Lw(s,n,void 0),ap(r,e,o,n)}if(a=(o&r.childLanes)!==0,pn||a){if(n=nr,n!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,wo(r,i),ji(n,r,i,-1))}return Mv(),n=Lw(Error(ee(421))),ap(r,e,o,n)}return i.data==="$?"?(e.flags|=128,e.child=r.child,e=Gq.bind(null,r),i._reactRetry=e,null):(r=s.treeContext,Ln=Ma(i.nextSibling),Mn=e,kt=!0,Mi=null,r!==null&&(oi[ai++]=so,oi[ai++]=oo,oi[ai++]=wl,so=r.id,oo=r.overflow,wl=e),e=Dv(e,n.children),e.flags|=4096,e)}function WA(r,e,t){r.lanes|=e;var n=r.alternate;n!==null&&(n.lanes|=e),t6(r.return,e,t)}function Mw(r,e,t,n,i){var s=r.memoizedState;s===null?r.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=t,s.tailMode=i)}function sR(r,e,t){var n=e.pendingProps,i=n.revealOrder,s=n.tail;if(Yr(r,e,n.children,t),n=Pt.current,n&2)n=n&1|2,e.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=e.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&WA(r,t,e);else if(r.tag===19)WA(r,t,e);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}n&=1}if(yt(Pt,n),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)r=t.alternate,r!==null&&hg(r)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),Mw(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(r=i.alternate,r!==null&&hg(r)===null){e.child=i;break}r=i.sibling,i.sibling=t,t=i,i=r}Mw(e,!0,t,null,s);break;case"together":Mw(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function h2(r,e){!(e.mode&1)&&r!==null&&(r.alternate=null,e.alternate=null,e.flags|=2)}function bo(r,e,t){if(r!==null&&(e.dependencies=r.dependencies),vl|=e.lanes,!(t&e.childLanes))return null;if(r!==null&&e.child!==r.child)throw Error(ee(153));if(e.child!==null){for(r=e.child,t=Va(r,r.pendingProps),e.child=t,t.return=e;r.sibling!==null;)r=r.sibling,t=t.sibling=Va(r,r.pendingProps),t.return=e;t.sibling=null}return e.child}function Bq(r,e,t){switch(e.tag){case 3:nR(e),yd();break;case 5:PO(e);break;case 1:mn(e.type)&&og(e);break;case 4:Av(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,i=e.memoizedProps.value;yt(lg,n._currentValue),n._currentValue=i;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(yt(Pt,Pt.current&1),e.flags|=128,null):t&e.child.childLanes?iR(r,e,t):(yt(Pt,Pt.current&1),r=bo(r,e,t),r!==null?r.sibling:null);yt(Pt,Pt.current&1);break;case 19:if(n=(t&e.childLanes)!==0,r.flags&128){if(n)return sR(r,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),yt(Pt,Pt.current),n)break;return null;case 22:case 23:return e.lanes=0,tR(r,e,t)}return bo(r,e,t)}var oR,l6,aR,cR;oR=function(r,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)r.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};l6=function(){};aR=function(r,e,t,n){var i=r.memoizedProps;if(i!==n){r=e.stateNode,Qc(vs.current);var s=null;switch(t){case"input":i=P5(r,i),n=P5(r,n),s=[];break;case"select":i=Ot({},i,{value:void 0}),n=Ot({},n,{value:void 0}),s=[];break;case"textarea":i=O5(r,i),n=O5(r,n),s=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(r.onclick=ig)}B5(t,n);var o;t=null;for(l in i)if(!n.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var a=i[l];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Xf.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in n){var c=n[l];if(a=i!=null?i[l]:void 0,n.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(s||(s=[]),s.push(l,t)),t=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Xf.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&vt("scroll",r),s||a===c||(s=[])):(s=s||[]).push(l,c))}t&&(s=s||[]).push("style",t);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};cR=function(r,e,t,n){t!==n&&(e.flags|=4)};function Bh(r,e){if(!kt)switch(r.tailMode){case"hidden":e=r.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?r.tail=null:t.sibling=null;break;case"collapsed":t=r.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||r.tail===null?r.tail=null:r.tail.sibling=null:n.sibling=null}}function Sr(r){var e=r.alternate!==null&&r.alternate.child===r.child,t=0,n=0;if(e)for(var i=r.child;i!==null;)t|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=r,i=i.sibling;else for(i=r.child;i!==null;)t|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=r,i=i.sibling;return r.subtreeFlags|=n,r.childLanes=t,e}function Lq(r,e,t){var n=e.pendingProps;switch(mv(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Sr(e),null;case 1:return mn(e.type)&&sg(),Sr(e),null;case 3:return n=e.stateNode,wd(),Et(yn),Et(qr),kv(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(r===null||r.child===null)&&(sp(e)?e.flags|=4:r===null||r.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Mi!==null&&(m6(Mi),Mi=null))),l6(r,e),Sr(e),null;case 5:Cv(e);var i=Qc(u1.current);if(t=e.type,r!==null&&e.stateNode!=null)aR(r,e,t,n,i),r.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(ee(166));return Sr(e),null}if(r=Qc(vs.current),sp(e)){n=e.stateNode,t=e.type;var s=e.memoizedProps;switch(n[ms]=e,n[c1]=s,r=(e.mode&1)!==0,t){case"dialog":vt("cancel",n),vt("close",n);break;case"iframe":case"object":case"embed":vt("load",n);break;case"video":case"audio":for(i=0;i<wf.length;i++)vt(wf[i],n);break;case"source":vt("error",n);break;case"img":case"image":case"link":vt("error",n),vt("load",n);break;case"details":vt("toggle",n);break;case"input":rA(n,s),vt("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},vt("invalid",n);break;case"textarea":iA(n,s),vt("invalid",n)}B5(t,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?n.textContent!==a&&(s.suppressHydrationWarning!==!0&&ip(n.textContent,a,r),i=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&ip(n.textContent,a,r),i=["children",""+a]):Xf.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&vt("scroll",n)}switch(t){case"input":Y0(n),nA(n,s,!0);break;case"textarea":Y0(n),sA(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=ig)}n=i,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=BN(t)),r==="http://www.w3.org/1999/xhtml"?t==="script"?(r=o.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof n.is=="string"?r=o.createElement(t,{is:n.is}):(r=o.createElement(t),t==="select"&&(o=r,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):r=o.createElementNS(r,t),r[ms]=e,r[c1]=n,oR(r,e,!1,!1),e.stateNode=r;e:{switch(o=L5(t,n),t){case"dialog":vt("cancel",r),vt("close",r),i=n;break;case"iframe":case"object":case"embed":vt("load",r),i=n;break;case"video":case"audio":for(i=0;i<wf.length;i++)vt(wf[i],r);i=n;break;case"source":vt("error",r),i=n;break;case"img":case"image":case"link":vt("error",r),vt("load",r),i=n;break;case"details":vt("toggle",r),i=n;break;case"input":rA(r,n),i=P5(r,n),vt("invalid",r);break;case"option":i=n;break;case"select":r._wrapperState={wasMultiple:!!n.multiple},i=Ot({},n,{value:void 0}),vt("invalid",r);break;case"textarea":iA(r,n),i=O5(r,n),vt("invalid",r);break;default:i=n}B5(t,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?UN(r,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&LN(r,c)):s==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&Zf(r,c):typeof c=="number"&&Zf(r,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Xf.hasOwnProperty(s)?c!=null&&s==="onScroll"&&vt("scroll",r):c!=null&&rv(r,s,c,o))}switch(t){case"input":Y0(r),nA(r,n,!1);break;case"textarea":Y0(r),sA(r);break;case"option":n.value!=null&&r.setAttribute("value",""+Ja(n.value));break;case"select":r.multiple=!!n.multiple,s=n.value,s!=null?Vu(r,!!n.multiple,s,!1):n.defaultValue!=null&&Vu(r,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(r.onclick=ig)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Sr(e),null;case 6:if(r&&e.stateNode!=null)cR(r,e,r.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(ee(166));if(t=Qc(u1.current),Qc(vs.current),sp(e)){if(n=e.stateNode,t=e.memoizedProps,n[ms]=e,(s=n.nodeValue!==t)&&(r=Mn,r!==null))switch(r.tag){case 3:ip(n.nodeValue,t,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&ip(n.nodeValue,t,(r.mode&1)!==0)}s&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[ms]=e,e.stateNode=n}return Sr(e),null;case 13:if(Et(Pt),n=e.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(kt&&Ln!==null&&e.mode&1&&!(e.flags&128))kO(),yd(),e.flags|=98560,s=!1;else if(s=sp(e),n!==null&&n.dehydrated!==null){if(r===null){if(!s)throw Error(ee(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ee(317));s[ms]=e}else yd(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Sr(e),s=!1}else Mi!==null&&(m6(Mi),Mi=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(r!==null&&r.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(r===null||Pt.current&1?Wt===0&&(Wt=3):Mv())),e.updateQueue!==null&&(e.flags|=4),Sr(e),null);case 4:return wd(),l6(r,e),r===null&&o1(e.stateNode.containerInfo),Sr(e),null;case 10:return Ev(e.type._context),Sr(e),null;case 17:return mn(e.type)&&sg(),Sr(e),null;case 19:if(Et(Pt),s=e.memoizedState,s===null)return Sr(e),null;if(n=(e.flags&128)!==0,o=s.rendering,o===null)if(n)Bh(s,!1);else{if(Wt!==0||r!==null&&r.flags&128)for(r=e.child;r!==null;){if(o=hg(r),o!==null){for(e.flags|=128,Bh(s,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)s=t,r=n,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=r,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,r=o.dependencies,s.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t=t.sibling;return yt(Pt,Pt.current&1|2),e.child}r=r.sibling}s.tail!==null&&Ut()>vd&&(e.flags|=128,n=!0,Bh(s,!1),e.lanes=4194304)}else{if(!n)if(r=hg(o),r!==null){if(e.flags|=128,n=!0,t=r.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Bh(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!kt)return Sr(e),null}else 2*Ut()-s.renderingStartTime>vd&&t!==1073741824&&(e.flags|=128,n=!0,Bh(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ut(),e.sibling=null,t=Pt.current,yt(Pt,n?t&1|2:t&1),e):(Sr(e),null);case 22:case 23:return Lv(),n=e.memoizedState!==null,r!==null&&r.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Pn&1073741824&&(Sr(e),e.subtreeFlags&6&&(e.flags|=8192)):Sr(e),null;case 24:return null;case 25:return null}throw Error(ee(156,e.tag))}function Mq(r,e){switch(mv(e),e.tag){case 1:return mn(e.type)&&sg(),r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 3:return wd(),Et(yn),Et(qr),kv(),r=e.flags,r&65536&&!(r&128)?(e.flags=r&-65537|128,e):null;case 5:return Cv(e),null;case 13:if(Et(Pt),r=e.memoizedState,r!==null&&r.dehydrated!==null){if(e.alternate===null)throw Error(ee(340));yd()}return r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 19:return Et(Pt),null;case 4:return wd(),null;case 10:return Ev(e.type._context),null;case 22:case 23:return Lv(),null;case 24:return null;default:return null}}var cp=!1,zr=!1,Uq=typeof WeakSet=="function"?WeakSet:Set,be=null;function Bu(r,e){var t=r.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){Bt(r,e,n)}else t.current=null}function u6(r,e,t){try{t()}catch(n){Bt(r,e,n)}}var GA=!1;function Fq(r,e){if(W5=tg,r=fO(),gv(r)){if("selectionStart"in r)var t={start:r.selectionStart,end:r.selectionEnd};else e:{t=(t=r.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var i=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,c=-1,l=0,d=0,h=r,p=null;t:for(;;){for(var b;h!==t||i!==0&&h.nodeType!==3||(a=o+i),h!==s||n!==0&&h.nodeType!==3||(c=o+n),h.nodeType===3&&(o+=h.nodeValue.length),(b=h.firstChild)!==null;)p=h,h=b;for(;;){if(h===r)break t;if(p===t&&++l===i&&(a=o),p===s&&++d===n&&(c=o),(b=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=b}t=a===-1||c===-1?null:{start:a,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(G5={focusedElem:r,selectionRange:t},tg=!1,be=e;be!==null;)if(e=be,r=e.child,(e.subtreeFlags&1028)!==0&&r!==null)r.return=e,be=r;else for(;be!==null;){e=be;try{var f=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var g=f.memoizedProps,v=f.memoizedState,y=e.stateNode,w=y.getSnapshotBeforeUpdate(e.elementType===e.type?g:Oi(e.type,g),v);y.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var m=e.stateNode.containerInfo;m.nodeType===1?m.textContent="":m.nodeType===9&&m.documentElement&&m.removeChild(m.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ee(163))}}catch(E){Bt(e,e.return,E)}if(r=e.sibling,r!==null){r.return=e.return,be=r;break}be=e.return}return f=GA,GA=!1,f}function Rf(r,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&r)===r){var s=i.destroy;i.destroy=void 0,s!==void 0&&u6(e,t,s)}i=i.next}while(i!==n)}}function em(r,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&r)===r){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function d6(r){var e=r.ref;if(e!==null){var t=r.stateNode;switch(r.tag){case 5:r=t;break;default:r=t}typeof e=="function"?e(r):e.current=r}}function lR(r){var e=r.alternate;e!==null&&(r.alternate=null,lR(e)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(e=r.stateNode,e!==null&&(delete e[ms],delete e[c1],delete e[J5],delete e[xq],delete e[Sq])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function uR(r){return r.tag===5||r.tag===3||r.tag===4}function QA(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||uR(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function h6(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(r,e):t.insertBefore(r,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(r,t)):(e=t,e.appendChild(r)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=ig));else if(n!==4&&(r=r.child,r!==null))for(h6(r,e,t),r=r.sibling;r!==null;)h6(r,e,t),r=r.sibling}function f6(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.insertBefore(r,e):t.appendChild(r);else if(n!==4&&(r=r.child,r!==null))for(f6(r,e,t),r=r.sibling;r!==null;)f6(r,e,t),r=r.sibling}var ar=null,Ri=!1;function Ho(r,e,t){for(t=t.child;t!==null;)dR(r,e,t),t=t.sibling}function dR(r,e,t){if(bs&&typeof bs.onCommitFiberUnmount=="function")try{bs.onCommitFiberUnmount(q3,t)}catch{}switch(t.tag){case 5:zr||Bu(t,e);case 6:var n=ar,i=Ri;ar=null,Ho(r,e,t),ar=n,Ri=i,ar!==null&&(Ri?(r=ar,t=t.stateNode,r.nodeType===8?r.parentNode.removeChild(t):r.removeChild(t)):ar.removeChild(t.stateNode));break;case 18:ar!==null&&(Ri?(r=ar,t=t.stateNode,r.nodeType===8?Pw(r.parentNode,t):r.nodeType===1&&Pw(r,t),n1(r)):Pw(ar,t.stateNode));break;case 4:n=ar,i=Ri,ar=t.stateNode.containerInfo,Ri=!0,Ho(r,e,t),ar=n,Ri=i;break;case 0:case 11:case 14:case 15:if(!zr&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&u6(t,e,o),i=i.next}while(i!==n)}Ho(r,e,t);break;case 1:if(!zr&&(Bu(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(a){Bt(t,e,a)}Ho(r,e,t);break;case 21:Ho(r,e,t);break;case 22:t.mode&1?(zr=(n=zr)||t.memoizedState!==null,Ho(r,e,t),zr=n):Ho(r,e,t);break;default:Ho(r,e,t)}}function YA(r){var e=r.updateQueue;if(e!==null){r.updateQueue=null;var t=r.stateNode;t===null&&(t=r.stateNode=new Uq),e.forEach(function(n){var i=Qq.bind(null,r,n);t.has(n)||(t.add(n),n.then(i,i))})}}function ki(r,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var i=t[n];try{var s=r,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:ar=a.stateNode,Ri=!1;break e;case 3:ar=a.stateNode.containerInfo,Ri=!0;break e;case 4:ar=a.stateNode.containerInfo,Ri=!0;break e}a=a.return}if(ar===null)throw Error(ee(160));dR(s,o,i),ar=null,Ri=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(l){Bt(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)hR(e,r),e=e.sibling}function hR(r,e){var t=r.alternate,n=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(ki(e,r),is(r),n&4){try{Rf(3,r,r.return),em(3,r)}catch(g){Bt(r,r.return,g)}try{Rf(5,r,r.return)}catch(g){Bt(r,r.return,g)}}break;case 1:ki(e,r),is(r),n&512&&t!==null&&Bu(t,t.return);break;case 5:if(ki(e,r),is(r),n&512&&t!==null&&Bu(t,t.return),r.flags&32){var i=r.stateNode;try{Zf(i,"")}catch(g){Bt(r,r.return,g)}}if(n&4&&(i=r.stateNode,i!=null)){var s=r.memoizedProps,o=t!==null?t.memoizedProps:s,a=r.type,c=r.updateQueue;if(r.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&ON(i,s),L5(a,o);var l=L5(a,s);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];d==="style"?UN(i,h):d==="dangerouslySetInnerHTML"?LN(i,h):d==="children"?Zf(i,h):rv(i,d,h,l)}switch(a){case"input":D5(i,s);break;case"textarea":RN(i,s);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var b=s.value;b!=null?Vu(i,!!s.multiple,b,!1):p!==!!s.multiple&&(s.defaultValue!=null?Vu(i,!!s.multiple,s.defaultValue,!0):Vu(i,!!s.multiple,s.multiple?[]:"",!1))}i[c1]=s}catch(g){Bt(r,r.return,g)}}break;case 6:if(ki(e,r),is(r),n&4){if(r.stateNode===null)throw Error(ee(162));i=r.stateNode,s=r.memoizedProps;try{i.nodeValue=s}catch(g){Bt(r,r.return,g)}}break;case 3:if(ki(e,r),is(r),n&4&&t!==null&&t.memoizedState.isDehydrated)try{n1(e.containerInfo)}catch(g){Bt(r,r.return,g)}break;case 4:ki(e,r),is(r);break;case 13:ki(e,r),is(r),i=r.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Rv=Ut())),n&4&&YA(r);break;case 22:if(d=t!==null&&t.memoizedState!==null,r.mode&1?(zr=(l=zr)||d,ki(e,r),zr=l):ki(e,r),is(r),n&8192){if(l=r.memoizedState!==null,(r.stateNode.isHidden=l)&&!d&&r.mode&1)for(be=r,d=r.child;d!==null;){for(h=be=d;be!==null;){switch(p=be,b=p.child,p.tag){case 0:case 11:case 14:case 15:Rf(4,p,p.return);break;case 1:Bu(p,p.return);var f=p.stateNode;if(typeof f.componentWillUnmount=="function"){n=p,t=p.return;try{e=n,f.props=e.memoizedProps,f.state=e.memoizedState,f.componentWillUnmount()}catch(g){Bt(n,t,g)}}break;case 5:Bu(p,p.return);break;case 22:if(p.memoizedState!==null){XA(h);continue}}b!==null?(b.return=p,be=b):XA(h)}d=d.sibling}e:for(d=null,h=r;;){if(h.tag===5){if(d===null){d=h;try{i=h.stateNode,l?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=MN("display",o))}catch(g){Bt(r,r.return,g)}}}else if(h.tag===6){if(d===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(g){Bt(r,r.return,g)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===r)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===r)break e;for(;h.sibling===null;){if(h.return===null||h.return===r)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ki(e,r),is(r),n&4&&YA(r);break;case 21:break;default:ki(e,r),is(r)}}function is(r){var e=r.flags;if(e&2){try{e:{for(var t=r.return;t!==null;){if(uR(t)){var n=t;break e}t=t.return}throw Error(ee(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(Zf(i,""),n.flags&=-33);var s=QA(r);f6(r,s,i);break;case 3:case 4:var o=n.stateNode.containerInfo,a=QA(r);h6(r,a,o);break;default:throw Error(ee(161))}}catch(c){Bt(r,r.return,c)}r.flags&=-3}e&4096&&(r.flags&=-4097)}function zq(r,e,t){be=r,fR(r)}function fR(r,e,t){for(var n=(r.mode&1)!==0;be!==null;){var i=be,s=i.child;if(i.tag===22&&n){var o=i.memoizedState!==null||cp;if(!o){var a=i.alternate,c=a!==null&&a.memoizedState!==null||zr;a=cp;var l=zr;if(cp=o,(zr=c)&&!l)for(be=i;be!==null;)o=be,c=o.child,o.tag===22&&o.memoizedState!==null?ZA(i):c!==null?(c.return=o,be=c):ZA(i);for(;s!==null;)be=s,fR(s),s=s.sibling;be=i,cp=a,zr=l}JA(r)}else i.subtreeFlags&8772&&s!==null?(s.return=i,be=s):JA(r)}}function JA(r){for(;be!==null;){var e=be;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:zr||em(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!zr)if(t===null)n.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Oi(e.type,t.memoizedProps);n.componentDidUpdate(i,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&RA(e,s,n);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}RA(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var d=l.memoizedState;if(d!==null){var h=d.dehydrated;h!==null&&n1(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ee(163))}zr||e.flags&512&&d6(e)}catch(p){Bt(e,e.return,p)}}if(e===r){be=null;break}if(t=e.sibling,t!==null){t.return=e.return,be=t;break}be=e.return}}function XA(r){for(;be!==null;){var e=be;if(e===r){be=null;break}var t=e.sibling;if(t!==null){t.return=e.return,be=t;break}be=e.return}}function ZA(r){for(;be!==null;){var e=be;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{em(4,e)}catch(c){Bt(e,t,c)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var i=e.return;try{n.componentDidMount()}catch(c){Bt(e,i,c)}}var s=e.return;try{d6(e)}catch(c){Bt(e,s,c)}break;case 5:var o=e.return;try{d6(e)}catch(c){Bt(e,o,c)}}}catch(c){Bt(e,e.return,c)}if(e===r){be=null;break}var a=e.sibling;if(a!==null){a.return=e.return,be=a;break}be=e.return}}var Vq=Math.ceil,gg=_o.ReactCurrentDispatcher,Nv=_o.ReactCurrentOwner,gi=_o.ReactCurrentBatchConfig,Xe=0,nr=null,Kt=null,dr=0,Pn=0,Lu=pc(0),Wt=0,p1=null,vl=0,tm=0,Ov=0,Bf=null,fn=null,Rv=0,vd=1/0,qs=null,yg=!1,p6=null,Fa=null,lp=!1,_a=null,mg=0,Lf=0,g6=null,f2=-1,p2=0;function tn(){return Xe&6?Ut():f2!==-1?f2:f2=Ut()}function za(r){return r.mode&1?Xe&2&&dr!==0?dr&-dr:Cq.transition!==null?(p2===0&&(p2=JN()),p2):(r=lt,r!==0||(r=window.event,r=r===void 0?16:iO(r.type)),r):1}function ji(r,e,t,n){if(50<Lf)throw Lf=0,g6=null,Error(ee(185));s0(r,t,n),(!(Xe&2)||r!==nr)&&(r===nr&&(!(Xe&2)&&(tm|=t),Wt===4&&Ea(r,dr)),wn(r,n),t===1&&Xe===0&&!(e.mode&1)&&(vd=Ut()+500,J3&&gc()))}function wn(r,e){var t=r.callbackNode;CH(r,e);var n=eg(r,r===nr?dr:0);if(n===0)t!==null&&cA(t),r.callbackNode=null,r.callbackPriority=0;else if(e=n&-n,r.callbackPriority!==e){if(t!=null&&cA(t),e===1)r.tag===0?Aq(eC.bind(null,r)):SO(eC.bind(null,r)),vq(function(){!(Xe&6)&&gc()}),t=null;else{switch(XN(n)){case 1:t=av;break;case 4:t=QN;break;case 16:t=Z2;break;case 536870912:t=YN;break;default:t=Z2}t=ER(t,pR.bind(null,r))}r.callbackPriority=e,r.callbackNode=t}}function pR(r,e){if(f2=-1,p2=0,Xe&6)throw Error(ee(327));var t=r.callbackNode;if(Wu()&&r.callbackNode!==t)return null;var n=eg(r,r===nr?dr:0);if(n===0)return null;if(n&30||n&r.expiredLanes||e)e=wg(r,n);else{e=n;var i=Xe;Xe|=2;var s=yR();(nr!==r||dr!==e)&&(qs=null,vd=Ut()+500,sl(r,e));do try{Hq();break}catch(a){gR(r,a)}while(!0);vv(),gg.current=s,Xe=i,Kt!==null?e=0:(nr=null,dr=0,e=Wt)}if(e!==0){if(e===2&&(i=V5(r),i!==0&&(n=i,e=y6(r,i))),e===1)throw t=p1,sl(r,0),Ea(r,n),wn(r,Ut()),t;if(e===6)Ea(r,n);else{if(i=r.current.alternate,!(n&30)&&!Kq(i)&&(e=wg(r,n),e===2&&(s=V5(r),s!==0&&(n=s,e=y6(r,s))),e===1))throw t=p1,sl(r,0),Ea(r,n),wn(r,Ut()),t;switch(r.finishedWork=i,r.finishedLanes=n,e){case 0:case 1:throw Error(ee(345));case 2:Uc(r,fn,qs);break;case 3:if(Ea(r,n),(n&130023424)===n&&(e=Rv+500-Ut(),10<e)){if(eg(r,0)!==0)break;if(i=r.suspendedLanes,(i&n)!==n){tn(),r.pingedLanes|=r.suspendedLanes&i;break}r.timeoutHandle=Y5(Uc.bind(null,r,fn,qs),e);break}Uc(r,fn,qs);break;case 4:if(Ea(r,n),(n&4194240)===n)break;for(e=r.eventTimes,i=-1;0<n;){var o=31-Ki(n);s=1<<o,o=e[o],o>i&&(i=o),n&=~s}if(n=i,n=Ut()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Vq(n/1960))-n,10<n){r.timeoutHandle=Y5(Uc.bind(null,r,fn,qs),n);break}Uc(r,fn,qs);break;case 5:Uc(r,fn,qs);break;default:throw Error(ee(329))}}}return wn(r,Ut()),r.callbackNode===t?pR.bind(null,r):null}function y6(r,e){var t=Bf;return r.current.memoizedState.isDehydrated&&(sl(r,e).flags|=256),r=wg(r,e),r!==2&&(e=fn,fn=t,e!==null&&m6(e)),r}function m6(r){fn===null?fn=r:fn.push.apply(fn,r)}function Kq(r){for(var e=r;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var i=t[n],s=i.getSnapshot;i=i.value;try{if(!Gi(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ea(r,e){for(e&=~Ov,e&=~tm,r.suspendedLanes|=e,r.pingedLanes&=~e,r=r.expirationTimes;0<e;){var t=31-Ki(e),n=1<<t;r[t]=-1,e&=~n}}function eC(r){if(Xe&6)throw Error(ee(327));Wu();var e=eg(r,0);if(!(e&1))return wn(r,Ut()),null;var t=wg(r,e);if(r.tag!==0&&t===2){var n=V5(r);n!==0&&(e=n,t=y6(r,n))}if(t===1)throw t=p1,sl(r,0),Ea(r,e),wn(r,Ut()),t;if(t===6)throw Error(ee(345));return r.finishedWork=r.current.alternate,r.finishedLanes=e,Uc(r,fn,qs),wn(r,Ut()),null}function Bv(r,e){var t=Xe;Xe|=1;try{return r(e)}finally{Xe=t,Xe===0&&(vd=Ut()+500,J3&&gc())}}function El(r){_a!==null&&_a.tag===0&&!(Xe&6)&&Wu();var e=Xe;Xe|=1;var t=gi.transition,n=lt;try{if(gi.transition=null,lt=1,r)return r()}finally{lt=n,gi.transition=t,Xe=e,!(Xe&6)&&gc()}}function Lv(){Pn=Lu.current,Et(Lu)}function sl(r,e){r.finishedWork=null,r.finishedLanes=0;var t=r.timeoutHandle;if(t!==-1&&(r.timeoutHandle=-1,bq(t)),Kt!==null)for(t=Kt.return;t!==null;){var n=t;switch(mv(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&sg();break;case 3:wd(),Et(yn),Et(qr),kv();break;case 5:Cv(n);break;case 4:wd();break;case 13:Et(Pt);break;case 19:Et(Pt);break;case 10:Ev(n.type._context);break;case 22:case 23:Lv()}t=t.return}if(nr=r,Kt=r=Va(r.current,null),dr=Pn=e,Wt=0,p1=null,Ov=tm=vl=0,fn=Bf=null,Gc!==null){for(e=0;e<Gc.length;e++)if(t=Gc[e],n=t.interleaved,n!==null){t.interleaved=null;var i=n.next,s=t.pending;if(s!==null){var o=s.next;s.next=i,n.next=o}t.pending=n}Gc=null}return r}function gR(r,e){do{var t=Kt;try{if(vv(),u2.current=pg,fg){for(var n=Nt.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}fg=!1}if(bl=0,tr=qt=Nt=null,Of=!1,d1=0,Nv.current=null,t===null||t.return===null){Wt=1,p1=e,Kt=null;break}e:{var s=r,o=t.return,a=t,c=e;if(e=dr,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,d=a,h=d.tag;if(!(d.mode&1)&&(h===0||h===11||h===15)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var b=zA(o);if(b!==null){b.flags&=-257,VA(b,o,a,s,e),b.mode&1&&FA(s,l,e),e=b,c=l;var f=e.updateQueue;if(f===null){var g=new Set;g.add(c),e.updateQueue=g}else f.add(c);break e}else{if(!(e&1)){FA(s,l,e),Mv();break e}c=Error(ee(426))}}else if(kt&&a.mode&1){var v=zA(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),VA(v,o,a,s,e),wv(bd(c,a));break e}}s=c=bd(c,a),Wt!==4&&(Wt=2),Bf===null?Bf=[s]:Bf.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var y=XO(s,c,e);OA(s,y);break e;case 1:a=c;var w=s.type,m=s.stateNode;if(!(s.flags&128)&&(typeof w.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Fa===null||!Fa.has(m)))){s.flags|=65536,e&=-e,s.lanes|=e;var E=ZO(s,a,e);OA(s,E);break e}}s=s.return}while(s!==null)}wR(t)}catch(C){e=C,Kt===t&&t!==null&&(Kt=t=t.return);continue}break}while(!0)}function yR(){var r=gg.current;return gg.current=pg,r===null?pg:r}function Mv(){(Wt===0||Wt===3||Wt===2)&&(Wt=4),nr===null||!(vl&268435455)&&!(tm&268435455)||Ea(nr,dr)}function wg(r,e){var t=Xe;Xe|=2;var n=yR();(nr!==r||dr!==e)&&(qs=null,sl(r,e));do try{jq();break}catch(i){gR(r,i)}while(!0);if(vv(),Xe=t,gg.current=n,Kt!==null)throw Error(ee(261));return nr=null,dr=0,Wt}function jq(){for(;Kt!==null;)mR(Kt)}function Hq(){for(;Kt!==null&&!yH();)mR(Kt)}function mR(r){var e=vR(r.alternate,r,Pn);r.memoizedProps=r.pendingProps,e===null?wR(r):Kt=e,Nv.current=null}function wR(r){var e=r;do{var t=e.alternate;if(r=e.return,e.flags&32768){if(t=Mq(t,e),t!==null){t.flags&=32767,Kt=t;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{Wt=6,Kt=null;return}}else if(t=Lq(t,e,Pn),t!==null){Kt=t;return}if(e=e.sibling,e!==null){Kt=e;return}Kt=e=r}while(e!==null);Wt===0&&(Wt=5)}function Uc(r,e,t){var n=lt,i=gi.transition;try{gi.transition=null,lt=1,qq(r,e,t,n)}finally{gi.transition=i,lt=n}return null}function qq(r,e,t,n){do Wu();while(_a!==null);if(Xe&6)throw Error(ee(327));t=r.finishedWork;var i=r.finishedLanes;if(t===null)return null;if(r.finishedWork=null,r.finishedLanes=0,t===r.current)throw Error(ee(177));r.callbackNode=null,r.callbackPriority=0;var s=t.lanes|t.childLanes;if(kH(r,s),r===nr&&(Kt=nr=null,dr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||lp||(lp=!0,ER(Z2,function(){return Wu(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=gi.transition,gi.transition=null;var o=lt;lt=1;var a=Xe;Xe|=4,Nv.current=null,Fq(r,t),hR(t,r),hq(G5),tg=!!W5,G5=W5=null,r.current=t,zq(t),mH(),Xe=a,lt=o,gi.transition=s}else r.current=t;if(lp&&(lp=!1,_a=r,mg=i),s=r.pendingLanes,s===0&&(Fa=null),vH(t.stateNode),wn(r,Ut()),e!==null)for(n=r.onRecoverableError,t=0;t<e.length;t++)i=e[t],n(i.value,{componentStack:i.stack,digest:i.digest});if(yg)throw yg=!1,r=p6,p6=null,r;return mg&1&&r.tag!==0&&Wu(),s=r.pendingLanes,s&1?r===g6?Lf++:(Lf=0,g6=r):Lf=0,gc(),null}function Wu(){if(_a!==null){var r=XN(mg),e=gi.transition,t=lt;try{if(gi.transition=null,lt=16>r?16:r,_a===null)var n=!1;else{if(r=_a,_a=null,mg=0,Xe&6)throw Error(ee(331));var i=Xe;for(Xe|=4,be=r.current;be!==null;){var s=be,o=s.child;if(be.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(be=l;be!==null;){var d=be;switch(d.tag){case 0:case 11:case 15:Rf(8,d,s)}var h=d.child;if(h!==null)h.return=d,be=h;else for(;be!==null;){d=be;var p=d.sibling,b=d.return;if(lR(d),d===l){be=null;break}if(p!==null){p.return=b,be=p;break}be=b}}}var f=s.alternate;if(f!==null){var g=f.child;if(g!==null){f.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(g!==null)}}be=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,be=o;else e:for(;be!==null;){if(s=be,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Rf(9,s,s.return)}var y=s.sibling;if(y!==null){y.return=s.return,be=y;break e}be=s.return}}var w=r.current;for(be=w;be!==null;){o=be;var m=o.child;if(o.subtreeFlags&2064&&m!==null)m.return=o,be=m;else e:for(o=w;be!==null;){if(a=be,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:em(9,a)}}catch(C){Bt(a,a.return,C)}if(a===o){be=null;break e}var E=a.sibling;if(E!==null){E.return=a.return,be=E;break e}be=a.return}}if(Xe=i,gc(),bs&&typeof bs.onPostCommitFiberRoot=="function")try{bs.onPostCommitFiberRoot(q3,r)}catch{}n=!0}return n}finally{lt=t,gi.transition=e}}return!1}function tC(r,e,t){e=bd(t,e),e=XO(r,e,1),r=Ua(r,e,1),e=tn(),r!==null&&(s0(r,1,e),wn(r,e))}function Bt(r,e,t){if(r.tag===3)tC(r,r,t);else for(;e!==null;){if(e.tag===3){tC(e,r,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Fa===null||!Fa.has(n))){r=bd(t,r),r=ZO(e,r,1),e=Ua(e,r,1),r=tn(),e!==null&&(s0(e,1,r),wn(e,r));break}}e=e.return}}function Wq(r,e,t){var n=r.pingCache;n!==null&&n.delete(e),e=tn(),r.pingedLanes|=r.suspendedLanes&t,nr===r&&(dr&t)===t&&(Wt===4||Wt===3&&(dr&130023424)===dr&&500>Ut()-Rv?sl(r,0):Ov|=t),wn(r,e)}function bR(r,e){e===0&&(r.mode&1?(e=Z0,Z0<<=1,!(Z0&130023424)&&(Z0=4194304)):e=1);var t=tn();r=wo(r,e),r!==null&&(s0(r,e,t),wn(r,t))}function Gq(r){var e=r.memoizedState,t=0;e!==null&&(t=e.retryLane),bR(r,t)}function Qq(r,e){var t=0;switch(r.tag){case 13:var n=r.stateNode,i=r.memoizedState;i!==null&&(t=i.retryLane);break;case 19:n=r.stateNode;break;default:throw Error(ee(314))}n!==null&&n.delete(e),bR(r,t)}var vR;vR=function(r,e,t){if(r!==null)if(r.memoizedProps!==e.pendingProps||yn.current)pn=!0;else{if(!(r.lanes&t)&&!(e.flags&128))return pn=!1,Bq(r,e,t);pn=!!(r.flags&131072)}else pn=!1,kt&&e.flags&1048576&&AO(e,cg,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;h2(r,e),r=e.pendingProps;var i=gd(e,qr.current);qu(e,t),i=_v(null,e,n,r,i,t);var s=Tv();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,mn(n)?(s=!0,og(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Sv(e),i.updater=Z3,e.stateNode=i,i._reactInternals=e,n6(e,n,r,t),e=o6(null,e,n,!0,s,t)):(e.tag=0,kt&&s&&yv(e),Yr(null,e,i,t),e=e.child),e;case 16:n=e.elementType;e:{switch(h2(r,e),r=e.pendingProps,i=n._init,n=i(n._payload),e.type=n,i=e.tag=Jq(n),r=Oi(n,r),i){case 0:e=s6(null,e,n,r,t);break e;case 1:e=HA(null,e,n,r,t);break e;case 11:e=KA(null,e,n,r,t);break e;case 14:e=jA(null,e,n,Oi(n.type,r),t);break e}throw Error(ee(306,n,""))}return e;case 0:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Oi(n,i),s6(r,e,n,i,t);case 1:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Oi(n,i),HA(r,e,n,i,t);case 3:e:{if(nR(e),r===null)throw Error(ee(387));n=e.pendingProps,s=e.memoizedState,i=s.element,$O(r,e),dg(e,n,null,t);var o=e.memoizedState;if(n=o.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=bd(Error(ee(423)),e),e=qA(r,e,n,t,i);break e}else if(n!==i){i=bd(Error(ee(424)),e),e=qA(r,e,n,t,i);break e}else for(Ln=Ma(e.stateNode.containerInfo.firstChild),Mn=e,kt=!0,Mi=null,t=_O(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(yd(),n===i){e=bo(r,e,t);break e}Yr(r,e,n,t)}e=e.child}return e;case 5:return PO(e),r===null&&e6(e),n=e.type,i=e.pendingProps,s=r!==null?r.memoizedProps:null,o=i.children,Q5(n,i)?o=null:s!==null&&Q5(n,s)&&(e.flags|=32),rR(r,e),Yr(r,e,o,t),e.child;case 6:return r===null&&e6(e),null;case 13:return iR(r,e,t);case 4:return Av(e,e.stateNode.containerInfo),n=e.pendingProps,r===null?e.child=md(e,null,n,t):Yr(r,e,n,t),e.child;case 11:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Oi(n,i),KA(r,e,n,i,t);case 7:return Yr(r,e,e.pendingProps,t),e.child;case 8:return Yr(r,e,e.pendingProps.children,t),e.child;case 12:return Yr(r,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,yt(lg,n._currentValue),n._currentValue=o,s!==null)if(Gi(s.value,o)){if(s.children===i.children&&!yn.current){e=bo(r,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===n){if(s.tag===1){c=co(-1,t&-t),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var d=l.pending;d===null?c.next=c:(c.next=d.next,d.next=c),l.pending=c}}s.lanes|=t,c=s.alternate,c!==null&&(c.lanes|=t),t6(s.return,t,e),a.lanes|=t;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(ee(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),t6(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Yr(r,e,i.children,t),e=e.child}return e;case 9:return i=e.type,n=e.pendingProps.children,qu(e,t),i=mi(i),n=n(i),e.flags|=1,Yr(r,e,n,t),e.child;case 14:return n=e.type,i=Oi(n,e.pendingProps),i=Oi(n.type,i),jA(r,e,n,i,t);case 15:return eR(r,e,e.type,e.pendingProps,t);case 17:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Oi(n,i),h2(r,e),e.tag=1,mn(n)?(r=!0,og(e)):r=!1,qu(e,t),JO(e,n,i),n6(e,n,i,t),o6(null,e,n,!0,r,t);case 19:return sR(r,e,t);case 22:return tR(r,e,t)}throw Error(ee(156,e.tag))};function ER(r,e){return GN(r,e)}function Yq(r,e,t,n){this.tag=r,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ui(r,e,t,n){return new Yq(r,e,t,n)}function Uv(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Jq(r){if(typeof r=="function")return Uv(r)?1:0;if(r!=null){if(r=r.$$typeof,r===iv)return 11;if(r===sv)return 14}return 2}function Va(r,e){var t=r.alternate;return t===null?(t=ui(r.tag,e,r.key,r.mode),t.elementType=r.elementType,t.type=r.type,t.stateNode=r.stateNode,t.alternate=r,r.alternate=t):(t.pendingProps=e,t.type=r.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=r.flags&14680064,t.childLanes=r.childLanes,t.lanes=r.lanes,t.child=r.child,t.memoizedProps=r.memoizedProps,t.memoizedState=r.memoizedState,t.updateQueue=r.updateQueue,e=r.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=r.sibling,t.index=r.index,t.ref=r.ref,t}function g2(r,e,t,n,i,s){var o=2;if(n=r,typeof r=="function")Uv(r)&&(o=1);else if(typeof r=="string")o=5;else e:switch(r){case Iu:return ol(t.children,i,s,e);case nv:o=8,i|=8;break;case I5:return r=ui(12,t,e,i|2),r.elementType=I5,r.lanes=s,r;case _5:return r=ui(13,t,e,i),r.elementType=_5,r.lanes=s,r;case T5:return r=ui(19,t,e,i),r.elementType=T5,r.lanes=s,r;case PN:return rm(t,i,s,e);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case TN:o=10;break e;case $N:o=9;break e;case iv:o=11;break e;case sv:o=14;break e;case oa:o=16,n=null;break e}throw Error(ee(130,r==null?r:typeof r,""))}return e=ui(o,t,e,i),e.elementType=r,e.type=n,e.lanes=s,e}function ol(r,e,t,n){return r=ui(7,r,n,e),r.lanes=t,r}function rm(r,e,t,n){return r=ui(22,r,n,e),r.elementType=PN,r.lanes=t,r.stateNode={isHidden:!1},r}function Uw(r,e,t){return r=ui(6,r,null,e),r.lanes=t,r}function Fw(r,e,t){return e=ui(4,r.children!==null?r.children:[],r.key,e),e.lanes=t,e.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},e}function Xq(r,e,t,n,i){this.tag=e,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vw(0),this.expirationTimes=vw(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vw(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Fv(r,e,t,n,i,s,o,a,c){return r=new Xq(r,e,t,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=ui(3,null,null,e),r.current=s,s.stateNode=r,s.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Sv(s),r}function Zq(r,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ku,key:n==null?null:""+n,children:r,containerInfo:e,implementation:t}}function xR(r){if(!r)return Xa;r=r._reactInternals;e:{if(Gl(r)!==r||r.tag!==1)throw Error(ee(170));var e=r;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(mn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ee(171))}if(r.tag===1){var t=r.type;if(mn(t))return xO(r,t,e)}return e}function SR(r,e,t,n,i,s,o,a,c){return r=Fv(t,n,!0,r,i,s,o,a,c),r.context=xR(null),t=r.current,n=tn(),i=za(t),s=co(n,i),s.callback=e??null,Ua(t,s,i),r.current.lanes=i,s0(r,i,n),wn(r,n),r}function nm(r,e,t,n){var i=e.current,s=tn(),o=za(i);return t=xR(t),e.context===null?e.context=t:e.pendingContext=t,e=co(s,o),e.payload={element:r},n=n===void 0?null:n,n!==null&&(e.callback=n),r=Ua(i,e,o),r!==null&&(ji(r,i,o,s),l2(r,i,o)),o}function bg(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function rC(r,e){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var t=r.retryLane;r.retryLane=t!==0&&t<e?t:e}}function zv(r,e){rC(r,e),(r=r.alternate)&&rC(r,e)}function eW(){return null}var AR=typeof reportError=="function"?reportError:function(r){console.error(r)};function Vv(r){this._internalRoot=r}im.prototype.render=Vv.prototype.render=function(r){var e=this._internalRoot;if(e===null)throw Error(ee(409));nm(r,e,null,null)};im.prototype.unmount=Vv.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var e=r.containerInfo;El(function(){nm(null,r,null,null)}),e[mo]=null}};function im(r){this._internalRoot=r}im.prototype.unstable_scheduleHydration=function(r){if(r){var e=tO();r={blockedOn:null,target:r,priority:e};for(var t=0;t<va.length&&e!==0&&e<va[t].priority;t++);va.splice(t,0,r),t===0&&nO(r)}};function Kv(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function sm(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function nC(){}function tW(r,e,t,n,i){if(i){if(typeof n=="function"){var s=n;n=function(){var l=bg(o);s.call(l)}}var o=SR(e,n,r,0,null,!1,!1,"",nC);return r._reactRootContainer=o,r[mo]=o.current,o1(r.nodeType===8?r.parentNode:r),El(),o}for(;i=r.lastChild;)r.removeChild(i);if(typeof n=="function"){var a=n;n=function(){var l=bg(c);a.call(l)}}var c=Fv(r,0,!1,null,null,!1,!1,"",nC);return r._reactRootContainer=c,r[mo]=c.current,o1(r.nodeType===8?r.parentNode:r),El(function(){nm(e,c,t,n)}),c}function om(r,e,t,n,i){var s=t._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var c=bg(o);a.call(c)}}nm(e,o,r,i)}else o=tW(t,e,r,i,n);return bg(o)}ZN=function(r){switch(r.tag){case 3:var e=r.stateNode;if(e.current.memoizedState.isDehydrated){var t=mf(e.pendingLanes);t!==0&&(cv(e,t|1),wn(e,Ut()),!(Xe&6)&&(vd=Ut()+500,gc()))}break;case 13:El(function(){var n=wo(r,1);if(n!==null){var i=tn();ji(n,r,1,i)}}),zv(r,1)}};lv=function(r){if(r.tag===13){var e=wo(r,134217728);if(e!==null){var t=tn();ji(e,r,134217728,t)}zv(r,134217728)}};eO=function(r){if(r.tag===13){var e=za(r),t=wo(r,e);if(t!==null){var n=tn();ji(t,r,e,n)}zv(r,e)}};tO=function(){return lt};rO=function(r,e){var t=lt;try{return lt=r,e()}finally{lt=t}};U5=function(r,e,t){switch(e){case"input":if(D5(r,t),e=t.name,t.type==="radio"&&e!=null){for(t=r;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==r&&n.form===r.form){var i=Y3(n);if(!i)throw Error(ee(90));NN(n),D5(n,i)}}}break;case"textarea":RN(r,t);break;case"select":e=t.value,e!=null&&Vu(r,!!t.multiple,e,!1)}};VN=Bv;KN=El;var rW={usingClientEntryPoint:!1,Events:[a0,Pu,Y3,FN,zN,Bv]},Lh={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nW={bundleType:Lh.bundleType,version:Lh.version,rendererPackageName:Lh.rendererPackageName,rendererConfig:Lh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_o.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=qN(r),r===null?null:r.stateNode},findFiberByHostInstance:Lh.findFiberByHostInstance||eW,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var up=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!up.isDisabled&&up.supportsFiber)try{q3=up.inject(nW),bs=up}catch{}}Kn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=rW;Kn.createPortal=function(r,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Kv(e))throw Error(ee(200));return Zq(r,e,null,t)};Kn.createRoot=function(r,e){if(!Kv(r))throw Error(ee(299));var t=!1,n="",i=AR;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Fv(r,1,!1,null,null,t,!1,n,i),r[mo]=e.current,o1(r.nodeType===8?r.parentNode:r),new Vv(e)};Kn.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var e=r._reactInternals;if(e===void 0)throw typeof r.render=="function"?Error(ee(188)):(r=Object.keys(r).join(","),Error(ee(268,r)));return r=qN(e),r=r===null?null:r.stateNode,r};Kn.flushSync=function(r){return El(r)};Kn.hydrate=function(r,e,t){if(!sm(e))throw Error(ee(200));return om(null,r,e,!0,t)};Kn.hydrateRoot=function(r,e,t){if(!Kv(r))throw Error(ee(405));var n=t!=null&&t.hydratedSources||null,i=!1,s="",o=AR;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=SR(e,null,r,1,t??null,i,!1,s,o),r[mo]=e.current,o1(r),n)for(r=0;r<n.length;r++)t=n[r],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new im(e)};Kn.render=function(r,e,t){if(!sm(e))throw Error(ee(200));return om(null,r,e,!1,t)};Kn.unmountComponentAtNode=function(r){if(!sm(r))throw Error(ee(40));return r._reactRootContainer?(El(function(){om(null,null,r,!1,function(){r._reactRootContainer=null,r[mo]=null})}),!0):!1};Kn.unstable_batchedUpdates=Bv;Kn.unstable_renderSubtreeIntoContainer=function(r,e,t,n){if(!sm(t))throw Error(ee(200));if(r==null||r._reactInternals===void 0)throw Error(ee(38));return om(r,e,t,!1,n)};Kn.version="18.3.1-next-f1338f8080-20240426";function CR(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(CR)}catch(r){console.error(r)}}CR(),CN.exports=Kn;var iW=CN.exports,iC=iW;C5.createRoot=iC.createRoot,C5.hydrateRoot=iC.hydrateRoot;var kR={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(c,l,d){this.fn=c,this.context=l,this.once=d||!1}function s(c,l,d,h,p){if(typeof d!="function")throw new TypeError("The listener must be a function");var b=new i(d,h||c,p),f=t?t+l:l;return c._events[f]?c._events[f].fn?c._events[f]=[c._events[f],b]:c._events[f].push(b):(c._events[f]=b,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new n:delete c._events[l]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],d,h;if(this._eventsCount===0)return l;for(h in d=this._events)e.call(d,h)&&l.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},a.prototype.listeners=function(l){var d=t?t+l:l,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var p=0,b=h.length,f=new Array(b);p<b;p++)f[p]=h[p].fn;return f},a.prototype.listenerCount=function(l){var d=t?t+l:l,h=this._events[d];return h?h.fn?1:h.length:0},a.prototype.emit=function(l,d,h,p,b,f){var g=t?t+l:l;if(!this._events[g])return!1;var v=this._events[g],y=arguments.length,w,m;if(v.fn){switch(v.once&&this.removeListener(l,v.fn,void 0,!0),y){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,d),!0;case 3:return v.fn.call(v.context,d,h),!0;case 4:return v.fn.call(v.context,d,h,p),!0;case 5:return v.fn.call(v.context,d,h,p,b),!0;case 6:return v.fn.call(v.context,d,h,p,b,f),!0}for(m=1,w=new Array(y-1);m<y;m++)w[m-1]=arguments[m];v.fn.apply(v.context,w)}else{var E=v.length,C;for(m=0;m<E;m++)switch(v[m].once&&this.removeListener(l,v[m].fn,void 0,!0),y){case 1:v[m].fn.call(v[m].context);break;case 2:v[m].fn.call(v[m].context,d);break;case 3:v[m].fn.call(v[m].context,d,h);break;case 4:v[m].fn.call(v[m].context,d,h,p);break;default:if(!w)for(C=1,w=new Array(y-1);C<y;C++)w[C-1]=arguments[C];v[m].fn.apply(v[m].context,w)}}return!0},a.prototype.on=function(l,d,h){return s(this,l,d,h,!1)},a.prototype.once=function(l,d,h){return s(this,l,d,h,!0)},a.prototype.removeListener=function(l,d,h,p){var b=t?t+l:l;if(!this._events[b])return this;if(!d)return o(this,b),this;var f=this._events[b];if(f.fn)f.fn===d&&(!p||f.once)&&(!h||f.context===h)&&o(this,b);else{for(var g=0,v=[],y=f.length;g<y;g++)(f[g].fn!==d||p&&!f[g].once||h&&f[g].context!==h)&&v.push(f[g]);v.length?this._events[b]=v.length===1?v[0]:v:o(this,b)}return this},a.prototype.removeAllListeners=function(l){var d;return l?(d=t?t+l:l,this._events[d]&&o(this,d)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a})(kR);var sW=kR.exports;const g1=hc(sW),oW=Object.freeze(Object.defineProperty({__proto__:null,EventEmitter:g1,default:g1},Symbol.toStringTag,{value:"Module"}));let IR=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},aW=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const sC=r=>globalThis.DOMException===void 0?new aW(r):new DOMException(r),oC=r=>{const e=r.reason===void 0?sC("This operation was aborted."):r.reason;return e instanceof Error?e:sC(e)};function l0(r,e){const{milliseconds:t,fallback:n,message:i,customTimers:s={setTimeout,clearTimeout}}=e;let o,a;const l=new Promise((d,h)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:b}=e;b.aborted&&h(oC(b)),a=()=>{h(oC(b))},b.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){r.then(d,h);return}const p=new IR;o=s.setTimeout.call(void 0,()=>{if(n){try{d(n())}catch(b){h(b)}return}typeof r.cancel=="function"&&r.cancel(),i===!1?d():i instanceof Error?h(i):(p.message=i??`Promise timed out after ${t} milliseconds`,h(p))},t),(async()=>{try{d(await r)}catch(b){h(b)}})()}).finally(()=>{l.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return l.clear=()=>{s.clearTimeout.call(void 0,o),o=void 0},l}function cW(r,e,t){let n=0,i=r.length;for(;i>0;){const s=Math.trunc(i/2);let o=n+s;t(r[o],e)<=0?(n=++o,i-=s+1):i=s}return n}var ri,WP;let lW=(WP=class{constructor(){qe(this,ri,[])}enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,id:t.id,run:e};if(this.size===0||ie(this,ri)[this.size-1].priority>=t.priority){ie(this,ri).push(n);return}const i=cW(ie(this,ri),n,(s,o)=>o.priority-s.priority);ie(this,ri).splice(i,0,n)}setPriority(e,t){const n=ie(this,ri).findIndex(s=>s.id===e);if(n===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[i]=ie(this,ri).splice(n,1);this.enqueue(i.run,{priority:t,id:e})}dequeue(){const e=ie(this,ri).shift();return e==null?void 0:e.run}filter(e){return ie(this,ri).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return ie(this,ri).length}},ri=new WeakMap,WP);var id,sd,Ca,J1,od,X1,ni,ad,Qr,Z1,ii,cd,to,e0,V3,rt,_R,TR,$R,PR,DR,y2,w6,b6,m2,NR,w2;class Za extends g1{constructor(t){var n,i;super();qe(this,rt);qe(this,id);qe(this,sd);qe(this,Ca,0);qe(this,J1);qe(this,od);qe(this,X1,0);qe(this,ni);qe(this,ad);qe(this,Qr);qe(this,Z1);qe(this,ii,0);qe(this,cd);qe(this,to);qe(this,e0);qe(this,V3,1n);u(this,"timeout");if(t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:lW,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((n=t.intervalCap)==null?void 0:n.toString())??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((i=t.interval)==null?void 0:i.toString())??""}\` (${typeof t.interval})`);dt(this,id,t.carryoverConcurrencyCount),dt(this,sd,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),dt(this,J1,t.intervalCap),dt(this,od,t.interval),dt(this,Qr,new t.queueClass),dt(this,Z1,t.queueClass),this.concurrency=t.concurrency,this.timeout=t.timeout,dt(this,e0,t.throwOnTimeout===!0),dt(this,to,t.autoStart===!1)}get concurrency(){return ie(this,cd)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);dt(this,cd,t),Ae(this,rt,m2).call(this)}setPriority(t,n){ie(this,Qr).setPriority(t,n)}async add(t,n={}){return n.id??(n.id=(ns(this,V3)._++).toString()),n={timeout:this.timeout,throwOnTimeout:ie(this,e0),...n},new Promise((i,s)=>{ie(this,Qr).enqueue(async()=>{var o;ns(this,ii)._++,ns(this,Ca)._++;try{(o=n.signal)==null||o.throwIfAborted();let a=t({signal:n.signal});n.timeout&&(a=l0(Promise.resolve(a),{milliseconds:n.timeout})),n.signal&&(a=Promise.race([a,Ae(this,rt,NR).call(this,n.signal)]));const c=await a;i(c),this.emit("completed",c)}catch(a){if(a instanceof IR&&!n.throwOnTimeout){i();return}s(a),this.emit("error",a)}finally{Ae(this,rt,$R).call(this)}},n),this.emit("add"),Ae(this,rt,y2).call(this)})}async addAll(t,n){return Promise.all(t.map(async i=>this.add(i,n)))}start(){return ie(this,to)?(dt(this,to,!1),Ae(this,rt,m2).call(this),this):this}pause(){dt(this,to,!0)}clear(){dt(this,Qr,new(ie(this,Z1)))}async onEmpty(){ie(this,Qr).size!==0&&await Ae(this,rt,w2).call(this,"empty")}async onSizeLessThan(t){ie(this,Qr).size<t||await Ae(this,rt,w2).call(this,"next",()=>ie(this,Qr).size<t)}async onIdle(){ie(this,ii)===0&&ie(this,Qr).size===0||await Ae(this,rt,w2).call(this,"idle")}get size(){return ie(this,Qr).size}sizeBy(t){return ie(this,Qr).filter(t).length}get pending(){return ie(this,ii)}get isPaused(){return ie(this,to)}}id=new WeakMap,sd=new WeakMap,Ca=new WeakMap,J1=new WeakMap,od=new WeakMap,X1=new WeakMap,ni=new WeakMap,ad=new WeakMap,Qr=new WeakMap,Z1=new WeakMap,ii=new WeakMap,cd=new WeakMap,to=new WeakMap,e0=new WeakMap,V3=new WeakMap,rt=new WeakSet,_R=function(){return ie(this,sd)||ie(this,Ca)<ie(this,J1)},TR=function(){return ie(this,ii)<ie(this,cd)},$R=function(){ns(this,ii)._--,Ae(this,rt,y2).call(this),this.emit("next")},PR=function(){Ae(this,rt,b6).call(this),Ae(this,rt,w6).call(this),dt(this,ad,void 0)},DR=function(){const t=Date.now();if(ie(this,ni)===void 0){const n=ie(this,X1)-t;if(n<0)dt(this,Ca,ie(this,id)?ie(this,ii):0);else return ie(this,ad)===void 0&&dt(this,ad,setTimeout(()=>{Ae(this,rt,PR).call(this)},n)),!0}return!1},y2=function(){if(ie(this,Qr).size===0)return ie(this,ni)&&clearInterval(ie(this,ni)),dt(this,ni,void 0),this.emit("empty"),ie(this,ii)===0&&this.emit("idle"),!1;if(!ie(this,to)){const t=!ie(this,rt,DR);if(ie(this,rt,_R)&&ie(this,rt,TR)){const n=ie(this,Qr).dequeue();return n?(this.emit("active"),n(),t&&Ae(this,rt,w6).call(this),!0):!1}}return!1},w6=function(){ie(this,sd)||ie(this,ni)!==void 0||(dt(this,ni,setInterval(()=>{Ae(this,rt,b6).call(this)},ie(this,od))),dt(this,X1,Date.now()+ie(this,od)))},b6=function(){ie(this,Ca)===0&&ie(this,ii)===0&&ie(this,ni)&&(clearInterval(ie(this,ni)),dt(this,ni,void 0)),dt(this,Ca,ie(this,id)?ie(this,ii):0),Ae(this,rt,m2).call(this)},m2=function(){for(;Ae(this,rt,y2).call(this););},NR=async function(t){return new Promise((n,i)=>{t.addEventListener("abort",()=>{i(t.reason)},{once:!0})})},w2=async function(t,n){return new Promise(i=>{const s=()=>{n&&!n()||(this.off(t,s),i())};this.on(t,s)})};function De(){const r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}class aC{constructor(e){u(this,"buffer");u(this,"mask");u(this,"top");u(this,"btm");u(this,"next");if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class zw{constructor(e={}){u(this,"size");u(this,"hwm");u(this,"head");u(this,"tail");this.hwm=e.splitLimit??16,this.head=new aC(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new aC(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let uW=class extends Error{constructor(t,n){super(t??"The operation was aborted");u(this,"type");u(this,"code");this.type="aborted",this.code=n??"ABORT_ERR"}};function sh(r={}){return dW(t=>{const n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function dW(r,e){e=e??{};let t=e.onEnd,n=new zw,i,s,o,a=De();const c=async()=>{try{return n.isEmpty()?o?{done:!0}:await new Promise((v,y)=>{s=w=>{s=null,n.push(w);try{v(r(n))}catch(m){y(m)}return i}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=De()})}},l=v=>s!=null?s(v):(n.push(v),i),d=v=>(n=new zw,s!=null?s({error:v}):(n.push({error:v}),i)),h=v=>{if(o)return i;if((e==null?void 0:e.objectMode)!==!0&&(v==null?void 0:v.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:v})},p=v=>o?i:(o=!0,v!=null?d(v):l({done:!0})),b=()=>(n=new zw,p(),{done:!0}),f=v=>(p(v),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:c,return:b,throw:f,push:h,end:p,get readableLength(){return n.size},onEmpty:async v=>{const y=v==null?void 0:v.signal;if(y==null||y.throwIfAborted(),n.isEmpty())return;let w,m;y!=null&&(w=new Promise((E,C)=>{m=()=>{C(new uW)},y.addEventListener("abort",m)}));try{await Promise.race([a.promise,w])}finally{m!=null&&y!=null&&(y==null||y.removeEventListener("abort",m))}}},t==null)return i;const g=i;return i={[Symbol.asyncIterator](){return this},next(){return g.next()},throw(v){return g.throw(v),t!=null&&(t(v),t=void 0),{done:!0}},return(){return g.return(),t!=null&&(t(),t=void 0),{done:!0}},push:h,end(v){return g.end(v),t!=null&&(t(v),t=void 0),i},get readableLength(){return g.readableLength},onEmpty:v=>g.onEmpty(v)},i}let cC=class extends Error{constructor(t,n,i){super(t??"The operation was aborted");u(this,"type");u(this,"code");this.type="aborted",this.name=i??"AbortError",this.code=n??"ABORT_ERR"}};async function Zr(r,e,t){if(e==null)return r;if(e.aborted)return r.catch(()=>{}),Promise.reject(new cC(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName));let n;const i=new cC(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName);try{return await Promise.race([r,new Promise((s,o)=>{n=()=>{o(i)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}}let hW=class{constructor(){u(this,"readNext");u(this,"haveNext");u(this,"ended");u(this,"nextResult");u(this,"error");this.ended=!1,this.readNext=De(),this.haveNext=De()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=De(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=De(),await Zr(this.readNext.promise,t==null?void 0:t.signal,t)}};function fW(){return new hW}function pW(r){return r[Symbol.asyncIterator]!=null}async function gW(r,e){try{await Promise.all(r.map(async t=>{for await(const n of t)await e.push(n)})),await e.end()}catch(t){await e.end(t).catch(()=>{})}}async function*yW(r){const e=fW();gW(r,e).catch(()=>{}),yield*e}function*mW(r){for(const e of r)yield*e}function Ka(...r){const e=[];for(const t of r)pW(t)||e.push(t);return e.length===r.length?mW(e):yW(r)}function Qi(r,...e){if(r==null)throw new Error("Empty pipeline");if(Vw(r)){const n=r;r=()=>n.source}else if(RR(r)||OR(r)){const n=r;r=()=>n}const t=[r,...e];if(t.length>1&&Vw(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)Vw(t[n])&&(t[n]=bW(t[n]));return wW(...t)}const wW=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},OR=r=>(r==null?void 0:r[Symbol.asyncIterator])!=null,RR=r=>(r==null?void 0:r[Symbol.iterator])!=null,Vw=r=>r==null?!1:r.sink!=null&&r.source!=null,bW=r=>e=>{const t=r.sink(e);if((t==null?void 0:t.then)!=null){const n=sh({objectMode:!0});t.then(()=>{n.end()},o=>{n.end(o)});let i;const s=r.source;if(OR(s))i=async function*(){yield*s,n.end()};else if(RR(s))i=function*(){yield*s,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return Ka(n,i())}return r.source};var vW=function(){return Date.now()};const dp=vW;class EW{constructor(e,t,n){const i=this;this._started=dp(),this._rescheduled=0,this._scheduled=t,this._args=n,this._triggered=!1,this._timerWrapper=()=>{i._rescheduled>0?(i._scheduled=i._rescheduled-(dp()-i._started),i._schedule(i._scheduled)):(i._triggered=!0,e.apply(null,i._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);const t=dp();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=dp(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}}function xW(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("timeout needed");let r;if(arguments.length>0){r=new Array(arguments.length-2);for(var e=0;e<r.length;e++)r[e]=arguments[e+2]}return new EW(arguments[0],arguments[1],r)}var SW=xW;const{AbortController:AW}=globalThis,lC=SW;class jv extends AW{constructor(e){super(),this._ms=e,this._timer=lC(()=>this.abort(),e),Object.setPrototypeOf(this,jv.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=lC(()=>this.abort(),this._ms)}}var v6={TimeoutController:jv};const ja=(...r)=>r.join("/").replace(new RegExp("((?<=\\/)\\/+)|(^\\.\\/)|((?<=\\/)\\.\\/)","g"),"")||".",CW=3e4,kW=async({ipfs:r,log:e,events:t,onSynced:n,start:i,timeout:s})=>{if(!r)throw new Error("An instance of ipfs is required.");if(!e)throw new Error("An instance of log is required.");const o=r.libp2p,a=r.libp2p.services.pubsub,c=e.id,l=ja("/orbitdb/heads/",c),d=new Za({concurrency:1}),h=new Set;t=t||new g1,s=s||CW;let p=!1;const b=async A=>{const I=await e.heads();t.emit("join",A,I)},f=A=>async function*(){const I=await e.heads();for await(const{bytes:D}of I)yield D}(),g=A=>async I=>{for await(const D of I){const F=D.subarray();F&&n&&await n(F)}p&&await b(A)},v=async({connection:A,stream:I})=>{const D=String(A.remotePeer);try{h.add(D),await Qi(I,g(D),f,I)}catch(F){h.delete(D),t.emit("error",F)}},y=async A=>{const I=async()=>{const{peerId:D,subscriptions:F}=A.detail,W=String(D),U=F.find(Y=>Y.topic===c);if(U)if(U.subscribe){if(h.has(W))return;const Y=new v6.TimeoutController(s),{signal:j}=Y;try{h.add(W);const H=await o.dialProtocol(D,l,{signal:j});await Qi(f,H,g(W))}catch(H){h.delete(W),H.name==="UnsupportedProtocolError"||t.emit("error",H)}finally{Y&&Y.clear()}}else h.delete(W),t.emit("leave",W)};d.add(I)},w=async A=>{const{topic:I,data:D}=A.detail,F=async()=>{try{D&&n&&await n(D)}catch(W){t.emit("error",W)}};I===c&&d.add(F)},m=async A=>{h.delete(A.detail.toString())},E=async A=>{p&&await a.publish(c,A.bytes)},C=async()=>{p&&(p=!1,await d.onIdle(),a.removeEventListener("subscription-change",y),a.removeEventListener("message",w),await o.unhandle(l),await a.unsubscribe(c),o.removeEventListener("peer:disconnect",m),h.clear())},k=async()=>{p||(await o.handle(l,v),a.addEventListener("subscription-change",y),a.addEventListener("message",w),await a.subscribe(c),o.addEventListener("peer:disconnect",m),p=!0)};return i!==!1&&await k(),{add:E,stop:C,start:k,events:t,peers:h}},BR=Pj(oW);var E6={exports:{}};typeof Object.create=="function"?E6.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:E6.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}};var IW=E6.exports,LR=BR,_W=IW,TW=Fn;function Fn(r){if(!(this instanceof Fn))return new Fn(r);typeof r=="number"&&(r={max:r}),r||(r={}),LR.EventEmitter.call(this),this.cache={},this.head=this.tail=null,this.length=0,this.max=r.max||1e3,this.maxAge=r.maxAge||0}_W(Fn,LR.EventEmitter);Object.defineProperty(Fn.prototype,"keys",{get:function(){return Object.keys(this.cache)}});Fn.prototype.clear=function(){this.cache={},this.head=this.tail=null,this.length=0};Fn.prototype.remove=function(r){if(typeof r!="string"&&(r=""+r),!!this.cache.hasOwnProperty(r)){var e=this.cache[r];return delete this.cache[r],this._unlink(r,e.prev,e.next),e.value}};Fn.prototype._unlink=function(r,e,t){this.length--,this.length===0?this.head=this.tail=null:this.head===r?(this.head=e,this.cache[this.head].next=null):this.tail===r?(this.tail=t,this.cache[this.tail].prev=null):(this.cache[e].next=t,this.cache[t].prev=e)};Fn.prototype.peek=function(r){if(this.cache.hasOwnProperty(r)){var e=this.cache[r];if(this._checkAge(r,e))return e.value}};Fn.prototype.set=function(r,e){typeof r!="string"&&(r=""+r);var t;if(this.cache.hasOwnProperty(r)){if(t=this.cache[r],t.value=e,this.maxAge&&(t.modified=Date.now()),r===this.head)return e;this._unlink(r,t.prev,t.next)}else t={value:e,modified:0,next:null,prev:null},this.maxAge&&(t.modified=Date.now()),this.cache[r]=t,this.length===this.max&&this.evict();return this.length++,t.next=null,t.prev=this.head,this.head&&(this.cache[this.head].next=r),this.head=r,this.tail||(this.tail=r),e};Fn.prototype._checkAge=function(r,e){return this.maxAge&&Date.now()-e.modified>this.maxAge?(this.remove(r),this.emit("evict",{key:r,value:e.value}),!1):!0};Fn.prototype.get=function(r){if(typeof r!="string"&&(r=""+r),!!this.cache.hasOwnProperty(r)){var e=this.cache[r];if(this._checkAge(r,e))return this.head!==r&&(r===this.tail?(this.tail=e.next,this.cache[this.tail].prev=null):this.cache[e.prev].next=e.next,this.cache[e.next].prev=e.prev,this.cache[this.head].next=r,e.prev=this.head,e.next=null,this.head=r),e.value}};Fn.prototype.evict=function(){if(this.tail){var r=this.tail,e=this.remove(this.tail);this.emit("evict",{key:r,value:e})}};const x6=hc(TW),$W=(r,e)=>{const t=r.time-e.time;return t===0&&r.id!==e.id?r.id<e.id?-1:1:t},PW=r=>am(r.id,++r.time),am=(r,e)=>(e=e||0,{id:r,time:e}),DW=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},Hv=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};function NW(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var OW=NW,RW=OW;let BW=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},LW=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return MR(this,e)}},MW=class{constructor(e){this.decoders=e}or(e){return MR(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const MR=(r,e)=>new MW({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let UW=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new BW(e,t,n),this.decoder=new LW(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const UR=({name:r,prefix:e,encode:t,decode:n})=>new UW(r,e,t,n),FR=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:i}=RW(t,e);return UR({prefix:r,name:e,encode:n,decode:s=>Hv(i(s))})},FW=(r,e,t,n)=>{const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},zW=(r,e,t)=>{const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s},To=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>UR({prefix:e,name:r,encode(i){return zW(i,n,t)},decode(i){return FW(i,n,t,r)}}),b2=To({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});To({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});To({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});To({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});To({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});To({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});To({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});To({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});To({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Jr=FR({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});FR({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var VW=zR,uC=128,KW=-128,jW=Math.pow(2,31);function zR(r,e,t){e=e||[],t=t||0;for(var n=t;r>=jW;)e[t++]=r&255|uC,r/=128;for(;r&KW;)e[t++]=r&255|uC,r>>>=7;return e[t]=r|0,zR.bytes=t-n+1,e}var HW=S6,qW=128,dC=127;function S6(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw S6.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&dC)<<i:(o&dC)*Math.pow(2,i),i+=7}while(o>=qW);return S6.bytes=s-n,t}var WW=Math.pow(2,7),GW=Math.pow(2,14),QW=Math.pow(2,21),YW=Math.pow(2,28),JW=Math.pow(2,35),XW=Math.pow(2,42),ZW=Math.pow(2,49),eG=Math.pow(2,56),tG=Math.pow(2,63),rG=function(r){return r<WW?1:r<GW?2:r<QW?3:r<YW?4:r<JW?5:r<XW?6:r<ZW?7:r<eG?8:r<tG?9:10},nG={encode:VW,decode:HW,encodingLength:rG},vg=nG;const A6=(r,e=0)=>[vg.decode(r,e),vg.decode.bytes],Eg=(r,e,t=0)=>(vg.encode(r,e,t),e),xg=r=>vg.encodingLength(r),C6=(r,e)=>{const t=e.byteLength,n=xg(r),i=n+xg(t),s=new Uint8Array(i+t);return Eg(r,s,0),Eg(t,s,n),s.set(e,i),new qv(r,t,e,s)},iG=r=>{const e=Hv(r),[t,n]=A6(e),[i,s]=A6(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new qv(t,i,o,e)},sG=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&DW(r.bytes,t.bytes)}};let qv=class{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}};const hC=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return aG(t,k6(r),e||Jr.encoder);default:return cG(t,k6(r),e||b2.encoder)}},fC=new WeakMap,k6=r=>{const e=fC.get(r);if(e==null){const t=new Map;return fC.set(r,t),t}return e};let Yi=class Cr{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Mh)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==lG)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Cr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=C6(e,t);return Cr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Cr.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&sG(e.multihash,n.multihash)}toString(e){return hC(this,e)}toJSON(){return{"/":hC(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Cr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Cr(n,i,s,o||pC(n,i,s.bytes))}else if(t[uG]===!0){const{version:n,multihash:i,code:s}=t,o=iG(i);return Cr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Mh)throw new Error(`Version 0 CID must use dag-pb (code: ${Mh}) block encoding`);return new Cr(e,t,n,n.bytes)}case 1:{const i=pC(e,t,n.bytes);return new Cr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Cr.create(0,Mh,e)}static createV1(e,t){return Cr.create(1,e,t)}static decode(e){const[t,n]=Cr.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Cr.inspectBytes(e),n=t.size-t.multihashSize,i=Hv(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new qv(t.multihashCode,t.digestSize,s,i);return[t.version===0?Cr.createV0(o):Cr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=A6(e.subarray(t));return t+=p,h};let i=n(),s=Mh;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=oG(e,t),s=Cr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return k6(s).set(n,e),s}};const oG=(r,e)=>{switch(r[0]){case"Q":{const t=e||Jr;return[Jr.prefix,t.decode(`${Jr.prefix}${r}`)]}case Jr.prefix:{const t=e||Jr;return[Jr.prefix,t.decode(r)]}case b2.prefix:{const t=e||b2;return[b2.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},aG=(r,e,t)=>{const{prefix:n}=t;if(n!==Jr.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i},cG=(r,e,t)=>{const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i},Mh=112,lG=18,pC=(r,e,t)=>{const n=xg(r),i=n+xg(e),s=new Uint8Array(i+t.byteLength);return Eg(r,s,0),Eg(e,s,n),s.set(t,i),s},uG=Symbol.for("@ipld/js-cid/CID"),dG=({name:r,code:e,encode:t})=>new hG(r,e,t);let hG=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?C6(this.code,t):t.then(n=>C6(this.code,n))}else throw Error("Unknown type, must be binary type")}};function hp({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*fG(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t],s=Yi.asCID(n);s?yield[i.join("/"),s]:typeof n=="object"&&(yield*I6(n,i))}else{const t=Yi.asCID(e);t?yield[r.join("/"),t]:yield*I6(e,r)}}function*I6(r,e){if(r==null||r instanceof Uint8Array)return;const t=Yi.asCID(r);t&&(yield[e.join("/"),t]);for(const[n,i]of Object.entries(r)){const s=[...e,n];yield*fG(s,i)}}function*pG(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t];yield i.join("/"),typeof n=="object"&&!Yi.asCID(n)&&(yield*_6(n,i))}else yield*_6(e,r)}function*_6(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const i=[...e,t];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!Yi.asCID(n)&&(yield*pG(i,n))}}function gG(r,e){let t=r;for(const[n,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);const s=Yi.asCID(t);if(s)return{value:s,remaining:e.slice(n+1).join("/")}}return{value:t}}let VR=class{constructor({cid:e,bytes:t,value:n}){if(!e||!t||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:hp(),bytes:hp(),value:hp(),asBlock:hp()})}links(){return I6(this.value,[])}tree(){return _6(this.value,[])}get(e="/"){return gG(this.value,e.split("/").filter(Boolean))}};async function oh({value:r,codec:e,hasher:t}){if(typeof r>"u")throw new Error('Missing required argument "value"');if(!e||!t)throw new Error("Missing required argument: codec or hasher");const n=e.encode(r),i=await t.digest(n),s=Yi.create(1,e.code,i);return new VR({value:r,bytes:n,cid:s})}async function cm({bytes:r,codec:e,hasher:t}){if(!r)throw new Error('Missing required argument "bytes"');if(!e||!t)throw new Error("Missing required argument: codec or hasher");const n=e.decode(r),i=await t.digest(r),s=Yi.create(1,e.code,i);return new VR({value:n,bytes:r,cid:s})}const yG=["string","number","bigint","symbol"],mG=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function wG(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";const e=typeof r;if(yG.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(bG(r))return"Buffer";const t=vG(r);return t||"Object"}function bG(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function vG(r){const e=Object.prototype.toString.call(r).slice(8,-1);if(mG.includes(e))return e}class z{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}z.uint=new z(0,"uint",!0);z.negint=new z(1,"negint",!0);z.bytes=new z(2,"bytes",!0);z.string=new z(3,"string",!0);z.array=new z(4,"array",!1);z.map=new z(5,"map",!1);z.tag=new z(6,"tag",!1);z.float=new z(7,"float",!0);z.false=new z(7,"false",!0);z.true=new z(7,"true",!0);z.null=new z(7,"null",!0);z.undefined=new z(7,"undefined",!0);z.break=new z(7,"break",!0);class ne{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const ah=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",EG=new TextDecoder,xG=new TextEncoder;function Sg(r){return ah&&globalThis.Buffer.isBuffer(r)}function Wv(r){return r instanceof Uint8Array?Sg(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}const SG=ah?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):yC(r,e,t):(r,e,t)=>t-e>64?EG.decode(r.subarray(e,t)):yC(r,e,t),KR=ah?r=>r.length>64?globalThis.Buffer.from(r):gC(r):r=>r.length>64?xG.encode(r):gC(r),Ls=r=>Uint8Array.from(r),Gv=ah?(r,e,t)=>Sg(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),AG=ah?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),Wv(globalThis.Buffer.concat(r,e))):(r,e)=>{const t=new Uint8Array(e);let n=0;for(let i of r)n+i.length>t.length&&(i=i.subarray(0,t.length-n)),t.set(i,n),n+=i.length;return t},CG=ah?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function kG(r,e){if(Sg(r)&&Sg(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function gC(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e}function yC(r,e,t){const n=[];for(;e<t;){const i=r[e];let s=null,o=i>239?4:i>223?3:i>191?2:1;if(e+o<=t){let a,c,l,d;switch(o){case 1:i<128&&(s=i);break;case 2:a=r[e+1],(a&192)===128&&(d=(i&31)<<6|a&63,d>127&&(s=d));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(d=(i&15)<<12|(a&63)<<6|c&63,d>2047&&(d<55296||d>57343)&&(s=d));break;case 4:a=r[e+1],c=r[e+2],l=r[e+3],(a&192)===128&&(c&192)===128&&(l&192)===128&&(d=(i&15)<<18|(a&63)<<12|(c&63)<<6|l&63,d>65535&&d<1114112&&(s=d))}}s===null?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|s&1023),n.push(s),e+=o}return jR(n)}const mC=4096;function jR(r){const e=r.length;if(e<=mC)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=mC));return t}const IG=256;class HR{constructor(e=IG){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const i=t.length-(this.maxCursor-this.cursor)-1;t.set(e,i)}else{if(t){const i=t.length-(this.maxCursor-this.cursor)-1;i<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,i),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=CG(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=Gv(n,0,this.cursor)}else t=AG(this.chunks,this.cursor);return e&&this.reset(),t}}const Ce="CBOR decode error:",al="CBOR encode error:";function ch(r,e,t){if(r.length-e<t)throw new Error(`${Ce} not enough data for type`)}const lr=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Ql(r,e,t){ch(r,e,1);const n=r[e];if(t.strict===!0&&n<lr[0])throw new Error(`${Ce} integer encoded in more bytes than necessary (strict decode)`);return n}function Yl(r,e,t){ch(r,e,2);const n=r[e]<<8|r[e+1];if(t.strict===!0&&n<lr[1])throw new Error(`${Ce} integer encoded in more bytes than necessary (strict decode)`);return n}function Jl(r,e,t){ch(r,e,4);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<lr[2])throw new Error(`${Ce} integer encoded in more bytes than necessary (strict decode)`);return n}function Xl(r,e,t){ch(r,e,8);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],i=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],s=(BigInt(n)<<BigInt(32))+BigInt(i);if(t.strict===!0&&s<lr[3])throw new Error(`${Ce} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(t.allowBigInt===!0)return s;throw new Error(`${Ce} integers outside of the safe integer range are not supported`)}function _G(r,e,t,n){return new ne(z.uint,Ql(r,e+1,n),2)}function TG(r,e,t,n){return new ne(z.uint,Yl(r,e+1,n),3)}function $G(r,e,t,n){return new ne(z.uint,Jl(r,e+1,n),5)}function PG(r,e,t,n){return new ne(z.uint,Xl(r,e+1,n),9)}function Zl(r,e){return Ei(r,0,e.value)}function Ei(r,e,t){if(t<lr[0]){const n=Number(t);r.push([e|n])}else if(t<lr[1]){const n=Number(t);r.push([e|24,n])}else if(t<lr[2]){const n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<lr[3]){const n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{const n=BigInt(t);if(n<lr[4]){const i=[e|27,0,0,0,0,0,0,0];let s=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=s&255,s=s>>8,i[7]=s&255,s=s>>8,i[6]=s&255,s=s>>8,i[5]=s&255,i[4]=o&255,o=o>>8,i[3]=o&255,o=o>>8,i[2]=o&255,o=o>>8,i[1]=o&255,r.push(i)}else throw new Error(`${Ce} encountered BigInt larger than allowable range`)}}Zl.encodedSize=function(e){return Ei.encodedSize(e.value)};Ei.encodedSize=function(e){return e<lr[0]?1:e<lr[1]?2:e<lr[2]?3:e<lr[3]?5:9};Zl.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function DG(r,e,t,n){return new ne(z.negint,-1-Ql(r,e+1,n),2)}function NG(r,e,t,n){return new ne(z.negint,-1-Yl(r,e+1,n),3)}function OG(r,e,t,n){return new ne(z.negint,-1-Jl(r,e+1,n),5)}const Qv=BigInt(-1),qR=BigInt(1);function RG(r,e,t,n){const i=Xl(r,e+1,n);if(typeof i!="bigint"){const s=-1-i;if(s>=Number.MIN_SAFE_INTEGER)return new ne(z.negint,s,9)}if(n.allowBigInt!==!0)throw new Error(`${Ce} integers outside of the safe integer range are not supported`);return new ne(z.negint,Qv-BigInt(i),9)}function Yv(r,e){const t=e.value,n=typeof t=="bigint"?t*Qv-qR:t*-1-1;Ei(r,e.type.majorEncoded,n)}Yv.encodedSize=function(e){const t=e.value,n=typeof t=="bigint"?t*Qv-qR:t*-1-1;return n<lr[0]?1:n<lr[1]?2:n<lr[2]?3:n<lr[3]?5:9};Yv.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function u0(r,e,t,n){ch(r,e,t+n);const i=Gv(r,e+t,e+t+n);return new ne(z.bytes,i,t+n)}function BG(r,e,t,n){return u0(r,e,1,t)}function LG(r,e,t,n){return u0(r,e,2,Ql(r,e+1,n))}function MG(r,e,t,n){return u0(r,e,3,Yl(r,e+1,n))}function UG(r,e,t,n){return u0(r,e,5,Jl(r,e+1,n))}function FG(r,e,t,n){const i=Xl(r,e+1,n);if(typeof i=="bigint")throw new Error(`${Ce} 64-bit integer bytes lengths not supported`);return u0(r,e,9,i)}function Ag(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===z.string?KR(r.value):r.value),r.encodedBytes}function lm(r,e){const t=Ag(e);Ei(r,e.type.majorEncoded,t.length),r.push(t)}lm.encodedSize=function(e){const t=Ag(e);return Ei.encodedSize(t.length)+t.length};lm.compareTokens=function(e,t){return zG(Ag(e),Ag(t))};function zG(r,e){return r.length<e.length?-1:r.length>e.length?1:kG(r,e)}function d0(r,e,t,n,i){const s=t+n;ch(r,e,s);const o=new ne(z.string,SG(r,e+t,e+s),s);return i.retainStringBytes===!0&&(o.byteValue=Gv(r,e+t,e+s)),o}function VG(r,e,t,n){return d0(r,e,1,t,n)}function KG(r,e,t,n){return d0(r,e,2,Ql(r,e+1,n),n)}function jG(r,e,t,n){return d0(r,e,3,Yl(r,e+1,n),n)}function HG(r,e,t,n){return d0(r,e,5,Jl(r,e+1,n),n)}function qG(r,e,t,n){const i=Xl(r,e+1,n);if(typeof i=="bigint")throw new Error(`${Ce} 64-bit integer string lengths not supported`);return d0(r,e,9,i,n)}const WG=lm;function lh(r,e,t,n){return new ne(z.array,n,t)}function GG(r,e,t,n){return lh(r,e,1,t)}function QG(r,e,t,n){return lh(r,e,2,Ql(r,e+1,n))}function YG(r,e,t,n){return lh(r,e,3,Yl(r,e+1,n))}function JG(r,e,t,n){return lh(r,e,5,Jl(r,e+1,n))}function XG(r,e,t,n){const i=Xl(r,e+1,n);if(typeof i=="bigint")throw new Error(`${Ce} 64-bit integer array lengths not supported`);return lh(r,e,9,i)}function ZG(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Ce} indefinite length items not allowed`);return lh(r,e,1,1/0)}function Jv(r,e){Ei(r,z.array.majorEncoded,e.value)}Jv.compareTokens=Zl.compareTokens;Jv.encodedSize=function(e){return Ei.encodedSize(e.value)};function uh(r,e,t,n){return new ne(z.map,n,t)}function eQ(r,e,t,n){return uh(r,e,1,t)}function tQ(r,e,t,n){return uh(r,e,2,Ql(r,e+1,n))}function rQ(r,e,t,n){return uh(r,e,3,Yl(r,e+1,n))}function nQ(r,e,t,n){return uh(r,e,5,Jl(r,e+1,n))}function iQ(r,e,t,n){const i=Xl(r,e+1,n);if(typeof i=="bigint")throw new Error(`${Ce} 64-bit integer map lengths not supported`);return uh(r,e,9,i)}function sQ(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Ce} indefinite length items not allowed`);return uh(r,e,1,1/0)}function Xv(r,e){Ei(r,z.map.majorEncoded,e.value)}Xv.compareTokens=Zl.compareTokens;Xv.encodedSize=function(e){return Ei.encodedSize(e.value)};function oQ(r,e,t,n){return new ne(z.tag,t,1)}function aQ(r,e,t,n){return new ne(z.tag,Ql(r,e+1,n),2)}function cQ(r,e,t,n){return new ne(z.tag,Yl(r,e+1,n),3)}function lQ(r,e,t,n){return new ne(z.tag,Jl(r,e+1,n),5)}function uQ(r,e,t,n){return new ne(z.tag,Xl(r,e+1,n),9)}function Zv(r,e){Ei(r,z.tag.majorEncoded,e.value)}Zv.compareTokens=Zl.compareTokens;Zv.encodedSize=function(e){return Ei.encodedSize(e.value)};const dQ=20,hQ=21,fQ=22,pQ=23;function gQ(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${Ce} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new ne(z.null,null,1):new ne(z.undefined,void 0,1)}function yQ(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Ce} indefinite length items not allowed`);return new ne(z.break,void 0,1)}function eE(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${Ce} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${Ce} Infinity values are not supported`)}return new ne(z.float,r,e)}function mQ(r,e,t,n){return eE(rE(r,e+1),3,n)}function wQ(r,e,t,n){return eE(nE(r,e+1),5,n)}function bQ(r,e,t,n){return eE(YR(r,e+1),9,n)}function tE(r,e,t){const n=e.value;if(n===!1)r.push([z.float.majorEncoded|dQ]);else if(n===!0)r.push([z.float.majorEncoded|hQ]);else if(n===null)r.push([z.float.majorEncoded|fQ]);else if(n===void 0)r.push([z.float.majorEncoded|pQ]);else{let i,s=!1;(!t||t.float64!==!0)&&(GR(n),i=rE(Pi,1),n===i||Number.isNaN(n)?(Pi[0]=249,r.push(Pi.slice(0,3)),s=!0):(QR(n),i=nE(Pi,1),n===i&&(Pi[0]=250,r.push(Pi.slice(0,5)),s=!0))),s||(vQ(n),i=YR(Pi,1),Pi[0]=251,r.push(Pi.slice(0,9)))}}tE.encodedSize=function(e,t){const n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){GR(n);let i=rE(Pi,1);if(n===i||Number.isNaN(n))return 3;if(QR(n),i=nE(Pi,1),n===i)return 5}return 9};const WR=new ArrayBuffer(9),ei=new DataView(WR,1),Pi=new Uint8Array(WR,0);function GR(r){if(r===1/0)ei.setUint16(0,31744,!1);else if(r===-1/0)ei.setUint16(0,64512,!1);else if(Number.isNaN(r))ei.setUint16(0,32256,!1);else{ei.setFloat32(0,r);const e=ei.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)ei.setUint16(0,31744,!1);else if(t===0)ei.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{const i=t-127;i<-24?ei.setUint16(0,0):i<-14?ei.setUint16(0,(e&2147483648)>>16|1<<24+i,!1):ei.setUint16(0,(e&2147483648)>>16|i+15<<10|n>>13,!1)}}}function rE(r,e){if(r.length-e<2)throw new Error(`${Ce} not enough data for float16`);const t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const n=t>>10&31,i=t&1023;let s;return n===0?s=i*2**-24:n!==31?s=(i+1024)*2**(n-25):s=i===0?1/0:NaN,t&32768?-s:s}function QR(r){ei.setFloat32(0,r,!1)}function nE(r,e){if(r.length-e<4)throw new Error(`${Ce} not enough data for float32`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function vQ(r){ei.setFloat64(0,r,!1)}function YR(r,e){if(r.length-e<8)throw new Error(`${Ce} not enough data for float64`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}tE.compareTokens=Zl.compareTokens;function nt(r,e,t){throw new Error(`${Ce} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function um(r){return()=>{throw new Error(`${Ce} ${r}`)}}const ae=[];for(let r=0;r<=23;r++)ae[r]=nt;ae[24]=_G;ae[25]=TG;ae[26]=$G;ae[27]=PG;ae[28]=nt;ae[29]=nt;ae[30]=nt;ae[31]=nt;for(let r=32;r<=55;r++)ae[r]=nt;ae[56]=DG;ae[57]=NG;ae[58]=OG;ae[59]=RG;ae[60]=nt;ae[61]=nt;ae[62]=nt;ae[63]=nt;for(let r=64;r<=87;r++)ae[r]=BG;ae[88]=LG;ae[89]=MG;ae[90]=UG;ae[91]=FG;ae[92]=nt;ae[93]=nt;ae[94]=nt;ae[95]=um("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)ae[r]=VG;ae[120]=KG;ae[121]=jG;ae[122]=HG;ae[123]=qG;ae[124]=nt;ae[125]=nt;ae[126]=nt;ae[127]=um("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)ae[r]=GG;ae[152]=QG;ae[153]=YG;ae[154]=JG;ae[155]=XG;ae[156]=nt;ae[157]=nt;ae[158]=nt;ae[159]=ZG;for(let r=160;r<=183;r++)ae[r]=eQ;ae[184]=tQ;ae[185]=rQ;ae[186]=nQ;ae[187]=iQ;ae[188]=nt;ae[189]=nt;ae[190]=nt;ae[191]=sQ;for(let r=192;r<=215;r++)ae[r]=oQ;ae[216]=aQ;ae[217]=cQ;ae[218]=lQ;ae[219]=uQ;ae[220]=nt;ae[221]=nt;ae[222]=nt;ae[223]=nt;for(let r=224;r<=243;r++)ae[r]=um("simple values are not supported");ae[244]=nt;ae[245]=nt;ae[246]=nt;ae[247]=gQ;ae[248]=um("simple values are not supported");ae[249]=mQ;ae[250]=wQ;ae[251]=bQ;ae[252]=nt;ae[253]=nt;ae[254]=nt;ae[255]=yQ;const $s=[];for(let r=0;r<24;r++)$s[r]=new ne(z.uint,r,1);for(let r=-1;r>=-24;r--)$s[31-r]=new ne(z.negint,r,1);$s[64]=new ne(z.bytes,new Uint8Array(0),1);$s[96]=new ne(z.string,"",1);$s[128]=new ne(z.array,0,1);$s[160]=new ne(z.map,0,1);$s[244]=new ne(z.false,!1,1);$s[245]=new ne(z.true,!0,1);$s[246]=new ne(z.null,null,1);function EQ(r){switch(r.type){case z.false:return Ls([244]);case z.true:return Ls([245]);case z.null:return Ls([246]);case z.bytes:return r.value.length?void 0:Ls([64]);case z.string:return r.value===""?Ls([96]):void 0;case z.array:return r.value===0?Ls([128]):void 0;case z.map:return r.value===0?Ls([160]):void 0;case z.uint:return r.value<24?Ls([Number(r.value)]):void 0;case z.negint:if(r.value>=-24)return Ls([31-Number(r.value)])}}const xQ={float64:!1,mapSorter:CQ,quickEncodeToken:EQ};function SQ(){const r=[];return r[z.uint.major]=Zl,r[z.negint.major]=Yv,r[z.bytes.major]=lm,r[z.string.major]=WG,r[z.array.major]=Jv,r[z.map.major]=Xv,r[z.tag.major]=Zv,r[z.float.major]=tE,r}const JR=SQ(),Kw=new HR;class Cg{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${al} object contains circular references`);return new Cg(t,e)}}const qo={null:new ne(z.null,null),undefined:new ne(z.undefined,void 0),true:new ne(z.true,!0),false:new ne(z.false,!1),emptyArray:new ne(z.array,0),emptyMap:new ne(z.map,0)},ec={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new ne(z.float,r):r>=0?new ne(z.uint,r):new ne(z.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new ne(z.uint,r):new ne(z.negint,r)},Uint8Array(r,e,t,n){return new ne(z.bytes,r)},string(r,e,t,n){return new ne(z.string,r)},boolean(r,e,t,n){return r?qo.true:qo.false},null(r,e,t,n){return qo.null},undefined(r,e,t,n){return qo.undefined},ArrayBuffer(r,e,t,n){return new ne(z.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new ne(z.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[qo.emptyArray,new ne(z.break)]:qo.emptyArray;n=Cg.createCheck(n,r);const i=[];let s=0;for(const o of r)i[s++]=v2(o,t,n);return t.addBreakTokens?[new ne(z.array,r.length),i,new ne(z.break)]:[new ne(z.array,r.length),i]},Object(r,e,t,n){const i=e!=="Object",s=i?r.keys():Object.keys(r),o=i?r.size:s.length;if(!o)return t.addBreakTokens===!0?[qo.emptyMap,new ne(z.break)]:qo.emptyMap;n=Cg.createCheck(n,r);const a=[];let c=0;for(const l of s)a[c++]=[v2(l,t,n),v2(i?r.get(l):r[l],t,n)];return AQ(a,t),t.addBreakTokens?[new ne(z.map,o),a,new ne(z.break)]:[new ne(z.map,o),a]}};ec.Map=ec.Object;ec.Buffer=ec.Uint8Array;for(const r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))ec[`${r}Array`]=ec.DataView;function v2(r,e={},t){const n=wG(r),i=e&&e.typeEncoders&&e.typeEncoders[n]||ec[n];if(typeof i=="function"){const o=i(r,n,e,t);if(o!=null)return o}const s=ec[n];if(!s)throw new Error(`${al} unsupported type: ${n}`);return s(r,n,e,t)}function AQ(r,e){e.mapSorter&&r.sort(e.mapSorter)}function CQ(r,e){const t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);const i=t.type.major,s=JR[i].compareTokens(t,n);return s===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),s}function XR(r,e,t,n){if(Array.isArray(e))for(const i of e)XR(r,i,t,n);else t[e.type.major](r,e,n)}function ZR(r,e,t){const n=v2(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){const i=t.quickEncodeToken(n);if(i)return i;const s=e[n.type.major];if(s.encodedSize){const o=s.encodedSize(n,t),a=new HR(o);if(s(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return Wv(a.chunks[0])}}return Kw.reset(),XR(Kw,n,e,t),Kw.toBytes(!0)}function E2(r,e){return e=Object.assign({},xQ,e),ZR(r,JR,e)}const kQ={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class IQ{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=$s[e];if(t===void 0){const n=ae[e];if(!n)throw new Error(`${Ce} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const i=e&31;t=n(this.data,this._pos,i,this.options)}return this._pos+=t.encodedLength,t}}const y1=Symbol.for("DONE"),dm=Symbol.for("BREAK");function _Q(r,e,t){const n=[];for(let i=0;i<r.value;i++){const s=m1(e,t);if(s===dm){if(r.value===1/0)break;throw new Error(`${Ce} got unexpected break to lengthed array`)}if(s===y1)throw new Error(`${Ce} found array but not enough entries (got ${i}, expected ${r.value})`);n[i]=s}return n}function TQ(r,e,t){const n=t.useMaps===!0,i=n?void 0:{},s=n?new Map:void 0;for(let o=0;o<r.value;o++){const a=m1(e,t);if(a===dm){if(r.value===1/0)break;throw new Error(`${Ce} got unexpected break to lengthed map`)}if(a===y1)throw new Error(`${Ce} found map but not enough entries (got ${o} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${Ce} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&s.has(a)||!n&&a in i))throw new Error(`${Ce} found repeat map key "${a}"`);const c=m1(e,t);if(c===y1)throw new Error(`${Ce} found map but not enough entries (got ${o} [no value], expected ${r.value})`);n?s.set(a,c):i[a]=c}return n?s:i}function m1(r,e){if(r.done())return y1;const t=r.next();if(t.type===z.break)return dm;if(t.type.terminal)return t.value;if(t.type===z.array)return _Q(t,r,e);if(t.type===z.map)return TQ(t,r,e);if(t.type===z.tag){if(e.tags&&typeof e.tags[t.value]=="function"){const n=m1(r,e);return e.tags[t.value](n)}throw new Error(`${Ce} tag not supported (${t.value})`)}throw new Error("unsupported")}function $Q(r,e){if(!(r instanceof Uint8Array))throw new Error(`${Ce} data to decode must be a Uint8Array`);e=Object.assign({},kQ,e);const t=e.tokenizer||new IQ(r,e),n=m1(t,e);if(n===y1)throw new Error(`${Ce} did not find any content to decode`);if(n===dm)throw new Error(`${Ce} got unexpected break`);return[n,r.subarray(t.pos())]}function xa(r,e){const[t,n]=$Q(r,e);if(n.length>0)throw new Error(`${Ce} too many terminals, data makes no sense`);return t}function PQ(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function iE(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function DQ(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var NQ=DQ,OQ=NQ;let RQ=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},BQ=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return eB(this,e)}},LQ=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return eB(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function eB(r,e){return new LQ({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let MQ=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new RQ(e,t,n),this.decoder=new BQ(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function tB({name:r,prefix:e,encode:t,decode:n}){return new MQ(r,e,t,n)}function hm({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=OQ(t,r);return tB({prefix:e,name:r,encode:n,decode:s=>iE(i(s))})}function UQ(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function FQ(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function $o({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return tB({prefix:e,name:r,encode(i){return FQ(i,n,t)},decode(i){return UQ(i,n,t,r)}})}const x2=$o({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});$o({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});$o({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});$o({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});$o({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});$o({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});$o({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});$o({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});$o({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const jw=hm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});hm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const ca=hm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});hm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var zQ=rB,wC=128,VQ=-128,KQ=Math.pow(2,31);function rB(r,e,t){e=e||[],t=t||0;for(var n=t;r>=KQ;)e[t++]=r&255|wC,r/=128;for(;r&VQ;)e[t++]=r&255|wC,r>>>=7;return e[t]=r|0,rB.bytes=t-n+1,e}var jQ=T6,HQ=128,bC=127;function T6(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw T6.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&bC)<<i:(o&bC)*Math.pow(2,i),i+=7}while(o>=HQ);return T6.bytes=s-n,t}var qQ=Math.pow(2,7),WQ=Math.pow(2,14),GQ=Math.pow(2,21),QQ=Math.pow(2,28),YQ=Math.pow(2,35),JQ=Math.pow(2,42),XQ=Math.pow(2,49),ZQ=Math.pow(2,56),eY=Math.pow(2,63),tY=function(r){return r<qQ?1:r<WQ?2:r<GQ?3:r<QQ?4:r<YQ?5:r<JQ?6:r<XQ?7:r<ZQ?8:r<eY?9:10},rY={encode:zQ,decode:jQ,encodingLength:tY},kg=rY;function $6(r,e=0){return[kg.decode(r,e),kg.decode.bytes]}function Ig(r,e,t=0){return kg.encode(r,e,t),e}function _g(r){return kg.encodingLength(r)}function nY(r,e){const t=e.byteLength,n=_g(r),i=n+_g(t),s=new Uint8Array(i+t);return Ig(r,s,0),Ig(t,s,n),s.set(e,i),new sE(r,t,e,s)}function iY(r){const e=iE(r),[t,n]=$6(e),[i,s]=$6(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new sE(t,i,o,e)}function sY(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&PQ(r.bytes,t.bytes)}}let sE=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function vC(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return aY(t,P6(r),e??ca.encoder);default:return cY(t,P6(r),e??x2.encoder)}}const EC=new WeakMap;function P6(r){const e=EC.get(r);if(e==null){const t=new Map;return EC.set(r,t),t}return e}var GP;let nB=class kr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,GP,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Uh)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==lY)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return kr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=nY(e,t);return kr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return kr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&sY(e.multihash,n.multihash)}toString(e){return vC(this,e)}toJSON(){return{"/":vC(this)}}link(){return this}[(GP=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof kr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new kr(n,i,s,o??xC(n,i,s.bytes))}else if(t[uY]===!0){const{version:n,multihash:i,code:s}=t,o=iY(i);return kr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Uh)throw new Error(`Version 0 CID must use dag-pb (code: ${Uh}) block encoding`);return new kr(e,t,n,n.bytes)}case 1:{const i=xC(e,t,n.bytes);return new kr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return kr.create(0,Uh,e)}static createV1(e,t){return kr.create(1,e,t)}static decode(e){const[t,n]=kr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=kr.inspectBytes(e),n=t.size-t.multihashSize,i=iE(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new sE(t.multihashCode,t.digestSize,s,i);return[t.version===0?kr.createV0(o):kr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=$6(e.subarray(t));return t+=p,h};let i=n(),s=Uh;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=oY(e,t),s=kr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return P6(s).set(n,e),s}};function oY(r,e){switch(r[0]){case"Q":{const t=e??ca;return[ca.prefix,t.decode(`${ca.prefix}${r}`)]}case ca.prefix:{const t=e??ca;return[ca.prefix,t.decode(r)]}case x2.prefix:{const t=e??x2;return[x2.prefix,t.decode(r)]}case jw.prefix:{const t=e??jw;return[jw.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function aY(r,e,t){const{prefix:n}=t;if(n!==ca.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function cY(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Uh=112,lY=18;function xC(r,e,t){const n=_g(r),i=n+_g(e),s=new Uint8Array(i+t.byteLength);return Ig(r,s,0),Ig(e,s,n),s.set(t,i),s}const uY=Symbol.for("@ipld/js-cid/CID"),iB=42;function sB(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function dY(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=nB.asCID(r);if(!e)return null;const t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new ne(z.tag,iB),new ne(z.bytes,t)]}function hY(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function fY(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const D6={float64:!0,typeEncoders:{Object:dY,undefined:hY,number:fY}},pY={...D6,typeEncoders:{...D6.typeEncoders}};function gY(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return nB.decode(r.subarray(1))}const Tg={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Tg.tags[iB]=gY;const yY={...Tg,tags:Tg.tags.slice()},mY="dag-cbor",oB=113,wY=r=>E2(r,D6),bY=r=>xa(sB(r),Tg),h0=Object.freeze(Object.defineProperty({__proto__:null,code:oB,decode:bY,decodeOptions:yY,encode:wY,encodeOptions:pY,name:mY,toByteView:sB},Symbol.toStringTag,{value:"Module"})),vY=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),fm=dG({name:"sha2-256",code:18,encode:vY("SHA-256")}),pm=h0,gm=fm,aB=Jr,EY=async(r,e,t,n=null,i=[],s=[])=>{if(r==null)throw new Error("Identity is required, cannot create entry");if(e==null)throw new Error("Entry requires an id");if(t==null)throw new Error("Entry requires a payload");if(i==null||!Array.isArray(i))throw new Error("'next' argument is not an array");n=n||am(r.publicKey);const o={id:e,payload:t,next:i,refs:s,clock:n,v:2},{bytes:a}=await oh({value:o,codec:pm,hasher:gm}),c=await r.sign(r,a);return o.key=r.publicKey,o.identity=r.hash,o.sig=c,lB(o)},xY=async(r,e)=>{if(!r)throw new Error("Identities is required, cannot verify entry");if(!cB(e))throw new Error("Invalid Log entry");if(!e.key)throw new Error("Entry doesn't have a key");if(!e.sig)throw new Error("Entry doesn't have a signature");const t={id:e.id,payload:e.payload,next:e.next,refs:e.refs,clock:e.clock,v:e.v},{bytes:n}=await oh({value:t,codec:pm,hasher:gm});return r.verify(e.sig,e.key,n)},cB=r=>r&&r.id!==void 0&&r.next!==void 0&&r.payload!==void 0&&r.v!==void 0&&r.clock!==void 0&&r.refs!==void 0,SY=(r,e)=>r&&e&&r.hash===e.hash,AY=async r=>{const{cid:e,value:t}=await cm({bytes:r,codec:pm,hasher:gm}),n=e.toString(aB);return{...t,hash:n,bytes:r}},lB=async r=>{const{cid:e,bytes:t}=await oh({value:r,codec:pm,hasher:gm}),n=e.toString(aB),i=am(r.clock.id,r.clock.time);return{...r,clock:i,hash:n,bytes:t}},Ys={create:EY,verify:xY,decode:AY,encode:lB,isEntry:cB,isEqual:SY},oE=async()=>{let r={};const e=async(c,l)=>{r[c]=l};return{put:e,del:async c=>{delete r[c]},get:async c=>r[c],iterator:async function*(){for await(const[c,l]of Object.entries(r))yield[c,l]},merge:async c=>{if(c)for await(const[l,d]of c.iterator())e(l,d)},clear:async()=>{r={}},close:async()=>{}}},CY=oE,kY=async({storage:r,heads:e})=>{r=r||await CY();const t=async d=>{d=SC(d);for(const h of d)await r.put(h.hash,h.bytes)},n=async d=>{await r.clear(),await t(d)},i=async d=>{const h=await a();if(h.find(b=>Ys.isEqual(b,d)))return;const p=SC([...h,d]);return await n(p),p},s=async d=>{const p=(await a()).filter(b=>b.hash!==d);await n(p)},o=async function*(){const d=r.iterator();for await(const[,h]of d)yield await Ys.decode(h)},a=async()=>{const d=[];for await(const h of o())d.push(h);return d},c=async()=>{await r.clear()},l=async()=>{await r.close()};return await t(e||[]),{put:t,set:n,add:i,remove:s,iterator:o,all:a,clear:c,close:l}},SC=r=>{r=new Set(r);const e={};for(const n of r)for(const i of n.next)e[i]=n.hash;const t=[];for(const n of r)e[n.hash]||t.push(n);return t};function IY(r,e){const t=(s,o)=>s,n=(s,o)=>TY(s,o,t);return((s,o)=>_Y(s,o,n))(r,e)}function _Y(r,e,t){const n=$W(r.clock,e.clock);return n===0?t(r,e):n}function TY(r,e,t){return r.clock.id===e.clock.id?t(r,e):r.clock.id<e.clock.id?-1:1}function $Y(r){const e=`Your log's tiebreaker function, ${r.name}, has returned zero and therefore cannot be`;return(n,i)=>{const s=r(n,i);if(s===0)throw Error(e);return s}}const PY={LastWriteWins:IY,NoZeroes:$Y},{LastWriteWins:DY,NoZeroes:NY}=PY,OY=()=>new Date().getTime().toString(),RY=(r,e)=>Math.max(r,e.clock.time),Hw=oE,BY=async()=>({canAppend:async r=>!0}),LY=async(r,{logId:e,logHeads:t,access:n,entryStorage:i,headsStorage:s,indexStorage:o,sortFn:a}={})=>{if(r==null)throw new Error("Identity is required");if(t!=null&&!Array.isArray(t))throw new Error("'logHeads' argument must be an array");const c=e||OY();n=n||await BY();const l=i||await Hw(),d=o||await Hw();s=s||await Hw();const h=await kY({storage:s,heads:t});a=NY(a||DY);const p=new Za({concurrency:1}),b=new Za({concurrency:1}),f=async()=>{const U=Math.max(0,(await g()).reduce(RY,0));return am(r.publicKey,U)},g=async()=>(await h.all()).sort(a).reverse(),v=async()=>{const U=[];for await(const Y of k())U.unshift(Y);return U},y=async U=>{const Y=await l.get(U);if(Y)return await Ys.decode(Y)},w=async U=>await d.get(U)!=null,m=async(U,Y={referencesCount:0})=>{const j=async()=>{const H=await g(),G=H.map(q=>q.hash),V=await W(H,Y.referencesCount+H.length),R=await Ys.create(r,c,U,PW(await f()),G,V);if(!await n.canAppend(R))throw new Error(`Could not append entry:
Key "${r.hash}" is not allowed to write to the log`);return await h.set([R]),await l.put(R.hash,R.bytes),await d.put(R.hash,!0),R};return p.add(j)},E=async U=>{if(!U)throw new Error("Log instance not defined");if(!F(U))throw new Error("Given argument is not an instance of Log");l.merge&&await l.merge(U.storage);const Y=await U.heads();for(const j of Y)await C(j)},C=async U=>{const Y=async()=>{if(await w(U.hash))return!1;const H=async Q=>{if(Q.id!==c)throw new Error(`Entry's id (${Q.id}) doesn't match the log's id (${c}).`);if(!await n.canAppend(Q))throw new Error(`Could not append entry:
Key "${Q.identity}" is not allowed to write to the log`);if(!await Ys.verify(r,Q))throw new Error(`Could not validate signature for entry "${Q.hash}"`)};await H(U);const G=(await g()).map(Q=>Q.hash),V=new Set([U.hash]),R=new Set([...U.next,...U.refs]),L=new Set,q=async()=>{const Q=Array.from(R.values()).filter(w).map(y),K=await Promise.all(Q);for(const ce of K){R.delete(ce.hash),await H(ce),V.add(ce.hash);for(const me of[...ce.next,...ce.refs])!await w(me)&&!V.has(me)?R.add(me):G.includes(me)&&L.add(me)}R.size>0&&await q()};await q();for(const Q of V.values())await d.put(Q,!0);for(const Q of L.values())await h.remove(Q);return await l.put(U.hash,U.bytes),await h.add(U),!0};return b.add(Y)},k=async function*(U,Y){Y=Y||(()=>!1),U=U||await g();let H=U.sort(a);const G={};let V=[];const R={},L=Q=>!(G[Q]||R[Q]);let q;for(;H.length>0;)if(H=H.sort(a),q=H.pop(),q){const{hash:Q,next:K}=q;if(!G[Q]){if(yield q,await Y(q)===!0)break;G[Q]=!0,R[Q]=!0,V=[...V,...K].filter(L);const me=ue=>{if(!G[ue]&&!R[ue])return R[ue]=!0,y(ue)},de=await Promise.all(V.map(me));V=de.filter(ue=>ue!=null).reduce((ue,$e)=>Array.from(new Set([...ue,...$e.next])),[]).filter(L),H=[...de,...H]}}},A=async function*({amount:U=-1,gt:Y,gte:j,lt:H,lte:G}={}){if(U===0)return;if(typeof G=="string"&&(G=[await y(G)]),typeof H=="string"){const ue=await y(H);H=await Promise.all(ue.next.map(Pe=>y(Pe)))}if(H!=null&&!Array.isArray(H))throw new Error("lt must be a string or an array of Entries");if(G!=null&&!Array.isArray(G))throw new Error("lte must be a string or an array of Entries");const V=(H||G||await g()).filter(ue=>ue!=null),R=Y||j?await y(Y||j):null,L=R||U===-1?-1:U;let q=0;const Q=async ue=>(q++,ue?!!(q>=L&&L!==-1||R&&Ys.isEqual(ue,R)):!1),K=R&&U!==-1&&!H&&!G,ce=K?new x6(U+2):null;let me=0;const de=k(V,Q);for await(const ue of de){const $e=H&&Ys.isEqual(ue,V),Pe=Y&&Ys.isEqual(ue,R);$e||Pe||(K?ce.set(me++,ue.hash):yield ue)}if(K){const ue=ce.keys.length,$e=ue>U?ue-U:0,Pe=ce.keys.slice($e,ue);for(const Je of Pe){const it=ce.get(Je);yield await y(it)}}},I=async()=>{await d.clear(),await h.clear(),await l.clear()},D=async()=>{await d.close(),await h.close(),await l.close()},F=U=>U&&U.id!==void 0&&U.clock!==void 0&&U.heads!==void 0&&U.values!==void 0&&U.access!==void 0&&U.identity!==void 0&&U.storage!==void 0,W=async(U,Y=0)=>{let j=[];const H=async G=>j.length>=Y&&Y!==-1;for await(const{hash:G}of k(U,H))j.push(G);return j=j.slice(U.length+1,Y),j};return{id:c,clock:f,heads:g,values:v,all:v,get:y,has:w,append:m,join:E,joinEntry:C,traverse:k,iterator:A,clear:I,close:D,access:n,identity:r,storage:l}},cl=async(r,e)=>({put:async(l,d)=>{await r.put(l,d),await e.put(l,d)},get:async l=>{let d=await r.get(l);return d||(d=await e.get(l),d&&await r.put(l,d)),d},del:async l=>{await r.del(l),await e.del(l)},iterator:async function*({amount:l,reverse:d}={}){const h=[],p={amount:l||-1,reverse:d||!1};for(const b of[r,e])for await(const[f,g]of b.iterator(p))h[f]||(h[f]=!0,yield[f,g])},merge:async l=>{await r.merge(l),await e.merge(l),await l.merge(r),await l.merge(e)},clear:async()=>{await r.clear(),await e.clear()},close:async()=>{await r.close(),await e.close()}});function MY(r){return r[Symbol.asyncIterator]!=null}function vo(r){if(MY(r))return(async()=>{for await(const e of r);})();for(const e of r);}const AC=3e4,ym=async({ipfs:r,pin:e,timeout:t}={})=>{if(!r)throw new Error("An instance of ipfs is required.");return{put:async(d,h)=>{const p=Yi.parse(d,Jr),{signal:b}=new v6.TimeoutController(t||AC);await r.blockstore.put(p,h,{signal:b}),e&&!await r.pins.isPinned(p)&&await vo(r.pins.add(p))},del:async d=>{},get:async d=>{const h=Yi.parse(d,Jr),{signal:p}=new v6.TimeoutController(t||AC),b=await r.blockstore.get(h,{signal:p});if(b)return b},iterator:async function*(){},merge:async d=>{},clear:async()=>{},close:async()=>{}}};var uB={},yc={},mm={},dB={};dB.supports=function(...e){const t=e.reduce((n,i)=>Object.assign(n,i),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})};var hB={},Ps=class extends Error{constructor(e,t){super(e||""),typeof t=="object"&&t!==null&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},eu={},wm={},bm={};bm.byteLength=zY;bm.toByteArray=KY;bm.fromByteArray=qY;var ws=[],ti=[],UY=typeof Uint8Array<"u"?Uint8Array:Array,qw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var lu=0,FY=qw.length;lu<FY;++lu)ws[lu]=qw[lu],ti[qw.charCodeAt(lu)]=lu;ti[45]=62;ti[95]=63;function fB(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function zY(r){var e=fB(r),t=e[0],n=e[1];return(t+n)*3/4-n}function VY(r,e,t){return(e+t)*3/4-t}function KY(r){var e,t=fB(r),n=t[0],i=t[1],s=new UY(VY(r,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=ti[r.charCodeAt(c)]<<18|ti[r.charCodeAt(c+1)]<<12|ti[r.charCodeAt(c+2)]<<6|ti[r.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=ti[r.charCodeAt(c)]<<2|ti[r.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=ti[r.charCodeAt(c)]<<10|ti[r.charCodeAt(c+1)]<<4|ti[r.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function jY(r){return ws[r>>18&63]+ws[r>>12&63]+ws[r>>6&63]+ws[r&63]}function HY(r,e,t){for(var n,i=[],s=e;s<t;s+=3)n=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),i.push(jY(n));return i.join("")}function qY(r){for(var e,t=r.length,n=t%3,i=[],s=16383,o=0,a=t-n;o<a;o+=s)i.push(HY(r,o,o+s>a?a:o+s));return n===1?(e=r[t-1],i.push(ws[e>>2]+ws[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],i.push(ws[e>>10]+ws[e>>4&63]+ws[e<<2&63]+"=")),i.join("")}var aE={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */aE.read=function(r,e,t,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,l=c>>1,d=-7,h=t?i-1:0,p=t?-1:1,b=r[e+h];for(h+=p,s=b&(1<<-d)-1,b>>=-d,d+=a;d>0;s=s*256+r[e+h],h+=p,d-=8);for(o=s&(1<<-d)-1,s>>=-d,d+=n;d>0;o=o*256+r[e+h],h+=p,d-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(b?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-l}return(b?-1:1)*o*Math.pow(2,s-n)};aE.write=function(r,e,t,n,i,s){var o,a,c,l=s*8-i-1,d=(1<<l)-1,h=d>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=n?0:s-1,f=n?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=d):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?e+=p/c:e+=p*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=d?(a=0,o=d):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;r[t+b]=a&255,b+=f,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;r[t+b]=o&255,b+=f,o/=256,l-=8);r[t+b-f]|=g*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(r){const e=bm,t=aE,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=a,r.SlowBuffer=w,r.INSPECT_MAX_BYTES=50;const i=2147483647;r.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const $=new Uint8Array(1),x={foo:function(){return 42}};return Object.setPrototypeOf(x,Uint8Array.prototype),Object.setPrototypeOf($,x),$.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o($){if($>i)throw new RangeError('The value "'+$+'" is invalid for option "size"');const x=new Uint8Array($);return Object.setPrototypeOf(x,a.prototype),x}function a($,x,S){if(typeof $=="number"){if(typeof x=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return h($)}return c($,x,S)}a.poolSize=8192;function c($,x,S){if(typeof $=="string")return p($,x);if(ArrayBuffer.isView($))return f($);if($==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof $);if(Xn($,ArrayBuffer)||$&&Xn($.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Xn($,SharedArrayBuffer)||$&&Xn($.buffer,SharedArrayBuffer)))return g($,x,S);if(typeof $=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const O=$.valueOf&&$.valueOf();if(O!=null&&O!==$)return a.from(O,x,S);const T=v($);if(T)return T;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof $[Symbol.toPrimitive]=="function")return a.from($[Symbol.toPrimitive]("string"),x,S);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof $)}a.from=function($,x,S){return c($,x,S)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function l($){if(typeof $!="number")throw new TypeError('"size" argument must be of type number');if($<0)throw new RangeError('The value "'+$+'" is invalid for option "size"')}function d($,x,S){return l($),$<=0?o($):x!==void 0?typeof S=="string"?o($).fill(x,S):o($).fill(x):o($)}a.alloc=function($,x,S){return d($,x,S)};function h($){return l($),o($<0?0:y($)|0)}a.allocUnsafe=function($){return h($)},a.allocUnsafeSlow=function($){return h($)};function p($,x){if((typeof x!="string"||x==="")&&(x="utf8"),!a.isEncoding(x))throw new TypeError("Unknown encoding: "+x);const S=m($,x)|0;let O=o(S);const T=O.write($,x);return T!==S&&(O=O.slice(0,T)),O}function b($){const x=$.length<0?0:y($.length)|0,S=o(x);for(let O=0;O<x;O+=1)S[O]=$[O]&255;return S}function f($){if(Xn($,Uint8Array)){const x=new Uint8Array($);return g(x.buffer,x.byteOffset,x.byteLength)}return b($)}function g($,x,S){if(x<0||$.byteLength<x)throw new RangeError('"offset" is outside of buffer bounds');if($.byteLength<x+(S||0))throw new RangeError('"length" is outside of buffer bounds');let O;return x===void 0&&S===void 0?O=new Uint8Array($):S===void 0?O=new Uint8Array($,x):O=new Uint8Array($,x,S),Object.setPrototypeOf(O,a.prototype),O}function v($){if(a.isBuffer($)){const x=y($.length)|0,S=o(x);return S.length===0||$.copy(S,0,0,x),S}if($.length!==void 0)return typeof $.length!="number"||Th($.length)?o(0):b($);if($.type==="Buffer"&&Array.isArray($.data))return b($.data)}function y($){if($>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return $|0}function w($){return+$!=$&&($=0),a.alloc(+$)}a.isBuffer=function(x){return x!=null&&x._isBuffer===!0&&x!==a.prototype},a.compare=function(x,S){if(Xn(x,Uint8Array)&&(x=a.from(x,x.offset,x.byteLength)),Xn(S,Uint8Array)&&(S=a.from(S,S.offset,S.byteLength)),!a.isBuffer(x)||!a.isBuffer(S))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(x===S)return 0;let O=x.length,T=S.length;for(let N=0,B=Math.min(O,T);N<B;++N)if(x[N]!==S[N]){O=x[N],T=S[N];break}return O<T?-1:T<O?1:0},a.isEncoding=function(x){switch(String(x).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(x,S){if(!Array.isArray(x))throw new TypeError('"list" argument must be an Array of Buffers');if(x.length===0)return a.alloc(0);let O;if(S===void 0)for(S=0,O=0;O<x.length;++O)S+=x[O].length;const T=a.allocUnsafe(S);let N=0;for(O=0;O<x.length;++O){let B=x[O];if(Xn(B,Uint8Array))N+B.length>T.length?(a.isBuffer(B)||(B=a.from(B)),B.copy(T,N)):Uint8Array.prototype.set.call(T,B,N);else if(a.isBuffer(B))B.copy(T,N);else throw new TypeError('"list" argument must be an Array of Buffers');N+=B.length}return T};function m($,x){if(a.isBuffer($))return $.length;if(ArrayBuffer.isView($)||Xn($,ArrayBuffer))return $.byteLength;if(typeof $!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof $);const S=$.length,O=arguments.length>2&&arguments[2]===!0;if(!O&&S===0)return 0;let T=!1;for(;;)switch(x){case"ascii":case"latin1":case"binary":return S;case"utf8":case"utf-8":return Ko($).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S*2;case"hex":return S>>>1;case"base64":return Cc($).length;default:if(T)return O?-1:Ko($).length;x=(""+x).toLowerCase(),T=!0}}a.byteLength=m;function E($,x,S){let O=!1;if((x===void 0||x<0)&&(x=0),x>this.length||((S===void 0||S>this.length)&&(S=this.length),S<=0)||(S>>>=0,x>>>=0,S<=x))return"";for($||($="utf8");;)switch($){case"hex":return L(this,x,S);case"utf8":case"utf-8":return j(this,x,S);case"ascii":return V(this,x,S);case"latin1":case"binary":return R(this,x,S);case"base64":return Y(this,x,S);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return q(this,x,S);default:if(O)throw new TypeError("Unknown encoding: "+$);$=($+"").toLowerCase(),O=!0}}a.prototype._isBuffer=!0;function C($,x,S){const O=$[x];$[x]=$[S],$[S]=O}a.prototype.swap16=function(){const x=this.length;if(x%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let S=0;S<x;S+=2)C(this,S,S+1);return this},a.prototype.swap32=function(){const x=this.length;if(x%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let S=0;S<x;S+=4)C(this,S,S+3),C(this,S+1,S+2);return this},a.prototype.swap64=function(){const x=this.length;if(x%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let S=0;S<x;S+=8)C(this,S,S+7),C(this,S+1,S+6),C(this,S+2,S+5),C(this,S+3,S+4);return this},a.prototype.toString=function(){const x=this.length;return x===0?"":arguments.length===0?j(this,0,x):E.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(x){if(!a.isBuffer(x))throw new TypeError("Argument must be a Buffer");return this===x?!0:a.compare(this,x)===0},a.prototype.inspect=function(){let x="";const S=r.INSPECT_MAX_BYTES;return x=this.toString("hex",0,S).replace(/(.{2})/g,"$1 ").trim(),this.length>S&&(x+=" ... "),"<Buffer "+x+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(x,S,O,T,N){if(Xn(x,Uint8Array)&&(x=a.from(x,x.offset,x.byteLength)),!a.isBuffer(x))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof x);if(S===void 0&&(S=0),O===void 0&&(O=x?x.length:0),T===void 0&&(T=0),N===void 0&&(N=this.length),S<0||O>x.length||T<0||N>this.length)throw new RangeError("out of range index");if(T>=N&&S>=O)return 0;if(T>=N)return-1;if(S>=O)return 1;if(S>>>=0,O>>>=0,T>>>=0,N>>>=0,this===x)return 0;let B=N-T,J=O-S;const he=Math.min(B,J),_e=this.slice(T,N),Oe=x.slice(S,O);for(let ve=0;ve<he;++ve)if(_e[ve]!==Oe[ve]){B=_e[ve],J=Oe[ve];break}return B<J?-1:J<B?1:0};function k($,x,S,O,T){if($.length===0)return-1;if(typeof S=="string"?(O=S,S=0):S>2147483647?S=2147483647:S<-2147483648&&(S=-2147483648),S=+S,Th(S)&&(S=T?0:$.length-1),S<0&&(S=$.length+S),S>=$.length){if(T)return-1;S=$.length-1}else if(S<0)if(T)S=0;else return-1;if(typeof x=="string"&&(x=a.from(x,O)),a.isBuffer(x))return x.length===0?-1:A($,x,S,O,T);if(typeof x=="number")return x=x&255,typeof Uint8Array.prototype.indexOf=="function"?T?Uint8Array.prototype.indexOf.call($,x,S):Uint8Array.prototype.lastIndexOf.call($,x,S):A($,[x],S,O,T);throw new TypeError("val must be string, number or Buffer")}function A($,x,S,O,T){let N=1,B=$.length,J=x.length;if(O!==void 0&&(O=String(O).toLowerCase(),O==="ucs2"||O==="ucs-2"||O==="utf16le"||O==="utf-16le")){if($.length<2||x.length<2)return-1;N=2,B/=2,J/=2,S/=2}function he(Oe,ve){return N===1?Oe[ve]:Oe.readUInt16BE(ve*N)}let _e;if(T){let Oe=-1;for(_e=S;_e<B;_e++)if(he($,_e)===he(x,Oe===-1?0:_e-Oe)){if(Oe===-1&&(Oe=_e),_e-Oe+1===J)return Oe*N}else Oe!==-1&&(_e-=_e-Oe),Oe=-1}else for(S+J>B&&(S=B-J),_e=S;_e>=0;_e--){let Oe=!0;for(let ve=0;ve<J;ve++)if(he($,_e+ve)!==he(x,ve)){Oe=!1;break}if(Oe)return _e}return-1}a.prototype.includes=function(x,S,O){return this.indexOf(x,S,O)!==-1},a.prototype.indexOf=function(x,S,O){return k(this,x,S,O,!0)},a.prototype.lastIndexOf=function(x,S,O){return k(this,x,S,O,!1)};function I($,x,S,O){S=Number(S)||0;const T=$.length-S;O?(O=Number(O),O>T&&(O=T)):O=T;const N=x.length;O>N/2&&(O=N/2);let B;for(B=0;B<O;++B){const J=parseInt(x.substr(B*2,2),16);if(Th(J))return B;$[S+B]=J}return B}function D($,x,S,O){return jo(Ko(x,$.length-S),$,S,O)}function F($,x,S,O){return jo(ou(x),$,S,O)}function W($,x,S,O){return jo(Cc(x),$,S,O)}function U($,x,S,O){return jo(au(x,$.length-S),$,S,O)}a.prototype.write=function(x,S,O,T){if(S===void 0)T="utf8",O=this.length,S=0;else if(O===void 0&&typeof S=="string")T=S,O=this.length,S=0;else if(isFinite(S))S=S>>>0,isFinite(O)?(O=O>>>0,T===void 0&&(T="utf8")):(T=O,O=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const N=this.length-S;if((O===void 0||O>N)&&(O=N),x.length>0&&(O<0||S<0)||S>this.length)throw new RangeError("Attempt to write outside buffer bounds");T||(T="utf8");let B=!1;for(;;)switch(T){case"hex":return I(this,x,S,O);case"utf8":case"utf-8":return D(this,x,S,O);case"ascii":case"latin1":case"binary":return F(this,x,S,O);case"base64":return W(this,x,S,O);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,x,S,O);default:if(B)throw new TypeError("Unknown encoding: "+T);T=(""+T).toLowerCase(),B=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Y($,x,S){return x===0&&S===$.length?e.fromByteArray($):e.fromByteArray($.slice(x,S))}function j($,x,S){S=Math.min($.length,S);const O=[];let T=x;for(;T<S;){const N=$[T];let B=null,J=N>239?4:N>223?3:N>191?2:1;if(T+J<=S){let he,_e,Oe,ve;switch(J){case 1:N<128&&(B=N);break;case 2:he=$[T+1],(he&192)===128&&(ve=(N&31)<<6|he&63,ve>127&&(B=ve));break;case 3:he=$[T+1],_e=$[T+2],(he&192)===128&&(_e&192)===128&&(ve=(N&15)<<12|(he&63)<<6|_e&63,ve>2047&&(ve<55296||ve>57343)&&(B=ve));break;case 4:he=$[T+1],_e=$[T+2],Oe=$[T+3],(he&192)===128&&(_e&192)===128&&(Oe&192)===128&&(ve=(N&15)<<18|(he&63)<<12|(_e&63)<<6|Oe&63,ve>65535&&ve<1114112&&(B=ve))}}B===null?(B=65533,J=1):B>65535&&(B-=65536,O.push(B>>>10&1023|55296),B=56320|B&1023),O.push(B),T+=J}return G(O)}const H=4096;function G($){const x=$.length;if(x<=H)return String.fromCharCode.apply(String,$);let S="",O=0;for(;O<x;)S+=String.fromCharCode.apply(String,$.slice(O,O+=H));return S}function V($,x,S){let O="";S=Math.min($.length,S);for(let T=x;T<S;++T)O+=String.fromCharCode($[T]&127);return O}function R($,x,S){let O="";S=Math.min($.length,S);for(let T=x;T<S;++T)O+=String.fromCharCode($[T]);return O}function L($,x,S){const O=$.length;(!x||x<0)&&(x=0),(!S||S<0||S>O)&&(S=O);let T="";for(let N=x;N<S;++N)T+=fw[$[N]];return T}function q($,x,S){const O=$.slice(x,S);let T="";for(let N=0;N<O.length-1;N+=2)T+=String.fromCharCode(O[N]+O[N+1]*256);return T}a.prototype.slice=function(x,S){const O=this.length;x=~~x,S=S===void 0?O:~~S,x<0?(x+=O,x<0&&(x=0)):x>O&&(x=O),S<0?(S+=O,S<0&&(S=0)):S>O&&(S=O),S<x&&(S=x);const T=this.subarray(x,S);return Object.setPrototypeOf(T,a.prototype),T};function Q($,x,S){if($%1!==0||$<0)throw new RangeError("offset is not uint");if($+x>S)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(x,S,O){x=x>>>0,S=S>>>0,O||Q(x,S,this.length);let T=this[x],N=1,B=0;for(;++B<S&&(N*=256);)T+=this[x+B]*N;return T},a.prototype.readUintBE=a.prototype.readUIntBE=function(x,S,O){x=x>>>0,S=S>>>0,O||Q(x,S,this.length);let T=this[x+--S],N=1;for(;S>0&&(N*=256);)T+=this[x+--S]*N;return T},a.prototype.readUint8=a.prototype.readUInt8=function(x,S){return x=x>>>0,S||Q(x,1,this.length),this[x]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(x,S){return x=x>>>0,S||Q(x,2,this.length),this[x]|this[x+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(x,S){return x=x>>>0,S||Q(x,2,this.length),this[x]<<8|this[x+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(x,S){return x=x>>>0,S||Q(x,4,this.length),(this[x]|this[x+1]<<8|this[x+2]<<16)+this[x+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(x,S){return x=x>>>0,S||Q(x,4,this.length),this[x]*16777216+(this[x+1]<<16|this[x+2]<<8|this[x+3])},a.prototype.readBigUInt64LE=rs(function(x){x=x>>>0,_t(x,"offset");const S=this[x],O=this[x+7];(S===void 0||O===void 0)&&Yt(x,this.length-8);const T=S+this[++x]*2**8+this[++x]*2**16+this[++x]*2**24,N=this[++x]+this[++x]*2**8+this[++x]*2**16+O*2**24;return BigInt(T)+(BigInt(N)<<BigInt(32))}),a.prototype.readBigUInt64BE=rs(function(x){x=x>>>0,_t(x,"offset");const S=this[x],O=this[x+7];(S===void 0||O===void 0)&&Yt(x,this.length-8);const T=S*2**24+this[++x]*2**16+this[++x]*2**8+this[++x],N=this[++x]*2**24+this[++x]*2**16+this[++x]*2**8+O;return(BigInt(T)<<BigInt(32))+BigInt(N)}),a.prototype.readIntLE=function(x,S,O){x=x>>>0,S=S>>>0,O||Q(x,S,this.length);let T=this[x],N=1,B=0;for(;++B<S&&(N*=256);)T+=this[x+B]*N;return N*=128,T>=N&&(T-=Math.pow(2,8*S)),T},a.prototype.readIntBE=function(x,S,O){x=x>>>0,S=S>>>0,O||Q(x,S,this.length);let T=S,N=1,B=this[x+--T];for(;T>0&&(N*=256);)B+=this[x+--T]*N;return N*=128,B>=N&&(B-=Math.pow(2,8*S)),B},a.prototype.readInt8=function(x,S){return x=x>>>0,S||Q(x,1,this.length),this[x]&128?(255-this[x]+1)*-1:this[x]},a.prototype.readInt16LE=function(x,S){x=x>>>0,S||Q(x,2,this.length);const O=this[x]|this[x+1]<<8;return O&32768?O|4294901760:O},a.prototype.readInt16BE=function(x,S){x=x>>>0,S||Q(x,2,this.length);const O=this[x+1]|this[x]<<8;return O&32768?O|4294901760:O},a.prototype.readInt32LE=function(x,S){return x=x>>>0,S||Q(x,4,this.length),this[x]|this[x+1]<<8|this[x+2]<<16|this[x+3]<<24},a.prototype.readInt32BE=function(x,S){return x=x>>>0,S||Q(x,4,this.length),this[x]<<24|this[x+1]<<16|this[x+2]<<8|this[x+3]},a.prototype.readBigInt64LE=rs(function(x){x=x>>>0,_t(x,"offset");const S=this[x],O=this[x+7];(S===void 0||O===void 0)&&Yt(x,this.length-8);const T=this[x+4]+this[x+5]*2**8+this[x+6]*2**16+(O<<24);return(BigInt(T)<<BigInt(32))+BigInt(S+this[++x]*2**8+this[++x]*2**16+this[++x]*2**24)}),a.prototype.readBigInt64BE=rs(function(x){x=x>>>0,_t(x,"offset");const S=this[x],O=this[x+7];(S===void 0||O===void 0)&&Yt(x,this.length-8);const T=(S<<24)+this[++x]*2**16+this[++x]*2**8+this[++x];return(BigInt(T)<<BigInt(32))+BigInt(this[++x]*2**24+this[++x]*2**16+this[++x]*2**8+O)}),a.prototype.readFloatLE=function(x,S){return x=x>>>0,S||Q(x,4,this.length),t.read(this,x,!0,23,4)},a.prototype.readFloatBE=function(x,S){return x=x>>>0,S||Q(x,4,this.length),t.read(this,x,!1,23,4)},a.prototype.readDoubleLE=function(x,S){return x=x>>>0,S||Q(x,8,this.length),t.read(this,x,!0,52,8)},a.prototype.readDoubleBE=function(x,S){return x=x>>>0,S||Q(x,8,this.length),t.read(this,x,!1,52,8)};function K($,x,S,O,T,N){if(!a.isBuffer($))throw new TypeError('"buffer" argument must be a Buffer instance');if(x>T||x<N)throw new RangeError('"value" argument is out of bounds');if(S+O>$.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(x,S,O,T){if(x=+x,S=S>>>0,O=O>>>0,!T){const J=Math.pow(2,8*O)-1;K(this,x,S,O,J,0)}let N=1,B=0;for(this[S]=x&255;++B<O&&(N*=256);)this[S+B]=x/N&255;return S+O},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(x,S,O,T){if(x=+x,S=S>>>0,O=O>>>0,!T){const J=Math.pow(2,8*O)-1;K(this,x,S,O,J,0)}let N=O-1,B=1;for(this[S+N]=x&255;--N>=0&&(B*=256);)this[S+N]=x/B&255;return S+O},a.prototype.writeUint8=a.prototype.writeUInt8=function(x,S,O){return x=+x,S=S>>>0,O||K(this,x,S,1,255,0),this[S]=x&255,S+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(x,S,O){return x=+x,S=S>>>0,O||K(this,x,S,2,65535,0),this[S]=x&255,this[S+1]=x>>>8,S+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(x,S,O){return x=+x,S=S>>>0,O||K(this,x,S,2,65535,0),this[S]=x>>>8,this[S+1]=x&255,S+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(x,S,O){return x=+x,S=S>>>0,O||K(this,x,S,4,4294967295,0),this[S+3]=x>>>24,this[S+2]=x>>>16,this[S+1]=x>>>8,this[S]=x&255,S+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(x,S,O){return x=+x,S=S>>>0,O||K(this,x,S,4,4294967295,0),this[S]=x>>>24,this[S+1]=x>>>16,this[S+2]=x>>>8,this[S+3]=x&255,S+4};function ce($,x,S,O,T){At(x,O,T,$,S,7);let N=Number(x&BigInt(4294967295));$[S++]=N,N=N>>8,$[S++]=N,N=N>>8,$[S++]=N,N=N>>8,$[S++]=N;let B=Number(x>>BigInt(32)&BigInt(4294967295));return $[S++]=B,B=B>>8,$[S++]=B,B=B>>8,$[S++]=B,B=B>>8,$[S++]=B,S}function me($,x,S,O,T){At(x,O,T,$,S,7);let N=Number(x&BigInt(4294967295));$[S+7]=N,N=N>>8,$[S+6]=N,N=N>>8,$[S+5]=N,N=N>>8,$[S+4]=N;let B=Number(x>>BigInt(32)&BigInt(4294967295));return $[S+3]=B,B=B>>8,$[S+2]=B,B=B>>8,$[S+1]=B,B=B>>8,$[S]=B,S+8}a.prototype.writeBigUInt64LE=rs(function(x,S=0){return ce(this,x,S,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=rs(function(x,S=0){return me(this,x,S,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(x,S,O,T){if(x=+x,S=S>>>0,!T){const he=Math.pow(2,8*O-1);K(this,x,S,O,he-1,-he)}let N=0,B=1,J=0;for(this[S]=x&255;++N<O&&(B*=256);)x<0&&J===0&&this[S+N-1]!==0&&(J=1),this[S+N]=(x/B>>0)-J&255;return S+O},a.prototype.writeIntBE=function(x,S,O,T){if(x=+x,S=S>>>0,!T){const he=Math.pow(2,8*O-1);K(this,x,S,O,he-1,-he)}let N=O-1,B=1,J=0;for(this[S+N]=x&255;--N>=0&&(B*=256);)x<0&&J===0&&this[S+N+1]!==0&&(J=1),this[S+N]=(x/B>>0)-J&255;return S+O},a.prototype.writeInt8=function(x,S,O){return x=+x,S=S>>>0,O||K(this,x,S,1,127,-128),x<0&&(x=255+x+1),this[S]=x&255,S+1},a.prototype.writeInt16LE=function(x,S,O){return x=+x,S=S>>>0,O||K(this,x,S,2,32767,-32768),this[S]=x&255,this[S+1]=x>>>8,S+2},a.prototype.writeInt16BE=function(x,S,O){return x=+x,S=S>>>0,O||K(this,x,S,2,32767,-32768),this[S]=x>>>8,this[S+1]=x&255,S+2},a.prototype.writeInt32LE=function(x,S,O){return x=+x,S=S>>>0,O||K(this,x,S,4,2147483647,-2147483648),this[S]=x&255,this[S+1]=x>>>8,this[S+2]=x>>>16,this[S+3]=x>>>24,S+4},a.prototype.writeInt32BE=function(x,S,O){return x=+x,S=S>>>0,O||K(this,x,S,4,2147483647,-2147483648),x<0&&(x=4294967295+x+1),this[S]=x>>>24,this[S+1]=x>>>16,this[S+2]=x>>>8,this[S+3]=x&255,S+4},a.prototype.writeBigInt64LE=rs(function(x,S=0){return ce(this,x,S,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=rs(function(x,S=0){return me(this,x,S,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function de($,x,S,O,T,N){if(S+O>$.length)throw new RangeError("Index out of range");if(S<0)throw new RangeError("Index out of range")}function ue($,x,S,O,T){return x=+x,S=S>>>0,T||de($,x,S,4),t.write($,x,S,O,23,4),S+4}a.prototype.writeFloatLE=function(x,S,O){return ue(this,x,S,!0,O)},a.prototype.writeFloatBE=function(x,S,O){return ue(this,x,S,!1,O)};function $e($,x,S,O,T){return x=+x,S=S>>>0,T||de($,x,S,8),t.write($,x,S,O,52,8),S+8}a.prototype.writeDoubleLE=function(x,S,O){return $e(this,x,S,!0,O)},a.prototype.writeDoubleBE=function(x,S,O){return $e(this,x,S,!1,O)},a.prototype.copy=function(x,S,O,T){if(!a.isBuffer(x))throw new TypeError("argument should be a Buffer");if(O||(O=0),!T&&T!==0&&(T=this.length),S>=x.length&&(S=x.length),S||(S=0),T>0&&T<O&&(T=O),T===O||x.length===0||this.length===0)return 0;if(S<0)throw new RangeError("targetStart out of bounds");if(O<0||O>=this.length)throw new RangeError("Index out of range");if(T<0)throw new RangeError("sourceEnd out of bounds");T>this.length&&(T=this.length),x.length-S<T-O&&(T=x.length-S+O);const N=T-O;return this===x&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(S,O,T):Uint8Array.prototype.set.call(x,this.subarray(O,T),S),N},a.prototype.fill=function(x,S,O,T){if(typeof x=="string"){if(typeof S=="string"?(T=S,S=0,O=this.length):typeof O=="string"&&(T=O,O=this.length),T!==void 0&&typeof T!="string")throw new TypeError("encoding must be a string");if(typeof T=="string"&&!a.isEncoding(T))throw new TypeError("Unknown encoding: "+T);if(x.length===1){const B=x.charCodeAt(0);(T==="utf8"&&B<128||T==="latin1")&&(x=B)}}else typeof x=="number"?x=x&255:typeof x=="boolean"&&(x=Number(x));if(S<0||this.length<S||this.length<O)throw new RangeError("Out of range index");if(O<=S)return this;S=S>>>0,O=O===void 0?this.length:O>>>0,x||(x=0);let N;if(typeof x=="number")for(N=S;N<O;++N)this[N]=x;else{const B=a.isBuffer(x)?x:a.from(x,T),J=B.length;if(J===0)throw new TypeError('The value "'+x+'" is invalid for argument "value"');for(N=0;N<O-S;++N)this[N+S]=B[N%J]}return this};const Pe={};function Je($,x,S){Pe[$]=class extends S{constructor(){super(),Object.defineProperty(this,"message",{value:x.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${$}]`,this.stack,delete this.name}get code(){return $}set code(T){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:T,writable:!0})}toString(){return`${this.name} [${$}]: ${this.message}`}}}Je("ERR_BUFFER_OUT_OF_BOUNDS",function($){return $?`${$} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Je("ERR_INVALID_ARG_TYPE",function($,x){return`The "${$}" argument must be of type number. Received type ${typeof x}`},TypeError),Je("ERR_OUT_OF_RANGE",function($,x,S){let O=`The value of "${$}" is out of range.`,T=S;return Number.isInteger(S)&&Math.abs(S)>2**32?T=it(String(S)):typeof S=="bigint"&&(T=String(S),(S>BigInt(2)**BigInt(32)||S<-(BigInt(2)**BigInt(32)))&&(T=it(T)),T+="n"),O+=` It must be ${x}. Received ${T}`,O},RangeError);function it($){let x="",S=$.length;const O=$[0]==="-"?1:0;for(;S>=O+4;S-=3)x=`_${$.slice(S-3,S)}${x}`;return`${$.slice(0,S)}${x}`}function St($,x,S){_t(x,"offset"),($[x]===void 0||$[x+S]===void 0)&&Yt(x,$.length-(S+1))}function At($,x,S,O,T,N){if($>S||$<x){const B=typeof x=="bigint"?"n":"";let J;throw x===0||x===BigInt(0)?J=`>= 0${B} and < 2${B} ** ${(N+1)*8}${B}`:J=`>= -(2${B} ** ${(N+1)*8-1}${B}) and < 2 ** ${(N+1)*8-1}${B}`,new Pe.ERR_OUT_OF_RANGE("value",J,$)}St(O,T,N)}function _t($,x){if(typeof $!="number")throw new Pe.ERR_INVALID_ARG_TYPE(x,"number",$)}function Yt($,x,S){throw Math.floor($)!==$?(_t($,S),new Pe.ERR_OUT_OF_RANGE("offset","an integer",$)):x<0?new Pe.ERR_BUFFER_OUT_OF_BOUNDS:new Pe.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${x}`,$)}const Wr=/[^+/0-9A-Za-z-_]/g;function Ac($){if($=$.split("=")[0],$=$.trim().replace(Wr,""),$.length<2)return"";for(;$.length%4!==0;)$=$+"=";return $}function Ko($,x){x=x||1/0;let S;const O=$.length;let T=null;const N=[];for(let B=0;B<O;++B){if(S=$.charCodeAt(B),S>55295&&S<57344){if(!T){if(S>56319){(x-=3)>-1&&N.push(239,191,189);continue}else if(B+1===O){(x-=3)>-1&&N.push(239,191,189);continue}T=S;continue}if(S<56320){(x-=3)>-1&&N.push(239,191,189),T=S;continue}S=(T-55296<<10|S-56320)+65536}else T&&(x-=3)>-1&&N.push(239,191,189);if(T=null,S<128){if((x-=1)<0)break;N.push(S)}else if(S<2048){if((x-=2)<0)break;N.push(S>>6|192,S&63|128)}else if(S<65536){if((x-=3)<0)break;N.push(S>>12|224,S>>6&63|128,S&63|128)}else if(S<1114112){if((x-=4)<0)break;N.push(S>>18|240,S>>12&63|128,S>>6&63|128,S&63|128)}else throw new Error("Invalid code point")}return N}function ou($){const x=[];for(let S=0;S<$.length;++S)x.push($.charCodeAt(S)&255);return x}function au($,x){let S,O,T;const N=[];for(let B=0;B<$.length&&!((x-=2)<0);++B)S=$.charCodeAt(B),O=S>>8,T=S%256,N.push(T),N.push(O);return N}function Cc($){return e.toByteArray(Ac($))}function jo($,x,S,O){let T;for(T=0;T<O&&!(T+S>=x.length||T>=$.length);++T)x[T+S]=$[T];return T}function Xn($,x){return $ instanceof x||$!=null&&$.constructor!=null&&$.constructor.name!=null&&$.constructor.name===x.name}function Th($){return $!==$}const fw=function(){const $="0123456789abcdef",x=new Array(256);for(let S=0;S<16;++S){const O=S*16;for(let T=0;T<16;++T)x[O+T]=$[S]+$[T]}return x}();function rs($){return typeof BigInt>"u"?kc:$}function kc(){throw new Error("BigInt not supported")}})(wm);let Ww=null;var pB=function(){return Ww===null&&(Ww={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),Ww},f0={},cE={};const Gw=Ps,WY=new Set(["buffer","view","utf8"]);let GY=class{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!WY.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new Gw(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new Gw(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new Gw(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};cE.Encoding=GY;const{Buffer:lE}=wm||{},{Encoding:uE}=cE,QY=pB;let dE=class extends uE{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new hE({encode:this.encode,decode:e=>this.decode(lE.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},hE=class extends uE{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new dE({encode:e=>{const t=this.encode(e);return lE.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},YY=class extends uE{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new dE({encode:e=>lE.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){const{textEncoder:e,textDecoder:t}=QY();return new hE({encode:n=>e.encode(this.encode(n)),decode:n=>this.decode(t.decode(n)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};f0.BufferFormat=dE;f0.ViewFormat=hE;f0.UTF8Format=YY;const{Buffer:Kr}=wm||{Buffer:{isBuffer:()=>!1}},{textEncoder:gB,textDecoder:CC}=pB(),{BufferFormat:p0,ViewFormat:fE,UTF8Format:yB}=f0,$g=r=>r;eu.utf8=new yB({encode:function(r){return Kr.isBuffer(r)?r.toString("utf8"):ArrayBuffer.isView(r)?CC.decode(r):String(r)},decode:$g,name:"utf8",createViewTranscoder(){return new fE({encode:function(r){return ArrayBuffer.isView(r)?r:gB.encode(r)},decode:function(r){return CC.decode(r)},name:`${this.name}+view`})},createBufferTranscoder(){return new p0({encode:function(r){return Kr.isBuffer(r)?r:ArrayBuffer.isView(r)?Kr.from(r.buffer,r.byteOffset,r.byteLength):Kr.from(String(r),"utf8")},decode:function(r){return r.toString("utf8")},name:`${this.name}+buffer`})}});eu.json=new yB({encode:JSON.stringify,decode:JSON.parse,name:"json"});eu.buffer=new p0({encode:function(r){return Kr.isBuffer(r)?r:ArrayBuffer.isView(r)?Kr.from(r.buffer,r.byteOffset,r.byteLength):Kr.from(String(r),"utf8")},decode:$g,name:"buffer",createViewTranscoder(){return new fE({encode:function(r){return ArrayBuffer.isView(r)?r:Kr.from(String(r),"utf8")},decode:function(r){return Kr.from(r.buffer,r.byteOffset,r.byteLength)},name:`${this.name}+view`})}});eu.view=new fE({encode:function(r){return ArrayBuffer.isView(r)?r:gB.encode(r)},decode:$g,name:"view",createBufferTranscoder(){return new p0({encode:function(r){return Kr.isBuffer(r)?r:ArrayBuffer.isView(r)?Kr.from(r.buffer,r.byteOffset,r.byteLength):Kr.from(String(r),"utf8")},decode:$g,name:`${this.name}+buffer`})}});eu.hex=new p0({encode:function(r){return Kr.isBuffer(r)?r:Kr.from(String(r),"hex")},decode:function(r){return r.toString("hex")},name:"hex"});eu.base64=new p0({encode:function(r){return Kr.isBuffer(r)?r:Kr.from(String(r),"base64")},decode:function(r){return r.toString("base64")},name:"base64"});const kC=Ps,Pg=eu,{Encoding:JY}=cE,{BufferFormat:XY,ViewFormat:ZY,UTF8Format:eJ}=f0,Fh=Symbol("formats"),fp=Symbol("encodings"),tJ=new Set(["buffer","view","utf8"]);let rJ=class{constructor(e){if(Array.isArray(e)){if(!e.every(t=>tJ.has(t)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[fp]=new Map,this[Fh]=new Set(e);for(const t in Pg)try{this.encoding(t)}catch(n){if(n.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw n}}encodings(){return Array.from(new Set(this[fp].values()))}encoding(e){let t=this[fp].get(e);if(t===void 0){if(typeof e=="string"&&e!==""){if(t=oJ[e],!t)throw new kC(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof e!="object"||e===null)throw new TypeError("First argument 'encoding' must be a string or object");t=nJ(e)}const{name:n,format:i}=t;if(!this[Fh].has(i))if(this[Fh].has("view"))t=t.createViewTranscoder();else if(this[Fh].has("buffer"))t=t.createBufferTranscoder();else if(this[Fh].has("utf8"))t=t.createUTF8Transcoder();else throw new kC(`Encoding '${n}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(const s of[e,n,t.name,t.commonName])this[fp].set(s,t)}return t}};hB.Transcoder=rJ;function nJ(r){if(r instanceof JY)return r;const e="type"in r&&typeof r.type=="string"?r.type:void 0,t=r.name||e||`anonymous-${aJ++}`;switch(iJ(r)){case"view":return new ZY({...r,name:t});case"utf8":return new eJ({...r,name:t});case"buffer":return new XY({...r,name:t});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function iJ(r){return"format"in r&&r.format!==void 0?r.format:"buffer"in r&&typeof r.buffer=="boolean"?r.buffer?"buffer":"utf8":"code"in r&&Number.isInteger(r.code)?"view":"buffer"}const sJ={binary:Pg.buffer,"utf-8":Pg.utf8},oJ={...Pg,...sJ};let aJ=0;var dh={},cJ=typeof queueMicrotask=="function"?queueMicrotask:r=>Promise.resolve().then(r),IC=cJ;dh.fromCallback=function(r,e){if(r===void 0){var t=new Promise(function(n,i){r=function(s,o){s?i(s):n(o)}});r[e!==void 0?e:"promise"]=t}else if(typeof r!="function")throw new TypeError("Callback must be a function");return r};dh.fromPromise=function(r,e){if(e===void 0)return r;r.then(function(t){IC(()=>e(null,t))}).catch(function(t){IC(()=>e(t))})};var Ds={},g0={};g0.getCallback=function(r,e){return typeof r=="function"?r:e};g0.getOptions=function(r,e){return typeof r=="object"&&r!==null?r:e!==void 0?e:{}};const{fromCallback:Qw}=dh,Tn=Ps,{getOptions:Yw,getCallback:_C}=g0,Ic=Symbol("promise"),uu=Symbol("callback"),ss=Symbol("working"),Yc=Symbol("handleOne"),Js=Symbol("handleMany"),Jw=Symbol("autoClose"),tc=Symbol("finishWork"),Es=Symbol("returnMany"),Wo=Symbol("closing"),zh=Symbol("handleClose"),pp=Symbol("closed"),Vh=Symbol("closeCallbacks"),Ha=Symbol("keyEncoding"),xl=Symbol("valueEncoding"),Xw=Symbol("abortOnClose"),gp=Symbol("legacy"),Zw=Symbol("keys"),e8=Symbol("values"),Go=Symbol("limit"),ci=Symbol("count"),yp=Object.freeze({}),lJ=()=>{};let TC=!1;class pE{constructor(e,t,n){if(typeof e!="object"||e===null){const i=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${i}`)}if(typeof t!="object"||t===null)throw new TypeError("The second argument must be an options object");this[pp]=!1,this[Vh]=[],this[ss]=!1,this[Wo]=!1,this[Jw]=!1,this[uu]=null,this[Yc]=this[Yc].bind(this),this[Js]=this[Js].bind(this),this[zh]=this[zh].bind(this),this[Ha]=t[Ha],this[xl]=t[xl],this[gp]=n,this[Go]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[ci]=0,this[Xw]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[ci]}get limit(){return this[Go]}next(e){let t;if(e===void 0)t=new Promise((n,i)=>{e=(s,o,a)=>{s?i(s):this[gp]?o===void 0&&a===void 0?n():n([o,a]):n(o)}});else if(typeof e!="function")throw new TypeError("Callback must be a function");return this[Wo]?this.nextTick(e,new Tn("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[ss]?this.nextTick(e,new Tn("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[ss]=!0,this[uu]=e,this[ci]>=this[Go]?this.nextTick(this[Yc],null):this._next(this[Yc])),t}_next(e){this.nextTick(e)}nextv(e,t,n){return n=_C(t,n),n=Qw(n,Ic),t=Yw(t,yp),Number.isInteger(e)?(this[Wo]?this.nextTick(n,new Tn("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[ss]?this.nextTick(n,new Tn("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[Go]<1/0&&(e=Math.min(e,this[Go]-this[ci])),this[ss]=!0,this[uu]=n,e<=0?this.nextTick(this[Js],null,[]):this._nextv(e,t,this[Js])),n[Ic]):(this.nextTick(n,new TypeError("The first argument 'size' must be an integer")),n[Ic])}_nextv(e,t,n){const i=[],s=(o,a,c)=>{if(o)return n(o);if(this[gp]?a===void 0&&c===void 0:a===void 0)return n(null,i);i.push(this[gp]?[a,c]:a),i.length===e?n(null,i):this._next(s)};this._next(s)}all(e,t){return t=_C(e,t),t=Qw(t,Ic),e=Yw(e,yp),this[Wo]?this.nextTick(t,new Tn("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[ss]?this.nextTick(t,new Tn("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[ss]=!0,this[uu]=t,this[Jw]=!0,this[ci]>=this[Go]?this.nextTick(this[Js],null,[]):this._all(e,this[Js])),t[Ic]}_all(e,t){let n=this[ci];const i=[],s=()=>{const a=this[Go]<1/0?Math.min(1e3,this[Go]-n):1e3;a<=0?this.nextTick(t,null,i):this._nextv(a,yp,o)},o=(a,c)=>{a?t(a):c.length===0?t(null,i):(i.push.apply(i,c),n+=c.length,s())};s()}[tc](){const e=this[uu];return this[Xw]&&e===null?lJ:(this[ss]=!1,this[uu]=null,this[Wo]&&this._close(this[zh]),e)}[Es](e,t,n){this[Jw]?this.close(e.bind(null,t,n)):e(t,n)}seek(e,t){if(t=Yw(t,yp),!this[Wo]){if(this[ss])throw new Tn("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const n=this.db.keyEncoding(t.keyEncoding||this[Ha]),i=n.format;t.keyEncoding!==i&&(t={...t,keyEncoding:i});const s=this.db.prefixKey(n.encode(e),i);this._seek(s,t)}}}_seek(e,t){throw new Tn("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){return e=Qw(e,Ic),this[pp]?this.nextTick(e):this[Wo]?this[Vh].push(e):(this[Wo]=!0,this[Vh].push(e),this[ss]?this[Xw]&&this[tc]()(new Tn("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[zh])),e[Ic]}_close(e){this.nextTick(e)}[zh](){this[pp]=!0,this.db.detachResource(this);const e=this[Vh];this[Vh]=[];for(const t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;(e=await this.next())!==void 0;)yield e}finally{this[pp]||await this.close()}}}let vm=class extends pE{constructor(e,t){super(e,t,!0),this[Zw]=t.keys!==!1,this[e8]=t.values!==!1}[Yc](e,t,n){const i=this[tc]();if(e)return i(e);try{t=this[Zw]&&t!==void 0?this[Ha].decode(t):void 0,n=this[e8]&&n!==void 0?this[xl].decode(n):void 0}catch(s){return i(new Ed("entry",s))}t===void 0&&n===void 0||this[ci]++,i(null,t,n)}[Js](e,t){const n=this[tc]();if(e)return this[Es](n,e);try{for(const i of t){const s=i[0],o=i[1];i[0]=this[Zw]&&s!==void 0?this[Ha].decode(s):void 0,i[1]=this[e8]&&o!==void 0?this[xl].decode(o):void 0}}catch(i){return this[Es](n,new Ed("entries",i))}this[ci]+=t.length,this[Es](n,null,t)}end(e){return!TC&&typeof console<"u"&&(TC=!0,console.warn(new Tn("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}},uJ=class extends pE{constructor(e,t){super(e,t,!1)}[Yc](e,t){const n=this[tc]();if(e)return n(e);try{t=t!==void 0?this[Ha].decode(t):void 0}catch(i){return n(new Ed("key",i))}t!==void 0&&this[ci]++,n(null,t)}[Js](e,t){const n=this[tc]();if(e)return this[Es](n,e);try{for(let i=0;i<t.length;i++){const s=t[i];t[i]=s!==void 0?this[Ha].decode(s):void 0}}catch(i){return this[Es](n,new Ed("keys",i))}this[ci]+=t.length,this[Es](n,null,t)}},dJ=class extends pE{constructor(e,t){super(e,t,!1)}[Yc](e,t){const n=this[tc]();if(e)return n(e);try{t=t!==void 0?this[xl].decode(t):void 0}catch(i){return n(new Ed("value",i))}t!==void 0&&this[ci]++,n(null,t)}[Js](e,t){const n=this[tc]();if(e)return this[Es](n,e);try{for(let i=0;i<t.length;i++){const s=t[i];t[i]=s!==void 0?this[xl].decode(s):void 0}}catch(i){return this[Es](n,new Ed("values",i))}this[ci]+=t.length,this[Es](n,null,t)}};class Ed extends Tn{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}}for(const r of["_ended property","_nexting property","_end method"])Object.defineProperty(vm.prototype,r.split(" ")[0],{get(){throw new Tn(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new Tn(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})}});vm.keyEncoding=Ha;vm.valueEncoding=xl;Ds.AbstractIterator=vm;Ds.AbstractKeyIterator=uJ;Ds.AbstractValueIterator=dJ;var gE={};const{AbstractKeyIterator:hJ,AbstractValueIterator:fJ}=Ds,zc=Symbol("iterator"),Kh=Symbol("callback"),xd=Symbol("handleOne"),ll=Symbol("handleMany");let N6=class extends hJ{constructor(e,t){super(e,t),this[zc]=e.iterator({...t,keys:!0,values:!1}),this[xd]=this[xd].bind(this),this[ll]=this[ll].bind(this)}},mB=class extends fJ{constructor(e,t){super(e,t),this[zc]=e.iterator({...t,keys:!1,values:!0}),this[xd]=this[xd].bind(this),this[ll]=this[ll].bind(this)}};for(const r of[N6,mB]){const e=r===N6,t=e?n=>n[0]:n=>n[1];r.prototype._next=function(n){this[Kh]=n,this[zc].next(this[xd])},r.prototype[xd]=function(n,i,s){const o=this[Kh];n?o(n):o(null,e?i:s)},r.prototype._nextv=function(n,i,s){this[Kh]=s,this[zc].nextv(n,i,this[ll])},r.prototype._all=function(n,i){this[Kh]=i,this[zc].all(n,this[ll])},r.prototype[ll]=function(n,i){const s=this[Kh];n?s(n):s(null,i.map(t))},r.prototype._seek=function(n,i){this[zc].seek(n,i)},r.prototype._close=function(n){this[zc].close(n)}}gE.DefaultKeyIterator=N6;gE.DefaultValueIterator=mB;var Em={};const{AbstractIterator:pJ,AbstractKeyIterator:gJ,AbstractValueIterator:yJ}=Ds,t8=Ps,ln=Symbol("nut"),xm=Symbol("undefer"),Sm=Symbol("factory");let wB=class extends pJ{constructor(e,t){super(e,t),this[ln]=null,this[Sm]=()=>e.iterator(t),this.db.defer(()=>this[xm]())}},bB=class extends gJ{constructor(e,t){super(e,t),this[ln]=null,this[Sm]=()=>e.keys(t),this.db.defer(()=>this[xm]())}},vB=class extends yJ{constructor(e,t){super(e,t),this[ln]=null,this[Sm]=()=>e.values(t),this.db.defer(()=>this[xm]())}};for(const r of[wB,bB,vB])r.prototype[xm]=function(){this.db.status==="open"&&(this[ln]=this[Sm]())},r.prototype._next=function(e){this[ln]!==null?this[ln].next(e):this.db.status==="opening"?this.db.defer(()=>this._next(e)):this.nextTick(e,new t8("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._nextv=function(e,t,n){this[ln]!==null?this[ln].nextv(e,t,n):this.db.status==="opening"?this.db.defer(()=>this._nextv(e,t,n)):this.nextTick(n,new t8("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._all=function(e,t){this[ln]!==null?this[ln].all(t):this.db.status==="opening"?this.db.defer(()=>this._all(e,t)):this.nextTick(t,new t8("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._seek=function(e,t){this[ln]!==null?this[ln]._seek(e,t):this.db.status==="opening"&&this.db.defer(()=>this._seek(e,t))},r.prototype._close=function(e){this[ln]!==null?this[ln].close(e):this.db.status==="opening"?this.db.defer(()=>this._close(e)):this.nextTick(e)};Em.DeferredIterator=wB;Em.DeferredKeyIterator=bB;Em.DeferredValueIterator=vB;var EB={},yE={};const{fromCallback:$C}=dh,mp=Ps,{getCallback:mJ,getOptions:wJ}=g0,wp=Symbol("promise"),Zn=Symbol("status"),du=Symbol("operations"),jh=Symbol("finishClose"),hu=Symbol("closeCallbacks");let bJ=class{constructor(e){if(typeof e!="object"||e===null){const t=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${t}`)}this[du]=[],this[hu]=[],this[Zn]="open",this[jh]=this[jh].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[du].length}put(e,t,n){if(this[Zn]!=="open")throw new mp("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const i=this.db._checkKey(e)||this.db._checkValue(t);if(i)throw i;const s=n&&n.sublevel!=null?n.sublevel:this.db,o=n,a=s.keyEncoding(n&&n.keyEncoding),c=s.valueEncoding(n&&n.valueEncoding),l=a.format;n={...n,keyEncoding:l,valueEncoding:c.format},s!==this.db&&(n.sublevel=null);const d=s.prefixKey(a.encode(e),l),h=c.encode(t);return this._put(d,h,n),this[du].push({...o,type:"put",key:e,value:t}),this}_put(e,t,n){}del(e,t){if(this[Zn]!=="open")throw new mp("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const n=this.db._checkKey(e);if(n)throw n;const i=t&&t.sublevel!=null?t.sublevel:this.db,s=t,o=i.keyEncoding(t&&t.keyEncoding),a=o.format;return t={...t,keyEncoding:a},i!==this.db&&(t.sublevel=null),this._del(i.prefixKey(o.encode(e),a),t),this[du].push({...s,type:"del",key:e}),this}_del(e,t){}clear(){if(this[Zn]!=="open")throw new mp("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[du]=[],this}_clear(){}write(e,t){return t=mJ(e,t),t=$C(t,wp),e=wJ(e),this[Zn]!=="open"?this.nextTick(t,new mp("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(t):(this[Zn]="writing",this._write(e,n=>{this[Zn]="closing",this[hu].push(()=>t(n)),n||this.db.emit("batch",this[du]),this._close(this[jh])})),t[wp]}_write(e,t){}close(e){return e=$C(e,wp),this[Zn]==="closing"?this[hu].push(e):this[Zn]==="closed"?this.nextTick(e):(this[hu].push(e),this[Zn]!=="writing"&&(this[Zn]="closing",this._close(this[jh]))),e[wp]}_close(e){this.nextTick(e)}[jh](){this[Zn]="closed",this.db.detachResource(this);const e=this[hu];this[hu]=[];for(const t of e)t()}};yE.AbstractChainedBatch=bJ;const{AbstractChainedBatch:vJ}=yE,EJ=Ps,fu=Symbol("encoded");let xJ=class extends vJ{constructor(e){super(e),this[fu]=[]}_put(e,t,n){this[fu].push({...n,type:"put",key:e,value:t})}_del(e,t){this[fu].push({...t,type:"del",key:e})}_clear(){this[fu]=[]}_write(e,t){this.db.status==="opening"?this.db.defer(()=>this._write(e,t)):this.db.status==="open"?this[fu].length===0?this.nextTick(t):this.db._batch(this[fu],e,t):this.nextTick(t,new EJ("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};EB.DefaultChainedBatch=xJ;const PC=Ps,SJ=Object.prototype.hasOwnProperty,AJ=new Set(["lt","lte","gt","gte"]);var CJ=function(r,e){const t={};for(const n in r)if(SJ.call(r,n)&&!(n==="keyEncoding"||n==="valueEncoding")){if(n==="start"||n==="end")throw new PC(`The legacy range option '${n}' has been removed`,{code:"LEVEL_LEGACY"});if(n==="encoding")throw new PC("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});AJ.has(n)?t[n]=e.encode(r[n]):t[n]=r[n]}return t.reverse=!!t.reverse,t.limit=Number.isInteger(t.limit)&&t.limit>=0?t.limit:-1,t};/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let DC;var xB=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:Jf):r=>(DC||(DC=Promise.resolve())).then(r).catch(e=>setTimeout(()=>{throw e},0)),r8,NC;function kJ(){if(NC)return r8;NC=1;const r=xB;return r8=function(e,...t){t.length===0?r(e):r(()=>e(...t))},r8}var Hh={},OC;function IJ(){if(OC)return Hh;OC=1;const{AbstractIterator:r,AbstractKeyIterator:e,AbstractValueIterator:t}=Ds,n=Symbol("unfix"),i=Symbol("iterator"),s=Symbol("handleOne"),o=Symbol("handleMany"),a=Symbol("callback");class c extends r{constructor(p,b,f,g){super(p,b),this[i]=f,this[n]=g,this[s]=this[s].bind(this),this[o]=this[o].bind(this),this[a]=null}[s](p,b,f){const g=this[a];if(p)return g(p);b!==void 0&&(b=this[n](b)),g(p,b,f)}[o](p,b){const f=this[a];if(p)return f(p);for(const g of b){const v=g[0];v!==void 0&&(g[0]=this[n](v))}f(p,b)}}class l extends e{constructor(p,b,f,g){super(p,b),this[i]=f,this[n]=g,this[s]=this[s].bind(this),this[o]=this[o].bind(this),this[a]=null}[s](p,b){const f=this[a];if(p)return f(p);b!==void 0&&(b=this[n](b)),f(p,b)}[o](p,b){const f=this[a];if(p)return f(p);for(let g=0;g<b.length;g++){const v=b[g];v!==void 0&&(b[g]=this[n](v))}f(p,b)}}class d extends t{constructor(p,b,f){super(p,b),this[i]=f}}for(const h of[c,l])h.prototype._next=function(p){this[a]=p,this[i].next(this[s])},h.prototype._nextv=function(p,b,f){this[a]=f,this[i].nextv(p,b,this[o])},h.prototype._all=function(p,b){this[a]=b,this[i].all(p,this[o])};for(const h of[d])h.prototype._next=function(p){this[i].next(p)},h.prototype._nextv=function(p,b,f){this[i].nextv(p,b,f)},h.prototype._all=function(p,b){this[i].all(p,b)};for(const h of[c,l,d])h.prototype._seek=function(p,b){this[i].seek(p,b)},h.prototype._close=function(p){this[i].close(p)};return Hh.AbstractSublevelIterator=c,Hh.AbstractSublevelKeyIterator=l,Hh.AbstractSublevelValueIterator=d,Hh}var n8,RC;function _J(){if(RC)return n8;RC=1;const r=Ps,{Buffer:e}=wm||{},{AbstractSublevelIterator:t,AbstractSublevelKeyIterator:n,AbstractSublevelValueIterator:i}=IJ(),s=Symbol("prefix"),o=Symbol("upperBound"),a=Symbol("prefixRange"),c=Symbol("parent"),l=Symbol("unfix"),d=new TextEncoder,h={separator:"!"};n8=function({AbstractLevel:y}){class w extends y{static defaults(E){if(typeof E=="string")throw new r("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(E&&E.open)throw new r("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return E==null?h:E.separator?E:{...E,separator:"!"}}constructor(E,C,k){const{separator:A,manifest:I,...D}=w.defaults(k);C=v(C,A);const F=A.charCodeAt(0)+1,W=E[c]||E;if(!d.encode(C).every(j=>j>F&&j<127))throw new r(`Prefix must use bytes > ${F} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(p(W,I),D);const U=(E.prefix||"")+A+C+A,Y=U.slice(0,-1)+String.fromCharCode(F);this[c]=W,this[s]=new f(U),this[o]=new f(Y),this[l]=new g,this.nextTick=W.nextTick}prefixKey(E,C){if(C==="utf8")return this[s].utf8+E;if(E.byteLength===0)return this[s][C];if(C==="view"){const k=this[s].view,A=new Uint8Array(k.byteLength+E.byteLength);return A.set(k,0),A.set(E,k.byteLength),A}else{const k=this[s].buffer;return e.concat([k,E],k.byteLength+E.byteLength)}}[a](E,C){E.gte!==void 0?E.gte=this.prefixKey(E.gte,C):E.gt!==void 0?E.gt=this.prefixKey(E.gt,C):E.gte=this[s][C],E.lte!==void 0?E.lte=this.prefixKey(E.lte,C):E.lt!==void 0?E.lt=this.prefixKey(E.lt,C):E.lte=this[o][C]}get prefix(){return this[s].utf8}get db(){return this[c]}_open(E,C){this[c].open({passive:!0},C)}_put(E,C,k,A){this[c].put(E,C,k,A)}_get(E,C,k){this[c].get(E,C,k)}_getMany(E,C,k){this[c].getMany(E,C,k)}_del(E,C,k){this[c].del(E,C,k)}_batch(E,C,k){this[c].batch(E,C,k)}_clear(E,C){this[a](E,E.keyEncoding),this[c].clear(E,C)}_iterator(E){this[a](E,E.keyEncoding);const C=this[c].iterator(E),k=this[l].get(this[s].utf8.length,E.keyEncoding);return new t(this,E,C,k)}_keys(E){this[a](E,E.keyEncoding);const C=this[c].keys(E),k=this[l].get(this[s].utf8.length,E.keyEncoding);return new n(this,E,C,k)}_values(E){this[a](E,E.keyEncoding);const C=this[c].values(E);return new i(this,E,C)}}return{AbstractSublevel:w}};const p=function(y,w){return{...y.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...w,encodings:{utf8:b(y,"utf8"),buffer:b(y,"buffer"),view:b(y,"view")}}},b=function(y,w){return y.supports.encodings[w]?y.keyEncoding(w).name===w:!1};class f{constructor(w){this.utf8=w,this.view=d.encode(w),this.buffer=e?e.from(this.view.buffer,0,this.view.byteLength):{}}}class g{constructor(){this.cache=new Map}get(w,m){let E=this.cache.get(m);return E===void 0&&(m==="view"?E=(function(C,k){return k.subarray(C)}).bind(null,w):E=(function(C,k){return k.slice(C)}).bind(null,w),this.cache.set(m,E)),E}}const v=function(y,w){let m=0,E=y.length;for(;m<E&&y[m]===w;)m++;for(;E>m&&y[E-1]===w;)E--;return y.slice(m,E)};return n8}const{supports:TJ}=dB,{Transcoder:$J}=hB,{EventEmitter:PJ}=BR,{fromCallback:Qo}=dh,$i=Ps,{AbstractIterator:_c}=Ds,{DefaultKeyIterator:DJ,DefaultValueIterator:NJ}=gE,{DeferredIterator:OJ,DeferredKeyIterator:RJ,DeferredValueIterator:BJ}=Em,{DefaultChainedBatch:BC}=EB,{getCallback:Tc,getOptions:Yo}=g0,bp=CJ,Le=Symbol("promise"),Ms=Symbol("landed"),$c=Symbol("resources"),i8=Symbol("closeResources"),qh=Symbol("operations"),Wh=Symbol("undefer"),vp=Symbol("deferOpen"),LC=Symbol("options"),Ue=Symbol("status"),Pc=Symbol("defaultOptions"),pu=Symbol("transcoder"),Ep=Symbol("keyEncoding"),s8=Symbol("valueEncoding"),LJ=()=>{};let mE=class extends PJ{constructor(e,t){if(super(),typeof e!="object"||e===null)throw new TypeError("The first argument 'manifest' must be an object");t=Yo(t);const{keyEncoding:n,valueEncoding:i,passive:s,...o}=t;this[$c]=new Set,this[qh]=[],this[vp]=!0,this[LC]=o,this[Ue]="opening",this.supports=TJ(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:e.snapshots!==!1,permanence:e.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[pu]=new $J(MJ(this)),this[Ep]=this[pu].encoding(n||"utf8"),this[s8]=this[pu].encoding(i||"utf8");for(const a of this[pu].encodings())this.supports.encodings[a.commonName]||(this.supports.encodings[a.commonName]=!0);this[Pc]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[Ep].commonName,valueEncoding:this[s8].commonName}),key:Object.freeze({keyEncoding:this[Ep].commonName})},this.nextTick(()=>{this[vp]&&this.open({passive:!1},LJ)})}get status(){return this[Ue]}keyEncoding(e){return this[pu].encoding(e??this[Ep])}valueEncoding(e){return this[pu].encoding(e??this[s8])}open(e,t){t=Tc(e,t),t=Qo(t,Le),e={...this[LC],...Yo(e)},e.createIfMissing=e.createIfMissing!==!1,e.errorIfExists=!!e.errorIfExists;const n=i=>{this[Ue]==="closing"||this[Ue]==="opening"?this.once(Ms,i?()=>n(i):n):this[Ue]!=="open"?t(new $i("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:i})):t()};return e.passive?this[Ue]==="opening"?this.once(Ms,n):this.nextTick(n):this[Ue]==="closed"||this[vp]?(this[vp]=!1,this[Ue]="opening",this.emit("opening"),this._open(e,i=>{if(i){this[Ue]="closed",this[i8](()=>{this.emit(Ms),n(i)}),this[Wh]();return}this[Ue]="open",this[Wh](),this.emit(Ms),this[Ue]==="open"&&this.emit("open"),this[Ue]==="open"&&this.emit("ready"),n()})):this[Ue]==="open"?this.nextTick(n):this.once(Ms,()=>this.open(e,t)),t[Le]}_open(e,t){this.nextTick(t)}close(e){e=Qo(e,Le);const t=n=>{this[Ue]==="opening"||this[Ue]==="closing"?this.once(Ms,n?t(n):t):this[Ue]!=="closed"?e(new $i("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:n})):e()};if(this[Ue]==="open"){this[Ue]="closing",this.emit("closing");const n=i=>{this[Ue]="open",this[Wh](),this.emit(Ms),t(i)};this[i8](()=>{this._close(i=>{if(i)return n(i);this[Ue]="closed",this[Wh](),this.emit(Ms),this[Ue]==="closed"&&this.emit("closed"),t()})})}else this[Ue]==="closed"?this.nextTick(t):this.once(Ms,()=>this.close(e));return e[Le]}[i8](e){if(this[$c].size===0)return this.nextTick(e);let t=this[$c].size,n=!0;const i=()=>{--t===0&&(n?this.nextTick(e):e())};for(const s of this[$c])s.close(i);n=!1,this[$c].clear()}_close(e){this.nextTick(e)}get(e,t,n){if(n=Tc(t,n),n=Qo(n,Le),t=Yo(t,this[Pc].entry),this[Ue]==="opening")return this.defer(()=>this.get(e,t,n)),n[Le];if(gu(this,n))return n[Le];const i=this._checkKey(e);if(i)return this.nextTick(n,i),n[Le];const s=this.keyEncoding(t.keyEncoding),o=this.valueEncoding(t.valueEncoding),a=s.format,c=o.format;return(t.keyEncoding!==a||t.valueEncoding!==c)&&(t=Object.assign({},t,{keyEncoding:a,valueEncoding:c})),this._get(this.prefixKey(s.encode(e),a),t,(l,d)=>{if(l)return(l.code==="LEVEL_NOT_FOUND"||l.notFound||/NotFound/i.test(l))&&(l.code||(l.code="LEVEL_NOT_FOUND"),l.notFound||(l.notFound=!0),l.status||(l.status=404)),n(l);try{d=o.decode(d)}catch(h){return n(new $i("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:h}))}n(null,d)}),n[Le]}_get(e,t,n){this.nextTick(n,new Error("NotFound"))}getMany(e,t,n){if(n=Tc(t,n),n=Qo(n,Le),t=Yo(t,this[Pc].entry),this[Ue]==="opening")return this.defer(()=>this.getMany(e,t,n)),n[Le];if(gu(this,n))return n[Le];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'keys' must be an array")),n[Le];if(e.length===0)return this.nextTick(n,null,[]),n[Le];const i=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),o=i.format,a=s.format;(t.keyEncoding!==o||t.valueEncoding!==a)&&(t=Object.assign({},t,{keyEncoding:o,valueEncoding:a}));const c=new Array(e.length);for(let l=0;l<e.length;l++){const d=e[l],h=this._checkKey(d);if(h)return this.nextTick(n,h),n[Le];c[l]=this.prefixKey(i.encode(d),o)}return this._getMany(c,t,(l,d)=>{if(l)return n(l);try{for(let h=0;h<d.length;h++)d[h]!==void 0&&(d[h]=s.decode(d[h]))}catch(h){return n(new $i(`Could not decode one or more of ${d.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:h}))}n(null,d)}),n[Le]}_getMany(e,t,n){this.nextTick(n,null,new Array(e.length).fill(void 0))}put(e,t,n,i){if(i=Tc(n,i),i=Qo(i,Le),n=Yo(n,this[Pc].entry),this[Ue]==="opening")return this.defer(()=>this.put(e,t,n,i)),i[Le];if(gu(this,i))return i[Le];const s=this._checkKey(e)||this._checkValue(t);if(s)return this.nextTick(i,s),i[Le];const o=this.keyEncoding(n.keyEncoding),a=this.valueEncoding(n.valueEncoding),c=o.format,l=a.format;(n.keyEncoding!==c||n.valueEncoding!==l)&&(n=Object.assign({},n,{keyEncoding:c,valueEncoding:l}));const d=this.prefixKey(o.encode(e),c),h=a.encode(t);return this._put(d,h,n,p=>{if(p)return i(p);this.emit("put",e,t),i()}),i[Le]}_put(e,t,n,i){this.nextTick(i)}del(e,t,n){if(n=Tc(t,n),n=Qo(n,Le),t=Yo(t,this[Pc].key),this[Ue]==="opening")return this.defer(()=>this.del(e,t,n)),n[Le];if(gu(this,n))return n[Le];const i=this._checkKey(e);if(i)return this.nextTick(n,i),n[Le];const s=this.keyEncoding(t.keyEncoding),o=s.format;return t.keyEncoding!==o&&(t=Object.assign({},t,{keyEncoding:o})),this._del(this.prefixKey(s.encode(e),o),t,a=>{if(a)return n(a);this.emit("del",e),n()}),n[Le]}_del(e,t,n){this.nextTick(n)}batch(e,t,n){if(!arguments.length){if(this[Ue]==="opening")return new BC(this);if(this[Ue]!=="open")throw new $i("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof e=="function"?n=e:n=Tc(t,n),n=Qo(n,Le),t=Yo(t,this[Pc].empty),this[Ue]==="opening")return this.defer(()=>this.batch(e,t,n)),n[Le];if(gu(this,n))return n[Le];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'operations' must be an array")),n[Le];if(e.length===0)return this.nextTick(n),n[Le];const i=new Array(e.length),{keyEncoding:s,valueEncoding:o,...a}=t;for(let c=0;c<e.length;c++){if(typeof e[c]!="object"||e[c]===null)return this.nextTick(n,new TypeError("A batch operation must be an object")),n[Le];const l=Object.assign({},e[c]);if(l.type!=="put"&&l.type!=="del")return this.nextTick(n,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),n[Le];const d=this._checkKey(l.key);if(d)return this.nextTick(n,d),n[Le];const h=l.sublevel!=null?l.sublevel:this,p=h.keyEncoding(l.keyEncoding||s),b=p.format;if(l.key=h.prefixKey(p.encode(l.key),b),l.keyEncoding=b,l.type==="put"){const f=this._checkValue(l.value);if(f)return this.nextTick(n,f),n[Le];const g=h.valueEncoding(l.valueEncoding||o);l.value=g.encode(l.value),l.valueEncoding=g.format}h!==this&&(l.sublevel=null),i[c]=l}return this._batch(i,a,c=>{if(c)return n(c);this.emit("batch",e),n()}),n[Le]}_batch(e,t,n){this.nextTick(n)}sublevel(e,t){return this._sublevel(e,O6.defaults(t))}_sublevel(e,t){return new O6(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=Tc(e,t),t=Qo(t,Le),e=Yo(e,this[Pc].empty),this[Ue]==="opening")return this.defer(()=>this.clear(e,t)),t[Le];if(gu(this,t))return t[Le];const n=e,i=this.keyEncoding(e.keyEncoding);return e=bp(e,i),e.keyEncoding=i.format,e.limit===0?this.nextTick(t):this._clear(e,s=>{if(s)return t(s);this.emit("clear",n),t()}),t[Le]}_clear(e,t){this.nextTick(t)}iterator(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=bp(e,t),e.keys=e.keys!==!1,e.values=e.values!==!1,e[_c.keyEncoding]=t,e[_c.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[Ue]==="opening")return new OJ(this,e);if(this[Ue]!=="open")throw new $i("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new _c(this,e)}keys(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=bp(e,t),e[_c.keyEncoding]=t,e[_c.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[Ue]==="opening")return new RJ(this,e);if(this[Ue]!=="open")throw new $i("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new DJ(this,e)}values(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=bp(e,t),e[_c.keyEncoding]=t,e[_c.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[Ue]==="opening")return new BJ(this,e);if(this[Ue]!=="open")throw new $i("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new NJ(this,e)}defer(e){if(typeof e!="function")throw new TypeError("The first argument must be a function");this[qh].push(e)}[Wh](){if(this[qh].length===0)return;const e=this[qh];this[qh]=[];for(const t of e)t()}attachResource(e){if(typeof e!="object"||e===null||typeof e.close!="function")throw new TypeError("The first argument must be a resource object");this[$c].add(e)}detachResource(e){this[$c].delete(e)}_chainedBatch(){return new BC(this)}_checkKey(e){if(e==null)return new $i("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(e==null)return new $i("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};mE.prototype.nextTick=kJ();const{AbstractSublevel:O6}=_J()({AbstractLevel:mE});mm.AbstractLevel=mE;mm.AbstractSublevel=O6;const gu=function(r,e){return r[Ue]!=="open"?(r.nextTick(e,new $i("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},MJ=function(r){return Object.keys(r.supports.encodings).filter(e=>!!r.supports.encodings[e])};yc.AbstractLevel=mm.AbstractLevel;yc.AbstractSublevel=mm.AbstractSublevel;yc.AbstractIterator=Ds.AbstractIterator;yc.AbstractKeyIterator=Ds.AbstractKeyIterator;yc.AbstractValueIterator=Ds.AbstractValueIterator;yc.AbstractChainedBatch=yE.AbstractChainedBatch;/*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var UJ=zJ;const FJ=xB;function zJ(r,e,t){if(typeof e!="number")throw new Error("second argument must be a Number");let n,i,s,o,a,c=!0,l;Array.isArray(r)?(n=[],s=i=r.length):(o=Object.keys(r),n={},s=i=o.length);function d(p){function b(){t&&t(p,n),t=null}c?FJ(b):b()}function h(p,b,f){if(n[p]=f,b&&(a=!0),--s===0||b)d(b);else if(!a&&l<i){let g;o?(g=o[l],l+=1,r[g](function(v,y){h(g,v,y)})):(g=l,l+=1,r[g](function(v,y){h(g,v,y)}))}}l=e,s?o?o.some(function(p,b){return r[p](function(f,g){h(p,f,g)}),b===e-1}):r.some(function(p,b){return p(function(f,g){h(b,f,g)}),b===e-1}):d(null),c=!1}var SB={},AB=function(e){const t=e.gte!==void 0?e.gte:e.gt!==void 0?e.gt:void 0,n=e.lte!==void 0?e.lte:e.lt!==void 0?e.lt:void 0,i=e.gte===void 0,s=e.lte===void 0;return t!==void 0&&n!==void 0?IDBKeyRange.bound(t,n,i,s):t!==void 0?IDBKeyRange.lowerBound(t,i):n!==void 0?IDBKeyRange.upperBound(n,s):null};const VJ=new TextEncoder;var CB=function(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):VJ.encode(r)};const{AbstractIterator:KJ}=yc,MC=AB,xp=CB,os=Symbol("cache"),Us=Symbol("finished"),kn=Symbol("options"),Fs=Symbol("currentOptions"),Dc=Symbol("position"),o8=Symbol("location"),yu=Symbol("first"),UC={};let jJ=class extends KJ{constructor(e,t,n){super(e,n),this[os]=[],this[Us]=this.limit===0,this[kn]=n,this[Fs]={...n},this[Dc]=void 0,this[o8]=t,this[yu]=!0}_nextv(e,t,n){if(this[yu]=!1,this[Us])return this.nextTick(n,null,[]);if(this[os].length>0)return e=Math.min(e,this[os].length),this.nextTick(n,null,this[os].splice(0,e));this[Dc]!==void 0&&(this[kn].reverse?(this[Fs].lt=this[Dc],this[Fs].lte=void 0):(this[Fs].gt=this[Dc],this[Fs].gte=void 0));let i;try{i=MC(this[Fs])}catch{return this[Us]=!0,this.nextTick(n,null,[])}const s=this.db.db.transaction([this[o8]],"readonly"),o=s.objectStore(this[o8]),a=[];if(this[kn].reverse){const c=!this[kn].values&&o.openKeyCursor?"openKeyCursor":"openCursor";o[c](i,"prev").onsuccess=l=>{const d=l.target.result;if(d){const{key:h,value:p}=d;this[Dc]=h,a.push([this[kn].keys&&h!==void 0?xp(h):void 0,this[kn].values&&p!==void 0?xp(p):void 0]),a.length<e?d.continue():FC(s)}else this[Us]=!0}}else{let c,l;const d=()=>{if(c===void 0||l===void 0)return;const h=Math.max(c.length,l.length);h===0||e===1/0?this[Us]=!0:this[Dc]=c[h-1],a.length=h;for(let p=0;p<h;p++){const b=c[p],f=l[p];a[p]=[this[kn].keys&&b!==void 0?xp(b):void 0,this[kn].values&&f!==void 0?xp(f):void 0]}FC(s)};this[kn].keys||e<1/0?o.getAllKeys(i,e<1/0?e:void 0).onsuccess=h=>{c=h.target.result,d()}:(c=[],this.nextTick(d)),this[kn].values?o.getAll(i,e<1/0?e:void 0).onsuccess=h=>{l=h.target.result,d()}:(l=[],this.nextTick(d))}s.onabort=()=>{n(s.error||new Error("aborted by user")),n=null},s.oncomplete=()=>{n(null,a),n=null}}_next(e){if(this[os].length>0){const[t,n]=this[os].shift();this.nextTick(e,null,t,n)}else if(this[Us])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[yu]&&(this[yu]=!1,t=1),this._nextv(t,UC,(n,i)=>{if(n)return e(n);this[os]=i,this._next(e)})}}_all(e,t){this[yu]=!1;const n=this[os].splice(0,this[os].length),i=this.limit-this.count-n.length;if(i<=0)return this.nextTick(t,null,n);this._nextv(i,UC,(s,o)=>{if(s)return t(s);n.length>0&&(o=n.concat(o)),t(null,o)})}_seek(e,t){this[yu]=!0,this[os]=[],this[Us]=!1,this[Dc]=void 0,this[Fs]={...this[kn]};let n;try{n=MC(this[kn])}catch{this[Us]=!0;return}n!==null&&!n.includes(e)?this[Us]=!0:this[kn].reverse?this[Fs].lte=e:this[Fs].gte=e}};SB.Iterator=jJ;function FC(r){typeof r.commit=="function"&&r.commit()}var HJ=function(e,t,n,i,s){if(i.limit===0)return e.nextTick(s);const o=e.db.transaction([t],"readwrite"),a=o.objectStore(t);let c=0;o.oncomplete=function(){s()},o.onabort=function(){s(o.error||new Error("aborted by user"))};const l=a.openKeyCursor?"openKeyCursor":"openCursor",d=i.reverse?"prev":"next";a[l](n,d).onsuccess=function(h){const p=h.target.result;p&&(a.delete(p.key).onsuccess=function(){(i.limit<=0||++c<i.limit)&&p.continue()})}};const{AbstractLevel:qJ}=yc,zC=Ps,WJ=UJ,{fromCallback:GJ}=dh,{Iterator:QJ}=SB,VC=CB,YJ=HJ,JJ=AB,kB="level-js-",Gh=Symbol("idb"),a8=Symbol("namePrefix"),zs=Symbol("location"),c8=Symbol("version"),Nc=Symbol("store"),Qh=Symbol("onComplete"),KC=Symbol("promise");class IB extends qJ{constructor(e,t,n){if(typeof t=="function"||typeof n=="function")throw new zC("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:i,version:s,...o}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),typeof e!="string")throw new Error("constructor requires a location string argument");this[zs]=e,this[a8]=i??kB,this[c8]=parseInt(s||1,10),this[Gh]=null}get location(){return this[zs]}get namePrefix(){return this[a8]}get version(){return this[c8]}get db(){return this[Gh]}get type(){return"browser-level"}_open(e,t){const n=indexedDB.open(this[a8]+this[zs],this[c8]);n.onerror=function(){t(n.error||new Error("unknown error"))},n.onsuccess=()=>{this[Gh]=n.result,t()},n.onupgradeneeded=i=>{const s=i.target.result;s.objectStoreNames.contains(this[zs])||s.createObjectStore(this[zs])}}[Nc](e){return this[Gh].transaction([this[zs]],e).objectStore(this[zs])}[Qh](e,t){const n=e.transaction;n.onabort=function(){t(n.error||new Error("aborted by user"))},n.oncomplete=function(){t(null,e.result)}}_get(e,t,n){const i=this[Nc]("readonly");let s;try{s=i.get(e)}catch(o){return this.nextTick(n,o)}this[Qh](s,function(o,a){if(o)return n(o);if(a===void 0)return n(new zC("Entry not found",{code:"LEVEL_NOT_FOUND"}));n(null,VC(a))})}_getMany(e,t,n){const i=this[Nc]("readonly"),s=e.map(o=>a=>{let c;try{c=i.get(o)}catch(l){return a(l)}c.onsuccess=()=>{const l=c.result;a(null,l===void 0?l:VC(l))},c.onerror=l=>{l.stopPropagation(),a(c.error)}});WJ(s,16,n)}_del(e,t,n){const i=this[Nc]("readwrite");let s;try{s=i.delete(e)}catch(o){return this.nextTick(n,o)}this[Qh](s,n)}_put(e,t,n,i){const s=this[Nc]("readwrite");let o;try{o=s.put(t,e)}catch(a){return this.nextTick(i,a)}this[Qh](o,i)}_iterator(e){return new QJ(this,this[zs],e)}_batch(e,t,n){const i=this[Nc]("readwrite"),s=i.transaction;let o=0,a;s.onabort=function(){n(a||s.error||new Error("aborted by user"))},s.oncomplete=function(){n()};function c(){const l=e[o++],d=l.key;let h;try{h=l.type==="del"?i.delete(d):i.put(l.value,d)}catch(p){a=p,s.abort();return}o<e.length?h.onsuccess=c:typeof s.commit=="function"&&s.commit()}c()}_clear(e,t){let n,i;try{n=JJ(e)}catch{return this.nextTick(t)}if(e.limit>=0)return YJ(this,this[zs],n,e,t);try{const s=this[Nc]("readwrite");i=n?s.delete(n):s.clear()}catch(s){return this.nextTick(t,s)}this[Qh](i,t)}_close(e){this[Gh].close(),this.nextTick(e)}}IB.destroy=function(r,e,t){typeof e=="function"&&(t=e,e=kB),t=GJ(t,KC);const n=indexedDB.deleteDatabase(e+r);return n.onsuccess=function(){t()},n.onerror=function(i){t(i)},t[KC]};uB.BrowserLevel=IB;var XJ=uB.BrowserLevel;const ZJ="./level",eX="view",R6=async({path:r,valueEncoding:e}={})=>{r=r||ZJ,e=e||eX;const t=new XJ(r,{valueEncoding:e,passive:!0});return await t.open(),{put:async(d,h)=>{await t.put(d,h)},del:async d=>{await t.del(d)},get:async d=>{try{const h=await t.get(d);if(h)return h}catch{}},iterator:async function*({amount:d,reverse:h}={}){const p={limit:d||-1,reverse:h||!1};for await(const[b,f]of t.iterator(p))yield[b,f]},merge:async d=>{},clear:async()=>{await t.clear()},close:async()=>{await t.close()}}},jC=1e6,xs=async({size:r}={})=>{let e=new x6(r||jC);return{put:async(l,d)=>{e.set(l,d)},del:async l=>{e.remove(l)},get:async l=>e.get(l),iterator:async function*(){for await(const l of e.keys){const d=e.get(l);yield[l,d]}},merge:async l=>{if(l)for await(const[d,h]of l.iterator())e.set(d,h)},clear:async()=>{e=new x6(r||jC)},close:async()=>{}}},tX=16,l8=1e3,wE=async({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p})=>{s=ja(s||"./orbitdb",`./${t}/`),o=o||{},d=Number(d)>-1?d:tX,c=c||await cl(await xs({size:l8}),await ym({ipfs:r,pin:!0})),a=a||await cl(await xs({size:l8}),await R6({path:ja(s,"/log/_heads/")})),l=l||await cl(await xs({size:l8}),await R6({path:ja(s,"/log/_index/")}));const b=await LY(e,{logId:t,access:i,entryStorage:c,headsStorage:a,indexStorage:l}),f=new g1,g=new Za({concurrency:1}),v=async C=>{const k=async()=>{const I=await b.append(C,{referencesCount:d});return await E.add(I),p&&await p(b,I),f.emit("update",I),I.hash},A=await g.add(k);return await g.onIdle(),A},y=async C=>{const k=async()=>{const A=await Ys.decode(C);A&&await b.joinEntry(A)&&(p&&await p(b,A),f.emit("update",A))};await g.add(k)},w=async()=>{await E.stop(),await g.onIdle(),await b.close(),i&&i.close&&await i.close(),f.emit("close")},m=async()=>{await g.onIdle(),await b.clear(),i&&i.drop&&await i.drop(),f.emit("drop")},E=await kW({ipfs:r,log:b,events:f,onSynced:y,start:h});return{address:t,name:n,identity:e,meta:o,close:w,drop:m,addOperation:v,log:b,sync:E,peers:E.peers,events:f,access:i}},_B="documents",rX={indexBy:"_id"},TB=({indexBy:r}=rX)=>async({ipfs:e,identity:t,address:n,name:i,access:s,directory:o,meta:a,headsStorage:c,entryStorage:l,indexStorage:d,referencesCount:h,syncAutomatically:p,onUpdate:b})=>{const f=await wE({ipfs:e,identity:t,address:n,name:i,access:s,directory:o,meta:a,headsStorage:c,entryStorage:l,indexStorage:d,referencesCount:h,syncAutomatically:p}),{addOperation:g,log:v}=f,y=async A=>{const I=A[r];if(!I)throw new Error(`The provided document doesn't contain field '${r}'`);return g({op:"PUT",key:I,value:A})},w=async A=>{if(!await m(A))throw new Error(`No document with key '${A}' in the database`);return g({op:"DEL",key:A,value:null})},m=async A=>{for await(const I of C())if(A===I.key)return I},E=async A=>{const I=[];for await(const D of C())A(D.value)&&I.push(D.value);return I},C=async function*({amount:A}={}){const I={};let D=0;for await(const F of v.iterator()){const{op:W,key:U,value:Y}=F.payload;if(W==="PUT"&&!I[U]?(I[U]=!0,D++,yield{hash:F.hash,key:U,value:Y}):W==="DEL"&&!I[U]&&(I[U]=!0),D>=A)break}};return{...f,type:_B,put:y,del:w,get:m,iterator:C,query:E,indexBy:r,all:async()=>{const A=[];for await(const I of C())A.unshift(I);return A}}};TB.type=_B;const $B="events",PB=()=>async({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p})=>{const b=await wE({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p}),{addOperation:f,log:g}=b,v=async E=>f({op:"ADD",key:null,value:E}),y=async E=>(await g.get(E)).payload.value,w=async function*({gt:E,gte:C,lt:k,lte:A,amount:I}={}){const D=g.iterator({gt:E,gte:C,lt:k,lte:A,amount:I});for await(const F of D){const W=F.hash,U=F.payload.value;yield{hash:W,value:U}}};return{...b,type:$B,add:v,get:y,iterator:w,all:async()=>{const E=[];for await(const C of w())E.unshift(C);return E}}};PB.type=$B;const DB="keyvalue",NB=()=>async({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p})=>{const b=await wE({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:d,syncAutomatically:h,onUpdate:p}),{addOperation:f,log:g}=b,v=async(C,k)=>f({op:"PUT",key:C,value:k}),y=async C=>f({op:"DEL",key:C,value:null}),w=async C=>{for await(const k of g.traverse()){const{op:A,key:I,value:D}=k.payload;if(A==="PUT"&&I===C)return D;if(A==="DEL"&&I===C)return}},m=async function*({amount:C}={}){const k={};let A=0;for await(const I of g.traverse()){const{op:D,key:F,value:W}=I.payload;if(D==="PUT"&&!k[F]){k[F]=!0,A++;const U=I.hash;yield{key:F,value:W,hash:U}}else D==="DEL"&&!k[F]&&(k[F]=!0);if(A>=C)break}};return{...b,type:DB,put:v,set:v,del:y,get:w,iterator:m,all:async()=>{const C=[];for await(const k of m())C.unshift(k);return C}}};NB.type=DB;const B6={},bE=r=>{if(!r.type)throw new Error("Database type does not contain required field 'type'.");B6[r.type]=r},nX=r=>{if(!r)throw new Error("Type not specified");if(!B6[r])throw new Error(`Unsupported database type: '${r}'`);return B6[r]};bE(PB);bE(TB);bE(NB);const iX=Symbol.for("@libp2p/connection"),Sd=Symbol.for("@libp2p/content-routing"),Dg=Symbol.for("@libp2p/peer-discovery"),vE=Symbol.for("@libp2p/peer-id");function OB(r){return!!(r!=null&&r[vE])}const Ad=Symbol.for("@libp2p/peer-routing"),Am="keep-alive",Cm=Symbol.for("@libp2p/transport");var w1;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(w1||(w1={}));var x5;let Sl=(x5=class extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}},u(x5,"name","AbortError"),x5);class RB extends Error{constructor(e="Unexpected Peer"){super(e),this.name="UnexpectedPeerError"}}u(RB,"name","UnexpectedPeerError");var S5;let sX=(S5=class extends Error{constructor(e="Invalid crypto exchange"){super(e),this.name="InvalidCryptoExchangeError"}},u(S5,"name","InvalidCryptoExchangeError"),S5);class Z extends Error{constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}}u(Z,"name","InvalidParametersError");class b1 extends Error{constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}u(b1,"name","InvalidPublicKeyError");class EE extends Error{constructor(e="Invalid private key"){super(e),this.name="InvalidPrivateKeyError"}}u(EE,"name","InvalidPrivateKeyError");class BB extends Error{constructor(e="The connection is closing"){super(e),this.name="ConnectionClosingError"}}u(BB,"name","ConnectionClosingError");class xE extends Error{constructor(e="The connection is closed"){super(e),this.name="ConnectionClosedError"}}u(xE,"name","ConnectionClosedError");class SE extends Error{constructor(e="Connection failed"){super(e),this.name="ConnectionFailedError"}}u(SE,"name","ConnectionFailedError");class Vc extends Error{constructor(e="The muxer is closed"){super(e),this.name="MuxerClosedError"}}u(Vc,"name","MuxerClosedError");class LB extends Error{constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}}u(LB,"name","StreamResetError");class Ng extends Error{constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}}u(Ng,"name","StreamStateError");var A5;let jt=(A5=class extends Error{constructor(e="Not found"){super(e),this.name="NotFoundError"}},u(A5,"name","NotFoundError"),A5);class AE extends Error{constructor(e="Invalid PeerID"){super(e),this.name="InvalidPeerIdError"}}u(AE,"name","InvalidPeerIdError");class km extends Error{constructor(e="Invalid multiaddr"){super(e),this.name="InvalidMultiaddrError"}}u(km,"name","InvalidMultiaddrError");class MB extends Error{constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}u(MB,"name","InvalidCIDError");class Im extends Error{constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}u(Im,"name","InvalidMultihashError");class y0 extends Error{constructor(e="Unsupported protocol error"){super(e),this.name="UnsupportedProtocolError"}}u(y0,"name","UnsupportedProtocolError");class pt extends Error{constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}}u(pt,"name","InvalidMessageError");class UB extends Error{constructor(e="Protocol error"){super(e),this.name="ProtocolError"}}u(UB,"name","ProtocolError");class m0 extends Error{constructor(e="Timed out"){super(e),this.name="TimeoutError"}}u(m0,"name","TimeoutError");class Al extends Error{constructor(e="Not started"){super(e),this.name="NotStartedError"}}u(Al,"name","NotStartedError");class Gu extends Error{constructor(e="Dial error"){super(e),this.name="DialError"}}u(Gu,"name","DialError");class Og extends Error{constructor(e="Listen error"){super(e),this.name="ListenError"}}u(Og,"name","ListenError");class CE extends Error{constructor(e="Limited connection"){super(e),this.name="LimitedConnectionError"}}u(CE,"name","LimitedConnectionError");class FB extends Error{constructor(e="Too many inbound protocol streams"){super(e),this.name="TooManyInboundProtocolStreamsError"}}u(FB,"name","TooManyInboundProtocolStreamsError");class _m extends Error{constructor(e="Too many outbound protocol streams"){super(e),this.name="TooManyOutboundProtocolStreamsError"}}u(_m,"name","TooManyOutboundProtocolStreamsError");class tu extends Error{constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}u(tu,"name","UnsupportedKeyTypeError");var ps;class Gt extends EventTarget{constructor(){super();qe(this,ps,new Map)}listenerCount(t){const n=ie(this,ps).get(t);return n==null?0:n.length}addEventListener(t,n,i){super.addEventListener(t,n,i);let s=ie(this,ps).get(t);s==null&&(s=[],ie(this,ps).set(t,s)),s.push({callback:n,once:(i!==!0&&i!==!1&&(i==null?void 0:i.once))??!1})}removeEventListener(t,n,i){super.removeEventListener(t.toString(),n??null,i);let s=ie(this,ps).get(t);s!=null&&(s=s.filter(({callback:o})=>o!==n),ie(this,ps).set(t,s))}dispatchEvent(t){const n=super.dispatchEvent(t);let i=ie(this,ps).get(t.type);return i==null||(i=i.filter(({once:s})=>!s),ie(this,ps).set(t.type,i)),n}safeDispatchEvent(t,n={}){return this.dispatchEvent(new CustomEvent(t,n))}}ps=new WeakMap;function kE(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}async function Eo(...r){const e=[];for(const t of r)kE(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStart!=null&&await t.beforeStart()})),await Promise.all(e.map(async t=>{await t.start()})),await Promise.all(e.map(async t=>{t.afterStart!=null&&await t.afterStart()}))}async function mc(...r){const e=[];for(const t of r)kE(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStop!=null&&await t.beforeStop()})),await Promise.all(e.map(async t=>{await t.stop()})),await Promise.all(e.map(async t=>{t.afterStop!=null&&await t.afterStop()}))}const fr=Symbol.for("@libp2p/service-capabilities"),Cl=Symbol.for("@libp2p/service-dependencies");function oX(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Tm(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function aX(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var cX=aX,lX=cX;let uX=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},dX=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return zB(this,e)}},hX=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return zB(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function zB(r,e){return new hX({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let fX=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new uX(e,t,n),this.decoder=new dX(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function VB({name:r,prefix:e,encode:t,decode:n}){return new fX(r,e,t,n)}function $m({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=lX(t,r);return VB({prefix:e,name:r,encode:n,decode:s=>Tm(i(s))})}function pX(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function gX(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Hn({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return VB({prefix:e,name:r,encode(i){return gX(i,n,t)},decode(i){return pX(i,n,t,r)}})}const li=$m({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});$m({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const S2=Hn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Hn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Hn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Hn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Hn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Hn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Hn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Hn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Hn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const u8=$m({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});$m({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var yX=KB,HC=128,mX=-128,wX=Math.pow(2,31);function KB(r,e,t){e=e||[],t=t||0;for(var n=t;r>=wX;)e[t++]=r&255|HC,r/=128;for(;r&mX;)e[t++]=r&255|HC,r>>>=7;return e[t]=r|0,KB.bytes=t-n+1,e}var bX=L6,vX=128,qC=127;function L6(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw L6.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&qC)<<i:(o&qC)*Math.pow(2,i),i+=7}while(o>=vX);return L6.bytes=s-n,t}var EX=Math.pow(2,7),xX=Math.pow(2,14),SX=Math.pow(2,21),AX=Math.pow(2,28),CX=Math.pow(2,35),kX=Math.pow(2,42),IX=Math.pow(2,49),_X=Math.pow(2,56),TX=Math.pow(2,63),$X=function(r){return r<EX?1:r<xX?2:r<SX?3:r<AX?4:r<CX?5:r<kX?6:r<IX?7:r<_X?8:r<TX?9:10},PX={encode:yX,decode:bX,encodingLength:$X},Rg=PX;function M6(r,e=0){return[Rg.decode(r,e),Rg.decode.bytes]}function Bg(r,e,t=0){return Rg.encode(r,e,t),e}function Lg(r){return Rg.encodingLength(r)}function kl(r,e){const t=e.byteLength,n=Lg(r),i=n+Lg(t),s=new Uint8Array(i+t);return Bg(r,s,0),Bg(t,s,n),s.set(e,i),new IE(r,t,e,s)}function DX(r){const e=Tm(r),[t,n]=M6(e),[i,s]=M6(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new IE(t,i,o,e)}function NX(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&oX(r.bytes,t.bytes)}}let IE=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function WC(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return RX(t,U6(r),e??li.encoder);default:return BX(t,U6(r),e??S2.encoder)}}const GC=new WeakMap;function U6(r){const e=GC.get(r);if(e==null){const t=new Map;return GC.set(r,t),t}return e}var QP;let Pm=class Ir{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,QP,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Yh)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==LX)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Ir.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=kl(e,t);return Ir.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Ir.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&NX(e.multihash,n.multihash)}toString(e){return WC(this,e)}toJSON(){return{"/":WC(this)}}link(){return this}[(QP=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Ir)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Ir(n,i,s,o??QC(n,i,s.bytes))}else if(t[MX]===!0){const{version:n,multihash:i,code:s}=t,o=DX(i);return Ir.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Yh)throw new Error(`Version 0 CID must use dag-pb (code: ${Yh}) block encoding`);return new Ir(e,t,n,n.bytes)}case 1:{const i=QC(e,t,n.bytes);return new Ir(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Ir.create(0,Yh,e)}static createV1(e,t){return Ir.create(1,e,t)}static decode(e){const[t,n]=Ir.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Ir.inspectBytes(e),n=t.size-t.multihashSize,i=Tm(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new IE(t.multihashCode,t.digestSize,s,i);return[t.version===0?Ir.createV0(o):Ir.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=M6(e.subarray(t));return t+=p,h};let i=n(),s=Yh;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=OX(e,t),s=Ir.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return U6(s).set(n,e),s}};function OX(r,e){switch(r[0]){case"Q":{const t=e??li;return[li.prefix,t.decode(`${li.prefix}${r}`)]}case li.prefix:{const t=e??li;return[li.prefix,t.decode(r)]}case S2.prefix:{const t=e??S2;return[S2.prefix,t.decode(r)]}case u8.prefix:{const t=e??u8;return[u8.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function RX(r,e,t){const{prefix:n}=t;if(n!==li.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function BX(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Yh=112,LX=18;function QC(r,e,t){const n=Lg(r),i=n+Lg(e),s=new Uint8Array(i+t.byteLength);return Bg(r,s,0),Bg(e,s,n),s.set(t,i),s}const MX=Symbol.for("@ipld/js-cid/CID"),jB=0,UX="identity",HB=Tm;function FX(r){return kl(jB,HB(r))}const _E={code:jB,name:UX,encode:HB,digest:FX};function Fe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function We(r=0){return new Uint8Array(r)}function zn(r=0){return new Uint8Array(r)}function pr(r,e){e==null&&(e=r.reduce((i,s)=>i+s.length,0));const t=zn(e);let n=0;for(const i of r)t.set(i,n),n+=i.length;return t}const qB=Symbol.for("@achingbrain/uint8arraylist");function YC(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(const n of r){const i=t+n.byteLength;if(e<i)return{buf:n,index:e-t};t=i}throw new RangeError("index is out of bounds")}function bf(r){return!!(r!=null&&r[qB])}var YP;class Be{constructor(...e){u(this,"bufs");u(this,"length");u(this,YP,!0);this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[(YP=qB,Symbol.iterator)](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(bf(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(bf(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){const t=YC(this.bufs,e);return t.buf[t.index]}set(e,t){const n=YC(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(bf(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){const{bufs:n,length:i}=this._subList(e,t);return pr(n,i)}subarray(e,t){const{bufs:n,length:i}=this._subList(e,t);return n.length===1?n[0]:pr(n,i)}sublist(e,t){const{bufs:n,length:i}=this._subList(e,t),s=new Be;return s.length=i,s.bufs=[...n],s}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};const n=[];let i=0;for(let s=0;s<this.bufs.length;s++){const o=this.bufs[s],a=i,c=a+o.byteLength;if(i=c,e>=c)continue;const l=e>=a&&e<c,d=t>a&&t<=c;if(l&&d){if(e===a&&t===c){n.push(o);break}const h=e-a;n.push(o.subarray(h,h+(t-e)));break}if(l){if(e===0){n.push(o);continue}n.push(o.subarray(e-a));continue}if(d){if(t===c){n.push(o);break}n.push(o.subarray(0,t-a));break}n.push(o)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!bf(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const i=n.byteLength;if(i===0)throw new TypeError("search must be at least 1 byte long");const s=256,o=new Int32Array(s);for(let h=0;h<s;h++)o[h]=-1;for(let h=0;h<i;h++)o[n[h]]=h;const a=o,c=this.byteLength-n.byteLength,l=n.byteLength-1;let d;for(let h=t;h<=c;h+=d){d=0;for(let p=l;p>=0;p--){const b=this.get(h+p);if(n[p]!==b){d=Math.max(1,p-a[b]);break}}if(d===0)return h}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const n=zn(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){const i=We(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,t,n),this.write(i,e)}getInt32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){const i=We(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,t,n),this.write(i,e)}getBigInt64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){const i=We(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,t,n),this.write(i,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const n=zn(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){const i=We(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,t,n),this.write(i,e)}getUint32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){const i=We(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,t,n),this.write(i,e)}getBigUint64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){const i=We(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,t,n),this.write(i,e)}getFloat32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){const i=We(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,t,n),this.write(i,e)}getFloat64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){const i=We(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,t,n),this.write(i,e)}equals(e){if(e==null||!(e instanceof Be)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!Fe(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const n=new Be;return n.bufs=e,t==null&&(t=e.reduce((i,s)=>i+s.byteLength,0)),n.length=t,n}}function zX(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function VX(r){return new TextEncoder().encode(r)}function KX(r){return new TextDecoder().decode(r)}function jX(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var HX=jX,qX=HX;let WX=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},GX=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return WB(this,e)}},QX=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return WB(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function WB(r,e){return new QX({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let YX=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new WX(e,t,n),this.decoder=new GX(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Dm({name:r,prefix:e,encode:t,decode:n}){return new YX(r,e,t,n)}function w0({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=qX(t,r);return Dm({prefix:e,name:r,encode:n,decode:s=>zX(i(s))})}function JX(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function XX(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function br({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return Dm({prefix:e,name:r,encode(i){return XX(i,n,t)},decode(i){return JX(i,n,t,r)}})}const ZX=w0({prefix:"9",name:"base10",alphabet:"0123456789"}),eZ=Object.freeze(Object.defineProperty({__proto__:null,base10:ZX},Symbol.toStringTag,{value:"Module"})),tZ=br({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),rZ=br({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),nZ=Object.freeze(Object.defineProperty({__proto__:null,base16:tZ,base16upper:rZ},Symbol.toStringTag,{value:"Module"})),iZ=br({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),sZ=Object.freeze(Object.defineProperty({__proto__:null,base2:iZ},Symbol.toStringTag,{value:"Module"})),GB=Array.from(""),oZ=GB.reduce((r,e,t)=>(r[t]=e,r),[]),aZ=GB.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function cZ(r){return r.reduce((e,t)=>(e+=oZ[t],e),"")}function lZ(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const i=aZ[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const uZ=Dm({prefix:"",name:"base256emoji",encode:cZ,decode:lZ}),dZ=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:uZ},Symbol.toStringTag,{value:"Module"})),hZ=br({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),fZ=br({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),pZ=br({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),gZ=br({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),yZ=br({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),mZ=br({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),wZ=br({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),bZ=br({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),vZ=br({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),EZ=Object.freeze(Object.defineProperty({__proto__:null,base32:hZ,base32hex:yZ,base32hexpad:wZ,base32hexpadupper:bZ,base32hexupper:mZ,base32pad:pZ,base32padupper:gZ,base32upper:fZ,base32z:vZ},Symbol.toStringTag,{value:"Module"})),xZ=w0({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),SZ=w0({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),AZ=Object.freeze(Object.defineProperty({__proto__:null,base36:xZ,base36upper:SZ},Symbol.toStringTag,{value:"Module"})),CZ=w0({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),kZ=w0({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),IZ=Object.freeze(Object.defineProperty({__proto__:null,base58btc:CZ,base58flickr:kZ},Symbol.toStringTag,{value:"Module"})),_Z=br({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),TZ=br({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),$Z=br({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),PZ=br({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),DZ=Object.freeze(Object.defineProperty({__proto__:null,base64:_Z,base64pad:TZ,base64url:$Z,base64urlpad:PZ},Symbol.toStringTag,{value:"Module"})),NZ=br({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),OZ=Object.freeze(Object.defineProperty({__proto__:null,base8:NZ},Symbol.toStringTag,{value:"Module"})),RZ=Dm({prefix:"\0",name:"identity",encode:r=>KX(r),decode:r=>VX(r)}),BZ=Object.freeze(Object.defineProperty({__proto__:null,identity:RZ},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const JC={...BZ,...sZ,...OZ,...eZ,...nZ,...EZ,...AZ,...IZ,...DZ,...dZ};function QB(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const XC=QB("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),d8=QB("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=zn(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),YB={utf8:XC,"utf-8":XC,hex:JC.base16,latin1:d8,ascii:d8,binary:d8,...JC};function se(r,e="utf8"){const t=YB[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}function re(r,e="utf8"){const t=YB[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}const LZ=parseInt("11111",2),F6=parseInt("10000000",2),MZ=parseInt("01111111",2),ZC={0:Jh,1:Jh,2:UZ,3:VZ,4:KZ,5:zZ,6:FZ,16:Jh,22:Jh,48:Jh};function wc(r,e={offset:0}){const t=r[e.offset]&LZ;if(e.offset++,ZC[t]!=null)return ZC[t](r,e);throw new Error("No decoder for tag "+t)}function b0(r,e){let t=0;if((r[e.offset]&F6)===F6){const n=r[e.offset]&MZ;let i="0x";e.offset++;for(let s=0;s<n;s++,e.offset++)i+=r[e.offset].toString(16).padStart(2,"0");t=parseInt(i,16)}else t=r[e.offset],e.offset++;return t}function Jh(r,e){b0(r,e);const t=[];for(;!(e.offset>=r.byteLength);){const n=wc(r,e);if(n===null)break;t.push(n)}return t}function UZ(r,e){const t=b0(r,e),n=e.offset,i=e.offset+t,s=[];for(let o=n;o<i;o++)o===n&&r[o]===0||s.push(r[o]);return e.offset+=t,Uint8Array.from(s)}function FZ(r,e){const t=b0(r,e),n=e.offset+t,i=r[e.offset];e.offset++;let s=0,o=0;i<40?(s=0,o=i):i<80?(s=1,o=i-40):(s=2,o=i-80);let a=`${s}.${o}`,c=[];for(;e.offset<n;){const l=r[e.offset];if(e.offset++,c.push(l&127),l<128){c.reverse();let d=0;for(let h=0;h<c.length;h++)d+=c[h]<<h*7;a+=`.${d}`,c=[]}}return a}function zZ(r,e){return e.offset++,null}function VZ(r,e){const t=b0(r,e),n=r[e.offset];e.offset++;const i=r.subarray(e.offset,e.offset+t-1);if(e.offset+=t,n!==0)throw new Error("Unused bits in bit string is unimplemented");return i}function KZ(r,e){const t=b0(r,e),n=r.subarray(e.offset,e.offset+t);return e.offset+=t,n}function jZ(r){let e=r.toString(16);e.length%2===1&&(e="0"+e);const t=new Be;for(let n=0;n<e.length;n+=2)t.append(Uint8Array.from([parseInt(`${e[n]}${e[n+1]}`,16)]));return t}function Nm(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);const e=jZ(r.byteLength);return new Be(Uint8Array.from([e.byteLength|F6]),e)}function $n(r){const e=new Be,t=128;return(r.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(r),new Be(Uint8Array.from([2]),Nm(e),e)}function TE(r){const e=Uint8Array.from([0]),t=new Be(e,r);return new Be(Uint8Array.from([3]),Nm(t),t)}function HZ(r){return new Be(Uint8Array.from([4]),Nm(r),r)}function lo(r,e=48){const t=new Be;for(const n of r)t.append(n);return new Be(Uint8Array.from([e]),Nm(t),t)}const JB="1.2.840.10045.3.1.7",XB="1.3.132.0.34",ZB="1.3.132.0.35";async function qZ(r="P-256"){const e=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:r},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",e.publicKey),privateKey:await crypto.subtle.exportKey("jwk",e.privateKey)}}async function WZ(r,e){const t=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["sign"]),n=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},t,e.subarray());return new Uint8Array(n,0,n.byteLength)}async function GZ(r,e,t){const n=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["verify"]);return crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},n,e,t.subarray())}const QZ=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),YZ=Uint8Array.from([6,5,43,129,4,0,34]),JZ=Uint8Array.from([6,5,43,129,4,0,35]),eL={ext:!0,kty:"EC",crv:"P-256"},tL={ext:!0,kty:"EC",crv:"P-384"},rL={ext:!0,kty:"EC",crv:"P-521"},Qu=32,Yu=48,Ju=66;function XZ(r){const e=wc(r);return nL(e)}function nL(r){const e=r[1],t=re(e,"base64url"),n=r[2][1][0],i=1;let s,o;if(e.byteLength===Qu)return s=re(n.subarray(i,i+Qu),"base64url"),o=re(n.subarray(i+Qu),"base64url"),new C2({...eL,key_ops:["sign"],d:t,x:s,y:o});if(e.byteLength===Yu)return s=re(n.subarray(i,i+Yu),"base64url"),o=re(n.subarray(i+Yu),"base64url"),new C2({...tL,key_ops:["sign"],d:t,x:s,y:o});if(e.byteLength===Ju)return s=re(n.subarray(i,i+Ju),"base64url"),o=re(n.subarray(i+Ju),"base64url"),new C2({...rL,key_ops:["sign"],d:t,x:s,y:o});throw new Z(`Private key length was wrong length, got ${e.byteLength}, expected 32, 48 or 66`)}function iL(r){const e=wc(r);return sL(e)}function sL(r){const e=r[1][1][0],t=1;let n,i;if(e.byteLength===Qu*2+1)return n=re(e.subarray(t,t+Qu),"base64url"),i=re(e.subarray(t+Qu),"base64url"),new A2({...eL,key_ops:["verify"],x:n,y:i});if(e.byteLength===Yu*2+1)return n=re(e.subarray(t,t+Yu),"base64url"),i=re(e.subarray(t+Yu),"base64url"),new A2({...tL,key_ops:["verify"],x:n,y:i});if(e.byteLength===Ju*2+1)return n=re(e.subarray(t,t+Ju),"base64url"),i=re(e.subarray(t+Ju),"base64url"),new A2({...rL,key_ops:["verify"],x:n,y:i});throw new Z(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function ZZ(r){return lo([$n(Uint8Array.from([1])),HZ(se(r.d??"","base64url")),lo([oL(r.crv)],160),lo([TE(new Be(Uint8Array.from([4]),se(r.x??"","base64url"),se(r.y??"","base64url")))],161)]).subarray()}function eee(r){return lo([$n(Uint8Array.from([1])),lo([oL(r.crv)],160),lo([TE(new Be(Uint8Array.from([4]),se(r.x??"","base64url"),se(r.y??"","base64url")))],161)]).subarray()}function oL(r){if(r==="P-256")return QZ;if(r==="P-384")return YZ;if(r==="P-521")return JZ;throw new Z(`Invalid curve ${r}`)}async function tee(r="P-256"){const e=await qZ(r);return new C2(e.privateKey)}class A2{constructor(e){u(this,"type","ECDSA");u(this,"jwk");u(this,"_raw");this.jwk=e}get raw(){return this._raw==null&&(this._raw=eee(this.jwk)),this._raw}toMultihash(){return _E.digest(Ss(this))}toCID(){return Pm.createV1(114,this.toMultihash())}toString(){return li.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Fe(this.raw,e.raw)}async verify(e,t){return GZ(this.jwk,t,e)}}class C2{constructor(e){u(this,"type","ECDSA");u(this,"jwk");u(this,"publicKey");u(this,"_raw");this.jwk=e,this.publicKey=new A2({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){return this._raw==null&&(this._raw=ZZ(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Fe(this.raw,e.raw)}async sign(e){return WZ(this.jwk,e)}}function ek(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function ree(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Om(r,...e){if(!ree(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function nee(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");ek(r.outputLen),ek(r.blockLen)}function Mg(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function iee(r,e){Om(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const mu=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function h8(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function as(r,e){return r<<32-e|r>>>e}typeof Uint8Array.from([]).toHex=="function"&&Uint8Array.fromHex;function see(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function $E(r){return typeof r=="string"&&(r=see(r)),Om(r),r}function oee(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];Om(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const s=r[n];t.set(s,i),i+=s.length}return t}let aL=class{clone(){return this._cloneInto()}};function cL(r){const e=n=>r().update($E(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function PE(r=32){if(mu&&typeof mu.getRandomValues=="function")return mu.getRandomValues(new Uint8Array(r));if(mu&&typeof mu.randomBytes=="function")return Uint8Array.from(mu.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function aee(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function cee(r,e,t){return r&e^~r&t}function lee(r,e,t){return r&e^r&t^e&t}let lL=class extends aL{constructor(e,t,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=h8(this.buffer)}update(e){Mg(this);const{view:t,buffer:n,blockLen:i}=this;e=$E(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=h8(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Mg(this),iee(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)t[h]=0;aee(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=h8(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,d[h],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%t&&e.buffer.set(n),e}};const uee=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Jo=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Xo=new Uint32Array(64);let dee=class extends lL{constructor(e=32){super(64,e,8,!1),this.A=Jo[0]|0,this.B=Jo[1]|0,this.C=Jo[2]|0,this.D=Jo[3]|0,this.E=Jo[4]|0,this.F=Jo[5]|0,this.G=Jo[6]|0,this.H=Jo[7]|0}get(){const{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)Xo[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const p=Xo[h-15],b=Xo[h-2],f=as(p,7)^as(p,18)^p>>>3,g=as(b,17)^as(b,19)^b>>>10;Xo[h]=g+Xo[h-7]+f+Xo[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:l,H:d}=this;for(let h=0;h<64;h++){const p=as(a,6)^as(a,11)^as(a,25),b=d+p+cee(a,c,l)+uee[h]+Xo[h]|0,g=(as(n,2)^as(n,13)^as(n,22))+lee(n,i,s)|0;d=l,l=c,c=a,a=o+b|0,o=s,s=i,i=n,n=b+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(n,i,s,o,a,c,l,d)}roundClean(){Xo.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const hee=cL(()=>new dee),Sp=BigInt(2**32-1),z6=BigInt(32);function uL(r,e=!1){return e?{h:Number(r&Sp),l:Number(r>>z6&Sp)}:{h:Number(r>>z6&Sp)|0,l:Number(r&Sp)|0}}function fee(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let i=0;i<r.length;i++){const{h:s,l:o}=uL(r[i],e);[t[i],n[i]]=[s,o]}return[t,n]}const pee=(r,e)=>BigInt(r>>>0)<<z6|BigInt(e>>>0),gee=(r,e,t)=>r>>>t,yee=(r,e,t)=>r<<32-t|e>>>t,mee=(r,e,t)=>r>>>t|e<<32-t,wee=(r,e,t)=>r<<32-t|e>>>t,bee=(r,e,t)=>r<<64-t|e>>>t-32,vee=(r,e,t)=>r>>>t-32|e<<64-t,Eee=(r,e)=>e,xee=(r,e)=>r,See=(r,e,t)=>r<<t|e>>>32-t,Aee=(r,e,t)=>e<<t|r>>>32-t,Cee=(r,e,t)=>e<<t-32|r>>>64-t,kee=(r,e,t)=>r<<t-32|e>>>64-t;function Iee(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}const _ee=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),Tee=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,$ee=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),Pee=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,Dee=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0),Nee=(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0,Me={fromBig:uL,split:fee,toBig:pee,shrSH:gee,shrSL:yee,rotrSH:mee,rotrSL:wee,rotrBH:bee,rotrBL:vee,rotr32H:Eee,rotr32L:xee,rotlSH:See,rotlSL:Aee,rotlBH:Cee,rotlBL:kee,add:Iee,add3L:_ee,add3H:Tee,add4L:$ee,add4H:Pee,add5H:Nee,add5L:Dee},[Oee,Ree]=Me.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Zo=new Uint32Array(80),ea=new Uint32Array(80);let Bee=class extends lL{constructor(e=64){super(128,e,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:d,Fh:h,Fl:p,Gh:b,Gl:f,Hh:g,Hl:v}=this;return[e,t,n,i,s,o,a,c,l,d,h,p,b,f,g,v]}set(e,t,n,i,s,o,a,c,l,d,h,p,b,f,g,v){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=d|0,this.Fh=h|0,this.Fl=p|0,this.Gh=b|0,this.Gl=f|0,this.Hh=g|0,this.Hl=v|0}process(e,t){for(let m=0;m<16;m++,t+=4)Zo[m]=e.getUint32(t),ea[m]=e.getUint32(t+=4);for(let m=16;m<80;m++){const E=Zo[m-15]|0,C=ea[m-15]|0,k=Me.rotrSH(E,C,1)^Me.rotrSH(E,C,8)^Me.shrSH(E,C,7),A=Me.rotrSL(E,C,1)^Me.rotrSL(E,C,8)^Me.shrSL(E,C,7),I=Zo[m-2]|0,D=ea[m-2]|0,F=Me.rotrSH(I,D,19)^Me.rotrBH(I,D,61)^Me.shrSH(I,D,6),W=Me.rotrSL(I,D,19)^Me.rotrBL(I,D,61)^Me.shrSL(I,D,6),U=Me.add4L(A,W,ea[m-7],ea[m-16]),Y=Me.add4H(U,k,F,Zo[m-7],Zo[m-16]);Zo[m]=Y|0,ea[m]=U|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:d,Eh:h,El:p,Fh:b,Fl:f,Gh:g,Gl:v,Hh:y,Hl:w}=this;for(let m=0;m<80;m++){const E=Me.rotrSH(h,p,14)^Me.rotrSH(h,p,18)^Me.rotrBH(h,p,41),C=Me.rotrSL(h,p,14)^Me.rotrSL(h,p,18)^Me.rotrBL(h,p,41),k=h&b^~h&g,A=p&f^~p&v,I=Me.add5L(w,C,A,Ree[m],ea[m]),D=Me.add5H(I,y,E,k,Oee[m],Zo[m]),F=I|0,W=Me.rotrSH(n,i,28)^Me.rotrBH(n,i,34)^Me.rotrBH(n,i,39),U=Me.rotrSL(n,i,28)^Me.rotrBL(n,i,34)^Me.rotrBL(n,i,39),Y=n&s^n&a^s&a,j=i&o^i&c^o&c;y=g|0,w=v|0,g=b|0,v=f|0,b=h|0,f=p|0,{h,l:p}=Me.add(l|0,d|0,D|0,F|0),l=a|0,d=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const H=Me.add3L(F,U,j);n=Me.add3H(H,D,W,Y),i=H|0}({h:n,l:i}=Me.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=Me.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Me.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:d}=Me.add(this.Dh|0,this.Dl|0,l|0,d|0),{h,l:p}=Me.add(this.Eh|0,this.El|0,h|0,p|0),{h:b,l:f}=Me.add(this.Fh|0,this.Fl|0,b|0,f|0),{h:g,l:v}=Me.add(this.Gh|0,this.Gl|0,g|0,v|0),{h:y,l:w}=Me.add(this.Hh|0,this.Hl|0,y|0,w|0),this.set(n,i,s,o,a,c,l,d,h,p,b,f,g,v,y,w)}roundClean(){Zo.fill(0),ea.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Lee=cL(()=>new Bee);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const DE=BigInt(0),V6=BigInt(1);function Cd(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function NE(r){if(!Cd(r))throw new Error("Uint8Array expected")}function qa(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}function Ap(r){const e=r.toString(16);return e.length&1?"0"+e:e}function dL(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?DE:BigInt("0x"+r)}const hL=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Mee=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function kd(r){if(NE(r),hL)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=Mee[r[t]];return e}const Vs={_0:48,_9:57,A:65,F:70,a:97,f:102};function tk(r){if(r>=Vs._0&&r<=Vs._9)return r-Vs._0;if(r>=Vs.A&&r<=Vs.F)return r-(Vs.A-10);if(r>=Vs.a&&r<=Vs.f)return r-(Vs.a-10)}function Ug(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(hL)return Uint8Array.fromHex(r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let i=0,s=0;i<t;i++,s+=2){const o=tk(r.charCodeAt(s)),a=tk(r.charCodeAt(s+1));if(o===void 0||a===void 0){const c=r[s]+r[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function ul(r){return dL(kd(r))}function dl(r){return NE(r),dL(kd(Uint8Array.from(r).reverse()))}function v1(r,e){return Ug(r.toString(16).padStart(e*2,"0"))}function E1(r,e){return v1(r,e).reverse()}function Lt(r,e,t){let n;if(typeof e=="string")try{n=Ug(e)}catch(s){throw new Error(r+" must be hex string or Uint8Array, cause: "+s)}else if(Cd(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const i=n.length;if(typeof t=="number"&&i!==t)throw new Error(r+" of length "+t+" expected, got "+i);return n}function Id(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];NE(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const s=r[n];t.set(s,i),i+=s.length}return t}const f8=r=>typeof r=="bigint"&&DE<=r;function OE(r,e,t){return f8(r)&&f8(e)&&f8(t)&&e<=r&&r<t}function On(r,e,t,n){if(!OE(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function Uee(r){let e;for(e=0;r>DE;r>>=V6,e+=1);return e}const Rm=r=>(V6<<BigInt(r))-V6,p8=r=>new Uint8Array(r),rk=r=>Uint8Array.from(r);function Fee(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=p8(r),i=p8(r),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...h)=>t(i,n,...h),c=(h=p8(0))=>{i=a(rk([0]),h),n=a(),h.length!==0&&(i=a(rk([1]),h),n=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const p=[];for(;h<e;){n=a();const b=n.slice();p.push(b),h+=n.length}return Id(...p)};return(h,p)=>{o(),c(h);let b;for(;!(b=p(l()));)c();return o(),b}}const zee={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||Cd(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function hh(r,e,t={}){const n=(i,s,o)=>{const a=zee[s];if(typeof a!="function")throw new Error("invalid validator function");const c=r[i];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(t))n(i,s,!0);return r}function Fg(r){const e=new WeakMap;return(t,...n)=>{const i=e.get(t);if(i!==void 0)return i;const s=r(t,...n);return e.set(t,s),s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const rr=BigInt(0),Dt=BigInt(1),Kc=BigInt(2),Vee=BigInt(3),K6=BigInt(4),nk=BigInt(5),ik=BigInt(8);function ft(r,e){const t=r%e;return t>=rr?t:e+t}function fL(r,e,t){if(e<rr)throw new Error("invalid exponent, negatives unsupported");if(t<=rr)throw new Error("invalid modulus");if(t===Dt)return rr;let n=Dt;for(;e>rr;)e&Dt&&(n=n*r%t),r=r*r%t,e>>=Dt;return n}function $t(r,e,t){let n=r;for(;e-- >rr;)n*=n,n%=t;return n}function j6(r,e){if(r===rr)throw new Error("invert: expected non-zero number");if(e<=rr)throw new Error("invert: expected positive modulus, got "+e);let t=ft(r,e),n=e,i=rr,s=Dt;for(;t!==rr;){const a=n/t,c=n%t,l=i-s*a;n=t,t=c,i=s,s=l}if(n!==Dt)throw new Error("invert: does not exist");return ft(i,e)}function Kee(r){const e=(r-Dt)/Kc;let t,n,i;for(t=r-Dt,n=0;t%Kc===rr;t/=Kc,n++);for(i=Kc;i<r&&fL(i,e,r)!==r-Dt;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(r+Dt)/K6;return function(c,l){const d=c.pow(l,o);if(!c.eql(c.sqr(d),l))throw new Error("Cannot find square root");return d}}const s=(t+Dt)/Kc;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=n,d=a.pow(a.mul(a.ONE,i),t),h=a.pow(c,s),p=a.pow(c,t);for(;!a.eql(p,a.ONE);){if(a.eql(p,a.ZERO))return a.ZERO;let b=1;for(let g=a.sqr(p);b<l&&!a.eql(g,a.ONE);b++)g=a.sqr(g);const f=a.pow(d,Dt<<BigInt(l-b-1));d=a.sqr(f),h=a.mul(h,f),p=a.mul(p,d),l=b}return h}}function jee(r){if(r%K6===Vee){const e=(r+Dt)/K6;return function(n,i){const s=n.pow(i,e);if(!n.eql(n.sqr(s),i))throw new Error("Cannot find square root");return s}}if(r%ik===nk){const e=(r-nk)/ik;return function(n,i){const s=n.mul(i,Kc),o=n.pow(s,e),a=n.mul(i,o),c=n.mul(n.mul(a,Kc),o),l=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(l),i))throw new Error("Cannot find square root");return l}}return Kee(r)}const Hee=(r,e)=>(ft(r,e)&Dt)===Dt,qee=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Wee(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=qee.reduce((n,i)=>(n[i]="function",n),e);return hh(r,t)}function Gee(r,e,t){if(t<rr)throw new Error("invalid exponent, negatives unsupported");if(t===rr)return r.ONE;if(t===Dt)return e;let n=r.ONE,i=e;for(;t>rr;)t&Dt&&(n=r.mul(n,i)),i=r.sqr(i),t>>=Dt;return n}function Qee(r,e){const t=new Array(e.length),n=e.reduce((s,o,a)=>r.is0(o)?s:(t[a]=s,r.mul(s,o)),r.ONE),i=r.inv(n);return e.reduceRight((s,o,a)=>r.is0(o)?s:(t[a]=r.mul(s,t[a]),r.mul(s,o)),i),t}function pL(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function Bm(r,e,t=!1,n={}){if(r<=rr)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:i,nByteLength:s}=pL(r,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:r,isLE:t,BITS:i,BYTES:s,MASK:Rm(i),ZERO:rr,ONE:Dt,create:c=>ft(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return rr<=c&&c<r},is0:c=>c===rr,isOdd:c=>(c&Dt)===Dt,neg:c=>ft(-c,r),eql:(c,l)=>c===l,sqr:c=>ft(c*c,r),add:(c,l)=>ft(c+l,r),sub:(c,l)=>ft(c-l,r),mul:(c,l)=>ft(c*l,r),pow:(c,l)=>Gee(a,c,l),div:(c,l)=>ft(c*j6(l,r),r),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>j6(c,r),sqrt:n.sqrt||(c=>(o||(o=jee(r)),o(a,c))),invertBatch:c=>Qee(a,c),cmov:(c,l,d)=>d?l:c,toBytes:c=>t?E1(c,s):v1(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return t?dl(c):ul(c)}});return Object.freeze(a)}function gL(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function yL(r){const e=gL(r);return e+Math.ceil(e/2)}function Yee(r,e,t=!1){const n=r.length,i=gL(e),s=yL(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=t?dl(r):ul(r),a=ft(o,e-Dt)+Dt;return t?E1(a,i):v1(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const sk=BigInt(0),H6=BigInt(1);function g8(r,e){const t=e.negate();return r?t:e}function mL(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function y8(r,e){mL(r,e);const t=Math.ceil(e/r)+1,n=2**(r-1),i=2**r,s=Rm(r),o=BigInt(r);return{windows:t,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function ok(r,e,t){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=t;let a=Number(r&i),c=r>>o;a>n&&(a-=s,c+=H6);const l=e*n,d=l+Math.abs(a)-1,h=a===0,p=a<0,b=e%2!==0;return{nextN:c,offset:d,isZero:h,isNeg:p,isNegF:b,offsetF:l}}function Jee(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function Xee(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}const m8=new WeakMap,wL=new WeakMap;function w8(r){return wL.get(r)||1}function bL(r,e){return{constTimeNegate:g8,hasPrecomputes(t){return w8(t)!==1},unsafeLadder(t,n,i=r.ZERO){let s=t;for(;n>sk;)n&H6&&(i=i.add(s)),s=s.double(),n>>=H6;return i},precomputeWindow(t,n){const{windows:i,windowSize:s}=y8(n,e),o=[];let a=t,c=a;for(let l=0;l<i;l++){c=a,o.push(c);for(let d=1;d<s;d++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,n,i){let s=r.ZERO,o=r.BASE;const a=y8(t,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:d,isZero:h,isNeg:p,isNegF:b,offsetF:f}=ok(i,c,a);i=l,h?o=o.add(g8(b,n[f])):s=s.add(g8(p,n[d]))}return{p:s,f:o}},wNAFUnsafe(t,n,i,s=r.ZERO){const o=y8(t,e);for(let a=0;a<o.windows&&i!==sk;a++){const{nextN:c,offset:l,isZero:d,isNeg:h}=ok(i,a,o);if(i=c,!d){const p=n[l];s=s.add(h?p.negate():p)}}return s},getPrecomputes(t,n,i){let s=m8.get(n);return s||(s=this.precomputeWindow(n,t),t!==1&&m8.set(n,i(s))),s},wNAFCached(t,n,i){const s=w8(t);return this.wNAF(s,this.getPrecomputes(s,t,i),n)},wNAFCachedUnsafe(t,n,i,s){const o=w8(t);return o===1?this.unsafeLadder(t,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,t,i),n,s)},setWindowSize(t,n){mL(n,e),wL.set(t,n),m8.delete(t)}}}function vL(r,e,t,n){if(Jee(t,r),Xee(n,e),t.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=r.ZERO,s=Uee(BigInt(t.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=Rm(o),c=new Array(Number(a)+1).fill(i),l=Math.floor((e.BITS-1)/o)*o;let d=i;for(let h=l;h>=0;h-=o){c.fill(i);for(let b=0;b<n.length;b++){const f=n[b],g=Number(f>>BigInt(h)&a);c[g]=c[g].add(t[b])}let p=i;for(let b=c.length-1,f=i;b>0;b--)f=f.add(c[b]),p=p.add(f);if(d=d.add(p),h!==0)for(let b=0;b<o;b++)d=d.double()}return d}function RE(r){return Wee(r.Fp),hh(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...pL(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const cs=BigInt(0),Gr=BigInt(1),ak=BigInt(2),Zee=BigInt(8),ete={zip215:!0};function tte(r){const e=RE(r);return hh(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function rte(r){const e=tte(r),{Fp:t,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,l=ak<<BigInt(a*8)-Gr,d=t.create,h=Bm(e.n,e.nBitLength),p=e.uvRatio||((V,R)=>{try{return{isValid:!0,value:t.sqrt(V*t.inv(R))}}catch{return{isValid:!1,value:cs}}}),b=e.adjustScalarBytes||(V=>V),f=e.domain||((V,R,L)=>{if(qa("phflag",L),R.length||L)throw new Error("Contexts/pre-hash are not supported");return V});function g(V,R,L=!1){const q=L?Gr:cs;On("coordinate "+V,R,q,l)}function v(V){if(!(V instanceof m))throw new Error("ExtendedPoint expected")}const y=Fg((V,R)=>{const{ex:L,ey:q,ez:Q}=V,K=V.is0();R==null&&(R=K?Zee:t.inv(Q));const ce=d(L*R),me=d(q*R),de=d(Q*R);if(K)return{x:cs,y:Gr};if(de!==Gr)throw new Error("invZ was invalid");return{x:ce,y:me}}),w=Fg(V=>{const{a:R,d:L}=e;if(V.is0())throw new Error("bad point: ZERO");const{ex:q,ey:Q,ez:K,et:ce}=V,me=d(q*q),de=d(Q*Q),ue=d(K*K),$e=d(ue*ue),Pe=d(me*R),Je=d(ue*d(Pe+de)),it=d($e+d(L*d(me*de)));if(Je!==it)throw new Error("bad point: equation left != right (1)");const St=d(q*Q),At=d(K*ce);if(St!==At)throw new Error("bad point: equation left != right (2)");return!0});class m{constructor(R,L,q,Q){g("x",R),g("y",L),g("z",q,!0),g("t",Q),this.ex=R,this.ey=L,this.ez=q,this.et=Q,Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(R){if(R instanceof m)throw new Error("extended point not allowed");const{x:L,y:q}=R||{};return g("x",L),g("y",q),new m(L,q,Gr,d(L*q))}static normalizeZ(R){const L=t.invertBatch(R.map(q=>q.ez));return R.map((q,Q)=>q.toAffine(L[Q])).map(m.fromAffine)}static msm(R,L){return vL(m,h,R,L)}_setWindowSize(R){k.setWindowSize(this,R)}assertValidity(){w(this)}equals(R){v(R);const{ex:L,ey:q,ez:Q}=this,{ex:K,ey:ce,ez:me}=R,de=d(L*me),ue=d(K*Q),$e=d(q*me),Pe=d(ce*Q);return de===ue&&$e===Pe}is0(){return this.equals(m.ZERO)}negate(){return new m(d(-this.ex),this.ey,this.ez,d(-this.et))}double(){const{a:R}=e,{ex:L,ey:q,ez:Q}=this,K=d(L*L),ce=d(q*q),me=d(ak*d(Q*Q)),de=d(R*K),ue=L+q,$e=d(d(ue*ue)-K-ce),Pe=de+ce,Je=Pe-me,it=de-ce,St=d($e*Je),At=d(Pe*it),_t=d($e*it),Yt=d(Je*Pe);return new m(St,At,Yt,_t)}add(R){v(R);const{a:L,d:q}=e,{ex:Q,ey:K,ez:ce,et:me}=this,{ex:de,ey:ue,ez:$e,et:Pe}=R,Je=d(Q*de),it=d(K*ue),St=d(me*q*Pe),At=d(ce*$e),_t=d((Q+K)*(de+ue)-Je-it),Yt=At-St,Wr=At+St,Ac=d(it-L*Je),Ko=d(_t*Yt),ou=d(Wr*Ac),au=d(_t*Ac),Cc=d(Yt*Wr);return new m(Ko,ou,Cc,au)}subtract(R){return this.add(R.negate())}wNAF(R){return k.wNAFCached(this,R,m.normalizeZ)}multiply(R){const L=R;On("scalar",L,Gr,n);const{p:q,f:Q}=this.wNAF(L);return m.normalizeZ([q,Q])[0]}multiplyUnsafe(R,L=m.ZERO){const q=R;return On("scalar",q,cs,n),q===cs?C:this.is0()||q===Gr?this:k.wNAFCachedUnsafe(this,q,m.normalizeZ,L)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return k.unsafeLadder(this,n).is0()}toAffine(R){return y(this,R)}clearCofactor(){const{h:R}=e;return R===Gr?this:this.multiplyUnsafe(R)}static fromHex(R,L=!1){const{d:q,a:Q}=e,K=t.BYTES;R=Lt("pointHex",R,K),qa("zip215",L);const ce=R.slice(),me=R[K-1];ce[K-1]=me&-129;const de=dl(ce),ue=L?l:t.ORDER;On("pointHex.y",de,cs,ue);const $e=d(de*de),Pe=d($e-Gr),Je=d(q*$e-Q);let{isValid:it,value:St}=p(Pe,Je);if(!it)throw new Error("Point.fromHex: invalid y coordinate");const At=(St&Gr)===Gr,_t=(me&128)!==0;if(!L&&St===cs&&_t)throw new Error("Point.fromHex: x=0 and x_0=1");return _t!==At&&(St=d(-St)),m.fromAffine({x:St,y:de})}static fromPrivateKey(R){const{scalar:L}=D(R);return E.multiply(L)}toRawBytes(){const{x:R,y:L}=this.toAffine(),q=E1(L,t.BYTES);return q[q.length-1]|=R&Gr?128:0,q}toHex(){return kd(this.toRawBytes())}}m.BASE=new m(e.Gx,e.Gy,Gr,d(e.Gx*e.Gy)),m.ZERO=new m(cs,Gr,Gr,cs);const{BASE:E,ZERO:C}=m,k=bL(m,a*8);function A(V){return ft(V,n)}function I(V){return A(dl(V))}function D(V){const R=t.BYTES;V=Lt("private key",V,R);const L=Lt("hashed private key",s(V),2*R),q=b(L.slice(0,R)),Q=L.slice(R,2*R),K=I(q);return{head:q,prefix:Q,scalar:K}}function F(V){const{head:R,prefix:L,scalar:q}=D(V),Q=E.multiply(q),K=Q.toRawBytes();return{head:R,prefix:L,scalar:q,point:Q,pointBytes:K}}function W(V){return F(V).pointBytes}function U(V=new Uint8Array,...R){const L=Id(...R);return I(s(f(L,Lt("context",V),!!i)))}function Y(V,R,L={}){V=Lt("message",V),i&&(V=i(V));const{prefix:q,scalar:Q,pointBytes:K}=F(R),ce=U(L.context,q,V),me=E.multiply(ce).toRawBytes(),de=U(L.context,me,K,V),ue=A(ce+de*Q);On("signature.s",ue,cs,n);const $e=Id(me,E1(ue,t.BYTES));return Lt("result",$e,t.BYTES*2)}const j=ete;function H(V,R,L,q=j){const{context:Q,zip215:K}=q,ce=t.BYTES;V=Lt("signature",V,2*ce),R=Lt("message",R),L=Lt("publicKey",L,ce),K!==void 0&&qa("zip215",K),i&&(R=i(R));const me=dl(V.slice(ce,2*ce));let de,ue,$e;try{de=m.fromHex(L,K),ue=m.fromHex(V.slice(0,ce),K),$e=E.multiplyUnsafe(me)}catch{return!1}if(!K&&de.isSmallOrder())return!1;const Pe=U(Q,ue.toRawBytes(),de.toRawBytes(),R);return ue.add(de.multiplyUnsafe(Pe)).subtract($e).clearCofactor().equals(m.ZERO)}return E._setWindowSize(8),{CURVE:e,getPublicKey:W,sign:Y,verify:H,ExtendedPoint:m,utils:{getExtendedPublicKey:F,randomPrivateKey:()=>o(t.BYTES),precompute(V=8,R=m.BASE){return R._setWindowSize(V),R.multiply(BigInt(3)),R}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const wu=BigInt(0),b8=BigInt(1);function nte(r){return hh(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function ite(r){const e=nte(r),{P:t}=e,n=w=>ft(w,t),i=e.montgomeryBits,s=Math.ceil(i/8),o=e.nByteLength,a=e.adjustScalarBytes||(w=>w),c=e.powPminus2||(w=>fL(w,t-BigInt(2),t));function l(w,m,E){const C=n(w*(m-E));return m=n(m-C),E=n(E+C),[m,E]}const d=(e.a-BigInt(2))/BigInt(4);function h(w,m){On("u",w,wu,t),On("scalar",m,wu,t);const E=m,C=w;let k=b8,A=wu,I=w,D=b8,F=wu,W;for(let Y=BigInt(i-1);Y>=wu;Y--){const j=E>>Y&b8;F^=j,W=l(F,k,I),k=W[0],I=W[1],W=l(F,A,D),A=W[0],D=W[1],F=j;const H=k+A,G=n(H*H),V=k-A,R=n(V*V),L=G-R,q=I+D,Q=I-D,K=n(Q*H),ce=n(q*V),me=K+ce,de=K-ce;I=n(me*me),D=n(C*n(de*de)),k=n(G*R),A=n(L*(G+n(d*L)))}W=l(F,k,I),k=W[0],I=W[1],W=l(F,A,D),A=W[0],D=W[1];const U=c(A);return n(k*U)}function p(w){return E1(n(w),s)}function b(w){const m=Lt("u coordinate",w,s);return o===32&&(m[31]&=127),dl(m)}function f(w){const m=Lt("scalar",w),E=m.length;if(E!==s&&E!==o){let C=""+s+" or "+o;throw new Error("invalid scalar, expected "+C+" bytes, got "+E)}return dl(a(m))}function g(w,m){const E=b(m),C=f(w),k=h(E,C);if(k===wu)throw new Error("invalid private or public key received");return p(k)}const v=p(e.Gu);function y(w){return g(w,v)}return{scalarMult:g,scalarMultBase:y,getSharedSecret:(w,m)=>g(w,m),getPublicKey:w=>y(w),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:v}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const x1=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),ck=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const ste=BigInt(1),lk=BigInt(2),ote=BigInt(3),ate=BigInt(5),cte=BigInt(8);function EL(r){const e=BigInt(10),t=BigInt(20),n=BigInt(40),i=BigInt(80),s=x1,a=r*r%s*r%s,c=$t(a,lk,s)*a%s,l=$t(c,ste,s)*r%s,d=$t(l,ate,s)*l%s,h=$t(d,e,s)*d%s,p=$t(h,t,s)*h%s,b=$t(p,n,s)*p%s,f=$t(b,i,s)*b%s,g=$t(f,i,s)*b%s,v=$t(g,e,s)*d%s;return{pow_p_5_8:$t(v,lk,s)*r%s,b2:a}}function xL(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function lte(r,e){const t=x1,n=ft(e*e*e,t),i=ft(n*n*e,t),s=EL(r*i).pow_p_5_8;let o=ft(r*n*s,t);const a=ft(e*o*o,t),c=o,l=ft(o*ck,t),d=a===r,h=a===ft(-r,t),p=a===ft(-r*ck,t);return d&&(o=c),(h||p)&&(o=l),Hee(o,t)&&(o=ft(-o,t)),{isValid:d||h,value:o}}const uk=Bm(x1,void 0,!0),ute={a:uk.create(BigInt(-1)),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:uk,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:cte,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Lee,randomBytes:PE,adjustScalarBytes:xL,uvRatio:lte},zg=rte(ute),Cp=ite({P:x1,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{const e=x1,{pow_p_5_8:t,b2:n}=EL(r);return ft($t(t,ote,e)*n,e)},adjustScalarBytes:xL,randomBytes:PE}),S1=32,Xs=64,q6=32;function dte(){const r=zg.utils.randomPrivateKey(),e=zg.getPublicKey(r);return{privateKey:pte(r,e),publicKey:e}}function hte(r,e){const t=r.subarray(0,q6);return zg.sign(e instanceof Uint8Array?e:e.subarray(),t)}function fte(r,e,t){return zg.verify(e,t instanceof Uint8Array?t:t.subarray(),r)}function pte(r,e){const t=new Uint8Array(Xs);for(let n=0;n<q6;n++)t[n]=r[n],t[q6+n]=e[n];return t}class SL{constructor(e){u(this,"type","Ed25519");u(this,"raw");this.raw=A1(e,S1)}toMultihash(){return _E.digest(Ss(this))}toCID(){return Pm.createV1(114,this.toMultihash())}toString(){return li.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Fe(this.raw,e.raw)}verify(e,t){return fte(this.raw,t,e)}}class W6{constructor(e,t){u(this,"type","Ed25519");u(this,"raw");u(this,"publicKey");this.raw=A1(e,Xs),this.publicKey=new SL(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Fe(this.raw,e.raw)}sign(e){return hte(this.raw,e)}}function AL(r){if(r.length>Xs){r=A1(r,Xs+S1);const n=r.subarray(0,Xs),i=r.subarray(Xs,r.length);return new W6(n,i)}r=A1(r,Xs);const e=r.subarray(0,Xs),t=r.subarray(S1);return new W6(e,t)}function BE(r){return r=A1(r,S1),new SL(r)}async function gte(){const{privateKey:r,publicKey:e}=dte();return new W6(r,e)}function A1(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new Z(`Key must be a Uint8Array of length ${e}, got ${r.length}`);return r}const yte=Math.pow(2,7),mte=Math.pow(2,14),wte=Math.pow(2,21),LE=Math.pow(2,28),ME=Math.pow(2,35),UE=Math.pow(2,42),FE=Math.pow(2,49),st=128,Ur=127;function mt(r){if(r<yte)return 1;if(r<mte)return 2;if(r<wte)return 3;if(r<LE)return 4;if(r<ME)return 5;if(r<UE)return 6;if(r<FE)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function CL(r,e,t=0){switch(mt(r)){case 8:e[t++]=r&255|st,r/=128;case 7:e[t++]=r&255|st,r/=128;case 6:e[t++]=r&255|st,r/=128;case 5:e[t++]=r&255|st,r/=128;case 4:e[t++]=r&255|st,r>>>=7;case 3:e[t++]=r&255|st,r>>>=7;case 2:e[t++]=r&255|st,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function bte(r,e,t=0){switch(mt(r)){case 8:e.set(t++,r&255|st),r/=128;case 7:e.set(t++,r&255|st),r/=128;case 6:e.set(t++,r&255|st),r/=128;case 5:e.set(t++,r&255|st),r/=128;case 4:e.set(t++,r&255|st),r>>>=7;case 3:e.set(t++,r&255|st),r>>>=7;case 2:e.set(t++,r&255|st),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function kL(r,e){let t=r[e],n=0;if(n+=t&Ur,t<st||(t=r[e+1],n+=(t&Ur)<<7,t<st)||(t=r[e+2],n+=(t&Ur)<<14,t<st)||(t=r[e+3],n+=(t&Ur)<<21,t<st)||(t=r[e+4],n+=(t&Ur)*LE,t<st)||(t=r[e+5],n+=(t&Ur)*ME,t<st)||(t=r[e+6],n+=(t&Ur)*UE,t<st)||(t=r[e+7],n+=(t&Ur)*FE,t<st))return n;throw new RangeError("Could not decode varint")}function vte(r,e){let t=r.get(e),n=0;if(n+=t&Ur,t<st||(t=r.get(e+1),n+=(t&Ur)<<7,t<st)||(t=r.get(e+2),n+=(t&Ur)<<14,t<st)||(t=r.get(e+3),n+=(t&Ur)<<21,t<st)||(t=r.get(e+4),n+=(t&Ur)*LE,t<st)||(t=r.get(e+5),n+=(t&Ur)*ME,t<st)||(t=r.get(e+6),n+=(t&Ur)*UE,t<st)||(t=r.get(e+7),n+=(t&Ur)*FE,t<st))return n;throw new RangeError("Could not decode varint")}function Hr(r,e,t=0){return e==null&&(e=zn(mt(r))),e instanceof Uint8Array?CL(r,e,t):bte(r,e,t)}function Ns(r,e=0){return r instanceof Uint8Array?kL(r,e):vte(r,e)}const zE=new Float32Array([-0]),Ta=new Uint8Array(zE.buffer);function Ete(r,e,t){zE[0]=r,e[t]=Ta[0],e[t+1]=Ta[1],e[t+2]=Ta[2],e[t+3]=Ta[3]}function xte(r,e){return Ta[0]=r[e],Ta[1]=r[e+1],Ta[2]=r[e+2],Ta[3]=r[e+3],zE[0]}const VE=new Float64Array([-0]),Fr=new Uint8Array(VE.buffer);function Ste(r,e,t){VE[0]=r,e[t]=Fr[0],e[t+1]=Fr[1],e[t+2]=Fr[2],e[t+3]=Fr[3],e[t+4]=Fr[4],e[t+5]=Fr[5],e[t+6]=Fr[6],e[t+7]=Fr[7]}function Ate(r,e){return Fr[0]=r[e],Fr[1]=r[e+1],Fr[2]=r[e+2],Fr[3]=r[e+3],Fr[4]=r[e+4],Fr[5]=r[e+5],Fr[6]=r[e+6],Fr[7]=r[e+7],VE[0]}const Cte=BigInt(Number.MAX_SAFE_INTEGER),kte=BigInt(Number.MIN_SAFE_INTEGER);class Vr{constructor(e,t){u(this,"lo");u(this,"hi");this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return hl;if(e<Cte&&e>kte)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let n=e>>32n,i=e-(n<<32n);return t&&(n=~n|0n,i=~i|0n,++i>dk&&(i=0n,++n>dk&&(n=0n))),new Vr(Number(i),Number(n))}static fromNumber(e){if(e===0)return hl;const t=e<0;t&&(e=-e);let n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new Vr(n,i)}static from(e){return typeof e=="number"?Vr.fromNumber(e):typeof e=="bigint"?Vr.fromBigInt(e):typeof e=="string"?Vr.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new Vr(e.low>>>0,e.high>>>0):hl}}const hl=new Vr(0,0);hl.toBigInt=function(){return 0n};hl.zzEncode=hl.zzDecode=function(){return this};hl.length=function(){return 1};const dk=4294967296n;function Ite(r){let e=0,t=0;for(let n=0;n<r.length;++n)t=r.charCodeAt(n),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function _te(r,e,t){if(t-e<1)return"";let i;const s=[];let o=0,a;for(;e<t;)a=r[e++],a<128?s[o++]=a:a>191&&a<224?s[o++]=(a&31)<<6|r[e++]&63:a>239&&a<365?(a=((a&7)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,s[o++]=55296+(a>>10),s[o++]=56320+(a&1023)):s[o++]=(a&15)<<12|(r[e++]&63)<<6|r[e++]&63,o>8191&&((i??(i=[])).push(String.fromCharCode.apply(String,s)),o=0);return i!=null?(o>0&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))}function IL(r,e,t){const n=t;let i,s;for(let o=0;o<r.length;++o)i=r.charCodeAt(o),i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&((s=r.charCodeAt(o+1))&64512)===56320?(i=65536+((i&1023)<<10)+(s&1023),++o,e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128);return t-n}function Ii(r,e){return RangeError(`index out of range: ${r.pos} + ${e??1} > ${r.len}`)}function kp(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}class Tte{constructor(e){u(this,"buf");u(this,"pos");u(this,"len");u(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Ii(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Ii(this,4);return kp(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Ii(this,4);return kp(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Ii(this,4);const e=xte(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw Ii(this,4);const e=Ate(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Ii(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){const e=this.bytes();return _te(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Ii(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Ii(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new Vr(0,0);let t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw Ii(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw Ii(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Ii(this,8);const e=kp(this.buf,this.pos+=4),t=kp(this.buf,this.pos+=4);return new Vr(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=kL(this.buf,this.pos);return this.pos+=mt(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function $te(r){return new Tte(r instanceof Uint8Array?r:r.subarray())}function ze(r,e,t){const n=$te(r);return e.decode(n,void 0,t)}function Pte(r){let n,i=8192;return function(o){if(o<1||o>4096)return zn(o);i+o>8192&&(n=zn(8192),i=0);const a=n.subarray(i,i+=o);return i&7&&(i=(i|7)+1),a}}class vf{constructor(e,t,n){u(this,"fn");u(this,"len");u(this,"next");u(this,"val");this.fn=e,this.len=t,this.next=void 0,this.val=n}}function v8(){}class Dte{constructor(e){u(this,"head");u(this,"tail");u(this,"len");u(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const Nte=Pte();function Ote(r){return globalThis.Buffer!=null?zn(r):Nte(r)}class G6{constructor(){u(this,"len");u(this,"head");u(this,"tail");u(this,"states");this.len=0,this.head=new vf(v8,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new vf(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new Bte((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(Ip,10,Vr.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=Vr.fromBigInt(e);return this._push(Ip,t.length(),t)}uint64Number(e){return this._push(CL,mt(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=Vr.fromBigInt(e).zzEncode();return this._push(Ip,t.length(),t)}sint64Number(e){const t=Vr.fromNumber(e).zzEncode();return this._push(Ip,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(E8,1,e?1:0)}fixed32(e){return this._push(Xh,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=Vr.fromBigInt(e);return this._push(Xh,4,t.lo)._push(Xh,4,t.hi)}fixed64Number(e){const t=Vr.fromNumber(e);return this._push(Xh,4,t.lo)._push(Xh,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(Ete,4,e)}double(e){return this._push(Ste,8,e)}bytes(e){const t=e.length>>>0;return t===0?this._push(E8,1,0):this.uint32(t)._push(Lte,t,e)}string(e){const t=Ite(e);return t!==0?this.uint32(t)._push(IL,t,e):this._push(E8,1,0)}fork(){return this.states=new Dte(this),this.head=this.tail=new vf(v8,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new vf(v8,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next;const t=Ote(this.len);let n=0;for(;e!=null;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}}function E8(r,e,t){e[t]=r&255}function Rte(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}class Bte extends vf{constructor(t,n){super(Rte,t,n);u(this,"next");this.next=void 0}}function Ip(r,e,t){for(;r.hi!==0;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}function Xh(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function Lte(r,e,t){e.set(r,t)}globalThis.Buffer!=null&&(G6.prototype.bytes=function(r){const e=r.length>>>0;return this.uint32(e),e>0&&this._push(Mte,e,r),this},G6.prototype.string=function(r){const e=globalThis.Buffer.byteLength(r);return this.uint32(e),e>0&&this._push(Ute,e,r),this});function Mte(r,e,t){e.set(r,t)}function Ute(r,e,t){r.length<40?IL(r,e,t):e.utf8Write!=null?e.utf8Write(r,t):e.set(se(r),t)}function Fte(){return new G6}function Ve(r,e){const t=Fte();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var Vg;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(Vg||(Vg={}));function _L(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function En(r){function e(i){if(r[i.toString()]==null)throw new Error("Invalid enum value");return r[i]}const t=function(s,o){const a=e(s);o.int32(a)},n=function(s){const o=s.int32();return e(o)};return _L("enum",Vg.VARINT,t,n)}function Ke(r,e){return _L("message",Vg.LENGTH_DELIMITED,r,e)}class gr extends Error{constructor(){super(...arguments);u(this,"code","ERR_MAX_LENGTH");u(this,"name","MaxLengthError")}}class hk extends Error{constructor(){super(...arguments);u(this,"code","ERR_MAX_SIZE");u(this,"name","MaxSizeError")}}var It;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.ECDSA="ECDSA"})(It||(It={}));var Q6;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1",r[r.ECDSA=3]="ECDSA"})(Q6||(Q6={}));(function(r){r.codec=()=>En(Q6)})(It||(It={}));var rc;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),It.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=It.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(rc||(rc={}));var Kg;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),It.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=It.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(Kg||(Kg={}));const bu=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function zte(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Xu(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function v0(r,...e){if(!zte(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Lm(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Xu(r.outputLen),Xu(r.blockLen)}function jg(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Vte(r,e){v0(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function ks(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function Mf(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function ls(r,e){return r<<32-e|r>>>e}function x8(r,e){return r<<e|r>>>32-e>>>0}const Kte=async()=>{};async function jte(r,e,t){let n=Date.now();for(let i=0;i<r;i++){t(i);const s=Date.now()-n;s>=0&&s<e||(await Kte(),n+=s)}}function TL(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function C1(r){return typeof r=="string"&&(r=TL(r)),v0(r),r}function fk(r){return typeof r=="string"&&(r=TL(r)),v0(r),r}function Hte(r,e){if(e!==void 0&&{}.toString.call(e)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(r,e)}class $L{}function KE(r){const e=n=>r().update(C1(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function qte(r=32){if(bu&&typeof bu.getRandomValues=="function")return bu.getRandomValues(new Uint8Array(r));if(bu&&typeof bu.randomBytes=="function")return Uint8Array.from(bu.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function Il(r){if(isNaN(r)||r<=0)throw new Z("random bytes length must be a Number bigger than 0");return qte(r)}class pk extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}}class gk extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class Wte extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}const Is={get(r=globalThis){const e=r.crypto;if((e==null?void 0:e.subtle)==null)throw new Wte("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}};function Gte(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function PL(r,e,t){return r&e^~r&t}function DL(r,e,t){return r&e^r&t^e&t}class jE extends $L{constructor(e,t,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Mf(this.buffer)}update(e){jg(this),e=C1(e),v0(e);const{view:t,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Mf(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){jg(this),Vte(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,ks(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)t[h]=0;Gte(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Mf(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,d[h],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const ta=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ar=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),_p=BigInt(2**32-1),yk=BigInt(32);function Qte(r,e=!1){return e?{h:Number(r&_p),l:Number(r>>yk&_p)}:{h:Number(r>>yk&_p)|0,l:Number(r&_p)|0}}function Yte(r,e=!1){const t=r.length;let n=new Uint32Array(t),i=new Uint32Array(t);for(let s=0;s<t;s++){const{h:o,l:a}=Qte(r[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const mk=(r,e,t)=>r>>>t,wk=(r,e,t)=>r<<32-t|e>>>t,vu=(r,e,t)=>r>>>t|e<<32-t,Eu=(r,e,t)=>r<<32-t|e>>>t,Tp=(r,e,t)=>r<<64-t|e>>>t-32,$p=(r,e,t)=>r>>>t-32|e<<64-t;function Ks(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}const Jte=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),Xte=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,Zte=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),ere=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,tre=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0),rre=(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0,nre=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ra=new Uint32Array(64);class ire extends jE{constructor(e=32){super(64,e,8,!1),this.A=ta[0]|0,this.B=ta[1]|0,this.C=ta[2]|0,this.D=ta[3]|0,this.E=ta[4]|0,this.F=ta[5]|0,this.G=ta[6]|0,this.H=ta[7]|0}get(){const{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)ra[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const p=ra[h-15],b=ra[h-2],f=ls(p,7)^ls(p,18)^p>>>3,g=ls(b,17)^ls(b,19)^b>>>10;ra[h]=g+ra[h-7]+f+ra[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:l,H:d}=this;for(let h=0;h<64;h++){const p=ls(a,6)^ls(a,11)^ls(a,25),b=d+p+PL(a,c,l)+nre[h]+ra[h]|0,g=(ls(n,2)^ls(n,13)^ls(n,22))+DL(n,i,s)|0;d=l,l=c,c=a,a=o+b|0,o=s,s=i,i=n,n=b+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(n,i,s,o,a,c,l,d)}roundClean(){ks(ra)}destroy(){this.set(0,0,0,0,0,0,0,0),ks(this.buffer)}}const NL=Yte(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),sre=NL[0],ore=NL[1],na=new Uint32Array(80),ia=new Uint32Array(80);class are extends jE{constructor(e=64){super(128,e,16,!1),this.Ah=Ar[0]|0,this.Al=Ar[1]|0,this.Bh=Ar[2]|0,this.Bl=Ar[3]|0,this.Ch=Ar[4]|0,this.Cl=Ar[5]|0,this.Dh=Ar[6]|0,this.Dl=Ar[7]|0,this.Eh=Ar[8]|0,this.El=Ar[9]|0,this.Fh=Ar[10]|0,this.Fl=Ar[11]|0,this.Gh=Ar[12]|0,this.Gl=Ar[13]|0,this.Hh=Ar[14]|0,this.Hl=Ar[15]|0}get(){const{Ah:e,Al:t,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:d,Fh:h,Fl:p,Gh:b,Gl:f,Hh:g,Hl:v}=this;return[e,t,n,i,s,o,a,c,l,d,h,p,b,f,g,v]}set(e,t,n,i,s,o,a,c,l,d,h,p,b,f,g,v){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=d|0,this.Fh=h|0,this.Fl=p|0,this.Gh=b|0,this.Gl=f|0,this.Hh=g|0,this.Hl=v|0}process(e,t){for(let m=0;m<16;m++,t+=4)na[m]=e.getUint32(t),ia[m]=e.getUint32(t+=4);for(let m=16;m<80;m++){const E=na[m-15]|0,C=ia[m-15]|0,k=vu(E,C,1)^vu(E,C,8)^mk(E,C,7),A=Eu(E,C,1)^Eu(E,C,8)^wk(E,C,7),I=na[m-2]|0,D=ia[m-2]|0,F=vu(I,D,19)^Tp(I,D,61)^mk(I,D,6),W=Eu(I,D,19)^$p(I,D,61)^wk(I,D,6),U=Zte(A,W,ia[m-7],ia[m-16]),Y=ere(U,k,F,na[m-7],na[m-16]);na[m]=Y|0,ia[m]=U|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:d,Eh:h,El:p,Fh:b,Fl:f,Gh:g,Gl:v,Hh:y,Hl:w}=this;for(let m=0;m<80;m++){const E=vu(h,p,14)^vu(h,p,18)^Tp(h,p,41),C=Eu(h,p,14)^Eu(h,p,18)^$p(h,p,41),k=h&b^~h&g,A=p&f^~p&v,I=tre(w,C,A,ore[m],ia[m]),D=rre(I,y,E,k,sre[m],na[m]),F=I|0,W=vu(n,i,28)^Tp(n,i,34)^Tp(n,i,39),U=Eu(n,i,28)^$p(n,i,34)^$p(n,i,39),Y=n&s^n&a^s&a,j=i&o^i&c^o&c;y=g|0,w=v|0,g=b|0,v=f|0,b=h|0,f=p|0,{h,l:p}=Ks(l|0,d|0,D|0,F|0),l=a|0,d=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const H=Jte(F,U,j);n=Xte(H,D,W,Y),i=H|0}({h:n,l:i}=Ks(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=Ks(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Ks(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:d}=Ks(this.Dh|0,this.Dl|0,l|0,d|0),{h,l:p}=Ks(this.Eh|0,this.El|0,h|0,p|0),{h:b,l:f}=Ks(this.Fh|0,this.Fl|0,b|0,f|0),{h:g,l:v}=Ks(this.Gh|0,this.Gl|0,g|0,v|0),{h:y,l:w}=Ks(this.Hh|0,this.Hl|0,y|0,w|0),this.set(n,i,s,o,a,c,l,d,h,p,b,f,g,v,y,w)}roundClean(){ks(na,ia)}destroy(){ks(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const cre=KE(()=>new ire),lre=KE(()=>new are),fl=cre;let HE=class{constructor(e,t){u(this,"type","RSA");u(this,"jwk");u(this,"_raw");u(this,"_multihash");this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=WE(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return Pm.createV1(114,this._multihash)}toString(){return li.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Fe(this.raw,e.raw)}verify(e,t){return Sre(this.jwk,t,e)}},OL=class{constructor(e,t){u(this,"type","RSA");u(this,"jwk");u(this,"_raw");u(this,"publicKey");this.jwk=e,this.publicKey=t}get raw(){return this._raw==null&&(this._raw=fre(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Fe(this.raw,e.raw)}sign(e){return xre(this.jwk,e)}};const RL=8192,qE=18,ure=1062,dre=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function hre(r){return{n:re(r[1],"base64url"),e:re(r[2],"base64url"),d:re(r[3],"base64url"),p:re(r[4],"base64url"),q:re(r[5],"base64url"),dp:re(r[6],"base64url"),dq:re(r[7],"base64url"),qi:re(r[8],"base64url"),kty:"RSA"}}function fre(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new Z("JWK was missing components");return lo([$n(Uint8Array.from([0])),$n(se(r.n,"base64url")),$n(se(r.e,"base64url")),$n(se(r.d,"base64url")),$n(se(r.p,"base64url")),$n(se(r.q,"base64url")),$n(se(r.dp,"base64url")),$n(se(r.dq,"base64url")),$n(se(r.qi,"base64url"))]).subarray()}function pre(r){const e=wc(r[1],{offset:0});return{kty:"RSA",n:re(e[0],"base64url"),e:re(e[1],"base64url")}}function WE(r){if(r.n==null||r.e==null)throw new Z("JWK was missing components");return lo([dre,TE(lo([$n(se(r.n,"base64url")),$n(se(r.e,"base64url"))]))]).subarray()}function gre(r){const e=wc(r);return BL(e)}function BL(r){const e=hre(r);return mre(e)}function yre(r,e){if(r.byteLength>=ure)throw new b1("Key size is too large");const t=wc(r,{offset:0});return LL(t,r,e)}function LL(r,e,t){const n=pre(r);if(t==null){const i=fl(rc.encode({Type:It.RSA,Data:e}));t=kl(qE,i)}return new HE(n,t)}function mre(r){if(Cre(r)>RL)throw new Z("Key size is too large");const e=bre(r),t=fl(rc.encode({Type:It.RSA,Data:WE(e.publicKey)})),n=kl(qE,t);return new OL(e.privateKey,new HE(e.publicKey,n))}async function wre(r){if(r>RL)throw new Z("Key size is too large");const e=await Ere(r),t=fl(rc.encode({Type:It.RSA,Data:WE(e.publicKey)})),n=kl(qE,t);return new OL(e.privateKey,new HE(e.publicKey,n))}function bre(r){if(r==null)throw new Z("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}const vre="1.2.840.113549.1.1.1";async function Ere(r){const e=await Is.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await Are(e);return{privateKey:t[0],publicKey:t[1]}}async function xre(r,e){const t=await Is.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Is.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(n,0,n.byteLength)}async function Sre(r,e,t){const n=await Is.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Is.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,t instanceof Uint8Array?t:t.subarray())}async function Are(r){if(r.privateKey==null||r.publicKey==null)throw new Z("Private and public key are required");return Promise.all([Is.get().subtle.exportKey("jwk",r.privateKey),Is.get().subtle.exportKey("jwk",r.publicKey)])}function Cre(r){if(r.kty!=="RSA")throw new Z("invalid key type");if(r.n==null)throw new Z("invalid key modulus");return se(r.n,"base64url").length*8}let ML=class extends aL{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,nee(e);const n=$E(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return Mg(this),this.iHash.update(e),this}digestInto(e){Mg(this),Om(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const UL=(r,e,t)=>new ML(r,e).update(t).digest();UL.create=(r,e)=>new ML(r,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function bk(r){r.lowS!==void 0&&qa("lowS",r.lowS),r.prehash!==void 0&&qa("prehash",r.prehash)}function kre(r){const e=RE(r);hh(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:n,a:i}=e;if(t){if(!n.eql(i,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}class Ire extends Error{constructor(e=""){super(e)}}const Zs={Err:Ire,_tlv:{encode:(r,e)=>{const{Err:t}=Zs;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const n=e.length/2,i=Ap(n);if(i.length/2&128)throw new t("tlv.encode: long form length too big");const s=n>127?Ap(i.length/2|128):"";return Ap(r)+s+i+e},decode(r,e){const{Err:t}=Zs;let n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const d of l)o=o<<8|d;if(n+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(r){const{Err:e}=Zs;if(r<ro)throw new e("integer: negative integers are not allowed");let t=Ap(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=Zs;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return ul(r)}},toSig(r){const{Err:e,_int:t,_tlv:n}=Zs,i=Lt("signature",r),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:l,l:d}=n.decode(2,c);if(d.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(r){const{_tlv:e,_int:t}=Zs,n=e.encode(2,t.encode(r.r)),i=e.encode(2,t.encode(r.s)),s=n+i;return e.encode(48,s)}},ro=BigInt(0),Xt=BigInt(1);BigInt(2);const vk=BigInt(3);BigInt(4);function _re(r){const e=kre(r),{Fp:t}=e,n=Bm(e.n,e.nBitLength),i=e.toBytes||((g,v,y)=>{const w=v.toAffine();return Id(Uint8Array.from([4]),t.toBytes(w.x),t.toBytes(w.y))}),s=e.fromBytes||(g=>{const v=g.subarray(1),y=t.fromBytes(v.subarray(0,t.BYTES)),w=t.fromBytes(v.subarray(t.BYTES,2*t.BYTES));return{x:y,y:w}});function o(g){const{a:v,b:y}=e,w=t.sqr(g),m=t.mul(w,g);return t.add(t.add(m,t.mul(g,v)),y)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(g){return OE(g,Xt,e.n)}function c(g){const{allowedPrivateKeyLengths:v,nByteLength:y,wrapPrivateKey:w,n:m}=e;if(v&&typeof g!="bigint"){if(Cd(g)&&(g=kd(g)),typeof g!="string"||!v.includes(g.length))throw new Error("invalid private key");g=g.padStart(y*2,"0")}let E;try{E=typeof g=="bigint"?g:ul(Lt("private key",g,y))}catch{throw new Error("invalid private key, expected hex or "+y+" bytes, got "+typeof g)}return w&&(E=ft(E,m)),On("private key",E,Xt,m),E}function l(g){if(!(g instanceof p))throw new Error("ProjectivePoint expected")}const d=Fg((g,v)=>{const{px:y,py:w,pz:m}=g;if(t.eql(m,t.ONE))return{x:y,y:w};const E=g.is0();v==null&&(v=E?t.ONE:t.inv(m));const C=t.mul(y,v),k=t.mul(w,v),A=t.mul(m,v);if(E)return{x:t.ZERO,y:t.ZERO};if(!t.eql(A,t.ONE))throw new Error("invZ was invalid");return{x:C,y:k}}),h=Fg(g=>{if(g.is0()){if(e.allowInfinityPoint&&!t.is0(g.py))return;throw new Error("bad point: ZERO")}const{x:v,y}=g.toAffine();if(!t.isValid(v)||!t.isValid(y))throw new Error("bad point: x or y not FE");const w=t.sqr(y),m=o(v);if(!t.eql(w,m))throw new Error("bad point: equation left != right");if(!g.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class p{constructor(v,y,w){if(v==null||!t.isValid(v))throw new Error("x required");if(y==null||!t.isValid(y))throw new Error("y required");if(w==null||!t.isValid(w))throw new Error("z required");this.px=v,this.py=y,this.pz=w,Object.freeze(this)}static fromAffine(v){const{x:y,y:w}=v||{};if(!v||!t.isValid(y)||!t.isValid(w))throw new Error("invalid affine point");if(v instanceof p)throw new Error("projective point not allowed");const m=E=>t.eql(E,t.ZERO);return m(y)&&m(w)?p.ZERO:new p(y,w,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(v){const y=t.invertBatch(v.map(w=>w.pz));return v.map((w,m)=>w.toAffine(y[m])).map(p.fromAffine)}static fromHex(v){const y=p.fromAffine(s(Lt("pointHex",v)));return y.assertValidity(),y}static fromPrivateKey(v){return p.BASE.multiply(c(v))}static msm(v,y){return vL(p,n,v,y)}_setWindowSize(v){f.setWindowSize(this,v)}assertValidity(){h(this)}hasEvenY(){const{y:v}=this.toAffine();if(t.isOdd)return!t.isOdd(v);throw new Error("Field doesn't support isOdd")}equals(v){l(v);const{px:y,py:w,pz:m}=this,{px:E,py:C,pz:k}=v,A=t.eql(t.mul(y,k),t.mul(E,m)),I=t.eql(t.mul(w,k),t.mul(C,m));return A&&I}negate(){return new p(this.px,t.neg(this.py),this.pz)}double(){const{a:v,b:y}=e,w=t.mul(y,vk),{px:m,py:E,pz:C}=this;let k=t.ZERO,A=t.ZERO,I=t.ZERO,D=t.mul(m,m),F=t.mul(E,E),W=t.mul(C,C),U=t.mul(m,E);return U=t.add(U,U),I=t.mul(m,C),I=t.add(I,I),k=t.mul(v,I),A=t.mul(w,W),A=t.add(k,A),k=t.sub(F,A),A=t.add(F,A),A=t.mul(k,A),k=t.mul(U,k),I=t.mul(w,I),W=t.mul(v,W),U=t.sub(D,W),U=t.mul(v,U),U=t.add(U,I),I=t.add(D,D),D=t.add(I,D),D=t.add(D,W),D=t.mul(D,U),A=t.add(A,D),W=t.mul(E,C),W=t.add(W,W),D=t.mul(W,U),k=t.sub(k,D),I=t.mul(W,F),I=t.add(I,I),I=t.add(I,I),new p(k,A,I)}add(v){l(v);const{px:y,py:w,pz:m}=this,{px:E,py:C,pz:k}=v;let A=t.ZERO,I=t.ZERO,D=t.ZERO;const F=e.a,W=t.mul(e.b,vk);let U=t.mul(y,E),Y=t.mul(w,C),j=t.mul(m,k),H=t.add(y,w),G=t.add(E,C);H=t.mul(H,G),G=t.add(U,Y),H=t.sub(H,G),G=t.add(y,m);let V=t.add(E,k);return G=t.mul(G,V),V=t.add(U,j),G=t.sub(G,V),V=t.add(w,m),A=t.add(C,k),V=t.mul(V,A),A=t.add(Y,j),V=t.sub(V,A),D=t.mul(F,G),A=t.mul(W,j),D=t.add(A,D),A=t.sub(Y,D),D=t.add(Y,D),I=t.mul(A,D),Y=t.add(U,U),Y=t.add(Y,U),j=t.mul(F,j),G=t.mul(W,G),Y=t.add(Y,j),j=t.sub(U,j),j=t.mul(F,j),G=t.add(G,j),U=t.mul(Y,G),I=t.add(I,U),U=t.mul(V,G),A=t.mul(H,A),A=t.sub(A,U),U=t.mul(H,Y),D=t.mul(V,D),D=t.add(D,U),new p(A,I,D)}subtract(v){return this.add(v.negate())}is0(){return this.equals(p.ZERO)}wNAF(v){return f.wNAFCached(this,v,p.normalizeZ)}multiplyUnsafe(v){const{endo:y,n:w}=e;On("scalar",v,ro,w);const m=p.ZERO;if(v===ro)return m;if(this.is0()||v===Xt)return this;if(!y||f.hasPrecomputes(this))return f.wNAFCachedUnsafe(this,v,p.normalizeZ);let{k1neg:E,k1:C,k2neg:k,k2:A}=y.splitScalar(v),I=m,D=m,F=this;for(;C>ro||A>ro;)C&Xt&&(I=I.add(F)),A&Xt&&(D=D.add(F)),F=F.double(),C>>=Xt,A>>=Xt;return E&&(I=I.negate()),k&&(D=D.negate()),D=new p(t.mul(D.px,y.beta),D.py,D.pz),I.add(D)}multiply(v){const{endo:y,n:w}=e;On("scalar",v,Xt,w);let m,E;if(y){const{k1neg:C,k1:k,k2neg:A,k2:I}=y.splitScalar(v);let{p:D,f:F}=this.wNAF(k),{p:W,f:U}=this.wNAF(I);D=f.constTimeNegate(C,D),W=f.constTimeNegate(A,W),W=new p(t.mul(W.px,y.beta),W.py,W.pz),m=D.add(W),E=F.add(U)}else{const{p:C,f:k}=this.wNAF(v);m=C,E=k}return p.normalizeZ([m,E])[0]}multiplyAndAddUnsafe(v,y,w){const m=p.BASE,E=(k,A)=>A===ro||A===Xt||!k.equals(m)?k.multiplyUnsafe(A):k.multiply(A),C=E(this,y).add(E(v,w));return C.is0()?void 0:C}toAffine(v){return d(this,v)}isTorsionFree(){const{h:v,isTorsionFree:y}=e;if(v===Xt)return!0;if(y)return y(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:v,clearCofactor:y}=e;return v===Xt?this:y?y(p,this):this.multiplyUnsafe(e.h)}toRawBytes(v=!0){return qa("isCompressed",v),this.assertValidity(),i(p,this,v)}toHex(v=!0){return qa("isCompressed",v),kd(this.toRawBytes(v))}}p.BASE=new p(e.Gx,e.Gy,t.ONE),p.ZERO=new p(t.ZERO,t.ONE,t.ZERO);const b=e.nBitLength,f=bL(p,e.endo?Math.ceil(b/2):b);return{CURVE:e,ProjectivePoint:p,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function Tre(r){const e=RE(r);return hh(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function $re(r){const e=Tre(r),{Fp:t,n}=e,i=t.BYTES+1,s=2*t.BYTES+1;function o(j){return ft(j,n)}function a(j){return j6(j,n)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:d,isWithinCurveOrder:h}=_re({...e,toBytes(j,H,G){const V=H.toAffine(),R=t.toBytes(V.x),L=Id;return qa("isCompressed",G),G?L(Uint8Array.from([H.hasEvenY()?2:3]),R):L(Uint8Array.from([4]),R,t.toBytes(V.y))},fromBytes(j){const H=j.length,G=j[0],V=j.subarray(1);if(H===i&&(G===2||G===3)){const R=ul(V);if(!OE(R,Xt,t.ORDER))throw new Error("Point is not on curve");const L=d(R);let q;try{q=t.sqrt(L)}catch(ce){const me=ce instanceof Error?": "+ce.message:"";throw new Error("Point is not on curve"+me)}const Q=(q&Xt)===Xt;return(G&1)===1!==Q&&(q=t.neg(q)),{x:R,y:q}}else if(H===s&&G===4){const R=t.fromBytes(V.subarray(0,t.BYTES)),L=t.fromBytes(V.subarray(t.BYTES,2*t.BYTES));return{x:R,y:L}}else{const R=i,L=s;throw new Error("invalid Point, expected length of "+R+", or uncompressed "+L+", got "+H)}}}),p=j=>kd(v1(j,e.nByteLength));function b(j){const H=n>>Xt;return j>H}function f(j){return b(j)?o(-j):j}const g=(j,H,G)=>ul(j.slice(H,G));class v{constructor(H,G,V){On("r",H,Xt,n),On("s",G,Xt,n),this.r=H,this.s=G,V!=null&&(this.recovery=V),Object.freeze(this)}static fromCompact(H){const G=e.nByteLength;return H=Lt("compactSignature",H,G*2),new v(g(H,0,G),g(H,G,2*G))}static fromDER(H){const{r:G,s:V}=Zs.toSig(Lt("DER",H));return new v(G,V)}assertValidity(){}addRecoveryBit(H){return new v(this.r,this.s,H)}recoverPublicKey(H){const{r:G,s:V,recovery:R}=this,L=k(Lt("msgHash",H));if(R==null||![0,1,2,3].includes(R))throw new Error("recovery id invalid");const q=R===2||R===3?G+e.n:G;if(q>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const Q=R&1?"03":"02",K=c.fromHex(Q+p(q)),ce=a(q),me=o(-L*ce),de=o(V*ce),ue=c.BASE.multiplyAndAddUnsafe(K,me,de);if(!ue)throw new Error("point at infinify");return ue.assertValidity(),ue}hasHighS(){return b(this.s)}normalizeS(){return this.hasHighS()?new v(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Ug(this.toDERHex())}toDERHex(){return Zs.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ug(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}}const y={isValidPrivateKey(j){try{return l(j),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const j=yL(e.n);return Yee(e.randomBytes(j),e.n)},precompute(j=8,H=c.BASE){return H._setWindowSize(j),H.multiply(BigInt(3)),H}};function w(j,H=!0){return c.fromPrivateKey(j).toRawBytes(H)}function m(j){const H=Cd(j),G=typeof j=="string",V=(H||G)&&j.length;return H?V===i||V===s:G?V===2*i||V===2*s:j instanceof c}function E(j,H,G=!0){if(m(j))throw new Error("first arg must be private key");if(!m(H))throw new Error("second arg must be public key");return c.fromHex(H).multiply(l(j)).toRawBytes(G)}const C=e.bits2int||function(j){if(j.length>8192)throw new Error("input is too large");const H=ul(j),G=j.length*8-e.nBitLength;return G>0?H>>BigInt(G):H},k=e.bits2int_modN||function(j){return o(C(j))},A=Rm(e.nBitLength);function I(j){return On("num < 2^"+e.nBitLength,j,ro,A),v1(j,e.nByteLength)}function D(j,H,G=F){if(["recovered","canonical"].some(Pe=>Pe in G))throw new Error("sign() legacy options not supported");const{hash:V,randomBytes:R}=e;let{lowS:L,prehash:q,extraEntropy:Q}=G;L==null&&(L=!0),j=Lt("msgHash",j),bk(G),q&&(j=Lt("prehashed msgHash",V(j)));const K=k(j),ce=l(H),me=[I(ce),I(K)];if(Q!=null&&Q!==!1){const Pe=Q===!0?R(t.BYTES):Q;me.push(Lt("extraEntropy",Pe))}const de=Id(...me),ue=K;function $e(Pe){const Je=C(Pe);if(!h(Je))return;const it=a(Je),St=c.BASE.multiply(Je).toAffine(),At=o(St.x);if(At===ro)return;const _t=o(it*o(ue+At*ce));if(_t===ro)return;let Yt=(St.x===At?0:2)|Number(St.y&Xt),Wr=_t;return L&&b(_t)&&(Wr=f(_t),Yt^=1),new v(At,Wr,Yt)}return{seed:de,k2sig:$e}}const F={lowS:e.lowS,prehash:!1},W={lowS:e.lowS,prehash:!1};function U(j,H,G=F){const{seed:V,k2sig:R}=D(j,H,G),L=e;return Fee(L.hash.outputLen,L.nByteLength,L.hmac)(V,R)}c.BASE._setWindowSize(8);function Y(j,H,G,V=W){var Yt;const R=j;H=Lt("msgHash",H),G=Lt("publicKey",G);const{lowS:L,prehash:q,format:Q}=V;if(bk(V),"strict"in V)throw new Error("options.strict was renamed to lowS");if(Q!==void 0&&Q!=="compact"&&Q!=="der")throw new Error("format must be compact or der");const K=typeof R=="string"||Cd(R),ce=!K&&!Q&&typeof R=="object"&&R!==null&&typeof R.r=="bigint"&&typeof R.s=="bigint";if(!K&&!ce)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let me,de;try{if(ce&&(me=new v(R.r,R.s)),K){try{Q!=="compact"&&(me=v.fromDER(R))}catch(Wr){if(!(Wr instanceof Zs.Err))throw Wr}!me&&Q!=="der"&&(me=v.fromCompact(R))}de=c.fromHex(G)}catch{return!1}if(!me||L&&me.hasHighS())return!1;q&&(H=e.hash(H));const{r:ue,s:$e}=me,Pe=k(H),Je=a($e),it=o(Pe*Je),St=o(ue*Je),At=(Yt=c.BASE.multiplyAndAddUnsafe(de,it,St))==null?void 0:Yt.toAffine();return At?o(At.x)===ue:!1}return{CURVE:e,getPublicKey:w,getSharedSecret:E,sign:U,verify:Y,ProjectivePoint:c,Signature:v,utils:y}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Pre(r){return{hash:r,hmac:(e,...t)=>UL(r,e,oee(...t)),randomBytes:PE}}function Dre(r,e){const t=n=>$re({...r,...Pre(n)});return{...t(e),create:t}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const FL=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ek=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Nre=BigInt(1),Y6=BigInt(2),xk=(r,e)=>(r+e/Y6)/e;function Ore(r){const e=FL,t=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=r*r*r%e,d=l*l*r%e,h=$t(d,t,e)*d%e,p=$t(h,t,e)*d%e,b=$t(p,Y6,e)*l%e,f=$t(b,i,e)*b%e,g=$t(f,s,e)*f%e,v=$t(g,a,e)*g%e,y=$t(v,c,e)*v%e,w=$t(y,a,e)*g%e,m=$t(w,t,e)*d%e,E=$t(m,o,e)*f%e,C=$t(E,n,e)*l%e,k=$t(C,Y6,e);if(!J6.eql(J6.sqr(k),r))throw new Error("Cannot find square root");return k}const J6=Bm(FL,void 0,void 0,{sqrt:Ore}),_s=Dre({a:BigInt(0),b:BigInt(7),Fp:J6,n:Ek,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const e=Ek,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Nre*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=t,o=BigInt("0x100000000000000000000000000000000"),a=xk(s*r,e),c=xk(-n*r,e);let l=ft(r-a*t-c*i,e),d=ft(-a*n-c*s,e);const h=l>o,p=d>o;if(h&&(l=e-l),p&&(d=e-d),l>o||d>o)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:h,k1:l,k2neg:p,k2:d}}}},hee);BigInt(0);_s.ProjectivePoint;function Rre({name:r,code:e,encode:t}){return new Bre(r,e,t)}let Bre=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?kl(this.code,t):t.then(n=>kl(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Lre(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const zL=Rre({name:"sha2-256",code:18,encode:Lre("SHA-256")});function VL(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}const Mre=33,Ure=32;function Fre(r,e){const t=zL.digest(e instanceof Uint8Array?e:e.subarray());if(VL(t))return t.then(({digest:n})=>_s.sign(n,r).toDERRawBytes()).catch(n=>{throw new pk(String(n))});try{return _s.sign(t.digest,r).toDERRawBytes()}catch(n){throw new pk(String(n))}}function zre(r,e,t){const n=zL.digest(t instanceof Uint8Array?t:t.subarray());if(VL(n))return n.then(({digest:i})=>_s.verify(e,i,r)).catch(i=>{throw new gk(String(i))});try{return _s.verify(e,n.digest,r)}catch(i){throw new gk(String(i))}}class KL{constructor(e){u(this,"type","secp256k1");u(this,"raw");u(this,"_key");this._key=Hre(e),this.raw=Kre(this._key)}toMultihash(){return _E.digest(Ss(this))}toCID(){return Pm.createV1(114,this.toMultihash())}toString(){return li.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Fe(this.raw,e.raw)}verify(e,t){return zre(this._key,t,e)}}class jL{constructor(e,t){u(this,"type","secp256k1");u(this,"raw");u(this,"publicKey");this.raw=jre(e),this.publicKey=new KL(t??qre(e))}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Fe(this.raw,e.raw)}sign(e){return Fre(this.raw,e)}}function HL(r){return new jL(r)}function GE(r){return new KL(r)}async function Vre(){const r=Wre();return new jL(r)}function Kre(r){return _s.ProjectivePoint.fromHex(r).toRawBytes(!0)}function jre(r){try{return _s.getPublicKey(r,!0),r}catch(e){throw new EE(String(e))}}function Hre(r){try{return _s.ProjectivePoint.fromHex(r),r}catch(e){throw new b1(String(e))}}function qre(r){try{return _s.getPublicKey(r,!0)}catch(e){throw new EE(String(e))}}function Wre(){return _s.utils.randomPrivateKey()}async function Mm(r,e){if(r==="Ed25519")return gte();if(r==="secp256k1")return Vre();if(r==="RSA")return wre(Yre(e));if(r==="ECDSA")return tee(Jre(e));throw new tu}function Ji(r,e){const{Type:t,Data:n}=rc.decode(r),i=n??new Uint8Array;switch(t){case It.RSA:return yre(i,e);case It.Ed25519:return BE(i);case It.secp256k1:return GE(i);case It.ECDSA:return iL(i);default:throw new tu}}function Gre(r){var n,i;if(r.byteLength===S1)return BE(r);if(r.byteLength===Mre)return GE(r);const e=wc(r),t=(n=e[1])==null?void 0:n[0];if(t===JB||t===XB||t===ZB)return sL(e);if(((i=e[0])==null?void 0:i[0])===vre)return LL(e,r);throw new Z("Could not extract public key from raw bytes")}function qL(r){const{Type:e,Data:t}=rc.decode(r.digest),n=t??new Uint8Array;switch(e){case It.Ed25519:return BE(n);case It.secp256k1:return GE(n);case It.ECDSA:return iL(n);default:throw new tu}}function Ss(r){return rc.encode({Type:It[r.type],Data:r.raw})}function Qre(r){const e=Kg.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case It.RSA:return gre(t);case It.Ed25519:return AL(t);case It.secp256k1:return HL(t);case It.ECDSA:return XZ(t);default:throw new tu}}function X6(r){var n;if(r.byteLength===Xs)return AL(r);if(r.byteLength===Ure)return HL(r);const e=wc(r),t=(n=e[2])==null?void 0:n[0];if(t===JB||t===XB||t===ZB)return nL(e);if(e.length>8)return BL(e);throw new Z("Could not extract private key from raw bytes")}function E0(r){return Kg.encode({Type:It[r.type],Data:r.raw})}function Yre(r){return r==null?2048:parseInt(r,10)}function Jre(r){if(r==="P-256"||r==null)return"P-256";if(r==="P-384")return"P-384";if(r==="P-521")return"P-521";throw new Z("Unsupported curve, should be P-256, P-384 or P-521")}async function WL(r){if(r.type==="RSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if(r.type==="ECDSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"ECDSA",namedCurve:r.jwk.crv??"P-256"},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"ECDSA",namedCurve:r.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new Z("Only RSA and ECDSA keys are supported")}function Xre(r,e){for(let t=0;t<r.byteLength;t++){if(r[t]<e[t])return-1;if(r[t]>e[t])return 1}return r.byteLength>e.byteLength?1:r.byteLength<e.byteLength?-1:0}const Zre=async(r,e,t)=>{if(!r)throw new Error("No signature given");if(!e)throw new Error("Given publicKey was undefined");if(!t)throw new Error("Given input data was undefined");t instanceof Uint8Array||(t=typeof t=="string"?se(t):new Uint8Array(t));const n=(s,o,a)=>s.verify(o,a);let i=!1;try{const s=Gre(se(e,"base16"));i=await n(s,t,se(r,"base16"))}catch{}return Promise.resolve(i)},Z6=async(r,e)=>{if(!r)throw new Error("No signing key given");if(!e)throw new Error("Given input data was undefined");return e instanceof Uint8Array||(e=typeof e=="string"?se(e):new Uint8Array(e)),re(await r.sign(e),"base16")},ene=xs({size:1e3}),GL=async(r,e,t)=>{const n=await ene,i=await n.get(r);let s=!1;if(i){const o=(a,c)=>c instanceof Uint8Array?Xre(a,c)===0:a.toString()===c.toString();s=i.publicKey===e&&o(i.data,t)}else{const o=await Zre(r,e,t);s=o,o&&await n.put(r,{publicKey:e,data:t})}return s},tne="./keystore",QL=async({storage:r,path:e}={})=>{r=r||await cl(await xs({size:1e3}),await R6({path:e||tne}));const t=await xs({size:1e3}),n=async()=>{await r.close(),await t.close()},i=async()=>{await r.clear(),await t.clear()},s=async d=>{if(!d)throw new Error("id needed to check a key");let h=!1,p=await t.get(d);if(p)h=!0;else try{p=await r.get("private_"+d),h=p!=null}catch{console.error("Error: ENOENT: no such file or directory")}return h},o=async(d,h)=>{const{privateKey:p}=h;await r.put("private_"+d,p);const b=X6(p);await t.put(d,b)};return{clear:i,close:n,hasKey:s,addKey:o,createKey:async d=>{if(!d)throw new Error("id needed to create a key");const h=await Mm("secp256k1"),p={publicKey:h.publicKey.raw,privateKey:h.raw};return await o(d,p),h},getKey:async d=>{if(!d)throw new Error("id needed to get a key");let h=await t.get(d);if(!h){let p;try{p=await r.get("private_"+d)}catch{}if(!p)return;h=X6(p),await t.put(d,h)}return h},getPublic:(d,h={})=>{const p=["hex","buffer"],b=h.format||"hex";if(p.indexOf(b)===-1)throw new Error("Supported formats are `hex` and `buffer`");const f=d.publicKey.raw;return b==="buffer"?f:re(f,"base16")}}},YL=h0,JL=fm,rne=Jr,XL=async({id:r,publicKey:e,signatures:t,type:n,sign:i,verify:s}={})=>{if(!r)throw new Error("Identity id is required");if(!e)throw new Error("Invalid public key");if(!t)throw new Error("Signatures object is required");if(!t.id)throw new Error("Signature of id is required");if(!t.publicKey)throw new Error("Signature of publicKey+id is required");if(!n)throw new Error("Identity type is required");t=Object.assign({},t);const o={id:r,publicKey:e,signatures:t,type:n,sign:i,verify:s},{hash:a,bytes:c}=await nne(o);return o.hash=a,o.bytes=c,o},nne=async r=>{const{id:e,publicKey:t,signatures:n,type:i}=r,s={id:e,publicKey:t,signatures:n,type:i},{cid:o,bytes:a}=await oh({value:s,codec:YL,hasher:JL});return{hash:o.toString(rne),bytes:Uint8Array.from(a)}},ine=async r=>{const{value:e}=await cm({bytes:r,codec:YL,hasher:JL});return XL({...e})},sne=r=>!!(r.id&&r.hash&&r.bytes&&r.publicKey&&r.signatures&&r.signatures.id&&r.signatures.publicKey&&r.type),one=(r,e)=>r.id===e.id&&r.hash===e.hash&&r.type===e.type&&r.publicKey===e.publicKey&&r.signatures.id===e.signatures.id&&r.signatures.publicKey===e.signatures.publicKey,ZL="publickey",ane=async r=>{const{id:e,publicKey:t,signatures:n}=r;return GL(n.publicKey,e,t+n.id)},QE=({keystore:r})=>async()=>{if(!r)throw new Error("PublicKeyIdentityProvider requires a keystore parameter");return{type:ZL,getId:async({id:n}={})=>{if(!n)throw new Error("id is required");const i=await r.getKey(n)||await r.createKey(n);return re(i.publicKey.raw,"base16")},signIdentity:async(n,{id:i}={})=>{if(!i)throw new Error("id is required");const s=await r.getKey(i);if(!s)throw new Error(`Signing key for '${i}' not found`);return Z6(s,n)}}};QE.verifyIdentity=ane;QE.type=ZL;const YE={},cne=r=>Object.keys(YE).includes(r),S8=r=>{if(!cne(r))throw new Error(`IdentityProvider type '${r}' is not supported`);return YE[r]},lne=r=>{if(!r.type||typeof r.type!="string")throw new Error("Given IdentityProvider doesn't have a field 'type'.");if(!r.verifyIdentity)throw new Error("Given IdentityProvider doesn't have a function 'verifyIdentity'.");YE[r.type]=r};lne(QE);const une=ja("./orbitdb","identities"),dne=async({keystore:r,path:e,storage:t,ipfs:n}={})=>{r=r||await QL({path:e||une}),t||(t=n?await cl(await xs({size:1e3}),await ym({ipfs:n,pin:!0})):await oE());const i=await xs({size:1e3}),s=async d=>{const h=await t.get(d);if(h)return ine(h)},o=async(d={})=>{d.keystore=r;const h=S8("publickey"),b=await(d.provider||h({keystore:r}))();if(!S8(b.type))throw new Error("Identity provider is unknown. Use useIdentityProvider(provider) to register the identity provider");const f=await b.getId(d),g=await r.getKey(f)||await r.createKey(f),v=r.getPublic(g),y=await Z6(g,f),w=await b.signIdentity(v+y,d),E=await XL({id:f,publicKey:v,signatures:{id:y,publicKey:w},type:b.type,sign:c,verify:l});return await t.put(E.hash,E.bytes),E},a=async d=>{if(!sne(d))return!1;const{id:h,publicKey:p,signatures:b}=d;if(!await l(b.id,p,h))return!1;const g=await i.get(b.id);if(g)return one(d,g);const y=await S8(d.type).verifyIdentity(d);return y&&await i.put(b.id,d),y},c=async(d,h)=>{const p=await r.getKey(d.id);if(!p)throw new Error("Private signing key not found from KeyStore");return await Z6(p,h)},l=async(d,h,p)=>await GL(d,h,p);return{createIdentity:o,verifyIdentity:a,getIdentity:s,sign:c,verify:l,keystore:r}},hne=r=>{if(r=r.toString(),!r.startsWith("/orbitdb")&&!r.startsWith("\\orbitdb"))return!1;r=r.replaceAll("/orbitdb/",""),r=r.replaceAll("\\orbitdb\\",""),r=r.replaceAll("/",""),r=r.replaceAll("\\","");let e;try{e=Yi.parse(r,Jr)}catch{return!1}return e!==void 0},Sk=r=>{if(r&&r.protocol==="orbitdb"&&r.hash)return r;const e="orbitdb",t=r.replace("/orbitdb/","").replace("\\orbitdb\\","");return{protocol:e,hash:t,address:r,toString:()=>ja("/",e,t)}},Ak=h0,Ck=fm,fne=Jr,pne=async({ipfs:r,storage:e}={})=>(e=e||await cl(await xs({size:1e5}),await ym({ipfs:r,pin:!0})),{get:async s=>{const o=await e.get(s),{value:a}=await cm({bytes:o,codec:Ak,hasher:Ck});return a&&await e.put(s,o),a},create:async({name:s,type:o,accessController:a,meta:c})=>{if(!s)throw new Error("name is required");if(!o)throw new Error("type is required");if(!a)throw new Error("accessController is required");const l=Object.assign({name:s,type:o,accessController:a},c!==void 0?{meta:c}:{}),{cid:d,bytes:h}=await oh({value:l,codec:Ak,hasher:Ck}),p=d.toString(fne);return await e.put(p,h),{hash:p,manifest:l}},close:async()=>{await e.close()}}),eM=async(r=32)=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="",n=0;for(;n<r;)t+=e.charAt(Math.floor(Math.random()*e.length)),n+=1;return t},tM=h0,rM=fm,gne=Jr,yne=async({storage:r,type:e,params:t})=>{const n={type:e,...t},{cid:i,bytes:s}=await oh({value:n,codec:tM,hasher:rM}),o=i.toString(gne);return await r.put(o,s),o},k2="ipfs",Um=({write:r,storage:e}={})=>async({orbitdb:t,identities:n,address:i})=>{if(e=e||await cl(await xs({size:1e3}),await ym({ipfs:t.ipfs,pin:!0})),r=r||[t.identity.id],i){const o=await e.get(i.replaceAll("/ipfs/","")),{value:a}=await cm({bytes:o,codec:tM,hasher:rM});r=a.write}else i=await yne({storage:e,type:k2,params:{write:r}}),i=ja("/",k2,i);return{type:k2,address:i,write:r,canAppend:async o=>{const a=await n.getIdentity(o.identity);if(!a)return!1;const{id:c}=a;return r.includes(c)||r.includes("*")?await n.verifyIdentity(a):!1}}};Um.type=k2;const nM="orbitdb",iM=({write:r}={})=>async({orbitdb:e,identities:t,address:n,name:i})=>{n=n||i||await eM(64),r=r||[e.identity.id];const s=await e.open(n,{type:"keyvalue",AccessController:Um({write:r})});n=s.address;const o=async f=>{const g=await t.getIdentity(f.identity);if(!g)return!1;const{id:v}=g;return await h("write",v)||await h("admin",v)?await t.verifyIdentity(g):!1},a=async()=>{const f=[];for await(const v of s.iterator())f[v.key]=v.value;const g=v=>{const y=v[0];f[y]=new Set([...f[y]||[],...v[1]])};return Object.entries({...f,admin:new Set([...f.admin||[],...s.access.write])}).forEach(g),f},c=async f=>(await a())[f]||new Set([]),l=async()=>{await s.close()},d=async()=>{await s.drop()},h=async(f,g)=>{const v=new Set(await c(f));return v.has(g)||v.has("*")};return{type:nM,address:n,write:r,canAppend:o,capabilities:a,get:c,grant:async(f,g)=>{const v=new Set([...await s.get(f)||[],g]);await s.put(f,Array.from(v.values()))},revoke:async(f,g)=>{const v=new Set(await s.get(f)||[]);v.delete(g),v.size>0?await s.put(f,Array.from(v.values())):await s.del(f)},close:l,drop:d,events:s.events}};iM.type=nM;const e7={},mne=r=>{if(!e7[r])throw new Error(`AccessController type '${r}' is not supported`);return e7[r]},sM=r=>{if(!r.type)throw new Error("AccessController does not contain required field 'type'.");e7[r.type]=r};sM(Um);sM(iM);const wne="events",bne=Um,vne=async({ipfs:r,id:e,identity:t,identities:n,directory:i}={})=>{if(r==null)throw new Error("IPFS instance is a required argument.");e=e||await eM();const s=r.libp2p.peerId;i=i||"./orbitdb";let o;n?o=n.keystore:(o=await QL({path:ja(i,"./keystore")}),n=await dne({ipfs:r,keystore:o})),t?t.provider&&(t=await n.createIdentity({...t})):t=await n.createIdentity({id:e});const a=await pne({ipfs:r});let c={};const l=async(p,{type:b,meta:f,sync:g,Database:v,AccessController:y,headsStorage:w,entryStorage:m,indexStorage:E,referencesCount:C}={})=>{let k,A,I;if(c[p])return c[p];if(hne(p)){const F=Sk(p);A=await a.get(F.hash);const W=A.accessController.split("/",2).pop();y=mne(W)(),I=await y({orbitdb:{open:l,identity:t,ipfs:r},identities:n,address:A.accessController}),k=A.name,b=b||A.type,f=A.meta}else{b=b||wne,y=y||bne(),I=await y({orbitdb:{open:l,identity:t,ipfs:r},identities:n,name:p});const F=await a.create({name:p,type:b,accessController:I.address,meta:f});if(A=F.manifest,p=Sk(F.hash),k=A.name,f=A.meta,c[p])return c[p]}if(v=v||nX(b)(),!v)throw new Error(`Unsupported database type: '${b}'`);p=p.toString();const D=await v({ipfs:r,identity:t,address:p,name:k,access:I,directory:i,meta:f,syncAutomatically:g,headsStorage:w,entryStorage:m,indexStorage:E,referencesCount:C});return D.events.on("close",d(p)),c[p]=D,D},d=p=>()=>{delete c[p]};return{id:e,open:l,stop:async()=>{for(const p of Object.values(c))await p.close();o&&await o.close(),a&&await a.close(),c={}},ipfs:r,directory:i,keystore:o,identities:n,identity:t,peerId:s}};function ct(r){const e=new globalThis.AbortController;function t(){e.abort();for(const s of r)(s==null?void 0:s.removeEventListener)!=null&&s.removeEventListener("abort",t)}for(const s of r){if((s==null?void 0:s.aborted)===!0){t();break}(s==null?void 0:s.addEventListener)!=null&&s.addEventListener("abort",t)}function n(){for(const s of r)(s==null?void 0:s.removeEventListener)!=null&&s.removeEventListener("abort",t)}const i=e.signal;return i.clear=n,i}let Ene=class extends Error{constructor(t,n){super(t??"The operation was aborted");u(this,"type");u(this,"code");this.type="aborted",this.name="AbortError",this.code=n??"ABORT_ERR"}};async function di(r,e,t,n){const i=new Ene(n==null?void 0:n.errorMessage,n==null?void 0:n.errorCode);return(t==null?void 0:t.aborted)===!0?Promise.reject(i):new Promise((s,o)=>{function a(){t==null||t.removeEventListener("abort",d),r.removeEventListener(e,c),(n==null?void 0:n.errorEvent)!=null&&r.removeEventListener(n.errorEvent,l)}const c=h=>{var p;try{if(((p=n==null?void 0:n.filter)==null?void 0:p.call(n,h))===!1)return}catch(b){a(),o(b);return}a(),s(h)},l=h=>{a(),o(h.detail)},d=()=>{a(),o(i)};t==null||t.addEventListener("abort",d),r.addEventListener(e,c),(n==null?void 0:n.errorEvent)!=null&&r.addEventListener(n.errorEvent,l)})}class xne extends Error{constructor(t="Rate limit exceeded",n){super(t);u(this,"remainingPoints");u(this,"msBeforeNext");u(this,"consumedPoints");u(this,"isFirstInDuration");this.name="RateLimitError",this.remainingPoints=n.remainingPoints,this.msBeforeNext=n.msBeforeNext,this.consumedPoints=n.consumedPoints,this.isFirstInDuration=n.isFirstInDuration}}class oM extends Error{constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}u(oM,"name","QueueFullError");class Sne{constructor(e){u(this,"deferred");u(this,"signal");var t;this.signal=e,this.deferred=De(),this.onAbort=this.onAbort.bind(this),(t=this.signal)==null||t.addEventListener("abort",this.onAbort)}onAbort(){var e;this.deferred.reject(((e=this.signal)==null?void 0:e.reason)??new Sl)}cleanup(){var e;(e=this.signal)==null||e.removeEventListener("abort",this.onAbort)}}function Ane(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}class Cne{constructor(e,t){u(this,"id");u(this,"fn");u(this,"options");u(this,"recipients");u(this,"status");u(this,"timeline");u(this,"controller");this.id=Ane(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,n)=>{var i;return t&&((i=n.signal)==null?void 0:i.aborted)===!0},!0)&&(this.controller.abort(new Sl),this.cleanup())}async join(e={}){var n;const t=new Sne(e.signal);return this.recipients.push(t),(n=e.signal)==null||n.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await Zr(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{var t;e.cleanup(),(t=e.signal)==null||t.removeEventListener("abort",this.onAbort)})}}class _l extends Gt{constructor(t={}){var n;super();u(this,"concurrency");u(this,"maxSize");u(this,"queue");u(this,"pending");u(this,"sort");this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.maxSize=t.maxSize??Number.POSITIVE_INFINITY,this.pending=0,t.metricName!=null&&((n=t.metrics)==null||n.registerMetricGroup(t.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})})),this.sort=t.sort,this.queue=[]}tryToStartAnother(){if(this.size===0)return queueMicrotask(()=>{this.safeDispatchEvent("empty")}),this.running===0&&queueMicrotask(()=>{this.safeDispatchEvent("idle")}),!1;if(this.pending<this.concurrency){let t;for(const n of this.queue)if(n.status==="queued"){t=n;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let n=0;n<this.queue.length;n++)if(this.queue[n]===t){this.queue.splice(n,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(t){this.queue.push(t),this.sort!=null&&this.queue.sort(this.sort)}async add(t,n){var s;if((s=n==null?void 0:n.signal)==null||s.throwIfAborted(),this.size===this.maxSize)throw new oM;const i=new Cne(t,n);return this.enqueue(i),this.safeDispatchEvent("add"),this.tryToStartAnother(),i.join(n).then(o=>(this.safeDispatchEvent("completed",{detail:o}),this.safeDispatchEvent("success",{detail:{job:i,result:o}}),o)).catch(o=>{if(i.status==="queued"){for(let a=0;a<this.queue.length;a++)if(this.queue[a]===i){this.queue.splice(a,1);break}}throw this.safeDispatchEvent("error",{detail:o}),this.safeDispatchEvent("failure",{detail:{job:i,error:o}}),o})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new Sl)}),this.clear()}async onEmpty(t){this.size!==0&&await di(this,"empty",t==null?void 0:t.signal)}async onSizeLessThan(t,n){this.size<t||await di(this,"next",n==null?void 0:n.signal,{filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await di(this,"idle",t==null?void 0:t.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){var l,d,h;(l=t==null?void 0:t.signal)==null||l.throwIfAborted();const n=sh({objectMode:!0}),i=p=>{p!=null?this.abort():this.clear(),n.end(p)},s=p=>{p.detail!=null&&n.push(p.detail)},o=p=>{i(p.detail)},a=()=>{i()},c=()=>{i(new Sl("Queue aborted"))};this.addEventListener("completed",s),this.addEventListener("error",o),this.addEventListener("idle",a),(d=t==null?void 0:t.signal)==null||d.addEventListener("abort",c);try{yield*n}finally{this.removeEventListener("completed",s),this.removeEventListener("error",o),this.removeEventListener("idle",a),(h=t==null?void 0:t.signal)==null||h.removeEventListener("abort",c),i()}}}class nc extends _l{has(e){return this.find(e)!=null}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}const kne=8,JE=1024*1024*4;let Ine=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}},aM=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}},_ne=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}},kk=class extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}};function cM(r){return r[Symbol.asyncIterator]!=null}function lM(r,e){if(r.byteLength>e)throw new aM("Message length too long")}const Fm=r=>{const e=mt(r),t=zn(e);return Hr(r,t),Fm.bytes=e,t};Fm.bytes=0;function _d(r,e){e=e??{};const t=e.lengthEncoder??Fm,n=(e==null?void 0:e.maxDataLength)??JE;function*i(s){lM(s,n);const o=t(s.byteLength);o instanceof Uint8Array?yield o:yield*o,s instanceof Uint8Array?yield s:yield*s}return cM(r)?async function*(){for await(const s of r)yield*i(s)}():function*(){for(const s of r)yield*i(s)}()}_d.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??Fm,n=(e==null?void 0:e.maxDataLength)??JE;return lM(r,n),new Be(t(r.byteLength),r)};var jc;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(jc||(jc={}));const XE=r=>{const e=Ns(r);return XE.bytes=mt(e),e};XE.bytes=0;function Td(r,e){const t=new Be;let n=jc.LENGTH,i=-1;const s=(e==null?void 0:e.lengthDecoder)??XE,o=(e==null?void 0:e.maxLengthLength)??kne,a=(e==null?void 0:e.maxDataLength)??JE;function*c(){for(;t.byteLength>0;){if(n===jc.LENGTH)try{if(i=s(t),i<0)throw new Ine("Invalid message length");if(i>a)throw new aM("Message length too long");const l=s.bytes;t.consume(l),(e==null?void 0:e.onLength)!=null&&e.onLength(i),n=jc.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>o)throw new _ne("Message length length too long");break}throw l}if(n===jc.DATA){if(t.byteLength<i)break;const l=t.sublist(0,i);t.consume(i),(e==null?void 0:e.onData)!=null&&e.onData(l),yield l,n=jc.LENGTH}}}return cM(r)?async function*(){for await(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new kk("Unexpected end of input")}():function*(){for(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new kk("Unexpected end of input")}()}Td.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:s,value:o}=await r.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return Td(n,{...e??{},onLength:s=>{t=s}})};function ZE(r){const[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:i=>{n.push(i)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}function Tne(r){return r[Symbol.asyncIterator]!=null}function fh(r,e){let t=0;if(Tne(r))return async function*(){for await(const c of r)yield e(c,t++)}();const n=ZE(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof o.then=="function")return async function*(){yield await o;for await(const c of n)yield e(c,t++)}();const a=e;return function*(){yield o;for(const c of n)yield a(c,t++)}()}function $ne(r){return r[Symbol.asyncIterator]!=null}function Hg(r,e){return $ne(r)?async function*(){let t=0;if(!(e<1)){for await(const n of r)if(yield n,t++,t===e)return}}():function*(){let t=0;if(!(e<1)){for(const n of r)if(yield n,t++,t===e)return}}()}class ke extends Event{constructor(t,n){super(t);u(this,"type");u(this,"detail");this.type=t,this.detail=n}}const Pp="/ipfs/bitswap/1.2.0",Pne=1024,Dne=1024,Nne=1024,One=5e3,Rne=10,Bne=50,Lne=!1,Mne=3,uM=1024*1024*4,Une=uM;var Zt;(function(r){r.WantBlock="WantBlock",r.WantHave="WantHave"})(Zt||(Zt={}));var t7;(function(r){r[r.WantBlock=0]="WantBlock",r[r.WantHave=1]="WantHave"})(t7||(t7={}));(function(r){r.codec=()=>En(t7)})(Zt||(Zt={}));var k1;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.priority!=null&&t.priority!==0&&(n.uint32(16),n.int32(t.priority)),t.cancel!=null&&(n.uint32(24),n.bool(t.cancel)),t.wantType!=null&&(n.uint32(32),Zt.codec().encode(t.wantType,n)),t.sendDontHave!=null&&(n.uint32(40),n.bool(t.sendDontHave)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={cid:We(0),priority:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.cid=t.bytes();break}case 2:{s.priority=t.int32();break}case 3:{s.cancel=t.bool();break}case 4:{s.wantType=Zt.codec().decode(t);break}case 5:{s.sendDontHave=t.bool();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(k1||(k1={}));var qg;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.entries!=null)for(const s of t.entries)n.uint32(10),k1.codec().encode(s,n);t.full!=null&&(n.uint32(16),n.bool(t.full)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={entries:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{if(((a=i.limits)==null?void 0:a.entries)!=null&&s.entries.length===i.limits.entries)throw new gr('Decode error - map field "entries" had too many elements');s.entries.push(k1.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.entries$}));break}case 2:{s.full=t.bool();break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(qg||(qg={}));var I1;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.prefix!=null&&t.prefix.byteLength>0&&(n.uint32(10),n.bytes(t.prefix)),t.data!=null&&t.data.byteLength>0&&(n.uint32(18),n.bytes(t.data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={prefix:We(0),data:We(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.prefix=t.bytes();break}case 2:{s.data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(I1||(I1={}));var As;(function(r){r.HaveBlock="HaveBlock",r.DoNotHaveBlock="DoNotHaveBlock"})(As||(As={}));var Wg;(function(r){r[r.HaveBlock=0]="HaveBlock",r[r.DoNotHaveBlock=1]="DoNotHaveBlock"})(Wg||(Wg={}));(function(r){r.codec=()=>En(Wg)})(As||(As={}));var _1;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.type!=null&&Wg[t.type]!==0&&(n.uint32(16),As.codec().encode(t.type,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={cid:We(0),type:As.HaveBlock},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.cid=t.bytes();break}case 2:{s.type=As.codec().decode(t);break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(_1||(_1={}));var T1;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.wantlist!=null&&(n.uint32(10),qg.codec().encode(t.wantlist,n)),t.blocks!=null)for(const s of t.blocks)n.uint32(26),I1.codec().encode(s,n);if(t.blockPresences!=null)for(const s of t.blockPresences)n.uint32(34),_1.codec().encode(s,n);t.pendingBytes!=null&&t.pendingBytes!==0&&(n.uint32(40),n.int32(t.pendingBytes)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,d,h;const s={blocks:[],blockPresences:[],pendingBytes:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const p=t.uint32();switch(p>>>3){case 1:{s.wantlist=qg.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.wantlist});break}case 3:{if(((c=i.limits)==null?void 0:c.blocks)!=null&&s.blocks.length===i.limits.blocks)throw new gr('Decode error - map field "blocks" had too many elements');s.blocks.push(I1.codec().decode(t,t.uint32(),{limits:(l=i.limits)==null?void 0:l.blocks$}));break}case 4:{if(((d=i.limits)==null?void 0:d.blockPresences)!=null&&s.blockPresences.length===i.limits.blockPresences)throw new gr('Decode error - map field "blockPresences" had too many elements');s.blockPresences.push(_1.codec().decode(t,t.uint32(),{limits:(h=i.limits)==null?void 0:h.blockPresences$}));break}case 5:{s.pendingBytes=t.int32();break}default:{t.skipType(p&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(T1||(T1={}));function Fne(r,e){for(const[t,n]of e.wantlist.entries()){const i=r.wantlist.get(t);i!=null&&(i.priority>n.priority&&(n.priority=i.priority),n.cancel=n.cancel??i.cancel,n.wantType=n.wantType??i.wantType,n.sendDontHave=n.sendDontHave??i.sendDontHave),r.wantlist.set(t,n)}for(const[t,n]of e.blockPresences.entries())r.blockPresences.set(t,n);for(const[t,n]of e.blocks.entries())r.blocks.set(t,n);return e.full&&!r.full&&(r.full=!0),r}class dM extends Error{constructor(e="Block too large"){super(e),this.name="BlockTooLargeError"}}u(dM,"name","BlockTooLargeError");const zne=4193648,Vne=zne+16;function*Kne(r,e){const t=[...r.wantlist.values()],n=[...r.blockPresences.values()],i=[...r.blocks.values()];let s=0,o=0,a=0,c=!1;for(;;){const l={wantlist:{full:r.full??!1,entries:[]},blockPresences:[],blocks:[],pendingBytes:0};let d=T1.encode(l).byteLength,{added:h,hasMore:p,newSize:b}=A8(i,l.blocks,a,e,d,jne);a+=h,d=b;const f=p;({added:h,hasMore:p,newSize:b}=A8(n,l.blockPresences,o,e,d,Hne)),o+=h,d=b;const g=p;if({added:h,hasMore:p,newSize:b}=A8(t,l.wantlist.entries,s,e,d,qne),s+=h,d=b,c=!f&&!g&&!p,c||(l.wantlist.full=!1),yield T1.encode(l),c)break}}function A8(r,e,t,n,i,s){let o=0,a=!1;for(let c=t;c<r.length;c++){const l=r[c],d=s(l);if(d>Vne)throw new dM("Cannot send block as after encoding it is over the max message size");const h=i+d;if(h>n){a=!0;break}e.push(l),o++,i=h}return{hasMore:a,added:o,newSize:i}}function jne(r){return ex(3,I1.encode(r))}function Hne(r){return ex(4,_1.encode(r))}function qne(r){return ex(1,k1.encode(r))}function ex(r,e){const t=mt(r),n=mt(e.byteLength);return t+n+e.byteLength}let Wne=class extends Gt{constructor(t,n={}){var i,s;super();u(this,"log");u(this,"libp2p");u(this,"routing");u(this,"protocols");u(this,"running");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"messageReceiveTimeout");u(this,"registrarIds");u(this,"metrics");u(this,"sendQueue");u(this,"runOnLimitedConnections");u(this,"maxOutgoingMessageSize");u(this,"maxIncomingMessageSize");this.log=t.logger.forComponent("helia:bitswap:network"),this.libp2p=t.libp2p,this.routing=t.routing,this.protocols=n.protocols??[Pp],this.registrarIds=[],this.running=!1,this._onStream=this._onStream.bind(this),this.maxInboundStreams=n.maxInboundStreams??Dne,this.maxOutboundStreams=n.maxOutboundStreams??Nne,this.messageReceiveTimeout=n.messageReceiveTimeout??One,this.runOnLimitedConnections=n.runOnLimitedConnections??Lne,this.maxIncomingMessageSize=n.maxIncomingMessageSize??uM,this.maxOutgoingMessageSize=n.maxOutgoingMessageSize??n.maxIncomingMessageSize??Une,this.metrics={blocksSent:(i=t.metrics)==null?void 0:i.registerCounter("helia_bitswap_sent_blocks_total"),dataSent:(s=t.metrics)==null?void 0:s.registerCounter("helia_bitswap_sent_data_bytes_total")},this.sendQueue=new nc({concurrency:n.messageSendConcurrency??Bne,metrics:t.metrics,metricName:"helia_bitswap_message_send_queue"}),this.sendQueue.addEventListener("error",o=>{this.log.error("error sending wantlist to peer",o.detail)})}async start(){if(this.running)return;this.running=!0,await this.libp2p.handle(this.protocols,this._onStream,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnections});const t={onConnect:n=>{this.safeDispatchEvent("peer:connected",{detail:n})},onDisconnect:n=>{this.safeDispatchEvent("peer:disconnected",{detail:n})}};this.registrarIds=[];for(const n of this.protocols)this.registrarIds.push(await this.libp2p.register(n,t));this.libp2p.getConnections().forEach(n=>{this.safeDispatchEvent("peer:connected",{detail:n.remotePeer})})}async stop(){if(this.running=!1,await this.libp2p.unhandle(this.protocols),this.registrarIds!=null){for(const t of this.registrarIds)this.libp2p.unregister(t);this.registrarIds=[]}}_onStream(t){if(!this.running)return;const{stream:n,connection:i}=t;Promise.resolve().then(async()=>{this.log("incoming new bitswap %s stream from %p",n.protocol,i.remotePeer);const s=()=>{n.status==="open"?n.abort(new m0(`Incoming Bitswap stream timed out after ${this.messageReceiveTimeout}ms`)):this.log("stream aborted with status %s",n.status)};let o=AbortSignal.timeout(this.messageReceiveTimeout);o.addEventListener("abort",s),await n.closeWrite(),await Qi(n,a=>Td(a,{maxDataLength:this.maxIncomingMessageSize}),async a=>{for await(const c of a)try{const l=T1.decode(c);this.log("incoming new bitswap %s message from %p on stream",n.protocol,i.remotePeer,n.id),this.safeDispatchEvent("bitswap:message",{detail:{peer:i.remotePeer,message:l}}),o.removeEventListener("abort",s),o=AbortSignal.timeout(this.messageReceiveTimeout),o.addEventListener("abort",s)}catch(l){this.log.error("error reading incoming bitswap message from %p on stream",i.remotePeer,n.id,l),n.abort(l);break}})}).catch(s=>{this.log.error("error handling incoming stream from %p",i.remotePeer,s),n.abort(s)})}async*findProviders(t,n){var i;(i=n==null?void 0:n.onProgress)==null||i.call(n,new ke("bitswap:network:find-providers",t));for await(const s of this.routing.findProviders(t,n))await this.libp2p.isDialable(s.multiaddrs,{runOnLimitedConnection:this.runOnLimitedConnections})&&(yield s)}async findAndConnect(t,n){await vo(fh(Hg(this.findProviders(t,n),(n==null?void 0:n.maxProviders)??Mne),async i=>this.connectTo(i.id,n))).catch(i=>{this.log.error(i)})}async sendMessage(t,n,i){if(!this.running)throw new Error("network isn't running");const s=this.sendQueue.queue.find(o=>t.equals(o.options.peerId)&&o.status==="queued");if(s!=null){s.options.message=Fne(s.options.message,n),await s.join({signal:i==null?void 0:i.signal});return}await this.sendQueue.add(async o=>{var l,d;const a=o==null?void 0:o.message;if(a==null)throw new Z("No message to send");this.log("sendMessage to %p",t),(l=o==null?void 0:o.onProgress)==null||l.call(o,new ke("bitswap:network:send-wantlist",t));const c=await this.libp2p.dialProtocol(t,Pp,o);await c.closeRead();try{await Qi(Kne(a,this.maxOutgoingMessageSize),h=>_d(h),c),await c.close(o)}catch(h){(d=o==null?void 0:o.onProgress)==null||d.call(o,new ke("bitswap:network:send-wantlist:error",{peer:t,error:h})),this.log.error("error sending message to %p",t,h),c.abort(h)}this._updateSentStats(a.blocks)},{peerId:t,signal:i==null?void 0:i.signal,message:n})}async connectTo(t,n){var s;if(!this.running)throw new Al("Network isn't running");(s=n==null?void 0:n.onProgress)==null||s.call(n,new ke("bitswap:network:dial",t));const[i]=await Promise.all([this.libp2p.dial(t,n),di(this.libp2p,"peer:identify",n==null?void 0:n.signal,{filter:o=>{if(!o.detail.peerId.equals(t))return!1;if(o.detail.protocols.includes(Pp))return!0;throw new y0(`${t} did not support ${Pp}`)}})]);return i}_updateSentStats(t){var i,s;let n=0;for(const o of t.values())n+=o.data.byteLength;(i=this.metrics.dataSent)==null||i.increment(n),(s=this.metrics.blocksSent)==null||s.increment(t.size)}};function Gne(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function zm(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Qne(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var Yne=Qne,Jne=Yne;let Xne=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Zne=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return hM(this,e)}},eie=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return hM(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function hM(r,e){return new eie({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let tie=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Xne(e,t,n),this.decoder=new Zne(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function fM({name:r,prefix:e,encode:t,decode:n}){return new tie(r,e,t,n)}function Vm({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Jne(t,r);return fM({prefix:e,name:r,encode:n,decode:s=>zm(i(s))})}function rie(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function nie(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Po({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return fM({prefix:e,name:r,encode(i){return nie(i,n,t)},decode(i){return rie(i,n,t,r)}})}const gs=Vm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Vm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const I2=Po({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Po({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Po({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Po({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Po({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Po({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Po({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Po({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Po({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const C8=Vm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Vm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var iie=pM,Ik=128,sie=-128,oie=Math.pow(2,31);function pM(r,e,t){e=e||[],t=t||0;for(var n=t;r>=oie;)e[t++]=r&255|Ik,r/=128;for(;r&sie;)e[t++]=r&255|Ik,r>>>=7;return e[t]=r|0,pM.bytes=t-n+1,e}var aie=r7,cie=128,_k=127;function r7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw r7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&_k)<<i:(o&_k)*Math.pow(2,i),i+=7}while(o>=cie);return r7.bytes=s-n,t}var lie=Math.pow(2,7),uie=Math.pow(2,14),die=Math.pow(2,21),hie=Math.pow(2,28),fie=Math.pow(2,35),pie=Math.pow(2,42),gie=Math.pow(2,49),yie=Math.pow(2,56),mie=Math.pow(2,63),wie=function(r){return r<lie?1:r<uie?2:r<die?3:r<hie?4:r<fie?5:r<pie?6:r<gie?7:r<yie?8:r<mie?9:10},bie={encode:iie,decode:aie,encodingLength:wie},Gg=bie;function n7(r,e=0){return[Gg.decode(r,e),Gg.decode.bytes]}function Qg(r,e,t=0){return Gg.encode(r,e,t),e}function Yg(r){return Gg.encodingLength(r)}function Jg(r,e){const t=e.byteLength,n=Yg(r),i=n+Yg(t),s=new Uint8Array(i+t);return Qg(r,s,0),Qg(t,s,n),s.set(e,i),new tx(r,t,e,s)}function gM(r){const e=zm(r),[t,n]=n7(e),[i,s]=n7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new tx(t,i,o,e)}function vie(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Gne(r.bytes,t.bytes)}}let tx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function Tk(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return xie(t,i7(r),e??gs.encoder);default:return Sie(t,i7(r),e??I2.encoder)}}const $k=new WeakMap;function i7(r){const e=$k.get(r);if(e==null){const t=new Map;return $k.set(r,t),t}return e}var JP;let rx=class _r{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,JP,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Zh)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Aie)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return _r.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Jg(e,t);return _r.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return _r.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&vie(e.multihash,n.multihash)}toString(e){return Tk(this,e)}toJSON(){return{"/":Tk(this)}}link(){return this}[(JP=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof _r)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new _r(n,i,s,o??Pk(n,i,s.bytes))}else if(t[Cie]===!0){const{version:n,multihash:i,code:s}=t,o=gM(i);return _r.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Zh)throw new Error(`Version 0 CID must use dag-pb (code: ${Zh}) block encoding`);return new _r(e,t,n,n.bytes)}case 1:{const i=Pk(e,t,n.bytes);return new _r(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return _r.create(0,Zh,e)}static createV1(e,t){return _r.create(1,e,t)}static decode(e){const[t,n]=_r.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=_r.inspectBytes(e),n=t.size-t.multihashSize,i=zm(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new tx(t.multihashCode,t.digestSize,s,i);return[t.version===0?_r.createV0(o):_r.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=n7(e.subarray(t));return t+=p,h};let i=n(),s=Zh;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Eie(e,t),s=_r.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return i7(s).set(n,e),s}};function Eie(r,e){switch(r[0]){case"Q":{const t=e??gs;return[gs.prefix,t.decode(`${gs.prefix}${r}`)]}case gs.prefix:{const t=e??gs;return[gs.prefix,t.decode(r)]}case I2.prefix:{const t=e??I2;return[I2.prefix,t.decode(r)]}case C8.prefix:{const t=e??C8;return[C8.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function xie(r,e,t){const{prefix:n}=t;if(n!==gs.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Sie(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Zh=112,Aie=18;function Pk(r,e,t){const n=Yg(r),i=n+Yg(e),s=new Uint8Array(i+t.byteLength);return Qg(r,s,0),Qg(e,s,n),s.set(t,i),s}const Cie=Symbol.for("@ipld/js-cid/CID"),yM=0,kie="identity",mM=zm;function Iie(r){return Jg(yM,mM(r))}const wM={code:yM,name:kie,encode:mM,digest:Iie};function _ie({name:r,code:e,encode:t}){return new Tie(r,e,t)}let Tie=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Jg(this.code,t):t.then(n=>Jg(this.code,n))}else throw Error("Unknown type, must be binary type")}};function $ie(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const Pie=_ie({name:"sha2-256",code:18,encode:$ie("SHA-256")}),bM=Symbol.for("nodejs.util.inspect.custom"),Die=114;var XP;class nx{constructor(e){u(this,"type");u(this,"multihash");u(this,"publicKey");u(this,"string");u(this,XP,!0);this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=gs.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return rx.createV1(Die,this.multihash)}toJSON(){return this.toString()}equals(e){var t;if(e==null)return!1;if(e instanceof Uint8Array)return Fe(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(((t=e==null?void 0:e.toMultihash())==null?void 0:t.bytes)!=null)return Fe(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[(XP=vE,bM)](){return`PeerId(${this.toString()})`}}class vM extends nx{constructor(t){super({...t,type:"RSA"});u(this,"type","RSA");u(this,"publicKey");this.publicKey=t.publicKey}}class EM extends nx{constructor(t){super({...t,type:"Ed25519"});u(this,"type","Ed25519");u(this,"publicKey");this.publicKey=t.publicKey}}class xM extends nx{constructor(t){super({...t,type:"secp256k1"});u(this,"type","secp256k1");u(this,"publicKey");this.publicKey=t.publicKey}}const Nie=2336;var ZP,eD;class SM{constructor(e){u(this,"type","url");u(this,"multihash");u(this,"publicKey");u(this,"url");u(this,ZP,!0);this.url=e.toString(),this.multihash=wM.digest(se(this.url))}[(eD=bM,ZP=vE,eD)](){return`PeerId(${this.url})`}toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return rx.createV1(Nie,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=re(e)),e.toString()===this.toString())}}const Oie=114,Dk=2336;function xn(r,e){let t;if(r.charAt(0)==="1"||r.charAt(0)==="Q")t=gM(gs.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return ph(rx.parse(r));throw new Z('Please pass a multibase decoder for strings that do not start with "1" or "Q"')}return Zi(t)}function $d(r){if(r.type==="Ed25519")return new EM({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new xM({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new vM({multihash:r.toCID().multihash,publicKey:r});throw new tu}function Rie(r){return $d(r.publicKey)}function Zi(r){if(Lie(r))return new vM({multihash:r});if(Bie(r))try{const e=qL(r);if(e.type==="Ed25519")return new EM({multihash:r,publicKey:e});if(e.type==="secp256k1")return new xM({multihash:r,publicKey:e})}catch{const t=re(r.digest);return new SM(new URL(t))}throw new Im("Supplied PeerID Multihash is invalid")}function ph(r){if((r==null?void 0:r.multihash)==null||r.version==null||r.version===1&&r.code!==Oie&&r.code!==Dk)throw new MB("Supplied PeerID CID is invalid");if(r.code===Dk){const e=re(r.multihash.digest);return new SM(new URL(e))}return Zi(r.multihash)}function Bie(r){return r.code===wM.code}function Lie(r){return r.code===Pie.code}function AM(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Mie(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var Uie=Mie,Fie=Uie;let zie=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Vie=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return CM(this,e)}},Kie=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return CM(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function CM(r,e){return new Kie({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let jie=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new zie(e,t,n),this.decoder=new Vie(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Hie({name:r,prefix:e,encode:t,decode:n}){return new jie(r,e,t,n)}function kM({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Fie(t,r);return Hie({prefix:e,name:r,encode:n,decode:s=>AM(i(s))})}const qie=kM({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});kM({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Wie=IM,Nk=128,Gie=-128,Qie=Math.pow(2,31);function IM(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Qie;)e[t++]=r&255|Nk,r/=128;for(;r&Gie;)e[t++]=r&255|Nk,r>>>=7;return e[t]=r|0,IM.bytes=t-n+1,e}var Yie=s7,Jie=128,Ok=127;function s7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw s7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&Ok)<<i:(o&Ok)*Math.pow(2,i),i+=7}while(o>=Jie);return s7.bytes=s-n,t}var Xie=Math.pow(2,7),Zie=Math.pow(2,14),ese=Math.pow(2,21),tse=Math.pow(2,28),rse=Math.pow(2,35),nse=Math.pow(2,42),ise=Math.pow(2,49),sse=Math.pow(2,56),ose=Math.pow(2,63),ase=function(r){return r<Xie?1:r<Zie?2:r<ese?3:r<tse?4:r<rse?5:r<nse?6:r<ise?7:r<sse?8:r<ose?9:10},cse={encode:Wie,decode:Yie,encodingLength:ase},Rk=cse;function Bk(r,e=0){return[Rk.decode(r,e),Rk.decode.bytes]}function lse(r){const e=AM(r),[t,n]=Bk(e),[i,s]=Bk(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new use(t,i,o,e)}let use=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function Uf(r,e){const t={[Symbol.iterator]:()=>t,next:()=>{const n=r.next(),i=n.value;return n.done===!0||i==null?{done:!0,value:void 0}:{done:!1,value:e(i)}}};return t}function k8(r){const e=lse(qie.decode(`z${r}`));return Zi(e)}class bc{constructor(e){u(this,"map");if(this.map=new Map,e!=null)for(const[t,n]of e.entries())this.map.set(t.toString(),{key:t,value:n})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return Uf(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,n)=>{e(t.value,t.key,this)})}get(e){var t;return(t=this.map.get(e.toString()))==null?void 0:t.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return Uf(this.map.values(),e=>e.key)}values(){return Uf(this.map.values(),e=>e.value)}get size(){return this.map.size}}class Hi{constructor(e){u(this,"set");if(this.set=new Set,e!=null)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return Uf(this.set.entries(),e=>{const t=k8(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{const n=k8(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return Uf(this.set.values(),e=>k8(e))}intersection(e){const t=new Hi;for(const n of e)this.has(n)&&t.add(n);return t}difference(e){const t=new Hi;for(const n of this)e.has(n)||t.add(n);return t}union(e){const t=new Hi;for(const n of e)t.add(n);for(const n of this)t.add(n);return t}}function dse(){return new Hi}class _M extends $L{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Lm(e);const n=C1(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),ks(s)}update(e){return jg(this),this.iHash.update(e),this}digestInto(e){jg(this),v0(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Km=(r,e,t)=>new _M(r,e).update(t).digest();Km.create=(r,e)=>new _M(r,e);function TM(r,e,t,n){Lm(r);const i=Hte({dkLen:32,asyncTick:10},n),{c:s,dkLen:o,asyncTick:a}=i;if(Xu(s),Xu(o),Xu(a),s<1)throw new Error("iterations (c) should be >= 1");const c=fk(e),l=fk(t),d=new Uint8Array(o),h=Km.create(r,c),p=h._cloneInto().update(l);return{c:s,dkLen:o,asyncTick:a,DK:d,PRF:h,PRFSalt:p}}function $M(r,e,t,n,i){return r.destroy(),e.destroy(),n&&n.destroy(),ks(i),t}function hse(r,e,t,n){const{c:i,dkLen:s,DK:o,PRF:a,PRFSalt:c}=TM(r,e,t,n);let l;const d=new Uint8Array(4),h=Mf(d),p=new Uint8Array(a.outputLen);for(let b=1,f=0;f<s;b++,f+=a.outputLen){const g=o.subarray(f,f+a.outputLen);h.setInt32(0,b,!1),(l=c._cloneInto(l)).update(d).digestInto(p),g.set(p.subarray(0,g.length));for(let v=1;v<i;v++){a._cloneInto(l).update(p).digestInto(p);for(let y=0;y<g.length;y++)g[y]^=p[y]}}return $M(a,c,o,l,p)}async function PM(r,e,t,n){const{c:i,dkLen:s,asyncTick:o,DK:a,PRF:c,PRFSalt:l}=TM(r,e,t,n);let d;const h=new Uint8Array(4),p=Mf(h),b=new Uint8Array(c.outputLen);for(let f=1,g=0;g<s;f++,g+=c.outputLen){const v=a.subarray(g,g+c.outputLen);p.setInt32(0,f,!1),(d=l._cloneInto(d)).update(h).digestInto(b),v.set(b.subarray(0,v.length)),await jte(i-1,o,()=>{c._cloneInto(d).update(b).digestInto(b);for(let y=0;y<v.length;y++)v[y]^=b[y]})}return $M(c,l,a,d,b)}const ef=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),sa=new Uint32Array(80);class fse extends jE{constructor(){super(64,20,8,!1),this.A=ef[0]|0,this.B=ef[1]|0,this.C=ef[2]|0,this.D=ef[3]|0,this.E=ef[4]|0}get(){const{A:e,B:t,C:n,D:i,E:s}=this;return[e,t,n,i,s]}set(e,t,n,i,s){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0}process(e,t){for(let c=0;c<16;c++,t+=4)sa[c]=e.getUint32(t,!1);for(let c=16;c<80;c++)sa[c]=x8(sa[c-3]^sa[c-8]^sa[c-14]^sa[c-16],1);let{A:n,B:i,C:s,D:o,E:a}=this;for(let c=0;c<80;c++){let l,d;c<20?(l=PL(i,s,o),d=1518500249):c<40?(l=i^s^o,d=1859775393):c<60?(l=DL(i,s,o),d=2400959708):(l=i^s^o,d=3395469782);const h=x8(n,5)+l+a+d+sa[c]|0;a=o,o=s,s=x8(i,30),i=n,n=h}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,this.set(n,i,s,o,a)}roundClean(){ks(sa)}destroy(){this.set(0,0,0,0,0),ks(this.buffer)}}const pse=KE(()=>new fse),gse=pse,ix=lre,yse=Hn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Hn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});Hn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});Hn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const Lk={sha1:gse,"sha2-256":fl,"sha2-512":ix};function Mk(r,e,t,n,i){if(i!=="sha1"&&i!=="sha2-256"&&i!=="sha2-512"){const a=Object.keys(Lk).join(" / ");throw new Z(`Hash '${i}' is unknown or not supported. Must be ${a}`)}const s=Lk[i],o=hse(s,r,e,{c:t,dkLen:n});return yse.encode(o).substring(1)}const sx={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},DM={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},NM=new globalThis.TextEncoder;function mse(r,e){const t=sx[e];let n=DM[e];for(let i=0;i<r.length;i++)n^=BigInt(r[i]),n=BigInt.asUintN(e,n*t);return n}function wse(r,e,t){if(t.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");const n=sx[e];let i=DM[e],s=r;for(;s.length>0;){const o=NM.encodeInto(s,t);s=s.slice(o.read);for(let a=0;a<o.written;a++)i^=BigInt(t[a]),i=BigInt.asUintN(e,i*n)}return i}function bse(r,{size:e=32,utf8Buffer:t}={}){if(!sx[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof r=="string"){if(t)return wse(r,e,t);r=NM.encode(r)}return mse(r,e)}const ox={hash:r=>Number(bse(r,{size:32})),hashV:(r,e)=>vse(ox.hash(r,e))};function vse(r){let e=r.toString(16);return e.length%2===1&&(e=`0${e}`),se(e,"base16")}const OM=64;class Jc{constructor(e,t,n,i=2){u(this,"fp");u(this,"h");u(this,"seed");if(i>OM)throw new TypeError("Invalid Fingerprint Size");const s=t.hashV(e,n),o=We(i);for(let a=0;a<o.length;a++)o[a]=s[a];o.length===0&&(o[0]=7),this.fp=o,this.h=t,this.seed=n}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return(e==null?void 0:e.fp)instanceof Uint8Array?Fe(this.fp,e.fp):!1}}function Xg(r,e){return Math.floor(Math.random()*(e-r))+r}class Dp{constructor(e){u(this,"contents");this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof Jc))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof Jc))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof Jc))throw new TypeError("Invalid Fingerprint");const t=Xg(0,this.contents.length-1),n=this.contents[t];return this.contents[t]=e,n}remove(e){if(!(e instanceof Jc))throw new TypeError("Invalid Fingerprint");const t=this.contents.findIndex(n=>e.equals(n));return t>-1?(this.contents[t]=null,!0):!1}}const Ese=500;class Uk{constructor(e){u(this,"bucketSize");u(this,"filterSize");u(this,"fingerprintSize");u(this,"buckets");u(this,"count");u(this,"hash");u(this,"seed");this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??ox,this.seed=e.seed??Xg(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=se(e));const t=new Jc(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=(n^t.hash())%this.filterSize;if(this.buckets[n]==null&&(this.buckets[n]=new Dp(this.bucketSize)),this.buckets[i]==null&&(this.buckets[i]=new Dp(this.bucketSize)),this.buckets[n].add(t)||this.buckets[i].add(t))return this.count++,!0;const s=[n,i];let o=s[Xg(0,s.length-1)];this.buckets[o]==null&&(this.buckets[o]=new Dp(this.bucketSize));for(let a=0;a<Ese;a++){const c=this.buckets[o].swap(t);if(c!=null&&(o=(o^c.hash())%this.filterSize,this.buckets[o]==null&&(this.buckets[o]=new Dp(this.bucketSize)),this.buckets[o].add(c)))return this.count++,!0}return!1}has(e){var o,a;typeof e=="string"&&(e=se(e));const t=new Jc(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=((o=this.buckets[n])==null?void 0:o.has(t))??!1;if(i)return i;const s=(n^t.hash())%this.filterSize;return((a=this.buckets[s])==null?void 0:a.has(t))??!1}remove(e){var a,c;typeof e=="string"&&(e=se(e));const t=new Jc(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=((a=this.buckets[n])==null?void 0:a.remove(t))??!1;if(i)return this.count--,i;const s=(n^t.hash())%this.filterSize,o=((c=this.buckets[s])==null?void 0:c.remove(t))??!1;return o&&this.count--,o}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}}const xse={1:.5,2:.84,4:.95,8:.98};function Sse(r=.001){return r>.002?2:r>1e-5?4:8}function Ase(r,e=.001){const t=Sse(e),n=xse[t],i=Math.round(r/n),s=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),OM);return{filterSize:i,bucketSize:t,fingerprintSize:s}}class Cse{constructor(e){u(this,"filterSize");u(this,"bucketSize");u(this,"fingerprintSize");u(this,"scale");u(this,"filterSeries");u(this,"hash");u(this,"seed");this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??ox,this.seed=e.seed??Xg(0,Math.pow(2,10)),this.filterSeries=[new Uk({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=se(e)),this.has(e))return!0;let t=this.filterSeries.find(n=>n.reliable);if(t==null){const n=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new Uk({filterSize:n,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=se(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=se(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}function Tl(r,e=.001,t){return new Cse({...Ase(r,e)})}class kse{constructor(e,t){u(this,"filter");this.filter=Tl(e,t)}has(e){return this.filter.has(e.toMultihash().bytes)}add(e){this.filter.add(e.toMultihash().bytes)}remove(e){var t,n;(n=(t=this.filter).remove)==null||n.call(t,e.toMultihash().bytes)}}function Ise(r,e=.001){return new kse(r,e)}class _se extends bc{constructor(t){super();u(this,"metric");const{name:n,metrics:i}=t;this.metric=i.registerMetric(n),this.updateComponentMetric()}set(t,n){return super.set(t,n),this.updateComponentMetric(),this}delete(t){const n=super.delete(t);return this.updateComponentMetric(),n}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function RM(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new _se({name:e,metrics:t}):n=new bc,n}function Tse(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function ax(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function $se(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var Pse=$se,Dse=Pse;let Nse=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Ose=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return BM(this,e)}},Rse=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return BM(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function BM(r,e){return new Rse({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Bse=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Nse(e,t,n),this.decoder=new Ose(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function LM({name:r,prefix:e,encode:t,decode:n}){return new Bse(r,e,t,n)}function jm({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Dse(t,r);return LM({prefix:e,name:r,encode:n,decode:s=>ax(i(s))})}function Lse(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Mse(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function qn({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return LM({prefix:e,name:r,encode(i){return Mse(i,n,t)},decode(i){return Lse(i,n,t,r)}})}const _2=qn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});qn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});qn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});qn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});qn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});qn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});qn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});qn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});qn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const I8=jm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});jm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const la=jm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});jm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Use=MM,Fk=128,Fse=-128,zse=Math.pow(2,31);function MM(r,e,t){e=e||[],t=t||0;for(var n=t;r>=zse;)e[t++]=r&255|Fk,r/=128;for(;r&Fse;)e[t++]=r&255|Fk,r>>>=7;return e[t]=r|0,MM.bytes=t-n+1,e}var Vse=o7,Kse=128,zk=127;function o7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw o7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&zk)<<i:(o&zk)*Math.pow(2,i),i+=7}while(o>=Kse);return o7.bytes=s-n,t}var jse=Math.pow(2,7),Hse=Math.pow(2,14),qse=Math.pow(2,21),Wse=Math.pow(2,28),Gse=Math.pow(2,35),Qse=Math.pow(2,42),Yse=Math.pow(2,49),Jse=Math.pow(2,56),Xse=Math.pow(2,63),Zse=function(r){return r<jse?1:r<Hse?2:r<qse?3:r<Wse?4:r<Gse?5:r<Qse?6:r<Yse?7:r<Jse?8:r<Xse?9:10},eoe={encode:Use,decode:Vse,encodingLength:Zse},Zg=eoe;function a7(r,e=0){return[Zg.decode(r,e),Zg.decode.bytes]}function ey(r,e,t=0){return Zg.encode(r,e,t),e}function ty(r){return Zg.encodingLength(r)}function c7(r,e){const t=e.byteLength,n=ty(r),i=n+ty(t),s=new Uint8Array(i+t);return ey(r,s,0),ey(t,s,n),s.set(e,i),new cx(r,t,e,s)}function toe(r){const e=ax(r),[t,n]=a7(e),[i,s]=a7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new cx(t,i,o,e)}function roe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Tse(r.bytes,t.bytes)}}let cx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function Vk(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return ioe(t,l7(r),e??la.encoder);default:return soe(t,l7(r),e??_2.encoder)}}const Kk=new WeakMap;function l7(r){const e=Kk.get(r);if(e==null){const t=new Map;return Kk.set(r,t),t}return e}var tD;let u7=class Tr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,tD,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==tf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==ooe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Tr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=c7(e,t);return Tr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Tr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&roe(e.multihash,n.multihash)}toString(e){return Vk(this,e)}toJSON(){return{"/":Vk(this)}}link(){return this}[(tD=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Tr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Tr(n,i,s,o??jk(n,i,s.bytes))}else if(t[aoe]===!0){const{version:n,multihash:i,code:s}=t,o=toe(i);return Tr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==tf)throw new Error(`Version 0 CID must use dag-pb (code: ${tf}) block encoding`);return new Tr(e,t,n,n.bytes)}case 1:{const i=jk(e,t,n.bytes);return new Tr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Tr.create(0,tf,e)}static createV1(e,t){return Tr.create(1,e,t)}static decode(e){const[t,n]=Tr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Tr.inspectBytes(e),n=t.size-t.multihashSize,i=ax(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new cx(t.multihashCode,t.digestSize,s,i);return[t.version===0?Tr.createV0(o):Tr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=a7(e.subarray(t));return t+=p,h};let i=n(),s=tf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=noe(e,t),s=Tr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return l7(s).set(n,e),s}};function noe(r,e){switch(r[0]){case"Q":{const t=e??la;return[la.prefix,t.decode(`${la.prefix}${r}`)]}case la.prefix:{const t=e??la;return[la.prefix,t.decode(r)]}case _2.prefix:{const t=e??_2;return[_2.prefix,t.decode(r)]}case I8.prefix:{const t=e??I8;return[I8.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function ioe(r,e,t){const{prefix:n}=t;if(n!==la.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function soe(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const tf=112,ooe=18;function jk(r,e,t){const n=ty(r),i=n+ty(e),s=new Uint8Array(i+t.byteLength);return ey(r,s,0),ey(e,s,n),s.set(t,i),s}const aoe=Symbol.for("@ipld/js-cid/CID"),_8=qn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});qn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});qn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});qn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});class Ef{constructor(e=!1,t=0){u(this,"full");u(this,"pendingBytes");u(this,"wantlist");u(this,"blocks");u(this,"blockPresences");this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}addWantlistEntry(e,t){const n=_8.encode(e.multihash.bytes);this.wantlist.set(n,t)}addBlockPresence(e,t){const n=_8.encode(e.multihash.bytes);this.blockPresences.set(n,t)}addBlock(e,t){const n=_8.encode(e.multihash.bytes);this.blocks.set(n,t)}}function coe(r){let e=new Uint8Array(r.reduce((n,i)=>n+mt(i),0)),t=0;for(const n of r)e=Hr(n,e,t),t+=mt(n);return e}function Hk(r){return coe([r.version,r.code,r.multihash.code,r.multihash.digest.byteLength])}class loe{constructor(e,t){u(this,"peerId");u(this,"blockstore");u(this,"network");u(this,"wants");u(this,"exchangeCount");u(this,"bytesSent");u(this,"bytesReceived");u(this,"lastExchange");u(this,"maxSizeReplaceHasWithBlock");u(this,"log");this.peerId=e.peerId,this.blockstore=e.blockstore,this.network=e.network,this.wants=new Map,this.log=e.logger.forComponent(`helia:bitswap:ledger:${e.peerId}`),this.exchangeCount=0,this.bytesSent=0,this.bytesReceived=0,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock??Pne}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesReceived+=e}debtRatio(){return this.bytesSent/(this.bytesReceived+1)}async sendBlocksToPeer(e){const t=new Ef,n=new Set;for(const[i,s]of this.wants.entries())try{const o=await this.blockstore.get(s.cid,e);s.wantType===Zt.WantHave?o.byteLength<this.maxSizeReplaceHasWithBlock?(this.log("sending have and block for %c",s.cid),n.add(i),t.addBlock(s.cid,{data:o,prefix:Hk(s.cid)})):(this.log("sending have for %c",s.cid),t.addBlockPresence(s.cid,{cid:s.cid.bytes,type:As.HaveBlock})):(this.log("sending block for %c",s.cid),n.add(i),t.addBlock(s.cid,{data:o,prefix:Hk(s.cid)}))}catch(o){if(o.name!=="NotFoundError")throw o;if(this.log("do not have block for %c",s.cid),!s.sendDontHave||s.sentDoNotHave===!0)continue;s.sentDoNotHave=!0,t.addBlockPresence(s.cid,{cid:s.cid.bytes,type:As.DoNotHaveBlock})}if(t.blocks.size>0||t.blockPresences.size>0){this.log("sending message"),await this.network.sendMessage(this.peerId,t,e),this.log("sent message"),this.sentBytes([...t.blocks.values()].reduce((i,s)=>i+s.data.byteLength,0));for(const i of n)this.wants.delete(i)}}}class uoe{constructor(e,t={}){u(this,"blockstore");u(this,"network");u(this,"ledgerMap");u(this,"maxSizeReplaceHasWithBlock");u(this,"log");u(this,"logger");this.blockstore=e.blockstore,this.network=e.network,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock,this.log=e.logger.forComponent("helia:bitswap:peer-want-lists"),this.logger=e.logger,this.ledgerMap=RM({name:"helia_bitswap_ledger_map",metrics:e.metrics}),this.network.addEventListener("bitswap:message",n=>{this.receiveMessage(n.detail.peer,n.detail.message).catch(i=>{this.log.error("error receiving bitswap message from %p",n.detail.peer,i)})}),this.network.addEventListener("peer:disconnected",n=>{this.peerDisconnected(n.detail)})}ledgerForPeer(e){const t=this.ledgerMap.get(e);if(t!=null)return{peer:t.peerId,value:t.debtRatio(),sent:t.bytesSent,received:t.bytesReceived,exchanged:t.exchangeCount}}wantListForPeer(e){const t=this.ledgerMap.get(e);if(t!=null)return[...t.wants.values()]}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.peerId)}async receiveMessage(e,t){var i;let n=this.ledgerMap.get(e);if(n==null&&(n=new loe({peerId:e,blockstore:this.blockstore,network:this.network,logger:this.logger},{maxSizeReplaceHasWithBlock:this.maxSizeReplaceHasWithBlock}),this.ledgerMap.set(e,n)),n.receivedBytes(((i=t.blocks)==null?void 0:i.reduce((s,o)=>s+o.data.byteLength,0))??0),t.wantlist!=null){t.wantlist.full===!0&&n.wants.clear();for(const s of t.wantlist.entries){const o=u7.decode(s.cid),a=re(o.multihash.bytes,"base64");s.cancel===!0?(this.log("peer %p cancelled want of block for %c",e,o),n.wants.delete(a)):(s.wantType===Zt.WantHave?this.log("peer %p wanted block presence for %c",e,o):this.log("peer %p wanted block for %c",e,o),n.wants.set(a,{cid:o,priority:s.priority,wantType:s.wantType??Zt.WantBlock,sendDontHave:s.sendDontHave??!1}))}}this.log("send blocks to peer"),await n.sendBlocksToPeer()}async receivedBlock(e,t){const n=re(e.multihash.bytes,"base64"),i=[];for(const s of this.ledgerMap.values())s.wants.has(n)&&i.push(s);await Promise.all(i.map(async s=>s.sendBlocksToPeer(t)))}peerDisconnected(e){this.ledgerMap.delete(e)}}function doe(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function hoe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var foe=hoe,poe=foe;let goe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},yoe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return UM(this,e)}},moe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return UM(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function UM(r,e){return new moe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let woe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new goe(e,t,n),this.decoder=new yoe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function FM({name:r,prefix:e,encode:t,decode:n}){return new woe(r,e,t,n)}function zM({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=poe(t,r);return FM({prefix:e,name:r,encode:n,decode:s=>doe(i(s))})}function boe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function voe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Wn({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return FM({prefix:e,name:r,encode(i){return voe(i,n,t)},decode(i){return boe(i,n,t,r)}})}const Eoe=Wn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Wn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Wn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Wn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Wn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Wn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Wn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Wn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Wn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const xoe=zM({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});zM({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const Soe=Wn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Wn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});Wn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});Wn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const Pd=1e3,Dd=Pd*60,Nd=Dd*60,$l=Nd*24,Aoe=$l*7,Coe=$l*365.25;function VM(r,e){try{if(typeof r=="string"&&r.length>0)return koe(r);if(typeof r=="number"&&isFinite(r))return e!=null&&e.long?_oe(r):Ioe(r);throw new Error("Value is not a string or number.")}catch(t){const n=Toe(t)?`${t.message}. value=${JSON.stringify(r)}`:"An unknown error has occured.";throw new Error(n)}}function koe(r){if(r=String(r),r.length>100)throw new Error("Value exceeds the maximum length of 100 characters.");const e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!e)return NaN;const t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*Coe;case"weeks":case"week":case"w":return t*Aoe;case"days":case"day":case"d":return t*$l;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Nd;case"minutes":case"minute":case"mins":case"min":case"m":return t*Dd;case"seconds":case"second":case"secs":case"sec":case"s":return t*Pd;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:throw new Error(`The unit ${n} was matched, but no matching case exists.`)}}function Ioe(r){const e=Math.abs(r);return e>=$l?`${Math.round(r/$l)}d`:e>=Nd?`${Math.round(r/Nd)}h`:e>=Dd?`${Math.round(r/Dd)}m`:e>=Pd?`${Math.round(r/Pd)}s`:`${r}ms`}function _oe(r){const e=Math.abs(r);return e>=$l?Np(r,e,$l,"day"):e>=Nd?Np(r,e,Nd,"hour"):e>=Dd?Np(r,e,Dd,"minute"):e>=Pd?Np(r,e,Pd,"second"):`${r} ms`}function Np(r,e,t,n){const i=e>=t*1.5;return`${Math.round(r/t)} ${n}${i?"s":""}`}function Toe(r){return typeof r=="object"&&r!==null&&"message"in r}function $oe(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=i,t.enabled=o,t.humanize=VM,t.destroy=l,Object.keys(r).forEach(d=>{t[d]=r[d]}),t.names=[],t.skips=[],t.formatters={};function e(d){let h=0;for(let p=0;p<d.length;p++)h=(h<<5)-h+d.charCodeAt(p),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=e;function t(d){let h,p=null,b,f;function g(...v){if(!g.enabled)return;const y=g,w=Number(new Date),m=w-(h||w);y.diff=m,y.prev=h,y.curr=w,h=w,v[0]=t.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let E=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(k,A)=>{if(k==="%%")return"%";E++;const I=t.formatters[A];if(typeof I=="function"){const D=v[E];k=I.call(y,D),v.splice(E,1),E--}return k}),t.formatArgs.call(y,v),(y.log||t.log).apply(y,v)}return g.namespace=d,g.useColors=t.useColors(),g.color=t.selectColor(d),g.extend=n,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(b!==t.namespaces&&(b=t.namespaces,f=t.enabled(d)),f),set:v=>{p=v}}),typeof t.init=="function"&&t.init(g),g}function n(d,h){const p=t(this.namespace+(typeof h>"u"?":":h)+d);return p.log=this.log,p}function i(d){t.save(d),t.namespaces=d,t.names=[],t.skips=[];let h;const p=(typeof d=="string"?d:"").split(/[\s,]+/),b=p.length;for(h=0;h<b;h++)p[h]&&(d=p[h].replace(/\*/g,".*?"),d[0]==="-"?t.skips.push(new RegExp("^"+d.substr(1)+"$")):t.names.push(new RegExp("^"+d+"$")))}function s(){const d=[...t.names.map(a),...t.skips.map(a).map(h=>"-"+h)].join(",");return t.enable(""),d}function o(d){if(d[d.length-1]==="*")return!0;let h,p;for(h=0,p=t.skips.length;h<p;h++)if(t.skips[h].test(d))return!1;for(h=0,p=t.names.length;h<p;h++)if(t.names[h].test(d))return!0;return!1}function a(d){return d.toString().substring(2,d.toString().length-2).replace(/\.\*\?$/,"*")}function c(d){return d instanceof Error?d.stack??d.message:d}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.setupFormatters(t.formatters),t.enable(t.load()),t}var Poe={};const ys=Moe(),Doe=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Noe(){var r,e,t,n,i;return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&((r=navigator.userAgent)==null?void 0:r.toLowerCase().match(/(edge|trident)\/(\d+)/))!=null?!1:typeof document<"u"&&((t=(e=document.documentElement)==null?void 0:e.style)==null?void 0:t.WebkitAppearance)||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&((n=navigator.userAgent)==null?void 0:n.toLowerCase().match(/firefox\/(\d+)/))!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&((i=navigator.userAgent)==null?void 0:i.toLowerCase().match(/applewebkit\/(\d+)/))}function Ooe(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+VM(this.diff),!this.useColors)return;const e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}const Roe=console.debug??console.log??(()=>{});function Boe(r){try{r?ys==null||ys.setItem("debug",r):ys==null||ys.removeItem("debug")}catch{}}function Loe(){let r;try{r=ys==null?void 0:ys.getItem("debug")}catch{}return!r&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(r=Poe.DEBUG),r}function Moe(){try{return localStorage}catch{}}function Uoe(r){r.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}const Rn=$oe({formatArgs:Ooe,save:Boe,load:Loe,useColors:Noe,setupFormatters:Uoe,colors:Doe,storage:ys,log:Roe});Rn.formatters.b=r=>r==null?"undefined":xoe.baseEncode(r);Rn.formatters.t=r=>r==null?"undefined":Eoe.baseEncode(r);Rn.formatters.m=r=>r==null?"undefined":Soe.baseEncode(r);Rn.formatters.p=r=>r==null?"undefined":r.toString();Rn.formatters.c=r=>r==null?"undefined":r.toString();Rn.formatters.k=r=>r==null?"undefined":r.toString();Rn.formatters.a=r=>r==null?"undefined":r.toString();Rn.formatters.e=r=>r==null?"undefined":qk(r.stack)??qk(r.message)??r.toString();function Foe(r){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function Hm(){return{forComponent(r){return gh(r)}}}function gh(r){let e=Foe(`${r}:trace`);return Rn.enabled(`${r}:trace`)&&Rn.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=Rn(`${r}:trace`)),Object.assign(Rn(r),{error:Rn(`${r}:error`),trace:e})}function qk(r){if(r!=null&&(r=r.trim(),r.length!==0))return r}function KM(r){const e=[ic.A];return r==null?e:Array.isArray(r)?r.length===0?e:r:[r]}const jM=60;function HM(r){return{Status:r.Status??0,TC:r.TC??r.flag_tc??!1,RD:r.RD??r.flag_rd??!1,RA:r.RA??r.flag_ra??!1,AD:r.AD??r.flag_ad??!1,CD:r.CD??r.flag_cd??!1,Question:(r.Question??r.questions??[]).map(e=>({name:e.name,type:ic[e.type]})),Answer:(r.Answer??r.answers??[]).map(e=>({name:e.name,type:ic[e.type],TTL:e.TTL??e.ttl??jM,data:e.data instanceof Uint8Array?re(e.data):e.data}))}}const zoe=4;function Wk(r,e={}){const t=new Za({concurrency:e.queryConcurrency??zoe});return async(n,i={})=>{var a;const s=new URLSearchParams;s.set("name",n),KM(i.types).forEach(c=>{s.append("type",ic[c])}),(a=i.onProgress)==null||a.call(i,new ke("dns:query",{detail:n}));const o=await t.add(async()=>{var d;const c=await fetch(`${r}?${s}`,{headers:{accept:"application/dns-json"},signal:i==null?void 0:i.signal});if(c.status!==200)throw new Error(`Unexpected HTTP status: ${c.status} - ${c.statusText}`);const l=HM(await c.json());return(d=i.onProgress)==null||d.call(i,new ke("dns:response",{detail:l})),l},{signal:i.signal});if(o==null)throw new Error("No DNS response received");return o}}function Voe(){return[Wk("https://cloudflare-dns.com/dns-query"),Wk("https://dns.google/resolve")]}var Koe=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),n=Object.create(null);function i(s,o){t[s]=o,e++,e>=r&&(e=0,n=t,t=Object.create(null))}return{has:function(s){return t[s]!==void 0||n[s]!==void 0},remove:function(s){t[s]!==void 0&&(t[s]=void 0),n[s]!==void 0&&(n[s]=void 0)},get:function(s){var o=t[s];if(o!==void 0)return o;if((o=n[s])!==void 0)return i(s,o),o},set:function(s,o){t[s]!==void 0?t[s]=o:i(s,o)},clear:function(){t=Object.create(null),n=Object.create(null)}}};const joe=hc(Koe);class Hoe{constructor(e){u(this,"lru");this.lru=joe(e)}get(e,t){let n=!0;const i=[];for(const s of t){const o=this.getAnswers(e,s);if(o.length===0){n=!1;break}i.push(...o)}if(n)return HM({answers:i})}getAnswers(e,t){const n=`${e.toLowerCase()}-${t}`,i=this.lru.get(n);if(i!=null){const s=i.filter(o=>o.expires>Date.now()).map(({expires:o,value:a})=>({...a,TTL:Math.round((o-Date.now())/1e3),type:ic[a.type]}));return s.length===0&&this.lru.remove(n),s}return[]}add(e,t){const n=`${e.toLowerCase()}-${t.type}`,i=this.lru.get(n)??[];i.push({expires:Date.now()+(t.TTL??jM)*1e3,value:t}),this.lru.set(n,i)}remove(e,t){const n=`${e.toLowerCase()}-${t}`;this.lru.remove(n)}clear(){this.lru.clear()}}function qoe(r){return new Hoe(r)}const Woe=1e3;let Goe=class{constructor(e){u(this,"resolvers");u(this,"cache");this.resolvers={},this.cache=qoe(e.cacheSize??Woe),Object.entries(e.resolvers??{}).forEach(([t,n])=>{Array.isArray(n)||(n=[n]),t.endsWith(".")||(t=`${t}.`),this.resolvers[t]=n}),this.resolvers["."]==null&&(this.resolvers["."]=Voe())}async query(e,t={}){var c,l,d;const n=KM(t.types),i=t.cached!==!1?this.cache.get(e,n):void 0;if(i!=null)return(c=t.onProgress)==null||c.call(t,new ke("dns:cache",{detail:i})),i;const s=`${e.split(".").pop()}.`,o=(this.resolvers[s]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),a=[];for(const h of o){if(((l=t.signal)==null?void 0:l.aborted)===!0)break;try{const p=await h(e,{...t,types:n});for(const b of p.Answer)this.cache.add(e,b);return p}catch(p){a.push(p),(d=t.onProgress)==null||d.call(t,new ke("dns:error",{detail:p}))}}throw a.length===1?a[0]:new AggregateError(a,`DNS lookup of ${e} ${n} failed`)}};var ic;(function(r){r[r.A=1]="A",r[r.CNAME=5]="CNAME",r[r.TXT=16]="TXT",r[r.AAAA=28]="AAAA"})(ic||(ic={}));function qM(r={}){return new Goe(r)}const js="/",WM=new TextEncoder().encode(js),Op=WM[0];class ht{constructor(e,t){u(this,"_buf");if(typeof e=="string")this._buf=se(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==Op)throw new Error("Invalid key")}toString(e="utf8"){return re(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new ht(e.join(js))}static random(){return new ht(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new ht(e):typeof e.uint8Array=="function"?new ht(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=WM),this._buf[0]!==Op){const e=new Uint8Array(this._buf.byteLength+1);e.fill(Op,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Op;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;const s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return ht.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(js).slice(1)}type(){return Qoe(this.baseNamespace())}name(){return Yoe(this.baseNamespace())}instance(e){return new ht(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(js)||(e+=js),e+=this.type(),new ht(e)}parent(){const e=this.list();return e.length===1?new ht(js):new ht(e.slice(0,-1).join(js))}child(e){return this.toString()===js?e:e.toString()===js?this:new ht(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return ht.withNamespaces([...this.namespaces(),...Joe(e.map(t=>t.namespaces()))])}}function Qoe(r){const e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function Yoe(r){const e=r.split(":");return e[e.length-1]}function Joe(r){return[].concat(...r)}function Xoe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function yh(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Zoe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var eae=Zoe,tae=eae;let rae=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},nae=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return GM(this,e)}},iae=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return GM(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function GM(r,e){return new iae({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let sae=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new rae(e,t,n),this.decoder=new nae(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function QM({name:r,prefix:e,encode:t,decode:n}){return new sae(r,e,t,n)}function qm({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=tae(t,r);return QM({prefix:e,name:r,encode:n,decode:s=>yh(i(s))})}function oae(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function aae(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Gn({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return QM({prefix:e,name:r,encode(i){return aae(i,n,t)},decode(i){return oae(i,n,t,r)}})}const Zu=qm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});qm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const T2=Gn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Gn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Gn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Gn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Gn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Gn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Gn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Gn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Gn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const ua=qm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});qm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var cae=YM,Gk=128,lae=-128,uae=Math.pow(2,31);function YM(r,e,t){e=e||[],t=t||0;for(var n=t;r>=uae;)e[t++]=r&255|Gk,r/=128;for(;r&lae;)e[t++]=r&255|Gk,r>>>=7;return e[t]=r|0,YM.bytes=t-n+1,e}var dae=d7,hae=128,Qk=127;function d7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw d7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&Qk)<<i:(o&Qk)*Math.pow(2,i),i+=7}while(o>=hae);return d7.bytes=s-n,t}var fae=Math.pow(2,7),pae=Math.pow(2,14),gae=Math.pow(2,21),yae=Math.pow(2,28),mae=Math.pow(2,35),wae=Math.pow(2,42),bae=Math.pow(2,49),vae=Math.pow(2,56),Eae=Math.pow(2,63),xae=function(r){return r<fae?1:r<pae?2:r<gae?3:r<yae?4:r<mae?5:r<wae?6:r<bae?7:r<vae?8:r<Eae?9:10},Sae={encode:cae,decode:dae,encodingLength:xae},ry=Sae;function h7(r,e=0){return[ry.decode(r,e),ry.decode.bytes]}function ny(r,e,t=0){return ry.encode(r,e,t),e}function iy(r){return ry.encodingLength(r)}function sy(r,e){const t=e.byteLength,n=iy(r),i=n+iy(t),s=new Uint8Array(i+t);return ny(r,s,0),ny(t,s,n),s.set(e,i),new lx(r,t,e,s)}function Aae(r){const e=yh(r),[t,n]=h7(e),[i,s]=h7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new lx(t,i,o,e)}function Cae(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Xoe(r.bytes,t.bytes)}}let lx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function Yk(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Iae(t,f7(r),e??ua.encoder);default:return _ae(t,f7(r),e??T2.encoder)}}const Jk=new WeakMap;function f7(r){const e=Jk.get(r);if(e==null){const t=new Map;return Jk.set(r,t),t}return e}var rD;let Pl=class $r{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,rD,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==rf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Tae)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return $r.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=sy(e,t);return $r.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return $r.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Cae(e.multihash,n.multihash)}toString(e){return Yk(this,e)}toJSON(){return{"/":Yk(this)}}link(){return this}[(rD=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof $r)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new $r(n,i,s,o??Xk(n,i,s.bytes))}else if(t[$ae]===!0){const{version:n,multihash:i,code:s}=t,o=Aae(i);return $r.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==rf)throw new Error(`Version 0 CID must use dag-pb (code: ${rf}) block encoding`);return new $r(e,t,n,n.bytes)}case 1:{const i=Xk(e,t,n.bytes);return new $r(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return $r.create(0,rf,e)}static createV1(e,t){return $r.create(1,e,t)}static decode(e){const[t,n]=$r.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=$r.inspectBytes(e),n=t.size-t.multihashSize,i=yh(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new lx(t.multihashCode,t.digestSize,s,i);return[t.version===0?$r.createV0(o):$r.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=h7(e.subarray(t));return t+=p,h};let i=n(),s=rf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=kae(e,t),s=$r.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return f7(s).set(n,e),s}};function kae(r,e){switch(r[0]){case"Q":{const t=e??ua;return[ua.prefix,t.decode(`${ua.prefix}${r}`)]}case ua.prefix:{const t=e??ua;return[ua.prefix,t.decode(r)]}case T2.prefix:{const t=e??T2;return[T2.prefix,t.decode(r)]}case Zu.prefix:{const t=e??Zu;return[Zu.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Iae(r,e,t){const{prefix:n}=t;if(n!==ua.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function _ae(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const rf=112,Tae=18;function Xk(r,e,t){const n=iy(r),i=n+iy(e),s=new Uint8Array(i+t.byteLength);return ny(r,s,0),ny(e,s,n),s.set(t,i),s}const $ae=Symbol.for("@ipld/js-cid/CID");function JM({name:r,code:e,encode:t}){return new Pae(r,e,t)}let Pae=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?sy(this.code,t):t.then(n=>sy(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Rp({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*Dae(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t],s=Pl.asCID(n);s!=null?yield[i.join("/"),s]:typeof n=="object"&&(yield*p7(n,i))}else{const t=Pl.asCID(e);t!=null?yield[r.join("/"),t]:yield*p7(e,r)}}function*p7(r,e){if(r==null||r instanceof Uint8Array)return;const t=Pl.asCID(r);t!=null&&(yield[e.join("/"),t]);for(const[n,i]of Object.entries(r)){const s=[...e,n];yield*Dae(s,i)}}function*Nae(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t];yield i.join("/"),typeof n=="object"&&Pl.asCID(n)==null&&(yield*g7(n,i))}else yield*g7(e,r)}function*g7(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const i=[...e,t];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&Pl.asCID(n)==null&&(yield*Nae(i,n))}}function Oae(r,e){let t=r;for(const[n,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);const s=Pl.asCID(t);if(s!=null)return{value:s,remaining:e.slice(n+1).join("/")}}return{value:t}}class Rae{constructor({cid:e,bytes:t,value:n}){u(this,"cid");u(this,"bytes");u(this,"value");u(this,"asBlock");if(e==null||t==null||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:Rp(),bytes:Rp(),value:Rp(),asBlock:Rp()})}links(){return p7(this.value,[])}tree(){return g7(this.value,[])}get(e="/"){return Oae(this.value,e.split("/").filter(Boolean))}}function Bae({bytes:r,cid:e,value:t,codec:n}){const i=t!==void 0?t:n==null?void 0:n.decode(r);if(i===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new Rae({cid:e,bytes:r,value:i})}const XM="/pin/",Zk="/pinned-block/",y7=Zu,eI=1;function Bp(r){return r.version===0&&(r=r.toV1()),new ht(`${XM}${r.toString(y7)}`)}var go,$2,m7;class Lae{constructor(e,t,n){qe(this,go);u(this,"datastore");u(this,"blockstore");u(this,"getCodec");this.datastore=e,this.blockstore=t,this.getCodec=n}async*add(e,t={}){const n=Bp(e);if(await this.datastore.has(n))throw new Error("Already pinned");const i=Math.round(t.depth??1/0);if(i<0)throw new Error("Depth must be greater than or equal to 0");const s=new _l({concurrency:eI});for await(const a of Ae(this,go,$2).call(this,e,s,{...t,depth:i}))await Ae(this,go,m7).call(this,a,c=>c.pinnedBy.find(l=>Fe(l,e.bytes))!=null?!1:(c.pinCount++,c.pinnedBy.push(e.bytes),!0),t),yield a;const o={depth:i,metadata:t.metadata??{}};await this.datastore.put(n,E2(o),t)}async*rm(e,t={}){const n=Bp(e),i=await this.datastore.get(n,t),s=xa(i);await this.datastore.delete(n,t);const o=new _l({concurrency:eI});for await(const a of Ae(this,go,$2).call(this,e,o,{...t,depth:s.depth}))await Ae(this,go,m7).call(this,a,c=>(c.pinCount--,c.pinnedBy=c.pinnedBy.filter(l=>Fe(l,e.bytes)),!0),{...t,depth:s.depth}),yield a}async*ls(e={}){for await(const{key:t,value:n}of this.datastore.query({prefix:XM+(e.cid!=null?`${e.cid.toString(Zu)}`:"")},e)){const i=Pl.parse(t.toString().substring(5),Zu),s=xa(n);yield{cid:i,...s}}}async isPinned(e,t={}){const n=new ht(`${Zk}${y7.encode(e.multihash.bytes)}`);return this.datastore.has(n,t)}async get(e,t){const n=Bp(e),i=await this.datastore.get(n,t);return xa(i)}async setMetadata(e,t,n){const i=Bp(e),s=await this.datastore.get(i,n),o=xa(s);o.metadata=t??{},await this.datastore.put(i,E2(o),n)}}go=new WeakSet,$2=async function*(e,t,n){if(n.depth===-1)return;const i=await this.getCodec(e.code),s=await this.blockstore.get(e,n),o=Bae({bytes:s,cid:e,codec:i});yield e;for await(const[,a]of o.links())yield*await t.add(async()=>Ae(this,go,$2).call(this,a,t,{...n,depth:n.depth-1}))},m7=async function(e,t,n){var a;const i=new ht(`${Zk}${y7.encode(e.multihash.bytes)}`);let s={pinCount:0,pinnedBy:[]};try{s=xa(await this.datastore.get(i,n))}catch(c){if(c.name!=="NotFoundError")throw c}if(t(s)){if(s.pinCount===0&&await this.datastore.has(i)){await this.datastore.delete(i);return}await this.datastore.put(i,E2(s),n),(a=n.onProgress)==null||a.call(n,new ke("helia:pin:add",e))}};const Mae=1,Uae=5;class ZM extends Error{constructor(e="Insufficient providers found"){super(e),this.name="InsufficientProvidersError"}}u(ZM,"name","InsufficientProvidersError");class xf extends Error{constructor(e="No routers available"){super(e),this.name="NoRoutersAvailableError"}}u(xf,"name","NoRoutersAvailableError");class eU extends Error{constructor(e="Unknown hash algorithm"){super(e),this.name="UnknownHashAlgorithmError"}}u(eU,"name","UnknownHashAlgorithmError");class tU extends Error{constructor(e="Unknown codec"){super(e),this.name="UnknownCodecError"}}u(tU,"name","UnknownCodecError");const Fae=5;class zae{constructor(e,t){u(this,"log");u(this,"routers");u(this,"providerLookupConcurrency");var n,i,s,o,a,c,l;this.log=e.logger.forComponent("helia:routing"),this.routers=t.routers??[],this.providerLookupConcurrency=t.providerLookupConcurrency??Fae,this.findProviders=((n=e.metrics)==null?void 0:n.traceFunction("helia.routing.findProviders",this.findProviders.bind(this),{optionsIndex:1}))??this.findProviders,this.provide=((i=e.metrics)==null?void 0:i.traceFunction("helia.routing.provide",this.provide.bind(this),{optionsIndex:1}))??this.provide,this.cancelReprovide=((s=e.metrics)==null?void 0:s.traceFunction("helia.routing.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1}))??this.cancelReprovide,this.put=((o=e.metrics)==null?void 0:o.traceFunction("helia.routing.put",this.put.bind(this),{optionsIndex:2}))??this.put,this.get=((a=e.metrics)==null?void 0:a.traceFunction("helia.routing.get",this.get.bind(this),{optionsIndex:1}))??this.get,this.findPeer=((c=e.metrics)==null?void 0:c.traceFunction("helia.routing.findPeer",this.findPeer.bind(this),{optionsIndex:1}))??this.findPeer,this.getClosestPeers=((l=e.metrics)==null?void 0:l.traceFunction("helia.routing.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1}))??this.getClosestPeers}async start(){await Eo(...this.routers)}async stop(){await mc(...this.routers)}async*findProviders(e,t={}){if(this.routers.length===0)throw new xf("No content routers available");const n=new nc({concurrency:this.providerLookupConcurrency});n.addEventListener("error",()=>{});for await(const i of Ka(n.toGenerator(),...Oc(this.routers,"findProviders").map(s=>s.findProviders(e,t))))if(i!=null){if(i.multiaddrs.length===0){if(n.find(i.id)!=null)continue;n.add(async()=>{try{const s=await this.findPeer(i.id,t);return s.multiaddrs.length===0?null:s}catch(s){return this.log.error("could not load multiaddrs for peer %p",i.id,s),null}},{peerId:i.id,signal:t.signal}).catch(s=>{this.log.error("could not load multiaddrs for peer %p",i.id,s)})}yield i}}async provide(e,t={}){if(this.routers.length===0)throw new xf("No content routers available");await Promise.all(Oc(this.routers,"provide").map(async n=>{await n.provide(e,t)}))}async cancelReprovide(e,t={}){await Promise.all(Oc(this.routers,"cancelReprovide").map(async n=>{await n.cancelReprovide(e,t)}))}async put(e,t,n){await Promise.all(Oc(this.routers,"put").map(async i=>{await i.put(e,t,n)}))}async get(e,t){return Promise.any(Oc(this.routers,"get").map(async n=>n.get(e,t)))}async findPeer(e,t){if(this.routers.length===0)throw new xf("No peer routers available");const n=this,i=Ka(...Oc(this.routers,"findPeer").map(s=>async function*(){try{yield await s.findPeer(e,t)}catch(o){n.log.error(o)}}()));for await(const s of i)if(s!=null)return s;throw new jt("Could not find peer in routing")}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new xf("No peer routers available");for await(const n of Ka(...Oc(this.routers,"getClosestPeers").map(i=>i.getClosestPeers(e,t))))n!=null&&(yield n)}}function Oc(r,e){return r.filter(t=>t[e]!=null)}const Wa={},Dl=r=>{r.addEventListener("message",e=>{Dl.dispatchEvent("message",r,e)}),r.port!=null&&r.port.addEventListener("message",e=>{Dl.dispatchEvent("message",r,e)})};Dl.addEventListener=(r,e)=>{Wa[r]==null&&(Wa[r]=[]),Wa[r].push(e)};Dl.removeEventListener=(r,e)=>{Wa[r]!=null&&(Wa[r]=Wa[r].filter(t=>t===e))};Dl.dispatchEvent=function(r,e,t){Wa[r]!=null&&Wa[r].forEach(n=>n(e,t))};const tI="lock:worker:request-read",rI="lock:worker:release-read",nI="lock:master:grant-read",iI="lock:worker:request-write",sI="lock:worker:release-write",oI="lock:master:grant-write",Vae=(r=21)=>Math.random().toString().substring(2),aI=(r,e,t,n,i)=>(s,o)=>{if(o.data.type!==t)return;const a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};r.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>{s.postMessage({type:i,name:a.name,identifier:a.identifier}),await new Promise(c=>{const l=d=>{if((d==null?void 0:d.data)==null)return;const h={type:d.data.type,name:d.data.name,identifier:d.data.identifier};h.type===n&&h.identifier===a.identifier&&(s.removeEventListener("message",l),c())};s.addEventListener("message",l)})}}}))},cI=(r,e,t,n)=>async()=>{const i=Vae();return globalThis.postMessage({type:e,identifier:i,name:r}),new Promise(s=>{const o=a=>{if((a==null?void 0:a.data)==null)return;const c={type:a.data.type,identifier:a.data.identifier};c.type===t&&c.identifier===i&&(globalThis.removeEventListener("message",o),s(()=>{globalThis.postMessage({type:n,identifier:i,name:r})}))};globalThis.addEventListener("message",o)})},Kae={singleProcess:!1},jae=r=>{if(r=Object.assign({},Kae,r),!!globalThis.document||r.singleProcess){const t=new EventTarget;return Dl.addEventListener("message",aI(t,"requestReadLock",tI,rI,nI)),Dl.addEventListener("message",aI(t,"requestWriteLock",iI,sI,oI)),t}return{isWorker:!0,readLock:t=>cI(t,tI,nI,rI),writeLock:t=>cI(t,iI,oI,sI)}},Rc={};let Sa;async function T8(r,e){let t;const n=new Promise(i=>{t=i});return r.add(async()=>l0((async()=>{await new Promise(i=>{t(()=>{i()})})})(),{milliseconds:e.timeout})),n}const Hae=(r,e)=>{if(Sa.isWorker===!0)return{readLock:Sa.readLock(r,e),writeLock:Sa.writeLock(r,e)};const t=new Za({concurrency:1});let n;return{async readLock(){if(n!=null)return T8(n,e);n=new Za({concurrency:e.concurrency,autoStart:!1});const i=n,s=T8(n,e);return t.add(async()=>{i.start(),await i.onIdle().then(()=>{n===i&&(n=null)})}),s},async writeLock(){return n=null,T8(t,e)}}},qae={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function ux(r){const e=Object.assign({},qae,r);return Sa==null&&(Sa=jae(e),Sa.isWorker!==!0&&(Sa.addEventListener("requestReadLock",t=>{Rc[t.data.name]!=null&&Rc[t.data.name].readLock().then(async n=>t.data.handler().finally(()=>{n()}))}),Sa.addEventListener("requestWriteLock",async t=>{Rc[t.data.name]!=null&&Rc[t.data.name].writeLock().then(async n=>t.data.handler().finally(()=>{n()}))}))),Rc[e.name]==null&&(Rc[e.name]=Hae(e.name,e)),Rc[e.name]}class Wae{constructor(e,t,n={}){u(this,"lock");u(this,"child");u(this,"pins");u(this,"started");this.child=e,this.pins=t,this.lock=ux({singleProcess:n.holdGcLock}),this.started=!1}isStarted(){return this.started}async start(){await Eo(this.child),this.started=!0}async stop(){await mc(this.child),this.started=!1}unwrap(){return this.child}async put(e,t,n={}){var s;(s=n==null?void 0:n.signal)==null||s.throwIfAborted();const i=await this.lock.readLock();try{return await this.child.put(e,t,n)}finally{i()}}async*putMany(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.putMany(e,t)}finally{n()}}async get(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{return await this.child.get(e,t)}finally{n()}}async*getMany(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.getMany(e,t)}finally{n()}}async delete(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.writeLock();try{if(await this.pins.isPinned(e))throw new Error("CID was pinned");await this.child.delete(e,t)}finally{n()}}async*deleteMany(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.writeLock();try{const s=this;yield*this.child.deleteMany(async function*(){for await(const o of e){if(await s.pins.isPinned(o))throw new Error("CID was pinned");yield o}}(),t)}finally{n()}}async has(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{return await this.child.has(e,t)}finally{n()}}async*getAll(e={}){var n;(n=e==null?void 0:e.signal)==null||n.throwIfAborted();const t=await this.lock.readLock();try{yield*this.child.getAll(e)}finally{t()}}createSession(e,t){var n;return(n=t==null?void 0:t.signal)==null||n.throwIfAborted(),this.child.createSession(e,t)}}const $8=new ht("/version"),lI=1;async function Gae(r){if(!await r.has($8)){await r.put($8,se(`${lI}`));return}const e=await r.get($8),t=re(e);if(parseInt(t,10)!==lI)throw new Error("Unknown datastore version, a datastore migration may be required")}class Qae extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===z.array&&(t.elements++,t.elements!==1&&e.push([44])),t.type===z.map&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[z.uint.major](e,t){this.prefix(e);const n=String(t.value),i=[];for(let s=0;s<n.length;s++)i[s]=n.charCodeAt(s);e.push(i)}[z.negint.major](e,t){this[z.uint.major](e,t)}[z.bytes.major](e,t){throw new Error(`${al} unsupported type: Uint8Array`)}[z.string.major](e,t){this.prefix(e);const n=KR(JSON.stringify(t.value));e.push(n.length>32?Wv(n):n)}[z.array.major](e,t){this.prefix(e),this.inRecursive.push({type:z.array,elements:0}),e.push([91])}[z.map.major](e,t){this.prefix(e),this.inRecursive.push({type:z.map,elements:0}),e.push([123])}[z.tag.major](e,t){}[z.float.major](e,t){if(t.type.name==="break"){const o=this.inRecursive.pop();if(o){if(o.type===z.array)e.push([93]);else if(o.type===z.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${al} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}const n=String(t.value),i=[];let s=!1;for(let o=0;o<n.length;o++)i[o]=n.charCodeAt(o),!s&&(i[o]===46||i[o]===101||i[o]===69)&&(s=!0);s||(i.push(46),i.push(48)),e.push(i)}}function Yae(r,e){if(Array.isArray(r[0])||Array.isArray(e[0]))throw new Error(`${al} complex map keys are not supported`);const t=r[0],n=e[0];if(t.type!==z.string||n.type!==z.string)throw new Error(`${al} non-string map keys are not supported`);if(t<n)return-1;if(t>n)return 1;throw new Error(`${al} unexpected duplicate map keys, this is not supported`)}const Jae={addBreakTokens:!0,mapSorter:Yae};function Xae(r,e){return e=Object.assign({},Jae,e),ZR(r,new Qae,e)}class rU{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error(`${Ce} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw new Error(`${Ce} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this._pos;let t=!1,n=!1;const i=a=>{for(;!this.done();){const c=this.ch();if(a.includes(c))this._pos++;else break}};if(this.ch()===45&&(t=!0,this._pos++),this.ch()===48)if(this._pos++,this.ch()===46)this._pos++,n=!0;else return new ne(z.uint,0,this._pos-e);if(i([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw new Error(`${Ce} unexpected token at position ${this._pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${Ce} unexpected token at position ${this._pos}`);n=!0,this._pos++,i([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this._pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this._pos++,i([48,49,50,51,52,53,54,55,56,57]));const s=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),o=parseFloat(s);return n?new ne(z.float,o,this._pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(o)?new ne(o>=0?z.uint:z.negint,o,this._pos-e):new ne(o>=0?z.uint:z.negint,BigInt(s),this._pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${Ce} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let s=this._pos,o=0;s<this.data.length&&o<65536;s++,o++){const a=this.data[s];if(a===92||a<32||a>=128)break;if(a===34){const c=String.fromCharCode.apply(null,this.data.subarray(this._pos,s));return this._pos=s+1,new ne(z.string,c,o)}}const e=this._pos,t=[],n=()=>{if(this._pos+4>=this.data.length)throw new Error(`${Ce} unexpected end of unicode escape sequence at position ${this._pos}`);let s=0;for(let o=0;o<4;o++){let a=this.ch();if(a>=48&&a<=57)a-=48;else if(a>=97&&a<=102)a=a-97+10;else if(a>=65&&a<=70)a=a-65+10;else throw new Error(`${Ce} unexpected unicode escape character at position ${this._pos}`);s=s*16+a,this._pos++}return s},i=()=>{const s=this.ch();let o=null,a=s>239?4:s>223?3:s>191?2:1;if(this._pos+a>this.data.length)throw new Error(`${Ce} unexpected unicode sequence at position ${this._pos}`);let c,l,d,h;switch(a){case 1:s<128&&(o=s);break;case 2:c=this.data[this._pos+1],(c&192)===128&&(h=(s&31)<<6|c&63,h>127&&(o=h));break;case 3:c=this.data[this._pos+1],l=this.data[this._pos+2],(c&192)===128&&(l&192)===128&&(h=(s&15)<<12|(c&63)<<6|l&63,h>2047&&(h<55296||h>57343)&&(o=h));break;case 4:c=this.data[this._pos+1],l=this.data[this._pos+2],d=this.data[this._pos+3],(c&192)===128&&(l&192)===128&&(d&192)===128&&(h=(s&15)<<18|(c&63)<<12|(l&63)<<6|d&63,h>65535&&h<1114112&&(o=h))}o===null?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|o&1023),t.push(o),this._pos+=a};for(;!this.done();){const s=this.ch();let o;switch(s){case 92:if(this._pos++,this.done())throw new Error(`${Ce} unexpected string termination at position ${this._pos}`);switch(o=this.ch(),this._pos++,o){case 34:case 39:case 92:case 47:t.push(o);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${Ce} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new ne(z.string,jR(t),this._pos-e);default:if(s<32)throw new Error(`${Ce} invalid control character at position ${this._pos}`);s<128?(t.push(s),this._pos++):i()}}throw new Error(`${Ce} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new ne(z.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new ne(z.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new ne(z.null,null,4);case 102:return this.expect([102,97,108,115,101]),new ne(z.false,!1,5);case 116:return this.expect([116,114,117,101]),new ne(z.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${Ce} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this._pos++,this.skipWhitespace(),new ne(z.break,void 0,1);if(this.ch()!==44)throw new Error(`${Ce} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this._pos++,this.skipWhitespace(),new ne(z.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new ne(z.break,void 0,1);if(this.ch()!==44)throw new Error(`${Ce} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this._pos++,this.skipWhitespace(),new ne(z.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${Ce} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${Ce} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}}function Zae(r,e){return e=Object.assign({tokenizer:new rU(r,e)},e),xa(r,e)}function ece(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function dx(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function tce(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var rce=tce,nce=rce;let ice=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},sce=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return nU(this,e)}},oce=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return nU(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function nU(r,e){return new oce({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let ace=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new ice(e,t,n),this.decoder=new sce(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function iU({name:r,prefix:e,encode:t,decode:n}){return new ace(r,e,t,n)}function Wm({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=nce(t,r);return iU({prefix:e,name:r,encode:n,decode:s=>dx(i(s))})}function cce(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function lce(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Qn({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return iU({prefix:e,name:r,encode(i){return lce(i,n,t)},decode(i){return cce(i,n,t,r)}})}const P2=Qn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Qn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Qn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Qn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Qn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Qn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Qn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Qn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Qn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const P8=Wm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Wm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const da=Wm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Wm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var uce=sU,uI=128,dce=-128,hce=Math.pow(2,31);function sU(r,e,t){e=e||[],t=t||0;for(var n=t;r>=hce;)e[t++]=r&255|uI,r/=128;for(;r&dce;)e[t++]=r&255|uI,r>>>=7;return e[t]=r|0,sU.bytes=t-n+1,e}var fce=w7,pce=128,dI=127;function w7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw w7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&dI)<<i:(o&dI)*Math.pow(2,i),i+=7}while(o>=pce);return w7.bytes=s-n,t}var gce=Math.pow(2,7),yce=Math.pow(2,14),mce=Math.pow(2,21),wce=Math.pow(2,28),bce=Math.pow(2,35),vce=Math.pow(2,42),Ece=Math.pow(2,49),xce=Math.pow(2,56),Sce=Math.pow(2,63),Ace=function(r){return r<gce?1:r<yce?2:r<mce?3:r<wce?4:r<bce?5:r<vce?6:r<Ece?7:r<xce?8:r<Sce?9:10},Cce={encode:uce,decode:fce,encodingLength:Ace},oy=Cce;function b7(r,e=0){return[oy.decode(r,e),oy.decode.bytes]}function ay(r,e,t=0){return oy.encode(r,e,t),e}function cy(r){return oy.encodingLength(r)}function kce(r,e){const t=e.byteLength,n=cy(r),i=n+cy(t),s=new Uint8Array(i+t);return ay(r,s,0),ay(t,s,n),s.set(e,i),new hx(r,t,e,s)}function Ice(r){const e=dx(r),[t,n]=b7(e),[i,s]=b7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new hx(t,i,o,e)}function _ce(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&ece(r.bytes,t.bytes)}}let hx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function hI(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return $ce(t,v7(r),e??da.encoder);default:return Pce(t,v7(r),e??P2.encoder)}}const fI=new WeakMap;function v7(r){const e=fI.get(r);if(e==null){const t=new Map;return fI.set(r,t),t}return e}var nD;let oU=class Pr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,nD,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==nf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Dce)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Pr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=kce(e,t);return Pr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Pr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&_ce(e.multihash,n.multihash)}toString(e){return hI(this,e)}toJSON(){return{"/":hI(this)}}link(){return this}[(nD=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Pr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Pr(n,i,s,o??pI(n,i,s.bytes))}else if(t[Nce]===!0){const{version:n,multihash:i,code:s}=t,o=Ice(i);return Pr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==nf)throw new Error(`Version 0 CID must use dag-pb (code: ${nf}) block encoding`);return new Pr(e,t,n,n.bytes)}case 1:{const i=pI(e,t,n.bytes);return new Pr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Pr.create(0,nf,e)}static createV1(e,t){return Pr.create(1,e,t)}static decode(e){const[t,n]=Pr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Pr.inspectBytes(e),n=t.size-t.multihashSize,i=dx(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new hx(t.multihashCode,t.digestSize,s,i);return[t.version===0?Pr.createV0(o):Pr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=b7(e.subarray(t));return t+=p,h};let i=n(),s=nf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Tce(e,t),s=Pr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return v7(s).set(n,e),s}};function Tce(r,e){switch(r[0]){case"Q":{const t=e??da;return[da.prefix,t.decode(`${da.prefix}${r}`)]}case da.prefix:{const t=e??da;return[da.prefix,t.decode(r)]}case P2.prefix:{const t=e??P2;return[P2.prefix,t.decode(r)]}case P8.prefix:{const t=e??P8;return[P8.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function $ce(r,e,t){const{prefix:n}=t;if(n!==da.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Pce(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const nf=112,Dce=18;function pI(r,e,t){const n=cy(r),i=n+cy(e),s=new Uint8Array(i+t.byteLength);return ay(r,s,0),ay(e,s,n),s.set(t,i),s}const Nce=Symbol.for("@ipld/js-cid/CID"),aU=Qn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Qn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});Qn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});Qn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function Oce(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function Rce(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=oU.asCID(r);if(!e)return null;const t=e.toString();return[new ne(z.map,1/0,1),new ne(z.string,"/",1),new ne(z.string,t,t.length),new ne(z.break,void 0,1)]}function ly(r){const e=aU.encode(r).slice(1);return[new ne(z.map,1/0,1),new ne(z.string,"/",1),new ne(z.map,1/0,1),new ne(z.string,"bytes",5),new ne(z.string,e,e.length),new ne(z.break,void 0,1),new ne(z.break,void 0,1)]}function _i(r){return ly(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}function Bce(r){return ly(new Uint8Array(r))}function Lce(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function Mce(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const Uce={typeEncoders:{Object:Rce,Buffer:ly,Uint8Array:ly,Int8Array:_i,Uint16Array:_i,Int16Array:_i,Uint32Array:_i,Int32Array:_i,Float32Array:_i,Float64Array:_i,Uint8ClampedArray:_i,BigInt64Array:_i,BigUint64Array:_i,DataView:_i,ArrayBuffer:Bce,undefined:Lce,number:Mce}};class Fce extends rU{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(e.type===z.map){const t=this._next();if(t.type===z.string&&t.value==="/"){const n=this._next();if(n.type===z.string){if(this._next().type!==z.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new ne(z.tag,42,0)}if(n.type===z.map){const i=this._next();if(i.type===z.string&&i.value==="bytes"){const s=this._next();if(s.type===z.string){for(let a=0;a<2;a++)if(this._next().type!==z.break)throw new Error("Invalid encoded Bytes form");const o=aU.decode(`m${s.value}`);return new ne(z.bytes,o,s.value.length)}this.tokenBuffer.push(s)}this.tokenBuffer.push(i)}this.tokenBuffer.push(n)}this.tokenBuffer.push(t)}return e}}const E7={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};E7.tags[42]=oU.parse;const zce="dag-json",cU=297,lU=r=>Xae(r,Uce),uU=r=>{const e=Oce(r),t=Object.assign(E7,{tokenizer:new Fce(e,E7)});return Zae(e,t)},gI=r=>Vce.decode(lU(r)),Vce=new TextDecoder,Kce=r=>uU(jce.encode(r)),jce=new TextEncoder,Hce=Object.freeze(Object.defineProperty({__proto__:null,code:cU,decode:uU,encode:lU,format:gI,name:zce,parse:Kce,stringify:gI},Symbol.toStringTag,{value:"Module"}));function qce(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function fx(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Wce(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var Gce=Wce,Qce=Gce;let Yce=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Jce=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return dU(this,e)}},Xce=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return dU(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function dU(r,e){return new Xce({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Zce=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Yce(e,t,n),this.decoder=new Jce(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function hU({name:r,prefix:e,encode:t,decode:n}){return new Zce(r,e,t,n)}function Gm({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Qce(t,r);return hU({prefix:e,name:r,encode:n,decode:s=>fx(i(s))})}function ele(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function tle(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Do({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return hU({prefix:e,name:r,encode(i){return tle(i,n,t)},decode(i){return ele(i,n,t,r)}})}const D2=Do({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Do({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Do({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Do({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Do({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Do({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Do({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Do({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Do({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const D8=Gm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Gm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const ha=Gm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Gm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var rle=fU,yI=128,nle=-128,ile=Math.pow(2,31);function fU(r,e,t){e=e||[],t=t||0;for(var n=t;r>=ile;)e[t++]=r&255|yI,r/=128;for(;r&nle;)e[t++]=r&255|yI,r>>>=7;return e[t]=r|0,fU.bytes=t-n+1,e}var sle=x7,ole=128,mI=127;function x7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw x7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&mI)<<i:(o&mI)*Math.pow(2,i),i+=7}while(o>=ole);return x7.bytes=s-n,t}var ale=Math.pow(2,7),cle=Math.pow(2,14),lle=Math.pow(2,21),ule=Math.pow(2,28),dle=Math.pow(2,35),hle=Math.pow(2,42),fle=Math.pow(2,49),ple=Math.pow(2,56),gle=Math.pow(2,63),yle=function(r){return r<ale?1:r<cle?2:r<lle?3:r<ule?4:r<dle?5:r<hle?6:r<fle?7:r<ple?8:r<gle?9:10},mle={encode:rle,decode:sle,encodingLength:yle},uy=mle;function S7(r,e=0){return[uy.decode(r,e),uy.decode.bytes]}function dy(r,e,t=0){return uy.encode(r,e,t),e}function hy(r){return uy.encodingLength(r)}function wle(r,e){const t=e.byteLength,n=hy(r),i=n+hy(t),s=new Uint8Array(i+t);return dy(r,s,0),dy(t,s,n),s.set(e,i),new px(r,t,e,s)}function ble(r){const e=fx(r),[t,n]=S7(e),[i,s]=S7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new px(t,i,o,e)}function vle(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&qce(r.bytes,t.bytes)}}let px=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function wI(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return xle(t,A7(r),e??ha.encoder);default:return Sle(t,A7(r),e??D2.encoder)}}const bI=new WeakMap;function A7(r){const e=bI.get(r);if(e==null){const t=new Map;return bI.set(r,t),t}return e}var iD;let Sf=class Dr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,iD,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==sf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Ale)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Dr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=wle(e,t);return Dr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Dr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&vle(e.multihash,n.multihash)}toString(e){return wI(this,e)}toJSON(){return{"/":wI(this)}}link(){return this}[(iD=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Dr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Dr(n,i,s,o??vI(n,i,s.bytes))}else if(t[Cle]===!0){const{version:n,multihash:i,code:s}=t,o=ble(i);return Dr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==sf)throw new Error(`Version 0 CID must use dag-pb (code: ${sf}) block encoding`);return new Dr(e,t,n,n.bytes)}case 1:{const i=vI(e,t,n.bytes);return new Dr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Dr.create(0,sf,e)}static createV1(e,t){return Dr.create(1,e,t)}static decode(e){const[t,n]=Dr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Dr.inspectBytes(e),n=t.size-t.multihashSize,i=fx(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new px(t.multihashCode,t.digestSize,s,i);return[t.version===0?Dr.createV0(o):Dr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=S7(e.subarray(t));return t+=p,h};let i=n(),s=sf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Ele(e,t),s=Dr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return A7(s).set(n,e),s}};function Ele(r,e){switch(r[0]){case"Q":{const t=e??ha;return[ha.prefix,t.decode(`${ha.prefix}${r}`)]}case ha.prefix:{const t=e??ha;return[ha.prefix,t.decode(r)]}case D2.prefix:{const t=e??D2;return[D2.prefix,t.decode(r)]}case D8.prefix:{const t=e??D8;return[D8.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function xle(r,e,t){const{prefix:n}=t;if(n!==ha.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Sle(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const sf=112,Ale=18;function vI(r,e,t){const n=hy(r),i=n+hy(e),s=new Uint8Array(i+t.byteLength);return dy(r,s,0),dy(e,s,n),s.set(t,i),s}const Cle=Symbol.for("@ipld/js-cid/CID"),kle=new TextDecoder;function gx(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");const i=r[e++];if(t+=n<28?(i&127)<<n:(i&127)*2**n,i<128)break}return[t,e]}function fy(r,e){let t;[t,e]=gx(r,e);const n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function pU(r,e){let t;return[t,e]=gx(r,e),[t&7,t>>3,e]}function Ile(r){const e={},t=r.length;let n=0;for(;n<t;){let i,s;if([i,s,n]=pU(r,n),s===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=fy(r,n)}else if(s===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=fy(r,n),e.Name=kle.decode(o)}else if(s===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(i!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Tsize`);[e.Tsize,n]=gx(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${s}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function _le(r){const e=r.length;let t=0,n,i=!1,s;for(;t<e;){let a,c;if([a,c,t]=pU(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(s)throw new Error("protobuf: (PBNode) duplicate Data section");[s,t]=fy(r,t),n&&(i=!0)}else if(c===2){if(i)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let l;[l,t]=fy(r,t),n.push(Ile(l))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");const o={};return s&&(o.Data=s),o.Links=n||[],o}const gU=new TextEncoder,EI=2**32,Tle=2**31;function $le(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=Ff(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){const n=gU.encode(r.Name);t-=n.length,e.set(n,t),t=Ff(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=Ff(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function Ple(r){const e=Nle(r),t=new Uint8Array(e);let n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=Ff(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let i=r.Links.length-1;i>=0;i--){const s=$le(r.Links[i],t.subarray(0,n));n-=s,n=Ff(t,n,s)-1,t[n]=18}return t}function Dle(r){let e=0;if(r.Hash){const t=r.Hash.length;e+=1+t+ed(t)}if(typeof r.Name=="string"){const t=gU.encode(r.Name).length;e+=1+t+ed(t)}return typeof r.Tsize=="number"&&(e+=1+ed(r.Tsize)),e}function Nle(r){let e=0;if(r.Data){const t=r.Data.length;e+=1+t+ed(t)}if(r.Links)for(const t of r.Links){const n=Dle(t);e+=1+n+ed(n)}return e}function Ff(r,e,t){e-=ed(t);const n=e;for(;t>=Tle;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function ed(r){return r%2===0&&r++,Math.floor((Ole(r)+6)/7)}function Ole(r){let e=0;return r>=EI&&(r=Math.floor(r/EI),e=32),r>=65536&&(r>>>=16,e+=16),r>=256&&(r>>>=8,e+=8),e+Rle[r]}const Rle=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],Ble=["Data","Links"],Lle=["Hash","Name","Tsize"],C7=new TextEncoder;function yU(r,e){if(r===e)return 0;const t=r.Name?C7.encode(r.Name):[],n=e.Name?C7.encode(e.Name):[];let i=t.length,s=n.length;for(let o=0,a=Math.min(i,s);o<a;++o)if(t[o]!==n[o]){i=t[o],s=n[o];break}return i<s?-1:s<i?1:0}function xI(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function mU(r){if(typeof r.asCID=="object"){const t=Sf.asCID(r);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Hash){let t=Sf.asCID(r.Hash);try{t||(typeof r.Hash=="string"?t=Sf.parse(r.Hash):r.Hash instanceof Uint8Array&&(t=Sf.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(e.Name=r.Name),typeof r.Tsize=="number"&&(e.Tsize=r.Tsize),e}function wU(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Data!==void 0)if(typeof r.Data=="string")e.Data=C7.encode(r.Data);else if(r.Data instanceof Uint8Array)e.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))e.Links=r.Links.map(mU),e.Links.sort(yU);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function bU(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!xI(r,Ble))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<r.Links.length;e++){const t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!xI(t,Lle))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash==null||!t.Hash["/"]||t.Hash["/"]!==t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0){if(typeof t.Tsize!="number"||t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&yU(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function Mle(r,e=[]){return wU({Data:r,Links:e})}function Ule(r,e,t){return mU({Hash:t,Name:r,Tsize:e})}function Fle(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}const zle="dag-pb",vU=112;function Vle(r){bU(r);const e={};return r.Links&&(e.Links=r.Links.map(t=>{const n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),Ple(e)}function Kle(r){const e=Fle(r),t=_le(e),n={};return t.Data&&(n.Data=t.Data),t.Links&&(n.Links=t.Links.map(i=>{const s={};try{s.Hash=Sf.decode(i.Hash)}catch{}if(!s.Hash)throw new Error("Invalid Hash field found in link, expected CID");return i.Name!==void 0&&(s.Name=i.Name),i.Tsize!==void 0&&(s.Tsize=i.Tsize),s})),n}const jle=Object.freeze(Object.defineProperty({__proto__:null,code:vU,createLink:Ule,createNode:Mle,decode:Kle,encode:Vle,name:zle,prepare:wU,validate:bU},Symbol.toStringTag,{value:"Module"})),Hle=new TextEncoder,qle=new TextDecoder,Wle="json",EU=512;function Gle(r){return Hle.encode(JSON.stringify(r))}function Qle(r){return JSON.parse(qle.decode(r))}const Yle=Object.freeze(Object.defineProperty({__proto__:null,code:EU,decode:Qle,encode:Gle,name:Wle},Symbol.toStringTag,{value:"Module"})),Jle="raw",xU=85;function Xle(r){return yh(r)}function Zle(r){return yh(r)}const eue=Object.freeze(Object.defineProperty({__proto__:null,code:xU,decode:Zle,encode:Xle,name:Jle},Symbol.toStringTag,{value:"Module"}));function yx(r){return(r==null?void 0:r.then)!=null}function tue(r=[],e){const t={[vU]:jle,[xU]:eue,[oB]:h0,[cU]:Hce,[EU]:Yle};return r.forEach(n=>{t[n.code]=n}),async n=>{let i=t[n];if(i==null&&e!=null){const s=e(n);yx(s)?i=await s:i=s,t[i.code]=i}if(i!=null)return i;throw new tU(`Could not load codec for ${n}`)}}const SU=0,rue="identity",AU=yh;function nue(r){return sy(SU,AU(r))}const SI={code:SU,name:rue,encode:AU,digest:nue};function CU(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const AI=JM({name:"sha2-256",code:18,encode:CU("SHA-256")}),CI=JM({name:"sha2-512",code:19,encode:CU("SHA-512")});function iue(r=[],e){const t={[AI.code]:AI,[CI.code]:CI,[SI.code]:SI};return r.forEach(n=>{t[n.code]=n}),async n=>{let i=t[n];if(i==null&&e!=null){const s=e(n);yx(s)?i=await s:i=s,t[i.code]=i}if(i!=null)return i;throw new eU(`No hasher configured for multihash code 0x${n.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)}}const Fu=class Fu extends Error{constructor(t="Not Found"){super(t);u(this,"name",Fu.name);u(this,"code",Fu.code)}};u(Fu,"name","NotFoundError"),u(Fu,"code","ERR_NOT_FOUND");let $1=Fu;class kU{has(e,t){return Promise.reject(new Error(".has is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}async*putMany(e,t){for await(const{cid:n,block:i}of e)await this.put(n,i,t),yield n}get(e,t){return Promise.reject(new Error(".get is not implemented"))}async*getMany(e,t){for await(const n of e)yield{cid:n,block:await this.get(n,t)}}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(e,t){for await(const n of e)await this.delete(n,t),yield n}async*getAll(e){throw new Error(".getAll is not implemented")}}const Lp=0;class sue extends kU{constructor(t){super();u(this,"child");this.child=t}put(t,n){return t.multihash.code===Lp||this.child==null?t:this.child.put(t,n)}get(t){if(t.multihash.code===Lp)return t.multihash.digest;if(this.child==null)throw new $1;return this.child.get(t)}has(t){return t.multihash.code===Lp?!0:this.child==null?!1:this.child.has(t)}delete(t){if(t.code!==Lp&&this.child!=null)return this.child.delete(t)}getAll(t){return this.child!=null?this.child.getAll(t):[]}}function oue(r){return r[Symbol.asyncIterator]!=null}function Fc(r,e){let t=0;if(oue(r))return async function*(){for await(const c of r)await e(c,t++)&&(yield c)}();const n=ZE(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof o.then=="function")return async function*(){await o&&(yield i);for await(const c of n)await e(c,t++)&&(yield c)}();const a=e;return function*(){o===!0&&(yield i);for(const c of n)a(c,t++)&&(yield c)}()}function aue(r){return r[Symbol.asyncIterator]!=null}function kI(r){return(r==null?void 0:r.then)!=null}function py(r,e){let t=0;if(aue(r))return async function*(){for await(const c of r){const l=e(c,t++);kI(l)&&await l,yield c}}();const n=ZE(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof(o==null?void 0:o.then)=="function")return async function*(){yield i;for await(const c of n){const l=e(c,t++);kI(l)&&await l,yield c}}();const a=e;return function*(){yield i;for(const c of n)a(c,t++),yield c}()}class IU{constructor(e){u(this,"child");u(this,"getHasher");u(this,"log");u(this,"logger");u(this,"components");this.log=e.logger.forComponent("helia:networked-storage"),this.logger=e.logger,this.components=e,this.child=new sue(e.blockstore),this.getHasher=e.getHasher}async put(e,t,n={}){var i,s,o;return await this.child.has(e,n)?((i=n.onProgress)==null||i.call(n,new ke("blocks:put:duplicate",e)),e):((s=n.onProgress)==null||s.call(n,new ke("blocks:put:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async a=>{var c;return(c=a.announce)==null?void 0:c.call(a,e,t,n)})),(o=n.onProgress)==null||o.call(n,new ke("blocks:put:blockstore:put",e)),this.child.put(e,t,n))}async*putMany(e,t={}){var s;const n=Fc(e,async({cid:o})=>{var c;const a=await this.child.has(o,t);return a&&((c=t.onProgress)==null||c.call(t,new ke("blocks:put-many:duplicate",o))),!a}),i=py(n,async({cid:o,block:a})=>{var c;(c=t.onProgress)==null||c.call(t,new ke("blocks:put-many:providers:notify",o)),await Promise.all(this.components.blockBrokers.map(async l=>{var d;return(d=l.announce)==null?void 0:d.call(l,o,a,t)}))});(s=t.onProgress)==null||s.call(t,new ke("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(i,t)}async get(e,t={}){var n,i,s,o;if(t.offline!==!0&&!await this.child.has(e,t)){const a=await this.getHasher(e.multihash.code);(n=t.onProgress)==null||n.call(t,new ke("blocks:get:providers:get",e));const c=await II(e,this.components.blockBrokers,a,{...t,log:this.log});return(i=t.onProgress)==null||i.call(t,new ke("blocks:get:blockstore:put",e)),await this.child.put(e,c,t),(s=t.onProgress)==null||s.call(t,new ke("blocks:get:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async l=>{var d;return(d=l.announce)==null?void 0:d.call(l,e,c,t)})),c}return(o=t.onProgress)==null||o.call(t,new ke("blocks:get:blockstore:get",e)),this.child.get(e,t)}async*getMany(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new ke("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(py(e,async i=>{var s,o,a;if(t.offline!==!0&&!await this.child.has(i,t)){const c=await this.getHasher(i.multihash.code);(s=t.onProgress)==null||s.call(t,new ke("blocks:get-many:providers:get",i));const l=await II(i,this.components.blockBrokers,c,{...t,log:this.log});(o=t.onProgress)==null||o.call(t,new ke("blocks:get-many:blockstore:put",i)),await this.child.put(i,l,t),(a=t.onProgress)==null||a.call(t,new ke("blocks:get-many:providers:notify",i)),await Promise.all(this.components.blockBrokers.map(async d=>{var h;return(h=d.announce)==null?void 0:h.call(d,i,l,t)}))}}))}async delete(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new ke("blocks:delete:blockstore:delete",e)),await this.child.delete(e,t)}async*deleteMany(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new ke("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(const i of e)yield i}(),t)}async has(e,t={}){return this.child.has(e,t)}async*getAll(e={}){var t;(t=e.onProgress)==null||t.call(e,new ke("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(e)}}class cue extends IU{constructor(t){super(t);u(this,"started");this.started=!1}isStarted(){return this.started}async start(){await Eo(this.child,...this.components.blockBrokers),this.started=!0}async stop(){await mc(this.child,...this.components.blockBrokers),this.started=!1}unwrap(){return this.child}createSession(t,n){const i=this.components.blockBrokers.map(s=>s.createSession==null?s:s.createSession(n));return new lue({blockstore:this.child,blockBrokers:i,getHasher:this.getHasher,logger:this.logger},{root:t})}}class lue extends IU{constructor(t,n){super(t);u(this,"closeController");this.closeController=new AbortController,this.closeController.signal,this.log=t.logger.forComponent(`helia:session-storage:${n.root}`)}close(){this.closeController.abort()}async put(t,n,i={}){const s=ct([this.closeController.signal,i.signal]);try{return await super.put(t,n,{...i,signal:s})}finally{s.clear()}}async*putMany(t,n={}){const i=ct([this.closeController.signal,n.signal]);try{yield*super.putMany(t,{...n,signal:i})}finally{i.clear()}}async get(t,n={}){const i=ct([this.closeController.signal,n.signal]);try{return await super.get(t,{...n,signal:i})}finally{i.clear()}}async*getMany(t,n={}){const i=ct([this.closeController.signal,n.signal]);try{yield*super.getMany(t,{...n,signal:i})}finally{i.clear()}}async delete(t,n={}){const i=ct([this.closeController.signal,n.signal]);try{await super.delete(t,{...n,signal:i})}finally{i.clear()}}async*deleteMany(t,n={}){const i=ct([this.closeController.signal,n.signal]);try{yield*super.deleteMany(t,{...n,signal:i})}finally{i.clear()}}async has(t,n={}){const i=ct([this.closeController.signal,n.signal]);try{return await super.has(t,{...n,signal:i})}finally{i.clear()}}async*getAll(t={}){const n=ct([this.closeController.signal,t.signal]);try{yield*super.getAll({...t,signal:n})}finally{n.clear()}}}function uue(r){return typeof r.retrieve=="function"}const due=(r,e)=>{if(e==null)throw new Z(`No hasher configured for multihash code 0x${r.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`);return async t=>{let n;const i=e.digest(t);if(yx(i)?n=await i:n=i,!Fe(n.digest,r.multihash.digest))throw new Im("Hash of downloaded block did not match multihash from passed CID")}};async function II(r,e,t,n){const i=due(r,t),s=new AbortController,o=ct([s.signal,n.signal]);s.signal;const a=[];for(const c of e)uue(c)&&a.push(c);try{return await Promise.any(a.map(async c=>{try{let l=!1;const d=await c.retrieve(r,{...n,signal:o,validateFn:async h=>{await i(h),l=!0}});return l||await i(d),d}catch(l){throw n.log.error("could not retrieve verified block for %c",r,l),l}}))}finally{s.abort(),o.clear()}}const hue=Gn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Gn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});Gn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});Gn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});class _U extends Gt{constructor(t,n){super();u(this,"initialPeerSearchComplete");u(this,"requests");u(this,"name");u(this,"log");u(this,"logger");u(this,"minProviders");u(this,"maxProviders");u(this,"providers");u(this,"evictionFilter");this.name=n.name,this.logger=t.logger,this.log=t.logger.forComponent(this.name),this.requests=new Map,this.minProviders=n.minProviders??Mae,this.maxProviders=n.maxProviders??Uae,this.providers=[],this.evictionFilter=Tl(this.maxProviders)}async retrieve(t,n={}){const i=hue.encode(t.multihash.bytes),s=this.requests.get(i);if(s!=null)return this.log("join existing request for %c",t),s;const o=De();if(this.requests.set(i,o.promise),this.providers.length===0){let d=!1;this.initialPeerSearchComplete==null&&(d=!0,this.log=this.logger.forComponent(`${this.name}:${t}`),this.initialPeerSearchComplete=this.findProviders(t,this.minProviders,n)),await this.initialPeerSearchComplete,d&&this.log("found initial session peers for %c",t)}let a=!1;const c=new _l({concurrency:this.maxProviders});c.addEventListener("error",()=>{}),c.addEventListener("failure",d=>{this.log.error("error querying provider %o, evicting from session",d.detail.job.options.provider,d.detail.error),this.evict(d.detail.job.options.provider)}),c.addEventListener("success",d=>{a=!0,o.resolve(d.detail.result)}),c.addEventListener("idle",()=>{var d;a||((d=n.signal)==null?void 0:d.aborted)===!0||Promise.resolve().then(async()=>{this.log("no session peers had block for for %c, finding new providers",t);for(let h=0;h<this.minProviders&&this.providers.length!==0;h++){const p=this.providers[Math.floor(Math.random()*this.providers.length)];this.evict(p)}await this.findProviders(t,this.minProviders,n),this.log("found new providers re-retrieving %c",t),this.requests.delete(i),o.resolve(await this.retrieve(t,n))}).catch(h=>{this.log.error("could not find new providers for %c",t,h),o.reject(h)})});const l=d=>{c.add(async()=>this.queryProvider(t,d.detail,n),{provider:d.detail}).catch(h=>{var p;((p=n.signal)==null?void 0:p.aborted)!==!0&&this.log.error("error retrieving session block for %c",t,h)})};this.addEventListener("provider",l),Promise.all([...this.providers].map(async d=>c.add(async()=>this.queryProvider(t,d,n),{provider:d}))).catch(d=>{var h;((h=n.signal)==null?void 0:h.aborted)!==!0&&this.log.error("error retrieving session block for %c",t,d)});try{return await o.promise}finally{this.removeEventListener("provider",l),c.clear(),this.requests.delete(i)}}evict(t){this.evictionFilter.add(this.toEvictionKey(t));const n=this.providers.findIndex(i=>this.equals(i,t));n!==-1&&this.providers.splice(n,1)}isEvicted(t){return this.evictionFilter.has(this.toEvictionKey(t))}hasProvider(t){return!!(this.providers.find(n=>this.equals(n,t))!=null||this.isEvicted(t))}async findProviders(t,n,i){const s=De();let o=0;return Promise.resolve().then(async()=>{var a;this.log("finding %d-%d new provider(s) for %c",n,this.maxProviders,t);for await(const c of this.findNewProviders(t,i)){if(o===this.maxProviders||((a=i.signal)==null?void 0:a.aborted)===!0)break;if(!this.hasProvider(c)&&(this.log("found %d/%d new providers",o,this.maxProviders),this.providers.push(c),this.safeDispatchEvent("provider",{detail:c}),o++,o===n&&(this.log("session is ready"),s.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",o);break}}if(this.log("found %d/%d new session peers",o,this.maxProviders),o<n)throw new ZM(`Found ${o} of ${n} ${this.name} providers for ${t}`)}).catch(a=>{this.log.error("error searching routing for potential session peers for %c",t,a.errors??a),s.reject(a)}),s.promise}}class fue{constructor(e){u(this,"blockstore");u(this,"datastore");u(this,"pins");u(this,"logger");u(this,"routing");u(this,"getCodec");u(this,"getHasher");u(this,"dns");u(this,"metrics");u(this,"log");this.logger=e.logger??Hm(),this.log=this.logger.forComponent("helia"),this.getHasher=iue(e.hashers,e.loadHasher),this.getCodec=tue(e.codecs,e.loadCodec),this.dns=e.dns??qM(),this.metrics=e.metrics;const t={blockstore:e.blockstore,datastore:e.datastore,logger:this.logger,blockBrokers:[],getHasher:this.getHasher,getCodec:this.getCodec,dns:this.dns,metrics:this.metrics,...e.components??{}};this.routing=t.routing=new zae(t,{routers:(e.routers??[]).flatMap(i=>{const s=[i];return i[Sd]!=null&&s.push(i[Sd]),i[Ad]!=null&&s.push(i[Ad]),s}),providerLookupConcurrency:e.providerLookupConcurrency});const n=new cue(t);this.pins=new Lae(e.datastore,n,this.getCodec),this.blockstore=new Wae(n,this.pins,{holdGcLock:e.holdGcLock??!0}),this.datastore=e.datastore,t.blockBrokers=e.blockBrokers.map(i=>i(t))}async start(){await Gae(this.datastore),await Eo(this.blockstore,this.datastore,this.routing)}async stop(){await mc(this.blockstore,this.datastore,this.routing)}async gc(e={}){const t=await this.blockstore.lock.writeLock();try{const n=this,i=this.blockstore.unwrap();this.log("gc start"),await vo(i.deleteMany(async function*(){var s,o;for await(const{cid:a}of i.getAll())try{if(await n.pins.isPinned(a,e))continue;yield a,(s=e.onProgress)==null||s.call(e,new ke("helia:gc:deleted",a))}catch(c){n.log.error("Error during gc",c),(o=e.onProgress)==null||o.call(e,new ke("helia:gc:error",c))}}()))}finally{t()}this.log("gc finished")}}class pue extends _U{constructor(t,n){super(t,{...n,name:"helia:bitswap:session"});u(this,"wantList");u(this,"network");this.wantList=t.wantList,this.network=t.network}async queryProvider(t,n,i){this.log("sending WANT-BLOCK for %c to %p",t,n);const s=await this.wantList.wantSessionBlock(t,n,i);if(this.log("%p %s %c",n,s.has?"has":"does not have",t),s.has&&s.block!=null)return s.block;throw new Error("Provider did not have block")}async*findNewProviders(t,n={}){for await(const i of this.network.findProviders(t,n))yield i.id}toEvictionKey(t){return t.toMultihash().bytes}equals(t,n){return t.equals(n)}}function gue(r,e){return new pue(r,e)}class yue{constructor(e){u(this,"blocksReceived");u(this,"duplicateBlocksReceived");u(this,"dataReceived");u(this,"duplicateDataReceived");var t,n,i,s;this.blocksReceived=(t=e.metrics)==null?void 0:t.registerMetricGroup("helia_bitswap_received_blocks"),this.duplicateBlocksReceived=(n=e.metrics)==null?void 0:n.registerMetricGroup("helia_bitswap_duplicate_received_blocks"),this.dataReceived=(i=e.metrics)==null?void 0:i.registerMetricGroup("helia_bitswap_data_received_bytes"),this.duplicateDataReceived=(s=e.metrics)==null?void 0:s.registerMetricGroup("helia_bitswap_duplicate_data_received_bytes")}updateBlocksReceived(e=1,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.blocksReceived)==null||i.increment(n)}updateDuplicateBlocksReceived(e=1,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.duplicateBlocksReceived)==null||i.increment(n)}updateDataReceived(e,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.dataReceived)==null||i.increment(n)}updateDuplicateDataReceived(e,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.duplicateDataReceived)==null||i.increment(n)}}class mue extends Map{constructor(t){super();u(this,"metric");const{name:n,metrics:i}=t;this.metric=i.registerMetric(n),this.updateComponentMetric()}set(t,n){return super.set(t,n),this.updateComponentMetric(),this}delete(t){const n=super.delete(t);return this.updateComponentMetric(),n}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function TU(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new mue({name:e,metrics:t}):n=new Map,n}function wue({name:r,code:e,encode:t}){return new bue(r,e,t)}let bue=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?c7(this.code,t):t.then(n=>c7(this.code,n))}else throw Error("Unknown type, must be binary type")}};function vue(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const _I=wue({name:"sha2-256",code:18,encode:vue("SHA-256")});function Eue(r){if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");const e=[];for(;r.length>0;){const t=Ns(r);e.push(t),r=r.slice(mt(t))}return e}class xue extends Gt{constructor(t,n={}){super();u(this,"peers");u(this,"wants");u(this,"network");u(this,"log");u(this,"sendMessagesDelay");u(this,"sendMessagesTimeout");u(this,"hashLoader");u(this,"sendingMessages");this.peers=RM({name:"helia_bitswap_peers",metrics:t.metrics}),this.wants=TU({name:"helia_bitswap_wantlist",metrics:t.metrics}),this.network=t.network,this.sendMessagesDelay=n.sendMessagesDelay??Rne,this.log=t.logger.forComponent("helia:bitswap:wantlist"),this.hashLoader=n.hashLoader,this.network.addEventListener("bitswap:message",i=>{this.receiveMessage(i.detail.peer,i.detail.message).catch(s=>{this.log.error("error receiving bitswap message from %p",i.detail.peer,s)})}),this.network.addEventListener("peer:connected",i=>{this.peerConnected(i.detail).catch(s=>{this.log.error("error processing newly connected bitswap peer %p",i.detail,s)})}),this.network.addEventListener("peer:disconnected",i=>{this.peerDisconnected(i.detail)})}async addEntry(t,n){var o;const i=re(t.multihash.bytes,"base64");let s=this.wants.get(i);s==null&&(s={cid:t,priority:n.priority??1,wantType:n.wantType??Zt.WantBlock,cancel:!1,sendDontHave:!0},this.wants.set(i,s)),s.wantType===Zt.WantHave&&n.wantType===Zt.WantBlock&&(s.wantType=Zt.WantBlock),await this.sendMessagesDebounced();try{return n.wantType===Zt.WantBlock?(await di(this,"block",n==null?void 0:n.signal,{filter:l=>Fe(t.multihash.digest,l.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail:(await di(this,"presence",n==null?void 0:n.signal,{filter:c=>Fe(t.multihash.digest,c.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail}finally{((o=n.signal)==null?void 0:o.aborted)===!0&&(this.log("want for %c was aborted, cancelling want",t),s.cancel=!0,await this.sendMessagesDebounced())}}async sendMessagesDebounced(){var t;await((t=this.sendingMessages)==null?void 0:t.promise),clearTimeout(this.sendMessagesTimeout),this.sendMessagesTimeout=setTimeout(()=>{this.sendMessages().catch(n=>{this.log("error sending messages to peers",n)})},this.sendMessagesDelay)}async sendMessages(){this.sendingMessages=De(),await Promise.all([...this.peers.entries()].map(async([t,n])=>{const i=new Set,s=new Ef;for(const[o,a]of this.wants.entries())n.has(o)||a.cancel||(i.add(o),s.addWantlistEntry(a.cid,{cid:a.cid.bytes,priority:a.priority,wantType:a.wantType,cancel:a.cancel,sendDontHave:a.sendDontHave}));if(s.wantlist.size!==0)try{await this.network.sendMessage(t,s);for(const o of i)n.add(o)}catch(o){this.log.error("error sending full wantlist to new peer",o)}})).catch(t=>{this.log.error("error sending messages",t)});for(const[t,n]of this.wants)if(n.cancel){this.wants.delete(t);for(const i of this.peers.values())i.delete(t)}this.sendingMessages.resolve()}has(t){const n=re(t.multihash.bytes,"base64");return this.wants.has(n)}async wantSessionPresence(t,n,i={}){const s=new Ef;return s.addWantlistEntry(t,{cid:t.bytes,sendDontHave:!0,wantType:Zt.WantHave,priority:1}),await this.network.sendMessage(n,s),(await di(this,"presence",i.signal,{filter:a=>n.equals(a.detail.sender)&&Fe(t.multihash.digest,a.detail.cid.multihash.digest)})).detail}async wantBlock(t,n={}){return this.addEntry(t,{...n,wantType:Zt.WantBlock})}async wantSessionBlock(t,n,i={}){const s=new Ef;return s.addWantlistEntry(t,{cid:t.bytes,sendDontHave:!0,wantType:Zt.WantBlock,priority:1}),await this.network.sendMessage(n,s),(await di(this,"presence",i.signal,{filter:a=>n.equals(a.detail.sender)&&Fe(t.multihash.digest,a.detail.cid.multihash.digest)})).detail}async receivedBlock(t,n){const i=re(t.multihash.bytes,"base64"),s=this.wants.get(i);s!=null&&(s.cancel=!0,await this.sendMessagesDebounced())}async receiveMessage(t,n){var s;this.log("received message from %p with %d blocks",t,n.blocks.length);let i=!1;for(const o of n.blocks){if(o.prefix==null||o.data==null)continue;const a=Eue(o.prefix),c=a[0],l=a[1],d=a[2],h=d===_I.code?_I:await((s=this.hashLoader)==null?void 0:s.getHasher(d));if(h==null){this.log.error("unknown hash algorithm",d);continue}let p=h.digest(o.data);p.then!=null&&(p=await p);const b=u7.create(c===0?0:1,l,p);this.log("received block from %p for %c",t,b),this.safeDispatchEvent("block",{detail:{sender:t,cid:b,block:o.data}}),this.safeDispatchEvent("presence",{detail:{sender:t,cid:b,has:!0,block:o.data}});const f=re(b.multihash.bytes,"base64"),g=this.wants.get(f);g!=null&&(g.cancel=!0,i=!0)}for(const{cid:o,type:a}of n.blockPresences){const c=u7.decode(o);this.log("received %s from %p for %c",a,t,c),this.safeDispatchEvent("presence",{detail:{sender:t,cid:c,has:a===As.HaveBlock}})}i&&await this.sendMessagesDebounced()}async peerConnected(t){const n=new Set,i=new Ef(!0);for(const[s,o]of this.wants.entries())o.cancel||(n.add(s),i.addWantlistEntry(o.cid,{cid:o.cid.bytes,priority:1,wantType:Zt.WantBlock,cancel:!1,sendDontHave:!1}));if(i.wantlist.size===0){this.peers.set(t,n);return}try{await this.network.sendMessage(t,i),this.peers.set(t,n)}catch(s){this.log.error("error sending full wantlist to new peer %p",t,s)}}peerDisconnected(t){this.peers.delete(t)}start(){}stop(){this.peers.clear(),clearTimeout(this.sendMessagesTimeout)}}class Sue{constructor(e,t={}){u(this,"log");u(this,"logger");u(this,"stats");u(this,"network");u(this,"blockstore");u(this,"peerWantLists");u(this,"wantList");this.logger=e.logger,this.log=e.logger.forComponent("helia:bitswap"),this.blockstore=e.blockstore,this.stats=new yue(e),this.network=new Wne(e,t),this.peerWantLists=new uoe({...e,network:this.network},t),this.wantList=new xue({...e,network:this.network},t)}createSession(e={}){return gue({wantList:this.wantList,network:this.network,logger:this.logger},e)}async want(e,t={}){const n=new AbortController,i=ct([n.signal,t.signal]);n.signal,this.network.findAndConnect(e,{...t,signal:i}).catch(s=>{n.signal.aborted||this.log.error("error during finding and connect for cid %c",e,s)});try{return(await this.wantList.wantBlock(e,{...t,signal:i})).block}finally{n.abort(),i.clear()}}async notify(e,t,n={}){await Promise.all([this.peerWantLists.receivedBlock(e,n),this.wantList.receivedBlock(e,n)])}getWantlist(){return[...this.wantList.wants.values()].filter(e=>!e.cancel).map(e=>({cid:e.cid,priority:e.priority,wantType:e.wantType}))}getPeerWantlist(e){return this.peerWantLists.wantListForPeer(e)}async start(){this.wantList.start(),await this.network.start()}async stop(){this.wantList.stop(),await this.network.stop()}}const Aue=(r,e={})=>new Sue(r,e);class Cue{constructor(e,t={}){u(this,"bitswap");u(this,"started");const{getHasher:n}=e;this.bitswap=Aue(e,{hashLoader:{getHasher:async i=>n(i)},...t}),this.started=!1}isStarted(){return this.started}async start(){await this.bitswap.start(),this.started=!0}async stop(){await this.bitswap.stop(),this.started=!1}async announce(e,t,n){await this.bitswap.notify(e,t,n)}async retrieve(e,t={}){return this.bitswap.want(e,t)}createSession(e){const t=this.bitswap.createSession(e);return{announce:async(n,i,s)=>{await this.bitswap.notify(n,i,s)},retrieve:async(n,i)=>t.retrieve(n,i)}}}function kue(r={}){return e=>new Cue(e,r)}class Iue{constructor(){u(this,"index",0);u(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,i){return this.readAtomically(()=>{let s=0,o=0;const a=this.peekChar();if(a===void 0)return;const c=a==="0",l=2**(8*i)-1;for(;;){const d=this.readAtomically(()=>{const h=this.readChar();if(h===void 0)return;const p=Number.parseInt(h,e);if(!Number.isNaN(p))return p});if(d===void 0)break;if(s*=e,s+=d,s>l||(o+=1,t!==void 0&&o>t))return}if(o!==0)return!n&&c&&o>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){const e=t=>{for(let n=0;n<t.length/2;n++){const i=n*2;if(n<t.length-3){const o=this.readSeparator(":",n,()=>this.readIPv4Addr());if(o!==void 0)return t[i]=o[0],t[i+1]=o[1],t[i+2]=o[2],t[i+3]=o[3],[i+4,!0]}const s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[i,!1];t[i]=s>>8,t[i+1]=s&255}return[t.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[n,i]=e(t);if(n===16)return t;if(i||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const s=new Uint8Array(14),o=16-(n+2),[a]=e(s.subarray(0,o));return t.set(s.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const $U=45,_ue=15,Od=new Iue;function PU(r){if(!(r.length>_ue))return Od.new(r).parseWith(()=>Od.readIPv4Addr())}function DU(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>$U))return Od.new(r).parseWith(()=>Od.readIPv6Addr())}function gy(r,e=!1){if(r.includes("%")&&(r=r.split("%")[0]),r.length>$U)return;const t=Od.new(r).parseWith(()=>Od.readIPAddr());if(t)return e&&t.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,t[0],t[1],t[2],t[3]]):t}function Rd(r){return!!PU(r)}function mx(r){return!!DU(r)}function NU(r){return!!gy(r)}var OU;(function(){var r,e,t,n,i,s,o,a;a=function(c){var l,d,h,p;return l=(c&255<<24)>>>24,d=(c&255<<16)>>>16,h=(c&65280)>>>8,p=c&255,[l,d,h,p].join(".")},o=function(c){var l,d,h,p,b,f;for(l=[],h=p=0;p<=3&&c.length!==0;h=++p){if(h>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}f=e(c),b=f[0],d=f[1],c=c.substring(d),l.push(b)}if(c.length!==0)throw new Error("Invalid IP");switch(l.length){case 1:if(l[0]>4294967295)throw new Error("Invalid IP");return l[0]>>>0;case 2:if(l[0]>255||l[1]>16777215)throw new Error("Invalid IP");return(l[0]<<24|l[1])>>>0;case 3:if(l[0]>255||l[1]>255||l[2]>65535)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2])>>>0;case 4:if(l[0]>255||l[1]>255||l[2]>255||l[3]>255)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2]<<8|l[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},n=t("0"),s=t("a"),i=t("A"),e=function(c){var l,d,h,p,b;for(p=0,l=10,d="9",h=0,c.length>1&&c[h]==="0"&&(c[h+1]==="x"||c[h+1]==="X"?(h+=2,l=16):"0"<=c[h+1]&&c[h+1]<="9"&&(h++,l=8,d="7")),b=h;h<c.length;){if("0"<=c[h]&&c[h]<=d)p=p*l+(t(c[h])-n)>>>0;else if(l===16)if("a"<=c[h]&&c[h]<="f")p=p*l+(10+t(c[h])-s)>>>0;else if("A"<=c[h]&&c[h]<="F")p=p*l+(10+t(c[h])-i)>>>0;else break;else break;if(p>4294967295)throw new Error("too large");h++}if(h===b)throw new Error("empty octet");return[p,h]},r=function(){function c(l,d){var h,p,b;if(typeof l!="string")throw new Error("Missing `net' parameter");if(d||(b=l.split("/",2),l=b[0],d=b[1]),d||(d=32),typeof d=="string"&&d.indexOf(".")>-1){try{this.maskLong=o(d)}catch{throw new Error("Invalid mask: "+d)}for(h=p=32;p>=0;h=--p)if(this.maskLong===4294967295<<32-h>>>0){this.bitmask=h;break}}else if(d||d===0)this.bitmask=parseInt(d,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(o(l)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+l)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+d);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(l){return typeof l=="string"&&(l.indexOf("/")>0||l.split(".").length!==4)&&(l=new c(l)),l instanceof c?this.contains(l.base)&&this.contains(l.broadcast||l.last):(o(l)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(l){return l==null&&(l=1),new c(a(this.netLong+this.size*l),this.mask)},c.prototype.forEach=function(l){var d,h,p;for(p=o(this.first),h=o(this.last),d=0;p<=h;)l(a(p),p,d),d++,p++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),OU=r}).call(Jf);const Tue=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],$ue=Tue.map(r=>new OU(r));function wx(r){for(const e of $ue)if(e.contains(r))return!0;return!1}function Pue(r){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(r)}function Due(r){const e=r.split(":");if(e.length<2)return!1;const t=e[e.length-1].padStart(4,"0"),n=e[e.length-2].padStart(4,"0"),i=`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(t.substring(0,2),16)}.${parseInt(t.substring(2),16)}`;return wx(i)}function Nue(r){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)}function Oue(r){const e=r.split(":"),t=e[e.length-1];return wx(t)}function Rue(r){return/^::$/.test(r)||/^::1$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}function vc(r){return Rd(r)?wx(r):Pue(r)?Due(r):Nue(r)?Oue(r):mx(r)?Rue(r):void 0}function Bue(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Lue(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var Mue=Lue,Uue=Mue;let Fue=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},zue=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return RU(this,e)}},Vue=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return RU(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function RU(r,e){return new Vue({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Kue=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Fue(e,t,n),this.decoder=new zue(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function BU({name:r,prefix:e,encode:t,decode:n}){return new Kue(r,e,t,n)}function LU({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Uue(t,r);return BU({prefix:e,name:r,encode:n,decode:s=>Bue(i(s))})}function jue(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Hue(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Qm({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return BU({prefix:e,name:r,encode(i){return Hue(i,n,t)},decode(i){return jue(i,n,t,r)}})}const que=LU({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});LU({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});Qm({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Qm({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});const Wue=Qm({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});Qm({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const Gue=r=>r.toString().split("/").slice(1),x0=r=>({match:e=>e.length<1?!1:r(e[0])?e.slice(1):!1,pattern:"fn"}),Ge=r=>({match:e=>x0(t=>t===r).match(e),pattern:r}),mh=()=>({match:r=>x0(e=>typeof e=="string").match(r),pattern:"{string}"}),Ym=()=>({match:r=>x0(e=>!isNaN(parseInt(e))).match(r),pattern:"{number}"}),ut=()=>({match:r=>{if(r.length<2||r[0]!=="p2p"&&r[0]!=="ipfs")return!1;if(r[1].startsWith("Q")||r[1].startsWith("1"))try{que.decode(`z${r[1]}`)}catch{return!1}else return!1;return r.slice(2)},pattern:"/p2p/{peerid}"}),yy=()=>({match:r=>{if(r.length<2||r[0]!=="certhash")return!1;try{Wue.decode(r[1])}catch{return!1}return r.slice(2)},pattern:"/certhash/{certhash}"}),ot=r=>({match:e=>{const t=r.match(e);return t===!1?e:t},pattern:`optional(${r.pattern})`}),nn=(...r)=>({match:e=>{let t;for(const n of r){const i=n.match(e);i!==!1&&(t==null||i.length<t.length)&&(t=i)}return t??!1},pattern:`or(${r.map(e=>e.pattern).join(", ")})`}),Qe=(...r)=>({match:e=>{for(const t of r){const n=t.match(e);if(n===!1)return!1;e=n}return e},pattern:`and(${r.map(e=>e.pattern).join(", ")})`});function wt(...r){function e(i){let s=Gue(i);for(const o of r){const a=o.match(s);if(a===!1)return!1;s=a}return s}function t(i){return e(i)!==!1}function n(i){const s=e(i);return s===!1?!1:s.length===0}return{matchers:r,matches:t,exactMatch:n}}const Que=ut(),Yue=wt(Que),Jm=Qe(Ge("dns4"),mh()),Xm=Qe(Ge("dns6"),mh()),Zm=Qe(Ge("dnsaddr"),mh()),bx=Qe(Ge("dns"),mh());wt(Jm,ot(ut()));wt(Xm,ot(ut()));wt(Zm,ot(ut()));const MU=wt(nn(bx,Zm,Jm,Xm),ot(ut())),UU=Qe(Ge("ip4"),x0(Rd)),FU=Qe(Ge("ip6"),x0(mx)),vx=nn(UU,FU),uo=nn(vx,bx,Jm,Xm,Zm),Jue=wt(nn(vx,Qe(nn(bx,Zm,Jm,Xm),ot(ut())))),TI=wt(UU),$I=wt(FU),Xue=wt(vx),Ex=Qe(uo,Ge("tcp"),Ym()),S0=Qe(uo,Ge("udp"),Ym()),my=wt(Qe(Ex,ot(ut())));wt(S0);const xx=Qe(S0,Ge("quic"),ot(ut())),e4=Qe(S0,Ge("quic-v1"),ot(ut())),Zue=nn(xx,e4);wt(xx);const ede=wt(e4),k7=nn(uo,Ex,S0,xx,e4),zU=nn(Qe(k7,Ge("ws"),ot(ut()))),P1=wt(zU),VU=nn(Qe(k7,Ge("wss"),ot(ut())),Qe(k7,Ge("tls"),ot(Qe(Ge("sni"),mh())),Ge("ws"),ot(ut()))),wy=wt(VU),KU=Qe(S0,Ge("webrtc-direct"),ot(yy()),ot(yy()),ot(ut())),I7=wt(KU),jU=Qe(e4,Ge("webtransport"),ot(yy()),ot(yy()),ot(ut())),PI=wt(jU),by=nn(zU,VU,Qe(Ex,ot(ut())),Qe(Zue,ot(ut())),Qe(uo,ot(ut())),KU,jU,ut()),HU=wt(by),tde=Qe(by,Ge("p2p-circuit"),ut()),sc=wt(tde),rde=nn(Qe(by,Ge("p2p-circuit"),Ge("webrtc"),ot(ut())),Qe(by,Ge("webrtc"),ot(ut())),Qe(Ge("webrtc"),ot(ut()))),_7=wt(rde),nde=nn(Qe(uo,Ge("tcp"),Ym(),Ge("http"),ot(ut())),Qe(uo,Ge("http"),ot(ut()))),ide=wt(nde),sde=nn(Qe(uo,Ge("tcp"),nn(Qe(Ge("443"),Ge("http")),Qe(Ym(),Ge("https"))),ot(ut())),Qe(uo,Ge("tls"),Ge("http"),ot(ut())),Qe(uo,Ge("https"),ot(ut()))),ode=wt(sde),ade=nn(Qe(Ge("memory"),mh(),ot(ut())));wt(ade);function cde(r,e,t){let n=0;for(const i of r)if(!(n<e)){if(n>t)break;if(i!==255)return!1;n++}return!0}function lde(r,e,t,n){let i=0;for(const s of r)if(!(i<t)){if(i>n)break;if(s!==e[i])return!1;i++}return!0}function ude(r){switch(r.length){case D1:return r.join(".");case N1:{const e=[];for(let t=0;t<r.length;t++)t%2===0&&e.push(r[t].toString(16).padStart(2,"0")+r[t+1].toString(16).padStart(2,"0"));return e.join(":")}default:throw new Error("Invalid ip length")}}function dde(r){let e=0;for(let[t,n]of r.entries()){if(n===255){e+=8;continue}for(;n&128;)e++,n=n<<1;if(n&128)return-1;for(let i=t+1;i<r.length;i++)if(r[i]!=0)return-1;break}return e}function hde(r){let e="0x";for(const t of r)e+=(t>>4).toString(16)+(t&15).toString(16);return e}const D1=4,N1=16,fde=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function qU(r,e){e.length===N1&&r.length===D1&&cde(e,0,11)&&(e=e.slice(12)),e.length===D1&&r.length===N1&&lde(r,fde,0,11)&&(r=r.slice(12));const t=r.length;if(t!=e.length)throw new Error("Failed to mask ip");const n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=r[i]&e[i];return n}function pde(r,e){if(typeof e=="string"&&(e=gy(e)),e==null)throw new Error("Invalid ip");if(e.length!==r.network.length)return!1;for(let t=0;t<e.length;t++)if((r.network[t]&r.mask[t])!==(e[t]&r.mask[t]))return!1;return!0}function gde(r){const[e,t]=r.split("/");if(!e||!t)throw new Error("Failed to parse given CIDR: "+r);let n=D1,i=PU(e);if(i==null&&(n=N1,i=DU(e),i==null))throw new Error("Failed to parse given CIDR: "+r);const s=parseInt(t,10);if(Number.isNaN(s)||String(s).length!==t.length||s<0||s>n*8)throw new Error("Failed to parse given CIDR: "+r);const o=WU(s,8*n);return{network:qU(i,o),mask:o}}function WU(r,e){if(e!==8*D1&&e!==8*N1)throw new Error("Invalid CIDR mask");if(r<0||r>e)throw new Error("Invalid CIDR mask");const t=e/8,n=new Uint8Array(t);for(let i=0;i<t;i++){if(r>=8){n[i]=255,r-=8;continue}n[i]=255-(255>>r),r=0}return n}class GU{constructor(e,t){if(t==null)({network:this.network,mask:this.mask}=gde(e));else{const n=gy(e);if(n==null)throw new Error("Failed to parse network");t=String(t);const i=parseInt(t,10);if(Number.isNaN(i)||String(i).length!==t.length||i<0||i>n.length*8){const s=gy(t);if(s==null)throw new Error("Failed to parse mask");this.mask=s}else this.mask=WU(i,8*n.length);this.network=qU(n,this.mask)}}contains(e){return pde({network:this.network,mask:this.mask},e)}toString(){const e=dde(this.mask),t=e!==-1?String(e):hde(this.mask);return ude(this.network)+"/"+t}}function yde(r,e){return new GU(r).contains(e)}function mde(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Sx(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function wde(r){return new TextEncoder().encode(r)}function bde(r){return new TextDecoder().decode(r)}function vde(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var Ede=vde,xde=Ede;let Sde=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Ade=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return QU(this,e)}},Cde=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return QU(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function QU(r,e){return new Cde({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let kde=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Sde(e,t,n),this.decoder=new Ade(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function t4({name:r,prefix:e,encode:t,decode:n}){return new kde(r,e,t,n)}function A0({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=xde(t,r);return t4({prefix:e,name:r,encode:n,decode:s=>Sx(i(s))})}function Ide(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function _de(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function vr({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return t4({prefix:e,name:r,encode(i){return _de(i,n,t)},decode(i){return Ide(i,n,t,r)}})}const pl=vr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Tde=vr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),$de=vr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Pde=vr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Dde=vr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Nde=vr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ode=vr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Rde=vr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Bde=vr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Lde=Object.freeze(Object.defineProperty({__proto__:null,base32:pl,base32hex:Dde,base32hexpad:Ode,base32hexpadupper:Rde,base32hexupper:Nde,base32pad:$de,base32padupper:Pde,base32upper:Tde,base32z:Bde},Symbol.toStringTag,{value:"Module"})),Ui=A0({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Mde=A0({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Ude=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Ui,base58flickr:Mde},Symbol.toStringTag,{value:"Module"})),Fde=A0({prefix:"9",name:"base10",alphabet:"0123456789"}),zde=Object.freeze(Object.defineProperty({__proto__:null,base10:Fde},Symbol.toStringTag,{value:"Module"})),Vde=vr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Kde=vr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),jde=Object.freeze(Object.defineProperty({__proto__:null,base16:Vde,base16upper:Kde},Symbol.toStringTag,{value:"Module"})),Hde=vr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),qde=Object.freeze(Object.defineProperty({__proto__:null,base2:Hde},Symbol.toStringTag,{value:"Module"})),YU=Array.from(""),Wde=YU.reduce((r,e,t)=>(r[t]=e,r),[]),Gde=YU.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function Qde(r){return r.reduce((e,t)=>(e+=Wde[t],e),"")}function Yde(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const i=Gde[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const Jde=t4({prefix:"",name:"base256emoji",encode:Qde,decode:Yde}),Xde=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Jde},Symbol.toStringTag,{value:"Module"})),N2=A0({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Zde=A0({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),ehe=Object.freeze(Object.defineProperty({__proto__:null,base36:N2,base36upper:Zde},Symbol.toStringTag,{value:"Module"})),the=vr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),rhe=vr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),nhe=vr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ihe=vr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),she=Object.freeze(Object.defineProperty({__proto__:null,base64:the,base64pad:rhe,base64url:nhe,base64urlpad:ihe},Symbol.toStringTag,{value:"Module"})),ohe=vr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),ahe=Object.freeze(Object.defineProperty({__proto__:null,base8:ohe},Symbol.toStringTag,{value:"Module"})),che=t4({prefix:"\0",name:"identity",encode:r=>bde(r),decode:r=>wde(r)}),lhe=Object.freeze(Object.defineProperty({__proto__:null,identity:che},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;var uhe=JU,DI=128,dhe=-128,hhe=Math.pow(2,31);function JU(r,e,t){e=e||[],t=t||0;for(var n=t;r>=hhe;)e[t++]=r&255|DI,r/=128;for(;r&dhe;)e[t++]=r&255|DI,r>>>=7;return e[t]=r|0,JU.bytes=t-n+1,e}var fhe=T7,phe=128,NI=127;function T7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw T7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&NI)<<i:(o&NI)*Math.pow(2,i),i+=7}while(o>=phe);return T7.bytes=s-n,t}var ghe=Math.pow(2,7),yhe=Math.pow(2,14),mhe=Math.pow(2,21),whe=Math.pow(2,28),bhe=Math.pow(2,35),vhe=Math.pow(2,42),Ehe=Math.pow(2,49),xhe=Math.pow(2,56),She=Math.pow(2,63),Ahe=function(r){return r<ghe?1:r<yhe?2:r<mhe?3:r<whe?4:r<bhe?5:r<vhe?6:r<Ehe?7:r<xhe?8:r<She?9:10},Che={encode:uhe,decode:fhe,encodingLength:Ahe},vy=Che;function $7(r,e=0){return[vy.decode(r,e),vy.decode.bytes]}function Ey(r,e,t=0){return vy.encode(r,e,t),e}function xy(r){return vy.encodingLength(r)}function khe(r,e){const t=e.byteLength,n=xy(r),i=n+xy(t),s=new Uint8Array(i+t);return Ey(r,s,0),Ey(t,s,n),s.set(e,i),new Ax(r,t,e,s)}function XU(r){const e=Sx(r),[t,n]=$7(e),[i,s]=$7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Ax(t,i,o,e)}function Ihe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&mde(r.bytes,t.bytes)}}let Ax=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function OI(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return The(t,P7(r),e??Ui.encoder);default:return $he(t,P7(r),e??pl.encoder)}}const RI=new WeakMap;function P7(r){const e=RI.get(r);if(e==null){const t=new Map;return RI.set(r,t),t}return e}var sD;let ZU=class Nr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,sD,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==of)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Phe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Nr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=khe(e,t);return Nr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Nr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Ihe(e.multihash,n.multihash)}toString(e){return OI(this,e)}toJSON(){return{"/":OI(this)}}link(){return this}[(sD=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Nr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Nr(n,i,s,o??BI(n,i,s.bytes))}else if(t[Dhe]===!0){const{version:n,multihash:i,code:s}=t,o=XU(i);return Nr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==of)throw new Error(`Version 0 CID must use dag-pb (code: ${of}) block encoding`);return new Nr(e,t,n,n.bytes)}case 1:{const i=BI(e,t,n.bytes);return new Nr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Nr.create(0,of,e)}static createV1(e,t){return Nr.create(1,e,t)}static decode(e){const[t,n]=Nr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Nr.inspectBytes(e),n=t.size-t.multihashSize,i=Sx(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new Ax(t.multihashCode,t.digestSize,s,i);return[t.version===0?Nr.createV0(o):Nr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=$7(e.subarray(t));return t+=p,h};let i=n(),s=of;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=_he(e,t),s=Nr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return P7(s).set(n,e),s}};function _he(r,e){switch(r[0]){case"Q":{const t=e??Ui;return[Ui.prefix,t.decode(`${Ui.prefix}${r}`)]}case Ui.prefix:{const t=e??Ui;return[Ui.prefix,t.decode(r)]}case pl.prefix:{const t=e??pl;return[pl.prefix,t.decode(r)]}case N2.prefix:{const t=e??N2;return[N2.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function The(r,e,t){const{prefix:n}=t;if(n!==Ui.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function $he(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const of=112,Phe=18;function BI(r,e,t){const n=xy(r),i=n+xy(e),s=new Uint8Array(i+t.byteLength);return Ey(r,s,0),Ey(e,s,n),s.set(t,i),s}const Dhe=Symbol.for("@ipld/js-cid/CID"),Nhe={...lhe,...qde,...ahe,...zde,...jde,...Lde,...ehe,...Ude,...she,...Xde},LI=Rd,Ohe=mx,eF=function(r){let e=0;if(r=r.toString().trim(),LI(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(Ohe(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const s=LI(t[n]);let o;s&&(o=eF(t[n]),t[n]=re(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,re(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const s=[n,1];for(n=9-t.length;n>0;n--)s.push("0");t.splice.apply(t,s)}const i=new Uint8Array(e+16);for(n=0;n<t.length;n++){const s=parseInt(t[n],16);i[e++]=s>>8&255,i[e++]=s&255}return i}throw new Error("invalid ip address")},Rhe=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const i=[];for(let s=0;s<t;s++)i.push(r[e+s]);return i.join(".")}if(t===16){const i=[];for(let s=0;s<t;s+=2)i.push(n.getUint16(e+s).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},In=-1,O1={},D7={},Bhe=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,In,"ip6zone"],[43,8,"ipcidr"],[53,In,"dns",!0],[54,In,"dns4",!0],[55,In,"dns6",!0],[56,In,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,In,"unix",!1,!0],[421,In,"ipfs"],[421,In,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,In,"garlic64"],[448,0,"tls"],[449,In,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,In,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,In,"http-path"],[777,In,"memory"]];Bhe.forEach(r=>{const e=Lhe(...r);D7[e.code]=e,O1[e.name]=e});function Lhe(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:!!n,path:!!i}}function Re(r){if(typeof r=="number"){if(D7[r]!=null)return D7[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(O1[r]!=null)return O1[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}const Mhe=Re("ip4"),Uhe=Re("ip6"),Fhe=Re("ipcidr");function tF(r,e){switch(Re(r).code){case 4:case 41:return Khe(e);case 42:return R8(e);case 43:return re(e,"base10");case 6:case 273:case 33:case 132:return rF(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return R8(e);case 421:return Whe(e);case 444:return FI(e);case 445:return FI(e);case 466:return qhe(e);case 481:return globalThis.encodeURIComponent(R8(e));default:return re(e,"base16")}}function MI(r,e){switch(Re(r).code){case 4:return UI(e);case 41:return UI(e);case 42:return O8(e);case 43:return se(e,"base10");case 6:case 273:case 33:case 132:return Cx(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return O8(e);case 421:return jhe(e);case 444:return Ghe(e);case 445:return Qhe(e);case 466:return Hhe(e);case 481:return O8(globalThis.decodeURIComponent(e));default:return se(e,"base16")}}function zhe(r){let e,t;if(r.stringTuples().forEach(([n,i])=>{(n===Mhe.code||n===Uhe.code)&&(t=i),n===Fhe.code&&(e=i)}),e==null||t==null)throw new Error("Invalid multiaddr");return new GU(t,e)}const N8=Object.values(Nhe).map(r=>r.decoder),Vhe=function(){let r=N8[0].or(N8[1]);return N8.slice(2).forEach(e=>r=r.or(e)),r}();function UI(r){if(!NU(r))throw new Error("invalid ip address");return eF(r)}function Khe(r){const e=Rhe(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!NU(e))throw new Error("invalid ip address");return e}function Cx(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function rF(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function O8(r){const e=se(r),t=Uint8Array.from(Hr(e.length));return pr([t,e],t.length+e.length)}function R8(r){const e=Ns(r);if(r=r.slice(mt(e)),r.length!==e)throw new Error("inconsistent lengths");return re(r)}function jhe(r){let e;r[0]==="Q"||r[0]==="1"?e=XU(Ui.decode(`z${r}`)).bytes:e=ZU.parse(r).multihash.bytes;const t=Uint8Array.from(Hr(e.length));return pr([t,e],t.length+e.length)}function Hhe(r){const e=Vhe.decode(r),t=Uint8Array.from(Hr(e.length));return pr([t,e],t.length+e.length)}function qhe(r){const e=Ns(r),t=r.slice(mt(e));if(t.length!==e)throw new Error("inconsistent lengths");return"u"+re(t,"base64url")}function Whe(r){const e=Ns(r),t=r.slice(mt(e));if(t.length!==e)throw new Error("inconsistent lengths");return re(t,"base58btc")}function Ghe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=pl.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Cx(n);return pr([t,i],t.length+i.length)}function Qhe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=pl.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Cx(n);return pr([t,i],t.length+i.length)}function FI(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=re(e,"base32"),i=rF(t);return`${n}:${i}`}function Yhe(r){r=N7(r);const e=[],t=[];let n=null;const i=r.split("/").slice(1);if(i.length===1&&i[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<i.length;s++){const o=i[s],a=Re(o);if(a.size===0){e.push([a.code]),t.push([a.code]);continue}if(s++,s>=i.length)throw new kx("invalid address: "+r);if(a.path===!0){n=N7(i.slice(s).join("/")),e.push([a.code,MI(a.code,n)]),t.push([a.code,n]);break}const c=MI(a.code,i[s]);e.push([a.code,c]),t.push([a.code,tF(a.code,c)])}return{string:nF(t),bytes:iF(e),tuples:e,stringTuples:t,path:n}}function zI(r){const e=[],t=[];let n=null,i=0;for(;i<r.length;){const s=Ns(r,i),o=mt(s),a=Re(s),c=Jhe(a,r.slice(i+o));if(c===0){e.push([s]),t.push([s]),i+=o;continue}const l=r.slice(i+o,i+o+c);if(i+=c+o,i>r.length)throw new kx("Invalid address Uint8Array: "+re(r,"base16"));e.push([s,l]);const d=tF(s,l);if(t.push([s,d]),a.path===!0){n=d;break}}return{bytes:Uint8Array.from(r),string:nF(t),tuples:e,stringTuples:t,path:n}}function nF(r){const e=[];return r.map(t=>{const n=Re(t[0]);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),N7(e.join("/"))}function iF(r){return pr(r.map(e=>{const t=Re(e[0]);let n=Uint8Array.from(Hr(t.code));return e.length>1&&e[1]!=null&&(n=pr([n,e[1]])),n}))}function Jhe(r,e){if(r.size>0)return r.size/8;if(r.size===0)return 0;{const t=Ns(e instanceof Uint8Array?e:Uint8Array.from(e));return t+mt(t)}}function N7(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}class kx extends Error{constructor(t){super(`Error parsing address: ${t}`);u(this,"name","ParseError")}}u(kx,"name","ParseError");const Xhe=Symbol.for("nodejs.util.inspect.custom"),sF=Symbol.for("@multiformats/js-multiaddr/multiaddr"),Zhe=[Re("dns").code,Re("dns4").code,Re("dns6").code,Re("dnsaddr").code];class efe extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}var oD,ld,ka,t0,r0;const zu=class zu{constructor(e){u(this,"bytes");qe(this,ld);qe(this,ka);qe(this,t0);qe(this,r0);u(this,oD,!0);e==null&&(e="");let t;if(e instanceof Uint8Array)t=zI(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=Yhe(e)}else if(r4(e))t=zI(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,dt(this,ld,t.string),dt(this,ka,t.tuples),dt(this,t0,t.stringTuples),dt(this,r0,t.path)}toString(){return ie(this,ld)}toJSON(){return this.toString()}toOptions(){let e,t,n,i,s="";const o=Re("tcp"),a=Re("udp"),c=Re("ip4"),l=Re("ip6"),d=Re("dns6"),h=Re("ip6zone");for(const[b,f]of this.stringTuples())b===h.code&&(s=`%${f??""}`),Zhe.includes(b)&&(t=o.name==="tcp"?"tcp":"udp",i=443,n=`${f??""}${s}`,e=b===d.code?6:4),(b===o.code||b===a.code)&&(t=Re(b).name==="tcp"?"tcp":"udp",i=parseInt(f??"")),(b===c.code||b===l.code)&&(t=Re(b).name==="tcp"?"tcp":"udp",n=`${f??""}${s}`,e=b===l.code?6:4);if(e==null||t==null||n==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:i}}protos(){return ie(this,ka).map(([e])=>Object.assign({},Re(e)))}protoCodes(){return ie(this,ka).map(([e])=>e)}protoNames(){return ie(this,ka).map(([e])=>Re(e).name)}tuples(){return ie(this,ka).map(([e,t])=>t==null?[e]:[e,t])}stringTuples(){return ie(this,t0).map(([e,t])=>t==null?[e]:[e,t])}encapsulate(e){return e=new zu(e),new zu(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new zu(n.slice(0,i))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new zu(iF(t.slice(0,n)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([n,i])=>{n===O1.p2p.code&&e.push([n,i]),n===O1["p2p-circuit"].code&&(e=[])});const t=e.pop();if((t==null?void 0:t[1])!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?re(Ui.decode(`z${n}`),"base58btc"):re(ZU.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return ie(this,r0)}equals(e){return Fe(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(s=>s.resolvable);if(t==null)return[this];const n=Ix.get(t.name);if(n==null)throw new efe(`no available resolver for ${t.name}`);return(await n(this,e)).map(s=>Te(s))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(oD=sF,Xhe)](){return`Multiaddr(${ie(this,ld)})`}};ld=new WeakMap,ka=new WeakMap,t0=new WeakMap,r0=new WeakMap;let O7=zu;const Ix=new Map;function r4(r){return!!(r!=null&&r[sF])}function Te(r){return new O7(r)}const tfe=[Re("tcp").code,Re("dns").code,Re("dnsaddr").code,Re("dns4").code,Re("dns6").code];function VI(r){var e;return(e=oF("sni",r))==null?void 0:e[1]}function KI(r){var t;const e=(t=oF("tcp",r))==null?void 0:t[1];return e==null?"":`:${e}`}function oF(r,e){let t;try{t=Re(r).code}catch{return}for(const[n,i]of e)if(n===t&&i!=null)return[n,i]}function jI(r){return r.some(([e,t])=>e===Re("tls").code)}function Ti(r,e,t){const n=aF[Re(r).name];if(n==null)throw new Error(`Can't interpret protocol ${Re(r).name}`);const i=n(e,t);return r===Re("ip6").code?`[${i}]`:i}const aF={ip4:(r,e)=>r,ip6:(r,e)=>e.length===0?r:`[${r}]`,tcp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`tcp://${Ti(t[0],t[1]??"",e)}:${r}`},udp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`udp://${Ti(t[0],t[1]??"",e)}:${r}`},dnsaddr:(r,e)=>r,dns4:(r,e)=>r,dns6:(r,e)=>r,dns:(r,e)=>r,ipfs:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${Ti(t[0],t[1]??"",e)}`},p2p:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${Ti(t[0],t[1]??"",e)}`},http:(r,e)=>{const t=jI(e),n=VI(e),i=KI(e);if(t&&n!=null)return`https://${n}${i}`;const s=t?"https://":"http://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=Ti(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${s}${a}`},"http-path":(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");const n=Ti(t[0],t[1]??"",e),i=decodeURIComponent(r);return`${n}/${i}`},tls:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return Ti(t[0],t[1]??"",e)},sni:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return Ti(t[0],t[1]??"",e)},https:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=Ti(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`https://${n}`},ws:(r,e)=>{const t=jI(e),n=VI(e),i=KI(e);if(t&&n!=null)return`wss://${n}${i}`;const s=t?"wss://":"ws://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=Ti(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${s}${a}`},wss:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=Ti(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`wss://${n}`}};function cF(r,e){const n=Te(r).stringTuples(),i=n.pop();if(i==null)throw new Error("Unexpected end of multiaddr");const s=Re(i[0]),o=aF[s.name];if(o==null)throw new Error(`No interpreter found for ${s.name}`);let a=o(i[1]??"",n);return tfe.includes(i[0])&&(a=a.replace(/^.*:\/\//,""),i[1]==="443"?a=`https://${a}`:a=`http://${a}`),(a.startsWith("http://")||a.startsWith("https://")||a.startsWith("ws://")||a.startsWith("wss://"))&&(a=new URL(a).toString(),a.endsWith("/")&&(a=a.substring(0,a.length-1))),a}let rfe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},nfe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return lF(this,e)}},ife=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return lF(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function lF(r,e){return new ife({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let sfe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new rfe(e,t,n),this.decoder=new nfe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function ofe({name:r,prefix:e,encode:t,decode:n}){return new sfe(r,e,t,n)}function afe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function cfe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function n4({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return ofe({prefix:e,name:r,encode(i){return cfe(i,n,t)},decode(i){return afe(i,n,t,r)}})}const lfe=n4({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});n4({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});n4({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});n4({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var rl,nl,ud,dd,il,K3,uF;class ufe{constructor(e,{logger:t,transformRequestInit:n}){qe(this,K3);u(this,"url");qe(this,rl,0);qe(this,nl,0);qe(this,ud,0);qe(this,dd,0);qe(this,il,new Map);u(this,"log");u(this,"transformRequestInit");this.url=e instanceof URL?e:new URL(e),this.transformRequestInit=n,this.log=t.forComponent(`helia:trustless-gateway-block-broker:${this.url.hostname}`)}async getRawBlock(e,t){const n=new URL(this.url.toString());if(n.pathname=`/ipfs/${e.toString()}`,n.search="?format=raw",(t==null?void 0:t.aborted)===!0)throw new Error(`Signal to fetch raw block for CID ${e} from gateway ${this.url} was aborted prior to fetch`);const i=Ae(this,K3,uF).call(this,e),s=new AbortController,o=()=>{s.abort()};t==null||t.addEventListener("abort",o);try{let a=ie(this,il).get(i);if(a==null){ns(this,rl)._++;const c={signal:s.signal,headers:{Accept:"application/vnd.ipld.raw"},cache:"force-cache"},l=this.transformRequestInit!=null?await this.transformRequestInit(c):c;a=fetch(n.toString(),l).then(async d=>{if(this.log("GET %s %d",n,d.status),!d.ok)throw ns(this,nl)._++,new Error(`unable to fetch raw block for CID ${e} from gateway ${this.url}`);return ns(this,dd)._++,new Uint8Array(await d.arrayBuffer())}),ie(this,il).set(i,a)}return await a}catch{throw(t==null?void 0:t.aborted)===!0?new Error(`fetching raw block for CID ${e} from gateway ${this.url} was aborted`):(ns(this,nl)._++,new Error(`unable to fetch raw block for CID ${e}`))}finally{t==null||t.removeEventListener("abort",o),ie(this,il).delete(i)}}reliability(){return ie(this,rl)===0?1:ie(this,ud)>0?-1/0:ie(this,dd)/(ie(this,rl)+ie(this,nl)*3)}incrementInvalidBlocks(){ns(this,ud)._++}getStats(){return{attempts:ie(this,rl),errors:ie(this,nl),invalidBlocks:ie(this,ud),successes:ie(this,dd),pendingResponses:ie(this,il).size}}}rl=new WeakMap,nl=new WeakMap,ud=new WeakMap,dd=new WeakMap,il=new WeakMap,K3=new WeakSet,uF=function(e){const t=e.multihash.bytes;return lfe.encode(t)};function dfe(r,e,t){return r.filter(n=>{if(ode.matches(n)||e&&ide.matches(n))return t||MU.matches(n)?!0:vc(n.toOptions().host)===!1;if(!e&&t){const{host:i}=n.toOptions();if(i==="127.0.0.1"||i==="localhost"||i.endsWith(".localhost"))return!0}return!1})}async function*dF(r,e,t,n,i,s={}){for await(const o of e.findProviders(r,s)){const a=dfe(o.multiaddrs,n,i);if(a.length===0)continue;const c=cF(a[0]);yield new ufe(c,{logger:t,transformRequestInit:s.transformRequestInit})}}class hfe extends _U{constructor(t,n){super(t,{...n,name:"helia:trustless-gateway:session"});u(this,"routing");u(this,"allowInsecure");u(this,"allowLocal");u(this,"transformRequestInit");this.routing=t.routing,this.allowInsecure=n.allowInsecure??hF,this.allowLocal=n.allowLocal??fF,this.transformRequestInit=n.transformRequestInit}async queryProvider(t,n,i){var o;this.log("fetching BLOCK for %c from %s",t,n.url);const s=await n.getRawBlock(t,i.signal);return this.log.trace("got block for %c from %s",t,n.url),await((o=i.validateFn)==null?void 0:o.call(i,s)),s}async*findNewProviders(t,n={}){yield*dF(t,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...n,transformRequestInit:this.transformRequestInit})}toEvictionKey(t){return t.url.toString()}equals(t,n){return t.url.toString()===n.url.toString()}}function ffe(r,e){return new hfe(r,e)}class pfe{constructor(e,t={}){u(this,"allowInsecure");u(this,"allowLocal");u(this,"transformRequestInit");u(this,"routing");u(this,"log");u(this,"logger");this.log=e.logger.forComponent("helia:trustless-gateway-block-broker"),this.logger=e.logger,this.routing=e.routing,this.allowInsecure=t.allowInsecure??hF,this.allowLocal=t.allowLocal??fF,this.transformRequestInit=t.transformRequestInit}async retrieve(e,t={}){var i,s;const n=[];for await(const o of dF(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...t,transformRequestInit:this.transformRequestInit})){this.log("getting block for %c from %s",e,o.url);try{const a=await o.getRawBlock(e,t.signal);this.log.trace("got block for %c from %s",e,o.url);try{await((i=t.validateFn)==null?void 0:i.call(t,a))}catch(c){this.log.error("failed to validate block for %c from %s",e,o.url,c);continue}return a}catch(a){if(this.log.error("failed to get block for %c from %s",e,o.url,a),a instanceof Error?n.push(a):n.push(new Error(`Unable to fetch raw block for CID ${e} from gateway ${o.url}`)),((s=t.signal)==null?void 0:s.aborted)===!0){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",e,o.url);break}}}throw n.length>0?new AggregateError(n,`Unable to fetch raw block for CID ${e} from any gateway`):new Error(`Unable to fetch raw block for CID ${e} from any gateway`)}createSession(e={}){return ffe({logger:this.logger,routing:this.routing},{...e,allowLocal:this.allowLocal,allowInsecure:this.allowInsecure,transformRequestInit:this.transformRequestInit})}}const hF=!1,fF=!1;function gfe(r={}){return e=>new pfe(e,r)}async function*HI(r,e={}){const t=r.getReader();try{for(;;){const n=await t.read();if(n.done)return;yield n.value}}finally{e.preventCancel!==!0&&await t.cancel(),t.releaseLock()}}var pF={exports:{}};(function(r){(function(){r.exports=v;var e=86400,t=3200,n=146097*t/400,i=e*n,s=1e3*i,o=864e13,a=4294967296,c=1e6,l="000000000",d=Math.trunc||function(D){var F=D-D%1;return F==0&&(D<0||D===0&&1/D!=1/0)?-0:F},h=v.prototype,p=(v.fromDate=function(D){return new v(+D)},v.fromInt64BE=C(0,1,2,3,0,4),v.fromInt64LE=C(3,2,1,0,4,0),v.fromString=function(U){var F,W=new v,U=(U+="").replace(/^\s*[+\-]?\d+/,function(j){var j=+j,H=1970+(j-1970)%400;return W.year=j-H,H}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(Y,j,H){return j<0&&(H*=-1),F=6e4*(60*+j+ +H),""}).replace(/\.\d+$/,function(Y){return W.nano=+(Y+l).substr(1,9),""}).split(/\D+/);if(1<U.length?U[1]--:U[1]=0,W.time=F=Date.UTC.apply(Date,U)-(F||0),isNaN(F))throw new TypeError("Invalid Date");return y(W)},v.fromTimeT=function(D){return m(D,0)},h.year=0,h.time=0,h.nano=0,h.addNano=function(D){return this.nano+=+D||0,this},h.getNano=function(){var D=y(this);return(D.time%1e3*c+ +D.nano+1e9)%1e9},h.getTimeT=function(){var F=y(this),D=Math.floor(F.time/1e3),F=F.year;return F&&(D+=F*n*e/t),D},h.getYear=function(){return this.toDate().getUTCFullYear()+this.year},h.toDate=function(){return w(y(this).time)},h.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},h.toString=function(D){var F=this,W=F.toDate(),U={H:function(){return A(W.getUTCHours())},L:function(){return I(W.getUTCMilliseconds(),3)},M:function(){return A(W.getUTCMinutes())},N:function(){return I(F.getNano(),9)},S:function(){return A(W.getUTCSeconds())},Y:function(){var Y=F.getYear();return 999999<Y?"+"+Y:9999<Y?"+"+I(Y,6):0<=Y?I(Y,4):-999999<=Y?"-"+I(-Y,6):Y},a:function(){return f[W.getUTCDay()]},b:function(){return b[W.getUTCMonth()]},d:function(){return A(W.getUTCDate())},e:function(){return function(Y){return(9<Y?"":" ")+(0|Y)}(W.getUTCDate())},m:function(){return A(W.getUTCMonth()+1)}};return function Y(j){return j.replace(/%./g,function(H){var V=H[1],G=g[V],V=U[V];return G?Y(G):V?V():H})}(D||p)},h.writeInt64BE=E(0,1,2,3,0,4),h.writeInt64LE=E(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return v;function v(D,F,W){var U=this;if(!(U instanceof v))return new v(D,F,W);U.time=+D||0,U.nano=+F||0,U.year=+W||0,y(U)}function y(D){var F,W,U,Y=D.year,j=D.time,H=D.nano,G=((H<0||c<=H)&&(H-=(W=Math.floor(H/c))*c,j+=W,W=1),Y%t);return(j<-864e13||o<j||G)&&((F=d(j/s))&&(Y+=F*t,j-=F*s),(U=w(j)).setUTCFullYear(G+U.getUTCFullYear()),U=(j=+U)+(F=d((Y-=G)/t))*s,F&&-864e13<=U&&U<=o&&(Y-=F*t,j=U),W=1),W&&(D.year=Y,D.time=j,D.nano=H),D}function w(D){var F=new Date(0);return F.setTime(D),F}function m(Y,U){Y=+Y||0;var W=d((U=(U|0)*a)/i)+d(Y/i),U=U%i+Y%i,Y=d(U/i);return Y&&(W+=Y,U-=Y*i),new v(1e3*U,0,W*t)}function E(D,F,W,U,Y,j){return function(G,V){var L=y(this);G=G||new Array(8),k(G,V|=0);var q=Math.floor(L.time/1e3),L=L.year*(n*e/t),R=d(L/a)+d(q/a),L=L%a+q%a,q=Math.floor(L/a);return q&&(R+=q,L-=q*a),H(G,V+Y,R),H(G,V+j,L),G};function H(G,V,R){G[V+D]=R>>24&255,G[V+F]=R>>16&255,G[V+W]=R>>8&255,G[V+U]=255&R}}function C(D,F,W,U,Y,j){return function(G,V){k(G,V|=0);var R=H(G,V+Y);return m(H(G,V+j),R)};function H(G,V){return 16777216*G[V+D]+(G[V+F]<<16|G[V+W]<<8|G[V+U])}}function k(D,F){if(D=D&&D.length,D==null)throw new TypeError("Invalid Buffer");if(D<F+8)throw new RangeError("Out of range")}function A(D){return(9<D?"":"0")+(0|D)}function I(D,F){return(l+(0|D)).substr(-F)}})()})(pF);var yfe=pF.exports;const R7=hc(yfe);class Aa extends Error{constructor(e="Record signature verification failed"){super(e),this.name="SignatureVerificationError"}}u(Aa,"name","SignatureVerificationError");class gF extends Error{constructor(e="Record has expired"){super(e),this.name="RecordExpiredError"}}u(gF,"name","RecordExpiredError");class _x extends Error{constructor(e="The validity type is unsupported"){super(e),this.name="UnsupportedValidityError"}}u(_x,"name","UnsupportedValidityError");class yF extends Error{constructor(e="The record is too large"){super(e),this.name="RecordTooLargeError"}}u(yF,"name","RecordTooLargeError");class mF extends Error{constructor(e="Value must be a valid content path starting with /"){super(e),this.name="InvalidValueError"}}u(mF,"name","InvalidValueError");class wF extends Error{constructor(e="Invalid record data"){super(e),this.name="InvalidRecordDataError"}}u(wF,"name","InvalidRecordDataError");class B7 extends Error{constructor(e="Invalid embedded public key"){super(e),this.name="InvalidEmbeddedPublicKeyError"}}u(B7,"name","InvalidEmbeddedPublicKeyError");var qi;(function(r){(function(n){n.EOL="EOL"})(r.ValidityType||(r.ValidityType={}));let e;(function(n){n[n.EOL=0]="EOL"})(e||(e={})),function(n){n.codec=()=>En(e)}(r.ValidityType||(r.ValidityType={}));let t;r.codec=()=>(t==null&&(t=Ke((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.value!=null&&(i.uint32(10),i.bytes(n.value)),n.signatureV1!=null&&(i.uint32(18),i.bytes(n.signatureV1)),n.validityType!=null&&(i.uint32(24),r.ValidityType.codec().encode(n.validityType,i)),n.validity!=null&&(i.uint32(34),i.bytes(n.validity)),n.sequence!=null&&(i.uint32(40),i.uint64(n.sequence)),n.ttl!=null&&(i.uint32(48),i.uint64(n.ttl)),n.pubKey!=null&&(i.uint32(58),i.bytes(n.pubKey)),n.signatureV2!=null&&(i.uint32(66),i.bytes(n.signatureV2)),n.data!=null&&(i.uint32(74),i.bytes(n.data)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.value=n.bytes();break}case 2:{o.signatureV1=n.bytes();break}case 3:{o.validityType=r.ValidityType.codec().decode(n);break}case 4:{o.validity=n.bytes();break}case 5:{o.sequence=n.uint64();break}case 6:{o.ttl=n.uint64();break}case 7:{o.pubKey=n.bytes();break}case 8:{o.signatureV2=n.bytes();break}case 9:{o.data=n.bytes();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>Ve(n,r.codec()),r.decode=(n,i)=>ze(n,r.codec(),i)})(qi||(qi={}));function mfe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Tx(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function wfe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var bfe=wfe,vfe=bfe;let Efe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},xfe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return bF(this,e)}},Sfe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return bF(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function bF(r,e){return new Sfe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Afe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Efe(e,t,n),this.decoder=new xfe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function vF({name:r,prefix:e,encode:t,decode:n}){return new Afe(r,e,t,n)}function i4({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=vfe(t,r);return vF({prefix:e,name:r,encode:n,decode:s=>Tx(i(s))})}function Cfe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function kfe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function No({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return vF({prefix:e,name:r,encode(i){return kfe(i,n,t)},decode(i){return Cfe(i,n,t,r)}})}const B8=i4({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});i4({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const O2=No({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});No({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});No({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});No({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});No({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});No({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});No({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});No({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});No({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const fa=i4({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});i4({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ife=EF,qI=128,_fe=-128,Tfe=Math.pow(2,31);function EF(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Tfe;)e[t++]=r&255|qI,r/=128;for(;r&_fe;)e[t++]=r&255|qI,r>>>=7;return e[t]=r|0,EF.bytes=t-n+1,e}var $fe=L7,Pfe=128,WI=127;function L7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw L7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&WI)<<i:(o&WI)*Math.pow(2,i),i+=7}while(o>=Pfe);return L7.bytes=s-n,t}var Dfe=Math.pow(2,7),Nfe=Math.pow(2,14),Ofe=Math.pow(2,21),Rfe=Math.pow(2,28),Bfe=Math.pow(2,35),Lfe=Math.pow(2,42),Mfe=Math.pow(2,49),Ufe=Math.pow(2,56),Ffe=Math.pow(2,63),zfe=function(r){return r<Dfe?1:r<Nfe?2:r<Ofe?3:r<Rfe?4:r<Bfe?5:r<Lfe?6:r<Mfe?7:r<Ufe?8:r<Ffe?9:10},Vfe={encode:Ife,decode:$fe,encodingLength:zfe},Sy=Vfe;function M7(r,e=0){return[Sy.decode(r,e),Sy.decode.bytes]}function Ay(r,e,t=0){return Sy.encode(r,e,t),e}function Cy(r){return Sy.encodingLength(r)}function Kfe(r,e){const t=e.byteLength,n=Cy(r),i=n+Cy(t),s=new Uint8Array(i+t);return Ay(r,s,0),Ay(t,s,n),s.set(e,i),new $x(r,t,e,s)}function xF(r){const e=Tx(r),[t,n]=M7(e),[i,s]=M7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new $x(t,i,o,e)}function jfe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&mfe(r.bytes,t.bytes)}}let $x=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function GI(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return qfe(t,U7(r),e??fa.encoder);default:return Wfe(t,U7(r),e??O2.encoder)}}const QI=new WeakMap;function U7(r){const e=QI.get(r);if(e==null){const t=new Map;return QI.set(r,t),t}return e}var aD;let YI=class Or{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,aD,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==af)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Gfe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Or.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Kfe(e,t);return Or.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Or.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&jfe(e.multihash,n.multihash)}toString(e){return GI(this,e)}toJSON(){return{"/":GI(this)}}link(){return this}[(aD=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Or)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Or(n,i,s,o??JI(n,i,s.bytes))}else if(t[Qfe]===!0){const{version:n,multihash:i,code:s}=t,o=xF(i);return Or.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==af)throw new Error(`Version 0 CID must use dag-pb (code: ${af}) block encoding`);return new Or(e,t,n,n.bytes)}case 1:{const i=JI(e,t,n.bytes);return new Or(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Or.create(0,af,e)}static createV1(e,t){return Or.create(1,e,t)}static decode(e){const[t,n]=Or.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Or.inspectBytes(e),n=t.size-t.multihashSize,i=Tx(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new $x(t.multihashCode,t.digestSize,s,i);return[t.version===0?Or.createV0(o):Or.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=M7(e.subarray(t));return t+=p,h};let i=n(),s=af;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=Hfe(e,t),s=Or.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return U7(s).set(n,e),s}};function Hfe(r,e){switch(r[0]){case"Q":{const t=e??fa;return[fa.prefix,t.decode(`${fa.prefix}${r}`)]}case fa.prefix:{const t=e??fa;return[fa.prefix,t.decode(r)]}case O2.prefix:{const t=e??O2;return[O2.prefix,t.decode(r)]}case B8.prefix:{const t=e??B8;return[B8.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function qfe(r,e,t){const{prefix:n}=t;if(n!==fa.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Wfe(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const af=112,Gfe=18;function JI(r,e,t){const n=Cy(r),i=n+Cy(e),s=new Uint8Array(i+t.byteLength);return Ay(r,s,0),Ay(e,s,n),s.set(t,i),s}const Qfe=Symbol.for("@ipld/js-cid/CID"),Yfe=gh("ipns:utils"),SF=se("/ipns/"),Jfe=0,Xfe=18;function Zfe(r){let e;if(r.pubKey!=null)try{e=Ji(r.pubKey)}catch(t){throw Yfe.error(t),t}if(e!=null)return e}function e1e(r){const e=se("ipns-signature:");return pr([e,r])}function AF(r){return"signatureV1"in r?qi.encode({value:se(r.value),signatureV1:r.signatureV1,validityType:r.validityType,validity:se(r.validity),sequence:r.sequence,ttl:r.ttl,pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data}):qi.encode({pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data})}function C0(r){const e=qi.decode(r);if(e.sequence!=null&&(e.sequence=BigInt(e.sequence)),e.ttl!=null&&(e.ttl=BigInt(e.ttl)),e.signatureV2==null||e.data==null)throw new Aa("Missing data or signatureV2");const t=kF(e.data),n=t1e(t.Value),i=re(t.Validity);if(e.value!=null&&e.signatureV1!=null)return r1e(e),{value:n,validityType:qi.ValidityType.EOL,validity:i,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV1:e.signatureV1,signatureV2:e.signatureV2,data:e.data};if(e.signatureV2!=null)return{value:n,validityType:qi.ValidityType.EOL,validity:i,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}function CF(r){return pr([SF,r.bytes])}function F7(r){const e=xF(r.slice(SF.length));if(!z7(e,Jfe)&&!z7(e,Xfe))throw new Im("Multihash in IPNS key was not identity or sha2-256");return e}function kF(r){const e=xa(r);if(e.ValidityType===0)e.ValidityType=qi.ValidityType.EOL;else throw new _x("The validity type is unsupported");return Number.isInteger(e.Sequence)&&(e.Sequence=BigInt(e.Sequence)),Number.isInteger(e.TTL)&&(e.TTL=BigInt(e.TTL)),e}function t1e(r){const e=re(r).trim();if(e.startsWith("/"))return e;try{return`/ipfs/${YI.decode(r).toV1().toString()}`}catch{}try{return`/ipfs/${YI.parse(e).toV1().toString()}`}catch{}throw new mF("Value must be a valid content path starting with /")}function r1e(r){if(r.data==null)throw new wF("Record data is missing");const e=kF(r.data);if(!Fe(e.Value,r.value??new Uint8Array(0)))throw new Aa('Field "value" did not match between protobuf and CBOR');if(!Fe(e.Validity,r.validity??new Uint8Array(0)))throw new Aa('Field "validity" did not match between protobuf and CBOR');if(e.ValidityType!==r.validityType)throw new Aa('Field "validityType" did not match between protobuf and CBOR');if(e.Sequence!==r.sequence)throw new Aa('Field "sequence" did not match between protobuf and CBOR');if(e.TTL!==r.ttl)throw new Aa('Field "ttl" did not match between protobuf and CBOR')}function z7(r,e){return r.code===e}const Mp=gh("ipns:validator"),n1e=1024*10,i1e=async(r,e)=>{const t=C0(e);let n;try{const i=e1e(t.data);n=await r.verify(i,t.signatureV2)}catch{n=!1}if(!n)throw Mp.error("record signature verification failed"),new Aa("Record signature verification failed");if(t.validityType===qi.ValidityType.EOL){if(R7.fromString(t.validity).toDate().getTime()<Date.now())throw Mp.error("record has expired"),new gF("record has expired")}else if(t.validityType!=null)throw Mp.error("the validity type is unsupported"),new _x("The validity type is unsupported");Mp("ipns record for %s is valid",t.value)};async function IF(r,e){if(e.byteLength>n1e)throw new yF("The record is too large");const t=F7(r);let n;z7(t,0)&&(n=qL(t));const i=C0(e),s=Zfe(i)??n;if(s==null)throw new B7("Could not extract public key from IPNS record or routing key");const o=CF(s.toMultihash());if(!Fe(o,r))throw new B7("Embedded public key did not match routing key");await i1e(s,e)}let s1e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MESSAGE_LENGTH")}};async function*XI(r,e={}){const t=/\r?\n/,n=new TextDecoder("utf8");let i="";for await(let s of r){if(typeof s=="string"&&(s=new TextEncoder().encode(s)),bf(s)&&(s=s.subarray()),i+=n.decode(s,{stream:!0}),i.length>((e==null?void 0:e.maxMessageLength)??i.length))throw new s1e("Incoming message too long");const o=i.split(t);i=o.pop()??"";for(let a=0;a<o.length;a++)yield JSON.parse(o[a])}i+=n.decode(),i!==""&&(yield JSON.parse(i))}class R2 extends Error{constructor(e="Invalid request"){super(e),this.name="InvalidRequestError"}}u(R2,"name","InvalidRequestError");class Hs extends Error{constructor(e="Bad response"){super(e),this.name="BadResponseError"}}u(Hs,"name","BadResponseError");function o1e(r){return r[Symbol.asyncIterator]!=null}function a1e(r){if(o1e(r))return(async()=>{for await(const e of r)return e})();for(const e of r)return e}function c1e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Px(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function l1e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var u1e=l1e,d1e=u1e;let h1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},f1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return _F(this,e)}},p1e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return _F(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function _F(r,e){return new p1e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let g1e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new h1e(e,t,n),this.decoder=new f1e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function TF({name:r,prefix:e,encode:t,decode:n}){return new g1e(r,e,t,n)}function s4({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=d1e(t,r);return TF({prefix:e,name:r,encode:n,decode:s=>Px(i(s))})}function y1e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function m1e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Oo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return TF({prefix:e,name:r,encode(i){return m1e(i,n,t)},decode(i){return y1e(i,n,t,r)}})}const B2=Oo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Oo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Oo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Oo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Oo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Oo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Oo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Oo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Oo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const L8=s4({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});s4({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const pa=s4({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});s4({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var w1e=$F,ZI=128,b1e=-128,v1e=Math.pow(2,31);function $F(r,e,t){e=e||[],t=t||0;for(var n=t;r>=v1e;)e[t++]=r&255|ZI,r/=128;for(;r&b1e;)e[t++]=r&255|ZI,r>>>=7;return e[t]=r|0,$F.bytes=t-n+1,e}var E1e=V7,x1e=128,e_=127;function V7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw V7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&e_)<<i:(o&e_)*Math.pow(2,i),i+=7}while(o>=x1e);return V7.bytes=s-n,t}var S1e=Math.pow(2,7),A1e=Math.pow(2,14),C1e=Math.pow(2,21),k1e=Math.pow(2,28),I1e=Math.pow(2,35),_1e=Math.pow(2,42),T1e=Math.pow(2,49),$1e=Math.pow(2,56),P1e=Math.pow(2,63),D1e=function(r){return r<S1e?1:r<A1e?2:r<C1e?3:r<k1e?4:r<I1e?5:r<_1e?6:r<T1e?7:r<$1e?8:r<P1e?9:10},N1e={encode:w1e,decode:E1e,encodingLength:D1e},ky=N1e;function K7(r,e=0){return[ky.decode(r,e),ky.decode.bytes]}function Iy(r,e,t=0){return ky.encode(r,e,t),e}function _y(r){return ky.encodingLength(r)}function O1e(r,e){const t=e.byteLength,n=_y(r),i=n+_y(t),s=new Uint8Array(i+t);return Iy(r,s,0),Iy(t,s,n),s.set(e,i),new Dx(r,t,e,s)}function R1e(r){const e=Px(r),[t,n]=K7(e),[i,s]=K7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Dx(t,i,o,e)}function B1e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&c1e(r.bytes,t.bytes)}}let Dx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function t_(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return M1e(t,j7(r),e??pa.encoder);default:return U1e(t,j7(r),e??B2.encoder)}}const r_=new WeakMap;function j7(r){const e=r_.get(r);if(e==null){const t=new Map;return r_.set(r,t),t}return e}var cD;let n_=class Rr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,cD,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==cf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==F1e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Rr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=O1e(e,t);return Rr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Rr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&B1e(e.multihash,n.multihash)}toString(e){return t_(this,e)}toJSON(){return{"/":t_(this)}}link(){return this}[(cD=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Rr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Rr(n,i,s,o??i_(n,i,s.bytes))}else if(t[z1e]===!0){const{version:n,multihash:i,code:s}=t,o=R1e(i);return Rr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==cf)throw new Error(`Version 0 CID must use dag-pb (code: ${cf}) block encoding`);return new Rr(e,t,n,n.bytes)}case 1:{const i=i_(e,t,n.bytes);return new Rr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Rr.create(0,cf,e)}static createV1(e,t){return Rr.create(1,e,t)}static decode(e){const[t,n]=Rr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Rr.inspectBytes(e),n=t.size-t.multihashSize,i=Px(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new Dx(t.multihashCode,t.digestSize,s,i);return[t.version===0?Rr.createV0(o):Rr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=K7(e.subarray(t));return t+=p,h};let i=n(),s=cf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=L1e(e,t),s=Rr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return j7(s).set(n,e),s}};function L1e(r,e){switch(r[0]){case"Q":{const t=e??pa;return[pa.prefix,t.decode(`${pa.prefix}${r}`)]}case pa.prefix:{const t=e??pa;return[pa.prefix,t.decode(r)]}case B2.prefix:{const t=e??B2;return[B2.prefix,t.decode(r)]}case L8.prefix:{const t=e??L8;return[L8.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function M1e(r,e,t){const{prefix:n}=t;if(n!==pa.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function U1e(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const cf=112,F1e=18;function i_(r,e,t){const n=_y(r),i=n+_y(e),s=new Uint8Array(i+t.byteLength);return Iy(r,s,0),Iy(e,s,n),s.set(t,i),s}const z1e=Symbol.for("@ipld/js-cid/CID"),s_=se("/ipns/");function o_(r){return Fe(r.subarray(0,s_.byteLength),s_)}class V1e{constructor(e){u(this,"client");this.client=e}async*findProviders(e,t={}){yield*fh(this.client.getProviders(e,t),n=>({id:n.ID,multiaddrs:n.Addrs??[]}))}async provide(){}async cancelReprovide(){}async put(e,t,n){if(!o_(e))return;const i=F7(e),s=n_.createV1(114,i),o=C0(t);await this.client.putIPNS(s,o,n)}async get(e,t){if(!o_(e))throw new jt("Not found");const n=F7(e),i=n_.createV1(114,n);try{const s=await this.client.getIPNS(i,t);return AF(s)}catch(s){throw s.name==="BadResponseError"?new jt("Not found"):s}}}class K1e{constructor(e){u(this,"client");this.client=e}async findPeer(e,t={}){const n=await a1e(this.client.getPeers(e,t));if(n!=null)return{id:n.ID,multiaddrs:n.Addrs??[]};throw new jt("Not found")}async*getClosestPeers(e,t={}){}}const Jt=gh("delegated-routing-v1-http-api-client"),Up={concurrentRequests:4,timeout:3e4,cacheTTL:5*60*1e3,cacheName:"delegated-routing-v1-cache"};var en,Af,H7,Cf;class j1e{constructor(e,t={}){qe(this,en);u(this,"started");u(this,"httpQueue");u(this,"shutDownController");u(this,"clientUrl");u(this,"timeout");u(this,"contentRouting");u(this,"peerRouting");u(this,"filterAddrs");u(this,"filterProtocols");u(this,"inFlightRequests");u(this,"cacheName");u(this,"cache");u(this,"cacheTTL");this.started=!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.httpQueue=new Za({concurrency:t.concurrentRequests??Up.concurrentRequests}),this.inFlightRequests=new Map,this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=t.timeout??Up.timeout,this.filterAddrs=t.filterAddrs,this.filterProtocols=t.filterProtocols,this.contentRouting=new V1e(this),this.peerRouting=new K1e(this),this.cacheName=t.cacheName??Up.cacheName,this.cacheTTL=t.cacheTTL??Up.cacheTTL}get[Sd](){return this.contentRouting}get[Ad](){return this.peerRouting}isStarted(){return this.started}async start(){var e;this.started||(this.started=!0,this.cacheTTL>0&&(this.cache=await((e=globalThis.caches)==null?void 0:e.open(this.cacheName)),this.cache!=null&&Jt("cache enabled with ttl %d",this.cacheTTL)))}async stop(){var e;this.httpQueue.clear(),this.shutDownController.abort(),await((e=globalThis.caches)==null?void 0:e.delete(this.cacheName)),this.started=!1}async*getProviders(e,t={}){Jt("getProviders starts: %c",e);const n=AbortSignal.timeout(this.timeout),i=ct([this.shutDownController.signal,n,t.signal]),s=De(),o=De();this.httpQueue.add(async()=>(s.resolve(),o.promise));try{await s.promise;const a=new URL(`${this.clientUrl}routing/v1/providers/${e.toString()}`);Ae(this,en,H7).call(this,a,t.filterAddrs,t.filterProtocols);const c={headers:{Accept:"application/x-ndjson"},signal:i},l=await Ae(this,en,Cf).call(this,a.toString(),c);if(l==null)throw new Hs("No response received");if(!l.ok)throw l.status===404?new jt("No matching records found"):l.status===422?new R2("Request does not conform to schema or semantic constraints"):new Hs(`Unexpected status code: ${l.status}`);if(l.body==null)throw new Hs("Routing response had no body");const d=l.headers.get("Content-Type");if(d==null)throw new Hs("No Content-Type header received");if(d!=null&&d.startsWith("application/json")){const h=await l.json();for(const p of h.Providers){const b=Ae(this,en,Af).call(this,p);b!=null&&(yield b)}}else if(d.includes("application/x-ndjson"))for await(const h of XI(HI(l.body))){const p=Ae(this,en,Af).call(this,h);p!=null&&(yield p)}else throw new Hs(`Unsupported Content-Type: ${d}`)}catch(a){Jt.error("getProviders errored:",a)}finally{i.clear(),o.resolve(),Jt("getProviders finished: %c",e)}}async*getPeers(e,t={}){Jt("getPeers starts: %c",e);const n=AbortSignal.timeout(this.timeout),i=ct([this.shutDownController.signal,n,t.signal]),s=De(),o=De();this.httpQueue.add(async()=>(s.resolve(),o.promise));try{await s.promise;const a=new URL(`${this.clientUrl}routing/v1/peers/${e.toCID().toString()}`);Ae(this,en,H7).call(this,a,t.filterAddrs,t.filterProtocols);const c={headers:{Accept:"application/x-ndjson"},signal:i},l=await Ae(this,en,Cf).call(this,a.toString(),c);if(l.status===404)throw new jt("No matching records found");if(l.status===422)throw new R2("Request does not conform to schema or semantic constraints");if(l.body==null)throw new Hs("Routing response had no body");if(l.headers.get("Content-Type")==="application/json"){const h=await l.json();for(const p of h.Peers){const b=Ae(this,en,Af).call(this,p);b!=null&&(yield b)}}else for await(const h of XI(HI(l.body))){const p=Ae(this,en,Af).call(this,h);p!=null&&(yield p)}}catch(a){Jt.error("getPeers errored:",a)}finally{i.clear(),o.resolve(),Jt("getPeers finished: %c",e)}}async getIPNS(e,t={}){Jt("getIPNS starts: %s",e);const n=AbortSignal.timeout(this.timeout),i=ct([this.shutDownController.signal,n,t.signal]),s=De(),o=De();this.httpQueue.add(async()=>(s.resolve(),o.promise));const a=`${this.clientUrl}routing/v1/ipns/${e}`;try{await s.promise;const c={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:i},l=await Ae(this,en,Cf).call(this,a,c);if(Jt("getIPNS GET %s %d",a,l.status),l.status===404)throw new jt("No matching records found");if(l.status===422)throw new R2("Request does not conform to schema or semantic constraints");if(l.body==null)throw new Hs("GET ipns response had no body");const d=await l.arrayBuffer(),h=new Uint8Array(d,0,d.byteLength);return t.validate!==!1&&await IF(CF(e.multihash),h),C0(h)}catch(c){throw Jt.error("getIPNS GET %s error:",a,c),c}finally{i.clear(),o.resolve(),Jt("getIPNS finished: %s",e)}}async putIPNS(e,t,n={}){Jt("putIPNS starts: %c",e);const i=AbortSignal.timeout(this.timeout),s=ct([this.shutDownController.signal,i,n.signal]),o=De(),a=De();this.httpQueue.add(async()=>(o.resolve(),a.promise));const c=`${this.clientUrl}routing/v1/ipns/${e}`;try{await o.promise;const l=AF(t),d={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:l,signal:s},h=await Ae(this,en,Cf).call(this,c,d);if(Jt("putIPNS PUT %s %d",c,h.status),h.status!==200)throw new Hs("PUT ipns response had status other than 200")}catch(l){throw Jt.error("putIPNS PUT %s error:",c,l.stack),l}finally{s.clear(),a.resolve(),Jt("putIPNS finished: %c",e)}}}en=new WeakSet,Af=function(e){var t;try{const n=[],i=((t=e.Addrs)==null?void 0:t.map(Te))??[];return e.Protocols!=null&&n.push(...e.Protocols),e.Protocol!=null&&(n.push(e.Protocol),delete e.Protocol),{...e,Schema:"peer",ID:xn(e.ID),Addrs:i,Protocols:n}}catch(n){Jt.error("could not conform record to peer schema",n)}},H7=function(e,t,n){var i,s;if(t!=null||this.filterAddrs!=null){const o=(t==null?void 0:t.join(","))??((i=this.filterAddrs)==null?void 0:i.join(","))??"";o!==""&&e.searchParams.set("filter-addrs",o)}if(n!=null||this.filterProtocols!=null){const o=(n==null?void 0:n.join(","))??((s=this.filterProtocols)==null?void 0:s.join(","))??"";o!==""&&e.searchParams.set("filter-protocols",o)}},Cf=async function(e,t){var c,l;const n=t.method??"GET",i=`${n}-${e}`;if(n==="GET"){const d=await((c=this.cache)==null?void 0:c.match(e));if(d!=null){if(parseInt(d.headers.get("x-cache-expires")??"0",10)>Date.now())return Jt("returning cached response for %s",i),d;await((l=this.cache)==null?void 0:l.delete(e))}}const s=this.inFlightRequests.get(i);if(s!=null){const d=await s;return Jt("deduplicating outgoing request for %s",i),d.clone()}const o=fetch(e,t).then(async d=>{if(this.cache!=null&&d.ok&&n==="GET"){const h=Date.now()+this.cacheTTL,p=new Headers(d.headers);p.set("x-cache-expires",h.toString());const b=new Response(d.clone().body,{status:d.status,statusText:d.statusText,headers:p});await this.cache.put(e,b)}return d}).finally(()=>{this.inFlightRequests.delete(i)});return this.inFlightRequests.set(i,o),await o};function H1e(r,e={}){return new j1e(new URL(r),e)}function q1e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function o4(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function W1e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var G1e=W1e,Q1e=G1e;let Y1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},J1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return PF(this,e)}},X1e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return PF(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function PF(r,e){return new X1e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Z1e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Y1e(e,t,n),this.decoder=new J1e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function DF({name:r,prefix:e,encode:t,decode:n}){return new Z1e(r,e,t,n)}function a4({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Q1e(t,r);return DF({prefix:e,name:r,encode:n,decode:s=>o4(i(s))})}function e0e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function t0e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Ro({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return DF({prefix:e,name:r,encode(i){return t0e(i,n,t)},decode(i){return e0e(i,n,t,r)}})}const L2=Ro({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Ro({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Ro({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Ro({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Ro({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Ro({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Ro({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Ro({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Ro({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const M8=a4({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});a4({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const ga=a4({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});a4({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var r0e=NF,a_=128,n0e=-128,i0e=Math.pow(2,31);function NF(r,e,t){e=e||[],t=t||0;for(var n=t;r>=i0e;)e[t++]=r&255|a_,r/=128;for(;r&n0e;)e[t++]=r&255|a_,r>>>=7;return e[t]=r|0,NF.bytes=t-n+1,e}var s0e=q7,o0e=128,c_=127;function q7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw q7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&c_)<<i:(o&c_)*Math.pow(2,i),i+=7}while(o>=o0e);return q7.bytes=s-n,t}var a0e=Math.pow(2,7),c0e=Math.pow(2,14),l0e=Math.pow(2,21),u0e=Math.pow(2,28),d0e=Math.pow(2,35),h0e=Math.pow(2,42),f0e=Math.pow(2,49),p0e=Math.pow(2,56),g0e=Math.pow(2,63),y0e=function(r){return r<a0e?1:r<c0e?2:r<l0e?3:r<u0e?4:r<d0e?5:r<h0e?6:r<f0e?7:r<p0e?8:r<g0e?9:10},m0e={encode:r0e,decode:s0e,encodingLength:y0e},Ty=m0e;function W7(r,e=0){return[Ty.decode(r,e),Ty.decode.bytes]}function $y(r,e,t=0){return Ty.encode(r,e,t),e}function Py(r){return Ty.encodingLength(r)}function OF(r,e){const t=e.byteLength,n=Py(r),i=n+Py(t),s=new Uint8Array(i+t);return $y(r,s,0),$y(t,s,n),s.set(e,i),new Nx(r,t,e,s)}function w0e(r){const e=o4(r),[t,n]=W7(e),[i,s]=W7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Nx(t,i,o,e)}function b0e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&q1e(r.bytes,t.bytes)}}let Nx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function l_(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return x0e(t,G7(r),e??ga.encoder);default:return S0e(t,G7(r),e??L2.encoder)}}const u_=new WeakMap;function G7(r){const e=u_.get(r);if(e==null){const t=new Map;return u_.set(r,t),t}return e}var lD;let v0e=class Br{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,lD,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==lf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==A0e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Br.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=OF(e,t);return Br.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Br.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&b0e(e.multihash,n.multihash)}toString(e){return l_(this,e)}toJSON(){return{"/":l_(this)}}link(){return this}[(lD=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Br)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Br(n,i,s,o??d_(n,i,s.bytes))}else if(t[C0e]===!0){const{version:n,multihash:i,code:s}=t,o=w0e(i);return Br.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==lf)throw new Error(`Version 0 CID must use dag-pb (code: ${lf}) block encoding`);return new Br(e,t,n,n.bytes)}case 1:{const i=d_(e,t,n.bytes);return new Br(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Br.create(0,lf,e)}static createV1(e,t){return Br.create(1,e,t)}static decode(e){const[t,n]=Br.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Br.inspectBytes(e),n=t.size-t.multihashSize,i=o4(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new Nx(t.multihashCode,t.digestSize,s,i);return[t.version===0?Br.createV0(o):Br.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=W7(e.subarray(t));return t+=p,h};let i=n(),s=lf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=E0e(e,t),s=Br.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return G7(s).set(n,e),s}};function E0e(r,e){switch(r[0]){case"Q":{const t=e??ga;return[ga.prefix,t.decode(`${ga.prefix}${r}`)]}case ga.prefix:{const t=e??ga;return[ga.prefix,t.decode(r)]}case L2.prefix:{const t=e??L2;return[L2.prefix,t.decode(r)]}case M8.prefix:{const t=e??M8;return[M8.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function x0e(r,e,t){const{prefix:n}=t;if(n!==ga.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function S0e(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const lf=112,A0e=18;function d_(r,e,t){const n=Py(r),i=n+Py(e),s=new Uint8Array(i+t.byteLength);return $y(r,s,0),$y(e,s,n),s.set(t,i),s}const C0e=Symbol.for("@ipld/js-cid/CID");function k0e(){return{filterProtocols:["unknown","transport-bitswap","transport-ipfs-gateway-http"],filterAddrs:["https","webtransport","webrtc","webrtc-direct","wss","tls"]}}const h_="[a-fA-F\\d:]",$a=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${h_})|(?<=${h_})(?=\\s|$))`:"",Bi="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",Vt="[a-fA-F\\d]{1,4}",c4=`
(?:
(?:${Vt}:){7}(?:${Vt}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${Vt}:){6}(?:${Bi}|:${Vt}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${Vt}:){5}(?::${Bi}|(?::${Vt}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${Vt}:){4}(?:(?::${Vt}){0,1}:${Bi}|(?::${Vt}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${Vt}:){3}(?:(?::${Vt}){0,2}:${Bi}|(?::${Vt}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${Vt}:){2}(?:(?::${Vt}){0,3}:${Bi}|(?::${Vt}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${Vt}:){1}(?:(?::${Vt}){0,4}:${Bi}|(?::${Vt}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${Vt}){0,5}:${Bi}|(?::${Vt}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),I0e=new RegExp(`(?:^${Bi}$)|(?:^${c4}$)`),_0e=new RegExp(`^${Bi}$`),T0e=new RegExp(`^${c4}$`),l4=r=>r&&r.exact?I0e:new RegExp(`(?:${$a(r)}${Bi}${$a(r)})|(?:${$a(r)}${c4}${$a(r)})`,"g");l4.v4=r=>r&&r.exact?_0e:new RegExp(`${$a(r)}${Bi}${$a(r)}`,"g");l4.v6=r=>r&&r.exact?T0e:new RegExp(`${$a(r)}${c4}${$a(r)}`,"g");function $0e(r){const e=(...t)=>r(...t);return Object.defineProperty(e,"name",{value:`functionTimeout(${r.name||"<anonymous>"})`,configurable:!0}),e}const{toString:P0e}=Object.prototype;function D0e(r){return P0e.call(r)==="[object RegExp]"}const f_={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function N0e(r,e={}){if(!D0e(r))throw new TypeError("Expected a RegExp instance");const t=Object.keys(f_).map(i=>(typeof e[i]=="boolean"?e[i]:r[i])?f_[i]:"").join(""),n=new RegExp(e.source||r.source,t);return n.lastIndex=typeof e.lastIndex=="number"?e.lastIndex:r.lastIndex,n}function RF(r,e,{timeout:t}={}){try{return $0e(()=>N0e(r).test(e),{timeout:t})()}catch(n){throw n}}const O0e=15,R0e=45,BF={timeout:400};function p_(r){return r.length>R0e?!1:RF(l4.v6({exact:!0}),r,BF)}function B0e(r){return r.length>O0e?!1:RF(l4.v4({exact:!0}),r,BF)}const g_={http:"80",https:"443",ws:"80",wss:"443"},L0e=["http","https","ws","wss"];function M0e(r,e){e=e??{};const t=e.defaultDnsType??"dns4",{scheme:n,hostname:i,port:s,path:o}=U0e(r),a=[F0e(i,t),z0e(s,n),V0e(n)];o!=null&&a.push(K0e(o));const c="/"+a.filter(l=>!!l).reduce((l,d)=>l.concat(d),[]).join("/");return Te(c)}function U0e(r){const[e]=r.split(":");L0e.includes(e)||(r="http"+r.substring(e.length));let{protocol:t,hostname:n,port:i,pathname:s,search:o}=new URL(r);if(i==null||i===""){const c=j0e(e);c!=null&&(i=c),c==null&&t==="http:"&&(i="80")}let a;return s!=null&&s!==""&&s!=="/"&&(s.startsWith("/")&&(s=s.substring(1)),a=s),o!=null&&o!==""&&(a=a??"",a+=o),{scheme:e,hostname:n,port:i,path:a}}function F0e(r,e){if(!(r==null||r==="")){if(B0e(r))return["ip4",r];if(p_(r))return["ip6",r];if(r[0]==="["){const t=r.substring(1,r.length-1);if(p_(t))return["ip6",t]}return[e,r]}}function z0e(r,e){if(!(r==null||r===""))return e==="udp"?["udp",r]:["tcp",r]}function V0e(r){if(r.match(/^tcp$|^udp$/)==null)return[r]}function K0e(r){if(!(r==null||r===""))return["http-path",encodeURIComponent(r)]}function j0e(r){if(!(r==null||r===""||g_[r]==null))return g_[r]}const LF=0,H0e="identity",MF=o4;function q0e(r){return OF(LF,MF(r))}const W0e={code:LF,name:H0e,encode:MF,digest:q0e},G0e=["https://trustless-gateway.link","https://4everland.io"],Q0e=2336;function Y0e(r){return r=r.toString(),{id:ph(v0e.createV1(Q0e,W0e.digest(se(r)))),multiaddrs:[M0e(r)]}}class J0e{constructor(e={}){u(this,"gateways");this.gateways=(e.gateways??G0e).map(t=>Y0e(t))}async*findProviders(e,t){yield*this.gateways.toSorted(()=>Math.random()>.5?1:-1).map(n=>({...n,protocols:["transport-ipfs-gateway-http"]}))}}function X0e(r={}){return new J0e(r)}class Z0e{constructor(e){u(this,"libp2p");this.libp2p=e}async provide(e,t){await this.libp2p.contentRouting.provide(e,t)}async cancelReprovide(e,t){await this.libp2p.contentRouting.cancelReprovide(e,t)}async*findProviders(e,t){yield*this.libp2p.contentRouting.findProviders(e,t)}async put(e,t,n){await this.libp2p.contentRouting.put(e,t,n)}async get(e,t){return this.libp2p.contentRouting.get(e,t)}async findPeer(e,t){return this.libp2p.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t){yield*this.libp2p.peerRouting.getClosestPeers(e,t)}}function epe(r){return new Z0e(r)}function tpe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Ox(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function rpe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var npe=rpe,ipe=npe;let spe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ope=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return UF(this,e)}},ape=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return UF(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function UF(r,e){return new ape({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let cpe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new spe(e,t,n),this.decoder=new ope(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function FF({name:r,prefix:e,encode:t,decode:n}){return new cpe(r,e,t,n)}function u4({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=ipe(t,r);return FF({prefix:e,name:r,encode:n,decode:s=>Ox(i(s))})}function lpe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function upe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Bo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return FF({prefix:e,name:r,encode(i){return upe(i,n,t)},decode(i){return lpe(i,n,t,r)}})}const no=Bo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Bo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Bo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Bo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Bo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Bo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Bo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Bo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Bo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const U8=u4({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});u4({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const ya=u4({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});u4({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var dpe=zF,y_=128,hpe=-128,fpe=Math.pow(2,31);function zF(r,e,t){e=e||[],t=t||0;for(var n=t;r>=fpe;)e[t++]=r&255|y_,r/=128;for(;r&hpe;)e[t++]=r&255|y_,r>>>=7;return e[t]=r|0,zF.bytes=t-n+1,e}var ppe=Q7,gpe=128,m_=127;function Q7(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Q7.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&m_)<<i:(o&m_)*Math.pow(2,i),i+=7}while(o>=gpe);return Q7.bytes=s-n,t}var ype=Math.pow(2,7),mpe=Math.pow(2,14),wpe=Math.pow(2,21),bpe=Math.pow(2,28),vpe=Math.pow(2,35),Epe=Math.pow(2,42),xpe=Math.pow(2,49),Spe=Math.pow(2,56),Ape=Math.pow(2,63),Cpe=function(r){return r<ype?1:r<mpe?2:r<wpe?3:r<bpe?4:r<vpe?5:r<Epe?6:r<xpe?7:r<Spe?8:r<Ape?9:10},kpe={encode:dpe,decode:ppe,encodingLength:Cpe},Dy=kpe;function Y7(r,e=0){return[Dy.decode(r,e),Dy.decode.bytes]}function Ny(r,e,t=0){return Dy.encode(r,e,t),e}function Oy(r){return Dy.encodingLength(r)}function Ipe(r,e){const t=e.byteLength,n=Oy(r),i=n+Oy(t),s=new Uint8Array(i+t);return Ny(r,s,0),Ny(t,s,n),s.set(e,i),new Rx(r,t,e,s)}function VF(r){const e=Ox(r),[t,n]=Y7(e),[i,s]=Y7(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Rx(t,i,o,e)}function _pe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&tpe(r.bytes,t.bytes)}}let Rx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function w_(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Ppe(t,J7(r),e??ya.encoder);default:return Dpe(t,J7(r),e??no.encoder)}}const b_=new WeakMap;function J7(r){const e=b_.get(r);if(e==null){const t=new Map;return b_.set(r,t),t}return e}var uD;let Tpe=class Lr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,uD,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==uf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Npe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Lr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Ipe(e,t);return Lr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Lr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&_pe(e.multihash,n.multihash)}toString(e){return w_(this,e)}toJSON(){return{"/":w_(this)}}link(){return this}[(uD=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Lr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Lr(n,i,s,o??v_(n,i,s.bytes))}else if(t[Ope]===!0){const{version:n,multihash:i,code:s}=t,o=VF(i);return Lr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==uf)throw new Error(`Version 0 CID must use dag-pb (code: ${uf}) block encoding`);return new Lr(e,t,n,n.bytes)}case 1:{const i=v_(e,t,n.bytes);return new Lr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Lr.create(0,uf,e)}static createV1(e,t){return Lr.create(1,e,t)}static decode(e){const[t,n]=Lr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Lr.inspectBytes(e),n=t.size-t.multihashSize,i=Ox(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new Rx(t.multihashCode,t.digestSize,s,i);return[t.version===0?Lr.createV0(o):Lr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=Y7(e.subarray(t));return t+=p,h};let i=n(),s=uf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=$pe(e,t),s=Lr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return J7(s).set(n,e),s}};function $pe(r,e){switch(r[0]){case"Q":{const t=e??ya;return[ya.prefix,t.decode(`${ya.prefix}${r}`)]}case ya.prefix:{const t=e??ya;return[ya.prefix,t.decode(r)]}case no.prefix:{const t=e??no;return[no.prefix,t.decode(r)]}case U8.prefix:{const t=e??U8;return[U8.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Ppe(r,e,t){const{prefix:n}=t;if(n!==ya.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Dpe(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const uf=112,Npe=18;function v_(r,e,t){const n=Oy(r),i=n+Oy(e),s=new Uint8Array(i+t.byteLength);return Ny(r,s,0),Ny(e,s,n),s.set(t,i),s}const Ope=Symbol.for("@ipld/js-cid/CID"),Rpe=85;class Bpe extends kU{constructor(){super();u(this,"data");this.data=new Map}put(t,n){return this.data.set(no.encode(t.multihash.bytes),n),t}get(t){const n=this.data.get(no.encode(t.multihash.bytes));if(n==null)throw new $1;return n}has(t){return this.data.has(no.encode(t.multihash.bytes))}async delete(t){this.data.delete(no.encode(t.multihash.bytes))}async*getAll(){for(const[t,n]of this.data.entries())yield{cid:Tpe.createV1(Rpe,VF(no.decode(t))),block:n}}}gh("blockstore:core:tiered");const Lpe="SHARDING";function Mpe(r){return r[Symbol.asyncIterator]!=null}function Ry(r){if(Mpe(r))return(async()=>{const t=[];for await(const n of r)t.push(n);return t})();const e=[];for(const t of r)e.push(t);return e}function Upe(r){return r[Symbol.asyncIterator]!=null}function E_(r,e){return Upe(r)?async function*(){yield*(await Ry(r)).sort(e)}():function*(){yield*Ry(r).sort(e)}()}class Fpe{put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:i}of e)await this.put(n,i,t),yield n}async*getMany(e,t={}){for await(const n of e)yield{key:n,value:await this.get(n,t)}}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await vo(this.putMany(e,n)),e=[],await vo(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null){const i=e.prefix;n=Fc(n,s=>s.key.toString().startsWith(i))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>Fc(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>E_(i,s),n)),e.offset!=null){let i=0;const s=e.offset;n=Fc(n,()=>i++>=s)}return e.limit!=null&&(n=Hg(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null){const i=e.prefix;n=Fc(n,s=>s.toString().startsWith(i))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>Fc(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>E_(i,s),n)),e.offset!=null){const i=e.offset;let s=0;n=Fc(n,()=>s++>=i)}return e.limit!=null&&(n=Hg(n,e.limit)),n}}class KF extends Fpe{constructor(){super();u(this,"data");this.data=new Map}put(t,n){return this.data.set(t.toString(),n),t}get(t){const n=this.data.get(t.toString());if(n==null)throw new $1;return n}has(t){return this.data.has(t.toString())}delete(t){this.data.delete(t.toString())}*_all(){for(const[t,n]of this.data.entries())yield{key:new ht(t),value:n}}*_allKeys(){for(const t of this.data.keys())yield new ht(t)}}new ht(Lpe);gh("datastore:core:tiered");class zpe extends fue{constructor(t){super({...t,components:{libp2p:t.libp2p}});u(this,"libp2p");this.libp2p=t.libp2p}async start(){await super.start(),await this.libp2p.start()}async stop(){await super.stop(),await this.libp2p.stop()}}let Vpe=class{constructor(){u(this,"readNext");u(this,"haveNext");u(this,"ended");u(this,"nextResult");u(this,"error");this.ended=!1,this.readNext=De(),this.haveNext=De()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=De(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=De(),await Zr(this.readNext.promise,t==null?void 0:t.signal,t)}};function Kpe(){return new Vpe}let jpe=class extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}};function By(r,e){const t=Kpe();r.sink(t).catch(async o=>{await t.end(o)}),r.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());const i=new Be;return{read:async o=>{var c;if((c=o==null?void 0:o.signal)==null||c.throwIfAborted(),(o==null?void 0:o.bytes)==null){const{done:l,value:d}=await Zr(n.next(),o==null?void 0:o.signal);return l===!0?null:d}for(;i.byteLength<o.bytes;){const{value:l,done:d}=await Zr(n.next(),o==null?void 0:o.signal);if(d===!0)throw new jpe("unexpected end of input");i.append(l)}const a=i.sublist(0,o.bytes);return i.consume(o.bytes),a},write:async(o,a)=>{var c;(c=a==null?void 0:a.signal)==null||c.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(i.byteLength>0){const o=r.source;r.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield i:yield*i,yield*o}()}return r}}}let Hpe=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}},qpe=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}},Wpe=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}};function Bd(r,e={}){const t=By(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=mt(e.maxDataLength));const n=(e==null?void 0:e.lengthDecoder)??Ns,i=(e==null?void 0:e.lengthEncoder)??Hr;return{read:async o=>{let a=-1;const c=new Be;for(;;){c.append(await t.read({...o,bytes:1}));try{a=n(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new Hpe("Invalid message length");if((e==null?void 0:e.maxLengthLength)!=null&&c.byteLength>e.maxLengthLength)throw new Wpe("message length length too long");if(a>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&a>e.maxDataLength)throw new qpe("message length too long");return t.read({...o,bytes:a})},write:async(o,a)=>{await t.write(new Be(i(o.byteLength),o),a)},writeV:async(o,a)=>{const c=new Be(...o.flatMap(l=>[i(l.byteLength),l]));await t.write(c,a)},unwrap:()=>t.unwrap()}}function x_(){const r=De();let e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,r.resolve(t)},source:async function*(){yield*await r.promise}()}}function Gpe(){const r=x_(),e=x_();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}const R1=65535,S_=R1-16;var dD,hD;const k0=!!((hD=(dD=globalThis.process)==null?void 0:dD.env)!=null&&hD.DUMP_SESSION_KEYS);function F8(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function jF(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Dn(r,...e){if(!jF(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function A_(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Qpe(r,e){Dn(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function C_(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const Ga=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),Ype=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Jpe=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Jpe)throw new Error("Non little-endian hardware is not supported");function Xpe(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function X7(r){if(typeof r=="string")r=Xpe(r);else if(jF(r))r=Z7(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function Zpe(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function e2e(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}const t2e=(r,e)=>{function t(n,...i){if(Dn(n),r.nonceLength!==void 0){const d=i[0];if(!d)throw new Error("nonce / iv required");r.varSizeNonce?Dn(d):Dn(d,r.nonceLength)}const s=r.tagLength;s&&i[1]!==void 0&&Dn(i[1]);const o=e(n,...i),a=(d,h)=>{if(h!==void 0){if(d!==2)throw new Error("cipher output not supported");Dn(h)}};let c=!1;return{encrypt(d,h){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Dn(d),a(o.encrypt.length,h),o.encrypt(d,h)},decrypt(d,h){if(Dn(d),s&&d.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,h),o.decrypt(d,h)}}}return Object.assign(t,r),t};function k_(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!r2e(e))throw new Error("invalid output, must be aligned");return e}function I_(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=4,l=0;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function r2e(r){return r.byteOffset%4===0}function Z7(r){return Uint8Array.from(r)}function Ld(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}const HF=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),n2e=HF("expand 16-byte k"),i2e=HF("expand 32-byte k"),s2e=Ga(n2e),o2e=Ga(i2e);function Ze(r,e){return r<<e|r>>>32-e}function eb(r){return r.byteOffset%4===0}const Fp=64,a2e=16,qF=2**32-1,__=new Uint32Array;function c2e(r,e,t,n,i,s,o,a){const c=i.length,l=new Uint8Array(Fp),d=Ga(l),h=eb(i)&&eb(s),p=h?Ga(i):__,b=h?Ga(s):__;for(let f=0;f<c;o++){if(r(e,t,n,d,o,a),o>=qF)throw new Error("arx: counter overflow");const g=Math.min(Fp,c-f);if(h&&g===Fp){const v=f/4;if(f%4!==0)throw new Error("arx: invalid block position");for(let y=0,w;y<a2e;y++)w=v+y,b[w]=p[w]^d[y];f+=Fp;continue}for(let v=0,y;v<g;v++)y=f+v,s[y]=i[y]^l[v];f+=g}}function l2e(r,e){const{allowShortKeys:t,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=Zpe({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return F8(i),F8(o),C_(s),C_(t),(a,c,l,d,h=0)=>{Dn(a),Dn(c),Dn(l);const p=l.length;if(d===void 0&&(d=new Uint8Array(p)),Dn(d),F8(h),h<0||h>=qF)throw new Error("arx: counter overflow");if(d.length<p)throw new Error(`arx: output (${d.length}) is shorter than data (${p})`);const b=[];let f=a.length,g,v;if(f===32)b.push(g=Z7(a)),v=o2e;else if(f===16&&t)g=new Uint8Array(32),g.set(a),g.set(a,16),v=s2e,b.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${f}`);eb(c)||b.push(c=Z7(c));const y=Ga(g);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(v,y,Ga(c.subarray(0,16)),y),c=c.subarray(16)}const w=16-i;if(w!==c.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(w!==12){const E=new Uint8Array(12);E.set(c,s?0:12-c.length),c=E,b.push(c)}const m=Ga(c);return c2e(r,v,y,m,l,d,h,o),Ld(...b),d}}const ir=(r,e)=>r[e++]&255|(r[e++]&255)<<8;class u2e{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=X7(e),Dn(e,32);const t=ir(e,0),n=ir(e,2),i=ir(e,4),s=ir(e,6),o=ir(e,8),a=ir(e,10),c=ir(e,12),l=ir(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let d=0;d<8;d++)this.pad[d]=ir(e,16+2*d)}process(e,t,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],l=o[2],d=o[3],h=o[4],p=o[5],b=o[6],f=o[7],g=o[8],v=o[9],y=ir(e,t+0),w=ir(e,t+2),m=ir(e,t+4),E=ir(e,t+6),C=ir(e,t+8),k=ir(e,t+10),A=ir(e,t+12),I=ir(e,t+14);let D=s[0]+(y&8191),F=s[1]+((y>>>13|w<<3)&8191),W=s[2]+((w>>>10|m<<6)&8191),U=s[3]+((m>>>7|E<<9)&8191),Y=s[4]+((E>>>4|C<<12)&8191),j=s[5]+(C>>>1&8191),H=s[6]+((C>>>14|k<<2)&8191),G=s[7]+((k>>>11|A<<5)&8191),V=s[8]+((A>>>8|I<<8)&8191),R=s[9]+(I>>>5|i),L=0,q=L+D*a+F*(5*v)+W*(5*g)+U*(5*f)+Y*(5*b);L=q>>>13,q&=8191,q+=j*(5*p)+H*(5*h)+G*(5*d)+V*(5*l)+R*(5*c),L+=q>>>13,q&=8191;let Q=L+D*c+F*a+W*(5*v)+U*(5*g)+Y*(5*f);L=Q>>>13,Q&=8191,Q+=j*(5*b)+H*(5*p)+G*(5*h)+V*(5*d)+R*(5*l),L+=Q>>>13,Q&=8191;let K=L+D*l+F*c+W*a+U*(5*v)+Y*(5*g);L=K>>>13,K&=8191,K+=j*(5*f)+H*(5*b)+G*(5*p)+V*(5*h)+R*(5*d),L+=K>>>13,K&=8191;let ce=L+D*d+F*l+W*c+U*a+Y*(5*v);L=ce>>>13,ce&=8191,ce+=j*(5*g)+H*(5*f)+G*(5*b)+V*(5*p)+R*(5*h),L+=ce>>>13,ce&=8191;let me=L+D*h+F*d+W*l+U*c+Y*a;L=me>>>13,me&=8191,me+=j*(5*v)+H*(5*g)+G*(5*f)+V*(5*b)+R*(5*p),L+=me>>>13,me&=8191;let de=L+D*p+F*h+W*d+U*l+Y*c;L=de>>>13,de&=8191,de+=j*a+H*(5*v)+G*(5*g)+V*(5*f)+R*(5*b),L+=de>>>13,de&=8191;let ue=L+D*b+F*p+W*h+U*d+Y*l;L=ue>>>13,ue&=8191,ue+=j*c+H*a+G*(5*v)+V*(5*g)+R*(5*f),L+=ue>>>13,ue&=8191;let $e=L+D*f+F*b+W*p+U*h+Y*d;L=$e>>>13,$e&=8191,$e+=j*l+H*c+G*a+V*(5*v)+R*(5*g),L+=$e>>>13,$e&=8191;let Pe=L+D*g+F*f+W*b+U*p+Y*h;L=Pe>>>13,Pe&=8191,Pe+=j*d+H*l+G*c+V*a+R*(5*v),L+=Pe>>>13,Pe&=8191;let Je=L+D*v+F*g+W*f+U*b+Y*p;L=Je>>>13,Je&=8191,Je+=j*h+H*d+G*l+V*c+R*a,L+=Je>>>13,Je&=8191,L=(L<<2)+L|0,L=L+q|0,q=L&8191,L=L>>>13,Q+=L,s[0]=q,s[1]=Q,s[2]=K,s[3]=ce,s[4]=me,s[5]=de,s[6]=ue,s[7]=$e,s[8]=Pe,s[9]=Je}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;Ld(n)}update(e){A_(this);const{buffer:t,blockLen:n}=this;e=X7(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}t.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Ld(this.h,this.r,this.buffer,this.pad)}digestInto(e){A_(this),Qpe(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}function d2e(r){const e=(n,i)=>r(i).update(X7(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}const h2e=d2e(r=>new u2e(r));function f2e(r,e,t,n,i,s=20){let o=r[0],a=r[1],c=r[2],l=r[3],d=e[0],h=e[1],p=e[2],b=e[3],f=e[4],g=e[5],v=e[6],y=e[7],w=i,m=t[0],E=t[1],C=t[2],k=o,A=a,I=c,D=l,F=d,W=h,U=p,Y=b,j=f,H=g,G=v,V=y,R=w,L=m,q=E,Q=C;for(let ce=0;ce<s;ce+=2)k=k+F|0,R=Ze(R^k,16),j=j+R|0,F=Ze(F^j,12),k=k+F|0,R=Ze(R^k,8),j=j+R|0,F=Ze(F^j,7),A=A+W|0,L=Ze(L^A,16),H=H+L|0,W=Ze(W^H,12),A=A+W|0,L=Ze(L^A,8),H=H+L|0,W=Ze(W^H,7),I=I+U|0,q=Ze(q^I,16),G=G+q|0,U=Ze(U^G,12),I=I+U|0,q=Ze(q^I,8),G=G+q|0,U=Ze(U^G,7),D=D+Y|0,Q=Ze(Q^D,16),V=V+Q|0,Y=Ze(Y^V,12),D=D+Y|0,Q=Ze(Q^D,8),V=V+Q|0,Y=Ze(Y^V,7),k=k+W|0,Q=Ze(Q^k,16),G=G+Q|0,W=Ze(W^G,12),k=k+W|0,Q=Ze(Q^k,8),G=G+Q|0,W=Ze(W^G,7),A=A+U|0,R=Ze(R^A,16),V=V+R|0,U=Ze(U^V,12),A=A+U|0,R=Ze(R^A,8),V=V+R|0,U=Ze(U^V,7),I=I+Y|0,L=Ze(L^I,16),j=j+L|0,Y=Ze(Y^j,12),I=I+Y|0,L=Ze(L^I,8),j=j+L|0,Y=Ze(Y^j,7),D=D+F|0,q=Ze(q^D,16),H=H+q|0,F=Ze(F^H,12),D=D+F|0,q=Ze(q^D,8),H=H+q|0,F=Ze(F^H,7);let K=0;n[K++]=o+k|0,n[K++]=a+A|0,n[K++]=c+I|0,n[K++]=l+D|0,n[K++]=d+F|0,n[K++]=h+W|0,n[K++]=p+U|0,n[K++]=b+Y|0,n[K++]=f+j|0,n[K++]=g+H|0,n[K++]=v+G|0,n[K++]=y+V|0,n[K++]=w+R|0,n[K++]=m+L|0,n[K++]=E+q|0,n[K++]=C+Q|0}const p2e=l2e(f2e,{counterRight:!1,counterLength:4,allowShortKeys:!1}),g2e=new Uint8Array(16),T_=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(g2e.subarray(t))},y2e=new Uint8Array(32);function $_(r,e,t,n,i){const s=r(e,t,y2e),o=h2e.create(s);i&&T_(o,i),T_(o,n);const a=new Uint8Array(16),c=Ype(a);I_(c,0,BigInt(i?i.length:0),!0),I_(c,8,BigInt(n.length),!0),o.update(a);const l=o.digest();return Ld(s,a),l}const m2e=r=>(e,t,n)=>({encrypt(s,o){const a=s.length;o=k_(a+16,o,!1),o.set(s);const c=o.subarray(0,-16);r(e,t,c,c,1);const l=$_(r,e,t,c,n);return o.set(l,a),Ld(l),o},decrypt(s,o){o=k_(s.length-16,o,!1);const a=s.subarray(0,-16),c=s.subarray(-16),l=$_(r,e,t,a,n);if(!e2e(c,l))throw new Error("invalid tag");return o.set(s.subarray(0,-16)),r(e,t,o,o,1),Ld(l),o}}),P_=t2e({blockSize:64,nonceLength:12,tagLength:16},m2e(p2e));function w2e(r,e,t){return Lm(r),t===void 0&&(t=new Uint8Array(r.outputLen)),Km(r,C1(t),C1(e))}const z8=Uint8Array.from([0]),D_=Uint8Array.of();function b2e(r,e,t,n=32){Lm(r),Xu(n);const i=r.outputLen;if(n>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(n/i);t===void 0&&(t=D_);const o=new Uint8Array(s*i),a=Km.create(r,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let d=0;d<s;d++)z8[0]=d+1,c.update(d===0?D_:l).update(t).update(z8).digestInto(l),o.set(l,i*d),a._cloneInto(c);return a.destroy(),c.destroy(),ks(l,z8),o.slice(0,n)}const v2e={hashSHA256(r){return fl(r.subarray())},getHKDF(r,e){const t=w2e(fl,e,r),i=b2e(fl,t,void 0,96),s=i.subarray(0,32),o=i.subarray(32,64),a=i.subarray(64,96);return[s,o,a]},generateX25519KeyPair(){const r=Cp.utils.randomPrivateKey();return{publicKey:Cp.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:Cp.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,e){return Cp.getSharedSecret(r.subarray(),e.subarray())},chaCha20Poly1305Encrypt(r,e,t,n){return P_(n,e,t).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,e,t,n,i){return P_(n,e,t).decrypt(r.subarray(),i)}},E2e=v2e;function x2e(r){return{generateKeypair:r.generateX25519KeyPair,dh:(e,t)=>r.generateX25519SharedKey(e.privateKey,t).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}const Ly=r=>{const e=zn(2);return e[0]=r>>8,e[1]=r,e};Ly.bytes=2;const M2=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let e=0;return e+=r[0]<<8,e+=r[1],e}return r.getUint16(0)};M2.bytes=2;function S2e(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function WF(r,e){!e.enabled||!k0||(r?(e(`LOCAL_STATIC_PUBLIC_KEY ${re(r.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${re(r.privateKey,"hex")}`)):e("Missing local static keys."))}function GF(r,e){!e.enabled||!k0||(r?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${re(r.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${re(r.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function A2e(r,e){!e.enabled||!k0||e(r?`REMOTE_STATIC_PUBLIC_KEY ${re(r.subarray(),"hex")}`:"Missing remote static public key.")}function QF(r,e){!e.enabled||!k0||e(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${re(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function YF(r,e,t){!t.enabled||!k0||(t(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&re(r.k,"hex")}`),t(`CIPHER_STATE_2 ${e.n.getUint64()} ${e.k&&re(e.k,"hex")}`))}function oc(r,e){if(r.length!==e.length)throw new Error("Inputs should have the same length");const t=zn(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return t}const j3=class j3 extends Error{constructor(t="Invalid crypto exchange"){super(t);u(this,"code");this.code=j3.code}};u(j3,"code","ERR_INVALID_CRYPTO_EXCHANGE");let zf=j3;const C2e=0,k2e=4294967295,I2e="Cipherstate has reached maximum n, a new handshake must be performed";class _2e{constructor(e=C2e){u(this,"n");u(this,"bytes");u(this,"view");this.n=e,this.bytes=We(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>k2e)throw new Error(I2e)}}const td=We(0);class zp{constructor(e,t=void 0,n=0){u(this,"k");u(this,"n");u(this,"crypto");this.crypto=e,this.k=t,this.n=new _2e(n)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();const n=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),n}decryptWithAd(e,t,n){if(!this.hasKey())return t;this.n.assertValue();const i=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,n);return this.n.increment(),i}}class T2e{constructor(e,t){u(this,"cs");u(this,"ck");u(this,"h");u(this,"crypto");this.crypto=e;const n=se(t,"utf-8");this.h=P2e(e,n),this.ck=this.h,this.cs=new zp(e)}mixKey(e){const[t,n]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new zp(this.crypto,n)}mixHash(e){this.h=this.crypto.hash(new Be(this.h,e))}encryptAndHash(e){const t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){const t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){const[e,t]=this.crypto.hkdf(this.ck,td);return[new zp(this.crypto,e),new zp(this.crypto,t)]}}class $2e{constructor(e){u(this,"ss");u(this,"s");u(this,"e");u(this,"rs");u(this,"re");u(this,"initiator");u(this,"crypto");const{crypto:t,protocolName:n,prologue:i,initiator:s,s:o,e:a,rs:c,re:l}=e;this.crypto=t,this.ss=new T2e(t,n),this.ss.mixHash(i),this.initiator=s,this.s=o,this.e=a,this.rs=c,this.re=l}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");const e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw new Error("remote static public key is already set");const n=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+n)throw new Error("message is not long enough");const i=e.sublist(t,t+n);return this.rs=this.ss.decryptAndHash(i),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class JF extends $2e{writeMessageA(e){return new Be(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){const t=this.writeE();this.writeEE();const n=this.writeS();return this.writeES(),new Be(t,n,this.ss.encryptAndHash(e))}writeMessageC(e){const t=this.writeS();return this.writeSE(),new Be(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(t){throw new zf(`handshake stage 0 validation fail: ${t.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();const t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(t){throw new zf(`handshake stage 1 validation fail: ${t.message}`)}}readMessageC(e){try{const t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(t){throw new zf(`handshake stage 2 validation fail: ${t.message}`)}}}function P2e(r,e){if(e.length<=32){const t=We(32);return t.set(e),t}else return r.hash(e)}var My;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(const s of t.webtransportCerthashes)n.uint32(10),n.bytes(s);if(t.streamMuxers!=null)for(const s of t.streamMuxers)n.uint32(18),n.string(s);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={webtransportCerthashes:[],streamMuxers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{if(((a=i.limits)==null?void 0:a.webtransportCerthashes)!=null&&s.webtransportCerthashes.length===i.limits.webtransportCerthashes)throw new gr('Decode error - map field "webtransportCerthashes" had too many elements');s.webtransportCerthashes.push(t.bytes());break}case 2:{if(((c=i.limits)==null?void 0:c.streamMuxers)!=null&&s.streamMuxers.length===i.limits.streamMuxers)throw new gr('Decode error - map field "streamMuxers" had too many elements');s.streamMuxers.push(t.string());break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(My||(My={}));var Uy;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.identityKey!=null&&t.identityKey.byteLength>0&&(n.uint32(10),n.bytes(t.identityKey)),t.identitySig!=null&&t.identitySig.byteLength>0&&(n.uint32(18),n.bytes(t.identitySig)),t.extensions!=null&&(n.uint32(34),My.codec().encode(t.extensions,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={identityKey:We(0),identitySig:We(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.identityKey=t.bytes();break}case 2:{s.identitySig=t.bytes();break}case 4:{s.extensions=My.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.extensions});break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(Uy||(Uy={}));async function XF(r,e,t){const n=await r.sign(ez(e));return Uy.encode({identityKey:Ss(r.publicKey),identitySig:n,extensions:t})}async function ZF(r,e,t){try{const n=Uy.decode(r),i=Ji(n.identityKey);if((t==null?void 0:t.equals(i))===!1)throw new Error(`Payload identity key ${i} does not match expected remote identity key ${t}`);if(!e)throw new Error("Remote static does not exist");const s=ez(e);if(!await i.verify(s,n.identitySig))throw new Error("Invalid payload signature");return n}catch(n){throw new RB(n.message)}}function ez(r){const e=se("noise-libp2p-static-key:");return r instanceof Uint8Array?pr([e,r],e.length+r.length):(r.prepend(e),r)}async function D2e(r,e){const{log:t,connection:n,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=r,d=await XF(s,a.publicKey,l),h=new JF({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:o,s:a});WF(h.s,t),t.trace("Stage 0 - Initiator starting to send first message."),await n.write(h.writeMessageA(td),e),t.trace("Stage 0 - Initiator finished sending first message."),GF(h.e,t),t.trace("Stage 1 - Initiator waiting to receive first message from responder...");const p=h.readMessageB(await n.read(e));t.trace("Stage 1 - Initiator received the message."),QF(h.re,t),A2e(h.rs,t),t.trace("Initiator going to check remote's signature...");const b=await ZF(p,h.rs,c);t.trace("All good with the signature!"),t.trace("Stage 2 - Initiator sending third handshake message."),await n.write(h.writeMessageC(d),e),t.trace("Stage 2 - Initiator sent message with signed payload.");const[f,g]=h.ss.split();return YF(f,g,t),{payload:b,encrypt:v=>f.encryptWithAd(td,v),decrypt:(v,y)=>g.decryptWithAd(td,v,y)}}async function N2e(r,e){const{log:t,connection:n,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=r,d=await XF(s,a.publicKey,l),h=new JF({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:o,s:a});WF(h.s,t),t.trace("Stage 0 - Responder waiting to receive first message."),h.readMessageA(await n.read(e)),t.trace("Stage 0 - Responder received first message."),QF(h.re,t),t.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(h.writeMessageB(d),e),t.trace("Stage 1 - Responder sent the second handshake message with signed payload."),GF(h.e,t),t.trace("Stage 2 - Responder waiting for third handshake message...");const p=h.readMessageC(await n.read(e));t.trace("Stage 2 - Responder received the message, finished handshake.");const b=await ZF(p,h.rs,c),[f,g]=h.ss.split();return YF(f,g,t),{payload:b,encrypt:v=>g.encryptWithAd(td,v),decrypt:(v,y)=>f.decryptWithAd(td,v,y)}}const N_=16;function O2e(r,e){return async function*(t){for await(const n of t)for(let i=0;i<n.length;i+=S_){let s=i+S_;s>n.length&&(s=n.length);let o;n instanceof Uint8Array?o=r.encrypt(n.subarray(i,s)):o=r.encrypt(n.sublist(i,s)),e==null||e.encryptedPackets.increment(),yield new Be(Ly(o.byteLength),o)}}}function R2e(r,e){return async function*(t){for await(const n of t)for(let i=0;i<n.length;i+=R1){let s=i+R1;if(s>n.length&&(s=n.length),s-N_<i)throw new Error("Invalid chunk");const o=n.sublist(i,s),a=n.subarray(i,s-N_);try{const c=r.decrypt(o,a);e==null||e.decryptedPackets.increment(),yield c}catch(c){throw e==null||e.decryptErrors.increment(),c}}}}var fD,pD;pD=Symbol.toStringTag,fD=fr;class B2e{constructor(e,t={}){u(this,"protocol","/noise");u(this,"crypto");u(this,"prologue");u(this,"staticKey");u(this,"extensions");u(this,"metrics");u(this,"components");u(this,pD,"@chainsafe/libp2p-noise");u(this,fD,["@libp2p/connection-encryption","@chainsafe/libp2p-noise"]);const{staticNoiseKey:n,extensions:i,crypto:s,prologueBytes:o}=t,{metrics:a}=e;this.components=e;const c=s??E2e;this.crypto=x2e(c),this.extensions={webtransportCerthashes:[],...i},this.metrics=a?S2e(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=o??We(0)}async secureOutbound(e,t){var a,c;const n=Bd(e,{lengthEncoder:Ly,lengthDecoder:M2,maxDataLength:R1}),i=await this.performHandshakeInitiator(n,this.components.privateKey,(a=t==null?void 0:t.remotePeer)==null?void 0:a.publicKey,t),s=await this.createSecureConnection(n,i);e.source=s.source,e.sink=s.sink;const o=Ji(i.payload.identityKey);return{conn:e,remoteExtensions:i.payload.extensions,remotePeer:$d(o),streamMuxer:this.getStreamMuxer((c=i.payload.extensions)==null?void 0:c.streamMuxers)}}getStreamMuxer(e){if(e==null)return;const t=this.components.upgrader.getStreamMuxers();if(t!=null)for(const n of e){const i=t.get(n);if(i!=null)return i}if(e.length)throw new sX("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(e,t){var a,c;const n=Bd(e,{lengthEncoder:Ly,lengthDecoder:M2,maxDataLength:R1}),i=await this.performHandshakeResponder(n,this.components.privateKey,(a=t==null?void 0:t.remotePeer)==null?void 0:a.publicKey,t),s=await this.createSecureConnection(n,i);e.source=s.source,e.sink=s.sink;const o=Ji(i.payload.identityKey);return{conn:e,remoteExtensions:i.payload.extensions,remotePeer:$d(o),streamMuxer:this.getStreamMuxer((c=i.payload.extensions)==null?void 0:c.streamMuxers)}}async performHandshakeInitiator(e,t,n,i){var o,a;let s;try{s=await D2e({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},i),(o=this.metrics)==null||o.xxHandshakeSuccesses.increment()}catch(c){throw(a=this.metrics)==null||a.xxHandshakeErrors.increment(),c}return s}async performHandshakeResponder(e,t,n,i){var o,a;let s;try{s=await N2e({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},i),(o=this.metrics)==null||o.xxHandshakeSuccesses.increment()}catch(c){throw(a=this.metrics)==null||a.xxHandshakeErrors.increment(),c}return s}async createSecureConnection(e,t){const[n,i]=Gpe(),s=e.unwrap();return await Qi(n,O2e(t,this.metrics),s,o=>Td(o,{lengthDecoder:M2}),R2e(t,this.metrics),n),i}}function tz(r={}){return e=>new B2e(e,r)}function rz(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}class Xc extends Error{constructor(e="The frame was invalid"){super(e),this.name="InvalidFrameError"}}u(Xc,"name","InvalidFrameError");class Bx extends Error{constructor(e="Unrequested ping error"){super(e),this.name="UnrequestedPingError"}}u(Bx,"name","UnrequestedPingError");class Lx extends Error{constructor(e="Unrequested ping error"){super(e),this.name="NotMatchingPingError"}}u(Lx,"name","NotMatchingPingError");class nz extends Error{constructor(e="Invalid state"){super(e),this.name="InvalidStateError"}}u(nz,"name","InvalidStateError");class iz extends Error{constructor(e="Strean already exists"){super(e),this.name="StreamAlreadyExistsError"}}u(iz,"name","StreamAlreadyExistsError");class sz extends Error{constructor(e="Decode invalid version"){super(e),this.name="DecodeInvalidVersionError"}}u(sz,"name","DecodeInvalidVersionError");class oz extends Error{constructor(e="Both clients"){super(e),this.name="BothClientsError"}}u(oz,"name","BothClientsError");class Mx extends Error{constructor(e="Receive window exceeded"){super(e),this.name="ReceiveWindowExceededError"}}u(Mx,"name","ReceiveWindowExceededError");const L2e=new Set([Xc.name,Bx.name,Lx.name,iz.name,sz.name,oz.name,Mx.name]),Ux=256*1024,M2e=16*1024*1024,U2e={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:Ux,maxStreamWindowSize:M2e,maxMessageSize:64*1024};function F2e(r){if(r.keepAliveInterval<=0)throw new Z("keep-alive interval must be positive");if(r.maxInboundStreams<0)throw new Z("max inbound streams must be larger or equal 0");if(r.maxOutboundStreams<0)throw new Z("max outbound streams must be larger or equal 0");if(r.initialStreamWindowSize<Ux)throw new Z("InitialStreamWindowSize must be larger or equal 256 kB");if(r.maxStreamWindowSize<r.initialStreamWindowSize)throw new Z("MaxStreamWindowSize must be larger than the InitialStreamWindowSize");if(r.maxStreamWindowSize>2**32-1)throw new Z("MaxStreamWindowSize must be less than equal MAX_UINT32");if(r.maxMessageSize<1024)throw new Z("MaxMessageSize must be greater than a kilobyte")}var Ht;(function(r){r[r.Data=0]="Data",r[r.WindowUpdate=1]="WindowUpdate",r[r.Ping=2]="Ping",r[r.GoAway=3]="GoAway"})(Ht||(Ht={}));var Rt;(function(r){r[r.SYN=1]="SYN",r[r.ACK=2]="ACK",r[r.FIN=4]="FIN",r[r.RST=8]="RST"})(Rt||(Rt={}));Object.values(Rt).filter(r=>typeof r!="string");const z2e=0;var hs;(function(r){r[r.NormalTermination=0]="NormalTermination",r[r.ProtocolError=1]="ProtocolError",r[r.InternalError=2]="InternalError"})(hs||(hs={}));const Vf=12,O_=2**24;function V2e(r){if(r[0]!==z2e)throw new Xc("Invalid frame version");return{type:r[1],flag:(r[2]<<8)+r[3],streamID:r[4]*O_+(r[5]<<16)+(r[6]<<8)+r[7],length:r[8]*O_+(r[9]<<16)+(r[10]<<8)+r[11]}}let K2e=class{constructor(e){u(this,"source");u(this,"buffer");u(this,"frameInProgress");this.source=j2e(e),this.buffer=new Be,this.frameInProgress=!1}async*emitFrames(){for await(const e of this.source)for(this.buffer.append(e);;){const t=this.readHeader();if(t===void 0)break;const{type:n,length:i}=t;n===Ht.Data?(this.frameInProgress=!0,yield{header:t,readData:this.readBytes.bind(this,i)}):yield{header:t}}}readHeader(){if(this.frameInProgress)throw new nz("decoding frame already in progress");if(this.buffer.length<Vf)return;const e=V2e(this.buffer.subarray(0,Vf));return this.buffer.consume(Vf),e}async readBytes(e){if(this.buffer.length<e){for await(const n of this.source)if(this.buffer.append(n),this.buffer.length>=e)break}const t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}};function j2e(r){if(r[Symbol.iterator]!==void 0){const e=r[Symbol.iterator]();return e.return=void 0,{[Symbol.iterator](){return e}}}else if(r[Symbol.asyncIterator]!==void 0){const e=r[Symbol.asyncIterator]();return e.return=void 0,{[Symbol.asyncIterator](){return e}}}else throw new Error("a source must be either an iterable or an async iterable")}function R_(r){const e=new Uint8Array(Vf);return e[1]=r.type,e[2]=r.flag>>>8,e[3]=r.flag,e[4]=r.streamID>>>24,e[5]=r.streamID>>>16,e[6]=r.streamID>>>8,e[7]=r.streamID,e[8]=r.length>>>24,e[9]=r.length>>>16,e[10]=r.length>>>8,e[11]=r.length,e}function H2e(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function az(r,e){var n,i;const t=(i=(n=rz(r)).return)==null?void 0:i.call(n);H2e(t)&&t.catch(s=>{e.error("could not cause iterator to return",s)})}const q2e=5e3;function V8(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}class Fx{constructor(e){u(this,"id");u(this,"direction");u(this,"timeline");u(this,"protocol");u(this,"metadata");u(this,"source");u(this,"status");u(this,"readStatus");u(this,"writeStatus");u(this,"log");u(this,"sinkController");u(this,"sinkEnd");u(this,"closed");u(this,"endErr");u(this,"streamSource");u(this,"onEnd");u(this,"onCloseRead");u(this,"onCloseWrite");u(this,"onReset");u(this,"onAbort");u(this,"sendCloseWriteTimeout");u(this,"sendingData");this.sinkController=new AbortController,this.sinkEnd=De(),this.closed=De(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??q2e,this.onEnd=e.onEnd,this.onCloseRead=e==null?void 0:e.onCloseRead,this.onCloseWrite=e==null?void 0:e.onCloseWrite,this.onReset=e==null?void 0:e.onReset,this.onAbort=e==null?void 0:e.onAbort,this.source=this.streamSource=sh({onEnd:t=>{t!=null?this.log.trace("source ended with error",t):this.log.trace("source ended"),this.onSourceEnd(t)}}),this.sink=this.sink.bind(this)}async sink(e){if(this.writeStatus!=="ready")throw new Ng(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";const t={signal:this.sinkController.signal};if(this.direction==="outbound"){const i=this.sendNewStream(t);V8(i)&&await i}const n=()=>{az(e,this.log)};try{this.sinkController.signal.addEventListener("abort",n),this.log.trace("sink reading from source");for await(let i of e){i=i instanceof Uint8Array?new Be(i):i;const s=this.sendData(i,t);V8(s)&&(this.sendingData=De(),await s,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",n)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(t){throw this.log.trace("sink ended with error, calling abort with error",t),this.abort(t),t}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){var t;this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(t=this.onCloseRead)==null||t.call(this),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){var t;this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(t=this.onCloseWrite)==null||t.call(this),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.status==="open"&&(this.log.trace("closing gracefully"),this.status="closing",await Zr(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e==null?void 0:e.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(e={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const t=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),t==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(e={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),await Zr(this.sink([]),e.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&await Zr(this.sendingData.promise,e.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await Zr(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){var n;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",e),this.log("try to send reset to remote");const t=this.sendReset();V8(t)&&t.catch(i=>{this.log.error("error sending reset message",i)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),(n=this.onAbort)==null||n.call(this,e)}reset(){var t;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;const e=new LB("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),(t=this.onReset)==null||t.call(this)}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}var Li;(function(r){r[r.Init=0]="Init",r[r.SYNSent=1]="SYNSent",r[r.SYNReceived=2]="SYNReceived",r[r.Established=3]="Established",r[r.Finished=4]="Finished"})(Li||(Li={}));class W2e extends Fx{constructor(t){super({...t,onEnd:n=>{var i;this.state=Li.Finished,(i=t.onEnd)==null||i.call(t,n)}});u(this,"name");u(this,"state");u(this,"config");u(this,"_id");u(this,"sendWindowCapacity");u(this,"sendWindowCapacityUpdate");u(this,"recvWindow");u(this,"recvWindowCapacity");u(this,"epochStart");u(this,"getRTT");u(this,"sendFrame");this.config=t.config,this._id=parseInt(t.id,10),this.name=t.name,this.state=t.state,this.sendWindowCapacity=Ux,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=t.getRTT,this.sendFrame=t.sendFrame,this.source=py(this.source,()=>{this.sendWindowUpdate()})}async sendNewStream(){}async sendData(t,n={}){var i,s;for(t=t.sublist();t.byteLength!==0;){if(this.sendWindowCapacity===0&&((i=this.log)==null||i.trace("wait for send window capacity, status %s",this.status),await this.waitForSendWindowCapacity(n),this.status==="closed"||this.status==="aborted"||this.status==="reset")){(s=this.log)==null||s.trace("%s while waiting for send window capacity",this.status);return}const o=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-Vf,t.length),a=this.getSendFlags();this.sendFrame({type:Ht.Data,flag:a,streamID:this._id,length:o},t.sublist(0,o)),this.sendWindowCapacity-=o,t.consume(o)}}async sendReset(){this.sendFrame({type:Ht.WindowUpdate,flag:Rt.RST,streamID:this._id,length:0})}async sendCloseWrite(){const t=this.getSendFlags()|Rt.FIN;this.sendFrame({type:Ht.WindowUpdate,flag:t,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(t={}){var o,a;if(this.sendWindowCapacity>0)return;let n,i;const s=()=>{this.status==="open"||this.status==="closing"?i(new Sl("Stream aborted")):n()};(o=t.signal)==null||o.addEventListener("abort",s);try{await new Promise((c,l)=>{this.sendWindowCapacityUpdate=()=>{c()},i=l,n=c})}finally{(a=t.signal)==null||a.removeEventListener("abort",s)}}handleWindowUpdate(t){var i,s;(i=this.log)==null||i.trace("stream received window update id=%s",this._id),this.processFlags(t.flag);const n=this.sendWindowCapacity;this.sendWindowCapacity+=t.length,n===0&&t.length>0&&((s=this.sendWindowCapacityUpdate)==null||s.call(this))}async handleData(t,n){var s;if((s=this.log)==null||s.trace("stream received data id=%s",this._id),this.processFlags(t.flag),this.recvWindowCapacity<t.length)throw new Mx("Receive window exceeded");const i=await n();this.recvWindowCapacity-=t.length,this.sourcePush(i)}processFlags(t){(t&Rt.ACK)===Rt.ACK&&this.state===Li.SYNSent&&(this.state=Li.Established),(t&Rt.FIN)===Rt.FIN&&this.remoteCloseWrite(),(t&Rt.RST)===Rt.RST&&this.reset()}getSendFlags(){switch(this.state){case Li.Init:return this.state=Li.SYNSent,Rt.SYN;case Li.SYNReceived:return this.state=Li.Established,Rt.ACK;default:return 0}}sendWindowUpdate(){const t=this.getSendFlags(),n=Date.now(),i=this.getRTT();if(t===0&&i>-1&&n-this.epochStart<i*4&&(this.recvWindow=Math.min(this.recvWindow*2,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&t===0)return;const s=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=n,this.sendFrame({type:Ht.WindowUpdate,flag:t,streamID:this._id,length:s})}}const cz="/yamux/1.0.0",G2e=500;var gD,yD;yD=Symbol.toStringTag,gD=fr;class Q2e{constructor(e,t={}){u(this,"protocol",cz);u(this,"_components");u(this,"_init");u(this,yD,"@chainsafe/libp2p-yamux");u(this,gD,["@libp2p/stream-multiplexing"]);this._components=e,this._init=t}createStreamMuxer(e){return new Y2e(this._components,{...this._init,...e})}}class Y2e{constructor(e,t){u(this,"protocol",cz);u(this,"source");u(this,"sink");u(this,"config");u(this,"log");u(this,"logger");u(this,"closeController");u(this,"nextStreamID");u(this,"_streams");u(this,"nextPingID");u(this,"activePing");u(this,"rtt");u(this,"client");u(this,"localGoAway");u(this,"remoteGoAway");u(this,"numInboundStreams");u(this,"numOutboundStreams");u(this,"onIncomingStream");u(this,"onStreamEnd");var n;this.client=t.direction==="outbound",this.config={...U2e,...t},this.logger=e.logger,this.log=this.logger.forComponent("libp2p:yamux"),F2e(this.config),this.closeController=new AbortController,this.closeController.signal,this.onIncomingStream=t.onIncomingStream,this.onStreamEnd=t.onStreamEnd,this._streams=new Map,this.source=sh({onEnd:()=>{var i;(i=this.log)==null||i.trace("muxer source ended"),this._streams.forEach(s=>{s.destroy()})}}),this.sink=async i=>{var c,l,d;const s=()=>{const h=rz(i);if(h.return!=null){const p=h.return();J2e(p)&&p.catch(b=>{var f;(f=this.log)==null||f.call(this,"could not cause sink source to return",b)})}};let o,a;try{const h=new K2e(i);try{this.closeController.signal.addEventListener("abort",s);for await(const p of h.emitFrames())await this.handleFrame(p.header,p.readData)}finally{this.closeController.signal.removeEventListener("abort",s)}o=hs.NormalTermination}catch(h){L2e.has(h.name)?((c=this.log)==null||c.error("protocol error in sink",h),o=hs.ProtocolError):((l=this.log)==null||l.error("internal error in sink",h),o=hs.InternalError),a=h}(d=this.log)==null||d.trace("muxer sink ended"),a!=null?this.abort(a,o):await this.close({reason:o})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,(n=this.log)==null||n.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("keepalive error: %s",i)}),this.ping().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("ping error: %s",i)})}get streams(){return Array.from(this._streams.values())}newStream(e){var i;if(this.remoteGoAway!==void 0)throw new Vc("Muxer closed remotely");if(this.localGoAway!==void 0)throw new Vc("Muxer closed locally");const t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new _m("max outbound streams exceeded");(i=this.log)==null||i.trace("new outgoing stream id=%s",t);const n=this._newStream(t,e,Li.Init,"outbound");return this._streams.set(t,n),this.numOutboundStreams++,n.sendWindowUpdate(),n}async ping(){if(this.remoteGoAway!==void 0)throw new Vc("Muxer closed remotely");if(this.localGoAway!==void 0)throw new Vc("Muxer closed locally");if(this.activePing===void 0){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((i,s)=>{const o=()=>{s(new Vc("Muxer closed locally"))};this.closeController.signal.addEventListener("abort",o,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",o),i()}}),resolve:e};const t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const n=Date.now();this.rtt=n-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(e={}){var n;if(this.closeController.signal.aborted)return;const t=(e==null?void 0:e.reason)??hs.NormalTermination;if((n=this.log)==null||n.trace("muxer close reason=%s",t),e.signal==null){const i=AbortSignal.timeout(G2e);e={...e,signal:i}}try{await Promise.all([...this._streams.values()].map(async i=>i.close(e))),this.sendGoAway(t),this._closeMuxer()}catch(i){this.abort(i)}}abort(e,t){var n;if(!this.closeController.signal.aborted){t=t??hs.InternalError,(n=this.log)==null||n.error("muxer abort reason=%s error=%s",t,e);for(const i of this._streams.values())i.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,n,i){if(this._streams.get(e)!=null)throw new Z("Stream already exists with that id");const s=new W2e({id:e.toString(),name:t,state:n,direction:i,sendFrame:this.sendFrame.bind(this),onEnd:()=>{var o;this.closeStream(e),(o=this.onStreamEnd)==null||o.call(this,s)},log:this.logger.forComponent(`libp2p:yamux:${i}:${e}`),config:this.config,getRTT:this.getRTT.bind(this)});return s}closeStream(e){this.client===(e%2===0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){var t;const e=new Promise((n,i)=>{this.closeController.signal.addEventListener("abort",i,{once:!0})});for((t=this.log)==null||t.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let n;try{await Promise.race([e,new Promise(i=>{n=setTimeout(i,this.config.keepAliveInterval)})]),this.ping().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("ping error: %s",i)})}catch{clearInterval(n);return}}}async handleFrame(e,t){var o;const{streamID:n,type:i,length:s}=e;if((o=this.log)==null||o.trace("received frame %o",e),n===0)switch(i){case Ht.Ping:{this.handlePing(e);return}case Ht.GoAway:{this.handleGoAway(s);return}default:throw new Xc("Invalid frame type")}else switch(e.type){case Ht.Data:case Ht.WindowUpdate:{await this.handleStreamMessage(e,t);return}default:throw new Xc("Invalid frame type")}}handlePing(e){var t,n;if(e.flag===Rt.SYN)(t=this.log)==null||t.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,Rt.ACK);else if(e.flag===Rt.ACK)(n=this.log)==null||n.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length);else throw new Xc("Invalid frame flag")}handlePingResponse(e){if(this.activePing===void 0)throw new Bx("ping not requested");if(this.activePing.id!==e)throw new Lx("ping doesn't match our id");this.activePing.resolve()}handleGoAway(e){var t;(t=this.log)==null||t.trace("received GoAway reason=%s",hs[e]??"unknown"),this.remoteGoAway=e;for(const n of this._streams.values())n.reset();this._closeMuxer()}async handleStreamMessage(e,t){var a,c;const{streamID:n,flag:i,type:s}=e;(i&Rt.SYN)===Rt.SYN&&this.incomingStream(n);const o=this._streams.get(n);if(o===void 0){if(s===Ht.Data){if((a=this.log)==null||a.call(this,"discarding data for stream id=%s",n),t===void 0)throw new Error("unreachable");await t()}else(c=this.log)==null||c.trace("frame for missing stream id=%s",n);return}switch(s){case Ht.WindowUpdate:{o.handleWindowUpdate(e);return}case Ht.Data:{if(t===void 0)throw new Error("unreachable");await o.handleData(e,t);return}default:throw new Error("unreachable")}}incomingStream(e){var n,i,s;if(this.client!==(e%2===0))throw new Z("Both endpoints are clients");if(this._streams.has(e))return;if((n=this.log)==null||n.trace("new incoming stream id=%s",e),this.localGoAway!==void 0){this.sendFrame({type:Ht.WindowUpdate,flag:Rt.RST,streamID:e,length:0});return}if(this.numInboundStreams>=this.config.maxInboundStreams){(i=this.log)==null||i.call(this,"maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:Ht.WindowUpdate,flag:Rt.RST,streamID:e,length:0});return}const t=this._newStream(e,void 0,Li.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),(s=this.onIncomingStream)==null||s.call(this,t)}sendFrame(e,t){var n;if((n=this.log)==null||n.trace("sending frame %o",e),e.type===Ht.Data){if(t===void 0)throw new Xc("Invalid frame");this.source.push(new Be(R_(e),t))}else this.source.push(R_(e))}sendPing(e,t=Rt.SYN){var n,i;t===Rt.SYN?(n=this.log)==null||n.trace("sending ping request pingId=%s",e):(i=this.log)==null||i.trace("sending ping response pingId=%s",e),this.sendFrame({type:Ht.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=hs.NormalTermination){var t;(t=this.log)==null||t.call(this,"sending GoAway reason=%s",hs[e]),this.localGoAway=e,this.sendFrame({type:Ht.GoAway,flag:0,streamID:0,length:e})}}function J2e(r){return r!=null&&typeof r.then=="function"}function X2e(r={}){return e=>new Q2e(e,r)}const Z2e=41;function lz(r){try{const[[e,t]]=r.stringTuples();if(t==null)return!1;if(e===Z2e)return yde("2000::/3",t)}catch{}return!1}const ege=4,tge=41;function uz(r){try{const[[e]]=r.stringTuples();return e===ege||e===tge}catch{}return!1}function Nl(r){try{if(!uz(r))return!1;const[[,e]]=r.stringTuples();return e==null?!1:vc(e)??!1}catch{}return!0}function rge(r,e,t){let n,i;function s(){const a={signal:i.signal};if((t==null?void 0:t.timeout)!=null){const c=ct([i.signal,AbortSignal.timeout(t.timeout)]);a.signal=c}Promise.resolve().then(async()=>{await r(a)}).catch(()=>{}).finally(()=>{i.signal.aborted||(n=setTimeout(s,e))})}let o=!1;return{setInterval:a=>{e=a,n!=null&&(clearTimeout(n),n=setTimeout(s,e))},setTimeout:a=>{t==null&&(t={}),t.timeout=a},start:()=>{o||(o=!0,i=new AbortController,i.signal,(t==null?void 0:t.runImmediately)===!0?queueMicrotask(()=>{s()}):n=setTimeout(s,e))},stop:()=>{clearTimeout(n),i==null||i.abort(),o=!1}}}function Vn(r,e){const t=Bd(r,e),n={read:async(i,s)=>{const o=await t.read(s);return i.decode(o)},write:async(i,s,o)=>{await t.write(s.encode(i),o)},writeV:async(i,s,o)=>{await t.writeV(i.map(a=>s.encode(a)),o)},pb:i=>({read:async s=>n.read(i,s),write:async(s,o)=>n.write(s,i,o),writeV:async(s,o)=>n.writeV(s,i,o),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}function nge(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var ige=dz,B_=128,sge=-128,oge=Math.pow(2,31);function dz(r,e,t){e=e||[],t=t||0;for(var n=t;r>=oge;)e[t++]=r&255|B_,r/=128;for(;r&sge;)e[t++]=r&255|B_,r>>>=7;return e[t]=r|0,dz.bytes=t-n+1,e}var age=tb,cge=128,L_=127;function tb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw tb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&L_)<<i:(o&L_)*Math.pow(2,i),i+=7}while(o>=cge);return tb.bytes=s-n,t}var lge=Math.pow(2,7),uge=Math.pow(2,14),dge=Math.pow(2,21),hge=Math.pow(2,28),fge=Math.pow(2,35),pge=Math.pow(2,42),gge=Math.pow(2,49),yge=Math.pow(2,56),mge=Math.pow(2,63),wge=function(r){return r<lge?1:r<uge?2:r<dge?3:r<hge?4:r<fge?5:r<pge?6:r<gge?7:r<yge?8:r<mge?9:10},bge={encode:ige,decode:age,encodingLength:wge},M_=bge;function U_(r,e=0){return[M_.decode(r,e),M_.decode.bytes]}function vge(r){const e=nge(r),[t,n]=U_(e),[i,s]=U_(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Ege(t,i,o,e)}let Ege=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};const xge="libp2p",Sge="autonat",Age="1.0.0",Cge=3e4,kge=2,Ige=20,_ge=80,Tge=8192;var Ct;(function(r){(function(i){i.DIAL="DIAL",i.DIAL_RESPONSE="DIAL_RESPONSE"})(r.MessageType||(r.MessageType={}));let e;(function(i){i[i.DIAL=0]="DIAL",i[i.DIAL_RESPONSE=1]="DIAL_RESPONSE"})(e||(e={})),function(i){i.codec=()=>En(e)}(r.MessageType||(r.MessageType={})),function(i){i.OK="OK",i.E_DIAL_ERROR="E_DIAL_ERROR",i.E_DIAL_REFUSED="E_DIAL_REFUSED",i.E_BAD_REQUEST="E_BAD_REQUEST",i.E_INTERNAL_ERROR="E_INTERNAL_ERROR"}(r.ResponseStatus||(r.ResponseStatus={}));let t;(function(i){i[i.OK=0]="OK",i[i.E_DIAL_ERROR=100]="E_DIAL_ERROR",i[i.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",i[i.E_BAD_REQUEST=200]="E_BAD_REQUEST",i[i.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"})(t||(t={})),function(i){i.codec=()=>En(t)}(r.ResponseStatus||(r.ResponseStatus={})),function(i){let s;i.codec=()=>(s==null&&(s=Ke((o,a,c={})=>{if(c.lengthDelimited!==!1&&a.fork(),o.id!=null&&(a.uint32(10),a.bytes(o.id)),o.addrs!=null)for(const l of o.addrs)a.uint32(18),a.bytes(l);c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{var h;const l={addrs:[]},d=a==null?o.len:o.pos+a;for(;o.pos<d;){const p=o.uint32();switch(p>>>3){case 1:{l.id=o.bytes();break}case 2:{if(((h=c.limits)==null?void 0:h.addrs)!=null&&l.addrs.length===c.limits.addrs)throw new gr('Decode error - map field "addrs" had too many elements');l.addrs.push(o.bytes());break}default:{o.skipType(p&7);break}}}return l})),s),i.encode=o=>Ve(o,i.codec()),i.decode=(o,a)=>ze(o,i.codec(),a)}(r.PeerInfo||(r.PeerInfo={})),function(i){let s;i.codec=()=>(s==null&&(s=Ke((o,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),o.peer!=null&&(a.uint32(10),r.PeerInfo.codec().encode(o.peer,a)),c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{var h;const l={},d=a==null?o.len:o.pos+a;for(;o.pos<d;){const p=o.uint32();switch(p>>>3){case 1:{l.peer=r.PeerInfo.codec().decode(o,o.uint32(),{limits:(h=c.limits)==null?void 0:h.peer});break}default:{o.skipType(p&7);break}}}return l})),s),i.encode=o=>Ve(o,i.codec()),i.decode=(o,a)=>ze(o,i.codec(),a)}(r.Dial||(r.Dial={})),function(i){let s;i.codec=()=>(s==null&&(s=Ke((o,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),o.status!=null&&(a.uint32(8),r.ResponseStatus.codec().encode(o.status,a)),o.statusText!=null&&(a.uint32(18),a.string(o.statusText)),o.addr!=null&&(a.uint32(26),a.bytes(o.addr)),c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{const l={},d=a==null?o.len:o.pos+a;for(;o.pos<d;){const h=o.uint32();switch(h>>>3){case 1:{l.status=r.ResponseStatus.codec().decode(o);break}case 2:{l.statusText=o.string();break}case 3:{l.addr=o.bytes();break}default:{o.skipType(h&7);break}}}return l})),s),i.encode=o=>Ve(o,i.codec()),i.decode=(o,a)=>ze(o,i.codec(),a)}(r.DialResponse||(r.DialResponse={}));let n;r.codec=()=>(n==null&&(n=Ke((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.type!=null&&(s.uint32(8),r.MessageType.codec().encode(i.type,s)),i.dial!=null&&(s.uint32(18),r.Dial.codec().encode(i.dial,s)),i.dialResponse!=null&&(s.uint32(26),r.DialResponse.codec().encode(i.dialResponse,s)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l,d;const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const h=i.uint32();switch(h>>>3){case 1:{a.type=r.MessageType.codec().decode(i);break}case 2:{a.dial=r.Dial.codec().decode(i,i.uint32(),{limits:(l=o.limits)==null?void 0:l.dial});break}case 3:{a.dialResponse=r.DialResponse.codec().decode(i,i.uint32(),{limits:(d=o.limits)==null?void 0:d.dialResponse});break}default:{i.skipType(h&7);break}}}return a})),n),r.encode=i=>Ve(i,r.codec()),r.decode=(i,s)=>ze(i,r.codec(),s)})(Ct||(Ct={}));const $ge=4,Pge=8;var mD,wD;class Dge{constructor(e,t){u(this,"components");u(this,"protocol");u(this,"timeout");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"maxMessageSize");u(this,"started");u(this,"log");u(this,"topologyId");u(this,"dialResults");u(this,"findPeers");u(this,"addressFilter");u(this,"connectionThreshold");u(this,wD,"@libp2p/autonat");u(this,mD,["@libp2p/autonat"]);this.components=e,this.log=e.logger.forComponent("libp2p:auto-nat"),this.started=!1,this.protocol=`/${t.protocolPrefix??xge}/${Sge}/${Age}`,this.timeout=t.timeout??Cge,this.maxInboundStreams=t.maxInboundStreams??kge,this.maxOutboundStreams=t.maxOutboundStreams??Ige,this.connectionThreshold=t.connectionThreshold??_ge,this.maxMessageSize=t.maxMessageSize??Tge,this.dialResults=new Map,this.findPeers=rge(this.findRandomPeers.bind(this),6e4),this.addressFilter=Tl(1024)}get[(wD=Symbol.toStringTag,mD=fr,Cl)](){return["@libp2p/identify"]}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,e=>{this.handleIncomingAutonatStream(e).catch(t=>{this.log.error("error handling incoming autonat stream - %e",t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.topologyId=await this.components.registrar.register(this.protocol,{onConnect:(e,t)=>{this.verifyExternalAddresses(t).catch(n=>{this.log.error("could not verify addresses - %e",n)})}}),this.findPeers.start(),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),this.topologyId!=null&&await this.components.registrar.unhandle(this.topologyId),this.dialResults.clear(),this.findPeers.stop(),this.started=!1}allAddressesAreVerified(){return this.components.addressManager.getAddressesWithMetadata().every(e=>e.expires>Date.now()?!0:e.verified)}async findRandomPeers(e){if(this.allAddressesAreVerified())return;const t=ct([AbortSignal.timeout(1e4),e==null?void 0:e.signal]);try{this.log("starting random walk to find peers to run AutoNAT");for await(const n of this.components.randomWalk.walk({signal:t})){if(!await this.components.connectionManager.isDialable(n.multiaddrs)){this.log.trace("random peer %p was not dialable %s",n.id,n.multiaddrs.map(i=>i.toString()).join(", "));continue}try{this.log.trace("dial random peer %p",n.id),await this.components.connectionManager.openConnection(n.multiaddrs,{signal:t})}catch{}if(this.allAddressesAreVerified()){this.log("stopping random walk, all addresses are verified");return}if(!this.hasConnectionCapacity()){this.log("stopping random walk, too close to max connections");return}}}catch{}}async handleIncomingAutonatStream(e){const t=AbortSignal.timeout(this.timeout),n=Vn(e.stream,{maxDataLength:this.maxMessageSize}).pb(Ct);try{const i=await n.read({signal:t}),s=await this.handleAutonatMessage(i,e.connection,{signal:t});await n.write(s,{signal:t}),await n.unwrap().unwrap().close({signal:t})}catch(i){this.log.error("error handling incoming autonat stream - %e",i),e.stream.abort(i)}}async handleAutonatMessage(e,t,n){const i=this.components.addressManager.getAddresses().map(h=>h.toOptions().host),s=e.dial;if(s==null)return this.log.error("dial was missing from message"),{type:Ct.MessageType.DIAL_RESPONSE,dialResponse:{status:Ct.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}};let o;const a=s.peer;if((a==null?void 0:a.id)==null)return this.log.error("PeerId missing from message"),{type:Ct.MessageType.DIAL_RESPONSE,dialResponse:{status:Ct.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}};try{const h=vge(a.id);o=Zi(h)}catch(h){return this.log.error("invalid PeerId - %e",h),{type:Ct.MessageType.DIAL_RESPONSE,dialResponse:{status:Ct.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}}if(this.log("incoming request from %p",o),!t.remotePeer.equals(o))return this.log("target peer %p did not equal sending peer %p",o,t.remotePeer),{type:Ct.MessageType.DIAL_RESPONSE,dialResponse:{status:Ct.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}};const c=a.addrs.map(h=>Te(h)).filter(h=>{const p=h.toOptions();return Nl(h)?!1:p.host!==t.remoteAddr.toOptions().host?(this.log.trace("not dialing %a - target host did not match remote host %a",h,t.remoteAddr),!1):i.includes(p.host)?!1:this.components.transportManager.dialTransportForMultiaddr(h)==null?(this.log.trace("not dialing %a - transport unsupported",h),!1):!0}).map(h=>(h.getPeerId()==null&&(h=h.encapsulate(`/p2p/${o.toString()}`)),h));if(c.length===0)return this.log("refused to dial all multiaddrs for %p from message",o),{type:Ct.MessageType.DIAL_RESPONSE,dialResponse:{status:Ct.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}};this.log("dial multiaddrs %s for peer %p",c.map(h=>h.toString()).join(", "),o);let l="",d=c[0];for await(const h of c){let p;d=h;try{if(p=await this.components.connectionManager.openConnection(h,n),!p.remoteAddr.equals(h))throw this.log.error("tried to dial %a but dialed %a",h,p.remoteAddr),new Error("Unexpected remote address");return this.log("successfully dialed %p via %a",o,h),{type:Ct.MessageType.DIAL_RESPONSE,dialResponse:{status:Ct.ResponseStatus.OK,addr:p.remoteAddr.decapsulateCode(Re("p2p").code).bytes}}}catch(b){this.log.error("could not dial %p - %e",o,b),l=b.message}finally{p!=null&&await p.close()}}return{type:Ct.MessageType.DIAL_RESPONSE,dialResponse:{status:Ct.ResponseStatus.E_DIAL_ERROR,statusText:l,addr:d.bytes}}}getFirstUnverifiedMultiaddr(e,t){var i,s;const n=this.components.addressManager.getAddressesWithMetadata().sort((o,a)=>o.type==="observed"&&a.type!=="observed"?1:a.type==="observed"&&o.type!=="observed"?-1:0).filter(o=>!(!(o.expires<Date.now())||o.multiaddr.toOptions().family===6&&(!t||!lz(o.multiaddr))||Nl(o.multiaddr)));for(const o of n){const a=o.multiaddr.toString();let c=this.dialResults.get(a);if(c!=null){if(c.networkSegments.includes(e)){this.log.trace("%a already has a network segment result from %s",c.multiaddr,e);continue}if(c.queue.size>10){this.log.trace("%a already has enough peers queued",c.multiaddr);continue}}if(c==null){const l=o.expires<Date.now();if(l&&((s=(i=this.addressFilter).remove)==null||s.call(i,a)),this.addressFilter.has(a))continue;this.addressFilter.add(a),this.log.trace("creating dial result %s %s",l?"to revalidate":"for",a),c={multiaddr:o.multiaddr,success:0,failure:0,networkSegments:[],verifyingPeers:dse(),queue:new nc({concurrency:3,maxSize:50}),type:o.type,lastVerified:o.lastVerified},this.dialResults.set(a,c)}return c}}removeOutdatedMultiaddrResults(){const e=new Set(this.components.addressManager.getAddressesWithMetadata().filter(({expires:t})=>t<Date.now()).map(({multiaddr:t})=>t.toString()));for(const t of this.dialResults.keys())e.has(t)||(this.log.trace("remove results for %a",t),this.dialResults.delete(t))}async verifyExternalAddresses(e){if(!this.isStarted())return;this.removeOutdatedMultiaddrResults();const n=(await this.components.peerStore.get(e.remotePeer)).addresses.some(({multiaddr:o})=>o.toOptions().family===6),i=this.getNetworkSegment(e.remoteAddr),s=this.getFirstUnverifiedMultiaddr(i,n);if(s==null){this.log.trace("no unverified public addresses found for peer %p to verify, not requesting verification",e.remotePeer);return}if(!this.hasConnectionCapacity()){s.lastVerified!=null?(this.log("automatically re-verifying %a because we are too close to the connection limit",s.multiaddr),this.confirmAddress(s)):this.log("skipping verifying %a because we are too close to the connection limit",s.multiaddr);return}s.queue.add(async o=>{await this.askPeerToVerify(e,i,o)},{peerId:e.remotePeer,multiaddr:s.multiaddr}).catch(o=>{(s==null?void 0:s.result)==null&&this.log.error("error from %p verifying address %a - %e",e.remotePeer,s==null?void 0:s.multiaddr,o)})}async askPeerToVerify(e,t,n){let i=this.dialResults.get(n.multiaddr.toString());if(i==null){this.log("%a was verified while %p was queued",n.multiaddr,e.remotePeer);return}const s=AbortSignal.timeout(this.timeout);this.log.trace("asking %p to verify multiaddr %s",e.remotePeer,n.multiaddr);const o=await e.newStream(this.protocol,{signal:s});try{const a=Vn(o).pb(Ct),[,c]=await Promise.all([a.write({type:Ct.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toMultihash().bytes,addrs:[n.multiaddr.bytes]}}},{signal:s}),a.read({signal:s})]);if(c.type!==Ct.MessageType.DIAL_RESPONSE||c.dialResponse==null){this.log("invalid autonat response from %p - %j",e.remotePeer,c);return}const l=c.dialResponse.status;if(this.log.trace("autonat response from %p for %a is %s",e.remotePeer,n.multiaddr,l),l!==Ct.ResponseStatus.OK&&l!==Ct.ResponseStatus.E_DIAL_ERROR)return;if(i=this.dialResults.get(n.multiaddr.toString()),i==null){this.log.trace("peer reported %a as %s but there is no result object",n.multiaddr,c.dialResponse.status);return}if(i.networkSegments.includes(t)){this.log.trace("%a results included network segment %s",n.multiaddr,t);return}if(i.result!=null){this.log.trace("already resolved result for %a, ignoring response from",n.multiaddr,e.remotePeer);return}if(i.verifyingPeers.has(e.remotePeer)){this.log.trace("peer %p has already verified %a, ignoring response",e.remotePeer,n.multiaddr);return}if(i.verifyingPeers.add(e.remotePeer),i.networkSegments.push(t),l===Ct.ResponseStatus.OK){if(i.success++,i.type!=="observed"){this.confirmAddress(i);return}}else l===Ct.ResponseStatus.E_DIAL_ERROR&&i.failure++;this.log("%a success %d failure %d",i.multiaddr,i.success,i.failure),i.success===$ge&&this.confirmAddress(i),i.failure===Pge&&this.unconfirmAddress(i)}finally{try{await o.close({signal:s})}catch(a){o.abort(a)}}}hasConnectionCapacity(){const t=this.components.connectionManager.getConnections().length,n=this.components.connectionManager.getMaxConnections();return t/n*100<this.connectionThreshold}confirmAddress(e){this.log("%s address %a is externally dialable",e.type,e.multiaddr),this.components.addressManager.confirmObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!0,e.queue.abort()}unconfirmAddress(e){this.log("%s address %a is not externally dialable",e.type,e.multiaddr),this.components.addressManager.removeObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!1,e.queue.abort()}getNetworkSegment(e){const t=e.toOptions();return t.family===4?t.host.split(".")[0].padStart(3,"0"):t.host.split(":")[0].padStart(4,"0")}}function Nge(r={}){return e=>new Dge(e,r)}const Oge=pe("dns4"),Rge=pe("dns6"),Bge=pe("dnsaddr"),Ol=zt(pe("dns"),Bge,Oge,Rge),d4=zt(pe("ip4"),pe("ip6")),Md=zt(Ie(d4,pe("tcp")),Ie(Ol,pe("tcp"))),h4=Ie(d4,pe("udp")),Lge=Ie(h4,pe("utp")),Mge=Ie(h4,pe("quic")),Uge=Ie(h4,pe("quic-v1")),rb=zt(Ie(Md,pe("ws")),Ie(Ol,pe("ws"))),Fy=zt(Ie(rb,pe("p2p")),rb),nb=zt(Ie(Md,pe("wss")),Ie(Ol,pe("wss")),Ie(Md,pe("tls"),pe("ws")),Ie(Ol,pe("tls"),pe("ws"))),zy=zt(Ie(nb,pe("p2p")),nb),ib=zt(Ie(Md,pe("http")),Ie(d4,pe("http")),Ie(Ol,pe("http"))),sb=zt(Ie(Md,pe("https")),Ie(d4,pe("https")),Ie(Ol,pe("https"))),F_=Ie(h4,pe("webrtc-direct"),pe("certhash")),hz=zt(Ie(F_,pe("p2p")),F_),z_=Ie(Uge,pe("webtransport"),pe("certhash"),pe("certhash")),fz=zt(Ie(z_,pe("p2p")),z_),pz=zt(Ie(Fy,pe("p2p-webrtc-star"),pe("p2p")),Ie(zy,pe("p2p-webrtc-star"),pe("p2p")),Ie(Fy,pe("p2p-webrtc-star")),Ie(zy,pe("p2p-webrtc-star")));zt(Ie(Fy,pe("p2p-websocket-star"),pe("p2p")),Ie(zy,pe("p2p-websocket-star"),pe("p2p")),Ie(Fy,pe("p2p-websocket-star")),Ie(zy,pe("p2p-websocket-star")));const gz=zt(Ie(ib,pe("p2p-webrtc-direct"),pe("p2p")),Ie(sb,pe("p2p-webrtc-direct"),pe("p2p")),Ie(ib,pe("p2p-webrtc-direct")),Ie(sb,pe("p2p-webrtc-direct"))),Rl=zt(rb,nb,ib,sb,pz,gz,Md,Lge,Mge,Ol,hz,fz);zt(Ie(Rl,pe("p2p-stardust"),pe("p2p")),Ie(Rl,pe("p2p-stardust")));const Pa=zt(Ie(Rl,pe("p2p")),pz,gz,hz,fz,pe("p2p")),V_=zt(Ie(Pa,pe("p2p-circuit"),Pa),Ie(Pa,pe("p2p-circuit")),Ie(pe("p2p-circuit"),Pa),Ie(Rl,pe("p2p-circuit")),Ie(pe("p2p-circuit"),Rl),pe("p2p-circuit")),yz=()=>zt(Ie(V_,yz),V_),Hc=yz(),Fge=zt(Ie(Hc,Pa,Hc),Ie(Pa,Hc),Ie(Hc,Pa),Hc,Pa);zt(Ie(Hc,pe("webrtc"),pe("p2p")),Ie(Hc,pe("webrtc")),Ie(Rl,pe("webrtc"),pe("p2p")),Ie(Rl,pe("webrtc")),pe("webrtc"));function mz(r){function e(t){let n;try{n=Te(t)}catch{return!1}const i=r(n.protoNames());return i===null?!1:i===!0||i===!1?i:i.length===0}return e}function Ie(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(i=>(n=typeof i=="function"?i().partialMatch(t):i.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:mz(e),partialMatch:e}}function zt(...r){function e(n){let i=null;return r.some(s=>{const o=typeof s=="function"?s().partialMatch(n):s.partialMatch(n);return o!=null?(i=o,!0):!1}),i}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:mz(e),partialMatch:e}}function pe(r){const e=r;function t(i){let s;try{s=Te(i)}catch{return!1}const o=s.protoNames();return o.length===1&&o[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}const zge="bootstrap",Vge=50,Kge=1e3;var bD,vD,ED,xD;class wz extends(xD=Gt,ED=Dg,vD=Symbol.toStringTag,bD=fr,xD){constructor(t,n={list:[]}){if(n.list==null||n.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super();u(this,"log");u(this,"timer");u(this,"list");u(this,"timeout");u(this,"components");u(this,"_init");u(this,ED,this);u(this,vD,"@libp2p/bootstrap");u(this,bD,["@libp2p/peer-discovery"]);this.components=t,this.log=t.logger.forComponent("libp2p:bootstrap"),this.timeout=n.timeout??Kge,this.list=[];for(const i of n.list){if(!Fge.matches(i)){this.log.error("Invalid multiaddr");continue}const s=Te(i),o=s.getPeerId();if(o==null){this.log.error("Invalid bootstrap multiaddr without peer id");continue}const a={id:xn(o),multiaddrs:[s]};this.list.push(a)}this._init=n}isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(t=>{this.log.error(t)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(const t of this.list){if(await this.components.peerStore.merge(t.id,{tags:{[this._init.tagName??zge]:{value:this._init.tagValue??Vge,ttl:this._init.tagTTL}},multiaddrs:t.multiaddrs}),this.timer==null)return;this.safeDispatchEvent("peer",{detail:t}),this.components.connectionManager.openConnection(t.id).catch(n=>{this.log.error("could not dial bootstrap peer %p",t.id,n)})}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}}u(wz,"tag","bootstrap");function bz(r){return e=>new wz(e,r)}var Vy;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(n.uint32(26),n.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={publicKey:We(0),payloadType:We(0),payload:We(0),signature:We(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.publicKey=t.bytes();break}case 2:{s.payloadType=t.bytes();break}case 3:{s.payload=t.bytes();break}case 5:{s.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(Vy||(Vy={}));class jge extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}}const wa=class wa{constructor(e){u(this,"publicKey");u(this,"payloadType");u(this,"payload");u(this,"signature");u(this,"marshaled");const{publicKey:t,payloadType:n,payload:i,signature:s}=e;this.publicKey=t,this.payloadType=n,this.payload=i,this.signature=s}marshal(){return this.marshaled==null&&(this.marshaled=Vy.encode({publicKey:Ss(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return Fe(this.marshal(),e.marshal())}async validate(e){const t=K_(e,this.payloadType,this.payload);return this.publicKey.verify(t.subarray(),this.signature)}};u(wa,"createFromProtobuf",async e=>{const t=Vy.decode(e),n=Ji(t.publicKey);return new wa({publicKey:n,payloadType:t.payloadType,payload:t.payload,signature:t.signature})}),u(wa,"seal",async(e,t)=>{if(t==null)throw new Error("Missing private key");const n=e.domain,i=e.codec,s=e.marshal(),o=K_(n,i,s),a=await t.sign(o.subarray());return new wa({publicKey:t.publicKey,payloadType:i,payload:s,signature:a})}),u(wa,"openAndCertify",async(e,t)=>{const n=await wa.createFromProtobuf(e);if(!await n.validate(t))throw new jge("Envelope signature is not valid for the given domain");return n});let ac=wa;const K_=(r,e,t)=>{const n=se(r),i=Hr(n.byteLength),s=Hr(e.length),o=Hr(t.length);return new Be(i,n,s,e,o,t)};function Hge(r,e){const t=(n,i)=>n.toString().localeCompare(i.toString());return r.length!==e.length?!1:(e.sort(t),r.sort(t).every((n,i)=>e[i].equals(n)))}function qge(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var Wge=vz,j_=128,Gge=-128,Qge=Math.pow(2,31);function vz(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Qge;)e[t++]=r&255|j_,r/=128;for(;r&Gge;)e[t++]=r&255|j_,r>>>=7;return e[t]=r|0,vz.bytes=t-n+1,e}var Yge=ob,Jge=128,H_=127;function ob(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw ob.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&H_)<<i:(o&H_)*Math.pow(2,i),i+=7}while(o>=Jge);return ob.bytes=s-n,t}var Xge=Math.pow(2,7),Zge=Math.pow(2,14),eye=Math.pow(2,21),tye=Math.pow(2,28),rye=Math.pow(2,35),nye=Math.pow(2,42),iye=Math.pow(2,49),sye=Math.pow(2,56),oye=Math.pow(2,63),aye=function(r){return r<Xge?1:r<Zge?2:r<eye?3:r<tye?4:r<rye?5:r<nye?6:r<iye?7:r<sye?8:r<oye?9:10},cye={encode:Wge,decode:Yge,encodingLength:aye},q_=cye;function W_(r,e=0){return[q_.decode(r,e),q_.decode.bytes]}function lye(r){const e=qge(r),[t,n]=W_(e),[i,s]=W_(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new uye(t,i,o,e)}let uye=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};const dye="libp2p-peer-record",hye=Uint8Array.from([3,1]);var Ky;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=Ke((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.multiaddr!=null&&i.multiaddr.byteLength>0&&(s.uint32(10),s.bytes(i.multiaddr)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={multiaddr:We(0)},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.multiaddr=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>Ve(i,t.codec()),t.decode=(i,s)=>ze(i,t.codec(),s)})(r.AddressInfo||(r.AddressInfo={}));let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.peerId!=null&&t.peerId.byteLength>0&&(n.uint32(10),n.bytes(t.peerId)),t.seq!=null&&t.seq!==0n&&(n.uint32(16),n.uint64(t.seq)),t.addresses!=null)for(const s of t.addresses)n.uint32(26),r.AddressInfo.codec().encode(s,n);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={peerId:We(0),seq:0n,addresses:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.peerId=t.bytes();break}case 2:{s.seq=t.uint64();break}case 3:{if(((a=i.limits)==null?void 0:a.addresses)!=null&&s.addresses.length===i.limits.addresses)throw new gr('Decode error - map field "addresses" had too many elements');s.addresses.push(r.AddressInfo.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.addresses$}));break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(Ky||(Ky={}));const Gs=class Gs{constructor(e){u(this,"peerId");u(this,"multiaddrs");u(this,"seqNumber");u(this,"domain",Gs.DOMAIN);u(this,"codec",Gs.CODEC);u(this,"marshaled");const{peerId:t,multiaddrs:n,seqNumber:i}=e;this.peerId=t,this.multiaddrs=n??[],this.seqNumber=i??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=Ky.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof Gs)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!Hge(this.multiaddrs,e.multiaddrs))}};u(Gs,"createFromProtobuf",e=>{const t=Ky.decode(e),n=Zi(lye(t.peerId)),i=(t.addresses??[]).map(o=>Te(o.multiaddr)),s=t.seq;return new Gs({peerId:n,multiaddrs:i,seqNumber:s})}),u(Gs,"DOMAIN",dye),u(Gs,"CODEC",hye);let Cs=Gs;function Ez(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var fye=xz,G_=128,pye=-128,gye=Math.pow(2,31);function xz(r,e,t){e=e||[],t=t||0;for(var n=t;r>=gye;)e[t++]=r&255|G_,r/=128;for(;r&pye;)e[t++]=r&255|G_,r>>>=7;return e[t]=r|0,xz.bytes=t-n+1,e}var yye=ab,mye=128,Q_=127;function ab(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw ab.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&Q_)<<i:(o&Q_)*Math.pow(2,i),i+=7}while(o>=mye);return ab.bytes=s-n,t}var wye=Math.pow(2,7),bye=Math.pow(2,14),vye=Math.pow(2,21),Eye=Math.pow(2,28),xye=Math.pow(2,35),Sye=Math.pow(2,42),Aye=Math.pow(2,49),Cye=Math.pow(2,56),kye=Math.pow(2,63),Iye=function(r){return r<wye?1:r<bye?2:r<vye?3:r<Eye?4:r<xye?5:r<Sye?6:r<Aye?7:r<Cye?8:r<kye?9:10},_ye={encode:fye,decode:yye,encodingLength:Iye},Y_=_ye;function J_(r,e=0){return[Y_.decode(r,e),Y_.decode.bytes]}function Tye(r){const e=Ez(r),[t,n]=J_(e),[i,s]=J_(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new $ye(t,i,o,e)}let $ye=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};const Pye=290,Dye=1,Sz=2e3,Nye=100,Vp=`${Am}-circuit-relay`;BigInt(1<<17);const jy="/libp2p/circuit/relay/0.2.0/hop",X_="/libp2p/circuit/relay/0.2.0/stop",Z_=300,Oye=4096,Rye=.001;var Ud;(function(r){(function(n){n.RESERVE="RESERVE",n.CONNECT="CONNECT",n.STATUS="STATUS"})(r.Type||(r.Type={}));let e;(function(n){n[n.RESERVE=0]="RESERVE",n[n.CONNECT=1]="CONNECT",n[n.STATUS=2]="STATUS"})(e||(e={})),function(n){n.codec=()=>En(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=Ke((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.peer!=null&&(i.uint32(18),Fd.codec().encode(n.peer,i)),n.reservation!=null&&(i.uint32(26),Hy.codec().encode(n.reservation,i)),n.limit!=null&&(i.uint32(34),zd.codec().encode(n.limit,i)),n.status!=null&&(i.uint32(40),Xr.codec().encode(n.status,i)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{var c,l,d;const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const h=n.uint32();switch(h>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.peer=Fd.codec().decode(n,n.uint32(),{limits:(c=s.limits)==null?void 0:c.peer});break}case 3:{o.reservation=Hy.codec().decode(n,n.uint32(),{limits:(l=s.limits)==null?void 0:l.reservation});break}case 4:{o.limit=zd.codec().decode(n,n.uint32(),{limits:(d=s.limits)==null?void 0:d.limit});break}case 5:{o.status=Xr.codec().decode(n);break}default:{n.skipType(h&7);break}}}return o})),t),r.encode=n=>Ve(n,r.codec()),r.decode=(n,i)=>ze(n,r.codec(),i)})(Ud||(Ud={}));var Ws;(function(r){(function(n){n.CONNECT="CONNECT",n.STATUS="STATUS"})(r.Type||(r.Type={}));let e;(function(n){n[n.CONNECT=0]="CONNECT",n[n.STATUS=1]="STATUS"})(e||(e={})),function(n){n.codec=()=>En(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=Ke((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.peer!=null&&(i.uint32(18),Fd.codec().encode(n.peer,i)),n.limit!=null&&(i.uint32(26),zd.codec().encode(n.limit,i)),n.status!=null&&(i.uint32(32),Xr.codec().encode(n.status,i)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{var c,l;const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const d=n.uint32();switch(d>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.peer=Fd.codec().decode(n,n.uint32(),{limits:(c=s.limits)==null?void 0:c.peer});break}case 3:{o.limit=zd.codec().decode(n,n.uint32(),{limits:(l=s.limits)==null?void 0:l.limit});break}case 4:{o.status=Xr.codec().decode(n);break}default:{n.skipType(d&7);break}}}return o})),t),r.encode=n=>Ve(n,r.codec()),r.decode=(n,i)=>ze(n,r.codec(),i)})(Ws||(Ws={}));var Fd;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.addrs!=null)for(const s of t.addrs)n.uint32(18),n.bytes(s);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={id:We(0),addrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.id=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.addrs)!=null&&s.addrs.length===i.limits.addrs)throw new gr('Decode error - map field "addrs" had too many elements');s.addrs.push(t.bytes());break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(Fd||(Fd={}));var Hy;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.expire!=null&&t.expire!==0n&&(n.uint32(8),n.uint64(t.expire)),t.addrs!=null)for(const s of t.addrs)n.uint32(18),n.bytes(s);t.voucher!=null&&(n.uint32(26),Wy.codec().encode(t.voucher,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={expire:0n,addrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.expire=t.uint64();break}case 2:{if(((a=i.limits)==null?void 0:a.addrs)!=null&&s.addrs.length===i.limits.addrs)throw new gr('Decode error - map field "addrs" had too many elements');s.addrs.push(t.bytes());break}case 3:{s.voucher=Wy.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.voucher});break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(Hy||(Hy={}));var zd;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.duration!=null&&(n.uint32(8),n.uint32(t.duration)),t.data!=null&&(n.uint32(16),n.uint64(t.data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.duration=t.uint32();break}case 2:{s.data=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(zd||(zd={}));var Xr;(function(r){r.UNUSED="UNUSED",r.OK="OK",r.RESERVATION_REFUSED="RESERVATION_REFUSED",r.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONNECTION_FAILED="CONNECTION_FAILED",r.NO_RESERVATION="NO_RESERVATION",r.MALFORMED_MESSAGE="MALFORMED_MESSAGE",r.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"})(Xr||(Xr={}));var cb;(function(r){r[r.UNUSED=0]="UNUSED",r[r.OK=100]="OK",r[r.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",r[r.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",r[r.PERMISSION_DENIED=202]="PERMISSION_DENIED",r[r.CONNECTION_FAILED=203]="CONNECTION_FAILED",r[r.NO_RESERVATION=204]="NO_RESERVATION",r[r.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",r[r.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"})(cb||(cb={}));(function(r){r.codec=()=>En(cb)})(Xr||(Xr={}));var qy;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.relay!=null&&t.relay.byteLength>0&&(n.uint32(10),n.bytes(t.relay)),t.peer!=null&&t.peer.byteLength>0&&(n.uint32(18),n.bytes(t.peer)),t.expiration!=null&&t.expiration!==0n&&(n.uint32(24),n.uint64(t.expiration)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={relay:We(0),peer:We(0),expiration:0n},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.relay=t.bytes();break}case 2:{s.peer=t.bytes();break}case 3:{s.expiration=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(qy||(qy={}));var Wy;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&(n.uint32(26),qy.codec().encode(t.payload,n)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={publicKey:We(0),payloadType:We(0),signature:We(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.publicKey=t.bytes();break}case 2:{s.payloadType=t.bytes();break}case 3:{s.payload=qy.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.payload});break}case 5:{s.signature=t.bytes();break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(Wy||(Wy={}));function Bye(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var Lye=Bye,Mye=Lye;let Uye=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Fye=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Az(this,e)}},zye=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return Az(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Az(r,e){return new zye({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Vye=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Uye(e,t,n),this.decoder=new Fye(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Cz({name:r,prefix:e,encode:t,decode:n}){return new Vye(r,e,t,n)}function f4({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Mye(t,r);return Cz({prefix:e,name:r,encode:n,decode:s=>Ez(i(s))})}function Kye(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function jye(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Lo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return Cz({prefix:e,name:r,encode(i){return jye(i,n,t)},decode(i){return Kye(i,n,t,r)}})}Lo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Lo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Lo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Lo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Lo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Lo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Lo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Lo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Lo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});f4({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});f4({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});f4({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});f4({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});class lb extends Error{constructor(){super(...arguments);u(this,"name","HadEnoughRelaysError")}}u(lb,"name","HadEnoughRelaysError");class kz extends Error{constructor(){super(...arguments);u(this,"name","DoubleRelayError")}}u(kz,"name","DoubleRelayError");class Iz extends Error{constructor(){super(...arguments);u(this,"name","RelayQueueFullError")}}u(Iz,"name","RelayQueueFullError");function eT(r){const e=r*BigInt(1e3),t=new Date().getTime();return Number(e-BigInt(t))}class tT{constructor(e){u(this,"expires");u(this,"bytes");(e==null?void 0:e.duration)!=null&&(e==null?void 0:e.duration)!==0&&(this.expires=Date.now()+e.duration*1e3),this.bytes=e==null?void 0:e.data,this.bytes===0n&&(this.bytes=void 0),this.onData=this.onData.bind(this)}onData(e){this.bytes!=null&&(this.bytes-=BigInt(e.byteLength),this.bytes<0n&&(this.bytes=0n))}getLimits(){if(this.expires==null&&this.bytes==null)return;const e={};if(this.bytes!=null){const t=this;Object.defineProperty(e,"bytes",{get(){return t.bytes}})}if(this.expires!=null){const t=this;Object.defineProperty(e,"seconds",{get(){return Math.round(((t.expires??0)-Date.now())/1e3)}})}return e}}const _z=wt(Qe(HU.matchers[0],Ge("p2p-circuit"))),Tz=wt(Ge("p2p-circuit"));function rT(r){const{stream:e,remoteAddr:t,logger:n,onDataRead:i,onDataWrite:s}=r,o=n.forComponent("libp2p:stream:converter");let a=!1,c=!1;const l=e.close.bind(e);e.close=async f=>{await l(f),b(!0)};const d=e.abort.bind(e);e.abort=f=>{d(f),b(!0)};const h=e.sink.bind(e);e.sink=async f=>{try{await h(Qi(f,g=>py(g,v=>s==null?void 0:s(v))))}catch(g){g.type!=="aborted"&&o.error("%s error in sink",t,g)}finally{c=!0,b()}};const p={log:o,sink:e.sink,source:async function*(){try{for await(const f of e.source)i==null||i(f),yield f}finally{a=!0,b()}}(),remoteAddr:t,timeline:{open:Date.now(),close:void 0},close:e.close,abort:e.abort};function b(f){f===!0&&(a=!0,c=!0),a&&c&&p.timeline.close==null&&(p.timeline.close=Date.now())}return p}class Hye extends Gt{constructor(t,n={}){super();u(this,"peerStore");u(this,"registrar");u(this,"connectionManager");u(this,"randomWalk");u(this,"started");u(this,"running");u(this,"topologyId");u(this,"log");u(this,"discoveryController");u(this,"filter");u(this,"queue");this.log=t.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.started=!1,this.running=!1,this.peerStore=t.peerStore,this.registrar=t.registrar,this.connectionManager=t.connectionManager,this.randomWalk=t.randomWalk,this.filter=n.filter,this.discoveryController=new AbortController,this.discoveryController.signal}isStarted(){return this.started}async start(){this.topologyId=await this.registrar.register(jy,{filter:this.filter,onConnect:t=>{var n,i;this.log.trace("discovered relay %p queue (length: %d, active %d)",t,(n=this.queue)==null?void 0:n.size,(i=this.queue)==null?void 0:i.running),this.safeDispatchEvent("relay:discover",{detail:t})}}),this.started=!0}stop(){var t;this.topologyId!=null&&this.registrar.unregister(this.topologyId),(t=this.discoveryController)==null||t.abort(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,this.discoveryController.signal,Promise.resolve().then(async()=>{var i;this.log("searching peer store for relays");const t=await this.peerStore.all({filters:[s=>s.protocols.includes(jy)],orders:[()=>Math.random()<.5?1:-1,(s,o)=>{const a=nT(s),c=nT(o);return a>c?-1:c>a?1:0}]});for(const s of t)this.log.trace("found relay peer %p in peer store",s.id),this.safeDispatchEvent("relay:discover",{detail:s.id});this.log("found %d relay peers in peer store",t.length);const n=this.queue=new nc({concurrency:5});this.log("start random walk");for await(const s of this.randomWalk.walk({signal:this.discoveryController.signal})){if(this.log.trace("found random peer %p",s.id),n.has(s.id)){this.log.trace("random peer %p was already in queue",s.id);continue}if(((i=this.connectionManager.getConnections(s.id))==null?void 0:i.length)>0){this.log.trace("random peer %p was already connected",s.id);continue}if(!await this.connectionManager.isDialable(s.multiaddrs)){this.log.trace("random peer %p was not dialable",s.id,s.multiaddrs.map(o=>o.toString()));continue}n.queued>10&&(this.log.trace("wait for space in queue for %p",s.id),await n.onSizeLessThan(10,{signal:this.discoveryController.signal})),this.log("adding random peer %p to dial queue (length: %d, active %d)",s.id,n.size,n.running),n.add(async()=>{const o=ct([this.discoveryController.signal,AbortSignal.timeout(5e3)]);try{await this.connectionManager.openConnection(s.id,{signal:o})}finally{o.clear()}},{peerId:s.id,signal:this.discoveryController.signal}).catch(o=>{this.log.error("error opening connection to random peer %p",s.id,o)})}this.log("stop random walk"),await n.onIdle()}).catch(t=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network",t)}))}stopDiscovery(){var t;this.log("stop discovery"),this.running=!1,(t=this.discoveryController)==null||t.abort()}}function nT(r){const e=r.metadata.get("last-dial-success");return e==null?0:new Date(re(e)).getTime()}class qye extends Gt{constructor(t,n={}){super();u(this,"connectionManager");u(this,"addressManager");u(this,"reservationStore");u(this,"listeningAddrs");u(this,"log");u(this,"listenTimeout");u(this,"reservationId");u(this,"relay");u(this,"_onRemoveRelayPeer",t=>{var n,i;this.log("relay removed %p our relay %p",t.detail.relay,this.relay,(n=this.relay)==null?void 0:n.equals(t.detail.relay)),((i=this.relay)==null?void 0:i.equals(t.detail.relay))===!0&&(this.log("relay peer removed %p",t.detail.relay),this.listeningAddrs.forEach(s=>{this.addressManager.removeObservedAddr(s)}),this.listeningAddrs=[],this.safeDispatchEvent("listening"))});u(this,"_onAddRelayPeer",t=>{const{details:n}=t.detail;n.type!=="configured"&&n.id===this.reservationId&&this.addedRelay(t.detail)});this.log=t.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=t.connectionManager,this.addressManager=t.addressManager,this.reservationStore=t.reservationStore,this.listeningAddrs=[],this.listenTimeout=n.listenTimeout??Sz,this.reservationStore.addEventListener("relay:removed",this._onRemoveRelayPeer),this.reservationStore.addEventListener("relay:created-reservation",this._onAddRelayPeer)}async listen(t){if(Tz.exactMatch(t))this.log("searching for circuit relay servers"),this.reservationId=this.reservationStore.reserveRelay();else if(_z.exactMatch(t)){this.log("listen on specific relay server %a",t);const n=AbortSignal.timeout(this.listenTimeout),i=t.decapsulate("/p2p-circuit"),s=await this.connectionManager.openConnection(i,{signal:n});if(!this.reservationStore.hasReservation(s.remotePeer)){this.log("making reservation on peer %p",s.remotePeer);const o=await this.reservationStore.addRelay(s.remotePeer,"configured");this.addedRelay(o)}}else throw new Og(`Could not listen on p2p-circuit address "${t}"`)}getAddrs(){return[...this.listeningAddrs.values()].flat()}updateAnnounceAddrs(){}async close(){this.reservationStore.cancelReservations(),this.listeningAddrs=[],this.reservationStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),queueMicrotask(()=>{this.safeDispatchEvent("close")})}addedRelay(t){this.log("relay peer added %p",t.relay),this.relay=t.relay,this.listeningAddrs=t.details.reservation.addrs.map(n=>Te(n).encapsulate("/p2p-circuit")),this.listeningAddrs.forEach(n=>{this.addressManager.confirmObservedAddr(n,{type:"transport"})}),queueMicrotask(()=>{this.safeDispatchEvent("listening")})}}function Wye(r){return new qye(r)}const Gye="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Qye=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=Gye[t[r]&63];return e};const Yye=60*1e3*10,Jye=60*1e3*5,Xye=30*1e3;var gn,$z,kf,If;class Zye extends Gt{constructor(t,n){super();qe(this,gn);u(this,"peerId");u(this,"connectionManager");u(this,"peerStore");u(this,"events");u(this,"reserveQueue");u(this,"reservations");u(this,"pendingReservations");u(this,"maxReservationQueueLength");u(this,"reservationCompletionTimeout");u(this,"started");u(this,"log");u(this,"relayFilter");this.log=t.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=t.peerId,this.connectionManager=t.connectionManager,this.peerStore=t.peerStore,this.events=t.events,this.reservations=new bc,this.pendingReservations=[],this.maxReservationQueueLength=(n==null?void 0:n.maxReservationQueueLength)??Nye,this.reservationCompletionTimeout=(n==null?void 0:n.reservationCompletionTimeout)??Sz,this.started=!1,this.relayFilter=Tl(100),this.reserveQueue=new nc({concurrency:(n==null?void 0:n.reservationConcurrency)??Dye,metricName:"libp2p_relay_reservation_queue",metrics:t.metrics}),this.events.addEventListener("connection:close",i=>{[...this.reservations.values()].find(o=>o.connection===i.detail.id)!=null&&Ae(this,gn,kf).call(this,i.detail.remotePeer).catch(o=>{this.log("could not remove relay %p - %e",i.detail,o)})})}isStarted(){return this.started}start(){this.started=!0}afterStart(){Promise.resolve().then(async()=>{const t=await this.peerStore.all({filters:[n=>n.tags.has(Vp)]});this.log("removing tag from %d old relays",t.length),await Promise.all(t.map(async n=>{await this.peerStore.merge(n.id,{tags:{[Vp]:void 0}})})),this.log("redialing %d old relays",t.length),await Promise.all(t.map(async n=>this.addRelay(n.id,"discovered"))),Ae(this,gn,If).call(this)}).catch(t=>{this.log.error(t)})}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:t})=>{clearTimeout(t)}),this.reservations.clear(),this.started=!1}reserveRelay(){const t=Qye();return this.pendingReservations.push(t),Ae(this,gn,If).call(this),t}async addRelay(t,n){if(this.peerId.equals(t))throw this.log.trace("not trying to use self as relay"),new Og("Cannot use self as relay");if(this.reserveQueue.size>this.maxReservationQueueLength)throw new Iz("The reservation queue is full");const i=this.reserveQueue.find(t);if(i!=null)return this.log.trace("potential relay peer %p is already in the reservation queue",t),i.join();if(this.relayFilter.has(t.toMultihash().bytes))throw new Og("The relay was previously invalid");return this.log.trace("try to reserve relay slot with %p",t),this.reserveQueue.add(async()=>{const s=Date.now();try{const o=this.reservations.get(t);if(o!=null){const g=this.connectionManager.getConnections(t);let v=!1;if(g.length===0&&this.log("already have relay reservation with %p but we are no longer connected",t),g.map(y=>y.id).includes(o.connection)&&(this.log("already have relay reservation with %p and the original connection is still open",t),v=!0),v&&eT(o.reservation.expire)>Yye)return this.log("already have relay reservation with %p but we are still connected and it does not expire soon",t),{relay:t,details:o};await Ae(this,gn,kf).call(this,t)}if(n==="discovered"&&this.pendingReservations.length===0)throw new lb("Not making reservation on discovered relay because we do not need any more relays");const a=AbortSignal.timeout(this.reservationCompletionTimeout);const c=await this.connectionManager.openConnection(t,{signal:a});if(sc.matches(c.remoteAddr))throw new kz("not creating reservation over relayed connection");const l=await Ae(this,gn,$z).call(this,c,{signal:a}),d=eT(l.expire);this.log("created reservation on relay peer %p, expiry date is %s",t,new Date(Date.now()+d).toString());const h=Math.min(Math.max(d-Jye,Xye),Math.pow(2,31)-1),p=setTimeout(()=>{this.log("refresh reservation to relay %p",t),this.addRelay(t,n).catch(async g=>{this.log.error("could not refresh reservation to relay %p - %e",t,g),await Ae(this,gn,kf).call(this,t)}).catch(g=>{this.log.error("could not remove expired reservation to relay %p - %e",t,g)})},h);let b;if(n==="discovered"){const g=this.pendingReservations.pop();if(g==null)throw new lb("Made reservation on relay but did not need any more discovered relays");b={timeout:p,reservation:l,type:n,connection:c.id,id:g}}else b={timeout:p,reservation:l,type:n,connection:c.id};this.reservations.set(t,b),await this.peerStore.merge(t,{tags:{[Vp]:{value:1,ttl:d}}}),Ae(this,gn,If).call(this);const f={relay:t,details:b};return this.safeDispatchEvent("relay:created-reservation",{detail:f}),f}catch(o){throw n==="discovered"&&o.name==="HadEnoughRelaysError"||this.log.error("could not reserve slot on %p after %dms - %e",t,Date.now()-s,o),(o.name==="DialError"||o.name==="UnsupportedProtocolError")&&this.relayFilter.add(t.toMultihash().bytes),Ae(this,gn,kf).call(this,t).catch(a=>{this.log.error("could not remove reservation on %p after reserving slot failed - %e",t,a)}),o}},{peerId:t})}hasReservation(t){return this.reservations.has(t)}getReservation(t){var n;return(n=this.reservations.get(t))==null?void 0:n.reservation}reservationCount(t){return t==null?this.reservations.size:[...this.reservations.values()].reduce((n,i)=>(i.type===t&&n++,n),0)}cancelReservations(){[...this.reservations.values()].forEach(t=>{clearTimeout(t.timeout)}),this.reservations.clear()}}gn=new WeakSet,$z=async function(t,n){var l;(l=n.signal)==null||l.throwIfAborted(),this.log("requesting reservation from %p",t.remotePeer);const i=await t.newStream(jy,n),o=Vn(i).pb(Ud);this.log.trace("send RESERVE to %p",t.remotePeer),await o.write({type:Ud.Type.RESERVE},n);let a;try{this.log.trace("reading response from %p",t.remotePeer),a=await o.read(n)}catch(d){throw i.abort(d),d}finally{i.status!=="closed"&&await i.close(n)}if(this.log.trace("read response %o",a),a.status===Xr.OK&&a.reservation!=null){const d=new Set;d.add(t.remoteAddr.toString());for(const h of a.reservation.addrs){let p=Te(h);p.getPeerId()==null&&(p=p.encapsulate(`/p2p/${t.remotePeer}`)),p=Te(p.toString().replace(`/p2p/${t.remotePeer}/p2p/${t.remotePeer}`,`/p2p/${t.remotePeer}`)),d.add(p.toString())}return a.reservation.addrs=[...d].map(h=>Te(h).bytes),a.reservation}const c=`reservation failed with status ${a.status??"undefined"}`;throw this.log.error(c),new Error(c)},kf=async function(t){const n=this.reservations.get(t);n!=null&&(this.log("removing relay reservation with %p from local store",t),clearTimeout(n.timeout),this.reservations.delete(t),n.type==="discovered"&&this.pendingReservations.push(n.id),await this.peerStore.merge(t,{tags:{[Vp]:void 0}}),this.safeDispatchEvent("relay:removed",{detail:{relay:t,details:n}}),Ae(this,gn,If).call(this))},If=function(){if(this.pendingReservations.length===0){this.log.trace("have discovered enough relays"),this.reserveQueue.clear(),this.safeDispatchEvent("relay:found-enough-relays");return}this.relayFilter=Tl(100),this.log("not discovered enough relays %d/%d",this.reservations.size,this.pendingReservations.length),this.safeDispatchEvent("relay:not-enough-relays")};const e3e=r=>{if(r.peer==null)return!1;try{r.peer.addrs.forEach(Te)}catch{return!1}return!0},iT={maxInboundStopStreams:Z_,maxOutboundStopStreams:Z_};var SD,AD,CD,kD;class t3e{constructor(e,t={}){u(this,"discovery");u(this,"registrar");u(this,"peerStore");u(this,"connectionManager");u(this,"transportManager");u(this,"peerId");u(this,"upgrader");u(this,"addressManager");u(this,"connectionGater");u(this,"reservationStore");u(this,"logger");u(this,"maxInboundStopStreams");u(this,"maxOutboundStopStreams");u(this,"started");u(this,"log");u(this,"shutdownController");u(this,kD,"@libp2p/circuit-relay-v2-transport");u(this,CD,["@libp2p/transport","@libp2p/circuit-relay-v2-transport"]);u(this,SD,!0);this.log=e.logger.forComponent("libp2p:circuit-relay:transport"),this.registrar=e.registrar,this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.logger=e.logger,this.peerId=e.peerId,this.upgrader=e.upgrader,this.addressManager=e.addressManager,this.connectionGater=e.connectionGater,this.maxInboundStopStreams=t.maxInboundStopStreams??iT.maxInboundStopStreams,this.maxOutboundStopStreams=t.maxOutboundStopStreams??iT.maxOutboundStopStreams,this.shutdownController=new AbortController,this.discovery=new Hye(e,{filter:t.discoveryFilter??Ise(Oye,Rye)}),this.discovery.addEventListener("relay:discover",n=>{this.reservationStore.addRelay(n.detail,"discovered").catch(i=>{i.name!=="HadEnoughRelaysError"&&i.name!=="RelayQueueFullError"&&this.log.error("could not add discovered relay %p",n.detail,i)})}),this.reservationStore=new Zye(e,t),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{var n;(n=this.discovery)==null||n.startDiscovery()}),this.reservationStore.addEventListener("relay:found-enough-relays",()=>{var n;(n=this.discovery)==null||n.stopDiscovery()}),this.started=!1}get[(kD=Symbol.toStringTag,CD=fr,AD=Cl,SD=Cm,AD)](){return this.discovery!=null?["@libp2p/identify"]:[]}isStarted(){return this.started}async start(){this.shutdownController=new AbortController,await this.registrar.handle(X_,e=>{const t=this.upgrader.createInboundAbortSignal(this.shutdownController.signal);this.onStop(e,t).catch(n=>{this.log.error("error while handling STOP protocol",n),e.stream.abort(n)}).finally(()=>{t.clear()})},{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0}),await Eo(this.discovery,this.reservationStore),this.started=!0}async stop(){this.shutdownController.abort(),await mc(this.discovery,this.reservationStore),await this.registrar.unhandle(X_),this.started=!1}async dial(e,t){var b,f,g,v,y,w;if(e.protoCodes().filter(m=>m===Pye).length!==1){const m="Invalid circuit relay address";throw this.log.error(m,e),new Gu(m)}const n=e.toString().split("/p2p-circuit"),i=Te(n[0]),s=Te(n[n.length-1]),o=i.getPeerId(),a=s.getPeerId();if(o==null||a==null){const m=`ircuit relay dial to ${e.toString()} failed as address did not have both relay and destination PeerIDs`;throw this.log.error(`c${m}`),new Gu(`C${m}`)}const c=xn(o),l=xn(a);let h=this.connectionManager.getConnections(c)[0];h==null?(await this.peerStore.merge(c,{multiaddrs:[i]}),(b=t.onProgress)==null||b.call(t,new ke("circuit-relay:open-connection")),h=await this.connectionManager.openConnection(c,t)):(f=t.onProgress)==null||f.call(t,new ke("circuit-relay:reuse-connection"));let p;try{(g=t.onProgress)==null||g.call(t,new ke("circuit-relay:open-hop-stream")),p=await h.newStream(jy,t);const m=Vn(p),E=m.pb(Ud);(v=t.onProgress)==null||v.call(t,new ke("circuit-relay:write-connect-message")),await E.write({type:Ud.Type.CONNECT,peer:{id:l.toMultihash().bytes,addrs:[Te(s).bytes]}},t),(y=t.onProgress)==null||y.call(t,new ke("circuit-relay:read-connect-response"));const C=await E.read(t);if(C.status!==Xr.OK)throw new pt(`failed to connect via relay with status ${((w=C==null?void 0:C.status)==null?void 0:w.toString())??"undefined"}`);const k=new tT(C.limit),A=rT({stream:m.unwrap(),remoteAddr:e,localAddr:i.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`),logger:this.logger,onDataRead:k.onData,onDataWrite:k.onData});return this.log("new outbound relayed connection %a",A.remoteAddr),await this.upgrader.upgradeOutbound(A,{...t,limits:k.getLimits()})}catch(m){throw this.log.error("circuit relay dial to destination %p via relay %p failed",l,c,m),p==null||p.abort(m),m}}createListener(e){return Wye({peerId:this.peerId,connectionManager:this.connectionManager,addressManager:this.addressManager,reservationStore:this.reservationStore,logger:this.logger})}listenFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>_z.exactMatch(t)||Tz.exactMatch(t))}dialFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>sc.exactMatch(t))}async onStop({connection:e,stream:t},n){var d,h;if(!this.reservationStore.hasReservation(e.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.transportManager.listen([e.remoteAddr.encapsulate("/p2p-circuit")])}catch(p){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on",p)}const i=Vn(t).pb(Ws),s=await i.read({signal:n});if(this.log("new circuit relay v2 stop stream from %p with type %s",e.remotePeer,s.type),(s==null?void 0:s.type)===void 0){this.log.error("type was missing from circuit v2 stop protocol request from %s",e.remotePeer),await i.write({type:Ws.Type.STATUS,status:Xr.MALFORMED_MESSAGE},{signal:n}),await t.close();return}if(s.type!==Ws.Type.CONNECT){this.log.error("invalid stop connect request via peer %p",e.remotePeer),await i.write({type:Ws.Type.STATUS,status:Xr.UNEXPECTED_MESSAGE},{signal:n}),await t.close();return}if(!e3e(s)){this.log.error("invalid stop connect request via peer %p",e.remotePeer),await i.write({type:Ws.Type.STATUS,status:Xr.MALFORMED_MESSAGE},{signal:n}),await t.close({signal:n});return}const o=Zi(Tye(s.peer.id));if(await((h=(d=this.connectionGater).denyInboundRelayedConnection)==null?void 0:h.call(d,e.remotePeer,o))===!0){this.log.error("connection gater denied inbound relayed connection from %p",e.remotePeer),await i.write({type:Ws.Type.STATUS,status:Xr.PERMISSION_DENIED},{signal:n}),await t.close({signal:n});return}this.log.trace("sending success response to %p",e.remotePeer),await i.write({type:Ws.Type.STATUS,status:Xr.OK},{signal:n});const a=new tT(s.limit),c=e.remoteAddr.encapsulate(`/p2p-circuit/p2p/${o.toString()}`);this.addressManager.getAddresses()[0];const l=rT({stream:i.unwrap().unwrap(),remoteAddr:c,logger:this.logger,onDataRead:a.onData,onDataWrite:a.onData});this.log("new inbound relayed connection %a",l.remoteAddr),await this.upgrader.upgradeInbound(l,{limits:a.getLimits(),signal:n}),this.log("%s connection %a upgraded","inbound",l.remoteAddr)}}function r3e(r={}){return e=>new t3e(e,r)}const sT=()=>{const r=new Error("Delay aborted");return r.name="AbortError",r},n3e=new WeakMap;function i3e({clearTimeout:r,setTimeout:e}={}){return(t,{value:n,signal:i}={})=>{if(i!=null&&i.aborted)return Promise.reject(sT());let s,o,a;const c=r??clearTimeout,l=()=>{c(s),a(sT())},d=()=>{i&&i.removeEventListener("abort",l)},h=new Promise((p,b)=>{o=()=>{d(),p(n)},a=b,s=(e??setTimeout)(o,t)});return i&&i.addEventListener("abort",l,{once:!0}),n3e.set(h,()=>{c(s),s=null,o()}),h}}const Pz=i3e();var fs;(function(r){(function(n){n.UNUSED="UNUSED",n.CONNECT="CONNECT",n.SYNC="SYNC"})(r.Type||(r.Type={}));let e;(function(n){n[n.UNUSED=0]="UNUSED",n[n.CONNECT=100]="CONNECT",n[n.SYNC=300]="SYNC"})(e||(e={})),function(n){n.codec=()=>En(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=Ke((n,i,s={})=>{if(s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.observedAddresses!=null)for(const o of n.observedAddresses)i.uint32(18),i.bytes(o);s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{var c;const o={observedAddresses:[]},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const l=n.uint32();switch(l>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{if(((c=s.limits)==null?void 0:c.observedAddresses)!=null&&o.observedAddresses.length===s.limits.observedAddresses)throw new gr('Decode error - map field "observedAddresses" had too many elements');o.observedAddresses.push(n.bytes());break}default:{n.skipType(l&7);break}}}return o})),t),r.encode=n=>Ve(n,r.codec()),r.decode=(n,i)=>ze(n,r.codec(),i)})(fs||(fs={}));function oT(r,e){return sc.matches(r)||e.dialTransportForMultiaddr(r)==null?!1:MU.matches(r)?!0:Xue.matches(r)?vc(r.toOptions().host)===!1:!1}const aT=1024*4,cT=100,Kp={timeout:5e3,retries:3,maxInboundStreams:1,maxOutboundStreams:1};var ID,_D;_D=Symbol.toStringTag,ID=Cl;class s3e{constructor(e,t){u(this,"started");u(this,"timeout");u(this,"retries");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"peerStore");u(this,"registrar");u(this,"connectionManager");u(this,"addressManager");u(this,"transportManager");u(this,"topologyId");u(this,"log");u(this,_D,"@libp2p/dcutr");u(this,ID,["@libp2p/identify"]);this.log=e.logger.forComponent("libp2p:dcutr"),this.started=!1,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.timeout=t.timeout??Kp.timeout,this.retries=t.retries??Kp.retries,this.maxInboundStreams=t.maxInboundStreams??Kp.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??Kp.maxOutboundStreams}isStarted(){return this.started}async start(){this.started||(this.topologyId=await this.registrar.register(jp,{notifyOnLimitedConnection:!0,onConnect:(e,t)=>{sc.exactMatch(t.remoteAddr)&&t.direction==="inbound"&&this.upgradeInbound(t).catch(n=>{this.log.error("error during outgoing DCUtR attempt",n)})}}),await this.registrar.handle(jp,e=>{this.handleIncomingUpgrade(e.stream,e.connection).catch(t=>{this.log.error("error during incoming DCUtR attempt",t),e.stream.abort(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:!0}),this.started=!0)}async stop(){await this.registrar.unhandle(jp),this.topologyId!=null&&this.registrar.unregister(this.topologyId),this.started=!1}async upgradeInbound(e){if(await this.attemptUnilateralConnectionUpgrade(e))return;let t;for(let n=0;n<this.retries;n++){const i={signal:AbortSignal.timeout(this.timeout)};try{t=await e.newStream([jp],{signal:i.signal,runOnLimitedConnection:!0});const s=Vn(t,{maxDataLength:aT}).pb(fs);this.log("B sending connect to %p",e.remotePeer);const o=Date.now();await s.write({type:fs.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(h=>h.bytes)},i),this.log("B receiving connect from %p",e.remotePeer);const a=await s.read(i);if(a.type!==fs.Type.CONNECT)throw this.log("A sent wrong message type"),new pt("DCUtR message type was incorrect");const c=this.getDialableMultiaddrs(a.observedAddresses);if(c.length===0)throw this.log("A did not have any dialable multiaddrs"),new pt("DCUtR connect message had no multiaddrs");const l=Date.now()-o;this.log("A sending sync, rtt %dms",l),await s.write({type:fs.Type.SYNC,observedAddresses:[]},i),this.log("A waiting for half RTT"),await Pz(l/2),this.log("B dialing",c);const d=await this.connectionManager.openConnection(c,{signal:i.signal,priority:cT,force:!0,initiator:!1});this.log("DCUtR to %p succeeded to address %a, closing relayed connection",e.remotePeer,d.remoteAddr),await e.close(i);break}catch(s){if(this.log.error("error while attempting DCUtR on attempt %d of %d",n+1,this.retries,s),t==null||t.abort(s),n===this.retries)throw s}finally{t!=null&&await t.close(i)}}}async attemptUnilateralConnectionUpgrade(e){const n=(await this.peerStore.get(e.remotePeer)).addresses.map(i=>{const s=i.multiaddr;return s.getPeerId()==null?s.encapsulate(`/p2p/${e.remotePeer}`):s}).filter(i=>oT(i,this.transportManager));if(n.length>0){const i=AbortSignal.timeout(this.timeout);try{this.log("attempting unilateral connection upgrade to %a",n);const s=await this.connectionManager.openConnection(n,{signal:i,force:!0});if(sc.exactMatch(s.remoteAddr))throw new Error("Could not open a new, non-limited, connection");return this.log("unilateral connection upgrade to %p succeeded via %a, closing relayed connection",e.remotePeer,s.remoteAddr),await e.close({signal:i}),!0}catch(s){this.log.error("unilateral connection upgrade to %p on addresses %a failed",e.remotePeer,n,s)}}else this.log("peer %p has no public addresses, not attempting unilateral connection upgrade",e.remotePeer);return!1}async handleIncomingUpgrade(e,t){const n={signal:AbortSignal.timeout(this.timeout)};try{const i=Vn(e,{maxDataLength:aT}).pb(fs);this.log("A receiving connect");const s=await i.read(n);if(s.type!==fs.Type.CONNECT)throw this.log("B sent wrong message type"),new pt("DCUtR message type was incorrect");if(s.observedAddresses.length===0)throw this.log("B sent no multiaddrs"),new pt("DCUtR connect message had no multiaddrs");const o=this.getDialableMultiaddrs(s.observedAddresses);if(o.length===0)throw this.log("B had no dialable multiaddrs"),new pt("DCUtR connect message had no dialable multiaddrs");if(this.log("A sending connect"),await i.write({type:fs.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(l=>l.bytes)}),this.log("A receiving sync"),(await i.read(n)).type!==fs.Type.SYNC)throw new pt("DCUtR message type was incorrect");this.log("A dialing",o);const c=await this.connectionManager.openConnection(o,{signal:n.signal,priority:cT,force:!0});this.log("DCUtR to %p succeeded via %a, closing relayed connection",t.remotePeer,c.remoteAddr),await t.close(n)}catch(i){this.log.error("incoming DCUtR from %p failed",t.remotePeer,i),e.abort(i)}finally{await e.close(n)}}getDialableMultiaddrs(e){const t=[];for(const n of e)if(!(n==null||n.length===0))try{const i=Te(n);if(!oT(i,this.transportManager))continue;t.push(i)}catch{}return t}}const jp="/libp2p/dcutr";function o3e(r={}){return e=>new s3e(e,r)}const Hp=globalThis.CustomEvent??Event;async function*I0(r,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);const n=e.ordered??!1,i=new EventTarget,s=[];let o=De(),a=De(),c=!1,l,d=!1;i.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(const f of r){if(s.length===t&&(o=De(),await o.promise),d)break;const g={done:!1};s.push(g),f().then(v=>{g.done=!0,g.ok=!0,g.value=v,i.dispatchEvent(new Hp("task-complete"))},v=>{g.done=!0,g.err=v,i.dispatchEvent(new Hp("task-complete"))})}c=!0,i.dispatchEvent(new Hp("task-complete"))}catch(f){l=f,i.dispatchEvent(new Hp("task-complete"))}});function h(){var f;return n?(f=s[0])==null?void 0:f.done:!!s.find(g=>g.done)}function*p(){for(;s.length>0&&s[0].done;){const f=s[0];if(s.shift(),f.ok)yield f.value;else throw d=!0,o.resolve(),f.err;o.resolve()}}function*b(){for(;h();)for(let f=0;f<s.length;f++)if(s[f].done){const g=s[f];if(s.splice(f,1),f--,g.ok)yield g.value;else throw d=!0,o.resolve(),g.err;o.resolve()}}for(;;){if(h()||(a=De(),await a.promise),l!=null)throw l;if(n?yield*p():yield*b(),c&&s.length===0)break}}const a3e="0.1.0",c3e="id",l3e="id/push",u3e="1.0.0",d3e="1.0.0",h3e=1024*8,f3e=32;var Vd;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.protocolVersion!=null&&(n.uint32(42),n.string(t.protocolVersion)),t.agentVersion!=null&&(n.uint32(50),n.string(t.agentVersion)),t.publicKey!=null&&(n.uint32(10),n.bytes(t.publicKey)),t.listenAddrs!=null)for(const s of t.listenAddrs)n.uint32(18),n.bytes(s);if(t.observedAddr!=null&&(n.uint32(34),n.bytes(t.observedAddr)),t.protocols!=null)for(const s of t.protocols)n.uint32(26),n.string(s);t.signedPeerRecord!=null&&(n.uint32(66),n.bytes(t.signedPeerRecord)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={listenAddrs:[],protocols:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 5:{s.protocolVersion=t.string();break}case 6:{s.agentVersion=t.string();break}case 1:{s.publicKey=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.listenAddrs)!=null&&s.listenAddrs.length===i.limits.listenAddrs)throw new gr('Decode error - map field "listenAddrs" had too many elements');s.listenAddrs.push(t.bytes());break}case 4:{s.observedAddr=t.bytes();break}case 3:{if(((c=i.limits)==null?void 0:c.protocols)!=null&&s.protocols.length===i.limits.protocols)throw new gr('Decode error - map field "protocols" had too many elements');s.protocols.push(t.string());break}case 8:{s.signedPeerRecord=t.bytes();break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(Vd||(Vd={}));const si={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:h3e,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnLimitedConnection:!0,concurrency:f3e};function p3e(r){if(r!=null&&r.length>0)try{return Te(r)}catch{}}function g3e(r,e){return e??r.userAgent}async function Dz(r,e,t,n,i){if(t("received identify from %p",n.remotePeer),i==null)throw new pt("message was null or undefined");const s={};if(i.listenAddrs.length>0&&(s.addresses=i.listenAddrs.map(c=>({isCertified:!1,multiaddr:Te(c)}))),i.protocols.length>0&&(s.protocols=i.protocols),i.publicKey!=null){const c=Ji(i.publicKey);if(!$d(c).equals(n.remotePeer))throw new pt("public key did not match remote PeerId");s.publicKey=c}let o;if(i.signedPeerRecord!=null){t.trace("received signedPeerRecord from %p",n.remotePeer);let c=i.signedPeerRecord;const l=await ac.openAndCertify(c,Cs.DOMAIN);let d=Cs.createFromProtobuf(l.payload);const h=ph(l.publicKey.toCID());if(!d.peerId.equals(h))throw new pt("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(d.peerId))throw new pt("signing key does not match remote PeerId");let p;try{p=await r.get(d.peerId)}catch(b){if(b.name!=="NotFoundError")throw b}if(p!=null&&(s.metadata=p.metadata,p.peerRecordEnvelope!=null)){const b=await ac.createFromProtobuf(p.peerRecordEnvelope),f=Cs.createFromProtobuf(b.payload);f.seqNumber>=d.seqNumber&&(t("sequence number was lower or equal to existing sequence number - stored: %d received: %d",f.seqNumber,d.seqNumber),d=f,c=p.peerRecordEnvelope)}s.peerRecordEnvelope=c,s.addresses=d.multiaddrs.map(b=>({isCertified:!0,multiaddr:b})),o={seq:d.seqNumber,addresses:d.multiaddrs}}else t("%p did not send a signed peer record",n.remotePeer);if(t.trace("patching %p with",n.remotePeer,s),await r.patch(n.remotePeer,s),i.agentVersion!=null||i.protocolVersion!=null){const c={};i.agentVersion!=null&&(c.AgentVersion=se(i.agentVersion)),i.protocolVersion!=null&&(c.ProtocolVersion=se(i.protocolVersion)),t.trace("merging %p metadata",n.remotePeer,c),await r.merge(n.remotePeer,{metadata:c})}const a={peerId:n.remotePeer,protocolVersion:i.protocolVersion,agentVersion:i.agentVersion,publicKey:i.publicKey,listenAddrs:i.listenAddrs.map(c=>Te(c)),observedAddr:i.observedAddr==null?void 0:Te(i.observedAddr),protocols:i.protocols,signedPeerRecord:o,connection:n};return e.safeDispatchEvent("peer:identify",{detail:a}),a}class Nz{constructor(e,t){u(this,"host");u(this,"protocol");u(this,"started");u(this,"timeout");u(this,"peerId");u(this,"privateKey");u(this,"peerStore");u(this,"registrar");u(this,"addressManager");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"maxMessageSize");u(this,"maxObservedAddresses");u(this,"events");u(this,"runOnLimitedConnection");u(this,"log");this.protocol=t.protocol,this.started=!1,this.peerId=e.peerId,this.privateKey=e.privateKey,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.events=e.events,this.log=t.log,this.timeout=t.timeout??si.timeout,this.maxInboundStreams=t.maxInboundStreams??si.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??si.maxOutboundStreams,this.maxMessageSize=t.maxMessageSize??si.maxMessageSize,this.maxObservedAddresses=t.maxObservedAddresses??si.maxObservedAddresses,this.runOnLimitedConnection=t.runOnLimitedConnection??si.runOnLimitedConnection,this.host={protocolVersion:`${t.protocolPrefix??si.protocolPrefix}/${a3e}`,agentVersion:g3e(e.nodeInfo,t.agentVersion)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:se(this.host.agentVersion),ProtocolVersion:se(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,e=>{this.handleProtocol(e).catch(t=>{this.log.error(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}}var TD,$D;class y3e extends($D=Nz,TD=fr,$D){constructor(t,n={}){super(t,{...n,protocol:`/${n.protocolPrefix??si.protocolPrefix}/${l3e}/${d3e}`,log:t.logger.forComponent("libp2p:identify-push")});u(this,"connectionManager");u(this,"concurrency");u(this,TD,["@libp2p/identify-push"]);this.connectionManager=t.connectionManager,this.concurrency=n.concurrency??si.concurrency,(n.runOnSelfUpdate??si.runOnSelfUpdate)&&t.events.addEventListener("self:peer:update",i=>{this.push().catch(s=>{this.log.error(s)})})}async push(){if(!this.isStarted())return;const t=this.addressManager.getAddresses().map(h=>h.decapsulateCode(Re("p2p").code)),n=new Cs({peerId:this.peerId,multiaddrs:t}),i=await ac.seal(n,this.privateKey),s=this.registrar.getProtocols(),o=await this.peerStore.get(this.peerId),a=re(o.metadata.get("AgentVersion")??se(this.host.agentVersion)),c=re(o.metadata.get("ProtocolVersion")??se(this.host.protocolVersion)),l=this;async function*d(){for(const h of l.connectionManager.getConnections())(await l.peerStore.get(h.remotePeer)).protocols.includes(l.protocol)&&(yield async()=>{let b;const f=AbortSignal.timeout(l.timeout);try{b=await h.newStream(l.protocol,{signal:f,runOnLimitedConnection:l.runOnLimitedConnection}),await Vn(b,{maxDataLength:l.maxMessageSize}).pb(Vd).write({listenAddrs:t.map(v=>v.bytes),signedPeerRecord:i.marshal(),protocols:s,agentVersion:a,protocolVersion:c},{signal:f}),await b.close({signal:f})}catch(g){l.log.error("could not push identify update to peer",g),b==null||b.abort(g)}})}await vo(I0(d(),{concurrency:this.concurrency}))}async handleProtocol(t){const{connection:n,stream:i}=t;try{if(this.peerId.equals(n.remotePeer))throw new Error("received push from ourselves?");const s={signal:AbortSignal.timeout(this.timeout)},a=await Vn(i,{maxDataLength:this.maxMessageSize}).pb(Vd).read(s);await i.close(s),await Dz(this.peerStore,this.events,this.log,n,a)}catch(s){this.log.error("received invalid message",s),i.abort(s);return}this.log.trace("handled push from %p",n.remotePeer)}}const m3e=41;var PD,DD;class w3e extends(DD=Nz,PD=fr,DD){constructor(t,n={}){super(t,{...n,protocol:`/${n.protocolPrefix??si.protocolPrefix}/${c3e}/${u3e}`,log:t.logger.forComponent("libp2p:identify")});u(this,PD,["@libp2p/identify"]);(n.runOnConnectionOpen??si.runOnConnectionOpen)&&t.events.addEventListener("connection:open",i=>{const s=i.detail;this.identify(s).catch(o=>{o.name!==y0.name&&this.log.error("error during identify trigged by connection:open",o)})})}async _identify(t,n={}){let i;if(n.signal==null){const s=AbortSignal.timeout(this.timeout);n={...n,signal:s}}try{i=await t.newStream(this.protocol,{...n,runOnLimitedConnection:this.runOnLimitedConnection});const o=await Vn(i,{maxDataLength:this.maxMessageSize}).pb(Vd).read(n);return await i.close(n),o}catch(s){throw i==null||i.abort(s),s}}async identify(t,n={}){const i=await this._identify(t,n),{publicKey:s,protocols:o,observedAddr:a}=i;if(s==null)throw new pt("public key was missing from identify message");const c=Ji(s),l=ph(c.toCID());if(!t.remotePeer.equals(l))throw new pt("identified peer does not match the expected peer");if(this.peerId.equals(l))throw new pt("identified peer is our own peer id?");return this.maybeAddObservedAddress(a),this.log("identify completed for peer %p and protocols %o",l,o),Dz(this.peerStore,this.events,this.log,t,i)}maybeAddObservedAddress(t){const n=p3e(t);if(n==null)return;if(this.log.trace("our observed address was %a",n),Nl(n)){this.log.trace("our observed address was private");return}if(n.stringTuples()[0][0]===m3e&&!lz(n)){this.log.trace("our observed address was IPv6 but not a global unicast address");return}my.exactMatch(n)||(this.log.trace("storing the observed address"),this.addressManager.addObservedAddr(n))}async handleProtocol(t){const{connection:n,stream:i}=t,s=AbortSignal.timeout(this.timeout);try{const o=await this.peerStore.get(this.peerId),a=this.addressManager.getAddresses().map(h=>h.decapsulateCode(Re("p2p").code));let c=o.peerRecordEnvelope;if(a.length>0&&c==null){const h=new Cs({peerId:this.peerId,multiaddrs:a});c=(await ac.seal(h,this.privateKey)).marshal().subarray()}let l=n.remoteAddr.bytes;Jue.matches(n.remoteAddr)||(l=void 0),await Vn(i).pb(Vd).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:Ss(this.privateKey.publicKey),listenAddrs:a.map(h=>h.bytes),signedPeerRecord:c,observedAddr:l,protocols:o.protocols},{signal:s}),await i.close({signal:s})}catch(o){this.log.error("could not respond to identify request",o),i.abort(o)}}}function b3e(r={}){return e=>new w3e(e,r)}function v3e(r={}){return e=>new y3e(e,r)}const _0=1e3,zx=60*_0,p4=60*zx,E3e=36*p4,x3e="/ipfs/kad/1.0.0",S3e=48*p4,A3e=24*p4,C3e=10,k3e=16384,I3e=p4,Oz=20,Vx=3,_3e=5*zx,T3e=_0,$3e=5*_0,P3e=5*zx,D3e=30*_0,N3e=180*_0,lT=`${Am}-kad-dht`;var Gy;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key.byteLength>0&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={key:We(0),value:We(0),timeReceived:""},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.key=t.bytes();break}case 2:{s.value=t.bytes();break}case 5:{s.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(Gy||(Gy={}));function O3e(r){const e=r.getUTCFullYear(),t=String(r.getUTCMonth()+1).padStart(2,"0"),n=String(r.getUTCDate()).padStart(2,"0"),i=String(r.getUTCHours()).padStart(2,"0"),s=String(r.getUTCMinutes()).padStart(2,"0"),o=String(r.getUTCSeconds()).padStart(2,"0"),a=r.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${n}T${i}:${s}:${o}.${c}Z`}function R3e(r){const e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");const n=parseInt(t[1],10),i=parseInt(t[2],10)-1,s=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),l=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,i,s,o,a,c,l))}class yi{constructor(e,t,n){u(this,"key");u(this,"value");u(this,"timeReceived");if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return Gy.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:O3e(this.timeReceived)}}static deserialize(e){const t=Gy.decode(e);return new yi(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=R3e(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new yi(e.key,e.value,t)}}class Qy extends Error{constructor(e="Query error"){super(e),this.name="QueryError"}}class B3e extends Error{constructor(e="Query aborted"){super(e),this.name="QueryAbortedError"}}class L3e extends Error{constructor(e="Invalid record"){super(e),this.name="InvalidRecordError"}}class M3e extends Error{constructor(e="No selector function configured for prefix"){super(e),this.name="MissingSelectorError"}}var uT;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&(n.uint32(18),n.bytes(t.value)),t.author!=null&&(n.uint32(26),n.bytes(t.author)),t.signature!=null&&(n.uint32(34),n.bytes(t.signature)),t.timeReceived!=null&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.key=t.bytes();break}case 2:{s.value=t.bytes();break}case 3:{s.author=t.bytes();break}case 4:{s.signature=t.bytes();break}case 5:{s.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(uT||(uT={}));var gt;(function(r){r.PUT_VALUE="PUT_VALUE",r.GET_VALUE="GET_VALUE",r.ADD_PROVIDER="ADD_PROVIDER",r.GET_PROVIDERS="GET_PROVIDERS",r.FIND_NODE="FIND_NODE",r.PING="PING"})(gt||(gt={}));var Yy;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(Yy||(Yy={}));(function(r){r.codec=()=>En(Yy)})(gt||(gt={}));var Kd;(function(r){r.NOT_CONNECTED="NOT_CONNECTED",r.CONNECTED="CONNECTED",r.CAN_CONNECT="CAN_CONNECT",r.CANNOT_CONNECT="CANNOT_CONNECT"})(Kd||(Kd={}));var ub;(function(r){r[r.NOT_CONNECTED=0]="NOT_CONNECTED",r[r.CONNECTED=1]="CONNECTED",r[r.CAN_CONNECT=2]="CAN_CONNECT",r[r.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(ub||(ub={}));(function(r){r.codec=()=>En(ub)})(Kd||(Kd={}));var Mu;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.multiaddrs!=null)for(const s of t.multiaddrs)n.uint32(18),n.bytes(s);t.connection!=null&&(n.uint32(24),Kd.codec().encode(t.connection,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={id:We(0),multiaddrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.id=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.multiaddrs)!=null&&s.multiaddrs.length===i.limits.multiaddrs)throw new gr('Decode error - map field "multiaddrs" had too many elements');s.multiaddrs.push(t.bytes());break}case 3:{s.connection=Kd.codec().decode(t);break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(Mu||(Mu={}));var gl;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.type!=null&&Yy[t.type]!==0&&(n.uint32(8),gt.codec().encode(t.type,n)),t.clusterLevel!=null&&(n.uint32(80),n.int32(t.clusterLevel)),t.key!=null&&(n.uint32(18),n.bytes(t.key)),t.record!=null&&(n.uint32(26),n.bytes(t.record)),t.closer!=null)for(const s of t.closer)n.uint32(66),Mu.codec().encode(s,n);if(t.providers!=null)for(const s of t.providers)n.uint32(74),Mu.codec().encode(s,n);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,d;const s={type:gt.PUT_VALUE,closer:[],providers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const h=t.uint32();switch(h>>>3){case 1:{s.type=gt.codec().decode(t);break}case 10:{s.clusterLevel=t.int32();break}case 2:{s.key=t.bytes();break}case 3:{s.record=t.bytes();break}case 8:{if(((a=i.limits)==null?void 0:a.closer)!=null&&s.closer.length===i.limits.closer)throw new gr('Decode error - map field "closer" had too many elements');s.closer.push(Mu.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.closer$}));break}case 9:{if(((l=i.limits)==null?void 0:l.providers)!=null&&s.providers.length===i.limits.providers)throw new gr('Decode error - map field "providers" had too many elements');s.providers.push(Mu.codec().decode(t,t.uint32(),{limits:(d=i.limits)==null?void 0:d.providers$}));break}default:{t.skipType(h&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(gl||(gl={}));function dT(r,e={}){var n;const t={...r,name:"SEND_QUERY",type:0,messageName:r.type,messageType:r.type};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:send-query",{detail:t})),t}function db(r,e={}){var n;const t={...r,name:"PEER_RESPONSE",type:1,messageName:r.messageType,closer:r.closer??[],providers:r.providers??[]};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:peer-response",{detail:t})),t}function K8(r,e={}){var n;const t={...r,name:"FINAL_PEER",type:2};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:final-peer",{detail:t})),t}function cc(r,e={}){var n;const t={...r,name:"QUERY_ERROR",type:3};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:query-error",{detail:t})),t}function hT(r,e={}){var n;const t={...r,name:"PROVIDER",type:4};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:provider",{detail:t})),t}function hb(r,e={}){var n;const t={...r,name:"VALUE",type:5};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:value",{detail:t})),t}function fT(r,e={}){var n;const t={...r,name:"DIAL_PEER",type:7};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:dial-peer",{detail:t})),t}function U3e(r,e,t){if(t.length===0)throw new Z("No records given");const i=re(e).split("/");if(i.length<3)throw new Z("Record key does not have a selector function");const s=r[i[1].toString()];if(s==null)throw new M3e(`No selector function configured for key type "${i[1]}"`);return t.length===1?0:s(e,t)}function F3e(r,e){return 0}const z3e={pk:F3e};async function Kx(r,e){const t=e.key,i=re(t).split("/");if(i.length<3)return;const s=r[i[1].toString()];if(s==null)throw new Z(`No validator available for key type "${i[1]}"`);await s(t,e.value)}const V3e=async(r,e)=>{if(!(r instanceof Uint8Array))throw new Z('"key" must be a Uint8Array');if(r.byteLength<5)throw new Z("Invalid public key record");if(re(r.subarray(0,4))!=="/pk/")throw new Z("key was not prefixed with /pk/");const n=Ji(e),i=r.slice(4);if(!Fe(i,n.toMultihash().bytes))throw new Z("public key does not match passed in key")},K3e={pk:V3e};function j3e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function jx(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function H3e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var q3e=H3e,W3e=q3e;let G3e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Q3e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Rz(this,e)}},Y3e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return Rz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Rz(r,e){return new Y3e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let J3e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new G3e(e,t,n),this.decoder=new Q3e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Bz({name:r,prefix:e,encode:t,decode:n}){return new J3e(r,e,t,n)}function g4({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=W3e(t,r);return Bz({prefix:e,name:r,encode:n,decode:s=>jx(i(s))})}function X3e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Z3e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Mo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return Bz({prefix:e,name:r,encode(i){return Z3e(i,n,t)},decode(i){return X3e(i,n,t,r)}})}const U2=Mo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Mo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Mo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Mo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Mo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Mo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Mo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Mo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Mo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const j8=g4({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});g4({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const ma=g4({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});g4({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var eme=Lz,pT=128,tme=-128,rme=Math.pow(2,31);function Lz(r,e,t){e=e||[],t=t||0;for(var n=t;r>=rme;)e[t++]=r&255|pT,r/=128;for(;r&tme;)e[t++]=r&255|pT,r>>>=7;return e[t]=r|0,Lz.bytes=t-n+1,e}var nme=fb,ime=128,gT=127;function fb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw fb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&gT)<<i:(o&gT)*Math.pow(2,i),i+=7}while(o>=ime);return fb.bytes=s-n,t}var sme=Math.pow(2,7),ome=Math.pow(2,14),ame=Math.pow(2,21),cme=Math.pow(2,28),lme=Math.pow(2,35),ume=Math.pow(2,42),dme=Math.pow(2,49),hme=Math.pow(2,56),fme=Math.pow(2,63),pme=function(r){return r<sme?1:r<ome?2:r<ame?3:r<cme?4:r<lme?5:r<ume?6:r<dme?7:r<hme?8:r<fme?9:10},gme={encode:eme,decode:nme,encodingLength:pme},Jy=gme;function pb(r,e=0){return[Jy.decode(r,e),Jy.decode.bytes]}function Xy(r,e,t=0){return Jy.encode(r,e,t),e}function Zy(r){return Jy.encodingLength(r)}function gb(r,e){const t=e.byteLength,n=Zy(r),i=n+Zy(t),s=new Uint8Array(i+t);return Xy(r,s,0),Xy(t,s,n),s.set(e,i),new Hx(r,t,e,s)}function ru(r){const e=jx(r),[t,n]=pb(e),[i,s]=pb(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Hx(t,i,o,e)}function yme(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&j3e(r.bytes,t.bytes)}}let Hx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function yT(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return wme(t,yb(r),e??ma.encoder);default:return bme(t,yb(r),e??U2.encoder)}}const mT=new WeakMap;function yb(r){const e=mT.get(r);if(e==null){const t=new Map;return mT.set(r,t),t}return e}var ND;let qx=class Mr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,ND,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==df)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==vme)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Mr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=gb(e,t);return Mr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Mr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&yme(e.multihash,n.multihash)}toString(e){return yT(this,e)}toJSON(){return{"/":yT(this)}}link(){return this}[(ND=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Mr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Mr(n,i,s,o??wT(n,i,s.bytes))}else if(t[Eme]===!0){const{version:n,multihash:i,code:s}=t,o=ru(i);return Mr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==df)throw new Error(`Version 0 CID must use dag-pb (code: ${df}) block encoding`);return new Mr(e,t,n,n.bytes)}case 1:{const i=wT(e,t,n.bytes);return new Mr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Mr.create(0,df,e)}static createV1(e,t){return Mr.create(1,e,t)}static decode(e){const[t,n]=Mr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Mr.inspectBytes(e),n=t.size-t.multihashSize,i=jx(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new Hx(t.multihashCode,t.digestSize,s,i);return[t.version===0?Mr.createV0(o):Mr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=pb(e.subarray(t));return t+=p,h};let i=n(),s=df;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=mme(e,t),s=Mr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return yb(s).set(n,e),s}};function mme(r,e){switch(r[0]){case"Q":{const t=e??ma;return[ma.prefix,t.decode(`${ma.prefix}${r}`)]}case ma.prefix:{const t=e??ma;return[ma.prefix,t.decode(r)]}case U2.prefix:{const t=e??U2;return[U2.prefix,t.decode(r)]}case j8.prefix:{const t=e??j8;return[j8.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function wme(r,e,t){const{prefix:n}=t;if(n!==ma.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function bme(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const df=112,vme=18;function wT(r,e,t){const n=Zy(r),i=n+Zy(e),s=new Uint8Array(i+t.byteLength);return Xy(r,s,0),Xy(e,s,n),s.set(t,i),s}const Eme=Symbol.for("@ipld/js-cid/CID"),xme=85;function Sme({name:r,code:e,encode:t}){return new Ame(r,e,t)}let Ame=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?gb(this.code,t):t.then(n=>gb(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Cme(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const Mz=Sme({name:"sha2-256",code:18,encode:Cme("SHA-256")}),kme=se("/pk/");function Ime(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{const[[t,n]]=e.stringTuples();if(t===53||t===54||t===55)return n!=="localhost";if(t!==4&&t!==6||n==null)return!1;const i=vc(n);return i==null?!0:!i})}}async function B1(r){return(await Mz.digest(r)).digest}async function Xi(r){return B1(r.toMultihash().bytes)}function Kf(r,e){return new ht(`${r}/${re(e,"base32")}`,!1)}function _me(r){return pr([kme,r.toMultihash().bytes])}function Tme(r){return re(r.subarray(0,4))==="/pk/"}function $me(r){const e=ru(r.subarray(4));return Zi(e)}function bT(r,e){const t=new Date;return new yi(r,e,t).serialize()}const Pme=290,Dme=54,Nme=55,Ome=56,Rme=4,Bme=41;function Lme(r){const e=r.stringTuples();for(const t of e)if(t[0]===Pme)return!1;if(e[0][0]===Dme||e[0][0]===Nme||e[0][0]===Ome)return!0;if(e[0][0]===Rme||e[0][0]===Bme){const t=vc(`${e[0][1]}`);return t==null||!t}return!1}function Uz(r){const e=r.toString().split("/"),t=e.pop(),n=e.pop();if(t==null||n==null)throw new Error(`incorrectly formatted provider entry key in datastore: ${r.toString()}`);return{cid:qx.createV1(xme,ru(se(n,"base32"))),peerId:xn(t)}}function H8(r,e,t){const n=typeof e=="string"?e:re(e.multihash.bytes,"base32"),i=[r,n];return t!=null&&i.push(t.toString()),new ht(i.join("/"))}function Fz(r){return new Date(Ns(r))}function xu(r,e,t){return async function*(...n){var a,c,l,d,h;const i=(a=e.queryTime)==null?void 0:a.timer(t),s=(c=e.errorTime)==null?void 0:c.timer(t);let o=!1;try{(l=e.queries)==null||l.increment({[t]:!0}),yield*r(...n)}catch(p){throw o=!0,s==null||s(),(d=e.errors)==null||d.increment({[t]:!0}),p}finally{(h=e.queries)==null||h.decrement({[t]:!0}),o||i==null||i()}}}function zz(r,e,t){return async function(...n){var a,c,l,d,h;const i=(a=e==null?void 0:e.queryTime)==null?void 0:a.timer(t),s=(c=e==null?void 0:e.errorTime)==null?void 0:c.timer(t);let o=!1;try{return(l=e.queries)==null||l.increment({[t]:!0}),await r(...n)}catch(p){throw o=!0,s==null||s(),(d=e.errors)==null||d.increment({[t]:!0}),p}finally{(h=e.queries)==null||h.decrement({[t]:!0}),o||i==null||i()}}}class Mme{constructor(e,t){u(this,"log");u(this,"components");u(this,"validators");u(this,"selectors");u(this,"peerRouting");u(this,"queryManager");u(this,"network");u(this,"datastorePrefix");var l,d;const{validators:n,selectors:i,peerRouting:s,queryManager:o,network:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-fetching`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n,this.selectors=i,this.peerRouting=s,this.queryManager=o,this.network=a,this.get=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.get",this.get.bind(this),{optionsIndex:1}))??this.get,this.put=((d=e.metrics)==null?void 0:d.traceFunction("libp2p.kadDHT.put",this.put.bind(this),{optionsIndex:2}))??this.put}async getLocal(e){this.log("getLocal %b",e);const t=Kf(this.datastorePrefix,e);this.log("fetching record for key %k",t);const n=await this.components.datastore.get(t);this.log("found %k in local datastore",t);const i=yi.deserialize(n);return await Kx(this.validators,i),i}async*sendCorrectionRecord(e,t,n,i={}){this.log("sendCorrection for %b",e);const s=bT(e,n);for(const{value:o,from:a}of t){if(Fe(o,n)){this.log("record was ok");continue}if(this.components.peerId.equals(a)){try{const d=Kf(this.datastorePrefix,e);this.log(`Storing corrected record for key ${d.toString()}`),await this.components.datastore.put(d,s.subarray())}catch(d){this.log.error("Failed error correcting self",d)}continue}let c=!1;const l={type:gt.PUT_VALUE,key:e,record:s};for await(const d of this.network.sendRequest(a,l,i))d.name==="PEER_RESPONSE"&&d.record!=null&&Fe(d.record.value,yi.deserialize(s).value)&&(c=!0),yield d;c||(yield cc({from:a,error:new Qy("Value not put correctly")},i)),this.log.error("Failed error correcting entry")}}async*put(e,t,n={}){this.log("put key %b value %b",e,t);const i=bT(e,t),s=Kf(this.datastorePrefix,e);this.log(`storing record for key ${s.toString()}`),await this.components.datastore.put(s,i.subarray()),yield*Qi(this.peerRouting.getClosestPeers(e,{...n,signal:n.signal}),o=>fh(o,a=>async()=>{if(a.name!=="FINAL_PEER")return[a];const c=[],l={type:gt.PUT_VALUE,key:e,record:i};this.log("send put to %p",a.peer.id);for await(const d of this.network.sendRequest(a.peer.id,l,n))c.push(d),d.name==="PEER_RESPONSE"&&(d.record!=null&&Fe(d.record.value,yi.deserialize(i).value)||c.push(cc({from:a.peer.id,error:new Qy("Value not put correctly")},n)));return c}),o=>I0(o,{ordered:!1,concurrency:Vx}),async function*(o){for await(const a of o)yield*a})}async*get(e,t={}){this.log("get %b",e);const n=[];for await(const a of this.getMany(e,t))a.name==="VALUE"&&n.push(a),yield a;if(n.length===0)return;const i=n.map(a=>a.value);let s=0;try{s=U3e(this.selectors,e,i)}catch(a){if(a.name!=="InvalidParametersError")throw a}const o=i[s];if(this.log("GetValue %b %b",e,o),o==null)throw new jt("Best value was not found");yield*this.sendCorrectionRecord(e,n,o,t),yield n[s]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{const s=await this.getLocal(e);yield hb({value:s.value,from:this.components.peerId},t)}catch(s){this.log("error getting local value for %b",e,s)}const n=this,i=async function*({peer:s,signal:o}){for await(const a of n.peerRouting.getValueOrPeers(s,e,{...t,signal:o}))yield a,a.name==="PEER_RESPONSE"&&a.record!=null&&(yield hb({from:s,value:a.record.value},t))};yield*this.queryManager.run(e,i,t)}}function Ume(r,e){return{id:r.id.toMultihash().bytes,multiaddrs:(r.multiaddrs??[]).map(n=>n.bytes),connection:e}}function qp(r){if(r.id==null)throw new Error("Invalid peer in message");const e=ru(r.id);return{id:Zi(e),multiaddrs:(r.multiaddrs??[]).map(t=>Te(t))}}class Fme{constructor(e,t){u(this,"log");u(this,"components");u(this,"network");u(this,"peerRouting");u(this,"queryManager");u(this,"routingTable");u(this,"providers");var l,d;const{network:n,peerRouting:i,queryManager:s,routingTable:o,providers:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-routing`),this.network=n,this.peerRouting=i,this.queryManager=s,this.routingTable=o,this.providers=a,this.findProviders=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(h,p)=>(h.name==="PROVIDER"&&(p.providers??(p.providers=[]),p.providers.push(...h.providers.map(b=>b.id.toString()))),p)}))??this.findProviders,this.provide=((d=e.metrics)==null?void 0:d.traceFunction("libp2p.kadDHT.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(h,p)=>(h.name==="PEER_RESPONSE"&&h.messageName==="ADD_PROVIDER"&&(p.providers??(p.providers=[]),p.providers.push(h.from.toString())),p)}))??this.provide}async*provide(e,t,n={}){this.log("provide %s",e);const i=e.multihash.bytes;await this.providers.addProvider(e,this.components.peerId);const s={type:gt.ADD_PROVIDER,key:i,providers:[Ume({id:this.components.peerId,multiaddrs:t})]};let o=0;const a=c=>async()=>{if(c.name!=="FINAL_PEER")return[c];const l=[];this.log("putProvider %s to %p",e,c.peer.id);try{this.log("sending provider record for %s to %p",e,c.peer.id);for await(const d of this.network.sendMessage(c.peer.id,s,n))d.name==="PEER_RESPONSE"&&(this.log("sent provider record for %s to %p",e,c.peer.id),o++),l.push(d)}catch(d){this.log.error("error sending provide record to peer %p",c.peer.id,d),l.push(cc({from:c.peer.id,error:d},n))}return l};yield*Qi(this.peerRouting.getClosestPeers(i,n),c=>fh(c,l=>a(l)),c=>I0(c,{ordered:!1,concurrency:Vx}),async function*(c){for await(const l of c)yield*l}),this.log("sent provider records to %d peers",o)}async*findProviders(e,t){const n=this.routingTable.kBucketSize;let i=0;const s=e.multihash.bytes,o=this;this.log("findProviders %c",e);const a=await this.providers.getProviders(e);if(a.length>0){const d=[];for(const h of a.slice(0,n))try{const p=await this.components.peerStore.get(h);d.push({id:h,multiaddrs:p.addresses.map(({multiaddr:b})=>b)})}catch(p){if(p.name!=="NotFoundError")throw p;this.log("no peer store entry for %p",h)}if(yield db({from:this.components.peerId,messageType:gt.GET_PROVIDERS,providers:d},t),yield hT({from:this.components.peerId,providers:d},t),i+=d.length,i>=n)return}const c=async function*({peer:d,signal:h}){const p={type:gt.GET_PROVIDERS,key:s};yield*o.network.sendRequest(d,p,{...t,signal:h})},l=new Hi(a);for await(const d of this.queryManager.run(s,c,t))if(yield d,d.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",d.providers.length,e,d.closer.length);const h=[];for(const p of d.providers)l.has(p.id)||(l.add(p.id),h.push(p));if(h.length>0&&(yield hT({from:d.from,providers:h},t),i+=h.length,i>=n))return}}}class q8{constructor(e){u(this,"movingAverage");u(this,"variance");u(this,"deviation");u(this,"forecast");u(this,"timeSpan");u(this,"previousTime");this.timeSpan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timeSpan)}push(e,t=Date.now()){if(this.previousTime!=null){const n=this.alpha(t,this.previousTime),i=e-this.movingAverage,s=n*i;this.movingAverage=n*e+(1-n)*this.movingAverage,this.variance=(1-n)*(this.variance+i*s),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+n*i}else this.movingAverage=e;this.previousTime=t}}const zme=1.2,Vme=2,Kme=2e3;class L1{constructor(e={}){u(this,"success");u(this,"failure");u(this,"next");u(this,"metric");u(this,"timeoutMultiplier");u(this,"failureMultiplier");u(this,"minTimeout");var t;this.success=new q8(e.interval??5e3),this.failure=new q8(e.interval??5e3),this.next=new q8(e.interval??5e3),this.failureMultiplier=e.failureMultiplier??Vme,this.timeoutMultiplier=e.timeoutMultiplier??zme,this.minTimeout=e.minTimeout??Kme,e.metricName!=null&&(this.metric=(t=e.metrics)==null?void 0:t.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){const t=Math.max(Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier)),this.minTimeout),n=AbortSignal.timeout(t),i=ct([e.signal,n]);return i.start=Date.now(),i.timeout=t,i}cleanUp(e){var n,i;const t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),(n=this.metric)==null||n.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),(i=this.metric)==null||i.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}}class jme{constructor(){u(this,"readNext");u(this,"haveNext");u(this,"ended");u(this,"nextResult");this.ended=!1,this.readNext=De(),this.haveNext=De()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=De(),e}async throw(e){return this.ended=!0,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=De(),await Zr(this.readNext.promise,t==null?void 0:t.signal,t)}}function Hme(){return new jme}class qme extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}}class Wme extends Error{constructor(t,n){super(t);u(this,"code");this.code=n}}let Gme=class extends Wme{constructor(t){super(t,"ABORT_ERR");u(this,"type");this.type="aborted",this.name="AbortError"}};function Qme(r,e){const t=Hme();r.sink(t).catch(async o=>{await t.end(o)}),r.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());const i=new Be;return{read:async(o,a)=>{var d,h;(d=a==null?void 0:a.signal)==null||d.throwIfAborted();let c;const l=new Promise((p,b)=>{var f;c=()=>{b(new Gme("Read aborted"))},(f=a==null?void 0:a.signal)==null||f.addEventListener("abort",c)});try{if(o==null){const{done:b,value:f}=await Promise.race([n.next(),l]);return b===!0?new Be:f}for(;i.byteLength<o;){const{value:b,done:f}=await Promise.race([n.next(),l]);if(f===!0)throw new qme("unexpected end of input");i.append(b)}const p=i.sublist(0,o);return i.consume(o),p}finally{c!=null&&((h=a==null?void 0:a.signal)==null||h.removeEventListener("abort",c))}},write:async(o,a)=>{var c;(c=a==null?void 0:a.signal)==null||c.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(i.byteLength>0){const o=r.source;r.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield i:yield*i,yield*o}()}return r}}}class Yme extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}}class Jme extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}}class Xme extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}}function Zme(r,e={}){const t=Qme(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=mt(e.maxDataLength));const n=(e==null?void 0:e.lengthDecoder)??Ns,i=(e==null?void 0:e.lengthEncoder)??Hr;return{read:async o=>{let a=-1;const c=new Be;for(;;){c.append(await t.read(1,o));try{a=n(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new Yme("Invalid message length");if((e==null?void 0:e.maxLengthLength)!=null&&c.byteLength>e.maxLengthLength)throw new Xme("message length length too long");if(a>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&a>e.maxDataLength)throw new Jme("message length too long");return t.read(a,o)},write:async(o,a)=>{await t.write(new Be(i(o.byteLength),o),a)},writeV:async(o,a)=>{const c=new Be(...o.flatMap(l=>[i(l.byteLength),l]));await t.write(c,a)},unwrap:()=>t.unwrap()}}function vT(r,e){const t=Zme(r,e),n={read:async(i,s)=>{const o=await t.read(s);return i.decode(o)},write:async(i,s,o)=>{await t.write(s.encode(i),o)},writeV:async(i,s,o)=>{await t.writeV(i.map(a=>s.encode(a)),o)},pb:i=>({read:async s=>n.read(i,s),write:async(s,o)=>n.write(s,i,o),writeV:async(s,o)=>n.writeV(s,i,o),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}class e4e extends Gt{constructor(t,n){var i,s,o,a;super();u(this,"log");u(this,"protocol");u(this,"running");u(this,"components");u(this,"timeout");u(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${n.logPrefix}:network`),this.running=!1,this.protocol=n.protocol,this.timeout=new L1({...n.timeout??{},metrics:t.metrics,metricName:`${n.metricsPrefix}_network_message_send_times_milliseconds`}),this.metrics={operations:(i=t.metrics)==null?void 0:i.registerCounterGroup(`${n.metricsPrefix}_outbound_rpc_requests_total`),errors:(s=t.metrics)==null?void 0:s.registerCounterGroup(`${n.metricsPrefix}_outbound_rpc_errors_total`)},this.sendRequest=((o=t.metrics)==null?void 0:o.traceFunction("libp2p.kadDHT.sendRequest",this.sendRequest.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],d){return{...d,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((d,h)=>{l[`providers-${h}`]=d.id.toString()}),c.closer.length>0&&c.closer.forEach((d,h)=>{l[`closer-${h}`]=d.id.toString()})),l)}))??this.sendRequest,this.sendMessage=((a=t.metrics)==null?void 0:a.traceFunction("libp2p.kadDHT.sendMessage",this.sendMessage.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],d){return{...d,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((d,h)=>{l[`providers-${h}`]=d.id.toString()}),c.closer.length>0&&c.closer.forEach((d,h)=>{l[`closer-${h}`]=d.id.toString()})),l)}))??this.sendMessage}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(t,n,i={}){var c,l,d;if(!this.running)return;const s=n.type;if(s==null)throw new Z("Message type was missing");this.log("sending %s to %p",n.type,t),yield fT({peer:t},i),yield dT({to:t,type:s},i);let o;const a=this.timeout.getTimeoutSignal(i);i={...i,signal:a};try{(c=this.metrics.operations)==null||c.increment({[s]:!0}),o=await(await this.components.connectionManager.openConnection(t,i)).newStream(this.protocol,i);const p=await this._writeReadMessage(o,n,i);o.close(i).catch(b=>{this.log.error("error closing stream to %p",t,b),o==null||o.abort(b)}),yield db({from:t,messageType:p.type,closer:p.closer.map(qp),providers:p.providers.map(qp),record:p.record==null?void 0:yi.deserialize(p.record)},i)}catch(h){(l=this.metrics.errors)==null||l.increment({[s]:!0}),o==null||o.abort(h),((d=i.signal)==null?void 0:d.aborted)!==!0&&this.log.error("could not send %s to %p - %e",n.type,t,h),yield cc({from:t,error:h},i)}finally{this.timeout.cleanUp(a)}}async*sendMessage(t,n,i={}){var c,l;if(!this.running)return;const s=n.type;if(s==null)throw new Z("Message type was missing");this.log("sending %s to %p",n.type,t),yield fT({peer:t},i),yield dT({to:t,type:s},i);let o;const a=this.timeout.getTimeoutSignal(i);i={...i,signal:a};try{(c=this.metrics.operations)==null||c.increment({[s]:!0}),o=await(await this.components.connectionManager.openConnection(t,i)).newStream(this.protocol,i),await this._writeMessage(o,n,i),o.close(i).catch(h=>{this.log.error("error closing stream to %p",t,h),o==null||o.abort(h)}),yield db({from:t,messageType:s},i)}catch(d){(l=this.metrics.errors)==null||l.increment({[s]:!0}),o==null||o.abort(d),yield cc({from:t,error:d},i)}finally{this.timeout.cleanUp(a)}}async _writeMessage(t,n,i){await vT(t).write(n,gl,i)}async _writeReadMessage(t,n,i){const s=vT(t);await s.write(n,gl,i);const o=await s.read(gl,i);return o.closer.forEach(a=>{this.safeDispatchEvent("peer",{detail:qp(a)})}),o.providers.forEach(a=>{this.safeDispatchEvent("peer",{detail:qp(a)})}),o}}function M1(r,e){if(r.byteLength!==e.byteLength)throw new Error("Inputs should have the same length");for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}class Wx{constructor(e,t){u(this,"originDhtKey");u(this,"capacity");u(this,"peerDistances");this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peer)}async add(e){const t=await Xi(e.id);this.addWithKadId(e,t)}addWithKadId(e,t){if(this.peerDistances.find(s=>s.peer.id.equals(e.id))!=null)return;const n={peer:e,distance:oc(this.originDhtKey,t)};let i=!1;for(let s=0;s<this.peerDistances.length;s++){const o=M1(this.peerDistances[s].distance,n.distance);if(o===0||o===1){i=!0,this.peerDistances.splice(s,0,n);break}}i||this.peerDistances.push(n),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async isCloser(e){if(this.length===0)return!0;const t=await Xi(e),n=oc(t,this.originDhtKey),i=this.peerDistances[this.peerDistances.length-1].distance;return M1(n,i)===-1}async anyCloser(e){return e.length===0?!1:Promise.any(e.map(async t=>this.isCloser(t)))}}class t4e{constructor(e,t){u(this,"log");u(this,"routingTable");u(this,"network");u(this,"validators");u(this,"queryManager");u(this,"peerStore");u(this,"peerId");var n,i;this.routingTable=t.routingTable,this.network=t.network,this.validators=t.validators,this.queryManager=t.queryManager,this.peerStore=e.peerStore,this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:peer-routing`),this.findPeer=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.kadDHT.findPeer",this.findPeer.bind(this),{optionsIndex:1}))??this.findPeer,this.getClosestPeers=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.kadDHT.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1}))??this.getClosestPeers}async findPeerLocal(e){let t;const n=await this.routingTable.find(e);if(n!=null){this.log("findPeerLocal found %p in routing table",e);try{t=await this.peerStore.get(n)}catch(i){if(i.name!=="NotFoundError")throw i}}if(t==null)try{t=await this.peerStore.get(e)}catch(i){if(i.name!=="NotFoundError")throw i}if(t!=null)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(i=>i.multiaddr)}}async*_getValueSingle(e,t,n={}){const i={type:gt.GET_VALUE,key:t};yield*this.network.sendRequest(e,i,n)}async*getPublicKeyFromNode(e,t={}){const n=_me(e);for await(const i of this._getValueSingle(e,n,t))if(yield i,i.name==="PEER_RESPONSE"&&i.record!=null){const s=Ji(i.record.value),o=$d(s);if(!o.equals(e))throw new b1("public key does not match id");if(o.publicKey==null)throw new b1("public key missing");yield hb({from:e,value:i.record.value},t)}throw new Qy(`Node not responding with its public key: ${e.toString()}`)}async*findPeer(e,t={}){if(this.log("findPeer %p",e),t.useCache!==!1){const i=await this.findPeerLocal(e);if(i!=null){this.log("found local"),yield K8({from:this.peerId,peer:i},t);return}}let n=!1;if(t.useNetwork!==!1){const i=this,s=async function*({peer:o,signal:a}){const c={type:gt.FIND_NODE,key:e.toMultihash().bytes};for await(const l of i.network.sendRequest(o,c,{...t,signal:a}))if(yield l,l.name==="PEER_RESPONSE"){const d=l.closer.find(h=>h.id.equals(e));d!=null&&(yield K8({from:l.from,peer:d},t))}};for await(const o of this.queryManager.run(e.toMultihash().bytes,s,t))o.name==="FINAL_PEER"&&(n=!0),yield o}n||(yield cc({from:this.peerId,error:new jt("Not found")},t))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);const n=await B1(e),i=this.routingTable.closestPeers(n),s=this,o=new Wx(n,this.routingTable.kBucketSize);await Promise.all(i.map(async c=>{await o.add({id:c,multiaddrs:[]})}));const a=async function*({peer:c,signal:l}){s.log("closerPeersSingle %s from %p",re(e,"base32"),c);const d={type:gt.FIND_NODE,key:e};yield*s.network.sendRequest(c,d,{...t,signal:l})};for await(const c of this.queryManager.run(e,a,t))c.name==="PEER_RESPONSE"&&await Promise.all(c.closer.map(async l=>{await o.add(l)})),yield c;this.log("found %d peers close to %b",o.length,e);for(const c of o.peers)yield K8({from:this.peerId,peer:c},t)}async*getValueOrPeers(e,t,n={}){for await(const i of this._getValueSingle(e,t,n)){if(i.name==="PEER_RESPONSE"&&i.record!=null)try{await this._verifyRecordOnline(i.record)}catch{const o="invalid record received, discarded";this.log(o),yield cc({from:i.from,error:new Qy(o)},n);continue}yield i}}async _verifyRecordOnline(e){if(e.timeReceived==null)throw new L3e("invalid record received");await Kx(this.validators,new yi(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){const n=[];try{const c=ru(e),l=Zi(c),d=await this.peerStore.get(l);n.push({id:d.id,multiaddrs:d.addresses.map(({multiaddr:h})=>h)})}catch{}const i=await B1(e),s=this.routingTable.closestPeers(i),o=await Xi(t),a=oc(o,i);for(const c of s){const l=await Xi(c),d=oc(l,i);if(M1(d,a)===-1)try{const h=await this.peerStore.get(c);n.push({id:c,multiaddrs:h.addresses.map(({multiaddr:p})=>p)})}catch(h){if(h.name!=="NotFoundError")throw h}}return n.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",n.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p with %d peers in the routing table",e,t,this.routingTable.size),n}}class r4e{constructor(e,t){u(this,"log");u(this,"datastore");u(this,"datastorePrefix");u(this,"lock");this.log=e.logger.forComponent(`${t.logPrefix}:providers`),this.datastorePrefix=`${t.datastorePrefix}/provider`,this.datastore=e.datastore,this.lock=t.lock}async addProvider(e,t){const n=await this.lock.readLock();try{this.log("%p provides %s",t,e),await this.writeProviderEntry(e,t)}finally{n()}}async removeProvider(e,t){const n=await this.lock.writeLock();try{const i=H8(this.datastorePrefix,e,t);this.log("%p no longer provides %s",t,e),await this.datastore.delete(i)}finally{n()}}async getProviders(e){const t=await this.lock.readLock();try{this.log("get providers for %c",e);const n=await this.loadProviders(e);return this.log("got %d providers for %c",n.size,e),[...n.keys()]}finally{t()}}async writeProviderEntry(e,t,n=new Date){const i=H8(this.datastorePrefix,e,t),s=Hr(n.getTime());await this.datastore.put(i,s)}async loadProviders(e){const t=new bc,n=H8(this.datastorePrefix,e);for await(const i of this.datastore.query({prefix:n.toString()})){const{peerId:s}=Uz(i.key);t.set(s,Fz(i.value))}return t}}async function*n4e(r){const{key:e,startingPeer:t,ourPeerId:n,signal:i,query:s,alpha:o,pathIndex:a,numPaths:c,queryFuncTimeout:l,log:d,peersSeen:h,connectionManager:p}=r,b=new _l({concurrency:o,sort:(v,y)=>M1(v.options.distance,y.options.distance)}),f=await B1(e);function g(v,y){if(v==null)return;h.add(v);const w=oc(y,f);b.add(async()=>{const m=[i];l!=null&&m.push(AbortSignal.timeout(l));const E=ct(m);try{for await(const C of s({...r,key:e,peer:v,signal:E,pathIndex:a,numPaths:c})){if(E.aborted)return;if(C.name==="PEER_RESPONSE")for(const k of C.closer){if(h.has(k.id)){d.trace("already seen %p in query",k.id);continue}if(n.equals(k.id)){d("not querying ourselves");continue}if(!await p.isDialable(k.multiaddrs)){d("not querying undialable peer");continue}const A=await Xi(k.id),I=oc(A,f);if(M1(I,w)!==-1){d.trace("skipping %p as they are not closer to %b than %p",k.id,e,v);continue}d.trace("querying closer peer %p",k.id),g(k.id,A)}b.safeDispatchEvent("completed",{detail:C})}}catch(C){if(!i.aborted)return cc({from:v,error:C},r)}finally{E.clear()}},{distance:w}).catch(m=>{d.error(m)})}g(t,await Xi(t));try{for await(const v of b.toGenerator({signal:i}))v!=null&&(yield v)}catch(v){throw i.aborted?new B3e("Query aborted"):v}}class i4e{constructor(e,t){u(this,"disjointPaths");u(this,"alpha");u(this,"shutDownController");u(this,"running");u(this,"logger");u(this,"peerId");u(this,"connectionManager");u(this,"routingTable");u(this,"initialQuerySelfHasRun");u(this,"logPrefix");this.logPrefix=t.logPrefix,this.disjointPaths=t.disjointPaths??Oz,this.alpha=t.alpha??Vx,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.shutDownController=new AbortController,this.shutDownController.signal,this.running=!1}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutDownController=new AbortController,this.shutDownController.signal,void 0)}async stop(){this.running=!1,this.shutDownController.abort()}async*run(e,t,n={}){if(!this.running)throw new Error("QueryManager not started");if(n.signal==null){const c=AbortSignal.timeout(N3e);n={...n,signal:c}}const i=new AbortController,s=ct([this.shutDownController.signal,i.signal,n.signal]);i.signal;const o=this.logger.forComponent(`${this.logPrefix}:query:`+re(e,"base58btc"));let a=!1;try{n.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(o("waiting for initial query-self query before continuing"),await Zr(this.initialQuerySelfHasRun.promise,s),this.initialQuerySelfHasRun=void 0),o("query:start");const c=await B1(e),l=this.routingTable.closestPeers(c),d=l.slice(0,Math.min(this.disjointPaths,l.length));if(l.length===0){o.error("Running query with no peers");return}const h=new Hi,p=d.map((b,f)=>n4e({...n,key:e,startingPeer:b,ourPeerId:this.peerId,signal:s,query:t,pathIndex:f,numPaths:d.length,alpha:this.alpha,queryFuncTimeout:n.queryFuncTimeout,log:o,peersSeen:h,onProgress:n.onProgress,connectionManager:this.connectionManager}));for await(const b of Ka(...p)){if(b.name==="QUERY_ERROR"&&o.error("query error",b.error),b.name==="PEER_RESPONSE")for(const f of[...b.closer,...b.providers])await this.connectionManager.isDialable(f.multiaddrs)&&await this.routingTable.add(f.id);yield b}a=!0}catch(c){if(!(!this.running&&c.name==="QueryAbortedError"))throw c}finally{a||(o("query exited early"),i.abort()),s.clear(),o("query:done")}}}function s4e(r){return r[Symbol.asyncIterator]!=null}function Vz(r){if(s4e(r))return(async()=>{let e=0;for await(const t of r)e++;return e})();{let e=0;for(const t of r)e++;return e}}const o4e=r=>{const e=r.addEventListener||r.on||r.addListener,t=r.removeEventListener||r.off||r.removeListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function a4e(r,e,t){let n;const i=new Promise((s,o)=>{var b;if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");(b=t.signal)==null||b.throwIfAborted();const a=[e].flat(),c=[],{addListener:l,removeListener:d}=o4e(r),h=(...f)=>{const g=t.multiArgs?f:f[0];t.filter&&!t.filter(g)||(c.push(g),t.count===c.length&&(n(),s(c)))},p=f=>{n(),o(f)};n=()=>{for(const f of a)d(f,h);for(const f of t.rejectionEvents)d(f,p)};for(const f of a)l(f,h);for(const f of t.rejectionEvents)l(f,p);t.signal&&t.signal.addEventListener("abort",()=>{p(t.signal.reason)},{once:!0}),t.resolveImmediately&&s(c)});if(i.cancel=n,typeof t.timeout=="number"){const s=l0(i,{milliseconds:t.timeout});return s.cancel=n,s}return i}function c4e(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};const n=a4e(r,e,t),i=n.then(s=>s[0]);return i.cancel=n.cancel,i}class l4e{constructor(e,t){u(this,"log");u(this,"peerId");u(this,"peerRouting");u(this,"routingTable");u(this,"count");u(this,"interval");u(this,"initialInterval");u(this,"queryTimeout");u(this,"running");u(this,"timeoutId");u(this,"controller");u(this,"initialQuerySelfHasRun");u(this,"querySelfPromise");this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:query-self`),this.running=!1,this.peerRouting=t.peerRouting,this.routingTable=t.routingTable,this.count=t.count??Oz,this.interval=t.interval??_3e,this.initialInterval=t.initialInterval??T3e,this.queryTimeout=t.queryTimeout??$3e,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.querySelf=zz(this.querySelf.bind(this),t.operationMetrics,"SELF_QUERY")}isStarted(){return this.running}start(){this.running||(this.running=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.initialInterval))}stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}async querySelf(){if(!this.running){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=De(),this.running){this.controller=new AbortController;const e=[this.controller.signal];if(this.initialQuerySelfHasRun==null){const n=AbortSignal.timeout(this.queryTimeout);e.push(n)}const t=ct(e);this.controller.signal;try{this.routingTable.size===0&&(this.log("routing table was empty, waiting for some peers before running query"),await c4e(this.routingTable,"peer:add",{signal:t,filter:s=>!this.peerId.equals(s.detail)}),this.log("routing table has peers, continuing with query")),this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);const n=Date.now(),i=await Qi(this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes,{signal:t,isSelfQuery:!0}),s=>Hg(s,this.count),async s=>Vz(s));this.log("self-query found %d peers in %dms",i,Date.now()-n)}catch(n){this.log.error("self-query error",n)}finally{t.clear(),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.running&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.interval))}}class u4e extends Gt{constructor(t,n){super();u(this,"log");u(this,"reprovideQueue");u(this,"maxQueueSize");u(this,"datastore");u(this,"timeout");u(this,"reprovideTimeout");u(this,"running");u(this,"shutdownController");u(this,"reprovideThreshold");u(this,"contentRouting");u(this,"datastorePrefix");u(this,"addressManager");u(this,"validity");u(this,"interval");u(this,"lock");u(this,"peerId");this.log=t.logger.forComponent(`${n.logPrefix}:reprovider`),this.peerId=t.peerId,this.reprovideQueue=new _l({concurrency:n.concurrency??C3e,metrics:t.metrics,metricName:`${n.metricsPrefix}_reprovide_queue`}),this.reprovideTimeout=new L1({...n.timeout??{},metrics:t.metrics,metricName:`${n.metricsPrefix}_reprovide_timeout_milliseconds`}),this.datastore=t.datastore,this.addressManager=t.addressManager,this.datastorePrefix=`${n.datastorePrefix}/provider`,this.reprovideThreshold=n.threshold??A3e,this.maxQueueSize=n.maxQueueSize??k3e,this.validity=n.validity??S3e,this.interval=n.interval??I3e,this.contentRouting=n.contentRouting,this.lock=n.lock,this.running=!1,this.reprovide=zz(this.reprovide.bind(this),n.operationMetrics,"PROVIDE")}start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,this.timeout=setTimeout(()=>{this.cleanUp().catch(t=>{this.log.error("error running reprovide/cleanup - %e",t)})},this.interval))}stop(){var t;this.running=!1,this.reprovideQueue.clear(),clearTimeout(this.timeout),(t=this.shutdownController)==null||t.abort()}async cleanUp(){const t=await this.lock.writeLock();try{this.safeDispatchEvent("reprovide:start");for await(const n of this.datastore.query({prefix:this.datastorePrefix}))try{const{cid:i,peerId:s}=Uz(n.key),o=Fz(n.value).getTime(),a=o+this.validity,c=Date.now(),l=c>a;this.log.trace("comparing: %d < %d = %s %s",o,c-this.validity,l,l?"(expired)":""),l&&await this.datastore.delete(n.key),this.peerId.equals(s)&&c-a<this.reprovideThreshold&&this.queueReprovide(i).catch(d=>{this.log.error("could not reprovide %c - %e",i,d)})}catch(i){this.log.error("error processing datastore key %s - %e",n.key,i.message)}this.log("reprovide/cleanup successful")}finally{t(),this.safeDispatchEvent("reprovide:end"),this.running&&(this.timeout=setTimeout(()=>{this.cleanUp().catch(n=>{this.log.error("error running re-provide - %e",n)})},this.interval))}}async queueReprovide(t){var i;if(!this.running)return;this.log.trace("waiting for queue capacity before adding %c to re-provide queue",t),await this.reprovideQueue.onSizeLessThan(this.maxQueueSize);const n=this.reprovideQueue.queue.find(s=>s.options.cid.equals(t));if(n!=null)return this.log.trace("not adding %c to re-provide queue - already in queue",t),n.join();this.log.trace("adding %c to re-provide queue",t),this.reprovideQueue.add(async s=>{var a;if((a=s.signal)==null||a.throwIfAborted(),!this.running)return;this.log.trace("re-providing %c",t);const o=this.reprovideTimeout.getTimeoutSignal(s);try{await this.reprovide(s.cid,s)}finally{this.reprovideTimeout.cleanUp(o)}this.log.trace("re-provided %c",t)},{signal:(i=this.shutdownController)==null?void 0:i.signal,cid:t}).catch(s=>{this.log.error("could not re-provide key %c - %e",t,s)})}async reprovide(t,n){await vo(this.contentRouting.provide(t,this.addressManager.getAddresses(),n))}}const d4e=20,h4e=5e3,f4e="kad-close",p4e=50;class g4e{constructor(e,t){u(this,"routingTable");u(this,"components");u(this,"closestPeers");u(this,"newPeers");u(this,"refreshInterval");u(this,"peerSetSize");u(this,"timeout");u(this,"closeTagName");u(this,"closeTagValue");u(this,"log");u(this,"running");this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.routingTable=t.routingTable,this.refreshInterval=t.refreshInterval??h4e,this.peerSetSize=t.peerSetSize??d4e,this.closeTagName=t.closeTagName??f4e,this.closeTagValue=t.closeTagValue??p4e,this.closestPeers=new Hi,this.onPeerPing=this.onPeerPing.bind(this),this.running=!1}async start(){if(this.running)return;this.running=!0;const e=await Xi(this.components.peerId);this.newPeers=new Wx(e,this.peerSetSize),this.routingTable.addEventListener("peer:ping",this.onPeerPing),this.timeout=setInterval(()=>{this.updatePeerTags().catch(t=>{this.log.error("error updating peer tags - %e",t)})},this.refreshInterval)}stop(){this.running=!1,this.routingTable.removeEventListener("peer:ping",this.onPeerPing),clearTimeout(this.timeout)}onPeerPing(e){var t;(t=this.newPeers)==null||t.add({id:e.detail,multiaddrs:[]}).catch(n=>{this.log.error("error adding peer to distance list - %e",n)})}async updatePeerTags(){var i;const e=new Hi((i=this.newPeers)==null?void 0:i.peers.map(s=>s.id)),t=e.difference(this.closestPeers),n=this.closestPeers.difference(e);this.closestPeers=e,await Promise.all([...[...t].map(async s=>{await this.components.peerStore.merge(s,{tags:{[this.closeTagName]:{value:this.closeTagValue},[lT]:{value:1}}})}),...[...n].map(async s=>{await this.components.peerStore.merge(s,{tags:{[this.closeTagName]:void 0,[lT]:void 0}})})])}}function F2(r){return Array.isArray(r==null?void 0:r.peers)}class y4e{constructor(e){u(this,"root");u(this,"localPeer");u(this,"prefixLength");u(this,"splitThreshold");u(this,"kBucketSize");u(this,"numberOfNodesToPing");u(this,"lastPingThreshold");u(this,"ping");u(this,"verify");u(this,"onAdd");u(this,"onRemove");u(this,"onMove");u(this,"addingPeerMap");this.prefixLength=e.prefixLength??b4e,this.kBucketSize=e.kBucketSize??Kz,this.splitThreshold=e.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=e.numberOfOldContactsToPing??x4e,this.lastPingThreshold=e.lastPingThreshold??k4e,this.ping=e.ping,this.verify=e.verify,this.onAdd=e.onAdd,this.onRemove=e.onRemove,this.addingPeerMap=new bc,this.root={prefix:"",depth:0,peers:[]}}async addSelfPeer(e){this.localPeer={peerId:e,kadId:await Xi(e),lastPing:Date.now()}}async add(e,t){const n={peerId:e,kadId:await Xi(e),lastPing:0},i=this.addingPeerMap.get(e);if(i!=null)return i;try{const s=this._add(n,t);this.addingPeerMap.set(e,s),await s}finally{this.addingPeerMap.delete(e)}}async _add(e,t){var o;const n=this._determineBucket(e.kadId);if(this._indexOf(n,e.kadId)>-1)return;if(n.peers.length===this.splitThreshold&&n.depth<this.prefixLength){await this._split(n),await this._add(e,t);return}if(n.peers.length<this.kBucketSize){if(!w4e(e,this.lastPingThreshold)){n.peers.push(e),await((o=this.onAdd)==null?void 0:o.call(this,e,n));return}await this.verify(e,t)&&(e.lastPing=Date.now(),await this._add(e,t));return}const i=n.peers.filter(a=>{var c;return!(a.peerId.equals((c=this.localPeer)==null?void 0:c.peerId)||a.lastPing>Date.now()-this.lastPingThreshold)}).sort((a,c)=>a.lastPing<c.lastPing?-1:a.lastPing>c.lastPing?1:0).slice(0,this.numberOfNodesToPing);let s=!1;for await(const a of this.ping(i,t))s=!0,await this.remove(a.kadId);s&&await this._add(e,t)}*closest(e,t=this.kBucketSize){const n=new Wx(e,t);for(const i of this.toIterable())n.addWithKadId({id:i.peerId,multiaddrs:[]},i.kadId);yield*fh(n.peers,i=>i.id)}count(){function e(t){if(F2(t))return t.peers.length;let n=0;return t.left!=null&&(n+=e(t.left)),t.right!=null&&(n+=e(t.right)),n}return e(this.root)}get(e){const t=this._determineBucket(e),n=this._indexOf(t,e);return t.peers[n]}async remove(e){var i;const t=this._determineBucket(e),n=this._indexOf(t,e);if(n>-1){const s=t.peers.splice(n,1)[0];await((i=this.onRemove)==null?void 0:i.call(this,s,t))}}*toIterable(){function*e(t){if(F2(t)){yield*t.peers;return}yield*e(t.left),yield*e(t.right)}yield*e(this.root)}distance(e,t){return BigInt("0x"+re(oc(e,t),"base16"))}_determineBucket(e){const t=re(e,"base2");function n(i,s=0){return F2(i)?i:t[s]==="0"?n(i.left,s+1):n(i.right,s+1)}return n(this.root)}_indexOf(e,t){return e.peers.findIndex(n=>Fe(n.kadId,t))}async _split(e){var i,s;const t={prefix:"0",depth:e.depth+1,peers:[]},n={prefix:"1",depth:e.depth+1,peers:[]};for(const o of e.peers)re(o.kadId,"base2")[e.depth]==="0"?(t.peers.push(o),await((i=this.onMove)==null?void 0:i.call(this,o,e,t))):(n.peers.push(o),await((s=this.onMove)==null?void 0:s.call(this,o,e,n)));m4e(e,t,n)}}function m4e(r,e,t){return delete r.peers,r.left=e,r.right=t,r.prefix===""&&(delete r.depth,delete r.prefix),!0}function w4e(r,e){return r.lastPing<Date.now()-e}const Kz=20,b4e=6,v4e=20,E4e=100,x4e=3,S4e=20,A4e=100,ET="kad-peer",C4e=1,k4e=6e5,I4e=!0,_4e=1e3;class T4e extends Gt{constructor(t,n){super();u(this,"kBucketSize");u(this,"kb");u(this,"network");u(this,"closestPeerTagger");u(this,"log");u(this,"components");u(this,"running");u(this,"pingNewContactTimeout");u(this,"pingNewContactQueue");u(this,"pingOldContactTimeout");u(this,"pingOldContactQueue");u(this,"populateFromDatastoreOnStart");u(this,"populateFromDatastoreLimit");u(this,"protocol");u(this,"peerTagName");u(this,"peerTagValue");u(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${n.logPrefix}:routing-table`),this.kBucketSize=n.kBucketSize??Kz,this.running=!1,this.protocol=n.protocol,this.network=n.network,this.peerTagName=n.peerTagName??ET,this.peerTagValue=n.peerTagValue??C4e,this.pingOldContacts=this.pingOldContacts.bind(this),this.verifyNewContact=this.verifyNewContact.bind(this),this.peerAdded=this.peerAdded.bind(this),this.peerRemoved=this.peerRemoved.bind(this),this.populateFromDatastoreOnStart=n.populateFromDatastoreOnStart??I4e,this.populateFromDatastoreLimit=n.populateFromDatastoreLimit??_4e,this.pingOldContactQueue=new nc({concurrency:n.pingOldContactConcurrency??S4e,metricName:`${n.metricsPrefix}_ping_old_contact_queue`,metrics:this.components.metrics,maxSize:n.pingOldContactMaxQueueSize??A4e}),this.pingOldContactTimeout=new L1({...n.pingOldContactTimeout??{},metrics:this.components.metrics,metricName:`${n.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`}),this.pingNewContactQueue=new nc({concurrency:n.pingNewContactConcurrency??v4e,metricName:`${n.metricsPrefix}_ping_new_contact_queue`,metrics:this.components.metrics,maxSize:n.pingNewContactMaxQueueSize??E4e}),this.pingNewContactTimeout=new L1({...n.pingNewContactTimeout??{},metrics:this.components.metrics,metricName:`${n.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`}),this.kb=new y4e({kBucketSize:n.kBucketSize,prefixLength:n.prefixLength,splitThreshold:n.splitThreshold,numberOfOldContactsToPing:n.numberOfOldContactsToPing,lastPingThreshold:n.lastPingThreshold,ping:this.pingOldContacts,verify:this.verifyNewContact,onAdd:this.peerAdded,onRemove:this.peerRemoved}),this.closestPeerTagger=new g4e(this.components,{logPrefix:n.logPrefix,routingTable:this,peerSetSize:n.closestPeerSetSize,refreshInterval:n.closestPeerSetRefreshInterval,closeTagName:n.closeTagName,closeTagValue:n.closeTagValue}),this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMinOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),routingTableKadBucketMaxOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_max_depth`),kadBucketEvents:this.components.metrics.registerCounterGroup(`${n.metricsPrefix}_kad_bucket_events_total`)})}isStarted(){return this.running}async start(){this.running||(this.running=!0,await Eo(this.closestPeerTagger),await this.kb.addSelfPeer(this.components.peerId))}async afterStart(){Promise.resolve().then(async()=>{if(!this.populateFromDatastoreOnStart)return;let t=0;for(const n of await this.components.peerStore.all({filters:[i=>i.protocols.includes(this.protocol)&&i.tags.has(ET)],limit:this.populateFromDatastoreLimit})){if(!this.running)return;try{await this.add(n.id),t++}catch{this.log("failed to add peer %p to routing table, removing kad-dht peer tags - %e"),await this.components.peerStore.merge(n.id,{tags:{[this.peerTagName]:void 0}})}}this.log("added %d peer store peers to the routing table",t)}).catch(t=>{this.log.error("error adding peer store peers to the routing table %e",t)})}async stop(){this.running=!1,await mc(this.closestPeerTagger),this.pingOldContactQueue.abort(),this.pingNewContactQueue.abort()}async peerAdded(t,n){var i;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:{value:this.peerTagValue}}}),this.updateMetrics(),(i=this.metrics)==null||i.kadBucketEvents.increment({peer_added:!0}),this.safeDispatchEvent("peer:add",{detail:t.peerId})}async peerRemoved(t,n){var i;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:void 0}}),this.updateMetrics(),(i=this.metrics)==null||i.kadBucketEvents.increment({peer_removed:!0}),this.safeDispatchEvent("peer:remove",{detail:t.peerId})}async*pingOldContacts(t,n){var s;if(!this.running)return;const i=[];for(const o of t){if(this.kb.get(o.kadId)==null){this.log("asked to ping contact %p that was not in routing table",o.peerId);continue}(s=this.metrics)==null||s.kadBucketEvents.increment({ping_old_contact:!0}),i.push(async()=>{const a=this.pingOldContactQueue.find(o.peerId);if(a!=null)return this.log("asked to ping contact %p was already being pinged",o.peerId),await a.join(n)?void 0:o;if(!await this.pingOldContactQueue.add(async l=>{var p;const d=this.pingOldContactTimeout.getTimeoutSignal(),h=ct([d,l==null?void 0:l.signal]);try{return await this.pingContact(o,l)}catch{return(p=this.metrics)==null||p.kadBucketEvents.increment({ping_old_contact_error:!0}),!0}finally{this.pingOldContactTimeout.cleanUp(d),h.clear()}},{peerId:o.peerId,signal:n==null?void 0:n.signal}))return o})}for await(const o of I0(i))o!=null&&(yield o)}async verifyNewContact(t,n){var o;const i=this.pingNewContactTimeout.getTimeoutSignal(),s=ct([i,n==null?void 0:n.signal]);try{const a=this.pingNewContactQueue.find(t.peerId);return a!=null?(this.log("joining existing ping to add new peer %p to routing table",t.peerId),await a.join({signal:s})):await this.pingNewContactQueue.add(async c=>{var l;return(l=this.metrics)==null||l.kadBucketEvents.increment({ping_new_contact:!0}),this.log("pinging new peer %p before adding to routing table",t.peerId),this.pingContact(t,c)},{peerId:t.peerId,signal:s})}catch{return this.log.trace("tried to add peer %p but they were not online",t.peerId),(o=this.metrics)==null||o.kadBucketEvents.increment({ping_new_contact_error:!0}),!1}finally{this.pingNewContactTimeout.cleanUp(i),s.clear()}}async pingContact(t,n){try{this.log("pinging contact %p",t.peerId);for await(const i of this.network.sendRequest(t.peerId,{type:gt.PING},n))if(i.type===mb.PEER_RESPONSE)return i.messageType===gt.PING?(this.log("contact %p ping ok",t.peerId),this.safeDispatchEvent("peer:ping",{detail:t.peerId}),!0):!1;return!1}catch(i){return this.log("error pinging old contact %p - %e",t.peerId,i),!1}}get size(){return this.kb==null?0:this.kb.count()}async find(t){var i;const n=await Xi(t);return(i=this.kb.get(n))==null?void 0:i.peerId}closestPeer(t){const n=this.closestPeers(t,1);if(n.length>0)return n[0]}closestPeers(t,n=this.kBucketSize){return this.kb==null?[]:[...this.kb.closest(t,n)]}async add(t,n){if(this.kb==null)throw new Error("RoutingTable is not started");await this.kb.add(t,n)}async remove(t){if(this.kb==null)throw new Error("RoutingTable is not started");const n=await Xi(t);await this.kb.remove(n)}updateMetrics(){if(this.metrics==null||this.kb==null)return;let t=0,n=0,i=0,s=20,o=0;function a(c){if(F2(c)){c.depth>i&&(i=c.depth),n++,t+=c.peers.length,c.peers.length<s&&(s=c.peers.length),c.peers.length>o&&(o=c.peers.length);return}a(c.left),a(c.right)}a(this.kb.root),this.metrics.routingTableSize.update(t),this.metrics.routingTableKadBucketTotal.update(n),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(t/n)),this.metrics.routingTableKadBucketMinOccupancy.update(s),this.metrics.routingTableKadBucketMaxOccupancy.update(o),this.metrics.routingTableKadBucketMaxDepth.update(i)}}const $4e=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],Wp=15;class P4e{constructor(e,t){u(this,"log");u(this,"peerRouting");u(this,"routingTable");u(this,"refreshInterval");u(this,"refreshQueryTimeout");u(this,"commonPrefixLengthRefreshedAt");u(this,"refreshTimeoutId");const{peerRouting:n,routingTable:i,refreshInterval:s,refreshQueryTimeout:o,logPrefix:a}=t;this.log=e.logger.forComponent(`${a}:routing-table:refresh`),this.peerRouting=n,this.routingTable=i,this.refreshInterval=s??P3e,this.refreshQueryTimeout=o??D3e,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async afterStart(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");const t=this._maxCommonPrefix(),n=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${n.map(i=>i.toISOString()).join(", ")} ]`),Promise.all(n.map(async(i,s)=>{try{if(await this._refreshCommonPrefixLength(s,i,e),this._numPeersForCpl(t)===0){const o=Math.min(2*(s+1),n.length-1);for(let a=s+1;a<o+1;a++)try{await this._refreshCommonPrefixLength(a,i,e)}catch(c){this.log.error(c)}}}catch(o){this.log.error(o)}})).catch(i=>{this.log.error(i)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(i=>{this.log.error(i)})}async _refreshCommonPrefixLength(e,t,n){if(!n&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}const i=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,i,this.routingTable.size);const s=AbortSignal.timeout(this.refreshQueryTimeout),o=await Vz(this.peerRouting.getClosestPeers(i.toMultihash().bytes,{signal:s}));this.log(`found ${o} peers that were close to imaginary peer %p`,i),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,i,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(e){e>Wp&&(e=Wp);const t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}async _generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");if(this.routingTable.kb.localPeer==null)throw new Error("Local peer not set");const t=Il(2),n=(t[1]<<8)+t[0],i=await this._makePeerId(this.routingTable.kb.localPeer.kadId,n,e),s=ru(i);return Zi(s)}async _makePeerId(e,t,n){if(n>Wp)throw new Error(`Cannot generate peer ID for common prefix length greater than ${Wp}`);const o=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>n,a=65535<<16-(n+1),c=o&a|t&~a,l=$4e[c],d=new ArrayBuffer(34),h=new DataView(d,0,d.byteLength);return h.setUint8(0,Mz.code),h.setUint8(1,32),h.setUint32(2,l,!1),new Uint8Array(h.buffer,h.byteOffset,h.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){var e;if(((e=this.routingTable.kb)==null?void 0:e.localPeer)!=null)for(const{kadId:t}of this.routingTable.kb.toIterable()){const n=oc(this.routingTable.kb.localPeer.kadId,t);let i=0;for(const s of n)if(s===0)i++;else break;yield i}}}class D4e{constructor(e,t){u(this,"peerId");u(this,"providers");u(this,"peerStore");u(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:add-provider`),this.peerId=e.peerId,this.providers=t.providers,this.peerStore=e.peerStore}async handle(e,t){if(t.key==null||t.key.length===0)throw new pt("Missing key");let n;try{n=qx.decode(t.key)}catch{throw new pt("Invalid CID")}(t.providers==null||t.providers.length===0)&&this.log.error("no providers found in message"),this.log("%p asked us, %p to store provider record for for %c",e,this.peerId,n),await Promise.all(t.providers.map(async i=>{const s=ru(i.id),o=Zi(s),a=i.multiaddrs.map(c=>Te(c));if(!e.equals(o)){this.log("invalid provider peer %p from %p",i.id,e);return}if(i.multiaddrs.length<1){this.log("no valid addresses for provider %p. Ignore",e);return}this.log.trace("received provider %p for %s (addrs %s)",e,n,a),await this.providers.addProvider(n,o),await this.peerStore.merge(o,{multiaddrs:a})}))}}class N4e{constructor(e,t){u(this,"peerRouting");u(this,"peerInfoMapper");u(this,"peerId");u(this,"addressManager");u(this,"log");const{peerRouting:n,logPrefix:i}=t;this.log=e.logger.forComponent(`${i}:rpc:handlers:find-node`),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=n,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(this.log("incoming request from %p for peers closer to %b",e,t.key),t.key==null)throw new pt("Invalid FIND_NODE message received - key was missing");const n=await this.peerRouting.getCloserPeersOffline(t.key,e);Fe(this.peerId.toMultihash().bytes,t.key)&&n.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(s=>s.decapsulateCode(Re("p2p").code))});const i={type:gt.FIND_NODE,clusterLevel:t.clusterLevel,closer:n.map(this.peerInfoMapper).filter(({multiaddrs:s})=>s.length).map(s=>({id:s.id.toMultihash().bytes,multiaddrs:s.multiaddrs.map(o=>o.bytes)})),providers:[]};return i.closer.length===0&&this.log("could not find any peers closer to %b than %p",t.key,e),i}}class O4e{constructor(e,t){u(this,"peerId");u(this,"peerRouting");u(this,"providers");u(this,"peerStore");u(this,"peerInfoMapper");u(this,"log");const{peerRouting:n,providers:i,logPrefix:s}=t;this.log=e.logger.forComponent(`${s}:rpc:handlers:get-providers`),this.peerId=e.peerId,this.peerStore=e.peerStore,this.peerRouting=n,this.providers=i,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(t.key==null)throw new pt("Invalid GET_PROVIDERS message received - key was missing");let n;try{n=qx.decode(t.key)}catch{throw new pt("Invalid CID")}this.log("%p asking for providers for %s",e,n);const[i,s]=await Promise.all([Ry(fh(await this.providers.getProviders(n),async a=>{const c=await this.peerStore.get(a);return{id:c.id,multiaddrs:c.addresses.map(({multiaddr:d})=>d)}})),this.peerRouting.getCloserPeersOffline(t.key,this.peerId)]),o={type:gt.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:s.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)})),providers:i.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))};return this.log("got %s providers %s closerPeers",o.providers.length,o.closer.length),o}async _getAddresses(e){return[]}}class R4e{constructor(e,t){u(this,"peerStore");u(this,"datastore");u(this,"peerRouting");u(this,"log");u(this,"datastorePrefix");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:get-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}async handle(e,t){const n=t.key;if(this.log("%p asked for key %b",e,n),n==null||n.length===0)throw new pt("Invalid key");const i={type:gt.GET_VALUE,key:n,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(Tme(n)){this.log("is public key");const a=$me(n);let c;try{const l=await this.peerStore.get(a);if(l.id.publicKey==null)throw new jt("No public key found in key book");c=Ss(l.id.publicKey)}catch(l){if(l.name!=="NotFoundError")throw l}if(c!=null)return this.log("returning found public key"),i.record=new yi(n,c,new Date).serialize(),i}const[s,o]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getCloserPeersOffline(n,e)]);return s!=null&&(this.log("had record for %b in local datastore",n),i.record=s.serialize()),o.length>0&&(this.log("had %s closer peers in routing table",o.length),i.closer=o.map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))),i}async _checkLocalDatastore(e){this.log("checkLocalDatastore looking for %b",e);const t=Kf(this.datastorePrefix,e);let n;try{n=await this.datastore.get(t)}catch(s){if(s.name==="NotFoundError")return;throw s}const i=yi.deserialize(n);if(i.timeReceived==null||Date.now()-i.timeReceived.getTime()>E3e){await this.datastore.delete(t);return}return i}}class B4e{constructor(e,t){u(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:ping`)}async handle(e,t){return this.log("ping from %p",e),t}}class L4e{constructor(e,t){u(this,"components");u(this,"validators");u(this,"log");u(this,"datastorePrefix");const{validators:n}=t;this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:put-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n}async handle(e,t){const n=t.key;if(this.log("%p asked us to store value for key %b",e,n),t.record==null){const i=`Empty record from: ${e.toString()}`;throw this.log.error(i),new pt(i)}try{const i=yi.deserialize(t.record);await Kx(this.validators,i),i.timeReceived=new Date;const s=Kf(this.datastorePrefix,i.key);await this.components.datastore.put(s,i.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,s)}catch(i){this.log("did not put record for key %b into datastore %o",n,i)}return t}}class M4e{constructor(e,t){u(this,"handlers");u(this,"routingTable");u(this,"log");u(this,"metrics");var n,i;this.metrics={operations:(n=e.metrics)==null?void 0:n.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_requests_total`),errors:(i=e.metrics)==null?void 0:i.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_errors_total`)},this.log=e.logger.forComponent(`${t.logPrefix}:rpc`),this.routingTable=t.routingTable,this.handlers={[gt.GET_VALUE.toString()]:new R4e(e,t),[gt.PUT_VALUE.toString()]:new L4e(e,t),[gt.FIND_NODE.toString()]:new N4e(e,t),[gt.ADD_PROVIDER.toString()]:new D4e(e,t),[gt.GET_PROVIDERS.toString()]:new O4e(e,t),[gt.PING.toString()]:new B4e(e,t)}}async handleMessage(e,t){var i,s;const n=this.handlers[t.type];if(n==null){this.log.error(`no handler found for message type: ${t.type}`);return}try{return(i=this.metrics.operations)==null||i.increment({[t.type]:!0}),await n.handle(e,t)}catch{(s=this.metrics.errors)==null||s.increment({[t.type]:!0})}}onIncomingStream(e){let t="unknown";Promise.resolve().then(async()=>{const{stream:n,connection:i}=e,s=i.remotePeer,o=this;await Qi(n,a=>Td(a),async function*(a){for await(const c of a){const l=gl.decode(c);t=l.type,o.log("incoming %s from %p",l.type,s);const d=await o.handleMessage(s,l);d!=null&&(yield gl.encode(d))}},a=>_d(a),n)}).catch(n=>{this.log.error("error handling %s RPC message from %p - %e",t,e.connection.remotePeer,n)})}}class U4e extends Gt{constructor(t,n){super();u(this,"log");u(this,"components");u(this,"protocol");u(this,"running");u(this,"registrarId");const{protocol:i,logPrefix:s}=n;this.components=t,this.log=t.logger.forComponent(`${s}:topology-listener`),this.running=!1,this.protocol=i}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:t=>{this.log("observed peer %p with protocol %s",t,this.protocol),this.dispatchEvent(new CustomEvent("peer",{detail:t}))}}))}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class F4e{constructor(e){u(this,"dht");this.dht=e}async provide(e,t={}){await vo(this.dht.provide(e,t))}async cancelReprovide(e){await this.dht.cancelReprovide(e)}async*findProviders(e,t={}){for await(const n of this.dht.findProviders(e,t))n.name==="PROVIDER"&&(yield*n.providers)}async put(e,t,n){await vo(this.dht.put(e,t,n))}async get(e,t){for await(const n of this.dht.get(e,t))if(n.name==="VALUE")return n.value;throw new jt("Could not find value for key")}}class z4e{constructor(e){u(this,"dht");this.dht=e}async findPeer(e,t={}){for await(const n of this.dht.findPeer(e,t))if(n.name==="FINAL_PEER")return n.peer;throw new jt("Peer not found")}async*getClosestPeers(e,t={}){for await(const n of this.dht.getClosestPeers(e,t))n.name==="FINAL_PEER"&&(yield n.peer)}}const V4e=32,K4e=64;var OD,RD,BD;class j4e extends Gt{constructor(t,n={}){var d,h,p,b;super();u(this,"protocol");u(this,"routingTable");u(this,"providers");u(this,"network");u(this,"peerRouting");u(this,"components");u(this,"log");u(this,"running");u(this,"kBucketSize");u(this,"clientMode");u(this,"validators");u(this,"selectors");u(this,"queryManager");u(this,"contentFetching");u(this,"contentRouting");u(this,"routingTableRefresh");u(this,"rpc");u(this,"topologyListener");u(this,"querySelf");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"dhtContentRouting");u(this,"dhtPeerRouting");u(this,"peerInfoMapper");u(this,"reprovider");u(this,BD,"@libp2p/kad-dht");u(this,RD,["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery"]);u(this,OD,["@libp2p/identify"]);const i=n.logPrefix??"libp2p:kad-dht",s=n.datastorePrefix??"/dht",o=n.metricsPrefix??"libp2p_kad_dht",a={queries:(d=t.metrics)==null?void 0:d.registerMetricGroup(`${o}_operations_total`,{label:"operation"}),errors:(h=t.metrics)==null?void 0:h.registerCounterGroup(`${o}_operation_errors_total`,{label:"operation"}),queryTime:(p=t.metrics)==null?void 0:p.registerMetricGroup(`${o}_operation_time_seconds`,{label:"operation"}),errorTime:(b=t.metrics)==null?void 0:b.registerMetricGroup(`${o}_operation_error_time_seconds`,{label:"operation"})};this.running=!1,this.components=t,this.log=t.logger.forComponent(i),this.protocol=n.protocol??x3e,this.kBucketSize=n.kBucketSize??20,this.clientMode=n.clientMode??!0,this.maxInboundStreams=n.maxInboundStreams??V4e,this.maxOutboundStreams=n.maxOutboundStreams??K4e,this.peerInfoMapper=n.peerInfoMapper??Ime;const c=ux();this.providers=new r4e(t,{...n.providers,logPrefix:i,datastorePrefix:s,lock:c}),this.validators={...K3e,...n.validators},this.selectors={...z3e,...n.selectors},this.network=new e4e(t,{protocol:this.protocol,logPrefix:i,metricsPrefix:o}),this.routingTable=new T4e(t,{kBucketSize:n.kBucketSize,pingOldContactTimeout:n.pingOldContactTimeout,pingOldContactConcurrency:n.pingOldContactConcurrency,pingOldContactMaxQueueSize:n.pingOldContactMaxQueueSize,pingNewContactTimeout:n.pingNewContactTimeout,pingNewContactConcurrency:n.pingNewContactConcurrency,pingNewContactMaxQueueSize:n.pingNewContactMaxQueueSize,protocol:this.protocol,logPrefix:i,metricsPrefix:o,prefixLength:n.prefixLength,splitThreshold:n.kBucketSplitThreshold,network:this.network});const l=De();n.allowQueryWithZeroPeers===!0&&l.resolve(),this.queryManager=new i4e(t,{disjointPaths:Math.ceil(this.kBucketSize/2),logPrefix:i,metricsPrefix:o,initialQuerySelfHasRun:l,routingTable:this.routingTable}),this.peerRouting=new t4e(t,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:i}),this.contentFetching=new Mme(t,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:i,datastorePrefix:s}),this.contentRouting=new Fme(t,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:i}),this.routingTableRefresh=new P4e(t,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:i}),this.rpc=new M4e(t,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:i,metricsPrefix:o,datastorePrefix:s,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new U4e(t,{protocol:this.protocol,logPrefix:i}),this.querySelf=new l4e(t,{peerRouting:this.peerRouting,interval:n.querySelfInterval,initialInterval:n.initialQuerySelfInterval,logPrefix:i,initialQuerySelfHasRun:l,routingTable:this.routingTable,operationMetrics:a}),this.reprovider=new u4e(t,{...n.reprovide,logPrefix:i,metricsPrefix:o,datastorePrefix:s,contentRouting:this.contentRouting,lock:c,operationMetrics:a}),this.network.addEventListener("peer",f=>{const g=f.detail;this.onPeerConnect(g).catch(v=>{this.log.error("could not add %p to routing table",g.id,v)}),this.dispatchEvent(new CustomEvent("peer",{detail:g}))}),this.topologyListener.addEventListener("peer",f=>{const g=f.detail;Promise.resolve().then(async()=>{const v=await this.components.peerStore.get(g),y={id:g,multiaddrs:v.addresses.map(({multiaddr:w})=>w),protocols:v.protocols};await this.onPeerConnect(y)}).catch(v=>{this.log.error("could not add %p to routing table - %e",g,v)})}),this.dhtPeerRouting=new z4e(this),this.dhtContentRouting=new F4e(this),n.clientMode==null&&t.events.addEventListener("self:peer:update",f=>{this.log("received update of self-peer info"),Promise.resolve().then(async()=>{const g=f.detail.peer.addresses.some(({multiaddr:y})=>Lme(y)),v=this.getMode();g&&v==="client"?await this.setMode("server"):v==="server"&&!g&&await this.setMode("client")}).catch(g=>{this.log.error("error setting dht server mode",g)})}),this.get=xu(this.get.bind(this),a,"GET_VALUE"),this.findProviders=xu(this.findProviders.bind(this),a,"FIND_PROVIDERS"),this.findPeer=xu(this.findPeer.bind(this),a,"FIND_PEER"),this.getClosestPeers=xu(this.getClosestPeers.bind(this),a,"GET_CLOSEST_PEERS"),this.provide=xu(this.provide.bind(this),a,"PROVIDE"),this.put=xu(this.put.bind(this),a,"PUT_VALUE")}get[(BD=Symbol.toStringTag,RD=fr,OD=Cl,Sd)](){return this.dhtContentRouting}get[Ad](){return this.dhtPeerRouting}get[Dg](){return this}async onPeerConnect(t){if(this.log.trace("peer %p connected",t.id),t=this.peerInfoMapper(t),t.multiaddrs.length===0){this.log.trace("ignoring %p as there were no valid addresses in %s after filtering",t.id,t.multiaddrs.map(n=>n.toString()));return}try{await this.routingTable.add(t.id)}catch(n){this.log.error("could not add %p to routing table",t.id,n)}}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(t,n=!1){if(t===this.getMode()&&!n){this.log("already in %s mode",t);return}if(await this.components.registrar.unhandle(this.protocol),t===this.getMode()&&!n){this.log("already in %s mode",t);return}t==="client"?(this.log("enabling client mode while in %s mode",this.getMode()),this.clientMode=!0):(this.log("enabling server mode while in %s mode",this.getMode()),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running||(this.running=!0,await this.setMode(this.clientMode?"client":"server",!0),await Eo(this.routingTable,this.queryManager,this.network,this.topologyListener,this.routingTableRefresh,this.reprovider),await Eo(this.querySelf))}async stop(){this.running=!1,await mc(this.querySelf,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener,this.reprovider)}async*put(t,n,i={}){yield*this.contentFetching.put(t,n,i)}async*get(t,n={}){yield*this.contentFetching.get(t,n)}async*provide(t,n={}){yield*this.contentRouting.provide(t,this.components.addressManager.getAddresses(),n)}async cancelReprovide(t){await this.providers.removeProvider(t,this.components.peerId)}async*findProviders(t,n={}){yield*this.contentRouting.findProviders(t,n)}async*findPeer(t,n={}){yield*this.peerRouting.findPeer(t,n)}async*getClosestPeers(t,n={}){yield*this.peerRouting.getClosestPeers(t,n)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}}var mb;(function(r){r[r.SEND_QUERY=0]="SEND_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADD_PEER=6]="ADD_PEER",r[r.DIAL_PEER=7]="DIAL_PEER"})(mb||(mb={}));function H4e(r={}){return e=>new j4e(e,r)}var q4e=r=>{if(Object.prototype.toString.call(r)!=="[object Object]")return!1;const e=Object.getPrototypeOf(r);return e===null||e===Object.prototype};const e3=q4e,{hasOwnProperty:jz}=Object.prototype,{propertyIsEnumerable:W4e}=Object,jd=(r,e,t)=>Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),G4e=Jf,xT={concatArrays:!1,ignoreUndefined:!1},y4=r=>{const e=[];for(const t in r)jz.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){const t=Object.getOwnPropertySymbols(r);for(const n of t)W4e.call(r,n)&&e.push(n)}return e};function wh(r){return Array.isArray(r)?Q4e(r):e3(r)?Y4e(r):r}function Q4e(r){const e=r.slice(0,0);return y4(r).forEach(t=>{jd(e,t,wh(r[t]))}),e}function Y4e(r){const e=Object.getPrototypeOf(r)===null?Object.create(null):{};return y4(r).forEach(t=>{jd(e,t,wh(r[t]))}),e}const Hz=(r,e,t,n)=>(t.forEach(i=>{typeof e[i]>"u"&&n.ignoreUndefined||(i in r&&r[i]!==Object.getPrototypeOf(r)?jd(r,i,wb(r[i],e[i],n)):jd(r,i,wh(e[i])))}),r),J4e=(r,e,t)=>{let n=r.slice(0,0),i=0;return[r,e].forEach(s=>{const o=[];for(let a=0;a<s.length;a++)jz.call(s,a)&&(o.push(String(a)),s===r?jd(n,i++,s[a]):jd(n,i++,wh(s[a])));n=Hz(n,s,y4(s).filter(a=>!o.includes(a)),t)}),n};function wb(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?J4e(r,e,t):!e3(e)||!e3(r)?wh(e):Hz(r,e,y4(e),t)}var X4e=function(...r){const e=wb(wh(xT),this!==G4e&&this||{},xT);let t={_:{}};for(const n of r)if(n!==void 0){if(!e3(n))throw new TypeError("`"+n+"` is not an Option Object");t=wb(t,{_:n},e)}return t._};const Gx=hc(X4e);function Z4e(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function ewe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var twe=ewe,rwe=twe;let nwe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},iwe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return qz(this,e)}},swe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return qz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function qz(r,e){return new swe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let owe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new nwe(e,t,n),this.decoder=new iwe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Wz({name:r,prefix:e,encode:t,decode:n}){return new owe(r,e,t,n)}function Gz({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=rwe(t,r);return Wz({prefix:e,name:r,encode:n,decode:s=>Z4e(i(s))})}function awe(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function cwe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function m4({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return Wz({prefix:e,name:r,encode(i){return cwe(i,n,t)},decode(i){return awe(i,n,t,r)}})}const lwe=Gz({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Gz({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var uwe=Qz,ST=128,dwe=-128,hwe=Math.pow(2,31);function Qz(r,e,t){e=e||[],t=t||0;for(var n=t;r>=hwe;)e[t++]=r&255|ST,r/=128;for(;r&dwe;)e[t++]=r&255|ST,r>>>=7;return e[t]=r|0,Qz.bytes=t-n+1,e}var fwe=bb,pwe=128,AT=127;function bb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw bb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&AT)<<i:(o&AT)*Math.pow(2,i),i+=7}while(o>=pwe);return bb.bytes=s-n,t}var gwe=Math.pow(2,7),ywe=Math.pow(2,14),mwe=Math.pow(2,21),wwe=Math.pow(2,28),bwe=Math.pow(2,35),vwe=Math.pow(2,42),Ewe=Math.pow(2,49),xwe=Math.pow(2,56),Swe=Math.pow(2,63),Awe=function(r){return r<gwe?1:r<ywe?2:r<mwe?3:r<wwe?4:r<bwe?5:r<vwe?6:r<Ewe?7:r<xwe?8:r<Swe?9:10},Cwe={encode:uwe,decode:fwe,encodingLength:Awe},Yz=Cwe;function CT(r,e,t=0){return Yz.encode(r,e,t),e}function kT(r){return Yz.encodingLength(r)}function IT(r,e){const t=e.byteLength,n=kT(r),i=n+kT(t),s=new Uint8Array(i+t);return CT(r,s,0),CT(t,s,n),s.set(e,i),new kwe(r,t,e,s)}let kwe=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function Iwe({name:r,code:e,encode:t}){return new _we(r,e,t)}let _we=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?IT(this.code,t):t.then(n=>IT(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Twe(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const $we=Iwe({name:"sha2-256",code:18,encode:Twe("SHA-256")});function Pwe(r){return r>=55296&&r<=56319}function Dwe(r){return r>=56320&&r<=57343}var Nwe=function(e,t,n){if(typeof t!="string")throw new Error("Input must be string");for(var i=t.length,s=0,o,a,c=0;c<i;c+=1){if(o=t.charCodeAt(c),a=t[c],Pwe(o)&&Dwe(t.charCodeAt(c+1))&&(c+=1,a+=t[c]),s+=e(a),s===n)return t.slice(0,c+1);if(s>n)return t.slice(0,c-a.length+1)}return t};function Owe(r){return r>=55296&&r<=56319}function Rwe(r){return r>=56320&&r<=57343}var Bwe=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var t=e.length,n=0,i=null,s=null,o=0;o<t;o++)i=e.charCodeAt(o),Rwe(i)?s!=null&&Owe(s)?n+=1:n+=3:i<=127?n+=1:i>=128&&i<=2047?n+=2:i>=2048&&i<=65535&&(n+=3),s=i;return n},Lwe=Nwe,Mwe=Bwe,Uwe=Lwe.bind(null,Mwe),Fwe=Uwe,zwe=/[\/\?<>\\:\*\|"]/g,Vwe=/[\x00-\x1f\x80-\x9f]/g,Kwe=/^\.+$/,jwe=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,Hwe=/[\. ]+$/;function _T(r,e){if(typeof r!="string")throw new Error("Input must be string");var t=r.replace(zwe,e).replace(Vwe,e).replace(Kwe,e).replace(jwe,e).replace(Hwe,e);return Fwe(t,255)}var qwe=function(r,e){var t=e&&e.replacement||"",n=_T(r,t);return t===""?n:_T(n,"")};const Wwe=hc(qwe),W8={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function Jz(r){const e="AES-GCM";let t=16;const n=12,i="SHA-256",s=16,o=32767,a=Is.get();t*=8;async function c(h,p){const b=a.getRandomValues(new Uint8Array(s)),f=a.getRandomValues(new Uint8Array(n)),g={name:e,iv:f};typeof p=="string"&&(p=se(p));let v;if(p.length===0){v=await a.subtle.importKey("jwk",W8,{name:"AES-GCM"},!0,["encrypt"]);try{const w={name:"PBKDF2",salt:b,iterations:o,hash:{name:i}},m=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);v=await a.subtle.deriveKey(w,m,{name:e,length:t},!0,["encrypt"])}catch{v=await a.subtle.importKey("jwk",W8,{name:"AES-GCM"},!0,["encrypt"])}}else{const w={name:"PBKDF2",salt:b,iterations:o,hash:{name:i}},m=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);v=await a.subtle.deriveKey(w,m,{name:e,length:t},!0,["encrypt"])}const y=await a.subtle.encrypt(g,v,h);return pr([b,g.iv,new Uint8Array(y)])}async function l(h,p){const b=h.subarray(0,s),f=h.subarray(s,s+n),g=h.subarray(s+n),v={name:e,iv:f};typeof p=="string"&&(p=se(p));let y;if(p.length===0)try{const m={name:"PBKDF2",salt:b,iterations:o,hash:{name:i}},E=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(m,E,{name:e,length:t},!0,["decrypt"])}catch{y=await a.subtle.importKey("jwk",W8,{name:"AES-GCM"},!0,["decrypt"])}else{const m={name:"PBKDF2",salt:b,iterations:o,hash:{name:i}},E=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(m,E,{name:e,length:t},!0,["decrypt"])}const w=await a.subtle.decrypt(v,y,g);return new Uint8Array(w)}return{encrypt:c,decrypt:l}}/*!
 * MIT License
 * 
 * Copyright (c) 2017-2024 Peculiar Ventures, LLC
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const Gwe="[object ArrayBuffer]";class le{static isArrayBuffer(e){return Object.prototype.toString.call(e)===Gwe}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const n=le.toUint8Array(e),i=le.toUint8Array(t);if(n.length!==i.byteLength)return!1;for(let s=0;s<n.length;s++)if(n[s]!==i[s])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let n=0;for(const o of t)n+=o.byteLength;const i=new Uint8Array(n);let s=0;for(const o of t){const a=this.toUint8Array(o);i.set(a,s),s+=a.length}return e[e.length-1]instanceof Function?this.toView(i,e[e.length-1]):i.buffer}}const G8="string",Qwe=/^[0-9a-f\s]+$/i,Ywe=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,Jwe=/^[a-zA-Z0-9-_]+$/;class TT{static fromString(e){const t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n.buffer}static toString(e){const t=le.toUint8Array(e);let n="";for(let s=0;s<t.length;s++)n+=String.fromCharCode(t[s]);return decodeURIComponent(escape(n))}}class us{static toString(e,t=!1){const n=le.toArrayBuffer(e),i=new DataView(n);let s="";for(let o=0;o<n.byteLength;o+=2){const a=i.getUint16(o,t);s+=String.fromCharCode(a)}return s}static fromString(e,t=!1){const n=new ArrayBuffer(e.length*2),i=new DataView(n);for(let s=0;s<e.length;s++)i.setUint16(s*2,e.charCodeAt(s),t);return n}}class Ee{static isHex(e){return typeof e===G8&&Qwe.test(e)}static isBase64(e){return typeof e===G8&&Ywe.test(e)}static isBase64Url(e){return typeof e===G8&&Jwe.test(e)}static ToString(e,t="utf8"){const n=le.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return us.toString(n,!0);case"utf16":case"utf16be":return us.toString(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return us.fromString(e,!0);case"utf16":case"utf16be":return us.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=le.toUint8Array(e);if(typeof btoa<"u"){const n=this.ToString(t,"binary");return btoa(n)}else return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ee.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ee.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=Ee.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return TT.fromString(e);case"utf16":case"utf16be":return us.fromString(e);case"utf16le":case"usc2":return us.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=Ee.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return TT.toString(e);case"utf16":case"utf16be":return us.toString(e);case"utf16le":case"usc2":return us.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);return n.buffer}static ToBinary(e){const t=le.toUint8Array(e);let n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return n}static ToHex(e){const t=le.toUint8Array(e);let n="";const i=t.length;for(let s=0;s<i;s++){const o=t[s];o<16&&(n+="0"),n+=o.toString(16)}return n}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ee.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const n=new Uint8Array(t.length/2);for(let i=0;i<t.length;i=i+2){const s=t.slice(i,i+2);n[i/2]=parseInt(s,16)}return n.buffer}static ToUtf16String(e,t=!1){return us.toString(e,t)}static FromUtf16String(e,t=!1){return us.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}static formatString(e){return(e==null?void 0:e.replace(/[\n\r\t ]/g,""))||""}}Ee.DEFAULT_UTF8_ENCODING="utf8";function Xwe(...r){const e=r.map(i=>i.byteLength).reduce((i,s)=>i+s),t=new Uint8Array(e);let n=0;return r.map(i=>new Uint8Array(i)).forEach(i=>{for(const s of i)t[n++]=s}),t.buffer}function Xz(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<r.byteLength;i++)if(t[i]!==n[i])return!1;return!0}/*!
 Copyright (c) Peculiar Ventures, LLC
*/function Hd(r,e){let t=0;if(r.length===1)return r[0];for(let n=r.length-1;n>=0;n--)t+=r[r.length-1-n]*Math.pow(2,e*n);return t}function Bl(r,e,t=-1){const n=t;let i=r,s=0,o=Math.pow(2,e);for(let a=1;a<8;a++){if(r<o){let c;if(n<0)c=new ArrayBuffer(a),s=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),s=n}const l=new Uint8Array(c);for(let d=a-1;d>=0;d--){const h=Math.pow(2,d*e);l[s-d-1]=Math.floor(i/h),i-=l[s-d-1]*h}return c}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function vb(...r){let e=0,t=0;for(const s of r)e+=s.length;const n=new ArrayBuffer(e),i=new Uint8Array(n);for(const s of r)i.set(s,t),t+=s.length;return i}function Zz(){const r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const a=r[0]===255&&r[1]&128,c=r[0]===0&&(r[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=r[0]&128;const n=Hd(t,8),i=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(i);for(let a=0;a<this.valueHex.byteLength;a++)s[a]=r[a];return s[0]&=127,Hd(s,8)-n}function Zwe(r){const e=r<0?r*-1:r;let t=128;for(let n=1;n<8;n++){if(e<=t){if(r<0){const o=t-e,a=Bl(o,8,n),c=new Uint8Array(a);return c[0]|=128,a}let i=Bl(e,8,n),s=new Uint8Array(i);if(s[0]&128){const o=i.slice(0),a=new Uint8Array(o);i=new ArrayBuffer(i.byteLength+1),s=new Uint8Array(i);for(let c=0;c<o.byteLength;c++)s[c+1]=a[c];s[0]=0}return i}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function e8e(r,e){if(r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<t.length;i++)if(t[i]!==n[i])return!1;return!0}function Nn(r,e){const t=r.toString(10);if(e<t.length)return"";const n=e-t.length,i=new Array(n);for(let o=0;o<n;o++)i[o]="0";return i.join("").concat(t)}/*!
 * Copyright (c) 2014, GMO GlobalSign
 * Copyright (c) 2015-2022, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */function t3(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Qx(r){let e=0,t=0;for(let i=0;i<r.length;i++){const s=r[i];e+=s.byteLength}const n=new Uint8Array(e);for(let i=0;i<r.length;i++){const s=r[i];n.set(new Uint8Array(s),t),t+=s.byteLength}return n.buffer}function Uo(r,e,t,n){return e instanceof Uint8Array?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class w4{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return Qx(this.items)}}const hf=[new Uint8Array([1])],$T="0123456789",Q8="name",PT="valueHexView",t8e="isHexOnly",r8e="idBlock",n8e="tagClass",i8e="tagNumber",s8e="isConstructed",o8e="fromBER",a8e="toBER",c8e="local",dn="",es=new ArrayBuffer(0),b4=new Uint8Array(0),U1="EndOfContent",eV="OCTET STRING",tV="BIT STRING";function Os(r){var e;return e=class extends r{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}constructor(...n){var i;super(...n);const s=n[0]||{};this.isHexOnly=(i=s.isHexOnly)!==null&&i!==void 0?i:!1,this.valueHexView=s.valueHex?le.toUint8Array(s.valueHex):b4}fromBER(n,i,s){const o=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!Uo(this,o,i,s))return-1;const a=i+s;return this.valueHexView=o.subarray(i,a),this.valueHexView.length?(this.blockLength=s,a):(this.warnings.push("Zero buffer length"),i)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",es)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:Ee.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class nu{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=dn,warnings:n=[],valueBeforeDecode:i=b4}={}){this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=le.toUint8Array(i)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Ee.ToHex(this.valueBeforeDecodeView)}}}nu.NAME="baseBlock";class an extends nu{fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}an.NAME="valueBlock";class rV extends Os(nu){constructor({idBlock:e={}}={}){var t,n,i,s;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?le.toUint8Array(e.valueHex):b4,this.tagClass=(n=e.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(i=e.tagNumber)!==null&&i!==void 0?i:-1,this.isConstructed=(s=e.isConstructed)!==null&&s!==void 0?s:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",es}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const i=new Uint8Array(1);if(!e){let s=this.tagNumber;s&=31,t|=s,i[0]=t}return i.buffer}if(!this.isHexOnly){const i=Bl(this.tagNumber,7),s=new Uint8Array(i),o=i.byteLength,a=new Uint8Array(o+1);if(a[0]=t|31,!e){for(let c=0;c<o-1;c++)a[c+1]=s[c]|128;a[o]=s[o-1]}return a.buffer}const n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=t|31,!e){const i=this.valueHexView;for(let s=0;s<i.length-1;s++)n[s+1]=i[s]|128;n[this.valueHexView.byteLength]=i[i.length-1]}return n.buffer}fromBER(e,t,n){const i=le.toUint8Array(e);if(!Uo(this,i,t,n))return-1;const s=i.subarray(t,t+n);if(s.length===0)return this.error="Zero buffer length",-1;switch(s[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(s[0]&32)===32,this.isHexOnly=!1;const a=s[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,l=this.valueHexView=new Uint8Array(255),d=255;for(;s[c]&128;){if(l[c-1]=s[c]&127,c++,c>=s.length)return this.error="End of input reached before message was fully decoded",-1;if(c===d){d+=255;const p=new Uint8Array(d);for(let b=0;b<l.length;b++)p[b]=l[b];l=this.valueHexView=new Uint8Array(d)}}this.blockLength=c+1,l[c-1]=s[c]&127;const h=new Uint8Array(c);for(let p=0;p<c;p++)h[p]=l[p];l=this.valueHexView=new Uint8Array(c),l.set(h),this.blockLength<=9?this.tagNumber=Hd(l,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}rV.NAME="identificationBlock";class nV extends nu{constructor({lenBlock:e={}}={}){var t,n,i;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(n=e.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(i=e.length)!==null&&i!==void 0?i:0}fromBER(e,t,n){const i=le.toUint8Array(e);if(!Uo(this,i,t,n))return-1;const s=i.subarray(t,t+n);if(s.length===0)return this.error="Zero buffer length",-1;if(s[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=s[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(s[0]&128),this.longFormUsed===!1)return this.length=s[0],this.blockLength=1,t+this.blockLength;const o=s[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>s.length)return this.error="End of input reached before message was fully decoded",-1;const a=t+1,c=i.subarray(a,a+o);return c[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=Hd(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(e=!1){let t,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=128),t;if(this.longFormUsed){const i=Bl(this.length,8);if(i.byteLength>127)return this.error="Too big length",es;if(t=new ArrayBuffer(i.byteLength+1),e)return t;const s=new Uint8Array(i);n=new Uint8Array(t),n[0]=i.byteLength|128;for(let o=0;o<i.byteLength;o++)n[o+1]=s[o];return t}return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}nV.NAME="lengthBlock";const ye={};class yr extends nu{constructor({name:e=dn,optional:t=!1,primitiveSchema:n,...i}={},s){super(i),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new rV(i),this.lenBlock=new nV(i),this.valueBlock=s?new s(i):new an(i)}fromBER(e,t,n){const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}toBER(e,t){const n=t||new w4;t||iV(this);const i=this.idBlock.toBER(e);if(n.write(i),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{const s=this.valueBlock.toBER(e);this.lenBlock.length=s.byteLength;const o=this.lenBlock.toBER(e);n.write(o),n.write(s)}return t?es:n.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():Ee.ToHex(this.toBER())}onAsciiEncoding(){const e=this.constructor.NAME,t=Ee.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),n=e.toBER();return e8e(t,n)}}yr.NAME="BaseBlock";function iV(r){var e;if(r instanceof ye.Constructed)for(const t of r.valueBlock.value)iV(t)&&(r.lenBlock.isIndefiniteForm=!0);return!!(!((e=r.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}class Yx extends yr{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=dn,...t}={},n){super(t,n),e&&this.fromString(e)}fromBER(e,t,n){const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}Yx.NAME="BaseStringBlock";class sV extends Os(an){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}sV.NAME="PrimitiveValueBlock";var oV;class T0 extends yr{constructor(e={}){super(e,sV),this.idBlock.isConstructed=!1}}oV=T0;ye.Primitive=oV;T0.NAME="PRIMITIVE";function l8e(r,e){if(r instanceof e)return r;const t=new e;return t.idBlock=r.idBlock,t.lenBlock=r.lenBlock,t.warnings=r.warnings,t.valueBeforeDecodeView=r.valueBeforeDecodeView,t}function bh(r,e=0,t=r.length){const n=e;let i=new yr({},an);const s=new nu;if(!Uo(s,r,e,t))return i.error=s.error,{offset:-1,result:i};if(!r.subarray(e,e+t).length)return i.error="Zero buffer length",{offset:-1,result:i};let a=i.idBlock.fromBER(r,e,t);if(i.idBlock.warnings.length&&i.warnings.concat(i.idBlock.warnings),a===-1)return i.error=i.idBlock.error,{offset:-1,result:i};if(e=a,t-=i.idBlock.blockLength,a=i.lenBlock.fromBER(r,e,t),i.lenBlock.warnings.length&&i.warnings.concat(i.lenBlock.warnings),a===-1)return i.error=i.lenBlock.error,{offset:-1,result:i};if(e=a,t-=i.lenBlock.blockLength,!i.idBlock.isConstructed&&i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};let c=yr;switch(i.idBlock.tagClass){case 1:if(i.idBlock.tagNumber>=37&&i.idBlock.isHexOnly===!1)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};c=ye.EndOfContent;break;case 1:c=ye.Boolean;break;case 2:c=ye.Integer;break;case 3:c=ye.BitString;break;case 4:c=ye.OctetString;break;case 5:c=ye.Null;break;case 6:c=ye.ObjectIdentifier;break;case 10:c=ye.Enumerated;break;case 12:c=ye.Utf8String;break;case 13:c=ye.RelativeObjectIdentifier;break;case 14:c=ye.TIME;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:c=ye.Sequence;break;case 17:c=ye.Set;break;case 18:c=ye.NumericString;break;case 19:c=ye.PrintableString;break;case 20:c=ye.TeletexString;break;case 21:c=ye.VideotexString;break;case 22:c=ye.IA5String;break;case 23:c=ye.UTCTime;break;case 24:c=ye.GeneralizedTime;break;case 25:c=ye.GraphicString;break;case 26:c=ye.VisibleString;break;case 27:c=ye.GeneralString;break;case 28:c=ye.UniversalString;break;case 29:c=ye.CharacterString;break;case 30:c=ye.BmpString;break;case 31:c=ye.DATE;break;case 32:c=ye.TimeOfDay;break;case 33:c=ye.DateTime;break;case 34:c=ye.Duration;break;default:{const l=i.idBlock.isConstructed?new ye.Constructed:new ye.Primitive;l.idBlock=i.idBlock,l.lenBlock=i.lenBlock,l.warnings=i.warnings,i=l}}break;case 2:case 3:case 4:default:c=i.idBlock.isConstructed?ye.Constructed:ye.Primitive}return i=l8e(i,c),a=i.fromBER(r,e,i.lenBlock.isIndefiniteForm?t:i.lenBlock.length),i.valueBeforeDecodeView=r.subarray(n,n+i.blockLength),{offset:a,result:i}}function ho(r){if(!r.byteLength){const e=new yr({},an);return e.error="Input buffer has zero length",{offset:-1,result:e}}return bh(le.toUint8Array(r).slice(),0,r.byteLength)}function u8e(r,e){return r?1:e}class Qa extends an{constructor({value:e=[],isIndefiniteForm:t=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){const i=le.toUint8Array(e);if(!Uo(this,i,t,n))return-1;if(this.valueBeforeDecodeView=i.subarray(t,t+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let s=t;for(;u8e(this.isIndefiniteForm,n)>0;){const o=bh(i,s,n);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(s=o.offset,this.blockLength+=o.result.blockLength,n-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===U1)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===U1?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}toBER(e,t){const n=t||new w4;for(let i=0;i<this.value.length;i++)this.value[i].toBER(e,n);return t?es:n.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}Qa.NAME="ConstructedValueBlock";var aV;class bn extends yr{constructor(e={}){super(e,Qa),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){const e=[];for(const n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(i=>`  ${i}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}aV=bn;ye.Constructed=aV;bn.NAME="CONSTRUCTED";class cV extends an{fromBER(e,t,n){return t}toBER(e){return es}}cV.override="EndOfContentValueBlock";var lV;class Jx extends yr{constructor(e={}){super(e,cV),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}lV=Jx;ye.EndOfContent=lV;Jx.NAME=U1;var uV;class xo extends yr{constructor(e={}){super(e,an),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){const n=new ArrayBuffer(2);if(!e){const i=new Uint8Array(n);i[0]=5,i[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}}uV=xo;ye.Null=uV;xo.NAME="NULL";class dV extends Os(an){get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=le.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,n){const i=le.toUint8Array(e);return Uo(this,i,t,n)?(this.valueHexView=i.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,Zz.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}dV.NAME="BooleanValueBlock";var hV;let v4=class extends yr{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,dV),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};hV=v4;ye.Boolean=hV;v4.NAME="BOOLEAN";class fV extends Os(Qa){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,n){let i=0;if(this.isConstructed){if(this.isHexOnly=!1,i=Qa.prototype.fromBER.call(this,e,t,n),i===-1)return i;for(let s=0;s<this.value.length;s++){const o=this.value[s].constructor.NAME;if(o===U1){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==eV)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,i=super.fromBER(e,t,n),this.blockLength=n;return i}toBER(e,t){return this.isConstructed?Qa.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}fV.NAME="OctetStringValueBlock";var Xx;let Fi=class extends yr{constructor({idBlock:e={},lenBlock:t={},...n}={}){var i,s;(i=n.isConstructed)!==null&&i!==void 0||(n.isConstructed=!!(!((s=n.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},fV),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const s=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(s.byteLength){const o=bh(s,0,s.byteLength);o.offset!==-1&&o.offset===n&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return bn.prototype.onAsciiEncoding.call(this);const e=this.constructor.NAME,t=Ee.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof Xx&&e.push(t.valueBlock.valueHexView);return le.concat(e)}};Xx=Fi;ye.OctetString=Xx;Fi.NAME=eV;class pV extends Os(Qa){constructor({unusedBits:e=0,isConstructed:t=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let i=-1;if(this.isConstructed){if(i=Qa.prototype.fromBER.call(this,e,t,n),i===-1)return i;for(const a of this.value){const c=a.constructor.NAME;if(c===U1){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==tV)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const l=a.valueBlock;if(this.unusedBits>0&&l.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=l.unusedBits}return i}const s=le.toUint8Array(e);if(!Uo(this,s,t,n))return-1;const o=s.subarray(t,t+n);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const a=o.subarray(1);try{if(a.byteLength){const c=bh(a,0,a.byteLength);c.offset!==-1&&c.offset===n-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+n}toBER(e,t){if(this.isConstructed)return Qa.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return es;const n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}pV.NAME="BitStringValueBlock";var gV;let yl=class extends yr{constructor({idBlock:e={},lenBlock:t={},...n}={}){var i,s;(i=n.isConstructed)!==null&&i!==void 0||(n.isConstructed=!!(!((s=n.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},pV),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return bn.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const o of t)e.push(o.toString(2).padStart(8,"0"));const n=e.join(""),i=this.constructor.NAME,s=n.substring(0,n.length-this.valueBlock.unusedBits);return`${i} : ${s}`}}};gV=yl;ye.BitString=gV;yl.NAME=tV;var yV;function d8e(r,e){const t=new Uint8Array([0]),n=new Uint8Array(r),i=new Uint8Array(e);let s=n.slice(0);const o=s.length-1,a=i.slice(0),c=a.length-1;let l=0;const d=c<o?o:c;let h=0;for(let p=d;p>=0;p--,h++){switch(!0){case h<a.length:l=s[o-h]+a[c-h]+t[0];break;default:l=s[o-h]+t[0]}switch(t[0]=l/10,!0){case h>=s.length:s=vb(new Uint8Array([l%10]),s);break;default:s[o-h]=l%10}}return t[0]>0&&(s=vb(t,s)),s}function DT(r){if(r>=hf.length)for(let e=hf.length;e<=r;e++){const t=new Uint8Array([0]);let n=hf[e-1].slice(0);for(let i=n.length-1;i>=0;i--){const s=new Uint8Array([(n[i]<<1)+t[0]]);t[0]=s[0]/10,n[i]=s[0]%10}t[0]>0&&(n=vb(t,n)),hf.push(n)}return hf[r]}function h8e(r,e){let t=0;const n=new Uint8Array(r),i=new Uint8Array(e),s=n.slice(0),o=s.length-1,a=i.slice(0),c=a.length-1;let l,d=0;for(let h=c;h>=0;h--,d++)switch(l=s[o-d]-a[c-d]-t,!0){case l<0:t=1,s[o-d]=l+10;break;default:t=0,s[o-d]=l}if(t>0)for(let h=o-c+1;h>=0;h--,d++)if(l=s[o-d]-t,l<0)t=1,s[o-d]=l+10;else{t=0,s[o-d]=l;break}return s.slice()}class Zx extends Os(an){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=Zz.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(Zwe(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,i=0){const s=this.fromBER(e,t,n);if(s===-1)return s;const o=this.valueHexView;return o[0]===0&&o[1]&128?this.valueHexView=o.subarray(1):i!==0&&o.length<i&&(i-o.length>1&&(i=o.length+1),this.valueHexView=o.subarray(i-o.length)),s}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(t,1),this.valueHexView=n}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,n){const i=super.fromBER(e,t,n);return i===-1||this.setValueHex(),i}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),n=0,i;const s=this.valueHexView;let o="",a=!1;for(let c=s.byteLength-1;c>=0;c--){i=s[c];for(let l=0;l<8;l++){if((i&1)===1)switch(n){case e:t=h8e(DT(n),t),o="-";break;default:t=d8e(t,DT(n))}n++,i>>=1}}for(let c=0;c<t.length;c++)t[c]&&(a=!0),a&&(o+=$T.charAt(t[c]));return a===!1&&(o+=$T.charAt(0)),o}}yV=Zx;Zx.NAME="IntegerValueBlock";Object.defineProperty(yV.prototype,"valueHex",{set:function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var jf;class fo extends yr{constructor(e={}){super(e,Zx),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return t3(),BigInt(this.valueBlock.toString())}static fromBigInt(e){t3();const t=BigInt(e),n=new w4,i=t.toString(16).replace(/^-/,""),s=new Uint8Array(Ee.FromHex(i));if(t<0){const a=new Uint8Array(s.length+(s[0]&128?1:0));a[0]|=128;const l=BigInt(`0x${Ee.ToHex(a)}`)+t,d=le.toUint8Array(Ee.FromHex(l.toString(16)));d[0]|=128,n.write(d)}else s[0]&128&&n.write(new Uint8Array([0])),n.write(s);return new jf({valueHex:n.final()})}convertToDER(){const e=new jf({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new jf({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}jf=fo;ye.Integer=jf;fo.NAME="INTEGER";var mV;class E4 extends fo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}mV=E4;ye.Enumerated=mV;E4.NAME="ENUMERATED";class Eb extends Os(an){constructor({valueDec:e=-1,isFirstSid:t=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;const i=le.toUint8Array(e);if(!Uo(this,i,t,n))return-1;const s=i.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=s[a]&127,this.blockLength++,!!(s[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,s[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Hd(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){t3();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const n=new Uint8Array(t.length/7);for(let i=0;i<n.length;i++)n[i]=parseInt(t.slice(i*7,i*7+7),2)+(i+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=i[o]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}const t=Bl(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",es;const n=new Uint8Array(t.byteLength);if(!e){const i=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)n[o]=i[o]|128;n[s]=i[s]}return n}toString(){let e="";if(this.isHexOnly)e=Ee.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}Eb.NAME="sidBlock";class wV extends an{constructor({value:e=dn,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let i=t;for(;n>0;){const s=new Eb;if(i=s.fromBER(e,i,n),i===-1)return this.blockLength=0,this.error=s.error,i;this.value.length===0&&(s.isFirstSid=!0),this.blockLength+=s.blockLength,n-=s.blockLength,this.value.push(s)}return i}toBER(e){const t=[];for(let n=0;n<this.value.length;n++){const i=this.value[n].toBER(e);if(i.byteLength===0)return this.error=this.value[n].error,es;t.push(i)}return Qx(t)}fromString(e){this.value=[];let t=0,n=0,i="",s=!1;do if(n=e.indexOf(".",t),n===-1?i=e.substring(t):i=e.substring(t,n),t=n+1,s){const o=this.value[0];let a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}const c=parseInt(i,10);if(isNaN(c))return;o.valueDec=c+a,s=!1}else{const o=new Eb;if(i>Number.MAX_SAFE_INTEGER){t3();const a=BigInt(i);o.valueBigInt=a}else if(o.valueDec=parseInt(i,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,s=!0),this.value.push(o)}while(n!==-1)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let i=this.value[n].toString();n!==0&&(e=`${e}.`),t?(i=`{${i}}`,this.value[n].isFirstSid?e=`2.{${i} - 80}`:e+=i):e+=i}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}wV.NAME="ObjectIdentifierValueBlock";var bV;class io extends yr{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,wV),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}bV=io;ye.ObjectIdentifier=bV;io.NAME="OBJECT IDENTIFIER";class xb extends Os(nu){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,n){if(n===0)return t;const i=le.toUint8Array(e);if(!Uo(this,i,t,n))return-1;const s=i.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=s[a]&127,this.blockLength++,!!(s[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,s[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Hd(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=i[o]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}const t=Bl(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",es;const n=new Uint8Array(t.byteLength);if(!e){const i=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)n[o]=i[o]|128;n[s]=i[s]}return n.buffer}toString(){let e="";return this.isHexOnly?e=Ee.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}xb.NAME="relativeSidBlock";class vV extends an{constructor({value:e=dn,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let i=t;for(;n>0;){const s=new xb;if(i=s.fromBER(e,i,n),i===-1)return this.blockLength=0,this.error=s.error,i;this.blockLength+=s.blockLength,n-=s.blockLength,this.value.push(s)}return i}toBER(e,t){const n=[];for(let i=0;i<this.value.length;i++){const s=this.value[i].toBER(e);if(s.byteLength===0)return this.error=this.value[i].error,es;n.push(s)}return Qx(n)}fromString(e){this.value=[];let t=0,n=0,i="";do{n=e.indexOf(".",t),n===-1?i=e.substring(t):i=e.substring(t,n),t=n+1;const s=new xb;if(s.valueDec=parseInt(i,10),isNaN(s.valueDec))return!0;this.value.push(s)}while(n!==-1);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let i=this.value[n].toString();n!==0&&(e=`${e}.`),t&&(i=`{${i}}`),e+=i}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}vV.NAME="RelativeObjectIdentifierValueBlock";var EV;class eS extends yr{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,vV),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}EV=eS;ye.RelativeObjectIdentifier=EV;eS.NAME="RelativeObjectIdentifier";var xV;class er extends bn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}xV=er;ye.Sequence=xV;er.NAME="SEQUENCE";var SV;let po=class extends bn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};SV=po;ye.Set=SV;po.NAME="SET";class AV extends Os(an){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=dn}toJSON(){return{...super.toJSON(),value:this.value}}}AV.NAME="StringValueBlock";class CV extends AV{}CV.NAME="SimpleStringValueBlock";class Yn extends Yx{constructor({...e}={}){super(e,CV)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,le.toUint8Array(e))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);this.valueBlock.value=e}}Yn.NAME="SIMPLE STRING";class kV extends Yn{fromBuffer(e){this.valueBlock.valueHexView=le.toUint8Array(e);try{this.valueBlock.value=Ee.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=Ee.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(Ee.FromUtf8String(e)),this.valueBlock.value=e}}kV.NAME="Utf8StringValueBlock";var IV;class Fo extends kV{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}IV=Fo;ye.Utf8String=IV;Fo.NAME="UTF8String";class _V extends Yn{fromBuffer(e){this.valueBlock.value=Ee.ToUtf16String(e),this.valueBlock.valueHexView=le.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(Ee.FromUtf16String(e))}}_V.NAME="BmpStringValueBlock";var TV;class x4 extends _V{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}TV=x4;ye.BmpString=TV;x4.NAME="BMPString";class $V extends Yn{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let i=0;i<n.length;i+=4)n[i]=n[i+3],n[i+1]=n[i+2],n[i+2]=0,n[i+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let i=0;i<t;i++){const s=Bl(e.charCodeAt(i),8),o=new Uint8Array(s);if(o.length>4)continue;const a=4-o.length;for(let c=o.length-1;c>=0;c--)n[i*4+c+a]=o[c]}this.valueBlock.value=e}}$V.NAME="UniversalStringValueBlock";var PV;class S4 extends $V{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}PV=S4;ye.UniversalString=PV;S4.NAME="UniversalString";var DV;class A4 extends Yn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}DV=A4;ye.NumericString=DV;A4.NAME="NumericString";var NV;class C4 extends Yn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}NV=C4;ye.PrintableString=NV;C4.NAME="PrintableString";var OV;class k4 extends Yn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}OV=k4;ye.TeletexString=OV;k4.NAME="TeletexString";var RV;class I4 extends Yn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}RV=I4;ye.VideotexString=RV;I4.NAME="VideotexString";var BV;class _4 extends Yn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}BV=_4;ye.IA5String=BV;_4.NAME="IA5String";var LV;class T4 extends Yn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}LV=T4;ye.GraphicString=LV;T4.NAME="GraphicString";var MV;class $0 extends Yn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}MV=$0;ye.VisibleString=MV;$0.NAME="VisibleString";var UV;class $4 extends Yn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}UV=$4;ye.GeneralString=UV;$4.NAME="GeneralString";var FV;class P4 extends Yn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}FV=P4;ye.CharacterString=FV;P4.NAME="CharacterString";var zV;class P0 extends $0{constructor({value:e,valueDate:t,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let i=0;i<e.length;i++)this.valueBlock.valueHexView[i]=e.charCodeAt(i)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,le.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}const i=parseInt(n[1],10);i>=50?this.year=1900+i:this.year=2e3+i,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=Nn(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=Nn(this.month,2),t[2]=Nn(this.day,2),t[3]=Nn(this.hour,2),t[4]=Nn(this.minute,2),t[5]=Nn(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}zV=P0;ye.UTCTime=zV;P0.NAME="UTCTime";var VV;class D4 extends P0{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){const e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,n="",i="",s=0,o,a=0,c=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),t=!0;else{const h=new Number(e[e.length-1]);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(t){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let h=1,p=n.indexOf("+"),b="";if(p===-1&&(p=n.indexOf("-"),h=-1),p!==-1){if(b=n.substring(p+1),n=n.substring(0,p),b.length!==2&&b.length!==4)throw new Error("Wrong input string for conversion");let f=parseInt(b.substring(0,2),10);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");if(a=h*f,b.length===4){if(f=parseInt(b.substring(2,4),10),isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");c=h*f}}}let l=n.indexOf(".");if(l===-1&&(l=n.indexOf(",")),l!==-1){const h=new Number(`0${n.substring(l)}`);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");s=h.valueOf(),i=n.substring(0,l)}else i=n;switch(!0){case i.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,l!==-1)throw new Error("Wrong input string for conversion");break;case i.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let h=60*s;this.minute=Math.floor(h),h=60*(h-this.minute),this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case i.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let h=60*s;this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case i.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){const h=1e3*s;this.millisecond=Math.floor(h)}break;default:throw new Error("Wrong input string for conversion")}const d=o.exec(i);if(d===null)throw new Error("Wrong input string for conversion");for(let h=1;h<d.length;h++)switch(h){case 1:this.year=parseInt(d[h],10);break;case 2:this.month=parseInt(d[h],10);break;case 3:this.day=parseInt(d[h],10);break;case 4:this.hour=parseInt(d[h],10)+a;break;case 5:this.minute=parseInt(d[h],10)+c;break;case 6:this.second=parseInt(d[h],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const h=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=h.getUTCFullYear(),this.month=h.getUTCMonth(),this.day=h.getUTCDay(),this.hour=h.getUTCHours(),this.minute=h.getUTCMinutes(),this.second=h.getUTCSeconds(),this.millisecond=h.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push(Nn(this.year,4)),t.push(Nn(this.month,2)),t.push(Nn(this.day,2)),t.push(Nn(this.hour,2)),t.push(Nn(this.minute,2)),t.push(Nn(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(Nn(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}VV=D4;ye.GeneralizedTime=VV;D4.NAME="GeneralizedTime";var KV;class tS extends Fo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}KV=tS;ye.DATE=KV;tS.NAME="DATE";var jV;class rS extends Fo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}jV=rS;ye.TimeOfDay=jV;rS.NAME="TimeOfDay";var HV;class nS extends Fo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}HV=nS;ye.DateTime=HV;nS.NAME="DateTime";var qV;class iS extends Fo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}qV=iS;ye.Duration=qV;iS.NAME="Duration";var WV;class sS extends Fo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}WV=sS;ye.TIME=WV;sS.NAME="TIME";class Ll{constructor({name:e=dn,optional:t=!1}={}){this.name=e,this.optional=t}}class oS extends Ll{constructor({value:e=[],...t}={}){super(t),this.value=e}}class r3 extends Ll{constructor({value:e=new Ll,local:t=!1,...n}={}){super(n),this.value=e,this.local=t}}class f8e{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=le.toUint8Array(e)}constructor({data:e=b4}={}){this.dataView=le.toUint8Array(e)}fromBER(e,t,n){const i=t+n;return this.dataView=le.toUint8Array(e).subarray(t,i),i}toBER(e){return this.dataView.slice().buffer}}function Zc(r,e,t){if(t instanceof oS){for(const s of t.value)if(Zc(r,e,s).verified)return{verified:!0,result:r};{const s={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(Q8)&&(s.name=t.name),s}}if(t instanceof Ll)return t.hasOwnProperty(Q8)&&(r[t.name]=e),{verified:!0,result:r};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(r8e in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(o8e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(a8e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const n=t.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(n8e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(i8e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(s8e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:r};if(!(t8e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:r};if(t.idBlock.isHexOnly){if(!(PT in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const s=t.idBlock.valueHexView,o=e.idBlock.valueHexView;if(s.length!==o.length)return{verified:!1,result:r};for(let a=0;a<s.length;a++)if(s[a]!==o[1])return{verified:!1,result:r}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,dn),t.name&&(r[t.name]=e)),t instanceof ye.Constructed){let s=0,o={verified:!1,result:{error:"Unknown error"}},a=t.valueBlock.value.length;if(a>0&&t.valueBlock.value[0]instanceof r3&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:r};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let c=!0;for(let l=0;l<t.valueBlock.value.length;l++)c=c&&(t.valueBlock.value[l].optional||!1);return c?{verified:!0,result:r}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,dn),t.name&&delete r[t.name]),r.error="Inconsistent object length",{verified:!1,result:r})}for(let c=0;c<a;c++)if(c-s>=e.valueBlock.value.length){if(t.valueBlock.value[c].optional===!1){const l={verified:!1,result:r};return r.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,dn),t.name&&(delete r[t.name],l.name=t.name)),l}}else if(t.valueBlock.value[0]instanceof r3){if(o=Zc(r,e.valueBlock.value[c],t.valueBlock.value[0].value),o.verified===!1)if(t.valueBlock.value[0].optional)s++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,dn),t.name&&delete r[t.name]),o;if(Q8 in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let l={};c8e in t.valueBlock.value[0]&&t.valueBlock.value[0].local?l=e:l=r,typeof l[t.valueBlock.value[0].name]>"u"&&(l[t.valueBlock.value[0].name]=[]),l[t.valueBlock.value[0].name].push(e.valueBlock.value[c])}}else if(o=Zc(r,e.valueBlock.value[c-s],t.valueBlock.value[c]),o.verified===!1)if(t.valueBlock.value[c].optional)s++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,dn),t.name&&delete r[t.name]),o;if(o.verified===!1){const c={verified:!1,result:r};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,dn),t.name&&(delete r[t.name],c.name=t.name)),c}return{verified:!0,result:r}}if(t.primitiveSchema&&PT in e.valueBlock){const s=bh(e.valueBlock.valueHexView);if(s.offset===-1){const o={verified:!1,result:s.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,dn),t.name&&(delete r[t.name],o.name=t.name)),o}return Zc(r,s.result,t.primitiveSchema)}return{verified:!0,result:r}}function p8e(r,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};const t=bh(le.toUint8Array(r));return t.offset===-1?{verified:!1,result:t.result}:Zc(t.result,t.result,e)}const GV=Object.freeze(Object.defineProperty({__proto__:null,Any:Ll,BaseBlock:yr,BaseStringBlock:Yx,BitString:yl,BmpString:x4,Boolean:v4,CharacterString:P4,Choice:oS,Constructed:bn,DATE:tS,DateTime:nS,Duration:iS,EndOfContent:Jx,Enumerated:E4,GeneralString:$4,GeneralizedTime:D4,GraphicString:T4,HexBlock:Os,IA5String:_4,Integer:fo,Null:xo,NumericString:A4,ObjectIdentifier:io,OctetString:Fi,Primitive:T0,PrintableString:C4,RawData:f8e,RelativeObjectIdentifier:eS,Repeated:r3,Sequence:er,Set:po,TIME:sS,TeletexString:k4,TimeOfDay:rS,UTCTime:P0,UniversalString:S4,Utf8String:Fo,ValueBlock:an,VideotexString:I4,ViewWriter:w4,VisibleString:$0,compareSchema:Zc,fromBER:ho,verifySchema:p8e},Symbol.toStringTag,{value:"Module"})),QV=m4({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});m4({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});m4({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});m4({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const g8e=16,Sb=32,Ab=1e4;async function N4(r,e){const n=await Jz().encrypt(r,e);return QV.encode(n)}async function NT(r,e,t){if(r.type==="RSA")return b8e(r,e,t);if(r.type==="Ed25519")return y8e(r,e,t);if(r.type==="secp256k1")return m8e(r,e,t);if(r.type==="ECDSA")return w8e(r,e,t);throw new tu}async function y8e(r,e,t="libp2p-key"){if(t==="libp2p-key")return N4(E0(r),e);throw new Z(`export format '${t}' is not supported`)}async function m8e(r,e,t="libp2p-key"){if(t==="libp2p-key")return N4(E0(r),e);throw new Z("Export format is not supported")}async function w8e(r,e,t="libp2p-key"){if(t==="libp2p-key")return N4(E0(r),e);throw new Z(`export format '${t}' is not supported`)}async function b8e(r,e,t="pkcs-8"){if(t==="pkcs-8")return v8e(r,e);if(t==="libp2p-key")return N4(E0(r),e);throw new Z("Export format is not supported")}async function v8e(r,e){const t=Is.get(),i=new er({value:[new fo({value:0}),new er({value:[new io({value:"1.2.840.113549.1.1.1"}),new xo]}),new Fi({valueHex:r.raw})]}).toBER(),s=new Uint8Array(i,0,i.byteLength),o=Il(g8e),a=await PM(ix,e,o,{c:Ab,dkLen:Sb}),c=Il(16),l=await t.subtle.importKey("raw",a,"AES-CBC",!1,["encrypt"]),d=await t.subtle.encrypt({name:"AES-CBC",iv:c},l,s),h=new er({value:[new Fi({valueHex:o}),new fo({value:Ab}),new fo({value:Sb}),new er({value:[new io({value:"1.2.840.113549.2.11"}),new xo]})]}),p=new er({value:[new io({value:"1.2.840.113549.1.5.13"}),new er({value:[new er({value:[new io({value:"1.2.840.113549.1.5.12"}),h]}),new er({value:[new io({value:"2.16.840.1.101.3.4.1.42"}),new Fi({valueHex:c})]})]})]}),f=new er({value:[p,new Fi({valueHex:d})]}).toBER(),g=new Uint8Array(f,0,f.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...re(g,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join(`
`)}async function OT(r,e){try{const t=await E8e(r,e);return Qre(t)}catch{}if(!r.includes("BEGIN"))throw new Z("Encrypted key was not a libp2p-key or a PEM file");return x8e(r,e)}async function E8e(r,e){const t=QV.decode(r);return Jz().decrypt(t,e)}async function x8e(r,e){const t=Is.get();let n;if(r.includes("-----BEGIN ENCRYPTED PRIVATE KEY-----")){const s=se(r.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:o}=ho(s),{iv:a,salt:c,iterations:l,keySize:d,cipherText:h}=S8e(o),p=await PM(ix,e,c,{c:l,dkLen:d}),b=await t.subtle.importKey("raw",p,"AES-CBC",!1,["decrypt"]),f=Hf(await t.subtle.decrypt({name:"AES-CBC",iv:a},b,h)),{result:g}=ho(f);n=RT(g)}else if(r.includes("-----BEGIN PRIVATE KEY-----")){const s=se(r.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:o}=ho(s);n=RT(o)}else throw new Z("Could not parse private key from PEM data");const i=X6(n);if(i.type!=="RSA")throw new Z("Could not parse RSA private key from PEM data");return i}function S8e(r){const e=r.valueBlock.value[0];if(e.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.13")throw new Z("Only pkcs5PBES2 encrypted private keys are supported");const n=e.valueBlock.value[1].valueBlock.value[0];if(n.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.12")throw new Z("Only pkcs5PBKDF2 key derivation functions are supported");const s=n.valueBlock.value[1],o=Hf(s.valueBlock.value[0].getValue());let a=Ab,c=Sb;if(s.valueBlock.value.length===3)a=Number(s.valueBlock.value[1].toBigInt()),c=Number(s.valueBlock.value[2].toBigInt());else if(s.valueBlock.value.length===2)throw new Z("Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key");const l=e.valueBlock.value[1].valueBlock.value[1],d=l.valueBlock.value[0].toString();if(d!=="OBJECT IDENTIFIER : 1.2.840.113549.3.7"){if(d!=="OBJECT IDENTIFIER : 1.3.14.3.2.7"){if(d!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2"){if(d!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22"){if(d!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42")throw new Z("Only AES-CBC encryption schemes are supported")}}}}const h=Hf(l.valueBlock.value[1].getValue());return{cipherText:Hf(r.valueBlock.value[1].getValue()),salt:o,iterations:a,keySize:c,iv:h}}function RT(r){return Hf(r.valueBlock.value[2].getValue())}function Hf(r){return new Uint8Array(r,0,r.byteLength)}const A8e="/pkcs8/",Cb="/info/",ff=new WeakMap,Bc={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},Y8={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function Su(r){return r==null||typeof r!="string"?!1:r===Wwe(r.trim())&&r.length>0}async function sr(){const t=Math.random()*800+200;await new Promise(n=>setTimeout(n,t))}function Lc(r){return new ht(A8e+r)}function Au(r){return new ht(Cb+r)}async function C8e(r){const e=E0(r),t=await $we.digest(e);return lwe.encode(t.bytes).substring(1)}var LD,MD;MD=Symbol.toStringTag,LD=fr;class k8e{constructor(e,t){u(this,"components");u(this,"init");u(this,"log");u(this,"self");u(this,MD,"@libp2p/keychain");u(this,LD,["@libp2p/keychain"]);var i,s,o,a,c,l,d,h,p,b;if(this.components=e,this.log=e.logger.forComponent("libp2p:keychain"),this.init=Gx(Y8,t),this.self=t.selfKey??"self",this.init.pass!=null&&((i=this.init.pass)==null?void 0:i.length)<20)throw new Error("pass must be least 20 characters");if(((s=this.init.dek)==null?void 0:s.keyLength)!=null&&this.init.dek.keyLength<Bc.minKeyLength)throw new Error(`dek.keyLength must be least ${Bc.minKeyLength} bytes`);if(((a=(o=this.init.dek)==null?void 0:o.salt)==null?void 0:a.length)!=null&&this.init.dek.salt.length<Bc.minSaltLength)throw new Error(`dek.saltLength must be least ${Bc.minSaltLength} bytes`);if(((c=this.init.dek)==null?void 0:c.iterationCount)!=null&&this.init.dek.iterationCount<Bc.minIterationCount)throw new Error(`dek.iterationCount must be least ${Bc.minIterationCount}`);const n=this.init.pass!=null&&((l=this.init.dek)==null?void 0:l.salt)!=null?Mk(this.init.pass,(d=this.init.dek)==null?void 0:d.salt,(h=this.init.dek)==null?void 0:h.iterationCount,(p=this.init.dek)==null?void 0:p.keyLength,(b=this.init.dek)==null?void 0:b.hash):"";ff.set(this,{dek:n})}static generateOptions(){const e=Object.assign({},Y8),t=Math.ceil(Bc.minSaltLength/3)*3;return e.dek.salt=re(Il(t),"base64"),e}static get options(){return Y8}async findKeyByName(e){if(!Su(e))throw await sr(),new Z(`Invalid key name '${e}'`);const t=Au(e);try{const n=await this.components.datastore.get(t);return JSON.parse(re(n))}catch(n){throw await sr(),this.log.error(n),new jt(`Key '${e}' does not exist.`)}}async findKeyById(e){try{const t={prefix:Cb};for await(const n of this.components.datastore.query(t)){const i=JSON.parse(re(n.value));if(i.id===e)return i}throw new Z(`Key with id '${e}' does not exist.`)}catch(t){throw await sr(),t}}async importKey(e,t){if(!Su(e))throw await sr(),new Z(`Invalid key name '${e}'`);if(t==null)throw await sr(),new Z("Key is required");const n=Lc(e);if(await this.components.datastore.has(n))throw await sr(),new Z(`Key '${e}' already exists`);let s,o;try{s=await C8e(t);const l=ff.get(this);if(l==null)throw new Z("dek missing");const d=l.dek;o=await NT(t,d,t.type==="RSA"?"pkcs-8":"libp2p-key")}catch(l){throw await sr(),l}const a={name:e,id:s},c=this.components.datastore.batch();return c.put(n,se(o)),c.put(Au(e),se(JSON.stringify(a))),await c.commit(),a}async exportKey(e){if(!Su(e))throw await sr(),new Z(`Invalid key name '${e}'`);const t=Lc(e);try{const n=await this.components.datastore.get(t),i=re(n),s=ff.get(this);if(s==null)throw new Z("dek missing");const o=s.dek;return await OT(i,o)}catch(n){throw await sr(),n}}async removeKey(e){if(!Su(e)||e===this.self)throw await sr(),new Z(`Invalid key name '${e}'`);const t=Lc(e),n=await this.findKeyByName(e),i=this.components.datastore.batch();return i.delete(t),i.delete(Au(e)),await i.commit(),n}async listKeys(){const e={prefix:Cb},t=[];for await(const n of this.components.datastore.query(e))t.push(JSON.parse(re(n.value)));return t}async renameKey(e,t){if(!Su(e)||e===this.self)throw await sr(),new Z(`Invalid old key name '${e}'`);if(!Su(t)||t===this.self)throw await sr(),new Z(`Invalid new key name '${t}'`);const n=Lc(e),i=Lc(t),s=Au(e),o=Au(t);if(await this.components.datastore.has(i))throw await sr(),new Z(`Key '${t}' already exists`);try{const c=await this.components.datastore.get(n),l=await this.components.datastore.get(s),d=JSON.parse(re(l));d.name=t;const h=this.components.datastore.batch();return h.put(i,c),h.put(o,se(JSON.stringify(d))),h.delete(n),h.delete(s),await h.commit(),d}catch(c){throw await sr(),c}}async rotateKeychainPass(e,t){var a,c,l,d;if(typeof e!="string")throw await sr(),new Z(`Invalid old pass type '${typeof e}'`);if(typeof t!="string")throw await sr(),new Z(`Invalid new pass type '${typeof t}'`);if(t.length<20)throw await sr(),new Z(`Invalid pass length ${t.length}`);this.log("recreating keychain");const n=ff.get(this);if(n==null)throw new Z("dek missing");const i=n.dek;this.init.pass=t;const s=t!=null&&((a=this.init.dek)==null?void 0:a.salt)!=null?Mk(t,this.init.dek.salt,(c=this.init.dek)==null?void 0:c.iterationCount,(l=this.init.dek)==null?void 0:l.keyLength,(d=this.init.dek)==null?void 0:d.hash):"";ff.set(this,{dek:s});const o=await this.listKeys();for(const h of o){const p=await this.components.datastore.get(Lc(h.name)),b=re(p),f=await OT(b,i),g=s.toString(),v=await NT(f,g,f.type==="RSA"?"pkcs-8":"libp2p-key"),y=this.components.datastore.batch(),w={name:h.name,id:h.id};y.put(Lc(h.name),se(v)),y.put(Au(h.name),se(JSON.stringify(w))),await y.commit()}this.log("keychain reconstructed")}}function YV(r={}){return e=>new k8e(e,r)}class JV{constructor(e={}){u(this,"memoryStorage");u(this,"points");u(this,"duration");u(this,"blockDuration");u(this,"execEvenly");u(this,"execEvenlyMinDelayMs");u(this,"keyPrefix");this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??this.duration*1e3/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new I8e}async consume(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n);let o=this.memoryStorage.incrby(i,t,s);if(o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.consumedPoints>this.points)throw this.blockDuration>0&&o.consumedPoints<=this.points+t&&(o=this.memoryStorage.set(i,o.consumedPoints,this.blockDuration)),new xne("Rate limit exceeded",o);if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let a=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));a<this.execEvenlyMinDelayMs&&(a=o.consumedPoints*this.execEvenlyMinDelayMs),await Pz(a)}return o}penalty(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n),o=this.memoryStorage.incrby(i,t,s);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}reward(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n),o=this.memoryStorage.incrby(i,-t,s);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}block(e,t){const n=t*1e3,i=this.points+1;return this.memoryStorage.set(this.getKey(e),i,t),{remainingPoints:0,msBeforeNext:n===0?-1:n,consumedPoints:i,isFirstInDuration:!1}}set(e,t,n=0){const i=(n>=0?n:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,n),{remainingPoints:0,msBeforeNext:i===0?-1:i,consumedPoints:t,isFirstInDuration:!1}}get(e){const t=this.memoryStorage.get(this.getKey(e));return t!=null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return(e==null?void 0:e.customDuration)!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}}class I8e{constructor(){u(this,"storage");this.storage=new Map}incrby(e,t,n){const i=this.storage.get(e);if(i!=null){const s=i.expiresAt!=null?i.expiresAt.getTime()-new Date().getTime():-1;return i.expiresAt==null||s>0?(i.value+=t,{remainingPoints:0,msBeforeNext:s,consumedPoints:i.value,isFirstInDuration:!1}):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){const i=n*1e3,s=this.storage.get(e);s!=null&&clearTimeout(s.timeoutId);const o={value:t,expiresAt:i>0?new Date(Date.now()+i):void 0};return this.storage.set(e,o),i>0&&(o.timeoutId=setTimeout(()=>{this.storage.delete(e)},i),o.timeoutId.unref!=null&&o.timeoutId.unref()),{remainingPoints:0,msBeforeNext:i===0?-1:i,consumedPoints:o.value,isFirstInDuration:!0}}get(e){const t=this.storage.get(e);if(t!=null)return{remainingPoints:0,msBeforeNext:t.expiresAt!=null?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){const t=this.storage.get(e);return t!=null?(t.timeoutId!=null&&clearTimeout(t.timeoutId),this.storage.delete(e),!0):!1}}var et;(function(r){r[r.NEW_STREAM=0]="NEW_STREAM",r[r.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",r[r.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",r[r.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",r[r.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",r[r.RESET_RECEIVER=5]="RESET_RECEIVER",r[r.RESET_INITIATOR=6]="RESET_INITIATOR"})(et||(et={}));const aS=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),BT=Object.freeze({NEW_STREAM:et.NEW_STREAM,MESSAGE:et.MESSAGE_INITIATOR,CLOSE:et.CLOSE_INITIATOR,RESET:et.RESET_INITIATOR}),_8e=Object.freeze({MESSAGE:et.MESSAGE_RECEIVER,CLOSE:et.CLOSE_RECEIVER,RESET:et.RESET_RECEIVER}),XV=1<<20,T8e=4<<20;let $8e=class{constructor(e=XV,t=T8e){u(this,"_buffer");u(this,"_headerInfo");u(this,"_maxMessageSize");u(this,"_maxUnprocessedMessageQueueSize");this._buffer=new Be,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw new pt("Unprocessed message queue size too large!");const t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(l){if(l.name==="InvalidMessageError")throw l;break}const{id:n,type:i,length:s,offset:o}=this._headerInfo;if(this._buffer.length-o<s)break;const c={id:n,type:i};(i===et.NEW_STREAM||i===et.MESSAGE_INITIATOR||i===et.MESSAGE_RECEIVER)&&(c.data=this._buffer.sublist(o,o+s)),t.push(c),this._buffer.consume(o+s),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:n}=MT(e),{value:i,offset:s}=MT(e,n),o=t&7;if(aS[o]==null)throw new Error(`Invalid type received: ${o}`);if(i>this._maxMessageSize)throw new pt("Message size too large");return{id:t>>3,type:o,offset:n+s,length:i}}};const P8e=128,LT=127;function MT(r,e=0){let t=0,n=0,i=e,s;const o=r.length;do{if(i>=o||n>49)throw e=0,new RangeError("Could not decode varint");s=r.get(i++),t+=n<28?(s&LT)<<n:(s&LT)*Math.pow(2,n),n+=7}while(s>=P8e);return e=i-e,{value:t,offset:e}}const J8=10*1024;let D8e=class{constructor(){u(this,"_pool");u(this,"_poolOffset");this._pool=zn(J8),this._poolOffset=0}write(e,t){const n=this._pool;let i=this._poolOffset;Hr(e.id<<3|e.type,n,i),i+=mt(e.id<<3|e.type),(e.type===et.NEW_STREAM||e.type===et.MESSAGE_INITIATOR||e.type===et.MESSAGE_RECEIVER)&&e.data!=null?(Hr(e.data.length,n,i),i+=mt(e.data.length)):(Hr(0,n,i),i+=mt(0));const s=n.subarray(this._poolOffset,i);J8-i<100?(this._pool=zn(J8),this._poolOffset=0):this._poolOffset=i,t.append(s),(e.type===et.NEW_STREAM||e.type===et.MESSAGE_INITIATOR||e.type===et.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}};const N8e=new D8e;async function*O8e(r){for await(const e of r){const t=new Be;N8e.write(e,t),yield t}}class R8e extends Error{constructor(e="Stream input buffer error"){super(e),this.name="StreamInputBufferError"}}class B8e extends Fx{constructor(t){super(t);u(this,"name");u(this,"streamId");u(this,"send");u(this,"types");u(this,"maxDataSize");this.types=t.direction==="outbound"?BT:_8e,this.send=t.send,this.name=t.name,this.streamId=t.streamId,this.maxDataSize=t.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:BT.NEW_STREAM,data:new Be(se(this.name))})}async sendData(t){for(t=t.sublist();t.byteLength>0;){const n=Math.min(t.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:t.sublist(0,n)}),t.consume(n)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}function L8e(r){const{id:e,name:t,send:n,onEnd:i,type:s="initiator",maxMsgSize:o=XV}=r;return new B8e({id:s==="initiator"?`i${e}`:`r${e}`,streamId:e,name:`${t??e}`,direction:s==="initiator"?"outbound":"inbound",maxDataSize:o,onEnd:i,send:n,log:r.logger.forComponent(`libp2p:mplex:stream:${s}:${e}`)})}const M8e=1024,U8e=1024,F8e=1024*1024*4,z8e=5,V8e=500;function UT(r){const e={...r,type:`${aS[r.type]} (${r.type})`};return r.type===et.NEW_STREAM&&(e.data=re(r.data instanceof Uint8Array?r.data:r.data.subarray())),(r.type===et.MESSAGE_INITIATOR||r.type===et.MESSAGE_RECEIVER)&&(e.data=re(r.data instanceof Uint8Array?r.data:r.data.subarray(),"base16")),e}class K8e{constructor(e,t){u(this,"protocol","/mplex/6.7.0");u(this,"sink");u(this,"source");u(this,"log");u(this,"_streamId");u(this,"_streams");u(this,"_init");u(this,"_source");u(this,"closeController");u(this,"rateLimiter");u(this,"closeTimeout");u(this,"logger");t=t??{},this.log=e.logger.forComponent("libp2p:mplex"),this.logger=e.logger,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=t,this.closeTimeout=t.closeTimeout??V8e,this.sink=this._createSink(),this._source=sh({objectMode:!0,onEnd:()=>{for(const n of this._streams.initiators.values())n.destroy();for(const n of this._streams.receivers.values())n.destroy()}}),this.source=Qi(this._source,n=>O8e(n)),this.closeController=new AbortController,this.rateLimiter=new JV({points:t.disconnectThreshold??z8e,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Vc("Muxer already closed");const t=this._streamId++;e=e==null?t.toString():e.toString();const n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}async close(e){if(this.closeController.signal.aborted)return;const t=(e==null?void 0:e.signal)??AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map(async n=>n.close({signal:t}))),this._source.end(),await this._source.onEmpty({signal:t}),this.closeController.abort()}catch(n){this.abort(n)}}abort(e){this.closeController.signal.aborted||(this.streams.forEach(t=>{t.abort(e)}),this.closeController.abort(e))}_newReceiverStream(e){const{id:t,name:n}=e,i=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:i})}_newStream(e){const{id:t,name:n,type:i,registry:s}=e;if(this.log("new %s stream %s",i,t),i==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??U8e))throw new _m("Too many outbound streams open");if(s.has(t))throw new Error(`${i} stream ${t} already exists!`);const c=L8e({id:t,name:n,send:async l=>{this.log.enabled&&this.log.trace("%s stream %s send",i,t,UT(l)),this._source.push(l)},type:i,onEnd:()=>{this.log("%s stream with id %s and protocol %s ended",i,t,c.protocol),s.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(c)},maxMsgSize:this._init.maxMsgSize,logger:this.logger});return s.set(t,c),c}_createSink(){return async t=>{const n=()=>{az(t,this.log)};this.closeController.signal.addEventListener("abort",n);try{const i=new $8e(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const s of t)for(const o of i.write(s))await this._handleIncoming(o);this._source.end()}catch(i){this.log("error in sink",i),this._source.end(i)}finally{this.closeController.signal.removeEventListener("abort",n)}}}async _handleIncoming(e){const{id:t,type:n}=e;if(this.log.enabled&&this.log.trace("incoming message",UT(e)),e.type===et.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??M8e)){this.log("too many inbound streams open"),this._source.push({id:t,type:et.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(new Error("Too many open streams"));return}return}const a=this._newReceiverStream({id:t,name:re(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(a);return}const s=((n&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(s==null){this.log("missing stream %s for message type %s",t,aS[n]);try{await this.rateLimiter.consume("missing-stream",1)}catch{this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(new Error("Too many messages for missing streams"));return}return}const o=this._init.maxStreamBufferSize??F8e;try{switch(n){case et.MESSAGE_INITIATOR:case et.MESSAGE_RECEIVER:if(s.sourceReadableLength()>o)throw this._source.push({id:e.id,type:n===et.MESSAGE_INITIATOR?et.RESET_RECEIVER:et.RESET_INITIATOR}),new R8e("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers");s.sourcePush(e.data);break;case et.CLOSE_INITIATOR:case et.CLOSE_RECEIVER:s.remoteCloseWrite();break;case et.RESET_INITIATOR:case et.RESET_RECEIVER:s.reset();break;default:this.log("unknown message type %s",n)}}catch(a){this.log.error("error while processing message",a),s.abort(a)}}}var UD,FD;FD=Symbol.toStringTag,UD=fr;class j8e{constructor(e,t={}){u(this,"protocol","/mplex/6.7.0");u(this,"_init");u(this,"components");u(this,FD,"@libp2p/mplex");u(this,UD,["@libp2p/stream-multiplexing"]);this.components=e,this._init=t}createStreamMuxer(e={}){return new K8e(this.components,{...e,...this._init})}}function H8e(r={}){return e=>new j8e(e,r)}const X8=32,q8e="1.0.0",W8e="ping",G8e="ipfs",Q8e=1e4,Y8e=2,J8e=1;var zD,VD;VD=Symbol.toStringTag,zD=fr;class X8e{constructor(e,t={}){u(this,"protocol");u(this,"components");u(this,"started");u(this,"timeout");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"runOnLimitedConnection");u(this,"log");u(this,VD,"@libp2p/ping");u(this,zD,["@libp2p/ping"]);this.components=e,this.log=e.logger.forComponent("libp2p:ping"),this.started=!1,this.protocol=`/${t.protocolPrefix??G8e}/${W8e}/${q8e}`,this.timeout=t.timeout??Q8e,this.maxInboundStreams=t.maxInboundStreams??Y8e,this.maxOutboundStreams=t.maxOutboundStreams??J8e,this.runOnLimitedConnection=t.runOnLimitedConnection??!0,this.handleMessage=this.handleMessage.bind(this)}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){this.log("incoming ping from %p",e.connection.remotePeer);const{stream:t}=e,n=Date.now(),i=By(t);let s=!1;Promise.resolve().then(async()=>{for(;;){const o=AbortSignal.timeout(this.timeout);o.addEventListener("abort",()=>{t==null||t.abort(new m0("ping timeout"))});const a=await i.read({bytes:X8,signal:o});await i.write(a,{signal:o}),s=!0}}).catch(o=>{s&&o.name==="UnexpectedEOFError"&&t.readStatus!=="ready"||(this.log.error("incoming ping from %p failed with error - %e",e.connection.remotePeer,o),t==null||t.abort(o))}).finally(()=>{const o=Date.now()-n;this.log("incoming ping from %p complete in %dms",e.connection.remotePeer,o);const a=AbortSignal.timeout(this.timeout);t.close({signal:a}).catch(c=>{this.log.error("error closing ping stream from %p - %e",e.connection.remotePeer,c),t==null||t.abort(c)})})}async ping(e,t={}){this.log("pinging %p",e);const n=Date.now(),i=Il(X8),s=await this.components.connectionManager.openConnection(e,t);let o;if(t.signal==null){const a=AbortSignal.timeout(this.timeout);t={...t,signal:a}}try{o=await s.newStream(this.protocol,{...t,runOnLimitedConnection:this.runOnLimitedConnection});const a=By(o),[,c]=await Promise.all([a.write(i,t),a.read({...t,bytes:X8})]),l=Date.now()-n;if(!Fe(i,c.subarray()))throw new UB(`Received wrong ping ack after ${l}ms`);return this.log("ping %p complete in %dms",s.remotePeer,l),l}catch(a){throw this.log.error("error while pinging %p",s.remotePeer,a),o==null||o.abort(a),a}finally{o!=null&&await o.close(t)}}}function Z8e(r={}){return e=>new X8e(e,r)}var un;(function(r){(function(n){n.FIN="FIN",n.STOP_SENDING="STOP_SENDING",n.RESET="RESET",n.FIN_ACK="FIN_ACK"})(r.Flag||(r.Flag={}));let e;(function(n){n[n.FIN=0]="FIN",n[n.STOP_SENDING=1]="STOP_SENDING",n[n.RESET=2]="RESET",n[n.FIN_ACK=3]="FIN_ACK"})(e||(e={})),function(n){n.codec=()=>En(e)}(r.Flag||(r.Flag={}));let t;r.codec=()=>(t==null&&(t=Ke((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.flag!=null&&(i.uint32(8),r.Flag.codec().encode(n.flag,i)),n.message!=null&&(i.uint32(18),i.bytes(n.message)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.flag=r.Flag.codec().decode(n);break}case 2:{o.message=n.bytes();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>Ve(n,r.codec()),r.decode=(n,i)=>ze(n,r.codec(),i)})(un||(un={}));const e5e=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],FT=Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),t5e="libp2p+webrtc+v1/",r5e=466,n5e=2*1024*1024,i5e=30*1e3,O4=16*1024;function s5e(r=O4){const e=mt(r-mt(r)),t=1+mt(Object.keys(un.Flag).length-1),n=1,i=r-e-t-n,s=mt(i);return e+t+n+s}const o5e=s5e(),a5e=5e3,c5e=5e3,l5e=3e4,ZV="/webrtc",kb="/webrtc-signaling/0.0.1",u5e="/libp2p/webrtc-direct/certificate",d5e="webrtc-direct-certificate-private-key",h5e=12096e5,zT=864e5;var VT=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||Array.prototype.slice.call(e))},f5e=function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r}(),p5e=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}(),g5e=function(){function r(e,t,n,i){this.name=e,this.version=t,this.os=n,this.bot=i,this.type="bot-device"}return r}(),y5e=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),m5e=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),w5e=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,b5e=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,KT=3,v5e=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",w5e]],jT=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function E5e(r){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new m5e:typeof navigator<"u"?S5e(navigator.userAgent):C5e()}function x5e(r){return r!==""&&v5e.reduce(function(e,t){var n=t[0],i=t[1];if(e)return e;var s=i.exec(r);return!!s&&[n,s]},!1)}function S5e(r){var e=x5e(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new y5e;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<KT&&(i=VT(VT([],i,!0),k5e(KT-i.length),!0)):i=[];var s=i.join("."),o=A5e(r),a=b5e.exec(r);return a&&a[1]?new g5e(t,s,o,a[1]):new f5e(t,s,o)}function A5e(r){for(var e=0,t=jT.length;e<t;e++){var n=jT[e],i=n[0],s=n[1],o=s.exec(r);if(o)return i}return null}function C5e(){var r=typeof process<"u"&&process.version;return r?new p5e(process.version.slice(1)):null}function k5e(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}const HT=E5e(),cS=HT!=null&&HT.name==="firefox",eK=async function*(){},tK=async r=>{};function I5e(r,e,t=l5e,n){r.readyState==="open"&&Promise.resolve().then(async()=>{if(r.bufferedAmount>0){n.log("%s drain channel with %d buffered bytes",e,r.bufferedAmount);const i=De();let s=!1;r.bufferedAmountLowThreshold=0;const o=()=>{s||(n.log("%s drain channel closed before drain",e),i.resolve())};r.addEventListener("close",o,{once:!0}),r.addEventListener("bufferedamountlow",()=>{s=!0,r.removeEventListener("close",o),i.resolve()}),await l0(i.promise,{milliseconds:t})}}).then(async()=>{r.readyState==="open"&&r.close()}).catch(i=>{n.log.error("error closing outbound stream",i)})}async function qT(r){return r=r??{},typeof r=="function"&&(r=await r()),r.iceServers=r.iceServers??e5e.map(e=>({urls:[e]})),r}const _5e=(r=32)=>t5e+[...Array(r)].map(()=>FT.at(Math.floor(Math.random()*FT.length))).join("");class Ib{constructor(e,t){u(this,"log");u(this,"peerConnection");u(this,"remoteAddr");u(this,"timeline");u(this,"metrics");u(this,"source",eK());u(this,"sink",tK);this.log=e.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=t.remoteAddr,this.timeline=t.timeline,this.peerConnection=t.peerConnection;const n=this.peerConnection,i=n.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",n.connectionState,"initial state",i),(n.connectionState==="disconnected"||n.connectionState==="failed"||n.connectionState==="closed")&&(this.timeline.close=Date.now())}}async close(e){var t;this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),(t=this.metrics)==null||t.increment({close:!0})}abort(e){var t;this.log.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),(t=this.metrics)==null||t.increment({abort:!0})}}class T5e extends Fx{constructor(t){const n=t.onEnd;t.onEnd=s=>{this.log.trace('readable and writeable ends closed with status "%s"',this.status),Promise.resolve(async()=>{if(!(this.timeline.abort!=null||this.timeline.reset!==null))try{await l0(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(o){this.log.error("error receiving FIN_ACK",o)}}).then(()=>{this.incomingData.end(),n==null||n(s)}).catch(o=>{this.log.error("error ending stream",o)}).finally(()=>{this.channel.close()})};super(t);u(this,"channel");u(this,"incomingData");u(this,"maxBufferedAmount");u(this,"bufferedAmountLowEventTimeout");u(this,"maxMessageSize");u(this,"receiveFinAck");u(this,"finAckTimeout");u(this,"openTimeout");u(this,"closeController");switch(this.channel=t.channel,this.channel.binaryType="arraybuffer",this.incomingData=sh(),this.bufferedAmountLowEventTimeout=t.bufferedAmountLowEventTimeout??i5e,this.maxBufferedAmount=t.maxBufferedAmount??n5e,this.maxMessageSize=(t.maxMessageSize??O4)-o5e,this.receiveFinAck=De(),this.finAckTimeout=t.closeTimeout??a5e,this.openTimeout=t.openTimeout??c5e,this.closeController=new AbortController,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(this.timeline.close===void 0||this.timeline.close===0)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new Ng("Unknown datachannel state")}this.channel.onopen=s=>{this.timeline.open=new Date().getTime()},this.channel.onclose=s=>{this.log.trace("received onclose event"),this.closeController.abort(),this.receiveFinAck.resolve(),this.close().catch(o=>{this.log.error("error closing stream after channel closed",o)})},this.channel.onerror=s=>{this.log.trace("received onerror event"),this.closeController.abort();const o=s.error;this.abort(o)},this.channel.onmessage=async s=>{const{data:o}=s;o===null||o.byteLength===0||this.incomingData.push(new Uint8Array(o,0,o.byteLength))};const i=this;Promise.resolve().then(async()=>{for await(const s of Td(this.incomingData)){const o=i.processIncomingProtobuf(s);o!=null&&i.sourcePush(new Be(o))}}).catch(s=>{this.log.error("error processing incoming data channel messages",s)})}sendNewStream(){}async _sendMessage(t,n=!0){if(this.channel.readyState==="closed"||this.channel.readyState==="closing")throw new Ng(`Invalid datachannel state - ${this.channel.readyState}`);if(this.channel.readyState!=="open"){const i=AbortSignal.timeout(this.openTimeout),s=ct([this.closeController.signal,i]);try{this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await di(this.channel,"open",s)}finally{s.clear()}this.log('channel state is now "%s", sending data',this.channel.readyState)}if(n&&this.channel.bufferedAmount>this.maxBufferedAmount){const i=AbortSignal.timeout(this.bufferedAmountLowEventTimeout),s=ct([this.closeController.signal,i]);try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await di(this.channel,"bufferedamountlow",s)}catch(o){throw i.aborted?new m0(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`):o}finally{s.clear()}}try{this.log.trace('sending message, channel state "%s"',this.channel.readyState),this.channel.send(t.subarray())}catch(i){this.log.error("error while sending message",i)}}async sendData(t){const n=t.byteLength;for(t=t.sublist();t.byteLength>0;){const i=Math.min(t.byteLength,this.maxMessageSize),s=t.subarray(0,i),o=un.encode({message:s}),a=_d.single(o);this.log.trace("sending %d/%d bytes on channel",s.byteLength,n),await this._sendMessage(a),t.consume(i)}this.log.trace('finished sending data, channel state "%s"',this.channel.readyState)}async sendReset(){try{await this._sendFlag(un.Flag.RESET)}catch(t){this.log.error("failed to send reset - %e",t)}finally{this.channel.close()}}async sendCloseWrite(t){if(this.channel.readyState!=="open"){this.receiveFinAck.resolve();return}if(await this._sendFlag(un.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await Zr(this.receiveFinAck.promise,t==null?void 0:t.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorName:"FinAckNotReceivedError"})}catch(i){this.log.error("failed to await FIN_ACK",i)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){this.channel.readyState==="open"&&await this._sendFlag(un.Flag.STOP_SENDING)}processIncomingProtobuf(t){const n=un.decode(t);if(n.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',n.flag,this.writeStatus,this.readStatus),n.flag===un.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(un.Flag.FIN_ACK).catch(i=>{this.log.error("error sending FIN_ACK immediately",i)})),n.flag===un.Flag.RESET&&this.reset(),n.flag===un.Flag.STOP_SENDING&&this.remoteCloseRead(),n.flag===un.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),this.readStatus==="ready")return n.message}async _sendFlag(t){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',t.toString(),this.channel.readyState),!1;this.log.trace("sending flag %s",t.toString());const n=un.encode({flag:t}),i=_d.single(n);try{return await this._sendMessage(i,!1),!0}catch(s){this.log.error("could not send flag %s - %e",t.toString(),s)}return!1}}function n3(r){const{channel:e,direction:t,handshake:n}=r;return new T5e({id:`${e.id}`,log:r.logger.forComponent(`libp2p:webrtc:stream:${n===!0?"handshake":t}:${e.id}`),...r})}class lS{constructor(e,t){u(this,"protocol");u(this,"peerConnection");u(this,"bufferedStreams",[]);u(this,"metrics");u(this,"dataChannelOptions");u(this,"components");u(this,"log");this.components=e,this.peerConnection=t.peerConnection,this.metrics=t.metrics,this.protocol=t.protocol??ZV,this.dataChannelOptions=t.dataChannelOptions??{},this.log=e.logger.forComponent("libp2p:webrtc:muxerfactory"),this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',n.id),n.label==="init"){this.log.trace("closing early init channel"),n.close();return}const i={},s=n3({channel:n,direction:"inbound",onEnd:o=>{i.onEnd(o)},logger:e.logger,...this.dataChannelOptions});i.stream=s,i.channel=n,i.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(o=>o.stream.id!==s.id)},this.bufferedStreams.push(i)}}createStreamMuxer(e){return new $5e(this.components,{...e,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}}var hd,z2;class $5e{constructor(e,t){qe(this,hd);u(this,"init");u(this,"streams");u(this,"protocol");u(this,"log");u(this,"peerConnection");u(this,"dataChannelOptions");u(this,"metrics");u(this,"logger");u(this,"source",eK());u(this,"sink",tK);this.init=t,this.log=e.logger.forComponent("libp2p:webrtc:muxer"),this.logger=e.logger,this.streams=t.streams.map(n=>n.stream),this.peerConnection=t.peerConnection,this.protocol=t.protocol??ZV,this.metrics=t.metrics,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:n})=>{var o,a;if(this.log.trace("incoming datachannel with channel id %d",n.id),n.label==="init"){this.log.trace("closing init channel"),n.close();return}const i=n.id,s=n3({channel:n,direction:"inbound",onEnd:()=>{Ae(this,hd,z2).call(this,s,n),this.log("incoming channel %s ended",i)},logger:this.logger,...this.dataChannelOptions});this.streams.push(s),(o=this.metrics)==null||o.increment({incoming_stream:!0}),(a=t==null?void 0:t.onIncomingStream)==null||a.call(t,s)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(n=>{var i,s,o;n.onEnd=()=>{this.log("incoming early channel %s ended with state %s",n.channel.id,n.channel.readyState),Ae(this,hd,z2).call(this,n.stream,n.channel)},(i=this.metrics)==null||i.increment({incoming_stream:!0}),(o=(s=this.init)==null?void 0:s.onIncomingStream)==null||o.call(s,n.stream)})})}async close(e){try{await Promise.all(this.streams.map(async t=>t.close(e)))}catch(t){this.abort(t)}}abort(e){for(const t of this.streams)t.abort(e)}newStream(){var i;const e=this.peerConnection.createDataChannel(""),t=e.id;this.log.trace("opened outgoing datachannel with channel id %s",t);const n=n3({channel:e,direction:"outbound",onEnd:()=>{Ae(this,hd,z2).call(this,n,e),this.log("outgoing channel %s ended",t)},logger:this.logger,...this.dataChannelOptions});return this.streams.push(n),(i=this.metrics)==null||i.increment({outgoing_stream:!0}),n}}hd=new WeakSet,z2=function(e,t){var n,i,s;this.log.trace("stream %s %s %s onEnd",e.direction,e.id,e.protocol),I5e(t,`${e.direction} ${e.id} ${e.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(o=>o.id!==e.id),(n=this.metrics)==null||n.increment({stream_end:!0}),(s=(i=this.init)==null?void 0:i.onStreamEnd)==null||s.call(i,e)};const rK=globalThis.RTCPeerConnection,nK=globalThis.RTCSessionDescription,P5e=globalThis.RTCIceCandidate;class D0 extends Error{constructor(e){super(`WebRTC transport error: ${e}`),this.name="WebRTCTransportError"}}class Da extends D0{constructor(e="SDP handshake failed"){super(e),this.name="SDPHandshakeFailedError"}}class D5e extends D0{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`),this.name="WebRTC/InvalidFingerprintError"}}class N5e extends D0{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}}class O5e extends D0{constructor(e){super(`unsupported hash algorithm code: ${e} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}}var zi;(function(r){(function(n){n.SDP_OFFER="SDP_OFFER",n.SDP_ANSWER="SDP_ANSWER",n.ICE_CANDIDATE="ICE_CANDIDATE"})(r.Type||(r.Type={}));let e;(function(n){n[n.SDP_OFFER=0]="SDP_OFFER",n[n.SDP_ANSWER=1]="SDP_ANSWER",n[n.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(e||(e={})),function(n){n.codec=()=>En(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=Ke((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.data!=null&&(i.uint32(18),i.string(n.data)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.data=n.string();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>Ve(n,r.codec()),r.decode=(n,i)=>ze(n,r.codec(),i)})(zi||(zi={}));const iK=async(r,e,t)=>{var n,i,s,o;try{const a=De();for(R5e(r,a);;){const c=await Promise.race([a.promise,e.read({signal:t.signal}).catch(()=>{})]);if(c==null){(n=t.signal)==null||n.throwIfAborted();break}if(c.type!==zi.Type.ICE_CANDIDATE)throw new pt("ICE candidate message expected");const l=JSON.parse(c.data??"null");if(l===""||l===null){(i=t.onProgress)==null||i.call(t,new ke("webrtc:end-of-ice-candidates")),t.log.trace("end-of-candidates received");continue}const d=new P5e(l);t.log.trace("%s received new ICE candidate %o",t.direction,l);try{(s=t.onProgress)==null||s.call(t,new ke("webrtc:add-ice-candidate",d.candidate)),await r.addIceCandidate(d)}catch(h){t.log.error("%s bad candidate received",t.direction,l,h)}}}catch(a){if(t.log.error("%s error parsing ICE candidate",t.direction,a),((o=t.signal)==null?void 0:o.aborted)===!0&&uS(r)!=="connected")throw a}};function uS(r){return cS?r.iceConnectionState:r.connectionState}function R5e(r,e){r[cS?"oniceconnectionstatechange":"onconnectionstatechange"]=t=>{switch(uS(r)){case"connected":e.resolve();break;case"failed":case"disconnected":case"closed":e.reject(new SE("RTCPeerConnection was closed"));break}}}async function B5e({rtcConfiguration:r,dataChannel:e,signal:t,metrics:n,multiaddr:i,connectionManager:s,transportManager:o,log:a,logger:c,onProgress:l}){const{baseAddr:d}=U5e(i);n==null||n.dialerEvents.increment({open:!0}),a.trace("dialing base address: %a",d);const h=d.getPeerId();if(h==null)throw new Z("Relay peer was missing");const p=s.getConnections(xn(h));let b,f=!1;p.length===0?(l==null||l(new ke("webrtc:dial-relay")),b=await o.dial(d,{signal:t,onProgress:l}),f=!0):(l==null||l(new ke("webrtc:reuse-relay-connection")),b=p[0]);try{l==null||l(new ke("webrtc:open-signaling-stream"));const g=await b.newStream(kb,{signal:t,runOnLimitedConnection:!0}),v=Vn(g).pb(zi),y=new rK(r),w=new lS({logger:c},{peerConnection:y,dataChannelOptions:e});try{const m=y.createDataChannel("init");y.onicecandidate=({candidate:A})=>{const I=JSON.stringify((A==null?void 0:A.toJSON())??null);a.trace("initiator sending ICE candidate %o",A),v.write({type:zi.Type.ICE_CANDIDATE,data:I},{signal:t}).catch(D=>{a.error("error sending ICE candidate",D)})},y.onicecandidateerror=A=>{a.error("initiator ICE candidate error",A)};const E=await y.createOffer().catch(A=>{throw a.error("could not execute createOffer",A),new Da("Failed to set createOffer")});a.trace("initiator send SDP offer %s",E.sdp),l==null||l(new ke("webrtc:send-sdp-offer")),await v.write({type:zi.Type.SDP_OFFER,data:E.sdp},{signal:t}),await y.setLocalDescription(E).catch(A=>{throw a.error("could not execute setLocalDescription",A),new Da("Failed to set localDescription")}),l==null||l(new ke("webrtc:read-sdp-answer")),a.trace("initiator read SDP answer");const C=await v.read({signal:t});if(C.type!==zi.Type.SDP_ANSWER)throw new Da("Remote should send an SDP answer");a.trace("initiator received SDP answer %s",C.data);const k=new nK({type:"answer",sdp:C.data});return await y.setRemoteDescription(k).catch(A=>{throw a.error("could not execute setRemoteDescription",A),new Da("Failed to set remoteDescription")}),a.trace("initiator read candidates until connected"),l==null||l(new ke("webrtc:read-ice-candidates")),await iK(y,v,{direction:"initiator",signal:t,log:a,onProgress:l}),a.trace("initiator connected, closing init channel"),m.close(),l==null||l(new ke("webrtc:close-signaling-stream")),a.trace("closing signaling channel"),await g.close({signal:t}),a.trace("initiator connected to remote address %s",i),{remoteAddress:i,peerConnection:y,muxerFactory:w}}catch(m){throw a.error("outgoing signaling error",m),y.close(),g.abort(m),m}finally{y.onicecandidate=null,y.onicecandidateerror=null}}finally{if(f)try{await b.close({signal:t})}catch(g){b.abort(g)}}}const WT=wt(HU.matchers[0],Ge("p2p-circuit"));class dS extends Gt{constructor(t,n){super();u(this,"transportManager");u(this,"shutdownController");u(this,"events");this.transportManager=t.transportManager,this.events=t.events,this.shutdownController=n.shutdownController,this.onTransportListening=this.onTransportListening.bind(this)}async listen(){this.events.addEventListener("transport:listening",this.onTransportListening)}onTransportListening(t){t.detail.getAddrs().filter(i=>WT.exactMatch(i)).map(i=>i.encapsulate("/webrtc")).length>0&&this.safeDispatchEvent("listening")}getAddrs(){return this.transportManager.getListeners().filter(t=>!(t instanceof dS)).map(t=>t.getAddrs().filter(n=>WT.exactMatch(n)).map(n=>n.encapsulate("/webrtc"))).flat()}updateAnnounceAddrs(){}async close(){this.events.removeEventListener("transport:listening",this.onTransportListening),this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})}}async function L5e({peerConnection:r,stream:e,signal:t,connection:n,log:i}){i.trace("new inbound signaling stream");const s=Vn(e).pb(zi);try{r.onicecandidate=({candidate:d})=>{const h=JSON.stringify((d==null?void 0:d.toJSON())??null);i.trace("recipient sending ICE candidate %s",h),s.write({type:zi.Type.ICE_CANDIDATE,data:h},{signal:t}).catch(p=>{i.error("error sending ICE candidate",p)})},i.trace("recipient read SDP offer");const a=await s.read({signal:t});if(a.type!==zi.Type.SDP_OFFER)throw new Da(`expected message type SDP_OFFER, received: ${a.type??"undefined"} `);i.trace("recipient received SDP offer %s",a.data);const c=new nK({type:"offer",sdp:a.data});await r.setRemoteDescription(c).catch(d=>{throw i.error("could not execute setRemoteDescription",d),new Da("Failed to set remoteDescription")});const l=await r.createAnswer().catch(d=>{throw i.error("could not execute createAnswer",d),new Da("Failed to create answer")});i.trace("recipient send SDP answer %s",l.sdp),await s.write({type:zi.Type.SDP_ANSWER,data:l.sdp},{signal:t}),await r.setLocalDescription(l).catch(d=>{throw i.error("could not execute setLocalDescription",d),new Da("Failed to set localDescription")}),i.trace("recipient read candidates until connected"),await iK(r,s,{direction:"recipient",signal:t,log:i})}catch(a){if(uS(r)!=="connected")throw i.error("error while handling signaling stream from peer %a",n.remoteAddr,a),r.close(),a;i("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",n.remoteAddr,a)}const o=Te(`/webrtc/p2p/${n.remoteAddr.getPeerId()}`);return i.trace("recipient connected to remote address %s",o),{remoteAddress:o}}var KD,jD,HD,qD;qD=Cm,HD=Symbol.toStringTag,jD=fr,KD=Cl;class M5e{constructor(e,t={}){u(this,"components");u(this,"init");u(this,"log");u(this,"_started",!1);u(this,"metrics");u(this,"shutdownController");u(this,qD,!0);u(this,HD,"@libp2p/webrtc");u(this,jD,["@libp2p/transport"]);u(this,KD,["@libp2p/identify","@libp2p/circuit-relay-v2-transport"]);this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}isStarted(){return this._started}async start(){await this.components.registrar.handle(kb,e=>{const t=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);this._onProtocol(e,t).catch(n=>{this.log.error("failed to handle incoming connect from %p",e.connection.remotePeer,n)}).finally(()=>{t.clear()})},{runOnLimitedConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(kb),this._started=!1}createListener(e){return new dS(this.components,{shutdownController:this.shutdownController})}listenFilter(e){return e.filter(_7.exactMatch)}dialFilter(e){return this.listenFilter(e)}async dial(e,t){var c;this.log.trace("dialing address: %a",e);const{remoteAddress:n,peerConnection:i,muxerFactory:s}=await B5e({rtcConfiguration:await qT(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:t.onProgress}),o=new Ib(this.components,{peerConnection:i,timeline:{open:Date.now()},remoteAddr:n,metrics:(c=this.metrics)==null?void 0:c.dialerEvents}),a=await t.upgrader.upgradeOutbound(o,{skipProtection:!0,skipEncryption:!0,muxerFactory:s,onProgress:t.onProgress,signal:t.signal});return this._closeOnShutdown(i,o),a}async _onProtocol({connection:e,stream:t},n){var o;const i=new rK(await qT(this.init.rtcConfiguration)),s=new lS(this.components,{peerConnection:i,dataChannelOptions:this.init.dataChannel});try{const{remoteAddress:a}=await L5e({peerConnection:i,connection:e,stream:t,signal:n,log:this.log});await t.close({signal:n});const c=new Ib(this.components,{peerConnection:i,timeline:{open:new Date().getTime()},remoteAddr:a,metrics:(o=this.metrics)==null?void 0:o.listenerEvents});await this.components.upgrader.upgradeInbound(c,{skipEncryption:!0,skipProtection:!0,muxerFactory:s,signal:n}),this._closeOnShutdown(i,c)}catch(a){throw this.log.error("incoming signaling error",a),i.close(),t.abort(a),a}}_closeOnShutdown(e,t){const n=()=>{t.close().catch(i=>{this.log.error("could not close WebRTCMultiaddrConnection",i)})};this.shutdownController.signal.addEventListener("abort",n),e.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",n)})}}function U5e(r){const e=r.toString().split("/webrtc/");if(e.length!==2)throw new Z("webrtc protocol was not present in multiaddr");if(!e[0].includes("/p2p-circuit"))throw new Z("p2p-circuit protocol was not present in multiaddr");let t=Te(e[0]);const i=Te("/"+e[1]).getPeerId();if(i==null)throw new Z("destination peer id was missing");const s=t.protos().pop();if(s===void 0)throw new Z("invalid multiaddr");return s.name!=="p2p"&&(t=t.encapsulate(`/p2p/${i}`)),{baseAddr:t,peerId:xn(i)}}/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var GT;(function(r){(function(e){var t=typeof globalThis=="object"?globalThis:typeof Jf=="object"?Jf:typeof self=="object"?self:typeof this=="object"?this:a(),n=i(r);typeof t.Reflect<"u"&&(n=i(t.Reflect,n)),e(n,t),typeof t.Reflect>"u"&&(t.Reflect=r);function i(c,l){return function(d,h){Object.defineProperty(c,d,{configurable:!0,writable:!0,value:h}),l&&l(d,h)}}function s(){try{return Function("return this;")()}catch{}}function o(){try{return(0,eval)("(function() { return this; })()")}catch{}}function a(){return s()||o()}})(function(e,t){var n=Object.prototype.hasOwnProperty,i=typeof Symbol=="function",s=i&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=i&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",c={__proto__:[]}instanceof Array,l=!a&&!c,d={create:a?function(){return O(Object.create(null))}:c?function(){return O({__proto__:null})}:function(){return O({})},has:l?function(T,N){return n.call(T,N)}:function(T,N){return N in T},get:l?function(T,N){return n.call(T,N)?T[N]:void 0}:function(T,N){return T[N]}},h=Object.getPrototypeOf(Function),p=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:$(),b=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:x(),f=typeof WeakMap=="function"?WeakMap:S(),g=i?Symbol.for("@reflect-metadata:registry"):void 0,v=Th(),y=fw(v);function w(T,N,B,J){if(K(B)){if(!St(T))throw new TypeError;if(!_t(N))throw new TypeError;return U(T,N)}else{if(!St(T))throw new TypeError;if(!de(N))throw new TypeError;if(!de(J)&&!K(J)&&!ce(J))throw new TypeError;return ce(J)&&(J=void 0),B=it(B),Y(T,N,B,J)}}e("decorate",w);function m(T,N){function B(J,he){if(!de(J))throw new TypeError;if(!K(he)&&!Yt(he))throw new TypeError;R(T,N,J,he)}return B}e("metadata",m);function E(T,N,B,J){if(!de(B))throw new TypeError;return K(J)||(J=it(J)),R(T,N,B,J)}e("defineMetadata",E);function C(T,N,B){if(!de(N))throw new TypeError;return K(B)||(B=it(B)),j(T,N,B)}e("hasMetadata",C);function k(T,N,B){if(!de(N))throw new TypeError;return K(B)||(B=it(B)),H(T,N,B)}e("hasOwnMetadata",k);function A(T,N,B){if(!de(N))throw new TypeError;return K(B)||(B=it(B)),G(T,N,B)}e("getMetadata",A);function I(T,N,B){if(!de(N))throw new TypeError;return K(B)||(B=it(B)),V(T,N,B)}e("getOwnMetadata",I);function D(T,N){if(!de(T))throw new TypeError;return K(N)||(N=it(N)),L(T,N)}e("getMetadataKeys",D);function F(T,N){if(!de(T))throw new TypeError;return K(N)||(N=it(N)),q(T,N)}e("getOwnMetadataKeys",F);function W(T,N,B){if(!de(N))throw new TypeError;if(K(B)||(B=it(B)),!de(N))throw new TypeError;K(B)||(B=it(B));var J=kc(N,B,!1);return K(J)?!1:J.OrdinaryDeleteMetadata(T,N,B)}e("deleteMetadata",W);function U(T,N){for(var B=T.length-1;B>=0;--B){var J=T[B],he=J(N);if(!K(he)&&!ce(he)){if(!_t(he))throw new TypeError;N=he}}return N}function Y(T,N,B,J){for(var he=T.length-1;he>=0;--he){var _e=T[he],Oe=_e(N,B,J);if(!K(Oe)&&!ce(Oe)){if(!de(Oe))throw new TypeError;J=Oe}}return J}function j(T,N,B){var J=H(T,N,B);if(J)return!0;var he=jo(N);return ce(he)?!1:j(T,he,B)}function H(T,N,B){var J=kc(N,B,!1);return K(J)?!1:Pe(J.OrdinaryHasOwnMetadata(T,N,B))}function G(T,N,B){var J=H(T,N,B);if(J)return V(T,N,B);var he=jo(N);if(!ce(he))return G(T,he,B)}function V(T,N,B){var J=kc(N,B,!1);if(!K(J))return J.OrdinaryGetOwnMetadata(T,N,B)}function R(T,N,B,J){var he=kc(B,J,!0);he.OrdinaryDefineOwnMetadata(T,N,B,J)}function L(T,N){var B=q(T,N),J=jo(T);if(J===null)return B;var he=L(J,N);if(he.length<=0)return B;if(B.length<=0)return he;for(var _e=new b,Oe=[],ve=0,fe=B;ve<fe.length;ve++){var we=fe[ve],xe=_e.has(we);xe||(_e.add(we),Oe.push(we))}for(var Se=0,He=he;Se<He.length;Se++){var we=He[Se],xe=_e.has(we);xe||(_e.add(we),Oe.push(we))}return Oe}function q(T,N){var B=kc(T,N,!1);return B?B.OrdinaryOwnMetadataKeys(T,N):[]}function Q(T){if(T===null)return 1;switch(typeof T){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return T===null?1:6;default:return 6}}function K(T){return T===void 0}function ce(T){return T===null}function me(T){return typeof T=="symbol"}function de(T){return typeof T=="object"?T!==null:typeof T=="function"}function ue(T,N){switch(Q(T)){case 0:return T;case 1:return T;case 2:return T;case 3:return T;case 4:return T;case 5:return T}var B="string",J=Ac(T,s);if(J!==void 0){var he=J.call(T,B);if(de(he))throw new TypeError;return he}return $e(T)}function $e(T,N){var B,J,he;{var _e=T.toString;if(At(_e)){var J=_e.call(T);if(!de(J))return J}var B=T.valueOf;if(At(B)){var J=B.call(T);if(!de(J))return J}}throw new TypeError}function Pe(T){return!!T}function Je(T){return""+T}function it(T){var N=ue(T);return me(N)?N:Je(N)}function St(T){return Array.isArray?Array.isArray(T):T instanceof Object?T instanceof Array:Object.prototype.toString.call(T)==="[object Array]"}function At(T){return typeof T=="function"}function _t(T){return typeof T=="function"}function Yt(T){switch(Q(T)){case 3:return!0;case 4:return!0;default:return!1}}function Wr(T,N){return T===N||T!==T&&N!==N}function Ac(T,N){var B=T[N];if(B!=null){if(!At(B))throw new TypeError;return B}}function Ko(T){var N=Ac(T,o);if(!At(N))throw new TypeError;var B=N.call(T);if(!de(B))throw new TypeError;return B}function ou(T){return T.value}function au(T){var N=T.next();return N.done?!1:N}function Cc(T){var N=T.return;N&&N.call(T)}function jo(T){var N=Object.getPrototypeOf(T);if(typeof T!="function"||T===h||N!==h)return N;var B=T.prototype,J=B&&Object.getPrototypeOf(B);if(J==null||J===Object.prototype)return N;var he=J.constructor;return typeof he!="function"||he===T?N:he}function Xn(){var T;!K(g)&&typeof t.Reflect<"u"&&!(g in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&(T=rs(t.Reflect));var N,B,J,he=new f,_e={registerProvider:Oe,getProvider:fe,setProvider:xe};return _e;function Oe(Se){if(!Object.isExtensible(_e))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case T===Se:break;case K(N):N=Se;break;case N===Se:break;case K(B):B=Se;break;case B===Se:break;default:J===void 0&&(J=new b),J.add(Se);break}}function ve(Se,He){if(!K(N)){if(N.isProviderFor(Se,He))return N;if(!K(B)){if(B.isProviderFor(Se,He))return N;if(!K(J))for(var bt=Ko(J);;){var Mt=au(bt);if(!Mt)return;var Ci=ou(Mt);if(Ci.isProviderFor(Se,He))return Cc(bt),Ci}}}if(!K(T)&&T.isProviderFor(Se,He))return T}function fe(Se,He){var bt=he.get(Se),Mt;return K(bt)||(Mt=bt.get(He)),K(Mt)&&(Mt=ve(Se,He),K(Mt)||(K(bt)&&(bt=new p,he.set(Se,bt)),bt.set(He,Mt))),Mt}function we(Se){if(K(Se))throw new TypeError;return N===Se||B===Se||!K(J)&&J.has(Se)}function xe(Se,He,bt){if(!we(bt))throw new Error("Metadata provider not registered.");var Mt=fe(Se,He);if(Mt!==bt){if(!K(Mt))return!1;var Ci=he.get(Se);K(Ci)&&(Ci=new p,he.set(Se,Ci)),Ci.set(He,bt)}return!0}}function Th(){var T;return!K(g)&&de(t.Reflect)&&Object.isExtensible(t.Reflect)&&(T=t.Reflect[g]),K(T)&&(T=Xn()),!K(g)&&de(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,g,{enumerable:!1,configurable:!1,writable:!1,value:T}),T}function fw(T){var N=new f,B={isProviderFor:function(we,xe){var Se=N.get(we);return K(Se)?!1:Se.has(xe)},OrdinaryDefineOwnMetadata:Oe,OrdinaryHasOwnMetadata:he,OrdinaryGetOwnMetadata:_e,OrdinaryOwnMetadataKeys:ve,OrdinaryDeleteMetadata:fe};return v.registerProvider(B),B;function J(we,xe,Se){var He=N.get(we),bt=!1;if(K(He)){if(!Se)return;He=new p,N.set(we,He),bt=!0}var Mt=He.get(xe);if(K(Mt)){if(!Se)return;if(Mt=new p,He.set(xe,Mt),!T.setProvider(we,xe,B))throw He.delete(xe),bt&&N.delete(we),new Error("Wrong provider for target.")}return Mt}function he(we,xe,Se){var He=J(xe,Se,!1);return K(He)?!1:Pe(He.has(we))}function _e(we,xe,Se){var He=J(xe,Se,!1);if(!K(He))return He.get(we)}function Oe(we,xe,Se,He){var bt=J(Se,He,!0);bt.set(we,xe)}function ve(we,xe){var Se=[],He=J(we,xe,!1);if(K(He))return Se;for(var bt=He.keys(),Mt=Ko(bt),Ci=0;;){var GS=au(Mt);if(!GS)return Se.length=Ci,Se;var Ij=ou(GS);try{Se[Ci]=Ij}catch(_j){try{Cc(Mt)}finally{throw _j}}Ci++}}function fe(we,xe,Se){var He=J(xe,Se,!1);if(K(He)||!He.delete(we))return!1;if(He.size===0){var bt=N.get(xe);K(bt)||(bt.delete(Se),bt.size===0&&N.delete(bt))}return!0}}function rs(T){var N=T.defineMetadata,B=T.hasOwnMetadata,J=T.getOwnMetadata,he=T.getOwnMetadataKeys,_e=T.deleteMetadata,Oe=new f,ve={isProviderFor:function(fe,we){var xe=Oe.get(fe);return!K(xe)&&xe.has(we)?!0:he(fe,we).length?(K(xe)&&(xe=new b,Oe.set(fe,xe)),xe.add(we),!0):!1},OrdinaryDefineOwnMetadata:N,OrdinaryHasOwnMetadata:B,OrdinaryGetOwnMetadata:J,OrdinaryOwnMetadataKeys:he,OrdinaryDeleteMetadata:_e};return ve}function kc(T,N,B){var J=v.getProvider(T,N);if(!K(J))return J;if(B){if(v.setProvider(T,N,y))return y;throw new Error("Illegal state.")}}function $(){var T={},N=[],B=function(){function ve(fe,we,xe){this._index=0,this._keys=fe,this._values=we,this._selector=xe}return ve.prototype["@@iterator"]=function(){return this},ve.prototype[o]=function(){return this},ve.prototype.next=function(){var fe=this._index;if(fe>=0&&fe<this._keys.length){var we=this._selector(this._keys[fe],this._values[fe]);return fe+1>=this._keys.length?(this._index=-1,this._keys=N,this._values=N):this._index++,{value:we,done:!1}}return{value:void 0,done:!0}},ve.prototype.throw=function(fe){throw this._index>=0&&(this._index=-1,this._keys=N,this._values=N),fe},ve.prototype.return=function(fe){return this._index>=0&&(this._index=-1,this._keys=N,this._values=N),{value:fe,done:!0}},ve}(),J=function(){function ve(){this._keys=[],this._values=[],this._cacheKey=T,this._cacheIndex=-2}return Object.defineProperty(ve.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ve.prototype.has=function(fe){return this._find(fe,!1)>=0},ve.prototype.get=function(fe){var we=this._find(fe,!1);return we>=0?this._values[we]:void 0},ve.prototype.set=function(fe,we){var xe=this._find(fe,!0);return this._values[xe]=we,this},ve.prototype.delete=function(fe){var we=this._find(fe,!1);if(we>=0){for(var xe=this._keys.length,Se=we+1;Se<xe;Se++)this._keys[Se-1]=this._keys[Se],this._values[Se-1]=this._values[Se];return this._keys.length--,this._values.length--,Wr(fe,this._cacheKey)&&(this._cacheKey=T,this._cacheIndex=-2),!0}return!1},ve.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=T,this._cacheIndex=-2},ve.prototype.keys=function(){return new B(this._keys,this._values,he)},ve.prototype.values=function(){return new B(this._keys,this._values,_e)},ve.prototype.entries=function(){return new B(this._keys,this._values,Oe)},ve.prototype["@@iterator"]=function(){return this.entries()},ve.prototype[o]=function(){return this.entries()},ve.prototype._find=function(fe,we){if(!Wr(this._cacheKey,fe)){this._cacheIndex=-1;for(var xe=0;xe<this._keys.length;xe++)if(Wr(this._keys[xe],fe)){this._cacheIndex=xe;break}}return this._cacheIndex<0&&we&&(this._cacheIndex=this._keys.length,this._keys.push(fe),this._values.push(void 0)),this._cacheIndex},ve}();return J;function he(ve,fe){return ve}function _e(ve,fe){return fe}function Oe(ve,fe){return[ve,fe]}}function x(){var T=function(){function N(){this._map=new p}return Object.defineProperty(N.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),N.prototype.has=function(B){return this._map.has(B)},N.prototype.add=function(B){return this._map.set(B,B),this},N.prototype.delete=function(B){return this._map.delete(B)},N.prototype.clear=function(){this._map.clear()},N.prototype.keys=function(){return this._map.keys()},N.prototype.values=function(){return this._map.keys()},N.prototype.entries=function(){return this._map.entries()},N.prototype["@@iterator"]=function(){return this.keys()},N.prototype[o]=function(){return this.keys()},N}();return T}function S(){var T=16,N=d.create(),B=J();return function(){function fe(){this._key=J()}return fe.prototype.has=function(we){var xe=he(we,!1);return xe!==void 0?d.has(xe,this._key):!1},fe.prototype.get=function(we){var xe=he(we,!1);return xe!==void 0?d.get(xe,this._key):void 0},fe.prototype.set=function(we,xe){var Se=he(we,!0);return Se[this._key]=xe,this},fe.prototype.delete=function(we){var xe=he(we,!1);return xe!==void 0?delete xe[this._key]:!1},fe.prototype.clear=function(){this._key=J()},fe}();function J(){var fe;do fe="@@WeakMap@@"+ve();while(d.has(N,fe));return N[fe]=!0,fe}function he(fe,we){if(!n.call(fe,B)){if(!we)return;Object.defineProperty(fe,B,{value:d.create()})}return fe[B]}function _e(fe,we){for(var xe=0;xe<we;++xe)fe[xe]=Math.random()*255|0;return fe}function Oe(fe){if(typeof Uint8Array=="function"){var we=new Uint8Array(fe);return typeof crypto<"u"?crypto.getRandomValues(we):typeof msCrypto<"u"?msCrypto.getRandomValues(we):_e(we,fe),we}return _e(new Array(fe),fe)}function ve(){var fe=Oe(T);fe[6]=fe[6]&79|64,fe[8]=fe[8]&191|128;for(var we="",xe=0;xe<T;++xe){var Se=fe[xe];(xe===4||xe===6||xe===8)&&(we+="-"),Se<16&&(we+="0"),we+=Se.toString(16).toLowerCase()}return we}}function O(T){return T.__=void 0,delete T.__,T}})})(GT||(GT={}));var X;(function(r){r[r.Sequence=0]="Sequence",r[r.Set=1]="Set",r[r.Choice=2]="Choice"})(X||(X={}));var M;(function(r){r[r.Any=1]="Any",r[r.Boolean=2]="Boolean",r[r.OctetString=3]="OctetString",r[r.BitString=4]="BitString",r[r.Integer=5]="Integer",r[r.Enumerated=6]="Enumerated",r[r.ObjectIdentifier=7]="ObjectIdentifier",r[r.Utf8String=8]="Utf8String",r[r.BmpString=9]="BmpString",r[r.UniversalString=10]="UniversalString",r[r.NumericString=11]="NumericString",r[r.PrintableString=12]="PrintableString",r[r.TeletexString=13]="TeletexString",r[r.VideotexString=14]="VideotexString",r[r.IA5String=15]="IA5String",r[r.GraphicString=16]="GraphicString",r[r.VisibleString=17]="VisibleString",r[r.GeneralString=18]="GeneralString",r[r.CharacterString=19]="CharacterString",r[r.UTCTime=20]="UTCTime",r[r.GeneralizedTime=21]="GeneralizedTime",r[r.DATE=22]="DATE",r[r.TimeOfDay=23]="TimeOfDay",r[r.DateTime=24]="DateTime",r[r.Duration=25]="Duration",r[r.TIME=26]="TIME",r[r.Null=27]="Null"})(M||(M={}));class R4{constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if(typeof e=="number")this.fromNumber(e);else if(le.isBufferSource(e))this.unusedBits=t,this.value=le.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof yl))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new yl({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new yl({name:e})}toNumber(){let e="";const t=new Uint8Array(this.value);for(const n of t)e+=n.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2);const n=t.length+7>>3;this.unusedBits=(n<<3)-t.length;const i=new Uint8Array(n);t=t.padStart(n<<3,"0").split("").reverse().join("");let s=0;for(;s<n;)i[s]=parseInt(t.slice(s<<3,(s<<3)+8),2),s++;this.value=i.buffer}}class Ye{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){typeof e=="number"?this.buffer=new ArrayBuffer(e):le.isBufferSource(e)?this.buffer=le.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof Fi))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new Fi({valueHex:this.buffer})}toSchema(e){return new Fi({name:e})}}const F5e={fromASN:r=>r instanceof xo?null:r.valueBeforeDecodeView,toASN:r=>{if(r===null)return new xo;const e=ho(r);if(e.result.error)throw new Error(e.result.error);return e.result}},z5e={fromASN:r=>r.valueBlock.valueHexView.byteLength>=4?r.valueBlock.toString():r.valueBlock.valueDec,toASN:r=>new fo({value:+r})},V5e={fromASN:r=>r.valueBlock.valueDec,toASN:r=>new E4({value:r})},xt={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new fo({valueHex:r})},K5e={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new yl({valueHex:r})},j5e={fromASN:r=>r.valueBlock.toString(),toASN:r=>new io({value:r})},H5e={fromASN:r=>r.valueBlock.value,toASN:r=>new v4({value:r})},i3={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Fi({valueHex:r})},q5e={fromASN:r=>new Ye(r.getValue()),toASN:r=>r.toASN()};function xi(r){return{fromASN:e=>e.valueBlock.value,toASN:e=>new r({value:e})}}const sK=xi(Fo),W5e=xi(x4),G5e=xi(S4),Q5e=xi(A4),Y5e=xi(C4),J5e=xi(k4),X5e=xi(I4),Z5e=xi(_4),e6e=xi(T4),t6e=xi($0),r6e=xi($4),n6e=xi(P4),i6e={fromASN:r=>r.toDate(),toASN:r=>new P0({valueDate:r})},s6e={fromASN:r=>r.toDate(),toASN:r=>new D4({valueDate:r})},o6e={fromASN:()=>null,toASN:()=>new xo};function hS(r){switch(r){case M.Any:return F5e;case M.BitString:return K5e;case M.BmpString:return W5e;case M.Boolean:return H5e;case M.CharacterString:return n6e;case M.Enumerated:return V5e;case M.GeneralString:return r6e;case M.GeneralizedTime:return s6e;case M.GraphicString:return e6e;case M.IA5String:return Z5e;case M.Integer:return z5e;case M.Null:return o6e;case M.NumericString:return Q5e;case M.ObjectIdentifier:return j5e;case M.OctetString:return i3;case M.PrintableString:return Y5e;case M.TeletexString:return J5e;case M.UTCTime:return i6e;case M.UniversalString:return G5e;case M.Utf8String:return sK;case M.VideotexString:return X5e;case M.VisibleString:return t6e;default:return null}}function ao(r){return typeof r=="function"&&r.prototype?r.prototype.toASN&&r.prototype.fromASN?!0:ao(r.prototype):!!(r&&typeof r=="object"&&"toASN"in r&&"fromASN"in r)}function oK(r){var e;if(r){const t=Object.getPrototypeOf(r);return((e=t==null?void 0:t.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:oK(t)}return!1}function a6e(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<r.byteLength;i++)if(t[i]!==n[i])return!1;return!0}class c6e{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){const n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!n.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return n}cache(e){const t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){const t={type:X.Sequence,items:{}},n=this.findParentSchema(e);return n&&(Object.assign(t,n),t.items=Object.assign({},t.items,n.items)),t}create(e,t){const n=this.items.get(e)||this.createDefault(e),i=[];for(const s in n.items){const o=n.items[s],a=t?s:"";let c;if(typeof o.type=="number"){const d=M[o.type],h=GV[d];if(!h)throw new Error(`Cannot get ASN1 class by name '${d}'`);c=new h({name:a})}else ao(o.type)?c=new o.type().toSchema(a):o.optional?this.get(o.type).type===X.Choice?c=new Ll({name:a}):(c=this.create(o.type,!1),c.name=a):c=new Ll({name:a});const l=!!o.optional||o.defaultValue!==void 0;if(o.repeated){c.name="";const d=o.repeated==="set"?po:er;c=new d({name:"",value:[new r3({name:a,value:c})]})}if(o.context!==null&&o.context!==void 0)if(o.implicit)if(typeof o.type=="number"||ao(o.type)){const d=o.repeated?bn:T0;i.push(new d({name:a,optional:l,idBlock:{tagClass:3,tagNumber:o.context}}))}else{this.cache(o.type);const d=!!o.repeated;let h=d?c:this.get(o.type,!0).schema;h="valueBlock"in h?h.valueBlock.value:h.value,i.push(new bn({name:d?"":a,optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:h}))}else i.push(new bn({optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:[c]}));else c.optional=l,i.push(c)}switch(n.type){case X.Sequence:return new er({value:i,name:""});case X.Set:return new po({value:i,name:""});case X.Choice:return new oS({value:i,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){const t=Object.getPrototypeOf(e);return t?this.items.get(t)||this.findParentSchema(t):null}}const hi=new c6e,te=r=>e=>{let t;hi.has(e)?t=hi.get(e):(t=hi.createDefault(e),hi.set(e,t)),Object.assign(t,r)},P=r=>(e,t)=>{let n;hi.has(e.constructor)?n=hi.get(e.constructor):(n=hi.createDefault(e.constructor),hi.set(e.constructor,n));const i=Object.assign({},r);if(typeof i.type=="number"&&!i.converter){const s=hS(r.type);if(!s)throw new Error(`Cannot get default converter for property '${t}' of ${e.constructor.name}`);i.converter=s}n.items[t]=i};class QT extends Error{constructor(){super(...arguments),this.schemas=[]}}class l6e{static parse(e,t){const n=ho(e);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,t)}static fromASN(e,t){var n;try{if(ao(t))return new t().fromASN(e);const i=hi.get(t);hi.cache(t);let s=i.schema;if(e.constructor===bn&&i.type!==X.Choice){s=new bn({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:i.schema.valueBlock.value});for(const c in i.items)delete e[c]}const o=Zc({},e,s);if(!o.verified)throw new QT(`Data does not match to ${t.name} ASN1 schema. ${o.result.error}`);const a=new t;if(oK(t)){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const c=i.itemType;if(typeof c=="number"){const l=hS(c);if(!l)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);return t.from(e.valueBlock.value,d=>l.fromASN(d))}else return t.from(e.valueBlock.value,l=>this.fromASN(l,c))}for(const c in i.items){const l=o.result[c];if(!l)continue;const d=i.items[c],h=d.type;if(typeof h=="number"||ao(h)){const p=(n=d.converter)!==null&&n!==void 0?n:ao(h)?new h:null;if(!p)throw new Error("Converter is empty");if(d.repeated)if(d.implicit){const b=d.repeated==="sequence"?er:po,f=new b;f.valueBlock=l.valueBlock;const g=ho(f.toBER(!1));if(g.offset===-1)throw new Error(`Cannot parse the child item. ${g.result.error}`);if(!("value"in g.result.valueBlock&&Array.isArray(g.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const v=g.result.valueBlock.value;a[c]=Array.from(v,y=>p.fromASN(y))}else a[c]=Array.from(l,b=>p.fromASN(b));else{let b=l;if(d.implicit){let f;if(ao(h))f=new h().toSchema("");else{const g=M[h],v=GV[g];if(!v)throw new Error(`Cannot get '${g}' class from asn1js module`);f=new v}f.valueBlock=b.valueBlock,b=ho(f.toBER(!1)).result}a[c]=p.fromASN(b)}}else if(d.repeated){if(!Array.isArray(l))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");a[c]=Array.from(l,p=>this.fromASN(p,h))}else a[c]=this.fromASN(l,h)}return a}catch(i){throw i instanceof QT&&i.schemas.push(t.name),i}}}class fS{static serialize(e){return e instanceof yr?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&typeof e=="object"&&ao(e))return e.toASN();if(!(e&&typeof e=="object"))throw new TypeError("Parameter 1 should be type of Object.");const t=e.constructor,n=hi.get(t);hi.cache(t);let i=[];if(n.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if(typeof n.itemType=="number"){const o=hS(n.itemType);if(!o)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);i=e.map(a=>o.toASN(a))}else i=e.map(o=>this.toAsnItem({type:n.itemType},"[]",t,o))}else for(const o in n.items){const a=n.items[o],c=e[o];if(c===void 0||a.defaultValue===c||typeof a.defaultValue=="object"&&typeof c=="object"&&a6e(this.serialize(a.defaultValue),this.serialize(c)))continue;const l=fS.toAsnItem(a,o,t,c);if(typeof a.context=="number")if(a.implicit)if(!a.repeated&&(typeof a.type=="number"||ao(a.type))){const d={};d.valueHex=l instanceof xo?l.valueBeforeDecodeView:l.valueBlock.toBER(),i.push(new T0({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},...d}))}else i.push(new bn({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:l.valueBlock.value}));else i.push(new bn({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:[l]}));else a.repeated?i=i.concat(l):i.push(l)}let s;switch(n.type){case X.Sequence:s=new er({value:i});break;case X.Set:s=new po({value:i});break;case X.Choice:if(!i[0])throw new Error(`Schema '${t.name}' has wrong data. Choice cannot be empty.`);s=i[0];break}return s}static toAsnItem(e,t,n,i){let s;if(typeof e.type=="number"){const o=e.converter;if(!o)throw new Error(`Property '${t}' doesn't have converter for type ${M[e.type]} in schema '${n.name}'`);if(e.repeated){if(!Array.isArray(i))throw new TypeError("Parameter 'objProp' should be type of Array.");const a=Array.from(i,l=>o.toASN(l)),c=e.repeated==="sequence"?er:po;s=new c({value:a})}else s=o.toASN(i)}else if(e.repeated){if(!Array.isArray(i))throw new TypeError("Parameter 'objProp' should be type of Array.");const o=Array.from(i,c=>this.toASN(c)),a=e.repeated==="sequence"?er:po;s=new a({value:o})}else s=this.toASN(i);return s}}class at extends Array{constructor(e=[]){if(typeof e=="number")super(e);else{super();for(const t of e)this.push(t)}}}class oe{static serialize(e){return fS.serialize(e)}static parse(e,t){return l6e.parse(e,t)}static toString(e){const t=le.isBufferSource(e)?le.toArrayBuffer(e):oe.serialize(e),n=ho(t);if(n.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${n.result.error}`);return n.result.toString()}}function _(r,e,t,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}class YT{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){const t=e.split(".");if(t.length!==4)throw new Error("Invalid IPv4 address");return t.map(n=>{const i=parseInt(n,10);if(isNaN(i)||i<0||i>255)throw new Error("Invalid IPv4 address part");return i})}static parseIPv6(e){const n=this.expandIPv6(e).split(":");if(n.length!==8)throw new Error("Invalid IPv6 address");return n.reduce((i,s)=>{const o=parseInt(s,16);if(isNaN(o)||o<0||o>65535)throw new Error("Invalid IPv6 address part");return i.push(o>>8&255),i.push(o&255),i},[])}static expandIPv6(e){if(!e.includes("::"))return e;const t=e.split("::");if(t.length>2)throw new Error("Invalid IPv6 address");const n=t[0]?t[0].split(":"):[],i=t[1]?t[1].split(":"):[],s=8-(n.length+i.length);if(s<0)throw new Error("Invalid IPv6 address");return[...n,...Array(s).fill("0"),...i].join(":")}static formatIPv6(e){const t=[];for(let n=0;n<16;n+=2)t.push((e[n]<<8|e[n+1]).toString(16));return this.compressIPv6(t.join(":"))}static compressIPv6(e){const t=e.split(":");let n=-1,i=0,s=-1,o=0;for(let a=0;a<t.length;a++)t[a]==="0"?(s===-1&&(s=a),o++):(o>i&&(n=s,i=o),s=-1,o=0);if(o>i&&(n=s,i=o),i>1){const a=t.slice(0,n).join(":"),c=t.slice(n+i).join(":");return`${a}::${c}`}return e}static parseCIDR(e){const[t,n]=e.split("/"),i=parseInt(n,10);if(this.isIPv4(t)){if(i<0||i>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(t),i]}else{if(i<0||i>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(t),i]}}static decodeIP(e){if(e.length===64&&parseInt(e,16)===0)return"::/0";if(e.length!==16)return e;const t=parseInt(e.slice(8),16).toString(2).split("").reduce((i,s)=>i+ +s,0);let n=e.slice(0,8).replace(/(.{2})/g,i=>`${parseInt(i,16)}.`);return n=n.slice(0,-1),`${n}/${t}`}static toString(e){const t=new Uint8Array(e);if(t.length===4)return Array.from(t).join(".");if(t.length===16)return this.formatIPv6(t);if(t.length===8||t.length===32){const n=t.length/2,i=t.slice(0,n),s=t.slice(n);if(t.every(c=>c===0))return t.length===8?"0.0.0.0/0":"::/0";const a=s.reduce((c,l)=>c+(l.toString(2).match(/1/g)||[]).length,0);return t.length===8?`${Array.from(i).join(".")}/${a}`:`${this.formatIPv6(i)}/${a}`}return this.decodeIP(Ee.ToHex(e))}static fromString(e){if(e.includes("/")){const[n,i]=this.parseCIDR(e),s=new Uint8Array(n.length);let o=i;for(let c=0;c<s.length;c++)o>=8?(s[c]=255,o-=8):o>0&&(s[c]=255<<8-o,o=0);const a=new Uint8Array(n.length*2);return a.set(n,0),a.set(s,n.length),a.buffer}const t=this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e);return new Uint8Array(t).buffer}}var _b,Tb,$b;let mr=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};_([P({type:M.TeletexString})],mr.prototype,"teletexString",void 0);_([P({type:M.PrintableString})],mr.prototype,"printableString",void 0);_([P({type:M.UniversalString})],mr.prototype,"universalString",void 0);_([P({type:M.Utf8String})],mr.prototype,"utf8String",void 0);_([P({type:M.BmpString})],mr.prototype,"bmpString",void 0);mr=_([te({type:X.Choice})],mr);let qd=class extends mr{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?Ee.ToHex(this.anyValue):super.toString())}};_([P({type:M.IA5String})],qd.prototype,"ia5String",void 0);_([P({type:M.Any})],qd.prototype,"anyValue",void 0);qd=_([te({type:X.Choice})],qd);class B4{constructor(e={}){this.type="",this.value=new qd,Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],B4.prototype,"type",void 0);_([P({type:qd})],B4.prototype,"value",void 0);let Wd=_b=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,_b.prototype)}};Wd=_b=_([te({type:X.Set,itemType:B4})],Wd);let Pb=Tb=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,Tb.prototype)}};Pb=Tb=_([te({type:X.Sequence,itemType:Wd})],Pb);let Ft=$b=class extends Pb{constructor(e){super(e),Object.setPrototypeOf(this,$b.prototype)}};Ft=$b=_([te({type:X.Sequence})],Ft);const u6e={fromASN:r=>YT.toString(i3.fromASN(r)),toASN:r=>i3.toASN(YT.fromString(r))};class F1{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],F1.prototype,"typeId",void 0);_([P({type:M.Any,context:0})],F1.prototype,"value",void 0);class pS{constructor(e={}){this.partyName=new mr,Object.assign(this,e)}}_([P({type:mr,optional:!0,context:0,implicit:!0})],pS.prototype,"nameAssigner",void 0);_([P({type:mr,context:1,implicit:!0})],pS.prototype,"partyName",void 0);let Ne=class{constructor(e={}){Object.assign(this,e)}};_([P({type:F1,context:0,implicit:!0})],Ne.prototype,"otherName",void 0);_([P({type:M.IA5String,context:1,implicit:!0})],Ne.prototype,"rfc822Name",void 0);_([P({type:M.IA5String,context:2,implicit:!0})],Ne.prototype,"dNSName",void 0);_([P({type:M.Any,context:3,implicit:!0})],Ne.prototype,"x400Address",void 0);_([P({type:Ft,context:4,implicit:!1})],Ne.prototype,"directoryName",void 0);_([P({type:pS,context:5})],Ne.prototype,"ediPartyName",void 0);_([P({type:M.IA5String,context:6,implicit:!0})],Ne.prototype,"uniformResourceIdentifier",void 0);_([P({type:M.OctetString,context:7,implicit:!0,converter:u6e})],Ne.prototype,"iPAddress",void 0);_([P({type:M.ObjectIdentifier,context:8,implicit:!0})],Ne.prototype,"registeredID",void 0);Ne=_([te({type:X.Choice})],Ne);const gS="1.3.6.1.5.5.7",d6e=`${gS}.1`,vh=`${gS}.3`,L4=`${gS}.48`,JT=`${L4}.1`,XT=`${L4}.2`,ZT=`${L4}.3`,e$=`${L4}.5`,Ec="2.5.29";var Db;const Nb=`${d6e}.1`;class N0{constructor(e={}){this.accessMethod="",this.accessLocation=new Ne,Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],N0.prototype,"accessMethod",void 0);_([P({type:Ne})],N0.prototype,"accessLocation",void 0);let Uu=Db=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,Db.prototype)}};Uu=Db=_([te({type:X.Sequence,itemType:N0})],Uu);const Ob=`${Ec}.35`;class yS extends Ye{}class el{constructor(e={}){e&&Object.assign(this,e)}}_([P({type:yS,context:0,optional:!0,implicit:!0})],el.prototype,"keyIdentifier",void 0);_([P({type:Ne,context:1,optional:!0,implicit:!0,repeated:"sequence"})],el.prototype,"authorityCertIssuer",void 0);_([P({type:M.Integer,context:2,optional:!0,implicit:!0,converter:xt})],el.prototype,"authorityCertSerialNumber",void 0);const aK=`${Ec}.19`;class s3{constructor(e={}){this.cA=!1,Object.assign(this,e)}}_([P({type:M.Boolean,defaultValue:!1})],s3.prototype,"cA",void 0);_([P({type:M.Integer,optional:!0})],s3.prototype,"pathLenConstraint",void 0);var Rb;let rn=Rb=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,Rb.prototype)}};rn=Rb=_([te({type:X.Sequence,itemType:Ne})],rn);var Bb;let t$=Bb=class extends rn{constructor(e){super(e),Object.setPrototypeOf(this,Bb.prototype)}};t$=Bb=_([te({type:X.Sequence})],t$);var Lb;const cK=`${Ec}.32`;let So=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};_([P({type:M.IA5String})],So.prototype,"ia5String",void 0);_([P({type:M.VisibleString})],So.prototype,"visibleString",void 0);_([P({type:M.BmpString})],So.prototype,"bmpString",void 0);_([P({type:M.Utf8String})],So.prototype,"utf8String",void 0);So=_([te({type:X.Choice})],So);class mS{constructor(e={}){this.organization=new So,this.noticeNumbers=[],Object.assign(this,e)}}_([P({type:So})],mS.prototype,"organization",void 0);_([P({type:M.Integer,repeated:"sequence"})],mS.prototype,"noticeNumbers",void 0);class wS{constructor(e={}){Object.assign(this,e)}}_([P({type:mS,optional:!0})],wS.prototype,"noticeRef",void 0);_([P({type:So,optional:!0})],wS.prototype,"explicitText",void 0);let o3=class{constructor(e={}){Object.assign(this,e)}};_([P({type:M.IA5String})],o3.prototype,"cPSuri",void 0);_([P({type:wS})],o3.prototype,"userNotice",void 0);o3=_([te({type:X.Choice})],o3);class bS{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],bS.prototype,"policyQualifierId",void 0);_([P({type:M.Any})],bS.prototype,"qualifier",void 0);class M4{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],M4.prototype,"policyIdentifier",void 0);_([P({type:bS,repeated:"sequence",optional:!0})],M4.prototype,"policyQualifiers",void 0);let a3=Lb=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,Lb.prototype)}};a3=Lb=_([te({type:X.Sequence,itemType:M4})],a3);let c3=class{constructor(e=0){this.value=e}};_([P({type:M.Integer})],c3.prototype,"value",void 0);c3=_([te({type:X.Choice})],c3);let r$=class extends c3{};r$=_([te({type:X.Choice})],r$);var Mb;const Ub=`${Ec}.31`;var Di;(function(r){r[r.unused=1]="unused",r[r.keyCompromise=2]="keyCompromise",r[r.cACompromise=4]="cACompromise",r[r.affiliationChanged=8]="affiliationChanged",r[r.superseded=16]="superseded",r[r.cessationOfOperation=32]="cessationOfOperation",r[r.certificateHold=64]="certificateHold",r[r.privilegeWithdrawn=128]="privilegeWithdrawn",r[r.aACompromise=256]="aACompromise"})(Di||(Di={}));class lK extends R4{toJSON(){const e=[],t=this.toNumber();return t&Di.aACompromise&&e.push("aACompromise"),t&Di.affiliationChanged&&e.push("affiliationChanged"),t&Di.cACompromise&&e.push("cACompromise"),t&Di.certificateHold&&e.push("certificateHold"),t&Di.cessationOfOperation&&e.push("cessationOfOperation"),t&Di.keyCompromise&&e.push("keyCompromise"),t&Di.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&Di.superseded&&e.push("superseded"),t&Di.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}}let Ml=class{constructor(e={}){Object.assign(this,e)}};_([P({type:Ne,context:0,repeated:"sequence",implicit:!0})],Ml.prototype,"fullName",void 0);_([P({type:Wd,context:1,implicit:!0})],Ml.prototype,"nameRelativeToCRLIssuer",void 0);Ml=_([te({type:X.Choice})],Ml);class Eh{constructor(e={}){Object.assign(this,e)}}_([P({type:Ml,context:0,optional:!0})],Eh.prototype,"distributionPoint",void 0);_([P({type:lK,context:1,optional:!0,implicit:!0})],Eh.prototype,"reasons",void 0);_([P({type:Ne,context:2,optional:!0,repeated:"sequence",implicit:!0})],Eh.prototype,"cRLIssuer",void 0);let rd=Mb=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,Mb.prototype)}};rd=Mb=_([te({type:X.Sequence,itemType:Eh})],rd);var Fb;let n$=Fb=class extends rd{constructor(e){super(e),Object.setPrototypeOf(this,Fb.prototype)}};n$=Fb=_([te({type:X.Sequence,itemType:Eh})],n$);class jr{constructor(e={}){this.onlyContainsUserCerts=jr.ONLY,this.onlyContainsCACerts=jr.ONLY,this.indirectCRL=jr.ONLY,this.onlyContainsAttributeCerts=jr.ONLY,Object.assign(this,e)}}jr.ONLY=!1;_([P({type:Ml,context:0,optional:!0})],jr.prototype,"distributionPoint",void 0);_([P({type:M.Boolean,context:1,defaultValue:jr.ONLY,implicit:!0})],jr.prototype,"onlyContainsUserCerts",void 0);_([P({type:M.Boolean,context:2,defaultValue:jr.ONLY,implicit:!0})],jr.prototype,"onlyContainsCACerts",void 0);_([P({type:lK,context:3,optional:!0,implicit:!0})],jr.prototype,"onlySomeReasons",void 0);_([P({type:M.Boolean,context:4,defaultValue:jr.ONLY,implicit:!0})],jr.prototype,"indirectCRL",void 0);_([P({type:M.Boolean,context:5,defaultValue:jr.ONLY,implicit:!0})],jr.prototype,"onlyContainsAttributeCerts",void 0);var qf;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(qf||(qf={}));let zb=class{constructor(e=qf.unspecified){this.reason=qf.unspecified,this.reason=e}toJSON(){return qf[this.reason]}toString(){return this.toJSON()}};_([P({type:M.Enumerated})],zb.prototype,"reason",void 0);zb=_([te({type:X.Choice})],zb);var Vb;const uK=`${Ec}.37`;let l3=Vb=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,Vb.prototype)}};l3=Vb=_([te({type:X.Sequence,itemType:M.ObjectIdentifier})],l3);const h6e=`${vh}.1`,f6e=`${vh}.2`,p6e=`${vh}.3`,g6e=`${vh}.4`,y6e=`${vh}.8`,m6e=`${vh}.9`;let Kb=class{constructor(e=new ArrayBuffer(0)){this.value=e}};_([P({type:M.Integer,converter:xt})],Kb.prototype,"value",void 0);Kb=_([te({type:X.Choice})],Kb);let jb=class{constructor(e){this.value=new Date,e&&(this.value=e)}};_([P({type:M.GeneralizedTime})],jb.prototype,"value",void 0);jb=_([te({type:X.Choice})],jb);var Hb;let i$=Hb=class extends rn{constructor(e){super(e),Object.setPrototypeOf(this,Hb.prototype)}};i$=Hb=_([te({type:X.Sequence})],i$);const dK=`${Ec}.15`;var Ni;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(Ni||(Ni={}));class Z8 extends R4{toJSON(){const e=this.toNumber(),t=[];return e&Ni.cRLSign&&t.push("crlSign"),e&Ni.dataEncipherment&&t.push("dataEncipherment"),e&Ni.decipherOnly&&t.push("decipherOnly"),e&Ni.digitalSignature&&t.push("digitalSignature"),e&Ni.encipherOnly&&t.push("encipherOnly"),e&Ni.keyAgreement&&t.push("keyAgreement"),e&Ni.keyCertSign&&t.push("keyCertSign"),e&Ni.keyEncipherment&&t.push("keyEncipherment"),e&Ni.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}}var qb;class U4{constructor(e={}){this.base=new Ne,this.minimum=0,Object.assign(this,e)}}_([P({type:Ne})],U4.prototype,"base",void 0);_([P({type:M.Integer,context:0,defaultValue:0,implicit:!0})],U4.prototype,"minimum",void 0);_([P({type:M.Integer,context:1,optional:!0,implicit:!0})],U4.prototype,"maximum",void 0);let u3=qb=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,qb.prototype)}};u3=qb=_([te({type:X.Sequence,itemType:U4})],u3);class hK{constructor(e={}){Object.assign(this,e)}}_([P({type:u3,context:0,optional:!0,implicit:!0})],hK.prototype,"permittedSubtrees",void 0);_([P({type:u3,context:1,optional:!0,implicit:!0})],hK.prototype,"excludedSubtrees",void 0);class fK{constructor(e={}){Object.assign(this,e)}}_([P({type:M.Integer,context:0,implicit:!0,optional:!0,converter:xt})],fK.prototype,"requireExplicitPolicy",void 0);_([P({type:M.Integer,context:1,implicit:!0,optional:!0,converter:xt})],fK.prototype,"inhibitPolicyMapping",void 0);var Wb;class vS{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],vS.prototype,"issuerDomainPolicy",void 0);_([P({type:M.ObjectIdentifier})],vS.prototype,"subjectDomainPolicy",void 0);let s$=Wb=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,Wb.prototype)}};s$=Wb=_([te({type:X.Sequence,itemType:vS})],s$);var Gb;const pK=`${Ec}.17`;let Qb=Gb=class extends rn{constructor(e){super(e),Object.setPrototypeOf(this,Gb.prototype)}};Qb=Gb=_([te({type:X.Sequence})],Qb);let Ao=class{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}};_([P({type:M.ObjectIdentifier})],Ao.prototype,"type",void 0);_([P({type:M.Any,repeated:"set"})],Ao.prototype,"values",void 0);var Yb;let o$=Yb=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,Yb.prototype)}};o$=Yb=_([te({type:X.Sequence,itemType:Ao})],o$);const gK=`${Ec}.14`;class Ya extends yS{}class yK{constructor(e={}){Object.assign(this,e)}}_([P({type:M.GeneralizedTime,context:0,implicit:!0,optional:!0})],yK.prototype,"notBefore",void 0);_([P({type:M.GeneralizedTime,context:1,implicit:!0,optional:!0})],yK.prototype,"notAfter",void 0);var Wf;(function(r){r[r.keyUpdateAllowed=1]="keyUpdateAllowed",r[r.newExtensions=2]="newExtensions",r[r.pKIXCertificate=4]="pKIXCertificate"})(Wf||(Wf={}));class mK extends R4{toJSON(){const e=[],t=this.toNumber();return t&Wf.pKIXCertificate&&e.push("pKIXCertificate"),t&Wf.newExtensions&&e.push("newExtensions"),t&Wf.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}}class wK{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new mK,Object.assign(this,e)}}_([P({type:M.GeneralString})],wK.prototype,"entrustVers",void 0);_([P({type:mK})],wK.prototype,"entrustInfoFlags",void 0);var Jb;let a$=Jb=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,Jb.prototype)}};a$=Jb=_([te({type:X.Sequence,itemType:N0})],a$);class ge{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof ge&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&Xz(e.parameters,this.parameters)||e.parameters===this.parameters)}}_([P({type:M.ObjectIdentifier})],ge.prototype,"algorithm",void 0);_([P({type:M.Any,optional:!0})],ge.prototype,"parameters",void 0);class Vi{constructor(e={}){this.algorithm=new ge,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:ge})],Vi.prototype,"algorithm",void 0);_([P({type:M.BitString})],Vi.prototype,"subjectPublicKey",void 0);let ur=class{constructor(e){if(e)if(typeof e=="string"||typeof e=="number"||e instanceof Date){const t=new Date(e);t.getUTCFullYear()>2049?this.generalTime=t:this.utcTime=t}else Object.assign(this,e)}getTime(){const e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};_([P({type:M.UTCTime})],ur.prototype,"utcTime",void 0);_([P({type:M.GeneralizedTime})],ur.prototype,"generalTime",void 0);ur=_([te({type:X.Choice})],ur);class O0{constructor(e){this.notBefore=new ur(new Date),this.notAfter=new ur(new Date),e&&(this.notBefore=new ur(e.notBefore),this.notAfter=new ur(e.notAfter))}}_([P({type:ur})],O0.prototype,"notBefore",void 0);_([P({type:ur})],O0.prototype,"notAfter",void 0);var Xb;let bi=class bK{constructor(e={}){this.extnID="",this.critical=bK.CRITICAL,this.extnValue=new Ye,Object.assign(this,e)}};bi.CRITICAL=!1;_([P({type:M.ObjectIdentifier})],bi.prototype,"extnID",void 0);_([P({type:M.Boolean,defaultValue:bi.CRITICAL})],bi.prototype,"critical",void 0);_([P({type:Ye})],bi.prototype,"extnValue",void 0);let lc=Xb=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,Xb.prototype)}};lc=Xb=_([te({type:X.Sequence,itemType:bi})],lc);var Ul;(function(r){r[r.v1=0]="v1",r[r.v2=1]="v2",r[r.v3=2]="v3"})(Ul||(Ul={}));class Jn{constructor(e={}){this.version=Ul.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new ge,this.issuer=new Ft,this.validity=new O0,this.subject=new Ft,this.subjectPublicKeyInfo=new Vi,Object.assign(this,e)}}_([P({type:M.Integer,context:0,defaultValue:Ul.v1})],Jn.prototype,"version",void 0);_([P({type:M.Integer,converter:xt})],Jn.prototype,"serialNumber",void 0);_([P({type:ge})],Jn.prototype,"signature",void 0);_([P({type:Ft})],Jn.prototype,"issuer",void 0);_([P({type:O0})],Jn.prototype,"validity",void 0);_([P({type:Ft})],Jn.prototype,"subject",void 0);_([P({type:Vi})],Jn.prototype,"subjectPublicKeyInfo",void 0);_([P({type:M.BitString,context:1,implicit:!0,optional:!0})],Jn.prototype,"issuerUniqueID",void 0);_([P({type:M.BitString,context:2,implicit:!0,optional:!0})],Jn.prototype,"subjectUniqueID",void 0);_([P({type:lc,context:3,optional:!0})],Jn.prototype,"extensions",void 0);class Fl{constructor(e={}){this.tbsCertificate=new Jn,this.signatureAlgorithm=new ge,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:Jn})],Fl.prototype,"tbsCertificate",void 0);_([P({type:ge})],Fl.prototype,"signatureAlgorithm",void 0);_([P({type:M.BitString})],Fl.prototype,"signatureValue",void 0);class F4{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new ur,Object.assign(this,e)}}_([P({type:M.Integer,converter:xt})],F4.prototype,"userCertificate",void 0);_([P({type:ur})],F4.prototype,"revocationDate",void 0);_([P({type:bi,optional:!0,repeated:"sequence"})],F4.prototype,"crlEntryExtensions",void 0);class zo{constructor(e={}){this.signature=new ge,this.issuer=new Ft,this.thisUpdate=new ur,Object.assign(this,e)}}_([P({type:M.Integer,optional:!0})],zo.prototype,"version",void 0);_([P({type:ge})],zo.prototype,"signature",void 0);_([P({type:Ft})],zo.prototype,"issuer",void 0);_([P({type:ur})],zo.prototype,"thisUpdate",void 0);_([P({type:ur,optional:!0})],zo.prototype,"nextUpdate",void 0);_([P({type:F4,repeated:"sequence",optional:!0})],zo.prototype,"revokedCertificates",void 0);_([P({type:bi,optional:!0,context:0,repeated:"sequence"})],zo.prototype,"crlExtensions",void 0);class ES{constructor(e={}){this.tbsCertList=new zo,this.signatureAlgorithm=new ge,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:zo})],ES.prototype,"tbsCertList",void 0);_([P({type:ge})],ES.prototype,"signatureAlgorithm",void 0);_([P({type:M.BitString})],ES.prototype,"signature",void 0);class xh{constructor(e={}){this.issuer=new Ft,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:Ft})],xh.prototype,"issuer",void 0);_([P({type:M.Integer,converter:xt})],xh.prototype,"serialNumber",void 0);let Gd=class{constructor(e={}){Object.assign(this,e)}};_([P({type:Ya,context:0,implicit:!0})],Gd.prototype,"subjectKeyIdentifier",void 0);_([P({type:xh})],Gd.prototype,"issuerAndSerialNumber",void 0);Gd=_([te({type:X.Choice})],Gd);var Co;(function(r){r[r.v0=0]="v0",r[r.v1=1]="v1",r[r.v2=2]="v2",r[r.v3=3]="v3",r[r.v4=4]="v4",r[r.v5=5]="v5"})(Co||(Co={}));let z1=class extends ge{};z1=_([te({type:X.Sequence})],z1);let d3=class extends ge{};d3=_([te({type:X.Sequence})],d3);let Ts=class extends ge{};Ts=_([te({type:X.Sequence})],Ts);let h3=class extends ge{};h3=_([te({type:X.Sequence})],h3);let c$=class extends ge{};c$=_([te({type:X.Sequence})],c$);let Zb=class extends ge{};Zb=_([te({type:X.Sequence})],Zb);let Sh=class{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}};_([P({type:M.ObjectIdentifier})],Sh.prototype,"attrType",void 0);_([P({type:M.Any,repeated:"set"})],Sh.prototype,"attrValues",void 0);var e9;class Rs{constructor(e={}){this.version=Co.v0,this.sid=new Gd,this.digestAlgorithm=new z1,this.signatureAlgorithm=new d3,this.signature=new Ye,Object.assign(this,e)}}_([P({type:M.Integer})],Rs.prototype,"version",void 0);_([P({type:Gd})],Rs.prototype,"sid",void 0);_([P({type:z1})],Rs.prototype,"digestAlgorithm",void 0);_([P({type:Sh,repeated:"set",context:0,implicit:!0,optional:!0})],Rs.prototype,"signedAttrs",void 0);_([P({type:d3})],Rs.prototype,"signatureAlgorithm",void 0);_([P({type:Ye})],Rs.prototype,"signature",void 0);_([P({type:Sh,repeated:"set",context:1,implicit:!0,optional:!0})],Rs.prototype,"unsignedAttrs",void 0);let f3=e9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,e9.prototype)}};f3=e9=_([te({type:X.Set,itemType:Rs})],f3);let l$=class extends ur{};l$=_([te({type:X.Choice})],l$);let u$=class extends Rs{};u$=_([te({type:X.Sequence})],u$);class xS{constructor(e={}){this.acIssuer=new Ne,this.acSerial=0,this.attrs=[],Object.assign(this,e)}}_([P({type:Ne})],xS.prototype,"acIssuer",void 0);_([P({type:M.Integer})],xS.prototype,"acSerial",void 0);_([P({type:Ao,repeated:"sequence"})],xS.prototype,"attrs",void 0);var t9;let p3=t9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,t9.prototype)}};p3=t9=_([te({type:X.Sequence,itemType:M.ObjectIdentifier})],p3);class z4{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}}_([P({type:M.Integer,optional:!0})],z4.prototype,"pathLenConstraint",void 0);_([P({type:p3,implicit:!0,context:0,optional:!0})],z4.prototype,"permittedAttrs",void 0);_([P({type:p3,implicit:!0,context:1,optional:!0})],z4.prototype,"excludedAttrs",void 0);_([P({type:M.Boolean,defaultValue:!0})],z4.prototype,"permitUnSpecified",void 0);class iu{constructor(e={}){this.issuer=new rn,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:rn})],iu.prototype,"issuer",void 0);_([P({type:M.Integer,converter:xt})],iu.prototype,"serial",void 0);_([P({type:M.BitString,optional:!0})],iu.prototype,"issuerUID",void 0);var r9;(function(r){r[r.publicKey=0]="publicKey",r[r.publicKeyCert=1]="publicKeyCert",r[r.otherObjectTypes=2]="otherObjectTypes"})(r9||(r9={}));class su{constructor(e={}){this.digestedObjectType=r9.publicKey,this.digestAlgorithm=new ge,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:M.Enumerated})],su.prototype,"digestedObjectType",void 0);_([P({type:M.ObjectIdentifier,optional:!0})],su.prototype,"otherObjectTypeID",void 0);_([P({type:ge})],su.prototype,"digestAlgorithm",void 0);_([P({type:M.BitString})],su.prototype,"objectDigest",void 0);class V4{constructor(e={}){Object.assign(this,e)}}_([P({type:rn,optional:!0})],V4.prototype,"issuerName",void 0);_([P({type:iu,context:0,implicit:!0,optional:!0})],V4.prototype,"baseCertificateID",void 0);_([P({type:su,context:1,implicit:!0,optional:!0})],V4.prototype,"objectDigestInfo",void 0);let Qd=class{constructor(e={}){Object.assign(this,e)}};_([P({type:Ne,repeated:"sequence"})],Qd.prototype,"v1Form",void 0);_([P({type:V4,context:0,implicit:!0})],Qd.prototype,"v2Form",void 0);Qd=_([te({type:X.Choice})],Qd);class K4{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}}_([P({type:M.GeneralizedTime})],K4.prototype,"notBeforeTime",void 0);_([P({type:M.GeneralizedTime})],K4.prototype,"notAfterTime",void 0);class R0{constructor(e={}){Object.assign(this,e)}}_([P({type:iu,implicit:!0,context:0,optional:!0})],R0.prototype,"baseCertificateID",void 0);_([P({type:rn,implicit:!0,context:1,optional:!0})],R0.prototype,"entityName",void 0);_([P({type:su,implicit:!0,context:2,optional:!0})],R0.prototype,"objectDigestInfo",void 0);var n9;(function(r){r[r.v2=1]="v2"})(n9||(n9={}));class ts{constructor(e={}){this.version=n9.v2,this.holder=new R0,this.issuer=new Qd,this.signature=new ge,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new K4,this.attributes=[],Object.assign(this,e)}}_([P({type:M.Integer})],ts.prototype,"version",void 0);_([P({type:R0})],ts.prototype,"holder",void 0);_([P({type:Qd})],ts.prototype,"issuer",void 0);_([P({type:ge})],ts.prototype,"signature",void 0);_([P({type:M.Integer,converter:xt})],ts.prototype,"serialNumber",void 0);_([P({type:K4})],ts.prototype,"attrCertValidityPeriod",void 0);_([P({type:Ao,repeated:"sequence"})],ts.prototype,"attributes",void 0);_([P({type:M.BitString,optional:!0})],ts.prototype,"issuerUniqueID",void 0);_([P({type:lc,optional:!0})],ts.prototype,"extensions",void 0);class j4{constructor(e={}){this.acinfo=new ts,this.signatureAlgorithm=new ge,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:ts})],j4.prototype,"acinfo",void 0);_([P({type:ge})],j4.prototype,"signatureAlgorithm",void 0);_([P({type:M.BitString})],j4.prototype,"signatureValue",void 0);var g3;(function(r){r[r.unmarked=1]="unmarked",r[r.unclassified=2]="unclassified",r[r.restricted=4]="restricted",r[r.confidential=8]="confidential",r[r.secret=16]="secret",r[r.topSecret=32]="topSecret"})(g3||(g3={}));class i9 extends R4{}class SS{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:M.ObjectIdentifier,implicit:!0,context:0})],SS.prototype,"type",void 0);_([P({type:M.Any,implicit:!0,context:1})],SS.prototype,"value",void 0);class AS{constructor(e={}){this.policyId="",this.classList=new i9(g3.unclassified),Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],AS.prototype,"policyId",void 0);_([P({type:i9,defaultValue:new i9(g3.unclassified)})],AS.prototype,"classList",void 0);_([P({type:SS,repeated:"set"})],AS.prototype,"securityCategories",void 0);class H4{constructor(e={}){Object.assign(this,e)}}_([P({type:Ye})],H4.prototype,"cotets",void 0);_([P({type:M.ObjectIdentifier})],H4.prototype,"oid",void 0);_([P({type:M.Utf8String})],H4.prototype,"string",void 0);class vK{constructor(e={}){this.values=[],Object.assign(this,e)}}_([P({type:rn,implicit:!0,context:0,optional:!0})],vK.prototype,"policyAuthority",void 0);_([P({type:H4,repeated:"sequence"})],vK.prototype,"values",void 0);var s9;class q4{constructor(e={}){this.targetCertificate=new iu,Object.assign(this,e)}}_([P({type:iu})],q4.prototype,"targetCertificate",void 0);_([P({type:Ne,optional:!0})],q4.prototype,"targetName",void 0);_([P({type:su,optional:!0})],q4.prototype,"certDigestInfo",void 0);let Yd=class{constructor(e={}){Object.assign(this,e)}};_([P({type:Ne,context:0,implicit:!0})],Yd.prototype,"targetName",void 0);_([P({type:Ne,context:1,implicit:!0})],Yd.prototype,"targetGroup",void 0);_([P({type:q4,context:2,implicit:!0})],Yd.prototype,"targetCert",void 0);Yd=_([te({type:X.Choice})],Yd);let o9=s9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,s9.prototype)}};o9=s9=_([te({type:X.Sequence,itemType:Yd})],o9);var a9;let d$=a9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,a9.prototype)}};d$=a9=_([te({type:X.Sequence,itemType:o9})],d$);class EK{constructor(e={}){Object.assign(this,e)}}_([P({type:rn,implicit:!0,context:0,optional:!0})],EK.prototype,"roleAuthority",void 0);_([P({type:Ne,implicit:!0,context:1})],EK.prototype,"roleName",void 0);class CS{constructor(e={}){this.service=new Ne,this.ident=new Ne,Object.assign(this,e)}}_([P({type:Ne})],CS.prototype,"service",void 0);_([P({type:Ne})],CS.prototype,"ident",void 0);_([P({type:Ye,optional:!0})],CS.prototype,"authInfo",void 0);var c9;class kS{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],kS.prototype,"otherCertFormat",void 0);_([P({type:M.Any})],kS.prototype,"otherCert",void 0);let Jd=class{constructor(e={}){Object.assign(this,e)}};_([P({type:Fl})],Jd.prototype,"certificate",void 0);_([P({type:j4,context:2,implicit:!0})],Jd.prototype,"v2AttrCert",void 0);_([P({type:kS,context:3,implicit:!0})],Jd.prototype,"other",void 0);Jd=_([te({type:X.Choice})],Jd);let y3=c9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,c9.prototype)}};y3=c9=_([te({type:X.Set,itemType:Jd})],y3);class Ah{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],Ah.prototype,"contentType",void 0);_([P({type:M.Any,context:0})],Ah.prototype,"content",void 0);let V1=class{constructor(e={}){Object.assign(this,e)}};_([P({type:Ye})],V1.prototype,"single",void 0);_([P({type:M.Any})],V1.prototype,"any",void 0);V1=_([te({type:X.Choice})],V1);class W4{constructor(e={}){this.eContentType="",Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],W4.prototype,"eContentType",void 0);_([P({type:V1,context:0,optional:!0})],W4.prototype,"eContent",void 0);let K1=class{constructor(e={}){Object.assign(this,e)}};_([P({type:Ye,context:0,implicit:!0,optional:!0})],K1.prototype,"value",void 0);_([P({type:Ye,converter:q5e,context:0,implicit:!0,optional:!0,repeated:"sequence"})],K1.prototype,"constructedValue",void 0);K1=_([te({type:X.Choice})],K1);class B0{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new h3,Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],B0.prototype,"contentType",void 0);_([P({type:h3})],B0.prototype,"contentEncryptionAlgorithm",void 0);_([P({type:K1,optional:!0})],B0.prototype,"encryptedContent",void 0);class G4{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],G4.prototype,"keyAttrId",void 0);_([P({type:M.Any,optional:!0})],G4.prototype,"keyAttr",void 0);var l9;class Q4{constructor(e={}){this.subjectKeyIdentifier=new Ya,Object.assign(this,e)}}_([P({type:Ya})],Q4.prototype,"subjectKeyIdentifier",void 0);_([P({type:M.GeneralizedTime,optional:!0})],Q4.prototype,"date",void 0);_([P({type:G4,optional:!0})],Q4.prototype,"other",void 0);let Xd=class{constructor(e={}){Object.assign(this,e)}};_([P({type:Q4,context:0,implicit:!0,optional:!0})],Xd.prototype,"rKeyId",void 0);_([P({type:xh,optional:!0})],Xd.prototype,"issuerAndSerialNumber",void 0);Xd=_([te({type:X.Choice})],Xd);class IS{constructor(e={}){this.rid=new Xd,this.encryptedKey=new Ye,Object.assign(this,e)}}_([P({type:Xd})],IS.prototype,"rid",void 0);_([P({type:Ye})],IS.prototype,"encryptedKey",void 0);let m3=l9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,l9.prototype)}};m3=l9=_([te({type:X.Sequence,itemType:IS})],m3);class _S{constructor(e={}){this.algorithm=new ge,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:ge})],_S.prototype,"algorithm",void 0);_([P({type:M.BitString})],_S.prototype,"publicKey",void 0);let zl=class{constructor(e={}){Object.assign(this,e)}};_([P({type:Ya,context:0,implicit:!0,optional:!0})],zl.prototype,"subjectKeyIdentifier",void 0);_([P({type:_S,context:1,implicit:!0,optional:!0})],zl.prototype,"originatorKey",void 0);_([P({type:xh,optional:!0})],zl.prototype,"issuerAndSerialNumber",void 0);zl=_([te({type:X.Choice})],zl);class Ch{constructor(e={}){this.version=Co.v3,this.originator=new zl,this.keyEncryptionAlgorithm=new Ts,this.recipientEncryptedKeys=new m3,Object.assign(this,e)}}_([P({type:M.Integer})],Ch.prototype,"version",void 0);_([P({type:zl,context:0})],Ch.prototype,"originator",void 0);_([P({type:Ye,context:1,optional:!0})],Ch.prototype,"ukm",void 0);_([P({type:Ts})],Ch.prototype,"keyEncryptionAlgorithm",void 0);_([P({type:m3})],Ch.prototype,"recipientEncryptedKeys",void 0);let Zd=class{constructor(e={}){Object.assign(this,e)}};_([P({type:Ya,context:0,implicit:!0})],Zd.prototype,"subjectKeyIdentifier",void 0);_([P({type:xh})],Zd.prototype,"issuerAndSerialNumber",void 0);Zd=_([te({type:X.Choice})],Zd);class L0{constructor(e={}){this.version=Co.v0,this.rid=new Zd,this.keyEncryptionAlgorithm=new Ts,this.encryptedKey=new Ye,Object.assign(this,e)}}_([P({type:M.Integer})],L0.prototype,"version",void 0);_([P({type:Zd})],L0.prototype,"rid",void 0);_([P({type:Ts})],L0.prototype,"keyEncryptionAlgorithm",void 0);_([P({type:Ye})],L0.prototype,"encryptedKey",void 0);class M0{constructor(e={}){this.keyIdentifier=new Ye,Object.assign(this,e)}}_([P({type:Ye})],M0.prototype,"keyIdentifier",void 0);_([P({type:M.GeneralizedTime,optional:!0})],M0.prototype,"date",void 0);_([P({type:G4,optional:!0})],M0.prototype,"other",void 0);class U0{constructor(e={}){this.version=Co.v4,this.kekid=new M0,this.keyEncryptionAlgorithm=new Ts,this.encryptedKey=new Ye,Object.assign(this,e)}}_([P({type:M.Integer})],U0.prototype,"version",void 0);_([P({type:M0})],U0.prototype,"kekid",void 0);_([P({type:Ts})],U0.prototype,"keyEncryptionAlgorithm",void 0);_([P({type:Ye})],U0.prototype,"encryptedKey",void 0);class F0{constructor(e={}){this.version=Co.v0,this.keyEncryptionAlgorithm=new Ts,this.encryptedKey=new Ye,Object.assign(this,e)}}_([P({type:M.Integer})],F0.prototype,"version",void 0);_([P({type:Zb,context:0,optional:!0})],F0.prototype,"keyDerivationAlgorithm",void 0);_([P({type:Ts})],F0.prototype,"keyEncryptionAlgorithm",void 0);_([P({type:Ye})],F0.prototype,"encryptedKey",void 0);class TS{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],TS.prototype,"oriType",void 0);_([P({type:M.Any})],TS.prototype,"oriValue",void 0);let uc=class{constructor(e={}){Object.assign(this,e)}};_([P({type:L0,optional:!0})],uc.prototype,"ktri",void 0);_([P({type:Ch,context:1,implicit:!0,optional:!0})],uc.prototype,"kari",void 0);_([P({type:U0,context:2,implicit:!0,optional:!0})],uc.prototype,"kekri",void 0);_([P({type:F0,context:3,implicit:!0,optional:!0})],uc.prototype,"pwri",void 0);_([P({type:TS,context:4,implicit:!0,optional:!0})],uc.prototype,"ori",void 0);uc=_([te({type:X.Choice})],uc);var u9;let w3=u9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,u9.prototype)}};w3=u9=_([te({type:X.Set,itemType:uc})],w3);var d9;class Y4{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],Y4.prototype,"otherRevInfoFormat",void 0);_([P({type:M.Any})],Y4.prototype,"otherRevInfo",void 0);let b3=class{constructor(e={}){this.other=new Y4,Object.assign(this,e)}};_([P({type:Y4,context:1,implicit:!0})],b3.prototype,"other",void 0);b3=_([te({type:X.Choice})],b3);let v3=d9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,d9.prototype)}};v3=d9=_([te({type:X.Set,itemType:b3})],v3);class $S{constructor(e={}){Object.assign(this,e)}}_([P({type:y3,context:0,implicit:!0,optional:!0})],$S.prototype,"certs",void 0);_([P({type:v3,context:1,implicit:!0,optional:!0})],$S.prototype,"crls",void 0);var h9;let f9=h9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,h9.prototype)}};f9=h9=_([te({type:X.Set,itemType:Sh})],f9);class z0{constructor(e={}){this.version=Co.v0,this.recipientInfos=new w3,this.encryptedContentInfo=new B0,Object.assign(this,e)}}_([P({type:M.Integer})],z0.prototype,"version",void 0);_([P({type:$S,context:0,implicit:!0,optional:!0})],z0.prototype,"originatorInfo",void 0);_([P({type:w3})],z0.prototype,"recipientInfos",void 0);_([P({type:B0})],z0.prototype,"encryptedContentInfo",void 0);_([P({type:f9,context:1,implicit:!0,optional:!0})],z0.prototype,"unprotectedAttrs",void 0);const w6e="1.2.840.113549.1.7.2";var p9;let E3=p9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,p9.prototype)}};E3=p9=_([te({type:X.Set,itemType:z1})],E3);class kh{constructor(e={}){this.version=Co.v0,this.digestAlgorithms=new E3,this.encapContentInfo=new W4,this.signerInfos=new f3,Object.assign(this,e)}}_([P({type:M.Integer})],kh.prototype,"version",void 0);_([P({type:E3})],kh.prototype,"digestAlgorithms",void 0);_([P({type:W4})],kh.prototype,"encapContentInfo",void 0);_([P({type:y3,context:0,implicit:!0,optional:!0})],kh.prototype,"certificates",void 0);_([P({type:v3,context:1,implicit:!0,optional:!0})],kh.prototype,"crls",void 0);_([P({type:f3})],kh.prototype,"signerInfos",void 0);const j1="1.2.840.10045.2.1",PS="1.2.840.10045.4.1",xK="1.2.840.10045.4.3.1",DS="1.2.840.10045.4.3.2",NS="1.2.840.10045.4.3.3",OS="1.2.840.10045.4.3.4",h$="1.2.840.10045.3.1.7",f$="1.3.132.0.34",p$="1.3.132.0.35";function V0(r){return new ge({algorithm:r})}const b6e=V0(PS);V0(xK);const v6e=V0(DS),E6e=V0(NS),x6e=V0(OS);let H1=class{constructor(e={}){Object.assign(this,e)}};_([P({type:M.ObjectIdentifier})],H1.prototype,"fieldType",void 0);_([P({type:M.Any})],H1.prototype,"parameters",void 0);H1=_([te({type:X.Sequence})],H1);class S6e extends Ye{}let eh=class{constructor(e={}){Object.assign(this,e)}};_([P({type:M.OctetString})],eh.prototype,"a",void 0);_([P({type:M.OctetString})],eh.prototype,"b",void 0);_([P({type:M.BitString,optional:!0})],eh.prototype,"seed",void 0);eh=_([te({type:X.Sequence})],eh);var g9;(function(r){r[r.ecpVer1=1]="ecpVer1"})(g9||(g9={}));let ko=class{constructor(e={}){this.version=g9.ecpVer1,Object.assign(this,e)}};_([P({type:M.Integer})],ko.prototype,"version",void 0);_([P({type:H1})],ko.prototype,"fieldID",void 0);_([P({type:eh})],ko.prototype,"curve",void 0);_([P({type:S6e})],ko.prototype,"base",void 0);_([P({type:M.Integer,converter:xt})],ko.prototype,"order",void 0);_([P({type:M.Integer,optional:!0})],ko.prototype,"cofactor",void 0);ko=_([te({type:X.Sequence})],ko);let dc=class{constructor(e={}){Object.assign(this,e)}};_([P({type:M.ObjectIdentifier})],dc.prototype,"namedCurve",void 0);_([P({type:M.Null})],dc.prototype,"implicitCurve",void 0);_([P({type:ko})],dc.prototype,"specifiedCurve",void 0);dc=_([te({type:X.Choice})],dc);class J4{constructor(e={}){this.version=1,this.privateKey=new Ye,Object.assign(this,e)}}_([P({type:M.Integer})],J4.prototype,"version",void 0);_([P({type:Ye})],J4.prototype,"privateKey",void 0);_([P({type:dc,context:0,optional:!0})],J4.prototype,"parameters",void 0);_([P({type:M.BitString,context:1,optional:!0})],J4.prototype,"publicKey",void 0);class x3{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:M.Integer,converter:xt})],x3.prototype,"r",void 0);_([P({type:M.Integer,converter:xt})],x3.prototype,"s",void 0);const An="1.2.840.113549.1.1",Vl=`${An}.1`,A6e=`${An}.7`,C6e=`${An}.9`,Gf=`${An}.10`,k6e=`${An}.2`,I6e=`${An}.4`,S3=`${An}.5`,_6e=`${An}.14`,y9=`${An}.11`,A3=`${An}.12`,C3=`${An}.13`,SK=`${An}.15`,AK=`${An}.16`,k3="1.3.14.3.2.26",CK="2.16.840.1.101.3.4.2.4",I3="2.16.840.1.101.3.4.2.1",_3="2.16.840.1.101.3.4.2.2",T3="2.16.840.1.101.3.4.2.3",T6e="2.16.840.1.101.3.4.2.5",$6e="2.16.840.1.101.3.4.2.6",P6e="1.2.840.113549.2.2",D6e="1.2.840.113549.2.5",X4=`${An}.8`;function Qt(r){return new ge({algorithm:r,parameters:null})}Qt(P6e);Qt(D6e);const Kl=Qt(k3);Qt(CK);Qt(I3);Qt(_3);Qt(T3);Qt(T6e);Qt($6e);const kK=new ge({algorithm:X4,parameters:oe.serialize(Kl)}),IK=new ge({algorithm:C6e,parameters:oe.serialize(i3.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))});Qt(Vl);Qt(k6e);Qt(I6e);Qt(S3);Qt(SK);Qt(AK);Qt(A3);Qt(C3);Qt(SK);Qt(AK);class Z4{constructor(e={}){this.hashAlgorithm=new ge(Kl),this.maskGenAlgorithm=new ge({algorithm:X4,parameters:oe.serialize(Kl)}),this.pSourceAlgorithm=new ge(IK),Object.assign(this,e)}}_([P({type:ge,context:0,defaultValue:Kl})],Z4.prototype,"hashAlgorithm",void 0);_([P({type:ge,context:1,defaultValue:kK})],Z4.prototype,"maskGenAlgorithm",void 0);_([P({type:ge,context:2,defaultValue:IK})],Z4.prototype,"pSourceAlgorithm",void 0);new ge({algorithm:A6e,parameters:oe.serialize(new Z4)});class jl{constructor(e={}){this.hashAlgorithm=new ge(Kl),this.maskGenAlgorithm=new ge({algorithm:X4,parameters:oe.serialize(Kl)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}}_([P({type:ge,context:0,defaultValue:Kl})],jl.prototype,"hashAlgorithm",void 0);_([P({type:ge,context:1,defaultValue:kK})],jl.prototype,"maskGenAlgorithm",void 0);_([P({type:M.Integer,context:2,defaultValue:20})],jl.prototype,"saltLength",void 0);_([P({type:M.Integer,context:3,defaultValue:1})],jl.prototype,"trailerField",void 0);new ge({algorithm:Gf,parameters:oe.serialize(new jl)});class ew{constructor(e={}){this.digestAlgorithm=new ge,this.digest=new Ye,Object.assign(this,e)}}_([P({type:ge})],ew.prototype,"digestAlgorithm",void 0);_([P({type:Ye})],ew.prototype,"digest",void 0);var m9;class tw{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:M.Integer,converter:xt})],tw.prototype,"prime",void 0);_([P({type:M.Integer,converter:xt})],tw.prototype,"exponent",void 0);_([P({type:M.Integer,converter:xt})],tw.prototype,"coefficient",void 0);let w9=m9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,m9.prototype)}};w9=m9=_([te({type:X.Sequence,itemType:tw})],w9);class Bs{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:M.Integer})],Bs.prototype,"version",void 0);_([P({type:M.Integer,converter:xt})],Bs.prototype,"modulus",void 0);_([P({type:M.Integer,converter:xt})],Bs.prototype,"publicExponent",void 0);_([P({type:M.Integer,converter:xt})],Bs.prototype,"privateExponent",void 0);_([P({type:M.Integer,converter:xt})],Bs.prototype,"prime1",void 0);_([P({type:M.Integer,converter:xt})],Bs.prototype,"prime2",void 0);_([P({type:M.Integer,converter:xt})],Bs.prototype,"exponent1",void 0);_([P({type:M.Integer,converter:xt})],Bs.prototype,"exponent2",void 0);_([P({type:M.Integer,converter:xt})],Bs.prototype,"coefficient",void 0);_([P({type:w9,optional:!0})],Bs.prototype,"otherPrimeInfos",void 0);class RS{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:M.Integer,converter:xt})],RS.prototype,"modulus",void 0);_([P({type:M.Integer,converter:xt})],RS.prototype,"publicExponent",void 0);var b9;(function(r){r[r.Transient=0]="Transient",r[r.Singleton=1]="Singleton",r[r.ResolutionScoped=2]="ResolutionScoped",r[r.ContainerScoped=3]="ContainerScoped"})(b9||(b9={}));const cn=b9;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var v9=function(r,e){return v9=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},v9(r,e)};function BS(r,e){v9(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function N6e(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(d){try{l(n.next(d))}catch(h){o(h)}}function c(d){try{l(n.throw(d))}catch(h){o(h)}}function l(d){d.done?s(d.value):i(d.value).then(a,c)}l((n=n.apply(r,[])).next())})}function O6e(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(d){return c([l,d])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(d){l=[6,d],i=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Gp(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function $3(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s}function qc(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat($3(arguments[e]));return r}var R6e="injectionTokens";function B6e(r){var e=Reflect.getMetadata("design:paramtypes",r)||[],t=Reflect.getOwnMetadata(R6e,r)||{};return Object.keys(t).forEach(function(n){e[+n]=t[n]}),e}function _K(r){return!!r.useClass}function E9(r){return!!r.useFactory}var TK=function(){function r(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return r.prototype.createProxy=function(e){var t=this,n={},i=!1,s,o=function(){return i||(s=e(t.wrap()),i=!0),s};return new Proxy(n,this.createHandler(o))},r.prototype.createHandler=function(e){var t={},n=function(i){t[i]=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];s[0]=e();var a=Reflect[i];return a.apply(void 0,qc(s))}};return this.reflectMethods.forEach(n),t},r}();function Cu(r){return typeof r=="string"||typeof r=="symbol"}function L6e(r){return typeof r=="object"&&"token"in r&&"multiple"in r}function g$(r){return typeof r=="object"&&"token"in r&&"transform"in r}function M6e(r){return typeof r=="function"||r instanceof TK}function V2(r){return!!r.useToken}function K2(r){return r.useValue!=null}function U6e(r){return _K(r)||K2(r)||V2(r)||E9(r)}var LS=function(){function r(){this._registryMap=new Map}return r.prototype.entries=function(){return this._registryMap.entries()},r.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},r.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},r.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},r.prototype.setAll=function(e,t){this._registryMap.set(e,t)},r.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},r.prototype.clear=function(){this._registryMap.clear()},r.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},r}(),F6e=function(r){BS(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(LS),Qp=function(){function r(){this.scopedResolutions=new Map}return r}();function z6e(r,e){if(r===null)return"at position #"+e;var t=r.split(",")[e].trim();return'"'+t+'" at position #'+e}function V6e(r,e,t){return t===void 0&&(t="    "),qc([r],e.message.split(`
`).map(function(n){return t+n})).join(`
`)}function K6e(r,e,t){var n=$3(r.toString().match(/constructor\(([\w, ]+)\)/)||[],2),i=n[1],s=i===void 0?null:i,o=z6e(s,e);return V6e("Cannot inject the dependency "+o+' of "'+r.name+'" constructor. Reason:',t)}function j6e(r){if(typeof r.dispose!="function")return!1;var e=r.dispose;return!(e.length>0)}var H6e=function(r){BS(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(LS),q6e=function(r){BS(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(LS),W6e=function(){function r(){this.preResolution=new H6e,this.postResolution=new q6e}return r}(),$K=new Map,G6e=function(){function r(e){this.parent=e,this._registry=new F6e,this.interceptors=new W6e,this.disposed=!1,this.disposables=new Set}return r.prototype.register=function(e,t,n){n===void 0&&(n={lifecycle:cn.Transient}),this.ensureNotDisposed();var i;if(U6e(t)?i=t:i={useClass:t},V2(i))for(var s=[e],o=i;o!=null;){var a=o.useToken;if(s.includes(a))throw new Error("Token registration cycle detected! "+qc(s,[a]).join(" -> "));s.push(a);var c=this._registry.get(a);c&&V2(c.provider)?o=c.provider:o=null}if((n.lifecycle===cn.Singleton||n.lifecycle==cn.ContainerScoped||n.lifecycle==cn.ResolutionScoped)&&(K2(i)||E9(i)))throw new Error('Cannot use lifecycle "'+cn[n.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:i,options:n}),this},r.prototype.registerType=function(e,t){return this.ensureNotDisposed(),Cu(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},r.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},r.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),Cu(e)){if(Cu(t))return this.register(e,{useToken:t},{lifecycle:cn.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:cn.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var n=e;return t&&!Cu(t)&&(n=t),this.register(e,{useClass:n},{lifecycle:cn.Singleton})},r.prototype.resolve=function(e,t,n){t===void 0&&(t=new Qp),n===void 0&&(n=!1),this.ensureNotDisposed();var i=this.getRegistration(e);if(!i&&Cu(e)){if(n)return;throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"Single"),i){var s=this.resolveRegistration(i,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}if(M6e(e)){var s=this.construct(e,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},r.prototype.executePreResolutionInterceptor=function(e,t){var n,i;if(this.interceptors.preResolution.has(e)){var s=[];try{for(var o=Gp(this.interceptors.preResolution.getAll(e)),a=o.next();!a.done;a=o.next()){var c=a.value;c.options.frequency!="Once"&&s.push(c),c.callback(e,t)}}catch(l){n={error:l}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}this.interceptors.preResolution.setAll(e,s)}},r.prototype.executePostResolutionInterceptor=function(e,t,n){var i,s;if(this.interceptors.postResolution.has(e)){var o=[];try{for(var a=Gp(this.interceptors.postResolution.getAll(e)),c=a.next();!c.done;c=a.next()){var l=c.value;l.options.frequency!="Once"&&o.push(l),l.callback(e,t,n)}}catch(d){i={error:d}}finally{try{c&&!c.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}this.interceptors.postResolution.setAll(e,o)}},r.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===cn.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var n=e.options.lifecycle===cn.Singleton,i=e.options.lifecycle===cn.ContainerScoped,s=n||i,o;return K2(e.provider)?o=e.provider.useValue:V2(e.provider)?o=s?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):_K(e.provider)?o=s?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):E9(e.provider)?o=e.provider.useFactory(this):o=this.construct(e.provider,t),e.options.lifecycle===cn.ResolutionScoped&&t.scopedResolutions.set(e,o),o},r.prototype.resolveAll=function(e,t,n){var i=this;t===void 0&&(t=new Qp),n===void 0&&(n=!1),this.ensureNotDisposed();var s=this.getAllRegistrations(e);if(!s&&Cu(e)){if(n)return[];throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"All"),s){var o=s.map(function(c){return i.resolveRegistration(c,t)});return this.executePostResolutionInterceptor(e,o,"All"),o}var a=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,a,"All"),a},r.prototype.isRegistered=function(e,t){return t===void 0&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},r.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},r.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var n=Gp(this._registry.entries()),i=n.next();!i.done;i=n.next()){var s=$3(i.value,2),o=s[0],a=s[1];this._registry.setAll(o,a.filter(function(c){return!K2(c.provider)}).map(function(c){return c.instance=void 0,c}))}}catch(c){e={error:c}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},r.prototype.createChildContainer=function(){var e,t;this.ensureNotDisposed();var n=new r(this);try{for(var i=Gp(this._registry.entries()),s=i.next();!s.done;s=i.next()){var o=$3(s.value,2),a=o[0],c=o[1];c.some(function(l){var d=l.options;return d.lifecycle===cn.ContainerScoped})&&n._registry.setAll(a,c.map(function(l){return l.options.lifecycle===cn.ContainerScoped?{provider:l.provider,options:l.options}:l}))}}catch(l){e={error:l}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r.prototype.beforeResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:n})},r.prototype.afterResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:n})},r.prototype.dispose=function(){return N6e(this,void 0,void 0,function(){var e;return O6e(this,function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach(function(n){var i=n.dispose();i&&e.push(i)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},r.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},r.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},r.prototype.construct=function(e,t){var n=this;if(e instanceof TK)return e.createProxy(function(s){return n.resolve(s,t)});var i=function(){var s=$K.get(e);if(!s||s.length===0){if(e.length===0)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var o=s.map(n.resolveParams(t,e));return new(e.bind.apply(e,qc([void 0],o)))}();return j6e(i)&&this.disposables.add(i),i},r.prototype.resolveParams=function(e,t){var n=this;return function(i,s){var o,a,c;try{return L6e(i)?g$(i)?i.multiple?(o=n.resolve(i.transform)).transform.apply(o,qc([n.resolveAll(i.token,new Qp,i.isOptional)],i.transformArgs)):(a=n.resolve(i.transform)).transform.apply(a,qc([n.resolve(i.token,e,i.isOptional)],i.transformArgs)):i.multiple?n.resolveAll(i.token,new Qp,i.isOptional):n.resolve(i.token,e,i.isOptional):g$(i)?(c=n.resolve(i.transform,e)).transform.apply(c,qc([n.resolve(i.token,e)],i.transformArgs)):n.resolve(i,e)}catch(l){throw new Error(K6e(t,s,l))}}},r.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},r}(),wr=new G6e;function rw(r){return function(e){$K.set(e,B6e(e))}}if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var x9;class nw{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}}_([P({type:M.ObjectIdentifier})],nw.prototype,"attrId",void 0);_([P({type:M.Any,repeated:"set"})],nw.prototype,"attrValues",void 0);let y$=x9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,x9.prototype)}};y$=x9=_([te({type:X.Sequence,itemType:nw})],y$);var S9;let m$=S9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,S9.prototype)}};m$=S9=_([te({type:X.Sequence,itemType:Ah})],m$);class PK{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],PK.prototype,"certId",void 0);_([P({type:M.Any,context:0})],PK.prototype,"certValue",void 0);class DK{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],DK.prototype,"crlId",void 0);_([P({type:M.Any,context:0})],DK.prototype,"crltValue",void 0);class NK extends Ye{}let iw=class{constructor(e={}){this.encryptionAlgorithm=new ge,this.encryptedData=new NK,Object.assign(this,e)}};_([P({type:ge})],iw.prototype,"encryptionAlgorithm",void 0);_([P({type:NK})],iw.prototype,"encryptedData",void 0);var A9,C9;(function(r){r[r.v1=0]="v1"})(C9||(C9={}));class OK extends Ye{}let k9=A9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,A9.prototype)}};k9=A9=_([te({type:X.Sequence,itemType:Ao})],k9);class K0{constructor(e={}){this.version=C9.v1,this.privateKeyAlgorithm=new ge,this.privateKey=new OK,Object.assign(this,e)}}_([P({type:M.Integer})],K0.prototype,"version",void 0);_([P({type:ge})],K0.prototype,"privateKeyAlgorithm",void 0);_([P({type:OK})],K0.prototype,"privateKey",void 0);_([P({type:k9,implicit:!0,context:0,optional:!0})],K0.prototype,"attributes",void 0);let w$=class extends K0{};w$=_([te({type:X.Sequence})],w$);let b$=class extends iw{};b$=_([te({type:X.Sequence})],b$);class RK{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],RK.prototype,"secretTypeId",void 0);_([P({type:M.Any,context:0})],RK.prototype,"secretValue",void 0);class j0{constructor(e={}){this.mac=new ew,this.macSalt=new Ye,this.iterations=1,Object.assign(this,e)}}_([P({type:ew})],j0.prototype,"mac",void 0);_([P({type:Ye})],j0.prototype,"macSalt",void 0);_([P({type:M.Integer,defaultValue:1})],j0.prototype,"iterations",void 0);class sw{constructor(e={}){this.version=3,this.authSafe=new Ah,this.macData=new j0,Object.assign(this,e)}}_([P({type:M.Integer})],sw.prototype,"version",void 0);_([P({type:Ah})],sw.prototype,"authSafe",void 0);_([P({type:j0,optional:!0})],sw.prototype,"macData",void 0);var I9;class ow{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:M.ObjectIdentifier})],ow.prototype,"bagId",void 0);_([P({type:M.Any,context:0})],ow.prototype,"bagValue",void 0);_([P({type:nw,repeated:"set",optional:!0})],ow.prototype,"bagAttributes",void 0);let v$=I9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,I9.prototype)}};v$=I9=_([te({type:X.Sequence,itemType:ow})],v$);var _9,T9,$9;const BK="1.2.840.113549.1.9",LK=`${BK}.7`,MS=`${BK}.14`;let P3=class extends mr{constructor(e={}){super(e)}toString(){return this.ia5String||super.toString()}};_([P({type:M.IA5String})],P3.prototype,"ia5String",void 0);P3=_([te({type:X.Choice})],P3);let E$=class extends Ah{};E$=_([te({type:X.Sequence})],E$);let x$=class extends sw{};x$=_([te({type:X.Sequence})],x$);let S$=class extends iw{};S$=_([te({type:X.Sequence})],S$);let P9=class{constructor(e=""){this.value=e}toString(){return this.value}};_([P({type:M.IA5String})],P9.prototype,"value",void 0);P9=_([te({type:X.Choice})],P9);let A$=class extends P3{};A$=_([te({type:X.Choice})],A$);let C$=class extends mr{};C$=_([te({type:X.Choice})],C$);let D9=class{constructor(e=new Date){this.value=e}};_([P({type:M.GeneralizedTime})],D9.prototype,"value",void 0);D9=_([te({type:X.Choice})],D9);let k$=class extends mr{};k$=_([te({type:X.Choice})],k$);let N9=class{constructor(e="M"){this.value=e}toString(){return this.value}};_([P({type:M.PrintableString})],N9.prototype,"value",void 0);N9=_([te({type:X.Choice})],N9);let D3=class{constructor(e=""){this.value=e}toString(){return this.value}};_([P({type:M.PrintableString})],D3.prototype,"value",void 0);D3=_([te({type:X.Choice})],D3);let I$=class extends D3{};I$=_([te({type:X.Choice})],I$);let _$=class extends mr{};_$=_([te({type:X.Choice})],_$);let O9=class{constructor(e=""){this.value=e}toString(){return this.value}};_([P({type:M.ObjectIdentifier})],O9.prototype,"value",void 0);O9=_([te({type:X.Choice})],O9);let T$=class extends ur{};T$=_([te({type:X.Choice})],T$);let R9=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};_([P({type:M.Integer})],R9.prototype,"value",void 0);R9=_([te({type:X.Choice})],R9);let $$=class extends Rs{};$$=_([te({type:X.Sequence})],$$);let N3=class extends mr{};N3=_([te({type:X.Choice})],N3);let P$=_9=class extends lc{constructor(e){super(e),Object.setPrototypeOf(this,_9.prototype)}};P$=_9=_([te({type:X.Sequence})],P$);let D$=T9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,T9.prototype)}};D$=T9=_([te({type:X.Set,itemType:Sh})],D$);let B9=class{constructor(e=""){this.value=e}toString(){return this.value}};_([P({type:M.BmpString})],B9.prototype,"value",void 0);B9=_([te({type:X.Choice})],B9);let L9=class extends ge{};L9=_([te({type:X.Sequence})],L9);let N$=$9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,$9.prototype)}};N$=$9=_([te({type:X.Sequence,itemType:L9})],N$);var M9;let O3=M9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,M9.prototype)}};O3=M9=_([te({type:X.Sequence,itemType:Ao})],O3);class Ih{constructor(e={}){this.version=0,this.subject=new Ft,this.subjectPKInfo=new Vi,this.attributes=new O3,Object.assign(this,e)}}_([P({type:M.Integer})],Ih.prototype,"version",void 0);_([P({type:Ft})],Ih.prototype,"subject",void 0);_([P({type:Vi})],Ih.prototype,"subjectPKInfo",void 0);_([P({type:O3,implicit:!0,context:0})],Ih.prototype,"attributes",void 0);class q1{constructor(e={}){this.certificationRequestInfo=new Ih,this.signatureAlgorithm=new ge,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}_([P({type:Ih})],q1.prototype,"certificationRequestInfo",void 0);_([P({type:ge})],q1.prototype,"signatureAlgorithm",void 0);_([P({type:M.BitString})],q1.prototype,"signature",void 0);/*!
 * MIT License
 * 
 * Copyright (c) Peculiar Ventures. All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const H0="crypto.algorithm";class Q6e{getAlgorithms(){return wr.resolveAll(H0)}toAsnAlgorithm(e){({...e});for(const t of this.getAlgorithms()){const n=t.toAsnAlgorithm(e);if(n)return n}if(/^[0-9.]+$/.test(e.name)){const t=new ge({algorithm:e.name});if("parameters"in e){const n=e;t.parameters=n.parameters}return t}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(const n of this.getAlgorithms()){const i=n.toWebAlgorithm(e);if(i)return i}return{name:e.algorithm,parameters:e.parameters}}}const Hl="crypto.algorithmProvider";wr.registerSingleton(Hl,Q6e);var j2;const Cn="1.3.36.3.3.2.8.1.1",O$=`${Cn}.1`,R$=`${Cn}.2`,B$=`${Cn}.3`,L$=`${Cn}.4`,M$=`${Cn}.5`,U$=`${Cn}.6`,F$=`${Cn}.7`,z$=`${Cn}.8`,V$=`${Cn}.9`,K$=`${Cn}.10`,j$=`${Cn}.11`,H$=`${Cn}.12`,q$=`${Cn}.13`,W$=`${Cn}.14`,G$="brainpoolP160r1",Q$="brainpoolP160t1",Y$="brainpoolP192r1",J$="brainpoolP192t1",X$="brainpoolP224r1",Z$="brainpoolP224t1",eP="brainpoolP256r1",tP="brainpoolP256t1",rP="brainpoolP320r1",nP="brainpoolP320t1",iP="brainpoolP384r1",sP="brainpoolP384t1",oP="brainpoolP512r1",aP="brainpoolP512t1",Tt="ECDSA";let W1=j2=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case Tt.toLowerCase():if("hash"in e)switch((typeof e.hash=="string"?e.hash:e.hash.name).toLowerCase()){case"sha-1":return b6e;case"sha-256":return v6e;case"sha-384":return E6e;case"sha-512":return x6e}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t=h$;break;case"K-256":t=j2.SECP256K1;break;case"P-384":t=f$;break;case"P-521":t=p$;break;case G$:t=O$;break;case Q$:t=R$;break;case Y$:t=B$;break;case J$:t=L$;break;case X$:t=M$;break;case Z$:t=U$;break;case eP:t=F$;break;case tP:t=z$;break;case rP:t=V$;break;case nP:t=K$;break;case iP:t=j$;break;case sP:t=H$;break;case oP:t=q$;break;case aP:t=W$;break}if(t)return new ge({algorithm:j1,parameters:oe.serialize(new dc({namedCurve:t}))})}}return null}toWebAlgorithm(e){switch(e.algorithm){case PS:return{name:Tt,hash:{name:"SHA-1"}};case DS:return{name:Tt,hash:{name:"SHA-256"}};case NS:return{name:Tt,hash:{name:"SHA-384"}};case OS:return{name:Tt,hash:{name:"SHA-512"}};case j1:{if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(oe.parse(e.parameters,dc).namedCurve){case h$:return{name:Tt,namedCurve:"P-256"};case j2.SECP256K1:return{name:Tt,namedCurve:"K-256"};case f$:return{name:Tt,namedCurve:"P-384"};case p$:return{name:Tt,namedCurve:"P-521"};case O$:return{name:Tt,namedCurve:G$};case R$:return{name:Tt,namedCurve:Q$};case B$:return{name:Tt,namedCurve:Y$};case L$:return{name:Tt,namedCurve:J$};case M$:return{name:Tt,namedCurve:X$};case U$:return{name:Tt,namedCurve:Z$};case F$:return{name:Tt,namedCurve:eP};case z$:return{name:Tt,namedCurve:tP};case V$:return{name:Tt,namedCurve:rP};case K$:return{name:Tt,namedCurve:nP};case j$:return{name:Tt,namedCurve:iP};case H$:return{name:Tt,namedCurve:sP};case q$:return{name:Tt,namedCurve:oP};case W$:return{name:Tt,namedCurve:aP}}}}return null}};W1.SECP256K1="1.3.132.0.10";W1=j2=_([rw()],W1);wr.registerSingleton(H0,W1);const MK=Symbol("name"),UK=Symbol("value");class tt{constructor(e,t={},n=""){this[MK]=e,this[UK]=n;for(const i in t)this[i]=t[i]}}tt.NAME=MK;tt.VALUE=UK;class Y6e{static toTextObject(e){const t=new tt("Algorithm Identifier",{},xc.toString(e.algorithm));if(e.parameters)switch(e.algorithm){case j1:{const n=new W1().toWebAlgorithm(e);n&&"namedCurve"in n?t["Named Curve"]=n.namedCurve:t.Parameters=e.parameters;break}default:t.Parameters=e.parameters}return t}}class xc{static toString(e){const t=this.items[e];return t||e}}xc.items={[k3]:"sha1",[CK]:"sha224",[I3]:"sha256",[_3]:"sha384",[T3]:"sha512",[Vl]:"rsaEncryption",[S3]:"sha1WithRSAEncryption",[_6e]:"sha224WithRSAEncryption",[y9]:"sha256WithRSAEncryption",[A3]:"sha384WithRSAEncryption",[C3]:"sha512WithRSAEncryption",[j1]:"ecPublicKey",[PS]:"ecdsaWithSHA1",[xK]:"ecdsaWithSHA224",[DS]:"ecdsaWithSHA256",[NS]:"ecdsaWithSHA384",[OS]:"ecdsaWithSHA512",[h6e]:"TLS WWW server authentication",[f6e]:"TLS WWW client authentication",[p6e]:"Code Signing",[g6e]:"E-mail Protection",[y6e]:"Time Stamping",[m6e]:"OCSP Signing",[w6e]:"Signed Data"};class ql{static serialize(e){return this.serializeObj(e).join(`
`)}static pad(e=0){return"".padStart(2*e," ")}static serializeObj(e,t=0){const n=[];let i=this.pad(t++),s="";const o=e[tt.VALUE];o&&(s=` ${o}`),n.push(`${i}${e[tt.NAME]}:${s}`),i=this.pad(t);for(const a in e){if(typeof a=="symbol")continue;const c=e[a],l=a?`${a}: `:"";if(typeof c=="string"||typeof c=="number"||typeof c=="boolean")n.push(`${i}${l}${c}`);else if(c instanceof Date)n.push(`${i}${l}${c.toUTCString()}`);else if(Array.isArray(c))for(const d of c)d[tt.NAME]=a,n.push(...this.serializeObj(d,t));else if(c instanceof tt)c[tt.NAME]=a,n.push(...this.serializeObj(c,t));else if(le.isBufferSource(c))a?(n.push(`${i}${l}`),n.push(...this.serializeBufferSource(c,t+1))):n.push(...this.serializeBufferSource(c,t));else if("toTextObject"in c){const d=c.toTextObject();d[tt.NAME]=a,n.push(...this.serializeObj(d,t))}else throw new TypeError("Cannot serialize data in text format. Unsupported type.")}return n}static serializeBufferSource(e,t=0){const n=this.pad(t),i=le.toUint8Array(e),s=[];for(let o=0;o<i.length;){const a=[];for(let c=0;c<16&&o<i.length;c++){c===8&&a.push("");const l=i[o++].toString(16).padStart(2,"0");a.push(l)}s.push(`${n}${a.join(" ")}`)}return s}static serializeAlgorithm(e){return this.algorithmSerializer.toTextObject(e)}}ql.oidSerializer=xc;ql.algorithmSerializer=Y6e;class Sc{constructor(...e){if(e.length===1){const t=e[0];this.rawData=oe.serialize(t),this.onInit(t)}else{const t=oe.parse(e[0],e[1]);this.rawData=le.toArrayBuffer(e[0]),this.onInit(t)}}equal(e){return e instanceof Sc?Xz(e.rawData,this.rawData):!1}toString(e="text"){switch(e){case"asn":return oe.toString(this.rawData);case"text":return ql.serialize(this.toTextObject());case"hex":return Ee.ToHex(this.rawData);case"base64":return Ee.ToBase64(this.rawData);case"base64url":return Ee.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){const e=this.toTextObjectEmpty();return e[""]=this.rawData,e}toTextObjectEmpty(e){return new tt(this.getTextName(),{},e)}}Sc.NAME="ASN";class Si extends Sc{constructor(...e){let t;le.isBufferSource(e[0])?t=le.toArrayBuffer(e[0]):t=oe.serialize(new bi({extnID:e[0],critical:e[1],extnValue:new Ye(le.toArrayBuffer(e[2]))})),super(t,bi)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[tt.NAME]===Si.NAME&&(e[tt.NAME]=xc.toString(this.type)),e}}var FK;class Na{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&e.extractable!==void 0}constructor(){this.items=new Map,this[FK]="CryptoProvider",typeof self<"u"&&typeof crypto<"u"?this.set(Na.DEFAULT,crypto):typeof global<"u"&&global.crypto&&global.crypto.subtle&&this.set(Na.DEFAULT,global.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,t){return this.items.forEach(e,t)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=Na.DEFAULT){const t=this.items.get(e.toLowerCase());if(!t)throw new Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if(typeof e=="string"){if(!t)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),t)}else this.items.set(Na.DEFAULT,e);return this}}FK=Symbol.toStringTag;Na.DEFAULT="default";const cr=new Na,J6e=/^[0-2](?:\.[1-9][0-9]*)+$/;function X6e(r){return new RegExp(J6e).test(r)}class zK{constructor(e={}){this.items={};for(const t in e)this.register(t,e[t])}get(e){return this.items[e]||null}findId(e){return X6e(e)?e:this.get(e)}register(e,t){this.items[e]=t,this.items[t]=e}}const Sn=new zK;Sn.register("CN","2.5.4.3");Sn.register("L","2.5.4.7");Sn.register("ST","2.5.4.8");Sn.register("O","2.5.4.10");Sn.register("OU","2.5.4.11");Sn.register("C","2.5.4.6");Sn.register("DC","0.9.2342.19200300.100.1.25");Sn.register("E","1.2.840.113549.1.9.1");Sn.register("G","2.5.4.42");Sn.register("I","2.5.4.43");Sn.register("SN","2.5.4.4");Sn.register("T","2.5.4.12");function Z6e(r,e){return`\\${Ee.ToHex(Ee.FromUtf8String(e)).toUpperCase()}`}function e7e(r){return r.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,Z6e)}class fi{static isASCII(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!1;return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,t={}){this.extraNames=new zK,this.asn=new Ft;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const i=t[n];this.extraNames.register(n,i)}typeof e=="string"?this.asn=this.fromString(e):e instanceof Ft?this.asn=e:le.isBufferSource(e)?this.asn=oe.parse(e,Ft):this.asn=this.fromJSON(e)}getField(e){const t=this.extraNames.findId(e)||Sn.findId(e),n=[];for(const i of this.asn)for(const s of i)s.type===t&&n.push(s.value.toString());return n}getName(e){return this.extraNames.get(e)||Sn.get(e)}toString(){return this.asn.map(e=>e.map(t=>{const n=this.getName(t.type)||t.type,i=t.value.anyValue?`#${Ee.ToHex(t.value.anyValue)}`:e7e(t.value.toString());return`${n}=${i}`}).join("+")).join(", ")}toJSON(){var e;const t=[];for(const n of this.asn){const i={};for(const s of n){const o=this.getName(s.type)||s.type;(e=i[o])!==null&&e!==void 0||(i[o]=[]),i[o].push(s.value.anyValue?`#${Ee.ToHex(s.value.anyValue)}`:s.value.toString())}t.push(i)}return t}fromString(e){const t=new Ft,n=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g;let i=null,s=",";for(;i=n.exec(`${e},`);){let[,o,a]=i;const c=a[a.length-1];(c===","||c==="+")&&(a=a.slice(0,a.length-1),i[3]=c);const l=i[3];o=this.getTypeOid(o);const d=this.createAttribute(o,a);s==="+"?t[t.length-1].push(d):t.push(new Wd([d])),s=l}return t}fromJSON(e){const t=new Ft;for(const n of e){const i=new Wd;for(const s in n){const o=this.getTypeOid(s),a=n[s];for(const c of a){const l=this.createAttribute(o,c);i.push(l)}}t.push(i)}return t}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,t){const n=new B4({type:e});if(typeof t=="object")for(const i in t)switch(i){case"ia5String":n.value.ia5String=t[i];break;case"utf8String":n.value.utf8String=t[i];break;case"universalString":n.value.universalString=t[i];break;case"bmpString":n.value.bmpString=t[i];break;case"printableString":n.value.printableString=t[i];break}else if(t[0]==="#")n.value.anyValue=Ee.FromHex(t.slice(1));else{const i=this.processStringValue(t);e===this.getName("E")||e===this.getName("DC")?n.value.ia5String=i:fi.isPrintableString(i)?n.value.printableString=i:n.value.utf8String=i}return n}processStringValue(e){const t=/"(.*?[^\\])?"/.exec(e);return t&&(e=t[1]),e.replace(/\\0a/ig,`
`).replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return oe.serialize(this.asn)}async getThumbprint(...e){var t;let n,i="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(i=e[0]||i,n=e[1]||cr.get()):n=e[0]||cr.get(),await n.subtle.digest(i,this.toArrayBuffer())}}const VK="Cannot initialize GeneralName from ASN.1 data.",cP=`${VK} Unsupported string format in use.`,t7e=`${VK} Value doesn't match to GUID regular expression.`,lP=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,uP="1.3.6.1.4.1.311.25.1",dP="1.3.6.1.4.1.311.20.2.3",e5="dns",t5="dn",r5="email",n5="ip",i5="url",s5="guid",o5="upn",Yp="id";class Oa extends Sc{constructor(...e){let t;if(e.length===2)switch(e[0]){case t5:{const n=new fi(e[1]).toArrayBuffer(),i=oe.parse(n,Ft);t=new Ne({directoryName:i});break}case e5:t=new Ne({dNSName:e[1]});break;case r5:t=new Ne({rfc822Name:e[1]});break;case s5:{const n=new RegExp(lP,"i").exec(e[1]);if(!n)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");const i=n.slice(1).map((s,o)=>o<3?Ee.ToHex(new Uint8Array(Ee.FromHex(s)).reverse()):s).join("");t=new Ne({otherName:new F1({typeId:uP,value:oe.serialize(new Ye(Ee.FromHex(i)))})});break}case n5:t=new Ne({iPAddress:e[1]});break;case Yp:t=new Ne({registeredID:e[1]});break;case o5:{t=new Ne({otherName:new F1({typeId:dP,value:oe.serialize(sK.toASN(e[1]))})});break}case i5:t=new Ne({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else le.isBufferSource(e[0])?t=oe.parse(e[0],Ne):t=e[0];super(t)}onInit(e){if(e.dNSName!=null)this.type=e5,this.value=e.dNSName;else if(e.rfc822Name!=null)this.type=r5,this.value=e.rfc822Name;else if(e.iPAddress!=null)this.type=n5,this.value=e.iPAddress;else if(e.uniformResourceIdentifier!=null)this.type=i5,this.value=e.uniformResourceIdentifier;else if(e.registeredID!=null)this.type=Yp,this.value=e.registeredID;else if(e.directoryName!=null)this.type=t5,this.value=new fi(e.directoryName).toString();else if(e.otherName!=null)if(e.otherName.typeId===uP){this.type=s5;const t=oe.parse(e.otherName.value,Ye),n=new RegExp(lP,"i").exec(Ee.ToHex(t));if(!n)throw new Error(t7e);this.value=n.slice(1).map((i,s)=>s<3?Ee.ToHex(new Uint8Array(Ee.FromHex(i)).reverse()):i).join("-")}else if(e.otherName.typeId===dP)this.type=o5,this.value=oe.parse(e.otherName.value,mr).toString();else throw new Error(cP);else throw new Error(cP)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case t5:case e5:case s5:case n5:case Yp:case o5:case i5:e=this.type.toUpperCase();break;case r5:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let t=this.value;return this.type===Yp&&(t=xc.toString(t)),new tt(e,void 0,t)}}class G1 extends Sc{constructor(e){let t;if(e instanceof rn)t=e;else if(Array.isArray(e)){const n=[];for(const i of e)if(i instanceof Ne)n.push(i);else{const s=oe.parse(new Oa(i.type,i.value).rawData,Ne);n.push(s)}t=new rn(n)}else if(le.isBufferSource(e))t=oe.parse(e,rn);else throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(t)}onInit(e){const t=[];for(const n of e){let i=null;try{i=new Oa(n)}catch{continue}t.push(i)}this.items=t}toJSON(){return this.items.map(e=>e.toJSON())}toTextObject(){const e=super.toTextObjectEmpty();for(const t of this.items){const n=t.toTextObject();let i=e[n[tt.NAME]];Array.isArray(i)||(i=[],e[n[tt.NAME]]=i),i.push(n)}return e}}G1.NAME="GeneralNames";const Qf="-{5}",Q1="\\n",r7e=`[^${Q1}]+`,n7e=`${Qf}BEGIN (${r7e}(?=${Qf}))${Qf}`,i7e=`${Qf}END \\1${Qf}`,th="\\n",s7e=`[^:${Q1}]+`,o7e=`(?:[^${Q1}]+${th}(?: +[^${Q1}]+${th})*)`,a7e="[a-zA-Z0-9=+/]+",c7e=`(?:${a7e}${th})+`,hP=`${n7e}${th}(?:((?:${s7e}: ${o7e})+))?${th}?(${c7e})${i7e}`;class Bn{static isPem(e){return typeof e=="string"&&new RegExp(hP,"g").test(e)}static decodeWithHeaders(e){e=e.replace(/\r/g,"");const t=new RegExp(hP,"g"),n=[];let i=null;for(;i=t.exec(e);){const s=i[3].replace(new RegExp(`[${Q1}]+`,"g"),""),o={type:i[1],headers:[],rawData:Ee.FromBase64(s)},a=i[2];if(a){const c=a.split(new RegExp(th,"g"));let l=null;for(const d of c){const[h,p]=d.split(/:(.*)/);if(p===void 0){if(!l)throw new Error("Cannot parse PEM string. Incorrect header value");l.value+=h.trim()}else l&&o.headers.push(l),l={key:h,value:p.trim()}}l&&o.headers.push(l)}n.push(o)}return n}static decode(e){return this.decodeWithHeaders(e).map(n=>n.rawData)}static decodeFirst(e){const t=this.decode(e);if(!t.length)throw new RangeError("PEM string doesn't contain any objects");return t[0]}static encode(e,t){if(Array.isArray(e)){const n=new Array;return t?e.forEach(i=>{if(!le.isBufferSource(i))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");n.push(this.encodeStruct({type:t,rawData:le.toArrayBuffer(i)}))}):e.forEach(i=>{if(!("type"in i))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");n.push(this.encodeStruct(i))}),n.join(`
`)}else{if(!t)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:t,rawData:le.toArrayBuffer(e)})}}static encodeStruct(e){var t;const n=e.type.toLocaleUpperCase(),i=[];if(i.push(`-----BEGIN ${n}-----`),!((t=e.headers)===null||t===void 0)&&t.length){for(const l of e.headers)i.push(`${l.key}: ${l.value}`);i.push("")}const s=Ee.ToBase64(e.rawData);let o,a=0;const c=Array();for(;a<s.length&&(s.length-a<64?o=s.substring(a):(o=s.substring(a,a+64),a+=64),o.length!==0);)if(c.push(o),o.length<64)break;return i.push(...c),i.push(`-----END ${n}-----`),i.join(`
`)}}Bn.CertificateTag="CERTIFICATE";Bn.CrlTag="CRL";Bn.CertificateRequestTag="CERTIFICATE REQUEST";Bn.PublicKeyTag="PUBLIC KEY";Bn.PrivateKeyTag="PRIVATE KEY";class Io extends Sc{static isAsnEncoded(e){return le.isBufferSource(e)||typeof e=="string"}static toArrayBuffer(e){if(typeof e=="string"){if(Bn.isPem(e))return Bn.decode(e)[0];if(Ee.isHex(e))return Ee.FromHex(e);if(Ee.isBase64(e))return Ee.FromBase64(e);if(Ee.isBase64Url(e))return Ee.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}else{const t=Ee.ToBinary(e);return Bn.isPem(t)?Bn.decode(t)[0]:Ee.isHex(t)?Ee.FromHex(t):Ee.isBase64(t)?Ee.FromBase64(t):Ee.isBase64Url(t)?Ee.FromBase64Url(t):le.toArrayBuffer(e)}}constructor(...e){Io.isAsnEncoded(e[0])?super(Io.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){switch(e){case"pem":return Bn.encode(this.rawData,this.tag);default:return super.toString(e)}}}class Wi extends Io{static async create(e,t=cr.get()){if(e instanceof Wi)return e;if(Na.isCryptoKey(e)){if(e.type!=="public")throw new TypeError("Public key is required");const n=await t.subtle.exportKey("spki",e);return new Wi(n)}else{if(e.publicKey)return e.publicKey;if(le.isBufferSource(e))return new Wi(e);throw new TypeError("Unsupported PublicKeyType")}}constructor(e){Io.isAsnEncoded(e)?super(e,Vi):super(e),this.tag=Bn.PublicKeyTag}async export(...e){let t,n=["verify"],i={hash:"SHA-256",...this.algorithm};e.length>1?(i=e[0]||i,n=e[1]||n,t=e[2]||cr.get()):t=e[0]||cr.get();let s=this.rawData;const o=oe.parse(this.rawData,Vi);return o.algorithm.algorithm===Gf&&(s=l7e(o,s)),t.subtle.importKey("spki",s,i,!0,n)}onInit(e){const t=wr.resolve(Hl),n=this.algorithm=t.toWebAlgorithm(e.algorithm);switch(e.algorithm.algorithm){case Vl:{const i=oe.parse(e.subjectPublicKey,RS),s=le.toUint8Array(i.modulus);n.publicExponent=le.toUint8Array(i.publicExponent),n.modulusLength=(s[0]?s:s.slice(1)).byteLength<<3;break}}}async getThumbprint(...e){var t;let n,i="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(i=e[0]||i,n=e[1]||cr.get()):n=e[0]||cr.get(),await n.subtle.digest(i,this.rawData)}async getKeyIdentifier(...e){let t,n="SHA-1";e.length===1?typeof e[0]=="string"?(n=e[0],t=cr.get()):t=e[0]:e.length===2?(n=e[0],t=e[1]):t=cr.get();const i=oe.parse(this.rawData,Vi);return await t.subtle.digest(n,i.subjectPublicKey)}toTextObject(){const e=this.toTextObjectEmpty(),t=oe.parse(this.rawData,Vi);switch(e.Algorithm=ql.serializeAlgorithm(t.algorithm),t.algorithm.algorithm){case j1:e["EC Point"]=t.subjectPublicKey;break;case Vl:default:e["Raw Data"]=t.subjectPublicKey}return e}}function l7e(r,e){return r.algorithm=new ge({algorithm:Vl,parameters:null}),e=oe.serialize(r),e}class Y1 extends Si{static async create(e,t=!1,n=cr.get()){if("name"in e&&"serialNumber"in e)return new Y1(e,t);const s=await(await Wi.create(e,n)).getKeyIdentifier(n);return new Y1(Ee.ToHex(s),t)}constructor(...e){if(le.isBufferSource(e[0]))super(e[0]);else if(typeof e[0]=="string"){const t=new el({keyIdentifier:new yS(Ee.FromHex(e[0]))});super(Ob,e[1],oe.serialize(t))}else{const t=e[0],n=t.name instanceof G1?oe.parse(t.name.rawData,rn):t.name,i=new el({authorityCertIssuer:n,authorityCertSerialNumber:Ee.FromHex(t.serialNumber)});super(Ob,e[1],oe.serialize(i))}}onInit(e){super.onInit(e);const t=oe.parse(e.extnValue,el);t.keyIdentifier&&(this.keyId=Ee.ToHex(t.keyIdentifier)),(t.authorityCertIssuer||t.authorityCertSerialNumber)&&(this.certId={name:t.authorityCertIssuer||[],serialNumber:t.authorityCertSerialNumber?Ee.ToHex(t.authorityCertSerialNumber):""})}toTextObject(){const e=this.toTextObjectWithoutValue(),t=oe.parse(this.value,el);return t.authorityCertIssuer&&(e["Authority Issuer"]=new G1(t.authorityCertIssuer).toTextObject()),t.authorityCertSerialNumber&&(e["Authority Serial Number"]=t.authorityCertSerialNumber),t.keyIdentifier&&(e[""]=t.keyIdentifier),e}}Y1.NAME="Authority Key Identifier";class US extends Si{constructor(...e){if(le.isBufferSource(e[0])){super(e[0]);const t=oe.parse(this.value,s3);this.ca=t.cA,this.pathLength=t.pathLenConstraint}else{const t=new s3({cA:e[0],pathLenConstraint:e[1]});super(aK,e[2],oe.serialize(t)),this.ca=e[0],this.pathLength=e[1]}}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ca&&(e.CA=this.ca),this.pathLength!==void 0&&(e["Path Length"]=this.pathLength),e}}US.NAME="Basic Constraints";var fP;(function(r){r.serverAuth="1.3.6.1.5.5.7.3.1",r.clientAuth="1.3.6.1.5.5.7.3.2",r.codeSigning="1.3.6.1.5.5.7.3.3",r.emailProtection="1.3.6.1.5.5.7.3.4",r.timeStamping="1.3.6.1.5.5.7.3.8",r.ocspSigning="1.3.6.1.5.5.7.3.9"})(fP||(fP={}));class KK extends Si{constructor(...e){if(le.isBufferSource(e[0])){super(e[0]);const t=oe.parse(this.value,l3);this.usages=t.map(n=>n)}else{const t=new l3(e[0]);super(uK,e[1],oe.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.usages.map(t=>xc.toString(t)).join(", "),e}}KK.NAME="Extended Key Usages";var pP;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(pP||(pP={}));class jK extends Si{constructor(...e){if(le.isBufferSource(e[0])){super(e[0]);const t=oe.parse(this.value,Z8);this.usages=t.toNumber()}else{const t=new Z8(e[0]);super(dK,e[1],oe.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=oe.parse(this.value,Z8);return e[""]=t.toJSON().join(", "),e}}jK.NAME="Key Usages";class aw extends Si{static async create(e,t=!1,n=cr.get()){const s=await(await Wi.create(e,n)).getKeyIdentifier(n);return new aw(Ee.ToHex(s),t)}constructor(...e){if(le.isBufferSource(e[0])){super(e[0]);const t=oe.parse(this.value,Ya);this.keyId=Ee.ToHex(t)}else{const t=typeof e[0]=="string"?Ee.FromHex(e[0]):e[0],n=new Ya(t);super(gK,e[1],oe.serialize(n)),this.keyId=Ee.ToHex(t)}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=oe.parse(this.value,Ya);return e[""]=t,e}}aw.NAME="Subject Key Identifier";class HK extends Si{constructor(...e){le.isBufferSource(e[0])?super(e[0]):super(pK,e[1],new G1(e[0]||[]).rawData)}onInit(e){super.onInit(e);const t=oe.parse(e.extnValue,Qb);this.names=new G1(t)}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.names.toTextObject();for(const n in t)e[n]=t[n];return e}}HK.NAME="Subject Alternative Name";class Ai{static register(e,t){this.items.set(e,t)}static create(e){const t=new Si(e),n=this.items.get(t.type);return n?new n(e):t}}Ai.items=new Map;class qK extends Si{constructor(...e){var t;if(le.isBufferSource(e[0])){super(e[0]);const n=oe.parse(this.value,a3);this.policies=n.map(i=>i.policyIdentifier)}else{const n=e[0],i=(t=e[1])!==null&&t!==void 0?t:!1,s=new a3(n.map(o=>new M4({policyIdentifier:o})));super(cK,i,oe.serialize(s)),this.policies=n}}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Policy=this.policies.map(t=>new tt("",{},xc.toString(t))),e}}qK.NAME="Certificate Policies";Ai.register(cK,qK);class WK extends Si{constructor(...e){var t;if(le.isBufferSource(e[0]))super(e[0]);else if(Array.isArray(e[0])&&typeof e[0][0]=="string"){const i=e[0].map(o=>new Eh({distributionPoint:new Ml({fullName:[new Ne({uniformResourceIdentifier:o})]})})),s=new rd(i);super(Ub,e[1],oe.serialize(s))}else{const n=new rd(e[0]);super(Ub,e[1],oe.serialize(n))}(t=this.distributionPoints)!==null&&t!==void 0||(this.distributionPoints=[])}onInit(e){super.onInit(e);const t=oe.parse(e.extnValue,rd);this.distributionPoints=t}toTextObject(){const e=this.toTextObjectWithoutValue();return e["Distribution Point"]=this.distributionPoints.map(t=>{var n;const i={};return t.distributionPoint&&(i[""]=(n=t.distributionPoint.fullName)===null||n===void 0?void 0:n.map(s=>new Oa(s).toString()).join(", ")),t.reasons&&(i.Reasons=t.reasons.toString()),t.cRLIssuer&&(i["CRL Issuer"]=t.cRLIssuer.map(s=>s.toString()).join(", ")),i}),e}}WK.NAME="CRL Distribution Points";class GK extends Si{constructor(...e){var t,n,i,s;if(le.isBufferSource(e[0]))super(e[0]);else if(e[0]instanceof Uu){const o=new Uu(e[0]);super(Nb,e[1],oe.serialize(o))}else{const o=e[0],a=new Uu;Xp(a,o,JT,"ocsp"),Xp(a,o,XT,"caIssuers"),Xp(a,o,ZT,"timeStamping"),Xp(a,o,e$,"caRepository"),super(Nb,e[1],oe.serialize(a))}(t=this.ocsp)!==null&&t!==void 0||(this.ocsp=[]),(n=this.caIssuers)!==null&&n!==void 0||(this.caIssuers=[]),(i=this.timeStamping)!==null&&i!==void 0||(this.timeStamping=[]),(s=this.caRepository)!==null&&s!==void 0||(this.caRepository=[])}onInit(e){super.onInit(e),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],oe.parse(e.extnValue,Uu).forEach(n=>{switch(n.accessMethod){case JT:this.ocsp.push(new Oa(n.accessLocation));break;case XT:this.caIssuers.push(new Oa(n.accessLocation));break;case ZT:this.timeStamping.push(new Oa(n.accessLocation));break;case e$:this.caRepository.push(new Oa(n.accessLocation));break}})}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ocsp.length&&Jp(e,"OCSP",this.ocsp),this.caIssuers.length&&Jp(e,"CA Issuers",this.caIssuers),this.timeStamping.length&&Jp(e,"Time Stamping",this.timeStamping),this.caRepository.length&&Jp(e,"CA Repository",this.caRepository),e}}GK.NAME="Authority Info Access";function Jp(r,e,t){if(t.length===1)r[e]=t[0].toTextObject();else{const n=new tt("");t.forEach((i,s)=>{const o=i.toTextObject(),a=`${o[tt.NAME]} ${s+1}`;let c=n[a];Array.isArray(c)||(c=[],n[a]=c),c.push(o)}),r[e]=n}}function Xp(r,e,t,n){const i=e[n];i&&(Array.isArray(i)?i:[i]).forEach(o=>{typeof o=="string"&&(o=new Oa("url",o)),r.push(new N0({accessMethod:t,accessLocation:oe.parse(o.rawData,Ne)}))})}class _h extends Sc{constructor(...e){let t;if(le.isBufferSource(e[0]))t=le.toArrayBuffer(e[0]);else{const n=e[0],i=Array.isArray(e[1])?e[1].map(s=>le.toArrayBuffer(s)):[];t=oe.serialize(new Ao({type:n,values:i}))}super(t,Ao)}onInit(e){this.type=e.type,this.values=e.values}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Value=this.values.map(t=>new tt("",{"":t})),e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty();return e[tt.NAME]===_h.NAME&&(e[tt.NAME]=xc.toString(this.type)),e}}_h.NAME="Attribute";class QK extends _h{constructor(...e){var t;if(le.isBufferSource(e[0]))super(e[0]);else{const n=new N3({printableString:e[0]});super(LK,[oe.serialize(n)])}(t=this.password)!==null&&t!==void 0||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){const t=oe.parse(this.values[0],N3);this.password=t.toString()}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[tt.VALUE]=this.password,e}}QK.NAME="Challenge Password";class FS extends _h{constructor(...e){var t;if(le.isBufferSource(e[0]))super(e[0]);else{const n=e[0],i=new lc;for(const s of n)i.push(oe.parse(s.rawData,bi));super(MS,[oe.serialize(i)])}(t=this.items)!==null&&t!==void 0||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){const t=oe.parse(this.values[0],lc);this.items=t.map(n=>Ai.create(oe.serialize(n)))}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.items.map(n=>n.toTextObject());for(const n of t)e[n[tt.NAME]]=n;return e}}FS.NAME="Extensions";class cw{static register(e,t){this.items.set(e,t)}static create(e){const t=new _h(e),n=this.items.get(t.type);return n?new n(e):t}}cw.items=new Map;const q0="crypto.signatureFormatter";class u7e{toAsnSignature(e,t){return le.toArrayBuffer(t)}toWebSignature(e,t){return le.toArrayBuffer(t)}}var H2;let U9=H2=class{static createPssParams(e,t){const n=H2.getHashAlgorithm(e);return n?new jl({hashAlgorithm:n,maskGenAlgorithm:new ge({algorithm:X4,parameters:oe.serialize(n)}),saltLength:t}):null}static getHashAlgorithm(e){const t=wr.resolve(Hl);return typeof e=="string"?t.toAsnAlgorithm({name:e}):typeof e=="object"&&e&&"name"in e?t.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if("hash"in e){let t;if(typeof e.hash=="string")t=e.hash;else if(e.hash&&typeof e.hash=="object"&&"name"in e.hash&&typeof e.hash.name=="string")t=e.hash.name.toUpperCase();else throw new Error("Cannot get hash algorithm name");switch(t.toLowerCase()){case"sha-1":return new ge({algorithm:S3,parameters:null});case"sha-256":return new ge({algorithm:y9,parameters:null});case"sha-384":return new ge({algorithm:A3,parameters:null});case"sha-512":return new ge({algorithm:C3,parameters:null})}}else return new ge({algorithm:Vl,parameters:null});break;case"rsa-pss":if("hash"in e){if(!("saltLength"in e&&typeof e.saltLength=="number"))throw new Error("Cannot get 'saltLength' from 'alg' argument");const t=H2.createPssParams(e.hash,e.saltLength);if(!t)throw new Error("Cannot create PSS parameters");return new ge({algorithm:Gf,parameters:oe.serialize(t)})}else return new ge({algorithm:Gf,parameters:null})}return null}toWebAlgorithm(e){switch(e.algorithm){case Vl:return{name:"RSASSA-PKCS1-v1_5"};case S3:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case y9:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case A3:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case C3:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case Gf:if(e.parameters){const t=oe.parse(e.parameters,jl);return{name:"RSA-PSS",hash:wr.resolve(Hl).toWebAlgorithm(t.hashAlgorithm),saltLength:t.saltLength}}else return{name:"RSA-PSS"}}return null}};U9=H2=_([rw()],U9);wr.registerSingleton(H0,U9);let F9=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new ge({algorithm:k3});case"sha-256":return new ge({algorithm:I3});case"sha-384":return new ge({algorithm:_3});case"sha-512":return new ge({algorithm:T3})}return null}toWebAlgorithm(e){switch(e.algorithm){case k3:return{name:"SHA-1"};case I3:return{name:"SHA-256"};case _3:return{name:"SHA-384"};case T3:return{name:"SHA-512"}}return null}};F9=_([rw()],F9);wr.registerSingleton(H0,F9);class pi{addPadding(e,t){const n=le.toUint8Array(t),i=new Uint8Array(e);return i.set(n,e-n.length),i}removePadding(e,t=!1){let n=le.toUint8Array(e);for(let i=0;i<n.length;i++)if(n[i]){n=n.slice(i);break}if(t&&n[0]>127){const i=new Uint8Array(n.length+1);return i.set(n,1),i.buffer}return n.buffer}toAsnSignature(e,t){if(e.name==="ECDSA"){const n=e.namedCurve,i=pi.namedCurveSize.get(n)||pi.defaultNamedCurveSize,s=new x3,o=le.toUint8Array(t);return s.r=this.removePadding(o.slice(0,i),!0),s.s=this.removePadding(o.slice(i,i+i),!0),oe.serialize(s)}return null}toWebSignature(e,t){if(e.name==="ECDSA"){const n=oe.parse(t,x3),i=e.namedCurve,s=pi.namedCurveSize.get(i)||pi.defaultNamedCurveSize,o=this.addPadding(s,this.removePadding(n.r)),a=this.addPadding(s,this.removePadding(n.s));return Xwe(o,a)}return null}}pi.namedCurveSize=new Map;pi.defaultNamedCurveSize=32;const a5="1.3.101.110",gP="1.3.101.111",c5="1.3.101.112",yP="1.3.101.113";let z9=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"ed25519":t=c5;break;case"x25519":t=a5;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t=c5;break;case"ed448":t=yP;break}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t=a5;break;case"x448":t=gP;break}}return t?new ge({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case c5:return{name:"Ed25519"};case yP:return{name:"EdDSA",namedCurve:"Ed448"};case a5:return{name:"X25519"};case gP:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};z9=_([rw()],z9);wr.registerSingleton(H0,z9);class d7e extends Io{constructor(e){Io.isAsnEncoded(e)?super(e,q1):super(e),this.tag=Bn.CertificateRequestTag}onInit(e){this.tbs=oe.serialize(e.certificationRequestInfo),this.publicKey=new Wi(e.certificationRequestInfo.subjectPKInfo);const t=wr.resolve(Hl);this.signatureAlgorithm=t.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signature,this.attributes=e.certificationRequestInfo.attributes.map(i=>cw.create(oe.serialize(i)));const n=this.getAttribute(MS);this.extensions=[],n instanceof FS&&(this.extensions=n.items),this.subjectName=new fi(e.certificationRequestInfo.subject),this.subject=this.subjectName.toString()}getAttribute(e){for(const t of this.attributes)if(t.type===e)return t;return null}getAttributes(e){return this.attributes.filter(t=>t.type===e)}getExtension(e){for(const t of this.extensions)if(t.type===e)return t;return null}getExtensions(e){return this.extensions.filter(t=>t.type===e)}async verify(e=cr.get()){const t={...this.publicKey.algorithm,...this.signatureAlgorithm},n=await this.publicKey.export(t,["verify"],e),i=wr.resolveAll(q0).reverse();let s=null;for(const a of i)if(s=a.toWebSignature(t,this.signature),s)break;if(!s)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await e.subtle.verify(this.signatureAlgorithm,n,s,this.tbs)}toTextObject(){const e=this.toTextObjectEmpty(),t=oe.parse(this.rawData,q1),n=t.certificationRequestInfo,i=new tt("",{Version:`${Ul[n.version]} (${n.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){const s=new tt("");for(const o of this.attributes){const a=o.toTextObject();s[a[tt.NAME]]=a}i.Attributes=s}return e.Data=i,e.Signature=new tt("",{Algorithm:ql.serializeAlgorithm(t.signatureAlgorithm),"":t.signature}),e}}d7e.NAME="PKCS#10 Certificate Request";class zS extends Io{constructor(e){Io.isAsnEncoded(e)?super(e,Fl):super(e),this.tag=Bn.CertificateTag}onInit(e){const t=e.tbsCertificate;this.tbs=oe.serialize(t),this.serialNumber=Ee.ToHex(t.serialNumber),this.subjectName=new fi(t.subject),this.subject=new fi(t.subject).toString(),this.issuerName=new fi(t.issuer),this.issuer=this.issuerName.toString();const n=wr.resolve(Hl);this.signatureAlgorithm=n.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signatureValue;const i=t.validity.notBefore.utcTime||t.validity.notBefore.generalTime;if(!i)throw new Error("Cannot get 'notBefore' value");this.notBefore=i;const s=t.validity.notAfter.utcTime||t.validity.notAfter.generalTime;if(!s)throw new Error("Cannot get 'notAfter' value");this.notAfter=s,this.extensions=[],t.extensions&&(this.extensions=t.extensions.map(o=>Ai.create(oe.serialize(o)))),this.publicKey=new Wi(t.subjectPublicKeyInfo)}getExtension(e){for(const t of this.extensions)if(typeof e=="string"){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter(t=>typeof e=="string"?t.type===e:t instanceof e)}async verify(e={},t=cr.get()){let n,i;const s=e.publicKey;try{if(!s)n={...this.publicKey.algorithm,...this.signatureAlgorithm},i=await this.publicKey.export(n,["verify"],t);else if("publicKey"in s)n={...s.publicKey.algorithm,...this.signatureAlgorithm},i=await s.publicKey.export(n,["verify"],t);else if(s instanceof Wi)n={...s.algorithm,...this.signatureAlgorithm},i=await s.export(n,["verify"],t);else if(le.isBufferSource(s)){const l=new Wi(s);n={...l.algorithm,...this.signatureAlgorithm},i=await l.export(n,["verify"],t)}else n={...s.algorithm,...this.signatureAlgorithm},i=s}catch{return!1}const o=wr.resolveAll(q0).reverse();let a=null;for(const l of o)if(a=l.toWebSignature(n,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");const c=await t.subtle.verify(this.signatureAlgorithm,i,a,this.tbs);if(e.signatureOnly)return c;{const d=(e.date||new Date).getTime();return c&&this.notBefore.getTime()<d&&d<this.notAfter.getTime()}}async getThumbprint(...e){let t,n="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(n=e[0]||n,t=e[1])),t??(t=cr.get()),await t.subtle.digest(n,this.rawData)}async isSelfSigned(e=cr.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},e)}toTextObject(){const e=this.toTextObjectEmpty(),t=oe.parse(this.rawData,Fl),n=t.tbsCertificate,i=new tt("",{Version:`${Ul[n.version]} (${n.version})`,"Serial Number":n.serialNumber,"Signature Algorithm":ql.serializeAlgorithm(n.signature),Issuer:this.issuer,Validity:new tt("",{"Not Before":n.validity.notBefore.getTime(),"Not After":n.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(n.issuerUniqueID&&(i["Issuer Unique ID"]=n.issuerUniqueID),n.subjectUniqueID&&(i["Subject Unique ID"]=n.subjectUniqueID),this.extensions.length){const s=new tt("");for(const o of this.extensions){const a=o.toTextObject();s[a[tt.NAME]]=a}i.Extensions=s}return e.Data=i,e.Signature=new tt("",{Algorithm:ql.serializeAlgorithm(t.signatureAlgorithm),"":t.signatureValue}),e}}zS.NAME="Certificate";class h7e{static async createSelfSigned(e,t=cr.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},t)}static async create(e,t=cr.get()){var n;let i;e.publicKey instanceof Wi?i=e.publicKey.rawData:"publicKey"in e.publicKey?i=e.publicKey.publicKey.rawData:le.isBufferSource(e.publicKey)?i=e.publicKey:i=await t.subtle.exportKey("spki",e.publicKey);const s=e.serialNumber?le.toUint8Array(Ee.FromHex(e.serialNumber)):t.getRandomValues(new Uint8Array(16));s[0]>127&&(s[0]&=127),s.length>1&&s[0]===0&&(s[1]|=128);const o=e.notBefore||new Date,a=e.notAfter||new Date(o.getTime()+31536e6),c=new Fl({tbsCertificate:new Jn({version:Ul.v3,serialNumber:s,validity:new O0({notBefore:o,notAfter:a}),extensions:new lc(((n=e.extensions)===null||n===void 0?void 0:n.map(v=>oe.parse(v.rawData,bi)))||[]),subjectPublicKeyInfo:oe.parse(i,Vi)})});if(e.subject){const v=e.subject instanceof fi?e.subject:new fi(e.subject);c.tbsCertificate.subject=oe.parse(v.toArrayBuffer(),Ft)}if(e.issuer){const v=e.issuer instanceof fi?e.issuer:new fi(e.issuer);c.tbsCertificate.issuer=oe.parse(v.toArrayBuffer(),Ft)}const l={hash:"SHA-256"},d="signingKey"in e?{...l,...e.signingAlgorithm,...e.signingKey.algorithm}:{...l,...e.signingAlgorithm},h=wr.resolve(Hl);c.tbsCertificate.signature=c.signatureAlgorithm=h.toAsnAlgorithm(d);const p=oe.serialize(c.tbsCertificate),b="signingKey"in e?await t.subtle.sign(d,e.signingKey,p):e.signature,f=wr.resolveAll(q0).reverse();let g=null;for(const v of f)if(g=v.toAsnSignature(d,b),g)break;if(!g)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return c.signatureValue=g,new zS(oe.serialize(c))}}var mP;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(mP||(mP={}));Ai.register(aK,US);Ai.register(uK,KK);Ai.register(dK,jK);Ai.register(gK,aw);Ai.register(Ob,Y1);Ai.register(pK,HK);Ai.register(Ub,WK);Ai.register(Nb,GK);cw.register(LK,QK);cw.register(MS,FS);wr.registerSingleton(q0,u7e);wr.registerSingleton(q0,pi);pi.namedCurveSize.set("P-256",32);pi.namedCurveSize.set("K-256",32);pi.namedCurveSize.set("P-384",48);pi.namedCurveSize.set("P-521",66);function YK(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function f7e(r){return new TextEncoder().encode(r)}function p7e(r){return new TextDecoder().decode(r)}function g7e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var y7e=g7e,m7e=y7e;let w7e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},b7e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return JK(this,e)}},v7e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return JK(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function JK(r,e){return new v7e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let E7e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new w7e(e,t,n),this.decoder=new b7e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function lw({name:r,prefix:e,encode:t,decode:n}){return new E7e(r,e,t,n)}function W0({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=m7e(t,r);return lw({prefix:e,name:r,encode:n,decode:s=>YK(i(s))})}function x7e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function S7e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Er({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return lw({prefix:e,name:r,encode(i){return S7e(i,n,t)},decode(i){return x7e(i,n,t,r)}})}const A7e=Er({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),C7e=Er({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),VS=Er({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),k7e=Er({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),I7e=Object.freeze(Object.defineProperty({__proto__:null,base64:A7e,base64pad:C7e,base64url:VS,base64urlpad:k7e},Symbol.toStringTag,{value:"Module"}));var _7e=XK,wP=128,T7e=-128,$7e=Math.pow(2,31);function XK(r,e,t){e=e||[],t=t||0;for(var n=t;r>=$7e;)e[t++]=r&255|wP,r/=128;for(;r&T7e;)e[t++]=r&255|wP,r>>>=7;return e[t]=r|0,XK.bytes=t-n+1,e}var P7e=V9,D7e=128,bP=127;function V9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw V9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&bP)<<i:(o&bP)*Math.pow(2,i),i+=7}while(o>=D7e);return V9.bytes=s-n,t}var N7e=Math.pow(2,7),O7e=Math.pow(2,14),R7e=Math.pow(2,21),B7e=Math.pow(2,28),L7e=Math.pow(2,35),M7e=Math.pow(2,42),U7e=Math.pow(2,49),F7e=Math.pow(2,56),z7e=Math.pow(2,63),V7e=function(r){return r<N7e?1:r<O7e?2:r<R7e?3:r<B7e?4:r<L7e?5:r<M7e?6:r<U7e?7:r<F7e?8:r<z7e?9:10},K7e={encode:_7e,decode:P7e,encodingLength:V7e},R3=K7e;function vP(r,e=0){return[R3.decode(r,e),R3.decode.bytes]}function EP(r,e,t=0){return R3.encode(r,e,t),e}function xP(r){return R3.encodingLength(r)}function B3(r,e){const t=e.byteLength,n=xP(r),i=n+xP(t),s=new Uint8Array(i+t);return EP(r,s,0),EP(t,s,n),s.set(e,i),new ZK(r,t,e,s)}function j7e(r){const e=YK(r),[t,n]=vP(e),[i,s]=vP(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new ZK(t,i,o,e)}let ZK=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function H7e({name:r,code:e,encode:t}){return new q7e(r,e,t)}class q7e{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?B3(this.code,t):t.then(n=>B3(this.code,n))}else throw Error("Unknown type, must be binary type")}}function W7e(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const KS=H7e({name:"sha2-256",code:18,encode:W7e("SHA-256")});class G7e extends Gt{async listen(){throw new N5e("WebRTCTransport.createListener")}getAddrs(){return[]}updateAnnounceAddrs(){}async close(){}}const Q7e=W0({prefix:"9",name:"base10",alphabet:"0123456789"}),Y7e=Object.freeze(Object.defineProperty({__proto__:null,base10:Q7e},Symbol.toStringTag,{value:"Module"})),J7e=Er({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),X7e=Er({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Z7e=Object.freeze(Object.defineProperty({__proto__:null,base16:J7e,base16upper:X7e},Symbol.toStringTag,{value:"Module"})),ebe=Er({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),tbe=Object.freeze(Object.defineProperty({__proto__:null,base2:ebe},Symbol.toStringTag,{value:"Module"})),ej=Array.from(""),rbe=ej.reduce((r,e,t)=>(r[t]=e,r),[]),nbe=ej.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function ibe(r){return r.reduce((e,t)=>(e+=rbe[t],e),"")}function sbe(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const i=nbe[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const obe=lw({prefix:"",name:"base256emoji",encode:ibe,decode:sbe}),abe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:obe},Symbol.toStringTag,{value:"Module"})),cbe=Er({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),lbe=Er({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ube=Er({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),dbe=Er({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),hbe=Er({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),fbe=Er({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),pbe=Er({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),gbe=Er({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ybe=Er({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),mbe=Object.freeze(Object.defineProperty({__proto__:null,base32:cbe,base32hex:hbe,base32hexpad:pbe,base32hexpadupper:gbe,base32hexupper:fbe,base32pad:ube,base32padupper:dbe,base32upper:lbe,base32z:ybe},Symbol.toStringTag,{value:"Module"})),wbe=W0({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),bbe=W0({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),vbe=Object.freeze(Object.defineProperty({__proto__:null,base36:wbe,base36upper:bbe},Symbol.toStringTag,{value:"Module"})),Ebe=W0({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),xbe=W0({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Sbe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Ebe,base58flickr:xbe},Symbol.toStringTag,{value:"Module"})),Abe=Er({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Cbe=Object.freeze(Object.defineProperty({__proto__:null,base8:Abe},Symbol.toStringTag,{value:"Module"})),kbe=lw({prefix:"\0",name:"identity",encode:r=>p7e(r),decode:r=>f7e(r)}),Ibe=Object.freeze(Object.defineProperty({__proto__:null,identity:kbe},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const _be={...Ibe,...tbe,...Cbe,...Y7e,...Z7e,...mbe,...vbe,...Sbe,...I7e,...abe},tj=Object.values(_be).map(r=>r.decoder).reduce((r,e)=>r.or(e)),Tbe=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function $be(r){var t;if(r==null)return;const e=r.match(Tbe);return(t=e==null?void 0:e.groups)==null?void 0:t.fingerprint}function rj(r){const t=r.stringTuples().filter(n=>n[0]===r5e).map(n=>n[1])[0];if(t===void 0||t==="")throw new Z(`Couldn't find a certhash component of multiaddr: ${r.toString()}`);return t}function Pbe(r){return j7e(tj.decode(r))}function Dbe(r){const e=Pbe(rj(r)),t=Obe(e.code),n=e.digest.reduce((s,o)=>s+o.toString(16).padStart(2,"0"),""),i=n.match(/.{1,2}/g);if(i==null)throw new D5e(n,r.toString());return`${t} ${i.join(":").toUpperCase()}`}function Nbe(r){const e=r.split(":").map(i=>parseInt(i,16)),t=Uint8Array.from(e),n=B3(KS.code,t);return Te(`/certhash/${VS.encode(n.bytes)}`)}function Obe(r){switch(r){case 17:return"sha-1";case 18:return"sha-256";case 19:return"sha-512";default:throw new O5e(r)}}function Rbe(r,e){const{host:t,port:n,family:i}=r.toOptions(),s=Dbe(r);return{type:"answer",sdp:`v=0
o=- 0 0 IN IP${i} ${t}
s=-
t=0 0
a=ice-lite
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
c=IN IP${i} ${t}
a=mid:0
a=ice-options:ice2
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:${s}
a=setup:passive
a=sctp-port:5000
a=max-message-size:${O4}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function Bbe(r,e){const{host:t,port:n,family:i}=r.toOptions();return{type:"offer",sdp:`v=0
o=- 0 0 IN IP${i} ${t}
s=-
c=IN IP${i} ${t}
t=0 0
a=ice-options:ice2,trickle
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:active
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:sha-256 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
a=sctp-port:5000
a=max-message-size:${O4}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function SP(r,e){if(r.sdp===void 0)throw new Z("Can't munge a missing SDP");const t=r.sdp.includes(`\r
`)?`\r
`:`
`;return r.sdp=r.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,`
a=ice-ufrag:`+e+t).replace(/\na=ice-pwd:[^\n]*\n/,`
a=ice-pwd:`+e+t),r}const l5=se("libp2p-webrtc-noise:");function Lbe(r,e,t){const n=r.trim().toLowerCase().replaceAll(":",""),i=se(n,"hex"),s=B3(KS.code,i),o=tj.decode(rj(e)),a=l5.byteLength+s.bytes.byteLength+o.byteLength;return pr(t==="server"?[l5,o,s.bytes]:[l5,s.bytes,o],a)}const Mbe=cS?"iceconnectionstatechange":"connectionstatechange";async function Ube(r,e,t){var i,s,o;const n=r.createDataChannel("",{negotiated:!0,id:0});try{if(t.role==="client"){t.log.trace("client creating local offer");const f=await r.createOffer();t.log.trace("client created local offer %s",f.sdp);const g=SP(f,e);t.log.trace("client setting local offer %s",g.sdp),await r.setLocalDescription(g);const v=Rbe(t.remoteAddr,e);t.log.trace("client setting server description %s",v.sdp),await r.setRemoteDescription(v)}else{const f=Bbe(t.remoteAddr,e);t.log.trace("server setting client %s %s",f.type,f.sdp),await r.setRemoteDescription(f),t.log.trace("server creating local answer");const g=await r.createAnswer();t.log.trace("server created local answer");const v=SP(g,e);t.log.trace("server setting local description %s",g.sdp),await r.setLocalDescription(v)}if(n.readyState!=="open"&&(t.log.trace("%s wait for handshake channel to open, starting status %s",t.role,n.readyState),await di(n,"open",t.signal)),t.log.trace("%s handshake channel opened",t.role),t.role==="server"){const f=((i=r.remoteFingerprint())==null?void 0:i.value)??"";t.remoteAddr=t.remoteAddr.encapsulate(Nbe(f))}const a=$be((s=r.localDescription)==null?void 0:s.sdp);if(a==null)throw new D0("Could not get fingerprint from local description sdp");t.log.trace("%s performing noise handshake",t.role);const c=Lbe(a,t.remoteAddr,t.role),l=tz({prologueBytes:c})(t),d=n3({channel:n,direction:"outbound",handshake:!0,logger:t.logger,...t.dataChannel??{}}),h=new Ib(t,{peerConnection:r,remoteAddr:t.remoteAddr,timeline:{open:Date.now()},metrics:t.events});r.addEventListener(Mbe,()=>{switch(r.connectionState){case"failed":case"disconnected":case"closed":h.close().catch(f=>{t.log.error("error closing connection",f),h.abort(f)});break;default:break}}),(o=t.events)==null||o.increment({peer_connection:!0});const p=new lS(t,{peerConnection:r,metrics:t.events,dataChannelOptions:t.dataChannel});if(t.role==="client")return t.log.trace("%s secure inbound",t.role),await l.secureInbound(d,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0}),t.log.trace("%s upgrade outbound",t.role),await t.upgrader.upgradeOutbound(h,{skipProtection:!0,skipEncryption:!0,muxerFactory:p,signal:t.signal});t.log.trace("%s secure outbound",t.role);const b=await l.secureOutbound(d,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0});h.remoteAddr=h.remoteAddr.encapsulate(`/p2p/${b.remotePeer}`),t.log.trace("%s upgrade inbound",t.role),await t.upgrader.upgradeInbound(h,{skipProtection:!0,skipEncryption:!0,muxerFactory:p,signal:t.signal})}catch(a){throw n.close(),a}}async function Fbe(r,e,t,n){n==null&&(n=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"}));const i=typeof t=="function"?await t():t;return new RTCPeerConnection({...i??{},certificates:[n]})}async function zbe(r){const e=await WL(r),t=await crypto.subtle.exportKey("pkcs8",e.privateKey);return["-----BEGIN PRIVATE KEY-----",...re(new Uint8Array(t),"base64pad").split(/(.{64})/).filter(Boolean),"-----END PRIVATE KEY-----"].join(`
`)}var WD,GD,QD;QD=Cm,GD=Symbol.toStringTag,WD=fr;class Vbe{constructor(e,t={}){u(this,"log");u(this,"metrics");u(this,"components");u(this,"init");u(this,"certificate");u(this,"privateKey");u(this,"emitter");u(this,"renewCertificateTask");u(this,QD,!0);u(this,GD,"@libp2p/webrtc-direct");u(this,WD,["@libp2p/transport"]);if(this.log=e.logger.forComponent("libp2p:webrtc-direct"),this.components=e,this.init=t,this.emitter=new Gt,t.certificateLifespan!=null&&t.certificateRenewalThreshold!=null&&t.certificateRenewalThreshold>=t.certificateLifespan)throw new Z("Certificate renewal threshold must be less than certificate lifespan");e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}async start(){this.certificate=await this.getCertificate()}async stop(){this.renewCertificateTask!=null&&clearTimeout(this.renewCertificateTask),this.certificate=void 0}async dial(e,t){var a;this.log("dial %a",e),t.signal.throwIfAborted();let n;const i=e.getPeerId();i!=null&&(n=xn(i));const s=_5e(),o=await Fbe("client",s,typeof this.init.rtcConfiguration=="function"?await this.init.rtcConfiguration():this.init.rtcConfiguration??{});try{return await Ube(o,s,{role:"client",log:this.log,logger:this.components.logger,metrics:this.components.metrics,events:(a=this.metrics)==null?void 0:a.dialerEvents,signal:t.signal,remoteAddr:e,dataChannel:this.init.dataChannel,upgrader:t.upgrader,peerId:this.components.peerId,remotePeerId:n,privateKey:this.components.privateKey})}catch(c){throw o.close(),c}}createListener(e){if(this.certificate==null)throw new Al;return new G7e(this.components,{...this.init,...e,certificate:this.certificate,emitter:this.emitter})}listenFilter(e){return e.filter(I7.exactMatch)}dialFilter(e){return this.listenFilter(e)}async getCertificate(e){if(Kbe(this.init.certificate))return this.log("using provided TLS certificate"),this.init.certificate;const t=await this.loadOrCreatePrivateKey(),{pem:n,certhash:i}=await this.loadOrCreateCertificate(t,e);return{privateKey:await zbe(t),pem:n,certhash:i}}async loadOrCreatePrivateKey(){if(this.privateKey!=null)return this.privateKey;const e=this.init.certificateKeychainName??d5e,t=this.getKeychain();try{if(t==null)throw this.log("no keychain configured - not checking for stored private key"),new jt;this.log.trace("checking for stored private key"),this.privateKey=await t.exportKey(e)}catch(n){if(n.name!=="NotFoundError")throw n;this.log.trace("generating private key"),this.privateKey=await Mm("ECDSA","P-256"),t!=null?(this.log.trace("storing private key"),await t.importKey(e,this.privateKey)):this.log("no keychain configured - not storing private key")}return this.privateKey}async loadOrCreateCertificate(e,t){if(this.certificate!=null&&t!==!0)return this.certificate;let n;const i=new ht(this.init.certificateDatastoreKey??u5e),s=await WL(e);try{if(t===!0)throw this.log.trace("forcing renewal of TLS certificate"),new jt;this.log.trace("checking for stored TLS certificate"),n=await this.loadCertificate(i,s)}catch(a){if(a.name!=="NotFoundError")throw a;this.log.trace("generating new TLS certificate"),n=await this.createCertificate(i,s)}let o=n.notAfter.getTime()-(this.init.certificateRenewalThreshold??zT)-Date.now();return o<0&&(o=100),this.log("will renew TLS certificate after %d ms",o),this.renewCertificateTask=setTimeout(()=>{this.log("renewing TLS certificate"),this.getCertificate(!0).then(a=>{this.certificate=a,this.emitter.safeDispatchEvent("certificate:renew",{detail:a})}).catch(a=>{this.log.error("could not renew certificate - %e",a)})},o),{pem:n.toString("pem"),certhash:VS.encode((await KS.digest(new Uint8Array(n.rawData))).bytes)}}async loadCertificate(e,t){const n=await this.components.datastore.get(e),i=new zS(n),s=i.notAfter.getTime()-(this.init.certificateRenewalThreshold??zT);if(Date.now()>s)throw this.log("stored TLS certificate has expired"),new jt;this.log("loaded certificate, expires in %d ms",s);const o=await i.publicKey.export(crypto),a=await crypto.subtle.exportKey("raw",o),c=await crypto.subtle.exportKey("raw",t.publicKey);if(!Fe(new Uint8Array(a,0,a.byteLength),new Uint8Array(c,0,c.byteLength)))throw this.log("stored TLS certificate public key did not match public key from private key"),new jt;return this.log("loaded certificate, expiry time is %o",s),i}async createCertificate(e,t){const n=new Date,i=new Date(Date.now()+(this.init.certificateLifespan??h5e));n.setMilliseconds(0),i.setMilliseconds(0);const s=await h7e.createSelfSigned({serialNumber:(BigInt(Math.random().toString().replace(".",""))*100000n).toString(16),name:"CN=example.com, C=US, L=CA, O=example, ST=CA",notBefore:n,notAfter:i,keys:t,extensions:[new US(!1,void 0,!0)]},crypto);return this.getKeychain()!=null?(this.log.trace("storing TLS certificate"),await this.components.datastore.put(e,se(s.toString("pem")))):this.log("no keychain is configured so not storing TLS certificate since the private key will not be reused"),s}getKeychain(){try{return this.components.keychain}catch{}}}function Kbe(r){return r==null?!1:typeof r.privateKey=="string"&&typeof r.pem=="string"&&typeof r.certhash=="string"}function jbe(r){return e=>new Vbe(e,r)}function Hbe(r){return e=>new M5e(e,r)}const qbe=async r=>{if(r.readyState>=2)throw new Error("socket closed");r.readyState!==1&&await new Promise((e,t)=>{function n(){r.removeEventListener("open",i),r.removeEventListener("error",s)}function i(){n(),e()}function s(o){n(),t(o.error??new Error(`connect ECONNREFUSED ${r.url}`))}r.addEventListener("open",i),r.addEventListener("error",s)})},Wbe=(r,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,async n=>{for await(const i of n){try{await qbe(r)}catch(s){if(s.message==="socket closed")break;throw s}if(r.readyState===r.CLOSING||r.readyState===r.CLOSED)break;r.send(i)}e.closeOnEnd!=null&&r.readyState<=1&&await new Promise((i,s)=>{r.addEventListener("close",o=>{if(o.wasClean||o.code===1006)i();else{const a=Object.assign(new Error("ws error"),{event:o});s(a)}}),setTimeout(()=>{r.close()})})});var uw={},dw={};Object.defineProperty(dw,"__esModule",{value:!0});class Gbe{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const t={value:e,done:!1};if(this.pullQueue.length){const n=this.pullQueue.shift();n&&n.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{const t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{const t=this.pushQueue.shift();return t?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((n,i)=>{this.pullQueue.push({resolve:n,reject:i})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}let nj=class{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){const i=new Gbe;i.highWaterMark=t,i.lowWaterMark=n,i.removeCallback=e({push:s=>i.push(s),stop:()=>i.stop(),fail:s=>i.fail(s),on:(s,o)=>{i.eventHandlers[s]=o}})||(()=>{}),this[Symbol.asyncIterator]=()=>i[Symbol.asyncIterator](),Object.freeze(this)}};dw.EventIterator=nj;dw.default=nj;Object.defineProperty(uw,"__esModule",{value:!0});const jS=dw;var Qbe=uw.EventIterator=jS.EventIterator;function Ybe(r,e,t){return new jS.EventIterator(({push:n})=>(this.addEventListener(r,n,e),()=>this.removeEventListener(r,n,e)),t)}uw.subscribe=Ybe;uw.default=jS.EventIterator;function AP(r){var e;return r instanceof ArrayBuffer||((e=r==null?void 0:r.constructor)==null?void 0:e.name)==="ArrayBuffer"&&typeof(r==null?void 0:r.byteLength)=="number"}const Jbe=r=>{r.binaryType="arraybuffer";const e=async()=>{await new Promise((s,o)=>{if(n){s();return}if(i!=null){o(i);return}const a=d=>{r.removeEventListener("open",c),r.removeEventListener("error",l),d()},c=()=>{a(s)},l=d=>{a(()=>{o(d.error??new Error(`connect ECONNREFUSED ${r.url}`))})};r.addEventListener("open",c),r.addEventListener("error",l)})},t=async function*(){const s=new Qbe(({push:o,stop:a,fail:c})=>{const l=h=>{let p=null;typeof h.data=="string"&&(p=se(h.data)),AP(h.data)&&(p=new Uint8Array(h.data)),h.data instanceof Uint8Array&&(p=h.data),p!=null&&o(p)},d=h=>{c(h.error??new Error("Socket error"))};return r.addEventListener("message",l),r.addEventListener("error",d),r.addEventListener("close",a),()=>{r.removeEventListener("message",l),r.removeEventListener("error",d),r.removeEventListener("close",a)}},{highWaterMark:1/0});await e();for await(const o of s)yield AP(o)?new Uint8Array(o):o}();let n=r.readyState===1,i;return r.addEventListener("open",()=>{n=!0,i=null}),r.addEventListener("close",()=>{n=!1,i=null}),r.addEventListener("error",s=>{n||(i=s.error??new Error(`connect ECONNREFUSED ${r.url}`))}),Object.assign(t,{connected:e})},Xbe=(r,e)=>{e=e??{};const t=Jbe(r);let n=e.remoteAddress,i=e.remotePort;if(r.url!=null)try{const o=new URL(r.url);n=o.hostname,i=parseInt(o.port,10)}catch{}if(n==null||i==null)throw new Error("Remote connection did not have address and/or port");return{sink:Wbe(r,e),source:t,connected:async()=>{await t.connected()},close:async()=>{(r.readyState===r.CONNECTING||r.readyState===r.OPEN)&&await new Promise(o=>{r.addEventListener("close",()=>{o()}),r.close()})},destroy:()=>{r.terminate!=null?r.terminate():r.close()},remoteAddress:n,remotePort:i,socket:r}},Zbe=WebSocket,e9e={"http:":"ws:","https:":"wss:"},CP="ws:",t9e=(r,e)=>{if(r.startsWith("//")&&(r=`${(e==null?void 0:e.protocol)??CP}${r}`),r.startsWith("/")&&e!=null){const n=e.protocol??CP,i=e.host,s=e.port!=null&&(i==null?void 0:i.endsWith(`:${e.port}`))!==!0?`:${e.port}`:"";r=`${n}//${i}${s}${r}`}const t=new URL(r);for(const[n,i]of Object.entries(e9e))t.protocol===n&&(t.protocol=i);return t};function r9e(r,e){const t=typeof window>"u"?void 0:window.location;e=e??{};const n=t9e(r,t),i=new Zbe(n.toString(),e.websocket);return Xbe(i,e)}function n9e(r){return r.filter(e=>wy.exactMatch(e)||P1.exactMatch(e))}function i9e(){throw new Error("WebSocket Servers can not be created in the browser!")}const s9e=500;function o9e(r,e,t){const n=t.logger.forComponent("libp2p:websockets:maconn"),i=t.metrics,s=t.metricPrefix??"",o={log:n,async sink(a){try{await r.sink(async function*(){for await(const c of a)c instanceof Uint8Array?yield c:yield c.subarray()}())}catch(c){c.type!=="aborted"&&n.error(c)}},source:r.source,remoteAddr:e,timeline:{open:Date.now()},async close(a={}){var d,h;const c=Date.now();if(a.signal==null){const p=AbortSignal.timeout(s9e);a={...a,signal:p}}const l=()=>{const{host:p,port:b}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s after %dms, destroying it manually",p,b,Date.now()-c),this.abort(new Sl("Socket close timeout"))};(d=a.signal)==null||d.addEventListener("abort",l);try{await r.close()}catch(p){n.error("error closing WebSocket gracefully",p),this.abort(p)}finally{(h=a.signal)==null||h.removeEventListener("abort",l),o.timeline.close=Date.now()}},abort(a){const{host:c,port:l}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s due to error",c,l,a),r.destroy(),o.timeline.close=Date.now(),i==null||i.increment({[`${s}error`]:!0})}};return r.socket.addEventListener("close",()=>{i==null||i.increment({[`${s}close`]:!0}),o.timeline.close==null&&(o.timeline.close=Date.now())},{once:!0}),o}var YD,JD,XD;XD=Cm,JD=Symbol.toStringTag,YD=fr;class a9e{constructor(e,t={}){u(this,"log");u(this,"init");u(this,"logger");u(this,"metrics");u(this,"components");u(this,XD,!0);u(this,JD,"@libp2p/websockets");u(this,YD,["@libp2p/transport"]);this.log=e.logger.forComponent("libp2p:websockets"),this.logger=e.logger,this.components=e,this.init=t,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}async dial(e,t){var o;this.log("dialing %s",e),t=t??{};const n=await this._connect(e,t),i=o9e(n,e,{logger:this.logger,metrics:(o=this.metrics)==null?void 0:o.dialerEvents});this.log("new outbound connection %s",i.remoteAddr);const s=await t.upgrader.upgradeOutbound(i,t);return this.log("outbound connection %s upgraded",i.remoteAddr),s}async _connect(e,t){var o,a,c,l,d;(o=t==null?void 0:t.signal)==null||o.throwIfAborted();const n=e.toOptions();this.log("dialing %s:%s",n.host,n.port);const i=De(),s=r9e(cF(e),this.init);s.socket.addEventListener("error",()=>{var p;const h=new SE(`Could not connect to ${e.toString()}`);this.log.error("connection error:",h),(p=this.metrics)==null||p.dialerEvents.increment({error:!0}),i.reject(h)});try{(a=t.onProgress)==null||a.call(t,new ke("websockets:open-connection")),await Zr(Promise.race([s.connected(),i.promise]),t.signal)}catch(h){throw(c=t.signal)!=null&&c.aborted&&((l=this.metrics)==null||l.dialerEvents.increment({abort:!0})),s.close().catch(p=>{this.log.error("error closing raw socket",p)}),h}return this.log("connected %s",e),(d=this.metrics)==null||d.dialerEvents.increment({connect:!0}),s}createListener(e){return i9e({logger:this.logger,events:this.components.events,metrics:this.components.metrics},{...this.init,...e})}listenFilter(e){var t,n;return e=Array.isArray(e)?e:[e],((t=this.init)==null?void 0:t.filter)!=null?(n=this.init)==null?void 0:n.filter(e):n9e(e)}dialFilter(e){return this.listenFilter(e)}}function c9e(r={}){return e=>new a9e(e,r)}function l9e(r,e){const t=e.map((n,i)=>({record:C0(n),index:i}));return t.sort((n,i)=>{const s=n.record.sequence,o=i.record.sequence;if(s>o)return-1;if(s<o)return 1;if(n.record.validityType===qi.ValidityType.EOL&&i.record.validityType===qi.ValidityType.EOL){const a=R7.fromString(n.record.validity).toDate(),c=R7.fromString(i.record.validity).toDate();if(a.getTime()>c.getTime())return-1;if(a.getTime()<c.getTime())return 1}return 0}),t[0].index}const ij="2.8.5",sj="js-libp2p";function oj(r,e){return`${r??sj}/${e??ij} browser/${globalThis.navigator.userAgent}`}const u9e="5.3.0",d9e="helia",h9e={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};function f9e(r={}){const e=`${d9e}/${u9e} ${oj()}`;return{privateKey:r.privateKey,dns:r.dns,nodeInfo:{userAgent:e},addresses:{listen:["/p2p-circuit","/webrtc"]},transports:[r3e(),Hbe(),jbe(),c9e()],connectionEncrypters:[tz()],streamMuxers:[X2e(),H8e()],peerDiscovery:[bz(h9e)],services:{autoNAT:Nge(),dcutr:o3e(),delegatedRouting:()=>H1e("https://delegated-ipfs.dev",k0e()),dht:H4e({clientMode:!0,validators:{ipns:IF},selectors:{ipns:l9e}}),identify:b3e(),identifyPush:v3e(),keychain:YV(r.keychain),ping:Z8e()}}}async function p9e(r,e={}){const t=e.selfKey??"self",n=YV(e)({datastore:r,logger:Hm()});let i;return await r.has(new ht(`/pkcs8/${t}`))?i=await n.exportKey(t):(i=await Mm(e.keyType??"Ed25519"),await n.importKey(t,i)),i}const g9e=32,{code:y9e}=Re("dnsaddr");class m9e extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}}const aj=async function(e,t={}){const n=t.maxRecursiveDepth??g9e;if(n===0)throw new m9e("Max recursive depth reached");const[,i]=e.stringTuples().find(([l])=>l===y9e)??[],o=await((t==null?void 0:t.dns)??qM()).query(`_dnsaddr.${i}`,{signal:t==null?void 0:t.signal,types:[ic.TXT]}),a=e.getPeerId(),c=[];for(const l of o.Answer){const d=l.data.replace(/["']/g,"").trim().split("=")[1];if(d==null||a!=null&&!d.includes(a))continue;const h=Te(d);if(d.startsWith("/dnsaddr")){const p=await h.resolve({...t,maxRecursiveDepth:n-1});c.push(...p.map(b=>b.toString()))}else c.push(h.toString())}return c},w9e={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:r=>r},connectionManager:{resolvers:{dnsaddr:aj}},transportManager:{faultTolerance:w1.FATAL_ALL}};async function b9e(r){var t,n;const e=Gx(w9e,r);if(e.connectionProtector===null&&((n=(t=globalThis.process)==null?void 0:t.env)==null?void 0:n.LIBP2P_FORCE_PNET)!=null)throw new Z("Private network is enforced, but no protector was provided");return e}function v9e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function HS(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function E9e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var m=(w-y)*d+1>>>0,E=new Uint8Array(m);y!==w;){for(var C=f[y],k=0,A=m-1;(C!==0||k<v)&&A!==-1;A--,k++)C+=256*E[A]>>>0,E[A]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=m-v;I!==m&&E[I]===0;)I++;for(var D=c.repeat(g);I<m;++I)D+=r.charAt(E[I]);return D}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,m=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*m[k]>>>0,m[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var A=w-y;A!==w&&m[A]===0;)A++;for(var I=new Uint8Array(v+(w-A)),D=v;A!==w;)I[D++]=m[A++];return I}}}function b(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:b}}var x9e=E9e,S9e=x9e;class A9e{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class C9e{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return cj(this,e)}}class k9e{constructor(e){u(this,"decoders");this.decoders=e}or(e){return cj(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function cj(r,e){return new k9e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}class I9e{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new A9e(e,t,n),this.decoder=new C9e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function lj({name:r,prefix:e,encode:t,decode:n}){return new I9e(r,e,t,n)}function hw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=S9e(t,r);return lj({prefix:e,name:r,encode:n,decode:s=>HS(i(s))})}function _9e(r,e,t,n){const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let d=0;d<s;++d){const h=i[r[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function T9e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Vo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return lj({prefix:e,name:r,encode(i){return T9e(i,n,t)},decode(i){return _9e(i,n,t,r)}})}const Yf=Vo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Vo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Vo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Vo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Vo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Vo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Vo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Vo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Vo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const u5=hw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});hw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const eo=hw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});hw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var $9e=uj,kP=128,P9e=-128,D9e=Math.pow(2,31);function uj(r,e,t){e=e||[],t=t||0;for(var n=t;r>=D9e;)e[t++]=r&255|kP,r/=128;for(;r&P9e;)e[t++]=r&255|kP,r>>>=7;return e[t]=r|0,uj.bytes=t-n+1,e}var N9e=K9,O9e=128,IP=127;function K9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw K9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&IP)<<i:(o&IP)*Math.pow(2,i),i+=7}while(o>=O9e);return K9.bytes=s-n,t}var R9e=Math.pow(2,7),B9e=Math.pow(2,14),L9e=Math.pow(2,21),M9e=Math.pow(2,28),U9e=Math.pow(2,35),F9e=Math.pow(2,42),z9e=Math.pow(2,49),V9e=Math.pow(2,56),K9e=Math.pow(2,63),j9e=function(r){return r<R9e?1:r<B9e?2:r<L9e?3:r<M9e?4:r<U9e?5:r<F9e?6:r<z9e?7:r<V9e?8:r<K9e?9:10},H9e={encode:$9e,decode:N9e,encodingLength:j9e},L3=H9e;function j9(r,e=0){return[L3.decode(r,e),L3.decode.bytes]}function M3(r,e,t=0){return L3.encode(r,e,t),e}function U3(r){return L3.encodingLength(r)}function q9e(r,e){const t=e.byteLength,n=U3(r),i=n+U3(t),s=new Uint8Array(i+t);return M3(r,s,0),M3(t,s,n),s.set(e,i),new qS(r,t,e,s)}function dj(r){const e=HS(r),[t,n]=j9(e),[i,s]=j9(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new qS(t,i,o,e)}function W9e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&v9e(r.bytes,t.bytes)}}class qS{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}}function _P(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Q9e(t,H9(r),e??eo.encoder);default:return Y9e(t,H9(r),e??Yf.encoder)}}const TP=new WeakMap;function H9(r){const e=TP.get(r);if(e==null){const t=new Map;return TP.set(r,t),t}return e}var ZD;class or{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,ZD,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==pf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==J9e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return or.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=q9e(e,t);return or.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return or.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&W9e(e.multihash,n.multihash)}toString(e){return _P(this,e)}toJSON(){return{"/":_P(this)}}link(){return this}[(ZD=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof or)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new or(n,i,s,o??$P(n,i,s.bytes))}else if(t[X9e]===!0){const{version:n,multihash:i,code:s}=t,o=dj(i);return or.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==pf)throw new Error(`Version 0 CID must use dag-pb (code: ${pf}) block encoding`);return new or(e,t,n,n.bytes)}case 1:{const i=$P(e,t,n.bytes);return new or(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return or.create(0,pf,e)}static createV1(e,t){return or.create(1,e,t)}static decode(e){const[t,n]=or.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=or.inspectBytes(e),n=t.size-t.multihashSize,i=HS(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new qS(t.multihashCode,t.digestSize,s,i);return[t.version===0?or.createV0(o):or.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,p]=j9(e.subarray(t));return t+=p,h};let i=n(),s=pf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,d=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:l}}static parse(e,t){const[n,i]=G9e(e,t),s=or.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return H9(s).set(n,e),s}}function G9e(r,e){switch(r[0]){case"Q":{const t=e??eo;return[eo.prefix,t.decode(`${eo.prefix}${r}`)]}case eo.prefix:{const t=e??eo;return[eo.prefix,t.decode(r)]}case Yf.prefix:{const t=e??Yf;return[Yf.prefix,t.decode(r)]}case u5.prefix:{const t=e??u5;return[u5.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Q9e(r,e,t){const{prefix:n}=t;if(n!==eo.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Y9e(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const pf=112,J9e=18;function $P(r,e,t){const n=U3(r),i=n+U3(e),s=new Uint8Array(i+t.byteLength);return M3(r,s,0),M3(e,s,n),s.set(t,i),s}const X9e=Symbol.for("@ipld/js-cid/CID"),Z9e=36e5,eve=216e5;var tl;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=Ke((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.key!=null&&i.key!==""&&(s.uint32(10),s.string(i.key)),i.value!=null&&i.value.byteLength>0&&(s.uint32(18),s.bytes(i.value)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={key:"",value:We(0)},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.key=i.string();break}case 2:{a.value=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>Ve(i,t.codec()),t.decode=(i,s)=>ze(i,t.codec(),s)})(r.Peer$metadataEntry||(r.Peer$metadataEntry={})),function(t){let n;t.codec=()=>(n==null&&(n=Ke((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.key!=null&&i.key!==""&&(s.uint32(10),s.string(i.key)),i.value!=null&&(s.uint32(18),z3.codec().encode(i.value,s)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={key:""},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:{a.key=i.string();break}case 2:{a.value=z3.codec().decode(i,i.uint32(),{limits:(l=o.limits)==null?void 0:l.value});break}default:{i.skipType(d&7);break}}}return a})),n),t.encode=i=>Ve(i,t.codec()),t.decode=(i,s)=>ze(i,t.codec(),s)}(r.Peer$tagsEntry||(r.Peer$tagsEntry={}));let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.addresses!=null)for(const s of t.addresses)n.uint32(10),F3.codec().encode(s,n);if(t.protocols!=null)for(const s of t.protocols)n.uint32(18),n.string(s);if(t.publicKey!=null&&(n.uint32(34),n.bytes(t.publicKey)),t.peerRecordEnvelope!=null&&(n.uint32(42),n.bytes(t.peerRecordEnvelope)),t.metadata!=null&&t.metadata.size!==0)for(const[s,o]of t.metadata.entries())n.uint32(50),r.Peer$metadataEntry.codec().encode({key:s,value:o},n);if(t.tags!=null&&t.tags.size!==0)for(const[s,o]of t.tags.entries())n.uint32(58),r.Peer$tagsEntry.codec().encode({key:s,value:o},n);t.updated!=null&&(n.uint32(64),n.uint64Number(t.updated)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,d,h,p;const s={addresses:[],protocols:[],metadata:new Map,tags:new Map},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const b=t.uint32();switch(b>>>3){case 1:{if(((a=i.limits)==null?void 0:a.addresses)!=null&&s.addresses.length===i.limits.addresses)throw new gr('Decode error - map field "addresses" had too many elements');s.addresses.push(F3.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.addresses$}));break}case 2:{if(((l=i.limits)==null?void 0:l.protocols)!=null&&s.protocols.length===i.limits.protocols)throw new gr('Decode error - map field "protocols" had too many elements');s.protocols.push(t.string());break}case 4:{s.publicKey=t.bytes();break}case 5:{s.peerRecordEnvelope=t.bytes();break}case 6:{if(((d=i.limits)==null?void 0:d.metadata)!=null&&s.metadata.size===i.limits.metadata)throw new hk('Decode error - map field "metadata" had too many elements');const f=r.Peer$metadataEntry.codec().decode(t,t.uint32());s.metadata.set(f.key,f.value);break}case 7:{if(((h=i.limits)==null?void 0:h.tags)!=null&&s.tags.size===i.limits.tags)throw new hk('Decode error - map field "tags" had too many elements');const f=r.Peer$tagsEntry.codec().decode(t,t.uint32(),{limits:{value:(p=i.limits)==null?void 0:p.tags$value}});s.tags.set(f.key,f.value);break}case 8:{s.updated=t.uint64Number();break}default:{t.skipType(b&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(tl||(tl={}));var F3;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(n.uint32(10),n.bytes(t.multiaddr)),t.isCertified!=null&&(n.uint32(16),n.bool(t.isCertified)),t.observed!=null&&(n.uint32(24),n.uint64Number(t.observed)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={multiaddr:We(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.multiaddr=t.bytes();break}case 2:{s.isCertified=t.bool();break}case 3:{s.observed=t.uint64Number();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(F3||(F3={}));var z3;(function(r){let e;r.codec=()=>(e==null&&(e=Ke((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.value!=null&&t.value!==0&&(n.uint32(8),n.uint32(t.value)),t.expiry!=null&&(n.uint32(16),n.uint64(t.expiry)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={value:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.value=t.uint32();break}case 2:{s.expiry=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Ve(t,r.codec()),r.decode=(t,n)=>ze(t,r.codec(),n)})(z3||(z3={}));function tve(r,e){if(r.publicKey!=null||e.publicKey==null)return r;let t;if(r.type==="RSA"){const i=eo.decode(`z${r}`);t=dj(i)}const n=Ji(e.publicKey,t);return $d(n)}function q9(r,e,t){const n=tl.decode(e);return W9(r,n,t)}function W9(r,e,t){const n=new Map,i=BigInt(Date.now());for(const[s,o]of e.tags.entries())o.expiry!=null&&o.expiry<i||n.set(s,o);return{...e,id:tve(r,e),addresses:e.addresses.filter(({observed:s})=>s!=null&&s>Date.now()-t).map(({multiaddr:s,isCertified:o})=>({multiaddr:Te(s),isCertified:o??!1})),metadata:e.metadata,peerRecordEnvelope:e.peerRecordEnvelope??void 0,tags:n}}function rve(r,e){return nve(r.addresses,e.addresses)&&ive(r.protocols,e.protocols)&&sve(r.publicKey,e.publicKey)&&ove(r.peerRecordEnvelope,e.peerRecordEnvelope)&&ave(r.metadata,e.metadata)&&cve(r.tags,e.tags)}function nve(r,e){return fj(r,e,(t,n)=>!(t.isCertified!==n.isCertified||!Fe(t.multiaddr,n.multiaddr)))}function ive(r,e){return fj(r,e,(t,n)=>t===n)}function sve(r,e){return hj(r,e)}function ove(r,e){return hj(r,e)}function ave(r,e){return pj(r,e,(t,n)=>Fe(t,n))}function cve(r,e){return pj(r,e,(t,n)=>t.value===n.value&&t.expiry===n.expiry)}function hj(r,e){return r==null&&e==null?!0:r!=null&&e!=null?Fe(r,e):!1}function fj(r,e,t){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!t(r[n],e[n]))return!1;return!0}function pj(r,e,t){if(r.size!==e.size)return!1;for(const[n,i]of r.entries()){const s=e.get(n);if(s==null||!t(i,s))return!1}return!0}const gj="/peers/";function Zp(r){if(!OB(r)||r.type==null)throw new Z("Invalid PeerId");const e=r.toCID().toString();return new ht(`${gj}${e}`)}async function lve(r,e,t,n){const i=new Map;for(const s of t){if(s==null)continue;if(s.multiaddr instanceof Uint8Array&&(s.multiaddr=Te(s.multiaddr)),!r4(s.multiaddr))throw new Z("Multiaddr was invalid");if(!await e(r,s.multiaddr))continue;const o=s.isCertified??!1,a=s.multiaddr.toString(),c=i.get(a);c!=null?s.isCertified=c.isCertified||o:i.set(a,{multiaddr:s.multiaddr,isCertified:o})}return[...i.values()].sort((s,o)=>s.multiaddr.toString().localeCompare(o.multiaddr.toString())).map(({isCertified:s,multiaddr:o})=>({isCertified:s,multiaddr:o.bytes}))}async function d5(r,e,t,n){var p,b;if(e==null)throw new Z("Invalid PeerData");if(e.publicKey!=null&&r.publicKey!=null&&!e.publicKey.equals(r.publicKey))throw new Z("publicKey bytes do not match peer id publicKey bytes");const i=(p=n.existingPeer)==null?void 0:p.peer;if(i!=null&&!r.equals(i.id))throw new Z("peer id did not match existing peer id");let s=(i==null?void 0:i.addresses)??[],o=new Set((i==null?void 0:i.protocols)??[]),a=(i==null?void 0:i.metadata)??new Map,c=(i==null?void 0:i.tags)??new Map,l=i==null?void 0:i.peerRecordEnvelope;if(t==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(s=[],e.multiaddrs!=null&&s.push(...e.multiaddrs.map(f=>({isCertified:!1,multiaddr:f}))),e.addresses!=null&&s.push(...e.addresses)),e.protocols!=null&&(o=new Set(e.protocols)),e.metadata!=null){const f=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);a=e2(f,{validate:PP})}if(e.tags!=null){const f=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);c=e2(f,{validate:DP,map:NP})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}if(t==="merge"){if(e.multiaddrs!=null&&s.push(...e.multiaddrs.map(f=>({isCertified:!1,multiaddr:f}))),e.addresses!=null&&s.push(...e.addresses),e.protocols!=null&&(o=new Set([...o,...e.protocols])),e.metadata!=null){const f=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(const[g,v]of f)v==null?a.delete(g):a.set(g,v);a=e2([...a.entries()],{validate:PP})}if(e.tags!=null){const f=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),g=new Map(c);for(const[v,y]of f)y==null?g.delete(v):g.set(v,y);c=e2([...g.entries()],{validate:DP,map:NP})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}let d;(i==null?void 0:i.id.publicKey)!=null?d=Ss(i.id.publicKey):e.publicKey!=null?d=Ss(e.publicKey):r.publicKey!=null&&(d=Ss(r.publicKey));const h={addresses:await lve(r,n.addressFilter??(async()=>!0),s,(b=n.existingPeer)==null?void 0:b.peerPB.addresses),protocols:[...o.values()].sort((f,g)=>f.localeCompare(g)),metadata:a,tags:c,publicKey:d,peerRecordEnvelope:l};return h.addresses.forEach(f=>{var g,v,y;f.observed=((y=(v=(g=n.existingPeer)==null?void 0:g.peerPB.addresses)==null?void 0:v.find(w=>Fe(w.multiaddr,w.multiaddr)))==null?void 0:y.observed)??Date.now()}),r.type!=="RSA"&&delete h.publicKey,h}function e2(r,e){var n;const t=new Map;for(const[i,s]of r)s!=null&&e.validate(i,s);for(const[i,s]of r.sort(([o],[a])=>o.localeCompare(a)))s!=null&&t.set(i,((n=e.map)==null?void 0:n.call(e,i,s))??s);return t}function PP(r,e){if(typeof r!="string")throw new Z("Metadata key must be a string");if(!(e instanceof Uint8Array))throw new Z("Metadata value must be a Uint8Array")}function DP(r,e){if(typeof r!="string")throw new Z("Tag name must be a string");if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new Z("Tag value must be an integer");if(e.value<0||e.value>100)throw new Z("Tag value must be between 0-100")}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new Z("Tag ttl must be an integer");if(e.ttl<0)throw new Z("Tag ttl must be between greater than 0")}}function NP(r,e){let t;return e.expiry!=null&&(t=e.expiry),e.ttl!=null&&(t=BigInt(Date.now()+Number(e.ttl))),{value:e.value??0,expiry:t}}function yj(r){const e=r.toString().split("/")[2],t=or.parse(e,Yf);return ph(t)}function h5(r,e,t){const n=yj(r);return q9(n,e,t)}function uve(r,e){return{prefix:gj,filters:(r.filters??[]).map(t=>({key:n,value:i})=>t(h5(n,i,e))),orders:(r.orders??[]).map(t=>(n,i)=>t(h5(n.key,n.value,e),h5(i.key,i.value,e)))}}var vn,q2,W2,G2;class dve{constructor(e,t={}){qe(this,vn);u(this,"peerId");u(this,"datastore");u(this,"lock");u(this,"addressFilter");u(this,"log");u(this,"maxAddressAge");u(this,"maxPeerAge");this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.lock=ux({name:"peer-store",singleProcess:!0}),this.maxAddressAge=t.maxAddressAge??Z9e,this.maxPeerAge=t.maxPeerAge??eve}async has(e){try{return await this.load(e),!0}catch(t){if(t.name!=="NotFoundError")throw t}return!1}async delete(e){this.peerId.equals(e)||await this.datastore.delete(Zp(e))}async load(e){const t=Zp(e),n=await this.datastore.get(t),i=tl.decode(n);if(Ae(this,vn,G2).call(this,e,i))throw await this.datastore.delete(t),new jt;return W9(e,i,this.peerId.equals(e)?1/0:this.maxAddressAge)}async save(e,t){const n=await Ae(this,vn,q2).call(this,e),i=await d5(e,t,"patch",{addressFilter:this.addressFilter});return Ae(this,vn,W2).call(this,e,i,n)}async patch(e,t){const n=await Ae(this,vn,q2).call(this,e),i=await d5(e,t,"patch",{addressFilter:this.addressFilter,existingPeer:n});return Ae(this,vn,W2).call(this,e,i,n)}async merge(e,t){const n=await Ae(this,vn,q2).call(this,e),i=await d5(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:n});return Ae(this,vn,W2).call(this,e,i,n)}async*all(e){for await(const{key:t,value:n}of this.datastore.query(uve(e??{},this.maxAddressAge))){const i=yj(t);if(i.equals(this.peerId))continue;const s=tl.decode(n);if(Ae(this,vn,G2).call(this,i,s)){await this.datastore.delete(t);continue}yield W9(i,s,this.peerId.equals(i)?1/0:this.maxAddressAge)}}}vn=new WeakSet,q2=async function(e){try{const t=Zp(e),n=await this.datastore.get(t),i=tl.decode(n);if(Ae(this,vn,G2).call(this,e,i))throw await this.datastore.delete(t),new jt;return{peerPB:i,peer:q9(e,n,this.maxAddressAge)}}catch(t){t.name!=="NotFoundError"&&this.log.error("invalid peer data found in peer store - %e",t)}},W2=async function(e,t,n){t.updated=Date.now();const i=tl.encode(t);return await this.datastore.put(Zp(e),i),{peer:q9(e,i,this.maxAddressAge),previous:n==null?void 0:n.peer,updated:n==null||!rve(t,n.peerPB)}},G2=function(e,t){if(t.updated==null)return!0;if(this.peerId.equals(e))return!1;const n=t.updated<Date.now()-this.maxPeerAge,i=Date.now()-this.maxAddressAge,s=t.addresses.filter(o=>o.observed!=null&&o.observed>i);return n&&s.length===0};var eN,fd,Q2;eN=Symbol.toStringTag;class hve{constructor(e,t={}){qe(this,fd);u(this,"store");u(this,"events");u(this,"peerId");u(this,"log");u(this,eN,"@libp2p/peer-store");this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new dve(e,t)}async forEach(e,t){this.log.trace("forEach await read lock");const n=await this.store.lock.readLock();this.log.trace("forEach got read lock");try{for await(const i of this.store.all(t))e(i)}finally{this.log.trace("forEach release read lock"),n()}}async all(e){this.log.trace("all await read lock");const t=await this.store.lock.readLock();this.log.trace("all got read lock");try{return await Ry(this.store.all(e))}finally{this.log.trace("all release read lock"),t()}}async delete(e){this.log.trace("delete await write lock");const t=await this.store.lock.writeLock();this.log.trace("delete got write lock");try{await this.store.delete(e)}finally{this.log.trace("delete release write lock"),t()}}async has(e){this.log.trace("has await read lock");const t=await this.store.lock.readLock();this.log.trace("has got read lock");try{return await this.store.has(e)}finally{this.log.trace("has release read lock"),t()}}async get(e){this.log.trace("get await read lock");const t=await this.store.lock.readLock();this.log.trace("get got read lock");try{return await this.store.load(e)}finally{this.log.trace("get release read lock"),t()}}async save(e,t){this.log.trace("save await write lock");const n=await this.store.lock.writeLock();this.log.trace("save got write lock");try{const i=await this.store.save(e,t);return Ae(this,fd,Q2).call(this,e,i),i.peer}finally{this.log.trace("save release write lock"),n()}}async patch(e,t){this.log.trace("patch await write lock");const n=await this.store.lock.writeLock();this.log.trace("patch got write lock");try{const i=await this.store.patch(e,t);return Ae(this,fd,Q2).call(this,e,i),i.peer}finally{this.log.trace("patch release write lock"),n()}}async merge(e,t){this.log.trace("merge await write lock");const n=await this.store.lock.writeLock();this.log.trace("merge got write lock");try{const i=await this.store.merge(e,t);return Ae(this,fd,Q2).call(this,e,i),i.peer}finally{this.log.trace("merge release write lock"),n()}}async consumePeerRecord(e,t){const n=await ac.openAndCertify(e,Cs.DOMAIN),i=ph(n.publicKey.toCID());if((t==null?void 0:t.equals(i))===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",t,i),!1;const s=Cs.createFromProtobuf(n.payload);let o;try{o=await this.get(i)}catch(a){if(a.name!=="NotFoundError")throw a}if((o==null?void 0:o.peerRecordEnvelope)!=null){const a=await ac.createFromProtobuf(o.peerRecordEnvelope),c=Cs.createFromProtobuf(a.payload);if(c.seqNumber>=s.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",c.seqNumber,s.seqNumber),!1}return await this.patch(s.peerId,{peerRecordEnvelope:e,addresses:s.multiaddrs.map(a=>({isCertified:!0,multiaddr:a}))}),!0}}fd=new WeakSet,Q2=function(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))};function fve(r,e={}){return new hve(r,e)}function pve(r,e){let t;const n=function(){const i=function(){t=void 0,r()};clearTimeout(t),t=setTimeout(i,e)};return n.start=()=>{},n.stop=()=>{clearTimeout(t)},n}const OP=864e13,gve=448,f5=449,yve=53,mve=54,wve=55,bve=56;class vve{constructor(e,t={}){u(this,"log");u(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=new Map}has(e){const t=this.findHost(e);for(const n of this.mappings.values())if(n.domain===t)return!0;return!1}add(e,t){t.forEach(n=>{this.log("add DNS mapping %s to %s",n,e);const i=vc(n)===!0;this.mappings.set(n,{domain:e,verified:i,expires:i?OP-Date.now():0,lastVerified:i?OP-Date.now():void 0})})}remove(e){const t=this.findHost(e);let n=!1;for(const[i,s]of this.mappings.entries())s.domain===t&&(this.log("removing %s to %s DNS mapping %e",i,s.domain,new Error("where")),this.mappings.delete(i),n=n||s.verified);return n}getAll(e){const t=[];for(let n=0;n<e.length;n++){const s=e[n].multiaddr.stringTuples(),o=s[0][1];if(o!=null)for(const[a,c]of this.mappings.entries()){if(o!==a)continue;this.maybeAddSNITuple(s,c.domain)&&(e.splice(n,1),n--,t.push({multiaddr:Te(`/${s.map(d=>[Re(d[0]).name,d[1]].join("/")).join("/")}`),verified:c.verified,type:"dns-mapping",expires:c.expires,lastVerified:c.lastVerified}))}}return t}maybeAddSNITuple(e,t){var n;for(let i=0;i<e.length;i++)if(e[i][0]===gve&&((n=e[i+1])==null?void 0:n[0])!==f5)return e.splice(i+1,0,[f5,t]),!0;return!1}confirm(e,t){const n=this.findHost(e);let i=!1;for(const[s,o]of this.mappings.entries())o.domain===n&&(this.log("marking %s to %s DNS mapping as verified",s,o.domain),i=o.verified,o.verified=!0,o.expires=Date.now()+t,o.lastVerified=Date.now());return i}unconfirm(e,t){const n=this.findHost(e);let i=!1;for(const[s,o]of this.mappings.entries())o.domain===n&&(this.log("removing verification of %s to %s DNS mapping",s,o.domain),i=i||o.verified,o.verified=!1,o.expires=Date.now()+t);return i}findHost(e){for(const t of e.stringTuples())if(t[0]===f5||t[0]===yve||t[0]===mve||t[0]===wve||t[0]===bve)return t[1]}}const p5=4,g5=41,y5=6,Eve=273;class xve{constructor(e,t={}){u(this,"log");u(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=new Map}has(e){const t=e.stringTuples();for(const n of this.mappings.values())for(const i of n)if(i.externalIp===t[0][1])return!0;return!1}add(e,t,n,i=t,s="tcp"){const o=`${e}-${t}-${s}`,a=this.mappings.get(o)??[],c={internalIp:e,internalPort:t,externalIp:n,externalPort:i,externalFamily:Rd(n)?4:6,protocol:s,verified:!1,expires:0};a.push(c),this.mappings.set(o,a)}remove(e){const t=e.stringTuples(),n=t[0][1]??"",i=t[1][0]===y5?"tcp":"udp",s=parseInt(t[1][1]??"0");let o=!1;for(const[a,c]of this.mappings.entries()){for(let l=0;l<c.length;l++){const d=c[l];d.externalIp===n&&d.externalPort===s&&d.protocol===i&&(this.log("removing %s:%s to %s:%s %s IP mapping",d.externalIp,d.externalPort,n,s,i),o=o||d.verified,c.splice(l,1),l--)}c.length===0&&this.mappings.delete(a)}return o}getAll(e){const t=[];for(const{multiaddr:n}of e){const i=n.stringTuples();let s;if((i[0][0]===p5||i[0][0]===g5)&&i[1][0]===y5?s=`${i[0][1]}-${i[1][1]}-tcp`:(i[0][0]===p5||i[0][0]===g5)&&i[1][0]===Eve&&(s=`${i[0][1]}-${i[1][1]}-udp`),s==null)continue;const o=this.mappings.get(s);if(o!=null)for(const a of o)i[0][0]=a.externalFamily===4?p5:g5,i[0][1]=a.externalIp,i[1][1]=`${a.externalPort}`,t.push({multiaddr:Te(`/${i.map(c=>[Re(c[0]).name,c[1]].join("/")).join("/")}`),verified:a.verified,type:"ip-mapping",expires:a.expires,lastVerified:a.lastVerified})}return t}confirm(e,t){const i=e.stringTuples()[0][1];let s=!1;for(const o of this.mappings.values())for(const a of o)a.externalIp===i&&(this.log("marking %s to %s IP mapping as verified",a.internalIp,a.externalIp),s=a.verified,a.verified=!0,a.expires=Date.now()+t,a.lastVerified=Date.now());return s}unconfirm(e,t){const n=e.stringTuples(),i=n[0][1]??"",s=n[1][0]===y5?"tcp":"udp",o=parseInt(n[1][1]??"0");let a=!1;for(const c of this.mappings.values())for(let l=0;l<c.length;l++){const d=c[l];d.externalIp===i&&d.externalPort===o&&d.protocol===s&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",d.externalIp,d.externalPort,i,o,s),a=a||d.verified,d.verified=!1,d.expires=Date.now()+t)}return a}}const Sve=4,Ave=41;function Cve(r){try{const[[e,t]]=r.stringTuples();if(t==null)return!1;if(e===Sve)return t.startsWith("169.254.");if(e===Ave)return t.toLowerCase().startsWith("fe80")}catch{}return!1}const kve={maxObservedAddresses:10};class Ive{constructor(e,t={}){u(this,"log");u(this,"addresses");u(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??kve.maxObservedAddresses}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(const t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&(Nl(e)||Cve(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:Te(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){var n;const t=((n=this.addresses.get(e.toString()))==null?void 0:n.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){const n=e.toString(),i=this.addresses.get(n)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},s=i.verified;return i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now(),this.log("marking observed address %a as verified",n),this.addresses.set(n,i),s}}const _ve=4,Tve=41,$ve=53,Pve=54,Dve=55,Nve=56,Ove=[_ve,Tve,$ve,Pve,Dve,Nve];function RP(r){try{const[[e]]=r.stringTuples();return Ove.includes(e)}catch{}return!1}const Rve={maxObservedAddresses:10};class Bve{constructor(e,t={}){u(this,"log");u(this,"addresses");u(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??Rve.maxObservedAddresses}get(e,t){if(Nl(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};const n=this.toKey(e);let i=this.addresses.get(n);return i==null&&(i={verified:!RP(e),expires:0},this.addresses.set(n,i)),{multiaddr:e,verified:i.verified,type:"transport",expires:i.expires,lastVerified:i.lastVerified}}has(e){const t=this.toKey(e);return this.addresses.has(t)}remove(e){var i;const t=this.toKey(e),n=((i=this.addresses.get(t))==null?void 0:i.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),n}confirm(e,t){const n=this.toKey(e),i=this.addresses.get(n)??{verified:!1,expires:0,lastVerified:0},s=i.verified;return i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now(),this.addresses.set(n,i),s}unconfirm(e,t){const n=this.toKey(e),i=this.addresses.get(n)??{verified:!1,expires:0},s=i.verified;return i.verified=!1,i.expires=Date.now()+t,this.addresses.set(n,i),s}toKey(e){if(RP(e)){const t=e.toOptions();return`${t.host}-${t.port}-${t.transport}`}return e.toString()}}const BP=6e4,LP={addressVerificationTTL:BP*10,addressVerificationRetry:BP*5},Lve=r=>r;function m5(r,e){const t=r.getPeerId();return t!=null&&xn(t).equals(e)&&(r=r.decapsulate(Te(`/p2p/${e.toString()}`))),r}var tN;tN=Symbol.toStringTag;class Mve{constructor(e,t={}){u(this,"log");u(this,"components");u(this,"listen");u(this,"announce");u(this,"appendAnnounce");u(this,"announceFilter");u(this,"observed");u(this,"dnsMappings");u(this,"ipMappings");u(this,"transportAddresses");u(this,"observedAddressFilter");u(this,"addressVerificationTTL");u(this,"addressVerificationRetry");u(this,tN,"@libp2p/address-manager");const{listen:n=[],announce:i=[],appendAnnounce:s=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=n.map(o=>o.toString()),this.announce=new Set(i.map(o=>o.toString())),this.appendAnnounce=new Set(s.map(o=>o.toString())),this.observed=new Ive(e,t),this.dnsMappings=new vve(e,t),this.ipMappings=new xve(e,t),this.transportAddresses=new Bve(e,t),this.announceFilter=t.announceFilter??Lve,this.observedAddressFilter=Tl(1024),this.addressVerificationTTL=t.addressVerificationTTL??LP.addressVerificationTTL,this.addressVerificationRetry=t.addressVerificationRetry??LP.addressVerificationRetry,this._updatePeerStoreAddresses=pve(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}_updatePeerStoreAddresses(){const e=this.getAddresses().map(t=>t.getPeerId()===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(t=>{this.log.error("error updating addresses",t)})}getListenAddrs(){return Array.from(this.listen).map(e=>Te(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>Te(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>Te(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){const t=e.stringTuples(),n=`${t[0][1]}:${t[1][1]}`;this.observedAddressFilter.has(n)||(this.observedAddressFilter.add(n),e=m5(e,this.components.peerId),!this.ipMappings.has(e)&&(this.dnsMappings.has(e)||this.observed.add(e)))}confirmObservedAddr(e,t){e=m5(e,this.components.peerId);let n=!0;((t==null?void 0:t.type)==="transport"||this.transportAddresses.has(e))&&!this.transportAddresses.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="dns-mapping"||this.dnsMappings.has(e))&&!this.dnsMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="ip-mapping"||this.ipMappings.has(e))&&!this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="observed"||this.observed.has(e))&&(this.maybeUpgradeToIPMapping(e)?(this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL),n=!1):!this.observed.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1)),n||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=m5(e,this.components.peerId),this.observed.has(e)&&this.observed.remove(e),this.transportAddresses.has(e)&&this.transportAddresses.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.dnsMappings.has(e)&&this.dnsMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.ipMappings.has(e)&&this.ipMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry)}getAddresses(){const e=new Set,t=this.getAddressesWithMetadata().filter(n=>{if(!n.verified)return!1;const i=n.multiaddr.toString();return e.has(i)?!1:(e.add(i),!0)}).map(n=>n.multiaddr);return this.announceFilter(t.map(n=>{var s;const i=Te(n);return((s=i.protos().pop())==null?void 0:s.path)===!0||i.getPeerId()===this.components.peerId.toString()?i:i.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){const e=this.getAnnounceAddrs();if(e.length>0)return this.components.transportManager.getListeners().forEach(i=>{i.updateAnnounceAddrs(e)}),e.map(i=>({multiaddr:i,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];t=t.concat(this.components.transportManager.getAddrs().map(i=>this.transportAddresses.get(i,this.addressVerificationTTL)));const n=this.getAppendAnnounceAddrs();return n.length>0&&(this.components.transportManager.getListeners().forEach(i=>{i.updateAnnounceAddrs(n)}),t=t.concat(n.map(i=>({multiaddr:i,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),t=t.concat(this.observed.getAll()),t=t.concat(this.ipMappings.getAll(t)),t=t.concat(this.dnsMappings.getAll(t)),t}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove(Te(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,n,i=t,s="tcp"){this.ipMappings.add(e,t,n,i,s),this.observed.removePrefixed(`/ip${Rd(n)?4:6}/${n}/${s}/${i}`)}removePublicAddressMapping(e,t,n,i=t,s="tcp"){this.ipMappings.remove(Te(`/ip${Rd(n)?4:6}/${n}/${s}/${i}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(e){if(this.ipMappings.has(e))return!1;const t=e.toOptions();if(t.family===6||t.host==="127.0.0.1"||vc(t.host)===!0)return!1;const n=this.components.transportManager.getListeners(),i=[s=>P1.exactMatch(s)||wy.exactMatch(s),s=>my.exactMatch(s),s=>ede.exactMatch(s)];for(const s of i){if(!s(e))continue;const o=n.filter(l=>l.getAddrs().filter(d=>d.toOptions().family===4&&s(d)).length>0);if(o.length!==1)continue;const a=o[0].getAddrs().filter(l=>l.toOptions().host!=="127.0.0.1").pop();if(a==null)continue;const c=a.toOptions();return this.observed.remove(e),this.ipMappings.add(c.host,c.port,t.host,t.port,t.transport),!0}return!1}}var MP;(function(r){r.NOT_STARTED_YET="The libp2p node is not started yet",r.NOT_FOUND="Not found"})(MP||(MP={}));class Uve extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}}class Fve extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}}class w5 extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}}class UP extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}}class zve extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}}class Vve extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}}class Kve extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}}class FP extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}}class jve extends Error{constructor(e="No transport was configured to listen on this address"){super(e),this.name="UnsupportedListenAddressError"}}class Hve extends Error{constructor(e="Configured listen addresses could not be listened on"){super(e),this.name="UnsupportedListenAddressesError"}}class qve extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}}class Wve extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}}class Gve extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}}class t2 extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}}class r2 extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}}class Qve extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}}class Yve{constructor(e={}){u(this,"components",{});u(this,"_started",!1);this.components={};for(const[t,n]of Object.entries(e))this.components[t]=n;this.components.logger==null&&(this.components.logger=Hm())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(t=>kE(t)).map(async t=>{var n;await((n=t[e])==null?void 0:n.call(t))}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const Jve=["metrics","connectionProtector","dns"],Xve=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function Zve(r={}){const e=new Yve(r);return new Proxy(e,{get(n,i,s){if(typeof i=="string"&&!Xve.includes(i)){const o=e.components[i];if(o==null&&!Jve.includes(i))throw new Uve(`${i} not set`);return o}return Reflect.get(n,i,s)},set(n,i,s){return typeof i=="string"?e.components[i]=s:Reflect.set(n,i,s),!0}})}function eEe(r){const e={};for(const t of Object.values(r.components))for(const n of tEe(t))e[n]=!0;for(const t of Object.values(r.components))for(const n of rEe(t))if(e[n]!==!0)throw new Fve(`Service "${nEe(t)}" required capability "${n}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function tEe(r){return Array.isArray(r==null?void 0:r[fr])?r[fr]:[]}function rEe(r){return Array.isArray(r==null?void 0:r[Cl])?r[Cl]:[]}function nEe(r){return(r==null?void 0:r[Symbol.toStringTag])??(r==null?void 0:r.toString())??"unknown"}const iEe=4,sEe=41;function oEe(r={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{if(P1.matches(e))return!1;const t=e.stringTuples();return t[0][0]===iEe||t[0][0]===sEe?!!vc(`${t[0][1]}`):!1},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...r}}function mj(r){if(OB(r))return{peerId:r,multiaddrs:[]};let e=Array.isArray(r)?r:[r],t;if(e.length>0){const n=e[0].getPeerId();t=n==null?void 0:xn(n),e.forEach(i=>{if(!r4(i))throw new km("Invalid multiaddr");const s=i.getPeerId();if(s==null){if(t!=null)throw new Z("Multiaddrs must all have the same peer id or have no peer id")}else{const o=xn(s);if((t==null?void 0:t.equals(o))!==!0)throw new Z("Multiaddrs must all have the same peer id or have no peer id")}})}return e=e.filter(n=>!Yue.exactMatch(n)),{peerId:t,multiaddrs:e}}const aEe=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function cEe(r,e){var i;const t=((i=r==null?void 0:r.streams)==null?void 0:i.map(s=>s.protocol))??[],n=(e==null?void 0:e.closableProtocols)??aEe;if(!(t.filter(s=>s!=null&&!n.includes(s)).length>0))try{await(r==null?void 0:r.close(e))}catch(s){r==null||r.abort(s)}}const wj=1e4,lEe=1e4,zP=1e4,bj=25,uEe=5,dEe=10,hEe=5,fEe="last-dial-failure",pEe="last-dial-success",vj=500,Ej=100,xj=50;async function gEe(r,e){let t=!1;for(const i of Ix.keys())if(t=r.protoNames().includes(i),t)break;if(!t)return[r];const n=await r.resolve(e);return e.log("resolved %s to",r,n.map(i=>i.toString())),n}function G9(r){try{let e;if(typeof r=="string"?e=Te(r):e=r,!e.protoNames().includes("ipcidr")){const n=e.protoNames().includes("ip6")?"/ipcidr/128":"/ipcidr/32";e=e.encapsulate(n)}return zhe(e)}catch{throw new Error(`Can't convert to IpNet, Invalid multiaddr format: ${r}`)}}const yEe={maxConnections:Ej};class mEe{constructor(e,t={}){u(this,"maxConnections");u(this,"connectionManager");u(this,"peerStore");u(this,"allow");u(this,"events");u(this,"log");this.maxConnections=t.maxConnections??yEe.maxConnections,this.allow=(t.allow??[]).map(n=>G9(n)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections %e",e)})}async _maybePruneConnections(){const e=this.connectionManager.getConnections(),t=e.length;if(this.log("checking max connections limit %d/%d",t,this.maxConnections),t<=this.maxConnections)return;const n=new bc;for(const a of e){const c=a.remotePeer;if(!n.has(c)){n.set(c,0);try{const l=await this.peerStore.get(c);n.set(c,[...l.tags.values()].reduce((d,h)=>d+h.value,0))}catch(l){l.name!=="NotFoundError"&&this.log.error("error loading peer tags",l)}}}const i=this.sortConnections(e,n),s=Math.max(t-this.maxConnections,0),o=[];for(const a of i)if(this.log("too many connections open - closing a connection to %p",a.remotePeer),this.allow.some(l=>l.contains(a.remoteAddr.nodeAddress().address))||o.push(a),o.length===s)break;await Promise.all(o.map(async a=>{await cEe(a,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:o})}sortConnections(e,t){return e.sort((n,i)=>{const s=n.timeline.open,o=i.timeline.open;return s<o?1:s>o?-1:0}).sort((n,i)=>n.direction==="outbound"&&i.direction==="inbound"?1:n.direction==="inbound"&&i.direction==="outbound"?-1:0).sort((n,i)=>n.streams.length>i.streams.length?1:n.streams.length<i.streams.length?-1:0).sort((n,i)=>{const s=t.get(n.remotePeer)??0,o=t.get(i.remotePeer)??0;return s>o?1:s<o?-1:0})}}class wEe extends _l{constructor(e={}){super({...e,sort:(t,n)=>t.options.priority>n.options.priority?-1:t.options.priority<n.options.priority?1:0})}}function bEe(r){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r)||/^::1$/.test(r)}function VP(r){if(!uz(r))return!1;const{address:e}=r.nodeAddress();return bEe(e)}function vEe(r,e){const t=my.exactMatch(r.multiaddr),n=my.exactMatch(e.multiaddr);if(t&&!n)return-1;if(!t&&n)return 1;const i=wy.exactMatch(r.multiaddr),s=wy.exactMatch(e.multiaddr);if(i&&!s)return-1;if(!i&&s)return 1;const o=P1.exactMatch(r.multiaddr),a=P1.exactMatch(e.multiaddr);if(o&&!a)return-1;if(!o&&a)return 1;const c=_7.exactMatch(r.multiaddr),l=_7.exactMatch(e.multiaddr);if(c&&!l)return-1;if(!c&&l)return 1;const d=I7.exactMatch(r.multiaddr),h=I7.exactMatch(e.multiaddr);if(d&&!h)return-1;if(!d&&h)return 1;const p=PI.exactMatch(r.multiaddr),b=PI.exactMatch(e.multiaddr);return p&&!b?-1:!p&&b?1:0}function EEe(r,e){const t=VP(r.multiaddr),n=VP(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function xEe(r,e){const t=Nl(r.multiaddr),n=Nl(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function SEe(r,e){return r.isCertified&&!e.isCertified?-1:!r.isCertified&&e.isCertified?1:0}function AEe(r,e){const t=sc.exactMatch(r.multiaddr),n=sc.exactMatch(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function CEe(r){return r.sort(vEe).sort(SEe).sort(AEe).sort(xEe).sort(EEe)}const n2={maxParallelDials:xj,maxDialQueueLength:vj,maxPeerAddrsToDial:bj,dialTimeout:wj};class kEe{constructor(e,t={}){u(this,"queue");u(this,"components");u(this,"addressSorter");u(this,"maxPeerAddrsToDial");u(this,"maxDialQueueLength");u(this,"dialTimeout");u(this,"shutDownController");u(this,"connections");u(this,"log");this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??n2.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??n2.maxDialQueueLength,this.dialTimeout=t.dialTimeout??n2.dialTimeout,this.connections=t.connections??new bc,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.shutDownController=new AbortController,this.shutDownController.signal;for(const[n,i]of Object.entries(t.resolvers??{}))Ix.set(n,i);this.queue=new wEe({concurrency:t.maxParallelDials??n2.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",n=>{var i;((i=n.detail)==null?void 0:i.name)!==Sl.name&&this.log.error("error in dial queue - %e",n.detail)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e,t={}){var a,c,l;const{peerId:n,multiaddrs:i}=mj(e),s=Array.from(this.connections.values()).flat().find(d=>t.force===!0?!1:d.remotePeer.equals(n)?!0:i.find(h=>h.equals(d.remoteAddr)));if((s==null?void 0:s.status)==="open")return this.log("already connected to %a",s.remoteAddr),(a=t.onProgress)==null||a.call(t,new ke("dial-queue:already-connected")),s;const o=this.queue.queue.find(d=>{if((n==null?void 0:n.equals(d.options.peerId))===!0)return!0;const h=d.options.multiaddrs;if(h==null)return!1;for(const p of i)if(h.has(p.toString()))return!0;return!1});if(o!=null){this.log("joining existing dial target for %p",n);for(const d of i)o.options.multiaddrs.add(d.toString());return(c=t.onProgress)==null||c.call(t,new ke("dial-queue:already-in-dial-queue")),o.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new Gu("Dial queue is full");return this.log("creating dial target for %p",n,i.map(d=>d.toString())),(l=t.onProgress)==null||l.call(t,new ke("dial-queue:add-to-dial-queue")),this.queue.add(async d=>{var p;(p=d.onProgress)==null||p.call(d,new ke("dial-queue:start-dial"));const h=ct([this.shutDownController.signal,d.signal]);try{return await this.dialPeer(d,h)}finally{h.clear()}},{peerId:n,priority:t.priority??Aj,multiaddrs:new Set(i.map(d=>d.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})}async dialPeer(e,t){var d;const n=e.peerId,i=e.multiaddrs,s=new Set;let o=e.multiaddrs.size===0,a=0,c=0;const l=[];for(this.log("starting dial to %p",n);o||i.size>0;){c++,o=!1;const h=[],p=new Set(e.multiaddrs);i.clear(),this.log("calculating addrs to dial %p from %s",n,[...p]);const b=await this.calculateMultiaddrs(n,p,{...e,signal:t});for(const f of b){if(s.has(f.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",f.multiaddr,n);continue}h.push(f)}this.log("%s dial to %p with %s",c===1?"starting":"continuing",n,h.map(f=>f.multiaddr.toString())),(d=e==null?void 0:e.onProgress)==null||d.call(e,new ke("dial-queue:calculated-addresses",h));for(const f of h){if(a===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",a,e.peerId),new Gu("Peer had more than maxPeerAddrsToDial");a++;try{const g=await this.components.transportManager.dial(f.multiaddr,{...e,signal:t});this.log("dial to %a succeeded",f.multiaddr);try{await this.components.peerStore.merge(g.remotePeer,{multiaddrs:[g.remoteAddr],metadata:{[pEe]:se(Date.now().toString())}})}catch(v){this.log.error("could not update last dial failure key for %p",n,v)}return g}catch(g){if(this.log.error("dial failed to %a",f.multiaddr,g),s.add(f.multiaddr.toString()),n!=null)try{await this.components.peerStore.merge(n,{metadata:{[fEe]:se(Date.now().toString())}})}catch(v){this.log.error("could not update last dial failure key for %p",n,v)}if(t.aborted)throw new m0(g.message);l.push(g)}}}throw l.length===1?l[0]:new AggregateError(l,"All multiaddr dials failed")}async calculateMultiaddrs(e,t=new Set,n={}){var h,p;const i=[...t].map(b=>({multiaddr:Te(b),isCertified:!1}));if(e!=null){if(this.components.peerId.equals(e))throw new Gu("Tried to dial self");if(await((p=(h=this.components.connectionGater).denyDialPeer)==null?void 0:p.call(h,e))===!0)throw new FP("The dial request is blocked by gater.allowDialPeer");if(i.length===0){this.log("loading multiaddrs for %p",e);try{const b=await this.components.peerStore.get(e);i.push(...b.addresses),this.log("loaded multiaddrs for %p",e,i.map(({multiaddr:f})=>f.toString()))}catch(b){if(b.name!=="NotFoundError")throw b}}if(i.length===0){this.log("looking up multiaddrs for %p in the peer routing",e);try{const b=await this.components.peerRouting.findPeer(e,n);this.log("found multiaddrs for %p in the peer routing",e,i.map(({multiaddr:f})=>f.toString())),i.push(...b.multiaddrs.map(f=>({multiaddr:f,isCertified:!1})))}catch(b){b.name==="NoPeerRoutersError"?this.log("no peer routers configured",e):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",e,b)}}}let s=(await Promise.all(i.map(async b=>{const f=await gEe(b.multiaddr,{dns:this.components.dns,...n,log:this.log});return f.length===1&&f[0].equals(b.multiaddr)?b:f.map(g=>({multiaddr:g,isCertified:!1}))}))).flat();if(e!=null){const b=`/p2p/${e.toString()}`;s=s.map(f=>{const g=f.multiaddr.protos().pop();return(g==null?void 0:g.path)===!0?f:f.multiaddr.getPeerId()==null?{multiaddr:f.multiaddr.encapsulate(b),isCertified:f.isCertified}:f})}const o=s.filter(b=>{if(this.components.transportManager.dialTransportForMultiaddr(b.multiaddr)==null)return!1;const f=b.multiaddr.getPeerId();return e!=null&&f!=null?e.equals(f):!0}),a=new Map;for(const b of o){const f=b.multiaddr.toString(),g=a.get(f);if(g!=null){g.isCertified=g.isCertified||b.isCertified||!1;continue}a.set(f,b)}const c=[...a.values()];if(c.length===0)throw new qve("The dial request has no valid addresses");const l=[];for(const b of c)this.components.connectionGater.denyDialMultiaddr!=null&&await this.components.connectionGater.denyDialMultiaddr(b.multiaddr)||l.push(b);const d=this.addressSorter==null?CEe(l):l.sort(this.addressSorter);if(d.length===0)throw new FP("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",s.map(({multiaddr:b})=>b.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",d.map(({multiaddr:b})=>b.toString())),d}async isDialable(e,t={}){Array.isArray(e)||(e=[e]);try{const n=await this.calculateMultiaddrs(void 0,new Set(e.map(i=>i.toString())),t);return t.runOnLimitedConnection===!1?n.find(i=>!sc.matches(i.multiaddr))!=null:!0}catch(n){this.log.trace("error calculating if multiaddr(s) were dialable",n)}return!1}}var Sj={};function vi(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var IEe=vi;vi.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};vi.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};vi.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};vi.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};vi.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};vi.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};vi.prototype.start=vi.prototype.try;vi.prototype.errors=function(){return this._errors};vi.prototype.attempts=function(){return this._attempts};vi.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var i=this._errors[n],s=i.message,o=(r[s]||0)+1;r[s]=o,o>=t&&(e=i,t=o)}return e};(function(r){var e=IEe;r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in t)n[i]=t[i];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],o=0;o<n.retries;o++)s.push(this.createTimeout(o,n));return t&&t.forever&&!s.length&&s.push(this.createTimeout(o,n)),s.sort(function(a,c){return a-c}),s},r.createTimeout=function(t,n){var i=n.randomize?Math.random()+1:1,s=Math.round(i*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return s=Math.min(s,n.maxTimeout),s},r.wrap=function(t,n,i){if(n instanceof Array&&(i=n,n=null),!i){i=[];for(var s in t)typeof t[s]=="function"&&i.push(s)}for(var o=0;o<i.length;o++){var a=i[o],c=t[a];t[a]=(function(d){var h=r.operation(n),p=Array.prototype.slice.call(arguments,1),b=p.pop();p.push(function(f){h.retry(f)||(f&&(arguments[0]=h.mainError()),b.apply(this,arguments))}),h.attempt(function(){d.apply(t,p)})}).bind(t,c),t[a].options=n}}})(Sj);var _Ee=Sj;const TEe=hc(_Ee),$Ee=Object.prototype.toString,PEe=r=>$Ee.call(r)==="[object Error]",DEe=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function NEe(r){return r&&PEe(r)&&r.name==="TypeError"&&typeof r.message=="string"?r.message==="Load failed"?r.stack===void 0:DEe.has(r.message):!1}class OEe extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const KP=(r,e,t)=>{const n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r};async function REe(r,e){return new Promise((t,n)=>{e={...e},e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.retries??(e.retries=10);const i=TEe.operation(e),s=()=>{var a;i.stop(),n((a=e.signal)==null?void 0:a.reason)};e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",s,{once:!0});const o=()=>{var a;(a=e.signal)==null||a.removeEventListener("abort",s),i.stop()};i.attempt(async a=>{try{const c=await r(a);o(),t(c)}catch(c){try{if(!(c instanceof Error))throw new TypeError(`Non-error was thrown: "${c}". You should only throw errors.`);if(c instanceof OEe)throw c.originalError;if(c instanceof TypeError&&!NEe(c))throw c;if(KP(c,a,e),await e.shouldRetry(c)||(i.stop(),n(c)),await e.onFailedAttempt(c),!i.retry(c))throw i.mainError()}catch(l){KP(l,a,e),o(),n(l)}}})})}class BEe{constructor(e,t={}){u(this,"log");u(this,"queue");u(this,"started");u(this,"peerStore");u(this,"retries");u(this,"retryInterval");u(this,"backoffFactor");u(this,"connectionManager");u(this,"events");this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new nc({concurrency:t.maxParallelReconnects??hEe,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",n=>{this.maybeReconnect(n.detail).catch(i=>{this.log.error("failed to maybe reconnect to %p - %e",n.detail,i)})})}async maybeReconnect(e){if(!this.started)return;const t=await this.peerStore.get(e);jP(t)&&(this.queue.has(e)||this.queue.add(async n=>{await REe(async i=>{if(this.started)try{await this.connectionManager.openConnection(e,{signal:n==null?void 0:n.signal})}catch(s){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,i,this.retries,s),s}},{signal:n==null?void 0:n.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:e}).catch(async n=>{this.log.error("failed to reconnect to %p - %e",e,n);const i={};[...t.tags.keys()].forEach(s=>{s.startsWith(Am)&&(i[s]=void 0)}),await this.peerStore.merge(e,{tags:i}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})}).catch(async n=>{this.log.error("failed to remove keep-alive tag from %p - %e",e,n)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[t=>jP(t)]});await Promise.all(e.map(async t=>{await this.connectionManager.openConnection(t.id).catch(n=>{this.log.error(n)})}))}).catch(e=>{this.log.error(e)})}stop(){this.started=!1,this.queue.abort()}}function jP(r){for(const e of r.tags.keys())if(e.startsWith(Am))return!0;return!1}const Aj=50,b5={maxConnections:Ej,inboundConnectionThreshold:uEe,maxIncomingPendingConnections:dEe};var rN;rN=Symbol.toStringTag;class LEe{constructor(e,t={}){u(this,"started");u(this,"connections");u(this,"allow");u(this,"deny");u(this,"maxIncomingPendingConnections");u(this,"incomingPendingConnections");u(this,"outboundPendingConnections");u(this,"maxConnections");u(this,"dialQueue");u(this,"reconnectQueue");u(this,"connectionPruner");u(this,"inboundConnectionRateLimiter");u(this,"peerStore");u(this,"metrics");u(this,"events");u(this,"log");u(this,"peerId");u(this,rN,"@libp2p/connection-manager");var n;if(this.maxConnections=t.maxConnections??b5.maxConnections,this.maxConnections<1)throw new Z("Connection Manager maxConnections must be greater than 0");this.connections=new bc,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(i=>G9(i)),this.deny=(t.deny??[]).map(i=>G9(i)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??b5.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new JV({points:t.inboundConnectionThreshold??b5.inboundConnectionThreshold,duration:1}),this.connectionPruner=new mEe({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{maxConnections:this.maxConnections,allow:(n=t.allow)==null?void 0:n.map(i=>Te(i))}),this.dialQueue=new kEe(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??xj,maxDialQueueLength:t.maxDialQueueLength??vj,maxPeerAddrsToDial:t.maxPeerAddrsToDial??bj,dialTimeout:t.dialTimeout??wj,resolvers:t.resolvers??{dnsaddr:aj},connections:this.connections}),this.reconnectQueue=new BEe({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}async start(){var e,t,n;(e=this.metrics)==null||e.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const i={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(const s of this.connections.values())for(const o of s)i[o.direction]++;return i}}),(t=this.metrics)==null||t.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const i={};for(const s of this.connections.values())for(const o of s)for(const a of o.streams){const c=`${a.direction} ${a.protocol??"unnegotiated"}`;i[c]=(i[c]??0)+1}return i}}),(n=this.metrics)==null||n.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const i={};for(const o of this.connections.values())for(const a of o){const c={};for(const l of a.streams){const d=`${l.direction} ${l.protocol??"unnegotiated"}`;c[d]=(c[d]??0)+1}for(const[l,d]of Object.entries(c))i[l]=i[l]??[],i[l].push(d)}const s={};for(let[o,a]of Object.entries(i)){a=a.sort((l,d)=>l-d);const c=Math.floor(a.length*.9);s[o]=a[c]}return s}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await Eo(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await mc(this.reconnectQueue,this.dialQueue,this.connectionPruner);const e=[];for(const t of this.connections.values())for(const n of t)e.push((async()=>{try{await n.close()}catch(i){this.log.error(i)}})());this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}onConnect(e){this._onConnect(e).catch(t=>{this.log.error(t)})}async _onConnect(e){const{detail:t}=e;if(!this.started){await t.close();return}if(t.status!=="open")return;const n=t.remotePeer,i=!this.connections.has(n),s=this.connections.get(n)??[];s.push(t),this.connections.set(n,s),n.publicKey!=null&&n.type==="RSA"&&await this.peerStore.patch(n,{publicKey:n.publicKey}),i&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){const{detail:t}=e,n=t.remotePeer,s=(this.connections.get(n)??[]).filter(o=>o.id!==t.id);this.connections.set(n,s),s.length===0&&(this.log("onDisconnect remove all connections for peer %p",n),this.connections.delete(n),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let t=[];for(const n of this.connections.values())t=t.concat(n);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){var n,i;if(!this.started)throw new Al("Not started");this.outboundPendingConnections++;try{(n=t.signal)==null||n.throwIfAborted();const{peerId:s}=mj(e);if(this.peerId.equals(s))throw new AE("Can not dial self");if(s!=null&&t.force!==!0){this.log("dial %p",s);const l=this.getConnections(s).find(d=>d.limits==null);if(l!=null)return this.log("had an existing non-limited connection to %p",s),(i=t.onProgress)==null||i.call(t,new ke("dial-queue:already-connected")),l}const o=await this.dialQueue.dial(e,{...t,priority:t.priority??Aj});if(o.status!=="open")throw new xE("Remote closed connection during opening");let a=this.connections.get(o.remotePeer);a==null&&(a=[],this.connections.set(o.remotePeer,a));let c=!1;for(const l of a)if(l.id===o.id&&(c=!0),t.force!==!0&&l.id!==o.id&&l.remoteAddr.equals(o.remoteAddr))return o.abort(new km("Duplicate multiaddr connection")),l;return c||a.push(o),o}finally{this.outboundPendingConnections--}}async closeConnections(e,t={}){const n=this.connections.get(e)??[];await Promise.all(n.map(async i=>{try{await i.close(t)}catch(s){i.abort(s)}}))}async acceptIncomingConnection(e){if(this.deny.some(i=>i.contains(e.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(i=>i.contains(e.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const i=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(i,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,i),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(n=>Te(n))}))}async isDialable(e,t={}){return this.dialQueue.isDialable(e,t)}}const MEe=1e4,UEe="1.0.0",FEe="ping",zEe="ipfs",HP=32,VEe=!0;var nN,iN;iN=Symbol.toStringTag,nN=fr;class KEe{constructor(e,t={}){u(this,"protocol");u(this,"components");u(this,"log");u(this,"heartbeatInterval");u(this,"pingIntervalMs");u(this,"abortController");u(this,"timeout");u(this,"abortConnectionOnPingFailure");u(this,iN,"@libp2p/connection-monitor");u(this,nN,["@libp2p/connection-monitor"]);this.components=e,this.protocol=`/${t.protocolPrefix??zEe}/${FEe}/${UEe}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??MEe,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??VEe,this.timeout=new L1({...t.pingTimeout??{},metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(async()=>{var n;let t=Date.now();try{const i=this.timeout.getTimeoutSignal({signal:(n=this.abortController)==null?void 0:n.signal}),s=await e.newStream(this.protocol,{signal:i,runOnLimitedConnection:!0}),o=By(s);t=Date.now(),await Promise.all([o.write(Il(HP),{signal:i}),o.read({bytes:HP,signal:i})]),e.rtt=Date.now()-t,await o.unwrap().close({signal:i})}catch(i){if(i.name!=="UnsupportedProtocolError")throw i;e.rtt=(Date.now()-t)/2}}).catch(t=>{this.log.error("error during heartbeat",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){var e;(e=this.abortController)==null||e.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}}var sN;sN=Symbol.toStringTag;class jEe{constructor(e,t){u(this,"routers");u(this,"started");u(this,"components");u(this,sN,"@libp2p/content-routing");var n,i,s,o,a;this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()}),getAttributesFromYieldedValue:(c,l)=>({...l,providers:[...Array.isArray(l.providers)?l.providers:[],c.id.toString()]})}))??this.findProviders,this.provide=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.provide,this.cancelReprovide=((s=e.metrics)==null?void 0:s.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.cancelReprovide,this.put=((o=e.metrics)==null?void 0:o.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([c])=>({key:re(c,"base36")})}))??this.put,this.get=((a=e.metrics)==null?void 0:a.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([c])=>({key:re(c,"base36")})}))??this.get}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw new w5("No content routers available");const n=this,i=new Hi;for await(const s of Ka(...n.routers.map(o=>o.findProviders(e,t))))s!=null&&(s.multiaddrs.length>0&&await this.components.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),!i.has(s.id)&&(i.add(s.id),yield s))}async provide(e,t={}){if(this.routers.length===0)throw new w5("No content routers available");await Promise.all(this.routers.map(async n=>{await n.provide(e,t)}))}async cancelReprovide(e,t={}){if(this.routers.length===0)throw new w5("No content routers available");await Promise.all(this.routers.map(async n=>{await n.cancelReprovide(e,t)}))}async put(e,t,n){if(!this.isStarted())throw new Al;await Promise.all(this.routers.map(async i=>{await i.put(e,t,n)}))}async get(e,t){if(!this.isStarted())throw new Al;return Promise.any(this.routers.map(async n=>n.get(e,t)))}}var oN;oN=Symbol.toStringTag;class HEe{constructor(e,t={}){u(this,"log");u(this,"peerId");u(this,"peerStore");u(this,"routers");u(this,oN,"@libp2p/peer-routing");var n,i;this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([s],o)=>({...o,peer:s.toString()})}))??this.findPeer,this.getClosestPeers=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([s],o)=>({...o,key:re(s,"base36")}),getAttributesFromYieldedValue:(s,o)=>({...o,peers:[...Array.isArray(o.peers)?o.peers:[],s.id.toString()]})}))??this.getClosestPeers}async findPeer(e,t){if(this.routers.length===0)throw new UP("No peer routers available");if(e.toString()===this.peerId.toString())throw new zve("Should not try to find self");const n=this,i=Ka(...this.routers.map(s=>async function*(){try{yield await s.findPeer(e,t)}catch(o){n.log.error(o)}}()));for await(const s of i)if(s!=null)return s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),s;throw new jt}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new UP("No peer routers available");const n=this,i=Tl(1024);for await(const s of I0(async function*(){const o=Ka(...n.routers.map(a=>a.getClosestPeers(e,t)));for await(let a of o)yield async()=>{if(a.multiaddrs.length===0)try{a=await n.findPeer(a.id,{...t,useCache:!1})}catch(c){n.log.error("could not find peer multiaddrs",c);return}return a}}()))s!=null&&(s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),!i.has(s.id.toMultihash().bytes)&&(i.add(s.id.toMultihash().bytes),yield s))}}var aN,cN;class qEe extends(cN=Gt,aN=Symbol.toStringTag,cN){constructor(t){super();u(this,"peerRouting");u(this,"log");u(this,"walking");u(this,"walkers");u(this,"shutdownController");u(this,"walkController");u(this,"needNext");u(this,aN,"@libp2p/random-walk");this.log=t.logger.forComponent("libp2p:random-walk"),this.peerRouting=t.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}async*walk(t){var i,s;this.walking||this.startWalk(),this.walkers++;const n=ct([this.shutdownController.signal,t==null?void 0:t.signal]);try{for(;;)(i=this.needNext)==null||i.resolve(),this.needNext=De(),yield(await di(this,"walk:peer",n,{errorEvent:"walk:error"})).detail}finally{n.clear(),this.walkers--,this.walkers===0&&((s=this.walkController)==null||s.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;const t=ct([this.walkController.signal,this.shutdownController.signal]),n=Date.now();let i=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const s=Il(32);let o=Date.now();for await(const a of this.peerRouting.getClosestPeers(s,{signal:t}))t.aborted&&this.log("aborting walk"),t.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",a.id,Date.now()-o,this.walkers),i++,this.safeDispatchEvent("walk:peer",{detail:a}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),await Zr(this.needNext.promise,t)),o=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",s,this.walkers,i)}catch(s){this.log.error("random walk errored",s),this.safeDispatchEvent("walk:error",{detail:s})}this.log("no walkers left, ended walk")}).catch(s=>{this.log.error("random walk errored",s)}).finally(()=>{this.log("finished walk, found %d peers after %dms",i,Date.now()-n),this.walking=!1})}}const Cj=32,kj=64;var lN;lN=Symbol.toStringTag;class WEe{constructor(e){u(this,"log");u(this,"topologies");u(this,"handlers");u(this,"components");u(this,lN,"@libp2p/registrar");this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(t==null)throw new Vve(`No handler registered for protocol ${e}`);return t}getTopologies(e){const t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,n){if(this.handlers.has(e)&&(n==null?void 0:n.force)!==!0)throw new Kve(`Handler already registered for protocol ${e}`);const i=Gx.bind({ignoreUndefined:!0})({maxInboundStreams:Cj,maxOutboundStreams:kj},n);this.handlers.set(e,{handler:t,options:i}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]})}async unhandle(e){(Array.isArray(e)?e:[e]).forEach(n=>{this.handlers.delete(n)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(e,t){if(t==null)throw new Z("invalid topology");const n=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let i=this.topologies.get(e);return i==null&&(i=new Map,this.topologies.set(e,i)),i.set(n,t),n}unregister(e){for(const[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),n.size===0&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail;this.components.peerStore.get(t).then(n=>{var i,s,o;for(const a of n.protocols){const c=this.topologies.get(a);if(c!=null)for(const l of c.values())((i=l.filter)==null?void 0:i.has(t))!==!1&&((s=l.filter)==null||s.remove(t),(o=l.onDisconnect)==null||o.call(l,t))}}).catch(n=>{n.name!=="NotFoundError"&&this.log.error("could not inform topologies of disconnecting peer %p",t,n)})}_onPeerUpdate(e){var s,o,a;const{peer:t,previous:n}=e.detail,i=((n==null?void 0:n.protocols)??[]).filter(c=>!t.protocols.includes(c));for(const c of i){const l=this.topologies.get(c);if(l!=null)for(const d of l.values())((s=d.filter)==null?void 0:s.has(t.id))!==!1&&((o=d.filter)==null||o.remove(t.id),(a=d.onDisconnect)==null||a.call(d,t.id))}}_onPeerIdentify(e){var s,o,a;const t=e.detail.protocols,n=e.detail.connection,i=e.detail.peerId;for(const c of t){const l=this.topologies.get(c);if(l!=null)for(const d of l.values())n.limits!=null&&d.notifyOnLimitedConnection!==!0||((s=d.filter)==null?void 0:s.has(i))!==!0&&((o=d.filter)==null||o.add(i),(a=d.onConnect)==null||a.call(d,i,n))}}}var uN;uN=Symbol.toStringTag;class GEe{constructor(e,t={}){u(this,"log");u(this,"components");u(this,"transports");u(this,"listeners");u(this,"faultTolerance");u(this,"started");u(this,uN,"@libp2p/transport-manager");this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=new Map,this.listeners=TU({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??w1.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(t==null)throw new Z("Transport must have a valid tag");if(this.transports.has(t))throw new Z(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[t,n]of this.listeners)for(this.log("closing listeners for %s",t);n.length>0;){const i=n.pop();i!=null&&e.push(i.close())}await Promise.all(e),this.log("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){var i;const n=this.dialTransportForMultiaddr(e);if(n==null)throw new Qve(`No transport available for address ${String(e)}`);return(i=t==null?void 0:t.onProgress)==null||i.call(t,new ke("transport-manager:selected-transport",n[Symbol.toStringTag])),n.dial(e,{...t,upgrader:this.components.upgrader})}getAddrs(){let e=[];for(const t of this.listeners.values())for(const n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(const t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(const t of this.transports.values())if(t.listenFilter([e]).length>0)return t}async listen(e){if(!this.isStarted())throw new Al("Not started");if(e==null||e.length===0){this.log("no addresses were provided for listening, this node is dial only");return}const t={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};e.forEach(s=>{t.errors.set(s.toString(),new jve)});const n=[];for(const[s,o]of this.transports.entries()){const a=o.listenFilter(e);for(const c of a){this.log("creating listener for %s on %a",s,c);const l=o.createListener({upgrader:this.components.upgrader});let d=this.listeners.get(s)??[];d==null&&(d=[],this.listeners.set(s,d)),d.push(l),l.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:l})}),l.addEventListener("close",()=>{const h=d.findIndex(p=>p===l);d.splice(h,1),this.components.events.safeDispatchEvent("transport:close",{detail:l})}),TI.matches(c)?t.ipv4.attempts++:$I.matches(c)&&t.ipv6.attempts++,n.push(l.listen(c).then(()=>{t.errors.delete(c.toString()),TI.matches(c)&&t.ipv4.success++,$I.matches(c)&&t.ipv6.success++},h=>{throw this.log.error("transport %s could not listen on address %a - %e",s,c,h),t.errors.set(c.toString(),h),h}))}}const i=await Promise.allSettled(n);if(!(i.length>0&&i.every(s=>s.status==="fulfilled"))){if(this.ipv6Unsupported(t)){this.log("all IPv4 addresses succeed but all IPv6 failed");return}if(this.faultTolerance===w1.NO_FATAL){this.log("failed to listen on any address but fault tolerance allows this");return}throw new Hve(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...t.errors.entries()].map(([s,o])=>`
  ${s}: ${`${o.stack??o}`.split(`
`).join(`
  `)}
`).join("")}`)}}ipv6Unsupported(e){if(e.ipv4.attempts===0||e.ipv6.attempts===0)return!1;const t=e.ipv4.attempts===e.ipv4.success,n=e.ipv6.success===0;return t&&n}async remove(e){const t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);const n=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){const i=t.pop();i!=null&&n.push(i.close())}await Promise.all(n),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}const hn="/multistream/1.0.0",WS=1024,QEe=se(`
`);async function _f(r,e,t){await r.write(e,t)}async function YEe(r,e,t){await r.writeV(e,t)}async function JEe(r,e){const t=await r.read(e);if(t.byteLength===0||t.get(t.byteLength-1)!==QEe[0])throw e.log.error("Invalid mss message - missing newline",t),new pt("Missing newline");return t.sublist(0,-1)}async function nd(r,e){const t=await JEe(r,e);return re(t.subarray())}async function v5(r,e,t){if(e=Array.isArray(e)?[...e]:[e],e.length===1&&t.negotiateFully===!1)return XEe(r,e[0],t);const n=Bd(r,{...t,maxDataLength:WS}),i=e.shift();if(i==null)throw new Error("At least one protocol must be specified");t.log.trace('select: write ["%s", "%s"]',hn,i);const s=se(`${hn}
`),o=se(`${i}
`);await YEe(n,[s,o],t),t.log.trace("select: reading multistream-select header");let a=await nd(n,t);if(t.log.trace('select: read "%s"',a),a===hn&&(t.log.trace("select: reading protocol response"),a=await nd(n,t),t.log.trace('select: read "%s"',a)),a===i)return{stream:n.unwrap(),protocol:i};for(const c of e){t.log.trace('select: write "%s"',c),await _f(n,se(`${c}
`),t),t.log.trace("select: reading protocol response");const l=await nd(n,t);if(t.log.trace('select: read "%s" for "%s"',l,c),l===c)return{stream:n.unwrap(),protocol:c}}throw new y0("protocol selection failed")}function XEe(r,e,t){const n=r.sink.bind(r),i=r.source;let s=!1,o=!1;const a=De();let c=!1,l=!1;const d=De();let h=!1,p=!1;const b=De(),f=Bd({sink:n,source:i},{...t,maxDataLength:WS});r.sink=async w=>{const{sink:m}=f.unwrap();await m(async function*(){let E=!1;for await(const C of w){if(l&&await d.promise,c)yield C;else{l=!0,t.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',hn,e,C.byteLength);const k=`${e}
`;yield new Be(Uint8Array.from([19]),se(`${hn}
`),Hr(k.length),se(k),C).subarray(),t.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',hn,e,C.byteLength),c=!0,l=!1,d.resolve(),g().catch(A=>{t.log.error("could not finish optimistic protocol negotiation of %s",e,A)})}E=!0}E||await g()}())};async function g(){if(o){t.log.trace("optimistic: already negotiating %s stream",e),await a.promise;return}o=!0;try{c||(t.log.trace("optimistic: doing send protocol for %s stream",e),await v()),h||(t.log.trace("optimistic: doing read protocol for %s stream",e),await y())}finally{o=!1,s=!0,a.resolve()}}async function v(){if(l){await d.promise;return}l=!0;try{t.log.trace('optimistic: write ["%s", "%s", data] in source',hn,e),await f.writeV([se(`${hn}
`),se(`${e}
`)]),t.log.trace('optimistic: wrote ["%s", "%s", data] in source',hn,e)}finally{c=!0,l=!1,d.resolve()}}async function y(){if(p){await b.promise;return}p=!0;try{t.log.trace("optimistic: reading multistream select header");let w=await nd(f,t);if(t.log.trace('optimistic: read multistream select header "%s"',w),w===hn&&(w=await nd(f,t)),t.log.trace('optimistic: read protocol "%s", expecting "%s"',w,e),w!==e)throw new y0("protocol selection failed")}finally{h=!0,p=!1,b.resolve()}}if(r.source=async function*(){await g(),t.log.trace('optimistic: reading data from "%s" stream',e),yield*f.unwrap().source}(),r.closeRead!=null){const w=r.closeRead.bind(r);r.closeRead=async m=>{s||await g().catch(E=>{t.log.error("could not negotiate protocol before close read",E)}),await w(m)}}if(r.closeWrite!=null){const w=r.closeWrite.bind(r);r.closeWrite=async m=>{s||await g().catch(E=>{t.log.error("could not negotiate protocol before close write",E)}),await w(m)}}if(r.close!=null){const w=r.close.bind(r);r.close=async m=>{const E=[];l&&E.push(d.promise),p&&E.push(b.promise),E.length>0?await Zr(Promise.all(E),m==null?void 0:m.signal):(s=!0,o=!1,a.resolve()),await w(m)}}return{stream:r,protocol:e}}async function E5(r,e,t){e=Array.isArray(e)?e:[e],t.log.trace("handle: available protocols %s",e);const n=Bd(r,{...t,maxDataLength:WS,maxLengthLength:2});for(;;){t.log.trace("handle: reading incoming string");const i=await nd(n,t);if(t.log.trace('handle: read "%s"',i),i===hn){t.log.trace('handle: respond with "%s" for "%s"',hn,i),await _f(n,se(`${hn}
`),t),t.log.trace('handle: responded with "%s" for "%s"',hn,i);continue}if(e.includes(i))return t.log.trace('handle: respond with "%s" for "%s"',i,i),await _f(n,se(`${i}
`),t),t.log.trace('handle: responded with "%s" for "%s"',i,i),{stream:n.unwrap(),protocol:i};if(i==="ls"){const s=new Be(...e.map(o=>_d.single(se(`${o}
`))),se(`
`));t.log.trace('handle: respond with "%s" for %s',e,i),await _f(n,s,t),t.log.trace('handle: responded with "%s" for %s',e,i);continue}t.log.trace('handle: respond with "na" for "%s"',i),await _f(n,se(`na
`),t),t.log('handle: responded with "na" for "%s"',i)}}const ZEe=500;var dN,hN;hN=Symbol.toStringTag,dN=iX;class exe{constructor(e){u(this,"id");u(this,"remoteAddr");u(this,"remotePeer");u(this,"direction");u(this,"timeline");u(this,"multiplexer");u(this,"encryption");u(this,"status");u(this,"limits");u(this,"log");u(this,"tags");u(this,"_newStream");u(this,"_close");u(this,"_abort");u(this,"_getStreams");u(this,hN,"Connection");u(this,dN,!0);const{remoteAddr:t,remotePeer:n,newStream:i,close:s,abort:o,getStreams:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=n,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.limits=e.limits,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=i,this._close=s,this._abort=o,this._getStreams=a,this.tags=[]}get streams(){return this._getStreams()}async newStream(e,t){if(this.status==="closing")throw new BB("the connection is being closed");if(this.status==="closed")throw new xE("the connection is closed");if(Array.isArray(e)||(e=[e]),this.limits!=null&&(t==null?void 0:t.runOnLimitedConnection)!==!0)throw new CE("Cannot open protocol stream on limited connection");const n=await this._newStream(e,t);return n.direction="outbound",n}async close(e={}){if(!(this.status==="closed"||this.status==="closing")){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",e.signal==null){const t=AbortSignal.timeout(ZEe);e={...e,signal:t}}try{this.log.trace("closing underlying transport"),await this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(t){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,t),this.abort(t)}}}abort(e){this.status!=="closed"&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this._abort(e),this.status="closed",this.timeline.close=Date.now())}}function txe(r){return new exe(r)}function rxe(r,e){try{const{options:t}=e.getHandler(r);return t.maxInboundStreams}catch(t){if(t.name!=="UnhandledProtocolError")throw t}return Cj}function nxe(r,e,t={}){try{const{options:n}=e.getHandler(r);if(n.maxOutboundStreams!=null)return n.maxOutboundStreams}catch(n){if(n.name!=="UnhandledProtocolError")throw n}return t.maxOutboundStreams??kj}function qP(r,e,t){let n=0;return t.streams.forEach(i=>{i.direction===e&&i.protocol===r&&n++}),n}var fN;fN=Symbol.toStringTag;class ixe{constructor(e,t){u(this,"components");u(this,"connectionEncrypters");u(this,"streamMuxers");u(this,"inboundUpgradeTimeout");u(this,"inboundStreamProtocolNegotiationTimeout");u(this,"outboundStreamProtocolNegotiationTimeout");u(this,"events");u(this,"metrics");u(this,fN,"@libp2p/upgrader");var n,i;this.components=e,this.connectionEncrypters=new Map,t.connectionEncrypters.forEach(s=>{this.connectionEncrypters.set(s.protocol,s)}),this.streamMuxers=new Map,t.streamMuxers.forEach(s=>{this.streamMuxers.set(s.protocol,s)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??lEe,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??zP,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??zP,this.events=e.events,this.metrics={dials:(n=e.metrics)==null?void 0:n.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:(i=e.metrics)==null?void 0:i.registerCounterGroup("libp2p_connection_manager_dial_errors_total")}}async shouldBlockConnection(e,...t){const n=this.components.connectionGater[e];if(n==null)return;if(await n.apply(this.components.connectionGater,t)===!0)throw new Wve(`The multiaddr connection is blocked by gater.${e}`)}createInboundAbortSignal(e){return ct([AbortSignal.timeout(this.inboundUpgradeTimeout),e])}async upgradeInbound(e,t){var s,o;let n=!1;const i=this.createInboundAbortSignal(t.signal);try{if((s=this.metrics.dials)==null||s.increment({inbound:!0}),n=await this.components.connectionManager.acceptIncomingConnection(e),!n)throw new Gve("Connection denied");await this.shouldBlockConnection("denyInboundConnection",e),await this._performUpgrade(e,"inbound",{...t,signal:i})}catch(a){throw(o=this.metrics.errors)==null||o.increment({inbound:!0}),a}finally{i.clear(),n&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){var n,i;try{(n=this.metrics.dials)==null||n.increment({outbound:!0});const s=e.remoteAddr.getPeerId();let o;s!=null&&(o=xn(s),await this.shouldBlockConnection("denyOutboundConnection",o,e));let a="outbound";return t.initiator===!1&&(a="inbound"),await this._performUpgrade(e,a,t)}catch(s){throw(i=this.metrics.errors)==null||i.increment({outbound:!0}),s}}async _performUpgrade(e,t,n){var d,h,p;let i,s,o,a,c;(d=this.components.metrics)==null||d.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t);let l=e;if((n==null?void 0:n.skipProtection)!==!0){const b=this.components.connectionProtector;b!=null&&(e.log("protecting the %s connection",t),l=await b.protect(e,n))}try{if(i=l,(n==null?void 0:n.skipEncryption)!==!0){(h=n==null?void 0:n.onProgress)==null||h.call(n,new ke(`upgrader:encrypt-${t}-connection`)),{conn:i,remotePeer:s,protocol:c,streamMuxer:a}=await(t==="inbound"?this._encryptInbound(l,n):this._encryptOutbound(l,n));const b={...l,...i};await this.shouldBlockConnection(t==="inbound"?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",s,b)}else{const b=e.remoteAddr.getPeerId();if(b==null)throw new km(`${t} connection that skipped encryption must have a peer id`);const f=xn(b);c="native",s=f}if(s.equals(this.components.peerId)){const b=new AE("Can not dial self");throw e.abort(b),b}if(o=i,(n==null?void 0:n.muxerFactory)!=null)a=n.muxerFactory;else if(a==null&&this.streamMuxers.size>0){(p=n==null?void 0:n.onProgress)==null||p.call(n,new ke(`upgrader:multiplex-${t}-connection`));const b=await(t==="inbound"?this._multiplexInbound({...l,...i},this.streamMuxers,n):this._multiplexOutbound({...l,...i},this.streamMuxers,n));a=b.muxerFactory,o=b.stream}}catch(b){throw e.log.error("failed to upgrade inbound connection %s %a - %e",t==="inbound"?"from":"to",e.remoteAddr,b),b}return await this.shouldBlockConnection(t==="inbound"?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",s,e),e.log("successfully upgraded %s connection",t),this._createConnection({cryptoProtocol:c,direction:t,maConn:e,upgradedConn:o,muxerFactory:a,remotePeer:s,limits:n==null?void 0:n.limits})}_createConnection(e){const{cryptoProtocol:t,direction:n,maConn:i,upgradedConn:s,remotePeer:o,muxerFactory:a,limits:c}=e;let l,d,h;a!=null&&(l=a.createStreamMuxer({direction:n,onIncomingStream:f=>{h!=null&&Promise.resolve().then(async()=>{var C;const g=this.components.registrar.getProtocols(),v=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout),{stream:y,protocol:w}=await E5(f,g,{signal:v,log:f.log,yieldBytes:!1});if(h==null)return;h.log("incoming stream opened on %s",w);const m=rxe(w,this.components.registrar);if(qP(w,"inbound",h)===m){const k=new FB(`Too many inbound protocol streams for protocol "${w}" - limit ${m}`);throw f.abort(k),k}f.source=y.source,f.sink=y.sink,f.protocol=w,y.closeWrite!=null&&(f.closeWrite=y.closeWrite),y.closeRead!=null&&(f.closeRead=y.closeRead),y.close!=null&&(f.close=y.close),await this.components.peerStore.merge(o,{protocols:[w]}),(C=this.components.metrics)==null||C.trackProtocolStream(f,h),this._onStream({connection:h,stream:f,protocol:w})}).catch(async g=>{h.log.error("error handling incoming stream id %s - %e",f.id,g),f.timeline.close==null&&await f.close()})}}),d=async(f,g={})=>{var y;if(l==null)throw new t2("Connection is not multiplexed");h.log.trace("starting new stream for protocols %s",f);const v=await l.newStream();h.log.trace("started new stream %s for protocols %s",v.id,f);try{if(g.signal==null){v.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",f);const k=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);g={...g,signal:k}}v.log.trace("selecting protocol from protocols %s",f);const{stream:w,protocol:m}=await v5(v,f,{...g,log:v.log,yieldBytes:!0});v.log.trace("selected protocol %s",m);const E=nxe(m,this.components.registrar,g),C=qP(m,"outbound",h);if(C>=E){const k=new _m(`Too many outbound protocol streams for protocol "${m}" - ${C}/${E}`);throw v.abort(k),k}return await this.components.peerStore.merge(o,{protocols:[m]}),v.source=w.source,v.sink=w.sink,v.protocol=m,w.closeWrite!=null&&(v.closeWrite=w.closeWrite),w.closeRead!=null&&(v.closeRead=w.closeRead),w.close!=null&&(v.close=w.close),(y=this.components.metrics)==null||y.trackProtocolStream(v,h),v}catch(w){throw h.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e",n==="inbound"?"from":"to",e.maConn.remoteAddr,f,w),v.timeline.close==null&&v.abort(w),w}},Promise.all([l.sink(s.source),s.sink(l.source)]).catch(f=>{h.log.error("error piping data through muxer - %e",f)}));const p=i.timeline;i.timeline=new Proxy(p,{set:(...f)=>(f[1]==="close"&&f[2]!=null&&p.close==null&&(async()=>{try{h.status==="open"&&await h.close()}catch(g){h.log.error("error closing connection after timeline close %e",g)}finally{this.events.safeDispatchEvent("connection:close",{detail:h})}})().catch(g=>{h.log.error("error thrown while dispatching connection:close event %e",g)}),Reflect.set(...f))}),i.timeline.upgraded=Date.now();const b=()=>{throw new t2("Connection is not multiplexed")};return h=txe({remoteAddr:i.remoteAddr,remotePeer:o,status:"open",direction:n,timeline:i.timeline,multiplexer:l==null?void 0:l.protocol,encryption:t,limits:c,logger:this.components.logger,newStream:d??b,getStreams:()=>(l==null?void 0:l.streams)??[],close:async f=>{await(l==null?void 0:l.close(f)),await i.close(f)},abort:f=>{i.abort(f),l==null||l.abort(f)}}),this.events.safeDispatchEvent("connection:open",{detail:h}),h.__maConnTimeline=p,h}_onStream(e){const{connection:t,stream:n,protocol:i}=e,{handler:s,options:o}=this.components.registrar.getHandler(i);if(t.limits!=null&&o.runOnLimitedConnection!==!0)throw new CE("Cannot open protocol stream on limited connection");s({connection:t,stream:n})}async _encryptInbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{const{stream:i,protocol:s}=await E5(e,n,{...t,log:e.log}),o=this.connectionEncrypters.get(s);if(o==null)throw new r2(`no crypto module found for ${s}`);return e.log("encrypting inbound connection to %a using %s",e.remoteAddr,s),{...await o.secureInbound(i,t),protocol:s}}catch(i){throw e.log.error("encrypting inbound connection from %a failed",e.remoteAddr,i),new r2(i.message)}}async _encryptOutbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",n);const{stream:i,protocol:s}=await v5(e,n,{...t,log:e.log,yieldBytes:!0}),o=this.connectionEncrypters.get(s);if(o==null)throw new r2(`no crypto module found for ${s}`);return e.log("encrypting outbound connection to %a using %s",e.remoteAddr,s),{...await o.secureOutbound(i,t),protocol:s}}catch(i){throw e.log.error("encrypting outbound connection to %a failed",e.remoteAddr,i),new r2(i.message)}}async _multiplexOutbound(e,t,n){const i=Array.from(t.keys());e.log("outbound selecting muxer %s",i);try{e.log.trace("selecting stream muxer from %s",i);const{stream:s,protocol:o}=await v5(e,i,{...n,log:e.log,yieldBytes:!0});e.log("selected %s as muxer protocol",o);const a=t.get(o);return{stream:s,muxerFactory:a}}catch(s){throw e.log.error("error multiplexing outbound connection",s),new t2(String(s))}}async _multiplexInbound(e,t,n){const i=Array.from(t.keys());e.log("inbound handling muxers %s",i);try{const{stream:s,protocol:o}=await E5(e,i,{...n,log:e.log}),a=t.get(o);return{stream:s,muxerFactory:a}}catch(s){throw e.log.error("error multiplexing inbound connection",s),new t2(String(s))}}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}}var n0,Q9;class sxe extends Gt{constructor(t){var d,h,p,b,f,g,v,y,w,m,E,C;super();qe(this,n0);u(this,"peerId");u(this,"peerStore");u(this,"contentRouting");u(this,"peerRouting");u(this,"metrics");u(this,"services");u(this,"logger");u(this,"status");u(this,"components");u(this,"log");this.status="stopped";const n=new Gt,i=n.dispatchEvent.bind(n);n.dispatchEvent=k=>{const A=i(k),I=this.dispatchEvent(new CustomEvent(k.type,{detail:k.detail}));return A||I},this.peerId=t.peerId,this.logger=t.logger??Hm(),this.log=this.logger.forComponent("libp2p"),this.services={};const s=((d=t.nodeInfo)==null?void 0:d.name)??sj,o=((h=t.nodeInfo)==null?void 0:h.version)??ij,a=this.components=Zve({peerId:t.peerId,privateKey:t.privateKey,nodeInfo:{name:s,version:o,userAgent:((p=t.nodeInfo)==null?void 0:p.userAgent)??oj(s,o)},logger:this.logger,events:n,datastore:t.datastore??new KF,connectionGater:oEe(t.connectionGater),dns:t.dns});this.peerStore=this.configureComponent("peerStore",fve(a,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...t.peerStore})),t.metrics!=null&&(this.metrics=this.configureComponent("metrics",t.metrics(this.components))),a.events.addEventListener("peer:update",k=>{if(k.detail.previous==null){const A={id:k.detail.peer.id,multiaddrs:k.detail.peer.addresses.map(I=>I.multiaddr)};a.events.safeDispatchEvent("peer:discovery",{detail:A})}}),t.connectionProtector!=null&&this.configureComponent("connectionProtector",t.connectionProtector(a)),this.components.upgrader=new ixe(this.components,{connectionEncrypters:(t.connectionEncrypters??[]).map((k,A)=>this.configureComponent(`connection-encryption-${A}`,k(this.components))),streamMuxers:(t.streamMuxers??[]).map((k,A)=>this.configureComponent(`stream-muxers-${A}`,k(this.components))),inboundUpgradeTimeout:(b=t.connectionManager)==null?void 0:b.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:((f=t.connectionManager)==null?void 0:f.inboundStreamProtocolNegotiationTimeout)??((g=t.connectionManager)==null?void 0:g.protocolNegotiationTimeout),outboundStreamProtocolNegotiationTimeout:((v=t.connectionManager)==null?void 0:v.outboundStreamProtocolNegotiationTimeout)??((y=t.connectionManager)==null?void 0:y.protocolNegotiationTimeout)}),this.configureComponent("transportManager",new GEe(this.components,t.transportManager)),this.configureComponent("connectionManager",new LEe(this.components,t.connectionManager)),((w=t.connectionMonitor)==null?void 0:w.enabled)!==!1&&this.configureComponent("connectionMonitor",new KEe(this.components,t.connectionMonitor)),this.configureComponent("registrar",new WEe(this.components)),this.configureComponent("addressManager",new Mve(this.components,t.addresses));const c=(t.peerRouters??[]).map((k,A)=>this.configureComponent(`peer-router-${A}`,k(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new HEe(this.components,{routers:c}));const l=(t.contentRouters??[]).map((k,A)=>this.configureComponent(`content-router-${A}`,k(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new jEe(this.components,{routers:l})),this.configureComponent("randomWalk",new qEe(this.components)),(t.peerDiscovery??[]).forEach((k,A)=>{this.configureComponent(`peer-discovery-${A}`,k(this.components)).addEventListener("peer",D=>{Ae(this,n0,Q9).call(this,D)})}),(m=t.transports)==null||m.forEach((k,A)=>{this.components.transportManager.add(this.configureComponent(`transport-${A}`,k(this.components)))}),t.services!=null)for(const k of Object.keys(t.services)){const A=t.services[k],I=A(this.components);if(I==null){this.log.error("service factory %s returned null or undefined instance",k);continue}this.services[k]=I,this.configureComponent(k,I),I[Sd]!=null&&(this.log("registering service %s for content routing",k),l.push(I[Sd])),I[Ad]!=null&&(this.log("registering service %s for peer routing",k),c.push(I[Ad])),I[Dg]!=null&&(this.log("registering service %s for peer discovery",k),(C=(E=I[Dg]).addEventListener)==null||C.call(E,"peer",D=>{Ae(this,n0,Q9).call(this,D)}))}eEe(a)}configureComponent(t,n){return n==null&&this.log.error("component %s was null or undefined",t),this.components[t]=n,n}async start(){var t,n,i,s;if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{await((n=(t=this.components).beforeStart)==null?void 0:n.call(t)),await this.components.start(),await((s=(i=this.components).afterStart)==null?void 0:s.call(i)),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(o){throw this.log.error("An error occurred starting libp2p",o),this.status="started",await this.stop(),o}}}async stop(){var t,n,i,s;this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",await((n=(t=this.components).beforeStop)==null?void 0:n.call(t)),await this.components.stop(),await((s=(i=this.components).afterStop)==null?void 0:s.call(i)),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(t){return this.components.connectionManager.getConnections(t)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const t=new Hi;for(const n of this.components.connectionManager.getConnections())t.add(n.remotePeer);return Array.from(t)}async dial(t,n={}){return this.components.connectionManager.openConnection(t,{priority:75,...n})}async dialProtocol(t,n,i={}){if(n==null)throw new Z("no protocols were provided to open a stream");if(n=Array.isArray(n)?n:[n],n.length===0)throw new Z("no protocols were provided to open a stream");return(await this.dial(t,i)).newStream(n,i)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(t,n={}){r4(t)&&(t=xn(t.getPeerId()??"")),await this.components.connectionManager.closeConnections(t,n)}async getPublicKey(t,n={}){if(this.log("getPublicKey %p",t),t.publicKey!=null)return t.publicKey;try{const a=await this.peerStore.get(t);if(a.id.publicKey!=null)return a.id.publicKey}catch(a){if(a.name!=="NotFoundError")throw a}const i=pr([se("/pk/"),t.toMultihash().bytes]),s=await this.contentRouting.get(i,n),o=Ji(s);return await this.peerStore.patch(t,{publicKey:o}),o}async handle(t,n,i){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async s=>{await this.components.registrar.handle(s,n,i)}))}async unhandle(t){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async n=>{await this.components.registrar.unhandle(n)}))}async register(t,n){return this.components.registrar.register(t,n)}unregister(t){this.components.registrar.unregister(t)}async isDialable(t,n={}){return this.components.connectionManager.isDialable(t,n)}}n0=new WeakSet,Q9=function(t){const{detail:n}=t;if(n.id.toString()===this.peerId.toString()){this.log.error("peer discovery mechanism discovered self");return}this.components.peerStore.merge(n.id,{multiaddrs:n.multiaddrs}).catch(i=>{this.log.error(i)})};async function oxe(r={}){r.privateKey??(r.privateKey=await Mm("Ed25519"));const e=new sxe({...await b9e(r),peerId:Rie(r.privateKey)});return r.start!==!1&&await e.start(),e}async function axe(r){const e=r.libp2p??{};e.privateKey==null&&r.datastore!=null&&(e.privateKey=await p9e(r.datastore,r.keychain));const t=f9e(e);return t.datastore=t.datastore??r.datastore,await oxe({...t,...e,start:!1})}async function cxe(r={}){const e=r.datastore??new KF,t=r.blockstore??new Bpe;let n;lxe(r.libp2p)?n=r.libp2p:n=await axe({...r,libp2p:{dns:r.dns,...r.libp2p,start:void 0},datastore:e});const i=new zpe({...r,libp2p:n,datastore:e,blockstore:t,blockBrokers:r.blockBrokers??[gfe(),kue()],routers:r.routers??[epe(n),X0e()],metrics:n.metrics});return r.start!==!1&&await i.start(),i}function lxe(r){return r==null?!1:["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"].every(t=>typeof r[t]=="function")}const uxe=()=>{const[r,e]=ba.useState(""),[t,n]=ba.useState([]),[i,s]=ba.useState(null),[o,a]=ba.useState(null);ba.useEffect(()=>{async function l(){try{console.log("Starting OrbitDB initialization for GitHub Pages");let d;try{d=await cxe({libp2p:{addresses:{listen:["/webrtc"]},peerDiscovery:[bz({list:["/dns4/bootstrap.libp2p.io/tcp/443/wss/p2p/12D3KooWQL1aS4qD3yCjmV7gNmx4F5gP7pNXG1qimV5DXe7tXUn","/dns4/bootstrap.libp2p.io/tcp/443/wss/p2p/12D3KooWAtfLqN4QmgjrZ9eZ9r4L1B7bH7d9eW8fA4n4bBAyKSm"]})]}})}catch(f){throw console.error("Failed to initialize Helia:",f),new Error("IPFS initialization failed")}if(console.log("Helia initialized:",d),!d)throw new Error("IPFS instance is undefined");const h=await vne(d);console.log("OrbitDB instance created:",h);const p=await h.open("citizenx-annotations",{type:"documents"});console.log("Database opened:",p),await p.load(),console.log("Database loaded"),s(p);const b=await p.all();n(b.map(f=>f.value)),p.events.on("update",async()=>{const f=await p.all();n(f.map(g=>g.value)),console.log("GitHub Pages database updated:",f)})}catch(d){console.error("OrbitDB initialization failed:",d),a("Failed to initialize decentralized storage")}}l()},[]);const c=async()=>{if(r.trim()&&i)try{const l={_id:Date.now().toString(),url:"sidepanel",text:r.trim(),timestamp:Date.now()};await i.put(l),e(""),console.log("Saved annotation to OrbitDB:",l)}catch(l){console.error("Failed to save annotation:",l),a("Failed to save annotation")}};return _n.jsxs("div",{style:{padding:"16px",maxWidth:"300px"},children:[_n.jsx("h1",{style:{fontSize:"1.5rem",fontWeight:"bold",margin:"0 0 8px 0"},children:"CitizenX Annotations 1"}),o&&_n.jsx("p",{style:{color:"red",margin:"0 0 8px 0"},children:o}),_n.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[_n.jsx("input",{type:"text",value:r,onChange:l=>e(l.target.value),placeholder:"Enter annotation...",style:{flex:1,padding:"5px",border:"1px solid #ccc",borderRadius:"3px"}}),_n.jsx("button",{onClick:c,disabled:!i,style:{padding:"5px 10px",background:i?"#007bff":"#ccc",color:"#fff",border:"none",borderRadius:"3px",cursor:i?"pointer":"not-allowed"},children:"Save"})]}),_n.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:t.length===0?_n.jsx("p",{style:{margin:0,color:"#666"},children:"No annotations yet."}):_n.jsx("ul",{style:{margin:0,padding:0,listStyle:"none"},children:t.map(l=>_n.jsxs("li",{style:{padding:"5px 0",borderBottom:"1px solid #eee",wordBreak:"break-word"},children:[l.text," ",_n.jsxs("small",{children:["(",new Date(l.timestamp).toLocaleString(),")"]})]},l._id))})})]})};C5.createRoot(document.getElementById("root")).render(_n.jsx(Wj.StrictMode,{children:_n.jsx(uxe,{})}));
