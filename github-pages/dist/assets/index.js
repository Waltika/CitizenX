var Yj=Object.defineProperty;var MA=r=>{throw TypeError(r)};var Xj=(r,e,t)=>e in r?Yj(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var u=(r,e,t)=>Xj(r,typeof e!="symbol"?e+"":e,t),V4=(r,e,t)=>e.has(r)||MA("Cannot "+t);var ie=(r,e,t)=>(V4(r,e,"read from private field"),t?t.call(r):e.get(r)),qe=(r,e,t)=>e.has(r)?MA("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),gt=(r,e,t,n)=>(V4(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),Ae=(r,e,t)=>(V4(r,e,"access private method"),t);var gs=(r,e,t,n)=>({set _(i){gt(r,e,i,t)},get _(){return ie(r,e,n)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var v1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vo(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var bM={exports:{}},y3={},vM={exports:{}},He={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cp=Symbol.for("react.element"),Jj=Symbol.for("react.portal"),Zj=Symbol.for("react.fragment"),eq=Symbol.for("react.strict_mode"),tq=Symbol.for("react.profiler"),rq=Symbol.for("react.provider"),nq=Symbol.for("react.context"),iq=Symbol.for("react.forward_ref"),sq=Symbol.for("react.suspense"),oq=Symbol.for("react.memo"),aq=Symbol.for("react.lazy"),OA=Symbol.iterator;function cq(r){return r===null||typeof r!="object"?null:(r=OA&&r[OA]||r["@@iterator"],typeof r=="function"?r:null)}var EM={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},SM=Object.assign,xM={};function xd(r,e,t){this.props=r,this.context=e,this.refs=xM,this.updater=t||EM}xd.prototype.isReactComponent={};xd.prototype.setState=function(r,e){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,e,"setState")};xd.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function AM(){}AM.prototype=xd.prototype;function T9(r,e,t){this.props=r,this.context=e,this.refs=xM,this.updater=t||EM}var P9=T9.prototype=new AM;P9.constructor=T9;SM(P9,xd.prototype);P9.isPureReactComponent=!0;var RA=Array.isArray,CM=Object.prototype.hasOwnProperty,D9={current:null},IM={key:!0,ref:!0,__self:!0,__source:!0};function kM(r,e,t){var n,i={},s=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)CM.call(e,n)&&!IM.hasOwnProperty(n)&&(i[n]=e[n]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(r&&r.defaultProps)for(n in a=r.defaultProps,a)i[n]===void 0&&(i[n]=a[n]);return{$$typeof:Cp,type:r,key:s,ref:o,props:i,_owner:D9.current}}function lq(r,e){return{$$typeof:Cp,type:r.type,key:e,ref:r.ref,props:r.props,_owner:r._owner}}function $9(r){return typeof r=="object"&&r!==null&&r.$$typeof===Cp}function uq(r){var e={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(t){return e[t]})}var LA=/\/+/g;function K4(r,e){return typeof r=="object"&&r!==null&&r.key!=null?uq(""+r.key):e.toString(36)}function Cg(r,e,t,n,i){var s=typeof r;(s==="undefined"||s==="boolean")&&(r=null);var o=!1;if(r===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(r.$$typeof){case Cp:case Jj:o=!0}}if(o)return o=r,i=i(o),r=n===""?"."+K4(o,0):n,RA(i)?(t="",r!=null&&(t=r.replace(LA,"$&/")+"/"),Cg(i,e,t,"",function(l){return l})):i!=null&&($9(i)&&(i=lq(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(LA,"$&/")+"/")+r)),e.push(i)),1;if(o=0,n=n===""?".":n+":",RA(r))for(var a=0;a<r.length;a++){s=r[a];var c=n+K4(s,a);o+=Cg(s,e,t,c,i)}else if(c=cq(r),typeof c=="function")for(r=c.call(r),a=0;!(s=r.next()).done;)s=s.value,c=n+K4(s,a++),o+=Cg(s,e,t,c,i);else if(s==="object")throw e=String(r),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function g0(r,e,t){if(r==null)return r;var n=[],i=0;return Cg(r,n,"","",function(s){return e.call(t,s,i++)}),n}function hq(r){if(r._status===-1){var e=r._result;e=e(),e.then(function(t){(r._status===0||r._status===-1)&&(r._status=1,r._result=t)},function(t){(r._status===0||r._status===-1)&&(r._status=2,r._result=t)}),r._status===-1&&(r._status=0,r._result=e)}if(r._status===1)return r._result.default;throw r._result}var un={current:null},Ig={transition:null},dq={ReactCurrentDispatcher:un,ReactCurrentBatchConfig:Ig,ReactCurrentOwner:D9};function _M(){throw Error("act(...) is not supported in production builds of React.")}He.Children={map:g0,forEach:function(r,e,t){g0(r,function(){e.apply(this,arguments)},t)},count:function(r){var e=0;return g0(r,function(){e++}),e},toArray:function(r){return g0(r,function(e){return e})||[]},only:function(r){if(!$9(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};He.Component=xd;He.Fragment=Zj;He.Profiler=tq;He.PureComponent=T9;He.StrictMode=eq;He.Suspense=sq;He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dq;He.act=_M;He.cloneElement=function(r,e,t){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var n=SM({},r.props),i=r.key,s=r.ref,o=r._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=D9.current),e.key!==void 0&&(i=""+e.key),r.type&&r.type.defaultProps)var a=r.type.defaultProps;for(c in e)CM.call(e,c)&&!IM.hasOwnProperty(c)&&(n[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)n.children=t;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];n.children=a}return{$$typeof:Cp,type:r.type,key:i,ref:s,props:n,_owner:o}};He.createContext=function(r){return r={$$typeof:nq,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:rq,_context:r},r.Consumer=r};He.createElement=kM;He.createFactory=function(r){var e=kM.bind(null,r);return e.type=r,e};He.createRef=function(){return{current:null}};He.forwardRef=function(r){return{$$typeof:iq,render:r}};He.isValidElement=$9;He.lazy=function(r){return{$$typeof:aq,_payload:{_status:-1,_result:r},_init:hq}};He.memo=function(r,e){return{$$typeof:oq,type:r,compare:e===void 0?null:e}};He.startTransition=function(r){var e=Ig.transition;Ig.transition={};try{r()}finally{Ig.transition=e}};He.unstable_act=_M;He.useCallback=function(r,e){return un.current.useCallback(r,e)};He.useContext=function(r){return un.current.useContext(r)};He.useDebugValue=function(){};He.useDeferredValue=function(r){return un.current.useDeferredValue(r)};He.useEffect=function(r,e){return un.current.useEffect(r,e)};He.useId=function(){return un.current.useId()};He.useImperativeHandle=function(r,e,t){return un.current.useImperativeHandle(r,e,t)};He.useInsertionEffect=function(r,e){return un.current.useInsertionEffect(r,e)};He.useLayoutEffect=function(r,e){return un.current.useLayoutEffect(r,e)};He.useMemo=function(r,e){return un.current.useMemo(r,e)};He.useReducer=function(r,e,t){return un.current.useReducer(r,e,t)};He.useRef=function(r){return un.current.useRef(r)};He.useState=function(r){return un.current.useState(r)};He.useSyncExternalStore=function(r,e,t){return un.current.useSyncExternalStore(r,e,t)};He.useTransition=function(){return un.current.useTransition()};He.version="18.3.1";vM.exports=He;var Ma=vM.exports;const fq=Vo(Ma);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pq=Ma,gq=Symbol.for("react.element"),yq=Symbol.for("react.fragment"),mq=Object.prototype.hasOwnProperty,wq=pq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,bq={key:!0,ref:!0,__self:!0,__source:!0};function TM(r,e,t){var n,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)mq.call(e,n)&&!bq.hasOwnProperty(n)&&(i[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)i[n]===void 0&&(i[n]=e[n]);return{$$typeof:gq,type:r,key:s,ref:o,props:i,_owner:wq.current}}y3.Fragment=yq;y3.jsx=TM;y3.jsxs=TM;bM.exports=y3;var Bn=bM.exports,t6={},PM={exports:{}},Zn={},DM={exports:{}},$M={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function e(O,B){var W=O.length;O.push(B);e:for(;0<W;){var Y=W-1>>>1,j=O[Y];if(0<i(j,B))O[Y]=B,O[W]=j,W=Y;else break e}}function t(O){return O.length===0?null:O[0]}function n(O){if(O.length===0)return null;var B=O[0],W=O.pop();if(W!==B){O[0]=W;e:for(var Y=0,j=O.length,ce=j>>>1;Y<ce;){var me=2*(Y+1)-1,he=O[me],ue=me+1,Ne=O[ue];if(0>i(he,W))ue<j&&0>i(Ne,he)?(O[Y]=Ne,O[ue]=W,Y=ue):(O[Y]=he,O[me]=W,Y=me);else if(ue<j&&0>i(Ne,W))O[Y]=Ne,O[ue]=W,Y=ue;else break e}}return B}function i(O,B){var W=O.sortIndex-B.sortIndex;return W!==0?W:O.id-B.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();r.unstable_now=function(){return o.now()-a}}var c=[],l=[],h=1,d=null,p=3,m=!1,f=!1,g=!1,v=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(O){for(var B=t(l);B!==null;){if(B.callback===null)n(l);else if(B.startTime<=O)n(l),B.sortIndex=B.expirationTime,e(c,B);else break;B=t(l)}}function E(O){if(g=!1,b(O),!f)if(t(c)!==null)f=!0,Q(C);else{var B=t(l);B!==null&&H(E,B.startTime-O)}}function C(O,B){f=!1,g&&(g=!1,y(I),I=-1),m=!0;var W=p;try{for(b(B),d=t(c);d!==null&&(!(d.expirationTime>B)||O&&!V());){var Y=d.callback;if(typeof Y=="function"){d.callback=null,p=d.priorityLevel;var j=Y(d.expirationTime<=B);B=r.unstable_now(),typeof j=="function"?d.callback=j:d===t(c)&&n(c),b(B)}else n(c);d=t(c)}if(d!==null)var ce=!0;else{var me=t(l);me!==null&&H(E,me.startTime-B),ce=!1}return ce}finally{d=null,p=W,m=!1}}var k=!1,x=null,I=-1,T=5,L=-1;function V(){return!(r.unstable_now()-L<T)}function U(){if(x!==null){var O=r.unstable_now();L=O;var B=!0;try{B=x(!0,O)}finally{B?G():(k=!1,x=null)}}else k=!1}var G;if(typeof w=="function")G=function(){w(U)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,q=K.port2;K.port1.onmessage=U,G=function(){q.postMessage(null)}}else G=function(){v(U,0)};function Q(O){x=O,k||(k=!0,G())}function H(O,B){I=v(function(){O(r.unstable_now())},B)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(O){O.callback=null},r.unstable_continueExecution=function(){f||m||(f=!0,Q(C))},r.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<O?Math.floor(1e3/O):5},r.unstable_getCurrentPriorityLevel=function(){return p},r.unstable_getFirstCallbackNode=function(){return t(c)},r.unstable_next=function(O){switch(p){case 1:case 2:case 3:var B=3;break;default:B=p}var W=p;p=B;try{return O()}finally{p=W}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(O,B){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var W=p;p=O;try{return B()}finally{p=W}},r.unstable_scheduleCallback=function(O,B,W){var Y=r.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?Y+W:Y):W=Y,O){case 1:var j=-1;break;case 2:j=250;break;case 5:j=1073741823;break;case 4:j=1e4;break;default:j=5e3}return j=W+j,O={id:h++,callback:B,priorityLevel:O,startTime:W,expirationTime:j,sortIndex:-1},W>Y?(O.sortIndex=W,e(l,O),t(c)===null&&O===t(l)&&(g?(y(I),I=-1):g=!0,H(E,W-Y))):(O.sortIndex=j,e(c,O),f||m||(f=!0,Q(C))),O},r.unstable_shouldYield=V,r.unstable_wrapCallback=function(O){var B=p;return function(){var W=p;p=B;try{return O.apply(this,arguments)}finally{p=W}}}})($M);DM.exports=$M;var vq=DM.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Eq=Ma,Yn=vq;function ee(r){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+r,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+r+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var NM=new Set,E1={};function lu(r,e){Nh(r,e),Nh(r+"Capture",e)}function Nh(r,e){for(E1[r]=e,r=0;r<e.length;r++)NM.add(e[r])}var To=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),r6=Object.prototype.hasOwnProperty,Sq=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,BA={},UA={};function xq(r){return r6.call(UA,r)?!0:r6.call(BA,r)?!1:Sq.test(r)?UA[r]=!0:(BA[r]=!0,!1)}function Aq(r,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function Cq(r,e,t,n){if(e===null||typeof e>"u"||Aq(r,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function hn(r,e,t,n,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=r,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var vr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){vr[r]=new hn(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var e=r[0];vr[e]=new hn(e,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){vr[r]=new hn(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){vr[r]=new hn(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){vr[r]=new hn(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){vr[r]=new hn(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){vr[r]=new hn(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){vr[r]=new hn(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){vr[r]=new hn(r,5,!1,r.toLowerCase(),null,!1,!1)});var N9=/[\-:]([a-z])/g;function M9(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var e=r.replace(N9,M9);vr[e]=new hn(e,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var e=r.replace(N9,M9);vr[e]=new hn(e,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var e=r.replace(N9,M9);vr[e]=new hn(e,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){vr[r]=new hn(r,1,!1,r.toLowerCase(),null,!1,!1)});vr.xlinkHref=new hn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){vr[r]=new hn(r,1,!1,r.toLowerCase(),null,!0,!0)});function O9(r,e,t,n){var i=vr.hasOwnProperty(e)?vr[e]:null;(i!==null?i.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Cq(e,t,i,n)&&(t=null),n||i===null?xq(e)&&(t===null?r.removeAttribute(e):r.setAttribute(e,""+t)):i.mustUseProperty?r[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,n=i.attributeNamespace,t===null?r.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,n?r.setAttributeNS(n,e,t):r.setAttribute(e,t))))}var Ko=Eq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,y0=Symbol.for("react.element"),Ku=Symbol.for("react.portal"),Hu=Symbol.for("react.fragment"),R9=Symbol.for("react.strict_mode"),n6=Symbol.for("react.profiler"),MM=Symbol.for("react.provider"),OM=Symbol.for("react.context"),L9=Symbol.for("react.forward_ref"),i6=Symbol.for("react.suspense"),s6=Symbol.for("react.suspense_list"),B9=Symbol.for("react.memo"),Ea=Symbol.for("react.lazy"),RM=Symbol.for("react.offscreen"),FA=Symbol.iterator;function Xd(r){return r===null||typeof r!="object"?null:(r=FA&&r[FA]||r["@@iterator"],typeof r=="function"?r:null)}var Lt=Object.assign,H4;function Rf(r){if(H4===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);H4=e&&e[1]||""}return`
`+H4+r}var j4=!1;function q4(r,e){if(!r||j4)return"";j4=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var n=l}Reflect.construct(r,[],e)}else{try{e.call()}catch(l){n=l}r.call(e.prototype)}else{try{throw Error()}catch(l){n=l}r()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),s=n.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var c=`
`+i[o].replace(" at new "," at ");return r.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",r.displayName)),c}while(1<=o&&0<=a);break}}}finally{j4=!1,Error.prepareStackTrace=t}return(r=r?r.displayName||r.name:"")?Rf(r):""}function Iq(r){switch(r.tag){case 5:return Rf(r.type);case 16:return Rf("Lazy");case 13:return Rf("Suspense");case 19:return Rf("SuspenseList");case 0:case 2:case 15:return r=q4(r.type,!1),r;case 11:return r=q4(r.type.render,!1),r;case 1:return r=q4(r.type,!0),r;default:return""}}function o6(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Hu:return"Fragment";case Ku:return"Portal";case n6:return"Profiler";case R9:return"StrictMode";case i6:return"Suspense";case s6:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case OM:return(r.displayName||"Context")+".Consumer";case MM:return(r._context.displayName||"Context")+".Provider";case L9:var e=r.render;return r=r.displayName,r||(r=e.displayName||e.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case B9:return e=r.displayName||null,e!==null?e:o6(r.type)||"Memo";case Ea:e=r._payload,r=r._init;try{return o6(r(e))}catch{}}return null}function kq(r){var e=r.type;switch(r.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=e.render,r=r.displayName||r.name||"",e.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return o6(e);case 8:return e===R9?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function dc(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function LM(r){var e=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function _q(r){var e=LM(r)?"checked":"value",t=Object.getOwnPropertyDescriptor(r.constructor.prototype,e),n=""+r[e];if(!r.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(r,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){n=""+o,s.call(this,o)}}),Object.defineProperty(r,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){r._valueTracker=null,delete r[e]}}}}function m0(r){r._valueTracker||(r._valueTracker=_q(r))}function BM(r){if(!r)return!1;var e=r._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return r&&(n=LM(r)?r.checked?"true":"false":r.value),r=n,r!==t?(e.setValue(r),!0):!1}function w2(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function a6(r,e){var t=e.checked;return Lt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??r._wrapperState.initialChecked})}function zA(r,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=dc(e.value!=null?e.value:t),r._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function UM(r,e){e=e.checked,e!=null&&O9(r,"checked",e,!1)}function c6(r,e){UM(r,e);var t=dc(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&r.value===""||r.value!=t)&&(r.value=""+t):r.value!==""+t&&(r.value=""+t);else if(n==="submit"||n==="reset"){r.removeAttribute("value");return}e.hasOwnProperty("value")?l6(r,e.type,t):e.hasOwnProperty("defaultValue")&&l6(r,e.type,dc(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(r.defaultChecked=!!e.defaultChecked)}function VA(r,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+r._wrapperState.initialValue,t||e===r.value||(r.value=e),r.defaultValue=e}t=r.name,t!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,t!==""&&(r.name=t)}function l6(r,e,t){(e!=="number"||w2(r.ownerDocument)!==r)&&(t==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+t&&(r.defaultValue=""+t))}var Lf=Array.isArray;function oh(r,e,t,n){if(r=r.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<r.length;t++)i=e.hasOwnProperty("$"+r[t].value),r[t].selected!==i&&(r[t].selected=i),i&&n&&(r[t].defaultSelected=!0)}else{for(t=""+dc(t),e=null,i=0;i<r.length;i++){if(r[i].value===t){r[i].selected=!0,n&&(r[i].defaultSelected=!0);return}e!==null||r[i].disabled||(e=r[i])}e!==null&&(e.selected=!0)}}function u6(r,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ee(91));return Lt({},e,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function KA(r,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(ee(92));if(Lf(t)){if(1<t.length)throw Error(ee(93));t=t[0]}e=t}e==null&&(e=""),t=e}r._wrapperState={initialValue:dc(t)}}function FM(r,e){var t=dc(e.value),n=dc(e.defaultValue);t!=null&&(t=""+t,t!==r.value&&(r.value=t),e.defaultValue==null&&r.defaultValue!==t&&(r.defaultValue=t)),n!=null&&(r.defaultValue=""+n)}function HA(r){var e=r.textContent;e===r._wrapperState.initialValue&&e!==""&&e!==null&&(r.value=e)}function zM(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function h6(r,e){return r==null||r==="http://www.w3.org/1999/xhtml"?zM(e):r==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var w0,VM=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return r(e,t,n,i)})}:r}(function(r,e){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=e;else{for(w0=w0||document.createElement("div"),w0.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=w0.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;e.firstChild;)r.appendChild(e.firstChild)}});function S1(r,e){if(e){var t=r.firstChild;if(t&&t===r.lastChild&&t.nodeType===3){t.nodeValue=e;return}}r.textContent=e}var Yf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Tq=["Webkit","ms","Moz","O"];Object.keys(Yf).forEach(function(r){Tq.forEach(function(e){e=e+r.charAt(0).toUpperCase()+r.substring(1),Yf[e]=Yf[r]})});function KM(r,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Yf.hasOwnProperty(r)&&Yf[r]?(""+e).trim():e+"px"}function HM(r,e){r=r.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,i=KM(t,e[t],n);t==="float"&&(t="cssFloat"),n?r.setProperty(t,i):r[t]=i}}var Pq=Lt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function d6(r,e){if(e){if(Pq[r]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ee(137,r));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ee(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ee(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ee(62))}}function f6(r,e){if(r.indexOf("-")===-1)return typeof e.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var p6=null;function U9(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var g6=null,ah=null,ch=null;function jA(r){if(r=_p(r)){if(typeof g6!="function")throw Error(ee(280));var e=r.stateNode;e&&(e=E3(e),g6(r.stateNode,r.type,e))}}function jM(r){ah?ch?ch.push(r):ch=[r]:ah=r}function qM(){if(ah){var r=ah,e=ch;if(ch=ah=null,jA(r),e)for(r=0;r<e.length;r++)jA(e[r])}}function WM(r,e){return r(e)}function GM(){}var W4=!1;function QM(r,e,t){if(W4)return r(e,t);W4=!0;try{return WM(r,e,t)}finally{W4=!1,(ah!==null||ch!==null)&&(GM(),qM())}}function x1(r,e){var t=r.stateNode;if(t===null)return null;var n=E3(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(r=r.type,n=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!n;break e;default:r=!1}if(r)return null;if(t&&typeof t!="function")throw Error(ee(231,e,typeof t));return t}var y6=!1;if(To)try{var Jd={};Object.defineProperty(Jd,"passive",{get:function(){y6=!0}}),window.addEventListener("test",Jd,Jd),window.removeEventListener("test",Jd,Jd)}catch{y6=!1}function Dq(r,e,t,n,i,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(h){this.onError(h)}}var Xf=!1,b2=null,v2=!1,m6=null,$q={onError:function(r){Xf=!0,b2=r}};function Nq(r,e,t,n,i,s,o,a,c){Xf=!1,b2=null,Dq.apply($q,arguments)}function Mq(r,e,t,n,i,s,o,a,c){if(Nq.apply(this,arguments),Xf){if(Xf){var l=b2;Xf=!1,b2=null}else throw Error(ee(198));v2||(v2=!0,m6=l)}}function uu(r){var e=r,t=r;if(r.alternate)for(;e.return;)e=e.return;else{r=e;do e=r,e.flags&4098&&(t=e.return),r=e.return;while(r)}return e.tag===3?t:null}function YM(r){if(r.tag===13){var e=r.memoizedState;if(e===null&&(r=r.alternate,r!==null&&(e=r.memoizedState)),e!==null)return e.dehydrated}return null}function qA(r){if(uu(r)!==r)throw Error(ee(188))}function Oq(r){var e=r.alternate;if(!e){if(e=uu(r),e===null)throw Error(ee(188));return e!==r?null:r}for(var t=r,n=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(n=i.return,n!==null){t=n;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return qA(i),r;if(s===n)return qA(i),e;s=s.sibling}throw Error(ee(188))}if(t.return!==n.return)t=i,n=s;else{for(var o=!1,a=i.child;a;){if(a===t){o=!0,t=i,n=s;break}if(a===n){o=!0,n=i,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,n=i;break}if(a===n){o=!0,n=s,t=i;break}a=a.sibling}if(!o)throw Error(ee(189))}}if(t.alternate!==n)throw Error(ee(190))}if(t.tag!==3)throw Error(ee(188));return t.stateNode.current===t?r:e}function XM(r){return r=Oq(r),r!==null?JM(r):null}function JM(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var e=JM(r);if(e!==null)return e;r=r.sibling}return null}var ZM=Yn.unstable_scheduleCallback,WA=Yn.unstable_cancelCallback,Rq=Yn.unstable_shouldYield,Lq=Yn.unstable_requestPaint,Kt=Yn.unstable_now,Bq=Yn.unstable_getCurrentPriorityLevel,F9=Yn.unstable_ImmediatePriority,eO=Yn.unstable_UserBlockingPriority,E2=Yn.unstable_NormalPriority,Uq=Yn.unstable_LowPriority,tO=Yn.unstable_IdlePriority,m3=null,Ns=null;function Fq(r){if(Ns&&typeof Ns.onCommitFiberRoot=="function")try{Ns.onCommitFiberRoot(m3,r,void 0,(r.current.flags&128)===128)}catch{}}var rs=Math.clz32?Math.clz32:Kq,zq=Math.log,Vq=Math.LN2;function Kq(r){return r>>>=0,r===0?32:31-(zq(r)/Vq|0)|0}var b0=64,v0=4194304;function Bf(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function S2(r,e){var t=r.pendingLanes;if(t===0)return 0;var n=0,i=r.suspendedLanes,s=r.pingedLanes,o=t&268435455;if(o!==0){var a=o&~i;a!==0?n=Bf(a):(s&=o,s!==0&&(n=Bf(s)))}else o=t&~i,o!==0?n=Bf(o):s!==0&&(n=Bf(s));if(n===0)return 0;if(e!==0&&e!==n&&!(e&i)&&(i=n&-n,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(n&4&&(n|=t&16),e=r.entangledLanes,e!==0)for(r=r.entanglements,e&=n;0<e;)t=31-rs(e),i=1<<t,n|=r[t],e&=~i;return n}function Hq(r,e){switch(r){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function jq(r,e){for(var t=r.suspendedLanes,n=r.pingedLanes,i=r.expirationTimes,s=r.pendingLanes;0<s;){var o=31-rs(s),a=1<<o,c=i[o];c===-1?(!(a&t)||a&n)&&(i[o]=Hq(a,e)):c<=e&&(r.expiredLanes|=a),s&=~a}}function w6(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function rO(){var r=b0;return b0<<=1,!(b0&4194240)&&(b0=64),r}function G4(r){for(var e=[],t=0;31>t;t++)e.push(r);return e}function Ip(r,e,t){r.pendingLanes|=e,e!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,e=31-rs(e),r[e]=t}function qq(r,e){var t=r.pendingLanes&~e;r.pendingLanes=e,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=e,r.mutableReadLanes&=e,r.entangledLanes&=e,e=r.entanglements;var n=r.eventTimes;for(r=r.expirationTimes;0<t;){var i=31-rs(t),s=1<<i;e[i]=0,n[i]=-1,r[i]=-1,t&=~s}}function z9(r,e){var t=r.entangledLanes|=e;for(r=r.entanglements;t;){var n=31-rs(t),i=1<<n;i&e|r[n]&e&&(r[n]|=e),t&=~i}}var lt=0;function nO(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var iO,V9,sO,oO,aO,b6=!1,E0=[],Ya=null,Xa=null,Ja=null,A1=new Map,C1=new Map,Oa=[],Wq="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function GA(r,e){switch(r){case"focusin":case"focusout":Ya=null;break;case"dragenter":case"dragleave":Xa=null;break;case"mouseover":case"mouseout":Ja=null;break;case"pointerover":case"pointerout":A1.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":C1.delete(e.pointerId)}}function Zd(r,e,t,n,i,s){return r===null||r.nativeEvent!==s?(r={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:s,targetContainers:[i]},e!==null&&(e=_p(e),e!==null&&V9(e)),r):(r.eventSystemFlags|=n,e=r.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),r)}function Gq(r,e,t,n,i){switch(e){case"focusin":return Ya=Zd(Ya,r,e,t,n,i),!0;case"dragenter":return Xa=Zd(Xa,r,e,t,n,i),!0;case"mouseover":return Ja=Zd(Ja,r,e,t,n,i),!0;case"pointerover":var s=i.pointerId;return A1.set(s,Zd(A1.get(s)||null,r,e,t,n,i)),!0;case"gotpointercapture":return s=i.pointerId,C1.set(s,Zd(C1.get(s)||null,r,e,t,n,i)),!0}return!1}function cO(r){var e=ul(r.target);if(e!==null){var t=uu(e);if(t!==null){if(e=t.tag,e===13){if(e=YM(t),e!==null){r.blockedOn=e,aO(r.priority,function(){sO(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){r.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}r.blockedOn=null}function kg(r){if(r.blockedOn!==null)return!1;for(var e=r.targetContainers;0<e.length;){var t=v6(r.domEventName,r.eventSystemFlags,e[0],r.nativeEvent);if(t===null){t=r.nativeEvent;var n=new t.constructor(t.type,t);p6=n,t.target.dispatchEvent(n),p6=null}else return e=_p(t),e!==null&&V9(e),r.blockedOn=t,!1;e.shift()}return!0}function QA(r,e,t){kg(r)&&t.delete(e)}function Qq(){b6=!1,Ya!==null&&kg(Ya)&&(Ya=null),Xa!==null&&kg(Xa)&&(Xa=null),Ja!==null&&kg(Ja)&&(Ja=null),A1.forEach(QA),C1.forEach(QA)}function ef(r,e){r.blockedOn===e&&(r.blockedOn=null,b6||(b6=!0,Yn.unstable_scheduleCallback(Yn.unstable_NormalPriority,Qq)))}function I1(r){function e(i){return ef(i,r)}if(0<E0.length){ef(E0[0],r);for(var t=1;t<E0.length;t++){var n=E0[t];n.blockedOn===r&&(n.blockedOn=null)}}for(Ya!==null&&ef(Ya,r),Xa!==null&&ef(Xa,r),Ja!==null&&ef(Ja,r),A1.forEach(e),C1.forEach(e),t=0;t<Oa.length;t++)n=Oa[t],n.blockedOn===r&&(n.blockedOn=null);for(;0<Oa.length&&(t=Oa[0],t.blockedOn===null);)cO(t),t.blockedOn===null&&Oa.shift()}var lh=Ko.ReactCurrentBatchConfig,x2=!0;function Yq(r,e,t,n){var i=lt,s=lh.transition;lh.transition=null;try{lt=1,K9(r,e,t,n)}finally{lt=i,lh.transition=s}}function Xq(r,e,t,n){var i=lt,s=lh.transition;lh.transition=null;try{lt=4,K9(r,e,t,n)}finally{lt=i,lh.transition=s}}function K9(r,e,t,n){if(x2){var i=v6(r,e,t,n);if(i===null)i8(r,e,n,A2,t),GA(r,n);else if(Gq(i,r,e,t,n))n.stopPropagation();else if(GA(r,n),e&4&&-1<Wq.indexOf(r)){for(;i!==null;){var s=_p(i);if(s!==null&&iO(s),s=v6(r,e,t,n),s===null&&i8(r,e,n,A2,t),s===i)break;i=s}i!==null&&n.stopPropagation()}else i8(r,e,n,null,t)}}var A2=null;function v6(r,e,t,n){if(A2=null,r=U9(n),r=ul(r),r!==null)if(e=uu(r),e===null)r=null;else if(t=e.tag,t===13){if(r=YM(e),r!==null)return r;r=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;r=null}else e!==r&&(r=null);return A2=r,null}function lO(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Bq()){case F9:return 1;case eO:return 4;case E2:case Uq:return 16;case tO:return 536870912;default:return 16}default:return 16}}var Va=null,H9=null,_g=null;function uO(){if(_g)return _g;var r,e=H9,t=e.length,n,i="value"in Va?Va.value:Va.textContent,s=i.length;for(r=0;r<t&&e[r]===i[r];r++);var o=t-r;for(n=1;n<=o&&e[t-n]===i[s-n];n++);return _g=i.slice(r,1<n?1-n:void 0)}function Tg(r){var e=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&e===13&&(r=13)):r=e,r===10&&(r=13),32<=r||r===13?r:0}function S0(){return!0}function YA(){return!1}function ei(r){function e(t,n,i,s,o){this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in r)r.hasOwnProperty(a)&&(t=r[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?S0:YA,this.isPropagationStopped=YA,this}return Lt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=S0)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=S0)},persist:function(){},isPersistent:S0}),e}var Ad={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},j9=ei(Ad),kp=Lt({},Ad,{view:0,detail:0}),Jq=ei(kp),Q4,Y4,tf,w3=Lt({},kp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:q9,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==tf&&(tf&&r.type==="mousemove"?(Q4=r.screenX-tf.screenX,Y4=r.screenY-tf.screenY):Y4=Q4=0,tf=r),Q4)},movementY:function(r){return"movementY"in r?r.movementY:Y4}}),XA=ei(w3),Zq=Lt({},w3,{dataTransfer:0}),eW=ei(Zq),tW=Lt({},kp,{relatedTarget:0}),X4=ei(tW),rW=Lt({},Ad,{animationName:0,elapsedTime:0,pseudoElement:0}),nW=ei(rW),iW=Lt({},Ad,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),sW=ei(iW),oW=Lt({},Ad,{data:0}),JA=ei(oW),aW={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cW={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},lW={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function uW(r){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(r):(r=lW[r])?!!e[r]:!1}function q9(){return uW}var hW=Lt({},kp,{key:function(r){if(r.key){var e=aW[r.key]||r.key;if(e!=="Unidentified")return e}return r.type==="keypress"?(r=Tg(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?cW[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:q9,charCode:function(r){return r.type==="keypress"?Tg(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Tg(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),dW=ei(hW),fW=Lt({},w3,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ZA=ei(fW),pW=Lt({},kp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:q9}),gW=ei(pW),yW=Lt({},Ad,{propertyName:0,elapsedTime:0,pseudoElement:0}),mW=ei(yW),wW=Lt({},w3,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),bW=ei(wW),vW=[9,13,27,32],W9=To&&"CompositionEvent"in window,Jf=null;To&&"documentMode"in document&&(Jf=document.documentMode);var EW=To&&"TextEvent"in window&&!Jf,hO=To&&(!W9||Jf&&8<Jf&&11>=Jf),eC=" ",tC=!1;function dO(r,e){switch(r){case"keyup":return vW.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fO(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var ju=!1;function SW(r,e){switch(r){case"compositionend":return fO(e);case"keypress":return e.which!==32?null:(tC=!0,eC);case"textInput":return r=e.data,r===eC&&tC?null:r;default:return null}}function xW(r,e){if(ju)return r==="compositionend"||!W9&&dO(r,e)?(r=uO(),_g=H9=Va=null,ju=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return hO&&e.locale!=="ko"?null:e.data;default:return null}}var AW={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function rC(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e==="input"?!!AW[r.type]:e==="textarea"}function pO(r,e,t,n){jM(n),e=C2(e,"onChange"),0<e.length&&(t=new j9("onChange","change",null,t,n),r.push({event:t,listeners:e}))}var Zf=null,k1=null;function CW(r){CO(r,0)}function b3(r){var e=Gu(r);if(BM(e))return r}function IW(r,e){if(r==="change")return e}var gO=!1;if(To){var J4;if(To){var Z4="oninput"in document;if(!Z4){var nC=document.createElement("div");nC.setAttribute("oninput","return;"),Z4=typeof nC.oninput=="function"}J4=Z4}else J4=!1;gO=J4&&(!document.documentMode||9<document.documentMode)}function iC(){Zf&&(Zf.detachEvent("onpropertychange",yO),k1=Zf=null)}function yO(r){if(r.propertyName==="value"&&b3(k1)){var e=[];pO(e,k1,r,U9(r)),QM(CW,e)}}function kW(r,e,t){r==="focusin"?(iC(),Zf=e,k1=t,Zf.attachEvent("onpropertychange",yO)):r==="focusout"&&iC()}function _W(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return b3(k1)}function TW(r,e){if(r==="click")return b3(e)}function PW(r,e){if(r==="input"||r==="change")return b3(e)}function DW(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var cs=typeof Object.is=="function"?Object.is:DW;function _1(r,e){if(cs(r,e))return!0;if(typeof r!="object"||r===null||typeof e!="object"||e===null)return!1;var t=Object.keys(r),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var i=t[n];if(!r6.call(e,i)||!cs(r[i],e[i]))return!1}return!0}function sC(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function oC(r,e){var t=sC(r);r=0;for(var n;t;){if(t.nodeType===3){if(n=r+t.textContent.length,r<=e&&n>=e)return{node:t,offset:e-r};r=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=sC(t)}}function mO(r,e){return r&&e?r===e?!0:r&&r.nodeType===3?!1:e&&e.nodeType===3?mO(r,e.parentNode):"contains"in r?r.contains(e):r.compareDocumentPosition?!!(r.compareDocumentPosition(e)&16):!1:!1}function wO(){for(var r=window,e=w2();e instanceof r.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)r=e.contentWindow;else break;e=w2(r.document)}return e}function G9(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e&&(e==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||e==="textarea"||r.contentEditable==="true")}function $W(r){var e=wO(),t=r.focusedElem,n=r.selectionRange;if(e!==t&&t&&t.ownerDocument&&mO(t.ownerDocument.documentElement,t)){if(n!==null&&G9(t)){if(e=n.start,r=n.end,r===void 0&&(r=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(r,t.value.length);else if(r=(e=t.ownerDocument||document)&&e.defaultView||window,r.getSelection){r=r.getSelection();var i=t.textContent.length,s=Math.min(n.start,i);n=n.end===void 0?s:Math.min(n.end,i),!r.extend&&s>n&&(i=n,n=s,s=i),i=oC(t,s);var o=oC(t,n);i&&o&&(r.rangeCount!==1||r.anchorNode!==i.node||r.anchorOffset!==i.offset||r.focusNode!==o.node||r.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),r.removeAllRanges(),s>n?(r.addRange(e),r.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),r.addRange(e)))}}for(e=[],r=t;r=r.parentNode;)r.nodeType===1&&e.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)r=e[t],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var NW=To&&"documentMode"in document&&11>=document.documentMode,qu=null,E6=null,e1=null,S6=!1;function aC(r,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;S6||qu==null||qu!==w2(n)||(n=qu,"selectionStart"in n&&G9(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),e1&&_1(e1,n)||(e1=n,n=C2(E6,"onSelect"),0<n.length&&(e=new j9("onSelect","select",null,e,t),r.push({event:e,listeners:n}),e.target=qu)))}function x0(r,e){var t={};return t[r.toLowerCase()]=e.toLowerCase(),t["Webkit"+r]="webkit"+e,t["Moz"+r]="moz"+e,t}var Wu={animationend:x0("Animation","AnimationEnd"),animationiteration:x0("Animation","AnimationIteration"),animationstart:x0("Animation","AnimationStart"),transitionend:x0("Transition","TransitionEnd")},e8={},bO={};To&&(bO=document.createElement("div").style,"AnimationEvent"in window||(delete Wu.animationend.animation,delete Wu.animationiteration.animation,delete Wu.animationstart.animation),"TransitionEvent"in window||delete Wu.transitionend.transition);function v3(r){if(e8[r])return e8[r];if(!Wu[r])return r;var e=Wu[r],t;for(t in e)if(e.hasOwnProperty(t)&&t in bO)return e8[r]=e[t];return r}var vO=v3("animationend"),EO=v3("animationiteration"),SO=v3("animationstart"),xO=v3("transitionend"),AO=new Map,cC="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Tc(r,e){AO.set(r,e),lu(e,[r])}for(var t8=0;t8<cC.length;t8++){var r8=cC[t8],MW=r8.toLowerCase(),OW=r8[0].toUpperCase()+r8.slice(1);Tc(MW,"on"+OW)}Tc(vO,"onAnimationEnd");Tc(EO,"onAnimationIteration");Tc(SO,"onAnimationStart");Tc("dblclick","onDoubleClick");Tc("focusin","onFocus");Tc("focusout","onBlur");Tc(xO,"onTransitionEnd");Nh("onMouseEnter",["mouseout","mouseover"]);Nh("onMouseLeave",["mouseout","mouseover"]);Nh("onPointerEnter",["pointerout","pointerover"]);Nh("onPointerLeave",["pointerout","pointerover"]);lu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));lu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));lu("onBeforeInput",["compositionend","keypress","textInput","paste"]);lu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));lu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));lu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Uf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),RW=new Set("cancel close invalid load scroll toggle".split(" ").concat(Uf));function lC(r,e,t){var n=r.type||"unknown-event";r.currentTarget=t,Mq(n,e,void 0,r),r.currentTarget=null}function CO(r,e){e=(e&4)!==0;for(var t=0;t<r.length;t++){var n=r[t],i=n.event;n=n.listeners;e:{var s=void 0;if(e)for(var o=n.length-1;0<=o;o--){var a=n[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&i.isPropagationStopped())break e;lC(i,a,l),s=c}else for(o=0;o<n.length;o++){if(a=n[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&i.isPropagationStopped())break e;lC(i,a,l),s=c}}}if(v2)throw r=m6,v2=!1,m6=null,r}function xt(r,e){var t=e[k6];t===void 0&&(t=e[k6]=new Set);var n=r+"__bubble";t.has(n)||(IO(e,r,2,!1),t.add(n))}function n8(r,e,t){var n=0;e&&(n|=4),IO(t,r,n,e)}var A0="_reactListening"+Math.random().toString(36).slice(2);function T1(r){if(!r[A0]){r[A0]=!0,NM.forEach(function(t){t!=="selectionchange"&&(RW.has(t)||n8(t,!1,r),n8(t,!0,r))});var e=r.nodeType===9?r:r.ownerDocument;e===null||e[A0]||(e[A0]=!0,n8("selectionchange",!1,e))}}function IO(r,e,t,n){switch(lO(e)){case 1:var i=Yq;break;case 4:i=Xq;break;default:i=K9}t=i.bind(null,e,t,r),i=void 0,!y6||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),n?i!==void 0?r.addEventListener(e,t,{capture:!0,passive:i}):r.addEventListener(e,t,!0):i!==void 0?r.addEventListener(e,t,{passive:i}):r.addEventListener(e,t,!1)}function i8(r,e,t,n,i){var s=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var a=n.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=n.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;a!==null;){if(o=ul(a),o===null)return;if(c=o.tag,c===5||c===6){n=s=o;continue e}a=a.parentNode}}n=n.return}QM(function(){var l=s,h=U9(t),d=[];e:{var p=AO.get(r);if(p!==void 0){var m=j9,f=r;switch(r){case"keypress":if(Tg(t)===0)break e;case"keydown":case"keyup":m=dW;break;case"focusin":f="focus",m=X4;break;case"focusout":f="blur",m=X4;break;case"beforeblur":case"afterblur":m=X4;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=XA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=eW;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=gW;break;case vO:case EO:case SO:m=nW;break;case xO:m=mW;break;case"scroll":m=Jq;break;case"wheel":m=bW;break;case"copy":case"cut":case"paste":m=sW;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=ZA}var g=(e&4)!==0,v=!g&&r==="scroll",y=g?p!==null?p+"Capture":null:p;g=[];for(var w=l,b;w!==null;){b=w;var E=b.stateNode;if(b.tag===5&&E!==null&&(b=E,y!==null&&(E=x1(w,y),E!=null&&g.push(P1(w,E,b)))),v)break;w=w.return}0<g.length&&(p=new m(p,f,null,t,h),d.push({event:p,listeners:g}))}}if(!(e&7)){e:{if(p=r==="mouseover"||r==="pointerover",m=r==="mouseout"||r==="pointerout",p&&t!==p6&&(f=t.relatedTarget||t.fromElement)&&(ul(f)||f[Po]))break e;if((m||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,m?(f=t.relatedTarget||t.toElement,m=l,f=f?ul(f):null,f!==null&&(v=uu(f),f!==v||f.tag!==5&&f.tag!==6)&&(f=null)):(m=null,f=l),m!==f)){if(g=XA,E="onMouseLeave",y="onMouseEnter",w="mouse",(r==="pointerout"||r==="pointerover")&&(g=ZA,E="onPointerLeave",y="onPointerEnter",w="pointer"),v=m==null?p:Gu(m),b=f==null?p:Gu(f),p=new g(E,w+"leave",m,t,h),p.target=v,p.relatedTarget=b,E=null,ul(h)===l&&(g=new g(y,w+"enter",f,t,h),g.target=b,g.relatedTarget=v,E=g),v=E,m&&f)t:{for(g=m,y=f,w=0,b=g;b;b=Au(b))w++;for(b=0,E=y;E;E=Au(E))b++;for(;0<w-b;)g=Au(g),w--;for(;0<b-w;)y=Au(y),b--;for(;w--;){if(g===y||y!==null&&g===y.alternate)break t;g=Au(g),y=Au(y)}g=null}else g=null;m!==null&&uC(d,p,m,g,!1),f!==null&&v!==null&&uC(d,v,f,g,!0)}}e:{if(p=l?Gu(l):window,m=p.nodeName&&p.nodeName.toLowerCase(),m==="select"||m==="input"&&p.type==="file")var C=IW;else if(rC(p))if(gO)C=PW;else{C=_W;var k=kW}else(m=p.nodeName)&&m.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(C=TW);if(C&&(C=C(r,l))){pO(d,C,t,h);break e}k&&k(r,p,l),r==="focusout"&&(k=p._wrapperState)&&k.controlled&&p.type==="number"&&l6(p,"number",p.value)}switch(k=l?Gu(l):window,r){case"focusin":(rC(k)||k.contentEditable==="true")&&(qu=k,E6=l,e1=null);break;case"focusout":e1=E6=qu=null;break;case"mousedown":S6=!0;break;case"contextmenu":case"mouseup":case"dragend":S6=!1,aC(d,t,h);break;case"selectionchange":if(NW)break;case"keydown":case"keyup":aC(d,t,h)}var x;if(W9)e:{switch(r){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else ju?dO(r,t)&&(I="onCompositionEnd"):r==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(hO&&t.locale!=="ko"&&(ju||I!=="onCompositionStart"?I==="onCompositionEnd"&&ju&&(x=uO()):(Va=h,H9="value"in Va?Va.value:Va.textContent,ju=!0)),k=C2(l,I),0<k.length&&(I=new JA(I,r,null,t,h),d.push({event:I,listeners:k}),x?I.data=x:(x=fO(t),x!==null&&(I.data=x)))),(x=EW?SW(r,t):xW(r,t))&&(l=C2(l,"onBeforeInput"),0<l.length&&(h=new JA("onBeforeInput","beforeinput",null,t,h),d.push({event:h,listeners:l}),h.data=x))}CO(d,e)})}function P1(r,e,t){return{instance:r,listener:e,currentTarget:t}}function C2(r,e){for(var t=e+"Capture",n=[];r!==null;){var i=r,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=x1(r,t),s!=null&&n.unshift(P1(r,s,i)),s=x1(r,e),s!=null&&n.push(P1(r,s,i))),r=r.return}return n}function Au(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function uC(r,e,t,n,i){for(var s=e._reactName,o=[];t!==null&&t!==n;){var a=t,c=a.alternate,l=a.stateNode;if(c!==null&&c===n)break;a.tag===5&&l!==null&&(a=l,i?(c=x1(t,s),c!=null&&o.unshift(P1(t,c,a))):i||(c=x1(t,s),c!=null&&o.push(P1(t,c,a)))),t=t.return}o.length!==0&&r.push({event:e,listeners:o})}var LW=/\r\n?/g,BW=/\u0000|\uFFFD/g;function hC(r){return(typeof r=="string"?r:""+r).replace(LW,`
`).replace(BW,"")}function C0(r,e,t){if(e=hC(e),hC(r)!==e&&t)throw Error(ee(425))}function I2(){}var x6=null,A6=null;function C6(r,e){return r==="textarea"||r==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var I6=typeof setTimeout=="function"?setTimeout:void 0,UW=typeof clearTimeout=="function"?clearTimeout:void 0,dC=typeof Promise=="function"?Promise:void 0,FW=typeof queueMicrotask=="function"?queueMicrotask:typeof dC<"u"?function(r){return dC.resolve(null).then(r).catch(zW)}:I6;function zW(r){setTimeout(function(){throw r})}function s8(r,e){var t=e,n=0;do{var i=t.nextSibling;if(r.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(n===0){r.removeChild(i),I1(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=i}while(t);I1(e)}function Za(r){for(;r!=null;r=r.nextSibling){var e=r.nodeType;if(e===1||e===3)break;if(e===8){if(e=r.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return r}function fC(r){r=r.previousSibling;for(var e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return r;e--}else t==="/$"&&e++}r=r.previousSibling}return null}var Cd=Math.random().toString(36).slice(2),Ps="__reactFiber$"+Cd,D1="__reactProps$"+Cd,Po="__reactContainer$"+Cd,k6="__reactEvents$"+Cd,VW="__reactListeners$"+Cd,KW="__reactHandles$"+Cd;function ul(r){var e=r[Ps];if(e)return e;for(var t=r.parentNode;t;){if(e=t[Po]||t[Ps]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(r=fC(r);r!==null;){if(t=r[Ps])return t;r=fC(r)}return e}r=t,t=r.parentNode}return null}function _p(r){return r=r[Ps]||r[Po],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Gu(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(ee(33))}function E3(r){return r[D1]||null}var _6=[],Qu=-1;function Pc(r){return{current:r}}function At(r){0>Qu||(r.current=_6[Qu],_6[Qu]=null,Qu--)}function vt(r,e){Qu++,_6[Qu]=r.current,r.current=e}var fc={},Yr=Pc(fc),Cn=Pc(!1),Ol=fc;function Mh(r,e){var t=r.type.contextTypes;if(!t)return fc;var n=r.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=e,r.__reactInternalMemoizedMaskedChildContext=i),i}function In(r){return r=r.childContextTypes,r!=null}function k2(){At(Cn),At(Yr)}function pC(r,e,t){if(Yr.current!==fc)throw Error(ee(168));vt(Yr,e),vt(Cn,t)}function kO(r,e,t){var n=r.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var i in n)if(!(i in e))throw Error(ee(108,kq(r)||"Unknown",i));return Lt({},t,n)}function _2(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||fc,Ol=Yr.current,vt(Yr,r),vt(Cn,Cn.current),!0}function gC(r,e,t){var n=r.stateNode;if(!n)throw Error(ee(169));t?(r=kO(r,e,Ol),n.__reactInternalMemoizedMergedChildContext=r,At(Cn),At(Yr),vt(Yr,r)):At(Cn),vt(Cn,t)}var co=null,S3=!1,o8=!1;function _O(r){co===null?co=[r]:co.push(r)}function HW(r){S3=!0,_O(r)}function Dc(){if(!o8&&co!==null){o8=!0;var r=0,e=lt;try{var t=co;for(lt=1;r<t.length;r++){var n=t[r];do n=n(!0);while(n!==null)}co=null,S3=!1}catch(i){throw co!==null&&(co=co.slice(r+1)),ZM(F9,Dc),i}finally{lt=e,o8=!1}}return null}var Yu=[],Xu=0,T2=null,P2=0,mi=[],wi=0,Rl=null,bo=1,vo="";function el(r,e){Yu[Xu++]=P2,Yu[Xu++]=T2,T2=r,P2=e}function TO(r,e,t){mi[wi++]=bo,mi[wi++]=vo,mi[wi++]=Rl,Rl=r;var n=bo;r=vo;var i=32-rs(n)-1;n&=~(1<<i),t+=1;var s=32-rs(e)+i;if(30<s){var o=i-i%5;s=(n&(1<<o)-1).toString(32),n>>=o,i-=o,bo=1<<32-rs(e)+i|t<<i|n,vo=s+r}else bo=1<<s|t<<i|n,vo=r}function Q9(r){r.return!==null&&(el(r,1),TO(r,1,0))}function Y9(r){for(;r===T2;)T2=Yu[--Xu],Yu[Xu]=null,P2=Yu[--Xu],Yu[Xu]=null;for(;r===Rl;)Rl=mi[--wi],mi[wi]=null,vo=mi[--wi],mi[wi]=null,bo=mi[--wi],mi[wi]=null}var Qn=null,Gn=null,Tt=!1,Xi=null;function PO(r,e){var t=Si(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=r,e=r.deletions,e===null?(r.deletions=[t],r.flags|=16):e.push(t)}function yC(r,e){switch(r.tag){case 5:var t=r.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(r.stateNode=e,Qn=r,Gn=Za(e.firstChild),!0):!1;case 6:return e=r.pendingProps===""||e.nodeType!==3?null:e,e!==null?(r.stateNode=e,Qn=r,Gn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Rl!==null?{id:bo,overflow:vo}:null,r.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Si(18,null,null,0),t.stateNode=e,t.return=r,r.child=t,Qn=r,Gn=null,!0):!1;default:return!1}}function T6(r){return(r.mode&1)!==0&&(r.flags&128)===0}function P6(r){if(Tt){var e=Gn;if(e){var t=e;if(!yC(r,e)){if(T6(r))throw Error(ee(418));e=Za(t.nextSibling);var n=Qn;e&&yC(r,e)?PO(n,t):(r.flags=r.flags&-4097|2,Tt=!1,Qn=r)}}else{if(T6(r))throw Error(ee(418));r.flags=r.flags&-4097|2,Tt=!1,Qn=r}}}function mC(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Qn=r}function I0(r){if(r!==Qn)return!1;if(!Tt)return mC(r),Tt=!0,!1;var e;if((e=r.tag!==3)&&!(e=r.tag!==5)&&(e=r.type,e=e!=="head"&&e!=="body"&&!C6(r.type,r.memoizedProps)),e&&(e=Gn)){if(T6(r))throw DO(),Error(ee(418));for(;e;)PO(r,e),e=Za(e.nextSibling)}if(mC(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(ee(317));e:{for(r=r.nextSibling,e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="/$"){if(e===0){Gn=Za(r.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}r=r.nextSibling}Gn=null}}else Gn=Qn?Za(r.stateNode.nextSibling):null;return!0}function DO(){for(var r=Gn;r;)r=Za(r.nextSibling)}function Oh(){Gn=Qn=null,Tt=!1}function X9(r){Xi===null?Xi=[r]:Xi.push(r)}var jW=Ko.ReactCurrentBatchConfig;function rf(r,e,t){if(r=t.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(ee(309));var n=t.stateNode}if(!n)throw Error(ee(147,r));var i=n,s=""+r;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof r!="string")throw Error(ee(284));if(!t._owner)throw Error(ee(290,r))}return r}function k0(r,e){throw r=Object.prototype.toString.call(e),Error(ee(31,r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r))}function wC(r){var e=r._init;return e(r._payload)}function $O(r){function e(y,w){if(r){var b=y.deletions;b===null?(y.deletions=[w],y.flags|=16):b.push(w)}}function t(y,w){if(!r)return null;for(;w!==null;)e(y,w),w=w.sibling;return null}function n(y,w){for(y=new Map;w!==null;)w.key!==null?y.set(w.key,w):y.set(w.index,w),w=w.sibling;return y}function i(y,w){return y=nc(y,w),y.index=0,y.sibling=null,y}function s(y,w,b){return y.index=b,r?(b=y.alternate,b!==null?(b=b.index,b<w?(y.flags|=2,w):b):(y.flags|=2,w)):(y.flags|=1048576,w)}function o(y){return r&&y.alternate===null&&(y.flags|=2),y}function a(y,w,b,E){return w===null||w.tag!==6?(w=f8(b,y.mode,E),w.return=y,w):(w=i(w,b),w.return=y,w)}function c(y,w,b,E){var C=b.type;return C===Hu?h(y,w,b.props.children,E,b.key):w!==null&&(w.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Ea&&wC(C)===w.type)?(E=i(w,b.props),E.ref=rf(y,w,b),E.return=y,E):(E=Rg(b.type,b.key,b.props,null,y.mode,E),E.ref=rf(y,w,b),E.return=y,E)}function l(y,w,b,E){return w===null||w.tag!==4||w.stateNode.containerInfo!==b.containerInfo||w.stateNode.implementation!==b.implementation?(w=p8(b,y.mode,E),w.return=y,w):(w=i(w,b.children||[]),w.return=y,w)}function h(y,w,b,E,C){return w===null||w.tag!==7?(w=xl(b,y.mode,E,C),w.return=y,w):(w=i(w,b),w.return=y,w)}function d(y,w,b){if(typeof w=="string"&&w!==""||typeof w=="number")return w=f8(""+w,y.mode,b),w.return=y,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case y0:return b=Rg(w.type,w.key,w.props,null,y.mode,b),b.ref=rf(y,null,w),b.return=y,b;case Ku:return w=p8(w,y.mode,b),w.return=y,w;case Ea:var E=w._init;return d(y,E(w._payload),b)}if(Lf(w)||Xd(w))return w=xl(w,y.mode,b,null),w.return=y,w;k0(y,w)}return null}function p(y,w,b,E){var C=w!==null?w.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return C!==null?null:a(y,w,""+b,E);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case y0:return b.key===C?c(y,w,b,E):null;case Ku:return b.key===C?l(y,w,b,E):null;case Ea:return C=b._init,p(y,w,C(b._payload),E)}if(Lf(b)||Xd(b))return C!==null?null:h(y,w,b,E,null);k0(y,b)}return null}function m(y,w,b,E,C){if(typeof E=="string"&&E!==""||typeof E=="number")return y=y.get(b)||null,a(w,y,""+E,C);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case y0:return y=y.get(E.key===null?b:E.key)||null,c(w,y,E,C);case Ku:return y=y.get(E.key===null?b:E.key)||null,l(w,y,E,C);case Ea:var k=E._init;return m(y,w,b,k(E._payload),C)}if(Lf(E)||Xd(E))return y=y.get(b)||null,h(w,y,E,C,null);k0(w,E)}return null}function f(y,w,b,E){for(var C=null,k=null,x=w,I=w=0,T=null;x!==null&&I<b.length;I++){x.index>I?(T=x,x=null):T=x.sibling;var L=p(y,x,b[I],E);if(L===null){x===null&&(x=T);break}r&&x&&L.alternate===null&&e(y,x),w=s(L,w,I),k===null?C=L:k.sibling=L,k=L,x=T}if(I===b.length)return t(y,x),Tt&&el(y,I),C;if(x===null){for(;I<b.length;I++)x=d(y,b[I],E),x!==null&&(w=s(x,w,I),k===null?C=x:k.sibling=x,k=x);return Tt&&el(y,I),C}for(x=n(y,x);I<b.length;I++)T=m(x,y,I,b[I],E),T!==null&&(r&&T.alternate!==null&&x.delete(T.key===null?I:T.key),w=s(T,w,I),k===null?C=T:k.sibling=T,k=T);return r&&x.forEach(function(V){return e(y,V)}),Tt&&el(y,I),C}function g(y,w,b,E){var C=Xd(b);if(typeof C!="function")throw Error(ee(150));if(b=C.call(b),b==null)throw Error(ee(151));for(var k=C=null,x=w,I=w=0,T=null,L=b.next();x!==null&&!L.done;I++,L=b.next()){x.index>I?(T=x,x=null):T=x.sibling;var V=p(y,x,L.value,E);if(V===null){x===null&&(x=T);break}r&&x&&V.alternate===null&&e(y,x),w=s(V,w,I),k===null?C=V:k.sibling=V,k=V,x=T}if(L.done)return t(y,x),Tt&&el(y,I),C;if(x===null){for(;!L.done;I++,L=b.next())L=d(y,L.value,E),L!==null&&(w=s(L,w,I),k===null?C=L:k.sibling=L,k=L);return Tt&&el(y,I),C}for(x=n(y,x);!L.done;I++,L=b.next())L=m(x,y,I,L.value,E),L!==null&&(r&&L.alternate!==null&&x.delete(L.key===null?I:L.key),w=s(L,w,I),k===null?C=L:k.sibling=L,k=L);return r&&x.forEach(function(U){return e(y,U)}),Tt&&el(y,I),C}function v(y,w,b,E){if(typeof b=="object"&&b!==null&&b.type===Hu&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case y0:e:{for(var C=b.key,k=w;k!==null;){if(k.key===C){if(C=b.type,C===Hu){if(k.tag===7){t(y,k.sibling),w=i(k,b.props.children),w.return=y,y=w;break e}}else if(k.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Ea&&wC(C)===k.type){t(y,k.sibling),w=i(k,b.props),w.ref=rf(y,k,b),w.return=y,y=w;break e}t(y,k);break}else e(y,k);k=k.sibling}b.type===Hu?(w=xl(b.props.children,y.mode,E,b.key),w.return=y,y=w):(E=Rg(b.type,b.key,b.props,null,y.mode,E),E.ref=rf(y,w,b),E.return=y,y=E)}return o(y);case Ku:e:{for(k=b.key;w!==null;){if(w.key===k)if(w.tag===4&&w.stateNode.containerInfo===b.containerInfo&&w.stateNode.implementation===b.implementation){t(y,w.sibling),w=i(w,b.children||[]),w.return=y,y=w;break e}else{t(y,w);break}else e(y,w);w=w.sibling}w=p8(b,y.mode,E),w.return=y,y=w}return o(y);case Ea:return k=b._init,v(y,w,k(b._payload),E)}if(Lf(b))return f(y,w,b,E);if(Xd(b))return g(y,w,b,E);k0(y,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,w!==null&&w.tag===6?(t(y,w.sibling),w=i(w,b),w.return=y,y=w):(t(y,w),w=f8(b,y.mode,E),w.return=y,y=w),o(y)):t(y,w)}return v}var Rh=$O(!0),NO=$O(!1),D2=Pc(null),$2=null,Ju=null,J9=null;function Z9(){J9=Ju=$2=null}function eE(r){var e=D2.current;At(D2),r._currentValue=e}function D6(r,e,t){for(;r!==null;){var n=r.alternate;if((r.childLanes&e)!==e?(r.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),r===t)break;r=r.return}}function uh(r,e){$2=r,J9=Ju=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&e&&(xn=!0),r.firstContext=null)}function Pi(r){var e=r._currentValue;if(J9!==r)if(r={context:r,memoizedValue:e,next:null},Ju===null){if($2===null)throw Error(ee(308));Ju=r,$2.dependencies={lanes:0,firstContext:r}}else Ju=Ju.next=r;return e}var hl=null;function tE(r){hl===null?hl=[r]:hl.push(r)}function MO(r,e,t,n){var i=e.interleaved;return i===null?(t.next=t,tE(e)):(t.next=i.next,i.next=t),e.interleaved=t,Do(r,n)}function Do(r,e){r.lanes|=e;var t=r.alternate;for(t!==null&&(t.lanes|=e),t=r,r=r.return;r!==null;)r.childLanes|=e,t=r.alternate,t!==null&&(t.childLanes|=e),t=r,r=r.return;return t.tag===3?t.stateNode:null}var Sa=!1;function rE(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function OO(r,e){r=r.updateQueue,e.updateQueue===r&&(e.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function So(r,e){return{eventTime:r,lane:e,tag:0,payload:null,callback:null,next:null}}function ec(r,e,t){var n=r.updateQueue;if(n===null)return null;if(n=n.shared,Je&2){var i=n.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),n.pending=e,Do(r,t)}return i=n.interleaved,i===null?(e.next=e,tE(n)):(e.next=i.next,i.next=e),n.interleaved=e,Do(r,t)}function Pg(r,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,z9(r,t)}}function bC(r,e){var t=r.updateQueue,n=r.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:n.shared,effects:n.effects},r.updateQueue=t;return}r=t.lastBaseUpdate,r===null?t.firstBaseUpdate=e:r.next=e,t.lastBaseUpdate=e}function N2(r,e,t,n){var i=r.updateQueue;Sa=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var h=r.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=l:a.next=l,h.lastBaseUpdate=c))}if(s!==null){var d=i.baseState;o=0,h=l=c=null,a=s;do{var p=a.lane,m=a.eventTime;if((n&p)===p){h!==null&&(h=h.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=r,g=a;switch(p=e,m=t,g.tag){case 1:if(f=g.payload,typeof f=="function"){d=f.call(m,d,p);break e}d=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=g.payload,p=typeof f=="function"?f.call(m,d,p):f,p==null)break e;d=Lt({},d,p);break e;case 2:Sa=!0}}a.callback!==null&&a.lane!==0&&(r.flags|=64,p=i.effects,p===null?i.effects=[a]:p.push(a))}else m={eventTime:m,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(l=h=m,c=d):h=h.next=m,o|=p;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;p=a,a=p.next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}while(!0);if(h===null&&(c=d),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=h,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);Bl|=o,r.lanes=o,r.memoizedState=d}}function vC(r,e,t){if(r=e.effects,e.effects=null,r!==null)for(e=0;e<r.length;e++){var n=r[e],i=n.callback;if(i!==null){if(n.callback=null,n=t,typeof i!="function")throw Error(ee(191,i));i.call(n)}}}var Tp={},Ms=Pc(Tp),$1=Pc(Tp),N1=Pc(Tp);function dl(r){if(r===Tp)throw Error(ee(174));return r}function nE(r,e){switch(vt(N1,e),vt($1,r),vt(Ms,Tp),r=e.nodeType,r){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:h6(null,"");break;default:r=r===8?e.parentNode:e,e=r.namespaceURI||null,r=r.tagName,e=h6(e,r)}At(Ms),vt(Ms,e)}function Lh(){At(Ms),At($1),At(N1)}function RO(r){dl(N1.current);var e=dl(Ms.current),t=h6(e,r.type);e!==t&&(vt($1,r),vt(Ms,t))}function iE(r){$1.current===r&&(At(Ms),At($1))}var Mt=Pc(0);function M2(r){for(var e=r;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var a8=[];function sE(){for(var r=0;r<a8.length;r++)a8[r]._workInProgressVersionPrimary=null;a8.length=0}var Dg=Ko.ReactCurrentDispatcher,c8=Ko.ReactCurrentBatchConfig,Ll=0,Rt=null,Jt=null,ar=null,O2=!1,t1=!1,M1=0,qW=0;function kr(){throw Error(ee(321))}function oE(r,e){if(e===null)return!1;for(var t=0;t<e.length&&t<r.length;t++)if(!cs(r[t],e[t]))return!1;return!0}function aE(r,e,t,n,i,s){if(Ll=s,Rt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Dg.current=r===null||r.memoizedState===null?YW:XW,r=t(n,i),t1){s=0;do{if(t1=!1,M1=0,25<=s)throw Error(ee(301));s+=1,ar=Jt=null,e.updateQueue=null,Dg.current=JW,r=t(n,i)}while(t1)}if(Dg.current=R2,e=Jt!==null&&Jt.next!==null,Ll=0,ar=Jt=Rt=null,O2=!1,e)throw Error(ee(300));return r}function cE(){var r=M1!==0;return M1=0,r}function As(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ar===null?Rt.memoizedState=ar=r:ar=ar.next=r,ar}function Di(){if(Jt===null){var r=Rt.alternate;r=r!==null?r.memoizedState:null}else r=Jt.next;var e=ar===null?Rt.memoizedState:ar.next;if(e!==null)ar=e,Jt=r;else{if(r===null)throw Error(ee(310));Jt=r,r={memoizedState:Jt.memoizedState,baseState:Jt.baseState,baseQueue:Jt.baseQueue,queue:Jt.queue,next:null},ar===null?Rt.memoizedState=ar=r:ar=ar.next=r}return ar}function O1(r,e){return typeof e=="function"?e(r):e}function l8(r){var e=Di(),t=e.queue;if(t===null)throw Error(ee(311));t.lastRenderedReducer=r;var n=Jt,i=n.baseQueue,s=t.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}n.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,n=n.baseState;var a=o=null,c=null,l=s;do{var h=l.lane;if((Ll&h)===h)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:r(n,l.action);else{var d={lane:h,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=d,o=n):c=c.next=d,Rt.lanes|=h,Bl|=h}l=l.next}while(l!==null&&l!==s);c===null?o=n:c.next=a,cs(n,e.memoizedState)||(xn=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=c,t.lastRenderedState=n}if(r=t.interleaved,r!==null){i=r;do s=i.lane,Rt.lanes|=s,Bl|=s,i=i.next;while(i!==r)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function u8(r){var e=Di(),t=e.queue;if(t===null)throw Error(ee(311));t.lastRenderedReducer=r;var n=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do s=r(s,o.action),o=o.next;while(o!==i);cs(s,e.memoizedState)||(xn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,n]}function LO(){}function BO(r,e){var t=Rt,n=Di(),i=e(),s=!cs(n.memoizedState,i);if(s&&(n.memoizedState=i,xn=!0),n=n.queue,lE(zO.bind(null,t,n,r),[r]),n.getSnapshot!==e||s||ar!==null&&ar.memoizedState.tag&1){if(t.flags|=2048,R1(9,FO.bind(null,t,n,i,e),void 0,null),lr===null)throw Error(ee(349));Ll&30||UO(t,e,i)}return i}function UO(r,e,t){r.flags|=16384,r={getSnapshot:e,value:t},e=Rt.updateQueue,e===null?(e={lastEffect:null,stores:null},Rt.updateQueue=e,e.stores=[r]):(t=e.stores,t===null?e.stores=[r]:t.push(r))}function FO(r,e,t,n){e.value=t,e.getSnapshot=n,VO(e)&&KO(r)}function zO(r,e,t){return t(function(){VO(e)&&KO(r)})}function VO(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!cs(r,t)}catch{return!0}}function KO(r){var e=Do(r,1);e!==null&&ns(e,r,1,-1)}function EC(r){var e=As();return typeof r=="function"&&(r=r()),e.memoizedState=e.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:O1,lastRenderedState:r},e.queue=r,r=r.dispatch=QW.bind(null,Rt,r),[e.memoizedState,r]}function R1(r,e,t,n){return r={tag:r,create:e,destroy:t,deps:n,next:null},e=Rt.updateQueue,e===null?(e={lastEffect:null,stores:null},Rt.updateQueue=e,e.lastEffect=r.next=r):(t=e.lastEffect,t===null?e.lastEffect=r.next=r:(n=t.next,t.next=r,r.next=n,e.lastEffect=r)),r}function HO(){return Di().memoizedState}function $g(r,e,t,n){var i=As();Rt.flags|=r,i.memoizedState=R1(1|e,t,void 0,n===void 0?null:n)}function x3(r,e,t,n){var i=Di();n=n===void 0?null:n;var s=void 0;if(Jt!==null){var o=Jt.memoizedState;if(s=o.destroy,n!==null&&oE(n,o.deps)){i.memoizedState=R1(e,t,s,n);return}}Rt.flags|=r,i.memoizedState=R1(1|e,t,s,n)}function SC(r,e){return $g(8390656,8,r,e)}function lE(r,e){return x3(2048,8,r,e)}function jO(r,e){return x3(4,2,r,e)}function qO(r,e){return x3(4,4,r,e)}function WO(r,e){if(typeof e=="function")return r=r(),e(r),function(){e(null)};if(e!=null)return r=r(),e.current=r,function(){e.current=null}}function GO(r,e,t){return t=t!=null?t.concat([r]):null,x3(4,4,WO.bind(null,e,r),t)}function uE(){}function QO(r,e){var t=Di();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&oE(e,n[1])?n[0]:(t.memoizedState=[r,e],r)}function YO(r,e){var t=Di();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&oE(e,n[1])?n[0]:(r=r(),t.memoizedState=[r,e],r)}function XO(r,e,t){return Ll&21?(cs(t,e)||(t=rO(),Rt.lanes|=t,Bl|=t,r.baseState=!0),e):(r.baseState&&(r.baseState=!1,xn=!0),r.memoizedState=t)}function WW(r,e){var t=lt;lt=t!==0&&4>t?t:4,r(!0);var n=c8.transition;c8.transition={};try{r(!1),e()}finally{lt=t,c8.transition=n}}function JO(){return Di().memoizedState}function GW(r,e,t){var n=rc(r);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},ZO(r))eR(e,t);else if(t=MO(r,e,t,n),t!==null){var i=on();ns(t,r,n,i),tR(t,e,n)}}function QW(r,e,t){var n=rc(r),i={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(ZO(r))eR(e,i);else{var s=r.alternate;if(r.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(i.hasEagerState=!0,i.eagerState=a,cs(a,o)){var c=e.interleaved;c===null?(i.next=i,tE(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}t=MO(r,e,i,n),t!==null&&(i=on(),ns(t,r,n,i),tR(t,e,n))}}function ZO(r){var e=r.alternate;return r===Rt||e!==null&&e===Rt}function eR(r,e){t1=O2=!0;var t=r.pending;t===null?e.next=e:(e.next=t.next,t.next=e),r.pending=e}function tR(r,e,t){if(t&4194240){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,z9(r,t)}}var R2={readContext:Pi,useCallback:kr,useContext:kr,useEffect:kr,useImperativeHandle:kr,useInsertionEffect:kr,useLayoutEffect:kr,useMemo:kr,useReducer:kr,useRef:kr,useState:kr,useDebugValue:kr,useDeferredValue:kr,useTransition:kr,useMutableSource:kr,useSyncExternalStore:kr,useId:kr,unstable_isNewReconciler:!1},YW={readContext:Pi,useCallback:function(r,e){return As().memoizedState=[r,e===void 0?null:e],r},useContext:Pi,useEffect:SC,useImperativeHandle:function(r,e,t){return t=t!=null?t.concat([r]):null,$g(4194308,4,WO.bind(null,e,r),t)},useLayoutEffect:function(r,e){return $g(4194308,4,r,e)},useInsertionEffect:function(r,e){return $g(4,2,r,e)},useMemo:function(r,e){var t=As();return e=e===void 0?null:e,r=r(),t.memoizedState=[r,e],r},useReducer:function(r,e,t){var n=As();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:e},n.queue=r,r=r.dispatch=GW.bind(null,Rt,r),[n.memoizedState,r]},useRef:function(r){var e=As();return r={current:r},e.memoizedState=r},useState:EC,useDebugValue:uE,useDeferredValue:function(r){return As().memoizedState=r},useTransition:function(){var r=EC(!1),e=r[0];return r=WW.bind(null,r[1]),As().memoizedState=r,[e,r]},useMutableSource:function(){},useSyncExternalStore:function(r,e,t){var n=Rt,i=As();if(Tt){if(t===void 0)throw Error(ee(407));t=t()}else{if(t=e(),lr===null)throw Error(ee(349));Ll&30||UO(n,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,SC(zO.bind(null,n,s,r),[r]),n.flags|=2048,R1(9,FO.bind(null,n,s,t,e),void 0,null),t},useId:function(){var r=As(),e=lr.identifierPrefix;if(Tt){var t=vo,n=bo;t=(n&~(1<<32-rs(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=M1++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=qW++,e=":"+e+"r"+t.toString(32)+":";return r.memoizedState=e},unstable_isNewReconciler:!1},XW={readContext:Pi,useCallback:QO,useContext:Pi,useEffect:lE,useImperativeHandle:GO,useInsertionEffect:jO,useLayoutEffect:qO,useMemo:YO,useReducer:l8,useRef:HO,useState:function(){return l8(O1)},useDebugValue:uE,useDeferredValue:function(r){var e=Di();return XO(e,Jt.memoizedState,r)},useTransition:function(){var r=l8(O1)[0],e=Di().memoizedState;return[r,e]},useMutableSource:LO,useSyncExternalStore:BO,useId:JO,unstable_isNewReconciler:!1},JW={readContext:Pi,useCallback:QO,useContext:Pi,useEffect:lE,useImperativeHandle:GO,useInsertionEffect:jO,useLayoutEffect:qO,useMemo:YO,useReducer:u8,useRef:HO,useState:function(){return u8(O1)},useDebugValue:uE,useDeferredValue:function(r){var e=Di();return Jt===null?e.memoizedState=r:XO(e,Jt.memoizedState,r)},useTransition:function(){var r=u8(O1)[0],e=Di().memoizedState;return[r,e]},useMutableSource:LO,useSyncExternalStore:BO,useId:JO,unstable_isNewReconciler:!1};function Wi(r,e){if(r&&r.defaultProps){e=Lt({},e),r=r.defaultProps;for(var t in r)e[t]===void 0&&(e[t]=r[t]);return e}return e}function $6(r,e,t,n){e=r.memoizedState,t=t(n,e),t=t==null?e:Lt({},e,t),r.memoizedState=t,r.lanes===0&&(r.updateQueue.baseState=t)}var A3={isMounted:function(r){return(r=r._reactInternals)?uu(r)===r:!1},enqueueSetState:function(r,e,t){r=r._reactInternals;var n=on(),i=rc(r),s=So(n,i);s.payload=e,t!=null&&(s.callback=t),e=ec(r,s,i),e!==null&&(ns(e,r,i,n),Pg(e,r,i))},enqueueReplaceState:function(r,e,t){r=r._reactInternals;var n=on(),i=rc(r),s=So(n,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=ec(r,s,i),e!==null&&(ns(e,r,i,n),Pg(e,r,i))},enqueueForceUpdate:function(r,e){r=r._reactInternals;var t=on(),n=rc(r),i=So(t,n);i.tag=2,e!=null&&(i.callback=e),e=ec(r,i,n),e!==null&&(ns(e,r,n,t),Pg(e,r,n))}};function xC(r,e,t,n,i,s,o){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(n,s,o):e.prototype&&e.prototype.isPureReactComponent?!_1(t,n)||!_1(i,s):!0}function rR(r,e,t){var n=!1,i=fc,s=e.contextType;return typeof s=="object"&&s!==null?s=Pi(s):(i=In(e)?Ol:Yr.current,n=e.contextTypes,s=(n=n!=null)?Mh(r,i):fc),e=new e(t,s),r.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=A3,r.stateNode=e,e._reactInternals=r,n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=i,r.__reactInternalMemoizedMaskedChildContext=s),e}function AC(r,e,t,n){r=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==r&&A3.enqueueReplaceState(e,e.state,null)}function N6(r,e,t,n){var i=r.stateNode;i.props=t,i.state=r.memoizedState,i.refs={},rE(r);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Pi(s):(s=In(e)?Ol:Yr.current,i.context=Mh(r,s)),i.state=r.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&($6(r,e,s,t),i.state=r.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&A3.enqueueReplaceState(i,i.state,null),N2(r,t,i,n),i.state=r.memoizedState),typeof i.componentDidMount=="function"&&(r.flags|=4194308)}function Bh(r,e){try{var t="",n=e;do t+=Iq(n),n=n.return;while(n);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:r,source:e,stack:i,digest:null}}function h8(r,e,t){return{value:r,source:null,stack:t??null,digest:e??null}}function M6(r,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var ZW=typeof WeakMap=="function"?WeakMap:Map;function nR(r,e,t){t=So(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){B2||(B2=!0,H6=n),M6(r,e)},t}function iR(r,e,t){t=So(-1,t),t.tag=3;var n=r.type.getDerivedStateFromError;if(typeof n=="function"){var i=e.value;t.payload=function(){return n(i)},t.callback=function(){M6(r,e)}}var s=r.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){M6(r,e),typeof n!="function"&&(tc===null?tc=new Set([this]):tc.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function CC(r,e,t){var n=r.pingCache;if(n===null){n=r.pingCache=new ZW;var i=new Set;n.set(e,i)}else i=n.get(e),i===void 0&&(i=new Set,n.set(e,i));i.has(t)||(i.add(t),r=fG.bind(null,r,e,t),e.then(r,r))}function IC(r){do{var e;if((e=r.tag===13)&&(e=r.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return r;r=r.return}while(r!==null);return null}function kC(r,e,t,n,i){return r.mode&1?(r.flags|=65536,r.lanes=i,r):(r===e?r.flags|=65536:(r.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=So(-1,1),e.tag=2,ec(t,e,1))),t.lanes|=1),r)}var eG=Ko.ReactCurrentOwner,xn=!1;function en(r,e,t,n){e.child=r===null?NO(e,null,t,n):Rh(e,r.child,t,n)}function _C(r,e,t,n,i){t=t.render;var s=e.ref;return uh(e,i),n=aE(r,e,t,n,s,i),t=cE(),r!==null&&!xn?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~i,$o(r,e,i)):(Tt&&t&&Q9(e),e.flags|=1,en(r,e,n,i),e.child)}function TC(r,e,t,n,i){if(r===null){var s=t.type;return typeof s=="function"&&!wE(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,sR(r,e,s,n,i)):(r=Rg(t.type,null,n,e,e.mode,i),r.ref=e.ref,r.return=e,e.child=r)}if(s=r.child,!(r.lanes&i)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:_1,t(o,n)&&r.ref===e.ref)return $o(r,e,i)}return e.flags|=1,r=nc(s,n),r.ref=e.ref,r.return=e,e.child=r}function sR(r,e,t,n,i){if(r!==null){var s=r.memoizedProps;if(_1(s,n)&&r.ref===e.ref)if(xn=!1,e.pendingProps=n=s,(r.lanes&i)!==0)r.flags&131072&&(xn=!0);else return e.lanes=r.lanes,$o(r,e,i)}return O6(r,e,t,n,i)}function oR(r,e,t){var n=e.pendingProps,i=n.children,s=r!==null?r.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},vt(eh,Vn),Vn|=t;else{if(!(t&1073741824))return r=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:r,cachePool:null,transitions:null},e.updateQueue=null,vt(eh,Vn),Vn|=r,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:t,vt(eh,Vn),Vn|=n}else s!==null?(n=s.baseLanes|t,e.memoizedState=null):n=t,vt(eh,Vn),Vn|=n;return en(r,e,i,t),e.child}function aR(r,e){var t=e.ref;(r===null&&t!==null||r!==null&&r.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function O6(r,e,t,n,i){var s=In(t)?Ol:Yr.current;return s=Mh(e,s),uh(e,i),t=aE(r,e,t,n,s,i),n=cE(),r!==null&&!xn?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~i,$o(r,e,i)):(Tt&&n&&Q9(e),e.flags|=1,en(r,e,t,i),e.child)}function PC(r,e,t,n,i){if(In(t)){var s=!0;_2(e)}else s=!1;if(uh(e,i),e.stateNode===null)Ng(r,e),rR(e,t,n),N6(e,t,n,i),n=!0;else if(r===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=t.contextType;typeof l=="object"&&l!==null?l=Pi(l):(l=In(t)?Ol:Yr.current,l=Mh(e,l));var h=t.getDerivedStateFromProps,d=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==n||c!==l)&&AC(e,o,n,l),Sa=!1;var p=e.memoizedState;o.state=p,N2(e,n,o,i),c=e.memoizedState,a!==n||p!==c||Cn.current||Sa?(typeof h=="function"&&($6(e,t,h,n),c=e.memoizedState),(a=Sa||xC(e,t,a,n,p,c,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=c),o.props=n,o.state=c,o.context=l,n=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,OO(r,e),a=e.memoizedProps,l=e.type===e.elementType?a:Wi(e.type,a),o.props=l,d=e.pendingProps,p=o.context,c=t.contextType,typeof c=="object"&&c!==null?c=Pi(c):(c=In(t)?Ol:Yr.current,c=Mh(e,c));var m=t.getDerivedStateFromProps;(h=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||p!==c)&&AC(e,o,n,c),Sa=!1,p=e.memoizedState,o.state=p,N2(e,n,o,i);var f=e.memoizedState;a!==d||p!==f||Cn.current||Sa?(typeof m=="function"&&($6(e,t,m,n),f=e.memoizedState),(l=Sa||xC(e,t,l,n,p,f,c)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,f,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,f,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=f),o.props=n,o.state=f,o.context=c,n=l):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&p===r.memoizedState||(e.flags|=1024),n=!1)}return R6(r,e,t,n,s,i)}function R6(r,e,t,n,i,s){aR(r,e);var o=(e.flags&128)!==0;if(!n&&!o)return i&&gC(e,t,!1),$o(r,e,s);n=e.stateNode,eG.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,r!==null&&o?(e.child=Rh(e,r.child,null,s),e.child=Rh(e,null,a,s)):en(r,e,a,s),e.memoizedState=n.state,i&&gC(e,t,!0),e.child}function cR(r){var e=r.stateNode;e.pendingContext?pC(r,e.pendingContext,e.pendingContext!==e.context):e.context&&pC(r,e.context,!1),nE(r,e.containerInfo)}function DC(r,e,t,n,i){return Oh(),X9(i),e.flags|=256,en(r,e,t,n),e.child}var L6={dehydrated:null,treeContext:null,retryLane:0};function B6(r){return{baseLanes:r,cachePool:null,transitions:null}}function lR(r,e,t){var n=e.pendingProps,i=Mt.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=r!==null&&r.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(r===null||r.memoizedState!==null)&&(i|=1),vt(Mt,i&1),r===null)return P6(e),r=e.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(e.mode&1?r.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,r=n.fallback,s?(n=e.mode,s=e.child,o={mode:"hidden",children:o},!(n&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=k3(o,n,0,null),r=xl(r,n,t,null),s.return=e,r.return=e,s.sibling=r,e.child=s,e.child.memoizedState=B6(t),e.memoizedState=L6,r):hE(e,o));if(i=r.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return tG(r,e,o,n,a,i,t);if(s){s=n.fallback,o=e.mode,i=r.child,a=i.sibling;var c={mode:"hidden",children:n.children};return!(o&1)&&e.child!==i?(n=e.child,n.childLanes=0,n.pendingProps=c,e.deletions=null):(n=nc(i,c),n.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=nc(a,s):(s=xl(s,o,t,null),s.flags|=2),s.return=e,n.return=e,n.sibling=s,e.child=n,n=s,s=e.child,o=r.child.memoizedState,o=o===null?B6(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=r.childLanes&~t,e.memoizedState=L6,n}return s=r.child,r=s.sibling,n=nc(s,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,r!==null&&(t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)),e.child=n,e.memoizedState=null,n}function hE(r,e){return e=k3({mode:"visible",children:e},r.mode,0,null),e.return=r,r.child=e}function _0(r,e,t,n){return n!==null&&X9(n),Rh(e,r.child,null,t),r=hE(e,e.pendingProps.children),r.flags|=2,e.memoizedState=null,r}function tG(r,e,t,n,i,s,o){if(t)return e.flags&256?(e.flags&=-257,n=h8(Error(ee(422))),_0(r,e,o,n)):e.memoizedState!==null?(e.child=r.child,e.flags|=128,null):(s=n.fallback,i=e.mode,n=k3({mode:"visible",children:n.children},i,0,null),s=xl(s,i,o,null),s.flags|=2,n.return=e,s.return=e,n.sibling=s,e.child=n,e.mode&1&&Rh(e,r.child,null,o),e.child.memoizedState=B6(o),e.memoizedState=L6,s);if(!(e.mode&1))return _0(r,e,o,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var a=n.dgst;return n=a,s=Error(ee(419)),n=h8(s,n,void 0),_0(r,e,o,n)}if(a=(o&r.childLanes)!==0,xn||a){if(n=lr,n!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Do(r,i),ns(n,r,i,-1))}return mE(),n=h8(Error(ee(421))),_0(r,e,o,n)}return i.data==="$?"?(e.flags|=128,e.child=r.child,e=pG.bind(null,r),i._reactRetry=e,null):(r=s.treeContext,Gn=Za(i.nextSibling),Qn=e,Tt=!0,Xi=null,r!==null&&(mi[wi++]=bo,mi[wi++]=vo,mi[wi++]=Rl,bo=r.id,vo=r.overflow,Rl=e),e=hE(e,n.children),e.flags|=4096,e)}function $C(r,e,t){r.lanes|=e;var n=r.alternate;n!==null&&(n.lanes|=e),D6(r.return,e,t)}function d8(r,e,t,n,i){var s=r.memoizedState;s===null?r.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=t,s.tailMode=i)}function uR(r,e,t){var n=e.pendingProps,i=n.revealOrder,s=n.tail;if(en(r,e,n.children,t),n=Mt.current,n&2)n=n&1|2,e.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=e.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&$C(r,t,e);else if(r.tag===19)$C(r,t,e);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}n&=1}if(vt(Mt,n),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)r=t.alternate,r!==null&&M2(r)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),d8(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(r=i.alternate,r!==null&&M2(r)===null){e.child=i;break}r=i.sibling,i.sibling=t,t=i,i=r}d8(e,!0,t,null,s);break;case"together":d8(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ng(r,e){!(e.mode&1)&&r!==null&&(r.alternate=null,e.alternate=null,e.flags|=2)}function $o(r,e,t){if(r!==null&&(e.dependencies=r.dependencies),Bl|=e.lanes,!(t&e.childLanes))return null;if(r!==null&&e.child!==r.child)throw Error(ee(153));if(e.child!==null){for(r=e.child,t=nc(r,r.pendingProps),e.child=t,t.return=e;r.sibling!==null;)r=r.sibling,t=t.sibling=nc(r,r.pendingProps),t.return=e;t.sibling=null}return e.child}function rG(r,e,t){switch(e.tag){case 3:cR(e),Oh();break;case 5:RO(e);break;case 1:In(e.type)&&_2(e);break;case 4:nE(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,i=e.memoizedProps.value;vt(D2,n._currentValue),n._currentValue=i;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(vt(Mt,Mt.current&1),e.flags|=128,null):t&e.child.childLanes?lR(r,e,t):(vt(Mt,Mt.current&1),r=$o(r,e,t),r!==null?r.sibling:null);vt(Mt,Mt.current&1);break;case 19:if(n=(t&e.childLanes)!==0,r.flags&128){if(n)return uR(r,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),vt(Mt,Mt.current),n)break;return null;case 22:case 23:return e.lanes=0,oR(r,e,t)}return $o(r,e,t)}var hR,U6,dR,fR;hR=function(r,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)r.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};U6=function(){};dR=function(r,e,t,n){var i=r.memoizedProps;if(i!==n){r=e.stateNode,dl(Ms.current);var s=null;switch(t){case"input":i=a6(r,i),n=a6(r,n),s=[];break;case"select":i=Lt({},i,{value:void 0}),n=Lt({},n,{value:void 0}),s=[];break;case"textarea":i=u6(r,i),n=u6(r,n),s=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(r.onclick=I2)}d6(t,n);var o;t=null;for(l in i)if(!n.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var a=i[l];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(E1.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in n){var c=n[l];if(a=i!=null?i[l]:void 0,n.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(s||(s=[]),s.push(l,t)),t=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(E1.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&xt("scroll",r),s||a===c||(s=[])):(s=s||[]).push(l,c))}t&&(s=s||[]).push("style",t);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};fR=function(r,e,t,n){t!==n&&(e.flags|=4)};function nf(r,e){if(!Tt)switch(r.tailMode){case"hidden":e=r.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?r.tail=null:t.sibling=null;break;case"collapsed":t=r.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||r.tail===null?r.tail=null:r.tail.sibling=null:n.sibling=null}}function _r(r){var e=r.alternate!==null&&r.alternate.child===r.child,t=0,n=0;if(e)for(var i=r.child;i!==null;)t|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=r,i=i.sibling;else for(i=r.child;i!==null;)t|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=r,i=i.sibling;return r.subtreeFlags|=n,r.childLanes=t,e}function nG(r,e,t){var n=e.pendingProps;switch(Y9(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _r(e),null;case 1:return In(e.type)&&k2(),_r(e),null;case 3:return n=e.stateNode,Lh(),At(Cn),At(Yr),sE(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(r===null||r.child===null)&&(I0(e)?e.flags|=4:r===null||r.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Xi!==null&&(W6(Xi),Xi=null))),U6(r,e),_r(e),null;case 5:iE(e);var i=dl(N1.current);if(t=e.type,r!==null&&e.stateNode!=null)dR(r,e,t,n,i),r.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(ee(166));return _r(e),null}if(r=dl(Ms.current),I0(e)){n=e.stateNode,t=e.type;var s=e.memoizedProps;switch(n[Ps]=e,n[D1]=s,r=(e.mode&1)!==0,t){case"dialog":xt("cancel",n),xt("close",n);break;case"iframe":case"object":case"embed":xt("load",n);break;case"video":case"audio":for(i=0;i<Uf.length;i++)xt(Uf[i],n);break;case"source":xt("error",n);break;case"img":case"image":case"link":xt("error",n),xt("load",n);break;case"details":xt("toggle",n);break;case"input":zA(n,s),xt("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},xt("invalid",n);break;case"textarea":KA(n,s),xt("invalid",n)}d6(t,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?n.textContent!==a&&(s.suppressHydrationWarning!==!0&&C0(n.textContent,a,r),i=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&C0(n.textContent,a,r),i=["children",""+a]):E1.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&xt("scroll",n)}switch(t){case"input":m0(n),VA(n,s,!0);break;case"textarea":m0(n),HA(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=I2)}n=i,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=zM(t)),r==="http://www.w3.org/1999/xhtml"?t==="script"?(r=o.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof n.is=="string"?r=o.createElement(t,{is:n.is}):(r=o.createElement(t),t==="select"&&(o=r,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):r=o.createElementNS(r,t),r[Ps]=e,r[D1]=n,hR(r,e,!1,!1),e.stateNode=r;e:{switch(o=f6(t,n),t){case"dialog":xt("cancel",r),xt("close",r),i=n;break;case"iframe":case"object":case"embed":xt("load",r),i=n;break;case"video":case"audio":for(i=0;i<Uf.length;i++)xt(Uf[i],r);i=n;break;case"source":xt("error",r),i=n;break;case"img":case"image":case"link":xt("error",r),xt("load",r),i=n;break;case"details":xt("toggle",r),i=n;break;case"input":zA(r,n),i=a6(r,n),xt("invalid",r);break;case"option":i=n;break;case"select":r._wrapperState={wasMultiple:!!n.multiple},i=Lt({},n,{value:void 0}),xt("invalid",r);break;case"textarea":KA(r,n),i=u6(r,n),xt("invalid",r);break;default:i=n}d6(t,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?HM(r,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&VM(r,c)):s==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&S1(r,c):typeof c=="number"&&S1(r,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(E1.hasOwnProperty(s)?c!=null&&s==="onScroll"&&xt("scroll",r):c!=null&&O9(r,s,c,o))}switch(t){case"input":m0(r),VA(r,n,!1);break;case"textarea":m0(r),HA(r);break;case"option":n.value!=null&&r.setAttribute("value",""+dc(n.value));break;case"select":r.multiple=!!n.multiple,s=n.value,s!=null?oh(r,!!n.multiple,s,!1):n.defaultValue!=null&&oh(r,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(r.onclick=I2)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return _r(e),null;case 6:if(r&&e.stateNode!=null)fR(r,e,r.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(ee(166));if(t=dl(N1.current),dl(Ms.current),I0(e)){if(n=e.stateNode,t=e.memoizedProps,n[Ps]=e,(s=n.nodeValue!==t)&&(r=Qn,r!==null))switch(r.tag){case 3:C0(n.nodeValue,t,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&C0(n.nodeValue,t,(r.mode&1)!==0)}s&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[Ps]=e,e.stateNode=n}return _r(e),null;case 13:if(At(Mt),n=e.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(Tt&&Gn!==null&&e.mode&1&&!(e.flags&128))DO(),Oh(),e.flags|=98560,s=!1;else if(s=I0(e),n!==null&&n.dehydrated!==null){if(r===null){if(!s)throw Error(ee(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ee(317));s[Ps]=e}else Oh(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;_r(e),s=!1}else Xi!==null&&(W6(Xi),Xi=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(r!==null&&r.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(r===null||Mt.current&1?Zt===0&&(Zt=3):mE())),e.updateQueue!==null&&(e.flags|=4),_r(e),null);case 4:return Lh(),U6(r,e),r===null&&T1(e.stateNode.containerInfo),_r(e),null;case 10:return eE(e.type._context),_r(e),null;case 17:return In(e.type)&&k2(),_r(e),null;case 19:if(At(Mt),s=e.memoizedState,s===null)return _r(e),null;if(n=(e.flags&128)!==0,o=s.rendering,o===null)if(n)nf(s,!1);else{if(Zt!==0||r!==null&&r.flags&128)for(r=e.child;r!==null;){if(o=M2(r),o!==null){for(e.flags|=128,nf(s,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)s=t,r=n,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=r,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,r=o.dependencies,s.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t=t.sibling;return vt(Mt,Mt.current&1|2),e.child}r=r.sibling}s.tail!==null&&Kt()>Uh&&(e.flags|=128,n=!0,nf(s,!1),e.lanes=4194304)}else{if(!n)if(r=M2(o),r!==null){if(e.flags|=128,n=!0,t=r.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),nf(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Tt)return _r(e),null}else 2*Kt()-s.renderingStartTime>Uh&&t!==1073741824&&(e.flags|=128,n=!0,nf(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Kt(),e.sibling=null,t=Mt.current,vt(Mt,n?t&1|2:t&1),e):(_r(e),null);case 22:case 23:return yE(),n=e.memoizedState!==null,r!==null&&r.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Vn&1073741824&&(_r(e),e.subtreeFlags&6&&(e.flags|=8192)):_r(e),null;case 24:return null;case 25:return null}throw Error(ee(156,e.tag))}function iG(r,e){switch(Y9(e),e.tag){case 1:return In(e.type)&&k2(),r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 3:return Lh(),At(Cn),At(Yr),sE(),r=e.flags,r&65536&&!(r&128)?(e.flags=r&-65537|128,e):null;case 5:return iE(e),null;case 13:if(At(Mt),r=e.memoizedState,r!==null&&r.dehydrated!==null){if(e.alternate===null)throw Error(ee(340));Oh()}return r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 19:return At(Mt),null;case 4:return Lh(),null;case 10:return eE(e.type._context),null;case 22:case 23:return yE(),null;case 24:return null;default:return null}}var T0=!1,qr=!1,sG=typeof WeakSet=="function"?WeakSet:Set,be=null;function Zu(r,e){var t=r.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){Ft(r,e,n)}else t.current=null}function F6(r,e,t){try{t()}catch(n){Ft(r,e,n)}}var NC=!1;function oG(r,e){if(x6=x2,r=wO(),G9(r)){if("selectionStart"in r)var t={start:r.selectionStart,end:r.selectionEnd};else e:{t=(t=r.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var i=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,c=-1,l=0,h=0,d=r,p=null;t:for(;;){for(var m;d!==t||i!==0&&d.nodeType!==3||(a=o+i),d!==s||n!==0&&d.nodeType!==3||(c=o+n),d.nodeType===3&&(o+=d.nodeValue.length),(m=d.firstChild)!==null;)p=d,d=m;for(;;){if(d===r)break t;if(p===t&&++l===i&&(a=o),p===s&&++h===n&&(c=o),(m=d.nextSibling)!==null)break;d=p,p=d.parentNode}d=m}t=a===-1||c===-1?null:{start:a,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(A6={focusedElem:r,selectionRange:t},x2=!1,be=e;be!==null;)if(e=be,r=e.child,(e.subtreeFlags&1028)!==0&&r!==null)r.return=e,be=r;else for(;be!==null;){e=be;try{var f=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var g=f.memoizedProps,v=f.memoizedState,y=e.stateNode,w=y.getSnapshotBeforeUpdate(e.elementType===e.type?g:Wi(e.type,g),v);y.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ee(163))}}catch(E){Ft(e,e.return,E)}if(r=e.sibling,r!==null){r.return=e.return,be=r;break}be=e.return}return f=NC,NC=!1,f}function r1(r,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&r)===r){var s=i.destroy;i.destroy=void 0,s!==void 0&&F6(e,t,s)}i=i.next}while(i!==n)}}function C3(r,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&r)===r){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function z6(r){var e=r.ref;if(e!==null){var t=r.stateNode;switch(r.tag){case 5:r=t;break;default:r=t}typeof e=="function"?e(r):e.current=r}}function pR(r){var e=r.alternate;e!==null&&(r.alternate=null,pR(e)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(e=r.stateNode,e!==null&&(delete e[Ps],delete e[D1],delete e[k6],delete e[VW],delete e[KW])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function gR(r){return r.tag===5||r.tag===3||r.tag===4}function MC(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||gR(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function V6(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(r,e):t.insertBefore(r,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(r,t)):(e=t,e.appendChild(r)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=I2));else if(n!==4&&(r=r.child,r!==null))for(V6(r,e,t),r=r.sibling;r!==null;)V6(r,e,t),r=r.sibling}function K6(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.insertBefore(r,e):t.appendChild(r);else if(n!==4&&(r=r.child,r!==null))for(K6(r,e,t),r=r.sibling;r!==null;)K6(r,e,t),r=r.sibling}var pr=null,Gi=!1;function oa(r,e,t){for(t=t.child;t!==null;)yR(r,e,t),t=t.sibling}function yR(r,e,t){if(Ns&&typeof Ns.onCommitFiberUnmount=="function")try{Ns.onCommitFiberUnmount(m3,t)}catch{}switch(t.tag){case 5:qr||Zu(t,e);case 6:var n=pr,i=Gi;pr=null,oa(r,e,t),pr=n,Gi=i,pr!==null&&(Gi?(r=pr,t=t.stateNode,r.nodeType===8?r.parentNode.removeChild(t):r.removeChild(t)):pr.removeChild(t.stateNode));break;case 18:pr!==null&&(Gi?(r=pr,t=t.stateNode,r.nodeType===8?s8(r.parentNode,t):r.nodeType===1&&s8(r,t),I1(r)):s8(pr,t.stateNode));break;case 4:n=pr,i=Gi,pr=t.stateNode.containerInfo,Gi=!0,oa(r,e,t),pr=n,Gi=i;break;case 0:case 11:case 14:case 15:if(!qr&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&F6(t,e,o),i=i.next}while(i!==n)}oa(r,e,t);break;case 1:if(!qr&&(Zu(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(a){Ft(t,e,a)}oa(r,e,t);break;case 21:oa(r,e,t);break;case 22:t.mode&1?(qr=(n=qr)||t.memoizedState!==null,oa(r,e,t),qr=n):oa(r,e,t);break;default:oa(r,e,t)}}function OC(r){var e=r.updateQueue;if(e!==null){r.updateQueue=null;var t=r.stateNode;t===null&&(t=r.stateNode=new sG),e.forEach(function(n){var i=gG.bind(null,r,n);t.has(n)||(t.add(n),n.then(i,i))})}}function Ui(r,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var i=t[n];try{var s=r,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:pr=a.stateNode,Gi=!1;break e;case 3:pr=a.stateNode.containerInfo,Gi=!0;break e;case 4:pr=a.stateNode.containerInfo,Gi=!0;break e}a=a.return}if(pr===null)throw Error(ee(160));yR(s,o,i),pr=null,Gi=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(l){Ft(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)mR(e,r),e=e.sibling}function mR(r,e){var t=r.alternate,n=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Ui(e,r),ys(r),n&4){try{r1(3,r,r.return),C3(3,r)}catch(g){Ft(r,r.return,g)}try{r1(5,r,r.return)}catch(g){Ft(r,r.return,g)}}break;case 1:Ui(e,r),ys(r),n&512&&t!==null&&Zu(t,t.return);break;case 5:if(Ui(e,r),ys(r),n&512&&t!==null&&Zu(t,t.return),r.flags&32){var i=r.stateNode;try{S1(i,"")}catch(g){Ft(r,r.return,g)}}if(n&4&&(i=r.stateNode,i!=null)){var s=r.memoizedProps,o=t!==null?t.memoizedProps:s,a=r.type,c=r.updateQueue;if(r.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&UM(i,s),f6(a,o);var l=f6(a,s);for(o=0;o<c.length;o+=2){var h=c[o],d=c[o+1];h==="style"?HM(i,d):h==="dangerouslySetInnerHTML"?VM(i,d):h==="children"?S1(i,d):O9(i,h,d,l)}switch(a){case"input":c6(i,s);break;case"textarea":FM(i,s);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?oh(i,!!s.multiple,m,!1):p!==!!s.multiple&&(s.defaultValue!=null?oh(i,!!s.multiple,s.defaultValue,!0):oh(i,!!s.multiple,s.multiple?[]:"",!1))}i[D1]=s}catch(g){Ft(r,r.return,g)}}break;case 6:if(Ui(e,r),ys(r),n&4){if(r.stateNode===null)throw Error(ee(162));i=r.stateNode,s=r.memoizedProps;try{i.nodeValue=s}catch(g){Ft(r,r.return,g)}}break;case 3:if(Ui(e,r),ys(r),n&4&&t!==null&&t.memoizedState.isDehydrated)try{I1(e.containerInfo)}catch(g){Ft(r,r.return,g)}break;case 4:Ui(e,r),ys(r);break;case 13:Ui(e,r),ys(r),i=r.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(pE=Kt())),n&4&&OC(r);break;case 22:if(h=t!==null&&t.memoizedState!==null,r.mode&1?(qr=(l=qr)||h,Ui(e,r),qr=l):Ui(e,r),ys(r),n&8192){if(l=r.memoizedState!==null,(r.stateNode.isHidden=l)&&!h&&r.mode&1)for(be=r,h=r.child;h!==null;){for(d=be=h;be!==null;){switch(p=be,m=p.child,p.tag){case 0:case 11:case 14:case 15:r1(4,p,p.return);break;case 1:Zu(p,p.return);var f=p.stateNode;if(typeof f.componentWillUnmount=="function"){n=p,t=p.return;try{e=n,f.props=e.memoizedProps,f.state=e.memoizedState,f.componentWillUnmount()}catch(g){Ft(n,t,g)}}break;case 5:Zu(p,p.return);break;case 22:if(p.memoizedState!==null){LC(d);continue}}m!==null?(m.return=p,be=m):LC(d)}h=h.sibling}e:for(h=null,d=r;;){if(d.tag===5){if(h===null){h=d;try{i=d.stateNode,l?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,c=d.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=KM("display",o))}catch(g){Ft(r,r.return,g)}}}else if(d.tag===6){if(h===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(g){Ft(r,r.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===r)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===r)break e;for(;d.sibling===null;){if(d.return===null||d.return===r)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Ui(e,r),ys(r),n&4&&OC(r);break;case 21:break;default:Ui(e,r),ys(r)}}function ys(r){var e=r.flags;if(e&2){try{e:{for(var t=r.return;t!==null;){if(gR(t)){var n=t;break e}t=t.return}throw Error(ee(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(S1(i,""),n.flags&=-33);var s=MC(r);K6(r,s,i);break;case 3:case 4:var o=n.stateNode.containerInfo,a=MC(r);V6(r,a,o);break;default:throw Error(ee(161))}}catch(c){Ft(r,r.return,c)}r.flags&=-3}e&4096&&(r.flags&=-4097)}function aG(r,e,t){be=r,wR(r)}function wR(r,e,t){for(var n=(r.mode&1)!==0;be!==null;){var i=be,s=i.child;if(i.tag===22&&n){var o=i.memoizedState!==null||T0;if(!o){var a=i.alternate,c=a!==null&&a.memoizedState!==null||qr;a=T0;var l=qr;if(T0=o,(qr=c)&&!l)for(be=i;be!==null;)o=be,c=o.child,o.tag===22&&o.memoizedState!==null?BC(i):c!==null?(c.return=o,be=c):BC(i);for(;s!==null;)be=s,wR(s),s=s.sibling;be=i,T0=a,qr=l}RC(r)}else i.subtreeFlags&8772&&s!==null?(s.return=i,be=s):RC(r)}}function RC(r){for(;be!==null;){var e=be;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:qr||C3(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!qr)if(t===null)n.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Wi(e.type,t.memoizedProps);n.componentDidUpdate(i,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&vC(e,s,n);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}vC(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var h=l.memoizedState;if(h!==null){var d=h.dehydrated;d!==null&&I1(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ee(163))}qr||e.flags&512&&z6(e)}catch(p){Ft(e,e.return,p)}}if(e===r){be=null;break}if(t=e.sibling,t!==null){t.return=e.return,be=t;break}be=e.return}}function LC(r){for(;be!==null;){var e=be;if(e===r){be=null;break}var t=e.sibling;if(t!==null){t.return=e.return,be=t;break}be=e.return}}function BC(r){for(;be!==null;){var e=be;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{C3(4,e)}catch(c){Ft(e,t,c)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var i=e.return;try{n.componentDidMount()}catch(c){Ft(e,i,c)}}var s=e.return;try{z6(e)}catch(c){Ft(e,s,c)}break;case 5:var o=e.return;try{z6(e)}catch(c){Ft(e,o,c)}}}catch(c){Ft(e,e.return,c)}if(e===r){be=null;break}var a=e.sibling;if(a!==null){a.return=e.return,be=a;break}be=e.return}}var cG=Math.ceil,L2=Ko.ReactCurrentDispatcher,dE=Ko.ReactCurrentOwner,ki=Ko.ReactCurrentBatchConfig,Je=0,lr=null,Gt=null,wr=0,Vn=0,eh=Pc(0),Zt=0,L1=null,Bl=0,I3=0,fE=0,n1=null,En=null,pE=0,Uh=1/0,so=null,B2=!1,H6=null,tc=null,P0=!1,Ka=null,U2=0,i1=0,j6=null,Mg=-1,Og=0;function on(){return Je&6?Kt():Mg!==-1?Mg:Mg=Kt()}function rc(r){return r.mode&1?Je&2&&wr!==0?wr&-wr:jW.transition!==null?(Og===0&&(Og=rO()),Og):(r=lt,r!==0||(r=window.event,r=r===void 0?16:lO(r.type)),r):1}function ns(r,e,t,n){if(50<i1)throw i1=0,j6=null,Error(ee(185));Ip(r,t,n),(!(Je&2)||r!==lr)&&(r===lr&&(!(Je&2)&&(I3|=t),Zt===4&&Ra(r,wr)),kn(r,n),t===1&&Je===0&&!(e.mode&1)&&(Uh=Kt()+500,S3&&Dc()))}function kn(r,e){var t=r.callbackNode;jq(r,e);var n=S2(r,r===lr?wr:0);if(n===0)t!==null&&WA(t),r.callbackNode=null,r.callbackPriority=0;else if(e=n&-n,r.callbackPriority!==e){if(t!=null&&WA(t),e===1)r.tag===0?HW(UC.bind(null,r)):_O(UC.bind(null,r)),FW(function(){!(Je&6)&&Dc()}),t=null;else{switch(nO(n)){case 1:t=F9;break;case 4:t=eO;break;case 16:t=E2;break;case 536870912:t=tO;break;default:t=E2}t=IR(t,bR.bind(null,r))}r.callbackPriority=e,r.callbackNode=t}}function bR(r,e){if(Mg=-1,Og=0,Je&6)throw Error(ee(327));var t=r.callbackNode;if(hh()&&r.callbackNode!==t)return null;var n=S2(r,r===lr?wr:0);if(n===0)return null;if(n&30||n&r.expiredLanes||e)e=F2(r,n);else{e=n;var i=Je;Je|=2;var s=ER();(lr!==r||wr!==e)&&(so=null,Uh=Kt()+500,Sl(r,e));do try{hG();break}catch(a){vR(r,a)}while(!0);Z9(),L2.current=s,Je=i,Gt!==null?e=0:(lr=null,wr=0,e=Zt)}if(e!==0){if(e===2&&(i=w6(r),i!==0&&(n=i,e=q6(r,i))),e===1)throw t=L1,Sl(r,0),Ra(r,n),kn(r,Kt()),t;if(e===6)Ra(r,n);else{if(i=r.current.alternate,!(n&30)&&!lG(i)&&(e=F2(r,n),e===2&&(s=w6(r),s!==0&&(n=s,e=q6(r,s))),e===1))throw t=L1,Sl(r,0),Ra(r,n),kn(r,Kt()),t;switch(r.finishedWork=i,r.finishedLanes=n,e){case 0:case 1:throw Error(ee(345));case 2:tl(r,En,so);break;case 3:if(Ra(r,n),(n&130023424)===n&&(e=pE+500-Kt(),10<e)){if(S2(r,0)!==0)break;if(i=r.suspendedLanes,(i&n)!==n){on(),r.pingedLanes|=r.suspendedLanes&i;break}r.timeoutHandle=I6(tl.bind(null,r,En,so),e);break}tl(r,En,so);break;case 4:if(Ra(r,n),(n&4194240)===n)break;for(e=r.eventTimes,i=-1;0<n;){var o=31-rs(n);s=1<<o,o=e[o],o>i&&(i=o),n&=~s}if(n=i,n=Kt()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*cG(n/1960))-n,10<n){r.timeoutHandle=I6(tl.bind(null,r,En,so),n);break}tl(r,En,so);break;case 5:tl(r,En,so);break;default:throw Error(ee(329))}}}return kn(r,Kt()),r.callbackNode===t?bR.bind(null,r):null}function q6(r,e){var t=n1;return r.current.memoizedState.isDehydrated&&(Sl(r,e).flags|=256),r=F2(r,e),r!==2&&(e=En,En=t,e!==null&&W6(e)),r}function W6(r){En===null?En=r:En.push.apply(En,r)}function lG(r){for(var e=r;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var i=t[n],s=i.getSnapshot;i=i.value;try{if(!cs(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ra(r,e){for(e&=~fE,e&=~I3,r.suspendedLanes|=e,r.pingedLanes&=~e,r=r.expirationTimes;0<e;){var t=31-rs(e),n=1<<t;r[t]=-1,e&=~n}}function UC(r){if(Je&6)throw Error(ee(327));hh();var e=S2(r,0);if(!(e&1))return kn(r,Kt()),null;var t=F2(r,e);if(r.tag!==0&&t===2){var n=w6(r);n!==0&&(e=n,t=q6(r,n))}if(t===1)throw t=L1,Sl(r,0),Ra(r,e),kn(r,Kt()),t;if(t===6)throw Error(ee(345));return r.finishedWork=r.current.alternate,r.finishedLanes=e,tl(r,En,so),kn(r,Kt()),null}function gE(r,e){var t=Je;Je|=1;try{return r(e)}finally{Je=t,Je===0&&(Uh=Kt()+500,S3&&Dc())}}function Ul(r){Ka!==null&&Ka.tag===0&&!(Je&6)&&hh();var e=Je;Je|=1;var t=ki.transition,n=lt;try{if(ki.transition=null,lt=1,r)return r()}finally{lt=n,ki.transition=t,Je=e,!(Je&6)&&Dc()}}function yE(){Vn=eh.current,At(eh)}function Sl(r,e){r.finishedWork=null,r.finishedLanes=0;var t=r.timeoutHandle;if(t!==-1&&(r.timeoutHandle=-1,UW(t)),Gt!==null)for(t=Gt.return;t!==null;){var n=t;switch(Y9(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&k2();break;case 3:Lh(),At(Cn),At(Yr),sE();break;case 5:iE(n);break;case 4:Lh();break;case 13:At(Mt);break;case 19:At(Mt);break;case 10:eE(n.type._context);break;case 22:case 23:yE()}t=t.return}if(lr=r,Gt=r=nc(r.current,null),wr=Vn=e,Zt=0,L1=null,fE=I3=Bl=0,En=n1=null,hl!==null){for(e=0;e<hl.length;e++)if(t=hl[e],n=t.interleaved,n!==null){t.interleaved=null;var i=n.next,s=t.pending;if(s!==null){var o=s.next;s.next=i,n.next=o}t.pending=n}hl=null}return r}function vR(r,e){do{var t=Gt;try{if(Z9(),Dg.current=R2,O2){for(var n=Rt.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}O2=!1}if(Ll=0,ar=Jt=Rt=null,t1=!1,M1=0,dE.current=null,t===null||t.return===null){Zt=1,L1=e,Gt=null;break}e:{var s=r,o=t.return,a=t,c=e;if(e=wr,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,h=a,d=h.tag;if(!(h.mode&1)&&(d===0||d===11||d===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var m=IC(o);if(m!==null){m.flags&=-257,kC(m,o,a,s,e),m.mode&1&&CC(s,l,e),e=m,c=l;var f=e.updateQueue;if(f===null){var g=new Set;g.add(c),e.updateQueue=g}else f.add(c);break e}else{if(!(e&1)){CC(s,l,e),mE();break e}c=Error(ee(426))}}else if(Tt&&a.mode&1){var v=IC(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),kC(v,o,a,s,e),X9(Bh(c,a));break e}}s=c=Bh(c,a),Zt!==4&&(Zt=2),n1===null?n1=[s]:n1.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var y=nR(s,c,e);bC(s,y);break e;case 1:a=c;var w=s.type,b=s.stateNode;if(!(s.flags&128)&&(typeof w.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(tc===null||!tc.has(b)))){s.flags|=65536,e&=-e,s.lanes|=e;var E=iR(s,a,e);bC(s,E);break e}}s=s.return}while(s!==null)}xR(t)}catch(C){e=C,Gt===t&&t!==null&&(Gt=t=t.return);continue}break}while(!0)}function ER(){var r=L2.current;return L2.current=R2,r===null?R2:r}function mE(){(Zt===0||Zt===3||Zt===2)&&(Zt=4),lr===null||!(Bl&268435455)&&!(I3&268435455)||Ra(lr,wr)}function F2(r,e){var t=Je;Je|=2;var n=ER();(lr!==r||wr!==e)&&(so=null,Sl(r,e));do try{uG();break}catch(i){vR(r,i)}while(!0);if(Z9(),Je=t,L2.current=n,Gt!==null)throw Error(ee(261));return lr=null,wr=0,Zt}function uG(){for(;Gt!==null;)SR(Gt)}function hG(){for(;Gt!==null&&!Rq();)SR(Gt)}function SR(r){var e=CR(r.alternate,r,Vn);r.memoizedProps=r.pendingProps,e===null?xR(r):Gt=e,dE.current=null}function xR(r){var e=r;do{var t=e.alternate;if(r=e.return,e.flags&32768){if(t=iG(t,e),t!==null){t.flags&=32767,Gt=t;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{Zt=6,Gt=null;return}}else if(t=nG(t,e,Vn),t!==null){Gt=t;return}if(e=e.sibling,e!==null){Gt=e;return}Gt=e=r}while(e!==null);Zt===0&&(Zt=5)}function tl(r,e,t){var n=lt,i=ki.transition;try{ki.transition=null,lt=1,dG(r,e,t,n)}finally{ki.transition=i,lt=n}return null}function dG(r,e,t,n){do hh();while(Ka!==null);if(Je&6)throw Error(ee(327));t=r.finishedWork;var i=r.finishedLanes;if(t===null)return null;if(r.finishedWork=null,r.finishedLanes=0,t===r.current)throw Error(ee(177));r.callbackNode=null,r.callbackPriority=0;var s=t.lanes|t.childLanes;if(qq(r,s),r===lr&&(Gt=lr=null,wr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||P0||(P0=!0,IR(E2,function(){return hh(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=ki.transition,ki.transition=null;var o=lt;lt=1;var a=Je;Je|=4,dE.current=null,oG(r,t),mR(t,r),$W(A6),x2=!!x6,A6=x6=null,r.current=t,aG(t),Lq(),Je=a,lt=o,ki.transition=s}else r.current=t;if(P0&&(P0=!1,Ka=r,U2=i),s=r.pendingLanes,s===0&&(tc=null),Fq(t.stateNode),kn(r,Kt()),e!==null)for(n=r.onRecoverableError,t=0;t<e.length;t++)i=e[t],n(i.value,{componentStack:i.stack,digest:i.digest});if(B2)throw B2=!1,r=H6,H6=null,r;return U2&1&&r.tag!==0&&hh(),s=r.pendingLanes,s&1?r===j6?i1++:(i1=0,j6=r):i1=0,Dc(),null}function hh(){if(Ka!==null){var r=nO(U2),e=ki.transition,t=lt;try{if(ki.transition=null,lt=16>r?16:r,Ka===null)var n=!1;else{if(r=Ka,Ka=null,U2=0,Je&6)throw Error(ee(331));var i=Je;for(Je|=4,be=r.current;be!==null;){var s=be,o=s.child;if(be.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(be=l;be!==null;){var h=be;switch(h.tag){case 0:case 11:case 15:r1(8,h,s)}var d=h.child;if(d!==null)d.return=h,be=d;else for(;be!==null;){h=be;var p=h.sibling,m=h.return;if(pR(h),h===l){be=null;break}if(p!==null){p.return=m,be=p;break}be=m}}}var f=s.alternate;if(f!==null){var g=f.child;if(g!==null){f.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(g!==null)}}be=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,be=o;else e:for(;be!==null;){if(s=be,s.flags&2048)switch(s.tag){case 0:case 11:case 15:r1(9,s,s.return)}var y=s.sibling;if(y!==null){y.return=s.return,be=y;break e}be=s.return}}var w=r.current;for(be=w;be!==null;){o=be;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,be=b;else e:for(o=w;be!==null;){if(a=be,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:C3(9,a)}}catch(C){Ft(a,a.return,C)}if(a===o){be=null;break e}var E=a.sibling;if(E!==null){E.return=a.return,be=E;break e}be=a.return}}if(Je=i,Dc(),Ns&&typeof Ns.onPostCommitFiberRoot=="function")try{Ns.onPostCommitFiberRoot(m3,r)}catch{}n=!0}return n}finally{lt=t,ki.transition=e}}return!1}function FC(r,e,t){e=Bh(t,e),e=nR(r,e,1),r=ec(r,e,1),e=on(),r!==null&&(Ip(r,1,e),kn(r,e))}function Ft(r,e,t){if(r.tag===3)FC(r,r,t);else for(;e!==null;){if(e.tag===3){FC(e,r,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(tc===null||!tc.has(n))){r=Bh(t,r),r=iR(e,r,1),e=ec(e,r,1),r=on(),e!==null&&(Ip(e,1,r),kn(e,r));break}}e=e.return}}function fG(r,e,t){var n=r.pingCache;n!==null&&n.delete(e),e=on(),r.pingedLanes|=r.suspendedLanes&t,lr===r&&(wr&t)===t&&(Zt===4||Zt===3&&(wr&130023424)===wr&&500>Kt()-pE?Sl(r,0):fE|=t),kn(r,e)}function AR(r,e){e===0&&(r.mode&1?(e=v0,v0<<=1,!(v0&130023424)&&(v0=4194304)):e=1);var t=on();r=Do(r,e),r!==null&&(Ip(r,e,t),kn(r,t))}function pG(r){var e=r.memoizedState,t=0;e!==null&&(t=e.retryLane),AR(r,t)}function gG(r,e){var t=0;switch(r.tag){case 13:var n=r.stateNode,i=r.memoizedState;i!==null&&(t=i.retryLane);break;case 19:n=r.stateNode;break;default:throw Error(ee(314))}n!==null&&n.delete(e),AR(r,t)}var CR;CR=function(r,e,t){if(r!==null)if(r.memoizedProps!==e.pendingProps||Cn.current)xn=!0;else{if(!(r.lanes&t)&&!(e.flags&128))return xn=!1,rG(r,e,t);xn=!!(r.flags&131072)}else xn=!1,Tt&&e.flags&1048576&&TO(e,P2,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Ng(r,e),r=e.pendingProps;var i=Mh(e,Yr.current);uh(e,t),i=aE(null,e,n,r,i,t);var s=cE();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,In(n)?(s=!0,_2(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,rE(e),i.updater=A3,e.stateNode=i,i._reactInternals=e,N6(e,n,r,t),e=R6(null,e,n,!0,s,t)):(e.tag=0,Tt&&s&&Q9(e),en(null,e,i,t),e=e.child),e;case 16:n=e.elementType;e:{switch(Ng(r,e),r=e.pendingProps,i=n._init,n=i(n._payload),e.type=n,i=e.tag=mG(n),r=Wi(n,r),i){case 0:e=O6(null,e,n,r,t);break e;case 1:e=PC(null,e,n,r,t);break e;case 11:e=_C(null,e,n,r,t);break e;case 14:e=TC(null,e,n,Wi(n.type,r),t);break e}throw Error(ee(306,n,""))}return e;case 0:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Wi(n,i),O6(r,e,n,i,t);case 1:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Wi(n,i),PC(r,e,n,i,t);case 3:e:{if(cR(e),r===null)throw Error(ee(387));n=e.pendingProps,s=e.memoizedState,i=s.element,OO(r,e),N2(e,n,null,t);var o=e.memoizedState;if(n=o.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Bh(Error(ee(423)),e),e=DC(r,e,n,t,i);break e}else if(n!==i){i=Bh(Error(ee(424)),e),e=DC(r,e,n,t,i);break e}else for(Gn=Za(e.stateNode.containerInfo.firstChild),Qn=e,Tt=!0,Xi=null,t=NO(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Oh(),n===i){e=$o(r,e,t);break e}en(r,e,n,t)}e=e.child}return e;case 5:return RO(e),r===null&&P6(e),n=e.type,i=e.pendingProps,s=r!==null?r.memoizedProps:null,o=i.children,C6(n,i)?o=null:s!==null&&C6(n,s)&&(e.flags|=32),aR(r,e),en(r,e,o,t),e.child;case 6:return r===null&&P6(e),null;case 13:return lR(r,e,t);case 4:return nE(e,e.stateNode.containerInfo),n=e.pendingProps,r===null?e.child=Rh(e,null,n,t):en(r,e,n,t),e.child;case 11:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Wi(n,i),_C(r,e,n,i,t);case 7:return en(r,e,e.pendingProps,t),e.child;case 8:return en(r,e,e.pendingProps.children,t),e.child;case 12:return en(r,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,vt(D2,n._currentValue),n._currentValue=o,s!==null)if(cs(s.value,o)){if(s.children===i.children&&!Cn.current){e=$o(r,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===n){if(s.tag===1){c=So(-1,t&-t),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var h=l.pending;h===null?c.next=c:(c.next=h.next,h.next=c),l.pending=c}}s.lanes|=t,c=s.alternate,c!==null&&(c.lanes|=t),D6(s.return,t,e),a.lanes|=t;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(ee(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),D6(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}en(r,e,i.children,t),e=e.child}return e;case 9:return i=e.type,n=e.pendingProps.children,uh(e,t),i=Pi(i),n=n(i),e.flags|=1,en(r,e,n,t),e.child;case 14:return n=e.type,i=Wi(n,e.pendingProps),i=Wi(n.type,i),TC(r,e,n,i,t);case 15:return sR(r,e,e.type,e.pendingProps,t);case 17:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Wi(n,i),Ng(r,e),e.tag=1,In(n)?(r=!0,_2(e)):r=!1,uh(e,t),rR(e,n,i),N6(e,n,i,t),R6(null,e,n,!0,r,t);case 19:return uR(r,e,t);case 22:return oR(r,e,t)}throw Error(ee(156,e.tag))};function IR(r,e){return ZM(r,e)}function yG(r,e,t,n){this.tag=r,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Si(r,e,t,n){return new yG(r,e,t,n)}function wE(r){return r=r.prototype,!(!r||!r.isReactComponent)}function mG(r){if(typeof r=="function")return wE(r)?1:0;if(r!=null){if(r=r.$$typeof,r===L9)return 11;if(r===B9)return 14}return 2}function nc(r,e){var t=r.alternate;return t===null?(t=Si(r.tag,e,r.key,r.mode),t.elementType=r.elementType,t.type=r.type,t.stateNode=r.stateNode,t.alternate=r,r.alternate=t):(t.pendingProps=e,t.type=r.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=r.flags&14680064,t.childLanes=r.childLanes,t.lanes=r.lanes,t.child=r.child,t.memoizedProps=r.memoizedProps,t.memoizedState=r.memoizedState,t.updateQueue=r.updateQueue,e=r.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=r.sibling,t.index=r.index,t.ref=r.ref,t}function Rg(r,e,t,n,i,s){var o=2;if(n=r,typeof r=="function")wE(r)&&(o=1);else if(typeof r=="string")o=5;else e:switch(r){case Hu:return xl(t.children,i,s,e);case R9:o=8,i|=8;break;case n6:return r=Si(12,t,e,i|2),r.elementType=n6,r.lanes=s,r;case i6:return r=Si(13,t,e,i),r.elementType=i6,r.lanes=s,r;case s6:return r=Si(19,t,e,i),r.elementType=s6,r.lanes=s,r;case RM:return k3(t,i,s,e);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case MM:o=10;break e;case OM:o=9;break e;case L9:o=11;break e;case B9:o=14;break e;case Ea:o=16,n=null;break e}throw Error(ee(130,r==null?r:typeof r,""))}return e=Si(o,t,e,i),e.elementType=r,e.type=n,e.lanes=s,e}function xl(r,e,t,n){return r=Si(7,r,n,e),r.lanes=t,r}function k3(r,e,t,n){return r=Si(22,r,n,e),r.elementType=RM,r.lanes=t,r.stateNode={isHidden:!1},r}function f8(r,e,t){return r=Si(6,r,null,e),r.lanes=t,r}function p8(r,e,t){return e=Si(4,r.children!==null?r.children:[],r.key,e),e.lanes=t,e.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},e}function wG(r,e,t,n,i){this.tag=e,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=G4(0),this.expirationTimes=G4(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=G4(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function bE(r,e,t,n,i,s,o,a,c){return r=new wG(r,e,t,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Si(3,null,null,e),r.current=s,s.stateNode=r,s.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},rE(s),r}function bG(r,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ku,key:n==null?null:""+n,children:r,containerInfo:e,implementation:t}}function kR(r){if(!r)return fc;r=r._reactInternals;e:{if(uu(r)!==r||r.tag!==1)throw Error(ee(170));var e=r;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(In(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ee(171))}if(r.tag===1){var t=r.type;if(In(t))return kO(r,t,e)}return e}function _R(r,e,t,n,i,s,o,a,c){return r=bE(t,n,!0,r,i,s,o,a,c),r.context=kR(null),t=r.current,n=on(),i=rc(t),s=So(n,i),s.callback=e??null,ec(t,s,i),r.current.lanes=i,Ip(r,i,n),kn(r,n),r}function _3(r,e,t,n){var i=e.current,s=on(),o=rc(i);return t=kR(t),e.context===null?e.context=t:e.pendingContext=t,e=So(s,o),e.payload={element:r},n=n===void 0?null:n,n!==null&&(e.callback=n),r=ec(i,e,o),r!==null&&(ns(r,i,o,s),Pg(r,i,o)),o}function z2(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function zC(r,e){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var t=r.retryLane;r.retryLane=t!==0&&t<e?t:e}}function vE(r,e){zC(r,e),(r=r.alternate)&&zC(r,e)}function vG(){return null}var TR=typeof reportError=="function"?reportError:function(r){console.error(r)};function EE(r){this._internalRoot=r}T3.prototype.render=EE.prototype.render=function(r){var e=this._internalRoot;if(e===null)throw Error(ee(409));_3(r,e,null,null)};T3.prototype.unmount=EE.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var e=r.containerInfo;Ul(function(){_3(null,r,null,null)}),e[Po]=null}};function T3(r){this._internalRoot=r}T3.prototype.unstable_scheduleHydration=function(r){if(r){var e=oO();r={blockedOn:null,target:r,priority:e};for(var t=0;t<Oa.length&&e!==0&&e<Oa[t].priority;t++);Oa.splice(t,0,r),t===0&&cO(r)}};function SE(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function P3(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function VC(){}function EG(r,e,t,n,i){if(i){if(typeof n=="function"){var s=n;n=function(){var l=z2(o);s.call(l)}}var o=_R(e,n,r,0,null,!1,!1,"",VC);return r._reactRootContainer=o,r[Po]=o.current,T1(r.nodeType===8?r.parentNode:r),Ul(),o}for(;i=r.lastChild;)r.removeChild(i);if(typeof n=="function"){var a=n;n=function(){var l=z2(c);a.call(l)}}var c=bE(r,0,!1,null,null,!1,!1,"",VC);return r._reactRootContainer=c,r[Po]=c.current,T1(r.nodeType===8?r.parentNode:r),Ul(function(){_3(e,c,t,n)}),c}function D3(r,e,t,n,i){var s=t._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var c=z2(o);a.call(c)}}_3(e,o,r,i)}else o=EG(t,e,r,i,n);return z2(o)}iO=function(r){switch(r.tag){case 3:var e=r.stateNode;if(e.current.memoizedState.isDehydrated){var t=Bf(e.pendingLanes);t!==0&&(z9(e,t|1),kn(e,Kt()),!(Je&6)&&(Uh=Kt()+500,Dc()))}break;case 13:Ul(function(){var n=Do(r,1);if(n!==null){var i=on();ns(n,r,1,i)}}),vE(r,1)}};V9=function(r){if(r.tag===13){var e=Do(r,134217728);if(e!==null){var t=on();ns(e,r,134217728,t)}vE(r,134217728)}};sO=function(r){if(r.tag===13){var e=rc(r),t=Do(r,e);if(t!==null){var n=on();ns(t,r,e,n)}vE(r,e)}};oO=function(){return lt};aO=function(r,e){var t=lt;try{return lt=r,e()}finally{lt=t}};g6=function(r,e,t){switch(e){case"input":if(c6(r,t),e=t.name,t.type==="radio"&&e!=null){for(t=r;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==r&&n.form===r.form){var i=E3(n);if(!i)throw Error(ee(90));BM(n),c6(n,i)}}}break;case"textarea":FM(r,t);break;case"select":e=t.value,e!=null&&oh(r,!!t.multiple,e,!1)}};WM=gE;GM=Ul;var SG={usingClientEntryPoint:!1,Events:[_p,Gu,E3,jM,qM,gE]},sf={findFiberByHostInstance:ul,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},xG={bundleType:sf.bundleType,version:sf.version,rendererPackageName:sf.rendererPackageName,rendererConfig:sf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ko.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=XM(r),r===null?null:r.stateNode},findFiberByHostInstance:sf.findFiberByHostInstance||vG,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var D0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!D0.isDisabled&&D0.supportsFiber)try{m3=D0.inject(xG),Ns=D0}catch{}}Zn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=SG;Zn.createPortal=function(r,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!SE(e))throw Error(ee(200));return bG(r,e,null,t)};Zn.createRoot=function(r,e){if(!SE(r))throw Error(ee(299));var t=!1,n="",i=TR;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=bE(r,1,!1,null,null,t,!1,n,i),r[Po]=e.current,T1(r.nodeType===8?r.parentNode:r),new EE(e)};Zn.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var e=r._reactInternals;if(e===void 0)throw typeof r.render=="function"?Error(ee(188)):(r=Object.keys(r).join(","),Error(ee(268,r)));return r=XM(e),r=r===null?null:r.stateNode,r};Zn.flushSync=function(r){return Ul(r)};Zn.hydrate=function(r,e,t){if(!P3(e))throw Error(ee(200));return D3(null,r,e,!0,t)};Zn.hydrateRoot=function(r,e,t){if(!SE(r))throw Error(ee(405));var n=t!=null&&t.hydratedSources||null,i=!1,s="",o=TR;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=_R(e,null,r,1,t??null,i,!1,s,o),r[Po]=e.current,T1(r),n)for(r=0;r<n.length;r++)t=n[r],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new T3(e)};Zn.render=function(r,e,t){if(!P3(e))throw Error(ee(200));return D3(null,r,e,!1,t)};Zn.unmountComponentAtNode=function(r){if(!P3(r))throw Error(ee(40));return r._reactRootContainer?(Ul(function(){D3(null,null,r,!1,function(){r._reactRootContainer=null,r[Po]=null})}),!0):!1};Zn.unstable_batchedUpdates=gE;Zn.unstable_renderSubtreeIntoContainer=function(r,e,t,n){if(!P3(t))throw Error(ee(200));if(r==null||r._reactInternals===void 0)throw Error(ee(38));return D3(r,e,t,!1,n)};Zn.version="18.3.1-next-f1338f8080-20240426";function PR(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(PR)}catch(r){console.error(r)}}PR(),PM.exports=Zn;var AG=PM.exports,KC=AG;t6.createRoot=KC.createRoot,t6.hydrateRoot=KC.hydrateRoot;var xE={exports:{}},dh=typeof Reflect=="object"?Reflect:null,HC=dh&&typeof dh.apply=="function"?dh.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},Lg;dh&&typeof dh.ownKeys=="function"?Lg=dh.ownKeys:Object.getOwnPropertySymbols?Lg=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Lg=function(e){return Object.getOwnPropertyNames(e)};function CG(r){console&&console.warn&&console.warn(r)}var DR=Number.isNaN||function(e){return e!==e};function pt(){pt.init.call(this)}xE.exports=pt;xE.exports.once=TG;pt.EventEmitter=pt;pt.prototype._events=void 0;pt.prototype._eventsCount=0;pt.prototype._maxListeners=void 0;var jC=10;function $3(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(pt,"defaultMaxListeners",{enumerable:!0,get:function(){return jC},set:function(r){if(typeof r!="number"||r<0||DR(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");jC=r}});pt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};pt.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||DR(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function $R(r){return r._maxListeners===void 0?pt.defaultMaxListeners:r._maxListeners}pt.prototype.getMaxListeners=function(){return $R(this)};pt.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")HC(c,this,t);else for(var l=c.length,h=LR(c,l),n=0;n<l;++n)HC(h[n],this,t);return!0};function NR(r,e,t,n){var i,s,o;if($3(t),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),s=r._events),o=s[e]),o===void 0)o=s[e]=t,++r._eventsCount;else if(typeof o=="function"?o=s[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),i=$R(r),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=o.length,CG(a)}return r}pt.prototype.addListener=function(e,t){return NR(this,e,t,!1)};pt.prototype.on=pt.prototype.addListener;pt.prototype.prependListener=function(e,t){return NR(this,e,t,!0)};function IG(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function MR(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=IG.bind(n);return i.listener=t,n.wrapFn=i,i}pt.prototype.once=function(e,t){return $3(t),this.on(e,MR(this,e,t)),this};pt.prototype.prependOnceListener=function(e,t){return $3(t),this.prependListener(e,MR(this,e,t)),this};pt.prototype.removeListener=function(e,t){var n,i,s,o,a;if($3(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():kG(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};pt.prototype.off=pt.prototype.removeListener;pt.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function OR(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?_G(i):LR(i,i.length)}pt.prototype.listeners=function(e){return OR(this,e,!0)};pt.prototype.rawListeners=function(e){return OR(this,e,!1)};pt.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):RR.call(r,e)};pt.prototype.listenerCount=RR;function RR(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}pt.prototype.eventNames=function(){return this._eventsCount>0?Lg(this._events):[]};function LR(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function kG(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function _G(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function TG(r,e){return new Promise(function(t,n){function i(o){r.removeListener(e,s),n(o)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}BR(r,e,s,{once:!0}),e!=="error"&&PG(r,i,{once:!0})})}function PG(r,e,t){typeof r.on=="function"&&BR(r,"error",e,t)}function BR(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(s){n.once&&r.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var N3=xE.exports,UR={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(c,l,h){this.fn=c,this.context=l,this.once=h||!1}function s(c,l,h,d,p){if(typeof h!="function")throw new TypeError("The listener must be a function");var m=new i(h,d||c,p),f=t?t+l:l;return c._events[f]?c._events[f].fn?c._events[f]=[c._events[f],m]:c._events[f].push(m):(c._events[f]=m,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new n:delete c._events[l]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],h,d;if(this._eventsCount===0)return l;for(d in h=this._events)e.call(h,d)&&l.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(h)):l},a.prototype.listeners=function(l){var h=t?t+l:l,d=this._events[h];if(!d)return[];if(d.fn)return[d.fn];for(var p=0,m=d.length,f=new Array(m);p<m;p++)f[p]=d[p].fn;return f},a.prototype.listenerCount=function(l){var h=t?t+l:l,d=this._events[h];return d?d.fn?1:d.length:0},a.prototype.emit=function(l,h,d,p,m,f){var g=t?t+l:l;if(!this._events[g])return!1;var v=this._events[g],y=arguments.length,w,b;if(v.fn){switch(v.once&&this.removeListener(l,v.fn,void 0,!0),y){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,h),!0;case 3:return v.fn.call(v.context,h,d),!0;case 4:return v.fn.call(v.context,h,d,p),!0;case 5:return v.fn.call(v.context,h,d,p,m),!0;case 6:return v.fn.call(v.context,h,d,p,m,f),!0}for(b=1,w=new Array(y-1);b<y;b++)w[b-1]=arguments[b];v.fn.apply(v.context,w)}else{var E=v.length,C;for(b=0;b<E;b++)switch(v[b].once&&this.removeListener(l,v[b].fn,void 0,!0),y){case 1:v[b].fn.call(v[b].context);break;case 2:v[b].fn.call(v[b].context,h);break;case 3:v[b].fn.call(v[b].context,h,d);break;case 4:v[b].fn.call(v[b].context,h,d,p);break;default:if(!w)for(C=1,w=new Array(y-1);C<y;C++)w[C-1]=arguments[C];v[b].fn.apply(v[b].context,w)}}return!0},a.prototype.on=function(l,h,d){return s(this,l,h,d,!1)},a.prototype.once=function(l,h,d){return s(this,l,h,d,!0)},a.prototype.removeListener=function(l,h,d,p){var m=t?t+l:l;if(!this._events[m])return this;if(!h)return o(this,m),this;var f=this._events[m];if(f.fn)f.fn===h&&(!p||f.once)&&(!d||f.context===d)&&o(this,m);else{for(var g=0,v=[],y=f.length;g<y;g++)(f[g].fn!==h||p&&!f[g].once||d&&f[g].context!==d)&&v.push(f[g]);v.length?this._events[m]=v.length===1?v[0]:v:o(this,m)}return this},a.prototype.removeAllListeners=function(l){var h;return l?(h=t?t+l:l,this._events[h]&&o(this,h)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a})(UR);var DG=UR.exports;const $G=Vo(DG);let FR=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},NG=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const qC=r=>globalThis.DOMException===void 0?new NG(r):new DOMException(r),WC=r=>{const e=r.reason===void 0?qC("This operation was aborted."):r.reason;return e instanceof Error?e:qC(e)};function Pp(r,e){const{milliseconds:t,fallback:n,message:i,customTimers:s={setTimeout,clearTimeout}}=e;let o,a;const l=new Promise((h,d)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:m}=e;m.aborted&&d(WC(m)),a=()=>{d(WC(m))},m.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){r.then(h,d);return}const p=new FR;o=s.setTimeout.call(void 0,()=>{if(n){try{h(n())}catch(m){d(m)}return}typeof r.cancel=="function"&&r.cancel(),i===!1?h():i instanceof Error?d(i):(p.message=i??`Promise timed out after ${t} milliseconds`,d(p))},t),(async()=>{try{h(await r)}catch(m){d(m)}})()}).finally(()=>{l.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return l.clear=()=>{s.clearTimeout.call(void 0,o),o=void 0},l}function MG(r,e,t){let n=0,i=r.length;for(;i>0;){const s=Math.trunc(i/2);let o=n+s;t(r[o],e)<=0?(n=++o,i-=s+1):i=s}return n}var fi,G$;let OG=(G$=class{constructor(){qe(this,fi,[])}enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,id:t.id,run:e};if(this.size===0||ie(this,fi)[this.size-1].priority>=t.priority){ie(this,fi).push(n);return}const i=MG(ie(this,fi),n,(s,o)=>o.priority-s.priority);ie(this,fi).splice(i,0,n)}setPriority(e,t){const n=ie(this,fi).findIndex(s=>s.id===e);if(n===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[i]=ie(this,fi).splice(n,1);this.enqueue(i.run,{priority:t,id:e})}dequeue(){const e=ie(this,fi).shift();return e==null?void 0:e.run}filter(e){return ie(this,fi).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return ie(this,fi).length}},fi=new WeakMap,G$);var xh,Ah,Fa,wp,Ch,bp,pi,Ih,Zr,vp,gi,kh,go,Ep,f3,rt,zR,VR,KR,HR,jR,Bg,G6,Q6,Ug,qR,Fg;class pc extends $G{constructor(t){var n,i;super();qe(this,rt);qe(this,xh);qe(this,Ah);qe(this,Fa,0);qe(this,wp);qe(this,Ch);qe(this,bp,0);qe(this,pi);qe(this,Ih);qe(this,Zr);qe(this,vp);qe(this,gi,0);qe(this,kh);qe(this,go);qe(this,Ep);qe(this,f3,1n);u(this,"timeout");if(t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:OG,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((n=t.intervalCap)==null?void 0:n.toString())??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((i=t.interval)==null?void 0:i.toString())??""}\` (${typeof t.interval})`);gt(this,xh,t.carryoverConcurrencyCount),gt(this,Ah,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),gt(this,wp,t.intervalCap),gt(this,Ch,t.interval),gt(this,Zr,new t.queueClass),gt(this,vp,t.queueClass),this.concurrency=t.concurrency,this.timeout=t.timeout,gt(this,Ep,t.throwOnTimeout===!0),gt(this,go,t.autoStart===!1)}get concurrency(){return ie(this,kh)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);gt(this,kh,t),Ae(this,rt,Ug).call(this)}setPriority(t,n){ie(this,Zr).setPriority(t,n)}async add(t,n={}){return n.id??(n.id=(gs(this,f3)._++).toString()),n={timeout:this.timeout,throwOnTimeout:ie(this,Ep),...n},new Promise((i,s)=>{ie(this,Zr).enqueue(async()=>{var o;gs(this,gi)._++,gs(this,Fa)._++;try{(o=n.signal)==null||o.throwIfAborted();let a=t({signal:n.signal});n.timeout&&(a=Pp(Promise.resolve(a),{milliseconds:n.timeout})),n.signal&&(a=Promise.race([a,Ae(this,rt,qR).call(this,n.signal)]));const c=await a;i(c),this.emit("completed",c)}catch(a){if(a instanceof FR&&!n.throwOnTimeout){i();return}s(a),this.emit("error",a)}finally{Ae(this,rt,KR).call(this)}},n),this.emit("add"),Ae(this,rt,Bg).call(this)})}async addAll(t,n){return Promise.all(t.map(async i=>this.add(i,n)))}start(){return ie(this,go)?(gt(this,go,!1),Ae(this,rt,Ug).call(this),this):this}pause(){gt(this,go,!0)}clear(){gt(this,Zr,new(ie(this,vp)))}async onEmpty(){ie(this,Zr).size!==0&&await Ae(this,rt,Fg).call(this,"empty")}async onSizeLessThan(t){ie(this,Zr).size<t||await Ae(this,rt,Fg).call(this,"next",()=>ie(this,Zr).size<t)}async onIdle(){ie(this,gi)===0&&ie(this,Zr).size===0||await Ae(this,rt,Fg).call(this,"idle")}get size(){return ie(this,Zr).size}sizeBy(t){return ie(this,Zr).filter(t).length}get pending(){return ie(this,gi)}get isPaused(){return ie(this,go)}}xh=new WeakMap,Ah=new WeakMap,Fa=new WeakMap,wp=new WeakMap,Ch=new WeakMap,bp=new WeakMap,pi=new WeakMap,Ih=new WeakMap,Zr=new WeakMap,vp=new WeakMap,gi=new WeakMap,kh=new WeakMap,go=new WeakMap,Ep=new WeakMap,f3=new WeakMap,rt=new WeakSet,zR=function(){return ie(this,Ah)||ie(this,Fa)<ie(this,wp)},VR=function(){return ie(this,gi)<ie(this,kh)},KR=function(){gs(this,gi)._--,Ae(this,rt,Bg).call(this),this.emit("next")},HR=function(){Ae(this,rt,Q6).call(this),Ae(this,rt,G6).call(this),gt(this,Ih,void 0)},jR=function(){const t=Date.now();if(ie(this,pi)===void 0){const n=ie(this,bp)-t;if(n<0)gt(this,Fa,ie(this,xh)?ie(this,gi):0);else return ie(this,Ih)===void 0&&gt(this,Ih,setTimeout(()=>{Ae(this,rt,HR).call(this)},n)),!0}return!1},Bg=function(){if(ie(this,Zr).size===0)return ie(this,pi)&&clearInterval(ie(this,pi)),gt(this,pi,void 0),this.emit("empty"),ie(this,gi)===0&&this.emit("idle"),!1;if(!ie(this,go)){const t=!ie(this,rt,jR);if(ie(this,rt,zR)&&ie(this,rt,VR)){const n=ie(this,Zr).dequeue();return n?(this.emit("active"),n(),t&&Ae(this,rt,G6).call(this),!0):!1}}return!1},G6=function(){ie(this,Ah)||ie(this,pi)!==void 0||(gt(this,pi,setInterval(()=>{Ae(this,rt,Q6).call(this)},ie(this,Ch))),gt(this,bp,Date.now()+ie(this,Ch)))},Q6=function(){ie(this,Fa)===0&&ie(this,gi)===0&&ie(this,pi)&&(clearInterval(ie(this,pi)),gt(this,pi,void 0)),gt(this,Fa,ie(this,xh)?ie(this,gi):0),Ae(this,rt,Ug).call(this)},Ug=function(){for(;Ae(this,rt,Bg).call(this););},qR=async function(t){return new Promise((n,i)=>{t.addEventListener("abort",()=>{i(t.reason)},{once:!0})})},Fg=async function(t,n){return new Promise(i=>{const s=()=>{n&&!n()||(this.off(t,s),i())};this.on(t,s)})};function Oe(){const r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}class GC{constructor(e){u(this,"buffer");u(this,"mask");u(this,"top");u(this,"btm");u(this,"next");if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class g8{constructor(e={}){u(this,"size");u(this,"hwm");u(this,"head");u(this,"tail");this.hwm=e.splitLimit??16,this.head=new GC(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new GC(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let RG=class extends Error{constructor(t,n){super(t??"The operation was aborted");u(this,"type");u(this,"code");this.type="aborted",this.code=n??"ABORT_ERR"}};function No(r={}){return LG(t=>{const n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function LG(r,e){e=e??{};let t=e.onEnd,n=new g8,i,s,o,a=Oe();const c=async()=>{try{return n.isEmpty()?o?{done:!0}:await new Promise((v,y)=>{s=w=>{s=null,n.push(w);try{v(r(n))}catch(b){y(b)}return i}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=Oe()})}},l=v=>s!=null?s(v):(n.push(v),i),h=v=>(n=new g8,s!=null?s({error:v}):(n.push({error:v}),i)),d=v=>{if(o)return i;if((e==null?void 0:e.objectMode)!==!0&&(v==null?void 0:v.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:v})},p=v=>o?i:(o=!0,v!=null?h(v):l({done:!0})),m=()=>(n=new g8,p(),{done:!0}),f=v=>(p(v),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:c,return:m,throw:f,push:d,end:p,get readableLength(){return n.size},onEmpty:async v=>{const y=v==null?void 0:v.signal;if(y==null||y.throwIfAborted(),n.isEmpty())return;let w,b;y!=null&&(w=new Promise((E,C)=>{b=()=>{C(new RG)},y.addEventListener("abort",b)}));try{await Promise.race([a.promise,w])}finally{b!=null&&y!=null&&(y==null||y.removeEventListener("abort",b))}}},t==null)return i;const g=i;return i={[Symbol.asyncIterator](){return this},next(){return g.next()},throw(v){return g.throw(v),t!=null&&(t(v),t=void 0),{done:!0}},return(){return g.return(),t!=null&&(t(),t=void 0),{done:!0}},push:d,end(v){return g.end(v),t!=null&&(t(v),t=void 0),i},get readableLength(){return g.readableLength},onEmpty:v=>g.onEmpty(v)},i}let QC=class extends Error{constructor(t,n,i){super(t??"The operation was aborted");u(this,"type");u(this,"code");this.type="aborted",this.name=i??"AbortError",this.code=n??"ABORT_ERR"}};async function nn(r,e,t){if(e==null)return r;if(e.aborted)return r.catch(()=>{}),Promise.reject(new QC(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName));let n;const i=new QC(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName);try{return await Promise.race([r,new Promise((s,o)=>{n=()=>{o(i)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}}let BG=class{constructor(){u(this,"readNext");u(this,"haveNext");u(this,"ended");u(this,"nextResult");u(this,"error");this.ended=!1,this.readNext=Oe(),this.haveNext=Oe()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Oe(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Oe(),await nn(this.readNext.promise,t==null?void 0:t.signal,t)}};function UG(){return new BG}function FG(r){return r[Symbol.asyncIterator]!=null}async function zG(r,e){try{await Promise.all(r.map(async t=>{for await(const n of t)await e.push(n)})),await e.end()}catch(t){await e.end(t).catch(()=>{})}}async function*VG(r){const e=UG();zG(r,e).catch(()=>{}),yield*e}function*KG(r){for(const e of r)yield*e}function ic(...r){const e=[];for(const t of r)FG(t)||e.push(t);return e.length===r.length?KG(e):VG(r)}function cn(r,...e){if(r==null)throw new Error("Empty pipeline");if(y8(r)){const n=r;r=()=>n.source}else if(GR(r)||WR(r)){const n=r;r=()=>n}const t=[r,...e];if(t.length>1&&y8(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)y8(t[n])&&(t[n]=jG(t[n]));return HG(...t)}const HG=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},WR=r=>(r==null?void 0:r[Symbol.asyncIterator])!=null,GR=r=>(r==null?void 0:r[Symbol.iterator])!=null,y8=r=>r==null?!1:r.sink!=null&&r.source!=null,jG=r=>e=>{const t=r.sink(e);if((t==null?void 0:t.then)!=null){const n=No({objectMode:!0});t.then(()=>{n.end()},o=>{n.end(o)});let i;const s=r.source;if(WR(s))i=async function*(){yield*s,n.end()};else if(GR(s))i=function*(){yield*s,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return ic(n,i())}return r.source};var qG=function(){return Date.now()};const $0=qG;class WG{constructor(e,t,n){const i=this;this._started=$0(),this._rescheduled=0,this._scheduled=t,this._args=n,this._triggered=!1,this._timerWrapper=()=>{i._rescheduled>0?(i._scheduled=i._rescheduled-($0()-i._started),i._schedule(i._scheduled)):(i._triggered=!0,e.apply(null,i._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);const t=$0();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=$0(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}}function GG(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("timeout needed");let r;if(arguments.length>0){r=new Array(arguments.length-2);for(var e=0;e<r.length;e++)r[e]=arguments[e+2]}return new WG(arguments[0],arguments[1],r)}var QG=GG;const{AbortController:YG}=globalThis,YC=QG;class AE extends YG{constructor(e){super(),this._ms=e,this._timer=YC(()=>this.abort(),e),Object.setPrototypeOf(this,AE.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=YC(()=>this.abort(),this._ms)}}var Y6={TimeoutController:AE};const sc=(...r)=>r.join("/").replace(new RegExp("((?<=\\/)\\/+)|(^\\.\\/)|((?<=\\/)\\.\\/)","g"),"")||".",XG=3e4,JG=async({ipfs:r,log:e,events:t,onSynced:n,start:i,timeout:s})=>{if(!r)throw new Error("An instance of ipfs is required.");if(!e)throw new Error("An instance of log is required.");const o=r.libp2p,a=r.libp2p.services.pubsub,c=e.id,l=sc("/orbitdb/heads/",c),h=new pc({concurrency:1}),d=new Set;t=t||new N3.EventEmitter,s=s||XG;let p=!1;const m=async x=>{const I=await e.heads();t.emit("join",x,I)},f=x=>async function*(){const I=await e.heads();for await(const{bytes:T}of I)yield T}(),g=x=>async I=>{for await(const T of I){const L=T.subarray();L&&n&&await n(L)}p&&await m(x)},v=async({connection:x,stream:I})=>{const T=String(x.remotePeer);try{d.add(T),await cn(I,g(T),f,I)}catch(L){d.delete(T),t.emit("error",L)}},y=async x=>{const I=async()=>{const{peerId:T,subscriptions:L}=x.detail,V=String(T),U=L.find(G=>G.topic===c);if(U)if(U.subscribe){if(d.has(V))return;const G=new Y6.TimeoutController(s),{signal:K}=G;try{d.add(V);const q=await o.dialProtocol(T,l,{signal:K});await cn(f,q,g(V))}catch(q){d.delete(V),q.name==="UnsupportedProtocolError"||t.emit("error",q)}finally{G&&G.clear()}}else d.delete(V),t.emit("leave",V)};h.add(I)},w=async x=>{const{topic:I,data:T}=x.detail,L=async()=>{try{T&&n&&await n(T)}catch(V){t.emit("error",V)}};I===c&&h.add(L)},b=async x=>{d.delete(x.detail.toString())},E=async x=>{p&&await a.publish(c,x.bytes)},C=async()=>{p&&(p=!1,await h.onIdle(),a.removeEventListener("subscription-change",y),a.removeEventListener("message",w),await o.unhandle(l),await a.unsubscribe(c),o.removeEventListener("peer:disconnect",b),d.clear())},k=async()=>{p||(await o.handle(l,v),a.addEventListener("subscription-change",y),a.addEventListener("message",w),await a.subscribe(c),o.addEventListener("peer:disconnect",b),p=!0)};return i!==!1&&await k(),{add:E,stop:C,start:k,events:t,peers:d}};var X6={exports:{}};typeof Object.create=="function"?X6.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:X6.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}};var ZG=X6.exports,QR=N3,eQ=ZG,tQ=Xn;function Xn(r){if(!(this instanceof Xn))return new Xn(r);typeof r=="number"&&(r={max:r}),r||(r={}),QR.EventEmitter.call(this),this.cache={},this.head=this.tail=null,this.length=0,this.max=r.max||1e3,this.maxAge=r.maxAge||0}eQ(Xn,QR.EventEmitter);Object.defineProperty(Xn.prototype,"keys",{get:function(){return Object.keys(this.cache)}});Xn.prototype.clear=function(){this.cache={},this.head=this.tail=null,this.length=0};Xn.prototype.remove=function(r){if(typeof r!="string"&&(r=""+r),!!this.cache.hasOwnProperty(r)){var e=this.cache[r];return delete this.cache[r],this._unlink(r,e.prev,e.next),e.value}};Xn.prototype._unlink=function(r,e,t){this.length--,this.length===0?this.head=this.tail=null:this.head===r?(this.head=e,this.cache[this.head].next=null):this.tail===r?(this.tail=t,this.cache[this.tail].prev=null):(this.cache[e].next=t,this.cache[t].prev=e)};Xn.prototype.peek=function(r){if(this.cache.hasOwnProperty(r)){var e=this.cache[r];if(this._checkAge(r,e))return e.value}};Xn.prototype.set=function(r,e){typeof r!="string"&&(r=""+r);var t;if(this.cache.hasOwnProperty(r)){if(t=this.cache[r],t.value=e,this.maxAge&&(t.modified=Date.now()),r===this.head)return e;this._unlink(r,t.prev,t.next)}else t={value:e,modified:0,next:null,prev:null},this.maxAge&&(t.modified=Date.now()),this.cache[r]=t,this.length===this.max&&this.evict();return this.length++,t.next=null,t.prev=this.head,this.head&&(this.cache[this.head].next=r),this.head=r,this.tail||(this.tail=r),e};Xn.prototype._checkAge=function(r,e){return this.maxAge&&Date.now()-e.modified>this.maxAge?(this.remove(r),this.emit("evict",{key:r,value:e.value}),!1):!0};Xn.prototype.get=function(r){if(typeof r!="string"&&(r=""+r),!!this.cache.hasOwnProperty(r)){var e=this.cache[r];if(this._checkAge(r,e))return this.head!==r&&(r===this.tail?(this.tail=e.next,this.cache[this.tail].prev=null):this.cache[e.prev].next=e.next,this.cache[e.next].prev=e.prev,this.cache[this.head].next=r,e.prev=this.head,e.next=null,this.head=r),e.value}};Xn.prototype.evict=function(){if(this.tail){var r=this.tail,e=this.remove(this.tail);this.emit("evict",{key:r,value:e})}};const J6=Vo(tQ),rQ=(r,e)=>{const t=r.time-e.time;return t===0&&r.id!==e.id?r.id<e.id?-1:1:t},nQ=r=>M3(r.id,++r.time),M3=(r,e)=>(e=e||0,{id:r,time:e}),iQ=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},CE=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};function sQ(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var oQ=sQ,aQ=oQ;let cQ=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},lQ=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return YR(this,e)}},uQ=class{constructor(e){this.decoders=e}or(e){return YR(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const YR=(r,e)=>new uQ({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let hQ=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new cQ(e,t,n),this.decoder=new lQ(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const XR=({name:r,prefix:e,encode:t,decode:n})=>new hQ(r,e,t,n),JR=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:i}=aQ(t,e);return XR({prefix:r,name:e,encode:n,decode:s=>CE(i(s))})},dQ=(r,e,t,n)=>{const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},fQ=(r,e,t)=>{const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s},Ho=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>XR({prefix:e,name:r,encode(i){return fQ(i,n,t)},decode(i){return dQ(i,n,t,r)}}),zg=Ho({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Ho({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Ho({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Ho({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Ho({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Ho({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Ho({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Ho({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Ho({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const tn=JR({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});JR({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var pQ=ZR,XC=128,gQ=-128,yQ=Math.pow(2,31);function ZR(r,e,t){e=e||[],t=t||0;for(var n=t;r>=yQ;)e[t++]=r&255|XC,r/=128;for(;r&gQ;)e[t++]=r&255|XC,r>>>=7;return e[t]=r|0,ZR.bytes=t-n+1,e}var mQ=Z6,wQ=128,JC=127;function Z6(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Z6.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&JC)<<i:(o&JC)*Math.pow(2,i),i+=7}while(o>=wQ);return Z6.bytes=s-n,t}var bQ=Math.pow(2,7),vQ=Math.pow(2,14),EQ=Math.pow(2,21),SQ=Math.pow(2,28),xQ=Math.pow(2,35),AQ=Math.pow(2,42),CQ=Math.pow(2,49),IQ=Math.pow(2,56),kQ=Math.pow(2,63),_Q=function(r){return r<bQ?1:r<vQ?2:r<EQ?3:r<SQ?4:r<xQ?5:r<AQ?6:r<CQ?7:r<IQ?8:r<kQ?9:10},TQ={encode:pQ,decode:mQ,encodingLength:_Q},V2=TQ;const eb=(r,e=0)=>[V2.decode(r,e),V2.decode.bytes],K2=(r,e,t=0)=>(V2.encode(r,e,t),e),H2=r=>V2.encodingLength(r),tb=(r,e)=>{const t=e.byteLength,n=H2(r),i=n+H2(t),s=new Uint8Array(i+t);return K2(r,s,0),K2(t,s,n),s.set(e,i),new IE(r,t,e,s)},PQ=r=>{const e=CE(r),[t,n]=eb(e),[i,s]=eb(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new IE(t,i,o,e)},DQ=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&iQ(r.bytes,t.bytes)}};let IE=class{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}};const ZC=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return NQ(t,rb(r),e||tn.encoder);default:return MQ(t,rb(r),e||zg.encoder)}},eI=new WeakMap,rb=r=>{const e=eI.get(r);if(e==null){const t=new Map;return eI.set(r,t),t}return e};let ls=class Pr{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==of)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==OQ)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Pr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=tb(e,t);return Pr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Pr.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&DQ(e.multihash,n.multihash)}toString(e){return ZC(this,e)}toJSON(){return{"/":ZC(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Pr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Pr(n,i,s,o||tI(n,i,s.bytes))}else if(t[RQ]===!0){const{version:n,multihash:i,code:s}=t,o=PQ(i);return Pr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==of)throw new Error(`Version 0 CID must use dag-pb (code: ${of}) block encoding`);return new Pr(e,t,n,n.bytes)}case 1:{const i=tI(e,t,n.bytes);return new Pr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Pr.create(0,of,e)}static createV1(e,t){return Pr.create(1,e,t)}static decode(e){const[t,n]=Pr.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Pr.inspectBytes(e),n=t.size-t.multihashSize,i=CE(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new IE(t.multihashCode,t.digestSize,s,i);return[t.version===0?Pr.createV0(o):Pr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=eb(e.subarray(t));return t+=p,d};let i=n(),s=of;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){const[n,i]=$Q(e,t),s=Pr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return rb(s).set(n,e),s}};const $Q=(r,e)=>{switch(r[0]){case"Q":{const t=e||tn;return[tn.prefix,t.decode(`${tn.prefix}${r}`)]}case tn.prefix:{const t=e||tn;return[tn.prefix,t.decode(r)]}case zg.prefix:{const t=e||zg;return[zg.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},NQ=(r,e,t)=>{const{prefix:n}=t;if(n!==tn.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i},MQ=(r,e,t)=>{const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i},of=112,OQ=18,tI=(r,e,t)=>{const n=H2(r),i=n+H2(e),s=new Uint8Array(i+t.byteLength);return K2(r,s,0),K2(e,s,n),s.set(t,i),s},RQ=Symbol.for("@ipld/js-cid/CID"),LQ=({name:r,code:e,encode:t})=>new BQ(r,e,t);let BQ=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?tb(this.code,t):t.then(n=>tb(this.code,n))}else throw Error("Unknown type, must be binary type")}};function N0({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*UQ(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t],s=ls.asCID(n);s?yield[i.join("/"),s]:typeof n=="object"&&(yield*nb(n,i))}else{const t=ls.asCID(e);t?yield[r.join("/"),t]:yield*nb(e,r)}}function*nb(r,e){if(r==null||r instanceof Uint8Array)return;const t=ls.asCID(r);t&&(yield[e.join("/"),t]);for(const[n,i]of Object.entries(r)){const s=[...e,n];yield*UQ(s,i)}}function*FQ(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t];yield i.join("/"),typeof n=="object"&&!ls.asCID(n)&&(yield*ib(n,i))}else yield*ib(e,r)}function*ib(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const i=[...e,t];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!ls.asCID(n)&&(yield*FQ(i,n))}}function zQ(r,e){let t=r;for(const[n,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);const s=ls.asCID(t);if(s)return{value:s,remaining:e.slice(n+1).join("/")}}return{value:t}}let eL=class{constructor({cid:e,bytes:t,value:n}){if(!e||!t||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:N0(),bytes:N0(),value:N0(),asBlock:N0()})}links(){return nb(this.value,[])}tree(){return ib(this.value,[])}get(e="/"){return zQ(this.value,e.split("/").filter(Boolean))}};async function Id({value:r,codec:e,hasher:t}){if(typeof r>"u")throw new Error('Missing required argument "value"');if(!e||!t)throw new Error("Missing required argument: codec or hasher");const n=e.encode(r),i=await t.digest(n),s=ls.create(1,e.code,i);return new eL({value:r,bytes:n,cid:s})}async function O3({bytes:r,codec:e,hasher:t}){if(!r)throw new Error('Missing required argument "bytes"');if(!e||!t)throw new Error("Missing required argument: codec or hasher");const n=e.decode(r),i=await t.digest(r),s=ls.create(1,e.code,i);return new eL({value:n,bytes:r,cid:s})}const VQ=["string","number","bigint","symbol"],KQ=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function HQ(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";const e=typeof r;if(VQ.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(jQ(r))return"Buffer";const t=qQ(r);return t||"Object"}function jQ(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function qQ(r){const e=Object.prototype.toString.call(r).slice(8,-1);if(KQ.includes(e))return e}class z{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}z.uint=new z(0,"uint",!0);z.negint=new z(1,"negint",!0);z.bytes=new z(2,"bytes",!0);z.string=new z(3,"string",!0);z.array=new z(4,"array",!1);z.map=new z(5,"map",!1);z.tag=new z(6,"tag",!1);z.float=new z(7,"float",!0);z.false=new z(7,"false",!0);z.true=new z(7,"true",!0);z.null=new z(7,"null",!0);z.undefined=new z(7,"undefined",!0);z.break=new z(7,"break",!0);class ne{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const kd=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",WQ=new TextDecoder,GQ=new TextEncoder;function j2(r){return kd&&globalThis.Buffer.isBuffer(r)}function kE(r){return r instanceof Uint8Array?j2(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}const QQ=kd?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):nI(r,e,t):(r,e,t)=>t-e>64?WQ.decode(r.subarray(e,t)):nI(r,e,t),tL=kd?r=>r.length>64?globalThis.Buffer.from(r):rI(r):r=>r.length>64?GQ.encode(r):rI(r),Qs=r=>Uint8Array.from(r),_E=kd?(r,e,t)=>j2(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),YQ=kd?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),kE(globalThis.Buffer.concat(r,e))):(r,e)=>{const t=new Uint8Array(e);let n=0;for(let i of r)n+i.length>t.length&&(i=i.subarray(0,t.length-n)),t.set(i,n),n+=i.length;return t},XQ=kd?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function JQ(r,e){if(j2(r)&&j2(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function rI(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e}function nI(r,e,t){const n=[];for(;e<t;){const i=r[e];let s=null,o=i>239?4:i>223?3:i>191?2:1;if(e+o<=t){let a,c,l,h;switch(o){case 1:i<128&&(s=i);break;case 2:a=r[e+1],(a&192)===128&&(h=(i&31)<<6|a&63,h>127&&(s=h));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(h=(i&15)<<12|(a&63)<<6|c&63,h>2047&&(h<55296||h>57343)&&(s=h));break;case 4:a=r[e+1],c=r[e+2],l=r[e+3],(a&192)===128&&(c&192)===128&&(l&192)===128&&(h=(i&15)<<18|(a&63)<<12|(c&63)<<6|l&63,h>65535&&h<1114112&&(s=h))}}s===null?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|s&1023),n.push(s),e+=o}return rL(n)}const iI=4096;function rL(r){const e=r.length;if(e<=iI)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=iI));return t}const ZQ=256;class nL{constructor(e=ZQ){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const i=t.length-(this.maxCursor-this.cursor)-1;t.set(e,i)}else{if(t){const i=t.length-(this.maxCursor-this.cursor)-1;i<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,i),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=XQ(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=_E(n,0,this.cursor)}else t=YQ(this.chunks,this.cursor);return e&&this.reset(),t}}const Ce="CBOR decode error:",Al="CBOR encode error:";function _d(r,e,t){if(r.length-e<t)throw new Error(`${Ce} not enough data for type`)}const yr=[24,256,65536,4294967296,BigInt("18446744073709551616")];function hu(r,e,t){_d(r,e,1);const n=r[e];if(t.strict===!0&&n<yr[0])throw new Error(`${Ce} integer encoded in more bytes than necessary (strict decode)`);return n}function du(r,e,t){_d(r,e,2);const n=r[e]<<8|r[e+1];if(t.strict===!0&&n<yr[1])throw new Error(`${Ce} integer encoded in more bytes than necessary (strict decode)`);return n}function fu(r,e,t){_d(r,e,4);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<yr[2])throw new Error(`${Ce} integer encoded in more bytes than necessary (strict decode)`);return n}function pu(r,e,t){_d(r,e,8);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],i=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],s=(BigInt(n)<<BigInt(32))+BigInt(i);if(t.strict===!0&&s<yr[3])throw new Error(`${Ce} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(t.allowBigInt===!0)return s;throw new Error(`${Ce} integers outside of the safe integer range are not supported`)}function eY(r,e,t,n){return new ne(z.uint,hu(r,e+1,n),2)}function tY(r,e,t,n){return new ne(z.uint,du(r,e+1,n),3)}function rY(r,e,t,n){return new ne(z.uint,fu(r,e+1,n),5)}function nY(r,e,t,n){return new ne(z.uint,pu(r,e+1,n),9)}function gu(r,e){return Mi(r,0,e.value)}function Mi(r,e,t){if(t<yr[0]){const n=Number(t);r.push([e|n])}else if(t<yr[1]){const n=Number(t);r.push([e|24,n])}else if(t<yr[2]){const n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<yr[3]){const n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{const n=BigInt(t);if(n<yr[4]){const i=[e|27,0,0,0,0,0,0,0];let s=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=s&255,s=s>>8,i[7]=s&255,s=s>>8,i[6]=s&255,s=s>>8,i[5]=s&255,i[4]=o&255,o=o>>8,i[3]=o&255,o=o>>8,i[2]=o&255,o=o>>8,i[1]=o&255,r.push(i)}else throw new Error(`${Ce} encountered BigInt larger than allowable range`)}}gu.encodedSize=function(e){return Mi.encodedSize(e.value)};Mi.encodedSize=function(e){return e<yr[0]?1:e<yr[1]?2:e<yr[2]?3:e<yr[3]?5:9};gu.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function iY(r,e,t,n){return new ne(z.negint,-1-hu(r,e+1,n),2)}function sY(r,e,t,n){return new ne(z.negint,-1-du(r,e+1,n),3)}function oY(r,e,t,n){return new ne(z.negint,-1-fu(r,e+1,n),5)}const TE=BigInt(-1),iL=BigInt(1);function aY(r,e,t,n){const i=pu(r,e+1,n);if(typeof i!="bigint"){const s=-1-i;if(s>=Number.MIN_SAFE_INTEGER)return new ne(z.negint,s,9)}if(n.allowBigInt!==!0)throw new Error(`${Ce} integers outside of the safe integer range are not supported`);return new ne(z.negint,TE-BigInt(i),9)}function PE(r,e){const t=e.value,n=typeof t=="bigint"?t*TE-iL:t*-1-1;Mi(r,e.type.majorEncoded,n)}PE.encodedSize=function(e){const t=e.value,n=typeof t=="bigint"?t*TE-iL:t*-1-1;return n<yr[0]?1:n<yr[1]?2:n<yr[2]?3:n<yr[3]?5:9};PE.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function Dp(r,e,t,n){_d(r,e,t+n);const i=_E(r,e+t,e+t+n);return new ne(z.bytes,i,t+n)}function cY(r,e,t,n){return Dp(r,e,1,t)}function lY(r,e,t,n){return Dp(r,e,2,hu(r,e+1,n))}function uY(r,e,t,n){return Dp(r,e,3,du(r,e+1,n))}function hY(r,e,t,n){return Dp(r,e,5,fu(r,e+1,n))}function dY(r,e,t,n){const i=pu(r,e+1,n);if(typeof i=="bigint")throw new Error(`${Ce} 64-bit integer bytes lengths not supported`);return Dp(r,e,9,i)}function q2(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===z.string?tL(r.value):r.value),r.encodedBytes}function R3(r,e){const t=q2(e);Mi(r,e.type.majorEncoded,t.length),r.push(t)}R3.encodedSize=function(e){const t=q2(e);return Mi.encodedSize(t.length)+t.length};R3.compareTokens=function(e,t){return fY(q2(e),q2(t))};function fY(r,e){return r.length<e.length?-1:r.length>e.length?1:JQ(r,e)}function $p(r,e,t,n,i){const s=t+n;_d(r,e,s);const o=new ne(z.string,QQ(r,e+t,e+s),s);return i.retainStringBytes===!0&&(o.byteValue=_E(r,e+t,e+s)),o}function pY(r,e,t,n){return $p(r,e,1,t,n)}function gY(r,e,t,n){return $p(r,e,2,hu(r,e+1,n),n)}function yY(r,e,t,n){return $p(r,e,3,du(r,e+1,n),n)}function mY(r,e,t,n){return $p(r,e,5,fu(r,e+1,n),n)}function wY(r,e,t,n){const i=pu(r,e+1,n);if(typeof i=="bigint")throw new Error(`${Ce} 64-bit integer string lengths not supported`);return $p(r,e,9,i,n)}const bY=R3;function Td(r,e,t,n){return new ne(z.array,n,t)}function vY(r,e,t,n){return Td(r,e,1,t)}function EY(r,e,t,n){return Td(r,e,2,hu(r,e+1,n))}function SY(r,e,t,n){return Td(r,e,3,du(r,e+1,n))}function xY(r,e,t,n){return Td(r,e,5,fu(r,e+1,n))}function AY(r,e,t,n){const i=pu(r,e+1,n);if(typeof i=="bigint")throw new Error(`${Ce} 64-bit integer array lengths not supported`);return Td(r,e,9,i)}function CY(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Ce} indefinite length items not allowed`);return Td(r,e,1,1/0)}function DE(r,e){Mi(r,z.array.majorEncoded,e.value)}DE.compareTokens=gu.compareTokens;DE.encodedSize=function(e){return Mi.encodedSize(e.value)};function Pd(r,e,t,n){return new ne(z.map,n,t)}function IY(r,e,t,n){return Pd(r,e,1,t)}function kY(r,e,t,n){return Pd(r,e,2,hu(r,e+1,n))}function _Y(r,e,t,n){return Pd(r,e,3,du(r,e+1,n))}function TY(r,e,t,n){return Pd(r,e,5,fu(r,e+1,n))}function PY(r,e,t,n){const i=pu(r,e+1,n);if(typeof i=="bigint")throw new Error(`${Ce} 64-bit integer map lengths not supported`);return Pd(r,e,9,i)}function DY(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Ce} indefinite length items not allowed`);return Pd(r,e,1,1/0)}function $E(r,e){Mi(r,z.map.majorEncoded,e.value)}$E.compareTokens=gu.compareTokens;$E.encodedSize=function(e){return Mi.encodedSize(e.value)};function $Y(r,e,t,n){return new ne(z.tag,t,1)}function NY(r,e,t,n){return new ne(z.tag,hu(r,e+1,n),2)}function MY(r,e,t,n){return new ne(z.tag,du(r,e+1,n),3)}function OY(r,e,t,n){return new ne(z.tag,fu(r,e+1,n),5)}function RY(r,e,t,n){return new ne(z.tag,pu(r,e+1,n),9)}function NE(r,e){Mi(r,z.tag.majorEncoded,e.value)}NE.compareTokens=gu.compareTokens;NE.encodedSize=function(e){return Mi.encodedSize(e.value)};const LY=20,BY=21,UY=22,FY=23;function zY(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${Ce} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new ne(z.null,null,1):new ne(z.undefined,void 0,1)}function VY(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Ce} indefinite length items not allowed`);return new ne(z.break,void 0,1)}function ME(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${Ce} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${Ce} Infinity values are not supported`)}return new ne(z.float,r,e)}function KY(r,e,t,n){return ME(RE(r,e+1),3,n)}function HY(r,e,t,n){return ME(LE(r,e+1),5,n)}function jY(r,e,t,n){return ME(cL(r,e+1),9,n)}function OE(r,e,t){const n=e.value;if(n===!1)r.push([z.float.majorEncoded|LY]);else if(n===!0)r.push([z.float.majorEncoded|BY]);else if(n===null)r.push([z.float.majorEncoded|UY]);else if(n===void 0)r.push([z.float.majorEncoded|FY]);else{let i,s=!1;(!t||t.float64!==!0)&&(oL(n),i=RE(Hi,1),n===i||Number.isNaN(n)?(Hi[0]=249,r.push(Hi.slice(0,3)),s=!0):(aL(n),i=LE(Hi,1),n===i&&(Hi[0]=250,r.push(Hi.slice(0,5)),s=!0))),s||(qY(n),i=cL(Hi,1),Hi[0]=251,r.push(Hi.slice(0,9)))}}OE.encodedSize=function(e,t){const n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){oL(n);let i=RE(Hi,1);if(n===i||Number.isNaN(n))return 3;if(aL(n),i=LE(Hi,1),n===i)return 5}return 9};const sL=new ArrayBuffer(9),hi=new DataView(sL,1),Hi=new Uint8Array(sL,0);function oL(r){if(r===1/0)hi.setUint16(0,31744,!1);else if(r===-1/0)hi.setUint16(0,64512,!1);else if(Number.isNaN(r))hi.setUint16(0,32256,!1);else{hi.setFloat32(0,r);const e=hi.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)hi.setUint16(0,31744,!1);else if(t===0)hi.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{const i=t-127;i<-24?hi.setUint16(0,0):i<-14?hi.setUint16(0,(e&2147483648)>>16|1<<24+i,!1):hi.setUint16(0,(e&2147483648)>>16|i+15<<10|n>>13,!1)}}}function RE(r,e){if(r.length-e<2)throw new Error(`${Ce} not enough data for float16`);const t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const n=t>>10&31,i=t&1023;let s;return n===0?s=i*2**-24:n!==31?s=(i+1024)*2**(n-25):s=i===0?1/0:NaN,t&32768?-s:s}function aL(r){hi.setFloat32(0,r,!1)}function LE(r,e){if(r.length-e<4)throw new Error(`${Ce} not enough data for float32`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function qY(r){hi.setFloat64(0,r,!1)}function cL(r,e){if(r.length-e<8)throw new Error(`${Ce} not enough data for float64`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}OE.compareTokens=gu.compareTokens;function nt(r,e,t){throw new Error(`${Ce} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function L3(r){return()=>{throw new Error(`${Ce} ${r}`)}}const ae=[];for(let r=0;r<=23;r++)ae[r]=nt;ae[24]=eY;ae[25]=tY;ae[26]=rY;ae[27]=nY;ae[28]=nt;ae[29]=nt;ae[30]=nt;ae[31]=nt;for(let r=32;r<=55;r++)ae[r]=nt;ae[56]=iY;ae[57]=sY;ae[58]=oY;ae[59]=aY;ae[60]=nt;ae[61]=nt;ae[62]=nt;ae[63]=nt;for(let r=64;r<=87;r++)ae[r]=cY;ae[88]=lY;ae[89]=uY;ae[90]=hY;ae[91]=dY;ae[92]=nt;ae[93]=nt;ae[94]=nt;ae[95]=L3("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)ae[r]=pY;ae[120]=gY;ae[121]=yY;ae[122]=mY;ae[123]=wY;ae[124]=nt;ae[125]=nt;ae[126]=nt;ae[127]=L3("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)ae[r]=vY;ae[152]=EY;ae[153]=SY;ae[154]=xY;ae[155]=AY;ae[156]=nt;ae[157]=nt;ae[158]=nt;ae[159]=CY;for(let r=160;r<=183;r++)ae[r]=IY;ae[184]=kY;ae[185]=_Y;ae[186]=TY;ae[187]=PY;ae[188]=nt;ae[189]=nt;ae[190]=nt;ae[191]=DY;for(let r=192;r<=215;r++)ae[r]=$Y;ae[216]=NY;ae[217]=MY;ae[218]=OY;ae[219]=RY;ae[220]=nt;ae[221]=nt;ae[222]=nt;ae[223]=nt;for(let r=224;r<=243;r++)ae[r]=L3("simple values are not supported");ae[244]=nt;ae[245]=nt;ae[246]=nt;ae[247]=zY;ae[248]=L3("simple values are not supported");ae[249]=KY;ae[250]=HY;ae[251]=jY;ae[252]=nt;ae[253]=nt;ae[254]=nt;ae[255]=VY;const Ks=[];for(let r=0;r<24;r++)Ks[r]=new ne(z.uint,r,1);for(let r=-1;r>=-24;r--)Ks[31-r]=new ne(z.negint,r,1);Ks[64]=new ne(z.bytes,new Uint8Array(0),1);Ks[96]=new ne(z.string,"",1);Ks[128]=new ne(z.array,0,1);Ks[160]=new ne(z.map,0,1);Ks[244]=new ne(z.false,!1,1);Ks[245]=new ne(z.true,!0,1);Ks[246]=new ne(z.null,null,1);function WY(r){switch(r.type){case z.false:return Qs([244]);case z.true:return Qs([245]);case z.null:return Qs([246]);case z.bytes:return r.value.length?void 0:Qs([64]);case z.string:return r.value===""?Qs([96]):void 0;case z.array:return r.value===0?Qs([128]):void 0;case z.map:return r.value===0?Qs([160]):void 0;case z.uint:return r.value<24?Qs([Number(r.value)]):void 0;case z.negint:if(r.value>=-24)return Qs([31-Number(r.value)])}}const GY={float64:!1,mapSorter:XY,quickEncodeToken:WY};function QY(){const r=[];return r[z.uint.major]=gu,r[z.negint.major]=PE,r[z.bytes.major]=R3,r[z.string.major]=bY,r[z.array.major]=DE,r[z.map.major]=$E,r[z.tag.major]=NE,r[z.float.major]=OE,r}const lL=QY(),m8=new nL;class W2{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${Al} object contains circular references`);return new W2(t,e)}}const aa={null:new ne(z.null,null),undefined:new ne(z.undefined,void 0),true:new ne(z.true,!0),false:new ne(z.false,!1),emptyArray:new ne(z.array,0),emptyMap:new ne(z.map,0)},gc={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new ne(z.float,r):r>=0?new ne(z.uint,r):new ne(z.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new ne(z.uint,r):new ne(z.negint,r)},Uint8Array(r,e,t,n){return new ne(z.bytes,r)},string(r,e,t,n){return new ne(z.string,r)},boolean(r,e,t,n){return r?aa.true:aa.false},null(r,e,t,n){return aa.null},undefined(r,e,t,n){return aa.undefined},ArrayBuffer(r,e,t,n){return new ne(z.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new ne(z.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[aa.emptyArray,new ne(z.break)]:aa.emptyArray;n=W2.createCheck(n,r);const i=[];let s=0;for(const o of r)i[s++]=Vg(o,t,n);return t.addBreakTokens?[new ne(z.array,r.length),i,new ne(z.break)]:[new ne(z.array,r.length),i]},Object(r,e,t,n){const i=e!=="Object",s=i?r.keys():Object.keys(r),o=i?r.size:s.length;if(!o)return t.addBreakTokens===!0?[aa.emptyMap,new ne(z.break)]:aa.emptyMap;n=W2.createCheck(n,r);const a=[];let c=0;for(const l of s)a[c++]=[Vg(l,t,n),Vg(i?r.get(l):r[l],t,n)];return YY(a,t),t.addBreakTokens?[new ne(z.map,o),a,new ne(z.break)]:[new ne(z.map,o),a]}};gc.Map=gc.Object;gc.Buffer=gc.Uint8Array;for(const r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))gc[`${r}Array`]=gc.DataView;function Vg(r,e={},t){const n=HQ(r),i=e&&e.typeEncoders&&e.typeEncoders[n]||gc[n];if(typeof i=="function"){const o=i(r,n,e,t);if(o!=null)return o}const s=gc[n];if(!s)throw new Error(`${Al} unsupported type: ${n}`);return s(r,n,e,t)}function YY(r,e){e.mapSorter&&r.sort(e.mapSorter)}function XY(r,e){const t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);const i=t.type.major,s=lL[i].compareTokens(t,n);return s===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),s}function uL(r,e,t,n){if(Array.isArray(e))for(const i of e)uL(r,i,t,n);else t[e.type.major](r,e,n)}function hL(r,e,t){const n=Vg(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){const i=t.quickEncodeToken(n);if(i)return i;const s=e[n.type.major];if(s.encodedSize){const o=s.encodedSize(n,t),a=new nL(o);if(s(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return kE(a.chunks[0])}}return m8.reset(),uL(m8,n,e,t),m8.toBytes(!0)}function Kg(r,e){return e=Object.assign({},GY,e),hL(r,lL,e)}const JY={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class ZY{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=Ks[e];if(t===void 0){const n=ae[e];if(!n)throw new Error(`${Ce} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const i=e&31;t=n(this.data,this._pos,i,this.options)}return this._pos+=t.encodedLength,t}}const B1=Symbol.for("DONE"),B3=Symbol.for("BREAK");function eX(r,e,t){const n=[];for(let i=0;i<r.value;i++){const s=U1(e,t);if(s===B3){if(r.value===1/0)break;throw new Error(`${Ce} got unexpected break to lengthed array`)}if(s===B1)throw new Error(`${Ce} found array but not enough entries (got ${i}, expected ${r.value})`);n[i]=s}return n}function tX(r,e,t){const n=t.useMaps===!0,i=n?void 0:{},s=n?new Map:void 0;for(let o=0;o<r.value;o++){const a=U1(e,t);if(a===B3){if(r.value===1/0)break;throw new Error(`${Ce} got unexpected break to lengthed map`)}if(a===B1)throw new Error(`${Ce} found map but not enough entries (got ${o} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${Ce} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&s.has(a)||!n&&a in i))throw new Error(`${Ce} found repeat map key "${a}"`);const c=U1(e,t);if(c===B1)throw new Error(`${Ce} found map but not enough entries (got ${o} [no value], expected ${r.value})`);n?s.set(a,c):i[a]=c}return n?s:i}function U1(r,e){if(r.done())return B1;const t=r.next();if(t.type===z.break)return B3;if(t.type.terminal)return t.value;if(t.type===z.array)return eX(t,r,e);if(t.type===z.map)return tX(t,r,e);if(t.type===z.tag){if(e.tags&&typeof e.tags[t.value]=="function"){const n=U1(r,e);return e.tags[t.value](n)}throw new Error(`${Ce} tag not supported (${t.value})`)}throw new Error("unsupported")}function rX(r,e){if(!(r instanceof Uint8Array))throw new Error(`${Ce} data to decode must be a Uint8Array`);e=Object.assign({},JY,e);const t=e.tokenizer||new ZY(r,e),n=U1(t,e);if(n===B1)throw new Error(`${Ce} did not find any content to decode`);if(n===B3)throw new Error(`${Ce} got unexpected break`);return[n,r.subarray(t.pos())]}function La(r,e){const[t,n]=rX(r,e);if(n.length>0)throw new Error(`${Ce} too many terminals, data makes no sense`);return t}function nX(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function BE(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function iX(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var sX=iX,oX=sX;let aX=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},cX=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return dL(this,e)}},lX=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return dL(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function dL(r,e){return new lX({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let uX=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new aX(e,t,n),this.decoder=new cX(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function fL({name:r,prefix:e,encode:t,decode:n}){return new uX(r,e,t,n)}function U3({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=oX(t,r);return fL({prefix:e,name:r,encode:n,decode:s=>BE(i(s))})}function hX(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function dX(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function jo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return fL({prefix:e,name:r,encode(i){return dX(i,n,t)},decode(i){return hX(i,n,t,r)}})}const Hg=jo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});jo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});jo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});jo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});jo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});jo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});jo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});jo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});jo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const w8=U3({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});U3({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const xa=U3({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});U3({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var fX=pL,sI=128,pX=-128,gX=Math.pow(2,31);function pL(r,e,t){e=e||[],t=t||0;for(var n=t;r>=gX;)e[t++]=r&255|sI,r/=128;for(;r&pX;)e[t++]=r&255|sI,r>>>=7;return e[t]=r|0,pL.bytes=t-n+1,e}var yX=sb,mX=128,oI=127;function sb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw sb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&oI)<<i:(o&oI)*Math.pow(2,i),i+=7}while(o>=mX);return sb.bytes=s-n,t}var wX=Math.pow(2,7),bX=Math.pow(2,14),vX=Math.pow(2,21),EX=Math.pow(2,28),SX=Math.pow(2,35),xX=Math.pow(2,42),AX=Math.pow(2,49),CX=Math.pow(2,56),IX=Math.pow(2,63),kX=function(r){return r<wX?1:r<bX?2:r<vX?3:r<EX?4:r<SX?5:r<xX?6:r<AX?7:r<CX?8:r<IX?9:10},_X={encode:fX,decode:yX,encodingLength:kX},G2=_X;function ob(r,e=0){return[G2.decode(r,e),G2.decode.bytes]}function Q2(r,e,t=0){return G2.encode(r,e,t),e}function Y2(r){return G2.encodingLength(r)}function TX(r,e){const t=e.byteLength,n=Y2(r),i=n+Y2(t),s=new Uint8Array(i+t);return Q2(r,s,0),Q2(t,s,n),s.set(e,i),new UE(r,t,e,s)}function PX(r){const e=BE(r),[t,n]=ob(e),[i,s]=ob(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new UE(t,i,o,e)}function DX(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&nX(r.bytes,t.bytes)}}let UE=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function aI(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return NX(t,ab(r),e??xa.encoder);default:return MX(t,ab(r),e??Hg.encoder)}}const cI=new WeakMap;function ab(r){const e=cI.get(r);if(e==null){const t=new Map;return cI.set(r,t),t}return e}var Q$;let gL=class Dr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Q$,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==af)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==OX)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Dr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=TX(e,t);return Dr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Dr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&DX(e.multihash,n.multihash)}toString(e){return aI(this,e)}toJSON(){return{"/":aI(this)}}link(){return this}[(Q$=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Dr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Dr(n,i,s,o??lI(n,i,s.bytes))}else if(t[RX]===!0){const{version:n,multihash:i,code:s}=t,o=PX(i);return Dr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==af)throw new Error(`Version 0 CID must use dag-pb (code: ${af}) block encoding`);return new Dr(e,t,n,n.bytes)}case 1:{const i=lI(e,t,n.bytes);return new Dr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Dr.create(0,af,e)}static createV1(e,t){return Dr.create(1,e,t)}static decode(e){const[t,n]=Dr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Dr.inspectBytes(e),n=t.size-t.multihashSize,i=BE(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new UE(t.multihashCode,t.digestSize,s,i);return[t.version===0?Dr.createV0(o):Dr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=ob(e.subarray(t));return t+=p,d};let i=n(),s=af;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){const[n,i]=$X(e,t),s=Dr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return ab(s).set(n,e),s}};function $X(r,e){switch(r[0]){case"Q":{const t=e??xa;return[xa.prefix,t.decode(`${xa.prefix}${r}`)]}case xa.prefix:{const t=e??xa;return[xa.prefix,t.decode(r)]}case Hg.prefix:{const t=e??Hg;return[Hg.prefix,t.decode(r)]}case w8.prefix:{const t=e??w8;return[w8.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function NX(r,e,t){const{prefix:n}=t;if(n!==xa.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function MX(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const af=112,OX=18;function lI(r,e,t){const n=Y2(r),i=n+Y2(e),s=new Uint8Array(i+t.byteLength);return Q2(r,s,0),Q2(e,s,n),s.set(t,i),s}const RX=Symbol.for("@ipld/js-cid/CID"),yL=42;function mL(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function LX(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=gL.asCID(r);if(!e)return null;const t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new ne(z.tag,yL),new ne(z.bytes,t)]}function BX(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function UX(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const cb={float64:!0,typeEncoders:{Object:LX,undefined:BX,number:UX}},FX={...cb,typeEncoders:{...cb.typeEncoders}};function zX(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return gL.decode(r.subarray(1))}const X2={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};X2.tags[yL]=zX;const VX={...X2,tags:X2.tags.slice()},KX="dag-cbor",wL=113,HX=r=>Kg(r,cb),jX=r=>La(mL(r),X2),Np=Object.freeze(Object.defineProperty({__proto__:null,code:wL,decode:jX,decodeOptions:VX,encode:HX,encodeOptions:FX,name:KX,toByteView:mL},Symbol.toStringTag,{value:"Module"})),qX=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),F3=LQ({name:"sha2-256",code:18,encode:qX("SHA-256")}),z3=Np,V3=F3,bL=tn,WX=async(r,e,t,n=null,i=[],s=[])=>{if(r==null)throw new Error("Identity is required, cannot create entry");if(e==null)throw new Error("Entry requires an id");if(t==null)throw new Error("Entry requires a payload");if(i==null||!Array.isArray(i))throw new Error("'next' argument is not an array");n=n||M3(r.publicKey);const o={id:e,payload:t,next:i,refs:s,clock:n,v:2},{bytes:a}=await Id({value:o,codec:z3,hasher:V3}),c=await r.sign(r,a);return o.key=r.publicKey,o.identity=r.hash,o.sig=c,EL(o)},GX=async(r,e)=>{if(!r)throw new Error("Identities is required, cannot verify entry");if(!vL(e))throw new Error("Invalid Log entry");if(!e.key)throw new Error("Entry doesn't have a key");if(!e.sig)throw new Error("Entry doesn't have a signature");const t={id:e.id,payload:e.payload,next:e.next,refs:e.refs,clock:e.clock,v:e.v},{bytes:n}=await Id({value:t,codec:z3,hasher:V3});return r.verify(e.sig,e.key,n)},vL=r=>r&&r.id!==void 0&&r.next!==void 0&&r.payload!==void 0&&r.v!==void 0&&r.clock!==void 0&&r.refs!==void 0,QX=(r,e)=>r&&e&&r.hash===e.hash,YX=async r=>{const{cid:e,value:t}=await O3({bytes:r,codec:z3,hasher:V3}),n=e.toString(bL);return{...t,hash:n,bytes:r}},EL=async r=>{const{cid:e,bytes:t}=await Id({value:r,codec:z3,hasher:V3}),n=e.toString(bL),i=M3(r.clock.id,r.clock.time);return{...r,clock:i,hash:n,bytes:t}},lo={create:WX,verify:GX,decode:YX,encode:EL,isEntry:vL,isEqual:QX},FE=async()=>{let r={};const e=async(c,l)=>{r[c]=l};return{put:e,del:async c=>{delete r[c]},get:async c=>r[c],iterator:async function*(){for await(const[c,l]of Object.entries(r))yield[c,l]},merge:async c=>{if(c)for await(const[l,h]of c.iterator())e(l,h)},clear:async()=>{r={}},close:async()=>{}}},XX=FE,JX=async({storage:r,heads:e})=>{r=r||await XX();const t=async h=>{h=uI(h);for(const d of h)await r.put(d.hash,d.bytes)},n=async h=>{await r.clear(),await t(h)},i=async h=>{const d=await a();if(d.find(m=>lo.isEqual(m,h)))return;const p=uI([...d,h]);return await n(p),p},s=async h=>{const p=(await a()).filter(m=>m.hash!==h);await n(p)},o=async function*(){const h=r.iterator();for await(const[,d]of h)yield await lo.decode(d)},a=async()=>{const h=[];for await(const d of o())h.push(d);return h},c=async()=>{await r.clear()},l=async()=>{await r.close()};return await t(e||[]),{put:t,set:n,add:i,remove:s,iterator:o,all:a,clear:c,close:l}},uI=r=>{r=new Set(r);const e={};for(const n of r)for(const i of n.next)e[i]=n.hash;const t=[];for(const n of r)e[n.hash]||t.push(n);return t};function ZX(r,e){const t=(s,o)=>s,n=(s,o)=>tJ(s,o,t);return((s,o)=>eJ(s,o,n))(r,e)}function eJ(r,e,t){const n=rQ(r.clock,e.clock);return n===0?t(r,e):n}function tJ(r,e,t){return r.clock.id===e.clock.id?t(r,e):r.clock.id<e.clock.id?-1:1}function rJ(r){const e=`Your log's tiebreaker function, ${r.name}, has returned zero and therefore cannot be`;return(n,i)=>{const s=r(n,i);if(s===0)throw Error(e);return s}}const nJ={LastWriteWins:ZX,NoZeroes:rJ},{LastWriteWins:iJ,NoZeroes:sJ}=nJ,oJ=()=>new Date().getTime().toString(),aJ=(r,e)=>Math.max(r,e.clock.time),b8=FE,cJ=async()=>({canAppend:async r=>!0}),lJ=async(r,{logId:e,logHeads:t,access:n,entryStorage:i,headsStorage:s,indexStorage:o,sortFn:a}={})=>{if(r==null)throw new Error("Identity is required");if(t!=null&&!Array.isArray(t))throw new Error("'logHeads' argument must be an array");const c=e||oJ();n=n||await cJ();const l=i||await b8(),h=o||await b8();s=s||await b8();const d=await JX({storage:s,heads:t});a=sJ(a||iJ);const p=new pc({concurrency:1}),m=new pc({concurrency:1}),f=async()=>{const U=Math.max(0,(await g()).reduce(aJ,0));return M3(r.publicKey,U)},g=async()=>(await d.all()).sort(a).reverse(),v=async()=>{const U=[];for await(const G of k())U.unshift(G);return U},y=async U=>{const G=await l.get(U);if(G)return await lo.decode(G)},w=async U=>await h.get(U)!=null,b=async(U,G={referencesCount:0})=>{const K=async()=>{const q=await g(),Q=q.map(W=>W.hash),H=await V(q,G.referencesCount+q.length),O=await lo.create(r,c,U,nQ(await f()),Q,H);if(!await n.canAppend(O))throw new Error(`Could not append entry:
Key "${r.hash}" is not allowed to write to the log`);return await d.set([O]),await l.put(O.hash,O.bytes),await h.put(O.hash,!0),O};return p.add(K)},E=async U=>{if(!U)throw new Error("Log instance not defined");if(!L(U))throw new Error("Given argument is not an instance of Log");l.merge&&await l.merge(U.storage);const G=await U.heads();for(const K of G)await C(K)},C=async U=>{const G=async()=>{if(await w(U.hash))return!1;const q=async Y=>{if(Y.id!==c)throw new Error(`Entry's id (${Y.id}) doesn't match the log's id (${c}).`);if(!await n.canAppend(Y))throw new Error(`Could not append entry:
Key "${Y.identity}" is not allowed to write to the log`);if(!await lo.verify(r,Y))throw new Error(`Could not validate signature for entry "${Y.hash}"`)};await q(U);const Q=(await g()).map(Y=>Y.hash),H=new Set([U.hash]),O=new Set([...U.next,...U.refs]),B=new Set,W=async()=>{const Y=Array.from(O.values()).filter(w).map(y),j=await Promise.all(Y);for(const ce of j){O.delete(ce.hash),await q(ce),H.add(ce.hash);for(const me of[...ce.next,...ce.refs])!await w(me)&&!H.has(me)?O.add(me):Q.includes(me)&&B.add(me)}O.size>0&&await W()};await W();for(const Y of H.values())await h.put(Y,!0);for(const Y of B.values())await d.remove(Y);return await l.put(U.hash,U.bytes),await d.add(U),!0};return m.add(G)},k=async function*(U,G){G=G||(()=>!1),U=U||await g();let q=U.sort(a);const Q={};let H=[];const O={},B=Y=>!(Q[Y]||O[Y]);let W;for(;q.length>0;)if(q=q.sort(a),W=q.pop(),W){const{hash:Y,next:j}=W;if(!Q[Y]){if(yield W,await G(W)===!0)break;Q[Y]=!0,O[Y]=!0,H=[...H,...j].filter(B);const me=ue=>{if(!Q[ue]&&!O[ue])return O[ue]=!0,y(ue)},he=await Promise.all(H.map(me));H=he.filter(ue=>ue!=null).reduce((ue,Ne)=>Array.from(new Set([...ue,...Ne.next])),[]).filter(B),q=[...he,...q]}}},x=async function*({amount:U=-1,gt:G,gte:K,lt:q,lte:Q}={}){if(U===0)return;if(typeof Q=="string"&&(Q=[await y(Q)]),typeof q=="string"){const ue=await y(q);q=await Promise.all(ue.next.map(Me=>y(Me)))}if(q!=null&&!Array.isArray(q))throw new Error("lt must be a string or an array of Entries");if(Q!=null&&!Array.isArray(Q))throw new Error("lte must be a string or an array of Entries");const H=(q||Q||await g()).filter(ue=>ue!=null),O=G||K?await y(G||K):null,B=O||U===-1?-1:U;let W=0;const Y=async ue=>(W++,ue?!!(W>=B&&B!==-1||O&&lo.isEqual(ue,O)):!1),j=O&&U!==-1&&!q&&!Q,ce=j?new J6(U+2):null;let me=0;const he=k(H,Y);for await(const ue of he){const Ne=q&&lo.isEqual(ue,H),Me=G&&lo.isEqual(ue,O);Ne||Me||(j?ce.set(me++,ue.hash):yield ue)}if(j){const ue=ce.keys.length,Ne=ue>U?ue-U:0,Me=ce.keys.slice(Ne,ue);for(const Xe of Me){const it=ce.get(Xe);yield await y(it)}}},I=async()=>{await h.clear(),await d.clear(),await l.clear()},T=async()=>{await h.close(),await d.close(),await l.close()},L=U=>U&&U.id!==void 0&&U.clock!==void 0&&U.heads!==void 0&&U.values!==void 0&&U.access!==void 0&&U.identity!==void 0&&U.storage!==void 0,V=async(U,G=0)=>{let K=[];const q=async Q=>K.length>=G&&G!==-1;for await(const{hash:Q}of k(U,q))K.push(Q);return K=K.slice(U.length+1,G),K};return{id:c,clock:f,heads:g,values:v,all:v,get:y,has:w,append:b,join:E,joinEntry:C,traverse:k,iterator:x,clear:I,close:T,access:n,identity:r,storage:l}},Cl=async(r,e)=>({put:async(l,h)=>{await r.put(l,h),await e.put(l,h)},get:async l=>{let h=await r.get(l);return h||(h=await e.get(l),h&&await r.put(l,h)),h},del:async l=>{await r.del(l),await e.del(l)},iterator:async function*({amount:l,reverse:h}={}){const d=[],p={amount:l||-1,reverse:h||!1};for(const m of[r,e])for await(const[f,g]of m.iterator(p))d[f]||(d[f]=!0,yield[f,g])},merge:async l=>{await r.merge(l),await e.merge(l),await l.merge(r),await l.merge(e)},clear:async()=>{await r.clear(),await e.clear()},close:async()=>{await r.close(),await e.close()}});function uJ(r){return r[Symbol.asyncIterator]!=null}function Mo(r){if(uJ(r))return(async()=>{for await(const e of r);})();for(const e of r);}const hI=3e4,K3=async({ipfs:r,pin:e,timeout:t}={})=>{if(!r)throw new Error("An instance of ipfs is required.");return{put:async(h,d)=>{const p=ls.parse(h,tn),{signal:m}=new Y6.TimeoutController(t||hI);await r.blockstore.put(p,d,{signal:m}),e&&!await r.pins.isPinned(p)&&await Mo(r.pins.add(p))},del:async h=>{},get:async h=>{const d=ls.parse(h,tn),{signal:p}=new Y6.TimeoutController(t||hI),m=await r.blockstore.get(d,{signal:p});if(m)return m},iterator:async function*(){},merge:async h=>{},clear:async()=>{},close:async()=>{}}};var SL={},$c={},H3={},xL={};xL.supports=function(...e){const t=e.reduce((n,i)=>Object.assign(n,i),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})};var AL={},Hs=class extends Error{constructor(e,t){super(e||""),typeof t=="object"&&t!==null&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},yu={},j3={},q3={};q3.byteLength=fJ;q3.toByteArray=gJ;q3.fromByteArray=wJ;var Ds=[],di=[],hJ=typeof Uint8Array<"u"?Uint8Array:Array,v8="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Cu=0,dJ=v8.length;Cu<dJ;++Cu)Ds[Cu]=v8[Cu],di[v8.charCodeAt(Cu)]=Cu;di[45]=62;di[95]=63;function CL(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function fJ(r){var e=CL(r),t=e[0],n=e[1];return(t+n)*3/4-n}function pJ(r,e,t){return(e+t)*3/4-t}function gJ(r){var e,t=CL(r),n=t[0],i=t[1],s=new hJ(pJ(r,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=di[r.charCodeAt(c)]<<18|di[r.charCodeAt(c+1)]<<12|di[r.charCodeAt(c+2)]<<6|di[r.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=di[r.charCodeAt(c)]<<2|di[r.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=di[r.charCodeAt(c)]<<10|di[r.charCodeAt(c+1)]<<4|di[r.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function yJ(r){return Ds[r>>18&63]+Ds[r>>12&63]+Ds[r>>6&63]+Ds[r&63]}function mJ(r,e,t){for(var n,i=[],s=e;s<t;s+=3)n=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),i.push(yJ(n));return i.join("")}function wJ(r){for(var e,t=r.length,n=t%3,i=[],s=16383,o=0,a=t-n;o<a;o+=s)i.push(mJ(r,o,o+s>a?a:o+s));return n===1?(e=r[t-1],i.push(Ds[e>>2]+Ds[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],i.push(Ds[e>>10]+Ds[e>>4&63]+Ds[e<<2&63]+"=")),i.join("")}var zE={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */zE.read=function(r,e,t,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,l=c>>1,h=-7,d=t?i-1:0,p=t?-1:1,m=r[e+d];for(d+=p,s=m&(1<<-h)-1,m>>=-h,h+=a;h>0;s=s*256+r[e+d],d+=p,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=n;h>0;o=o*256+r[e+d],d+=p,h-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(m?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-l}return(m?-1:1)*o*Math.pow(2,s-n)};zE.write=function(r,e,t,n,i,s){var o,a,c,l=s*8-i-1,h=(1<<l)-1,d=h>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=n?0:s-1,f=n?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+d>=1?e+=p/c:e+=p*Math.pow(2,1-d),e*c>=2&&(o++,c/=2),o+d>=h?(a=0,o=h):o+d>=1?(a=(e*c-1)*Math.pow(2,i),o=o+d):(a=e*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;r[t+m]=a&255,m+=f,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;r[t+m]=o&255,m+=f,o/=256,l-=8);r[t+m-f]|=g*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(r){const e=q3,t=zE,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=a,r.SlowBuffer=w,r.INSPECT_MAX_BYTES=50;const i=2147483647;r.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const D=new Uint8Array(1),S={foo:function(){return 42}};return Object.setPrototypeOf(S,Uint8Array.prototype),Object.setPrototypeOf(D,S),D.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(D){if(D>i)throw new RangeError('The value "'+D+'" is invalid for option "size"');const S=new Uint8Array(D);return Object.setPrototypeOf(S,a.prototype),S}function a(D,S,A){if(typeof D=="number"){if(typeof S=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return d(D)}return c(D,S,A)}a.poolSize=8192;function c(D,S,A){if(typeof D=="string")return p(D,S);if(ArrayBuffer.isView(D))return f(D);if(D==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof D);if(li(D,ArrayBuffer)||D&&li(D.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(li(D,SharedArrayBuffer)||D&&li(D.buffer,SharedArrayBuffer)))return g(D,S,A);if(typeof D=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const M=D.valueOf&&D.valueOf();if(M!=null&&M!==D)return a.from(M,S,A);const P=v(D);if(P)return P;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof D[Symbol.toPrimitive]=="function")return a.from(D[Symbol.toPrimitive]("string"),S,A);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof D)}a.from=function(D,S,A){return c(D,S,A)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function l(D){if(typeof D!="number")throw new TypeError('"size" argument must be of type number');if(D<0)throw new RangeError('The value "'+D+'" is invalid for option "size"')}function h(D,S,A){return l(D),D<=0?o(D):S!==void 0?typeof A=="string"?o(D).fill(S,A):o(D).fill(S):o(D)}a.alloc=function(D,S,A){return h(D,S,A)};function d(D){return l(D),o(D<0?0:y(D)|0)}a.allocUnsafe=function(D){return d(D)},a.allocUnsafeSlow=function(D){return d(D)};function p(D,S){if((typeof S!="string"||S==="")&&(S="utf8"),!a.isEncoding(S))throw new TypeError("Unknown encoding: "+S);const A=b(D,S)|0;let M=o(A);const P=M.write(D,S);return P!==A&&(M=M.slice(0,P)),M}function m(D){const S=D.length<0?0:y(D.length)|0,A=o(S);for(let M=0;M<S;M+=1)A[M]=D[M]&255;return A}function f(D){if(li(D,Uint8Array)){const S=new Uint8Array(D);return g(S.buffer,S.byteOffset,S.byteLength)}return m(D)}function g(D,S,A){if(S<0||D.byteLength<S)throw new RangeError('"offset" is outside of buffer bounds');if(D.byteLength<S+(A||0))throw new RangeError('"length" is outside of buffer bounds');let M;return S===void 0&&A===void 0?M=new Uint8Array(D):A===void 0?M=new Uint8Array(D,S):M=new Uint8Array(D,S,A),Object.setPrototypeOf(M,a.prototype),M}function v(D){if(a.isBuffer(D)){const S=y(D.length)|0,A=o(S);return A.length===0||D.copy(A,0,0,S),A}if(D.length!==void 0)return typeof D.length!="number"||Yd(D.length)?o(0):m(D);if(D.type==="Buffer"&&Array.isArray(D.data))return m(D.data)}function y(D){if(D>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return D|0}function w(D){return+D!=D&&(D=0),a.alloc(+D)}a.isBuffer=function(S){return S!=null&&S._isBuffer===!0&&S!==a.prototype},a.compare=function(S,A){if(li(S,Uint8Array)&&(S=a.from(S,S.offset,S.byteLength)),li(A,Uint8Array)&&(A=a.from(A,A.offset,A.byteLength)),!a.isBuffer(S)||!a.isBuffer(A))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(S===A)return 0;let M=S.length,P=A.length;for(let N=0,R=Math.min(M,P);N<R;++N)if(S[N]!==A[N]){M=S[N],P=A[N];break}return M<P?-1:P<M?1:0},a.isEncoding=function(S){switch(String(S).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(S,A){if(!Array.isArray(S))throw new TypeError('"list" argument must be an Array of Buffers');if(S.length===0)return a.alloc(0);let M;if(A===void 0)for(A=0,M=0;M<S.length;++M)A+=S[M].length;const P=a.allocUnsafe(A);let N=0;for(M=0;M<S.length;++M){let R=S[M];if(li(R,Uint8Array))N+R.length>P.length?(a.isBuffer(R)||(R=a.from(R)),R.copy(P,N)):Uint8Array.prototype.set.call(P,R,N);else if(a.isBuffer(R))R.copy(P,N);else throw new TypeError('"list" argument must be an Array of Buffers');N+=R.length}return P};function b(D,S){if(a.isBuffer(D))return D.length;if(ArrayBuffer.isView(D)||li(D,ArrayBuffer))return D.byteLength;if(typeof D!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof D);const A=D.length,M=arguments.length>2&&arguments[2]===!0;if(!M&&A===0)return 0;let P=!1;for(;;)switch(S){case"ascii":case"latin1":case"binary":return A;case"utf8":case"utf-8":return ia(D).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A*2;case"hex":return A>>>1;case"base64":return zc(D).length;default:if(P)return M?-1:ia(D).length;S=(""+S).toLowerCase(),P=!0}}a.byteLength=b;function E(D,S,A){let M=!1;if((S===void 0||S<0)&&(S=0),S>this.length||((A===void 0||A>this.length)&&(A=this.length),A<=0)||(A>>>=0,S>>>=0,A<=S))return"";for(D||(D="utf8");;)switch(D){case"hex":return B(this,S,A);case"utf8":case"utf-8":return K(this,S,A);case"ascii":return H(this,S,A);case"latin1":case"binary":return O(this,S,A);case"base64":return G(this,S,A);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return W(this,S,A);default:if(M)throw new TypeError("Unknown encoding: "+D);D=(D+"").toLowerCase(),M=!0}}a.prototype._isBuffer=!0;function C(D,S,A){const M=D[S];D[S]=D[A],D[A]=M}a.prototype.swap16=function(){const S=this.length;if(S%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let A=0;A<S;A+=2)C(this,A,A+1);return this},a.prototype.swap32=function(){const S=this.length;if(S%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let A=0;A<S;A+=4)C(this,A,A+3),C(this,A+1,A+2);return this},a.prototype.swap64=function(){const S=this.length;if(S%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let A=0;A<S;A+=8)C(this,A,A+7),C(this,A+1,A+6),C(this,A+2,A+5),C(this,A+3,A+4);return this},a.prototype.toString=function(){const S=this.length;return S===0?"":arguments.length===0?K(this,0,S):E.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(S){if(!a.isBuffer(S))throw new TypeError("Argument must be a Buffer");return this===S?!0:a.compare(this,S)===0},a.prototype.inspect=function(){let S="";const A=r.INSPECT_MAX_BYTES;return S=this.toString("hex",0,A).replace(/(.{2})/g,"$1 ").trim(),this.length>A&&(S+=" ... "),"<Buffer "+S+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(S,A,M,P,N){if(li(S,Uint8Array)&&(S=a.from(S,S.offset,S.byteLength)),!a.isBuffer(S))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof S);if(A===void 0&&(A=0),M===void 0&&(M=S?S.length:0),P===void 0&&(P=0),N===void 0&&(N=this.length),A<0||M>S.length||P<0||N>this.length)throw new RangeError("out of range index");if(P>=N&&A>=M)return 0;if(P>=N)return-1;if(A>=M)return 1;if(A>>>=0,M>>>=0,P>>>=0,N>>>=0,this===S)return 0;let R=N-P,X=M-A;const de=Math.min(R,X),De=this.slice(P,N),Be=S.slice(A,M);for(let ve=0;ve<de;++ve)if(De[ve]!==Be[ve]){R=De[ve],X=Be[ve];break}return R<X?-1:X<R?1:0};function k(D,S,A,M,P){if(D.length===0)return-1;if(typeof A=="string"?(M=A,A=0):A>2147483647?A=2147483647:A<-2147483648&&(A=-2147483648),A=+A,Yd(A)&&(A=P?0:D.length-1),A<0&&(A=D.length+A),A>=D.length){if(P)return-1;A=D.length-1}else if(A<0)if(P)A=0;else return-1;if(typeof S=="string"&&(S=a.from(S,M)),a.isBuffer(S))return S.length===0?-1:x(D,S,A,M,P);if(typeof S=="number")return S=S&255,typeof Uint8Array.prototype.indexOf=="function"?P?Uint8Array.prototype.indexOf.call(D,S,A):Uint8Array.prototype.lastIndexOf.call(D,S,A):x(D,[S],A,M,P);throw new TypeError("val must be string, number or Buffer")}function x(D,S,A,M,P){let N=1,R=D.length,X=S.length;if(M!==void 0&&(M=String(M).toLowerCase(),M==="ucs2"||M==="ucs-2"||M==="utf16le"||M==="utf-16le")){if(D.length<2||S.length<2)return-1;N=2,R/=2,X/=2,A/=2}function de(Be,ve){return N===1?Be[ve]:Be.readUInt16BE(ve*N)}let De;if(P){let Be=-1;for(De=A;De<R;De++)if(de(D,De)===de(S,Be===-1?0:De-Be)){if(Be===-1&&(Be=De),De-Be+1===X)return Be*N}else Be!==-1&&(De-=De-Be),Be=-1}else for(A+X>R&&(A=R-X),De=A;De>=0;De--){let Be=!0;for(let ve=0;ve<X;ve++)if(de(D,De+ve)!==de(S,ve)){Be=!1;break}if(Be)return De}return-1}a.prototype.includes=function(S,A,M){return this.indexOf(S,A,M)!==-1},a.prototype.indexOf=function(S,A,M){return k(this,S,A,M,!0)},a.prototype.lastIndexOf=function(S,A,M){return k(this,S,A,M,!1)};function I(D,S,A,M){A=Number(A)||0;const P=D.length-A;M?(M=Number(M),M>P&&(M=P)):M=P;const N=S.length;M>N/2&&(M=N/2);let R;for(R=0;R<M;++R){const X=parseInt(S.substr(R*2,2),16);if(Yd(X))return R;D[A+R]=X}return R}function T(D,S,A,M){return sa(ia(S,D.length-A),D,A,M)}function L(D,S,A,M){return sa(Su(S),D,A,M)}function V(D,S,A,M){return sa(zc(S),D,A,M)}function U(D,S,A,M){return sa(xu(S,D.length-A),D,A,M)}a.prototype.write=function(S,A,M,P){if(A===void 0)P="utf8",M=this.length,A=0;else if(M===void 0&&typeof A=="string")P=A,M=this.length,A=0;else if(isFinite(A))A=A>>>0,isFinite(M)?(M=M>>>0,P===void 0&&(P="utf8")):(P=M,M=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const N=this.length-A;if((M===void 0||M>N)&&(M=N),S.length>0&&(M<0||A<0)||A>this.length)throw new RangeError("Attempt to write outside buffer bounds");P||(P="utf8");let R=!1;for(;;)switch(P){case"hex":return I(this,S,A,M);case"utf8":case"utf-8":return T(this,S,A,M);case"ascii":case"latin1":case"binary":return L(this,S,A,M);case"base64":return V(this,S,A,M);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,S,A,M);default:if(R)throw new TypeError("Unknown encoding: "+P);P=(""+P).toLowerCase(),R=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function G(D,S,A){return S===0&&A===D.length?e.fromByteArray(D):e.fromByteArray(D.slice(S,A))}function K(D,S,A){A=Math.min(D.length,A);const M=[];let P=S;for(;P<A;){const N=D[P];let R=null,X=N>239?4:N>223?3:N>191?2:1;if(P+X<=A){let de,De,Be,ve;switch(X){case 1:N<128&&(R=N);break;case 2:de=D[P+1],(de&192)===128&&(ve=(N&31)<<6|de&63,ve>127&&(R=ve));break;case 3:de=D[P+1],De=D[P+2],(de&192)===128&&(De&192)===128&&(ve=(N&15)<<12|(de&63)<<6|De&63,ve>2047&&(ve<55296||ve>57343)&&(R=ve));break;case 4:de=D[P+1],De=D[P+2],Be=D[P+3],(de&192)===128&&(De&192)===128&&(Be&192)===128&&(ve=(N&15)<<18|(de&63)<<12|(De&63)<<6|Be&63,ve>65535&&ve<1114112&&(R=ve))}}R===null?(R=65533,X=1):R>65535&&(R-=65536,M.push(R>>>10&1023|55296),R=56320|R&1023),M.push(R),P+=X}return Q(M)}const q=4096;function Q(D){const S=D.length;if(S<=q)return String.fromCharCode.apply(String,D);let A="",M=0;for(;M<S;)A+=String.fromCharCode.apply(String,D.slice(M,M+=q));return A}function H(D,S,A){let M="";A=Math.min(D.length,A);for(let P=S;P<A;++P)M+=String.fromCharCode(D[P]&127);return M}function O(D,S,A){let M="";A=Math.min(D.length,A);for(let P=S;P<A;++P)M+=String.fromCharCode(D[P]);return M}function B(D,S,A){const M=D.length;(!S||S<0)&&(S=0),(!A||A<0||A>M)&&(A=M);let P="";for(let N=S;N<A;++N)P+=z4[D[N]];return P}function W(D,S,A){const M=D.slice(S,A);let P="";for(let N=0;N<M.length-1;N+=2)P+=String.fromCharCode(M[N]+M[N+1]*256);return P}a.prototype.slice=function(S,A){const M=this.length;S=~~S,A=A===void 0?M:~~A,S<0?(S+=M,S<0&&(S=0)):S>M&&(S=M),A<0?(A+=M,A<0&&(A=0)):A>M&&(A=M),A<S&&(A=S);const P=this.subarray(S,A);return Object.setPrototypeOf(P,a.prototype),P};function Y(D,S,A){if(D%1!==0||D<0)throw new RangeError("offset is not uint");if(D+S>A)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(S,A,M){S=S>>>0,A=A>>>0,M||Y(S,A,this.length);let P=this[S],N=1,R=0;for(;++R<A&&(N*=256);)P+=this[S+R]*N;return P},a.prototype.readUintBE=a.prototype.readUIntBE=function(S,A,M){S=S>>>0,A=A>>>0,M||Y(S,A,this.length);let P=this[S+--A],N=1;for(;A>0&&(N*=256);)P+=this[S+--A]*N;return P},a.prototype.readUint8=a.prototype.readUInt8=function(S,A){return S=S>>>0,A||Y(S,1,this.length),this[S]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(S,A){return S=S>>>0,A||Y(S,2,this.length),this[S]|this[S+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(S,A){return S=S>>>0,A||Y(S,2,this.length),this[S]<<8|this[S+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(S,A){return S=S>>>0,A||Y(S,4,this.length),(this[S]|this[S+1]<<8|this[S+2]<<16)+this[S+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(S,A){return S=S>>>0,A||Y(S,4,this.length),this[S]*16777216+(this[S+1]<<16|this[S+2]<<8|this[S+3])},a.prototype.readBigUInt64LE=ps(function(S){S=S>>>0,Dt(S,"offset");const A=this[S],M=this[S+7];(A===void 0||M===void 0)&&rr(S,this.length-8);const P=A+this[++S]*2**8+this[++S]*2**16+this[++S]*2**24,N=this[++S]+this[++S]*2**8+this[++S]*2**16+M*2**24;return BigInt(P)+(BigInt(N)<<BigInt(32))}),a.prototype.readBigUInt64BE=ps(function(S){S=S>>>0,Dt(S,"offset");const A=this[S],M=this[S+7];(A===void 0||M===void 0)&&rr(S,this.length-8);const P=A*2**24+this[++S]*2**16+this[++S]*2**8+this[++S],N=this[++S]*2**24+this[++S]*2**16+this[++S]*2**8+M;return(BigInt(P)<<BigInt(32))+BigInt(N)}),a.prototype.readIntLE=function(S,A,M){S=S>>>0,A=A>>>0,M||Y(S,A,this.length);let P=this[S],N=1,R=0;for(;++R<A&&(N*=256);)P+=this[S+R]*N;return N*=128,P>=N&&(P-=Math.pow(2,8*A)),P},a.prototype.readIntBE=function(S,A,M){S=S>>>0,A=A>>>0,M||Y(S,A,this.length);let P=A,N=1,R=this[S+--P];for(;P>0&&(N*=256);)R+=this[S+--P]*N;return N*=128,R>=N&&(R-=Math.pow(2,8*A)),R},a.prototype.readInt8=function(S,A){return S=S>>>0,A||Y(S,1,this.length),this[S]&128?(255-this[S]+1)*-1:this[S]},a.prototype.readInt16LE=function(S,A){S=S>>>0,A||Y(S,2,this.length);const M=this[S]|this[S+1]<<8;return M&32768?M|4294901760:M},a.prototype.readInt16BE=function(S,A){S=S>>>0,A||Y(S,2,this.length);const M=this[S+1]|this[S]<<8;return M&32768?M|4294901760:M},a.prototype.readInt32LE=function(S,A){return S=S>>>0,A||Y(S,4,this.length),this[S]|this[S+1]<<8|this[S+2]<<16|this[S+3]<<24},a.prototype.readInt32BE=function(S,A){return S=S>>>0,A||Y(S,4,this.length),this[S]<<24|this[S+1]<<16|this[S+2]<<8|this[S+3]},a.prototype.readBigInt64LE=ps(function(S){S=S>>>0,Dt(S,"offset");const A=this[S],M=this[S+7];(A===void 0||M===void 0)&&rr(S,this.length-8);const P=this[S+4]+this[S+5]*2**8+this[S+6]*2**16+(M<<24);return(BigInt(P)<<BigInt(32))+BigInt(A+this[++S]*2**8+this[++S]*2**16+this[++S]*2**24)}),a.prototype.readBigInt64BE=ps(function(S){S=S>>>0,Dt(S,"offset");const A=this[S],M=this[S+7];(A===void 0||M===void 0)&&rr(S,this.length-8);const P=(A<<24)+this[++S]*2**16+this[++S]*2**8+this[++S];return(BigInt(P)<<BigInt(32))+BigInt(this[++S]*2**24+this[++S]*2**16+this[++S]*2**8+M)}),a.prototype.readFloatLE=function(S,A){return S=S>>>0,A||Y(S,4,this.length),t.read(this,S,!0,23,4)},a.prototype.readFloatBE=function(S,A){return S=S>>>0,A||Y(S,4,this.length),t.read(this,S,!1,23,4)},a.prototype.readDoubleLE=function(S,A){return S=S>>>0,A||Y(S,8,this.length),t.read(this,S,!0,52,8)},a.prototype.readDoubleBE=function(S,A){return S=S>>>0,A||Y(S,8,this.length),t.read(this,S,!1,52,8)};function j(D,S,A,M,P,N){if(!a.isBuffer(D))throw new TypeError('"buffer" argument must be a Buffer instance');if(S>P||S<N)throw new RangeError('"value" argument is out of bounds');if(A+M>D.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(S,A,M,P){if(S=+S,A=A>>>0,M=M>>>0,!P){const X=Math.pow(2,8*M)-1;j(this,S,A,M,X,0)}let N=1,R=0;for(this[A]=S&255;++R<M&&(N*=256);)this[A+R]=S/N&255;return A+M},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(S,A,M,P){if(S=+S,A=A>>>0,M=M>>>0,!P){const X=Math.pow(2,8*M)-1;j(this,S,A,M,X,0)}let N=M-1,R=1;for(this[A+N]=S&255;--N>=0&&(R*=256);)this[A+N]=S/R&255;return A+M},a.prototype.writeUint8=a.prototype.writeUInt8=function(S,A,M){return S=+S,A=A>>>0,M||j(this,S,A,1,255,0),this[A]=S&255,A+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(S,A,M){return S=+S,A=A>>>0,M||j(this,S,A,2,65535,0),this[A]=S&255,this[A+1]=S>>>8,A+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(S,A,M){return S=+S,A=A>>>0,M||j(this,S,A,2,65535,0),this[A]=S>>>8,this[A+1]=S&255,A+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(S,A,M){return S=+S,A=A>>>0,M||j(this,S,A,4,4294967295,0),this[A+3]=S>>>24,this[A+2]=S>>>16,this[A+1]=S>>>8,this[A]=S&255,A+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(S,A,M){return S=+S,A=A>>>0,M||j(this,S,A,4,4294967295,0),this[A]=S>>>24,this[A+1]=S>>>16,this[A+2]=S>>>8,this[A+3]=S&255,A+4};function ce(D,S,A,M,P){kt(S,M,P,D,A,7);let N=Number(S&BigInt(4294967295));D[A++]=N,N=N>>8,D[A++]=N,N=N>>8,D[A++]=N,N=N>>8,D[A++]=N;let R=Number(S>>BigInt(32)&BigInt(4294967295));return D[A++]=R,R=R>>8,D[A++]=R,R=R>>8,D[A++]=R,R=R>>8,D[A++]=R,A}function me(D,S,A,M,P){kt(S,M,P,D,A,7);let N=Number(S&BigInt(4294967295));D[A+7]=N,N=N>>8,D[A+6]=N,N=N>>8,D[A+5]=N,N=N>>8,D[A+4]=N;let R=Number(S>>BigInt(32)&BigInt(4294967295));return D[A+3]=R,R=R>>8,D[A+2]=R,R=R>>8,D[A+1]=R,R=R>>8,D[A]=R,A+8}a.prototype.writeBigUInt64LE=ps(function(S,A=0){return ce(this,S,A,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=ps(function(S,A=0){return me(this,S,A,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(S,A,M,P){if(S=+S,A=A>>>0,!P){const de=Math.pow(2,8*M-1);j(this,S,A,M,de-1,-de)}let N=0,R=1,X=0;for(this[A]=S&255;++N<M&&(R*=256);)S<0&&X===0&&this[A+N-1]!==0&&(X=1),this[A+N]=(S/R>>0)-X&255;return A+M},a.prototype.writeIntBE=function(S,A,M,P){if(S=+S,A=A>>>0,!P){const de=Math.pow(2,8*M-1);j(this,S,A,M,de-1,-de)}let N=M-1,R=1,X=0;for(this[A+N]=S&255;--N>=0&&(R*=256);)S<0&&X===0&&this[A+N+1]!==0&&(X=1),this[A+N]=(S/R>>0)-X&255;return A+M},a.prototype.writeInt8=function(S,A,M){return S=+S,A=A>>>0,M||j(this,S,A,1,127,-128),S<0&&(S=255+S+1),this[A]=S&255,A+1},a.prototype.writeInt16LE=function(S,A,M){return S=+S,A=A>>>0,M||j(this,S,A,2,32767,-32768),this[A]=S&255,this[A+1]=S>>>8,A+2},a.prototype.writeInt16BE=function(S,A,M){return S=+S,A=A>>>0,M||j(this,S,A,2,32767,-32768),this[A]=S>>>8,this[A+1]=S&255,A+2},a.prototype.writeInt32LE=function(S,A,M){return S=+S,A=A>>>0,M||j(this,S,A,4,2147483647,-2147483648),this[A]=S&255,this[A+1]=S>>>8,this[A+2]=S>>>16,this[A+3]=S>>>24,A+4},a.prototype.writeInt32BE=function(S,A,M){return S=+S,A=A>>>0,M||j(this,S,A,4,2147483647,-2147483648),S<0&&(S=4294967295+S+1),this[A]=S>>>24,this[A+1]=S>>>16,this[A+2]=S>>>8,this[A+3]=S&255,A+4},a.prototype.writeBigInt64LE=ps(function(S,A=0){return ce(this,S,A,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=ps(function(S,A=0){return me(this,S,A,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function he(D,S,A,M,P,N){if(A+M>D.length)throw new RangeError("Index out of range");if(A<0)throw new RangeError("Index out of range")}function ue(D,S,A,M,P){return S=+S,A=A>>>0,P||he(D,S,A,4),t.write(D,S,A,M,23,4),A+4}a.prototype.writeFloatLE=function(S,A,M){return ue(this,S,A,!0,M)},a.prototype.writeFloatBE=function(S,A,M){return ue(this,S,A,!1,M)};function Ne(D,S,A,M,P){return S=+S,A=A>>>0,P||he(D,S,A,8),t.write(D,S,A,M,52,8),A+8}a.prototype.writeDoubleLE=function(S,A,M){return Ne(this,S,A,!0,M)},a.prototype.writeDoubleBE=function(S,A,M){return Ne(this,S,A,!1,M)},a.prototype.copy=function(S,A,M,P){if(!a.isBuffer(S))throw new TypeError("argument should be a Buffer");if(M||(M=0),!P&&P!==0&&(P=this.length),A>=S.length&&(A=S.length),A||(A=0),P>0&&P<M&&(P=M),P===M||S.length===0||this.length===0)return 0;if(A<0)throw new RangeError("targetStart out of bounds");if(M<0||M>=this.length)throw new RangeError("Index out of range");if(P<0)throw new RangeError("sourceEnd out of bounds");P>this.length&&(P=this.length),S.length-A<P-M&&(P=S.length-A+M);const N=P-M;return this===S&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(A,M,P):Uint8Array.prototype.set.call(S,this.subarray(M,P),A),N},a.prototype.fill=function(S,A,M,P){if(typeof S=="string"){if(typeof A=="string"?(P=A,A=0,M=this.length):typeof M=="string"&&(P=M,M=this.length),P!==void 0&&typeof P!="string")throw new TypeError("encoding must be a string");if(typeof P=="string"&&!a.isEncoding(P))throw new TypeError("Unknown encoding: "+P);if(S.length===1){const R=S.charCodeAt(0);(P==="utf8"&&R<128||P==="latin1")&&(S=R)}}else typeof S=="number"?S=S&255:typeof S=="boolean"&&(S=Number(S));if(A<0||this.length<A||this.length<M)throw new RangeError("Out of range index");if(M<=A)return this;A=A>>>0,M=M===void 0?this.length:M>>>0,S||(S=0);let N;if(typeof S=="number")for(N=A;N<M;++N)this[N]=S;else{const R=a.isBuffer(S)?S:a.from(S,P),X=R.length;if(X===0)throw new TypeError('The value "'+S+'" is invalid for argument "value"');for(N=0;N<M-A;++N)this[N+A]=R[N%X]}return this};const Me={};function Xe(D,S,A){Me[D]=class extends A{constructor(){super(),Object.defineProperty(this,"message",{value:S.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${D}]`,this.stack,delete this.name}get code(){return D}set code(P){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:P,writable:!0})}toString(){return`${this.name} [${D}]: ${this.message}`}}}Xe("ERR_BUFFER_OUT_OF_BOUNDS",function(D){return D?`${D} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Xe("ERR_INVALID_ARG_TYPE",function(D,S){return`The "${D}" argument must be of type number. Received type ${typeof S}`},TypeError),Xe("ERR_OUT_OF_RANGE",function(D,S,A){let M=`The value of "${D}" is out of range.`,P=A;return Number.isInteger(A)&&Math.abs(A)>2**32?P=it(String(A)):typeof A=="bigint"&&(P=String(A),(A>BigInt(2)**BigInt(32)||A<-(BigInt(2)**BigInt(32)))&&(P=it(P)),P+="n"),M+=` It must be ${S}. Received ${P}`,M},RangeError);function it(D){let S="",A=D.length;const M=D[0]==="-"?1:0;for(;A>=M+4;A-=3)S=`_${D.slice(A-3,A)}${S}`;return`${D.slice(0,A)}${S}`}function It(D,S,A){Dt(S,"offset"),(D[S]===void 0||D[S+A]===void 0)&&rr(S,D.length-(A+1))}function kt(D,S,A,M,P,N){if(D>A||D<S){const R=typeof S=="bigint"?"n":"";let X;throw S===0||S===BigInt(0)?X=`>= 0${R} and < 2${R} ** ${(N+1)*8}${R}`:X=`>= -(2${R} ** ${(N+1)*8-1}${R}) and < 2 ** ${(N+1)*8-1}${R}`,new Me.ERR_OUT_OF_RANGE("value",X,D)}It(M,P,N)}function Dt(D,S){if(typeof D!="number")throw new Me.ERR_INVALID_ARG_TYPE(S,"number",D)}function rr(D,S,A){throw Math.floor(D)!==D?(Dt(D,A),new Me.ERR_OUT_OF_RANGE("offset","an integer",D)):S<0?new Me.ERR_BUFFER_OUT_OF_BOUNDS:new Me.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${S}`,D)}const Xr=/[^+/0-9A-Za-z-_]/g;function Fc(D){if(D=D.split("=")[0],D=D.trim().replace(Xr,""),D.length<2)return"";for(;D.length%4!==0;)D=D+"=";return D}function ia(D,S){S=S||1/0;let A;const M=D.length;let P=null;const N=[];for(let R=0;R<M;++R){if(A=D.charCodeAt(R),A>55295&&A<57344){if(!P){if(A>56319){(S-=3)>-1&&N.push(239,191,189);continue}else if(R+1===M){(S-=3)>-1&&N.push(239,191,189);continue}P=A;continue}if(A<56320){(S-=3)>-1&&N.push(239,191,189),P=A;continue}A=(P-55296<<10|A-56320)+65536}else P&&(S-=3)>-1&&N.push(239,191,189);if(P=null,A<128){if((S-=1)<0)break;N.push(A)}else if(A<2048){if((S-=2)<0)break;N.push(A>>6|192,A&63|128)}else if(A<65536){if((S-=3)<0)break;N.push(A>>12|224,A>>6&63|128,A&63|128)}else if(A<1114112){if((S-=4)<0)break;N.push(A>>18|240,A>>12&63|128,A>>6&63|128,A&63|128)}else throw new Error("Invalid code point")}return N}function Su(D){const S=[];for(let A=0;A<D.length;++A)S.push(D.charCodeAt(A)&255);return S}function xu(D,S){let A,M,P;const N=[];for(let R=0;R<D.length&&!((S-=2)<0);++R)A=D.charCodeAt(R),M=A>>8,P=A%256,N.push(P),N.push(M);return N}function zc(D){return e.toByteArray(Fc(D))}function sa(D,S,A,M){let P;for(P=0;P<M&&!(P+A>=S.length||P>=D.length);++P)S[P+A]=D[P];return P}function li(D,S){return D instanceof S||D!=null&&D.constructor!=null&&D.constructor.name!=null&&D.constructor.name===S.name}function Yd(D){return D!==D}const z4=function(){const D="0123456789abcdef",S=new Array(256);for(let A=0;A<16;++A){const M=A*16;for(let P=0;P<16;++P)S[M+P]=D[A]+D[P]}return S}();function ps(D){return typeof BigInt>"u"?Vc:D}function Vc(){throw new Error("BigInt not supported")}})(j3);let E8=null;var IL=function(){return E8===null&&(E8={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),E8},Mp={},VE={};const S8=Hs,bJ=new Set(["buffer","view","utf8"]);let vJ=class{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!bJ.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new S8(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new S8(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new S8(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};VE.Encoding=vJ;const{Buffer:KE}=j3||{},{Encoding:HE}=VE,EJ=IL;let jE=class extends HE{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new qE({encode:this.encode,decode:e=>this.decode(KE.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},qE=class extends HE{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new jE({encode:e=>{const t=this.encode(e);return KE.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},SJ=class extends HE{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new jE({encode:e=>KE.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){const{textEncoder:e,textDecoder:t}=EJ();return new qE({encode:n=>e.encode(this.encode(n)),decode:n=>this.decode(t.decode(n)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};Mp.BufferFormat=jE;Mp.ViewFormat=qE;Mp.UTF8Format=SJ;const{Buffer:Gr}=j3||{Buffer:{isBuffer:()=>!1}},{textEncoder:kL,textDecoder:dI}=IL(),{BufferFormat:Op,ViewFormat:WE,UTF8Format:_L}=Mp,J2=r=>r;yu.utf8=new _L({encode:function(r){return Gr.isBuffer(r)?r.toString("utf8"):ArrayBuffer.isView(r)?dI.decode(r):String(r)},decode:J2,name:"utf8",createViewTranscoder(){return new WE({encode:function(r){return ArrayBuffer.isView(r)?r:kL.encode(r)},decode:function(r){return dI.decode(r)},name:`${this.name}+view`})},createBufferTranscoder(){return new Op({encode:function(r){return Gr.isBuffer(r)?r:ArrayBuffer.isView(r)?Gr.from(r.buffer,r.byteOffset,r.byteLength):Gr.from(String(r),"utf8")},decode:function(r){return r.toString("utf8")},name:`${this.name}+buffer`})}});yu.json=new _L({encode:JSON.stringify,decode:JSON.parse,name:"json"});yu.buffer=new Op({encode:function(r){return Gr.isBuffer(r)?r:ArrayBuffer.isView(r)?Gr.from(r.buffer,r.byteOffset,r.byteLength):Gr.from(String(r),"utf8")},decode:J2,name:"buffer",createViewTranscoder(){return new WE({encode:function(r){return ArrayBuffer.isView(r)?r:Gr.from(String(r),"utf8")},decode:function(r){return Gr.from(r.buffer,r.byteOffset,r.byteLength)},name:`${this.name}+view`})}});yu.view=new WE({encode:function(r){return ArrayBuffer.isView(r)?r:kL.encode(r)},decode:J2,name:"view",createBufferTranscoder(){return new Op({encode:function(r){return Gr.isBuffer(r)?r:ArrayBuffer.isView(r)?Gr.from(r.buffer,r.byteOffset,r.byteLength):Gr.from(String(r),"utf8")},decode:J2,name:`${this.name}+buffer`})}});yu.hex=new Op({encode:function(r){return Gr.isBuffer(r)?r:Gr.from(String(r),"hex")},decode:function(r){return r.toString("hex")},name:"hex"});yu.base64=new Op({encode:function(r){return Gr.isBuffer(r)?r:Gr.from(String(r),"base64")},decode:function(r){return r.toString("base64")},name:"base64"});const fI=Hs,Z2=yu,{Encoding:xJ}=VE,{BufferFormat:AJ,ViewFormat:CJ,UTF8Format:IJ}=Mp,cf=Symbol("formats"),M0=Symbol("encodings"),kJ=new Set(["buffer","view","utf8"]);let _J=class{constructor(e){if(Array.isArray(e)){if(!e.every(t=>kJ.has(t)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[M0]=new Map,this[cf]=new Set(e);for(const t in Z2)try{this.encoding(t)}catch(n){if(n.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw n}}encodings(){return Array.from(new Set(this[M0].values()))}encoding(e){let t=this[M0].get(e);if(t===void 0){if(typeof e=="string"&&e!==""){if(t=$J[e],!t)throw new fI(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof e!="object"||e===null)throw new TypeError("First argument 'encoding' must be a string or object");t=TJ(e)}const{name:n,format:i}=t;if(!this[cf].has(i))if(this[cf].has("view"))t=t.createViewTranscoder();else if(this[cf].has("buffer"))t=t.createBufferTranscoder();else if(this[cf].has("utf8"))t=t.createUTF8Transcoder();else throw new fI(`Encoding '${n}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(const s of[e,n,t.name,t.commonName])this[M0].set(s,t)}return t}};AL.Transcoder=_J;function TJ(r){if(r instanceof xJ)return r;const e="type"in r&&typeof r.type=="string"?r.type:void 0,t=r.name||e||`anonymous-${NJ++}`;switch(PJ(r)){case"view":return new CJ({...r,name:t});case"utf8":return new IJ({...r,name:t});case"buffer":return new AJ({...r,name:t});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function PJ(r){return"format"in r&&r.format!==void 0?r.format:"buffer"in r&&typeof r.buffer=="boolean"?r.buffer?"buffer":"utf8":"code"in r&&Number.isInteger(r.code)?"view":"buffer"}const DJ={binary:Z2.buffer,"utf-8":Z2.utf8},$J={...Z2,...DJ};let NJ=0;var Dd={},MJ=typeof queueMicrotask=="function"?queueMicrotask:r=>Promise.resolve().then(r),pI=MJ;Dd.fromCallback=function(r,e){if(r===void 0){var t=new Promise(function(n,i){r=function(s,o){s?i(s):n(o)}});r[e!==void 0?e:"promise"]=t}else if(typeof r!="function")throw new TypeError("Callback must be a function");return r};Dd.fromPromise=function(r,e){if(e===void 0)return r;r.then(function(t){pI(()=>e(null,t))}).catch(function(t){pI(()=>e(t))})};var js={},Rp={};Rp.getCallback=function(r,e){return typeof r=="function"?r:e};Rp.getOptions=function(r,e){return typeof r=="object"&&r!==null?r:e!==void 0?e:{}};const{fromCallback:x8}=Dd,Fn=Hs,{getOptions:A8,getCallback:gI}=Rp,Kc=Symbol("promise"),Iu=Symbol("callback"),ms=Symbol("working"),fl=Symbol("handleOne"),uo=Symbol("handleMany"),C8=Symbol("autoClose"),yc=Symbol("finishWork"),Os=Symbol("returnMany"),ca=Symbol("closing"),lf=Symbol("handleClose"),O0=Symbol("closed"),uf=Symbol("closeCallbacks"),oc=Symbol("keyEncoding"),Fl=Symbol("valueEncoding"),I8=Symbol("abortOnClose"),R0=Symbol("legacy"),k8=Symbol("keys"),_8=Symbol("values"),la=Symbol("limit"),bi=Symbol("count"),L0=Object.freeze({}),OJ=()=>{};let yI=!1;class GE{constructor(e,t,n){if(typeof e!="object"||e===null){const i=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${i}`)}if(typeof t!="object"||t===null)throw new TypeError("The second argument must be an options object");this[O0]=!1,this[uf]=[],this[ms]=!1,this[ca]=!1,this[C8]=!1,this[Iu]=null,this[fl]=this[fl].bind(this),this[uo]=this[uo].bind(this),this[lf]=this[lf].bind(this),this[oc]=t[oc],this[Fl]=t[Fl],this[R0]=n,this[la]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[bi]=0,this[I8]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[bi]}get limit(){return this[la]}next(e){let t;if(e===void 0)t=new Promise((n,i)=>{e=(s,o,a)=>{s?i(s):this[R0]?o===void 0&&a===void 0?n():n([o,a]):n(o)}});else if(typeof e!="function")throw new TypeError("Callback must be a function");return this[ca]?this.nextTick(e,new Fn("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[ms]?this.nextTick(e,new Fn("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[ms]=!0,this[Iu]=e,this[bi]>=this[la]?this.nextTick(this[fl],null):this._next(this[fl])),t}_next(e){this.nextTick(e)}nextv(e,t,n){return n=gI(t,n),n=x8(n,Kc),t=A8(t,L0),Number.isInteger(e)?(this[ca]?this.nextTick(n,new Fn("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[ms]?this.nextTick(n,new Fn("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[la]<1/0&&(e=Math.min(e,this[la]-this[bi])),this[ms]=!0,this[Iu]=n,e<=0?this.nextTick(this[uo],null,[]):this._nextv(e,t,this[uo])),n[Kc]):(this.nextTick(n,new TypeError("The first argument 'size' must be an integer")),n[Kc])}_nextv(e,t,n){const i=[],s=(o,a,c)=>{if(o)return n(o);if(this[R0]?a===void 0&&c===void 0:a===void 0)return n(null,i);i.push(this[R0]?[a,c]:a),i.length===e?n(null,i):this._next(s)};this._next(s)}all(e,t){return t=gI(e,t),t=x8(t,Kc),e=A8(e,L0),this[ca]?this.nextTick(t,new Fn("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[ms]?this.nextTick(t,new Fn("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[ms]=!0,this[Iu]=t,this[C8]=!0,this[bi]>=this[la]?this.nextTick(this[uo],null,[]):this._all(e,this[uo])),t[Kc]}_all(e,t){let n=this[bi];const i=[],s=()=>{const a=this[la]<1/0?Math.min(1e3,this[la]-n):1e3;a<=0?this.nextTick(t,null,i):this._nextv(a,L0,o)},o=(a,c)=>{a?t(a):c.length===0?t(null,i):(i.push.apply(i,c),n+=c.length,s())};s()}[yc](){const e=this[Iu];return this[I8]&&e===null?OJ:(this[ms]=!1,this[Iu]=null,this[ca]&&this._close(this[lf]),e)}[Os](e,t,n){this[C8]?this.close(e.bind(null,t,n)):e(t,n)}seek(e,t){if(t=A8(t,L0),!this[ca]){if(this[ms])throw new Fn("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const n=this.db.keyEncoding(t.keyEncoding||this[oc]),i=n.format;t.keyEncoding!==i&&(t={...t,keyEncoding:i});const s=this.db.prefixKey(n.encode(e),i);this._seek(s,t)}}}_seek(e,t){throw new Fn("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){return e=x8(e,Kc),this[O0]?this.nextTick(e):this[ca]?this[uf].push(e):(this[ca]=!0,this[uf].push(e),this[ms]?this[I8]&&this[yc]()(new Fn("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[lf])),e[Kc]}_close(e){this.nextTick(e)}[lf](){this[O0]=!0,this.db.detachResource(this);const e=this[uf];this[uf]=[];for(const t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;(e=await this.next())!==void 0;)yield e}finally{this[O0]||await this.close()}}}let W3=class extends GE{constructor(e,t){super(e,t,!0),this[k8]=t.keys!==!1,this[_8]=t.values!==!1}[fl](e,t,n){const i=this[yc]();if(e)return i(e);try{t=this[k8]&&t!==void 0?this[oc].decode(t):void 0,n=this[_8]&&n!==void 0?this[Fl].decode(n):void 0}catch(s){return i(new Fh("entry",s))}t===void 0&&n===void 0||this[bi]++,i(null,t,n)}[uo](e,t){const n=this[yc]();if(e)return this[Os](n,e);try{for(const i of t){const s=i[0],o=i[1];i[0]=this[k8]&&s!==void 0?this[oc].decode(s):void 0,i[1]=this[_8]&&o!==void 0?this[Fl].decode(o):void 0}}catch(i){return this[Os](n,new Fh("entries",i))}this[bi]+=t.length,this[Os](n,null,t)}end(e){return!yI&&typeof console<"u"&&(yI=!0,console.warn(new Fn("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}},RJ=class extends GE{constructor(e,t){super(e,t,!1)}[fl](e,t){const n=this[yc]();if(e)return n(e);try{t=t!==void 0?this[oc].decode(t):void 0}catch(i){return n(new Fh("key",i))}t!==void 0&&this[bi]++,n(null,t)}[uo](e,t){const n=this[yc]();if(e)return this[Os](n,e);try{for(let i=0;i<t.length;i++){const s=t[i];t[i]=s!==void 0?this[oc].decode(s):void 0}}catch(i){return this[Os](n,new Fh("keys",i))}this[bi]+=t.length,this[Os](n,null,t)}},LJ=class extends GE{constructor(e,t){super(e,t,!1)}[fl](e,t){const n=this[yc]();if(e)return n(e);try{t=t!==void 0?this[Fl].decode(t):void 0}catch(i){return n(new Fh("value",i))}t!==void 0&&this[bi]++,n(null,t)}[uo](e,t){const n=this[yc]();if(e)return this[Os](n,e);try{for(let i=0;i<t.length;i++){const s=t[i];t[i]=s!==void 0?this[Fl].decode(s):void 0}}catch(i){return this[Os](n,new Fh("values",i))}this[bi]+=t.length,this[Os](n,null,t)}};class Fh extends Fn{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}}for(const r of["_ended property","_nexting property","_end method"])Object.defineProperty(W3.prototype,r.split(" ")[0],{get(){throw new Fn(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new Fn(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})}});W3.keyEncoding=oc;W3.valueEncoding=Fl;js.AbstractIterator=W3;js.AbstractKeyIterator=RJ;js.AbstractValueIterator=LJ;var QE={};const{AbstractKeyIterator:BJ,AbstractValueIterator:UJ}=js,nl=Symbol("iterator"),hf=Symbol("callback"),zh=Symbol("handleOne"),Il=Symbol("handleMany");let lb=class extends BJ{constructor(e,t){super(e,t),this[nl]=e.iterator({...t,keys:!0,values:!1}),this[zh]=this[zh].bind(this),this[Il]=this[Il].bind(this)}},TL=class extends UJ{constructor(e,t){super(e,t),this[nl]=e.iterator({...t,keys:!1,values:!0}),this[zh]=this[zh].bind(this),this[Il]=this[Il].bind(this)}};for(const r of[lb,TL]){const e=r===lb,t=e?n=>n[0]:n=>n[1];r.prototype._next=function(n){this[hf]=n,this[nl].next(this[zh])},r.prototype[zh]=function(n,i,s){const o=this[hf];n?o(n):o(null,e?i:s)},r.prototype._nextv=function(n,i,s){this[hf]=s,this[nl].nextv(n,i,this[Il])},r.prototype._all=function(n,i){this[hf]=i,this[nl].all(n,this[Il])},r.prototype[Il]=function(n,i){const s=this[hf];n?s(n):s(null,i.map(t))},r.prototype._seek=function(n,i){this[nl].seek(n,i)},r.prototype._close=function(n){this[nl].close(n)}}QE.DefaultKeyIterator=lb;QE.DefaultValueIterator=TL;var G3={};const{AbstractIterator:FJ,AbstractKeyIterator:zJ,AbstractValueIterator:VJ}=js,T8=Hs,pn=Symbol("nut"),Q3=Symbol("undefer"),Y3=Symbol("factory");let PL=class extends FJ{constructor(e,t){super(e,t),this[pn]=null,this[Y3]=()=>e.iterator(t),this.db.defer(()=>this[Q3]())}},DL=class extends zJ{constructor(e,t){super(e,t),this[pn]=null,this[Y3]=()=>e.keys(t),this.db.defer(()=>this[Q3]())}},$L=class extends VJ{constructor(e,t){super(e,t),this[pn]=null,this[Y3]=()=>e.values(t),this.db.defer(()=>this[Q3]())}};for(const r of[PL,DL,$L])r.prototype[Q3]=function(){this.db.status==="open"&&(this[pn]=this[Y3]())},r.prototype._next=function(e){this[pn]!==null?this[pn].next(e):this.db.status==="opening"?this.db.defer(()=>this._next(e)):this.nextTick(e,new T8("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._nextv=function(e,t,n){this[pn]!==null?this[pn].nextv(e,t,n):this.db.status==="opening"?this.db.defer(()=>this._nextv(e,t,n)):this.nextTick(n,new T8("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._all=function(e,t){this[pn]!==null?this[pn].all(t):this.db.status==="opening"?this.db.defer(()=>this._all(e,t)):this.nextTick(t,new T8("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._seek=function(e,t){this[pn]!==null?this[pn]._seek(e,t):this.db.status==="opening"&&this.db.defer(()=>this._seek(e,t))},r.prototype._close=function(e){this[pn]!==null?this[pn].close(e):this.db.status==="opening"?this.db.defer(()=>this._close(e)):this.nextTick(e)};G3.DeferredIterator=PL;G3.DeferredKeyIterator=DL;G3.DeferredValueIterator=$L;var NL={},YE={};const{fromCallback:mI}=Dd,B0=Hs,{getCallback:KJ,getOptions:HJ}=Rp,U0=Symbol("promise"),ui=Symbol("status"),ku=Symbol("operations"),df=Symbol("finishClose"),_u=Symbol("closeCallbacks");let jJ=class{constructor(e){if(typeof e!="object"||e===null){const t=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${t}`)}this[ku]=[],this[_u]=[],this[ui]="open",this[df]=this[df].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[ku].length}put(e,t,n){if(this[ui]!=="open")throw new B0("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const i=this.db._checkKey(e)||this.db._checkValue(t);if(i)throw i;const s=n&&n.sublevel!=null?n.sublevel:this.db,o=n,a=s.keyEncoding(n&&n.keyEncoding),c=s.valueEncoding(n&&n.valueEncoding),l=a.format;n={...n,keyEncoding:l,valueEncoding:c.format},s!==this.db&&(n.sublevel=null);const h=s.prefixKey(a.encode(e),l),d=c.encode(t);return this._put(h,d,n),this[ku].push({...o,type:"put",key:e,value:t}),this}_put(e,t,n){}del(e,t){if(this[ui]!=="open")throw new B0("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const n=this.db._checkKey(e);if(n)throw n;const i=t&&t.sublevel!=null?t.sublevel:this.db,s=t,o=i.keyEncoding(t&&t.keyEncoding),a=o.format;return t={...t,keyEncoding:a},i!==this.db&&(t.sublevel=null),this._del(i.prefixKey(o.encode(e),a),t),this[ku].push({...s,type:"del",key:e}),this}_del(e,t){}clear(){if(this[ui]!=="open")throw new B0("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[ku]=[],this}_clear(){}write(e,t){return t=KJ(e,t),t=mI(t,U0),e=HJ(e),this[ui]!=="open"?this.nextTick(t,new B0("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(t):(this[ui]="writing",this._write(e,n=>{this[ui]="closing",this[_u].push(()=>t(n)),n||this.db.emit("batch",this[ku]),this._close(this[df])})),t[U0]}_write(e,t){}close(e){return e=mI(e,U0),this[ui]==="closing"?this[_u].push(e):this[ui]==="closed"?this.nextTick(e):(this[_u].push(e),this[ui]!=="writing"&&(this[ui]="closing",this._close(this[df]))),e[U0]}_close(e){this.nextTick(e)}[df](){this[ui]="closed",this.db.detachResource(this);const e=this[_u];this[_u]=[];for(const t of e)t()}};YE.AbstractChainedBatch=jJ;const{AbstractChainedBatch:qJ}=YE,WJ=Hs,Tu=Symbol("encoded");let GJ=class extends qJ{constructor(e){super(e),this[Tu]=[]}_put(e,t,n){this[Tu].push({...n,type:"put",key:e,value:t})}_del(e,t){this[Tu].push({...t,type:"del",key:e})}_clear(){this[Tu]=[]}_write(e,t){this.db.status==="opening"?this.db.defer(()=>this._write(e,t)):this.db.status==="open"?this[Tu].length===0?this.nextTick(t):this.db._batch(this[Tu],e,t):this.nextTick(t,new WJ("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};NL.DefaultChainedBatch=GJ;const wI=Hs,QJ=Object.prototype.hasOwnProperty,YJ=new Set(["lt","lte","gt","gte"]);var XJ=function(r,e){const t={};for(const n in r)if(QJ.call(r,n)&&!(n==="keyEncoding"||n==="valueEncoding")){if(n==="start"||n==="end")throw new wI(`The legacy range option '${n}' has been removed`,{code:"LEVEL_LEGACY"});if(n==="encoding")throw new wI("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});YJ.has(n)?t[n]=e.encode(r[n]):t[n]=r[n]}return t.reverse=!!t.reverse,t.limit=Number.isInteger(t.limit)&&t.limit>=0?t.limit:-1,t};/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let bI;var ML=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:v1):r=>(bI||(bI=Promise.resolve())).then(r).catch(e=>setTimeout(()=>{throw e},0)),P8,vI;function JJ(){if(vI)return P8;vI=1;const r=ML;return P8=function(e,...t){t.length===0?r(e):r(()=>e(...t))},P8}var ff={},EI;function ZJ(){if(EI)return ff;EI=1;const{AbstractIterator:r,AbstractKeyIterator:e,AbstractValueIterator:t}=js,n=Symbol("unfix"),i=Symbol("iterator"),s=Symbol("handleOne"),o=Symbol("handleMany"),a=Symbol("callback");class c extends r{constructor(p,m,f,g){super(p,m),this[i]=f,this[n]=g,this[s]=this[s].bind(this),this[o]=this[o].bind(this),this[a]=null}[s](p,m,f){const g=this[a];if(p)return g(p);m!==void 0&&(m=this[n](m)),g(p,m,f)}[o](p,m){const f=this[a];if(p)return f(p);for(const g of m){const v=g[0];v!==void 0&&(g[0]=this[n](v))}f(p,m)}}class l extends e{constructor(p,m,f,g){super(p,m),this[i]=f,this[n]=g,this[s]=this[s].bind(this),this[o]=this[o].bind(this),this[a]=null}[s](p,m){const f=this[a];if(p)return f(p);m!==void 0&&(m=this[n](m)),f(p,m)}[o](p,m){const f=this[a];if(p)return f(p);for(let g=0;g<m.length;g++){const v=m[g];v!==void 0&&(m[g]=this[n](v))}f(p,m)}}class h extends t{constructor(p,m,f){super(p,m),this[i]=f}}for(const d of[c,l])d.prototype._next=function(p){this[a]=p,this[i].next(this[s])},d.prototype._nextv=function(p,m,f){this[a]=f,this[i].nextv(p,m,this[o])},d.prototype._all=function(p,m){this[a]=m,this[i].all(p,this[o])};for(const d of[h])d.prototype._next=function(p){this[i].next(p)},d.prototype._nextv=function(p,m,f){this[i].nextv(p,m,f)},d.prototype._all=function(p,m){this[i].all(p,m)};for(const d of[c,l,h])d.prototype._seek=function(p,m){this[i].seek(p,m)},d.prototype._close=function(p){this[i].close(p)};return ff.AbstractSublevelIterator=c,ff.AbstractSublevelKeyIterator=l,ff.AbstractSublevelValueIterator=h,ff}var D8,SI;function eZ(){if(SI)return D8;SI=1;const r=Hs,{Buffer:e}=j3||{},{AbstractSublevelIterator:t,AbstractSublevelKeyIterator:n,AbstractSublevelValueIterator:i}=ZJ(),s=Symbol("prefix"),o=Symbol("upperBound"),a=Symbol("prefixRange"),c=Symbol("parent"),l=Symbol("unfix"),h=new TextEncoder,d={separator:"!"};D8=function({AbstractLevel:y}){class w extends y{static defaults(E){if(typeof E=="string")throw new r("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(E&&E.open)throw new r("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return E==null?d:E.separator?E:{...E,separator:"!"}}constructor(E,C,k){const{separator:x,manifest:I,...T}=w.defaults(k);C=v(C,x);const L=x.charCodeAt(0)+1,V=E[c]||E;if(!h.encode(C).every(K=>K>L&&K<127))throw new r(`Prefix must use bytes > ${L} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(p(V,I),T);const U=(E.prefix||"")+x+C+x,G=U.slice(0,-1)+String.fromCharCode(L);this[c]=V,this[s]=new f(U),this[o]=new f(G),this[l]=new g,this.nextTick=V.nextTick}prefixKey(E,C){if(C==="utf8")return this[s].utf8+E;if(E.byteLength===0)return this[s][C];if(C==="view"){const k=this[s].view,x=new Uint8Array(k.byteLength+E.byteLength);return x.set(k,0),x.set(E,k.byteLength),x}else{const k=this[s].buffer;return e.concat([k,E],k.byteLength+E.byteLength)}}[a](E,C){E.gte!==void 0?E.gte=this.prefixKey(E.gte,C):E.gt!==void 0?E.gt=this.prefixKey(E.gt,C):E.gte=this[s][C],E.lte!==void 0?E.lte=this.prefixKey(E.lte,C):E.lt!==void 0?E.lt=this.prefixKey(E.lt,C):E.lte=this[o][C]}get prefix(){return this[s].utf8}get db(){return this[c]}_open(E,C){this[c].open({passive:!0},C)}_put(E,C,k,x){this[c].put(E,C,k,x)}_get(E,C,k){this[c].get(E,C,k)}_getMany(E,C,k){this[c].getMany(E,C,k)}_del(E,C,k){this[c].del(E,C,k)}_batch(E,C,k){this[c].batch(E,C,k)}_clear(E,C){this[a](E,E.keyEncoding),this[c].clear(E,C)}_iterator(E){this[a](E,E.keyEncoding);const C=this[c].iterator(E),k=this[l].get(this[s].utf8.length,E.keyEncoding);return new t(this,E,C,k)}_keys(E){this[a](E,E.keyEncoding);const C=this[c].keys(E),k=this[l].get(this[s].utf8.length,E.keyEncoding);return new n(this,E,C,k)}_values(E){this[a](E,E.keyEncoding);const C=this[c].values(E);return new i(this,E,C)}}return{AbstractSublevel:w}};const p=function(y,w){return{...y.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...w,encodings:{utf8:m(y,"utf8"),buffer:m(y,"buffer"),view:m(y,"view")}}},m=function(y,w){return y.supports.encodings[w]?y.keyEncoding(w).name===w:!1};class f{constructor(w){this.utf8=w,this.view=h.encode(w),this.buffer=e?e.from(this.view.buffer,0,this.view.byteLength):{}}}class g{constructor(){this.cache=new Map}get(w,b){let E=this.cache.get(b);return E===void 0&&(b==="view"?E=(function(C,k){return k.subarray(C)}).bind(null,w):E=(function(C,k){return k.slice(C)}).bind(null,w),this.cache.set(b,E)),E}}const v=function(y,w){let b=0,E=y.length;for(;b<E&&y[b]===w;)b++;for(;E>b&&y[E-1]===w;)E--;return y.slice(b,E)};return D8}const{supports:tZ}=xL,{Transcoder:rZ}=AL,{EventEmitter:nZ}=N3,{fromCallback:ua}=Dd,Ki=Hs,{AbstractIterator:Hc}=js,{DefaultKeyIterator:iZ,DefaultValueIterator:sZ}=QE,{DeferredIterator:oZ,DeferredKeyIterator:aZ,DeferredValueIterator:cZ}=G3,{DefaultChainedBatch:xI}=NL,{getCallback:jc,getOptions:ha}=Rp,F0=XJ,Fe=Symbol("promise"),Ys=Symbol("landed"),qc=Symbol("resources"),$8=Symbol("closeResources"),pf=Symbol("operations"),gf=Symbol("undefer"),z0=Symbol("deferOpen"),AI=Symbol("options"),Ve=Symbol("status"),Wc=Symbol("defaultOptions"),Pu=Symbol("transcoder"),V0=Symbol("keyEncoding"),N8=Symbol("valueEncoding"),lZ=()=>{};let XE=class extends nZ{constructor(e,t){if(super(),typeof e!="object"||e===null)throw new TypeError("The first argument 'manifest' must be an object");t=ha(t);const{keyEncoding:n,valueEncoding:i,passive:s,...o}=t;this[qc]=new Set,this[pf]=[],this[z0]=!0,this[AI]=o,this[Ve]="opening",this.supports=tZ(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:e.snapshots!==!1,permanence:e.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[Pu]=new rZ(uZ(this)),this[V0]=this[Pu].encoding(n||"utf8"),this[N8]=this[Pu].encoding(i||"utf8");for(const a of this[Pu].encodings())this.supports.encodings[a.commonName]||(this.supports.encodings[a.commonName]=!0);this[Wc]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[V0].commonName,valueEncoding:this[N8].commonName}),key:Object.freeze({keyEncoding:this[V0].commonName})},this.nextTick(()=>{this[z0]&&this.open({passive:!1},lZ)})}get status(){return this[Ve]}keyEncoding(e){return this[Pu].encoding(e??this[V0])}valueEncoding(e){return this[Pu].encoding(e??this[N8])}open(e,t){t=jc(e,t),t=ua(t,Fe),e={...this[AI],...ha(e)},e.createIfMissing=e.createIfMissing!==!1,e.errorIfExists=!!e.errorIfExists;const n=i=>{this[Ve]==="closing"||this[Ve]==="opening"?this.once(Ys,i?()=>n(i):n):this[Ve]!=="open"?t(new Ki("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:i})):t()};return e.passive?this[Ve]==="opening"?this.once(Ys,n):this.nextTick(n):this[Ve]==="closed"||this[z0]?(this[z0]=!1,this[Ve]="opening",this.emit("opening"),this._open(e,i=>{if(i){this[Ve]="closed",this[$8](()=>{this.emit(Ys),n(i)}),this[gf]();return}this[Ve]="open",this[gf](),this.emit(Ys),this[Ve]==="open"&&this.emit("open"),this[Ve]==="open"&&this.emit("ready"),n()})):this[Ve]==="open"?this.nextTick(n):this.once(Ys,()=>this.open(e,t)),t[Fe]}_open(e,t){this.nextTick(t)}close(e){e=ua(e,Fe);const t=n=>{this[Ve]==="opening"||this[Ve]==="closing"?this.once(Ys,n?t(n):t):this[Ve]!=="closed"?e(new Ki("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:n})):e()};if(this[Ve]==="open"){this[Ve]="closing",this.emit("closing");const n=i=>{this[Ve]="open",this[gf](),this.emit(Ys),t(i)};this[$8](()=>{this._close(i=>{if(i)return n(i);this[Ve]="closed",this[gf](),this.emit(Ys),this[Ve]==="closed"&&this.emit("closed"),t()})})}else this[Ve]==="closed"?this.nextTick(t):this.once(Ys,()=>this.close(e));return e[Fe]}[$8](e){if(this[qc].size===0)return this.nextTick(e);let t=this[qc].size,n=!0;const i=()=>{--t===0&&(n?this.nextTick(e):e())};for(const s of this[qc])s.close(i);n=!1,this[qc].clear()}_close(e){this.nextTick(e)}get(e,t,n){if(n=jc(t,n),n=ua(n,Fe),t=ha(t,this[Wc].entry),this[Ve]==="opening")return this.defer(()=>this.get(e,t,n)),n[Fe];if(Du(this,n))return n[Fe];const i=this._checkKey(e);if(i)return this.nextTick(n,i),n[Fe];const s=this.keyEncoding(t.keyEncoding),o=this.valueEncoding(t.valueEncoding),a=s.format,c=o.format;return(t.keyEncoding!==a||t.valueEncoding!==c)&&(t=Object.assign({},t,{keyEncoding:a,valueEncoding:c})),this._get(this.prefixKey(s.encode(e),a),t,(l,h)=>{if(l)return(l.code==="LEVEL_NOT_FOUND"||l.notFound||/NotFound/i.test(l))&&(l.code||(l.code="LEVEL_NOT_FOUND"),l.notFound||(l.notFound=!0),l.status||(l.status=404)),n(l);try{h=o.decode(h)}catch(d){return n(new Ki("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:d}))}n(null,h)}),n[Fe]}_get(e,t,n){this.nextTick(n,new Error("NotFound"))}getMany(e,t,n){if(n=jc(t,n),n=ua(n,Fe),t=ha(t,this[Wc].entry),this[Ve]==="opening")return this.defer(()=>this.getMany(e,t,n)),n[Fe];if(Du(this,n))return n[Fe];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'keys' must be an array")),n[Fe];if(e.length===0)return this.nextTick(n,null,[]),n[Fe];const i=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),o=i.format,a=s.format;(t.keyEncoding!==o||t.valueEncoding!==a)&&(t=Object.assign({},t,{keyEncoding:o,valueEncoding:a}));const c=new Array(e.length);for(let l=0;l<e.length;l++){const h=e[l],d=this._checkKey(h);if(d)return this.nextTick(n,d),n[Fe];c[l]=this.prefixKey(i.encode(h),o)}return this._getMany(c,t,(l,h)=>{if(l)return n(l);try{for(let d=0;d<h.length;d++)h[d]!==void 0&&(h[d]=s.decode(h[d]))}catch(d){return n(new Ki(`Could not decode one or more of ${h.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:d}))}n(null,h)}),n[Fe]}_getMany(e,t,n){this.nextTick(n,null,new Array(e.length).fill(void 0))}put(e,t,n,i){if(i=jc(n,i),i=ua(i,Fe),n=ha(n,this[Wc].entry),this[Ve]==="opening")return this.defer(()=>this.put(e,t,n,i)),i[Fe];if(Du(this,i))return i[Fe];const s=this._checkKey(e)||this._checkValue(t);if(s)return this.nextTick(i,s),i[Fe];const o=this.keyEncoding(n.keyEncoding),a=this.valueEncoding(n.valueEncoding),c=o.format,l=a.format;(n.keyEncoding!==c||n.valueEncoding!==l)&&(n=Object.assign({},n,{keyEncoding:c,valueEncoding:l}));const h=this.prefixKey(o.encode(e),c),d=a.encode(t);return this._put(h,d,n,p=>{if(p)return i(p);this.emit("put",e,t),i()}),i[Fe]}_put(e,t,n,i){this.nextTick(i)}del(e,t,n){if(n=jc(t,n),n=ua(n,Fe),t=ha(t,this[Wc].key),this[Ve]==="opening")return this.defer(()=>this.del(e,t,n)),n[Fe];if(Du(this,n))return n[Fe];const i=this._checkKey(e);if(i)return this.nextTick(n,i),n[Fe];const s=this.keyEncoding(t.keyEncoding),o=s.format;return t.keyEncoding!==o&&(t=Object.assign({},t,{keyEncoding:o})),this._del(this.prefixKey(s.encode(e),o),t,a=>{if(a)return n(a);this.emit("del",e),n()}),n[Fe]}_del(e,t,n){this.nextTick(n)}batch(e,t,n){if(!arguments.length){if(this[Ve]==="opening")return new xI(this);if(this[Ve]!=="open")throw new Ki("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof e=="function"?n=e:n=jc(t,n),n=ua(n,Fe),t=ha(t,this[Wc].empty),this[Ve]==="opening")return this.defer(()=>this.batch(e,t,n)),n[Fe];if(Du(this,n))return n[Fe];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'operations' must be an array")),n[Fe];if(e.length===0)return this.nextTick(n),n[Fe];const i=new Array(e.length),{keyEncoding:s,valueEncoding:o,...a}=t;for(let c=0;c<e.length;c++){if(typeof e[c]!="object"||e[c]===null)return this.nextTick(n,new TypeError("A batch operation must be an object")),n[Fe];const l=Object.assign({},e[c]);if(l.type!=="put"&&l.type!=="del")return this.nextTick(n,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),n[Fe];const h=this._checkKey(l.key);if(h)return this.nextTick(n,h),n[Fe];const d=l.sublevel!=null?l.sublevel:this,p=d.keyEncoding(l.keyEncoding||s),m=p.format;if(l.key=d.prefixKey(p.encode(l.key),m),l.keyEncoding=m,l.type==="put"){const f=this._checkValue(l.value);if(f)return this.nextTick(n,f),n[Fe];const g=d.valueEncoding(l.valueEncoding||o);l.value=g.encode(l.value),l.valueEncoding=g.format}d!==this&&(l.sublevel=null),i[c]=l}return this._batch(i,a,c=>{if(c)return n(c);this.emit("batch",e),n()}),n[Fe]}_batch(e,t,n){this.nextTick(n)}sublevel(e,t){return this._sublevel(e,ub.defaults(t))}_sublevel(e,t){return new ub(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=jc(e,t),t=ua(t,Fe),e=ha(e,this[Wc].empty),this[Ve]==="opening")return this.defer(()=>this.clear(e,t)),t[Fe];if(Du(this,t))return t[Fe];const n=e,i=this.keyEncoding(e.keyEncoding);return e=F0(e,i),e.keyEncoding=i.format,e.limit===0?this.nextTick(t):this._clear(e,s=>{if(s)return t(s);this.emit("clear",n),t()}),t[Fe]}_clear(e,t){this.nextTick(t)}iterator(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=F0(e,t),e.keys=e.keys!==!1,e.values=e.values!==!1,e[Hc.keyEncoding]=t,e[Hc.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[Ve]==="opening")return new oZ(this,e);if(this[Ve]!=="open")throw new Ki("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new Hc(this,e)}keys(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=F0(e,t),e[Hc.keyEncoding]=t,e[Hc.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[Ve]==="opening")return new aZ(this,e);if(this[Ve]!=="open")throw new Ki("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new iZ(this,e)}values(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=F0(e,t),e[Hc.keyEncoding]=t,e[Hc.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[Ve]==="opening")return new cZ(this,e);if(this[Ve]!=="open")throw new Ki("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new sZ(this,e)}defer(e){if(typeof e!="function")throw new TypeError("The first argument must be a function");this[pf].push(e)}[gf](){if(this[pf].length===0)return;const e=this[pf];this[pf]=[];for(const t of e)t()}attachResource(e){if(typeof e!="object"||e===null||typeof e.close!="function")throw new TypeError("The first argument must be a resource object");this[qc].add(e)}detachResource(e){this[qc].delete(e)}_chainedBatch(){return new xI(this)}_checkKey(e){if(e==null)return new Ki("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(e==null)return new Ki("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};XE.prototype.nextTick=JJ();const{AbstractSublevel:ub}=eZ()({AbstractLevel:XE});H3.AbstractLevel=XE;H3.AbstractSublevel=ub;const Du=function(r,e){return r[Ve]!=="open"?(r.nextTick(e,new Ki("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},uZ=function(r){return Object.keys(r.supports.encodings).filter(e=>!!r.supports.encodings[e])};$c.AbstractLevel=H3.AbstractLevel;$c.AbstractSublevel=H3.AbstractSublevel;$c.AbstractIterator=js.AbstractIterator;$c.AbstractKeyIterator=js.AbstractKeyIterator;$c.AbstractValueIterator=js.AbstractValueIterator;$c.AbstractChainedBatch=YE.AbstractChainedBatch;/*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var hZ=fZ;const dZ=ML;function fZ(r,e,t){if(typeof e!="number")throw new Error("second argument must be a Number");let n,i,s,o,a,c=!0,l;Array.isArray(r)?(n=[],s=i=r.length):(o=Object.keys(r),n={},s=i=o.length);function h(p){function m(){t&&t(p,n),t=null}c?dZ(m):m()}function d(p,m,f){if(n[p]=f,m&&(a=!0),--s===0||m)h(m);else if(!a&&l<i){let g;o?(g=o[l],l+=1,r[g](function(v,y){d(g,v,y)})):(g=l,l+=1,r[g](function(v,y){d(g,v,y)}))}}l=e,s?o?o.some(function(p,m){return r[p](function(f,g){d(p,f,g)}),m===e-1}):r.some(function(p,m){return p(function(f,g){d(m,f,g)}),m===e-1}):h(null),c=!1}var OL={},RL=function(e){const t=e.gte!==void 0?e.gte:e.gt!==void 0?e.gt:void 0,n=e.lte!==void 0?e.lte:e.lt!==void 0?e.lt:void 0,i=e.gte===void 0,s=e.lte===void 0;return t!==void 0&&n!==void 0?IDBKeyRange.bound(t,n,i,s):t!==void 0?IDBKeyRange.lowerBound(t,i):n!==void 0?IDBKeyRange.upperBound(n,s):null};const pZ=new TextEncoder;var LL=function(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):pZ.encode(r)};const{AbstractIterator:gZ}=$c,CI=RL,K0=LL,ws=Symbol("cache"),Xs=Symbol("finished"),Rn=Symbol("options"),Js=Symbol("currentOptions"),Gc=Symbol("position"),M8=Symbol("location"),$u=Symbol("first"),II={};let yZ=class extends gZ{constructor(e,t,n){super(e,n),this[ws]=[],this[Xs]=this.limit===0,this[Rn]=n,this[Js]={...n},this[Gc]=void 0,this[M8]=t,this[$u]=!0}_nextv(e,t,n){if(this[$u]=!1,this[Xs])return this.nextTick(n,null,[]);if(this[ws].length>0)return e=Math.min(e,this[ws].length),this.nextTick(n,null,this[ws].splice(0,e));this[Gc]!==void 0&&(this[Rn].reverse?(this[Js].lt=this[Gc],this[Js].lte=void 0):(this[Js].gt=this[Gc],this[Js].gte=void 0));let i;try{i=CI(this[Js])}catch{return this[Xs]=!0,this.nextTick(n,null,[])}const s=this.db.db.transaction([this[M8]],"readonly"),o=s.objectStore(this[M8]),a=[];if(this[Rn].reverse){const c=!this[Rn].values&&o.openKeyCursor?"openKeyCursor":"openCursor";o[c](i,"prev").onsuccess=l=>{const h=l.target.result;if(h){const{key:d,value:p}=h;this[Gc]=d,a.push([this[Rn].keys&&d!==void 0?K0(d):void 0,this[Rn].values&&p!==void 0?K0(p):void 0]),a.length<e?h.continue():kI(s)}else this[Xs]=!0}}else{let c,l;const h=()=>{if(c===void 0||l===void 0)return;const d=Math.max(c.length,l.length);d===0||e===1/0?this[Xs]=!0:this[Gc]=c[d-1],a.length=d;for(let p=0;p<d;p++){const m=c[p],f=l[p];a[p]=[this[Rn].keys&&m!==void 0?K0(m):void 0,this[Rn].values&&f!==void 0?K0(f):void 0]}kI(s)};this[Rn].keys||e<1/0?o.getAllKeys(i,e<1/0?e:void 0).onsuccess=d=>{c=d.target.result,h()}:(c=[],this.nextTick(h)),this[Rn].values?o.getAll(i,e<1/0?e:void 0).onsuccess=d=>{l=d.target.result,h()}:(l=[],this.nextTick(h))}s.onabort=()=>{n(s.error||new Error("aborted by user")),n=null},s.oncomplete=()=>{n(null,a),n=null}}_next(e){if(this[ws].length>0){const[t,n]=this[ws].shift();this.nextTick(e,null,t,n)}else if(this[Xs])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[$u]&&(this[$u]=!1,t=1),this._nextv(t,II,(n,i)=>{if(n)return e(n);this[ws]=i,this._next(e)})}}_all(e,t){this[$u]=!1;const n=this[ws].splice(0,this[ws].length),i=this.limit-this.count-n.length;if(i<=0)return this.nextTick(t,null,n);this._nextv(i,II,(s,o)=>{if(s)return t(s);n.length>0&&(o=n.concat(o)),t(null,o)})}_seek(e,t){this[$u]=!0,this[ws]=[],this[Xs]=!1,this[Gc]=void 0,this[Js]={...this[Rn]};let n;try{n=CI(this[Rn])}catch{this[Xs]=!0;return}n!==null&&!n.includes(e)?this[Xs]=!0:this[Rn].reverse?this[Js].lte=e:this[Js].gte=e}};OL.Iterator=yZ;function kI(r){typeof r.commit=="function"&&r.commit()}var mZ=function(e,t,n,i,s){if(i.limit===0)return e.nextTick(s);const o=e.db.transaction([t],"readwrite"),a=o.objectStore(t);let c=0;o.oncomplete=function(){s()},o.onabort=function(){s(o.error||new Error("aborted by user"))};const l=a.openKeyCursor?"openKeyCursor":"openCursor",h=i.reverse?"prev":"next";a[l](n,h).onsuccess=function(d){const p=d.target.result;p&&(a.delete(p.key).onsuccess=function(){(i.limit<=0||++c<i.limit)&&p.continue()})}};const{AbstractLevel:wZ}=$c,_I=Hs,bZ=hZ,{fromCallback:vZ}=Dd,{Iterator:EZ}=OL,TI=LL,SZ=mZ,xZ=RL,BL="level-js-",yf=Symbol("idb"),O8=Symbol("namePrefix"),Zs=Symbol("location"),R8=Symbol("version"),Qc=Symbol("store"),mf=Symbol("onComplete"),PI=Symbol("promise");class UL extends wZ{constructor(e,t,n){if(typeof t=="function"||typeof n=="function")throw new _I("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:i,version:s,...o}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),typeof e!="string")throw new Error("constructor requires a location string argument");this[Zs]=e,this[O8]=i??BL,this[R8]=parseInt(s||1,10),this[yf]=null}get location(){return this[Zs]}get namePrefix(){return this[O8]}get version(){return this[R8]}get db(){return this[yf]}get type(){return"browser-level"}_open(e,t){const n=indexedDB.open(this[O8]+this[Zs],this[R8]);n.onerror=function(){t(n.error||new Error("unknown error"))},n.onsuccess=()=>{this[yf]=n.result,t()},n.onupgradeneeded=i=>{const s=i.target.result;s.objectStoreNames.contains(this[Zs])||s.createObjectStore(this[Zs])}}[Qc](e){return this[yf].transaction([this[Zs]],e).objectStore(this[Zs])}[mf](e,t){const n=e.transaction;n.onabort=function(){t(n.error||new Error("aborted by user"))},n.oncomplete=function(){t(null,e.result)}}_get(e,t,n){const i=this[Qc]("readonly");let s;try{s=i.get(e)}catch(o){return this.nextTick(n,o)}this[mf](s,function(o,a){if(o)return n(o);if(a===void 0)return n(new _I("Entry not found",{code:"LEVEL_NOT_FOUND"}));n(null,TI(a))})}_getMany(e,t,n){const i=this[Qc]("readonly"),s=e.map(o=>a=>{let c;try{c=i.get(o)}catch(l){return a(l)}c.onsuccess=()=>{const l=c.result;a(null,l===void 0?l:TI(l))},c.onerror=l=>{l.stopPropagation(),a(c.error)}});bZ(s,16,n)}_del(e,t,n){const i=this[Qc]("readwrite");let s;try{s=i.delete(e)}catch(o){return this.nextTick(n,o)}this[mf](s,n)}_put(e,t,n,i){const s=this[Qc]("readwrite");let o;try{o=s.put(t,e)}catch(a){return this.nextTick(i,a)}this[mf](o,i)}_iterator(e){return new EZ(this,this[Zs],e)}_batch(e,t,n){const i=this[Qc]("readwrite"),s=i.transaction;let o=0,a;s.onabort=function(){n(a||s.error||new Error("aborted by user"))},s.oncomplete=function(){n()};function c(){const l=e[o++],h=l.key;let d;try{d=l.type==="del"?i.delete(h):i.put(l.value,h)}catch(p){a=p,s.abort();return}o<e.length?d.onsuccess=c:typeof s.commit=="function"&&s.commit()}c()}_clear(e,t){let n,i;try{n=xZ(e)}catch{return this.nextTick(t)}if(e.limit>=0)return SZ(this,this[Zs],n,e,t);try{const s=this[Qc]("readwrite");i=n?s.delete(n):s.clear()}catch(s){return this.nextTick(t,s)}this[mf](i,t)}_close(e){this[yf].close(),this.nextTick(e)}}UL.destroy=function(r,e,t){typeof e=="function"&&(t=e,e=BL),t=vZ(t,PI);const n=indexedDB.deleteDatabase(e+r);return n.onsuccess=function(){t()},n.onerror=function(i){t(i)},t[PI]};SL.BrowserLevel=UL;var AZ=SL.BrowserLevel;const CZ="./level",IZ="view",hb=async({path:r,valueEncoding:e}={})=>{r=r||CZ,e=e||IZ;const t=new AZ(r,{valueEncoding:e,passive:!0});return await t.open(),{put:async(h,d)=>{await t.put(h,d)},del:async h=>{await t.del(h)},get:async h=>{try{const d=await t.get(h);if(d)return d}catch{}},iterator:async function*({amount:h,reverse:d}={}){const p={limit:h||-1,reverse:d||!1};for await(const[m,f]of t.iterator(p))yield[m,f]},merge:async h=>{},clear:async()=>{await t.clear()},close:async()=>{await t.close()}}},DI=1e6,Rs=async({size:r}={})=>{let e=new J6(r||DI);return{put:async(l,h)=>{e.set(l,h)},del:async l=>{e.remove(l)},get:async l=>e.get(l),iterator:async function*(){for await(const l of e.keys){const h=e.get(l);yield[l,h]}},merge:async l=>{if(l)for await(const[h,d]of l.iterator())e.set(h,d)},clear:async()=>{e=new J6(r||DI)},close:async()=>{}}},kZ=16,L8=1e3,JE=async({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:h,syncAutomatically:d,onUpdate:p})=>{s=sc(s||"./orbitdb",`./${t}/`),o=o||{},h=Number(h)>-1?h:kZ,c=c||await Cl(await Rs({size:L8}),await K3({ipfs:r,pin:!0})),a=a||await Cl(await Rs({size:L8}),await hb({path:sc(s,"/log/_heads/")})),l=l||await Cl(await Rs({size:L8}),await hb({path:sc(s,"/log/_index/")}));const m=await lJ(e,{logId:t,access:i,entryStorage:c,headsStorage:a,indexStorage:l}),f=new N3.EventEmitter,g=new pc({concurrency:1}),v=async C=>{const k=async()=>{const I=await m.append(C,{referencesCount:h});return await E.add(I),p&&await p(m,I),f.emit("update",I),I.hash},x=await g.add(k);return await g.onIdle(),x},y=async C=>{const k=async()=>{const x=await lo.decode(C);x&&await m.joinEntry(x)&&(p&&await p(m,x),f.emit("update",x))};await g.add(k)},w=async()=>{await E.stop(),await g.onIdle(),await m.close(),i&&i.close&&await i.close(),f.emit("close")},b=async()=>{await g.onIdle(),await m.clear(),i&&i.drop&&await i.drop(),f.emit("drop")},E=await JG({ipfs:r,log:m,events:f,onSynced:y,start:d});return{address:t,name:n,identity:e,meta:o,close:w,drop:b,addOperation:v,log:m,sync:E,peers:E.peers,events:f,access:i}},FL="documents",_Z={indexBy:"_id"},zL=({indexBy:r}=_Z)=>async({ipfs:e,identity:t,address:n,name:i,access:s,directory:o,meta:a,headsStorage:c,entryStorage:l,indexStorage:h,referencesCount:d,syncAutomatically:p,onUpdate:m})=>{const f=await JE({ipfs:e,identity:t,address:n,name:i,access:s,directory:o,meta:a,headsStorage:c,entryStorage:l,indexStorage:h,referencesCount:d,syncAutomatically:p}),{addOperation:g,log:v}=f,y=async x=>{const I=x[r];if(!I)throw new Error(`The provided document doesn't contain field '${r}'`);return g({op:"PUT",key:I,value:x})},w=async x=>{if(!await b(x))throw new Error(`No document with key '${x}' in the database`);return g({op:"DEL",key:x,value:null})},b=async x=>{for await(const I of C())if(x===I.key)return I},E=async x=>{const I=[];for await(const T of C())x(T.value)&&I.push(T.value);return I},C=async function*({amount:x}={}){const I={};let T=0;for await(const L of v.iterator()){const{op:V,key:U,value:G}=L.payload;if(V==="PUT"&&!I[U]?(I[U]=!0,T++,yield{hash:L.hash,key:U,value:G}):V==="DEL"&&!I[U]&&(I[U]=!0),T>=x)break}};return{...f,type:FL,put:y,del:w,get:b,iterator:C,query:E,indexBy:r,all:async()=>{const x=[];for await(const I of C())x.unshift(I);return x}}};zL.type=FL;const VL="events",KL=()=>async({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:h,syncAutomatically:d,onUpdate:p})=>{const m=await JE({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:h,syncAutomatically:d,onUpdate:p}),{addOperation:f,log:g}=m,v=async E=>f({op:"ADD",key:null,value:E}),y=async E=>(await g.get(E)).payload.value,w=async function*({gt:E,gte:C,lt:k,lte:x,amount:I}={}){const T=g.iterator({gt:E,gte:C,lt:k,lte:x,amount:I});for await(const L of T){const V=L.hash,U=L.payload.value;yield{hash:V,value:U}}};return{...m,type:VL,add:v,get:y,iterator:w,all:async()=>{const E=[];for await(const C of w())E.unshift(C);return E}}};KL.type=VL;const HL="keyvalue",jL=()=>async({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:h,syncAutomatically:d,onUpdate:p})=>{const m=await JE({ipfs:r,identity:e,address:t,name:n,access:i,directory:s,meta:o,headsStorage:a,entryStorage:c,indexStorage:l,referencesCount:h,syncAutomatically:d,onUpdate:p}),{addOperation:f,log:g}=m,v=async(C,k)=>f({op:"PUT",key:C,value:k}),y=async C=>f({op:"DEL",key:C,value:null}),w=async C=>{for await(const k of g.traverse()){const{op:x,key:I,value:T}=k.payload;if(x==="PUT"&&I===C)return T;if(x==="DEL"&&I===C)return}},b=async function*({amount:C}={}){const k={};let x=0;for await(const I of g.traverse()){const{op:T,key:L,value:V}=I.payload;if(T==="PUT"&&!k[L]){k[L]=!0,x++;const U=I.hash;yield{key:L,value:V,hash:U}}else T==="DEL"&&!k[L]&&(k[L]=!0);if(x>=C)break}};return{...m,type:HL,put:v,set:v,del:y,get:w,iterator:b,all:async()=>{const C=[];for await(const k of b())C.unshift(k);return C}}};jL.type=HL;const db={},ZE=r=>{if(!r.type)throw new Error("Database type does not contain required field 'type'.");db[r.type]=r},TZ=r=>{if(!r)throw new Error("Type not specified");if(!db[r])throw new Error(`Unsupported database type: '${r}'`);return db[r]};ZE(KL);ZE(zL);ZE(jL);const PZ=Symbol.for("@libp2p/connection"),Vh=Symbol.for("@libp2p/content-routing"),ey=Symbol.for("@libp2p/peer-discovery"),eS=Symbol.for("@libp2p/peer-id");function qL(r){return!!(r!=null&&r[eS])}const Kh=Symbol.for("@libp2p/peer-routing"),X3="keep-alive",ty="StrictSign",tS="StrictNoSign";var Ei;(function(r){r.Accept="accept",r.Ignore="ignore",r.Reject="reject"})(Ei||(Ei={}));const J3=Symbol.for("@libp2p/transport");var Hh;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(Hh||(Hh={}));var J5;let zl=(J5=class extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}},u(J5,"name","AbortError"),J5);class WL extends Error{constructor(e="Unexpected Peer"){super(e),this.name="UnexpectedPeerError"}}u(WL,"name","UnexpectedPeerError");var Z5;let DZ=(Z5=class extends Error{constructor(e="Invalid crypto exchange"){super(e),this.name="InvalidCryptoExchangeError"}},u(Z5,"name","InvalidCryptoExchangeError"),Z5);class Z extends Error{constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}}u(Z,"name","InvalidParametersError");class F1 extends Error{constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}u(F1,"name","InvalidPublicKeyError");class rS extends Error{constructor(e="Invalid private key"){super(e),this.name="InvalidPrivateKeyError"}}u(rS,"name","InvalidPrivateKeyError");class GL extends Error{constructor(e="The connection is closing"){super(e),this.name="ConnectionClosingError"}}u(GL,"name","ConnectionClosingError");class nS extends Error{constructor(e="The connection is closed"){super(e),this.name="ConnectionClosedError"}}u(nS,"name","ConnectionClosedError");class iS extends Error{constructor(e="Connection failed"){super(e),this.name="ConnectionFailedError"}}u(iS,"name","ConnectionFailedError");class il extends Error{constructor(e="The muxer is closed"){super(e),this.name="MuxerClosedError"}}u(il,"name","MuxerClosedError");class QL extends Error{constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}}u(QL,"name","StreamResetError");class ry extends Error{constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}}u(ry,"name","StreamStateError");var e6;let Qt=(e6=class extends Error{constructor(e="Not found"){super(e),this.name="NotFoundError"}},u(e6,"name","NotFoundError"),e6);class sS extends Error{constructor(e="Invalid PeerID"){super(e),this.name="InvalidPeerIdError"}}u(sS,"name","InvalidPeerIdError");class Z3 extends Error{constructor(e="Invalid multiaddr"){super(e),this.name="InvalidMultiaddrError"}}u(Z3,"name","InvalidMultiaddrError");class YL extends Error{constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}u(YL,"name","InvalidCIDError");class ew extends Error{constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}u(ew,"name","InvalidMultihashError");class Lp extends Error{constructor(e="Unsupported protocol error"){super(e),this.name="UnsupportedProtocolError"}}u(Lp,"name","UnsupportedProtocolError");class wt extends Error{constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}}u(wt,"name","InvalidMessageError");class XL extends Error{constructor(e="Protocol error"){super(e),this.name="ProtocolError"}}u(XL,"name","ProtocolError");class Bp extends Error{constructor(e="Timed out"){super(e),this.name="TimeoutError"}}u(Bp,"name","TimeoutError");class Vl extends Error{constructor(e="Not started"){super(e),this.name="NotStartedError"}}u(Vl,"name","NotStartedError");class fh extends Error{constructor(e="Dial error"){super(e),this.name="DialError"}}u(fh,"name","DialError");class ny extends Error{constructor(e="Listen error"){super(e),this.name="ListenError"}}u(ny,"name","ListenError");class oS extends Error{constructor(e="Limited connection"){super(e),this.name="LimitedConnectionError"}}u(oS,"name","LimitedConnectionError");class JL extends Error{constructor(e="Too many inbound protocol streams"){super(e),this.name="TooManyInboundProtocolStreamsError"}}u(JL,"name","TooManyInboundProtocolStreamsError");class tw extends Error{constructor(e="Too many outbound protocol streams"){super(e),this.name="TooManyOutboundProtocolStreamsError"}}u(tw,"name","TooManyOutboundProtocolStreamsError");class mu extends Error{constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}u(mu,"name","UnsupportedKeyTypeError");var ks;class Yt extends EventTarget{constructor(){super();qe(this,ks,new Map)}listenerCount(t){const n=ie(this,ks).get(t);return n==null?0:n.length}addEventListener(t,n,i){super.addEventListener(t,n,i);let s=ie(this,ks).get(t);s==null&&(s=[],ie(this,ks).set(t,s)),s.push({callback:n,once:(i!==!0&&i!==!1&&(i==null?void 0:i.once))??!1})}removeEventListener(t,n,i){super.removeEventListener(t.toString(),n??null,i);let s=ie(this,ks).get(t);s!=null&&(s=s.filter(({callback:o})=>o!==n),ie(this,ks).set(t,s))}dispatchEvent(t){const n=super.dispatchEvent(t);let i=ie(this,ks).get(t.type);return i==null||(i=i.filter(({once:s})=>!s),ie(this,ks).set(t.type,i)),n}safeDispatchEvent(t,n={}){return this.dispatchEvent(new CustomEvent(t,n))}}ks=new WeakMap;function aS(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}async function Oo(...r){const e=[];for(const t of r)aS(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStart!=null&&await t.beforeStart()})),await Promise.all(e.map(async t=>{await t.start()})),await Promise.all(e.map(async t=>{t.afterStart!=null&&await t.afterStart()}))}async function Nc(...r){const e=[];for(const t of r)aS(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStop!=null&&await t.beforeStop()})),await Promise.all(e.map(async t=>{await t.stop()})),await Promise.all(e.map(async t=>{t.afterStop!=null&&await t.afterStop()}))}const ur=Symbol.for("@libp2p/service-capabilities"),mc=Symbol.for("@libp2p/service-dependencies");function $Z(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function rw(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function NZ(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var MZ=NZ,OZ=MZ;let RZ=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},LZ=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ZL(this,e)}},BZ=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return ZL(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function ZL(r,e){return new BZ({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let UZ=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new RZ(e,t,n),this.decoder=new LZ(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function eB({name:r,prefix:e,encode:t,decode:n}){return new UZ(r,e,t,n)}function nw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=OZ(t,r);return eB({prefix:e,name:r,encode:n,decode:s=>rw(i(s))})}function FZ(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function zZ(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function ti({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return eB({prefix:e,name:r,encode(i){return zZ(i,n,t)},decode(i){return FZ(i,n,t,r)}})}const vi=nw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});nw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const jg=ti({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ti({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});ti({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});ti({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});ti({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});ti({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});ti({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});ti({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});ti({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const B8=nw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});nw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var VZ=tB,$I=128,KZ=-128,HZ=Math.pow(2,31);function tB(r,e,t){e=e||[],t=t||0;for(var n=t;r>=HZ;)e[t++]=r&255|$I,r/=128;for(;r&KZ;)e[t++]=r&255|$I,r>>>=7;return e[t]=r|0,tB.bytes=t-n+1,e}var jZ=fb,qZ=128,NI=127;function fb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw fb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&NI)<<i:(o&NI)*Math.pow(2,i),i+=7}while(o>=qZ);return fb.bytes=s-n,t}var WZ=Math.pow(2,7),GZ=Math.pow(2,14),QZ=Math.pow(2,21),YZ=Math.pow(2,28),XZ=Math.pow(2,35),JZ=Math.pow(2,42),ZZ=Math.pow(2,49),eee=Math.pow(2,56),tee=Math.pow(2,63),ree=function(r){return r<WZ?1:r<GZ?2:r<QZ?3:r<YZ?4:r<XZ?5:r<JZ?6:r<ZZ?7:r<eee?8:r<tee?9:10},nee={encode:VZ,decode:jZ,encodingLength:ree},iy=nee;function pb(r,e=0){return[iy.decode(r,e),iy.decode.bytes]}function sy(r,e,t=0){return iy.encode(r,e,t),e}function oy(r){return iy.encodingLength(r)}function Kl(r,e){const t=e.byteLength,n=oy(r),i=n+oy(t),s=new Uint8Array(i+t);return sy(r,s,0),sy(t,s,n),s.set(e,i),new cS(r,t,e,s)}function iee(r){const e=rw(r),[t,n]=pb(e),[i,s]=pb(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new cS(t,i,o,e)}function see(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&$Z(r.bytes,t.bytes)}}let cS=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function MI(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return aee(t,gb(r),e??vi.encoder);default:return cee(t,gb(r),e??jg.encoder)}}const OI=new WeakMap;function gb(r){const e=OI.get(r);if(e==null){const t=new Map;return OI.set(r,t),t}return e}var Y$;let iw=class $r{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,Y$,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==wf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==lee)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return $r.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Kl(e,t);return $r.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return $r.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&see(e.multihash,n.multihash)}toString(e){return MI(this,e)}toJSON(){return{"/":MI(this)}}link(){return this}[(Y$=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof $r)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new $r(n,i,s,o??RI(n,i,s.bytes))}else if(t[uee]===!0){const{version:n,multihash:i,code:s}=t,o=iee(i);return $r.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==wf)throw new Error(`Version 0 CID must use dag-pb (code: ${wf}) block encoding`);return new $r(e,t,n,n.bytes)}case 1:{const i=RI(e,t,n.bytes);return new $r(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return $r.create(0,wf,e)}static createV1(e,t){return $r.create(1,e,t)}static decode(e){const[t,n]=$r.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=$r.inspectBytes(e),n=t.size-t.multihashSize,i=rw(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new cS(t.multihashCode,t.digestSize,s,i);return[t.version===0?$r.createV0(o):$r.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=pb(e.subarray(t));return t+=p,d};let i=n(),s=wf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){const[n,i]=oee(e,t),s=$r.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return gb(s).set(n,e),s}};function oee(r,e){switch(r[0]){case"Q":{const t=e??vi;return[vi.prefix,t.decode(`${vi.prefix}${r}`)]}case vi.prefix:{const t=e??vi;return[vi.prefix,t.decode(r)]}case jg.prefix:{const t=e??jg;return[jg.prefix,t.decode(r)]}case B8.prefix:{const t=e??B8;return[B8.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function aee(r,e,t){const{prefix:n}=t;if(n!==vi.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function cee(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const wf=112,lee=18;function RI(r,e,t){const n=oy(r),i=n+oy(e),s=new Uint8Array(i+t.byteLength);return sy(r,s,0),sy(e,s,n),s.set(t,i),s}const uee=Symbol.for("@ipld/js-cid/CID"),rB=0,hee="identity",nB=rw;function dee(r){return Kl(rB,nB(r))}const lS={code:rB,name:hee,encode:nB,digest:dee};function Ke(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function We(r=0){return new Uint8Array(r)}function Pn(r=0){return new Uint8Array(r)}function er(r,e){e==null&&(e=r.reduce((i,s)=>i+s.length,0));const t=Pn(e);let n=0;for(const i of r)t.set(i,n),n+=i.length;return t}const iB=Symbol.for("@achingbrain/uint8arraylist");function LI(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(const n of r){const i=t+n.byteLength;if(e<i)return{buf:n,index:e-t};t=i}throw new RangeError("index is out of bounds")}function Ff(r){return!!(r!=null&&r[iB])}var X$;class Le{constructor(...e){u(this,"bufs");u(this,"length");u(this,X$,!0);this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[(X$=iB,Symbol.iterator)](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(Ff(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(Ff(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){const t=LI(this.bufs,e);return t.buf[t.index]}set(e,t){const n=LI(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(Ff(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){const{bufs:n,length:i}=this._subList(e,t);return er(n,i)}subarray(e,t){const{bufs:n,length:i}=this._subList(e,t);return n.length===1?n[0]:er(n,i)}sublist(e,t){const{bufs:n,length:i}=this._subList(e,t),s=new Le;return s.length=i,s.bufs=[...n],s}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};const n=[];let i=0;for(let s=0;s<this.bufs.length;s++){const o=this.bufs[s],a=i,c=a+o.byteLength;if(i=c,e>=c)continue;const l=e>=a&&e<c,h=t>a&&t<=c;if(l&&h){if(e===a&&t===c){n.push(o);break}const d=e-a;n.push(o.subarray(d,d+(t-e)));break}if(l){if(e===0){n.push(o);continue}n.push(o.subarray(e-a));continue}if(h){if(t===c){n.push(o);break}n.push(o.subarray(0,t-a));break}n.push(o)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!Ff(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const i=n.byteLength;if(i===0)throw new TypeError("search must be at least 1 byte long");const s=256,o=new Int32Array(s);for(let d=0;d<s;d++)o[d]=-1;for(let d=0;d<i;d++)o[n[d]]=d;const a=o,c=this.byteLength-n.byteLength,l=n.byteLength-1;let h;for(let d=t;d<=c;d+=h){h=0;for(let p=l;p>=0;p--){const m=this.get(d+p);if(n[p]!==m){h=Math.max(1,p-a[m]);break}}if(h===0)return d}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const n=Pn(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){const i=We(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,t,n),this.write(i,e)}getInt32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){const i=We(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,t,n),this.write(i,e)}getBigInt64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){const i=We(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,t,n),this.write(i,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const n=Pn(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){const i=We(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,t,n),this.write(i,e)}getUint32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){const i=We(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,t,n),this.write(i,e)}getBigUint64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){const i=We(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,t,n),this.write(i,e)}getFloat32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){const i=We(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,t,n),this.write(i,e)}getFloat64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){const i=We(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,t,n),this.write(i,e)}equals(e){if(e==null||!(e instanceof Le)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!Ke(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const n=new Le;return n.bufs=e,t==null&&(t=e.reduce((i,s)=>i+s.byteLength,0)),n.length=t,n}}function fee(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function pee(r){return new TextEncoder().encode(r)}function gee(r){return new TextDecoder().decode(r)}function yee(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var mee=yee,wee=mee;let bee=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},vee=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return sB(this,e)}},Eee=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return sB(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function sB(r,e){return new Eee({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let See=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new bee(e,t,n),this.decoder=new vee(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function sw({name:r,prefix:e,encode:t,decode:n}){return new See(r,e,t,n)}function Up({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=wee(t,r);return sw({prefix:e,name:r,encode:n,decode:s=>fee(i(s))})}function xee(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Aee(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Ar({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return sw({prefix:e,name:r,encode(i){return Aee(i,n,t)},decode(i){return xee(i,n,t,r)}})}const Cee=Up({prefix:"9",name:"base10",alphabet:"0123456789"}),Iee=Object.freeze(Object.defineProperty({__proto__:null,base10:Cee},Symbol.toStringTag,{value:"Module"})),kee=Ar({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),_ee=Ar({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Tee=Object.freeze(Object.defineProperty({__proto__:null,base16:kee,base16upper:_ee},Symbol.toStringTag,{value:"Module"})),Pee=Ar({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Dee=Object.freeze(Object.defineProperty({__proto__:null,base2:Pee},Symbol.toStringTag,{value:"Module"})),oB=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),$ee=oB.reduce((r,e,t)=>(r[t]=e,r),[]),Nee=oB.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function Mee(r){return r.reduce((e,t)=>(e+=$ee[t],e),"")}function Oee(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const i=Nee[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const Ree=sw({prefix:"🚀",name:"base256emoji",encode:Mee,decode:Oee}),Lee=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Ree},Symbol.toStringTag,{value:"Module"})),Bee=Ar({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Uee=Ar({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Fee=Ar({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),zee=Ar({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Vee=Ar({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Kee=Ar({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Hee=Ar({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),jee=Ar({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),qee=Ar({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Wee=Object.freeze(Object.defineProperty({__proto__:null,base32:Bee,base32hex:Vee,base32hexpad:Hee,base32hexpadupper:jee,base32hexupper:Kee,base32pad:Fee,base32padupper:zee,base32upper:Uee,base32z:qee},Symbol.toStringTag,{value:"Module"})),Gee=Up({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Qee=Up({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Yee=Object.freeze(Object.defineProperty({__proto__:null,base36:Gee,base36upper:Qee},Symbol.toStringTag,{value:"Module"})),Xee=Up({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Jee=Up({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Zee=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Xee,base58flickr:Jee},Symbol.toStringTag,{value:"Module"})),ete=Ar({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),tte=Ar({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),rte=Ar({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),nte=Ar({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),ite=Object.freeze(Object.defineProperty({__proto__:null,base64:ete,base64pad:tte,base64url:rte,base64urlpad:nte},Symbol.toStringTag,{value:"Module"})),ste=Ar({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),ote=Object.freeze(Object.defineProperty({__proto__:null,base8:ste},Symbol.toStringTag,{value:"Module"})),ate=sw({prefix:"\0",name:"identity",encode:r=>gee(r),decode:r=>pee(r)}),cte=Object.freeze(Object.defineProperty({__proto__:null,identity:ate},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const BI={...cte,...Dee,...ote,...Iee,...Tee,...Wee,...Yee,...Zee,...ite,...Lee};function aB(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const UI=aB("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),U8=aB("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=Pn(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),cB={utf8:UI,"utf-8":UI,hex:BI.base16,latin1:U8,ascii:U8,binary:U8,...BI};function se(r,e="utf8"){const t=cB[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}function re(r,e="utf8"){const t=cB[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}const lte=parseInt("11111",2),yb=parseInt("10000000",2),ute=parseInt("01111111",2),FI={0:bf,1:bf,2:hte,3:pte,4:gte,5:fte,6:dte,16:bf,22:bf,48:bf};function Mc(r,e={offset:0}){const t=r[e.offset]&lte;if(e.offset++,FI[t]!=null)return FI[t](r,e);throw new Error("No decoder for tag "+t)}function Fp(r,e){let t=0;if((r[e.offset]&yb)===yb){const n=r[e.offset]&ute;let i="0x";e.offset++;for(let s=0;s<n;s++,e.offset++)i+=r[e.offset].toString(16).padStart(2,"0");t=parseInt(i,16)}else t=r[e.offset],e.offset++;return t}function bf(r,e){Fp(r,e);const t=[];for(;!(e.offset>=r.byteLength);){const n=Mc(r,e);if(n===null)break;t.push(n)}return t}function hte(r,e){const t=Fp(r,e),n=e.offset,i=e.offset+t,s=[];for(let o=n;o<i;o++)o===n&&r[o]===0||s.push(r[o]);return e.offset+=t,Uint8Array.from(s)}function dte(r,e){const t=Fp(r,e),n=e.offset+t,i=r[e.offset];e.offset++;let s=0,o=0;i<40?(s=0,o=i):i<80?(s=1,o=i-40):(s=2,o=i-80);let a=`${s}.${o}`,c=[];for(;e.offset<n;){const l=r[e.offset];if(e.offset++,c.push(l&127),l<128){c.reverse();let h=0;for(let d=0;d<c.length;d++)h+=c[d]<<d*7;a+=`.${h}`,c=[]}}return a}function fte(r,e){return e.offset++,null}function pte(r,e){const t=Fp(r,e),n=r[e.offset];e.offset++;const i=r.subarray(e.offset,e.offset+t-1);if(e.offset+=t,n!==0)throw new Error("Unused bits in bit string is unimplemented");return i}function gte(r,e){const t=Fp(r,e),n=r.subarray(e.offset,e.offset+t);return e.offset+=t,n}function yte(r){let e=r.toString(16);e.length%2===1&&(e="0"+e);const t=new Le;for(let n=0;n<e.length;n+=2)t.append(Uint8Array.from([parseInt(`${e[n]}${e[n+1]}`,16)]));return t}function ow(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);const e=yte(r.byteLength);return new Le(Uint8Array.from([e.byteLength|yb]),e)}function zn(r){const e=new Le,t=128;return(r.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(r),new Le(Uint8Array.from([2]),ow(e),e)}function uS(r){const e=Uint8Array.from([0]),t=new Le(e,r);return new Le(Uint8Array.from([3]),ow(t),t)}function mte(r){return new Le(Uint8Array.from([4]),ow(r),r)}function xo(r,e=48){const t=new Le;for(const n of r)t.append(n);return new Le(Uint8Array.from([e]),ow(t),t)}const lB="1.2.840.10045.3.1.7",uB="1.3.132.0.34",hB="1.3.132.0.35";async function wte(r="P-256"){const e=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:r},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",e.publicKey),privateKey:await crypto.subtle.exportKey("jwk",e.privateKey)}}async function bte(r,e){const t=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["sign"]),n=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},t,e.subarray());return new Uint8Array(n,0,n.byteLength)}async function vte(r,e,t){const n=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["verify"]);return crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},n,e,t.subarray())}const Ete=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),Ste=Uint8Array.from([6,5,43,129,4,0,34]),xte=Uint8Array.from([6,5,43,129,4,0,35]),dB={ext:!0,kty:"EC",crv:"P-256"},fB={ext:!0,kty:"EC",crv:"P-384"},pB={ext:!0,kty:"EC",crv:"P-521"},ph=32,gh=48,yh=66;function Ate(r){const e=Mc(r);return gB(e)}function gB(r){const e=r[1],t=re(e,"base64url"),n=r[2][1][0],i=1;let s,o;if(e.byteLength===ph)return s=re(n.subarray(i,i+ph),"base64url"),o=re(n.subarray(i+ph),"base64url"),new Wg({...dB,key_ops:["sign"],d:t,x:s,y:o});if(e.byteLength===gh)return s=re(n.subarray(i,i+gh),"base64url"),o=re(n.subarray(i+gh),"base64url"),new Wg({...fB,key_ops:["sign"],d:t,x:s,y:o});if(e.byteLength===yh)return s=re(n.subarray(i,i+yh),"base64url"),o=re(n.subarray(i+yh),"base64url"),new Wg({...pB,key_ops:["sign"],d:t,x:s,y:o});throw new Z(`Private key length was wrong length, got ${e.byteLength}, expected 32, 48 or 66`)}function yB(r){const e=Mc(r);return mB(e)}function mB(r){const e=r[1][1][0],t=1;let n,i;if(e.byteLength===ph*2+1)return n=re(e.subarray(t,t+ph),"base64url"),i=re(e.subarray(t+ph),"base64url"),new qg({...dB,key_ops:["verify"],x:n,y:i});if(e.byteLength===gh*2+1)return n=re(e.subarray(t,t+gh),"base64url"),i=re(e.subarray(t+gh),"base64url"),new qg({...fB,key_ops:["verify"],x:n,y:i});if(e.byteLength===yh*2+1)return n=re(e.subarray(t,t+yh),"base64url"),i=re(e.subarray(t+yh),"base64url"),new qg({...pB,key_ops:["verify"],x:n,y:i});throw new Z(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function Cte(r){return xo([zn(Uint8Array.from([1])),mte(se(r.d??"","base64url")),xo([wB(r.crv)],160),xo([uS(new Le(Uint8Array.from([4]),se(r.x??"","base64url"),se(r.y??"","base64url")))],161)]).subarray()}function Ite(r){return xo([zn(Uint8Array.from([1])),xo([wB(r.crv)],160),xo([uS(new Le(Uint8Array.from([4]),se(r.x??"","base64url"),se(r.y??"","base64url")))],161)]).subarray()}function wB(r){if(r==="P-256")return Ete;if(r==="P-384")return Ste;if(r==="P-521")return xte;throw new Z(`Invalid curve ${r}`)}async function kte(r="P-256"){const e=await wte(r);return new Wg(e.privateKey)}class qg{constructor(e){u(this,"type","ECDSA");u(this,"jwk");u(this,"_raw");this.jwk=e}get raw(){return this._raw==null&&(this._raw=Ite(this.jwk)),this._raw}toMultihash(){return lS.digest(_i(this))}toCID(){return iw.createV1(114,this.toMultihash())}toString(){return vi.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ke(this.raw,e.raw)}async verify(e,t){return vte(this.jwk,t,e)}}class Wg{constructor(e){u(this,"type","ECDSA");u(this,"jwk");u(this,"publicKey");u(this,"_raw");this.jwk=e,this.publicKey=new qg({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){return this._raw==null&&(this._raw=Cte(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ke(this.raw,e.raw)}async sign(e){return bte(this.jwk,e)}}function zI(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function _te(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function aw(r,...e){if(!_te(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Tte(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");zI(r.outputLen),zI(r.blockLen)}function ay(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Pte(r,e){aw(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const Nu=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function F8(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function bs(r,e){return r<<32-e|r>>>e}typeof Uint8Array.from([]).toHex=="function"&&Uint8Array.fromHex;function Dte(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function hS(r){return typeof r=="string"&&(r=Dte(r)),aw(r),r}function $te(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];aw(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const s=r[n];t.set(s,i),i+=s.length}return t}let bB=class{clone(){return this._cloneInto()}};function vB(r){const e=n=>r().update(hS(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function dS(r=32){if(Nu&&typeof Nu.getRandomValues=="function")return Nu.getRandomValues(new Uint8Array(r));if(Nu&&typeof Nu.randomBytes=="function")return Uint8Array.from(Nu.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function Nte(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function Mte(r,e,t){return r&e^~r&t}function Ote(r,e,t){return r&e^r&t^e&t}let EB=class extends bB{constructor(e,t,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=F8(this.buffer)}update(e){ay(this);const{view:t,buffer:n,blockLen:i}=this;e=hS(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=F8(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ay(this),Pte(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let d=o;d<i;d++)t[d]=0;Nte(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=F8(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,h=this.get();if(l>h.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<l;d++)a.setUint32(4*d,h[d],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%t&&e.buffer.set(n),e}};const Rte=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),da=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),fa=new Uint32Array(64);let Lte=class extends EB{constructor(e=32){super(64,e,8,!1),this.A=da[0]|0,this.B=da[1]|0,this.C=da[2]|0,this.D=da[3]|0,this.E=da[4]|0,this.F=da[5]|0,this.G=da[6]|0,this.H=da[7]|0}get(){const{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let d=0;d<16;d++,t+=4)fa[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){const p=fa[d-15],m=fa[d-2],f=bs(p,7)^bs(p,18)^p>>>3,g=bs(m,17)^bs(m,19)^m>>>10;fa[d]=g+fa[d-7]+f+fa[d-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:l,H:h}=this;for(let d=0;d<64;d++){const p=bs(a,6)^bs(a,11)^bs(a,25),m=h+p+Mte(a,c,l)+Rte[d]+fa[d]|0,g=(bs(n,2)^bs(n,13)^bs(n,22))+Ote(n,i,s)|0;h=l,l=c,c=a,a=o+m|0,o=s,s=i,i=n,n=m+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,h=h+this.H|0,this.set(n,i,s,o,a,c,l,h)}roundClean(){fa.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Bte=vB(()=>new Lte),H0=BigInt(2**32-1),mb=BigInt(32);function SB(r,e=!1){return e?{h:Number(r&H0),l:Number(r>>mb&H0)}:{h:Number(r>>mb&H0)|0,l:Number(r&H0)|0}}function Ute(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let i=0;i<r.length;i++){const{h:s,l:o}=SB(r[i],e);[t[i],n[i]]=[s,o]}return[t,n]}const Fte=(r,e)=>BigInt(r>>>0)<<mb|BigInt(e>>>0),zte=(r,e,t)=>r>>>t,Vte=(r,e,t)=>r<<32-t|e>>>t,Kte=(r,e,t)=>r>>>t|e<<32-t,Hte=(r,e,t)=>r<<32-t|e>>>t,jte=(r,e,t)=>r<<64-t|e>>>t-32,qte=(r,e,t)=>r>>>t-32|e<<64-t,Wte=(r,e)=>e,Gte=(r,e)=>r,Qte=(r,e,t)=>r<<t|e>>>32-t,Yte=(r,e,t)=>e<<t|r>>>32-t,Xte=(r,e,t)=>e<<t-32|r>>>64-t,Jte=(r,e,t)=>r<<t-32|e>>>64-t;function Zte(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}const ere=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),tre=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,rre=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),nre=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,ire=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0),sre=(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0,ze={fromBig:SB,split:Ute,toBig:Fte,shrSH:zte,shrSL:Vte,rotrSH:Kte,rotrSL:Hte,rotrBH:jte,rotrBL:qte,rotr32H:Wte,rotr32L:Gte,rotlSH:Qte,rotlSL:Yte,rotlBH:Xte,rotlBL:Jte,add:Zte,add3L:ere,add3H:tre,add4L:rre,add4H:nre,add5H:sre,add5L:ire},[ore,are]=ze.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),pa=new Uint32Array(80),ga=new Uint32Array(80);let cre=class extends EB{constructor(e=64){super(128,e,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:h,Fh:d,Fl:p,Gh:m,Gl:f,Hh:g,Hl:v}=this;return[e,t,n,i,s,o,a,c,l,h,d,p,m,f,g,v]}set(e,t,n,i,s,o,a,c,l,h,d,p,m,f,g,v){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=h|0,this.Fh=d|0,this.Fl=p|0,this.Gh=m|0,this.Gl=f|0,this.Hh=g|0,this.Hl=v|0}process(e,t){for(let b=0;b<16;b++,t+=4)pa[b]=e.getUint32(t),ga[b]=e.getUint32(t+=4);for(let b=16;b<80;b++){const E=pa[b-15]|0,C=ga[b-15]|0,k=ze.rotrSH(E,C,1)^ze.rotrSH(E,C,8)^ze.shrSH(E,C,7),x=ze.rotrSL(E,C,1)^ze.rotrSL(E,C,8)^ze.shrSL(E,C,7),I=pa[b-2]|0,T=ga[b-2]|0,L=ze.rotrSH(I,T,19)^ze.rotrBH(I,T,61)^ze.shrSH(I,T,6),V=ze.rotrSL(I,T,19)^ze.rotrBL(I,T,61)^ze.shrSL(I,T,6),U=ze.add4L(x,V,ga[b-7],ga[b-16]),G=ze.add4H(U,k,L,pa[b-7],pa[b-16]);pa[b]=G|0,ga[b]=U|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:h,Eh:d,El:p,Fh:m,Fl:f,Gh:g,Gl:v,Hh:y,Hl:w}=this;for(let b=0;b<80;b++){const E=ze.rotrSH(d,p,14)^ze.rotrSH(d,p,18)^ze.rotrBH(d,p,41),C=ze.rotrSL(d,p,14)^ze.rotrSL(d,p,18)^ze.rotrBL(d,p,41),k=d&m^~d&g,x=p&f^~p&v,I=ze.add5L(w,C,x,are[b],ga[b]),T=ze.add5H(I,y,E,k,ore[b],pa[b]),L=I|0,V=ze.rotrSH(n,i,28)^ze.rotrBH(n,i,34)^ze.rotrBH(n,i,39),U=ze.rotrSL(n,i,28)^ze.rotrBL(n,i,34)^ze.rotrBL(n,i,39),G=n&s^n&a^s&a,K=i&o^i&c^o&c;y=g|0,w=v|0,g=m|0,v=f|0,m=d|0,f=p|0,{h:d,l:p}=ze.add(l|0,h|0,T|0,L|0),l=a|0,h=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const q=ze.add3L(L,U,K);n=ze.add3H(q,T,V,G),i=q|0}({h:n,l:i}=ze.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=ze.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=ze.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:h}=ze.add(this.Dh|0,this.Dl|0,l|0,h|0),{h:d,l:p}=ze.add(this.Eh|0,this.El|0,d|0,p|0),{h:m,l:f}=ze.add(this.Fh|0,this.Fl|0,m|0,f|0),{h:g,l:v}=ze.add(this.Gh|0,this.Gl|0,g|0,v|0),{h:y,l:w}=ze.add(this.Hh|0,this.Hl|0,y|0,w|0),this.set(n,i,s,o,a,c,l,h,d,p,m,f,g,v,y,w)}roundClean(){pa.fill(0),ga.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const lre=vB(()=>new cre);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const fS=BigInt(0),wb=BigInt(1);function jh(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function pS(r){if(!jh(r))throw new Error("Uint8Array expected")}function ac(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}function j0(r){const e=r.toString(16);return e.length&1?"0"+e:e}function xB(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?fS:BigInt("0x"+r)}const AB=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",ure=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function qh(r){if(pS(r),AB)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=ure[r[t]];return e}const eo={_0:48,_9:57,A:65,F:70,a:97,f:102};function VI(r){if(r>=eo._0&&r<=eo._9)return r-eo._0;if(r>=eo.A&&r<=eo.F)return r-(eo.A-10);if(r>=eo.a&&r<=eo.f)return r-(eo.a-10)}function cy(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(AB)return Uint8Array.fromHex(r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let i=0,s=0;i<t;i++,s+=2){const o=VI(r.charCodeAt(s)),a=VI(r.charCodeAt(s+1));if(o===void 0||a===void 0){const c=r[s]+r[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function kl(r){return xB(qh(r))}function _l(r){return pS(r),xB(qh(Uint8Array.from(r).reverse()))}function z1(r,e){return cy(r.toString(16).padStart(e*2,"0"))}function V1(r,e){return z1(r,e).reverse()}function zt(r,e,t){let n;if(typeof e=="string")try{n=cy(e)}catch(s){throw new Error(r+" must be hex string or Uint8Array, cause: "+s)}else if(jh(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const i=n.length;if(typeof t=="number"&&i!==t)throw new Error(r+" of length "+t+" expected, got "+i);return n}function Wh(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];pS(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const s=r[n];t.set(s,i),i+=s.length}return t}const z8=r=>typeof r=="bigint"&&fS<=r;function gS(r,e,t){return z8(r)&&z8(e)&&z8(t)&&e<=r&&r<t}function jn(r,e,t,n){if(!gS(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function hre(r){let e;for(e=0;r>fS;r>>=wb,e+=1);return e}const cw=r=>(wb<<BigInt(r))-wb,V8=r=>new Uint8Array(r),KI=r=>Uint8Array.from(r);function dre(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=V8(r),i=V8(r),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...d)=>t(i,n,...d),c=(d=V8(0))=>{i=a(KI([0]),d),n=a(),d.length!==0&&(i=a(KI([1]),d),n=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const p=[];for(;d<e;){n=a();const m=n.slice();p.push(m),d+=n.length}return Wh(...p)};return(d,p)=>{o(),c(d);let m;for(;!(m=p(l()));)c();return o(),m}}const fre={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||jh(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function $d(r,e,t={}){const n=(i,s,o)=>{const a=fre[s];if(typeof a!="function")throw new Error("invalid validator function");const c=r[i];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(t))n(i,s,!0);return r}function ly(r){const e=new WeakMap;return(t,...n)=>{const i=e.get(t);if(i!==void 0)return i;const s=r(t,...n);return e.set(t,s),s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const cr=BigInt(0),Ot=BigInt(1),sl=BigInt(2),pre=BigInt(3),bb=BigInt(4),HI=BigInt(5),jI=BigInt(8);function mt(r,e){const t=r%e;return t>=cr?t:e+t}function CB(r,e,t){if(e<cr)throw new Error("invalid exponent, negatives unsupported");if(t<=cr)throw new Error("invalid modulus");if(t===Ot)return cr;let n=Ot;for(;e>cr;)e&Ot&&(n=n*r%t),r=r*r%t,e>>=Ot;return n}function Nt(r,e,t){let n=r;for(;e-- >cr;)n*=n,n%=t;return n}function vb(r,e){if(r===cr)throw new Error("invert: expected non-zero number");if(e<=cr)throw new Error("invert: expected positive modulus, got "+e);let t=mt(r,e),n=e,i=cr,s=Ot;for(;t!==cr;){const a=n/t,c=n%t,l=i-s*a;n=t,t=c,i=s,s=l}if(n!==Ot)throw new Error("invert: does not exist");return mt(i,e)}function gre(r){const e=(r-Ot)/sl;let t,n,i;for(t=r-Ot,n=0;t%sl===cr;t/=sl,n++);for(i=sl;i<r&&CB(i,e,r)!==r-Ot;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(r+Ot)/bb;return function(c,l){const h=c.pow(l,o);if(!c.eql(c.sqr(h),l))throw new Error("Cannot find square root");return h}}const s=(t+Ot)/sl;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=n,h=a.pow(a.mul(a.ONE,i),t),d=a.pow(c,s),p=a.pow(c,t);for(;!a.eql(p,a.ONE);){if(a.eql(p,a.ZERO))return a.ZERO;let m=1;for(let g=a.sqr(p);m<l&&!a.eql(g,a.ONE);m++)g=a.sqr(g);const f=a.pow(h,Ot<<BigInt(l-m-1));h=a.sqr(f),d=a.mul(d,f),p=a.mul(p,h),l=m}return d}}function yre(r){if(r%bb===pre){const e=(r+Ot)/bb;return function(n,i){const s=n.pow(i,e);if(!n.eql(n.sqr(s),i))throw new Error("Cannot find square root");return s}}if(r%jI===HI){const e=(r-HI)/jI;return function(n,i){const s=n.mul(i,sl),o=n.pow(s,e),a=n.mul(i,o),c=n.mul(n.mul(a,sl),o),l=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(l),i))throw new Error("Cannot find square root");return l}}return gre(r)}const mre=(r,e)=>(mt(r,e)&Ot)===Ot,wre=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function bre(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=wre.reduce((n,i)=>(n[i]="function",n),e);return $d(r,t)}function vre(r,e,t){if(t<cr)throw new Error("invalid exponent, negatives unsupported");if(t===cr)return r.ONE;if(t===Ot)return e;let n=r.ONE,i=e;for(;t>cr;)t&Ot&&(n=r.mul(n,i)),i=r.sqr(i),t>>=Ot;return n}function Ere(r,e){const t=new Array(e.length),n=e.reduce((s,o,a)=>r.is0(o)?s:(t[a]=s,r.mul(s,o)),r.ONE),i=r.inv(n);return e.reduceRight((s,o,a)=>r.is0(o)?s:(t[a]=r.mul(s,t[a]),r.mul(s,o)),i),t}function IB(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function lw(r,e,t=!1,n={}){if(r<=cr)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:i,nByteLength:s}=IB(r,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:r,isLE:t,BITS:i,BYTES:s,MASK:cw(i),ZERO:cr,ONE:Ot,create:c=>mt(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return cr<=c&&c<r},is0:c=>c===cr,isOdd:c=>(c&Ot)===Ot,neg:c=>mt(-c,r),eql:(c,l)=>c===l,sqr:c=>mt(c*c,r),add:(c,l)=>mt(c+l,r),sub:(c,l)=>mt(c-l,r),mul:(c,l)=>mt(c*l,r),pow:(c,l)=>vre(a,c,l),div:(c,l)=>mt(c*vb(l,r),r),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>vb(c,r),sqrt:n.sqrt||(c=>(o||(o=yre(r)),o(a,c))),invertBatch:c=>Ere(a,c),cmov:(c,l,h)=>h?l:c,toBytes:c=>t?V1(c,s):z1(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return t?_l(c):kl(c)}});return Object.freeze(a)}function kB(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function _B(r){const e=kB(r);return e+Math.ceil(e/2)}function Sre(r,e,t=!1){const n=r.length,i=kB(e),s=_B(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=t?_l(r):kl(r),a=mt(o,e-Ot)+Ot;return t?V1(a,i):z1(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const qI=BigInt(0),Eb=BigInt(1);function K8(r,e){const t=e.negate();return r?t:e}function TB(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function H8(r,e){TB(r,e);const t=Math.ceil(e/r)+1,n=2**(r-1),i=2**r,s=cw(r),o=BigInt(r);return{windows:t,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function WI(r,e,t){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=t;let a=Number(r&i),c=r>>o;a>n&&(a-=s,c+=Eb);const l=e*n,h=l+Math.abs(a)-1,d=a===0,p=a<0,m=e%2!==0;return{nextN:c,offset:h,isZero:d,isNeg:p,isNegF:m,offsetF:l}}function xre(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function Are(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}const j8=new WeakMap,PB=new WeakMap;function q8(r){return PB.get(r)||1}function DB(r,e){return{constTimeNegate:K8,hasPrecomputes(t){return q8(t)!==1},unsafeLadder(t,n,i=r.ZERO){let s=t;for(;n>qI;)n&Eb&&(i=i.add(s)),s=s.double(),n>>=Eb;return i},precomputeWindow(t,n){const{windows:i,windowSize:s}=H8(n,e),o=[];let a=t,c=a;for(let l=0;l<i;l++){c=a,o.push(c);for(let h=1;h<s;h++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,n,i){let s=r.ZERO,o=r.BASE;const a=H8(t,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:h,isZero:d,isNeg:p,isNegF:m,offsetF:f}=WI(i,c,a);i=l,d?o=o.add(K8(m,n[f])):s=s.add(K8(p,n[h]))}return{p:s,f:o}},wNAFUnsafe(t,n,i,s=r.ZERO){const o=H8(t,e);for(let a=0;a<o.windows&&i!==qI;a++){const{nextN:c,offset:l,isZero:h,isNeg:d}=WI(i,a,o);if(i=c,!h){const p=n[l];s=s.add(d?p.negate():p)}}return s},getPrecomputes(t,n,i){let s=j8.get(n);return s||(s=this.precomputeWindow(n,t),t!==1&&j8.set(n,i(s))),s},wNAFCached(t,n,i){const s=q8(t);return this.wNAF(s,this.getPrecomputes(s,t,i),n)},wNAFCachedUnsafe(t,n,i,s){const o=q8(t);return o===1?this.unsafeLadder(t,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,t,i),n,s)},setWindowSize(t,n){TB(n,e),PB.set(t,n),j8.delete(t)}}}function $B(r,e,t,n){if(xre(t,r),Are(n,e),t.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=r.ZERO,s=hre(BigInt(t.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=cw(o),c=new Array(Number(a)+1).fill(i),l=Math.floor((e.BITS-1)/o)*o;let h=i;for(let d=l;d>=0;d-=o){c.fill(i);for(let m=0;m<n.length;m++){const f=n[m],g=Number(f>>BigInt(d)&a);c[g]=c[g].add(t[m])}let p=i;for(let m=c.length-1,f=i;m>0;m--)f=f.add(c[m]),p=p.add(f);if(h=h.add(p),d!==0)for(let m=0;m<o;m++)h=h.double()}return h}function yS(r){return bre(r.Fp),$d(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...IB(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const vs=BigInt(0),Jr=BigInt(1),GI=BigInt(2),Cre=BigInt(8),Ire={zip215:!0};function kre(r){const e=yS(r);return $d(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function _re(r){const e=kre(r),{Fp:t,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,l=GI<<BigInt(a*8)-Jr,h=t.create,d=lw(e.n,e.nBitLength),p=e.uvRatio||((H,O)=>{try{return{isValid:!0,value:t.sqrt(H*t.inv(O))}}catch{return{isValid:!1,value:vs}}}),m=e.adjustScalarBytes||(H=>H),f=e.domain||((H,O,B)=>{if(ac("phflag",B),O.length||B)throw new Error("Contexts/pre-hash are not supported");return H});function g(H,O,B=!1){const W=B?Jr:vs;jn("coordinate "+H,O,W,l)}function v(H){if(!(H instanceof b))throw new Error("ExtendedPoint expected")}const y=ly((H,O)=>{const{ex:B,ey:W,ez:Y}=H,j=H.is0();O==null&&(O=j?Cre:t.inv(Y));const ce=h(B*O),me=h(W*O),he=h(Y*O);if(j)return{x:vs,y:Jr};if(he!==Jr)throw new Error("invZ was invalid");return{x:ce,y:me}}),w=ly(H=>{const{a:O,d:B}=e;if(H.is0())throw new Error("bad point: ZERO");const{ex:W,ey:Y,ez:j,et:ce}=H,me=h(W*W),he=h(Y*Y),ue=h(j*j),Ne=h(ue*ue),Me=h(me*O),Xe=h(ue*h(Me+he)),it=h(Ne+h(B*h(me*he)));if(Xe!==it)throw new Error("bad point: equation left != right (1)");const It=h(W*Y),kt=h(j*ce);if(It!==kt)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(O,B,W,Y){g("x",O),g("y",B),g("z",W,!0),g("t",Y),this.ex=O,this.ey=B,this.ez=W,this.et=Y,Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(O){if(O instanceof b)throw new Error("extended point not allowed");const{x:B,y:W}=O||{};return g("x",B),g("y",W),new b(B,W,Jr,h(B*W))}static normalizeZ(O){const B=t.invertBatch(O.map(W=>W.ez));return O.map((W,Y)=>W.toAffine(B[Y])).map(b.fromAffine)}static msm(O,B){return $B(b,d,O,B)}_setWindowSize(O){k.setWindowSize(this,O)}assertValidity(){w(this)}equals(O){v(O);const{ex:B,ey:W,ez:Y}=this,{ex:j,ey:ce,ez:me}=O,he=h(B*me),ue=h(j*Y),Ne=h(W*me),Me=h(ce*Y);return he===ue&&Ne===Me}is0(){return this.equals(b.ZERO)}negate(){return new b(h(-this.ex),this.ey,this.ez,h(-this.et))}double(){const{a:O}=e,{ex:B,ey:W,ez:Y}=this,j=h(B*B),ce=h(W*W),me=h(GI*h(Y*Y)),he=h(O*j),ue=B+W,Ne=h(h(ue*ue)-j-ce),Me=he+ce,Xe=Me-me,it=he-ce,It=h(Ne*Xe),kt=h(Me*it),Dt=h(Ne*it),rr=h(Xe*Me);return new b(It,kt,rr,Dt)}add(O){v(O);const{a:B,d:W}=e,{ex:Y,ey:j,ez:ce,et:me}=this,{ex:he,ey:ue,ez:Ne,et:Me}=O,Xe=h(Y*he),it=h(j*ue),It=h(me*W*Me),kt=h(ce*Ne),Dt=h((Y+j)*(he+ue)-Xe-it),rr=kt-It,Xr=kt+It,Fc=h(it-B*Xe),ia=h(Dt*rr),Su=h(Xr*Fc),xu=h(Dt*Fc),zc=h(rr*Xr);return new b(ia,Su,zc,xu)}subtract(O){return this.add(O.negate())}wNAF(O){return k.wNAFCached(this,O,b.normalizeZ)}multiply(O){const B=O;jn("scalar",B,Jr,n);const{p:W,f:Y}=this.wNAF(B);return b.normalizeZ([W,Y])[0]}multiplyUnsafe(O,B=b.ZERO){const W=O;return jn("scalar",W,vs,n),W===vs?C:this.is0()||W===Jr?this:k.wNAFCachedUnsafe(this,W,b.normalizeZ,B)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return k.unsafeLadder(this,n).is0()}toAffine(O){return y(this,O)}clearCofactor(){const{h:O}=e;return O===Jr?this:this.multiplyUnsafe(O)}static fromHex(O,B=!1){const{d:W,a:Y}=e,j=t.BYTES;O=zt("pointHex",O,j),ac("zip215",B);const ce=O.slice(),me=O[j-1];ce[j-1]=me&-129;const he=_l(ce),ue=B?l:t.ORDER;jn("pointHex.y",he,vs,ue);const Ne=h(he*he),Me=h(Ne-Jr),Xe=h(W*Ne-Y);let{isValid:it,value:It}=p(Me,Xe);if(!it)throw new Error("Point.fromHex: invalid y coordinate");const kt=(It&Jr)===Jr,Dt=(me&128)!==0;if(!B&&It===vs&&Dt)throw new Error("Point.fromHex: x=0 and x_0=1");return Dt!==kt&&(It=h(-It)),b.fromAffine({x:It,y:he})}static fromPrivateKey(O){const{scalar:B}=T(O);return E.multiply(B)}toRawBytes(){const{x:O,y:B}=this.toAffine(),W=V1(B,t.BYTES);return W[W.length-1]|=O&Jr?128:0,W}toHex(){return qh(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,Jr,h(e.Gx*e.Gy)),b.ZERO=new b(vs,Jr,Jr,vs);const{BASE:E,ZERO:C}=b,k=DB(b,a*8);function x(H){return mt(H,n)}function I(H){return x(_l(H))}function T(H){const O=t.BYTES;H=zt("private key",H,O);const B=zt("hashed private key",s(H),2*O),W=m(B.slice(0,O)),Y=B.slice(O,2*O),j=I(W);return{head:W,prefix:Y,scalar:j}}function L(H){const{head:O,prefix:B,scalar:W}=T(H),Y=E.multiply(W),j=Y.toRawBytes();return{head:O,prefix:B,scalar:W,point:Y,pointBytes:j}}function V(H){return L(H).pointBytes}function U(H=new Uint8Array,...O){const B=Wh(...O);return I(s(f(B,zt("context",H),!!i)))}function G(H,O,B={}){H=zt("message",H),i&&(H=i(H));const{prefix:W,scalar:Y,pointBytes:j}=L(O),ce=U(B.context,W,H),me=E.multiply(ce).toRawBytes(),he=U(B.context,me,j,H),ue=x(ce+he*Y);jn("signature.s",ue,vs,n);const Ne=Wh(me,V1(ue,t.BYTES));return zt("result",Ne,t.BYTES*2)}const K=Ire;function q(H,O,B,W=K){const{context:Y,zip215:j}=W,ce=t.BYTES;H=zt("signature",H,2*ce),O=zt("message",O),B=zt("publicKey",B,ce),j!==void 0&&ac("zip215",j),i&&(O=i(O));const me=_l(H.slice(ce,2*ce));let he,ue,Ne;try{he=b.fromHex(B,j),ue=b.fromHex(H.slice(0,ce),j),Ne=E.multiplyUnsafe(me)}catch{return!1}if(!j&&he.isSmallOrder())return!1;const Me=U(Y,ue.toRawBytes(),he.toRawBytes(),O);return ue.add(he.multiplyUnsafe(Me)).subtract(Ne).clearCofactor().equals(b.ZERO)}return E._setWindowSize(8),{CURVE:e,getPublicKey:V,sign:G,verify:q,ExtendedPoint:b,utils:{getExtendedPublicKey:L,randomPrivateKey:()=>o(t.BYTES),precompute(H=8,O=b.BASE){return O._setWindowSize(H),O.multiply(BigInt(3)),O}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Mu=BigInt(0),W8=BigInt(1);function Tre(r){return $d(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function Pre(r){const e=Tre(r),{P:t}=e,n=w=>mt(w,t),i=e.montgomeryBits,s=Math.ceil(i/8),o=e.nByteLength,a=e.adjustScalarBytes||(w=>w),c=e.powPminus2||(w=>CB(w,t-BigInt(2),t));function l(w,b,E){const C=n(w*(b-E));return b=n(b-C),E=n(E+C),[b,E]}const h=(e.a-BigInt(2))/BigInt(4);function d(w,b){jn("u",w,Mu,t),jn("scalar",b,Mu,t);const E=b,C=w;let k=W8,x=Mu,I=w,T=W8,L=Mu,V;for(let G=BigInt(i-1);G>=Mu;G--){const K=E>>G&W8;L^=K,V=l(L,k,I),k=V[0],I=V[1],V=l(L,x,T),x=V[0],T=V[1],L=K;const q=k+x,Q=n(q*q),H=k-x,O=n(H*H),B=Q-O,W=I+T,Y=I-T,j=n(Y*q),ce=n(W*H),me=j+ce,he=j-ce;I=n(me*me),T=n(C*n(he*he)),k=n(Q*O),x=n(B*(Q+n(h*B)))}V=l(L,k,I),k=V[0],I=V[1],V=l(L,x,T),x=V[0],T=V[1];const U=c(x);return n(k*U)}function p(w){return V1(n(w),s)}function m(w){const b=zt("u coordinate",w,s);return o===32&&(b[31]&=127),_l(b)}function f(w){const b=zt("scalar",w),E=b.length;if(E!==s&&E!==o){let C=""+s+" or "+o;throw new Error("invalid scalar, expected "+C+" bytes, got "+E)}return _l(a(b))}function g(w,b){const E=m(b),C=f(w),k=d(E,C);if(k===Mu)throw new Error("invalid private or public key received");return p(k)}const v=p(e.Gu);function y(w){return g(w,v)}return{scalarMult:g,scalarMultBase:y,getSharedSecret:(w,b)=>g(w,b),getPublicKey:w=>y(w),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:v}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const K1=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),QI=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Dre=BigInt(1),YI=BigInt(2),$re=BigInt(3),Nre=BigInt(5),Mre=BigInt(8);function NB(r){const e=BigInt(10),t=BigInt(20),n=BigInt(40),i=BigInt(80),s=K1,a=r*r%s*r%s,c=Nt(a,YI,s)*a%s,l=Nt(c,Dre,s)*r%s,h=Nt(l,Nre,s)*l%s,d=Nt(h,e,s)*h%s,p=Nt(d,t,s)*d%s,m=Nt(p,n,s)*p%s,f=Nt(m,i,s)*m%s,g=Nt(f,i,s)*m%s,v=Nt(g,e,s)*h%s;return{pow_p_5_8:Nt(v,YI,s)*r%s,b2:a}}function MB(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function Ore(r,e){const t=K1,n=mt(e*e*e,t),i=mt(n*n*e,t),s=NB(r*i).pow_p_5_8;let o=mt(r*n*s,t);const a=mt(e*o*o,t),c=o,l=mt(o*QI,t),h=a===r,d=a===mt(-r,t),p=a===mt(-r*QI,t);return h&&(o=c),(d||p)&&(o=l),mre(o,t)&&(o=mt(-o,t)),{isValid:h||d,value:o}}const XI=lw(K1,void 0,!0),Rre={a:XI.create(BigInt(-1)),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:XI,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Mre,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:lre,randomBytes:dS,adjustScalarBytes:MB,uvRatio:Ore},uy=_re(Rre),q0=Pre({P:K1,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{const e=K1,{pow_p_5_8:t,b2:n}=NB(r);return mt(Nt(t,$re,e)*n,e)},adjustScalarBytes:MB,randomBytes:dS}),H1=32,ho=64,Sb=32;function Lre(){const r=uy.utils.randomPrivateKey(),e=uy.getPublicKey(r);return{privateKey:Fre(r,e),publicKey:e}}function Bre(r,e){const t=r.subarray(0,Sb);return uy.sign(e instanceof Uint8Array?e:e.subarray(),t)}function Ure(r,e,t){return uy.verify(e,t instanceof Uint8Array?t:t.subarray(),r)}function Fre(r,e){const t=new Uint8Array(ho);for(let n=0;n<Sb;n++)t[n]=r[n],t[Sb+n]=e[n];return t}class OB{constructor(e){u(this,"type","Ed25519");u(this,"raw");this.raw=j1(e,H1)}toMultihash(){return lS.digest(_i(this))}toCID(){return iw.createV1(114,this.toMultihash())}toString(){return vi.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ke(this.raw,e.raw)}verify(e,t){return Ure(this.raw,t,e)}}class xb{constructor(e,t){u(this,"type","Ed25519");u(this,"raw");u(this,"publicKey");this.raw=j1(e,ho),this.publicKey=new OB(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ke(this.raw,e.raw)}sign(e){return Bre(this.raw,e)}}function RB(r){if(r.length>ho){r=j1(r,ho+H1);const n=r.subarray(0,ho),i=r.subarray(ho,r.length);return new xb(n,i)}r=j1(r,ho);const e=r.subarray(0,ho),t=r.subarray(H1);return new xb(e,t)}function mS(r){return r=j1(r,H1),new OB(r)}async function zre(){const{privateKey:r,publicKey:e}=Lre();return new xb(r,e)}function j1(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new Z(`Key must be a Uint8Array of length ${e}, got ${r.length}`);return r}const Vre=Math.pow(2,7),Kre=Math.pow(2,14),Hre=Math.pow(2,21),wS=Math.pow(2,28),bS=Math.pow(2,35),vS=Math.pow(2,42),ES=Math.pow(2,49),st=128,Hr=127;function dt(r){if(r<Vre)return 1;if(r<Kre)return 2;if(r<Hre)return 3;if(r<wS)return 4;if(r<bS)return 5;if(r<vS)return 6;if(r<ES)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function LB(r,e,t=0){switch(dt(r)){case 8:e[t++]=r&255|st,r/=128;case 7:e[t++]=r&255|st,r/=128;case 6:e[t++]=r&255|st,r/=128;case 5:e[t++]=r&255|st,r/=128;case 4:e[t++]=r&255|st,r>>>=7;case 3:e[t++]=r&255|st,r>>>=7;case 2:e[t++]=r&255|st,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function jre(r,e,t=0){switch(dt(r)){case 8:e.set(t++,r&255|st),r/=128;case 7:e.set(t++,r&255|st),r/=128;case 6:e.set(t++,r&255|st),r/=128;case 5:e.set(t++,r&255|st),r/=128;case 4:e.set(t++,r&255|st),r>>>=7;case 3:e.set(t++,r&255|st),r>>>=7;case 2:e.set(t++,r&255|st),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function BB(r,e){let t=r[e],n=0;if(n+=t&Hr,t<st||(t=r[e+1],n+=(t&Hr)<<7,t<st)||(t=r[e+2],n+=(t&Hr)<<14,t<st)||(t=r[e+3],n+=(t&Hr)<<21,t<st)||(t=r[e+4],n+=(t&Hr)*wS,t<st)||(t=r[e+5],n+=(t&Hr)*bS,t<st)||(t=r[e+6],n+=(t&Hr)*vS,t<st)||(t=r[e+7],n+=(t&Hr)*ES,t<st))return n;throw new RangeError("Could not decode varint")}function qre(r,e){let t=r.get(e),n=0;if(n+=t&Hr,t<st||(t=r.get(e+1),n+=(t&Hr)<<7,t<st)||(t=r.get(e+2),n+=(t&Hr)<<14,t<st)||(t=r.get(e+3),n+=(t&Hr)<<21,t<st)||(t=r.get(e+4),n+=(t&Hr)*wS,t<st)||(t=r.get(e+5),n+=(t&Hr)*bS,t<st)||(t=r.get(e+6),n+=(t&Hr)*vS,t<st)||(t=r.get(e+7),n+=(t&Hr)*ES,t<st))return n;throw new RangeError("Could not decode varint")}function br(r,e,t=0){return e==null&&(e=Pn(dt(r))),e instanceof Uint8Array?LB(r,e,t):jre(r,e,t)}function hs(r,e=0){return r instanceof Uint8Array?BB(r,e):qre(r,e)}const SS=new Float32Array([-0]),Ha=new Uint8Array(SS.buffer);function Wre(r,e,t){SS[0]=r,e[t]=Ha[0],e[t+1]=Ha[1],e[t+2]=Ha[2],e[t+3]=Ha[3]}function Gre(r,e){return Ha[0]=r[e],Ha[1]=r[e+1],Ha[2]=r[e+2],Ha[3]=r[e+3],SS[0]}const xS=new Float64Array([-0]),jr=new Uint8Array(xS.buffer);function Qre(r,e,t){xS[0]=r,e[t]=jr[0],e[t+1]=jr[1],e[t+2]=jr[2],e[t+3]=jr[3],e[t+4]=jr[4],e[t+5]=jr[5],e[t+6]=jr[6],e[t+7]=jr[7]}function Yre(r,e){return jr[0]=r[e],jr[1]=r[e+1],jr[2]=r[e+2],jr[3]=r[e+3],jr[4]=r[e+4],jr[5]=r[e+5],jr[6]=r[e+6],jr[7]=r[e+7],xS[0]}const Xre=BigInt(Number.MAX_SAFE_INTEGER),Jre=BigInt(Number.MIN_SAFE_INTEGER);class Wr{constructor(e,t){u(this,"lo");u(this,"hi");this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return Tl;if(e<Xre&&e>Jre)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let n=e>>32n,i=e-(n<<32n);return t&&(n=~n|0n,i=~i|0n,++i>JI&&(i=0n,++n>JI&&(n=0n))),new Wr(Number(i),Number(n))}static fromNumber(e){if(e===0)return Tl;const t=e<0;t&&(e=-e);let n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new Wr(n,i)}static from(e){return typeof e=="number"?Wr.fromNumber(e):typeof e=="bigint"?Wr.fromBigInt(e):typeof e=="string"?Wr.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new Wr(e.low>>>0,e.high>>>0):Tl}}const Tl=new Wr(0,0);Tl.toBigInt=function(){return 0n};Tl.zzEncode=Tl.zzDecode=function(){return this};Tl.length=function(){return 1};const JI=4294967296n;function Zre(r){let e=0,t=0;for(let n=0;n<r.length;++n)t=r.charCodeAt(n),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function ene(r,e,t){if(t-e<1)return"";let i;const s=[];let o=0,a;for(;e<t;)a=r[e++],a<128?s[o++]=a:a>191&&a<224?s[o++]=(a&31)<<6|r[e++]&63:a>239&&a<365?(a=((a&7)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,s[o++]=55296+(a>>10),s[o++]=56320+(a&1023)):s[o++]=(a&15)<<12|(r[e++]&63)<<6|r[e++]&63,o>8191&&((i??(i=[])).push(String.fromCharCode.apply(String,s)),o=0);return i!=null?(o>0&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))}function UB(r,e,t){const n=t;let i,s;for(let o=0;o<r.length;++o)i=r.charCodeAt(o),i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&((s=r.charCodeAt(o+1))&64512)===56320?(i=65536+((i&1023)<<10)+(s&1023),++o,e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128);return t-n}function Fi(r,e){return RangeError(`index out of range: ${r.pos} + ${e??1} > ${r.len}`)}function W0(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}class tne{constructor(e){u(this,"buf");u(this,"pos");u(this,"len");u(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Fi(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Fi(this,4);return W0(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Fi(this,4);return W0(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Fi(this,4);const e=Gre(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw Fi(this,4);const e=Yre(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Fi(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){const e=this.bytes();return ene(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Fi(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Fi(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new Wr(0,0);let t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw Fi(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw Fi(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Fi(this,8);const e=W0(this.buf,this.pos+=4),t=W0(this.buf,this.pos+=4);return new Wr(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=BB(this.buf,this.pos);return this.pos+=dt(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function rne(r){return new tne(r instanceof Uint8Array?r:r.subarray())}function _e(r,e,t){const n=rne(r);return e.decode(n,void 0,t)}function nne(r){let n,i=8192;return function(o){if(o<1||o>4096)return Pn(o);i+o>8192&&(n=Pn(8192),i=0);const a=n.subarray(i,i+=o);return i&7&&(i=(i|7)+1),a}}class zf{constructor(e,t,n){u(this,"fn");u(this,"len");u(this,"next");u(this,"val");this.fn=e,this.len=t,this.next=void 0,this.val=n}}function G8(){}class ine{constructor(e){u(this,"head");u(this,"tail");u(this,"len");u(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const sne=nne();function one(r){return globalThis.Buffer!=null?Pn(r):sne(r)}class Ab{constructor(){u(this,"len");u(this,"head");u(this,"tail");u(this,"states");this.len=0,this.head=new zf(G8,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new zf(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new cne((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(G0,10,Wr.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=Wr.fromBigInt(e);return this._push(G0,t.length(),t)}uint64Number(e){return this._push(LB,dt(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=Wr.fromBigInt(e).zzEncode();return this._push(G0,t.length(),t)}sint64Number(e){const t=Wr.fromNumber(e).zzEncode();return this._push(G0,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(Q8,1,e?1:0)}fixed32(e){return this._push(vf,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=Wr.fromBigInt(e);return this._push(vf,4,t.lo)._push(vf,4,t.hi)}fixed64Number(e){const t=Wr.fromNumber(e);return this._push(vf,4,t.lo)._push(vf,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(Wre,4,e)}double(e){return this._push(Qre,8,e)}bytes(e){const t=e.length>>>0;return t===0?this._push(Q8,1,0):this.uint32(t)._push(lne,t,e)}string(e){const t=Zre(e);return t!==0?this.uint32(t)._push(UB,t,e):this._push(Q8,1,0)}fork(){return this.states=new ine(this),this.head=this.tail=new zf(G8,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new zf(G8,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next;const t=one(this.len);let n=0;for(;e!=null;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}}function Q8(r,e,t){e[t]=r&255}function ane(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}class cne extends zf{constructor(t,n){super(ane,t,n);u(this,"next");this.next=void 0}}function G0(r,e,t){for(;r.hi!==0;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}function vf(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function lne(r,e,t){e.set(r,t)}globalThis.Buffer!=null&&(Ab.prototype.bytes=function(r){const e=r.length>>>0;return this.uint32(e),e>0&&this._push(une,e,r),this},Ab.prototype.string=function(r){const e=globalThis.Buffer.byteLength(r);return this.uint32(e),e>0&&this._push(hne,e,r),this});function une(r,e,t){e.set(r,t)}function hne(r,e,t){r.length<40?UB(r,e,t):e.utf8Write!=null?e.utf8Write(r,t):e.set(se(r),t)}function dne(){return new Ab}function Te(r,e){const t=dne();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var hy;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(hy||(hy={}));function FB(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function Dn(r){function e(i){if(r[i.toString()]==null)throw new Error("Invalid enum value");return r[i]}const t=function(s,o){const a=e(s);o.int32(a)},n=function(s){const o=s.int32();return e(o)};return FB("enum",hy.VARINT,t,n)}function Pe(r,e){return FB("message",hy.LENGTH_DELIMITED,r,e)}class ht extends Error{constructor(){super(...arguments);u(this,"code","ERR_MAX_LENGTH");u(this,"name","MaxLengthError")}}class ZI extends Error{constructor(){super(...arguments);u(this,"code","ERR_MAX_SIZE");u(this,"name","MaxSizeError")}}var Pt;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.ECDSA="ECDSA"})(Pt||(Pt={}));var Cb;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1",r[r.ECDSA=3]="ECDSA"})(Cb||(Cb={}));(function(r){r.codec=()=>Dn(Cb)})(Pt||(Pt={}));var wc;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Pt.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=Pt.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(wc||(wc={}));var dy;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Pt.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=Pt.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(dy||(dy={}));const Ou=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function fne(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function mh(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function zp(r,...e){if(!fne(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function uw(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");mh(r.outputLen),mh(r.blockLen)}function fy(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function pne(r,e){zp(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Us(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function s1(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function Es(r,e){return r<<32-e|r>>>e}function Y8(r,e){return r<<e|r>>>32-e>>>0}const gne=async()=>{};async function yne(r,e,t){let n=Date.now();for(let i=0;i<r;i++){t(i);const s=Date.now()-n;s>=0&&s<e||(await gne(),n+=s)}}function zB(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function q1(r){return typeof r=="string"&&(r=zB(r)),zp(r),r}function ek(r){return typeof r=="string"&&(r=zB(r)),zp(r),r}function mne(r,e){if(e!==void 0&&{}.toString.call(e)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(r,e)}class VB{}function AS(r){const e=n=>r().update(q1(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function wne(r=32){if(Ou&&typeof Ou.getRandomValues=="function")return Ou.getRandomValues(new Uint8Array(r));if(Ou&&typeof Ou.randomBytes=="function")return Uint8Array.from(Ou.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function bc(r){if(isNaN(r)||r<=0)throw new Z("random bytes length must be a Number bigger than 0");return wne(r)}class tk extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}}class rk extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class bne extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}const Fs={get(r=globalThis){const e=r.crypto;if((e==null?void 0:e.subtle)==null)throw new bne("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}};function vne(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function KB(r,e,t){return r&e^~r&t}function HB(r,e,t){return r&e^r&t^e&t}class CS extends VB{constructor(e,t,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=s1(this.buffer)}update(e){fy(this),e=q1(e),zp(e);const{view:t,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=s1(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){fy(this),pne(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,Us(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let d=o;d<i;d++)t[d]=0;vne(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=s1(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,h=this.get();if(l>h.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<l;d++)a.setUint32(4*d,h[d],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const ya=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Tr=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Q0=BigInt(2**32-1),nk=BigInt(32);function Ene(r,e=!1){return e?{h:Number(r&Q0),l:Number(r>>nk&Q0)}:{h:Number(r>>nk&Q0)|0,l:Number(r&Q0)|0}}function Sne(r,e=!1){const t=r.length;let n=new Uint32Array(t),i=new Uint32Array(t);for(let s=0;s<t;s++){const{h:o,l:a}=Ene(r[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const ik=(r,e,t)=>r>>>t,sk=(r,e,t)=>r<<32-t|e>>>t,Ru=(r,e,t)=>r>>>t|e<<32-t,Lu=(r,e,t)=>r<<32-t|e>>>t,Y0=(r,e,t)=>r<<64-t|e>>>t-32,X0=(r,e,t)=>r>>>t-32|e<<64-t;function to(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}const xne=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),Ane=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,Cne=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),Ine=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,kne=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0),_ne=(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0,Tne=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ma=new Uint32Array(64);class Pne extends CS{constructor(e=32){super(64,e,8,!1),this.A=ya[0]|0,this.B=ya[1]|0,this.C=ya[2]|0,this.D=ya[3]|0,this.E=ya[4]|0,this.F=ya[5]|0,this.G=ya[6]|0,this.H=ya[7]|0}get(){const{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let d=0;d<16;d++,t+=4)ma[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){const p=ma[d-15],m=ma[d-2],f=Es(p,7)^Es(p,18)^p>>>3,g=Es(m,17)^Es(m,19)^m>>>10;ma[d]=g+ma[d-7]+f+ma[d-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:l,H:h}=this;for(let d=0;d<64;d++){const p=Es(a,6)^Es(a,11)^Es(a,25),m=h+p+KB(a,c,l)+Tne[d]+ma[d]|0,g=(Es(n,2)^Es(n,13)^Es(n,22))+HB(n,i,s)|0;h=l,l=c,c=a,a=o+m|0,o=s,s=i,i=n,n=m+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,h=h+this.H|0,this.set(n,i,s,o,a,c,l,h)}roundClean(){Us(ma)}destroy(){this.set(0,0,0,0,0,0,0,0),Us(this.buffer)}}const jB=Sne(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Dne=jB[0],$ne=jB[1],wa=new Uint32Array(80),ba=new Uint32Array(80);class Nne extends CS{constructor(e=64){super(128,e,16,!1),this.Ah=Tr[0]|0,this.Al=Tr[1]|0,this.Bh=Tr[2]|0,this.Bl=Tr[3]|0,this.Ch=Tr[4]|0,this.Cl=Tr[5]|0,this.Dh=Tr[6]|0,this.Dl=Tr[7]|0,this.Eh=Tr[8]|0,this.El=Tr[9]|0,this.Fh=Tr[10]|0,this.Fl=Tr[11]|0,this.Gh=Tr[12]|0,this.Gl=Tr[13]|0,this.Hh=Tr[14]|0,this.Hl=Tr[15]|0}get(){const{Ah:e,Al:t,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:h,Fh:d,Fl:p,Gh:m,Gl:f,Hh:g,Hl:v}=this;return[e,t,n,i,s,o,a,c,l,h,d,p,m,f,g,v]}set(e,t,n,i,s,o,a,c,l,h,d,p,m,f,g,v){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=h|0,this.Fh=d|0,this.Fl=p|0,this.Gh=m|0,this.Gl=f|0,this.Hh=g|0,this.Hl=v|0}process(e,t){for(let b=0;b<16;b++,t+=4)wa[b]=e.getUint32(t),ba[b]=e.getUint32(t+=4);for(let b=16;b<80;b++){const E=wa[b-15]|0,C=ba[b-15]|0,k=Ru(E,C,1)^Ru(E,C,8)^ik(E,C,7),x=Lu(E,C,1)^Lu(E,C,8)^sk(E,C,7),I=wa[b-2]|0,T=ba[b-2]|0,L=Ru(I,T,19)^Y0(I,T,61)^ik(I,T,6),V=Lu(I,T,19)^X0(I,T,61)^sk(I,T,6),U=Cne(x,V,ba[b-7],ba[b-16]),G=Ine(U,k,L,wa[b-7],wa[b-16]);wa[b]=G|0,ba[b]=U|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:h,Eh:d,El:p,Fh:m,Fl:f,Gh:g,Gl:v,Hh:y,Hl:w}=this;for(let b=0;b<80;b++){const E=Ru(d,p,14)^Ru(d,p,18)^Y0(d,p,41),C=Lu(d,p,14)^Lu(d,p,18)^X0(d,p,41),k=d&m^~d&g,x=p&f^~p&v,I=kne(w,C,x,$ne[b],ba[b]),T=_ne(I,y,E,k,Dne[b],wa[b]),L=I|0,V=Ru(n,i,28)^Y0(n,i,34)^Y0(n,i,39),U=Lu(n,i,28)^X0(n,i,34)^X0(n,i,39),G=n&s^n&a^s&a,K=i&o^i&c^o&c;y=g|0,w=v|0,g=m|0,v=f|0,m=d|0,f=p|0,{h:d,l:p}=to(l|0,h|0,T|0,L|0),l=a|0,h=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const q=xne(L,U,K);n=Ane(q,T,V,G),i=q|0}({h:n,l:i}=to(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=to(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=to(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:h}=to(this.Dh|0,this.Dl|0,l|0,h|0),{h:d,l:p}=to(this.Eh|0,this.El|0,d|0,p|0),{h:m,l:f}=to(this.Fh|0,this.Fl|0,m|0,f|0),{h:g,l:v}=to(this.Gh|0,this.Gl|0,g|0,v|0),{h:y,l:w}=to(this.Hh|0,this.Hl|0,y|0,w|0),this.set(n,i,s,o,a,c,l,h,d,p,m,f,g,v,y,w)}roundClean(){Us(wa,ba)}destroy(){Us(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Mne=AS(()=>new Pne),One=AS(()=>new Nne),Pl=Mne;let IS=class{constructor(e,t){u(this,"type","RSA");u(this,"jwk");u(this,"_raw");u(this,"_multihash");this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=_S(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return iw.createV1(114,this._multihash)}toString(){return vi.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ke(this.raw,e.raw)}verify(e,t){return Qne(this.jwk,t,e)}},qB=class{constructor(e,t){u(this,"type","RSA");u(this,"jwk");u(this,"_raw");u(this,"publicKey");this.jwk=e,this.publicKey=t}get raw(){return this._raw==null&&(this._raw=Une(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ke(this.raw,e.raw)}sign(e){return Gne(this.jwk,e)}};const WB=8192,kS=18,Rne=1062,Lne=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function Bne(r){return{n:re(r[1],"base64url"),e:re(r[2],"base64url"),d:re(r[3],"base64url"),p:re(r[4],"base64url"),q:re(r[5],"base64url"),dp:re(r[6],"base64url"),dq:re(r[7],"base64url"),qi:re(r[8],"base64url"),kty:"RSA"}}function Une(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new Z("JWK was missing components");return xo([zn(Uint8Array.from([0])),zn(se(r.n,"base64url")),zn(se(r.e,"base64url")),zn(se(r.d,"base64url")),zn(se(r.p,"base64url")),zn(se(r.q,"base64url")),zn(se(r.dp,"base64url")),zn(se(r.dq,"base64url")),zn(se(r.qi,"base64url"))]).subarray()}function Fne(r){const e=Mc(r[1],{offset:0});return{kty:"RSA",n:re(e[0],"base64url"),e:re(e[1],"base64url")}}function _S(r){if(r.n==null||r.e==null)throw new Z("JWK was missing components");return xo([Lne,uS(xo([zn(se(r.n,"base64url")),zn(se(r.e,"base64url"))]))]).subarray()}function zne(r){const e=Mc(r);return GB(e)}function GB(r){const e=Bne(r);return Kne(e)}function Vne(r,e){if(r.byteLength>=Rne)throw new F1("Key size is too large");const t=Mc(r,{offset:0});return QB(t,r,e)}function QB(r,e,t){const n=Fne(r);if(t==null){const i=Pl(wc.encode({Type:Pt.RSA,Data:e}));t=Kl(kS,i)}return new IS(n,t)}function Kne(r){if(Xne(r)>WB)throw new Z("Key size is too large");const e=jne(r),t=Pl(wc.encode({Type:Pt.RSA,Data:_S(e.publicKey)})),n=Kl(kS,t);return new qB(e.privateKey,new IS(e.publicKey,n))}async function Hne(r){if(r>WB)throw new Z("Key size is too large");const e=await Wne(r),t=Pl(wc.encode({Type:Pt.RSA,Data:_S(e.publicKey)})),n=Kl(kS,t);return new qB(e.privateKey,new IS(e.publicKey,n))}function jne(r){if(r==null)throw new Z("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}const qne="1.2.840.113549.1.1.1";async function Wne(r){const e=await Fs.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await Yne(e);return{privateKey:t[0],publicKey:t[1]}}async function Gne(r,e){const t=await Fs.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Fs.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(n,0,n.byteLength)}async function Qne(r,e,t){const n=await Fs.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Fs.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,t instanceof Uint8Array?t:t.subarray())}async function Yne(r){if(r.privateKey==null||r.publicKey==null)throw new Z("Private and public key are required");return Promise.all([Fs.get().subtle.exportKey("jwk",r.privateKey),Fs.get().subtle.exportKey("jwk",r.publicKey)])}function Xne(r){if(r.kty!=="RSA")throw new Z("invalid key type");if(r.n==null)throw new Z("invalid key modulus");return se(r.n,"base64url").length*8}let YB=class extends bB{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Tte(e);const n=hS(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return ay(this),this.iHash.update(e),this}digestInto(e){ay(this),aw(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const XB=(r,e,t)=>new YB(r,e).update(t).digest();XB.create=(r,e)=>new YB(r,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function ok(r){r.lowS!==void 0&&ac("lowS",r.lowS),r.prehash!==void 0&&ac("prehash",r.prehash)}function Jne(r){const e=yS(r);$d(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:n,a:i}=e;if(t){if(!n.eql(i,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}class Zne extends Error{constructor(e=""){super(e)}}const fo={Err:Zne,_tlv:{encode:(r,e)=>{const{Err:t}=fo;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const n=e.length/2,i=j0(n);if(i.length/2&128)throw new t("tlv.encode: long form length too big");const s=n>127?j0(i.length/2|128):"";return j0(r)+s+i+e},decode(r,e){const{Err:t}=fo;let n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const h of l)o=o<<8|h;if(n+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(r){const{Err:e}=fo;if(r<yo)throw new e("integer: negative integers are not allowed");let t=j0(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=fo;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return kl(r)}},toSig(r){const{Err:e,_int:t,_tlv:n}=fo,i=zt("signature",r),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:l,l:h}=n.decode(2,c);if(h.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(r){const{_tlv:e,_int:t}=fo,n=e.encode(2,t.encode(r.r)),i=e.encode(2,t.encode(r.s)),s=n+i;return e.encode(48,s)}},yo=BigInt(0),ir=BigInt(1);BigInt(2);const ak=BigInt(3);BigInt(4);function eie(r){const e=Jne(r),{Fp:t}=e,n=lw(e.n,e.nBitLength),i=e.toBytes||((g,v,y)=>{const w=v.toAffine();return Wh(Uint8Array.from([4]),t.toBytes(w.x),t.toBytes(w.y))}),s=e.fromBytes||(g=>{const v=g.subarray(1),y=t.fromBytes(v.subarray(0,t.BYTES)),w=t.fromBytes(v.subarray(t.BYTES,2*t.BYTES));return{x:y,y:w}});function o(g){const{a:v,b:y}=e,w=t.sqr(g),b=t.mul(w,g);return t.add(t.add(b,t.mul(g,v)),y)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(g){return gS(g,ir,e.n)}function c(g){const{allowedPrivateKeyLengths:v,nByteLength:y,wrapPrivateKey:w,n:b}=e;if(v&&typeof g!="bigint"){if(jh(g)&&(g=qh(g)),typeof g!="string"||!v.includes(g.length))throw new Error("invalid private key");g=g.padStart(y*2,"0")}let E;try{E=typeof g=="bigint"?g:kl(zt("private key",g,y))}catch{throw new Error("invalid private key, expected hex or "+y+" bytes, got "+typeof g)}return w&&(E=mt(E,b)),jn("private key",E,ir,b),E}function l(g){if(!(g instanceof p))throw new Error("ProjectivePoint expected")}const h=ly((g,v)=>{const{px:y,py:w,pz:b}=g;if(t.eql(b,t.ONE))return{x:y,y:w};const E=g.is0();v==null&&(v=E?t.ONE:t.inv(b));const C=t.mul(y,v),k=t.mul(w,v),x=t.mul(b,v);if(E)return{x:t.ZERO,y:t.ZERO};if(!t.eql(x,t.ONE))throw new Error("invZ was invalid");return{x:C,y:k}}),d=ly(g=>{if(g.is0()){if(e.allowInfinityPoint&&!t.is0(g.py))return;throw new Error("bad point: ZERO")}const{x:v,y}=g.toAffine();if(!t.isValid(v)||!t.isValid(y))throw new Error("bad point: x or y not FE");const w=t.sqr(y),b=o(v);if(!t.eql(w,b))throw new Error("bad point: equation left != right");if(!g.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class p{constructor(v,y,w){if(v==null||!t.isValid(v))throw new Error("x required");if(y==null||!t.isValid(y))throw new Error("y required");if(w==null||!t.isValid(w))throw new Error("z required");this.px=v,this.py=y,this.pz=w,Object.freeze(this)}static fromAffine(v){const{x:y,y:w}=v||{};if(!v||!t.isValid(y)||!t.isValid(w))throw new Error("invalid affine point");if(v instanceof p)throw new Error("projective point not allowed");const b=E=>t.eql(E,t.ZERO);return b(y)&&b(w)?p.ZERO:new p(y,w,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(v){const y=t.invertBatch(v.map(w=>w.pz));return v.map((w,b)=>w.toAffine(y[b])).map(p.fromAffine)}static fromHex(v){const y=p.fromAffine(s(zt("pointHex",v)));return y.assertValidity(),y}static fromPrivateKey(v){return p.BASE.multiply(c(v))}static msm(v,y){return $B(p,n,v,y)}_setWindowSize(v){f.setWindowSize(this,v)}assertValidity(){d(this)}hasEvenY(){const{y:v}=this.toAffine();if(t.isOdd)return!t.isOdd(v);throw new Error("Field doesn't support isOdd")}equals(v){l(v);const{px:y,py:w,pz:b}=this,{px:E,py:C,pz:k}=v,x=t.eql(t.mul(y,k),t.mul(E,b)),I=t.eql(t.mul(w,k),t.mul(C,b));return x&&I}negate(){return new p(this.px,t.neg(this.py),this.pz)}double(){const{a:v,b:y}=e,w=t.mul(y,ak),{px:b,py:E,pz:C}=this;let k=t.ZERO,x=t.ZERO,I=t.ZERO,T=t.mul(b,b),L=t.mul(E,E),V=t.mul(C,C),U=t.mul(b,E);return U=t.add(U,U),I=t.mul(b,C),I=t.add(I,I),k=t.mul(v,I),x=t.mul(w,V),x=t.add(k,x),k=t.sub(L,x),x=t.add(L,x),x=t.mul(k,x),k=t.mul(U,k),I=t.mul(w,I),V=t.mul(v,V),U=t.sub(T,V),U=t.mul(v,U),U=t.add(U,I),I=t.add(T,T),T=t.add(I,T),T=t.add(T,V),T=t.mul(T,U),x=t.add(x,T),V=t.mul(E,C),V=t.add(V,V),T=t.mul(V,U),k=t.sub(k,T),I=t.mul(V,L),I=t.add(I,I),I=t.add(I,I),new p(k,x,I)}add(v){l(v);const{px:y,py:w,pz:b}=this,{px:E,py:C,pz:k}=v;let x=t.ZERO,I=t.ZERO,T=t.ZERO;const L=e.a,V=t.mul(e.b,ak);let U=t.mul(y,E),G=t.mul(w,C),K=t.mul(b,k),q=t.add(y,w),Q=t.add(E,C);q=t.mul(q,Q),Q=t.add(U,G),q=t.sub(q,Q),Q=t.add(y,b);let H=t.add(E,k);return Q=t.mul(Q,H),H=t.add(U,K),Q=t.sub(Q,H),H=t.add(w,b),x=t.add(C,k),H=t.mul(H,x),x=t.add(G,K),H=t.sub(H,x),T=t.mul(L,Q),x=t.mul(V,K),T=t.add(x,T),x=t.sub(G,T),T=t.add(G,T),I=t.mul(x,T),G=t.add(U,U),G=t.add(G,U),K=t.mul(L,K),Q=t.mul(V,Q),G=t.add(G,K),K=t.sub(U,K),K=t.mul(L,K),Q=t.add(Q,K),U=t.mul(G,Q),I=t.add(I,U),U=t.mul(H,Q),x=t.mul(q,x),x=t.sub(x,U),U=t.mul(q,G),T=t.mul(H,T),T=t.add(T,U),new p(x,I,T)}subtract(v){return this.add(v.negate())}is0(){return this.equals(p.ZERO)}wNAF(v){return f.wNAFCached(this,v,p.normalizeZ)}multiplyUnsafe(v){const{endo:y,n:w}=e;jn("scalar",v,yo,w);const b=p.ZERO;if(v===yo)return b;if(this.is0()||v===ir)return this;if(!y||f.hasPrecomputes(this))return f.wNAFCachedUnsafe(this,v,p.normalizeZ);let{k1neg:E,k1:C,k2neg:k,k2:x}=y.splitScalar(v),I=b,T=b,L=this;for(;C>yo||x>yo;)C&ir&&(I=I.add(L)),x&ir&&(T=T.add(L)),L=L.double(),C>>=ir,x>>=ir;return E&&(I=I.negate()),k&&(T=T.negate()),T=new p(t.mul(T.px,y.beta),T.py,T.pz),I.add(T)}multiply(v){const{endo:y,n:w}=e;jn("scalar",v,ir,w);let b,E;if(y){const{k1neg:C,k1:k,k2neg:x,k2:I}=y.splitScalar(v);let{p:T,f:L}=this.wNAF(k),{p:V,f:U}=this.wNAF(I);T=f.constTimeNegate(C,T),V=f.constTimeNegate(x,V),V=new p(t.mul(V.px,y.beta),V.py,V.pz),b=T.add(V),E=L.add(U)}else{const{p:C,f:k}=this.wNAF(v);b=C,E=k}return p.normalizeZ([b,E])[0]}multiplyAndAddUnsafe(v,y,w){const b=p.BASE,E=(k,x)=>x===yo||x===ir||!k.equals(b)?k.multiplyUnsafe(x):k.multiply(x),C=E(this,y).add(E(v,w));return C.is0()?void 0:C}toAffine(v){return h(this,v)}isTorsionFree(){const{h:v,isTorsionFree:y}=e;if(v===ir)return!0;if(y)return y(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:v,clearCofactor:y}=e;return v===ir?this:y?y(p,this):this.multiplyUnsafe(e.h)}toRawBytes(v=!0){return ac("isCompressed",v),this.assertValidity(),i(p,this,v)}toHex(v=!0){return ac("isCompressed",v),qh(this.toRawBytes(v))}}p.BASE=new p(e.Gx,e.Gy,t.ONE),p.ZERO=new p(t.ZERO,t.ONE,t.ZERO);const m=e.nBitLength,f=DB(p,e.endo?Math.ceil(m/2):m);return{CURVE:e,ProjectivePoint:p,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function tie(r){const e=yS(r);return $d(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function rie(r){const e=tie(r),{Fp:t,n}=e,i=t.BYTES+1,s=2*t.BYTES+1;function o(K){return mt(K,n)}function a(K){return vb(K,n)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:h,isWithinCurveOrder:d}=eie({...e,toBytes(K,q,Q){const H=q.toAffine(),O=t.toBytes(H.x),B=Wh;return ac("isCompressed",Q),Q?B(Uint8Array.from([q.hasEvenY()?2:3]),O):B(Uint8Array.from([4]),O,t.toBytes(H.y))},fromBytes(K){const q=K.length,Q=K[0],H=K.subarray(1);if(q===i&&(Q===2||Q===3)){const O=kl(H);if(!gS(O,ir,t.ORDER))throw new Error("Point is not on curve");const B=h(O);let W;try{W=t.sqrt(B)}catch(ce){const me=ce instanceof Error?": "+ce.message:"";throw new Error("Point is not on curve"+me)}const Y=(W&ir)===ir;return(Q&1)===1!==Y&&(W=t.neg(W)),{x:O,y:W}}else if(q===s&&Q===4){const O=t.fromBytes(H.subarray(0,t.BYTES)),B=t.fromBytes(H.subarray(t.BYTES,2*t.BYTES));return{x:O,y:B}}else{const O=i,B=s;throw new Error("invalid Point, expected length of "+O+", or uncompressed "+B+", got "+q)}}}),p=K=>qh(z1(K,e.nByteLength));function m(K){const q=n>>ir;return K>q}function f(K){return m(K)?o(-K):K}const g=(K,q,Q)=>kl(K.slice(q,Q));class v{constructor(q,Q,H){jn("r",q,ir,n),jn("s",Q,ir,n),this.r=q,this.s=Q,H!=null&&(this.recovery=H),Object.freeze(this)}static fromCompact(q){const Q=e.nByteLength;return q=zt("compactSignature",q,Q*2),new v(g(q,0,Q),g(q,Q,2*Q))}static fromDER(q){const{r:Q,s:H}=fo.toSig(zt("DER",q));return new v(Q,H)}assertValidity(){}addRecoveryBit(q){return new v(this.r,this.s,q)}recoverPublicKey(q){const{r:Q,s:H,recovery:O}=this,B=k(zt("msgHash",q));if(O==null||![0,1,2,3].includes(O))throw new Error("recovery id invalid");const W=O===2||O===3?Q+e.n:Q;if(W>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const Y=O&1?"03":"02",j=c.fromHex(Y+p(W)),ce=a(W),me=o(-B*ce),he=o(H*ce),ue=c.BASE.multiplyAndAddUnsafe(j,me,he);if(!ue)throw new Error("point at infinify");return ue.assertValidity(),ue}hasHighS(){return m(this.s)}normalizeS(){return this.hasHighS()?new v(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return cy(this.toDERHex())}toDERHex(){return fo.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return cy(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}}const y={isValidPrivateKey(K){try{return l(K),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const K=_B(e.n);return Sre(e.randomBytes(K),e.n)},precompute(K=8,q=c.BASE){return q._setWindowSize(K),q.multiply(BigInt(3)),q}};function w(K,q=!0){return c.fromPrivateKey(K).toRawBytes(q)}function b(K){const q=jh(K),Q=typeof K=="string",H=(q||Q)&&K.length;return q?H===i||H===s:Q?H===2*i||H===2*s:K instanceof c}function E(K,q,Q=!0){if(b(K))throw new Error("first arg must be private key");if(!b(q))throw new Error("second arg must be public key");return c.fromHex(q).multiply(l(K)).toRawBytes(Q)}const C=e.bits2int||function(K){if(K.length>8192)throw new Error("input is too large");const q=kl(K),Q=K.length*8-e.nBitLength;return Q>0?q>>BigInt(Q):q},k=e.bits2int_modN||function(K){return o(C(K))},x=cw(e.nBitLength);function I(K){return jn("num < 2^"+e.nBitLength,K,yo,x),z1(K,e.nByteLength)}function T(K,q,Q=L){if(["recovered","canonical"].some(Me=>Me in Q))throw new Error("sign() legacy options not supported");const{hash:H,randomBytes:O}=e;let{lowS:B,prehash:W,extraEntropy:Y}=Q;B==null&&(B=!0),K=zt("msgHash",K),ok(Q),W&&(K=zt("prehashed msgHash",H(K)));const j=k(K),ce=l(q),me=[I(ce),I(j)];if(Y!=null&&Y!==!1){const Me=Y===!0?O(t.BYTES):Y;me.push(zt("extraEntropy",Me))}const he=Wh(...me),ue=j;function Ne(Me){const Xe=C(Me);if(!d(Xe))return;const it=a(Xe),It=c.BASE.multiply(Xe).toAffine(),kt=o(It.x);if(kt===yo)return;const Dt=o(it*o(ue+kt*ce));if(Dt===yo)return;let rr=(It.x===kt?0:2)|Number(It.y&ir),Xr=Dt;return B&&m(Dt)&&(Xr=f(Dt),rr^=1),new v(kt,Xr,rr)}return{seed:he,k2sig:Ne}}const L={lowS:e.lowS,prehash:!1},V={lowS:e.lowS,prehash:!1};function U(K,q,Q=L){const{seed:H,k2sig:O}=T(K,q,Q),B=e;return dre(B.hash.outputLen,B.nByteLength,B.hmac)(H,O)}c.BASE._setWindowSize(8);function G(K,q,Q,H=V){var rr;const O=K;q=zt("msgHash",q),Q=zt("publicKey",Q);const{lowS:B,prehash:W,format:Y}=H;if(ok(H),"strict"in H)throw new Error("options.strict was renamed to lowS");if(Y!==void 0&&Y!=="compact"&&Y!=="der")throw new Error("format must be compact or der");const j=typeof O=="string"||jh(O),ce=!j&&!Y&&typeof O=="object"&&O!==null&&typeof O.r=="bigint"&&typeof O.s=="bigint";if(!j&&!ce)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let me,he;try{if(ce&&(me=new v(O.r,O.s)),j){try{Y!=="compact"&&(me=v.fromDER(O))}catch(Xr){if(!(Xr instanceof fo.Err))throw Xr}!me&&Y!=="der"&&(me=v.fromCompact(O))}he=c.fromHex(Q)}catch{return!1}if(!me||B&&me.hasHighS())return!1;W&&(q=e.hash(q));const{r:ue,s:Ne}=me,Me=k(q),Xe=a(Ne),it=o(Me*Xe),It=o(ue*Xe),kt=(rr=c.BASE.multiplyAndAddUnsafe(he,it,It))==null?void 0:rr.toAffine();return kt?o(kt.x)===ue:!1}return{CURVE:e,getPublicKey:w,getSharedSecret:E,sign:U,verify:G,ProjectivePoint:c,Signature:v,utils:y}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function nie(r){return{hash:r,hmac:(e,...t)=>XB(r,e,$te(...t)),randomBytes:dS}}function iie(r,e){const t=n=>rie({...r,...nie(n)});return{...t(e),create:t}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const JB=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),ck=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),sie=BigInt(1),Ib=BigInt(2),lk=(r,e)=>(r+e/Ib)/e;function oie(r){const e=JB,t=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=r*r*r%e,h=l*l*r%e,d=Nt(h,t,e)*h%e,p=Nt(d,t,e)*h%e,m=Nt(p,Ib,e)*l%e,f=Nt(m,i,e)*m%e,g=Nt(f,s,e)*f%e,v=Nt(g,a,e)*g%e,y=Nt(v,c,e)*v%e,w=Nt(y,a,e)*g%e,b=Nt(w,t,e)*h%e,E=Nt(b,o,e)*f%e,C=Nt(E,n,e)*l%e,k=Nt(C,Ib,e);if(!kb.eql(kb.sqr(k),r))throw new Error("Cannot find square root");return k}const kb=lw(JB,void 0,void 0,{sqrt:oie}),zs=iie({a:BigInt(0),b:BigInt(7),Fp:kb,n:ck,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const e=ck,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-sie*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=t,o=BigInt("0x100000000000000000000000000000000"),a=lk(s*r,e),c=lk(-n*r,e);let l=mt(r-a*t-c*i,e),h=mt(-a*n-c*s,e);const d=l>o,p=h>o;if(d&&(l=e-l),p&&(h=e-h),l>o||h>o)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:d,k1:l,k2neg:p,k2:h}}}},Bte);BigInt(0);zs.ProjectivePoint;function aie({name:r,code:e,encode:t}){return new cie(r,e,t)}let cie=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Kl(this.code,t):t.then(n=>Kl(this.code,n))}else throw Error("Unknown type, must be binary type")}};function lie(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const ZB=aie({name:"sha2-256",code:18,encode:lie("SHA-256")});function eU(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}const uie=33,hie=32;function die(r,e){const t=ZB.digest(e instanceof Uint8Array?e:e.subarray());if(eU(t))return t.then(({digest:n})=>zs.sign(n,r).toDERRawBytes()).catch(n=>{throw new tk(String(n))});try{return zs.sign(t.digest,r).toDERRawBytes()}catch(n){throw new tk(String(n))}}function fie(r,e,t){const n=ZB.digest(t instanceof Uint8Array?t:t.subarray());if(eU(n))return n.then(({digest:i})=>zs.verify(e,i,r)).catch(i=>{throw new rk(String(i))});try{return zs.verify(e,n.digest,r)}catch(i){throw new rk(String(i))}}class tU{constructor(e){u(this,"type","secp256k1");u(this,"raw");u(this,"_key");this._key=mie(e),this.raw=gie(this._key)}toMultihash(){return lS.digest(_i(this))}toCID(){return iw.createV1(114,this.toMultihash())}toString(){return vi.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ke(this.raw,e.raw)}verify(e,t){return fie(this._key,t,e)}}class rU{constructor(e,t){u(this,"type","secp256k1");u(this,"raw");u(this,"publicKey");this.raw=yie(e),this.publicKey=new tU(t??wie(e))}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ke(this.raw,e.raw)}sign(e){return die(this.raw,e)}}function nU(r){return new rU(r)}function TS(r){return new tU(r)}async function pie(){const r=bie();return new rU(r)}function gie(r){return zs.ProjectivePoint.fromHex(r).toRawBytes(!0)}function yie(r){try{return zs.getPublicKey(r,!0),r}catch(e){throw new rS(String(e))}}function mie(r){try{return zs.ProjectivePoint.fromHex(r),r}catch(e){throw new F1(String(e))}}function wie(r){try{return zs.getPublicKey(r,!0)}catch(e){throw new rS(String(e))}}function bie(){return zs.utils.randomPrivateKey()}async function hw(r,e){if(r==="Ed25519")return zre();if(r==="secp256k1")return pie();if(r==="RSA")return Hne(Sie(e));if(r==="ECDSA")return kte(xie(e));throw new mu}function $n(r,e){const{Type:t,Data:n}=wc.decode(r),i=n??new Uint8Array;switch(t){case Pt.RSA:return Vne(i,e);case Pt.Ed25519:return mS(i);case Pt.secp256k1:return TS(i);case Pt.ECDSA:return yB(i);default:throw new mu}}function vie(r){var n,i;if(r.byteLength===H1)return mS(r);if(r.byteLength===uie)return TS(r);const e=Mc(r),t=(n=e[1])==null?void 0:n[0];if(t===lB||t===uB||t===hB)return mB(e);if(((i=e[0])==null?void 0:i[0])===qne)return QB(e,r);throw new Z("Could not extract public key from raw bytes")}function iU(r){const{Type:e,Data:t}=wc.decode(r.digest),n=t??new Uint8Array;switch(e){case Pt.Ed25519:return mS(n);case Pt.secp256k1:return TS(n);case Pt.ECDSA:return yB(n);default:throw new mu}}function _i(r){return wc.encode({Type:Pt[r.type],Data:r.raw})}function Eie(r){const e=dy.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case Pt.RSA:return zne(t);case Pt.Ed25519:return RB(t);case Pt.secp256k1:return nU(t);case Pt.ECDSA:return Ate(t);default:throw new mu}}function _b(r){var n;if(r.byteLength===ho)return RB(r);if(r.byteLength===hie)return nU(r);const e=Mc(r),t=(n=e[2])==null?void 0:n[0];if(t===lB||t===uB||t===hB)return gB(e);if(e.length>8)return GB(e);throw new Z("Could not extract private key from raw bytes")}function Vp(r){return dy.encode({Type:Pt[r.type],Data:r.raw})}function Sie(r){return r==null?2048:parseInt(r,10)}function xie(r){if(r==="P-256"||r==null)return"P-256";if(r==="P-384")return"P-384";if(r==="P-521")return"P-521";throw new Z("Unsupported curve, should be P-256, P-384 or P-521")}async function sU(r){if(r.type==="RSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if(r.type==="ECDSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"ECDSA",namedCurve:r.jwk.crv??"P-256"},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"ECDSA",namedCurve:r.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new Z("Only RSA and ECDSA keys are supported")}function Aie(r,e){for(let t=0;t<r.byteLength;t++){if(r[t]<e[t])return-1;if(r[t]>e[t])return 1}return r.byteLength>e.byteLength?1:r.byteLength<e.byteLength?-1:0}const Cie=async(r,e,t)=>{if(!r)throw new Error("No signature given");if(!e)throw new Error("Given publicKey was undefined");if(!t)throw new Error("Given input data was undefined");t instanceof Uint8Array||(t=typeof t=="string"?se(t):new Uint8Array(t));const n=(s,o,a)=>s.verify(o,a);let i=!1;try{const s=vie(se(e,"base16"));i=await n(s,t,se(r,"base16"))}catch{}return Promise.resolve(i)},Tb=async(r,e)=>{if(!r)throw new Error("No signing key given");if(!e)throw new Error("Given input data was undefined");return e instanceof Uint8Array||(e=typeof e=="string"?se(e):new Uint8Array(e)),re(await r.sign(e),"base16")},Iie=Rs({size:1e3}),oU=async(r,e,t)=>{const n=await Iie,i=await n.get(r);let s=!1;if(i){const o=(a,c)=>c instanceof Uint8Array?Aie(a,c)===0:a.toString()===c.toString();s=i.publicKey===e&&o(i.data,t)}else{const o=await Cie(r,e,t);s=o,o&&await n.put(r,{publicKey:e,data:t})}return s},kie="./keystore",aU=async({storage:r,path:e}={})=>{r=r||await Cl(await Rs({size:1e3}),await hb({path:e||kie}));const t=await Rs({size:1e3}),n=async()=>{await r.close(),await t.close()},i=async()=>{await r.clear(),await t.clear()},s=async h=>{if(!h)throw new Error("id needed to check a key");let d=!1,p=await t.get(h);if(p)d=!0;else try{p=await r.get("private_"+h),d=p!=null}catch{console.error("Error: ENOENT: no such file or directory")}return d},o=async(h,d)=>{const{privateKey:p}=d;await r.put("private_"+h,p);const m=_b(p);await t.put(h,m)};return{clear:i,close:n,hasKey:s,addKey:o,createKey:async h=>{if(!h)throw new Error("id needed to create a key");const d=await hw("secp256k1"),p={publicKey:d.publicKey.raw,privateKey:d.raw};return await o(h,p),d},getKey:async h=>{if(!h)throw new Error("id needed to get a key");let d=await t.get(h);if(!d){let p;try{p=await r.get("private_"+h)}catch{}if(!p)return;d=_b(p),await t.put(h,d)}return d},getPublic:(h,d={})=>{const p=["hex","buffer"],m=d.format||"hex";if(p.indexOf(m)===-1)throw new Error("Supported formats are `hex` and `buffer`");const f=h.publicKey.raw;return m==="buffer"?f:re(f,"base16")}}},cU=Np,lU=F3,_ie=tn,uU=async({id:r,publicKey:e,signatures:t,type:n,sign:i,verify:s}={})=>{if(!r)throw new Error("Identity id is required");if(!e)throw new Error("Invalid public key");if(!t)throw new Error("Signatures object is required");if(!t.id)throw new Error("Signature of id is required");if(!t.publicKey)throw new Error("Signature of publicKey+id is required");if(!n)throw new Error("Identity type is required");t=Object.assign({},t);const o={id:r,publicKey:e,signatures:t,type:n,sign:i,verify:s},{hash:a,bytes:c}=await Tie(o);return o.hash=a,o.bytes=c,o},Tie=async r=>{const{id:e,publicKey:t,signatures:n,type:i}=r,s={id:e,publicKey:t,signatures:n,type:i},{cid:o,bytes:a}=await Id({value:s,codec:cU,hasher:lU});return{hash:o.toString(_ie),bytes:Uint8Array.from(a)}},Pie=async r=>{const{value:e}=await O3({bytes:r,codec:cU,hasher:lU});return uU({...e})},Die=r=>!!(r.id&&r.hash&&r.bytes&&r.publicKey&&r.signatures&&r.signatures.id&&r.signatures.publicKey&&r.type),$ie=(r,e)=>r.id===e.id&&r.hash===e.hash&&r.type===e.type&&r.publicKey===e.publicKey&&r.signatures.id===e.signatures.id&&r.signatures.publicKey===e.signatures.publicKey,hU="publickey",Nie=async r=>{const{id:e,publicKey:t,signatures:n}=r;return oU(n.publicKey,e,t+n.id)},PS=({keystore:r})=>async()=>{if(!r)throw new Error("PublicKeyIdentityProvider requires a keystore parameter");return{type:hU,getId:async({id:n}={})=>{if(!n)throw new Error("id is required");const i=await r.getKey(n)||await r.createKey(n);return re(i.publicKey.raw,"base16")},signIdentity:async(n,{id:i}={})=>{if(!i)throw new Error("id is required");const s=await r.getKey(i);if(!s)throw new Error(`Signing key for '${i}' not found`);return Tb(s,n)}}};PS.verifyIdentity=Nie;PS.type=hU;const DS={},Mie=r=>Object.keys(DS).includes(r),X8=r=>{if(!Mie(r))throw new Error(`IdentityProvider type '${r}' is not supported`);return DS[r]},Oie=r=>{if(!r.type||typeof r.type!="string")throw new Error("Given IdentityProvider doesn't have a field 'type'.");if(!r.verifyIdentity)throw new Error("Given IdentityProvider doesn't have a function 'verifyIdentity'.");DS[r.type]=r};Oie(PS);const Rie=sc("./orbitdb","identities"),Lie=async({keystore:r,path:e,storage:t,ipfs:n}={})=>{r=r||await aU({path:e||Rie}),t||(t=n?await Cl(await Rs({size:1e3}),await K3({ipfs:n,pin:!0})):await FE());const i=await Rs({size:1e3}),s=async h=>{const d=await t.get(h);if(d)return Pie(d)},o=async(h={})=>{h.keystore=r;const d=X8("publickey"),m=await(h.provider||d({keystore:r}))();if(!X8(m.type))throw new Error("Identity provider is unknown. Use useIdentityProvider(provider) to register the identity provider");const f=await m.getId(h),g=await r.getKey(f)||await r.createKey(f),v=r.getPublic(g),y=await Tb(g,f),w=await m.signIdentity(v+y,h),E=await uU({id:f,publicKey:v,signatures:{id:y,publicKey:w},type:m.type,sign:c,verify:l});return await t.put(E.hash,E.bytes),E},a=async h=>{if(!Die(h))return!1;const{id:d,publicKey:p,signatures:m}=h;if(!await l(m.id,p,d))return!1;const g=await i.get(m.id);if(g)return $ie(h,g);const y=await X8(h.type).verifyIdentity(h);return y&&await i.put(m.id,h),y},c=async(h,d)=>{const p=await r.getKey(h.id);if(!p)throw new Error("Private signing key not found from KeyStore");return await Tb(p,d)},l=async(h,d,p)=>await oU(h,d,p);return{createIdentity:o,verifyIdentity:a,getIdentity:s,sign:c,verify:l,keystore:r}},Bie=r=>{if(r=r.toString(),!r.startsWith("/orbitdb")&&!r.startsWith("\\orbitdb"))return!1;r=r.replaceAll("/orbitdb/",""),r=r.replaceAll("\\orbitdb\\",""),r=r.replaceAll("/",""),r=r.replaceAll("\\","");let e;try{e=ls.parse(r,tn)}catch{return!1}return e!==void 0},uk=r=>{if(r&&r.protocol==="orbitdb"&&r.hash)return r;const e="orbitdb",t=r.replace("/orbitdb/","").replace("\\orbitdb\\","");return{protocol:e,hash:t,address:r,toString:()=>sc("/",e,t)}},hk=Np,dk=F3,Uie=tn,Fie=async({ipfs:r,storage:e}={})=>(e=e||await Cl(await Rs({size:1e5}),await K3({ipfs:r,pin:!0})),{get:async s=>{const o=await e.get(s),{value:a}=await O3({bytes:o,codec:hk,hasher:dk});return a&&await e.put(s,o),a},create:async({name:s,type:o,accessController:a,meta:c})=>{if(!s)throw new Error("name is required");if(!o)throw new Error("type is required");if(!a)throw new Error("accessController is required");const l=Object.assign({name:s,type:o,accessController:a},c!==void 0?{meta:c}:{}),{cid:h,bytes:d}=await Id({value:l,codec:hk,hasher:dk}),p=h.toString(Uie);return await e.put(p,d),{hash:p,manifest:l}},close:async()=>{await e.close()}}),dU=async(r=32)=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="",n=0;for(;n<r;)t+=e.charAt(Math.floor(Math.random()*e.length)),n+=1;return t},fU=Np,pU=F3,zie=tn,Vie=async({storage:r,type:e,params:t})=>{const n={type:e,...t},{cid:i,bytes:s}=await Id({value:n,codec:fU,hasher:pU}),o=i.toString(zie);return await r.put(o,s),o},Gg="ipfs",dw=({write:r,storage:e}={})=>async({orbitdb:t,identities:n,address:i})=>{if(e=e||await Cl(await Rs({size:1e3}),await K3({ipfs:t.ipfs,pin:!0})),r=r||[t.identity.id],i){const o=await e.get(i.replaceAll("/ipfs/","")),{value:a}=await O3({bytes:o,codec:fU,hasher:pU});r=a.write}else i=await Vie({storage:e,type:Gg,params:{write:r}}),i=sc("/",Gg,i);return{type:Gg,address:i,write:r,canAppend:async o=>{const a=await n.getIdentity(o.identity);if(!a)return!1;const{id:c}=a;return r.includes(c)||r.includes("*")?await n.verifyIdentity(a):!1}}};dw.type=Gg;const gU="orbitdb",yU=({write:r}={})=>async({orbitdb:e,identities:t,address:n,name:i})=>{n=n||i||await dU(64),r=r||[e.identity.id];const s=await e.open(n,{type:"keyvalue",AccessController:dw({write:r})});n=s.address;const o=async f=>{const g=await t.getIdentity(f.identity);if(!g)return!1;const{id:v}=g;return await d("write",v)||await d("admin",v)?await t.verifyIdentity(g):!1},a=async()=>{const f=[];for await(const v of s.iterator())f[v.key]=v.value;const g=v=>{const y=v[0];f[y]=new Set([...f[y]||[],...v[1]])};return Object.entries({...f,admin:new Set([...f.admin||[],...s.access.write])}).forEach(g),f},c=async f=>(await a())[f]||new Set([]),l=async()=>{await s.close()},h=async()=>{await s.drop()},d=async(f,g)=>{const v=new Set(await c(f));return v.has(g)||v.has("*")};return{type:gU,address:n,write:r,canAppend:o,capabilities:a,get:c,grant:async(f,g)=>{const v=new Set([...await s.get(f)||[],g]);await s.put(f,Array.from(v.values()))},revoke:async(f,g)=>{const v=new Set(await s.get(f)||[]);v.delete(g),v.size>0?await s.put(f,Array.from(v.values())):await s.del(f)},close:l,drop:h,events:s.events}};yU.type=gU;const Pb={},Kie=r=>{if(!Pb[r])throw new Error(`AccessController type '${r}' is not supported`);return Pb[r]},mU=r=>{if(!r.type)throw new Error("AccessController does not contain required field 'type'.");Pb[r.type]=r};mU(dw);mU(yU);const Hie="events",jie=dw,qie=async({ipfs:r,id:e,identity:t,identities:n,directory:i}={})=>{if(r==null)throw new Error("IPFS instance is a required argument.");e=e||await dU();const s=r.libp2p.peerId;i=i||"./orbitdb";let o;n?o=n.keystore:(o=await aU({path:sc(i,"./keystore")}),n=await Lie({ipfs:r,keystore:o})),t?t.provider&&(t=await n.createIdentity({...t})):t=await n.createIdentity({id:e});const a=await Fie({ipfs:r});let c={};const l=async(p,{type:m,meta:f,sync:g,Database:v,AccessController:y,headsStorage:w,entryStorage:b,indexStorage:E,referencesCount:C}={})=>{let k,x,I;if(c[p])return c[p];if(Bie(p)){const L=uk(p);x=await a.get(L.hash);const V=x.accessController.split("/",2).pop();y=Kie(V)(),I=await y({orbitdb:{open:l,identity:t,ipfs:r},identities:n,address:x.accessController}),k=x.name,m=m||x.type,f=x.meta}else{m=m||Hie,y=y||jie(),I=await y({orbitdb:{open:l,identity:t,ipfs:r},identities:n,name:p});const L=await a.create({name:p,type:m,accessController:I.address,meta:f});if(x=L.manifest,p=uk(L.hash),k=x.name,f=x.meta,c[p])return c[p]}if(v=v||TZ(m)(),!v)throw new Error(`Unsupported database type: '${m}'`);p=p.toString();const T=await v({ipfs:r,identity:t,address:p,name:k,access:I,directory:i,meta:f,syncAutomatically:g,headsStorage:w,entryStorage:b,indexStorage:E,referencesCount:C});return T.events.on("close",h(p)),c[p]=T,T},h=p=>()=>{delete c[p]};return{id:e,open:l,stop:async()=>{for(const p of Object.values(c))await p.close();o&&await o.close(),a&&await a.close(),c={}},ipfs:r,directory:i,keystore:o,identities:n,identity:t,peerId:s}};function ct(r){const e=new globalThis.AbortController;function t(){e.abort();for(const s of r)(s==null?void 0:s.removeEventListener)!=null&&s.removeEventListener("abort",t)}for(const s of r){if((s==null?void 0:s.aborted)===!0){t();break}(s==null?void 0:s.addEventListener)!=null&&s.addEventListener("abort",t)}function n(){for(const s of r)(s==null?void 0:s.removeEventListener)!=null&&s.removeEventListener("abort",t)}const i=e.signal;return i.clear=n,i}let Wie=class extends Error{constructor(t,n){super(t??"The operation was aborted");u(this,"type");u(this,"code");this.type="aborted",this.name="AbortError",this.code=n??"ABORT_ERR"}};async function xi(r,e,t,n){const i=new Wie(n==null?void 0:n.errorMessage,n==null?void 0:n.errorCode);return(t==null?void 0:t.aborted)===!0?Promise.reject(i):new Promise((s,o)=>{function a(){t==null||t.removeEventListener("abort",h),r.removeEventListener(e,c),(n==null?void 0:n.errorEvent)!=null&&r.removeEventListener(n.errorEvent,l)}const c=d=>{var p;try{if(((p=n==null?void 0:n.filter)==null?void 0:p.call(n,d))===!1)return}catch(m){a(),o(m);return}a(),s(d)},l=d=>{a(),o(d.detail)},h=()=>{a(),o(i)};t==null||t.addEventListener("abort",h),r.addEventListener(e,c),(n==null?void 0:n.errorEvent)!=null&&r.addEventListener(n.errorEvent,l)})}class Gie extends Error{constructor(t="Rate limit exceeded",n){super(t);u(this,"remainingPoints");u(this,"msBeforeNext");u(this,"consumedPoints");u(this,"isFirstInDuration");this.name="RateLimitError",this.remainingPoints=n.remainingPoints,this.msBeforeNext=n.msBeforeNext,this.consumedPoints=n.consumedPoints,this.isFirstInDuration=n.isFirstInDuration}}class wU extends Error{constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}u(wU,"name","QueueFullError");class Qie{constructor(e){u(this,"deferred");u(this,"signal");var t;this.signal=e,this.deferred=Oe(),this.onAbort=this.onAbort.bind(this),(t=this.signal)==null||t.addEventListener("abort",this.onAbort)}onAbort(){var e;this.deferred.reject(((e=this.signal)==null?void 0:e.reason)??new zl)}cleanup(){var e;(e=this.signal)==null||e.removeEventListener("abort",this.onAbort)}}function Yie(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}class Xie{constructor(e,t){u(this,"id");u(this,"fn");u(this,"options");u(this,"recipients");u(this,"status");u(this,"timeline");u(this,"controller");this.id=Yie(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,n)=>{var i;return t&&((i=n.signal)==null?void 0:i.aborted)===!0},!0)&&(this.controller.abort(new zl),this.cleanup())}async join(e={}){var n;const t=new Qie(e.signal);return this.recipients.push(t),(n=e.signal)==null||n.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await nn(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{var t;e.cleanup(),(t=e.signal)==null||t.removeEventListener("abort",this.onAbort)})}}class Hl extends Yt{constructor(t={}){var n;super();u(this,"concurrency");u(this,"maxSize");u(this,"queue");u(this,"pending");u(this,"sort");this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.maxSize=t.maxSize??Number.POSITIVE_INFINITY,this.pending=0,t.metricName!=null&&((n=t.metrics)==null||n.registerMetricGroup(t.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})})),this.sort=t.sort,this.queue=[]}tryToStartAnother(){if(this.size===0)return queueMicrotask(()=>{this.safeDispatchEvent("empty")}),this.running===0&&queueMicrotask(()=>{this.safeDispatchEvent("idle")}),!1;if(this.pending<this.concurrency){let t;for(const n of this.queue)if(n.status==="queued"){t=n;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let n=0;n<this.queue.length;n++)if(this.queue[n]===t){this.queue.splice(n,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(t){this.queue.push(t),this.sort!=null&&this.queue.sort(this.sort)}async add(t,n){var s;if((s=n==null?void 0:n.signal)==null||s.throwIfAborted(),this.size===this.maxSize)throw new wU;const i=new Xie(t,n);return this.enqueue(i),this.safeDispatchEvent("add"),this.tryToStartAnother(),i.join(n).then(o=>(this.safeDispatchEvent("completed",{detail:o}),this.safeDispatchEvent("success",{detail:{job:i,result:o}}),o)).catch(o=>{if(i.status==="queued"){for(let a=0;a<this.queue.length;a++)if(this.queue[a]===i){this.queue.splice(a,1);break}}throw this.safeDispatchEvent("error",{detail:o}),this.safeDispatchEvent("failure",{detail:{job:i,error:o}}),o})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new zl)}),this.clear()}async onEmpty(t){this.size!==0&&await xi(this,"empty",t==null?void 0:t.signal)}async onSizeLessThan(t,n){this.size<t||await xi(this,"next",n==null?void 0:n.signal,{filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await xi(this,"idle",t==null?void 0:t.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){var l,h,d;(l=t==null?void 0:t.signal)==null||l.throwIfAborted();const n=No({objectMode:!0}),i=p=>{p!=null?this.abort():this.clear(),n.end(p)},s=p=>{p.detail!=null&&n.push(p.detail)},o=p=>{i(p.detail)},a=()=>{i()},c=()=>{i(new zl("Queue aborted"))};this.addEventListener("completed",s),this.addEventListener("error",o),this.addEventListener("idle",a),(h=t==null?void 0:t.signal)==null||h.addEventListener("abort",c);try{yield*n}finally{this.removeEventListener("completed",s),this.removeEventListener("error",o),this.removeEventListener("idle",a),(d=t==null?void 0:t.signal)==null||d.removeEventListener("abort",c),i()}}}class vc extends Hl{has(e){return this.find(e)!=null}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}const Jie=8,$S=1024*1024*4;let Zie=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}},bU=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}},ese=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}},fk=class extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}};function vU(r){return r[Symbol.asyncIterator]!=null}function EU(r,e){if(r.byteLength>e)throw new bU("Message length too long")}const fw=r=>{const e=dt(r),t=Pn(e);return br(r,t),fw.bytes=e,t};fw.bytes=0;function Gh(r,e){e=e??{};const t=e.lengthEncoder??fw,n=(e==null?void 0:e.maxDataLength)??$S;function*i(s){EU(s,n);const o=t(s.byteLength);o instanceof Uint8Array?yield o:yield*o,s instanceof Uint8Array?yield s:yield*s}return vU(r)?async function*(){for await(const s of r)yield*i(s)}():function*(){for(const s of r)yield*i(s)}()}Gh.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??fw,n=(e==null?void 0:e.maxDataLength)??$S;return EU(r,n),new Le(t(r.byteLength),r)};var ol;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(ol||(ol={}));const NS=r=>{const e=hs(r);return NS.bytes=dt(e),e};NS.bytes=0;function Qh(r,e){const t=new Le;let n=ol.LENGTH,i=-1;const s=(e==null?void 0:e.lengthDecoder)??NS,o=(e==null?void 0:e.maxLengthLength)??Jie,a=(e==null?void 0:e.maxDataLength)??$S;function*c(){for(;t.byteLength>0;){if(n===ol.LENGTH)try{if(i=s(t),i<0)throw new Zie("Invalid message length");if(i>a)throw new bU("Message length too long");const l=s.bytes;t.consume(l),(e==null?void 0:e.onLength)!=null&&e.onLength(i),n=ol.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>o)throw new ese("Message length length too long");break}throw l}if(n===ol.DATA){if(t.byteLength<i)break;const l=t.sublist(0,i);t.consume(i),(e==null?void 0:e.onData)!=null&&e.onData(l),yield l,n=ol.LENGTH}}}return vU(r)?async function*(){for await(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new fk("Unexpected end of input")}():function*(){for(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new fk("Unexpected end of input")}()}Qh.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:s,value:o}=await r.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return Qh(n,{...e??{},onLength:s=>{t=s}})};function MS(r){const[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:i=>{n.push(i)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}function tse(r){return r[Symbol.asyncIterator]!=null}function Nd(r,e){let t=0;if(tse(r))return async function*(){for await(const c of r)yield e(c,t++)}();const n=MS(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof o.then=="function")return async function*(){yield await o;for await(const c of n)yield e(c,t++)}();const a=e;return function*(){yield o;for(const c of n)yield a(c,t++)}()}function rse(r){return r[Symbol.asyncIterator]!=null}function py(r,e){return rse(r)?async function*(){let t=0;if(!(e<1)){for await(const n of r)if(yield n,t++,t===e)return}}():function*(){let t=0;if(!(e<1)){for(const n of r)if(yield n,t++,t===e)return}}()}class Ie extends Event{constructor(t,n){super(t);u(this,"type");u(this,"detail");this.type=t,this.detail=n}}const J0="/ipfs/bitswap/1.2.0",nse=1024,ise=1024,sse=1024,ose=5e3,ase=10,cse=50,lse=!1,use=3,SU=1024*1024*4,hse=SU;var sr;(function(r){r.WantBlock="WantBlock",r.WantHave="WantHave"})(sr||(sr={}));var Db;(function(r){r[r.WantBlock=0]="WantBlock",r[r.WantHave=1]="WantHave"})(Db||(Db={}));(function(r){r.codec=()=>Dn(Db)})(sr||(sr={}));var W1;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.priority!=null&&t.priority!==0&&(n.uint32(16),n.int32(t.priority)),t.cancel!=null&&(n.uint32(24),n.bool(t.cancel)),t.wantType!=null&&(n.uint32(32),sr.codec().encode(t.wantType,n)),t.sendDontHave!=null&&(n.uint32(40),n.bool(t.sendDontHave)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={cid:We(0),priority:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.cid=t.bytes();break}case 2:{s.priority=t.int32();break}case 3:{s.cancel=t.bool();break}case 4:{s.wantType=sr.codec().decode(t);break}case 5:{s.sendDontHave=t.bool();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(W1||(W1={}));var gy;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.entries!=null)for(const s of t.entries)n.uint32(10),W1.codec().encode(s,n);t.full!=null&&(n.uint32(16),n.bool(t.full)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={entries:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{if(((a=i.limits)==null?void 0:a.entries)!=null&&s.entries.length===i.limits.entries)throw new ht('Decode error - map field "entries" had too many elements');s.entries.push(W1.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.entries$}));break}case 2:{s.full=t.bool();break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(gy||(gy={}));var G1;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.prefix!=null&&t.prefix.byteLength>0&&(n.uint32(10),n.bytes(t.prefix)),t.data!=null&&t.data.byteLength>0&&(n.uint32(18),n.bytes(t.data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={prefix:We(0),data:We(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.prefix=t.bytes();break}case 2:{s.data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(G1||(G1={}));var Ls;(function(r){r.HaveBlock="HaveBlock",r.DoNotHaveBlock="DoNotHaveBlock"})(Ls||(Ls={}));var yy;(function(r){r[r.HaveBlock=0]="HaveBlock",r[r.DoNotHaveBlock=1]="DoNotHaveBlock"})(yy||(yy={}));(function(r){r.codec=()=>Dn(yy)})(Ls||(Ls={}));var Q1;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.type!=null&&yy[t.type]!==0&&(n.uint32(16),Ls.codec().encode(t.type,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={cid:We(0),type:Ls.HaveBlock},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.cid=t.bytes();break}case 2:{s.type=Ls.codec().decode(t);break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(Q1||(Q1={}));var Y1;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.wantlist!=null&&(n.uint32(10),gy.codec().encode(t.wantlist,n)),t.blocks!=null)for(const s of t.blocks)n.uint32(26),G1.codec().encode(s,n);if(t.blockPresences!=null)for(const s of t.blockPresences)n.uint32(34),Q1.codec().encode(s,n);t.pendingBytes!=null&&t.pendingBytes!==0&&(n.uint32(40),n.int32(t.pendingBytes)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,h,d;const s={blocks:[],blockPresences:[],pendingBytes:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const p=t.uint32();switch(p>>>3){case 1:{s.wantlist=gy.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.wantlist});break}case 3:{if(((c=i.limits)==null?void 0:c.blocks)!=null&&s.blocks.length===i.limits.blocks)throw new ht('Decode error - map field "blocks" had too many elements');s.blocks.push(G1.codec().decode(t,t.uint32(),{limits:(l=i.limits)==null?void 0:l.blocks$}));break}case 4:{if(((h=i.limits)==null?void 0:h.blockPresences)!=null&&s.blockPresences.length===i.limits.blockPresences)throw new ht('Decode error - map field "blockPresences" had too many elements');s.blockPresences.push(Q1.codec().decode(t,t.uint32(),{limits:(d=i.limits)==null?void 0:d.blockPresences$}));break}case 5:{s.pendingBytes=t.int32();break}default:{t.skipType(p&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(Y1||(Y1={}));function dse(r,e){for(const[t,n]of e.wantlist.entries()){const i=r.wantlist.get(t);i!=null&&(i.priority>n.priority&&(n.priority=i.priority),n.cancel=n.cancel??i.cancel,n.wantType=n.wantType??i.wantType,n.sendDontHave=n.sendDontHave??i.sendDontHave),r.wantlist.set(t,n)}for(const[t,n]of e.blockPresences.entries())r.blockPresences.set(t,n);for(const[t,n]of e.blocks.entries())r.blocks.set(t,n);return e.full&&!r.full&&(r.full=!0),r}class xU extends Error{constructor(e="Block too large"){super(e),this.name="BlockTooLargeError"}}u(xU,"name","BlockTooLargeError");const fse=4193648,pse=fse+16;function*gse(r,e){const t=[...r.wantlist.values()],n=[...r.blockPresences.values()],i=[...r.blocks.values()];let s=0,o=0,a=0,c=!1;for(;;){const l={wantlist:{full:r.full??!1,entries:[]},blockPresences:[],blocks:[],pendingBytes:0};let h=Y1.encode(l).byteLength,{added:d,hasMore:p,newSize:m}=J8(i,l.blocks,a,e,h,yse);a+=d,h=m;const f=p;({added:d,hasMore:p,newSize:m}=J8(n,l.blockPresences,o,e,h,mse)),o+=d,h=m;const g=p;if({added:d,hasMore:p,newSize:m}=J8(t,l.wantlist.entries,s,e,h,wse),s+=d,h=m,c=!f&&!g&&!p,c||(l.wantlist.full=!1),yield Y1.encode(l),c)break}}function J8(r,e,t,n,i,s){let o=0,a=!1;for(let c=t;c<r.length;c++){const l=r[c],h=s(l);if(h>pse)throw new xU("Cannot send block as after encoding it is over the max message size");const d=i+h;if(d>n){a=!0;break}e.push(l),o++,i=d}return{hasMore:a,added:o,newSize:i}}function yse(r){return OS(3,G1.encode(r))}function mse(r){return OS(4,Q1.encode(r))}function wse(r){return OS(1,W1.encode(r))}function OS(r,e){const t=dt(r),n=dt(e.byteLength);return t+n+e.byteLength}let bse=class extends Yt{constructor(t,n={}){var i,s;super();u(this,"log");u(this,"libp2p");u(this,"routing");u(this,"protocols");u(this,"running");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"messageReceiveTimeout");u(this,"registrarIds");u(this,"metrics");u(this,"sendQueue");u(this,"runOnLimitedConnections");u(this,"maxOutgoingMessageSize");u(this,"maxIncomingMessageSize");this.log=t.logger.forComponent("helia:bitswap:network"),this.libp2p=t.libp2p,this.routing=t.routing,this.protocols=n.protocols??[J0],this.registrarIds=[],this.running=!1,this._onStream=this._onStream.bind(this),this.maxInboundStreams=n.maxInboundStreams??ise,this.maxOutboundStreams=n.maxOutboundStreams??sse,this.messageReceiveTimeout=n.messageReceiveTimeout??ose,this.runOnLimitedConnections=n.runOnLimitedConnections??lse,this.maxIncomingMessageSize=n.maxIncomingMessageSize??SU,this.maxOutgoingMessageSize=n.maxOutgoingMessageSize??n.maxIncomingMessageSize??hse,this.metrics={blocksSent:(i=t.metrics)==null?void 0:i.registerCounter("helia_bitswap_sent_blocks_total"),dataSent:(s=t.metrics)==null?void 0:s.registerCounter("helia_bitswap_sent_data_bytes_total")},this.sendQueue=new vc({concurrency:n.messageSendConcurrency??cse,metrics:t.metrics,metricName:"helia_bitswap_message_send_queue"}),this.sendQueue.addEventListener("error",o=>{this.log.error("error sending wantlist to peer",o.detail)})}async start(){if(this.running)return;this.running=!0,await this.libp2p.handle(this.protocols,this._onStream,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnections});const t={onConnect:n=>{this.safeDispatchEvent("peer:connected",{detail:n})},onDisconnect:n=>{this.safeDispatchEvent("peer:disconnected",{detail:n})}};this.registrarIds=[];for(const n of this.protocols)this.registrarIds.push(await this.libp2p.register(n,t));this.libp2p.getConnections().forEach(n=>{this.safeDispatchEvent("peer:connected",{detail:n.remotePeer})})}async stop(){if(this.running=!1,await this.libp2p.unhandle(this.protocols),this.registrarIds!=null){for(const t of this.registrarIds)this.libp2p.unregister(t);this.registrarIds=[]}}_onStream(t){if(!this.running)return;const{stream:n,connection:i}=t;Promise.resolve().then(async()=>{this.log("incoming new bitswap %s stream from %p",n.protocol,i.remotePeer);const s=()=>{n.status==="open"?n.abort(new Bp(`Incoming Bitswap stream timed out after ${this.messageReceiveTimeout}ms`)):this.log("stream aborted with status %s",n.status)};let o=AbortSignal.timeout(this.messageReceiveTimeout);o.addEventListener("abort",s),await n.closeWrite(),await cn(n,a=>Qh(a,{maxDataLength:this.maxIncomingMessageSize}),async a=>{for await(const c of a)try{const l=Y1.decode(c);this.log("incoming new bitswap %s message from %p on stream",n.protocol,i.remotePeer,n.id),this.safeDispatchEvent("bitswap:message",{detail:{peer:i.remotePeer,message:l}}),o.removeEventListener("abort",s),o=AbortSignal.timeout(this.messageReceiveTimeout),o.addEventListener("abort",s)}catch(l){this.log.error("error reading incoming bitswap message from %p on stream",i.remotePeer,n.id,l),n.abort(l);break}})}).catch(s=>{this.log.error("error handling incoming stream from %p",i.remotePeer,s),n.abort(s)})}async*findProviders(t,n){var i;(i=n==null?void 0:n.onProgress)==null||i.call(n,new Ie("bitswap:network:find-providers",t));for await(const s of this.routing.findProviders(t,n))await this.libp2p.isDialable(s.multiaddrs,{runOnLimitedConnection:this.runOnLimitedConnections})&&(yield s)}async findAndConnect(t,n){await Mo(Nd(py(this.findProviders(t,n),(n==null?void 0:n.maxProviders)??use),async i=>this.connectTo(i.id,n))).catch(i=>{this.log.error(i)})}async sendMessage(t,n,i){if(!this.running)throw new Error("network isn't running");const s=this.sendQueue.queue.find(o=>t.equals(o.options.peerId)&&o.status==="queued");if(s!=null){s.options.message=dse(s.options.message,n),await s.join({signal:i==null?void 0:i.signal});return}await this.sendQueue.add(async o=>{var l,h;const a=o==null?void 0:o.message;if(a==null)throw new Z("No message to send");this.log("sendMessage to %p",t),(l=o==null?void 0:o.onProgress)==null||l.call(o,new Ie("bitswap:network:send-wantlist",t));const c=await this.libp2p.dialProtocol(t,J0,o);await c.closeRead();try{await cn(gse(a,this.maxOutgoingMessageSize),d=>Gh(d),c),await c.close(o)}catch(d){(h=o==null?void 0:o.onProgress)==null||h.call(o,new Ie("bitswap:network:send-wantlist:error",{peer:t,error:d})),this.log.error("error sending message to %p",t,d),c.abort(d)}this._updateSentStats(a.blocks)},{peerId:t,signal:i==null?void 0:i.signal,message:n})}async connectTo(t,n){var s;if(!this.running)throw new Vl("Network isn't running");(s=n==null?void 0:n.onProgress)==null||s.call(n,new Ie("bitswap:network:dial",t));const[i]=await Promise.all([this.libp2p.dial(t,n),xi(this.libp2p,"peer:identify",n==null?void 0:n.signal,{filter:o=>{if(!o.detail.peerId.equals(t))return!1;if(o.detail.protocols.includes(J0))return!0;throw new Lp(`${t} did not support ${J0}`)}})]);return i}_updateSentStats(t){var i,s;let n=0;for(const o of t.values())n+=o.data.byteLength;(i=this.metrics.dataSent)==null||i.increment(n),(s=this.metrics.blocksSent)==null||s.increment(t.size)}};function vse(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function pw(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Ese(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var Sse=Ese,xse=Sse;let Ase=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Cse=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return AU(this,e)}},Ise=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return AU(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function AU(r,e){return new Ise({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let kse=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Ase(e,t,n),this.decoder=new Cse(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function CU({name:r,prefix:e,encode:t,decode:n}){return new kse(r,e,t,n)}function gw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=xse(t,r);return CU({prefix:e,name:r,encode:n,decode:s=>pw(i(s))})}function _se(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Tse(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function qo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return CU({prefix:e,name:r,encode(i){return Tse(i,n,t)},decode(i){return _se(i,n,t,r)}})}const _s=gw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});gw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const Qg=qo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});qo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});qo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});qo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});qo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});qo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});qo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});qo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});qo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Z8=gw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});gw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Pse=IU,pk=128,Dse=-128,$se=Math.pow(2,31);function IU(r,e,t){e=e||[],t=t||0;for(var n=t;r>=$se;)e[t++]=r&255|pk,r/=128;for(;r&Dse;)e[t++]=r&255|pk,r>>>=7;return e[t]=r|0,IU.bytes=t-n+1,e}var Nse=$b,Mse=128,gk=127;function $b(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw $b.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&gk)<<i:(o&gk)*Math.pow(2,i),i+=7}while(o>=Mse);return $b.bytes=s-n,t}var Ose=Math.pow(2,7),Rse=Math.pow(2,14),Lse=Math.pow(2,21),Bse=Math.pow(2,28),Use=Math.pow(2,35),Fse=Math.pow(2,42),zse=Math.pow(2,49),Vse=Math.pow(2,56),Kse=Math.pow(2,63),Hse=function(r){return r<Ose?1:r<Rse?2:r<Lse?3:r<Bse?4:r<Use?5:r<Fse?6:r<zse?7:r<Vse?8:r<Kse?9:10},jse={encode:Pse,decode:Nse,encodingLength:Hse},my=jse;function Nb(r,e=0){return[my.decode(r,e),my.decode.bytes]}function wy(r,e,t=0){return my.encode(r,e,t),e}function by(r){return my.encodingLength(r)}function vy(r,e){const t=e.byteLength,n=by(r),i=n+by(t),s=new Uint8Array(i+t);return wy(r,s,0),wy(t,s,n),s.set(e,i),new RS(r,t,e,s)}function kU(r){const e=pw(r),[t,n]=Nb(e),[i,s]=Nb(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new RS(t,i,o,e)}function qse(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&vse(r.bytes,t.bytes)}}let RS=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function yk(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Gse(t,Mb(r),e??_s.encoder);default:return Qse(t,Mb(r),e??Qg.encoder)}}const mk=new WeakMap;function Mb(r){const e=mk.get(r);if(e==null){const t=new Map;return mk.set(r,t),t}return e}var J$;let LS=class Nr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,J$,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Ef)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Yse)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Nr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=vy(e,t);return Nr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Nr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&qse(e.multihash,n.multihash)}toString(e){return yk(this,e)}toJSON(){return{"/":yk(this)}}link(){return this}[(J$=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Nr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Nr(n,i,s,o??wk(n,i,s.bytes))}else if(t[Xse]===!0){const{version:n,multihash:i,code:s}=t,o=kU(i);return Nr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Ef)throw new Error(`Version 0 CID must use dag-pb (code: ${Ef}) block encoding`);return new Nr(e,t,n,n.bytes)}case 1:{const i=wk(e,t,n.bytes);return new Nr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Nr.create(0,Ef,e)}static createV1(e,t){return Nr.create(1,e,t)}static decode(e){const[t,n]=Nr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Nr.inspectBytes(e),n=t.size-t.multihashSize,i=pw(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new RS(t.multihashCode,t.digestSize,s,i);return[t.version===0?Nr.createV0(o):Nr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=Nb(e.subarray(t));return t+=p,d};let i=n(),s=Ef;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){const[n,i]=Wse(e,t),s=Nr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Mb(s).set(n,e),s}};function Wse(r,e){switch(r[0]){case"Q":{const t=e??_s;return[_s.prefix,t.decode(`${_s.prefix}${r}`)]}case _s.prefix:{const t=e??_s;return[_s.prefix,t.decode(r)]}case Qg.prefix:{const t=e??Qg;return[Qg.prefix,t.decode(r)]}case Z8.prefix:{const t=e??Z8;return[Z8.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Gse(r,e,t){const{prefix:n}=t;if(n!==_s.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Qse(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Ef=112,Yse=18;function wk(r,e,t){const n=by(r),i=n+by(e),s=new Uint8Array(i+t.byteLength);return wy(r,s,0),wy(e,s,n),s.set(t,i),s}const Xse=Symbol.for("@ipld/js-cid/CID"),_U=0,Jse="identity",TU=pw;function Zse(r){return vy(_U,TU(r))}const PU={code:_U,name:Jse,encode:TU,digest:Zse};function eoe({name:r,code:e,encode:t}){return new toe(r,e,t)}let toe=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?vy(this.code,t):t.then(n=>vy(this.code,n))}else throw Error("Unknown type, must be binary type")}};function roe(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const noe=eoe({name:"sha2-256",code:18,encode:roe("SHA-256")}),DU=Symbol.for("nodejs.util.inspect.custom"),ioe=114;var Z$;class BS{constructor(e){u(this,"type");u(this,"multihash");u(this,"publicKey");u(this,"string");u(this,Z$,!0);this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=_s.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return LS.createV1(ioe,this.multihash)}toJSON(){return this.toString()}equals(e){var t;if(e==null)return!1;if(e instanceof Uint8Array)return Ke(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(((t=e==null?void 0:e.toMultihash())==null?void 0:t.bytes)!=null)return Ke(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[(Z$=eS,DU)](){return`PeerId(${this.toString()})`}}class $U extends BS{constructor(t){super({...t,type:"RSA"});u(this,"type","RSA");u(this,"publicKey");this.publicKey=t.publicKey}}class NU extends BS{constructor(t){super({...t,type:"Ed25519"});u(this,"type","Ed25519");u(this,"publicKey");this.publicKey=t.publicKey}}class MU extends BS{constructor(t){super({...t,type:"secp256k1"});u(this,"type","secp256k1");u(this,"publicKey");this.publicKey=t.publicKey}}const soe=2336;var eN,tN;class OU{constructor(e){u(this,"type","url");u(this,"multihash");u(this,"publicKey");u(this,"url");u(this,eN,!0);this.url=e.toString(),this.multihash=PU.digest(se(this.url))}[(tN=DU,eN=eS,tN)](){return`PeerId(${this.url})`}toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return LS.createV1(soe,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=re(e)),e.toString()===this.toString())}}const ooe=114,bk=2336;function Wt(r,e){let t;if(r.charAt(0)==="1"||r.charAt(0)==="Q")t=kU(_s.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return Md(LS.parse(r));throw new Z('Please pass a multibase decoder for strings that do not start with "1" or "Q"')}return ri(t)}function Yh(r){if(r.type==="Ed25519")return new NU({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new MU({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new $U({multihash:r.toCID().multihash,publicKey:r});throw new mu}function aoe(r){return Yh(r.publicKey)}function ri(r){if(loe(r))return new $U({multihash:r});if(coe(r))try{const e=iU(r);if(e.type==="Ed25519")return new NU({multihash:r,publicKey:e});if(e.type==="secp256k1")return new MU({multihash:r,publicKey:e})}catch{const t=re(r.digest);return new OU(new URL(t))}throw new ew("Supplied PeerID Multihash is invalid")}function Md(r){if((r==null?void 0:r.multihash)==null||r.version==null||r.version===1&&r.code!==ooe&&r.code!==bk)throw new YL("Supplied PeerID CID is invalid");if(r.code===bk){const e=re(r.multihash.digest);return new OU(new URL(e))}return ri(r.multihash)}function coe(r){return r.code===PU.code}function loe(r){return r.code===noe.code}function RU(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function uoe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var hoe=uoe,doe=hoe;let foe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},poe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return LU(this,e)}},goe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return LU(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function LU(r,e){return new goe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let yoe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new foe(e,t,n),this.decoder=new poe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function moe({name:r,prefix:e,encode:t,decode:n}){return new yoe(r,e,t,n)}function BU({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=doe(t,r);return moe({prefix:e,name:r,encode:n,decode:s=>RU(i(s))})}const woe=BU({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});BU({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var boe=UU,vk=128,voe=-128,Eoe=Math.pow(2,31);function UU(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Eoe;)e[t++]=r&255|vk,r/=128;for(;r&voe;)e[t++]=r&255|vk,r>>>=7;return e[t]=r|0,UU.bytes=t-n+1,e}var Soe=Ob,xoe=128,Ek=127;function Ob(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Ob.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&Ek)<<i:(o&Ek)*Math.pow(2,i),i+=7}while(o>=xoe);return Ob.bytes=s-n,t}var Aoe=Math.pow(2,7),Coe=Math.pow(2,14),Ioe=Math.pow(2,21),koe=Math.pow(2,28),_oe=Math.pow(2,35),Toe=Math.pow(2,42),Poe=Math.pow(2,49),Doe=Math.pow(2,56),$oe=Math.pow(2,63),Noe=function(r){return r<Aoe?1:r<Coe?2:r<Ioe?3:r<koe?4:r<_oe?5:r<Toe?6:r<Poe?7:r<Doe?8:r<$oe?9:10},Moe={encode:boe,decode:Soe,encodingLength:Noe},Sk=Moe;function xk(r,e=0){return[Sk.decode(r,e),Sk.decode.bytes]}function Ooe(r){const e=RU(r),[t,n]=xk(e),[i,s]=xk(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Roe(t,i,o,e)}let Roe=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function o1(r,e){const t={[Symbol.iterator]:()=>t,next:()=>{const n=r.next(),i=n.value;return n.done===!0||i==null?{done:!0,value:void 0}:{done:!1,value:e(i)}}};return t}function e5(r){const e=Ooe(woe.decode(`z${r}`));return ri(e)}class Oc{constructor(e){u(this,"map");if(this.map=new Map,e!=null)for(const[t,n]of e.entries())this.map.set(t.toString(),{key:t,value:n})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return o1(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,n)=>{e(t.value,t.key,this)})}get(e){var t;return(t=this.map.get(e.toString()))==null?void 0:t.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return o1(this.map.values(),e=>e.key)}values(){return o1(this.map.values(),e=>e.value)}get size(){return this.map.size}}class is{constructor(e){u(this,"set");if(this.set=new Set,e!=null)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return o1(this.set.entries(),e=>{const t=e5(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{const n=e5(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return o1(this.set.values(),e=>e5(e))}intersection(e){const t=new is;for(const n of e)this.has(n)&&t.add(n);return t}difference(e){const t=new is;for(const n of this)e.has(n)||t.add(n);return t}union(e){const t=new is;for(const n of e)t.add(n);for(const n of this)t.add(n);return t}}function Loe(){return new is}class FU extends VB{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,uw(e);const n=q1(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Us(s)}update(e){return fy(this),this.iHash.update(e),this}digestInto(e){fy(this),zp(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const yw=(r,e,t)=>new FU(r,e).update(t).digest();yw.create=(r,e)=>new FU(r,e);function zU(r,e,t,n){uw(r);const i=mne({dkLen:32,asyncTick:10},n),{c:s,dkLen:o,asyncTick:a}=i;if(mh(s),mh(o),mh(a),s<1)throw new Error("iterations (c) should be >= 1");const c=ek(e),l=ek(t),h=new Uint8Array(o),d=yw.create(r,c),p=d._cloneInto().update(l);return{c:s,dkLen:o,asyncTick:a,DK:h,PRF:d,PRFSalt:p}}function VU(r,e,t,n,i){return r.destroy(),e.destroy(),n&&n.destroy(),Us(i),t}function Boe(r,e,t,n){const{c:i,dkLen:s,DK:o,PRF:a,PRFSalt:c}=zU(r,e,t,n);let l;const h=new Uint8Array(4),d=s1(h),p=new Uint8Array(a.outputLen);for(let m=1,f=0;f<s;m++,f+=a.outputLen){const g=o.subarray(f,f+a.outputLen);d.setInt32(0,m,!1),(l=c._cloneInto(l)).update(h).digestInto(p),g.set(p.subarray(0,g.length));for(let v=1;v<i;v++){a._cloneInto(l).update(p).digestInto(p);for(let y=0;y<g.length;y++)g[y]^=p[y]}}return VU(a,c,o,l,p)}async function KU(r,e,t,n){const{c:i,dkLen:s,asyncTick:o,DK:a,PRF:c,PRFSalt:l}=zU(r,e,t,n);let h;const d=new Uint8Array(4),p=s1(d),m=new Uint8Array(c.outputLen);for(let f=1,g=0;g<s;f++,g+=c.outputLen){const v=a.subarray(g,g+c.outputLen);p.setInt32(0,f,!1),(h=l._cloneInto(h)).update(d).digestInto(m),v.set(m.subarray(0,v.length)),await yne(i-1,o,()=>{c._cloneInto(h).update(m).digestInto(m);for(let y=0;y<v.length;y++)v[y]^=m[y]})}return VU(c,l,a,h,m)}const Sf=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),va=new Uint32Array(80);class Uoe extends CS{constructor(){super(64,20,8,!1),this.A=Sf[0]|0,this.B=Sf[1]|0,this.C=Sf[2]|0,this.D=Sf[3]|0,this.E=Sf[4]|0}get(){const{A:e,B:t,C:n,D:i,E:s}=this;return[e,t,n,i,s]}set(e,t,n,i,s){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0}process(e,t){for(let c=0;c<16;c++,t+=4)va[c]=e.getUint32(t,!1);for(let c=16;c<80;c++)va[c]=Y8(va[c-3]^va[c-8]^va[c-14]^va[c-16],1);let{A:n,B:i,C:s,D:o,E:a}=this;for(let c=0;c<80;c++){let l,h;c<20?(l=KB(i,s,o),h=1518500249):c<40?(l=i^s^o,h=1859775393):c<60?(l=HB(i,s,o),h=2400959708):(l=i^s^o,h=3395469782);const d=Y8(n,5)+l+a+h+va[c]|0;a=o,o=s,s=Y8(i,30),i=n,n=d}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,this.set(n,i,s,o,a)}roundClean(){Us(va)}destroy(){this.set(0,0,0,0,0),Us(this.buffer)}}const Foe=AS(()=>new Uoe),zoe=Foe,US=One,Voe=ti({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});ti({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});ti({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});ti({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const Ak={sha1:zoe,"sha2-256":Pl,"sha2-512":US};function Ck(r,e,t,n,i){if(i!=="sha1"&&i!=="sha2-256"&&i!=="sha2-512"){const a=Object.keys(Ak).join(" / ");throw new Z(`Hash '${i}' is unknown or not supported. Must be ${a}`)}const s=Ak[i],o=Boe(s,r,e,{c:t,dkLen:n});return Voe.encode(o).substring(1)}const FS={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},HU={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},jU=new globalThis.TextEncoder;function Koe(r,e){const t=FS[e];let n=HU[e];for(let i=0;i<r.length;i++)n^=BigInt(r[i]),n=BigInt.asUintN(e,n*t);return n}function Hoe(r,e,t){if(t.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");const n=FS[e];let i=HU[e],s=r;for(;s.length>0;){const o=jU.encodeInto(s,t);s=s.slice(o.read);for(let a=0;a<o.written;a++)i^=BigInt(t[a]),i=BigInt.asUintN(e,i*n)}return i}function joe(r,{size:e=32,utf8Buffer:t}={}){if(!FS[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof r=="string"){if(t)return Hoe(r,e,t);r=jU.encode(r)}return Koe(r,e)}const zS={hash:r=>Number(joe(r,{size:32})),hashV:(r,e)=>qoe(zS.hash(r,e))};function qoe(r){let e=r.toString(16);return e.length%2===1&&(e=`0${e}`),se(e,"base16")}const qU=64;class pl{constructor(e,t,n,i=2){u(this,"fp");u(this,"h");u(this,"seed");if(i>qU)throw new TypeError("Invalid Fingerprint Size");const s=t.hashV(e,n),o=We(i);for(let a=0;a<o.length;a++)o[a]=s[a];o.length===0&&(o[0]=7),this.fp=o,this.h=t,this.seed=n}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return(e==null?void 0:e.fp)instanceof Uint8Array?Ke(this.fp,e.fp):!1}}function Ey(r,e){return Math.floor(Math.random()*(e-r))+r}class Z0{constructor(e){u(this,"contents");this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof pl))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof pl))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof pl))throw new TypeError("Invalid Fingerprint");const t=Ey(0,this.contents.length-1),n=this.contents[t];return this.contents[t]=e,n}remove(e){if(!(e instanceof pl))throw new TypeError("Invalid Fingerprint");const t=this.contents.findIndex(n=>e.equals(n));return t>-1?(this.contents[t]=null,!0):!1}}const Woe=500;class Ik{constructor(e){u(this,"bucketSize");u(this,"filterSize");u(this,"fingerprintSize");u(this,"buckets");u(this,"count");u(this,"hash");u(this,"seed");this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??zS,this.seed=e.seed??Ey(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=se(e));const t=new pl(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=(n^t.hash())%this.filterSize;if(this.buckets[n]==null&&(this.buckets[n]=new Z0(this.bucketSize)),this.buckets[i]==null&&(this.buckets[i]=new Z0(this.bucketSize)),this.buckets[n].add(t)||this.buckets[i].add(t))return this.count++,!0;const s=[n,i];let o=s[Ey(0,s.length-1)];this.buckets[o]==null&&(this.buckets[o]=new Z0(this.bucketSize));for(let a=0;a<Woe;a++){const c=this.buckets[o].swap(t);if(c!=null&&(o=(o^c.hash())%this.filterSize,this.buckets[o]==null&&(this.buckets[o]=new Z0(this.bucketSize)),this.buckets[o].add(c)))return this.count++,!0}return!1}has(e){var o,a;typeof e=="string"&&(e=se(e));const t=new pl(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=((o=this.buckets[n])==null?void 0:o.has(t))??!1;if(i)return i;const s=(n^t.hash())%this.filterSize;return((a=this.buckets[s])==null?void 0:a.has(t))??!1}remove(e){var a,c;typeof e=="string"&&(e=se(e));const t=new pl(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=((a=this.buckets[n])==null?void 0:a.remove(t))??!1;if(i)return this.count--,i;const s=(n^t.hash())%this.filterSize,o=((c=this.buckets[s])==null?void 0:c.remove(t))??!1;return o&&this.count--,o}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}}const Goe={1:.5,2:.84,4:.95,8:.98};function Qoe(r=.001){return r>.002?2:r>1e-5?4:8}function Yoe(r,e=.001){const t=Qoe(e),n=Goe[t],i=Math.round(r/n),s=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),qU);return{filterSize:i,bucketSize:t,fingerprintSize:s}}class Xoe{constructor(e){u(this,"filterSize");u(this,"bucketSize");u(this,"fingerprintSize");u(this,"scale");u(this,"filterSeries");u(this,"hash");u(this,"seed");this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??zS,this.seed=e.seed??Ey(0,Math.pow(2,10)),this.filterSeries=[new Ik({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=se(e)),this.has(e))return!0;let t=this.filterSeries.find(n=>n.reliable);if(t==null){const n=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new Ik({filterSize:n,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=se(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=se(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}function jl(r,e=.001,t){return new Xoe({...Yoe(r,e)})}class Joe{constructor(e,t){u(this,"filter");this.filter=jl(e,t)}has(e){return this.filter.has(e.toMultihash().bytes)}add(e){this.filter.add(e.toMultihash().bytes)}remove(e){var t,n;(n=(t=this.filter).remove)==null||n.call(t,e.toMultihash().bytes)}}function Zoe(r,e=.001){return new Joe(r,e)}class eae extends Oc{constructor(t){super();u(this,"metric");const{name:n,metrics:i}=t;this.metric=i.registerMetric(n),this.updateComponentMetric()}set(t,n){return super.set(t,n),this.updateComponentMetric(),this}delete(t){const n=super.delete(t);return this.updateComponentMetric(),n}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function WU(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new eae({name:e,metrics:t}):n=new Oc,n}function tae(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function VS(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function rae(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var nae=rae,iae=nae;let sae=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},oae=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return GU(this,e)}},aae=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return GU(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function GU(r,e){return new aae({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let cae=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new sae(e,t,n),this.decoder=new oae(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function QU({name:r,prefix:e,encode:t,decode:n}){return new cae(r,e,t,n)}function mw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=iae(t,r);return QU({prefix:e,name:r,encode:n,decode:s=>VS(i(s))})}function lae(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function uae(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function ni({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return QU({prefix:e,name:r,encode(i){return uae(i,n,t)},decode(i){return lae(i,n,t,r)}})}const Yg=ni({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ni({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});ni({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});ni({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});ni({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});ni({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});ni({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});ni({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});ni({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const t5=mw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});mw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Aa=mw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});mw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var hae=YU,kk=128,dae=-128,fae=Math.pow(2,31);function YU(r,e,t){e=e||[],t=t||0;for(var n=t;r>=fae;)e[t++]=r&255|kk,r/=128;for(;r&dae;)e[t++]=r&255|kk,r>>>=7;return e[t]=r|0,YU.bytes=t-n+1,e}var pae=Rb,gae=128,_k=127;function Rb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Rb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&_k)<<i:(o&_k)*Math.pow(2,i),i+=7}while(o>=gae);return Rb.bytes=s-n,t}var yae=Math.pow(2,7),mae=Math.pow(2,14),wae=Math.pow(2,21),bae=Math.pow(2,28),vae=Math.pow(2,35),Eae=Math.pow(2,42),Sae=Math.pow(2,49),xae=Math.pow(2,56),Aae=Math.pow(2,63),Cae=function(r){return r<yae?1:r<mae?2:r<wae?3:r<bae?4:r<vae?5:r<Eae?6:r<Sae?7:r<xae?8:r<Aae?9:10},Iae={encode:hae,decode:pae,encodingLength:Cae},Sy=Iae;function Lb(r,e=0){return[Sy.decode(r,e),Sy.decode.bytes]}function xy(r,e,t=0){return Sy.encode(r,e,t),e}function Ay(r){return Sy.encodingLength(r)}function Bb(r,e){const t=e.byteLength,n=Ay(r),i=n+Ay(t),s=new Uint8Array(i+t);return xy(r,s,0),xy(t,s,n),s.set(e,i),new KS(r,t,e,s)}function kae(r){const e=VS(r),[t,n]=Lb(e),[i,s]=Lb(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new KS(t,i,o,e)}function _ae(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&tae(r.bytes,t.bytes)}}let KS=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function Tk(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Pae(t,Ub(r),e??Aa.encoder);default:return Dae(t,Ub(r),e??Yg.encoder)}}const Pk=new WeakMap;function Ub(r){const e=Pk.get(r);if(e==null){const t=new Map;return Pk.set(r,t),t}return e}var rN;let Fb=class Mr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,rN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==xf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==$ae)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Mr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Bb(e,t);return Mr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Mr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&_ae(e.multihash,n.multihash)}toString(e){return Tk(this,e)}toJSON(){return{"/":Tk(this)}}link(){return this}[(rN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Mr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Mr(n,i,s,o??Dk(n,i,s.bytes))}else if(t[Nae]===!0){const{version:n,multihash:i,code:s}=t,o=kae(i);return Mr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==xf)throw new Error(`Version 0 CID must use dag-pb (code: ${xf}) block encoding`);return new Mr(e,t,n,n.bytes)}case 1:{const i=Dk(e,t,n.bytes);return new Mr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Mr.create(0,xf,e)}static createV1(e,t){return Mr.create(1,e,t)}static decode(e){const[t,n]=Mr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Mr.inspectBytes(e),n=t.size-t.multihashSize,i=VS(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new KS(t.multihashCode,t.digestSize,s,i);return[t.version===0?Mr.createV0(o):Mr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=Lb(e.subarray(t));return t+=p,d};let i=n(),s=xf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){const[n,i]=Tae(e,t),s=Mr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Ub(s).set(n,e),s}};function Tae(r,e){switch(r[0]){case"Q":{const t=e??Aa;return[Aa.prefix,t.decode(`${Aa.prefix}${r}`)]}case Aa.prefix:{const t=e??Aa;return[Aa.prefix,t.decode(r)]}case Yg.prefix:{const t=e??Yg;return[Yg.prefix,t.decode(r)]}case t5.prefix:{const t=e??t5;return[t5.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Pae(r,e,t){const{prefix:n}=t;if(n!==Aa.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Dae(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const xf=112,$ae=18;function Dk(r,e,t){const n=Ay(r),i=n+Ay(e),s=new Uint8Array(i+t.byteLength);return xy(r,s,0),xy(e,s,n),s.set(t,i),s}const Nae=Symbol.for("@ipld/js-cid/CID"),r5=ni({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});ni({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});ni({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});ni({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});class Vf{constructor(e=!1,t=0){u(this,"full");u(this,"pendingBytes");u(this,"wantlist");u(this,"blocks");u(this,"blockPresences");this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}addWantlistEntry(e,t){const n=r5.encode(e.multihash.bytes);this.wantlist.set(n,t)}addBlockPresence(e,t){const n=r5.encode(e.multihash.bytes);this.blockPresences.set(n,t)}addBlock(e,t){const n=r5.encode(e.multihash.bytes);this.blocks.set(n,t)}}function Mae(r){let e=new Uint8Array(r.reduce((n,i)=>n+dt(i),0)),t=0;for(const n of r)e=br(n,e,t),t+=dt(n);return e}function $k(r){return Mae([r.version,r.code,r.multihash.code,r.multihash.digest.byteLength])}class Oae{constructor(e,t){u(this,"peerId");u(this,"blockstore");u(this,"network");u(this,"wants");u(this,"exchangeCount");u(this,"bytesSent");u(this,"bytesReceived");u(this,"lastExchange");u(this,"maxSizeReplaceHasWithBlock");u(this,"log");this.peerId=e.peerId,this.blockstore=e.blockstore,this.network=e.network,this.wants=new Map,this.log=e.logger.forComponent(`helia:bitswap:ledger:${e.peerId}`),this.exchangeCount=0,this.bytesSent=0,this.bytesReceived=0,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock??nse}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesReceived+=e}debtRatio(){return this.bytesSent/(this.bytesReceived+1)}async sendBlocksToPeer(e){const t=new Vf,n=new Set;for(const[i,s]of this.wants.entries())try{const o=await this.blockstore.get(s.cid,e);s.wantType===sr.WantHave?o.byteLength<this.maxSizeReplaceHasWithBlock?(this.log("sending have and block for %c",s.cid),n.add(i),t.addBlock(s.cid,{data:o,prefix:$k(s.cid)})):(this.log("sending have for %c",s.cid),t.addBlockPresence(s.cid,{cid:s.cid.bytes,type:Ls.HaveBlock})):(this.log("sending block for %c",s.cid),n.add(i),t.addBlock(s.cid,{data:o,prefix:$k(s.cid)}))}catch(o){if(o.name!=="NotFoundError")throw o;if(this.log("do not have block for %c",s.cid),!s.sendDontHave||s.sentDoNotHave===!0)continue;s.sentDoNotHave=!0,t.addBlockPresence(s.cid,{cid:s.cid.bytes,type:Ls.DoNotHaveBlock})}if(t.blocks.size>0||t.blockPresences.size>0){this.log("sending message"),await this.network.sendMessage(this.peerId,t,e),this.log("sent message"),this.sentBytes([...t.blocks.values()].reduce((i,s)=>i+s.data.byteLength,0));for(const i of n)this.wants.delete(i)}}}class Rae{constructor(e,t={}){u(this,"blockstore");u(this,"network");u(this,"ledgerMap");u(this,"maxSizeReplaceHasWithBlock");u(this,"log");u(this,"logger");this.blockstore=e.blockstore,this.network=e.network,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock,this.log=e.logger.forComponent("helia:bitswap:peer-want-lists"),this.logger=e.logger,this.ledgerMap=WU({name:"helia_bitswap_ledger_map",metrics:e.metrics}),this.network.addEventListener("bitswap:message",n=>{this.receiveMessage(n.detail.peer,n.detail.message).catch(i=>{this.log.error("error receiving bitswap message from %p",n.detail.peer,i)})}),this.network.addEventListener("peer:disconnected",n=>{this.peerDisconnected(n.detail)})}ledgerForPeer(e){const t=this.ledgerMap.get(e);if(t!=null)return{peer:t.peerId,value:t.debtRatio(),sent:t.bytesSent,received:t.bytesReceived,exchanged:t.exchangeCount}}wantListForPeer(e){const t=this.ledgerMap.get(e);if(t!=null)return[...t.wants.values()]}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.peerId)}async receiveMessage(e,t){var i;let n=this.ledgerMap.get(e);if(n==null&&(n=new Oae({peerId:e,blockstore:this.blockstore,network:this.network,logger:this.logger},{maxSizeReplaceHasWithBlock:this.maxSizeReplaceHasWithBlock}),this.ledgerMap.set(e,n)),n.receivedBytes(((i=t.blocks)==null?void 0:i.reduce((s,o)=>s+o.data.byteLength,0))??0),t.wantlist!=null){t.wantlist.full===!0&&n.wants.clear();for(const s of t.wantlist.entries){const o=Fb.decode(s.cid),a=re(o.multihash.bytes,"base64");s.cancel===!0?(this.log("peer %p cancelled want of block for %c",e,o),n.wants.delete(a)):(s.wantType===sr.WantHave?this.log("peer %p wanted block presence for %c",e,o):this.log("peer %p wanted block for %c",e,o),n.wants.set(a,{cid:o,priority:s.priority,wantType:s.wantType??sr.WantBlock,sendDontHave:s.sendDontHave??!1}))}}this.log("send blocks to peer"),await n.sendBlocksToPeer()}async receivedBlock(e,t){const n=re(e.multihash.bytes,"base64"),i=[];for(const s of this.ledgerMap.values())s.wants.has(n)&&i.push(s);await Promise.all(i.map(async s=>s.sendBlocksToPeer(t)))}peerDisconnected(e){this.ledgerMap.delete(e)}}function Lae(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Bae(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var Uae=Bae,Fae=Uae;let zae=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Vae=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return XU(this,e)}},Kae=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return XU(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function XU(r,e){return new Kae({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Hae=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new zae(e,t,n),this.decoder=new Vae(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function JU({name:r,prefix:e,encode:t,decode:n}){return new Hae(r,e,t,n)}function ZU({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Fae(t,r);return JU({prefix:e,name:r,encode:n,decode:s=>Lae(i(s))})}function jae(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function qae(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function ii({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return JU({prefix:e,name:r,encode(i){return qae(i,n,t)},decode(i){return jae(i,n,t,r)}})}const Wae=ii({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ii({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});ii({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});ii({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});ii({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});ii({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});ii({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});ii({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});ii({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Gae=ZU({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});ZU({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const Qae=ii({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});ii({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});ii({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});ii({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const Xh=1e3,Jh=Xh*60,Zh=Jh*60,ql=Zh*24,Yae=ql*7,Xae=ql*365.25;function eF(r,e){try{if(typeof r=="string"&&r.length>0)return Jae(r);if(typeof r=="number"&&isFinite(r))return e!=null&&e.long?ece(r):Zae(r);throw new Error("Value is not a string or number.")}catch(t){const n=tce(t)?`${t.message}. value=${JSON.stringify(r)}`:"An unknown error has occured.";throw new Error(n)}}function Jae(r){if(r=String(r),r.length>100)throw new Error("Value exceeds the maximum length of 100 characters.");const e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!e)return NaN;const t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*Xae;case"weeks":case"week":case"w":return t*Yae;case"days":case"day":case"d":return t*ql;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Zh;case"minutes":case"minute":case"mins":case"min":case"m":return t*Jh;case"seconds":case"second":case"secs":case"sec":case"s":return t*Xh;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:throw new Error(`The unit ${n} was matched, but no matching case exists.`)}}function Zae(r){const e=Math.abs(r);return e>=ql?`${Math.round(r/ql)}d`:e>=Zh?`${Math.round(r/Zh)}h`:e>=Jh?`${Math.round(r/Jh)}m`:e>=Xh?`${Math.round(r/Xh)}s`:`${r}ms`}function ece(r){const e=Math.abs(r);return e>=ql?eg(r,e,ql,"day"):e>=Zh?eg(r,e,Zh,"hour"):e>=Jh?eg(r,e,Jh,"minute"):e>=Xh?eg(r,e,Xh,"second"):`${r} ms`}function eg(r,e,t,n){const i=e>=t*1.5;return`${Math.round(r/t)} ${n}${i?"s":""}`}function tce(r){return typeof r=="object"&&r!==null&&"message"in r}function rce(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=i,t.enabled=o,t.humanize=eF,t.destroy=l,Object.keys(r).forEach(h=>{t[h]=r[h]}),t.names=[],t.skips=[],t.formatters={};function e(h){let d=0;for(let p=0;p<h.length;p++)d=(d<<5)-d+h.charCodeAt(p),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(h){let d,p=null,m,f;function g(...v){if(!g.enabled)return;const y=g,w=Number(new Date),b=w-(d||w);y.diff=b,y.prev=d,y.curr=w,d=w,v[0]=t.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let E=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(k,x)=>{if(k==="%%")return"%";E++;const I=t.formatters[x];if(typeof I=="function"){const T=v[E];k=I.call(y,T),v.splice(E,1),E--}return k}),t.formatArgs.call(y,v),(y.log||t.log).apply(y,v)}return g.namespace=h,g.useColors=t.useColors(),g.color=t.selectColor(h),g.extend=n,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(m!==t.namespaces&&(m=t.namespaces,f=t.enabled(h)),f),set:v=>{p=v}}),typeof t.init=="function"&&t.init(g),g}function n(h,d){const p=t(this.namespace+(typeof d>"u"?":":d)+h);return p.log=this.log,p}function i(h){t.save(h),t.namespaces=h,t.names=[],t.skips=[];let d;const p=(typeof h=="string"?h:"").split(/[\s,]+/),m=p.length;for(d=0;d<m;d++)p[d]&&(h=p[d].replace(/\*/g,".*?"),h[0]==="-"?t.skips.push(new RegExp("^"+h.substr(1)+"$")):t.names.push(new RegExp("^"+h+"$")))}function s(){const h=[...t.names.map(a),...t.skips.map(a).map(d=>"-"+d)].join(",");return t.enable(""),h}function o(h){if(h[h.length-1]==="*")return!0;let d,p;for(d=0,p=t.skips.length;d<p;d++)if(t.skips[d].test(h))return!1;for(d=0,p=t.names.length;d<p;d++)if(t.names[d].test(h))return!0;return!1}function a(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}function c(h){return h instanceof Error?h.stack??h.message:h}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.setupFormatters(t.formatters),t.enable(t.load()),t}var nce={};const Ts=uce(),ice=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function sce(){var r,e,t,n,i;return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&((r=navigator.userAgent)==null?void 0:r.toLowerCase().match(/(edge|trident)\/(\d+)/))!=null?!1:typeof document<"u"&&((t=(e=document.documentElement)==null?void 0:e.style)==null?void 0:t.WebkitAppearance)||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&((n=navigator.userAgent)==null?void 0:n.toLowerCase().match(/firefox\/(\d+)/))!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&((i=navigator.userAgent)==null?void 0:i.toLowerCase().match(/applewebkit\/(\d+)/))}function oce(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+eF(this.diff),!this.useColors)return;const e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}const ace=console.debug??console.log??(()=>{});function cce(r){try{r?Ts==null||Ts.setItem("debug",r):Ts==null||Ts.removeItem("debug")}catch{}}function lce(){let r;try{r=Ts==null?void 0:Ts.getItem("debug")}catch{}return!r&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(r=nce.DEBUG),r}function uce(){try{return localStorage}catch{}}function hce(r){r.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}const qn=rce({formatArgs:oce,save:cce,load:lce,useColors:sce,setupFormatters:hce,colors:ice,storage:Ts,log:ace});qn.formatters.b=r=>r==null?"undefined":Gae.baseEncode(r);qn.formatters.t=r=>r==null?"undefined":Wae.baseEncode(r);qn.formatters.m=r=>r==null?"undefined":Qae.baseEncode(r);qn.formatters.p=r=>r==null?"undefined":r.toString();qn.formatters.c=r=>r==null?"undefined":r.toString();qn.formatters.k=r=>r==null?"undefined":r.toString();qn.formatters.a=r=>r==null?"undefined":r.toString();qn.formatters.e=r=>r==null?"undefined":Nk(r.stack)??Nk(r.message)??r.toString();function dce(r){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function ww(){return{forComponent(r){return Od(r)}}}function Od(r){let e=dce(`${r}:trace`);return qn.enabled(`${r}:trace`)&&qn.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=qn(`${r}:trace`)),Object.assign(qn(r),{error:qn(`${r}:error`),trace:e})}function Nk(r){if(r!=null&&(r=r.trim(),r.length!==0))return r}function tF(r){const e=[Ec.A];return r==null?e:Array.isArray(r)?r.length===0?e:r:[r]}const rF=60;function nF(r){return{Status:r.Status??0,TC:r.TC??r.flag_tc??!1,RD:r.RD??r.flag_rd??!1,RA:r.RA??r.flag_ra??!1,AD:r.AD??r.flag_ad??!1,CD:r.CD??r.flag_cd??!1,Question:(r.Question??r.questions??[]).map(e=>({name:e.name,type:Ec[e.type]})),Answer:(r.Answer??r.answers??[]).map(e=>({name:e.name,type:Ec[e.type],TTL:e.TTL??e.ttl??rF,data:e.data instanceof Uint8Array?re(e.data):e.data}))}}const fce=4;function Mk(r,e={}){const t=new pc({concurrency:e.queryConcurrency??fce});return async(n,i={})=>{var a;const s=new URLSearchParams;s.set("name",n),tF(i.types).forEach(c=>{s.append("type",Ec[c])}),(a=i.onProgress)==null||a.call(i,new Ie("dns:query",{detail:n}));const o=await t.add(async()=>{var h;const c=await fetch(`${r}?${s}`,{headers:{accept:"application/dns-json"},signal:i==null?void 0:i.signal});if(c.status!==200)throw new Error(`Unexpected HTTP status: ${c.status} - ${c.statusText}`);const l=nF(await c.json());return(h=i.onProgress)==null||h.call(i,new Ie("dns:response",{detail:l})),l},{signal:i.signal});if(o==null)throw new Error("No DNS response received");return o}}function pce(){return[Mk("https://cloudflare-dns.com/dns-query"),Mk("https://dns.google/resolve")]}var gce=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),n=Object.create(null);function i(s,o){t[s]=o,e++,e>=r&&(e=0,n=t,t=Object.create(null))}return{has:function(s){return t[s]!==void 0||n[s]!==void 0},remove:function(s){t[s]!==void 0&&(t[s]=void 0),n[s]!==void 0&&(n[s]=void 0)},get:function(s){var o=t[s];if(o!==void 0)return o;if((o=n[s])!==void 0)return i(s,o),o},set:function(s,o){t[s]!==void 0?t[s]=o:i(s,o)},clear:function(){t=Object.create(null),n=Object.create(null)}}};const yce=Vo(gce);class mce{constructor(e){u(this,"lru");this.lru=yce(e)}get(e,t){let n=!0;const i=[];for(const s of t){const o=this.getAnswers(e,s);if(o.length===0){n=!1;break}i.push(...o)}if(n)return nF({answers:i})}getAnswers(e,t){const n=`${e.toLowerCase()}-${t}`,i=this.lru.get(n);if(i!=null){const s=i.filter(o=>o.expires>Date.now()).map(({expires:o,value:a})=>({...a,TTL:Math.round((o-Date.now())/1e3),type:Ec[a.type]}));return s.length===0&&this.lru.remove(n),s}return[]}add(e,t){const n=`${e.toLowerCase()}-${t.type}`,i=this.lru.get(n)??[];i.push({expires:Date.now()+(t.TTL??rF)*1e3,value:t}),this.lru.set(n,i)}remove(e,t){const n=`${e.toLowerCase()}-${t}`;this.lru.remove(n)}clear(){this.lru.clear()}}function wce(r){return new mce(r)}const bce=1e3;let vce=class{constructor(e){u(this,"resolvers");u(this,"cache");this.resolvers={},this.cache=wce(e.cacheSize??bce),Object.entries(e.resolvers??{}).forEach(([t,n])=>{Array.isArray(n)||(n=[n]),t.endsWith(".")||(t=`${t}.`),this.resolvers[t]=n}),this.resolvers["."]==null&&(this.resolvers["."]=pce())}async query(e,t={}){var c,l,h;const n=tF(t.types),i=t.cached!==!1?this.cache.get(e,n):void 0;if(i!=null)return(c=t.onProgress)==null||c.call(t,new Ie("dns:cache",{detail:i})),i;const s=`${e.split(".").pop()}.`,o=(this.resolvers[s]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),a=[];for(const d of o){if(((l=t.signal)==null?void 0:l.aborted)===!0)break;try{const p=await d(e,{...t,types:n});for(const m of p.Answer)this.cache.add(e,m);return p}catch(p){a.push(p),(h=t.onProgress)==null||h.call(t,new Ie("dns:error",{detail:p}))}}throw a.length===1?a[0]:new AggregateError(a,`DNS lookup of ${e} ${n} failed`)}};var Ec;(function(r){r[r.A=1]="A",r[r.CNAME=5]="CNAME",r[r.TXT=16]="TXT",r[r.AAAA=28]="AAAA"})(Ec||(Ec={}));function iF(r={}){return new vce(r)}const no="/",sF=new TextEncoder().encode(no),tg=sF[0];class yt{constructor(e,t){u(this,"_buf");if(typeof e=="string")this._buf=se(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==tg)throw new Error("Invalid key")}toString(e="utf8"){return re(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new yt(e.join(no))}static random(){return new yt(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new yt(e):typeof e.uint8Array=="function"?new yt(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=sF),this._buf[0]!==tg){const e=new Uint8Array(this._buf.byteLength+1);e.fill(tg,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===tg;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;const s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return yt.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(no).slice(1)}type(){return Ece(this.baseNamespace())}name(){return Sce(this.baseNamespace())}instance(e){return new yt(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(no)||(e+=no),e+=this.type(),new yt(e)}parent(){const e=this.list();return e.length===1?new yt(no):new yt(e.slice(0,-1).join(no))}child(e){return this.toString()===no?e:e.toString()===no?this:new yt(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return yt.withNamespaces([...this.namespaces(),...xce(e.map(t=>t.namespaces()))])}}function Ece(r){const e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function Sce(r){const e=r.split(":");return e[e.length-1]}function xce(r){return[].concat(...r)}function Ace(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Rd(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Cce(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var Ice=Cce,kce=Ice;let _ce=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Tce=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return oF(this,e)}},Pce=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return oF(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function oF(r,e){return new Pce({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Dce=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new _ce(e,t,n),this.decoder=new Tce(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function aF({name:r,prefix:e,encode:t,decode:n}){return new Dce(r,e,t,n)}function bw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=kce(t,r);return aF({prefix:e,name:r,encode:n,decode:s=>Rd(i(s))})}function $ce(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Nce(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function si({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return aF({prefix:e,name:r,encode(i){return Nce(i,n,t)},decode(i){return $ce(i,n,t,r)}})}const wh=bw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});bw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Xg=si({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});si({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});si({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});si({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});si({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});si({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});si({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});si({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});si({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Ca=bw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});bw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Mce=cF,Ok=128,Oce=-128,Rce=Math.pow(2,31);function cF(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Rce;)e[t++]=r&255|Ok,r/=128;for(;r&Oce;)e[t++]=r&255|Ok,r>>>=7;return e[t]=r|0,cF.bytes=t-n+1,e}var Lce=zb,Bce=128,Rk=127;function zb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw zb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&Rk)<<i:(o&Rk)*Math.pow(2,i),i+=7}while(o>=Bce);return zb.bytes=s-n,t}var Uce=Math.pow(2,7),Fce=Math.pow(2,14),zce=Math.pow(2,21),Vce=Math.pow(2,28),Kce=Math.pow(2,35),Hce=Math.pow(2,42),jce=Math.pow(2,49),qce=Math.pow(2,56),Wce=Math.pow(2,63),Gce=function(r){return r<Uce?1:r<Fce?2:r<zce?3:r<Vce?4:r<Kce?5:r<Hce?6:r<jce?7:r<qce?8:r<Wce?9:10},Qce={encode:Mce,decode:Lce,encodingLength:Gce},Cy=Qce;function Vb(r,e=0){return[Cy.decode(r,e),Cy.decode.bytes]}function Iy(r,e,t=0){return Cy.encode(r,e,t),e}function ky(r){return Cy.encodingLength(r)}function _y(r,e){const t=e.byteLength,n=ky(r),i=n+ky(t),s=new Uint8Array(i+t);return Iy(r,s,0),Iy(t,s,n),s.set(e,i),new HS(r,t,e,s)}function Yce(r){const e=Rd(r),[t,n]=Vb(e),[i,s]=Vb(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new HS(t,i,o,e)}function Xce(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Ace(r.bytes,t.bytes)}}let HS=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function Lk(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Zce(t,Kb(r),e??Ca.encoder);default:return ele(t,Kb(r),e??Xg.encoder)}}const Bk=new WeakMap;function Kb(r){const e=Bk.get(r);if(e==null){const t=new Map;return Bk.set(r,t),t}return e}var nN;let Wl=class Or{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,nN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Af)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==tle)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Or.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=_y(e,t);return Or.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Or.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Xce(e.multihash,n.multihash)}toString(e){return Lk(this,e)}toJSON(){return{"/":Lk(this)}}link(){return this}[(nN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Or)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Or(n,i,s,o??Uk(n,i,s.bytes))}else if(t[rle]===!0){const{version:n,multihash:i,code:s}=t,o=Yce(i);return Or.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Af)throw new Error(`Version 0 CID must use dag-pb (code: ${Af}) block encoding`);return new Or(e,t,n,n.bytes)}case 1:{const i=Uk(e,t,n.bytes);return new Or(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Or.create(0,Af,e)}static createV1(e,t){return Or.create(1,e,t)}static decode(e){const[t,n]=Or.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Or.inspectBytes(e),n=t.size-t.multihashSize,i=Rd(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new HS(t.multihashCode,t.digestSize,s,i);return[t.version===0?Or.createV0(o):Or.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=Vb(e.subarray(t));return t+=p,d};let i=n(),s=Af;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){const[n,i]=Jce(e,t),s=Or.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Kb(s).set(n,e),s}};function Jce(r,e){switch(r[0]){case"Q":{const t=e??Ca;return[Ca.prefix,t.decode(`${Ca.prefix}${r}`)]}case Ca.prefix:{const t=e??Ca;return[Ca.prefix,t.decode(r)]}case Xg.prefix:{const t=e??Xg;return[Xg.prefix,t.decode(r)]}case wh.prefix:{const t=e??wh;return[wh.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Zce(r,e,t){const{prefix:n}=t;if(n!==Ca.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function ele(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Af=112,tle=18;function Uk(r,e,t){const n=ky(r),i=n+ky(e),s=new Uint8Array(i+t.byteLength);return Iy(r,s,0),Iy(e,s,n),s.set(t,i),s}const rle=Symbol.for("@ipld/js-cid/CID");function lF({name:r,code:e,encode:t}){return new nle(r,e,t)}let nle=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?_y(this.code,t):t.then(n=>_y(this.code,n))}else throw Error("Unknown type, must be binary type")}};function rg({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*ile(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t],s=Wl.asCID(n);s!=null?yield[i.join("/"),s]:typeof n=="object"&&(yield*Hb(n,i))}else{const t=Wl.asCID(e);t!=null?yield[r.join("/"),t]:yield*Hb(e,r)}}function*Hb(r,e){if(r==null||r instanceof Uint8Array)return;const t=Wl.asCID(r);t!=null&&(yield[e.join("/"),t]);for(const[n,i]of Object.entries(r)){const s=[...e,n];yield*ile(s,i)}}function*sle(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t];yield i.join("/"),typeof n=="object"&&Wl.asCID(n)==null&&(yield*jb(n,i))}else yield*jb(e,r)}function*jb(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const i=[...e,t];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&Wl.asCID(n)==null&&(yield*sle(i,n))}}function ole(r,e){let t=r;for(const[n,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);const s=Wl.asCID(t);if(s!=null)return{value:s,remaining:e.slice(n+1).join("/")}}return{value:t}}class ale{constructor({cid:e,bytes:t,value:n}){u(this,"cid");u(this,"bytes");u(this,"value");u(this,"asBlock");if(e==null||t==null||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:rg(),bytes:rg(),value:rg(),asBlock:rg()})}links(){return Hb(this.value,[])}tree(){return jb(this.value,[])}get(e="/"){return ole(this.value,e.split("/").filter(Boolean))}}function cle({bytes:r,cid:e,value:t,codec:n}){const i=t!==void 0?t:n==null?void 0:n.decode(r);if(i===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new ale({cid:e,bytes:r,value:i})}const uF="/pin/",Fk="/pinned-block/",qb=wh,zk=1;function ng(r){return r.version===0&&(r=r.toV1()),new yt(`${uF}${r.toString(qb)}`)}var _o,Jg,Wb;class lle{constructor(e,t,n){qe(this,_o);u(this,"datastore");u(this,"blockstore");u(this,"getCodec");this.datastore=e,this.blockstore=t,this.getCodec=n}async*add(e,t={}){const n=ng(e);if(await this.datastore.has(n))throw new Error("Already pinned");const i=Math.round(t.depth??1/0);if(i<0)throw new Error("Depth must be greater than or equal to 0");const s=new Hl({concurrency:zk});for await(const a of Ae(this,_o,Jg).call(this,e,s,{...t,depth:i}))await Ae(this,_o,Wb).call(this,a,c=>c.pinnedBy.find(l=>Ke(l,e.bytes))!=null?!1:(c.pinCount++,c.pinnedBy.push(e.bytes),!0),t),yield a;const o={depth:i,metadata:t.metadata??{}};await this.datastore.put(n,Kg(o),t)}async*rm(e,t={}){const n=ng(e),i=await this.datastore.get(n,t),s=La(i);await this.datastore.delete(n,t);const o=new Hl({concurrency:zk});for await(const a of Ae(this,_o,Jg).call(this,e,o,{...t,depth:s.depth}))await Ae(this,_o,Wb).call(this,a,c=>(c.pinCount--,c.pinnedBy=c.pinnedBy.filter(l=>Ke(l,e.bytes)),!0),{...t,depth:s.depth}),yield a}async*ls(e={}){for await(const{key:t,value:n}of this.datastore.query({prefix:uF+(e.cid!=null?`${e.cid.toString(wh)}`:"")},e)){const i=Wl.parse(t.toString().substring(5),wh),s=La(n);yield{cid:i,...s}}}async isPinned(e,t={}){const n=new yt(`${Fk}${qb.encode(e.multihash.bytes)}`);return this.datastore.has(n,t)}async get(e,t){const n=ng(e),i=await this.datastore.get(n,t);return La(i)}async setMetadata(e,t,n){const i=ng(e),s=await this.datastore.get(i,n),o=La(s);o.metadata=t??{},await this.datastore.put(i,Kg(o),n)}}_o=new WeakSet,Jg=async function*(e,t,n){if(n.depth===-1)return;const i=await this.getCodec(e.code),s=await this.blockstore.get(e,n),o=cle({bytes:s,cid:e,codec:i});yield e;for await(const[,a]of o.links())yield*await t.add(async()=>Ae(this,_o,Jg).call(this,a,t,{...n,depth:n.depth-1}))},Wb=async function(e,t,n){var a;const i=new yt(`${Fk}${qb.encode(e.multihash.bytes)}`);let s={pinCount:0,pinnedBy:[]};try{s=La(await this.datastore.get(i,n))}catch(c){if(c.name!=="NotFoundError")throw c}if(t(s)){if(s.pinCount===0&&await this.datastore.has(i)){await this.datastore.delete(i);return}await this.datastore.put(i,Kg(s),n),(a=n.onProgress)==null||a.call(n,new Ie("helia:pin:add",e))}};const ule=1,hle=5;class hF extends Error{constructor(e="Insufficient providers found"){super(e),this.name="InsufficientProvidersError"}}u(hF,"name","InsufficientProvidersError");class Kf extends Error{constructor(e="No routers available"){super(e),this.name="NoRoutersAvailableError"}}u(Kf,"name","NoRoutersAvailableError");class dF extends Error{constructor(e="Unknown hash algorithm"){super(e),this.name="UnknownHashAlgorithmError"}}u(dF,"name","UnknownHashAlgorithmError");class fF extends Error{constructor(e="Unknown codec"){super(e),this.name="UnknownCodecError"}}u(fF,"name","UnknownCodecError");const dle=5;class fle{constructor(e,t){u(this,"log");u(this,"routers");u(this,"providerLookupConcurrency");var n,i,s,o,a,c,l;this.log=e.logger.forComponent("helia:routing"),this.routers=t.routers??[],this.providerLookupConcurrency=t.providerLookupConcurrency??dle,this.findProviders=((n=e.metrics)==null?void 0:n.traceFunction("helia.routing.findProviders",this.findProviders.bind(this),{optionsIndex:1}))??this.findProviders,this.provide=((i=e.metrics)==null?void 0:i.traceFunction("helia.routing.provide",this.provide.bind(this),{optionsIndex:1}))??this.provide,this.cancelReprovide=((s=e.metrics)==null?void 0:s.traceFunction("helia.routing.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1}))??this.cancelReprovide,this.put=((o=e.metrics)==null?void 0:o.traceFunction("helia.routing.put",this.put.bind(this),{optionsIndex:2}))??this.put,this.get=((a=e.metrics)==null?void 0:a.traceFunction("helia.routing.get",this.get.bind(this),{optionsIndex:1}))??this.get,this.findPeer=((c=e.metrics)==null?void 0:c.traceFunction("helia.routing.findPeer",this.findPeer.bind(this),{optionsIndex:1}))??this.findPeer,this.getClosestPeers=((l=e.metrics)==null?void 0:l.traceFunction("helia.routing.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1}))??this.getClosestPeers}async start(){await Oo(...this.routers)}async stop(){await Nc(...this.routers)}async*findProviders(e,t={}){if(this.routers.length===0)throw new Kf("No content routers available");const n=new vc({concurrency:this.providerLookupConcurrency});n.addEventListener("error",()=>{});for await(const i of ic(n.toGenerator(),...Yc(this.routers,"findProviders").map(s=>s.findProviders(e,t))))if(i!=null){if(i.multiaddrs.length===0){if(n.find(i.id)!=null)continue;n.add(async()=>{try{const s=await this.findPeer(i.id,t);return s.multiaddrs.length===0?null:s}catch(s){return this.log.error("could not load multiaddrs for peer %p",i.id,s),null}},{peerId:i.id,signal:t.signal}).catch(s=>{this.log.error("could not load multiaddrs for peer %p",i.id,s)})}yield i}}async provide(e,t={}){if(this.routers.length===0)throw new Kf("No content routers available");await Promise.all(Yc(this.routers,"provide").map(async n=>{await n.provide(e,t)}))}async cancelReprovide(e,t={}){await Promise.all(Yc(this.routers,"cancelReprovide").map(async n=>{await n.cancelReprovide(e,t)}))}async put(e,t,n){await Promise.all(Yc(this.routers,"put").map(async i=>{await i.put(e,t,n)}))}async get(e,t){return Promise.any(Yc(this.routers,"get").map(async n=>n.get(e,t)))}async findPeer(e,t){if(this.routers.length===0)throw new Kf("No peer routers available");const n=this,i=ic(...Yc(this.routers,"findPeer").map(s=>async function*(){try{yield await s.findPeer(e,t)}catch(o){n.log.error(o)}}()));for await(const s of i)if(s!=null)return s;throw new Qt("Could not find peer in routing")}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new Kf("No peer routers available");for await(const n of ic(...Yc(this.routers,"getClosestPeers").map(i=>i.getClosestPeers(e,t))))n!=null&&(yield n)}}function Yc(r,e){return r.filter(t=>t[e]!=null)}const cc={},Gl=r=>{r.addEventListener("message",e=>{Gl.dispatchEvent("message",r,e)}),r.port!=null&&r.port.addEventListener("message",e=>{Gl.dispatchEvent("message",r,e)})};Gl.addEventListener=(r,e)=>{cc[r]==null&&(cc[r]=[]),cc[r].push(e)};Gl.removeEventListener=(r,e)=>{cc[r]!=null&&(cc[r]=cc[r].filter(t=>t===e))};Gl.dispatchEvent=function(r,e,t){cc[r]!=null&&cc[r].forEach(n=>n(e,t))};const Vk="lock:worker:request-read",Kk="lock:worker:release-read",Hk="lock:master:grant-read",jk="lock:worker:request-write",qk="lock:worker:release-write",Wk="lock:master:grant-write",ple=(r=21)=>Math.random().toString().substring(2),Gk=(r,e,t,n,i)=>(s,o)=>{if(o.data.type!==t)return;const a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};r.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>{s.postMessage({type:i,name:a.name,identifier:a.identifier}),await new Promise(c=>{const l=h=>{if((h==null?void 0:h.data)==null)return;const d={type:h.data.type,name:h.data.name,identifier:h.data.identifier};d.type===n&&d.identifier===a.identifier&&(s.removeEventListener("message",l),c())};s.addEventListener("message",l)})}}}))},Qk=(r,e,t,n)=>async()=>{const i=ple();return globalThis.postMessage({type:e,identifier:i,name:r}),new Promise(s=>{const o=a=>{if((a==null?void 0:a.data)==null)return;const c={type:a.data.type,identifier:a.data.identifier};c.type===t&&c.identifier===i&&(globalThis.removeEventListener("message",o),s(()=>{globalThis.postMessage({type:n,identifier:i,name:r})}))};globalThis.addEventListener("message",o)})},gle={singleProcess:!1},yle=r=>{if(r=Object.assign({},gle,r),!!globalThis.document||r.singleProcess){const t=new EventTarget;return Gl.addEventListener("message",Gk(t,"requestReadLock",Vk,Kk,Hk)),Gl.addEventListener("message",Gk(t,"requestWriteLock",jk,qk,Wk)),t}return{isWorker:!0,readLock:t=>Qk(t,Vk,Hk,Kk),writeLock:t=>Qk(t,jk,Wk,qk)}},Xc={};let Ba;async function n5(r,e){let t;const n=new Promise(i=>{t=i});return r.add(async()=>Pp((async()=>{await new Promise(i=>{t(()=>{i()})})})(),{milliseconds:e.timeout})),n}const mle=(r,e)=>{if(Ba.isWorker===!0)return{readLock:Ba.readLock(r,e),writeLock:Ba.writeLock(r,e)};const t=new pc({concurrency:1});let n;return{async readLock(){if(n!=null)return n5(n,e);n=new pc({concurrency:e.concurrency,autoStart:!1});const i=n,s=n5(n,e);return t.add(async()=>{i.start(),await i.onIdle().then(()=>{n===i&&(n=null)})}),s},async writeLock(){return n=null,n5(t,e)}}},wle={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function jS(r){const e=Object.assign({},wle,r);return Ba==null&&(Ba=yle(e),Ba.isWorker!==!0&&(Ba.addEventListener("requestReadLock",t=>{Xc[t.data.name]!=null&&Xc[t.data.name].readLock().then(async n=>t.data.handler().finally(()=>{n()}))}),Ba.addEventListener("requestWriteLock",async t=>{Xc[t.data.name]!=null&&Xc[t.data.name].writeLock().then(async n=>t.data.handler().finally(()=>{n()}))}))),Xc[e.name]==null&&(Xc[e.name]=mle(e.name,e)),Xc[e.name]}class ble{constructor(e,t,n={}){u(this,"lock");u(this,"child");u(this,"pins");u(this,"started");this.child=e,this.pins=t,this.lock=jS({singleProcess:n.holdGcLock}),this.started=!1}isStarted(){return this.started}async start(){await Oo(this.child),this.started=!0}async stop(){await Nc(this.child),this.started=!1}unwrap(){return this.child}async put(e,t,n={}){var s;(s=n==null?void 0:n.signal)==null||s.throwIfAborted();const i=await this.lock.readLock();try{return await this.child.put(e,t,n)}finally{i()}}async*putMany(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.putMany(e,t)}finally{n()}}async get(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{return await this.child.get(e,t)}finally{n()}}async*getMany(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.getMany(e,t)}finally{n()}}async delete(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.writeLock();try{if(await this.pins.isPinned(e))throw new Error("CID was pinned");await this.child.delete(e,t)}finally{n()}}async*deleteMany(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.writeLock();try{const s=this;yield*this.child.deleteMany(async function*(){for await(const o of e){if(await s.pins.isPinned(o))throw new Error("CID was pinned");yield o}}(),t)}finally{n()}}async has(e,t={}){var i;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=await this.lock.readLock();try{return await this.child.has(e,t)}finally{n()}}async*getAll(e={}){var n;(n=e==null?void 0:e.signal)==null||n.throwIfAborted();const t=await this.lock.readLock();try{yield*this.child.getAll(e)}finally{t()}}createSession(e,t){var n;return(n=t==null?void 0:t.signal)==null||n.throwIfAborted(),this.child.createSession(e,t)}}const i5=new yt("/version"),Yk=1;async function vle(r){if(!await r.has(i5)){await r.put(i5,se(`${Yk}`));return}const e=await r.get(i5),t=re(e);if(parseInt(t,10)!==Yk)throw new Error("Unknown datastore version, a datastore migration may be required")}class Ele extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===z.array&&(t.elements++,t.elements!==1&&e.push([44])),t.type===z.map&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[z.uint.major](e,t){this.prefix(e);const n=String(t.value),i=[];for(let s=0;s<n.length;s++)i[s]=n.charCodeAt(s);e.push(i)}[z.negint.major](e,t){this[z.uint.major](e,t)}[z.bytes.major](e,t){throw new Error(`${Al} unsupported type: Uint8Array`)}[z.string.major](e,t){this.prefix(e);const n=tL(JSON.stringify(t.value));e.push(n.length>32?kE(n):n)}[z.array.major](e,t){this.prefix(e),this.inRecursive.push({type:z.array,elements:0}),e.push([91])}[z.map.major](e,t){this.prefix(e),this.inRecursive.push({type:z.map,elements:0}),e.push([123])}[z.tag.major](e,t){}[z.float.major](e,t){if(t.type.name==="break"){const o=this.inRecursive.pop();if(o){if(o.type===z.array)e.push([93]);else if(o.type===z.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${Al} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}const n=String(t.value),i=[];let s=!1;for(let o=0;o<n.length;o++)i[o]=n.charCodeAt(o),!s&&(i[o]===46||i[o]===101||i[o]===69)&&(s=!0);s||(i.push(46),i.push(48)),e.push(i)}}function Sle(r,e){if(Array.isArray(r[0])||Array.isArray(e[0]))throw new Error(`${Al} complex map keys are not supported`);const t=r[0],n=e[0];if(t.type!==z.string||n.type!==z.string)throw new Error(`${Al} non-string map keys are not supported`);if(t<n)return-1;if(t>n)return 1;throw new Error(`${Al} unexpected duplicate map keys, this is not supported`)}const xle={addBreakTokens:!0,mapSorter:Sle};function Ale(r,e){return e=Object.assign({},xle,e),hL(r,new Ele,e)}class pF{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error(`${Ce} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw new Error(`${Ce} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this._pos;let t=!1,n=!1;const i=a=>{for(;!this.done();){const c=this.ch();if(a.includes(c))this._pos++;else break}};if(this.ch()===45&&(t=!0,this._pos++),this.ch()===48)if(this._pos++,this.ch()===46)this._pos++,n=!0;else return new ne(z.uint,0,this._pos-e);if(i([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw new Error(`${Ce} unexpected token at position ${this._pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${Ce} unexpected token at position ${this._pos}`);n=!0,this._pos++,i([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this._pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this._pos++,i([48,49,50,51,52,53,54,55,56,57]));const s=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),o=parseFloat(s);return n?new ne(z.float,o,this._pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(o)?new ne(o>=0?z.uint:z.negint,o,this._pos-e):new ne(o>=0?z.uint:z.negint,BigInt(s),this._pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${Ce} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let s=this._pos,o=0;s<this.data.length&&o<65536;s++,o++){const a=this.data[s];if(a===92||a<32||a>=128)break;if(a===34){const c=String.fromCharCode.apply(null,this.data.subarray(this._pos,s));return this._pos=s+1,new ne(z.string,c,o)}}const e=this._pos,t=[],n=()=>{if(this._pos+4>=this.data.length)throw new Error(`${Ce} unexpected end of unicode escape sequence at position ${this._pos}`);let s=0;for(let o=0;o<4;o++){let a=this.ch();if(a>=48&&a<=57)a-=48;else if(a>=97&&a<=102)a=a-97+10;else if(a>=65&&a<=70)a=a-65+10;else throw new Error(`${Ce} unexpected unicode escape character at position ${this._pos}`);s=s*16+a,this._pos++}return s},i=()=>{const s=this.ch();let o=null,a=s>239?4:s>223?3:s>191?2:1;if(this._pos+a>this.data.length)throw new Error(`${Ce} unexpected unicode sequence at position ${this._pos}`);let c,l,h,d;switch(a){case 1:s<128&&(o=s);break;case 2:c=this.data[this._pos+1],(c&192)===128&&(d=(s&31)<<6|c&63,d>127&&(o=d));break;case 3:c=this.data[this._pos+1],l=this.data[this._pos+2],(c&192)===128&&(l&192)===128&&(d=(s&15)<<12|(c&63)<<6|l&63,d>2047&&(d<55296||d>57343)&&(o=d));break;case 4:c=this.data[this._pos+1],l=this.data[this._pos+2],h=this.data[this._pos+3],(c&192)===128&&(l&192)===128&&(h&192)===128&&(d=(s&15)<<18|(c&63)<<12|(l&63)<<6|h&63,d>65535&&d<1114112&&(o=d))}o===null?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|o&1023),t.push(o),this._pos+=a};for(;!this.done();){const s=this.ch();let o;switch(s){case 92:if(this._pos++,this.done())throw new Error(`${Ce} unexpected string termination at position ${this._pos}`);switch(o=this.ch(),this._pos++,o){case 34:case 39:case 92:case 47:t.push(o);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${Ce} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new ne(z.string,rL(t),this._pos-e);default:if(s<32)throw new Error(`${Ce} invalid control character at position ${this._pos}`);s<128?(t.push(s),this._pos++):i()}}throw new Error(`${Ce} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new ne(z.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new ne(z.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new ne(z.null,null,4);case 102:return this.expect([102,97,108,115,101]),new ne(z.false,!1,5);case 116:return this.expect([116,114,117,101]),new ne(z.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${Ce} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this._pos++,this.skipWhitespace(),new ne(z.break,void 0,1);if(this.ch()!==44)throw new Error(`${Ce} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this._pos++,this.skipWhitespace(),new ne(z.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new ne(z.break,void 0,1);if(this.ch()!==44)throw new Error(`${Ce} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this._pos++,this.skipWhitespace(),new ne(z.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${Ce} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${Ce} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}}function Cle(r,e){return e=Object.assign({tokenizer:new pF(r,e)},e),La(r,e)}function Ile(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function qS(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function kle(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var _le=kle,Tle=_le;let Ple=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Dle=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return gF(this,e)}},$le=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return gF(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function gF(r,e){return new $le({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Nle=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Ple(e,t,n),this.decoder=new Dle(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function yF({name:r,prefix:e,encode:t,decode:n}){return new Nle(r,e,t,n)}function vw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Tle(t,r);return yF({prefix:e,name:r,encode:n,decode:s=>qS(i(s))})}function Mle(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Ole(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function oi({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return yF({prefix:e,name:r,encode(i){return Ole(i,n,t)},decode(i){return Mle(i,n,t,r)}})}const Zg=oi({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});oi({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});oi({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});oi({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});oi({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});oi({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});oi({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});oi({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});oi({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const s5=vw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});vw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Ia=vw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});vw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Rle=mF,Xk=128,Lle=-128,Ble=Math.pow(2,31);function mF(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Ble;)e[t++]=r&255|Xk,r/=128;for(;r&Lle;)e[t++]=r&255|Xk,r>>>=7;return e[t]=r|0,mF.bytes=t-n+1,e}var Ule=Gb,Fle=128,Jk=127;function Gb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Gb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&Jk)<<i:(o&Jk)*Math.pow(2,i),i+=7}while(o>=Fle);return Gb.bytes=s-n,t}var zle=Math.pow(2,7),Vle=Math.pow(2,14),Kle=Math.pow(2,21),Hle=Math.pow(2,28),jle=Math.pow(2,35),qle=Math.pow(2,42),Wle=Math.pow(2,49),Gle=Math.pow(2,56),Qle=Math.pow(2,63),Yle=function(r){return r<zle?1:r<Vle?2:r<Kle?3:r<Hle?4:r<jle?5:r<qle?6:r<Wle?7:r<Gle?8:r<Qle?9:10},Xle={encode:Rle,decode:Ule,encodingLength:Yle},Ty=Xle;function Qb(r,e=0){return[Ty.decode(r,e),Ty.decode.bytes]}function Py(r,e,t=0){return Ty.encode(r,e,t),e}function Dy(r){return Ty.encodingLength(r)}function Jle(r,e){const t=e.byteLength,n=Dy(r),i=n+Dy(t),s=new Uint8Array(i+t);return Py(r,s,0),Py(t,s,n),s.set(e,i),new WS(r,t,e,s)}function Zle(r){const e=qS(r),[t,n]=Qb(e),[i,s]=Qb(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new WS(t,i,o,e)}function eue(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Ile(r.bytes,t.bytes)}}let WS=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function Zk(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return rue(t,Yb(r),e??Ia.encoder);default:return nue(t,Yb(r),e??Zg.encoder)}}const e_=new WeakMap;function Yb(r){const e=e_.get(r);if(e==null){const t=new Map;return e_.set(r,t),t}return e}var iN;let wF=class Rr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,iN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Cf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==iue)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Rr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Jle(e,t);return Rr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Rr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&eue(e.multihash,n.multihash)}toString(e){return Zk(this,e)}toJSON(){return{"/":Zk(this)}}link(){return this}[(iN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Rr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Rr(n,i,s,o??t_(n,i,s.bytes))}else if(t[sue]===!0){const{version:n,multihash:i,code:s}=t,o=Zle(i);return Rr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Cf)throw new Error(`Version 0 CID must use dag-pb (code: ${Cf}) block encoding`);return new Rr(e,t,n,n.bytes)}case 1:{const i=t_(e,t,n.bytes);return new Rr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Rr.create(0,Cf,e)}static createV1(e,t){return Rr.create(1,e,t)}static decode(e){const[t,n]=Rr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Rr.inspectBytes(e),n=t.size-t.multihashSize,i=qS(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new WS(t.multihashCode,t.digestSize,s,i);return[t.version===0?Rr.createV0(o):Rr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=Qb(e.subarray(t));return t+=p,d};let i=n(),s=Cf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){const[n,i]=tue(e,t),s=Rr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Yb(s).set(n,e),s}};function tue(r,e){switch(r[0]){case"Q":{const t=e??Ia;return[Ia.prefix,t.decode(`${Ia.prefix}${r}`)]}case Ia.prefix:{const t=e??Ia;return[Ia.prefix,t.decode(r)]}case Zg.prefix:{const t=e??Zg;return[Zg.prefix,t.decode(r)]}case s5.prefix:{const t=e??s5;return[s5.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function rue(r,e,t){const{prefix:n}=t;if(n!==Ia.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function nue(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Cf=112,iue=18;function t_(r,e,t){const n=Dy(r),i=n+Dy(e),s=new Uint8Array(i+t.byteLength);return Py(r,s,0),Py(e,s,n),s.set(t,i),s}const sue=Symbol.for("@ipld/js-cid/CID"),bF=oi({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});oi({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});oi({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});oi({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function oue(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function aue(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=wF.asCID(r);if(!e)return null;const t=e.toString();return[new ne(z.map,1/0,1),new ne(z.string,"/",1),new ne(z.string,t,t.length),new ne(z.break,void 0,1)]}function $y(r){const e=bF.encode(r).slice(1);return[new ne(z.map,1/0,1),new ne(z.string,"/",1),new ne(z.map,1/0,1),new ne(z.string,"bytes",5),new ne(z.string,e,e.length),new ne(z.break,void 0,1),new ne(z.break,void 0,1)]}function zi(r){return $y(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}function cue(r){return $y(new Uint8Array(r))}function lue(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function uue(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const hue={typeEncoders:{Object:aue,Buffer:$y,Uint8Array:$y,Int8Array:zi,Uint16Array:zi,Int16Array:zi,Uint32Array:zi,Int32Array:zi,Float32Array:zi,Float64Array:zi,Uint8ClampedArray:zi,BigInt64Array:zi,BigUint64Array:zi,DataView:zi,ArrayBuffer:cue,undefined:lue,number:uue}};class due extends pF{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(e.type===z.map){const t=this._next();if(t.type===z.string&&t.value==="/"){const n=this._next();if(n.type===z.string){if(this._next().type!==z.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new ne(z.tag,42,0)}if(n.type===z.map){const i=this._next();if(i.type===z.string&&i.value==="bytes"){const s=this._next();if(s.type===z.string){for(let a=0;a<2;a++)if(this._next().type!==z.break)throw new Error("Invalid encoded Bytes form");const o=bF.decode(`m${s.value}`);return new ne(z.bytes,o,s.value.length)}this.tokenBuffer.push(s)}this.tokenBuffer.push(i)}this.tokenBuffer.push(n)}this.tokenBuffer.push(t)}return e}}const Xb={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Xb.tags[42]=wF.parse;const fue="dag-json",vF=297,EF=r=>Ale(r,hue),SF=r=>{const e=oue(r),t=Object.assign(Xb,{tokenizer:new due(e,Xb)});return Cle(e,t)},r_=r=>pue.decode(EF(r)),pue=new TextDecoder,gue=r=>SF(yue.encode(r)),yue=new TextEncoder,mue=Object.freeze(Object.defineProperty({__proto__:null,code:vF,decode:SF,encode:EF,format:r_,name:fue,parse:gue,stringify:r_},Symbol.toStringTag,{value:"Module"}));function wue(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function GS(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function bue(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var vue=bue,Eue=vue;let Sue=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},xue=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return xF(this,e)}},Aue=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return xF(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function xF(r,e){return new Aue({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Cue=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Sue(e,t,n),this.decoder=new xue(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function AF({name:r,prefix:e,encode:t,decode:n}){return new Cue(r,e,t,n)}function Ew({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Eue(t,r);return AF({prefix:e,name:r,encode:n,decode:s=>GS(i(s))})}function Iue(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function kue(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Wo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return AF({prefix:e,name:r,encode(i){return kue(i,n,t)},decode(i){return Iue(i,n,t,r)}})}const e2=Wo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Wo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Wo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Wo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Wo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Wo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Wo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Wo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Wo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const o5=Ew({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Ew({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const ka=Ew({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Ew({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var _ue=CF,n_=128,Tue=-128,Pue=Math.pow(2,31);function CF(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Pue;)e[t++]=r&255|n_,r/=128;for(;r&Tue;)e[t++]=r&255|n_,r>>>=7;return e[t]=r|0,CF.bytes=t-n+1,e}var Due=Jb,$ue=128,i_=127;function Jb(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Jb.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&i_)<<i:(o&i_)*Math.pow(2,i),i+=7}while(o>=$ue);return Jb.bytes=s-n,t}var Nue=Math.pow(2,7),Mue=Math.pow(2,14),Oue=Math.pow(2,21),Rue=Math.pow(2,28),Lue=Math.pow(2,35),Bue=Math.pow(2,42),Uue=Math.pow(2,49),Fue=Math.pow(2,56),zue=Math.pow(2,63),Vue=function(r){return r<Nue?1:r<Mue?2:r<Oue?3:r<Rue?4:r<Lue?5:r<Bue?6:r<Uue?7:r<Fue?8:r<zue?9:10},Kue={encode:_ue,decode:Due,encodingLength:Vue},Ny=Kue;function Zb(r,e=0){return[Ny.decode(r,e),Ny.decode.bytes]}function My(r,e,t=0){return Ny.encode(r,e,t),e}function Oy(r){return Ny.encodingLength(r)}function Hue(r,e){const t=e.byteLength,n=Oy(r),i=n+Oy(t),s=new Uint8Array(i+t);return My(r,s,0),My(t,s,n),s.set(e,i),new QS(r,t,e,s)}function jue(r){const e=GS(r),[t,n]=Zb(e),[i,s]=Zb(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new QS(t,i,o,e)}function que(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&wue(r.bytes,t.bytes)}}let QS=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function s_(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Gue(t,ev(r),e??ka.encoder);default:return Que(t,ev(r),e??e2.encoder)}}const o_=new WeakMap;function ev(r){const e=o_.get(r);if(e==null){const t=new Map;return o_.set(r,t),t}return e}var sN;let Hf=class Lr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,sN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==If)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Yue)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Lr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Hue(e,t);return Lr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Lr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&que(e.multihash,n.multihash)}toString(e){return s_(this,e)}toJSON(){return{"/":s_(this)}}link(){return this}[(sN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Lr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Lr(n,i,s,o??a_(n,i,s.bytes))}else if(t[Xue]===!0){const{version:n,multihash:i,code:s}=t,o=jue(i);return Lr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==If)throw new Error(`Version 0 CID must use dag-pb (code: ${If}) block encoding`);return new Lr(e,t,n,n.bytes)}case 1:{const i=a_(e,t,n.bytes);return new Lr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Lr.create(0,If,e)}static createV1(e,t){return Lr.create(1,e,t)}static decode(e){const[t,n]=Lr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Lr.inspectBytes(e),n=t.size-t.multihashSize,i=GS(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new QS(t.multihashCode,t.digestSize,s,i);return[t.version===0?Lr.createV0(o):Lr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=Zb(e.subarray(t));return t+=p,d};let i=n(),s=If;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){const[n,i]=Wue(e,t),s=Lr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return ev(s).set(n,e),s}};function Wue(r,e){switch(r[0]){case"Q":{const t=e??ka;return[ka.prefix,t.decode(`${ka.prefix}${r}`)]}case ka.prefix:{const t=e??ka;return[ka.prefix,t.decode(r)]}case e2.prefix:{const t=e??e2;return[e2.prefix,t.decode(r)]}case o5.prefix:{const t=e??o5;return[o5.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Gue(r,e,t){const{prefix:n}=t;if(n!==ka.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Que(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const If=112,Yue=18;function a_(r,e,t){const n=Oy(r),i=n+Oy(e),s=new Uint8Array(i+t.byteLength);return My(r,s,0),My(e,s,n),s.set(t,i),s}const Xue=Symbol.for("@ipld/js-cid/CID"),Jue=new TextDecoder;function YS(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");const i=r[e++];if(t+=n<28?(i&127)<<n:(i&127)*2**n,i<128)break}return[t,e]}function Ry(r,e){let t;[t,e]=YS(r,e);const n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function IF(r,e){let t;return[t,e]=YS(r,e),[t&7,t>>3,e]}function Zue(r){const e={},t=r.length;let n=0;for(;n<t;){let i,s;if([i,s,n]=IF(r,n),s===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=Ry(r,n)}else if(s===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=Ry(r,n),e.Name=Jue.decode(o)}else if(s===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(i!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Tsize`);[e.Tsize,n]=YS(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${s}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function ehe(r){const e=r.length;let t=0,n,i=!1,s;for(;t<e;){let a,c;if([a,c,t]=IF(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(s)throw new Error("protobuf: (PBNode) duplicate Data section");[s,t]=Ry(r,t),n&&(i=!0)}else if(c===2){if(i)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let l;[l,t]=Ry(r,t),n.push(Zue(l))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");const o={};return s&&(o.Data=s),o.Links=n||[],o}const kF=new TextEncoder,c_=2**32,the=2**31;function rhe(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=a1(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){const n=kF.encode(r.Name);t-=n.length,e.set(n,t),t=a1(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=a1(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function nhe(r){const e=she(r),t=new Uint8Array(e);let n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=a1(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let i=r.Links.length-1;i>=0;i--){const s=rhe(r.Links[i],t.subarray(0,n));n-=s,n=a1(t,n,s)-1,t[n]=18}return t}function ihe(r){let e=0;if(r.Hash){const t=r.Hash.length;e+=1+t+bh(t)}if(typeof r.Name=="string"){const t=kF.encode(r.Name).length;e+=1+t+bh(t)}return typeof r.Tsize=="number"&&(e+=1+bh(r.Tsize)),e}function she(r){let e=0;if(r.Data){const t=r.Data.length;e+=1+t+bh(t)}if(r.Links)for(const t of r.Links){const n=ihe(t);e+=1+n+bh(n)}return e}function a1(r,e,t){e-=bh(t);const n=e;for(;t>=the;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function bh(r){return r%2===0&&r++,Math.floor((ohe(r)+6)/7)}function ohe(r){let e=0;return r>=c_&&(r=Math.floor(r/c_),e=32),r>=65536&&(r>>>=16,e+=16),r>=256&&(r>>>=8,e+=8),e+ahe[r]}const ahe=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],che=["Data","Links"],lhe=["Hash","Name","Tsize"],tv=new TextEncoder;function _F(r,e){if(r===e)return 0;const t=r.Name?tv.encode(r.Name):[],n=e.Name?tv.encode(e.Name):[];let i=t.length,s=n.length;for(let o=0,a=Math.min(i,s);o<a;++o)if(t[o]!==n[o]){i=t[o],s=n[o];break}return i<s?-1:s<i?1:0}function l_(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function TF(r){if(typeof r.asCID=="object"){const t=Hf.asCID(r);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Hash){let t=Hf.asCID(r.Hash);try{t||(typeof r.Hash=="string"?t=Hf.parse(r.Hash):r.Hash instanceof Uint8Array&&(t=Hf.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(e.Name=r.Name),typeof r.Tsize=="number"&&(e.Tsize=r.Tsize),e}function PF(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Data!==void 0)if(typeof r.Data=="string")e.Data=tv.encode(r.Data);else if(r.Data instanceof Uint8Array)e.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))e.Links=r.Links.map(TF),e.Links.sort(_F);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function DF(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!l_(r,che))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<r.Links.length;e++){const t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!l_(t,lhe))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash==null||!t.Hash["/"]||t.Hash["/"]!==t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0){if(typeof t.Tsize!="number"||t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&_F(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function uhe(r,e=[]){return PF({Data:r,Links:e})}function hhe(r,e,t){return TF({Hash:t,Name:r,Tsize:e})}function dhe(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}const fhe="dag-pb",$F=112;function phe(r){DF(r);const e={};return r.Links&&(e.Links=r.Links.map(t=>{const n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),nhe(e)}function ghe(r){const e=dhe(r),t=ehe(e),n={};return t.Data&&(n.Data=t.Data),t.Links&&(n.Links=t.Links.map(i=>{const s={};try{s.Hash=Hf.decode(i.Hash)}catch{}if(!s.Hash)throw new Error("Invalid Hash field found in link, expected CID");return i.Name!==void 0&&(s.Name=i.Name),i.Tsize!==void 0&&(s.Tsize=i.Tsize),s})),n}const yhe=Object.freeze(Object.defineProperty({__proto__:null,code:$F,createLink:hhe,createNode:uhe,decode:ghe,encode:phe,name:fhe,prepare:PF,validate:DF},Symbol.toStringTag,{value:"Module"})),mhe=new TextEncoder,whe=new TextDecoder,bhe="json",NF=512;function vhe(r){return mhe.encode(JSON.stringify(r))}function Ehe(r){return JSON.parse(whe.decode(r))}const She=Object.freeze(Object.defineProperty({__proto__:null,code:NF,decode:Ehe,encode:vhe,name:bhe},Symbol.toStringTag,{value:"Module"})),xhe="raw",MF=85;function Ahe(r){return Rd(r)}function Che(r){return Rd(r)}const Ihe=Object.freeze(Object.defineProperty({__proto__:null,code:MF,decode:Che,encode:Ahe,name:xhe},Symbol.toStringTag,{value:"Module"}));function XS(r){return(r==null?void 0:r.then)!=null}function khe(r=[],e){const t={[$F]:yhe,[MF]:Ihe,[wL]:Np,[vF]:mue,[NF]:She};return r.forEach(n=>{t[n.code]=n}),async n=>{let i=t[n];if(i==null&&e!=null){const s=e(n);XS(s)?i=await s:i=s,t[i.code]=i}if(i!=null)return i;throw new fF(`Could not load codec for ${n}`)}}const OF=0,_he="identity",RF=Rd;function The(r){return _y(OF,RF(r))}const u_={code:OF,name:_he,encode:RF,digest:The};function LF(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const h_=lF({name:"sha2-256",code:18,encode:LF("SHA-256")}),d_=lF({name:"sha2-512",code:19,encode:LF("SHA-512")});function Phe(r=[],e){const t={[h_.code]:h_,[d_.code]:d_,[u_.code]:u_};return r.forEach(n=>{t[n.code]=n}),async n=>{let i=t[n];if(i==null&&e!=null){const s=e(n);XS(s)?i=await s:i=s,t[i.code]=i}if(i!=null)return i;throw new dF(`No hasher configured for multihash code 0x${n.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)}}const ih=class ih extends Error{constructor(t="Not Found"){super(t);u(this,"name",ih.name);u(this,"code",ih.code)}};u(ih,"name","NotFoundError"),u(ih,"code","ERR_NOT_FOUND");let X1=ih;class BF{has(e,t){return Promise.reject(new Error(".has is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}async*putMany(e,t){for await(const{cid:n,block:i}of e)await this.put(n,i,t),yield n}get(e,t){return Promise.reject(new Error(".get is not implemented"))}async*getMany(e,t){for await(const n of e)yield{cid:n,block:await this.get(n,t)}}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(e,t){for await(const n of e)await this.delete(n,t),yield n}async*getAll(e){throw new Error(".getAll is not implemented")}}const ig=0;class Dhe extends BF{constructor(t){super();u(this,"child");this.child=t}put(t,n){return t.multihash.code===ig||this.child==null?t:this.child.put(t,n)}get(t){if(t.multihash.code===ig)return t.multihash.digest;if(this.child==null)throw new X1;return this.child.get(t)}has(t){return t.multihash.code===ig?!0:this.child==null?!1:this.child.has(t)}delete(t){if(t.code!==ig&&this.child!=null)return this.child.delete(t)}getAll(t){return this.child!=null?this.child.getAll(t):[]}}function $he(r){return r[Symbol.asyncIterator]!=null}function rl(r,e){let t=0;if($he(r))return async function*(){for await(const c of r)await e(c,t++)&&(yield c)}();const n=MS(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof o.then=="function")return async function*(){await o&&(yield i);for await(const c of n)await e(c,t++)&&(yield c)}();const a=e;return function*(){o===!0&&(yield i);for(const c of n)a(c,t++)&&(yield c)}()}function Nhe(r){return r[Symbol.asyncIterator]!=null}function f_(r){return(r==null?void 0:r.then)!=null}function Ly(r,e){let t=0;if(Nhe(r))return async function*(){for await(const c of r){const l=e(c,t++);f_(l)&&await l,yield c}}();const n=MS(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof(o==null?void 0:o.then)=="function")return async function*(){yield i;for await(const c of n){const l=e(c,t++);f_(l)&&await l,yield c}}();const a=e;return function*(){yield i;for(const c of n)a(c,t++),yield c}()}class UF{constructor(e){u(this,"child");u(this,"getHasher");u(this,"log");u(this,"logger");u(this,"components");this.log=e.logger.forComponent("helia:networked-storage"),this.logger=e.logger,this.components=e,this.child=new Dhe(e.blockstore),this.getHasher=e.getHasher}async put(e,t,n={}){var i,s,o;return await this.child.has(e,n)?((i=n.onProgress)==null||i.call(n,new Ie("blocks:put:duplicate",e)),e):((s=n.onProgress)==null||s.call(n,new Ie("blocks:put:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async a=>{var c;return(c=a.announce)==null?void 0:c.call(a,e,t,n)})),(o=n.onProgress)==null||o.call(n,new Ie("blocks:put:blockstore:put",e)),this.child.put(e,t,n))}async*putMany(e,t={}){var s;const n=rl(e,async({cid:o})=>{var c;const a=await this.child.has(o,t);return a&&((c=t.onProgress)==null||c.call(t,new Ie("blocks:put-many:duplicate",o))),!a}),i=Ly(n,async({cid:o,block:a})=>{var c;(c=t.onProgress)==null||c.call(t,new Ie("blocks:put-many:providers:notify",o)),await Promise.all(this.components.blockBrokers.map(async l=>{var h;return(h=l.announce)==null?void 0:h.call(l,o,a,t)}))});(s=t.onProgress)==null||s.call(t,new Ie("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(i,t)}async get(e,t={}){var n,i,s,o;if(t.offline!==!0&&!await this.child.has(e,t)){const a=await this.getHasher(e.multihash.code);(n=t.onProgress)==null||n.call(t,new Ie("blocks:get:providers:get",e));const c=await p_(e,this.components.blockBrokers,a,{...t,log:this.log});return(i=t.onProgress)==null||i.call(t,new Ie("blocks:get:blockstore:put",e)),await this.child.put(e,c,t),(s=t.onProgress)==null||s.call(t,new Ie("blocks:get:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async l=>{var h;return(h=l.announce)==null?void 0:h.call(l,e,c,t)})),c}return(o=t.onProgress)==null||o.call(t,new Ie("blocks:get:blockstore:get",e)),this.child.get(e,t)}async*getMany(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new Ie("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(Ly(e,async i=>{var s,o,a;if(t.offline!==!0&&!await this.child.has(i,t)){const c=await this.getHasher(i.multihash.code);(s=t.onProgress)==null||s.call(t,new Ie("blocks:get-many:providers:get",i));const l=await p_(i,this.components.blockBrokers,c,{...t,log:this.log});(o=t.onProgress)==null||o.call(t,new Ie("blocks:get-many:blockstore:put",i)),await this.child.put(i,l,t),(a=t.onProgress)==null||a.call(t,new Ie("blocks:get-many:providers:notify",i)),await Promise.all(this.components.blockBrokers.map(async h=>{var d;return(d=h.announce)==null?void 0:d.call(h,i,l,t)}))}}))}async delete(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new Ie("blocks:delete:blockstore:delete",e)),await this.child.delete(e,t)}async*deleteMany(e,t={}){var n;(n=t.onProgress)==null||n.call(t,new Ie("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(const i of e)yield i}(),t)}async has(e,t={}){return this.child.has(e,t)}async*getAll(e={}){var t;(t=e.onProgress)==null||t.call(e,new Ie("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(e)}}class Mhe extends UF{constructor(t){super(t);u(this,"started");this.started=!1}isStarted(){return this.started}async start(){await Oo(this.child,...this.components.blockBrokers),this.started=!0}async stop(){await Nc(this.child,...this.components.blockBrokers),this.started=!1}unwrap(){return this.child}createSession(t,n){const i=this.components.blockBrokers.map(s=>s.createSession==null?s:s.createSession(n));return new Ohe({blockstore:this.child,blockBrokers:i,getHasher:this.getHasher,logger:this.logger},{root:t})}}class Ohe extends UF{constructor(t,n){super(t);u(this,"closeController");this.closeController=new AbortController,this.closeController.signal,this.log=t.logger.forComponent(`helia:session-storage:${n.root}`)}close(){this.closeController.abort()}async put(t,n,i={}){const s=ct([this.closeController.signal,i.signal]);try{return await super.put(t,n,{...i,signal:s})}finally{s.clear()}}async*putMany(t,n={}){const i=ct([this.closeController.signal,n.signal]);try{yield*super.putMany(t,{...n,signal:i})}finally{i.clear()}}async get(t,n={}){const i=ct([this.closeController.signal,n.signal]);try{return await super.get(t,{...n,signal:i})}finally{i.clear()}}async*getMany(t,n={}){const i=ct([this.closeController.signal,n.signal]);try{yield*super.getMany(t,{...n,signal:i})}finally{i.clear()}}async delete(t,n={}){const i=ct([this.closeController.signal,n.signal]);try{await super.delete(t,{...n,signal:i})}finally{i.clear()}}async*deleteMany(t,n={}){const i=ct([this.closeController.signal,n.signal]);try{yield*super.deleteMany(t,{...n,signal:i})}finally{i.clear()}}async has(t,n={}){const i=ct([this.closeController.signal,n.signal]);try{return await super.has(t,{...n,signal:i})}finally{i.clear()}}async*getAll(t={}){const n=ct([this.closeController.signal,t.signal]);try{yield*super.getAll({...t,signal:n})}finally{n.clear()}}}function Rhe(r){return typeof r.retrieve=="function"}const Lhe=(r,e)=>{if(e==null)throw new Z(`No hasher configured for multihash code 0x${r.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`);return async t=>{let n;const i=e.digest(t);if(XS(i)?n=await i:n=i,!Ke(n.digest,r.multihash.digest))throw new ew("Hash of downloaded block did not match multihash from passed CID")}};async function p_(r,e,t,n){const i=Lhe(r,t),s=new AbortController,o=ct([s.signal,n.signal]);s.signal;const a=[];for(const c of e)Rhe(c)&&a.push(c);try{return await Promise.any(a.map(async c=>{try{let l=!1;const h=await c.retrieve(r,{...n,signal:o,validateFn:async d=>{await i(d),l=!0}});return l||await i(h),h}catch(l){throw n.log.error("could not retrieve verified block for %c",r,l),l}}))}finally{s.abort(),o.clear()}}const Bhe=si({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});si({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});si({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});si({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});class FF extends Yt{constructor(t,n){super();u(this,"initialPeerSearchComplete");u(this,"requests");u(this,"name");u(this,"log");u(this,"logger");u(this,"minProviders");u(this,"maxProviders");u(this,"providers");u(this,"evictionFilter");this.name=n.name,this.logger=t.logger,this.log=t.logger.forComponent(this.name),this.requests=new Map,this.minProviders=n.minProviders??ule,this.maxProviders=n.maxProviders??hle,this.providers=[],this.evictionFilter=jl(this.maxProviders)}async retrieve(t,n={}){const i=Bhe.encode(t.multihash.bytes),s=this.requests.get(i);if(s!=null)return this.log("join existing request for %c",t),s;const o=Oe();if(this.requests.set(i,o.promise),this.providers.length===0){let h=!1;this.initialPeerSearchComplete==null&&(h=!0,this.log=this.logger.forComponent(`${this.name}:${t}`),this.initialPeerSearchComplete=this.findProviders(t,this.minProviders,n)),await this.initialPeerSearchComplete,h&&this.log("found initial session peers for %c",t)}let a=!1;const c=new Hl({concurrency:this.maxProviders});c.addEventListener("error",()=>{}),c.addEventListener("failure",h=>{this.log.error("error querying provider %o, evicting from session",h.detail.job.options.provider,h.detail.error),this.evict(h.detail.job.options.provider)}),c.addEventListener("success",h=>{a=!0,o.resolve(h.detail.result)}),c.addEventListener("idle",()=>{var h;a||((h=n.signal)==null?void 0:h.aborted)===!0||Promise.resolve().then(async()=>{this.log("no session peers had block for for %c, finding new providers",t);for(let d=0;d<this.minProviders&&this.providers.length!==0;d++){const p=this.providers[Math.floor(Math.random()*this.providers.length)];this.evict(p)}await this.findProviders(t,this.minProviders,n),this.log("found new providers re-retrieving %c",t),this.requests.delete(i),o.resolve(await this.retrieve(t,n))}).catch(d=>{this.log.error("could not find new providers for %c",t,d),o.reject(d)})});const l=h=>{c.add(async()=>this.queryProvider(t,h.detail,n),{provider:h.detail}).catch(d=>{var p;((p=n.signal)==null?void 0:p.aborted)!==!0&&this.log.error("error retrieving session block for %c",t,d)})};this.addEventListener("provider",l),Promise.all([...this.providers].map(async h=>c.add(async()=>this.queryProvider(t,h,n),{provider:h}))).catch(h=>{var d;((d=n.signal)==null?void 0:d.aborted)!==!0&&this.log.error("error retrieving session block for %c",t,h)});try{return await o.promise}finally{this.removeEventListener("provider",l),c.clear(),this.requests.delete(i)}}evict(t){this.evictionFilter.add(this.toEvictionKey(t));const n=this.providers.findIndex(i=>this.equals(i,t));n!==-1&&this.providers.splice(n,1)}isEvicted(t){return this.evictionFilter.has(this.toEvictionKey(t))}hasProvider(t){return!!(this.providers.find(n=>this.equals(n,t))!=null||this.isEvicted(t))}async findProviders(t,n,i){const s=Oe();let o=0;return Promise.resolve().then(async()=>{var a;this.log("finding %d-%d new provider(s) for %c",n,this.maxProviders,t);for await(const c of this.findNewProviders(t,i)){if(o===this.maxProviders||((a=i.signal)==null?void 0:a.aborted)===!0)break;if(!this.hasProvider(c)&&(this.log("found %d/%d new providers",o,this.maxProviders),this.providers.push(c),this.safeDispatchEvent("provider",{detail:c}),o++,o===n&&(this.log("session is ready"),s.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",o);break}}if(this.log("found %d/%d new session peers",o,this.maxProviders),o<n)throw new hF(`Found ${o} of ${n} ${this.name} providers for ${t}`)}).catch(a=>{this.log.error("error searching routing for potential session peers for %c",t,a.errors??a),s.reject(a)}),s.promise}}class Uhe{constructor(e){u(this,"blockstore");u(this,"datastore");u(this,"pins");u(this,"logger");u(this,"routing");u(this,"getCodec");u(this,"getHasher");u(this,"dns");u(this,"metrics");u(this,"log");this.logger=e.logger??ww(),this.log=this.logger.forComponent("helia"),this.getHasher=Phe(e.hashers,e.loadHasher),this.getCodec=khe(e.codecs,e.loadCodec),this.dns=e.dns??iF(),this.metrics=e.metrics;const t={blockstore:e.blockstore,datastore:e.datastore,logger:this.logger,blockBrokers:[],getHasher:this.getHasher,getCodec:this.getCodec,dns:this.dns,metrics:this.metrics,...e.components??{}};this.routing=t.routing=new fle(t,{routers:(e.routers??[]).flatMap(i=>{const s=[i];return i[Vh]!=null&&s.push(i[Vh]),i[Kh]!=null&&s.push(i[Kh]),s}),providerLookupConcurrency:e.providerLookupConcurrency});const n=new Mhe(t);this.pins=new lle(e.datastore,n,this.getCodec),this.blockstore=new ble(n,this.pins,{holdGcLock:e.holdGcLock??!0}),this.datastore=e.datastore,t.blockBrokers=e.blockBrokers.map(i=>i(t))}async start(){await vle(this.datastore),await Oo(this.blockstore,this.datastore,this.routing)}async stop(){await Nc(this.blockstore,this.datastore,this.routing)}async gc(e={}){const t=await this.blockstore.lock.writeLock();try{const n=this,i=this.blockstore.unwrap();this.log("gc start"),await Mo(i.deleteMany(async function*(){var s,o;for await(const{cid:a}of i.getAll())try{if(await n.pins.isPinned(a,e))continue;yield a,(s=e.onProgress)==null||s.call(e,new Ie("helia:gc:deleted",a))}catch(c){n.log.error("Error during gc",c),(o=e.onProgress)==null||o.call(e,new Ie("helia:gc:error",c))}}()))}finally{t()}this.log("gc finished")}}class Fhe extends FF{constructor(t,n){super(t,{...n,name:"helia:bitswap:session"});u(this,"wantList");u(this,"network");this.wantList=t.wantList,this.network=t.network}async queryProvider(t,n,i){this.log("sending WANT-BLOCK for %c to %p",t,n);const s=await this.wantList.wantSessionBlock(t,n,i);if(this.log("%p %s %c",n,s.has?"has":"does not have",t),s.has&&s.block!=null)return s.block;throw new Error("Provider did not have block")}async*findNewProviders(t,n={}){for await(const i of this.network.findProviders(t,n))yield i.id}toEvictionKey(t){return t.toMultihash().bytes}equals(t,n){return t.equals(n)}}function zhe(r,e){return new Fhe(r,e)}class Vhe{constructor(e){u(this,"blocksReceived");u(this,"duplicateBlocksReceived");u(this,"dataReceived");u(this,"duplicateDataReceived");var t,n,i,s;this.blocksReceived=(t=e.metrics)==null?void 0:t.registerMetricGroup("helia_bitswap_received_blocks"),this.duplicateBlocksReceived=(n=e.metrics)==null?void 0:n.registerMetricGroup("helia_bitswap_duplicate_received_blocks"),this.dataReceived=(i=e.metrics)==null?void 0:i.registerMetricGroup("helia_bitswap_data_received_bytes"),this.duplicateDataReceived=(s=e.metrics)==null?void 0:s.registerMetricGroup("helia_bitswap_duplicate_data_received_bytes")}updateBlocksReceived(e=1,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.blocksReceived)==null||i.increment(n)}updateDuplicateBlocksReceived(e=1,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.duplicateBlocksReceived)==null||i.increment(n)}updateDataReceived(e,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.dataReceived)==null||i.increment(n)}updateDuplicateDataReceived(e,t){var i;const n={global:e};t!=null&&(n[t.toString()]=e),(i=this.duplicateDataReceived)==null||i.increment(n)}}class Khe extends Map{constructor(t){super();u(this,"metric");const{name:n,metrics:i}=t;this.metric=i.registerMetric(n),this.updateComponentMetric()}set(t,n){return super.set(t,n),this.updateComponentMetric(),this}delete(t){const n=super.delete(t);return this.updateComponentMetric(),n}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function zF(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new Khe({name:e,metrics:t}):n=new Map,n}function Hhe({name:r,code:e,encode:t}){return new jhe(r,e,t)}let jhe=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Bb(this.code,t):t.then(n=>Bb(this.code,n))}else throw Error("Unknown type, must be binary type")}};function qhe(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const g_=Hhe({name:"sha2-256",code:18,encode:qhe("SHA-256")});function Whe(r){if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");const e=[];for(;r.length>0;){const t=hs(r);e.push(t),r=r.slice(dt(t))}return e}class Ghe extends Yt{constructor(t,n={}){super();u(this,"peers");u(this,"wants");u(this,"network");u(this,"log");u(this,"sendMessagesDelay");u(this,"sendMessagesTimeout");u(this,"hashLoader");u(this,"sendingMessages");this.peers=WU({name:"helia_bitswap_peers",metrics:t.metrics}),this.wants=zF({name:"helia_bitswap_wantlist",metrics:t.metrics}),this.network=t.network,this.sendMessagesDelay=n.sendMessagesDelay??ase,this.log=t.logger.forComponent("helia:bitswap:wantlist"),this.hashLoader=n.hashLoader,this.network.addEventListener("bitswap:message",i=>{this.receiveMessage(i.detail.peer,i.detail.message).catch(s=>{this.log.error("error receiving bitswap message from %p",i.detail.peer,s)})}),this.network.addEventListener("peer:connected",i=>{this.peerConnected(i.detail).catch(s=>{this.log.error("error processing newly connected bitswap peer %p",i.detail,s)})}),this.network.addEventListener("peer:disconnected",i=>{this.peerDisconnected(i.detail)})}async addEntry(t,n){var o;const i=re(t.multihash.bytes,"base64");let s=this.wants.get(i);s==null&&(s={cid:t,priority:n.priority??1,wantType:n.wantType??sr.WantBlock,cancel:!1,sendDontHave:!0},this.wants.set(i,s)),s.wantType===sr.WantHave&&n.wantType===sr.WantBlock&&(s.wantType=sr.WantBlock),await this.sendMessagesDebounced();try{return n.wantType===sr.WantBlock?(await xi(this,"block",n==null?void 0:n.signal,{filter:l=>Ke(t.multihash.digest,l.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail:(await xi(this,"presence",n==null?void 0:n.signal,{filter:c=>Ke(t.multihash.digest,c.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail}finally{((o=n.signal)==null?void 0:o.aborted)===!0&&(this.log("want for %c was aborted, cancelling want",t),s.cancel=!0,await this.sendMessagesDebounced())}}async sendMessagesDebounced(){var t;await((t=this.sendingMessages)==null?void 0:t.promise),clearTimeout(this.sendMessagesTimeout),this.sendMessagesTimeout=setTimeout(()=>{this.sendMessages().catch(n=>{this.log("error sending messages to peers",n)})},this.sendMessagesDelay)}async sendMessages(){this.sendingMessages=Oe(),await Promise.all([...this.peers.entries()].map(async([t,n])=>{const i=new Set,s=new Vf;for(const[o,a]of this.wants.entries())n.has(o)||a.cancel||(i.add(o),s.addWantlistEntry(a.cid,{cid:a.cid.bytes,priority:a.priority,wantType:a.wantType,cancel:a.cancel,sendDontHave:a.sendDontHave}));if(s.wantlist.size!==0)try{await this.network.sendMessage(t,s);for(const o of i)n.add(o)}catch(o){this.log.error("error sending full wantlist to new peer",o)}})).catch(t=>{this.log.error("error sending messages",t)});for(const[t,n]of this.wants)if(n.cancel){this.wants.delete(t);for(const i of this.peers.values())i.delete(t)}this.sendingMessages.resolve()}has(t){const n=re(t.multihash.bytes,"base64");return this.wants.has(n)}async wantSessionPresence(t,n,i={}){const s=new Vf;return s.addWantlistEntry(t,{cid:t.bytes,sendDontHave:!0,wantType:sr.WantHave,priority:1}),await this.network.sendMessage(n,s),(await xi(this,"presence",i.signal,{filter:a=>n.equals(a.detail.sender)&&Ke(t.multihash.digest,a.detail.cid.multihash.digest)})).detail}async wantBlock(t,n={}){return this.addEntry(t,{...n,wantType:sr.WantBlock})}async wantSessionBlock(t,n,i={}){const s=new Vf;return s.addWantlistEntry(t,{cid:t.bytes,sendDontHave:!0,wantType:sr.WantBlock,priority:1}),await this.network.sendMessage(n,s),(await xi(this,"presence",i.signal,{filter:a=>n.equals(a.detail.sender)&&Ke(t.multihash.digest,a.detail.cid.multihash.digest)})).detail}async receivedBlock(t,n){const i=re(t.multihash.bytes,"base64"),s=this.wants.get(i);s!=null&&(s.cancel=!0,await this.sendMessagesDebounced())}async receiveMessage(t,n){var s;this.log("received message from %p with %d blocks",t,n.blocks.length);let i=!1;for(const o of n.blocks){if(o.prefix==null||o.data==null)continue;const a=Whe(o.prefix),c=a[0],l=a[1],h=a[2],d=h===g_.code?g_:await((s=this.hashLoader)==null?void 0:s.getHasher(h));if(d==null){this.log.error("unknown hash algorithm",h);continue}let p=d.digest(o.data);p.then!=null&&(p=await p);const m=Fb.create(c===0?0:1,l,p);this.log("received block from %p for %c",t,m),this.safeDispatchEvent("block",{detail:{sender:t,cid:m,block:o.data}}),this.safeDispatchEvent("presence",{detail:{sender:t,cid:m,has:!0,block:o.data}});const f=re(m.multihash.bytes,"base64"),g=this.wants.get(f);g!=null&&(g.cancel=!0,i=!0)}for(const{cid:o,type:a}of n.blockPresences){const c=Fb.decode(o);this.log("received %s from %p for %c",a,t,c),this.safeDispatchEvent("presence",{detail:{sender:t,cid:c,has:a===Ls.HaveBlock}})}i&&await this.sendMessagesDebounced()}async peerConnected(t){const n=new Set,i=new Vf(!0);for(const[s,o]of this.wants.entries())o.cancel||(n.add(s),i.addWantlistEntry(o.cid,{cid:o.cid.bytes,priority:1,wantType:sr.WantBlock,cancel:!1,sendDontHave:!1}));if(i.wantlist.size===0){this.peers.set(t,n);return}try{await this.network.sendMessage(t,i),this.peers.set(t,n)}catch(s){this.log.error("error sending full wantlist to new peer %p",t,s)}}peerDisconnected(t){this.peers.delete(t)}start(){}stop(){this.peers.clear(),clearTimeout(this.sendMessagesTimeout)}}class Qhe{constructor(e,t={}){u(this,"log");u(this,"logger");u(this,"stats");u(this,"network");u(this,"blockstore");u(this,"peerWantLists");u(this,"wantList");this.logger=e.logger,this.log=e.logger.forComponent("helia:bitswap"),this.blockstore=e.blockstore,this.stats=new Vhe(e),this.network=new bse(e,t),this.peerWantLists=new Rae({...e,network:this.network},t),this.wantList=new Ghe({...e,network:this.network},t)}createSession(e={}){return zhe({wantList:this.wantList,network:this.network,logger:this.logger},e)}async want(e,t={}){const n=new AbortController,i=ct([n.signal,t.signal]);n.signal,this.network.findAndConnect(e,{...t,signal:i}).catch(s=>{n.signal.aborted||this.log.error("error during finding and connect for cid %c",e,s)});try{return(await this.wantList.wantBlock(e,{...t,signal:i})).block}finally{n.abort(),i.clear()}}async notify(e,t,n={}){await Promise.all([this.peerWantLists.receivedBlock(e,n),this.wantList.receivedBlock(e,n)])}getWantlist(){return[...this.wantList.wants.values()].filter(e=>!e.cancel).map(e=>({cid:e.cid,priority:e.priority,wantType:e.wantType}))}getPeerWantlist(e){return this.peerWantLists.wantListForPeer(e)}async start(){this.wantList.start(),await this.network.start()}async stop(){this.wantList.stop(),await this.network.stop()}}const Yhe=(r,e={})=>new Qhe(r,e);class Xhe{constructor(e,t={}){u(this,"bitswap");u(this,"started");const{getHasher:n}=e;this.bitswap=Yhe(e,{hashLoader:{getHasher:async i=>n(i)},...t}),this.started=!1}isStarted(){return this.started}async start(){await this.bitswap.start(),this.started=!0}async stop(){await this.bitswap.stop(),this.started=!1}async announce(e,t,n){await this.bitswap.notify(e,t,n)}async retrieve(e,t={}){return this.bitswap.want(e,t)}createSession(e){const t=this.bitswap.createSession(e);return{announce:async(n,i,s)=>{await this.bitswap.notify(n,i,s)},retrieve:async(n,i)=>t.retrieve(n,i)}}}function Jhe(r={}){return e=>new Xhe(e,r)}class Zhe{constructor(){u(this,"index",0);u(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,i){return this.readAtomically(()=>{let s=0,o=0;const a=this.peekChar();if(a===void 0)return;const c=a==="0",l=2**(8*i)-1;for(;;){const h=this.readAtomically(()=>{const d=this.readChar();if(d===void 0)return;const p=Number.parseInt(d,e);if(!Number.isNaN(p))return p});if(h===void 0)break;if(s*=e,s+=h,s>l||(o+=1,t!==void 0&&o>t))return}if(o!==0)return!n&&c&&o>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){const e=t=>{for(let n=0;n<t.length/2;n++){const i=n*2;if(n<t.length-3){const o=this.readSeparator(":",n,()=>this.readIPv4Addr());if(o!==void 0)return t[i]=o[0],t[i+1]=o[1],t[i+2]=o[2],t[i+3]=o[3],[i+4,!0]}const s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[i,!1];t[i]=s>>8,t[i+1]=s&255}return[t.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[n,i]=e(t);if(n===16)return t;if(i||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const s=new Uint8Array(14),o=16-(n+2),[a]=e(s.subarray(0,o));return t.set(s.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const VF=45,ede=15,ed=new Zhe;function KF(r){if(!(r.length>ede))return ed.new(r).parseWith(()=>ed.readIPv4Addr())}function HF(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>VF))return ed.new(r).parseWith(()=>ed.readIPv6Addr())}function By(r,e=!1){if(r.includes("%")&&(r=r.split("%")[0]),r.length>VF)return;const t=ed.new(r).parseWith(()=>ed.readIPAddr());if(t)return e&&t.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,t[0],t[1],t[2],t[3]]):t}function td(r){return!!KF(r)}function JS(r){return!!HF(r)}function jF(r){return!!By(r)}var qF;(function(){var r,e,t,n,i,s,o,a;a=function(c){var l,h,d,p;return l=(c&255<<24)>>>24,h=(c&255<<16)>>>16,d=(c&65280)>>>8,p=c&255,[l,h,d,p].join(".")},o=function(c){var l,h,d,p,m,f;for(l=[],d=p=0;p<=3&&c.length!==0;d=++p){if(d>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}f=e(c),m=f[0],h=f[1],c=c.substring(h),l.push(m)}if(c.length!==0)throw new Error("Invalid IP");switch(l.length){case 1:if(l[0]>4294967295)throw new Error("Invalid IP");return l[0]>>>0;case 2:if(l[0]>255||l[1]>16777215)throw new Error("Invalid IP");return(l[0]<<24|l[1])>>>0;case 3:if(l[0]>255||l[1]>255||l[2]>65535)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2])>>>0;case 4:if(l[0]>255||l[1]>255||l[2]>255||l[3]>255)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2]<<8|l[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},n=t("0"),s=t("a"),i=t("A"),e=function(c){var l,h,d,p,m;for(p=0,l=10,h="9",d=0,c.length>1&&c[d]==="0"&&(c[d+1]==="x"||c[d+1]==="X"?(d+=2,l=16):"0"<=c[d+1]&&c[d+1]<="9"&&(d++,l=8,h="7")),m=d;d<c.length;){if("0"<=c[d]&&c[d]<=h)p=p*l+(t(c[d])-n)>>>0;else if(l===16)if("a"<=c[d]&&c[d]<="f")p=p*l+(10+t(c[d])-s)>>>0;else if("A"<=c[d]&&c[d]<="F")p=p*l+(10+t(c[d])-i)>>>0;else break;else break;if(p>4294967295)throw new Error("too large");d++}if(d===m)throw new Error("empty octet");return[p,d]},r=function(){function c(l,h){var d,p,m;if(typeof l!="string")throw new Error("Missing `net' parameter");if(h||(m=l.split("/",2),l=m[0],h=m[1]),h||(h=32),typeof h=="string"&&h.indexOf(".")>-1){try{this.maskLong=o(h)}catch{throw new Error("Invalid mask: "+h)}for(d=p=32;p>=0;d=--p)if(this.maskLong===4294967295<<32-d>>>0){this.bitmask=d;break}}else if(h||h===0)this.bitmask=parseInt(h,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(o(l)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+l)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+h);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(l){return typeof l=="string"&&(l.indexOf("/")>0||l.split(".").length!==4)&&(l=new c(l)),l instanceof c?this.contains(l.base)&&this.contains(l.broadcast||l.last):(o(l)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(l){return l==null&&(l=1),new c(a(this.netLong+this.size*l),this.mask)},c.prototype.forEach=function(l){var h,d,p;for(p=o(this.first),d=o(this.last),h=0;p<=d;)l(a(p),p,h),h++,p++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),qF=r}).call(v1);const tde=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],rde=tde.map(r=>new qF(r));function ZS(r){for(const e of rde)if(e.contains(r))return!0;return!1}function nde(r){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(r)}function ide(r){const e=r.split(":");if(e.length<2)return!1;const t=e[e.length-1].padStart(4,"0"),n=e[e.length-2].padStart(4,"0"),i=`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(t.substring(0,2),16)}.${parseInt(t.substring(2),16)}`;return ZS(i)}function sde(r){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)}function ode(r){const e=r.split(":"),t=e[e.length-1];return ZS(t)}function ade(r){return/^::$/.test(r)||/^::1$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}function Rc(r){return td(r)?ZS(r):nde(r)?ide(r):sde(r)?ode(r):JS(r)?ade(r):void 0}function cde(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function lde(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var ude=lde,hde=ude;let dde=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},fde=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return WF(this,e)}},pde=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return WF(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function WF(r,e){return new pde({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let gde=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new dde(e,t,n),this.decoder=new fde(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function GF({name:r,prefix:e,encode:t,decode:n}){return new gde(r,e,t,n)}function QF({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=hde(t,r);return GF({prefix:e,name:r,encode:n,decode:s=>cde(i(s))})}function yde(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function mde(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Sw({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return GF({prefix:e,name:r,encode(i){return mde(i,n,t)},decode(i){return yde(i,n,t,r)}})}const wde=QF({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});QF({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});Sw({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Sw({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});const bde=Sw({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});Sw({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const vde=r=>r.toString().split("/").slice(1),Kp=r=>({match:e=>e.length<1?!1:r(e[0])?e.slice(1):!1,pattern:"fn"}),Ge=r=>({match:e=>Kp(t=>t===r).match(e),pattern:r}),Ld=()=>({match:r=>Kp(e=>typeof e=="string").match(r),pattern:"{string}"}),xw=()=>({match:r=>Kp(e=>!isNaN(parseInt(e))).match(r),pattern:"{number}"}),ft=()=>({match:r=>{if(r.length<2||r[0]!=="p2p"&&r[0]!=="ipfs")return!1;if(r[1].startsWith("Q")||r[1].startsWith("1"))try{wde.decode(`z${r[1]}`)}catch{return!1}else return!1;return r.slice(2)},pattern:"/p2p/{peerid}"}),Uy=()=>({match:r=>{if(r.length<2||r[0]!=="certhash")return!1;try{bde.decode(r[1])}catch{return!1}return r.slice(2)},pattern:"/certhash/{certhash}"}),ot=r=>({match:e=>{const t=r.match(e);return t===!1?e:t},pattern:`optional(${r.pattern})`}),ln=(...r)=>({match:e=>{let t;for(const n of r){const i=n.match(e);i!==!1&&(t==null||i.length<t.length)&&(t=i)}return t??!1},pattern:`or(${r.map(e=>e.pattern).join(", ")})`}),Qe=(...r)=>({match:e=>{for(const t of r){const n=t.match(e);if(n===!1)return!1;e=n}return e},pattern:`and(${r.map(e=>e.pattern).join(", ")})`});function Et(...r){function e(i){let s=vde(i);for(const o of r){const a=o.match(s);if(a===!1)return!1;s=a}return s}function t(i){return e(i)!==!1}function n(i){const s=e(i);return s===!1?!1:s.length===0}return{matchers:r,matches:t,exactMatch:n}}const Ede=ft(),Sde=Et(Ede),Aw=Qe(Ge("dns4"),Ld()),Cw=Qe(Ge("dns6"),Ld()),Iw=Qe(Ge("dnsaddr"),Ld()),ex=Qe(Ge("dns"),Ld());Et(Aw,ot(ft()));Et(Cw,ot(ft()));Et(Iw,ot(ft()));const YF=Et(ln(ex,Iw,Aw,Cw),ot(ft())),XF=Qe(Ge("ip4"),Kp(td)),JF=Qe(Ge("ip6"),Kp(JS)),tx=ln(XF,JF),Ao=ln(tx,ex,Aw,Cw,Iw),xde=Et(ln(tx,Qe(ln(ex,Iw,Aw,Cw),ot(ft())))),y_=Et(XF),m_=Et(JF),Ade=Et(tx),rx=Qe(Ao,Ge("tcp"),xw()),Hp=Qe(Ao,Ge("udp"),xw()),Fy=Et(Qe(rx,ot(ft())));Et(Hp);const nx=Qe(Hp,Ge("quic"),ot(ft())),kw=Qe(Hp,Ge("quic-v1"),ot(ft())),Cde=ln(nx,kw);Et(nx);const Ide=Et(kw),rv=ln(Ao,rx,Hp,nx,kw),ZF=ln(Qe(rv,Ge("ws"),ot(ft()))),J1=Et(ZF),ez=ln(Qe(rv,Ge("wss"),ot(ft())),Qe(rv,Ge("tls"),ot(Qe(Ge("sni"),Ld())),Ge("ws"),ot(ft()))),zy=Et(ez),tz=Qe(Hp,Ge("webrtc-direct"),ot(Uy()),ot(Uy()),ot(ft())),nv=Et(tz),rz=Qe(kw,Ge("webtransport"),ot(Uy()),ot(Uy()),ot(ft())),w_=Et(rz),Vy=ln(ZF,ez,Qe(rx,ot(ft())),Qe(Cde,ot(ft())),Qe(Ao,ot(ft())),tz,rz,ft()),nz=Et(Vy),kde=Qe(Vy,Ge("p2p-circuit"),ft()),Sc=Et(kde),_de=ln(Qe(Vy,Ge("p2p-circuit"),Ge("webrtc"),ot(ft())),Qe(Vy,Ge("webrtc"),ot(ft())),Qe(Ge("webrtc"),ot(ft()))),iv=Et(_de),Tde=ln(Qe(Ao,Ge("tcp"),xw(),Ge("http"),ot(ft())),Qe(Ao,Ge("http"),ot(ft()))),Pde=Et(Tde),Dde=ln(Qe(Ao,Ge("tcp"),ln(Qe(Ge("443"),Ge("http")),Qe(xw(),Ge("https"))),ot(ft())),Qe(Ao,Ge("tls"),Ge("http"),ot(ft())),Qe(Ao,Ge("https"),ot(ft()))),$de=Et(Dde),Nde=ln(Qe(Ge("memory"),Ld(),ot(ft())));Et(Nde);function Mde(r,e,t){let n=0;for(const i of r)if(!(n<e)){if(n>t)break;if(i!==255)return!1;n++}return!0}function Ode(r,e,t,n){let i=0;for(const s of r)if(!(i<t)){if(i>n)break;if(s!==e[i])return!1;i++}return!0}function Rde(r){switch(r.length){case Z1:return r.join(".");case ep:{const e=[];for(let t=0;t<r.length;t++)t%2===0&&e.push(r[t].toString(16).padStart(2,"0")+r[t+1].toString(16).padStart(2,"0"));return e.join(":")}default:throw new Error("Invalid ip length")}}function Lde(r){let e=0;for(let[t,n]of r.entries()){if(n===255){e+=8;continue}for(;n&128;)e++,n=n<<1;if(n&128)return-1;for(let i=t+1;i<r.length;i++)if(r[i]!=0)return-1;break}return e}function Bde(r){let e="0x";for(const t of r)e+=(t>>4).toString(16)+(t&15).toString(16);return e}const Z1=4,ep=16,Ude=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function iz(r,e){e.length===ep&&r.length===Z1&&Mde(e,0,11)&&(e=e.slice(12)),e.length===Z1&&r.length===ep&&Ode(r,Ude,0,11)&&(r=r.slice(12));const t=r.length;if(t!=e.length)throw new Error("Failed to mask ip");const n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=r[i]&e[i];return n}function Fde(r,e){if(typeof e=="string"&&(e=By(e)),e==null)throw new Error("Invalid ip");if(e.length!==r.network.length)return!1;for(let t=0;t<e.length;t++)if((r.network[t]&r.mask[t])!==(e[t]&r.mask[t]))return!1;return!0}function zde(r){const[e,t]=r.split("/");if(!e||!t)throw new Error("Failed to parse given CIDR: "+r);let n=Z1,i=KF(e);if(i==null&&(n=ep,i=HF(e),i==null))throw new Error("Failed to parse given CIDR: "+r);const s=parseInt(t,10);if(Number.isNaN(s)||String(s).length!==t.length||s<0||s>n*8)throw new Error("Failed to parse given CIDR: "+r);const o=sz(s,8*n);return{network:iz(i,o),mask:o}}function sz(r,e){if(e!==8*Z1&&e!==8*ep)throw new Error("Invalid CIDR mask");if(r<0||r>e)throw new Error("Invalid CIDR mask");const t=e/8,n=new Uint8Array(t);for(let i=0;i<t;i++){if(r>=8){n[i]=255,r-=8;continue}n[i]=255-(255>>r),r=0}return n}class oz{constructor(e,t){if(t==null)({network:this.network,mask:this.mask}=zde(e));else{const n=By(e);if(n==null)throw new Error("Failed to parse network");t=String(t);const i=parseInt(t,10);if(Number.isNaN(i)||String(i).length!==t.length||i<0||i>n.length*8){const s=By(t);if(s==null)throw new Error("Failed to parse mask");this.mask=s}else this.mask=sz(i,8*n.length);this.network=iz(n,this.mask)}}contains(e){return Fde({network:this.network,mask:this.mask},e)}toString(){const e=Lde(this.mask),t=e!==-1?String(e):Bde(this.mask);return Rde(this.network)+"/"+t}}function Vde(r,e){return new oz(r).contains(e)}function Kde(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function ix(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Hde(r){return new TextEncoder().encode(r)}function jde(r){return new TextDecoder().decode(r)}function qde(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var Wde=qde,Gde=Wde;let Qde=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Yde=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return az(this,e)}},Xde=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return az(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function az(r,e){return new Xde({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Jde=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Qde(e,t,n),this.decoder=new Yde(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function _w({name:r,prefix:e,encode:t,decode:n}){return new Jde(r,e,t,n)}function jp({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Gde(t,r);return _w({prefix:e,name:r,encode:n,decode:s=>ix(i(s))})}function Zde(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function efe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Cr({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return _w({prefix:e,name:r,encode(i){return efe(i,n,t)},decode(i){return Zde(i,n,t,r)}})}const Dl=Cr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),tfe=Cr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),rfe=Cr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),nfe=Cr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ife=Cr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),sfe=Cr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ofe=Cr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),afe=Cr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),cfe=Cr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),lfe=Object.freeze(Object.defineProperty({__proto__:null,base32:Dl,base32hex:ife,base32hexpad:ofe,base32hexpadupper:afe,base32hexupper:sfe,base32pad:rfe,base32padupper:nfe,base32upper:tfe,base32z:cfe},Symbol.toStringTag,{value:"Module"})),Ji=jp({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ufe=jp({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),hfe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Ji,base58flickr:ufe},Symbol.toStringTag,{value:"Module"})),dfe=jp({prefix:"9",name:"base10",alphabet:"0123456789"}),ffe=Object.freeze(Object.defineProperty({__proto__:null,base10:dfe},Symbol.toStringTag,{value:"Module"})),pfe=Cr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),gfe=Cr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),yfe=Object.freeze(Object.defineProperty({__proto__:null,base16:pfe,base16upper:gfe},Symbol.toStringTag,{value:"Module"})),mfe=Cr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),wfe=Object.freeze(Object.defineProperty({__proto__:null,base2:mfe},Symbol.toStringTag,{value:"Module"})),cz=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),bfe=cz.reduce((r,e,t)=>(r[t]=e,r),[]),vfe=cz.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function Efe(r){return r.reduce((e,t)=>(e+=bfe[t],e),"")}function Sfe(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const i=vfe[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const xfe=_w({prefix:"🚀",name:"base256emoji",encode:Efe,decode:Sfe}),Afe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:xfe},Symbol.toStringTag,{value:"Module"})),t2=jp({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Cfe=jp({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Ife=Object.freeze(Object.defineProperty({__proto__:null,base36:t2,base36upper:Cfe},Symbol.toStringTag,{value:"Module"})),kfe=Cr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),_fe=Cr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Tfe=Cr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Pfe=Cr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Dfe=Object.freeze(Object.defineProperty({__proto__:null,base64:kfe,base64pad:_fe,base64url:Tfe,base64urlpad:Pfe},Symbol.toStringTag,{value:"Module"})),$fe=Cr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Nfe=Object.freeze(Object.defineProperty({__proto__:null,base8:$fe},Symbol.toStringTag,{value:"Module"})),Mfe=_w({prefix:"\0",name:"identity",encode:r=>jde(r),decode:r=>Hde(r)}),Ofe=Object.freeze(Object.defineProperty({__proto__:null,identity:Mfe},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;var Rfe=lz,b_=128,Lfe=-128,Bfe=Math.pow(2,31);function lz(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Bfe;)e[t++]=r&255|b_,r/=128;for(;r&Lfe;)e[t++]=r&255|b_,r>>>=7;return e[t]=r|0,lz.bytes=t-n+1,e}var Ufe=sv,Ffe=128,v_=127;function sv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw sv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&v_)<<i:(o&v_)*Math.pow(2,i),i+=7}while(o>=Ffe);return sv.bytes=s-n,t}var zfe=Math.pow(2,7),Vfe=Math.pow(2,14),Kfe=Math.pow(2,21),Hfe=Math.pow(2,28),jfe=Math.pow(2,35),qfe=Math.pow(2,42),Wfe=Math.pow(2,49),Gfe=Math.pow(2,56),Qfe=Math.pow(2,63),Yfe=function(r){return r<zfe?1:r<Vfe?2:r<Kfe?3:r<Hfe?4:r<jfe?5:r<qfe?6:r<Wfe?7:r<Gfe?8:r<Qfe?9:10},Xfe={encode:Rfe,decode:Ufe,encodingLength:Yfe},Ky=Xfe;function ov(r,e=0){return[Ky.decode(r,e),Ky.decode.bytes]}function Hy(r,e,t=0){return Ky.encode(r,e,t),e}function jy(r){return Ky.encodingLength(r)}function Jfe(r,e){const t=e.byteLength,n=jy(r),i=n+jy(t),s=new Uint8Array(i+t);return Hy(r,s,0),Hy(t,s,n),s.set(e,i),new sx(r,t,e,s)}function uz(r){const e=ix(r),[t,n]=ov(e),[i,s]=ov(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new sx(t,i,o,e)}function Zfe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Kde(r.bytes,t.bytes)}}let sx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function E_(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return t1e(t,av(r),e??Ji.encoder);default:return r1e(t,av(r),e??Dl.encoder)}}const S_=new WeakMap;function av(r){const e=S_.get(r);if(e==null){const t=new Map;return S_.set(r,t),t}return e}var oN;let hz=class Br{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,oN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==kf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==n1e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Br.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Jfe(e,t);return Br.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Br.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Zfe(e.multihash,n.multihash)}toString(e){return E_(this,e)}toJSON(){return{"/":E_(this)}}link(){return this}[(oN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Br)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Br(n,i,s,o??x_(n,i,s.bytes))}else if(t[i1e]===!0){const{version:n,multihash:i,code:s}=t,o=uz(i);return Br.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==kf)throw new Error(`Version 0 CID must use dag-pb (code: ${kf}) block encoding`);return new Br(e,t,n,n.bytes)}case 1:{const i=x_(e,t,n.bytes);return new Br(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Br.create(0,kf,e)}static createV1(e,t){return Br.create(1,e,t)}static decode(e){const[t,n]=Br.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Br.inspectBytes(e),n=t.size-t.multihashSize,i=ix(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new sx(t.multihashCode,t.digestSize,s,i);return[t.version===0?Br.createV0(o):Br.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=ov(e.subarray(t));return t+=p,d};let i=n(),s=kf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){const[n,i]=e1e(e,t),s=Br.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return av(s).set(n,e),s}};function e1e(r,e){switch(r[0]){case"Q":{const t=e??Ji;return[Ji.prefix,t.decode(`${Ji.prefix}${r}`)]}case Ji.prefix:{const t=e??Ji;return[Ji.prefix,t.decode(r)]}case Dl.prefix:{const t=e??Dl;return[Dl.prefix,t.decode(r)]}case t2.prefix:{const t=e??t2;return[t2.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function t1e(r,e,t){const{prefix:n}=t;if(n!==Ji.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function r1e(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const kf=112,n1e=18;function x_(r,e,t){const n=jy(r),i=n+jy(e),s=new Uint8Array(i+t.byteLength);return Hy(r,s,0),Hy(e,s,n),s.set(t,i),s}const i1e=Symbol.for("@ipld/js-cid/CID"),s1e={...Ofe,...wfe,...Nfe,...ffe,...yfe,...lfe,...Ife,...hfe,...Dfe,...Afe},A_=td,o1e=JS,dz=function(r){let e=0;if(r=r.toString().trim(),A_(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(o1e(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const s=A_(t[n]);let o;s&&(o=dz(t[n]),t[n]=re(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,re(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const s=[n,1];for(n=9-t.length;n>0;n--)s.push("0");t.splice.apply(t,s)}const i=new Uint8Array(e+16);for(n=0;n<t.length;n++){const s=parseInt(t[n],16);i[e++]=s>>8&255,i[e++]=s&255}return i}throw new Error("invalid ip address")},a1e=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const i=[];for(let s=0;s<t;s++)i.push(r[e+s]);return i.join(".")}if(t===16){const i=[];for(let s=0;s<t;s+=2)i.push(n.getUint16(e+s).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Ln=-1,tp={},cv={},c1e=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Ln,"ip6zone"],[43,8,"ipcidr"],[53,Ln,"dns",!0],[54,Ln,"dns4",!0],[55,Ln,"dns6",!0],[56,Ln,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Ln,"unix",!1,!0],[421,Ln,"ipfs"],[421,Ln,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Ln,"garlic64"],[448,0,"tls"],[449,Ln,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Ln,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,Ln,"http-path"],[777,Ln,"memory"]];c1e.forEach(r=>{const e=l1e(...r);cv[e.code]=e,tp[e.name]=e});function l1e(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:!!n,path:!!i}}function Ue(r){if(typeof r=="number"){if(cv[r]!=null)return cv[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(tp[r]!=null)return tp[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}const u1e=Ue("ip4"),h1e=Ue("ip6"),d1e=Ue("ipcidr");function ox(r,e){switch(Ue(r).code){case 4:case 41:return g1e(e);case 42:return l5(e);case 43:return re(e,"base10");case 6:case 273:case 33:case 132:return fz(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return l5(e);case 421:return b1e(e);case 444:return k_(e);case 445:return k_(e);case 466:return w1e(e);case 481:return globalThis.encodeURIComponent(l5(e));default:return re(e,"base16")}}function C_(r,e){switch(Ue(r).code){case 4:return I_(e);case 41:return I_(e);case 42:return c5(e);case 43:return se(e,"base10");case 6:case 273:case 33:case 132:return ax(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return c5(e);case 421:return y1e(e);case 444:return v1e(e);case 445:return E1e(e);case 466:return m1e(e);case 481:return c5(globalThis.decodeURIComponent(e));default:return se(e,"base16")}}function f1e(r){let e,t;if(r.stringTuples().forEach(([n,i])=>{(n===u1e.code||n===h1e.code)&&(t=i),n===d1e.code&&(e=i)}),e==null||t==null)throw new Error("Invalid multiaddr");return new oz(t,e)}const a5=Object.values(s1e).map(r=>r.decoder),p1e=function(){let r=a5[0].or(a5[1]);return a5.slice(2).forEach(e=>r=r.or(e)),r}();function I_(r){if(!jF(r))throw new Error("invalid ip address");return dz(r)}function g1e(r){const e=a1e(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!jF(e))throw new Error("invalid ip address");return e}function ax(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function fz(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function c5(r){const e=se(r),t=Uint8Array.from(br(e.length));return er([t,e],t.length+e.length)}function l5(r){const e=hs(r);if(r=r.slice(dt(e)),r.length!==e)throw new Error("inconsistent lengths");return re(r)}function y1e(r){let e;r[0]==="Q"||r[0]==="1"?e=uz(Ji.decode(`z${r}`)).bytes:e=hz.parse(r).multihash.bytes;const t=Uint8Array.from(br(e.length));return er([t,e],t.length+e.length)}function m1e(r){const e=p1e.decode(r),t=Uint8Array.from(br(e.length));return er([t,e],t.length+e.length)}function w1e(r){const e=hs(r),t=r.slice(dt(e));if(t.length!==e)throw new Error("inconsistent lengths");return"u"+re(t,"base64url")}function b1e(r){const e=hs(r),t=r.slice(dt(e));if(t.length!==e)throw new Error("inconsistent lengths");return re(t,"base58btc")}function v1e(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Dl.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=ax(n);return er([t,i],t.length+i.length)}function E1e(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=Dl.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=ax(n);return er([t,i],t.length+i.length)}function k_(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=re(e,"base32"),i=fz(t);return`${n}:${i}`}function S1e(r){r=lv(r);const e=[],t=[];let n=null;const i=r.split("/").slice(1);if(i.length===1&&i[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<i.length;s++){const o=i[s],a=Ue(o);if(a.size===0){e.push([a.code]),t.push([a.code]);continue}if(s++,s>=i.length)throw new cx("invalid address: "+r);if(a.path===!0){n=lv(i.slice(s).join("/")),e.push([a.code,C_(a.code,n)]),t.push([a.code,n]);break}const c=C_(a.code,i[s]);e.push([a.code,c]),t.push([a.code,ox(a.code,c)])}return{string:pz(t),bytes:gz(e),tuples:e,stringTuples:t,path:n}}function __(r){const e=[],t=[];let n=null,i=0;for(;i<r.length;){const s=hs(r,i),o=dt(s),a=Ue(s),c=x1e(a,r.slice(i+o));if(c===0){e.push([s]),t.push([s]),i+=o;continue}const l=r.slice(i+o,i+o+c);if(i+=c+o,i>r.length)throw new cx("Invalid address Uint8Array: "+re(r,"base16"));e.push([s,l]);const h=ox(s,l);if(t.push([s,h]),a.path===!0){n=h;break}}return{bytes:Uint8Array.from(r),string:pz(t),tuples:e,stringTuples:t,path:n}}function pz(r){const e=[];return r.map(t=>{const n=Ue(t[0]);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),lv(e.join("/"))}function gz(r){return er(r.map(e=>{const t=Ue(e[0]);let n=Uint8Array.from(br(t.code));return e.length>1&&e[1]!=null&&(n=er([n,e[1]])),n}))}function x1e(r,e){if(r.size>0)return r.size/8;if(r.size===0)return 0;{const t=hs(e instanceof Uint8Array?e:Uint8Array.from(e));return t+dt(t)}}function lv(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}class cx extends Error{constructor(t){super(`Error parsing address: ${t}`);u(this,"name","ParseError")}}u(cx,"name","ParseError");const A1e=Symbol.for("nodejs.util.inspect.custom"),yz=Symbol.for("@multiformats/js-multiaddr/multiaddr"),C1e=[Ue("dns").code,Ue("dns4").code,Ue("dns6").code,Ue("dnsaddr").code];class I1e extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}var aN,_h,za,Sp,xp;const sh=class sh{constructor(e){u(this,"bytes");qe(this,_h);qe(this,za);qe(this,Sp);qe(this,xp);u(this,aN,!0);e==null&&(e="");let t;if(e instanceof Uint8Array)t=__(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=S1e(e)}else if(Tw(e))t=__(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,gt(this,_h,t.string),gt(this,za,t.tuples),gt(this,Sp,t.stringTuples),gt(this,xp,t.path)}toString(){return ie(this,_h)}toJSON(){return this.toString()}toOptions(){let e,t,n,i,s="";const o=Ue("tcp"),a=Ue("udp"),c=Ue("ip4"),l=Ue("ip6"),h=Ue("dns6"),d=Ue("ip6zone");for(const[m,f]of this.stringTuples())m===d.code&&(s=`%${f??""}`),C1e.includes(m)&&(t=o.name==="tcp"?"tcp":"udp",i=443,n=`${f??""}${s}`,e=m===h.code?6:4),(m===o.code||m===a.code)&&(t=Ue(m).name==="tcp"?"tcp":"udp",i=parseInt(f??"")),(m===c.code||m===l.code)&&(t=Ue(m).name==="tcp"?"tcp":"udp",n=`${f??""}${s}`,e=m===l.code?6:4);if(e==null||t==null||n==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:i}}protos(){return ie(this,za).map(([e])=>Object.assign({},Ue(e)))}protoCodes(){return ie(this,za).map(([e])=>e)}protoNames(){return ie(this,za).map(([e])=>Ue(e).name)}tuples(){return ie(this,za).map(([e,t])=>t==null?[e]:[e,t])}stringTuples(){return ie(this,Sp).map(([e,t])=>t==null?[e]:[e,t])}encapsulate(e){return e=new sh(e),new sh(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new sh(n.slice(0,i))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new sh(gz(t.slice(0,n)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([n,i])=>{n===tp.p2p.code&&e.push([n,i]),n===tp["p2p-circuit"].code&&(e=[])});const t=e.pop();if((t==null?void 0:t[1])!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?re(Ji.decode(`z${n}`),"base58btc"):re(hz.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return ie(this,xp)}equals(e){return Ke(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(s=>s.resolvable);if(t==null)return[this];const n=lx.get(t.name);if(n==null)throw new I1e(`no available resolver for ${t.name}`);return(await n(this,e)).map(s=>$e(s))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(aN=yz,A1e)](){return`Multiaddr(${ie(this,_h)})`}};_h=new WeakMap,za=new WeakMap,Sp=new WeakMap,xp=new WeakMap;let uv=sh;const lx=new Map;function Tw(r){return!!(r!=null&&r[yz])}function $e(r){return new uv(r)}const k1e=[Ue("tcp").code,Ue("dns").code,Ue("dnsaddr").code,Ue("dns4").code,Ue("dns6").code];function T_(r){var e;return(e=mz("sni",r))==null?void 0:e[1]}function P_(r){var t;const e=(t=mz("tcp",r))==null?void 0:t[1];return e==null?"":`:${e}`}function mz(r,e){let t;try{t=Ue(r).code}catch{return}for(const[n,i]of e)if(n===t&&i!=null)return[n,i]}function D_(r){return r.some(([e,t])=>e===Ue("tls").code)}function Vi(r,e,t){const n=wz[Ue(r).name];if(n==null)throw new Error(`Can't interpret protocol ${Ue(r).name}`);const i=n(e,t);return r===Ue("ip6").code?`[${i}]`:i}const wz={ip4:(r,e)=>r,ip6:(r,e)=>e.length===0?r:`[${r}]`,tcp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`tcp://${Vi(t[0],t[1]??"",e)}:${r}`},udp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`udp://${Vi(t[0],t[1]??"",e)}:${r}`},dnsaddr:(r,e)=>r,dns4:(r,e)=>r,dns6:(r,e)=>r,dns:(r,e)=>r,ipfs:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${Vi(t[0],t[1]??"",e)}`},p2p:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${Vi(t[0],t[1]??"",e)}`},http:(r,e)=>{const t=D_(e),n=T_(e),i=P_(e);if(t&&n!=null)return`https://${n}${i}`;const s=t?"https://":"http://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=Vi(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${s}${a}`},"http-path":(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");const n=Vi(t[0],t[1]??"",e),i=decodeURIComponent(r);return`${n}/${i}`},tls:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return Vi(t[0],t[1]??"",e)},sni:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return Vi(t[0],t[1]??"",e)},https:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=Vi(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`https://${n}`},ws:(r,e)=>{const t=D_(e),n=T_(e),i=P_(e);if(t&&n!=null)return`wss://${n}${i}`;const s=t?"wss://":"ws://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=Vi(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${s}${a}`},wss:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=Vi(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`wss://${n}`}};function bz(r,e){const n=$e(r).stringTuples(),i=n.pop();if(i==null)throw new Error("Unexpected end of multiaddr");const s=Ue(i[0]),o=wz[s.name];if(o==null)throw new Error(`No interpreter found for ${s.name}`);let a=o(i[1]??"",n);return k1e.includes(i[0])&&(a=a.replace(/^.*:\/\//,""),i[1]==="443"?a=`https://${a}`:a=`http://${a}`),(a.startsWith("http://")||a.startsWith("https://")||a.startsWith("ws://")||a.startsWith("wss://"))&&(a=new URL(a).toString(),a.endsWith("/")&&(a=a.substring(0,a.length-1))),a}let _1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},T1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return vz(this,e)}},P1e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return vz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function vz(r,e){return new P1e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let D1e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new _1e(e,t,n),this.decoder=new T1e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function $1e({name:r,prefix:e,encode:t,decode:n}){return new D1e(r,e,t,n)}function N1e(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function M1e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Pw({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return $1e({prefix:e,name:r,encode(i){return M1e(i,n,t)},decode(i){return N1e(i,n,t,r)}})}const O1e=Pw({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Pw({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});Pw({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});Pw({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var bl,vl,Th,Ph,El,p3,Ez;class R1e{constructor(e,{logger:t,transformRequestInit:n}){qe(this,p3);u(this,"url");qe(this,bl,0);qe(this,vl,0);qe(this,Th,0);qe(this,Ph,0);qe(this,El,new Map);u(this,"log");u(this,"transformRequestInit");this.url=e instanceof URL?e:new URL(e),this.transformRequestInit=n,this.log=t.forComponent(`helia:trustless-gateway-block-broker:${this.url.hostname}`)}async getRawBlock(e,t){const n=new URL(this.url.toString());if(n.pathname=`/ipfs/${e.toString()}`,n.search="?format=raw",(t==null?void 0:t.aborted)===!0)throw new Error(`Signal to fetch raw block for CID ${e} from gateway ${this.url} was aborted prior to fetch`);const i=Ae(this,p3,Ez).call(this,e),s=new AbortController,o=()=>{s.abort()};t==null||t.addEventListener("abort",o);try{let a=ie(this,El).get(i);if(a==null){gs(this,bl)._++;const c={signal:s.signal,headers:{Accept:"application/vnd.ipld.raw"},cache:"force-cache"},l=this.transformRequestInit!=null?await this.transformRequestInit(c):c;a=fetch(n.toString(),l).then(async h=>{if(this.log("GET %s %d",n,h.status),!h.ok)throw gs(this,vl)._++,new Error(`unable to fetch raw block for CID ${e} from gateway ${this.url}`);return gs(this,Ph)._++,new Uint8Array(await h.arrayBuffer())}),ie(this,El).set(i,a)}return await a}catch{throw(t==null?void 0:t.aborted)===!0?new Error(`fetching raw block for CID ${e} from gateway ${this.url} was aborted`):(gs(this,vl)._++,new Error(`unable to fetch raw block for CID ${e}`))}finally{t==null||t.removeEventListener("abort",o),ie(this,El).delete(i)}}reliability(){return ie(this,bl)===0?1:ie(this,Th)>0?-1/0:ie(this,Ph)/(ie(this,bl)+ie(this,vl)*3)}incrementInvalidBlocks(){gs(this,Th)._++}getStats(){return{attempts:ie(this,bl),errors:ie(this,vl),invalidBlocks:ie(this,Th),successes:ie(this,Ph),pendingResponses:ie(this,El).size}}}bl=new WeakMap,vl=new WeakMap,Th=new WeakMap,Ph=new WeakMap,El=new WeakMap,p3=new WeakSet,Ez=function(e){const t=e.multihash.bytes;return O1e.encode(t)};function L1e(r,e,t){return r.filter(n=>{if($de.matches(n)||e&&Pde.matches(n))return t||YF.matches(n)?!0:Rc(n.toOptions().host)===!1;if(!e&&t){const{host:i}=n.toOptions();if(i==="127.0.0.1"||i==="localhost"||i.endsWith(".localhost"))return!0}return!1})}async function*Sz(r,e,t,n,i,s={}){for await(const o of e.findProviders(r,s)){const a=L1e(o.multiaddrs,n,i);if(a.length===0)continue;const c=bz(a[0]);yield new R1e(c,{logger:t,transformRequestInit:s.transformRequestInit})}}class B1e extends FF{constructor(t,n){super(t,{...n,name:"helia:trustless-gateway:session"});u(this,"routing");u(this,"allowInsecure");u(this,"allowLocal");u(this,"transformRequestInit");this.routing=t.routing,this.allowInsecure=n.allowInsecure??xz,this.allowLocal=n.allowLocal??Az,this.transformRequestInit=n.transformRequestInit}async queryProvider(t,n,i){var o;this.log("fetching BLOCK for %c from %s",t,n.url);const s=await n.getRawBlock(t,i.signal);return this.log.trace("got block for %c from %s",t,n.url),await((o=i.validateFn)==null?void 0:o.call(i,s)),s}async*findNewProviders(t,n={}){yield*Sz(t,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...n,transformRequestInit:this.transformRequestInit})}toEvictionKey(t){return t.url.toString()}equals(t,n){return t.url.toString()===n.url.toString()}}function U1e(r,e){return new B1e(r,e)}class F1e{constructor(e,t={}){u(this,"allowInsecure");u(this,"allowLocal");u(this,"transformRequestInit");u(this,"routing");u(this,"log");u(this,"logger");this.log=e.logger.forComponent("helia:trustless-gateway-block-broker"),this.logger=e.logger,this.routing=e.routing,this.allowInsecure=t.allowInsecure??xz,this.allowLocal=t.allowLocal??Az,this.transformRequestInit=t.transformRequestInit}async retrieve(e,t={}){var i,s;const n=[];for await(const o of Sz(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...t,transformRequestInit:this.transformRequestInit})){this.log("getting block for %c from %s",e,o.url);try{const a=await o.getRawBlock(e,t.signal);this.log.trace("got block for %c from %s",e,o.url);try{await((i=t.validateFn)==null?void 0:i.call(t,a))}catch(c){this.log.error("failed to validate block for %c from %s",e,o.url,c);continue}return a}catch(a){if(this.log.error("failed to get block for %c from %s",e,o.url,a),a instanceof Error?n.push(a):n.push(new Error(`Unable to fetch raw block for CID ${e} from gateway ${o.url}`)),((s=t.signal)==null?void 0:s.aborted)===!0){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",e,o.url);break}}}throw n.length>0?new AggregateError(n,`Unable to fetch raw block for CID ${e} from any gateway`):new Error(`Unable to fetch raw block for CID ${e} from any gateway`)}createSession(e={}){return U1e({logger:this.logger,routing:this.routing},{...e,allowLocal:this.allowLocal,allowInsecure:this.allowInsecure,transformRequestInit:this.transformRequestInit})}}const xz=!1,Az=!1;function z1e(r={}){return e=>new F1e(e,r)}async function*$_(r,e={}){const t=r.getReader();try{for(;;){const n=await t.read();if(n.done)return;yield n.value}}finally{e.preventCancel!==!0&&await t.cancel(),t.releaseLock()}}var Cz={exports:{}};(function(r){(function(){r.exports=v;var e=86400,t=3200,n=146097*t/400,i=e*n,s=1e3*i,o=864e13,a=4294967296,c=1e6,l="000000000",h=Math.trunc||function(T){var L=T-T%1;return L==0&&(T<0||T===0&&1/T!=1/0)?-0:L},d=v.prototype,p=(v.fromDate=function(T){return new v(+T)},v.fromInt64BE=C(0,1,2,3,0,4),v.fromInt64LE=C(3,2,1,0,4,0),v.fromString=function(U){var L,V=new v,U=(U+="").replace(/^\s*[+\-]?\d+/,function(K){var K=+K,q=1970+(K-1970)%400;return V.year=K-q,q}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(G,K,q){return K<0&&(q*=-1),L=6e4*(60*+K+ +q),""}).replace(/\.\d+$/,function(G){return V.nano=+(G+l).substr(1,9),""}).split(/\D+/);if(1<U.length?U[1]--:U[1]=0,V.time=L=Date.UTC.apply(Date,U)-(L||0),isNaN(L))throw new TypeError("Invalid Date");return y(V)},v.fromTimeT=function(T){return b(T,0)},d.year=0,d.time=0,d.nano=0,d.addNano=function(T){return this.nano+=+T||0,this},d.getNano=function(){var T=y(this);return(T.time%1e3*c+ +T.nano+1e9)%1e9},d.getTimeT=function(){var L=y(this),T=Math.floor(L.time/1e3),L=L.year;return L&&(T+=L*n*e/t),T},d.getYear=function(){return this.toDate().getUTCFullYear()+this.year},d.toDate=function(){return w(y(this).time)},d.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},d.toString=function(T){var L=this,V=L.toDate(),U={H:function(){return x(V.getUTCHours())},L:function(){return I(V.getUTCMilliseconds(),3)},M:function(){return x(V.getUTCMinutes())},N:function(){return I(L.getNano(),9)},S:function(){return x(V.getUTCSeconds())},Y:function(){var G=L.getYear();return 999999<G?"+"+G:9999<G?"+"+I(G,6):0<=G?I(G,4):-999999<=G?"-"+I(-G,6):G},a:function(){return f[V.getUTCDay()]},b:function(){return m[V.getUTCMonth()]},d:function(){return x(V.getUTCDate())},e:function(){return function(G){return(9<G?"":" ")+(0|G)}(V.getUTCDate())},m:function(){return x(V.getUTCMonth()+1)}};return function G(K){return K.replace(/%./g,function(q){var H=q[1],Q=g[H],H=U[H];return Q?G(Q):H?H():q})}(T||p)},d.writeInt64BE=E(0,1,2,3,0,4),d.writeInt64LE=E(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),m=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return v;function v(T,L,V){var U=this;if(!(U instanceof v))return new v(T,L,V);U.time=+T||0,U.nano=+L||0,U.year=+V||0,y(U)}function y(T){var L,V,U,G=T.year,K=T.time,q=T.nano,Q=((q<0||c<=q)&&(q-=(V=Math.floor(q/c))*c,K+=V,V=1),G%t);return(K<-864e13||o<K||Q)&&((L=h(K/s))&&(G+=L*t,K-=L*s),(U=w(K)).setUTCFullYear(Q+U.getUTCFullYear()),U=(K=+U)+(L=h((G-=Q)/t))*s,L&&-864e13<=U&&U<=o&&(G-=L*t,K=U),V=1),V&&(T.year=G,T.time=K,T.nano=q),T}function w(T){var L=new Date(0);return L.setTime(T),L}function b(G,U){G=+G||0;var V=h((U=(U|0)*a)/i)+h(G/i),U=U%i+G%i,G=h(U/i);return G&&(V+=G,U-=G*i),new v(1e3*U,0,V*t)}function E(T,L,V,U,G,K){return function(Q,H){var B=y(this);Q=Q||new Array(8),k(Q,H|=0);var W=Math.floor(B.time/1e3),B=B.year*(n*e/t),O=h(B/a)+h(W/a),B=B%a+W%a,W=Math.floor(B/a);return W&&(O+=W,B-=W*a),q(Q,H+G,O),q(Q,H+K,B),Q};function q(Q,H,O){Q[H+T]=O>>24&255,Q[H+L]=O>>16&255,Q[H+V]=O>>8&255,Q[H+U]=255&O}}function C(T,L,V,U,G,K){return function(Q,H){k(Q,H|=0);var O=q(Q,H+G);return b(q(Q,H+K),O)};function q(Q,H){return 16777216*Q[H+T]+(Q[H+L]<<16|Q[H+V]<<8|Q[H+U])}}function k(T,L){if(T=T&&T.length,T==null)throw new TypeError("Invalid Buffer");if(T<L+8)throw new RangeError("Out of range")}function x(T){return(9<T?"":"0")+(0|T)}function I(T,L){return(l+(0|T)).substr(-L)}})()})(Cz);var V1e=Cz.exports;const hv=Vo(V1e);class Ua extends Error{constructor(e="Record signature verification failed"){super(e),this.name="SignatureVerificationError"}}u(Ua,"name","SignatureVerificationError");class Iz extends Error{constructor(e="Record has expired"){super(e),this.name="RecordExpiredError"}}u(Iz,"name","RecordExpiredError");class ux extends Error{constructor(e="The validity type is unsupported"){super(e),this.name="UnsupportedValidityError"}}u(ux,"name","UnsupportedValidityError");class kz extends Error{constructor(e="The record is too large"){super(e),this.name="RecordTooLargeError"}}u(kz,"name","RecordTooLargeError");class _z extends Error{constructor(e="Value must be a valid content path starting with /"){super(e),this.name="InvalidValueError"}}u(_z,"name","InvalidValueError");class Tz extends Error{constructor(e="Invalid record data"){super(e),this.name="InvalidRecordDataError"}}u(Tz,"name","InvalidRecordDataError");class dv extends Error{constructor(e="Invalid embedded public key"){super(e),this.name="InvalidEmbeddedPublicKeyError"}}u(dv,"name","InvalidEmbeddedPublicKeyError");var ss;(function(r){(function(n){n.EOL="EOL"})(r.ValidityType||(r.ValidityType={}));let e;(function(n){n[n.EOL=0]="EOL"})(e||(e={})),function(n){n.codec=()=>Dn(e)}(r.ValidityType||(r.ValidityType={}));let t;r.codec=()=>(t==null&&(t=Pe((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.value!=null&&(i.uint32(10),i.bytes(n.value)),n.signatureV1!=null&&(i.uint32(18),i.bytes(n.signatureV1)),n.validityType!=null&&(i.uint32(24),r.ValidityType.codec().encode(n.validityType,i)),n.validity!=null&&(i.uint32(34),i.bytes(n.validity)),n.sequence!=null&&(i.uint32(40),i.uint64(n.sequence)),n.ttl!=null&&(i.uint32(48),i.uint64(n.ttl)),n.pubKey!=null&&(i.uint32(58),i.bytes(n.pubKey)),n.signatureV2!=null&&(i.uint32(66),i.bytes(n.signatureV2)),n.data!=null&&(i.uint32(74),i.bytes(n.data)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.value=n.bytes();break}case 2:{o.signatureV1=n.bytes();break}case 3:{o.validityType=r.ValidityType.codec().decode(n);break}case 4:{o.validity=n.bytes();break}case 5:{o.sequence=n.uint64();break}case 6:{o.ttl=n.uint64();break}case 7:{o.pubKey=n.bytes();break}case 8:{o.signatureV2=n.bytes();break}case 9:{o.data=n.bytes();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>Te(n,r.codec()),r.decode=(n,i)=>_e(n,r.codec(),i)})(ss||(ss={}));function K1e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function hx(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function H1e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var j1e=H1e,q1e=j1e;let W1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},G1e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Pz(this,e)}},Q1e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return Pz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Pz(r,e){return new Q1e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Y1e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new W1e(e,t,n),this.decoder=new G1e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Dz({name:r,prefix:e,encode:t,decode:n}){return new Y1e(r,e,t,n)}function Dw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=q1e(t,r);return Dz({prefix:e,name:r,encode:n,decode:s=>hx(i(s))})}function X1e(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function J1e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Go({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return Dz({prefix:e,name:r,encode(i){return J1e(i,n,t)},decode(i){return X1e(i,n,t,r)}})}const u5=Dw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Dw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const r2=Go({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Go({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Go({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Go({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Go({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Go({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Go({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Go({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Go({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const _a=Dw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Dw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Z1e=$z,N_=128,epe=-128,tpe=Math.pow(2,31);function $z(r,e,t){e=e||[],t=t||0;for(var n=t;r>=tpe;)e[t++]=r&255|N_,r/=128;for(;r&epe;)e[t++]=r&255|N_,r>>>=7;return e[t]=r|0,$z.bytes=t-n+1,e}var rpe=fv,npe=128,M_=127;function fv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw fv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&M_)<<i:(o&M_)*Math.pow(2,i),i+=7}while(o>=npe);return fv.bytes=s-n,t}var ipe=Math.pow(2,7),spe=Math.pow(2,14),ope=Math.pow(2,21),ape=Math.pow(2,28),cpe=Math.pow(2,35),lpe=Math.pow(2,42),upe=Math.pow(2,49),hpe=Math.pow(2,56),dpe=Math.pow(2,63),fpe=function(r){return r<ipe?1:r<spe?2:r<ope?3:r<ape?4:r<cpe?5:r<lpe?6:r<upe?7:r<hpe?8:r<dpe?9:10},ppe={encode:Z1e,decode:rpe,encodingLength:fpe},qy=ppe;function pv(r,e=0){return[qy.decode(r,e),qy.decode.bytes]}function Wy(r,e,t=0){return qy.encode(r,e,t),e}function Gy(r){return qy.encodingLength(r)}function gpe(r,e){const t=e.byteLength,n=Gy(r),i=n+Gy(t),s=new Uint8Array(i+t);return Wy(r,s,0),Wy(t,s,n),s.set(e,i),new dx(r,t,e,s)}function Nz(r){const e=hx(r),[t,n]=pv(e),[i,s]=pv(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new dx(t,i,o,e)}function ype(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&K1e(r.bytes,t.bytes)}}let dx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function O_(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return wpe(t,gv(r),e??_a.encoder);default:return bpe(t,gv(r),e??r2.encoder)}}const R_=new WeakMap;function gv(r){const e=R_.get(r);if(e==null){const t=new Map;return R_.set(r,t),t}return e}var cN;let L_=class Ur{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,cN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==_f)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==vpe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Ur.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=gpe(e,t);return Ur.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Ur.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&ype(e.multihash,n.multihash)}toString(e){return O_(this,e)}toJSON(){return{"/":O_(this)}}link(){return this}[(cN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Ur)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Ur(n,i,s,o??B_(n,i,s.bytes))}else if(t[Epe]===!0){const{version:n,multihash:i,code:s}=t,o=Nz(i);return Ur.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==_f)throw new Error(`Version 0 CID must use dag-pb (code: ${_f}) block encoding`);return new Ur(e,t,n,n.bytes)}case 1:{const i=B_(e,t,n.bytes);return new Ur(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Ur.create(0,_f,e)}static createV1(e,t){return Ur.create(1,e,t)}static decode(e){const[t,n]=Ur.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Ur.inspectBytes(e),n=t.size-t.multihashSize,i=hx(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new dx(t.multihashCode,t.digestSize,s,i);return[t.version===0?Ur.createV0(o):Ur.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=pv(e.subarray(t));return t+=p,d};let i=n(),s=_f;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){const[n,i]=mpe(e,t),s=Ur.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return gv(s).set(n,e),s}};function mpe(r,e){switch(r[0]){case"Q":{const t=e??_a;return[_a.prefix,t.decode(`${_a.prefix}${r}`)]}case _a.prefix:{const t=e??_a;return[_a.prefix,t.decode(r)]}case r2.prefix:{const t=e??r2;return[r2.prefix,t.decode(r)]}case u5.prefix:{const t=e??u5;return[u5.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function wpe(r,e,t){const{prefix:n}=t;if(n!==_a.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function bpe(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const _f=112,vpe=18;function B_(r,e,t){const n=Gy(r),i=n+Gy(e),s=new Uint8Array(i+t.byteLength);return Wy(r,s,0),Wy(e,s,n),s.set(t,i),s}const Epe=Symbol.for("@ipld/js-cid/CID"),Spe=Od("ipns:utils"),Mz=se("/ipns/"),xpe=0,Ape=18;function Cpe(r){let e;if(r.pubKey!=null)try{e=$n(r.pubKey)}catch(t){throw Spe.error(t),t}if(e!=null)return e}function Ipe(r){const e=se("ipns-signature:");return er([e,r])}function Oz(r){return"signatureV1"in r?ss.encode({value:se(r.value),signatureV1:r.signatureV1,validityType:r.validityType,validity:se(r.validity),sequence:r.sequence,ttl:r.ttl,pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data}):ss.encode({pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data})}function qp(r){const e=ss.decode(r);if(e.sequence!=null&&(e.sequence=BigInt(e.sequence)),e.ttl!=null&&(e.ttl=BigInt(e.ttl)),e.signatureV2==null||e.data==null)throw new Ua("Missing data or signatureV2");const t=Lz(e.data),n=kpe(t.Value),i=re(t.Validity);if(e.value!=null&&e.signatureV1!=null)return _pe(e),{value:n,validityType:ss.ValidityType.EOL,validity:i,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV1:e.signatureV1,signatureV2:e.signatureV2,data:e.data};if(e.signatureV2!=null)return{value:n,validityType:ss.ValidityType.EOL,validity:i,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}function Rz(r){return er([Mz,r.bytes])}function yv(r){const e=Nz(r.slice(Mz.length));if(!mv(e,xpe)&&!mv(e,Ape))throw new ew("Multihash in IPNS key was not identity or sha2-256");return e}function Lz(r){const e=La(r);if(e.ValidityType===0)e.ValidityType=ss.ValidityType.EOL;else throw new ux("The validity type is unsupported");return Number.isInteger(e.Sequence)&&(e.Sequence=BigInt(e.Sequence)),Number.isInteger(e.TTL)&&(e.TTL=BigInt(e.TTL)),e}function kpe(r){const e=re(r).trim();if(e.startsWith("/"))return e;try{return`/ipfs/${L_.decode(r).toV1().toString()}`}catch{}try{return`/ipfs/${L_.parse(e).toV1().toString()}`}catch{}throw new _z("Value must be a valid content path starting with /")}function _pe(r){if(r.data==null)throw new Tz("Record data is missing");const e=Lz(r.data);if(!Ke(e.Value,r.value??new Uint8Array(0)))throw new Ua('Field "value" did not match between protobuf and CBOR');if(!Ke(e.Validity,r.validity??new Uint8Array(0)))throw new Ua('Field "validity" did not match between protobuf and CBOR');if(e.ValidityType!==r.validityType)throw new Ua('Field "validityType" did not match between protobuf and CBOR');if(e.Sequence!==r.sequence)throw new Ua('Field "sequence" did not match between protobuf and CBOR');if(e.TTL!==r.ttl)throw new Ua('Field "ttl" did not match between protobuf and CBOR')}function mv(r,e){return r.code===e}const sg=Od("ipns:validator"),Tpe=1024*10,Ppe=async(r,e)=>{const t=qp(e);let n;try{const i=Ipe(t.data);n=await r.verify(i,t.signatureV2)}catch{n=!1}if(!n)throw sg.error("record signature verification failed"),new Ua("Record signature verification failed");if(t.validityType===ss.ValidityType.EOL){if(hv.fromString(t.validity).toDate().getTime()<Date.now())throw sg.error("record has expired"),new Iz("record has expired")}else if(t.validityType!=null)throw sg.error("the validity type is unsupported"),new ux("The validity type is unsupported");sg("ipns record for %s is valid",t.value)};async function Bz(r,e){if(e.byteLength>Tpe)throw new kz("The record is too large");const t=yv(r);let n;mv(t,0)&&(n=iU(t));const i=qp(e),s=Cpe(i)??n;if(s==null)throw new dv("Could not extract public key from IPNS record or routing key");const o=Rz(s.toMultihash());if(!Ke(o,r))throw new dv("Embedded public key did not match routing key");await Ppe(s,e)}let Dpe=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MESSAGE_LENGTH")}};async function*U_(r,e={}){const t=/\r?\n/,n=new TextDecoder("utf8");let i="";for await(let s of r){if(typeof s=="string"&&(s=new TextEncoder().encode(s)),Ff(s)&&(s=s.subarray()),i+=n.decode(s,{stream:!0}),i.length>((e==null?void 0:e.maxMessageLength)??i.length))throw new Dpe("Incoming message too long");const o=i.split(t);i=o.pop()??"";for(let a=0;a<o.length;a++)yield JSON.parse(o[a])}i+=n.decode(),i!==""&&(yield JSON.parse(i))}class n2 extends Error{constructor(e="Invalid request"){super(e),this.name="InvalidRequestError"}}u(n2,"name","InvalidRequestError");class io extends Error{constructor(e="Bad response"){super(e),this.name="BadResponseError"}}u(io,"name","BadResponseError");function $pe(r){return r[Symbol.asyncIterator]!=null}function Npe(r){if($pe(r))return(async()=>{for await(const e of r)return e})();for(const e of r)return e}function Mpe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function fx(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Ope(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var Rpe=Ope,Lpe=Rpe;let Bpe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Upe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Uz(this,e)}},Fpe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return Uz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Uz(r,e){return new Fpe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let zpe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Bpe(e,t,n),this.decoder=new Upe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Fz({name:r,prefix:e,encode:t,decode:n}){return new zpe(r,e,t,n)}function $w({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Lpe(t,r);return Fz({prefix:e,name:r,encode:n,decode:s=>fx(i(s))})}function Vpe(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Kpe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Qo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return Fz({prefix:e,name:r,encode(i){return Kpe(i,n,t)},decode(i){return Vpe(i,n,t,r)}})}const i2=Qo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Qo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Qo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Qo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Qo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Qo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Qo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Qo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Qo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const h5=$w({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});$w({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Ta=$w({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});$w({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Hpe=zz,F_=128,jpe=-128,qpe=Math.pow(2,31);function zz(r,e,t){e=e||[],t=t||0;for(var n=t;r>=qpe;)e[t++]=r&255|F_,r/=128;for(;r&jpe;)e[t++]=r&255|F_,r>>>=7;return e[t]=r|0,zz.bytes=t-n+1,e}var Wpe=wv,Gpe=128,z_=127;function wv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw wv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&z_)<<i:(o&z_)*Math.pow(2,i),i+=7}while(o>=Gpe);return wv.bytes=s-n,t}var Qpe=Math.pow(2,7),Ype=Math.pow(2,14),Xpe=Math.pow(2,21),Jpe=Math.pow(2,28),Zpe=Math.pow(2,35),e0e=Math.pow(2,42),t0e=Math.pow(2,49),r0e=Math.pow(2,56),n0e=Math.pow(2,63),i0e=function(r){return r<Qpe?1:r<Ype?2:r<Xpe?3:r<Jpe?4:r<Zpe?5:r<e0e?6:r<t0e?7:r<r0e?8:r<n0e?9:10},s0e={encode:Hpe,decode:Wpe,encodingLength:i0e},Qy=s0e;function bv(r,e=0){return[Qy.decode(r,e),Qy.decode.bytes]}function Yy(r,e,t=0){return Qy.encode(r,e,t),e}function Xy(r){return Qy.encodingLength(r)}function o0e(r,e){const t=e.byteLength,n=Xy(r),i=n+Xy(t),s=new Uint8Array(i+t);return Yy(r,s,0),Yy(t,s,n),s.set(e,i),new px(r,t,e,s)}function a0e(r){const e=fx(r),[t,n]=bv(e),[i,s]=bv(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new px(t,i,o,e)}function c0e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Mpe(r.bytes,t.bytes)}}let px=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function V_(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return u0e(t,vv(r),e??Ta.encoder);default:return h0e(t,vv(r),e??i2.encoder)}}const K_=new WeakMap;function vv(r){const e=K_.get(r);if(e==null){const t=new Map;return K_.set(r,t),t}return e}var lN;let H_=class Fr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,lN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Tf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==d0e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Fr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=o0e(e,t);return Fr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Fr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&c0e(e.multihash,n.multihash)}toString(e){return V_(this,e)}toJSON(){return{"/":V_(this)}}link(){return this}[(lN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Fr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Fr(n,i,s,o??j_(n,i,s.bytes))}else if(t[f0e]===!0){const{version:n,multihash:i,code:s}=t,o=a0e(i);return Fr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Tf)throw new Error(`Version 0 CID must use dag-pb (code: ${Tf}) block encoding`);return new Fr(e,t,n,n.bytes)}case 1:{const i=j_(e,t,n.bytes);return new Fr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Fr.create(0,Tf,e)}static createV1(e,t){return Fr.create(1,e,t)}static decode(e){const[t,n]=Fr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Fr.inspectBytes(e),n=t.size-t.multihashSize,i=fx(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new px(t.multihashCode,t.digestSize,s,i);return[t.version===0?Fr.createV0(o):Fr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=bv(e.subarray(t));return t+=p,d};let i=n(),s=Tf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){const[n,i]=l0e(e,t),s=Fr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return vv(s).set(n,e),s}};function l0e(r,e){switch(r[0]){case"Q":{const t=e??Ta;return[Ta.prefix,t.decode(`${Ta.prefix}${r}`)]}case Ta.prefix:{const t=e??Ta;return[Ta.prefix,t.decode(r)]}case i2.prefix:{const t=e??i2;return[i2.prefix,t.decode(r)]}case h5.prefix:{const t=e??h5;return[h5.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function u0e(r,e,t){const{prefix:n}=t;if(n!==Ta.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function h0e(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Tf=112,d0e=18;function j_(r,e,t){const n=Xy(r),i=n+Xy(e),s=new Uint8Array(i+t.byteLength);return Yy(r,s,0),Yy(e,s,n),s.set(t,i),s}const f0e=Symbol.for("@ipld/js-cid/CID"),q_=se("/ipns/");function W_(r){return Ke(r.subarray(0,q_.byteLength),q_)}class p0e{constructor(e){u(this,"client");this.client=e}async*findProviders(e,t={}){yield*Nd(this.client.getProviders(e,t),n=>({id:n.ID,multiaddrs:n.Addrs??[]}))}async provide(){}async cancelReprovide(){}async put(e,t,n){if(!W_(e))return;const i=yv(e),s=H_.createV1(114,i),o=qp(t);await this.client.putIPNS(s,o,n)}async get(e,t){if(!W_(e))throw new Qt("Not found");const n=yv(e),i=H_.createV1(114,n);try{const s=await this.client.getIPNS(i,t);return Oz(s)}catch(s){throw s.name==="BadResponseError"?new Qt("Not found"):s}}}class g0e{constructor(e){u(this,"client");this.client=e}async findPeer(e,t={}){const n=await Npe(this.client.getPeers(e,t));if(n!=null)return{id:n.ID,multiaddrs:n.Addrs??[]};throw new Qt("Not found")}async*getClosestPeers(e,t={}){}}const nr=Od("delegated-routing-v1-http-api-client"),og={concurrentRequests:4,timeout:3e4,cacheTTL:5*60*1e3,cacheName:"delegated-routing-v1-cache"};var sn,jf,Ev,qf;class y0e{constructor(e,t={}){qe(this,sn);u(this,"started");u(this,"httpQueue");u(this,"shutDownController");u(this,"clientUrl");u(this,"timeout");u(this,"contentRouting");u(this,"peerRouting");u(this,"filterAddrs");u(this,"filterProtocols");u(this,"inFlightRequests");u(this,"cacheName");u(this,"cache");u(this,"cacheTTL");this.started=!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.httpQueue=new pc({concurrency:t.concurrentRequests??og.concurrentRequests}),this.inFlightRequests=new Map,this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=t.timeout??og.timeout,this.filterAddrs=t.filterAddrs,this.filterProtocols=t.filterProtocols,this.contentRouting=new p0e(this),this.peerRouting=new g0e(this),this.cacheName=t.cacheName??og.cacheName,this.cacheTTL=t.cacheTTL??og.cacheTTL}get[Vh](){return this.contentRouting}get[Kh](){return this.peerRouting}isStarted(){return this.started}async start(){var e;this.started||(this.started=!0,this.cacheTTL>0&&(this.cache=await((e=globalThis.caches)==null?void 0:e.open(this.cacheName)),this.cache!=null&&nr("cache enabled with ttl %d",this.cacheTTL)))}async stop(){var e;this.httpQueue.clear(),this.shutDownController.abort(),await((e=globalThis.caches)==null?void 0:e.delete(this.cacheName)),this.started=!1}async*getProviders(e,t={}){nr("getProviders starts: %c",e);const n=AbortSignal.timeout(this.timeout),i=ct([this.shutDownController.signal,n,t.signal]),s=Oe(),o=Oe();this.httpQueue.add(async()=>(s.resolve(),o.promise));try{await s.promise;const a=new URL(`${this.clientUrl}routing/v1/providers/${e.toString()}`);Ae(this,sn,Ev).call(this,a,t.filterAddrs,t.filterProtocols);const c={headers:{Accept:"application/x-ndjson"},signal:i},l=await Ae(this,sn,qf).call(this,a.toString(),c);if(l==null)throw new io("No response received");if(!l.ok)throw l.status===404?new Qt("No matching records found"):l.status===422?new n2("Request does not conform to schema or semantic constraints"):new io(`Unexpected status code: ${l.status}`);if(l.body==null)throw new io("Routing response had no body");const h=l.headers.get("Content-Type");if(h==null)throw new io("No Content-Type header received");if(h!=null&&h.startsWith("application/json")){const d=await l.json();for(const p of d.Providers){const m=Ae(this,sn,jf).call(this,p);m!=null&&(yield m)}}else if(h.includes("application/x-ndjson"))for await(const d of U_($_(l.body))){const p=Ae(this,sn,jf).call(this,d);p!=null&&(yield p)}else throw new io(`Unsupported Content-Type: ${h}`)}catch(a){nr.error("getProviders errored:",a)}finally{i.clear(),o.resolve(),nr("getProviders finished: %c",e)}}async*getPeers(e,t={}){nr("getPeers starts: %c",e);const n=AbortSignal.timeout(this.timeout),i=ct([this.shutDownController.signal,n,t.signal]),s=Oe(),o=Oe();this.httpQueue.add(async()=>(s.resolve(),o.promise));try{await s.promise;const a=new URL(`${this.clientUrl}routing/v1/peers/${e.toCID().toString()}`);Ae(this,sn,Ev).call(this,a,t.filterAddrs,t.filterProtocols);const c={headers:{Accept:"application/x-ndjson"},signal:i},l=await Ae(this,sn,qf).call(this,a.toString(),c);if(l.status===404)throw new Qt("No matching records found");if(l.status===422)throw new n2("Request does not conform to schema or semantic constraints");if(l.body==null)throw new io("Routing response had no body");if(l.headers.get("Content-Type")==="application/json"){const d=await l.json();for(const p of d.Peers){const m=Ae(this,sn,jf).call(this,p);m!=null&&(yield m)}}else for await(const d of U_($_(l.body))){const p=Ae(this,sn,jf).call(this,d);p!=null&&(yield p)}}catch(a){nr.error("getPeers errored:",a)}finally{i.clear(),o.resolve(),nr("getPeers finished: %c",e)}}async getIPNS(e,t={}){nr("getIPNS starts: %s",e);const n=AbortSignal.timeout(this.timeout),i=ct([this.shutDownController.signal,n,t.signal]),s=Oe(),o=Oe();this.httpQueue.add(async()=>(s.resolve(),o.promise));const a=`${this.clientUrl}routing/v1/ipns/${e}`;try{await s.promise;const c={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:i},l=await Ae(this,sn,qf).call(this,a,c);if(nr("getIPNS GET %s %d",a,l.status),l.status===404)throw new Qt("No matching records found");if(l.status===422)throw new n2("Request does not conform to schema or semantic constraints");if(l.body==null)throw new io("GET ipns response had no body");const h=await l.arrayBuffer(),d=new Uint8Array(h,0,h.byteLength);return t.validate!==!1&&await Bz(Rz(e.multihash),d),qp(d)}catch(c){throw nr.error("getIPNS GET %s error:",a,c),c}finally{i.clear(),o.resolve(),nr("getIPNS finished: %s",e)}}async putIPNS(e,t,n={}){nr("putIPNS starts: %c",e);const i=AbortSignal.timeout(this.timeout),s=ct([this.shutDownController.signal,i,n.signal]),o=Oe(),a=Oe();this.httpQueue.add(async()=>(o.resolve(),a.promise));const c=`${this.clientUrl}routing/v1/ipns/${e}`;try{await o.promise;const l=Oz(t),h={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:l,signal:s},d=await Ae(this,sn,qf).call(this,c,h);if(nr("putIPNS PUT %s %d",c,d.status),d.status!==200)throw new io("PUT ipns response had status other than 200")}catch(l){throw nr.error("putIPNS PUT %s error:",c,l.stack),l}finally{s.clear(),a.resolve(),nr("putIPNS finished: %c",e)}}}sn=new WeakSet,jf=function(e){var t;try{const n=[],i=((t=e.Addrs)==null?void 0:t.map($e))??[];return e.Protocols!=null&&n.push(...e.Protocols),e.Protocol!=null&&(n.push(e.Protocol),delete e.Protocol),{...e,Schema:"peer",ID:Wt(e.ID),Addrs:i,Protocols:n}}catch(n){nr.error("could not conform record to peer schema",n)}},Ev=function(e,t,n){var i,s;if(t!=null||this.filterAddrs!=null){const o=(t==null?void 0:t.join(","))??((i=this.filterAddrs)==null?void 0:i.join(","))??"";o!==""&&e.searchParams.set("filter-addrs",o)}if(n!=null||this.filterProtocols!=null){const o=(n==null?void 0:n.join(","))??((s=this.filterProtocols)==null?void 0:s.join(","))??"";o!==""&&e.searchParams.set("filter-protocols",o)}},qf=async function(e,t){var c,l;const n=t.method??"GET",i=`${n}-${e}`;if(n==="GET"){const h=await((c=this.cache)==null?void 0:c.match(e));if(h!=null){if(parseInt(h.headers.get("x-cache-expires")??"0",10)>Date.now())return nr("returning cached response for %s",i),h;await((l=this.cache)==null?void 0:l.delete(e))}}const s=this.inFlightRequests.get(i);if(s!=null){const h=await s;return nr("deduplicating outgoing request for %s",i),h.clone()}const o=fetch(e,t).then(async h=>{if(this.cache!=null&&h.ok&&n==="GET"){const d=Date.now()+this.cacheTTL,p=new Headers(h.headers);p.set("x-cache-expires",d.toString());const m=new Response(h.clone().body,{status:h.status,statusText:h.statusText,headers:p});await this.cache.put(e,m)}return h}).finally(()=>{this.inFlightRequests.delete(i)});return this.inFlightRequests.set(i,o),await o};function m0e(r,e={}){return new y0e(new URL(r),e)}function w0e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Nw(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function b0e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var v0e=b0e,E0e=v0e;let S0e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},x0e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Vz(this,e)}},A0e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return Vz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Vz(r,e){return new A0e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let C0e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new S0e(e,t,n),this.decoder=new x0e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Kz({name:r,prefix:e,encode:t,decode:n}){return new C0e(r,e,t,n)}function Mw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=E0e(t,r);return Kz({prefix:e,name:r,encode:n,decode:s=>Nw(i(s))})}function I0e(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function k0e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Yo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return Kz({prefix:e,name:r,encode(i){return k0e(i,n,t)},decode(i){return I0e(i,n,t,r)}})}const s2=Yo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Yo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Yo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Yo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Yo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Yo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Yo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Yo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Yo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const d5=Mw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Mw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Pa=Mw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Mw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var _0e=Hz,G_=128,T0e=-128,P0e=Math.pow(2,31);function Hz(r,e,t){e=e||[],t=t||0;for(var n=t;r>=P0e;)e[t++]=r&255|G_,r/=128;for(;r&T0e;)e[t++]=r&255|G_,r>>>=7;return e[t]=r|0,Hz.bytes=t-n+1,e}var D0e=Sv,$0e=128,Q_=127;function Sv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Sv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&Q_)<<i:(o&Q_)*Math.pow(2,i),i+=7}while(o>=$0e);return Sv.bytes=s-n,t}var N0e=Math.pow(2,7),M0e=Math.pow(2,14),O0e=Math.pow(2,21),R0e=Math.pow(2,28),L0e=Math.pow(2,35),B0e=Math.pow(2,42),U0e=Math.pow(2,49),F0e=Math.pow(2,56),z0e=Math.pow(2,63),V0e=function(r){return r<N0e?1:r<M0e?2:r<O0e?3:r<R0e?4:r<L0e?5:r<B0e?6:r<U0e?7:r<F0e?8:r<z0e?9:10},K0e={encode:_0e,decode:D0e,encodingLength:V0e},Jy=K0e;function xv(r,e=0){return[Jy.decode(r,e),Jy.decode.bytes]}function Zy(r,e,t=0){return Jy.encode(r,e,t),e}function em(r){return Jy.encodingLength(r)}function jz(r,e){const t=e.byteLength,n=em(r),i=n+em(t),s=new Uint8Array(i+t);return Zy(r,s,0),Zy(t,s,n),s.set(e,i),new gx(r,t,e,s)}function H0e(r){const e=Nw(r),[t,n]=xv(e),[i,s]=xv(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new gx(t,i,o,e)}function j0e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&w0e(r.bytes,t.bytes)}}let gx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function Y_(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return G0e(t,Av(r),e??Pa.encoder);default:return Q0e(t,Av(r),e??s2.encoder)}}const X_=new WeakMap;function Av(r){const e=X_.get(r);if(e==null){const t=new Map;return X_.set(r,t),t}return e}var uN;let q0e=class zr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,uN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Pf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Y0e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return zr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=jz(e,t);return zr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return zr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&j0e(e.multihash,n.multihash)}toString(e){return Y_(this,e)}toJSON(){return{"/":Y_(this)}}link(){return this}[(uN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof zr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new zr(n,i,s,o??J_(n,i,s.bytes))}else if(t[X0e]===!0){const{version:n,multihash:i,code:s}=t,o=H0e(i);return zr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Pf)throw new Error(`Version 0 CID must use dag-pb (code: ${Pf}) block encoding`);return new zr(e,t,n,n.bytes)}case 1:{const i=J_(e,t,n.bytes);return new zr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return zr.create(0,Pf,e)}static createV1(e,t){return zr.create(1,e,t)}static decode(e){const[t,n]=zr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=zr.inspectBytes(e),n=t.size-t.multihashSize,i=Nw(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new gx(t.multihashCode,t.digestSize,s,i);return[t.version===0?zr.createV0(o):zr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=xv(e.subarray(t));return t+=p,d};let i=n(),s=Pf;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){const[n,i]=W0e(e,t),s=zr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Av(s).set(n,e),s}};function W0e(r,e){switch(r[0]){case"Q":{const t=e??Pa;return[Pa.prefix,t.decode(`${Pa.prefix}${r}`)]}case Pa.prefix:{const t=e??Pa;return[Pa.prefix,t.decode(r)]}case s2.prefix:{const t=e??s2;return[s2.prefix,t.decode(r)]}case d5.prefix:{const t=e??d5;return[d5.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function G0e(r,e,t){const{prefix:n}=t;if(n!==Pa.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Q0e(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Pf=112,Y0e=18;function J_(r,e,t){const n=em(r),i=n+em(e),s=new Uint8Array(i+t.byteLength);return Zy(r,s,0),Zy(e,s,n),s.set(t,i),s}const X0e=Symbol.for("@ipld/js-cid/CID");function J0e(){return{filterProtocols:["unknown","transport-bitswap","transport-ipfs-gateway-http"],filterAddrs:["https","webtransport","webrtc","webrtc-direct","wss","tls"]}}const Z_="[a-fA-F\\d:]",ja=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${Z_})|(?<=${Z_})(?=\\s|$))`:"",Qi="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",qt="[a-fA-F\\d]{1,4}",Ow=`
(?:
(?:${qt}:){7}(?:${qt}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${qt}:){6}(?:${Qi}|:${qt}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${qt}:){5}(?::${Qi}|(?::${qt}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${qt}:){4}(?:(?::${qt}){0,1}:${Qi}|(?::${qt}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${qt}:){3}(?:(?::${qt}){0,2}:${Qi}|(?::${qt}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${qt}:){2}(?:(?::${qt}){0,3}:${Qi}|(?::${qt}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${qt}:){1}(?:(?::${qt}){0,4}:${Qi}|(?::${qt}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${qt}){0,5}:${Qi}|(?::${qt}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),Z0e=new RegExp(`(?:^${Qi}$)|(?:^${Ow}$)`),ege=new RegExp(`^${Qi}$`),tge=new RegExp(`^${Ow}$`),Rw=r=>r&&r.exact?Z0e:new RegExp(`(?:${ja(r)}${Qi}${ja(r)})|(?:${ja(r)}${Ow}${ja(r)})`,"g");Rw.v4=r=>r&&r.exact?ege:new RegExp(`${ja(r)}${Qi}${ja(r)}`,"g");Rw.v6=r=>r&&r.exact?tge:new RegExp(`${ja(r)}${Ow}${ja(r)}`,"g");function rge(r){const e=(...t)=>r(...t);return Object.defineProperty(e,"name",{value:`functionTimeout(${r.name||"<anonymous>"})`,configurable:!0}),e}const{toString:nge}=Object.prototype;function ige(r){return nge.call(r)==="[object RegExp]"}const eT={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function sge(r,e={}){if(!ige(r))throw new TypeError("Expected a RegExp instance");const t=Object.keys(eT).map(i=>(typeof e[i]=="boolean"?e[i]:r[i])?eT[i]:"").join(""),n=new RegExp(e.source||r.source,t);return n.lastIndex=typeof e.lastIndex=="number"?e.lastIndex:r.lastIndex,n}function qz(r,e,{timeout:t}={}){try{return rge(()=>sge(r).test(e),{timeout:t})()}catch(n){throw n}}const oge=15,age=45,Wz={timeout:400};function tT(r){return r.length>age?!1:qz(Rw.v6({exact:!0}),r,Wz)}function cge(r){return r.length>oge?!1:qz(Rw.v4({exact:!0}),r,Wz)}const rT={http:"80",https:"443",ws:"80",wss:"443"},lge=["http","https","ws","wss"];function uge(r,e){e=e??{};const t=e.defaultDnsType??"dns4",{scheme:n,hostname:i,port:s,path:o}=hge(r),a=[dge(i,t),fge(s,n),pge(n)];o!=null&&a.push(gge(o));const c="/"+a.filter(l=>!!l).reduce((l,h)=>l.concat(h),[]).join("/");return $e(c)}function hge(r){const[e]=r.split(":");lge.includes(e)||(r="http"+r.substring(e.length));let{protocol:t,hostname:n,port:i,pathname:s,search:o}=new URL(r);if(i==null||i===""){const c=yge(e);c!=null&&(i=c),c==null&&t==="http:"&&(i="80")}let a;return s!=null&&s!==""&&s!=="/"&&(s.startsWith("/")&&(s=s.substring(1)),a=s),o!=null&&o!==""&&(a=a??"",a+=o),{scheme:e,hostname:n,port:i,path:a}}function dge(r,e){if(!(r==null||r==="")){if(cge(r))return["ip4",r];if(tT(r))return["ip6",r];if(r[0]==="["){const t=r.substring(1,r.length-1);if(tT(t))return["ip6",t]}return[e,r]}}function fge(r,e){if(!(r==null||r===""))return e==="udp"?["udp",r]:["tcp",r]}function pge(r){if(r.match(/^tcp$|^udp$/)==null)return[r]}function gge(r){if(!(r==null||r===""))return["http-path",encodeURIComponent(r)]}function yge(r){if(!(r==null||r===""||rT[r]==null))return rT[r]}const Gz=0,mge="identity",Qz=Nw;function wge(r){return jz(Gz,Qz(r))}const bge={code:Gz,name:mge,encode:Qz,digest:wge},vge=["https://trustless-gateway.link","https://4everland.io"],Ege=2336;function Sge(r){return r=r.toString(),{id:Md(q0e.createV1(Ege,bge.digest(se(r)))),multiaddrs:[uge(r)]}}class xge{constructor(e={}){u(this,"gateways");this.gateways=(e.gateways??vge).map(t=>Sge(t))}async*findProviders(e,t){yield*this.gateways.toSorted(()=>Math.random()>.5?1:-1).map(n=>({...n,protocols:["transport-ipfs-gateway-http"]}))}}function Age(r={}){return new xge(r)}class Cge{constructor(e){u(this,"libp2p");this.libp2p=e}async provide(e,t){await this.libp2p.contentRouting.provide(e,t)}async cancelReprovide(e,t){await this.libp2p.contentRouting.cancelReprovide(e,t)}async*findProviders(e,t){yield*this.libp2p.contentRouting.findProviders(e,t)}async put(e,t,n){await this.libp2p.contentRouting.put(e,t,n)}async get(e,t){return this.libp2p.contentRouting.get(e,t)}async findPeer(e,t){return this.libp2p.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t){yield*this.libp2p.peerRouting.getClosestPeers(e,t)}}function Ige(r){return new Cge(r)}function kge(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function yx(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function _ge(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var Tge=_ge,Pge=Tge;let Dge=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},$ge=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Yz(this,e)}},Nge=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return Yz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Yz(r,e){return new Nge({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Mge=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Dge(e,t,n),this.decoder=new $ge(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Xz({name:r,prefix:e,encode:t,decode:n}){return new Mge(r,e,t,n)}function Lw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Pge(t,r);return Xz({prefix:e,name:r,encode:n,decode:s=>yx(i(s))})}function Oge(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Rge(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Xo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return Xz({prefix:e,name:r,encode(i){return Rge(i,n,t)},decode(i){return Oge(i,n,t,r)}})}const mo=Xo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Xo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Xo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Xo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Xo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Xo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Xo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Xo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Xo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const f5=Lw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Lw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const Da=Lw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Lw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Lge=Jz,nT=128,Bge=-128,Uge=Math.pow(2,31);function Jz(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Uge;)e[t++]=r&255|nT,r/=128;for(;r&Bge;)e[t++]=r&255|nT,r>>>=7;return e[t]=r|0,Jz.bytes=t-n+1,e}var Fge=Cv,zge=128,iT=127;function Cv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Cv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&iT)<<i:(o&iT)*Math.pow(2,i),i+=7}while(o>=zge);return Cv.bytes=s-n,t}var Vge=Math.pow(2,7),Kge=Math.pow(2,14),Hge=Math.pow(2,21),jge=Math.pow(2,28),qge=Math.pow(2,35),Wge=Math.pow(2,42),Gge=Math.pow(2,49),Qge=Math.pow(2,56),Yge=Math.pow(2,63),Xge=function(r){return r<Vge?1:r<Kge?2:r<Hge?3:r<jge?4:r<qge?5:r<Wge?6:r<Gge?7:r<Qge?8:r<Yge?9:10},Jge={encode:Lge,decode:Fge,encodingLength:Xge},tm=Jge;function Iv(r,e=0){return[tm.decode(r,e),tm.decode.bytes]}function rm(r,e,t=0){return tm.encode(r,e,t),e}function nm(r){return tm.encodingLength(r)}function Zge(r,e){const t=e.byteLength,n=nm(r),i=n+nm(t),s=new Uint8Array(i+t);return rm(r,s,0),rm(t,s,n),s.set(e,i),new mx(r,t,e,s)}function Zz(r){const e=yx(r),[t,n]=Iv(e),[i,s]=Iv(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new mx(t,i,o,e)}function e2e(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&kge(r.bytes,t.bytes)}}let mx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function sT(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return n2e(t,kv(r),e??Da.encoder);default:return i2e(t,kv(r),e??mo.encoder)}}const oT=new WeakMap;function kv(r){const e=oT.get(r);if(e==null){const t=new Map;return oT.set(r,t),t}return e}var hN;let t2e=class Vr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,hN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Df)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==s2e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Vr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Zge(e,t);return Vr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Vr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&e2e(e.multihash,n.multihash)}toString(e){return sT(this,e)}toJSON(){return{"/":sT(this)}}link(){return this}[(hN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Vr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Vr(n,i,s,o??aT(n,i,s.bytes))}else if(t[o2e]===!0){const{version:n,multihash:i,code:s}=t,o=Zz(i);return Vr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Df)throw new Error(`Version 0 CID must use dag-pb (code: ${Df}) block encoding`);return new Vr(e,t,n,n.bytes)}case 1:{const i=aT(e,t,n.bytes);return new Vr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Vr.create(0,Df,e)}static createV1(e,t){return Vr.create(1,e,t)}static decode(e){const[t,n]=Vr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Vr.inspectBytes(e),n=t.size-t.multihashSize,i=yx(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new mx(t.multihashCode,t.digestSize,s,i);return[t.version===0?Vr.createV0(o):Vr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=Iv(e.subarray(t));return t+=p,d};let i=n(),s=Df;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){const[n,i]=r2e(e,t),s=Vr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return kv(s).set(n,e),s}};function r2e(r,e){switch(r[0]){case"Q":{const t=e??Da;return[Da.prefix,t.decode(`${Da.prefix}${r}`)]}case Da.prefix:{const t=e??Da;return[Da.prefix,t.decode(r)]}case mo.prefix:{const t=e??mo;return[mo.prefix,t.decode(r)]}case f5.prefix:{const t=e??f5;return[f5.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function n2e(r,e,t){const{prefix:n}=t;if(n!==Da.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function i2e(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Df=112,s2e=18;function aT(r,e,t){const n=nm(r),i=n+nm(e),s=new Uint8Array(i+t.byteLength);return rm(r,s,0),rm(e,s,n),s.set(t,i),s}const o2e=Symbol.for("@ipld/js-cid/CID"),a2e=85;class c2e extends BF{constructor(){super();u(this,"data");this.data=new Map}put(t,n){return this.data.set(mo.encode(t.multihash.bytes),n),t}get(t){const n=this.data.get(mo.encode(t.multihash.bytes));if(n==null)throw new X1;return n}has(t){return this.data.has(mo.encode(t.multihash.bytes))}async delete(t){this.data.delete(mo.encode(t.multihash.bytes))}async*getAll(){for(const[t,n]of this.data.entries())yield{cid:t2e.createV1(a2e,Zz(mo.decode(t))),block:n}}}Od("blockstore:core:tiered");const l2e="SHARDING";function u2e(r){return r[Symbol.asyncIterator]!=null}function im(r){if(u2e(r))return(async()=>{const t=[];for await(const n of r)t.push(n);return t})();const e=[];for(const t of r)e.push(t);return e}function h2e(r){return r[Symbol.asyncIterator]!=null}function cT(r,e){return h2e(r)?async function*(){yield*(await im(r)).sort(e)}():function*(){yield*im(r).sort(e)}()}class d2e{put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:i}of e)await this.put(n,i,t),yield n}async*getMany(e,t={}){for await(const n of e)yield{key:n,value:await this.get(n,t)}}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await Mo(this.putMany(e,n)),e=[],await Mo(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null){const i=e.prefix;n=rl(n,s=>s.key.toString().startsWith(i))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>rl(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>cT(i,s),n)),e.offset!=null){let i=0;const s=e.offset;n=rl(n,()=>i++>=s)}return e.limit!=null&&(n=py(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null){const i=e.prefix;n=rl(n,s=>s.toString().startsWith(i))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>rl(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>cT(i,s),n)),e.offset!=null){const i=e.offset;let s=0;n=rl(n,()=>s++>=i)}return e.limit!=null&&(n=py(n,e.limit)),n}}class eV extends d2e{constructor(){super();u(this,"data");this.data=new Map}put(t,n){return this.data.set(t.toString(),n),t}get(t){const n=this.data.get(t.toString());if(n==null)throw new X1;return n}has(t){return this.data.has(t.toString())}delete(t){this.data.delete(t.toString())}*_all(){for(const[t,n]of this.data.entries())yield{key:new yt(t),value:n}}*_allKeys(){for(const t of this.data.keys())yield new yt(t)}}new yt(l2e);Od("datastore:core:tiered");class f2e extends Uhe{constructor(t){super({...t,components:{libp2p:t.libp2p}});u(this,"libp2p");this.libp2p=t.libp2p}async start(){await super.start(),await this.libp2p.start()}async stop(){await super.stop(),await this.libp2p.stop()}}let p2e=class{constructor(){u(this,"readNext");u(this,"haveNext");u(this,"ended");u(this,"nextResult");u(this,"error");this.ended=!1,this.readNext=Oe(),this.haveNext=Oe()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Oe(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Oe(),await nn(this.readNext.promise,t==null?void 0:t.signal,t)}};function g2e(){return new p2e}let y2e=class extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}};function sm(r,e){const t=g2e();r.sink(t).catch(async o=>{await t.end(o)}),r.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());const i=new Le;return{read:async o=>{var c;if((c=o==null?void 0:o.signal)==null||c.throwIfAborted(),(o==null?void 0:o.bytes)==null){const{done:l,value:h}=await nn(n.next(),o==null?void 0:o.signal);return l===!0?null:h}for(;i.byteLength<o.bytes;){const{value:l,done:h}=await nn(n.next(),o==null?void 0:o.signal);if(h===!0)throw new y2e("unexpected end of input");i.append(l)}const a=i.sublist(0,o.bytes);return i.consume(o.bytes),a},write:async(o,a)=>{var c;(c=a==null?void 0:a.signal)==null||c.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(i.byteLength>0){const o=r.source;r.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield i:yield*i,yield*o}()}return r}}}let m2e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}},w2e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}},b2e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}};function rd(r,e={}){const t=sm(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=dt(e.maxDataLength));const n=(e==null?void 0:e.lengthDecoder)??hs,i=(e==null?void 0:e.lengthEncoder)??br;return{read:async o=>{let a=-1;const c=new Le;for(;;){c.append(await t.read({...o,bytes:1}));try{a=n(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new m2e("Invalid message length");if((e==null?void 0:e.maxLengthLength)!=null&&c.byteLength>e.maxLengthLength)throw new b2e("message length length too long");if(a>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&a>e.maxDataLength)throw new w2e("message length too long");return t.read({...o,bytes:a})},write:async(o,a)=>{await t.write(new Le(i(o.byteLength),o),a)},writeV:async(o,a)=>{const c=new Le(...o.flatMap(l=>[i(l.byteLength),l]));await t.write(c,a)},unwrap:()=>t.unwrap()}}function lT(){const r=Oe();let e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,r.resolve(t)},source:async function*(){yield*await r.promise}()}}function v2e(){const r=lT(),e=lT();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}const rp=65535,uT=rp-16;var dN,fN;const Wp=!!((fN=(dN=globalThis.process)==null?void 0:dN.env)!=null&&fN.DUMP_SESSION_KEYS);function p5(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function tV(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Kn(r,...e){if(!tV(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function hT(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function E2e(r,e){Kn(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function dT(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const lc=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),S2e=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),x2e=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!x2e)throw new Error("Non little-endian hardware is not supported");function A2e(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function _v(r){if(typeof r=="string")r=A2e(r);else if(tV(r))r=Tv(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function C2e(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function I2e(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}const k2e=(r,e)=>{function t(n,...i){if(Kn(n),r.nonceLength!==void 0){const h=i[0];if(!h)throw new Error("nonce / iv required");r.varSizeNonce?Kn(h):Kn(h,r.nonceLength)}const s=r.tagLength;s&&i[1]!==void 0&&Kn(i[1]);const o=e(n,...i),a=(h,d)=>{if(d!==void 0){if(h!==2)throw new Error("cipher output not supported");Kn(d)}};let c=!1;return{encrypt(h,d){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Kn(h),a(o.encrypt.length,d),o.encrypt(h,d)},decrypt(h,d){if(Kn(h),s&&h.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,d),o.decrypt(h,d)}}}return Object.assign(t,r),t};function fT(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!_2e(e))throw new Error("invalid output, must be aligned");return e}function pT(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=4,l=0;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function _2e(r){return r.byteOffset%4===0}function Tv(r){return Uint8Array.from(r)}function nd(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}const rV=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),T2e=rV("expand 16-byte k"),P2e=rV("expand 32-byte k"),D2e=lc(T2e),$2e=lc(P2e);function Ze(r,e){return r<<e|r>>>32-e}function Pv(r){return r.byteOffset%4===0}const ag=64,N2e=16,nV=2**32-1,gT=new Uint32Array;function M2e(r,e,t,n,i,s,o,a){const c=i.length,l=new Uint8Array(ag),h=lc(l),d=Pv(i)&&Pv(s),p=d?lc(i):gT,m=d?lc(s):gT;for(let f=0;f<c;o++){if(r(e,t,n,h,o,a),o>=nV)throw new Error("arx: counter overflow");const g=Math.min(ag,c-f);if(d&&g===ag){const v=f/4;if(f%4!==0)throw new Error("arx: invalid block position");for(let y=0,w;y<N2e;y++)w=v+y,m[w]=p[w]^h[y];f+=ag;continue}for(let v=0,y;v<g;v++)y=f+v,s[y]=i[y]^l[v];f+=g}}function O2e(r,e){const{allowShortKeys:t,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=C2e({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return p5(i),p5(o),dT(s),dT(t),(a,c,l,h,d=0)=>{Kn(a),Kn(c),Kn(l);const p=l.length;if(h===void 0&&(h=new Uint8Array(p)),Kn(h),p5(d),d<0||d>=nV)throw new Error("arx: counter overflow");if(h.length<p)throw new Error(`arx: output (${h.length}) is shorter than data (${p})`);const m=[];let f=a.length,g,v;if(f===32)m.push(g=Tv(a)),v=$2e;else if(f===16&&t)g=new Uint8Array(32),g.set(a),g.set(a,16),v=D2e,m.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${f}`);Pv(c)||m.push(c=Tv(c));const y=lc(g);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(v,y,lc(c.subarray(0,16)),y),c=c.subarray(16)}const w=16-i;if(w!==c.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(w!==12){const E=new Uint8Array(12);E.set(c,s?0:12-c.length),c=E,m.push(c)}const b=lc(c);return M2e(r,v,y,b,l,h,d,o),nd(...m),h}}const hr=(r,e)=>r[e++]&255|(r[e++]&255)<<8;class R2e{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=_v(e),Kn(e,32);const t=hr(e,0),n=hr(e,2),i=hr(e,4),s=hr(e,6),o=hr(e,8),a=hr(e,10),c=hr(e,12),l=hr(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let h=0;h<8;h++)this.pad[h]=hr(e,16+2*h)}process(e,t,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],l=o[2],h=o[3],d=o[4],p=o[5],m=o[6],f=o[7],g=o[8],v=o[9],y=hr(e,t+0),w=hr(e,t+2),b=hr(e,t+4),E=hr(e,t+6),C=hr(e,t+8),k=hr(e,t+10),x=hr(e,t+12),I=hr(e,t+14);let T=s[0]+(y&8191),L=s[1]+((y>>>13|w<<3)&8191),V=s[2]+((w>>>10|b<<6)&8191),U=s[3]+((b>>>7|E<<9)&8191),G=s[4]+((E>>>4|C<<12)&8191),K=s[5]+(C>>>1&8191),q=s[6]+((C>>>14|k<<2)&8191),Q=s[7]+((k>>>11|x<<5)&8191),H=s[8]+((x>>>8|I<<8)&8191),O=s[9]+(I>>>5|i),B=0,W=B+T*a+L*(5*v)+V*(5*g)+U*(5*f)+G*(5*m);B=W>>>13,W&=8191,W+=K*(5*p)+q*(5*d)+Q*(5*h)+H*(5*l)+O*(5*c),B+=W>>>13,W&=8191;let Y=B+T*c+L*a+V*(5*v)+U*(5*g)+G*(5*f);B=Y>>>13,Y&=8191,Y+=K*(5*m)+q*(5*p)+Q*(5*d)+H*(5*h)+O*(5*l),B+=Y>>>13,Y&=8191;let j=B+T*l+L*c+V*a+U*(5*v)+G*(5*g);B=j>>>13,j&=8191,j+=K*(5*f)+q*(5*m)+Q*(5*p)+H*(5*d)+O*(5*h),B+=j>>>13,j&=8191;let ce=B+T*h+L*l+V*c+U*a+G*(5*v);B=ce>>>13,ce&=8191,ce+=K*(5*g)+q*(5*f)+Q*(5*m)+H*(5*p)+O*(5*d),B+=ce>>>13,ce&=8191;let me=B+T*d+L*h+V*l+U*c+G*a;B=me>>>13,me&=8191,me+=K*(5*v)+q*(5*g)+Q*(5*f)+H*(5*m)+O*(5*p),B+=me>>>13,me&=8191;let he=B+T*p+L*d+V*h+U*l+G*c;B=he>>>13,he&=8191,he+=K*a+q*(5*v)+Q*(5*g)+H*(5*f)+O*(5*m),B+=he>>>13,he&=8191;let ue=B+T*m+L*p+V*d+U*h+G*l;B=ue>>>13,ue&=8191,ue+=K*c+q*a+Q*(5*v)+H*(5*g)+O*(5*f),B+=ue>>>13,ue&=8191;let Ne=B+T*f+L*m+V*p+U*d+G*h;B=Ne>>>13,Ne&=8191,Ne+=K*l+q*c+Q*a+H*(5*v)+O*(5*g),B+=Ne>>>13,Ne&=8191;let Me=B+T*g+L*f+V*m+U*p+G*d;B=Me>>>13,Me&=8191,Me+=K*h+q*l+Q*c+H*a+O*(5*v),B+=Me>>>13,Me&=8191;let Xe=B+T*v+L*g+V*f+U*m+G*p;B=Xe>>>13,Xe&=8191,Xe+=K*d+q*h+Q*l+H*c+O*a,B+=Xe>>>13,Xe&=8191,B=(B<<2)+B|0,B=B+W|0,W=B&8191,B=B>>>13,Y+=B,s[0]=W,s[1]=Y,s[2]=j,s[3]=ce,s[4]=me,s[5]=he,s[6]=ue,s[7]=Ne,s[8]=Me,s[9]=Xe}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;nd(n)}update(e){hT(this);const{buffer:t,blockLen:n}=this;e=_v(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}t.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){nd(this.h,this.r,this.buffer,this.pad)}digestInto(e){hT(this),E2e(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}function L2e(r){const e=(n,i)=>r(i).update(_v(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}const B2e=L2e(r=>new R2e(r));function U2e(r,e,t,n,i,s=20){let o=r[0],a=r[1],c=r[2],l=r[3],h=e[0],d=e[1],p=e[2],m=e[3],f=e[4],g=e[5],v=e[6],y=e[7],w=i,b=t[0],E=t[1],C=t[2],k=o,x=a,I=c,T=l,L=h,V=d,U=p,G=m,K=f,q=g,Q=v,H=y,O=w,B=b,W=E,Y=C;for(let ce=0;ce<s;ce+=2)k=k+L|0,O=Ze(O^k,16),K=K+O|0,L=Ze(L^K,12),k=k+L|0,O=Ze(O^k,8),K=K+O|0,L=Ze(L^K,7),x=x+V|0,B=Ze(B^x,16),q=q+B|0,V=Ze(V^q,12),x=x+V|0,B=Ze(B^x,8),q=q+B|0,V=Ze(V^q,7),I=I+U|0,W=Ze(W^I,16),Q=Q+W|0,U=Ze(U^Q,12),I=I+U|0,W=Ze(W^I,8),Q=Q+W|0,U=Ze(U^Q,7),T=T+G|0,Y=Ze(Y^T,16),H=H+Y|0,G=Ze(G^H,12),T=T+G|0,Y=Ze(Y^T,8),H=H+Y|0,G=Ze(G^H,7),k=k+V|0,Y=Ze(Y^k,16),Q=Q+Y|0,V=Ze(V^Q,12),k=k+V|0,Y=Ze(Y^k,8),Q=Q+Y|0,V=Ze(V^Q,7),x=x+U|0,O=Ze(O^x,16),H=H+O|0,U=Ze(U^H,12),x=x+U|0,O=Ze(O^x,8),H=H+O|0,U=Ze(U^H,7),I=I+G|0,B=Ze(B^I,16),K=K+B|0,G=Ze(G^K,12),I=I+G|0,B=Ze(B^I,8),K=K+B|0,G=Ze(G^K,7),T=T+L|0,W=Ze(W^T,16),q=q+W|0,L=Ze(L^q,12),T=T+L|0,W=Ze(W^T,8),q=q+W|0,L=Ze(L^q,7);let j=0;n[j++]=o+k|0,n[j++]=a+x|0,n[j++]=c+I|0,n[j++]=l+T|0,n[j++]=h+L|0,n[j++]=d+V|0,n[j++]=p+U|0,n[j++]=m+G|0,n[j++]=f+K|0,n[j++]=g+q|0,n[j++]=v+Q|0,n[j++]=y+H|0,n[j++]=w+O|0,n[j++]=b+B|0,n[j++]=E+W|0,n[j++]=C+Y|0}const F2e=O2e(U2e,{counterRight:!1,counterLength:4,allowShortKeys:!1}),z2e=new Uint8Array(16),yT=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(z2e.subarray(t))},V2e=new Uint8Array(32);function mT(r,e,t,n,i){const s=r(e,t,V2e),o=B2e.create(s);i&&yT(o,i),yT(o,n);const a=new Uint8Array(16),c=S2e(a);pT(c,0,BigInt(i?i.length:0),!0),pT(c,8,BigInt(n.length),!0),o.update(a);const l=o.digest();return nd(s,a),l}const K2e=r=>(e,t,n)=>({encrypt(s,o){const a=s.length;o=fT(a+16,o,!1),o.set(s);const c=o.subarray(0,-16);r(e,t,c,c,1);const l=mT(r,e,t,c,n);return o.set(l,a),nd(l),o},decrypt(s,o){o=fT(s.length-16,o,!1);const a=s.subarray(0,-16),c=s.subarray(-16),l=mT(r,e,t,a,n);if(!I2e(c,l))throw new Error("invalid tag");return o.set(s.subarray(0,-16)),r(e,t,o,o,1),nd(l),o}}),wT=k2e({blockSize:64,nonceLength:12,tagLength:16},K2e(F2e));function H2e(r,e,t){return uw(r),t===void 0&&(t=new Uint8Array(r.outputLen)),yw(r,q1(t),q1(e))}const g5=Uint8Array.from([0]),bT=Uint8Array.of();function j2e(r,e,t,n=32){uw(r),mh(n);const i=r.outputLen;if(n>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(n/i);t===void 0&&(t=bT);const o=new Uint8Array(s*i),a=yw.create(r,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let h=0;h<s;h++)g5[0]=h+1,c.update(h===0?bT:l).update(t).update(g5).digestInto(l),o.set(l,i*h),a._cloneInto(c);return a.destroy(),c.destroy(),Us(l,g5),o.slice(0,n)}const q2e={hashSHA256(r){return Pl(r.subarray())},getHKDF(r,e){const t=H2e(Pl,e,r),i=j2e(Pl,t,void 0,96),s=i.subarray(0,32),o=i.subarray(32,64),a=i.subarray(64,96);return[s,o,a]},generateX25519KeyPair(){const r=q0.utils.randomPrivateKey();return{publicKey:q0.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:q0.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,e){return q0.getSharedSecret(r.subarray(),e.subarray())},chaCha20Poly1305Encrypt(r,e,t,n){return wT(n,e,t).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,e,t,n,i){return wT(n,e,t).decrypt(r.subarray(),i)}},W2e=q2e;function G2e(r){return{generateKeypair:r.generateX25519KeyPair,dh:(e,t)=>r.generateX25519SharedKey(e.privateKey,t).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}const om=r=>{const e=Pn(2);return e[0]=r>>8,e[1]=r,e};om.bytes=2;const o2=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let e=0;return e+=r[0]<<8,e+=r[1],e}return r.getUint16(0)};o2.bytes=2;function Q2e(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function iV(r,e){!e.enabled||!Wp||(r?(e(`LOCAL_STATIC_PUBLIC_KEY ${re(r.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${re(r.privateKey,"hex")}`)):e("Missing local static keys."))}function sV(r,e){!e.enabled||!Wp||(r?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${re(r.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${re(r.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function Y2e(r,e){!e.enabled||!Wp||e(r?`REMOTE_STATIC_PUBLIC_KEY ${re(r.subarray(),"hex")}`:"Missing remote static public key.")}function oV(r,e){!e.enabled||!Wp||e(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${re(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function aV(r,e,t){!t.enabled||!Wp||(t(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&re(r.k,"hex")}`),t(`CIPHER_STATE_2 ${e.n.getUint64()} ${e.k&&re(e.k,"hex")}`))}function xc(r,e){if(r.length!==e.length)throw new Error("Inputs should have the same length");const t=Pn(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return t}const g3=class g3 extends Error{constructor(t="Invalid crypto exchange"){super(t);u(this,"code");this.code=g3.code}};u(g3,"code","ERR_INVALID_CRYPTO_EXCHANGE");let c1=g3;const X2e=0,J2e=4294967295,Z2e="Cipherstate has reached maximum n, a new handshake must be performed";class eye{constructor(e=X2e){u(this,"n");u(this,"bytes");u(this,"view");this.n=e,this.bytes=We(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>J2e)throw new Error(Z2e)}}const vh=We(0);class cg{constructor(e,t=void 0,n=0){u(this,"k");u(this,"n");u(this,"crypto");this.crypto=e,this.k=t,this.n=new eye(n)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();const n=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),n}decryptWithAd(e,t,n){if(!this.hasKey())return t;this.n.assertValue();const i=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,n);return this.n.increment(),i}}class tye{constructor(e,t){u(this,"cs");u(this,"ck");u(this,"h");u(this,"crypto");this.crypto=e;const n=se(t,"utf-8");this.h=nye(e,n),this.ck=this.h,this.cs=new cg(e)}mixKey(e){const[t,n]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new cg(this.crypto,n)}mixHash(e){this.h=this.crypto.hash(new Le(this.h,e))}encryptAndHash(e){const t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){const t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){const[e,t]=this.crypto.hkdf(this.ck,vh);return[new cg(this.crypto,e),new cg(this.crypto,t)]}}class rye{constructor(e){u(this,"ss");u(this,"s");u(this,"e");u(this,"rs");u(this,"re");u(this,"initiator");u(this,"crypto");const{crypto:t,protocolName:n,prologue:i,initiator:s,s:o,e:a,rs:c,re:l}=e;this.crypto=t,this.ss=new tye(t,n),this.ss.mixHash(i),this.initiator=s,this.s=o,this.e=a,this.rs=c,this.re=l}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");const e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw new Error("remote static public key is already set");const n=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+n)throw new Error("message is not long enough");const i=e.sublist(t,t+n);return this.rs=this.ss.decryptAndHash(i),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class cV extends rye{writeMessageA(e){return new Le(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){const t=this.writeE();this.writeEE();const n=this.writeS();return this.writeES(),new Le(t,n,this.ss.encryptAndHash(e))}writeMessageC(e){const t=this.writeS();return this.writeSE(),new Le(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(t){throw new c1(`handshake stage 0 validation fail: ${t.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();const t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(t){throw new c1(`handshake stage 1 validation fail: ${t.message}`)}}readMessageC(e){try{const t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(t){throw new c1(`handshake stage 2 validation fail: ${t.message}`)}}}function nye(r,e){if(e.length<=32){const t=We(32);return t.set(e),t}else return r.hash(e)}var am;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(const s of t.webtransportCerthashes)n.uint32(10),n.bytes(s);if(t.streamMuxers!=null)for(const s of t.streamMuxers)n.uint32(18),n.string(s);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={webtransportCerthashes:[],streamMuxers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{if(((a=i.limits)==null?void 0:a.webtransportCerthashes)!=null&&s.webtransportCerthashes.length===i.limits.webtransportCerthashes)throw new ht('Decode error - map field "webtransportCerthashes" had too many elements');s.webtransportCerthashes.push(t.bytes());break}case 2:{if(((c=i.limits)==null?void 0:c.streamMuxers)!=null&&s.streamMuxers.length===i.limits.streamMuxers)throw new ht('Decode error - map field "streamMuxers" had too many elements');s.streamMuxers.push(t.string());break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(am||(am={}));var cm;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.identityKey!=null&&t.identityKey.byteLength>0&&(n.uint32(10),n.bytes(t.identityKey)),t.identitySig!=null&&t.identitySig.byteLength>0&&(n.uint32(18),n.bytes(t.identitySig)),t.extensions!=null&&(n.uint32(34),am.codec().encode(t.extensions,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={identityKey:We(0),identitySig:We(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.identityKey=t.bytes();break}case 2:{s.identitySig=t.bytes();break}case 4:{s.extensions=am.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.extensions});break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(cm||(cm={}));async function lV(r,e,t){const n=await r.sign(hV(e));return cm.encode({identityKey:_i(r.publicKey),identitySig:n,extensions:t})}async function uV(r,e,t){try{const n=cm.decode(r),i=$n(n.identityKey);if((t==null?void 0:t.equals(i))===!1)throw new Error(`Payload identity key ${i} does not match expected remote identity key ${t}`);if(!e)throw new Error("Remote static does not exist");const s=hV(e);if(!await i.verify(s,n.identitySig))throw new Error("Invalid payload signature");return n}catch(n){throw new WL(n.message)}}function hV(r){const e=se("noise-libp2p-static-key:");return r instanceof Uint8Array?er([e,r],e.length+r.length):(r.prepend(e),r)}async function iye(r,e){const{log:t,connection:n,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=r,h=await lV(s,a.publicKey,l),d=new cV({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:o,s:a});iV(d.s,t),t.trace("Stage 0 - Initiator starting to send first message."),await n.write(d.writeMessageA(vh),e),t.trace("Stage 0 - Initiator finished sending first message."),sV(d.e,t),t.trace("Stage 1 - Initiator waiting to receive first message from responder...");const p=d.readMessageB(await n.read(e));t.trace("Stage 1 - Initiator received the message."),oV(d.re,t),Y2e(d.rs,t),t.trace("Initiator going to check remote's signature...");const m=await uV(p,d.rs,c);t.trace("All good with the signature!"),t.trace("Stage 2 - Initiator sending third handshake message."),await n.write(d.writeMessageC(h),e),t.trace("Stage 2 - Initiator sent message with signed payload.");const[f,g]=d.ss.split();return aV(f,g,t),{payload:m,encrypt:v=>f.encryptWithAd(vh,v),decrypt:(v,y)=>g.decryptWithAd(vh,v,y)}}async function sye(r,e){const{log:t,connection:n,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=r,h=await lV(s,a.publicKey,l),d=new cV({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:o,s:a});iV(d.s,t),t.trace("Stage 0 - Responder waiting to receive first message."),d.readMessageA(await n.read(e)),t.trace("Stage 0 - Responder received first message."),oV(d.re,t),t.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(d.writeMessageB(h),e),t.trace("Stage 1 - Responder sent the second handshake message with signed payload."),sV(d.e,t),t.trace("Stage 2 - Responder waiting for third handshake message...");const p=d.readMessageC(await n.read(e));t.trace("Stage 2 - Responder received the message, finished handshake.");const m=await uV(p,d.rs,c),[f,g]=d.ss.split();return aV(f,g,t),{payload:m,encrypt:v=>g.encryptWithAd(vh,v),decrypt:(v,y)=>f.decryptWithAd(vh,v,y)}}const vT=16;function oye(r,e){return async function*(t){for await(const n of t)for(let i=0;i<n.length;i+=uT){let s=i+uT;s>n.length&&(s=n.length);let o;n instanceof Uint8Array?o=r.encrypt(n.subarray(i,s)):o=r.encrypt(n.sublist(i,s)),e==null||e.encryptedPackets.increment(),yield new Le(om(o.byteLength),o)}}}function aye(r,e){return async function*(t){for await(const n of t)for(let i=0;i<n.length;i+=rp){let s=i+rp;if(s>n.length&&(s=n.length),s-vT<i)throw new Error("Invalid chunk");const o=n.sublist(i,s),a=n.subarray(i,s-vT);try{const c=r.decrypt(o,a);e==null||e.decryptedPackets.increment(),yield c}catch(c){throw e==null||e.decryptErrors.increment(),c}}}}var pN,gN;gN=Symbol.toStringTag,pN=ur;class cye{constructor(e,t={}){u(this,"protocol","/noise");u(this,"crypto");u(this,"prologue");u(this,"staticKey");u(this,"extensions");u(this,"metrics");u(this,"components");u(this,gN,"@chainsafe/libp2p-noise");u(this,pN,["@libp2p/connection-encryption","@chainsafe/libp2p-noise"]);const{staticNoiseKey:n,extensions:i,crypto:s,prologueBytes:o}=t,{metrics:a}=e;this.components=e;const c=s??W2e;this.crypto=G2e(c),this.extensions={webtransportCerthashes:[],...i},this.metrics=a?Q2e(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=o??We(0)}async secureOutbound(e,t){var a,c;const n=rd(e,{lengthEncoder:om,lengthDecoder:o2,maxDataLength:rp}),i=await this.performHandshakeInitiator(n,this.components.privateKey,(a=t==null?void 0:t.remotePeer)==null?void 0:a.publicKey,t),s=await this.createSecureConnection(n,i);e.source=s.source,e.sink=s.sink;const o=$n(i.payload.identityKey);return{conn:e,remoteExtensions:i.payload.extensions,remotePeer:Yh(o),streamMuxer:this.getStreamMuxer((c=i.payload.extensions)==null?void 0:c.streamMuxers)}}getStreamMuxer(e){if(e==null)return;const t=this.components.upgrader.getStreamMuxers();if(t!=null)for(const n of e){const i=t.get(n);if(i!=null)return i}if(e.length)throw new DZ("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(e,t){var a,c;const n=rd(e,{lengthEncoder:om,lengthDecoder:o2,maxDataLength:rp}),i=await this.performHandshakeResponder(n,this.components.privateKey,(a=t==null?void 0:t.remotePeer)==null?void 0:a.publicKey,t),s=await this.createSecureConnection(n,i);e.source=s.source,e.sink=s.sink;const o=$n(i.payload.identityKey);return{conn:e,remoteExtensions:i.payload.extensions,remotePeer:Yh(o),streamMuxer:this.getStreamMuxer((c=i.payload.extensions)==null?void 0:c.streamMuxers)}}async performHandshakeInitiator(e,t,n,i){var o,a;let s;try{s=await iye({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},i),(o=this.metrics)==null||o.xxHandshakeSuccesses.increment()}catch(c){throw(a=this.metrics)==null||a.xxHandshakeErrors.increment(),c}return s}async performHandshakeResponder(e,t,n,i){var o,a;let s;try{s=await sye({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},i),(o=this.metrics)==null||o.xxHandshakeSuccesses.increment()}catch(c){throw(a=this.metrics)==null||a.xxHandshakeErrors.increment(),c}return s}async createSecureConnection(e,t){const[n,i]=v2e(),s=e.unwrap();return await cn(n,oye(t,this.metrics),s,o=>Qh(o,{lengthDecoder:o2}),aye(t,this.metrics),n),i}}function dV(r={}){return e=>new cye(e,r)}function fV(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}class gl extends Error{constructor(e="The frame was invalid"){super(e),this.name="InvalidFrameError"}}u(gl,"name","InvalidFrameError");class wx extends Error{constructor(e="Unrequested ping error"){super(e),this.name="UnrequestedPingError"}}u(wx,"name","UnrequestedPingError");class bx extends Error{constructor(e="Unrequested ping error"){super(e),this.name="NotMatchingPingError"}}u(bx,"name","NotMatchingPingError");class pV extends Error{constructor(e="Invalid state"){super(e),this.name="InvalidStateError"}}u(pV,"name","InvalidStateError");class gV extends Error{constructor(e="Strean already exists"){super(e),this.name="StreamAlreadyExistsError"}}u(gV,"name","StreamAlreadyExistsError");class yV extends Error{constructor(e="Decode invalid version"){super(e),this.name="DecodeInvalidVersionError"}}u(yV,"name","DecodeInvalidVersionError");class mV extends Error{constructor(e="Both clients"){super(e),this.name="BothClientsError"}}u(mV,"name","BothClientsError");class vx extends Error{constructor(e="Receive window exceeded"){super(e),this.name="ReceiveWindowExceededError"}}u(vx,"name","ReceiveWindowExceededError");const lye=new Set([gl.name,wx.name,bx.name,gV.name,yV.name,mV.name,vx.name]),Ex=256*1024,uye=16*1024*1024,hye={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:Ex,maxStreamWindowSize:uye,maxMessageSize:64*1024};function dye(r){if(r.keepAliveInterval<=0)throw new Z("keep-alive interval must be positive");if(r.maxInboundStreams<0)throw new Z("max inbound streams must be larger or equal 0");if(r.maxOutboundStreams<0)throw new Z("max outbound streams must be larger or equal 0");if(r.initialStreamWindowSize<Ex)throw new Z("InitialStreamWindowSize must be larger or equal 256 kB");if(r.maxStreamWindowSize<r.initialStreamWindowSize)throw new Z("MaxStreamWindowSize must be larger than the InitialStreamWindowSize");if(r.maxStreamWindowSize>2**32-1)throw new Z("MaxStreamWindowSize must be less than equal MAX_UINT32");if(r.maxMessageSize<1024)throw new Z("MaxMessageSize must be greater than a kilobyte")}var Xt;(function(r){r[r.Data=0]="Data",r[r.WindowUpdate=1]="WindowUpdate",r[r.Ping=2]="Ping",r[r.GoAway=3]="GoAway"})(Xt||(Xt={}));var Ut;(function(r){r[r.SYN=1]="SYN",r[r.ACK=2]="ACK",r[r.FIN=4]="FIN",r[r.RST=8]="RST"})(Ut||(Ut={}));Object.values(Ut).filter(r=>typeof r!="string");const fye=0;var Cs;(function(r){r[r.NormalTermination=0]="NormalTermination",r[r.ProtocolError=1]="ProtocolError",r[r.InternalError=2]="InternalError"})(Cs||(Cs={}));const l1=12,ET=2**24;function pye(r){if(r[0]!==fye)throw new gl("Invalid frame version");return{type:r[1],flag:(r[2]<<8)+r[3],streamID:r[4]*ET+(r[5]<<16)+(r[6]<<8)+r[7],length:r[8]*ET+(r[9]<<16)+(r[10]<<8)+r[11]}}let gye=class{constructor(e){u(this,"source");u(this,"buffer");u(this,"frameInProgress");this.source=yye(e),this.buffer=new Le,this.frameInProgress=!1}async*emitFrames(){for await(const e of this.source)for(this.buffer.append(e);;){const t=this.readHeader();if(t===void 0)break;const{type:n,length:i}=t;n===Xt.Data?(this.frameInProgress=!0,yield{header:t,readData:this.readBytes.bind(this,i)}):yield{header:t}}}readHeader(){if(this.frameInProgress)throw new pV("decoding frame already in progress");if(this.buffer.length<l1)return;const e=pye(this.buffer.subarray(0,l1));return this.buffer.consume(l1),e}async readBytes(e){if(this.buffer.length<e){for await(const n of this.source)if(this.buffer.append(n),this.buffer.length>=e)break}const t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}};function yye(r){if(r[Symbol.iterator]!==void 0){const e=r[Symbol.iterator]();return e.return=void 0,{[Symbol.iterator](){return e}}}else if(r[Symbol.asyncIterator]!==void 0){const e=r[Symbol.asyncIterator]();return e.return=void 0,{[Symbol.asyncIterator](){return e}}}else throw new Error("a source must be either an iterable or an async iterable")}function ST(r){const e=new Uint8Array(l1);return e[1]=r.type,e[2]=r.flag>>>8,e[3]=r.flag,e[4]=r.streamID>>>24,e[5]=r.streamID>>>16,e[6]=r.streamID>>>8,e[7]=r.streamID,e[8]=r.length>>>24,e[9]=r.length>>>16,e[10]=r.length>>>8,e[11]=r.length,e}function mye(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function wV(r,e){var n,i;const t=(i=(n=fV(r)).return)==null?void 0:i.call(n);mye(t)&&t.catch(s=>{e.error("could not cause iterator to return",s)})}const wye=5e3;function y5(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}class Sx{constructor(e){u(this,"id");u(this,"direction");u(this,"timeline");u(this,"protocol");u(this,"metadata");u(this,"source");u(this,"status");u(this,"readStatus");u(this,"writeStatus");u(this,"log");u(this,"sinkController");u(this,"sinkEnd");u(this,"closed");u(this,"endErr");u(this,"streamSource");u(this,"onEnd");u(this,"onCloseRead");u(this,"onCloseWrite");u(this,"onReset");u(this,"onAbort");u(this,"sendCloseWriteTimeout");u(this,"sendingData");this.sinkController=new AbortController,this.sinkEnd=Oe(),this.closed=Oe(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??wye,this.onEnd=e.onEnd,this.onCloseRead=e==null?void 0:e.onCloseRead,this.onCloseWrite=e==null?void 0:e.onCloseWrite,this.onReset=e==null?void 0:e.onReset,this.onAbort=e==null?void 0:e.onAbort,this.source=this.streamSource=No({onEnd:t=>{t!=null?this.log.trace("source ended with error",t):this.log.trace("source ended"),this.onSourceEnd(t)}}),this.sink=this.sink.bind(this)}async sink(e){if(this.writeStatus!=="ready")throw new ry(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";const t={signal:this.sinkController.signal};if(this.direction==="outbound"){const i=this.sendNewStream(t);y5(i)&&await i}const n=()=>{wV(e,this.log)};try{this.sinkController.signal.addEventListener("abort",n),this.log.trace("sink reading from source");for await(let i of e){i=i instanceof Uint8Array?new Le(i):i;const s=this.sendData(i,t);y5(s)&&(this.sendingData=Oe(),await s,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",n)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(t){throw this.log.trace("sink ended with error, calling abort with error",t),this.abort(t),t}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){var t;this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(t=this.onCloseRead)==null||t.call(this),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){var t;this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(t=this.onCloseWrite)==null||t.call(this),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.status==="open"&&(this.log.trace("closing gracefully"),this.status="closing",await nn(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e==null?void 0:e.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(e={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const t=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),t==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(e={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),await nn(this.sink([]),e.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&await nn(this.sendingData.promise,e.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await nn(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){var n;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",e),this.log("try to send reset to remote");const t=this.sendReset();y5(t)&&t.catch(i=>{this.log.error("error sending reset message",i)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),(n=this.onAbort)==null||n.call(this,e)}reset(){var t;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;const e=new QL("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),(t=this.onReset)==null||t.call(this)}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}var Yi;(function(r){r[r.Init=0]="Init",r[r.SYNSent=1]="SYNSent",r[r.SYNReceived=2]="SYNReceived",r[r.Established=3]="Established",r[r.Finished=4]="Finished"})(Yi||(Yi={}));class bye extends Sx{constructor(t){super({...t,onEnd:n=>{var i;this.state=Yi.Finished,(i=t.onEnd)==null||i.call(t,n)}});u(this,"name");u(this,"state");u(this,"config");u(this,"_id");u(this,"sendWindowCapacity");u(this,"sendWindowCapacityUpdate");u(this,"recvWindow");u(this,"recvWindowCapacity");u(this,"epochStart");u(this,"getRTT");u(this,"sendFrame");this.config=t.config,this._id=parseInt(t.id,10),this.name=t.name,this.state=t.state,this.sendWindowCapacity=Ex,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=t.getRTT,this.sendFrame=t.sendFrame,this.source=Ly(this.source,()=>{this.sendWindowUpdate()})}async sendNewStream(){}async sendData(t,n={}){var i,s;for(t=t.sublist();t.byteLength!==0;){if(this.sendWindowCapacity===0&&((i=this.log)==null||i.trace("wait for send window capacity, status %s",this.status),await this.waitForSendWindowCapacity(n),this.status==="closed"||this.status==="aborted"||this.status==="reset")){(s=this.log)==null||s.trace("%s while waiting for send window capacity",this.status);return}const o=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-l1,t.length),a=this.getSendFlags();this.sendFrame({type:Xt.Data,flag:a,streamID:this._id,length:o},t.sublist(0,o)),this.sendWindowCapacity-=o,t.consume(o)}}async sendReset(){this.sendFrame({type:Xt.WindowUpdate,flag:Ut.RST,streamID:this._id,length:0})}async sendCloseWrite(){const t=this.getSendFlags()|Ut.FIN;this.sendFrame({type:Xt.WindowUpdate,flag:t,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(t={}){var o,a;if(this.sendWindowCapacity>0)return;let n,i;const s=()=>{this.status==="open"||this.status==="closing"?i(new zl("Stream aborted")):n()};(o=t.signal)==null||o.addEventListener("abort",s);try{await new Promise((c,l)=>{this.sendWindowCapacityUpdate=()=>{c()},i=l,n=c})}finally{(a=t.signal)==null||a.removeEventListener("abort",s)}}handleWindowUpdate(t){var i,s;(i=this.log)==null||i.trace("stream received window update id=%s",this._id),this.processFlags(t.flag);const n=this.sendWindowCapacity;this.sendWindowCapacity+=t.length,n===0&&t.length>0&&((s=this.sendWindowCapacityUpdate)==null||s.call(this))}async handleData(t,n){var s;if((s=this.log)==null||s.trace("stream received data id=%s",this._id),this.processFlags(t.flag),this.recvWindowCapacity<t.length)throw new vx("Receive window exceeded");const i=await n();this.recvWindowCapacity-=t.length,this.sourcePush(i)}processFlags(t){(t&Ut.ACK)===Ut.ACK&&this.state===Yi.SYNSent&&(this.state=Yi.Established),(t&Ut.FIN)===Ut.FIN&&this.remoteCloseWrite(),(t&Ut.RST)===Ut.RST&&this.reset()}getSendFlags(){switch(this.state){case Yi.Init:return this.state=Yi.SYNSent,Ut.SYN;case Yi.SYNReceived:return this.state=Yi.Established,Ut.ACK;default:return 0}}sendWindowUpdate(){const t=this.getSendFlags(),n=Date.now(),i=this.getRTT();if(t===0&&i>-1&&n-this.epochStart<i*4&&(this.recvWindow=Math.min(this.recvWindow*2,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&t===0)return;const s=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=n,this.sendFrame({type:Xt.WindowUpdate,flag:t,streamID:this._id,length:s})}}const bV="/yamux/1.0.0",vye=500;var yN,mN;mN=Symbol.toStringTag,yN=ur;class Eye{constructor(e,t={}){u(this,"protocol",bV);u(this,"_components");u(this,"_init");u(this,mN,"@chainsafe/libp2p-yamux");u(this,yN,["@libp2p/stream-multiplexing"]);this._components=e,this._init=t}createStreamMuxer(e){return new Sye(this._components,{...this._init,...e})}}class Sye{constructor(e,t){u(this,"protocol",bV);u(this,"source");u(this,"sink");u(this,"config");u(this,"log");u(this,"logger");u(this,"closeController");u(this,"nextStreamID");u(this,"_streams");u(this,"nextPingID");u(this,"activePing");u(this,"rtt");u(this,"client");u(this,"localGoAway");u(this,"remoteGoAway");u(this,"numInboundStreams");u(this,"numOutboundStreams");u(this,"onIncomingStream");u(this,"onStreamEnd");var n;this.client=t.direction==="outbound",this.config={...hye,...t},this.logger=e.logger,this.log=this.logger.forComponent("libp2p:yamux"),dye(this.config),this.closeController=new AbortController,this.closeController.signal,this.onIncomingStream=t.onIncomingStream,this.onStreamEnd=t.onStreamEnd,this._streams=new Map,this.source=No({onEnd:()=>{var i;(i=this.log)==null||i.trace("muxer source ended"),this._streams.forEach(s=>{s.destroy()})}}),this.sink=async i=>{var c,l,h;const s=()=>{const d=fV(i);if(d.return!=null){const p=d.return();xye(p)&&p.catch(m=>{var f;(f=this.log)==null||f.call(this,"could not cause sink source to return",m)})}};let o,a;try{const d=new gye(i);try{this.closeController.signal.addEventListener("abort",s);for await(const p of d.emitFrames())await this.handleFrame(p.header,p.readData)}finally{this.closeController.signal.removeEventListener("abort",s)}o=Cs.NormalTermination}catch(d){lye.has(d.name)?((c=this.log)==null||c.error("protocol error in sink",d),o=Cs.ProtocolError):((l=this.log)==null||l.error("internal error in sink",d),o=Cs.InternalError),a=d}(h=this.log)==null||h.trace("muxer sink ended"),a!=null?this.abort(a,o):await this.close({reason:o})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,(n=this.log)==null||n.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("keepalive error: %s",i)}),this.ping().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("ping error: %s",i)})}get streams(){return Array.from(this._streams.values())}newStream(e){var i;if(this.remoteGoAway!==void 0)throw new il("Muxer closed remotely");if(this.localGoAway!==void 0)throw new il("Muxer closed locally");const t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new tw("max outbound streams exceeded");(i=this.log)==null||i.trace("new outgoing stream id=%s",t);const n=this._newStream(t,e,Yi.Init,"outbound");return this._streams.set(t,n),this.numOutboundStreams++,n.sendWindowUpdate(),n}async ping(){if(this.remoteGoAway!==void 0)throw new il("Muxer closed remotely");if(this.localGoAway!==void 0)throw new il("Muxer closed locally");if(this.activePing===void 0){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((i,s)=>{const o=()=>{s(new il("Muxer closed locally"))};this.closeController.signal.addEventListener("abort",o,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",o),i()}}),resolve:e};const t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const n=Date.now();this.rtt=n-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(e={}){var n;if(this.closeController.signal.aborted)return;const t=(e==null?void 0:e.reason)??Cs.NormalTermination;if((n=this.log)==null||n.trace("muxer close reason=%s",t),e.signal==null){const i=AbortSignal.timeout(vye);e={...e,signal:i}}try{await Promise.all([...this._streams.values()].map(async i=>i.close(e))),this.sendGoAway(t),this._closeMuxer()}catch(i){this.abort(i)}}abort(e,t){var n;if(!this.closeController.signal.aborted){t=t??Cs.InternalError,(n=this.log)==null||n.error("muxer abort reason=%s error=%s",t,e);for(const i of this._streams.values())i.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,n,i){if(this._streams.get(e)!=null)throw new Z("Stream already exists with that id");const s=new bye({id:e.toString(),name:t,state:n,direction:i,sendFrame:this.sendFrame.bind(this),onEnd:()=>{var o;this.closeStream(e),(o=this.onStreamEnd)==null||o.call(this,s)},log:this.logger.forComponent(`libp2p:yamux:${i}:${e}`),config:this.config,getRTT:this.getRTT.bind(this)});return s}closeStream(e){this.client===(e%2===0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){var t;const e=new Promise((n,i)=>{this.closeController.signal.addEventListener("abort",i,{once:!0})});for((t=this.log)==null||t.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let n;try{await Promise.race([e,new Promise(i=>{n=setTimeout(i,this.config.keepAliveInterval)})]),this.ping().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("ping error: %s",i)})}catch{clearInterval(n);return}}}async handleFrame(e,t){var o;const{streamID:n,type:i,length:s}=e;if((o=this.log)==null||o.trace("received frame %o",e),n===0)switch(i){case Xt.Ping:{this.handlePing(e);return}case Xt.GoAway:{this.handleGoAway(s);return}default:throw new gl("Invalid frame type")}else switch(e.type){case Xt.Data:case Xt.WindowUpdate:{await this.handleStreamMessage(e,t);return}default:throw new gl("Invalid frame type")}}handlePing(e){var t,n;if(e.flag===Ut.SYN)(t=this.log)==null||t.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,Ut.ACK);else if(e.flag===Ut.ACK)(n=this.log)==null||n.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length);else throw new gl("Invalid frame flag")}handlePingResponse(e){if(this.activePing===void 0)throw new wx("ping not requested");if(this.activePing.id!==e)throw new bx("ping doesn't match our id");this.activePing.resolve()}handleGoAway(e){var t;(t=this.log)==null||t.trace("received GoAway reason=%s",Cs[e]??"unknown"),this.remoteGoAway=e;for(const n of this._streams.values())n.reset();this._closeMuxer()}async handleStreamMessage(e,t){var a,c;const{streamID:n,flag:i,type:s}=e;(i&Ut.SYN)===Ut.SYN&&this.incomingStream(n);const o=this._streams.get(n);if(o===void 0){if(s===Xt.Data){if((a=this.log)==null||a.call(this,"discarding data for stream id=%s",n),t===void 0)throw new Error("unreachable");await t()}else(c=this.log)==null||c.trace("frame for missing stream id=%s",n);return}switch(s){case Xt.WindowUpdate:{o.handleWindowUpdate(e);return}case Xt.Data:{if(t===void 0)throw new Error("unreachable");await o.handleData(e,t);return}default:throw new Error("unreachable")}}incomingStream(e){var n,i,s;if(this.client!==(e%2===0))throw new Z("Both endpoints are clients");if(this._streams.has(e))return;if((n=this.log)==null||n.trace("new incoming stream id=%s",e),this.localGoAway!==void 0){this.sendFrame({type:Xt.WindowUpdate,flag:Ut.RST,streamID:e,length:0});return}if(this.numInboundStreams>=this.config.maxInboundStreams){(i=this.log)==null||i.call(this,"maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:Xt.WindowUpdate,flag:Ut.RST,streamID:e,length:0});return}const t=this._newStream(e,void 0,Yi.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),(s=this.onIncomingStream)==null||s.call(this,t)}sendFrame(e,t){var n;if((n=this.log)==null||n.trace("sending frame %o",e),e.type===Xt.Data){if(t===void 0)throw new gl("Invalid frame");this.source.push(new Le(ST(e),t))}else this.source.push(ST(e))}sendPing(e,t=Ut.SYN){var n,i;t===Ut.SYN?(n=this.log)==null||n.trace("sending ping request pingId=%s",e):(i=this.log)==null||i.trace("sending ping response pingId=%s",e),this.sendFrame({type:Xt.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=Cs.NormalTermination){var t;(t=this.log)==null||t.call(this,"sending GoAway reason=%s",Cs[e]),this.localGoAway=e,this.sendFrame({type:Xt.GoAway,flag:0,streamID:0,length:e})}}function xye(r){return r!=null&&typeof r.then=="function"}function Aye(r={}){return e=>new Eye(e,r)}const Cye=41;function vV(r){try{const[[e,t]]=r.stringTuples();if(t==null)return!1;if(e===Cye)return Vde("2000::/3",t)}catch{}return!1}const Iye=4,kye=41;function EV(r){try{const[[e]]=r.stringTuples();return e===Iye||e===kye}catch{}return!1}function Ql(r){try{if(!EV(r))return!1;const[[,e]]=r.stringTuples();return e==null?!1:Rc(e)??!1}catch{}return!0}function _ye(r,e,t){let n,i;function s(){const a={signal:i.signal};if((t==null?void 0:t.timeout)!=null){const c=ct([i.signal,AbortSignal.timeout(t.timeout)]);a.signal=c}Promise.resolve().then(async()=>{await r(a)}).catch(()=>{}).finally(()=>{i.signal.aborted||(n=setTimeout(s,e))})}let o=!1;return{setInterval:a=>{e=a,n!=null&&(clearTimeout(n),n=setTimeout(s,e))},setTimeout:a=>{t==null&&(t={}),t.timeout=a},start:()=>{o||(o=!0,i=new AbortController,i.signal,(t==null?void 0:t.runImmediately)===!0?queueMicrotask(()=>{s()}):n=setTimeout(s,e))},stop:()=>{clearTimeout(n),i==null||i.abort(),o=!1}}}function Jn(r,e){const t=rd(r,e),n={read:async(i,s)=>{const o=await t.read(s);return i.decode(o)},write:async(i,s,o)=>{await t.write(s.encode(i),o)},writeV:async(i,s,o)=>{await t.writeV(i.map(a=>s.encode(a)),o)},pb:i=>({read:async s=>n.read(i,s),write:async(s,o)=>n.write(s,i,o),writeV:async(s,o)=>n.writeV(s,i,o),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}function Tye(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var Pye=SV,xT=128,Dye=-128,$ye=Math.pow(2,31);function SV(r,e,t){e=e||[],t=t||0;for(var n=t;r>=$ye;)e[t++]=r&255|xT,r/=128;for(;r&Dye;)e[t++]=r&255|xT,r>>>=7;return e[t]=r|0,SV.bytes=t-n+1,e}var Nye=Dv,Mye=128,AT=127;function Dv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Dv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&AT)<<i:(o&AT)*Math.pow(2,i),i+=7}while(o>=Mye);return Dv.bytes=s-n,t}var Oye=Math.pow(2,7),Rye=Math.pow(2,14),Lye=Math.pow(2,21),Bye=Math.pow(2,28),Uye=Math.pow(2,35),Fye=Math.pow(2,42),zye=Math.pow(2,49),Vye=Math.pow(2,56),Kye=Math.pow(2,63),Hye=function(r){return r<Oye?1:r<Rye?2:r<Lye?3:r<Bye?4:r<Uye?5:r<Fye?6:r<zye?7:r<Vye?8:r<Kye?9:10},jye={encode:Pye,decode:Nye,encodingLength:Hye},CT=jye;function IT(r,e=0){return[CT.decode(r,e),CT.decode.bytes]}function qye(r){const e=Tye(r),[t,n]=IT(e),[i,s]=IT(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Wye(t,i,o,e)}let Wye=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};const Gye="libp2p",Qye="autonat",Yye="1.0.0",Xye=3e4,Jye=2,Zye=20,eme=80,tme=8192;var _t;(function(r){(function(i){i.DIAL="DIAL",i.DIAL_RESPONSE="DIAL_RESPONSE"})(r.MessageType||(r.MessageType={}));let e;(function(i){i[i.DIAL=0]="DIAL",i[i.DIAL_RESPONSE=1]="DIAL_RESPONSE"})(e||(e={})),function(i){i.codec=()=>Dn(e)}(r.MessageType||(r.MessageType={})),function(i){i.OK="OK",i.E_DIAL_ERROR="E_DIAL_ERROR",i.E_DIAL_REFUSED="E_DIAL_REFUSED",i.E_BAD_REQUEST="E_BAD_REQUEST",i.E_INTERNAL_ERROR="E_INTERNAL_ERROR"}(r.ResponseStatus||(r.ResponseStatus={}));let t;(function(i){i[i.OK=0]="OK",i[i.E_DIAL_ERROR=100]="E_DIAL_ERROR",i[i.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",i[i.E_BAD_REQUEST=200]="E_BAD_REQUEST",i[i.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"})(t||(t={})),function(i){i.codec=()=>Dn(t)}(r.ResponseStatus||(r.ResponseStatus={})),function(i){let s;i.codec=()=>(s==null&&(s=Pe((o,a,c={})=>{if(c.lengthDelimited!==!1&&a.fork(),o.id!=null&&(a.uint32(10),a.bytes(o.id)),o.addrs!=null)for(const l of o.addrs)a.uint32(18),a.bytes(l);c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{var d;const l={addrs:[]},h=a==null?o.len:o.pos+a;for(;o.pos<h;){const p=o.uint32();switch(p>>>3){case 1:{l.id=o.bytes();break}case 2:{if(((d=c.limits)==null?void 0:d.addrs)!=null&&l.addrs.length===c.limits.addrs)throw new ht('Decode error - map field "addrs" had too many elements');l.addrs.push(o.bytes());break}default:{o.skipType(p&7);break}}}return l})),s),i.encode=o=>Te(o,i.codec()),i.decode=(o,a)=>_e(o,i.codec(),a)}(r.PeerInfo||(r.PeerInfo={})),function(i){let s;i.codec=()=>(s==null&&(s=Pe((o,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),o.peer!=null&&(a.uint32(10),r.PeerInfo.codec().encode(o.peer,a)),c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{var d;const l={},h=a==null?o.len:o.pos+a;for(;o.pos<h;){const p=o.uint32();switch(p>>>3){case 1:{l.peer=r.PeerInfo.codec().decode(o,o.uint32(),{limits:(d=c.limits)==null?void 0:d.peer});break}default:{o.skipType(p&7);break}}}return l})),s),i.encode=o=>Te(o,i.codec()),i.decode=(o,a)=>_e(o,i.codec(),a)}(r.Dial||(r.Dial={})),function(i){let s;i.codec=()=>(s==null&&(s=Pe((o,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),o.status!=null&&(a.uint32(8),r.ResponseStatus.codec().encode(o.status,a)),o.statusText!=null&&(a.uint32(18),a.string(o.statusText)),o.addr!=null&&(a.uint32(26),a.bytes(o.addr)),c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{const l={},h=a==null?o.len:o.pos+a;for(;o.pos<h;){const d=o.uint32();switch(d>>>3){case 1:{l.status=r.ResponseStatus.codec().decode(o);break}case 2:{l.statusText=o.string();break}case 3:{l.addr=o.bytes();break}default:{o.skipType(d&7);break}}}return l})),s),i.encode=o=>Te(o,i.codec()),i.decode=(o,a)=>_e(o,i.codec(),a)}(r.DialResponse||(r.DialResponse={}));let n;r.codec=()=>(n==null&&(n=Pe((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.type!=null&&(s.uint32(8),r.MessageType.codec().encode(i.type,s)),i.dial!=null&&(s.uint32(18),r.Dial.codec().encode(i.dial,s)),i.dialResponse!=null&&(s.uint32(26),r.DialResponse.codec().encode(i.dialResponse,s)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l,h;const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:{a.type=r.MessageType.codec().decode(i);break}case 2:{a.dial=r.Dial.codec().decode(i,i.uint32(),{limits:(l=o.limits)==null?void 0:l.dial});break}case 3:{a.dialResponse=r.DialResponse.codec().decode(i,i.uint32(),{limits:(h=o.limits)==null?void 0:h.dialResponse});break}default:{i.skipType(d&7);break}}}return a})),n),r.encode=i=>Te(i,r.codec()),r.decode=(i,s)=>_e(i,r.codec(),s)})(_t||(_t={}));const rme=4,nme=8;var wN,bN;class ime{constructor(e,t){u(this,"components");u(this,"protocol");u(this,"timeout");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"maxMessageSize");u(this,"started");u(this,"log");u(this,"topologyId");u(this,"dialResults");u(this,"findPeers");u(this,"addressFilter");u(this,"connectionThreshold");u(this,bN,"@libp2p/autonat");u(this,wN,["@libp2p/autonat"]);this.components=e,this.log=e.logger.forComponent("libp2p:auto-nat"),this.started=!1,this.protocol=`/${t.protocolPrefix??Gye}/${Qye}/${Yye}`,this.timeout=t.timeout??Xye,this.maxInboundStreams=t.maxInboundStreams??Jye,this.maxOutboundStreams=t.maxOutboundStreams??Zye,this.connectionThreshold=t.connectionThreshold??eme,this.maxMessageSize=t.maxMessageSize??tme,this.dialResults=new Map,this.findPeers=_ye(this.findRandomPeers.bind(this),6e4),this.addressFilter=jl(1024)}get[(bN=Symbol.toStringTag,wN=ur,mc)](){return["@libp2p/identify"]}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,e=>{this.handleIncomingAutonatStream(e).catch(t=>{this.log.error("error handling incoming autonat stream - %e",t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.topologyId=await this.components.registrar.register(this.protocol,{onConnect:(e,t)=>{this.verifyExternalAddresses(t).catch(n=>{this.log.error("could not verify addresses - %e",n)})}}),this.findPeers.start(),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),this.topologyId!=null&&await this.components.registrar.unhandle(this.topologyId),this.dialResults.clear(),this.findPeers.stop(),this.started=!1}allAddressesAreVerified(){return this.components.addressManager.getAddressesWithMetadata().every(e=>e.expires>Date.now()?!0:e.verified)}async findRandomPeers(e){if(this.allAddressesAreVerified())return;const t=ct([AbortSignal.timeout(1e4),e==null?void 0:e.signal]);try{this.log("starting random walk to find peers to run AutoNAT");for await(const n of this.components.randomWalk.walk({signal:t})){if(!await this.components.connectionManager.isDialable(n.multiaddrs)){this.log.trace("random peer %p was not dialable %s",n.id,n.multiaddrs.map(i=>i.toString()).join(", "));continue}try{this.log.trace("dial random peer %p",n.id),await this.components.connectionManager.openConnection(n.multiaddrs,{signal:t})}catch{}if(this.allAddressesAreVerified()){this.log("stopping random walk, all addresses are verified");return}if(!this.hasConnectionCapacity()){this.log("stopping random walk, too close to max connections");return}}}catch{}}async handleIncomingAutonatStream(e){const t=AbortSignal.timeout(this.timeout),n=Jn(e.stream,{maxDataLength:this.maxMessageSize}).pb(_t);try{const i=await n.read({signal:t}),s=await this.handleAutonatMessage(i,e.connection,{signal:t});await n.write(s,{signal:t}),await n.unwrap().unwrap().close({signal:t})}catch(i){this.log.error("error handling incoming autonat stream - %e",i),e.stream.abort(i)}}async handleAutonatMessage(e,t,n){const i=this.components.addressManager.getAddresses().map(d=>d.toOptions().host),s=e.dial;if(s==null)return this.log.error("dial was missing from message"),{type:_t.MessageType.DIAL_RESPONSE,dialResponse:{status:_t.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}};let o;const a=s.peer;if((a==null?void 0:a.id)==null)return this.log.error("PeerId missing from message"),{type:_t.MessageType.DIAL_RESPONSE,dialResponse:{status:_t.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}};try{const d=qye(a.id);o=ri(d)}catch(d){return this.log.error("invalid PeerId - %e",d),{type:_t.MessageType.DIAL_RESPONSE,dialResponse:{status:_t.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}}if(this.log("incoming request from %p",o),!t.remotePeer.equals(o))return this.log("target peer %p did not equal sending peer %p",o,t.remotePeer),{type:_t.MessageType.DIAL_RESPONSE,dialResponse:{status:_t.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}};const c=a.addrs.map(d=>$e(d)).filter(d=>{const p=d.toOptions();return Ql(d)?!1:p.host!==t.remoteAddr.toOptions().host?(this.log.trace("not dialing %a - target host did not match remote host %a",d,t.remoteAddr),!1):i.includes(p.host)?!1:this.components.transportManager.dialTransportForMultiaddr(d)==null?(this.log.trace("not dialing %a - transport unsupported",d),!1):!0}).map(d=>(d.getPeerId()==null&&(d=d.encapsulate(`/p2p/${o.toString()}`)),d));if(c.length===0)return this.log("refused to dial all multiaddrs for %p from message",o),{type:_t.MessageType.DIAL_RESPONSE,dialResponse:{status:_t.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}};this.log("dial multiaddrs %s for peer %p",c.map(d=>d.toString()).join(", "),o);let l="",h=c[0];for await(const d of c){let p;h=d;try{if(p=await this.components.connectionManager.openConnection(d,n),!p.remoteAddr.equals(d))throw this.log.error("tried to dial %a but dialed %a",d,p.remoteAddr),new Error("Unexpected remote address");return this.log("successfully dialed %p via %a",o,d),{type:_t.MessageType.DIAL_RESPONSE,dialResponse:{status:_t.ResponseStatus.OK,addr:p.remoteAddr.decapsulateCode(Ue("p2p").code).bytes}}}catch(m){this.log.error("could not dial %p - %e",o,m),l=m.message}finally{p!=null&&await p.close()}}return{type:_t.MessageType.DIAL_RESPONSE,dialResponse:{status:_t.ResponseStatus.E_DIAL_ERROR,statusText:l,addr:h.bytes}}}getFirstUnverifiedMultiaddr(e,t){var i,s;const n=this.components.addressManager.getAddressesWithMetadata().sort((o,a)=>o.type==="observed"&&a.type!=="observed"?1:a.type==="observed"&&o.type!=="observed"?-1:0).filter(o=>!(!(o.expires<Date.now())||o.multiaddr.toOptions().family===6&&(!t||!vV(o.multiaddr))||Ql(o.multiaddr)));for(const o of n){const a=o.multiaddr.toString();let c=this.dialResults.get(a);if(c!=null){if(c.networkSegments.includes(e)){this.log.trace("%a already has a network segment result from %s",c.multiaddr,e);continue}if(c.queue.size>10){this.log.trace("%a already has enough peers queued",c.multiaddr);continue}}if(c==null){const l=o.expires<Date.now();if(l&&((s=(i=this.addressFilter).remove)==null||s.call(i,a)),this.addressFilter.has(a))continue;this.addressFilter.add(a),this.log.trace("creating dial result %s %s",l?"to revalidate":"for",a),c={multiaddr:o.multiaddr,success:0,failure:0,networkSegments:[],verifyingPeers:Loe(),queue:new vc({concurrency:3,maxSize:50}),type:o.type,lastVerified:o.lastVerified},this.dialResults.set(a,c)}return c}}removeOutdatedMultiaddrResults(){const e=new Set(this.components.addressManager.getAddressesWithMetadata().filter(({expires:t})=>t<Date.now()).map(({multiaddr:t})=>t.toString()));for(const t of this.dialResults.keys())e.has(t)||(this.log.trace("remove results for %a",t),this.dialResults.delete(t))}async verifyExternalAddresses(e){if(!this.isStarted())return;this.removeOutdatedMultiaddrResults();const n=(await this.components.peerStore.get(e.remotePeer)).addresses.some(({multiaddr:o})=>o.toOptions().family===6),i=this.getNetworkSegment(e.remoteAddr),s=this.getFirstUnverifiedMultiaddr(i,n);if(s==null){this.log.trace("no unverified public addresses found for peer %p to verify, not requesting verification",e.remotePeer);return}if(!this.hasConnectionCapacity()){s.lastVerified!=null?(this.log("automatically re-verifying %a because we are too close to the connection limit",s.multiaddr),this.confirmAddress(s)):this.log("skipping verifying %a because we are too close to the connection limit",s.multiaddr);return}s.queue.add(async o=>{await this.askPeerToVerify(e,i,o)},{peerId:e.remotePeer,multiaddr:s.multiaddr}).catch(o=>{(s==null?void 0:s.result)==null&&this.log.error("error from %p verifying address %a - %e",e.remotePeer,s==null?void 0:s.multiaddr,o)})}async askPeerToVerify(e,t,n){let i=this.dialResults.get(n.multiaddr.toString());if(i==null){this.log("%a was verified while %p was queued",n.multiaddr,e.remotePeer);return}const s=AbortSignal.timeout(this.timeout);this.log.trace("asking %p to verify multiaddr %s",e.remotePeer,n.multiaddr);const o=await e.newStream(this.protocol,{signal:s});try{const a=Jn(o).pb(_t),[,c]=await Promise.all([a.write({type:_t.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toMultihash().bytes,addrs:[n.multiaddr.bytes]}}},{signal:s}),a.read({signal:s})]);if(c.type!==_t.MessageType.DIAL_RESPONSE||c.dialResponse==null){this.log("invalid autonat response from %p - %j",e.remotePeer,c);return}const l=c.dialResponse.status;if(this.log.trace("autonat response from %p for %a is %s",e.remotePeer,n.multiaddr,l),l!==_t.ResponseStatus.OK&&l!==_t.ResponseStatus.E_DIAL_ERROR)return;if(i=this.dialResults.get(n.multiaddr.toString()),i==null){this.log.trace("peer reported %a as %s but there is no result object",n.multiaddr,c.dialResponse.status);return}if(i.networkSegments.includes(t)){this.log.trace("%a results included network segment %s",n.multiaddr,t);return}if(i.result!=null){this.log.trace("already resolved result for %a, ignoring response from",n.multiaddr,e.remotePeer);return}if(i.verifyingPeers.has(e.remotePeer)){this.log.trace("peer %p has already verified %a, ignoring response",e.remotePeer,n.multiaddr);return}if(i.verifyingPeers.add(e.remotePeer),i.networkSegments.push(t),l===_t.ResponseStatus.OK){if(i.success++,i.type!=="observed"){this.confirmAddress(i);return}}else l===_t.ResponseStatus.E_DIAL_ERROR&&i.failure++;this.log("%a success %d failure %d",i.multiaddr,i.success,i.failure),i.success===rme&&this.confirmAddress(i),i.failure===nme&&this.unconfirmAddress(i)}finally{try{await o.close({signal:s})}catch(a){o.abort(a)}}}hasConnectionCapacity(){const t=this.components.connectionManager.getConnections().length,n=this.components.connectionManager.getMaxConnections();return t/n*100<this.connectionThreshold}confirmAddress(e){this.log("%s address %a is externally dialable",e.type,e.multiaddr),this.components.addressManager.confirmObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!0,e.queue.abort()}unconfirmAddress(e){this.log("%s address %a is not externally dialable",e.type,e.multiaddr),this.components.addressManager.removeObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!1,e.queue.abort()}getNetworkSegment(e){const t=e.toOptions();return t.family===4?t.host.split(".")[0].padStart(3,"0"):t.host.split(":")[0].padStart(4,"0")}}function sme(r={}){return e=>new ime(e,r)}const ome=pe("dns4"),ame=pe("dns6"),cme=pe("dnsaddr"),Yl=jt(pe("dns"),cme,ome,ame),Bw=jt(pe("ip4"),pe("ip6")),id=jt(ke(Bw,pe("tcp")),ke(Yl,pe("tcp"))),Uw=ke(Bw,pe("udp")),lme=ke(Uw,pe("utp")),ume=ke(Uw,pe("quic")),hme=ke(Uw,pe("quic-v1")),$v=jt(ke(id,pe("ws")),ke(Yl,pe("ws"))),lm=jt(ke($v,pe("p2p")),$v),Nv=jt(ke(id,pe("wss")),ke(Yl,pe("wss")),ke(id,pe("tls"),pe("ws")),ke(Yl,pe("tls"),pe("ws"))),um=jt(ke(Nv,pe("p2p")),Nv),Mv=jt(ke(id,pe("http")),ke(Bw,pe("http")),ke(Yl,pe("http"))),Ov=jt(ke(id,pe("https")),ke(Bw,pe("https")),ke(Yl,pe("https"))),kT=ke(Uw,pe("webrtc-direct"),pe("certhash")),xV=jt(ke(kT,pe("p2p")),kT),_T=ke(hme,pe("webtransport"),pe("certhash"),pe("certhash")),AV=jt(ke(_T,pe("p2p")),_T),CV=jt(ke(lm,pe("p2p-webrtc-star"),pe("p2p")),ke(um,pe("p2p-webrtc-star"),pe("p2p")),ke(lm,pe("p2p-webrtc-star")),ke(um,pe("p2p-webrtc-star")));jt(ke(lm,pe("p2p-websocket-star"),pe("p2p")),ke(um,pe("p2p-websocket-star"),pe("p2p")),ke(lm,pe("p2p-websocket-star")),ke(um,pe("p2p-websocket-star")));const IV=jt(ke(Mv,pe("p2p-webrtc-direct"),pe("p2p")),ke(Ov,pe("p2p-webrtc-direct"),pe("p2p")),ke(Mv,pe("p2p-webrtc-direct")),ke(Ov,pe("p2p-webrtc-direct"))),Xl=jt($v,Nv,Mv,Ov,CV,IV,id,lme,ume,Yl,xV,AV);jt(ke(Xl,pe("p2p-stardust"),pe("p2p")),ke(Xl,pe("p2p-stardust")));const qa=jt(ke(Xl,pe("p2p")),CV,IV,xV,AV,pe("p2p")),TT=jt(ke(qa,pe("p2p-circuit"),qa),ke(qa,pe("p2p-circuit")),ke(pe("p2p-circuit"),qa),ke(Xl,pe("p2p-circuit")),ke(pe("p2p-circuit"),Xl),pe("p2p-circuit")),kV=()=>jt(ke(TT,kV),TT),al=kV(),dme=jt(ke(al,qa,al),ke(qa,al),ke(al,qa),al,qa);jt(ke(al,pe("webrtc"),pe("p2p")),ke(al,pe("webrtc")),ke(Xl,pe("webrtc"),pe("p2p")),ke(Xl,pe("webrtc")),pe("webrtc"));function _V(r){function e(t){let n;try{n=$e(t)}catch{return!1}const i=r(n.protoNames());return i===null?!1:i===!0||i===!1?i:i.length===0}return e}function ke(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(i=>(n=typeof i=="function"?i().partialMatch(t):i.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:_V(e),partialMatch:e}}function jt(...r){function e(n){let i=null;return r.some(s=>{const o=typeof s=="function"?s().partialMatch(n):s.partialMatch(n);return o!=null?(i=o,!0):!1}),i}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:_V(e),partialMatch:e}}function pe(r){const e=r;function t(i){let s;try{s=$e(i)}catch{return!1}const o=s.protoNames();return o.length===1&&o[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}const fme="bootstrap",pme=50,gme=1e3;var vN,EN,SN,xN;class TV extends(xN=Yt,SN=ey,EN=Symbol.toStringTag,vN=ur,xN){constructor(t,n={list:[]}){if(n.list==null||n.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super();u(this,"log");u(this,"timer");u(this,"list");u(this,"timeout");u(this,"components");u(this,"_init");u(this,SN,this);u(this,EN,"@libp2p/bootstrap");u(this,vN,["@libp2p/peer-discovery"]);this.components=t,this.log=t.logger.forComponent("libp2p:bootstrap"),this.timeout=n.timeout??gme,this.list=[];for(const i of n.list){if(!dme.matches(i)){this.log.error("Invalid multiaddr");continue}const s=$e(i),o=s.getPeerId();if(o==null){this.log.error("Invalid bootstrap multiaddr without peer id");continue}const a={id:Wt(o),multiaddrs:[s]};this.list.push(a)}this._init=n}isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(t=>{this.log.error(t)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(const t of this.list){if(await this.components.peerStore.merge(t.id,{tags:{[this._init.tagName??fme]:{value:this._init.tagValue??pme,ttl:this._init.tagTTL}},multiaddrs:t.multiaddrs}),this.timer==null)return;this.safeDispatchEvent("peer",{detail:t}),this.components.connectionManager.openConnection(t.id).catch(n=>{this.log.error("could not dial bootstrap peer %p",t.id,n)})}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}}u(TV,"tag","bootstrap");function PV(r){return e=>new TV(e,r)}var hm;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(n.uint32(26),n.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={publicKey:We(0),payloadType:We(0),payload:We(0),signature:We(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.publicKey=t.bytes();break}case 2:{s.payloadType=t.bytes();break}case 3:{s.payload=t.bytes();break}case 5:{s.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(hm||(hm={}));class yme extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}}const Na=class Na{constructor(e){u(this,"publicKey");u(this,"payloadType");u(this,"payload");u(this,"signature");u(this,"marshaled");const{publicKey:t,payloadType:n,payload:i,signature:s}=e;this.publicKey=t,this.payloadType=n,this.payload=i,this.signature=s}marshal(){return this.marshaled==null&&(this.marshaled=hm.encode({publicKey:_i(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return Ke(this.marshal(),e.marshal())}async validate(e){const t=PT(e,this.payloadType,this.payload);return this.publicKey.verify(t.subarray(),this.signature)}};u(Na,"createFromProtobuf",async e=>{const t=hm.decode(e),n=$n(t.publicKey);return new Na({publicKey:n,payloadType:t.payloadType,payload:t.payload,signature:t.signature})}),u(Na,"seal",async(e,t)=>{if(t==null)throw new Error("Missing private key");const n=e.domain,i=e.codec,s=e.marshal(),o=PT(n,i,s),a=await t.sign(o.subarray());return new Na({publicKey:t.publicKey,payloadType:i,payload:s,signature:a})}),u(Na,"openAndCertify",async(e,t)=>{const n=await Na.createFromProtobuf(e);if(!await n.validate(t))throw new yme("Envelope signature is not valid for the given domain");return n});let Ac=Na;const PT=(r,e,t)=>{const n=se(r),i=br(n.byteLength),s=br(e.length),o=br(t.length);return new Le(i,n,s,e,o,t)};function mme(r,e){const t=(n,i)=>n.toString().localeCompare(i.toString());return r.length!==e.length?!1:(e.sort(t),r.sort(t).every((n,i)=>e[i].equals(n)))}function wme(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var bme=DV,DT=128,vme=-128,Eme=Math.pow(2,31);function DV(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Eme;)e[t++]=r&255|DT,r/=128;for(;r&vme;)e[t++]=r&255|DT,r>>>=7;return e[t]=r|0,DV.bytes=t-n+1,e}var Sme=Rv,xme=128,$T=127;function Rv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Rv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&$T)<<i:(o&$T)*Math.pow(2,i),i+=7}while(o>=xme);return Rv.bytes=s-n,t}var Ame=Math.pow(2,7),Cme=Math.pow(2,14),Ime=Math.pow(2,21),kme=Math.pow(2,28),_me=Math.pow(2,35),Tme=Math.pow(2,42),Pme=Math.pow(2,49),Dme=Math.pow(2,56),$me=Math.pow(2,63),Nme=function(r){return r<Ame?1:r<Cme?2:r<Ime?3:r<kme?4:r<_me?5:r<Tme?6:r<Pme?7:r<Dme?8:r<$me?9:10},Mme={encode:bme,decode:Sme,encodingLength:Nme},NT=Mme;function MT(r,e=0){return[NT.decode(r,e),NT.decode.bytes]}function Ome(r){const e=wme(r),[t,n]=MT(e),[i,s]=MT(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Rme(t,i,o,e)}let Rme=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};const Lme="libp2p-peer-record",Bme=Uint8Array.from([3,1]);var dm;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=Pe((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.multiaddr!=null&&i.multiaddr.byteLength>0&&(s.uint32(10),s.bytes(i.multiaddr)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={multiaddr:We(0)},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.multiaddr=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>Te(i,t.codec()),t.decode=(i,s)=>_e(i,t.codec(),s)})(r.AddressInfo||(r.AddressInfo={}));let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.peerId!=null&&t.peerId.byteLength>0&&(n.uint32(10),n.bytes(t.peerId)),t.seq!=null&&t.seq!==0n&&(n.uint32(16),n.uint64(t.seq)),t.addresses!=null)for(const s of t.addresses)n.uint32(26),r.AddressInfo.codec().encode(s,n);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={peerId:We(0),seq:0n,addresses:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.peerId=t.bytes();break}case 2:{s.seq=t.uint64();break}case 3:{if(((a=i.limits)==null?void 0:a.addresses)!=null&&s.addresses.length===i.limits.addresses)throw new ht('Decode error - map field "addresses" had too many elements');s.addresses.push(r.AddressInfo.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.addresses$}));break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(dm||(dm={}));const ao=class ao{constructor(e){u(this,"peerId");u(this,"multiaddrs");u(this,"seqNumber");u(this,"domain",ao.DOMAIN);u(this,"codec",ao.CODEC);u(this,"marshaled");const{peerId:t,multiaddrs:n,seqNumber:i}=e;this.peerId=t,this.multiaddrs=n??[],this.seqNumber=i??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=dm.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof ao)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!mme(this.multiaddrs,e.multiaddrs))}};u(ao,"createFromProtobuf",e=>{const t=dm.decode(e),n=ri(Ome(t.peerId)),i=(t.addresses??[]).map(o=>$e(o.multiaddr)),s=t.seq;return new ao({peerId:n,multiaddrs:i,seqNumber:s})}),u(ao,"DOMAIN",Lme),u(ao,"CODEC",Bme);let Bs=ao;function $V(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var Ume=NV,OT=128,Fme=-128,zme=Math.pow(2,31);function NV(r,e,t){e=e||[],t=t||0;for(var n=t;r>=zme;)e[t++]=r&255|OT,r/=128;for(;r&Fme;)e[t++]=r&255|OT,r>>>=7;return e[t]=r|0,NV.bytes=t-n+1,e}var Vme=Lv,Kme=128,RT=127;function Lv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Lv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&RT)<<i:(o&RT)*Math.pow(2,i),i+=7}while(o>=Kme);return Lv.bytes=s-n,t}var Hme=Math.pow(2,7),jme=Math.pow(2,14),qme=Math.pow(2,21),Wme=Math.pow(2,28),Gme=Math.pow(2,35),Qme=Math.pow(2,42),Yme=Math.pow(2,49),Xme=Math.pow(2,56),Jme=Math.pow(2,63),Zme=function(r){return r<Hme?1:r<jme?2:r<qme?3:r<Wme?4:r<Gme?5:r<Qme?6:r<Yme?7:r<Xme?8:r<Jme?9:10},e3e={encode:Ume,decode:Vme,encodingLength:Zme},LT=e3e;function BT(r,e=0){return[LT.decode(r,e),LT.decode.bytes]}function t3e(r){const e=$V(r),[t,n]=BT(e),[i,s]=BT(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new r3e(t,i,o,e)}let r3e=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};const n3e=290,i3e=1,MV=2e3,s3e=100,lg=`${X3}-circuit-relay`;BigInt(1<<17);const fm="/libp2p/circuit/relay/0.2.0/hop",UT="/libp2p/circuit/relay/0.2.0/stop",FT=300,o3e=4096,a3e=.001;var sd;(function(r){(function(n){n.RESERVE="RESERVE",n.CONNECT="CONNECT",n.STATUS="STATUS"})(r.Type||(r.Type={}));let e;(function(n){n[n.RESERVE=0]="RESERVE",n[n.CONNECT=1]="CONNECT",n[n.STATUS=2]="STATUS"})(e||(e={})),function(n){n.codec=()=>Dn(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=Pe((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.peer!=null&&(i.uint32(18),od.codec().encode(n.peer,i)),n.reservation!=null&&(i.uint32(26),pm.codec().encode(n.reservation,i)),n.limit!=null&&(i.uint32(34),ad.codec().encode(n.limit,i)),n.status!=null&&(i.uint32(40),rn.codec().encode(n.status,i)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{var c,l,h;const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const d=n.uint32();switch(d>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.peer=od.codec().decode(n,n.uint32(),{limits:(c=s.limits)==null?void 0:c.peer});break}case 3:{o.reservation=pm.codec().decode(n,n.uint32(),{limits:(l=s.limits)==null?void 0:l.reservation});break}case 4:{o.limit=ad.codec().decode(n,n.uint32(),{limits:(h=s.limits)==null?void 0:h.limit});break}case 5:{o.status=rn.codec().decode(n);break}default:{n.skipType(d&7);break}}}return o})),t),r.encode=n=>Te(n,r.codec()),r.decode=(n,i)=>_e(n,r.codec(),i)})(sd||(sd={}));var oo;(function(r){(function(n){n.CONNECT="CONNECT",n.STATUS="STATUS"})(r.Type||(r.Type={}));let e;(function(n){n[n.CONNECT=0]="CONNECT",n[n.STATUS=1]="STATUS"})(e||(e={})),function(n){n.codec=()=>Dn(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=Pe((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.peer!=null&&(i.uint32(18),od.codec().encode(n.peer,i)),n.limit!=null&&(i.uint32(26),ad.codec().encode(n.limit,i)),n.status!=null&&(i.uint32(32),rn.codec().encode(n.status,i)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{var c,l;const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const h=n.uint32();switch(h>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.peer=od.codec().decode(n,n.uint32(),{limits:(c=s.limits)==null?void 0:c.peer});break}case 3:{o.limit=ad.codec().decode(n,n.uint32(),{limits:(l=s.limits)==null?void 0:l.limit});break}case 4:{o.status=rn.codec().decode(n);break}default:{n.skipType(h&7);break}}}return o})),t),r.encode=n=>Te(n,r.codec()),r.decode=(n,i)=>_e(n,r.codec(),i)})(oo||(oo={}));var od;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.addrs!=null)for(const s of t.addrs)n.uint32(18),n.bytes(s);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={id:We(0),addrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.id=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.addrs)!=null&&s.addrs.length===i.limits.addrs)throw new ht('Decode error - map field "addrs" had too many elements');s.addrs.push(t.bytes());break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(od||(od={}));var pm;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.expire!=null&&t.expire!==0n&&(n.uint32(8),n.uint64(t.expire)),t.addrs!=null)for(const s of t.addrs)n.uint32(18),n.bytes(s);t.voucher!=null&&(n.uint32(26),ym.codec().encode(t.voucher,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={expire:0n,addrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.expire=t.uint64();break}case 2:{if(((a=i.limits)==null?void 0:a.addrs)!=null&&s.addrs.length===i.limits.addrs)throw new ht('Decode error - map field "addrs" had too many elements');s.addrs.push(t.bytes());break}case 3:{s.voucher=ym.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.voucher});break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(pm||(pm={}));var ad;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.duration!=null&&(n.uint32(8),n.uint32(t.duration)),t.data!=null&&(n.uint32(16),n.uint64(t.data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.duration=t.uint32();break}case 2:{s.data=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(ad||(ad={}));var rn;(function(r){r.UNUSED="UNUSED",r.OK="OK",r.RESERVATION_REFUSED="RESERVATION_REFUSED",r.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONNECTION_FAILED="CONNECTION_FAILED",r.NO_RESERVATION="NO_RESERVATION",r.MALFORMED_MESSAGE="MALFORMED_MESSAGE",r.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"})(rn||(rn={}));var Bv;(function(r){r[r.UNUSED=0]="UNUSED",r[r.OK=100]="OK",r[r.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",r[r.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",r[r.PERMISSION_DENIED=202]="PERMISSION_DENIED",r[r.CONNECTION_FAILED=203]="CONNECTION_FAILED",r[r.NO_RESERVATION=204]="NO_RESERVATION",r[r.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",r[r.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"})(Bv||(Bv={}));(function(r){r.codec=()=>Dn(Bv)})(rn||(rn={}));var gm;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.relay!=null&&t.relay.byteLength>0&&(n.uint32(10),n.bytes(t.relay)),t.peer!=null&&t.peer.byteLength>0&&(n.uint32(18),n.bytes(t.peer)),t.expiration!=null&&t.expiration!==0n&&(n.uint32(24),n.uint64(t.expiration)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={relay:We(0),peer:We(0),expiration:0n},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.relay=t.bytes();break}case 2:{s.peer=t.bytes();break}case 3:{s.expiration=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(gm||(gm={}));var ym;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&(n.uint32(26),gm.codec().encode(t.payload,n)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={publicKey:We(0),payloadType:We(0),signature:We(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.publicKey=t.bytes();break}case 2:{s.payloadType=t.bytes();break}case 3:{s.payload=gm.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.payload});break}case 5:{s.signature=t.bytes();break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(ym||(ym={}));function c3e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var l3e=c3e,u3e=l3e;let h3e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},d3e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return OV(this,e)}},f3e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return OV(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function OV(r,e){return new f3e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let p3e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new h3e(e,t,n),this.decoder=new d3e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function RV({name:r,prefix:e,encode:t,decode:n}){return new p3e(r,e,t,n)}function Fw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=u3e(t,r);return RV({prefix:e,name:r,encode:n,decode:s=>$V(i(s))})}function g3e(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function y3e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Jo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return RV({prefix:e,name:r,encode(i){return y3e(i,n,t)},decode(i){return g3e(i,n,t,r)}})}Jo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Jo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Jo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Jo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Jo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Jo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Jo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Jo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Jo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});Fw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Fw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});Fw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Fw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});class Uv extends Error{constructor(){super(...arguments);u(this,"name","HadEnoughRelaysError")}}u(Uv,"name","HadEnoughRelaysError");class LV extends Error{constructor(){super(...arguments);u(this,"name","DoubleRelayError")}}u(LV,"name","DoubleRelayError");class BV extends Error{constructor(){super(...arguments);u(this,"name","RelayQueueFullError")}}u(BV,"name","RelayQueueFullError");function zT(r){const e=r*BigInt(1e3),t=new Date().getTime();return Number(e-BigInt(t))}class VT{constructor(e){u(this,"expires");u(this,"bytes");(e==null?void 0:e.duration)!=null&&(e==null?void 0:e.duration)!==0&&(this.expires=Date.now()+e.duration*1e3),this.bytes=e==null?void 0:e.data,this.bytes===0n&&(this.bytes=void 0),this.onData=this.onData.bind(this)}onData(e){this.bytes!=null&&(this.bytes-=BigInt(e.byteLength),this.bytes<0n&&(this.bytes=0n))}getLimits(){if(this.expires==null&&this.bytes==null)return;const e={};if(this.bytes!=null){const t=this;Object.defineProperty(e,"bytes",{get(){return t.bytes}})}if(this.expires!=null){const t=this;Object.defineProperty(e,"seconds",{get(){return Math.round(((t.expires??0)-Date.now())/1e3)}})}return e}}const UV=Et(Qe(nz.matchers[0],Ge("p2p-circuit"))),FV=Et(Ge("p2p-circuit"));function KT(r){const{stream:e,remoteAddr:t,logger:n,onDataRead:i,onDataWrite:s}=r,o=n.forComponent("libp2p:stream:converter");let a=!1,c=!1;const l=e.close.bind(e);e.close=async f=>{await l(f),m(!0)};const h=e.abort.bind(e);e.abort=f=>{h(f),m(!0)};const d=e.sink.bind(e);e.sink=async f=>{try{await d(cn(f,g=>Ly(g,v=>s==null?void 0:s(v))))}catch(g){g.type!=="aborted"&&o.error("%s error in sink",t,g)}finally{c=!0,m()}};const p={log:o,sink:e.sink,source:async function*(){try{for await(const f of e.source)i==null||i(f),yield f}finally{a=!0,m()}}(),remoteAddr:t,timeline:{open:Date.now(),close:void 0},close:e.close,abort:e.abort};function m(f){f===!0&&(a=!0,c=!0),a&&c&&p.timeline.close==null&&(p.timeline.close=Date.now())}return p}class m3e extends Yt{constructor(t,n={}){super();u(this,"peerStore");u(this,"registrar");u(this,"connectionManager");u(this,"randomWalk");u(this,"started");u(this,"running");u(this,"topologyId");u(this,"log");u(this,"discoveryController");u(this,"filter");u(this,"queue");this.log=t.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.started=!1,this.running=!1,this.peerStore=t.peerStore,this.registrar=t.registrar,this.connectionManager=t.connectionManager,this.randomWalk=t.randomWalk,this.filter=n.filter,this.discoveryController=new AbortController,this.discoveryController.signal}isStarted(){return this.started}async start(){this.topologyId=await this.registrar.register(fm,{filter:this.filter,onConnect:t=>{var n,i;this.log.trace("discovered relay %p queue (length: %d, active %d)",t,(n=this.queue)==null?void 0:n.size,(i=this.queue)==null?void 0:i.running),this.safeDispatchEvent("relay:discover",{detail:t})}}),this.started=!0}stop(){var t;this.topologyId!=null&&this.registrar.unregister(this.topologyId),(t=this.discoveryController)==null||t.abort(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,this.discoveryController.signal,Promise.resolve().then(async()=>{var i;this.log("searching peer store for relays");const t=await this.peerStore.all({filters:[s=>s.protocols.includes(fm)],orders:[()=>Math.random()<.5?1:-1,(s,o)=>{const a=HT(s),c=HT(o);return a>c?-1:c>a?1:0}]});for(const s of t)this.log.trace("found relay peer %p in peer store",s.id),this.safeDispatchEvent("relay:discover",{detail:s.id});this.log("found %d relay peers in peer store",t.length);const n=this.queue=new vc({concurrency:5});this.log("start random walk");for await(const s of this.randomWalk.walk({signal:this.discoveryController.signal})){if(this.log.trace("found random peer %p",s.id),n.has(s.id)){this.log.trace("random peer %p was already in queue",s.id);continue}if(((i=this.connectionManager.getConnections(s.id))==null?void 0:i.length)>0){this.log.trace("random peer %p was already connected",s.id);continue}if(!await this.connectionManager.isDialable(s.multiaddrs)){this.log.trace("random peer %p was not dialable",s.id,s.multiaddrs.map(o=>o.toString()));continue}n.queued>10&&(this.log.trace("wait for space in queue for %p",s.id),await n.onSizeLessThan(10,{signal:this.discoveryController.signal})),this.log("adding random peer %p to dial queue (length: %d, active %d)",s.id,n.size,n.running),n.add(async()=>{const o=ct([this.discoveryController.signal,AbortSignal.timeout(5e3)]);try{await this.connectionManager.openConnection(s.id,{signal:o})}finally{o.clear()}},{peerId:s.id,signal:this.discoveryController.signal}).catch(o=>{this.log.error("error opening connection to random peer %p",s.id,o)})}this.log("stop random walk"),await n.onIdle()}).catch(t=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network",t)}))}stopDiscovery(){var t;this.log("stop discovery"),this.running=!1,(t=this.discoveryController)==null||t.abort()}}function HT(r){const e=r.metadata.get("last-dial-success");return e==null?0:new Date(re(e)).getTime()}class w3e extends Yt{constructor(t,n={}){super();u(this,"connectionManager");u(this,"addressManager");u(this,"reservationStore");u(this,"listeningAddrs");u(this,"log");u(this,"listenTimeout");u(this,"reservationId");u(this,"relay");u(this,"_onRemoveRelayPeer",t=>{var n,i;this.log("relay removed %p our relay %p",t.detail.relay,this.relay,(n=this.relay)==null?void 0:n.equals(t.detail.relay)),((i=this.relay)==null?void 0:i.equals(t.detail.relay))===!0&&(this.log("relay peer removed %p",t.detail.relay),this.listeningAddrs.forEach(s=>{this.addressManager.removeObservedAddr(s)}),this.listeningAddrs=[],this.safeDispatchEvent("listening"))});u(this,"_onAddRelayPeer",t=>{const{details:n}=t.detail;n.type!=="configured"&&n.id===this.reservationId&&this.addedRelay(t.detail)});this.log=t.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=t.connectionManager,this.addressManager=t.addressManager,this.reservationStore=t.reservationStore,this.listeningAddrs=[],this.listenTimeout=n.listenTimeout??MV,this.reservationStore.addEventListener("relay:removed",this._onRemoveRelayPeer),this.reservationStore.addEventListener("relay:created-reservation",this._onAddRelayPeer)}async listen(t){if(FV.exactMatch(t))this.log("searching for circuit relay servers"),this.reservationId=this.reservationStore.reserveRelay();else if(UV.exactMatch(t)){this.log("listen on specific relay server %a",t);const n=AbortSignal.timeout(this.listenTimeout),i=t.decapsulate("/p2p-circuit"),s=await this.connectionManager.openConnection(i,{signal:n});if(!this.reservationStore.hasReservation(s.remotePeer)){this.log("making reservation on peer %p",s.remotePeer);const o=await this.reservationStore.addRelay(s.remotePeer,"configured");this.addedRelay(o)}}else throw new ny(`Could not listen on p2p-circuit address "${t}"`)}getAddrs(){return[...this.listeningAddrs.values()].flat()}updateAnnounceAddrs(){}async close(){this.reservationStore.cancelReservations(),this.listeningAddrs=[],this.reservationStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),queueMicrotask(()=>{this.safeDispatchEvent("close")})}addedRelay(t){this.log("relay peer added %p",t.relay),this.relay=t.relay,this.listeningAddrs=t.details.reservation.addrs.map(n=>$e(n).encapsulate("/p2p-circuit")),this.listeningAddrs.forEach(n=>{this.addressManager.confirmObservedAddr(n,{type:"transport"})}),queueMicrotask(()=>{this.safeDispatchEvent("listening")})}}function b3e(r){return new w3e(r)}const v3e="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let E3e=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=v3e[t[r]&63];return e};const S3e=60*1e3*10,x3e=60*1e3*5,A3e=30*1e3;var An,zV,Wf,Gf;class C3e extends Yt{constructor(t,n){super();qe(this,An);u(this,"peerId");u(this,"connectionManager");u(this,"peerStore");u(this,"events");u(this,"reserveQueue");u(this,"reservations");u(this,"pendingReservations");u(this,"maxReservationQueueLength");u(this,"reservationCompletionTimeout");u(this,"started");u(this,"log");u(this,"relayFilter");this.log=t.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=t.peerId,this.connectionManager=t.connectionManager,this.peerStore=t.peerStore,this.events=t.events,this.reservations=new Oc,this.pendingReservations=[],this.maxReservationQueueLength=(n==null?void 0:n.maxReservationQueueLength)??s3e,this.reservationCompletionTimeout=(n==null?void 0:n.reservationCompletionTimeout)??MV,this.started=!1,this.relayFilter=jl(100),this.reserveQueue=new vc({concurrency:(n==null?void 0:n.reservationConcurrency)??i3e,metricName:"libp2p_relay_reservation_queue",metrics:t.metrics}),this.events.addEventListener("connection:close",i=>{[...this.reservations.values()].find(o=>o.connection===i.detail.id)!=null&&Ae(this,An,Wf).call(this,i.detail.remotePeer).catch(o=>{this.log("could not remove relay %p - %e",i.detail,o)})})}isStarted(){return this.started}start(){this.started=!0}afterStart(){Promise.resolve().then(async()=>{const t=await this.peerStore.all({filters:[n=>n.tags.has(lg)]});this.log("removing tag from %d old relays",t.length),await Promise.all(t.map(async n=>{await this.peerStore.merge(n.id,{tags:{[lg]:void 0}})})),this.log("redialing %d old relays",t.length),await Promise.all(t.map(async n=>this.addRelay(n.id,"discovered"))),Ae(this,An,Gf).call(this)}).catch(t=>{this.log.error(t)})}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:t})=>{clearTimeout(t)}),this.reservations.clear(),this.started=!1}reserveRelay(){const t=E3e();return this.pendingReservations.push(t),Ae(this,An,Gf).call(this),t}async addRelay(t,n){if(this.peerId.equals(t))throw this.log.trace("not trying to use self as relay"),new ny("Cannot use self as relay");if(this.reserveQueue.size>this.maxReservationQueueLength)throw new BV("The reservation queue is full");const i=this.reserveQueue.find(t);if(i!=null)return this.log.trace("potential relay peer %p is already in the reservation queue",t),i.join();if(this.relayFilter.has(t.toMultihash().bytes))throw new ny("The relay was previously invalid");return this.log.trace("try to reserve relay slot with %p",t),this.reserveQueue.add(async()=>{const s=Date.now();try{const o=this.reservations.get(t);if(o!=null){const g=this.connectionManager.getConnections(t);let v=!1;if(g.length===0&&this.log("already have relay reservation with %p but we are no longer connected",t),g.map(y=>y.id).includes(o.connection)&&(this.log("already have relay reservation with %p and the original connection is still open",t),v=!0),v&&zT(o.reservation.expire)>S3e)return this.log("already have relay reservation with %p but we are still connected and it does not expire soon",t),{relay:t,details:o};await Ae(this,An,Wf).call(this,t)}if(n==="discovered"&&this.pendingReservations.length===0)throw new Uv("Not making reservation on discovered relay because we do not need any more relays");const a=AbortSignal.timeout(this.reservationCompletionTimeout);const c=await this.connectionManager.openConnection(t,{signal:a});if(Sc.matches(c.remoteAddr))throw new LV("not creating reservation over relayed connection");const l=await Ae(this,An,zV).call(this,c,{signal:a}),h=zT(l.expire);this.log("created reservation on relay peer %p, expiry date is %s",t,new Date(Date.now()+h).toString());const d=Math.min(Math.max(h-x3e,A3e),Math.pow(2,31)-1),p=setTimeout(()=>{this.log("refresh reservation to relay %p",t),this.addRelay(t,n).catch(async g=>{this.log.error("could not refresh reservation to relay %p - %e",t,g),await Ae(this,An,Wf).call(this,t)}).catch(g=>{this.log.error("could not remove expired reservation to relay %p - %e",t,g)})},d);let m;if(n==="discovered"){const g=this.pendingReservations.pop();if(g==null)throw new Uv("Made reservation on relay but did not need any more discovered relays");m={timeout:p,reservation:l,type:n,connection:c.id,id:g}}else m={timeout:p,reservation:l,type:n,connection:c.id};this.reservations.set(t,m),await this.peerStore.merge(t,{tags:{[lg]:{value:1,ttl:h}}}),Ae(this,An,Gf).call(this);const f={relay:t,details:m};return this.safeDispatchEvent("relay:created-reservation",{detail:f}),f}catch(o){throw n==="discovered"&&o.name==="HadEnoughRelaysError"||this.log.error("could not reserve slot on %p after %dms - %e",t,Date.now()-s,o),(o.name==="DialError"||o.name==="UnsupportedProtocolError")&&this.relayFilter.add(t.toMultihash().bytes),Ae(this,An,Wf).call(this,t).catch(a=>{this.log.error("could not remove reservation on %p after reserving slot failed - %e",t,a)}),o}},{peerId:t})}hasReservation(t){return this.reservations.has(t)}getReservation(t){var n;return(n=this.reservations.get(t))==null?void 0:n.reservation}reservationCount(t){return t==null?this.reservations.size:[...this.reservations.values()].reduce((n,i)=>(i.type===t&&n++,n),0)}cancelReservations(){[...this.reservations.values()].forEach(t=>{clearTimeout(t.timeout)}),this.reservations.clear()}}An=new WeakSet,zV=async function(t,n){var l;(l=n.signal)==null||l.throwIfAborted(),this.log("requesting reservation from %p",t.remotePeer);const i=await t.newStream(fm,n),o=Jn(i).pb(sd);this.log.trace("send RESERVE to %p",t.remotePeer),await o.write({type:sd.Type.RESERVE},n);let a;try{this.log.trace("reading response from %p",t.remotePeer),a=await o.read(n)}catch(h){throw i.abort(h),h}finally{i.status!=="closed"&&await i.close(n)}if(this.log.trace("read response %o",a),a.status===rn.OK&&a.reservation!=null){const h=new Set;h.add(t.remoteAddr.toString());for(const d of a.reservation.addrs){let p=$e(d);p.getPeerId()==null&&(p=p.encapsulate(`/p2p/${t.remotePeer}`)),p=$e(p.toString().replace(`/p2p/${t.remotePeer}/p2p/${t.remotePeer}`,`/p2p/${t.remotePeer}`)),h.add(p.toString())}return a.reservation.addrs=[...h].map(d=>$e(d).bytes),a.reservation}const c=`reservation failed with status ${a.status??"undefined"}`;throw this.log.error(c),new Error(c)},Wf=async function(t){const n=this.reservations.get(t);n!=null&&(this.log("removing relay reservation with %p from local store",t),clearTimeout(n.timeout),this.reservations.delete(t),n.type==="discovered"&&this.pendingReservations.push(n.id),await this.peerStore.merge(t,{tags:{[lg]:void 0}}),this.safeDispatchEvent("relay:removed",{detail:{relay:t,details:n}}),Ae(this,An,Gf).call(this))},Gf=function(){if(this.pendingReservations.length===0){this.log.trace("have discovered enough relays"),this.reserveQueue.clear(),this.safeDispatchEvent("relay:found-enough-relays");return}this.relayFilter=jl(100),this.log("not discovered enough relays %d/%d",this.reservations.size,this.pendingReservations.length),this.safeDispatchEvent("relay:not-enough-relays")};const I3e=r=>{if(r.peer==null)return!1;try{r.peer.addrs.forEach($e)}catch{return!1}return!0},jT={maxInboundStopStreams:FT,maxOutboundStopStreams:FT};var AN,CN,IN,kN;class k3e{constructor(e,t={}){u(this,"discovery");u(this,"registrar");u(this,"peerStore");u(this,"connectionManager");u(this,"transportManager");u(this,"peerId");u(this,"upgrader");u(this,"addressManager");u(this,"connectionGater");u(this,"reservationStore");u(this,"logger");u(this,"maxInboundStopStreams");u(this,"maxOutboundStopStreams");u(this,"started");u(this,"log");u(this,"shutdownController");u(this,kN,"@libp2p/circuit-relay-v2-transport");u(this,IN,["@libp2p/transport","@libp2p/circuit-relay-v2-transport"]);u(this,AN,!0);this.log=e.logger.forComponent("libp2p:circuit-relay:transport"),this.registrar=e.registrar,this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.logger=e.logger,this.peerId=e.peerId,this.upgrader=e.upgrader,this.addressManager=e.addressManager,this.connectionGater=e.connectionGater,this.maxInboundStopStreams=t.maxInboundStopStreams??jT.maxInboundStopStreams,this.maxOutboundStopStreams=t.maxOutboundStopStreams??jT.maxOutboundStopStreams,this.shutdownController=new AbortController,this.discovery=new m3e(e,{filter:t.discoveryFilter??Zoe(o3e,a3e)}),this.discovery.addEventListener("relay:discover",n=>{this.reservationStore.addRelay(n.detail,"discovered").catch(i=>{i.name!=="HadEnoughRelaysError"&&i.name!=="RelayQueueFullError"&&this.log.error("could not add discovered relay %p",n.detail,i)})}),this.reservationStore=new C3e(e,t),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{var n;(n=this.discovery)==null||n.startDiscovery()}),this.reservationStore.addEventListener("relay:found-enough-relays",()=>{var n;(n=this.discovery)==null||n.stopDiscovery()}),this.started=!1}get[(kN=Symbol.toStringTag,IN=ur,CN=mc,AN=J3,CN)](){return this.discovery!=null?["@libp2p/identify"]:[]}isStarted(){return this.started}async start(){this.shutdownController=new AbortController,await this.registrar.handle(UT,e=>{const t=this.upgrader.createInboundAbortSignal(this.shutdownController.signal);this.onStop(e,t).catch(n=>{this.log.error("error while handling STOP protocol",n),e.stream.abort(n)}).finally(()=>{t.clear()})},{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0}),await Oo(this.discovery,this.reservationStore),this.started=!0}async stop(){this.shutdownController.abort(),await Nc(this.discovery,this.reservationStore),await this.registrar.unhandle(UT),this.started=!1}async dial(e,t){var m,f,g,v,y,w;if(e.protoCodes().filter(b=>b===n3e).length!==1){const b="Invalid circuit relay address";throw this.log.error(b,e),new fh(b)}const n=e.toString().split("/p2p-circuit"),i=$e(n[0]),s=$e(n[n.length-1]),o=i.getPeerId(),a=s.getPeerId();if(o==null||a==null){const b=`ircuit relay dial to ${e.toString()} failed as address did not have both relay and destination PeerIDs`;throw this.log.error(`c${b}`),new fh(`C${b}`)}const c=Wt(o),l=Wt(a);let d=this.connectionManager.getConnections(c)[0];d==null?(await this.peerStore.merge(c,{multiaddrs:[i]}),(m=t.onProgress)==null||m.call(t,new Ie("circuit-relay:open-connection")),d=await this.connectionManager.openConnection(c,t)):(f=t.onProgress)==null||f.call(t,new Ie("circuit-relay:reuse-connection"));let p;try{(g=t.onProgress)==null||g.call(t,new Ie("circuit-relay:open-hop-stream")),p=await d.newStream(fm,t);const b=Jn(p),E=b.pb(sd);(v=t.onProgress)==null||v.call(t,new Ie("circuit-relay:write-connect-message")),await E.write({type:sd.Type.CONNECT,peer:{id:l.toMultihash().bytes,addrs:[$e(s).bytes]}},t),(y=t.onProgress)==null||y.call(t,new Ie("circuit-relay:read-connect-response"));const C=await E.read(t);if(C.status!==rn.OK)throw new wt(`failed to connect via relay with status ${((w=C==null?void 0:C.status)==null?void 0:w.toString())??"undefined"}`);const k=new VT(C.limit),x=KT({stream:b.unwrap(),remoteAddr:e,localAddr:i.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`),logger:this.logger,onDataRead:k.onData,onDataWrite:k.onData});return this.log("new outbound relayed connection %a",x.remoteAddr),await this.upgrader.upgradeOutbound(x,{...t,limits:k.getLimits()})}catch(b){throw this.log.error("circuit relay dial to destination %p via relay %p failed",l,c,b),p==null||p.abort(b),b}}createListener(e){return b3e({peerId:this.peerId,connectionManager:this.connectionManager,addressManager:this.addressManager,reservationStore:this.reservationStore,logger:this.logger})}listenFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>UV.exactMatch(t)||FV.exactMatch(t))}dialFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>Sc.exactMatch(t))}async onStop({connection:e,stream:t},n){var h,d;if(!this.reservationStore.hasReservation(e.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.transportManager.listen([e.remoteAddr.encapsulate("/p2p-circuit")])}catch(p){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on",p)}const i=Jn(t).pb(oo),s=await i.read({signal:n});if(this.log("new circuit relay v2 stop stream from %p with type %s",e.remotePeer,s.type),(s==null?void 0:s.type)===void 0){this.log.error("type was missing from circuit v2 stop protocol request from %s",e.remotePeer),await i.write({type:oo.Type.STATUS,status:rn.MALFORMED_MESSAGE},{signal:n}),await t.close();return}if(s.type!==oo.Type.CONNECT){this.log.error("invalid stop connect request via peer %p",e.remotePeer),await i.write({type:oo.Type.STATUS,status:rn.UNEXPECTED_MESSAGE},{signal:n}),await t.close();return}if(!I3e(s)){this.log.error("invalid stop connect request via peer %p",e.remotePeer),await i.write({type:oo.Type.STATUS,status:rn.MALFORMED_MESSAGE},{signal:n}),await t.close({signal:n});return}const o=ri(t3e(s.peer.id));if(await((d=(h=this.connectionGater).denyInboundRelayedConnection)==null?void 0:d.call(h,e.remotePeer,o))===!0){this.log.error("connection gater denied inbound relayed connection from %p",e.remotePeer),await i.write({type:oo.Type.STATUS,status:rn.PERMISSION_DENIED},{signal:n}),await t.close({signal:n});return}this.log.trace("sending success response to %p",e.remotePeer),await i.write({type:oo.Type.STATUS,status:rn.OK},{signal:n});const a=new VT(s.limit),c=e.remoteAddr.encapsulate(`/p2p-circuit/p2p/${o.toString()}`);this.addressManager.getAddresses()[0];const l=KT({stream:i.unwrap().unwrap(),remoteAddr:c,logger:this.logger,onDataRead:a.onData,onDataWrite:a.onData});this.log("new inbound relayed connection %a",l.remoteAddr),await this.upgrader.upgradeInbound(l,{limits:a.getLimits(),signal:n}),this.log("%s connection %a upgraded","inbound",l.remoteAddr)}}function VV(r={}){return e=>new k3e(e,r)}const qT=()=>{const r=new Error("Delay aborted");return r.name="AbortError",r},_3e=new WeakMap;function T3e({clearTimeout:r,setTimeout:e}={}){return(t,{value:n,signal:i}={})=>{if(i!=null&&i.aborted)return Promise.reject(qT());let s,o,a;const c=r??clearTimeout,l=()=>{c(s),a(qT())},h=()=>{i&&i.removeEventListener("abort",l)},d=new Promise((p,m)=>{o=()=>{h(),p(n)},a=m,s=(e??setTimeout)(o,t)});return i&&i.addEventListener("abort",l,{once:!0}),_3e.set(d,()=>{c(s),s=null,o()}),d}}const KV=T3e();var Is;(function(r){(function(n){n.UNUSED="UNUSED",n.CONNECT="CONNECT",n.SYNC="SYNC"})(r.Type||(r.Type={}));let e;(function(n){n[n.UNUSED=0]="UNUSED",n[n.CONNECT=100]="CONNECT",n[n.SYNC=300]="SYNC"})(e||(e={})),function(n){n.codec=()=>Dn(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=Pe((n,i,s={})=>{if(s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.observedAddresses!=null)for(const o of n.observedAddresses)i.uint32(18),i.bytes(o);s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{var c;const o={observedAddresses:[]},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const l=n.uint32();switch(l>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{if(((c=s.limits)==null?void 0:c.observedAddresses)!=null&&o.observedAddresses.length===s.limits.observedAddresses)throw new ht('Decode error - map field "observedAddresses" had too many elements');o.observedAddresses.push(n.bytes());break}default:{n.skipType(l&7);break}}}return o})),t),r.encode=n=>Te(n,r.codec()),r.decode=(n,i)=>_e(n,r.codec(),i)})(Is||(Is={}));function WT(r,e){return Sc.matches(r)||e.dialTransportForMultiaddr(r)==null?!1:YF.matches(r)?!0:Ade.matches(r)?Rc(r.toOptions().host)===!1:!1}const GT=1024*4,QT=100,ug={timeout:5e3,retries:3,maxInboundStreams:1,maxOutboundStreams:1};var _N,TN;TN=Symbol.toStringTag,_N=mc;class P3e{constructor(e,t){u(this,"started");u(this,"timeout");u(this,"retries");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"peerStore");u(this,"registrar");u(this,"connectionManager");u(this,"addressManager");u(this,"transportManager");u(this,"topologyId");u(this,"log");u(this,TN,"@libp2p/dcutr");u(this,_N,["@libp2p/identify"]);this.log=e.logger.forComponent("libp2p:dcutr"),this.started=!1,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.timeout=t.timeout??ug.timeout,this.retries=t.retries??ug.retries,this.maxInboundStreams=t.maxInboundStreams??ug.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??ug.maxOutboundStreams}isStarted(){return this.started}async start(){this.started||(this.topologyId=await this.registrar.register(hg,{notifyOnLimitedConnection:!0,onConnect:(e,t)=>{Sc.exactMatch(t.remoteAddr)&&t.direction==="inbound"&&this.upgradeInbound(t).catch(n=>{this.log.error("error during outgoing DCUtR attempt",n)})}}),await this.registrar.handle(hg,e=>{this.handleIncomingUpgrade(e.stream,e.connection).catch(t=>{this.log.error("error during incoming DCUtR attempt",t),e.stream.abort(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:!0}),this.started=!0)}async stop(){await this.registrar.unhandle(hg),this.topologyId!=null&&this.registrar.unregister(this.topologyId),this.started=!1}async upgradeInbound(e){if(await this.attemptUnilateralConnectionUpgrade(e))return;let t;for(let n=0;n<this.retries;n++){const i={signal:AbortSignal.timeout(this.timeout)};try{t=await e.newStream([hg],{signal:i.signal,runOnLimitedConnection:!0});const s=Jn(t,{maxDataLength:GT}).pb(Is);this.log("B sending connect to %p",e.remotePeer);const o=Date.now();await s.write({type:Is.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(d=>d.bytes)},i),this.log("B receiving connect from %p",e.remotePeer);const a=await s.read(i);if(a.type!==Is.Type.CONNECT)throw this.log("A sent wrong message type"),new wt("DCUtR message type was incorrect");const c=this.getDialableMultiaddrs(a.observedAddresses);if(c.length===0)throw this.log("A did not have any dialable multiaddrs"),new wt("DCUtR connect message had no multiaddrs");const l=Date.now()-o;this.log("A sending sync, rtt %dms",l),await s.write({type:Is.Type.SYNC,observedAddresses:[]},i),this.log("A waiting for half RTT"),await KV(l/2),this.log("B dialing",c);const h=await this.connectionManager.openConnection(c,{signal:i.signal,priority:QT,force:!0,initiator:!1});this.log("DCUtR to %p succeeded to address %a, closing relayed connection",e.remotePeer,h.remoteAddr),await e.close(i);break}catch(s){if(this.log.error("error while attempting DCUtR on attempt %d of %d",n+1,this.retries,s),t==null||t.abort(s),n===this.retries)throw s}finally{t!=null&&await t.close(i)}}}async attemptUnilateralConnectionUpgrade(e){const n=(await this.peerStore.get(e.remotePeer)).addresses.map(i=>{const s=i.multiaddr;return s.getPeerId()==null?s.encapsulate(`/p2p/${e.remotePeer}`):s}).filter(i=>WT(i,this.transportManager));if(n.length>0){const i=AbortSignal.timeout(this.timeout);try{this.log("attempting unilateral connection upgrade to %a",n);const s=await this.connectionManager.openConnection(n,{signal:i,force:!0});if(Sc.exactMatch(s.remoteAddr))throw new Error("Could not open a new, non-limited, connection");return this.log("unilateral connection upgrade to %p succeeded via %a, closing relayed connection",e.remotePeer,s.remoteAddr),await e.close({signal:i}),!0}catch(s){this.log.error("unilateral connection upgrade to %p on addresses %a failed",e.remotePeer,n,s)}}else this.log("peer %p has no public addresses, not attempting unilateral connection upgrade",e.remotePeer);return!1}async handleIncomingUpgrade(e,t){const n={signal:AbortSignal.timeout(this.timeout)};try{const i=Jn(e,{maxDataLength:GT}).pb(Is);this.log("A receiving connect");const s=await i.read(n);if(s.type!==Is.Type.CONNECT)throw this.log("B sent wrong message type"),new wt("DCUtR message type was incorrect");if(s.observedAddresses.length===0)throw this.log("B sent no multiaddrs"),new wt("DCUtR connect message had no multiaddrs");const o=this.getDialableMultiaddrs(s.observedAddresses);if(o.length===0)throw this.log("B had no dialable multiaddrs"),new wt("DCUtR connect message had no dialable multiaddrs");if(this.log("A sending connect"),await i.write({type:Is.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(l=>l.bytes)}),this.log("A receiving sync"),(await i.read(n)).type!==Is.Type.SYNC)throw new wt("DCUtR message type was incorrect");this.log("A dialing",o);const c=await this.connectionManager.openConnection(o,{signal:n.signal,priority:QT,force:!0});this.log("DCUtR to %p succeeded via %a, closing relayed connection",t.remotePeer,c.remoteAddr),await t.close(n)}catch(i){this.log.error("incoming DCUtR from %p failed",t.remotePeer,i),e.abort(i)}finally{await e.close(n)}}getDialableMultiaddrs(e){const t=[];for(const n of e)if(!(n==null||n.length===0))try{const i=$e(n);if(!WT(i,this.transportManager))continue;t.push(i)}catch{}return t}}const hg="/libp2p/dcutr";function D3e(r={}){return e=>new P3e(e,r)}const dg=globalThis.CustomEvent??Event;async function*Gp(r,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);const n=e.ordered??!1,i=new EventTarget,s=[];let o=Oe(),a=Oe(),c=!1,l,h=!1;i.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(const f of r){if(s.length===t&&(o=Oe(),await o.promise),h)break;const g={done:!1};s.push(g),f().then(v=>{g.done=!0,g.ok=!0,g.value=v,i.dispatchEvent(new dg("task-complete"))},v=>{g.done=!0,g.err=v,i.dispatchEvent(new dg("task-complete"))})}c=!0,i.dispatchEvent(new dg("task-complete"))}catch(f){l=f,i.dispatchEvent(new dg("task-complete"))}});function d(){var f;return n?(f=s[0])==null?void 0:f.done:!!s.find(g=>g.done)}function*p(){for(;s.length>0&&s[0].done;){const f=s[0];if(s.shift(),f.ok)yield f.value;else throw h=!0,o.resolve(),f.err;o.resolve()}}function*m(){for(;d();)for(let f=0;f<s.length;f++)if(s[f].done){const g=s[f];if(s.splice(f,1),f--,g.ok)yield g.value;else throw h=!0,o.resolve(),g.err;o.resolve()}}for(;;){if(d()||(a=Oe(),await a.promise),l!=null)throw l;if(n?yield*p():yield*m(),c&&s.length===0)break}}const $3e="0.1.0",N3e="id",M3e="id/push",O3e="1.0.0",R3e="1.0.0",L3e=1024*8,B3e=32;var cd;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.protocolVersion!=null&&(n.uint32(42),n.string(t.protocolVersion)),t.agentVersion!=null&&(n.uint32(50),n.string(t.agentVersion)),t.publicKey!=null&&(n.uint32(10),n.bytes(t.publicKey)),t.listenAddrs!=null)for(const s of t.listenAddrs)n.uint32(18),n.bytes(s);if(t.observedAddr!=null&&(n.uint32(34),n.bytes(t.observedAddr)),t.protocols!=null)for(const s of t.protocols)n.uint32(26),n.string(s);t.signedPeerRecord!=null&&(n.uint32(66),n.bytes(t.signedPeerRecord)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={listenAddrs:[],protocols:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 5:{s.protocolVersion=t.string();break}case 6:{s.agentVersion=t.string();break}case 1:{s.publicKey=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.listenAddrs)!=null&&s.listenAddrs.length===i.limits.listenAddrs)throw new ht('Decode error - map field "listenAddrs" had too many elements');s.listenAddrs.push(t.bytes());break}case 4:{s.observedAddr=t.bytes();break}case 3:{if(((c=i.limits)==null?void 0:c.protocols)!=null&&s.protocols.length===i.limits.protocols)throw new ht('Decode error - map field "protocols" had too many elements');s.protocols.push(t.string());break}case 8:{s.signedPeerRecord=t.bytes();break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(cd||(cd={}));const yi={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:L3e,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnLimitedConnection:!0,concurrency:B3e};function U3e(r){if(r!=null&&r.length>0)try{return $e(r)}catch{}}function F3e(r,e){return e??r.userAgent}async function HV(r,e,t,n,i){if(t("received identify from %p",n.remotePeer),i==null)throw new wt("message was null or undefined");const s={};if(i.listenAddrs.length>0&&(s.addresses=i.listenAddrs.map(c=>({isCertified:!1,multiaddr:$e(c)}))),i.protocols.length>0&&(s.protocols=i.protocols),i.publicKey!=null){const c=$n(i.publicKey);if(!Yh(c).equals(n.remotePeer))throw new wt("public key did not match remote PeerId");s.publicKey=c}let o;if(i.signedPeerRecord!=null){t.trace("received signedPeerRecord from %p",n.remotePeer);let c=i.signedPeerRecord;const l=await Ac.openAndCertify(c,Bs.DOMAIN);let h=Bs.createFromProtobuf(l.payload);const d=Md(l.publicKey.toCID());if(!h.peerId.equals(d))throw new wt("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(h.peerId))throw new wt("signing key does not match remote PeerId");let p;try{p=await r.get(h.peerId)}catch(m){if(m.name!=="NotFoundError")throw m}if(p!=null&&(s.metadata=p.metadata,p.peerRecordEnvelope!=null)){const m=await Ac.createFromProtobuf(p.peerRecordEnvelope),f=Bs.createFromProtobuf(m.payload);f.seqNumber>=h.seqNumber&&(t("sequence number was lower or equal to existing sequence number - stored: %d received: %d",f.seqNumber,h.seqNumber),h=f,c=p.peerRecordEnvelope)}s.peerRecordEnvelope=c,s.addresses=h.multiaddrs.map(m=>({isCertified:!0,multiaddr:m})),o={seq:h.seqNumber,addresses:h.multiaddrs}}else t("%p did not send a signed peer record",n.remotePeer);if(t.trace("patching %p with",n.remotePeer,s),await r.patch(n.remotePeer,s),i.agentVersion!=null||i.protocolVersion!=null){const c={};i.agentVersion!=null&&(c.AgentVersion=se(i.agentVersion)),i.protocolVersion!=null&&(c.ProtocolVersion=se(i.protocolVersion)),t.trace("merging %p metadata",n.remotePeer,c),await r.merge(n.remotePeer,{metadata:c})}const a={peerId:n.remotePeer,protocolVersion:i.protocolVersion,agentVersion:i.agentVersion,publicKey:i.publicKey,listenAddrs:i.listenAddrs.map(c=>$e(c)),observedAddr:i.observedAddr==null?void 0:$e(i.observedAddr),protocols:i.protocols,signedPeerRecord:o,connection:n};return e.safeDispatchEvent("peer:identify",{detail:a}),a}class jV{constructor(e,t){u(this,"host");u(this,"protocol");u(this,"started");u(this,"timeout");u(this,"peerId");u(this,"privateKey");u(this,"peerStore");u(this,"registrar");u(this,"addressManager");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"maxMessageSize");u(this,"maxObservedAddresses");u(this,"events");u(this,"runOnLimitedConnection");u(this,"log");this.protocol=t.protocol,this.started=!1,this.peerId=e.peerId,this.privateKey=e.privateKey,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.events=e.events,this.log=t.log,this.timeout=t.timeout??yi.timeout,this.maxInboundStreams=t.maxInboundStreams??yi.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??yi.maxOutboundStreams,this.maxMessageSize=t.maxMessageSize??yi.maxMessageSize,this.maxObservedAddresses=t.maxObservedAddresses??yi.maxObservedAddresses,this.runOnLimitedConnection=t.runOnLimitedConnection??yi.runOnLimitedConnection,this.host={protocolVersion:`${t.protocolPrefix??yi.protocolPrefix}/${$3e}`,agentVersion:F3e(e.nodeInfo,t.agentVersion)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:se(this.host.agentVersion),ProtocolVersion:se(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,e=>{this.handleProtocol(e).catch(t=>{this.log.error(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}}var PN,DN;class z3e extends(DN=jV,PN=ur,DN){constructor(t,n={}){super(t,{...n,protocol:`/${n.protocolPrefix??yi.protocolPrefix}/${M3e}/${R3e}`,log:t.logger.forComponent("libp2p:identify-push")});u(this,"connectionManager");u(this,"concurrency");u(this,PN,["@libp2p/identify-push"]);this.connectionManager=t.connectionManager,this.concurrency=n.concurrency??yi.concurrency,(n.runOnSelfUpdate??yi.runOnSelfUpdate)&&t.events.addEventListener("self:peer:update",i=>{this.push().catch(s=>{this.log.error(s)})})}async push(){if(!this.isStarted())return;const t=this.addressManager.getAddresses().map(d=>d.decapsulateCode(Ue("p2p").code)),n=new Bs({peerId:this.peerId,multiaddrs:t}),i=await Ac.seal(n,this.privateKey),s=this.registrar.getProtocols(),o=await this.peerStore.get(this.peerId),a=re(o.metadata.get("AgentVersion")??se(this.host.agentVersion)),c=re(o.metadata.get("ProtocolVersion")??se(this.host.protocolVersion)),l=this;async function*h(){for(const d of l.connectionManager.getConnections())(await l.peerStore.get(d.remotePeer)).protocols.includes(l.protocol)&&(yield async()=>{let m;const f=AbortSignal.timeout(l.timeout);try{m=await d.newStream(l.protocol,{signal:f,runOnLimitedConnection:l.runOnLimitedConnection}),await Jn(m,{maxDataLength:l.maxMessageSize}).pb(cd).write({listenAddrs:t.map(v=>v.bytes),signedPeerRecord:i.marshal(),protocols:s,agentVersion:a,protocolVersion:c},{signal:f}),await m.close({signal:f})}catch(g){l.log.error("could not push identify update to peer",g),m==null||m.abort(g)}})}await Mo(Gp(h(),{concurrency:this.concurrency}))}async handleProtocol(t){const{connection:n,stream:i}=t;try{if(this.peerId.equals(n.remotePeer))throw new Error("received push from ourselves?");const s={signal:AbortSignal.timeout(this.timeout)},a=await Jn(i,{maxDataLength:this.maxMessageSize}).pb(cd).read(s);await i.close(s),await HV(this.peerStore,this.events,this.log,n,a)}catch(s){this.log.error("received invalid message",s),i.abort(s);return}this.log.trace("handled push from %p",n.remotePeer)}}const V3e=41;var $N,NN;class K3e extends(NN=jV,$N=ur,NN){constructor(t,n={}){super(t,{...n,protocol:`/${n.protocolPrefix??yi.protocolPrefix}/${N3e}/${O3e}`,log:t.logger.forComponent("libp2p:identify")});u(this,$N,["@libp2p/identify"]);(n.runOnConnectionOpen??yi.runOnConnectionOpen)&&t.events.addEventListener("connection:open",i=>{const s=i.detail;this.identify(s).catch(o=>{o.name!==Lp.name&&this.log.error("error during identify trigged by connection:open",o)})})}async _identify(t,n={}){let i;if(n.signal==null){const s=AbortSignal.timeout(this.timeout);n={...n,signal:s}}try{i=await t.newStream(this.protocol,{...n,runOnLimitedConnection:this.runOnLimitedConnection});const o=await Jn(i,{maxDataLength:this.maxMessageSize}).pb(cd).read(n);return await i.close(n),o}catch(s){throw i==null||i.abort(s),s}}async identify(t,n={}){const i=await this._identify(t,n),{publicKey:s,protocols:o,observedAddr:a}=i;if(s==null)throw new wt("public key was missing from identify message");const c=$n(s),l=Md(c.toCID());if(!t.remotePeer.equals(l))throw new wt("identified peer does not match the expected peer");if(this.peerId.equals(l))throw new wt("identified peer is our own peer id?");return this.maybeAddObservedAddress(a),this.log("identify completed for peer %p and protocols %o",l,o),HV(this.peerStore,this.events,this.log,t,i)}maybeAddObservedAddress(t){const n=U3e(t);if(n==null)return;if(this.log.trace("our observed address was %a",n),Ql(n)){this.log.trace("our observed address was private");return}if(n.stringTuples()[0][0]===V3e&&!vV(n)){this.log.trace("our observed address was IPv6 but not a global unicast address");return}Fy.exactMatch(n)||(this.log.trace("storing the observed address"),this.addressManager.addObservedAddr(n))}async handleProtocol(t){const{connection:n,stream:i}=t,s=AbortSignal.timeout(this.timeout);try{const o=await this.peerStore.get(this.peerId),a=this.addressManager.getAddresses().map(d=>d.decapsulateCode(Ue("p2p").code));let c=o.peerRecordEnvelope;if(a.length>0&&c==null){const d=new Bs({peerId:this.peerId,multiaddrs:a});c=(await Ac.seal(d,this.privateKey)).marshal().subarray()}let l=n.remoteAddr.bytes;xde.matches(n.remoteAddr)||(l=void 0),await Jn(i).pb(cd).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:_i(this.privateKey.publicKey),listenAddrs:a.map(d=>d.bytes),signedPeerRecord:c,observedAddr:l,protocols:o.protocols},{signal:s}),await i.close({signal:s})}catch(o){this.log.error("could not respond to identify request",o),i.abort(o)}}}function qV(r={}){return e=>new K3e(e,r)}function H3e(r={}){return e=>new z3e(e,r)}const Qp=1e3,xx=60*Qp,zw=60*xx,j3e=36*zw,q3e="/ipfs/kad/1.0.0",W3e=48*zw,G3e=24*zw,Q3e=10,Y3e=16384,X3e=zw,WV=20,Ax=3,J3e=5*xx,Z3e=Qp,ewe=5*Qp,twe=5*xx,rwe=30*Qp,nwe=180*Qp,YT=`${X3}-kad-dht`;var mm;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key.byteLength>0&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={key:We(0),value:We(0),timeReceived:""},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.key=t.bytes();break}case 2:{s.value=t.bytes();break}case 5:{s.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(mm||(mm={}));function iwe(r){const e=r.getUTCFullYear(),t=String(r.getUTCMonth()+1).padStart(2,"0"),n=String(r.getUTCDate()).padStart(2,"0"),i=String(r.getUTCHours()).padStart(2,"0"),s=String(r.getUTCMinutes()).padStart(2,"0"),o=String(r.getUTCSeconds()).padStart(2,"0"),a=r.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${n}T${i}:${s}:${o}.${c}Z`}function swe(r){const e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");const n=parseInt(t[1],10),i=parseInt(t[2],10)-1,s=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),l=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,i,s,o,a,c,l))}class Ti{constructor(e,t,n){u(this,"key");u(this,"value");u(this,"timeReceived");if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return mm.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:iwe(this.timeReceived)}}static deserialize(e){const t=mm.decode(e);return new Ti(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=swe(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new Ti(e.key,e.value,t)}}class wm extends Error{constructor(e="Query error"){super(e),this.name="QueryError"}}class owe extends Error{constructor(e="Query aborted"){super(e),this.name="QueryAbortedError"}}class awe extends Error{constructor(e="Invalid record"){super(e),this.name="InvalidRecordError"}}class cwe extends Error{constructor(e="No selector function configured for prefix"){super(e),this.name="MissingSelectorError"}}var XT;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&(n.uint32(18),n.bytes(t.value)),t.author!=null&&(n.uint32(26),n.bytes(t.author)),t.signature!=null&&(n.uint32(34),n.bytes(t.signature)),t.timeReceived!=null&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.key=t.bytes();break}case 2:{s.value=t.bytes();break}case 3:{s.author=t.bytes();break}case 4:{s.signature=t.bytes();break}case 5:{s.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(XT||(XT={}));var bt;(function(r){r.PUT_VALUE="PUT_VALUE",r.GET_VALUE="GET_VALUE",r.ADD_PROVIDER="ADD_PROVIDER",r.GET_PROVIDERS="GET_PROVIDERS",r.FIND_NODE="FIND_NODE",r.PING="PING"})(bt||(bt={}));var bm;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(bm||(bm={}));(function(r){r.codec=()=>Dn(bm)})(bt||(bt={}));var ld;(function(r){r.NOT_CONNECTED="NOT_CONNECTED",r.CONNECTED="CONNECTED",r.CAN_CONNECT="CAN_CONNECT",r.CANNOT_CONNECT="CANNOT_CONNECT"})(ld||(ld={}));var Fv;(function(r){r[r.NOT_CONNECTED=0]="NOT_CONNECTED",r[r.CONNECTED=1]="CONNECTED",r[r.CAN_CONNECT=2]="CAN_CONNECT",r[r.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(Fv||(Fv={}));(function(r){r.codec=()=>Dn(Fv)})(ld||(ld={}));var th;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.multiaddrs!=null)for(const s of t.multiaddrs)n.uint32(18),n.bytes(s);t.connection!=null&&(n.uint32(24),ld.codec().encode(t.connection,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={id:We(0),multiaddrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.id=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.multiaddrs)!=null&&s.multiaddrs.length===i.limits.multiaddrs)throw new ht('Decode error - map field "multiaddrs" had too many elements');s.multiaddrs.push(t.bytes());break}case 3:{s.connection=ld.codec().decode(t);break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(th||(th={}));var $l;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.type!=null&&bm[t.type]!==0&&(n.uint32(8),bt.codec().encode(t.type,n)),t.clusterLevel!=null&&(n.uint32(80),n.int32(t.clusterLevel)),t.key!=null&&(n.uint32(18),n.bytes(t.key)),t.record!=null&&(n.uint32(26),n.bytes(t.record)),t.closer!=null)for(const s of t.closer)n.uint32(66),th.codec().encode(s,n);if(t.providers!=null)for(const s of t.providers)n.uint32(74),th.codec().encode(s,n);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,h;const s={type:bt.PUT_VALUE,closer:[],providers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const d=t.uint32();switch(d>>>3){case 1:{s.type=bt.codec().decode(t);break}case 10:{s.clusterLevel=t.int32();break}case 2:{s.key=t.bytes();break}case 3:{s.record=t.bytes();break}case 8:{if(((a=i.limits)==null?void 0:a.closer)!=null&&s.closer.length===i.limits.closer)throw new ht('Decode error - map field "closer" had too many elements');s.closer.push(th.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.closer$}));break}case 9:{if(((l=i.limits)==null?void 0:l.providers)!=null&&s.providers.length===i.limits.providers)throw new ht('Decode error - map field "providers" had too many elements');s.providers.push(th.codec().decode(t,t.uint32(),{limits:(h=i.limits)==null?void 0:h.providers$}));break}default:{t.skipType(d&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})($l||($l={}));function JT(r,e={}){var n;const t={...r,name:"SEND_QUERY",type:0,messageName:r.type,messageType:r.type};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:send-query",{detail:t})),t}function zv(r,e={}){var n;const t={...r,name:"PEER_RESPONSE",type:1,messageName:r.messageType,closer:r.closer??[],providers:r.providers??[]};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:peer-response",{detail:t})),t}function m5(r,e={}){var n;const t={...r,name:"FINAL_PEER",type:2};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:final-peer",{detail:t})),t}function Cc(r,e={}){var n;const t={...r,name:"QUERY_ERROR",type:3};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:query-error",{detail:t})),t}function ZT(r,e={}){var n;const t={...r,name:"PROVIDER",type:4};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:provider",{detail:t})),t}function Vv(r,e={}){var n;const t={...r,name:"VALUE",type:5};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:value",{detail:t})),t}function eP(r,e={}){var n;const t={...r,name:"DIAL_PEER",type:7};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:dial-peer",{detail:t})),t}function lwe(r,e,t){if(t.length===0)throw new Z("No records given");const i=re(e).split("/");if(i.length<3)throw new Z("Record key does not have a selector function");const s=r[i[1].toString()];if(s==null)throw new cwe(`No selector function configured for key type "${i[1]}"`);return t.length===1?0:s(e,t)}function uwe(r,e){return 0}const hwe={pk:uwe};async function Cx(r,e){const t=e.key,i=re(t).split("/");if(i.length<3)return;const s=r[i[1].toString()];if(s==null)throw new Z(`No validator available for key type "${i[1]}"`);await s(t,e.value)}const dwe=async(r,e)=>{if(!(r instanceof Uint8Array))throw new Z('"key" must be a Uint8Array');if(r.byteLength<5)throw new Z("Invalid public key record");if(re(r.subarray(0,4))!=="/pk/")throw new Z("key was not prefixed with /pk/");const n=$n(e),i=r.slice(4);if(!Ke(i,n.toMultihash().bytes))throw new Z("public key does not match passed in key")},fwe={pk:dwe};function pwe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Ix(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function gwe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var ywe=gwe,mwe=ywe;let wwe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},bwe=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return GV(this,e)}},vwe=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return GV(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function GV(r,e){return new vwe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Ewe=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new wwe(e,t,n),this.decoder=new bwe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function QV({name:r,prefix:e,encode:t,decode:n}){return new Ewe(r,e,t,n)}function Vw({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=mwe(t,r);return QV({prefix:e,name:r,encode:n,decode:s=>Ix(i(s))})}function Swe(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function xwe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Zo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return QV({prefix:e,name:r,encode(i){return xwe(i,n,t)},decode(i){return Swe(i,n,t,r)}})}const a2=Zo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Zo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Zo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Zo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Zo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Zo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Zo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Zo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Zo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const w5=Vw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Vw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const $a=Vw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Vw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Awe=YV,tP=128,Cwe=-128,Iwe=Math.pow(2,31);function YV(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Iwe;)e[t++]=r&255|tP,r/=128;for(;r&Cwe;)e[t++]=r&255|tP,r>>>=7;return e[t]=r|0,YV.bytes=t-n+1,e}var kwe=Kv,_we=128,rP=127;function Kv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Kv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&rP)<<i:(o&rP)*Math.pow(2,i),i+=7}while(o>=_we);return Kv.bytes=s-n,t}var Twe=Math.pow(2,7),Pwe=Math.pow(2,14),Dwe=Math.pow(2,21),$we=Math.pow(2,28),Nwe=Math.pow(2,35),Mwe=Math.pow(2,42),Owe=Math.pow(2,49),Rwe=Math.pow(2,56),Lwe=Math.pow(2,63),Bwe=function(r){return r<Twe?1:r<Pwe?2:r<Dwe?3:r<$we?4:r<Nwe?5:r<Mwe?6:r<Owe?7:r<Rwe?8:r<Lwe?9:10},Uwe={encode:Awe,decode:kwe,encodingLength:Bwe},vm=Uwe;function Hv(r,e=0){return[vm.decode(r,e),vm.decode.bytes]}function Em(r,e,t=0){return vm.encode(r,e,t),e}function Sm(r){return vm.encodingLength(r)}function jv(r,e){const t=e.byteLength,n=Sm(r),i=n+Sm(t),s=new Uint8Array(i+t);return Em(r,s,0),Em(t,s,n),s.set(e,i),new kx(r,t,e,s)}function wu(r){const e=Ix(r),[t,n]=Hv(e),[i,s]=Hv(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new kx(t,i,o,e)}function Fwe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&pwe(r.bytes,t.bytes)}}let kx=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function nP(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return Vwe(t,qv(r),e??$a.encoder);default:return Kwe(t,qv(r),e??a2.encoder)}}const iP=new WeakMap;function qv(r){const e=iP.get(r);if(e==null){const t=new Map;return iP.set(r,t),t}return e}var MN;let _x=class Kr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,MN,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==$f)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Hwe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Kr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=jv(e,t);return Kr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Kr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Fwe(e.multihash,n.multihash)}toString(e){return nP(this,e)}toJSON(){return{"/":nP(this)}}link(){return this}[(MN=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Kr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new Kr(n,i,s,o??sP(n,i,s.bytes))}else if(t[jwe]===!0){const{version:n,multihash:i,code:s}=t,o=wu(i);return Kr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==$f)throw new Error(`Version 0 CID must use dag-pb (code: ${$f}) block encoding`);return new Kr(e,t,n,n.bytes)}case 1:{const i=sP(e,t,n.bytes);return new Kr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Kr.create(0,$f,e)}static createV1(e,t){return Kr.create(1,e,t)}static decode(e){const[t,n]=Kr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Kr.inspectBytes(e),n=t.size-t.multihashSize,i=Ix(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new kx(t.multihashCode,t.digestSize,s,i);return[t.version===0?Kr.createV0(o):Kr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=Hv(e.subarray(t));return t+=p,d};let i=n(),s=$f;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){const[n,i]=zwe(e,t),s=Kr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return qv(s).set(n,e),s}};function zwe(r,e){switch(r[0]){case"Q":{const t=e??$a;return[$a.prefix,t.decode(`${$a.prefix}${r}`)]}case $a.prefix:{const t=e??$a;return[$a.prefix,t.decode(r)]}case a2.prefix:{const t=e??a2;return[a2.prefix,t.decode(r)]}case w5.prefix:{const t=e??w5;return[w5.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function Vwe(r,e,t){const{prefix:n}=t;if(n!==$a.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function Kwe(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const $f=112,Hwe=18;function sP(r,e,t){const n=Sm(r),i=n+Sm(e),s=new Uint8Array(i+t.byteLength);return Em(r,s,0),Em(e,s,n),s.set(t,i),s}const jwe=Symbol.for("@ipld/js-cid/CID"),qwe=85;function Wwe({name:r,code:e,encode:t}){return new Gwe(r,e,t)}let Gwe=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?jv(this.code,t):t.then(n=>jv(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Qwe(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const XV=Wwe({name:"sha2-256",code:18,encode:Qwe("SHA-256")}),Ywe=se("/pk/");function Xwe(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{const[[t,n]]=e.stringTuples();if(t===53||t===54||t===55)return n!=="localhost";if(t!==4&&t!==6||n==null)return!1;const i=Rc(n);return i==null?!0:!i})}}async function np(r){return(await XV.digest(r)).digest}async function us(r){return np(r.toMultihash().bytes)}function u1(r,e){return new yt(`${r}/${re(e,"base32")}`,!1)}function Jwe(r){return er([Ywe,r.toMultihash().bytes])}function Zwe(r){return re(r.subarray(0,4))==="/pk/"}function e4e(r){const e=wu(r.subarray(4));return ri(e)}function oP(r,e){const t=new Date;return new Ti(r,e,t).serialize()}const t4e=290,r4e=54,n4e=55,i4e=56,s4e=4,o4e=41;function a4e(r){const e=r.stringTuples();for(const t of e)if(t[0]===t4e)return!1;if(e[0][0]===r4e||e[0][0]===n4e||e[0][0]===i4e)return!0;if(e[0][0]===s4e||e[0][0]===o4e){const t=Rc(`${e[0][1]}`);return t==null||!t}return!1}function JV(r){const e=r.toString().split("/"),t=e.pop(),n=e.pop();if(t==null||n==null)throw new Error(`incorrectly formatted provider entry key in datastore: ${r.toString()}`);return{cid:_x.createV1(qwe,wu(se(n,"base32"))),peerId:Wt(t)}}function b5(r,e,t){const n=typeof e=="string"?e:re(e.multihash.bytes,"base32"),i=[r,n];return t!=null&&i.push(t.toString()),new yt(i.join("/"))}function ZV(r){return new Date(hs(r))}function Bu(r,e,t){return async function*(...n){var a,c,l,h,d;const i=(a=e.queryTime)==null?void 0:a.timer(t),s=(c=e.errorTime)==null?void 0:c.timer(t);let o=!1;try{(l=e.queries)==null||l.increment({[t]:!0}),yield*r(...n)}catch(p){throw o=!0,s==null||s(),(h=e.errors)==null||h.increment({[t]:!0}),p}finally{(d=e.queries)==null||d.decrement({[t]:!0}),o||i==null||i()}}}function eK(r,e,t){return async function(...n){var a,c,l,h,d;const i=(a=e==null?void 0:e.queryTime)==null?void 0:a.timer(t),s=(c=e==null?void 0:e.errorTime)==null?void 0:c.timer(t);let o=!1;try{return(l=e.queries)==null||l.increment({[t]:!0}),await r(...n)}catch(p){throw o=!0,s==null||s(),(h=e.errors)==null||h.increment({[t]:!0}),p}finally{(d=e.queries)==null||d.decrement({[t]:!0}),o||i==null||i()}}}class c4e{constructor(e,t){u(this,"log");u(this,"components");u(this,"validators");u(this,"selectors");u(this,"peerRouting");u(this,"queryManager");u(this,"network");u(this,"datastorePrefix");var l,h;const{validators:n,selectors:i,peerRouting:s,queryManager:o,network:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-fetching`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n,this.selectors=i,this.peerRouting=s,this.queryManager=o,this.network=a,this.get=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.get",this.get.bind(this),{optionsIndex:1}))??this.get,this.put=((h=e.metrics)==null?void 0:h.traceFunction("libp2p.kadDHT.put",this.put.bind(this),{optionsIndex:2}))??this.put}async getLocal(e){this.log("getLocal %b",e);const t=u1(this.datastorePrefix,e);this.log("fetching record for key %k",t);const n=await this.components.datastore.get(t);this.log("found %k in local datastore",t);const i=Ti.deserialize(n);return await Cx(this.validators,i),i}async*sendCorrectionRecord(e,t,n,i={}){this.log("sendCorrection for %b",e);const s=oP(e,n);for(const{value:o,from:a}of t){if(Ke(o,n)){this.log("record was ok");continue}if(this.components.peerId.equals(a)){try{const h=u1(this.datastorePrefix,e);this.log(`Storing corrected record for key ${h.toString()}`),await this.components.datastore.put(h,s.subarray())}catch(h){this.log.error("Failed error correcting self",h)}continue}let c=!1;const l={type:bt.PUT_VALUE,key:e,record:s};for await(const h of this.network.sendRequest(a,l,i))h.name==="PEER_RESPONSE"&&h.record!=null&&Ke(h.record.value,Ti.deserialize(s).value)&&(c=!0),yield h;c||(yield Cc({from:a,error:new wm("Value not put correctly")},i)),this.log.error("Failed error correcting entry")}}async*put(e,t,n={}){this.log("put key %b value %b",e,t);const i=oP(e,t),s=u1(this.datastorePrefix,e);this.log(`storing record for key ${s.toString()}`),await this.components.datastore.put(s,i.subarray()),yield*cn(this.peerRouting.getClosestPeers(e,{...n,signal:n.signal}),o=>Nd(o,a=>async()=>{if(a.name!=="FINAL_PEER")return[a];const c=[],l={type:bt.PUT_VALUE,key:e,record:i};this.log("send put to %p",a.peer.id);for await(const h of this.network.sendRequest(a.peer.id,l,n))c.push(h),h.name==="PEER_RESPONSE"&&(h.record!=null&&Ke(h.record.value,Ti.deserialize(i).value)||c.push(Cc({from:a.peer.id,error:new wm("Value not put correctly")},n)));return c}),o=>Gp(o,{ordered:!1,concurrency:Ax}),async function*(o){for await(const a of o)yield*a})}async*get(e,t={}){this.log("get %b",e);const n=[];for await(const a of this.getMany(e,t))a.name==="VALUE"&&n.push(a),yield a;if(n.length===0)return;const i=n.map(a=>a.value);let s=0;try{s=lwe(this.selectors,e,i)}catch(a){if(a.name!=="InvalidParametersError")throw a}const o=i[s];if(this.log("GetValue %b %b",e,o),o==null)throw new Qt("Best value was not found");yield*this.sendCorrectionRecord(e,n,o,t),yield n[s]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{const s=await this.getLocal(e);yield Vv({value:s.value,from:this.components.peerId},t)}catch(s){this.log("error getting local value for %b",e,s)}const n=this,i=async function*({peer:s,signal:o}){for await(const a of n.peerRouting.getValueOrPeers(s,e,{...t,signal:o}))yield a,a.name==="PEER_RESPONSE"&&a.record!=null&&(yield Vv({from:s,value:a.record.value},t))};yield*this.queryManager.run(e,i,t)}}function l4e(r,e){return{id:r.id.toMultihash().bytes,multiaddrs:(r.multiaddrs??[]).map(n=>n.bytes),connection:e}}function fg(r){if(r.id==null)throw new Error("Invalid peer in message");const e=wu(r.id);return{id:ri(e),multiaddrs:(r.multiaddrs??[]).map(t=>$e(t))}}class u4e{constructor(e,t){u(this,"log");u(this,"components");u(this,"network");u(this,"peerRouting");u(this,"queryManager");u(this,"routingTable");u(this,"providers");var l,h;const{network:n,peerRouting:i,queryManager:s,routingTable:o,providers:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-routing`),this.network=n,this.peerRouting=i,this.queryManager=s,this.routingTable=o,this.providers=a,this.findProviders=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(d,p)=>(d.name==="PROVIDER"&&(p.providers??(p.providers=[]),p.providers.push(...d.providers.map(m=>m.id.toString()))),p)}))??this.findProviders,this.provide=((h=e.metrics)==null?void 0:h.traceFunction("libp2p.kadDHT.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(d,p)=>(d.name==="PEER_RESPONSE"&&d.messageName==="ADD_PROVIDER"&&(p.providers??(p.providers=[]),p.providers.push(d.from.toString())),p)}))??this.provide}async*provide(e,t,n={}){this.log("provide %s",e);const i=e.multihash.bytes;await this.providers.addProvider(e,this.components.peerId);const s={type:bt.ADD_PROVIDER,key:i,providers:[l4e({id:this.components.peerId,multiaddrs:t})]};let o=0;const a=c=>async()=>{if(c.name!=="FINAL_PEER")return[c];const l=[];this.log("putProvider %s to %p",e,c.peer.id);try{this.log("sending provider record for %s to %p",e,c.peer.id);for await(const h of this.network.sendMessage(c.peer.id,s,n))h.name==="PEER_RESPONSE"&&(this.log("sent provider record for %s to %p",e,c.peer.id),o++),l.push(h)}catch(h){this.log.error("error sending provide record to peer %p",c.peer.id,h),l.push(Cc({from:c.peer.id,error:h},n))}return l};yield*cn(this.peerRouting.getClosestPeers(i,n),c=>Nd(c,l=>a(l)),c=>Gp(c,{ordered:!1,concurrency:Ax}),async function*(c){for await(const l of c)yield*l}),this.log("sent provider records to %d peers",o)}async*findProviders(e,t){const n=this.routingTable.kBucketSize;let i=0;const s=e.multihash.bytes,o=this;this.log("findProviders %c",e);const a=await this.providers.getProviders(e);if(a.length>0){const h=[];for(const d of a.slice(0,n))try{const p=await this.components.peerStore.get(d);h.push({id:d,multiaddrs:p.addresses.map(({multiaddr:m})=>m)})}catch(p){if(p.name!=="NotFoundError")throw p;this.log("no peer store entry for %p",d)}if(yield zv({from:this.components.peerId,messageType:bt.GET_PROVIDERS,providers:h},t),yield ZT({from:this.components.peerId,providers:h},t),i+=h.length,i>=n)return}const c=async function*({peer:h,signal:d}){const p={type:bt.GET_PROVIDERS,key:s};yield*o.network.sendRequest(h,p,{...t,signal:d})},l=new is(a);for await(const h of this.queryManager.run(s,c,t))if(yield h,h.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",h.providers.length,e,h.closer.length);const d=[];for(const p of h.providers)l.has(p.id)||(l.add(p.id),d.push(p));if(d.length>0&&(yield ZT({from:h.from,providers:d},t),i+=d.length,i>=n))return}}}class v5{constructor(e){u(this,"movingAverage");u(this,"variance");u(this,"deviation");u(this,"forecast");u(this,"timeSpan");u(this,"previousTime");this.timeSpan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timeSpan)}push(e,t=Date.now()){if(this.previousTime!=null){const n=this.alpha(t,this.previousTime),i=e-this.movingAverage,s=n*i;this.movingAverage=n*e+(1-n)*this.movingAverage,this.variance=(1-n)*(this.variance+i*s),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+n*i}else this.movingAverage=e;this.previousTime=t}}const h4e=1.2,d4e=2,f4e=2e3;class ip{constructor(e={}){u(this,"success");u(this,"failure");u(this,"next");u(this,"metric");u(this,"timeoutMultiplier");u(this,"failureMultiplier");u(this,"minTimeout");var t;this.success=new v5(e.interval??5e3),this.failure=new v5(e.interval??5e3),this.next=new v5(e.interval??5e3),this.failureMultiplier=e.failureMultiplier??d4e,this.timeoutMultiplier=e.timeoutMultiplier??h4e,this.minTimeout=e.minTimeout??f4e,e.metricName!=null&&(this.metric=(t=e.metrics)==null?void 0:t.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){const t=Math.max(Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier)),this.minTimeout),n=AbortSignal.timeout(t),i=ct([e.signal,n]);return i.start=Date.now(),i.timeout=t,i}cleanUp(e){var n,i;const t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),(n=this.metric)==null||n.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),(i=this.metric)==null||i.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}}class p4e{constructor(){u(this,"readNext");u(this,"haveNext");u(this,"ended");u(this,"nextResult");this.ended=!1,this.readNext=Oe(),this.haveNext=Oe()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Oe(),e}async throw(e){return this.ended=!0,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Oe(),await nn(this.readNext.promise,t==null?void 0:t.signal,t)}}function g4e(){return new p4e}let y4e=class extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}};class m4e extends Error{constructor(t,n){super(t);u(this,"code");this.code=n}}let w4e=class extends m4e{constructor(t){super(t,"ABORT_ERR");u(this,"type");this.type="aborted",this.name="AbortError"}};function b4e(r,e){const t=g4e();r.sink(t).catch(async o=>{await t.end(o)}),r.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());const i=new Le;return{read:async(o,a)=>{var h,d;(h=a==null?void 0:a.signal)==null||h.throwIfAborted();let c;const l=new Promise((p,m)=>{var f;c=()=>{m(new w4e("Read aborted"))},(f=a==null?void 0:a.signal)==null||f.addEventListener("abort",c)});try{if(o==null){const{done:m,value:f}=await Promise.race([n.next(),l]);return m===!0?new Le:f}for(;i.byteLength<o;){const{value:m,done:f}=await Promise.race([n.next(),l]);if(f===!0)throw new y4e("unexpected end of input");i.append(m)}const p=i.sublist(0,o);return i.consume(o),p}finally{c!=null&&((d=a==null?void 0:a.signal)==null||d.removeEventListener("abort",c))}},write:async(o,a)=>{var c;(c=a==null?void 0:a.signal)==null||c.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(i.byteLength>0){const o=r.source;r.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield i:yield*i,yield*o}()}return r}}}let v4e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}},E4e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}},S4e=class extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}};function x4e(r,e={}){const t=b4e(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=dt(e.maxDataLength));const n=(e==null?void 0:e.lengthDecoder)??hs,i=(e==null?void 0:e.lengthEncoder)??br;return{read:async o=>{let a=-1;const c=new Le;for(;;){c.append(await t.read(1,o));try{a=n(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new v4e("Invalid message length");if((e==null?void 0:e.maxLengthLength)!=null&&c.byteLength>e.maxLengthLength)throw new S4e("message length length too long");if(a>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&a>e.maxDataLength)throw new E4e("message length too long");return t.read(a,o)},write:async(o,a)=>{await t.write(new Le(i(o.byteLength),o),a)},writeV:async(o,a)=>{const c=new Le(...o.flatMap(l=>[i(l.byteLength),l]));await t.write(c,a)},unwrap:()=>t.unwrap()}}function aP(r,e){const t=x4e(r,e),n={read:async(i,s)=>{const o=await t.read(s);return i.decode(o)},write:async(i,s,o)=>{await t.write(s.encode(i),o)},writeV:async(i,s,o)=>{await t.writeV(i.map(a=>s.encode(a)),o)},pb:i=>({read:async s=>n.read(i,s),write:async(s,o)=>n.write(s,i,o),writeV:async(s,o)=>n.writeV(s,i,o),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}class A4e extends Yt{constructor(t,n){var i,s,o,a;super();u(this,"log");u(this,"protocol");u(this,"running");u(this,"components");u(this,"timeout");u(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${n.logPrefix}:network`),this.running=!1,this.protocol=n.protocol,this.timeout=new ip({...n.timeout??{},metrics:t.metrics,metricName:`${n.metricsPrefix}_network_message_send_times_milliseconds`}),this.metrics={operations:(i=t.metrics)==null?void 0:i.registerCounterGroup(`${n.metricsPrefix}_outbound_rpc_requests_total`),errors:(s=t.metrics)==null?void 0:s.registerCounterGroup(`${n.metricsPrefix}_outbound_rpc_errors_total`)},this.sendRequest=((o=t.metrics)==null?void 0:o.traceFunction("libp2p.kadDHT.sendRequest",this.sendRequest.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],h){return{...h,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((h,d)=>{l[`providers-${d}`]=h.id.toString()}),c.closer.length>0&&c.closer.forEach((h,d)=>{l[`closer-${d}`]=h.id.toString()})),l)}))??this.sendRequest,this.sendMessage=((a=t.metrics)==null?void 0:a.traceFunction("libp2p.kadDHT.sendMessage",this.sendMessage.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],h){return{...h,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((h,d)=>{l[`providers-${d}`]=h.id.toString()}),c.closer.length>0&&c.closer.forEach((h,d)=>{l[`closer-${d}`]=h.id.toString()})),l)}))??this.sendMessage}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(t,n,i={}){var c,l,h;if(!this.running)return;const s=n.type;if(s==null)throw new Z("Message type was missing");this.log("sending %s to %p",n.type,t),yield eP({peer:t},i),yield JT({to:t,type:s},i);let o;const a=this.timeout.getTimeoutSignal(i);i={...i,signal:a};try{(c=this.metrics.operations)==null||c.increment({[s]:!0}),o=await(await this.components.connectionManager.openConnection(t,i)).newStream(this.protocol,i);const p=await this._writeReadMessage(o,n,i);o.close(i).catch(m=>{this.log.error("error closing stream to %p",t,m),o==null||o.abort(m)}),yield zv({from:t,messageType:p.type,closer:p.closer.map(fg),providers:p.providers.map(fg),record:p.record==null?void 0:Ti.deserialize(p.record)},i)}catch(d){(l=this.metrics.errors)==null||l.increment({[s]:!0}),o==null||o.abort(d),((h=i.signal)==null?void 0:h.aborted)!==!0&&this.log.error("could not send %s to %p - %e",n.type,t,d),yield Cc({from:t,error:d},i)}finally{this.timeout.cleanUp(a)}}async*sendMessage(t,n,i={}){var c,l;if(!this.running)return;const s=n.type;if(s==null)throw new Z("Message type was missing");this.log("sending %s to %p",n.type,t),yield eP({peer:t},i),yield JT({to:t,type:s},i);let o;const a=this.timeout.getTimeoutSignal(i);i={...i,signal:a};try{(c=this.metrics.operations)==null||c.increment({[s]:!0}),o=await(await this.components.connectionManager.openConnection(t,i)).newStream(this.protocol,i),await this._writeMessage(o,n,i),o.close(i).catch(d=>{this.log.error("error closing stream to %p",t,d),o==null||o.abort(d)}),yield zv({from:t,messageType:s},i)}catch(h){(l=this.metrics.errors)==null||l.increment({[s]:!0}),o==null||o.abort(h),yield Cc({from:t,error:h},i)}finally{this.timeout.cleanUp(a)}}async _writeMessage(t,n,i){await aP(t).write(n,$l,i)}async _writeReadMessage(t,n,i){const s=aP(t);await s.write(n,$l,i);const o=await s.read($l,i);return o.closer.forEach(a=>{this.safeDispatchEvent("peer",{detail:fg(a)})}),o.providers.forEach(a=>{this.safeDispatchEvent("peer",{detail:fg(a)})}),o}}function sp(r,e){if(r.byteLength!==e.byteLength)throw new Error("Inputs should have the same length");for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}class Tx{constructor(e,t){u(this,"originDhtKey");u(this,"capacity");u(this,"peerDistances");this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peer)}async add(e){const t=await us(e.id);this.addWithKadId(e,t)}addWithKadId(e,t){if(this.peerDistances.find(s=>s.peer.id.equals(e.id))!=null)return;const n={peer:e,distance:xc(this.originDhtKey,t)};let i=!1;for(let s=0;s<this.peerDistances.length;s++){const o=sp(this.peerDistances[s].distance,n.distance);if(o===0||o===1){i=!0,this.peerDistances.splice(s,0,n);break}}i||this.peerDistances.push(n),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async isCloser(e){if(this.length===0)return!0;const t=await us(e),n=xc(t,this.originDhtKey),i=this.peerDistances[this.peerDistances.length-1].distance;return sp(n,i)===-1}async anyCloser(e){return e.length===0?!1:Promise.any(e.map(async t=>this.isCloser(t)))}}class C4e{constructor(e,t){u(this,"log");u(this,"routingTable");u(this,"network");u(this,"validators");u(this,"queryManager");u(this,"peerStore");u(this,"peerId");var n,i;this.routingTable=t.routingTable,this.network=t.network,this.validators=t.validators,this.queryManager=t.queryManager,this.peerStore=e.peerStore,this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:peer-routing`),this.findPeer=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.kadDHT.findPeer",this.findPeer.bind(this),{optionsIndex:1}))??this.findPeer,this.getClosestPeers=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.kadDHT.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1}))??this.getClosestPeers}async findPeerLocal(e){let t;const n=await this.routingTable.find(e);if(n!=null){this.log("findPeerLocal found %p in routing table",e);try{t=await this.peerStore.get(n)}catch(i){if(i.name!=="NotFoundError")throw i}}if(t==null)try{t=await this.peerStore.get(e)}catch(i){if(i.name!=="NotFoundError")throw i}if(t!=null)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(i=>i.multiaddr)}}async*_getValueSingle(e,t,n={}){const i={type:bt.GET_VALUE,key:t};yield*this.network.sendRequest(e,i,n)}async*getPublicKeyFromNode(e,t={}){const n=Jwe(e);for await(const i of this._getValueSingle(e,n,t))if(yield i,i.name==="PEER_RESPONSE"&&i.record!=null){const s=$n(i.record.value),o=Yh(s);if(!o.equals(e))throw new F1("public key does not match id");if(o.publicKey==null)throw new F1("public key missing");yield Vv({from:e,value:i.record.value},t)}throw new wm(`Node not responding with its public key: ${e.toString()}`)}async*findPeer(e,t={}){if(this.log("findPeer %p",e),t.useCache!==!1){const i=await this.findPeerLocal(e);if(i!=null){this.log("found local"),yield m5({from:this.peerId,peer:i},t);return}}let n=!1;if(t.useNetwork!==!1){const i=this,s=async function*({peer:o,signal:a}){const c={type:bt.FIND_NODE,key:e.toMultihash().bytes};for await(const l of i.network.sendRequest(o,c,{...t,signal:a}))if(yield l,l.name==="PEER_RESPONSE"){const h=l.closer.find(d=>d.id.equals(e));h!=null&&(yield m5({from:l.from,peer:h},t))}};for await(const o of this.queryManager.run(e.toMultihash().bytes,s,t))o.name==="FINAL_PEER"&&(n=!0),yield o}n||(yield Cc({from:this.peerId,error:new Qt("Not found")},t))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);const n=await np(e),i=this.routingTable.closestPeers(n),s=this,o=new Tx(n,this.routingTable.kBucketSize);await Promise.all(i.map(async c=>{await o.add({id:c,multiaddrs:[]})}));const a=async function*({peer:c,signal:l}){s.log("closerPeersSingle %s from %p",re(e,"base32"),c);const h={type:bt.FIND_NODE,key:e};yield*s.network.sendRequest(c,h,{...t,signal:l})};for await(const c of this.queryManager.run(e,a,t))c.name==="PEER_RESPONSE"&&await Promise.all(c.closer.map(async l=>{await o.add(l)})),yield c;this.log("found %d peers close to %b",o.length,e);for(const c of o.peers)yield m5({from:this.peerId,peer:c},t)}async*getValueOrPeers(e,t,n={}){for await(const i of this._getValueSingle(e,t,n)){if(i.name==="PEER_RESPONSE"&&i.record!=null)try{await this._verifyRecordOnline(i.record)}catch{const o="invalid record received, discarded";this.log(o),yield Cc({from:i.from,error:new wm(o)},n);continue}yield i}}async _verifyRecordOnline(e){if(e.timeReceived==null)throw new awe("invalid record received");await Cx(this.validators,new Ti(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){const n=[];try{const c=wu(e),l=ri(c),h=await this.peerStore.get(l);n.push({id:h.id,multiaddrs:h.addresses.map(({multiaddr:d})=>d)})}catch{}const i=await np(e),s=this.routingTable.closestPeers(i),o=await us(t),a=xc(o,i);for(const c of s){const l=await us(c),h=xc(l,i);if(sp(h,a)===-1)try{const d=await this.peerStore.get(c);n.push({id:c,multiaddrs:d.addresses.map(({multiaddr:p})=>p)})}catch(d){if(d.name!=="NotFoundError")throw d}}return n.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",n.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p with %d peers in the routing table",e,t,this.routingTable.size),n}}class I4e{constructor(e,t){u(this,"log");u(this,"datastore");u(this,"datastorePrefix");u(this,"lock");this.log=e.logger.forComponent(`${t.logPrefix}:providers`),this.datastorePrefix=`${t.datastorePrefix}/provider`,this.datastore=e.datastore,this.lock=t.lock}async addProvider(e,t){const n=await this.lock.readLock();try{this.log("%p provides %s",t,e),await this.writeProviderEntry(e,t)}finally{n()}}async removeProvider(e,t){const n=await this.lock.writeLock();try{const i=b5(this.datastorePrefix,e,t);this.log("%p no longer provides %s",t,e),await this.datastore.delete(i)}finally{n()}}async getProviders(e){const t=await this.lock.readLock();try{this.log("get providers for %c",e);const n=await this.loadProviders(e);return this.log("got %d providers for %c",n.size,e),[...n.keys()]}finally{t()}}async writeProviderEntry(e,t,n=new Date){const i=b5(this.datastorePrefix,e,t),s=br(n.getTime());await this.datastore.put(i,s)}async loadProviders(e){const t=new Oc,n=b5(this.datastorePrefix,e);for await(const i of this.datastore.query({prefix:n.toString()})){const{peerId:s}=JV(i.key);t.set(s,ZV(i.value))}return t}}async function*k4e(r){const{key:e,startingPeer:t,ourPeerId:n,signal:i,query:s,alpha:o,pathIndex:a,numPaths:c,queryFuncTimeout:l,log:h,peersSeen:d,connectionManager:p}=r,m=new Hl({concurrency:o,sort:(v,y)=>sp(v.options.distance,y.options.distance)}),f=await np(e);function g(v,y){if(v==null)return;d.add(v);const w=xc(y,f);m.add(async()=>{const b=[i];l!=null&&b.push(AbortSignal.timeout(l));const E=ct(b);try{for await(const C of s({...r,key:e,peer:v,signal:E,pathIndex:a,numPaths:c})){if(E.aborted)return;if(C.name==="PEER_RESPONSE")for(const k of C.closer){if(d.has(k.id)){h.trace("already seen %p in query",k.id);continue}if(n.equals(k.id)){h("not querying ourselves");continue}if(!await p.isDialable(k.multiaddrs)){h("not querying undialable peer");continue}const x=await us(k.id),I=xc(x,f);if(sp(I,w)!==-1){h.trace("skipping %p as they are not closer to %b than %p",k.id,e,v);continue}h.trace("querying closer peer %p",k.id),g(k.id,x)}m.safeDispatchEvent("completed",{detail:C})}}catch(C){if(!i.aborted)return Cc({from:v,error:C},r)}finally{E.clear()}},{distance:w}).catch(b=>{h.error(b)})}g(t,await us(t));try{for await(const v of m.toGenerator({signal:i}))v!=null&&(yield v)}catch(v){throw i.aborted?new owe("Query aborted"):v}}class _4e{constructor(e,t){u(this,"disjointPaths");u(this,"alpha");u(this,"shutDownController");u(this,"running");u(this,"logger");u(this,"peerId");u(this,"connectionManager");u(this,"routingTable");u(this,"initialQuerySelfHasRun");u(this,"logPrefix");this.logPrefix=t.logPrefix,this.disjointPaths=t.disjointPaths??WV,this.alpha=t.alpha??Ax,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.shutDownController=new AbortController,this.shutDownController.signal,this.running=!1}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutDownController=new AbortController,this.shutDownController.signal,void 0)}async stop(){this.running=!1,this.shutDownController.abort()}async*run(e,t,n={}){if(!this.running)throw new Error("QueryManager not started");if(n.signal==null){const c=AbortSignal.timeout(nwe);n={...n,signal:c}}const i=new AbortController,s=ct([this.shutDownController.signal,i.signal,n.signal]);i.signal;const o=this.logger.forComponent(`${this.logPrefix}:query:`+re(e,"base58btc"));let a=!1;try{n.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(o("waiting for initial query-self query before continuing"),await nn(this.initialQuerySelfHasRun.promise,s),this.initialQuerySelfHasRun=void 0),o("query:start");const c=await np(e),l=this.routingTable.closestPeers(c),h=l.slice(0,Math.min(this.disjointPaths,l.length));if(l.length===0){o.error("Running query with no peers");return}const d=new is,p=h.map((m,f)=>k4e({...n,key:e,startingPeer:m,ourPeerId:this.peerId,signal:s,query:t,pathIndex:f,numPaths:h.length,alpha:this.alpha,queryFuncTimeout:n.queryFuncTimeout,log:o,peersSeen:d,onProgress:n.onProgress,connectionManager:this.connectionManager}));for await(const m of ic(...p)){if(m.name==="QUERY_ERROR"&&o.error("query error",m.error),m.name==="PEER_RESPONSE")for(const f of[...m.closer,...m.providers])await this.connectionManager.isDialable(f.multiaddrs)&&await this.routingTable.add(f.id);yield m}a=!0}catch(c){if(!(!this.running&&c.name==="QueryAbortedError"))throw c}finally{a||(o("query exited early"),i.abort()),s.clear(),o("query:done")}}}function T4e(r){return r[Symbol.asyncIterator]!=null}function tK(r){if(T4e(r))return(async()=>{let e=0;for await(const t of r)e++;return e})();{let e=0;for(const t of r)e++;return e}}const P4e=r=>{const e=r.addEventListener||r.on||r.addListener,t=r.removeEventListener||r.off||r.removeListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function D4e(r,e,t){let n;const i=new Promise((s,o)=>{var m;if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");(m=t.signal)==null||m.throwIfAborted();const a=[e].flat(),c=[],{addListener:l,removeListener:h}=P4e(r),d=(...f)=>{const g=t.multiArgs?f:f[0];t.filter&&!t.filter(g)||(c.push(g),t.count===c.length&&(n(),s(c)))},p=f=>{n(),o(f)};n=()=>{for(const f of a)h(f,d);for(const f of t.rejectionEvents)h(f,p)};for(const f of a)l(f,d);for(const f of t.rejectionEvents)l(f,p);t.signal&&t.signal.addEventListener("abort",()=>{p(t.signal.reason)},{once:!0}),t.resolveImmediately&&s(c)});if(i.cancel=n,typeof t.timeout=="number"){const s=Pp(i,{milliseconds:t.timeout});return s.cancel=n,s}return i}function $4e(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};const n=D4e(r,e,t),i=n.then(s=>s[0]);return i.cancel=n.cancel,i}class N4e{constructor(e,t){u(this,"log");u(this,"peerId");u(this,"peerRouting");u(this,"routingTable");u(this,"count");u(this,"interval");u(this,"initialInterval");u(this,"queryTimeout");u(this,"running");u(this,"timeoutId");u(this,"controller");u(this,"initialQuerySelfHasRun");u(this,"querySelfPromise");this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:query-self`),this.running=!1,this.peerRouting=t.peerRouting,this.routingTable=t.routingTable,this.count=t.count??WV,this.interval=t.interval??J3e,this.initialInterval=t.initialInterval??Z3e,this.queryTimeout=t.queryTimeout??ewe,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.querySelf=eK(this.querySelf.bind(this),t.operationMetrics,"SELF_QUERY")}isStarted(){return this.running}start(){this.running||(this.running=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.initialInterval))}stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}async querySelf(){if(!this.running){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=Oe(),this.running){this.controller=new AbortController;const e=[this.controller.signal];if(this.initialQuerySelfHasRun==null){const n=AbortSignal.timeout(this.queryTimeout);e.push(n)}const t=ct(e);this.controller.signal;try{this.routingTable.size===0&&(this.log("routing table was empty, waiting for some peers before running query"),await $4e(this.routingTable,"peer:add",{signal:t,filter:s=>!this.peerId.equals(s.detail)}),this.log("routing table has peers, continuing with query")),this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);const n=Date.now(),i=await cn(this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes,{signal:t,isSelfQuery:!0}),s=>py(s,this.count),async s=>tK(s));this.log("self-query found %d peers in %dms",i,Date.now()-n)}catch(n){this.log.error("self-query error",n)}finally{t.clear(),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.running&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.interval))}}class M4e extends Yt{constructor(t,n){super();u(this,"log");u(this,"reprovideQueue");u(this,"maxQueueSize");u(this,"datastore");u(this,"timeout");u(this,"reprovideTimeout");u(this,"running");u(this,"shutdownController");u(this,"reprovideThreshold");u(this,"contentRouting");u(this,"datastorePrefix");u(this,"addressManager");u(this,"validity");u(this,"interval");u(this,"lock");u(this,"peerId");this.log=t.logger.forComponent(`${n.logPrefix}:reprovider`),this.peerId=t.peerId,this.reprovideQueue=new Hl({concurrency:n.concurrency??Q3e,metrics:t.metrics,metricName:`${n.metricsPrefix}_reprovide_queue`}),this.reprovideTimeout=new ip({...n.timeout??{},metrics:t.metrics,metricName:`${n.metricsPrefix}_reprovide_timeout_milliseconds`}),this.datastore=t.datastore,this.addressManager=t.addressManager,this.datastorePrefix=`${n.datastorePrefix}/provider`,this.reprovideThreshold=n.threshold??G3e,this.maxQueueSize=n.maxQueueSize??Y3e,this.validity=n.validity??W3e,this.interval=n.interval??X3e,this.contentRouting=n.contentRouting,this.lock=n.lock,this.running=!1,this.reprovide=eK(this.reprovide.bind(this),n.operationMetrics,"PROVIDE")}start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,this.timeout=setTimeout(()=>{this.cleanUp().catch(t=>{this.log.error("error running reprovide/cleanup - %e",t)})},this.interval))}stop(){var t;this.running=!1,this.reprovideQueue.clear(),clearTimeout(this.timeout),(t=this.shutdownController)==null||t.abort()}async cleanUp(){const t=await this.lock.writeLock();try{this.safeDispatchEvent("reprovide:start");for await(const n of this.datastore.query({prefix:this.datastorePrefix}))try{const{cid:i,peerId:s}=JV(n.key),o=ZV(n.value).getTime(),a=o+this.validity,c=Date.now(),l=c>a;this.log.trace("comparing: %d < %d = %s %s",o,c-this.validity,l,l?"(expired)":""),l&&await this.datastore.delete(n.key),this.peerId.equals(s)&&c-a<this.reprovideThreshold&&this.queueReprovide(i).catch(h=>{this.log.error("could not reprovide %c - %e",i,h)})}catch(i){this.log.error("error processing datastore key %s - %e",n.key,i.message)}this.log("reprovide/cleanup successful")}finally{t(),this.safeDispatchEvent("reprovide:end"),this.running&&(this.timeout=setTimeout(()=>{this.cleanUp().catch(n=>{this.log.error("error running re-provide - %e",n)})},this.interval))}}async queueReprovide(t){var i;if(!this.running)return;this.log.trace("waiting for queue capacity before adding %c to re-provide queue",t),await this.reprovideQueue.onSizeLessThan(this.maxQueueSize);const n=this.reprovideQueue.queue.find(s=>s.options.cid.equals(t));if(n!=null)return this.log.trace("not adding %c to re-provide queue - already in queue",t),n.join();this.log.trace("adding %c to re-provide queue",t),this.reprovideQueue.add(async s=>{var a;if((a=s.signal)==null||a.throwIfAborted(),!this.running)return;this.log.trace("re-providing %c",t);const o=this.reprovideTimeout.getTimeoutSignal(s);try{await this.reprovide(s.cid,s)}finally{this.reprovideTimeout.cleanUp(o)}this.log.trace("re-provided %c",t)},{signal:(i=this.shutdownController)==null?void 0:i.signal,cid:t}).catch(s=>{this.log.error("could not re-provide key %c - %e",t,s)})}async reprovide(t,n){await Mo(this.contentRouting.provide(t,this.addressManager.getAddresses(),n))}}const O4e=20,R4e=5e3,L4e="kad-close",B4e=50;class U4e{constructor(e,t){u(this,"routingTable");u(this,"components");u(this,"closestPeers");u(this,"newPeers");u(this,"refreshInterval");u(this,"peerSetSize");u(this,"timeout");u(this,"closeTagName");u(this,"closeTagValue");u(this,"log");u(this,"running");this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.routingTable=t.routingTable,this.refreshInterval=t.refreshInterval??R4e,this.peerSetSize=t.peerSetSize??O4e,this.closeTagName=t.closeTagName??L4e,this.closeTagValue=t.closeTagValue??B4e,this.closestPeers=new is,this.onPeerPing=this.onPeerPing.bind(this),this.running=!1}async start(){if(this.running)return;this.running=!0;const e=await us(this.components.peerId);this.newPeers=new Tx(e,this.peerSetSize),this.routingTable.addEventListener("peer:ping",this.onPeerPing),this.timeout=setInterval(()=>{this.updatePeerTags().catch(t=>{this.log.error("error updating peer tags - %e",t)})},this.refreshInterval)}stop(){this.running=!1,this.routingTable.removeEventListener("peer:ping",this.onPeerPing),clearTimeout(this.timeout)}onPeerPing(e){var t;(t=this.newPeers)==null||t.add({id:e.detail,multiaddrs:[]}).catch(n=>{this.log.error("error adding peer to distance list - %e",n)})}async updatePeerTags(){var i;const e=new is((i=this.newPeers)==null?void 0:i.peers.map(s=>s.id)),t=e.difference(this.closestPeers),n=this.closestPeers.difference(e);this.closestPeers=e,await Promise.all([...[...t].map(async s=>{await this.components.peerStore.merge(s,{tags:{[this.closeTagName]:{value:this.closeTagValue},[YT]:{value:1}}})}),...[...n].map(async s=>{await this.components.peerStore.merge(s,{tags:{[this.closeTagName]:void 0,[YT]:void 0}})})])}}function c2(r){return Array.isArray(r==null?void 0:r.peers)}class F4e{constructor(e){u(this,"root");u(this,"localPeer");u(this,"prefixLength");u(this,"splitThreshold");u(this,"kBucketSize");u(this,"numberOfNodesToPing");u(this,"lastPingThreshold");u(this,"ping");u(this,"verify");u(this,"onAdd");u(this,"onRemove");u(this,"onMove");u(this,"addingPeerMap");this.prefixLength=e.prefixLength??K4e,this.kBucketSize=e.kBucketSize??rK,this.splitThreshold=e.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=e.numberOfOldContactsToPing??q4e,this.lastPingThreshold=e.lastPingThreshold??Y4e,this.ping=e.ping,this.verify=e.verify,this.onAdd=e.onAdd,this.onRemove=e.onRemove,this.addingPeerMap=new Oc,this.root={prefix:"",depth:0,peers:[]}}async addSelfPeer(e){this.localPeer={peerId:e,kadId:await us(e),lastPing:Date.now()}}async add(e,t){const n={peerId:e,kadId:await us(e),lastPing:0},i=this.addingPeerMap.get(e);if(i!=null)return i;try{const s=this._add(n,t);this.addingPeerMap.set(e,s),await s}finally{this.addingPeerMap.delete(e)}}async _add(e,t){var o;const n=this._determineBucket(e.kadId);if(this._indexOf(n,e.kadId)>-1)return;if(n.peers.length===this.splitThreshold&&n.depth<this.prefixLength){await this._split(n),await this._add(e,t);return}if(n.peers.length<this.kBucketSize){if(!V4e(e,this.lastPingThreshold)){n.peers.push(e),await((o=this.onAdd)==null?void 0:o.call(this,e,n));return}await this.verify(e,t)&&(e.lastPing=Date.now(),await this._add(e,t));return}const i=n.peers.filter(a=>{var c;return!(a.peerId.equals((c=this.localPeer)==null?void 0:c.peerId)||a.lastPing>Date.now()-this.lastPingThreshold)}).sort((a,c)=>a.lastPing<c.lastPing?-1:a.lastPing>c.lastPing?1:0).slice(0,this.numberOfNodesToPing);let s=!1;for await(const a of this.ping(i,t))s=!0,await this.remove(a.kadId);s&&await this._add(e,t)}*closest(e,t=this.kBucketSize){const n=new Tx(e,t);for(const i of this.toIterable())n.addWithKadId({id:i.peerId,multiaddrs:[]},i.kadId);yield*Nd(n.peers,i=>i.id)}count(){function e(t){if(c2(t))return t.peers.length;let n=0;return t.left!=null&&(n+=e(t.left)),t.right!=null&&(n+=e(t.right)),n}return e(this.root)}get(e){const t=this._determineBucket(e),n=this._indexOf(t,e);return t.peers[n]}async remove(e){var i;const t=this._determineBucket(e),n=this._indexOf(t,e);if(n>-1){const s=t.peers.splice(n,1)[0];await((i=this.onRemove)==null?void 0:i.call(this,s,t))}}*toIterable(){function*e(t){if(c2(t)){yield*t.peers;return}yield*e(t.left),yield*e(t.right)}yield*e(this.root)}distance(e,t){return BigInt("0x"+re(xc(e,t),"base16"))}_determineBucket(e){const t=re(e,"base2");function n(i,s=0){return c2(i)?i:t[s]==="0"?n(i.left,s+1):n(i.right,s+1)}return n(this.root)}_indexOf(e,t){return e.peers.findIndex(n=>Ke(n.kadId,t))}async _split(e){var i,s;const t={prefix:"0",depth:e.depth+1,peers:[]},n={prefix:"1",depth:e.depth+1,peers:[]};for(const o of e.peers)re(o.kadId,"base2")[e.depth]==="0"?(t.peers.push(o),await((i=this.onMove)==null?void 0:i.call(this,o,e,t))):(n.peers.push(o),await((s=this.onMove)==null?void 0:s.call(this,o,e,n)));z4e(e,t,n)}}function z4e(r,e,t){return delete r.peers,r.left=e,r.right=t,r.prefix===""&&(delete r.depth,delete r.prefix),!0}function V4e(r,e){return r.lastPing<Date.now()-e}const rK=20,K4e=6,H4e=20,j4e=100,q4e=3,W4e=20,G4e=100,cP="kad-peer",Q4e=1,Y4e=6e5,X4e=!0,J4e=1e3;class Z4e extends Yt{constructor(t,n){super();u(this,"kBucketSize");u(this,"kb");u(this,"network");u(this,"closestPeerTagger");u(this,"log");u(this,"components");u(this,"running");u(this,"pingNewContactTimeout");u(this,"pingNewContactQueue");u(this,"pingOldContactTimeout");u(this,"pingOldContactQueue");u(this,"populateFromDatastoreOnStart");u(this,"populateFromDatastoreLimit");u(this,"protocol");u(this,"peerTagName");u(this,"peerTagValue");u(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${n.logPrefix}:routing-table`),this.kBucketSize=n.kBucketSize??rK,this.running=!1,this.protocol=n.protocol,this.network=n.network,this.peerTagName=n.peerTagName??cP,this.peerTagValue=n.peerTagValue??Q4e,this.pingOldContacts=this.pingOldContacts.bind(this),this.verifyNewContact=this.verifyNewContact.bind(this),this.peerAdded=this.peerAdded.bind(this),this.peerRemoved=this.peerRemoved.bind(this),this.populateFromDatastoreOnStart=n.populateFromDatastoreOnStart??X4e,this.populateFromDatastoreLimit=n.populateFromDatastoreLimit??J4e,this.pingOldContactQueue=new vc({concurrency:n.pingOldContactConcurrency??W4e,metricName:`${n.metricsPrefix}_ping_old_contact_queue`,metrics:this.components.metrics,maxSize:n.pingOldContactMaxQueueSize??G4e}),this.pingOldContactTimeout=new ip({...n.pingOldContactTimeout??{},metrics:this.components.metrics,metricName:`${n.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`}),this.pingNewContactQueue=new vc({concurrency:n.pingNewContactConcurrency??H4e,metricName:`${n.metricsPrefix}_ping_new_contact_queue`,metrics:this.components.metrics,maxSize:n.pingNewContactMaxQueueSize??j4e}),this.pingNewContactTimeout=new ip({...n.pingNewContactTimeout??{},metrics:this.components.metrics,metricName:`${n.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`}),this.kb=new F4e({kBucketSize:n.kBucketSize,prefixLength:n.prefixLength,splitThreshold:n.splitThreshold,numberOfOldContactsToPing:n.numberOfOldContactsToPing,lastPingThreshold:n.lastPingThreshold,ping:this.pingOldContacts,verify:this.verifyNewContact,onAdd:this.peerAdded,onRemove:this.peerRemoved}),this.closestPeerTagger=new U4e(this.components,{logPrefix:n.logPrefix,routingTable:this,peerSetSize:n.closestPeerSetSize,refreshInterval:n.closestPeerSetRefreshInterval,closeTagName:n.closeTagName,closeTagValue:n.closeTagValue}),this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMinOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),routingTableKadBucketMaxOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_max_depth`),kadBucketEvents:this.components.metrics.registerCounterGroup(`${n.metricsPrefix}_kad_bucket_events_total`)})}isStarted(){return this.running}async start(){this.running||(this.running=!0,await Oo(this.closestPeerTagger),await this.kb.addSelfPeer(this.components.peerId))}async afterStart(){Promise.resolve().then(async()=>{if(!this.populateFromDatastoreOnStart)return;let t=0;for(const n of await this.components.peerStore.all({filters:[i=>i.protocols.includes(this.protocol)&&i.tags.has(cP)],limit:this.populateFromDatastoreLimit})){if(!this.running)return;try{await this.add(n.id),t++}catch{this.log("failed to add peer %p to routing table, removing kad-dht peer tags - %e"),await this.components.peerStore.merge(n.id,{tags:{[this.peerTagName]:void 0}})}}this.log("added %d peer store peers to the routing table",t)}).catch(t=>{this.log.error("error adding peer store peers to the routing table %e",t)})}async stop(){this.running=!1,await Nc(this.closestPeerTagger),this.pingOldContactQueue.abort(),this.pingNewContactQueue.abort()}async peerAdded(t,n){var i;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:{value:this.peerTagValue}}}),this.updateMetrics(),(i=this.metrics)==null||i.kadBucketEvents.increment({peer_added:!0}),this.safeDispatchEvent("peer:add",{detail:t.peerId})}async peerRemoved(t,n){var i;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:void 0}}),this.updateMetrics(),(i=this.metrics)==null||i.kadBucketEvents.increment({peer_removed:!0}),this.safeDispatchEvent("peer:remove",{detail:t.peerId})}async*pingOldContacts(t,n){var s;if(!this.running)return;const i=[];for(const o of t){if(this.kb.get(o.kadId)==null){this.log("asked to ping contact %p that was not in routing table",o.peerId);continue}(s=this.metrics)==null||s.kadBucketEvents.increment({ping_old_contact:!0}),i.push(async()=>{const a=this.pingOldContactQueue.find(o.peerId);if(a!=null)return this.log("asked to ping contact %p was already being pinged",o.peerId),await a.join(n)?void 0:o;if(!await this.pingOldContactQueue.add(async l=>{var p;const h=this.pingOldContactTimeout.getTimeoutSignal(),d=ct([h,l==null?void 0:l.signal]);try{return await this.pingContact(o,l)}catch{return(p=this.metrics)==null||p.kadBucketEvents.increment({ping_old_contact_error:!0}),!0}finally{this.pingOldContactTimeout.cleanUp(h),d.clear()}},{peerId:o.peerId,signal:n==null?void 0:n.signal}))return o})}for await(const o of Gp(i))o!=null&&(yield o)}async verifyNewContact(t,n){var o;const i=this.pingNewContactTimeout.getTimeoutSignal(),s=ct([i,n==null?void 0:n.signal]);try{const a=this.pingNewContactQueue.find(t.peerId);return a!=null?(this.log("joining existing ping to add new peer %p to routing table",t.peerId),await a.join({signal:s})):await this.pingNewContactQueue.add(async c=>{var l;return(l=this.metrics)==null||l.kadBucketEvents.increment({ping_new_contact:!0}),this.log("pinging new peer %p before adding to routing table",t.peerId),this.pingContact(t,c)},{peerId:t.peerId,signal:s})}catch{return this.log.trace("tried to add peer %p but they were not online",t.peerId),(o=this.metrics)==null||o.kadBucketEvents.increment({ping_new_contact_error:!0}),!1}finally{this.pingNewContactTimeout.cleanUp(i),s.clear()}}async pingContact(t,n){try{this.log("pinging contact %p",t.peerId);for await(const i of this.network.sendRequest(t.peerId,{type:bt.PING},n))if(i.type===Wv.PEER_RESPONSE)return i.messageType===bt.PING?(this.log("contact %p ping ok",t.peerId),this.safeDispatchEvent("peer:ping",{detail:t.peerId}),!0):!1;return!1}catch(i){return this.log("error pinging old contact %p - %e",t.peerId,i),!1}}get size(){return this.kb==null?0:this.kb.count()}async find(t){var i;const n=await us(t);return(i=this.kb.get(n))==null?void 0:i.peerId}closestPeer(t){const n=this.closestPeers(t,1);if(n.length>0)return n[0]}closestPeers(t,n=this.kBucketSize){return this.kb==null?[]:[...this.kb.closest(t,n)]}async add(t,n){if(this.kb==null)throw new Error("RoutingTable is not started");await this.kb.add(t,n)}async remove(t){if(this.kb==null)throw new Error("RoutingTable is not started");const n=await us(t);await this.kb.remove(n)}updateMetrics(){if(this.metrics==null||this.kb==null)return;let t=0,n=0,i=0,s=20,o=0;function a(c){if(c2(c)){c.depth>i&&(i=c.depth),n++,t+=c.peers.length,c.peers.length<s&&(s=c.peers.length),c.peers.length>o&&(o=c.peers.length);return}a(c.left),a(c.right)}a(this.kb.root),this.metrics.routingTableSize.update(t),this.metrics.routingTableKadBucketTotal.update(n),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(t/n)),this.metrics.routingTableKadBucketMinOccupancy.update(s),this.metrics.routingTableKadBucketMaxOccupancy.update(o),this.metrics.routingTableKadBucketMaxDepth.update(i)}}const e8e=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],pg=15;class t8e{constructor(e,t){u(this,"log");u(this,"peerRouting");u(this,"routingTable");u(this,"refreshInterval");u(this,"refreshQueryTimeout");u(this,"commonPrefixLengthRefreshedAt");u(this,"refreshTimeoutId");const{peerRouting:n,routingTable:i,refreshInterval:s,refreshQueryTimeout:o,logPrefix:a}=t;this.log=e.logger.forComponent(`${a}:routing-table:refresh`),this.peerRouting=n,this.routingTable=i,this.refreshInterval=s??twe,this.refreshQueryTimeout=o??rwe,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async afterStart(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");const t=this._maxCommonPrefix(),n=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${n.map(i=>i.toISOString()).join(", ")} ]`),Promise.all(n.map(async(i,s)=>{try{if(await this._refreshCommonPrefixLength(s,i,e),this._numPeersForCpl(t)===0){const o=Math.min(2*(s+1),n.length-1);for(let a=s+1;a<o+1;a++)try{await this._refreshCommonPrefixLength(a,i,e)}catch(c){this.log.error(c)}}}catch(o){this.log.error(o)}})).catch(i=>{this.log.error(i)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(i=>{this.log.error(i)})}async _refreshCommonPrefixLength(e,t,n){if(!n&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}const i=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,i,this.routingTable.size);const s=AbortSignal.timeout(this.refreshQueryTimeout),o=await tK(this.peerRouting.getClosestPeers(i.toMultihash().bytes,{signal:s}));this.log(`found ${o} peers that were close to imaginary peer %p`,i),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,i,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(e){e>pg&&(e=pg);const t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}async _generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");if(this.routingTable.kb.localPeer==null)throw new Error("Local peer not set");const t=bc(2),n=(t[1]<<8)+t[0],i=await this._makePeerId(this.routingTable.kb.localPeer.kadId,n,e),s=wu(i);return ri(s)}async _makePeerId(e,t,n){if(n>pg)throw new Error(`Cannot generate peer ID for common prefix length greater than ${pg}`);const o=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>n,a=65535<<16-(n+1),c=o&a|t&~a,l=e8e[c],h=new ArrayBuffer(34),d=new DataView(h,0,h.byteLength);return d.setUint8(0,XV.code),d.setUint8(1,32),d.setUint32(2,l,!1),new Uint8Array(d.buffer,d.byteOffset,d.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){var e;if(((e=this.routingTable.kb)==null?void 0:e.localPeer)!=null)for(const{kadId:t}of this.routingTable.kb.toIterable()){const n=xc(this.routingTable.kb.localPeer.kadId,t);let i=0;for(const s of n)if(s===0)i++;else break;yield i}}}class r8e{constructor(e,t){u(this,"peerId");u(this,"providers");u(this,"peerStore");u(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:add-provider`),this.peerId=e.peerId,this.providers=t.providers,this.peerStore=e.peerStore}async handle(e,t){if(t.key==null||t.key.length===0)throw new wt("Missing key");let n;try{n=_x.decode(t.key)}catch{throw new wt("Invalid CID")}(t.providers==null||t.providers.length===0)&&this.log.error("no providers found in message"),this.log("%p asked us, %p to store provider record for for %c",e,this.peerId,n),await Promise.all(t.providers.map(async i=>{const s=wu(i.id),o=ri(s),a=i.multiaddrs.map(c=>$e(c));if(!e.equals(o)){this.log("invalid provider peer %p from %p",i.id,e);return}if(i.multiaddrs.length<1){this.log("no valid addresses for provider %p. Ignore",e);return}this.log.trace("received provider %p for %s (addrs %s)",e,n,a),await this.providers.addProvider(n,o),await this.peerStore.merge(o,{multiaddrs:a})}))}}class n8e{constructor(e,t){u(this,"peerRouting");u(this,"peerInfoMapper");u(this,"peerId");u(this,"addressManager");u(this,"log");const{peerRouting:n,logPrefix:i}=t;this.log=e.logger.forComponent(`${i}:rpc:handlers:find-node`),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=n,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(this.log("incoming request from %p for peers closer to %b",e,t.key),t.key==null)throw new wt("Invalid FIND_NODE message received - key was missing");const n=await this.peerRouting.getCloserPeersOffline(t.key,e);Ke(this.peerId.toMultihash().bytes,t.key)&&n.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(s=>s.decapsulateCode(Ue("p2p").code))});const i={type:bt.FIND_NODE,clusterLevel:t.clusterLevel,closer:n.map(this.peerInfoMapper).filter(({multiaddrs:s})=>s.length).map(s=>({id:s.id.toMultihash().bytes,multiaddrs:s.multiaddrs.map(o=>o.bytes)})),providers:[]};return i.closer.length===0&&this.log("could not find any peers closer to %b than %p",t.key,e),i}}class i8e{constructor(e,t){u(this,"peerId");u(this,"peerRouting");u(this,"providers");u(this,"peerStore");u(this,"peerInfoMapper");u(this,"log");const{peerRouting:n,providers:i,logPrefix:s}=t;this.log=e.logger.forComponent(`${s}:rpc:handlers:get-providers`),this.peerId=e.peerId,this.peerStore=e.peerStore,this.peerRouting=n,this.providers=i,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(t.key==null)throw new wt("Invalid GET_PROVIDERS message received - key was missing");let n;try{n=_x.decode(t.key)}catch{throw new wt("Invalid CID")}this.log("%p asking for providers for %s",e,n);const[i,s]=await Promise.all([im(Nd(await this.providers.getProviders(n),async a=>{const c=await this.peerStore.get(a);return{id:c.id,multiaddrs:c.addresses.map(({multiaddr:h})=>h)}})),this.peerRouting.getCloserPeersOffline(t.key,this.peerId)]),o={type:bt.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:s.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)})),providers:i.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))};return this.log("got %s providers %s closerPeers",o.providers.length,o.closer.length),o}async _getAddresses(e){return[]}}class s8e{constructor(e,t){u(this,"peerStore");u(this,"datastore");u(this,"peerRouting");u(this,"log");u(this,"datastorePrefix");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:get-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}async handle(e,t){const n=t.key;if(this.log("%p asked for key %b",e,n),n==null||n.length===0)throw new wt("Invalid key");const i={type:bt.GET_VALUE,key:n,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(Zwe(n)){this.log("is public key");const a=e4e(n);let c;try{const l=await this.peerStore.get(a);if(l.id.publicKey==null)throw new Qt("No public key found in key book");c=_i(l.id.publicKey)}catch(l){if(l.name!=="NotFoundError")throw l}if(c!=null)return this.log("returning found public key"),i.record=new Ti(n,c,new Date).serialize(),i}const[s,o]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getCloserPeersOffline(n,e)]);return s!=null&&(this.log("had record for %b in local datastore",n),i.record=s.serialize()),o.length>0&&(this.log("had %s closer peers in routing table",o.length),i.closer=o.map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))),i}async _checkLocalDatastore(e){this.log("checkLocalDatastore looking for %b",e);const t=u1(this.datastorePrefix,e);let n;try{n=await this.datastore.get(t)}catch(s){if(s.name==="NotFoundError")return;throw s}const i=Ti.deserialize(n);if(i.timeReceived==null||Date.now()-i.timeReceived.getTime()>j3e){await this.datastore.delete(t);return}return i}}class o8e{constructor(e,t){u(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:ping`)}async handle(e,t){return this.log("ping from %p",e),t}}class a8e{constructor(e,t){u(this,"components");u(this,"validators");u(this,"log");u(this,"datastorePrefix");const{validators:n}=t;this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:put-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n}async handle(e,t){const n=t.key;if(this.log("%p asked us to store value for key %b",e,n),t.record==null){const i=`Empty record from: ${e.toString()}`;throw this.log.error(i),new wt(i)}try{const i=Ti.deserialize(t.record);await Cx(this.validators,i),i.timeReceived=new Date;const s=u1(this.datastorePrefix,i.key);await this.components.datastore.put(s,i.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,s)}catch(i){this.log("did not put record for key %b into datastore %o",n,i)}return t}}let c8e=class{constructor(e,t){u(this,"handlers");u(this,"routingTable");u(this,"log");u(this,"metrics");var n,i;this.metrics={operations:(n=e.metrics)==null?void 0:n.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_requests_total`),errors:(i=e.metrics)==null?void 0:i.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_errors_total`)},this.log=e.logger.forComponent(`${t.logPrefix}:rpc`),this.routingTable=t.routingTable,this.handlers={[bt.GET_VALUE.toString()]:new s8e(e,t),[bt.PUT_VALUE.toString()]:new a8e(e,t),[bt.FIND_NODE.toString()]:new n8e(e,t),[bt.ADD_PROVIDER.toString()]:new r8e(e,t),[bt.GET_PROVIDERS.toString()]:new i8e(e,t),[bt.PING.toString()]:new o8e(e,t)}}async handleMessage(e,t){var i,s;const n=this.handlers[t.type];if(n==null){this.log.error(`no handler found for message type: ${t.type}`);return}try{return(i=this.metrics.operations)==null||i.increment({[t.type]:!0}),await n.handle(e,t)}catch{(s=this.metrics.errors)==null||s.increment({[t.type]:!0})}}onIncomingStream(e){let t="unknown";Promise.resolve().then(async()=>{const{stream:n,connection:i}=e,s=i.remotePeer,o=this;await cn(n,a=>Qh(a),async function*(a){for await(const c of a){const l=$l.decode(c);t=l.type,o.log("incoming %s from %p",l.type,s);const h=await o.handleMessage(s,l);h!=null&&(yield $l.encode(h))}},a=>Gh(a),n)}).catch(n=>{this.log.error("error handling %s RPC message from %p - %e",t,e.connection.remotePeer,n)})}};class l8e extends Yt{constructor(t,n){super();u(this,"log");u(this,"components");u(this,"protocol");u(this,"running");u(this,"registrarId");const{protocol:i,logPrefix:s}=n;this.components=t,this.log=t.logger.forComponent(`${s}:topology-listener`),this.running=!1,this.protocol=i}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:t=>{this.log("observed peer %p with protocol %s",t,this.protocol),this.dispatchEvent(new CustomEvent("peer",{detail:t}))}}))}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class u8e{constructor(e){u(this,"dht");this.dht=e}async provide(e,t={}){await Mo(this.dht.provide(e,t))}async cancelReprovide(e){await this.dht.cancelReprovide(e)}async*findProviders(e,t={}){for await(const n of this.dht.findProviders(e,t))n.name==="PROVIDER"&&(yield*n.providers)}async put(e,t,n){await Mo(this.dht.put(e,t,n))}async get(e,t){for await(const n of this.dht.get(e,t))if(n.name==="VALUE")return n.value;throw new Qt("Could not find value for key")}}class h8e{constructor(e){u(this,"dht");this.dht=e}async findPeer(e,t={}){for await(const n of this.dht.findPeer(e,t))if(n.name==="FINAL_PEER")return n.peer;throw new Qt("Peer not found")}async*getClosestPeers(e,t={}){for await(const n of this.dht.getClosestPeers(e,t))n.name==="FINAL_PEER"&&(yield n.peer)}}const d8e=32,f8e=64;var ON,RN,LN;class p8e extends Yt{constructor(t,n={}){var h,d,p,m;super();u(this,"protocol");u(this,"routingTable");u(this,"providers");u(this,"network");u(this,"peerRouting");u(this,"components");u(this,"log");u(this,"running");u(this,"kBucketSize");u(this,"clientMode");u(this,"validators");u(this,"selectors");u(this,"queryManager");u(this,"contentFetching");u(this,"contentRouting");u(this,"routingTableRefresh");u(this,"rpc");u(this,"topologyListener");u(this,"querySelf");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"dhtContentRouting");u(this,"dhtPeerRouting");u(this,"peerInfoMapper");u(this,"reprovider");u(this,LN,"@libp2p/kad-dht");u(this,RN,["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery"]);u(this,ON,["@libp2p/identify"]);const i=n.logPrefix??"libp2p:kad-dht",s=n.datastorePrefix??"/dht",o=n.metricsPrefix??"libp2p_kad_dht",a={queries:(h=t.metrics)==null?void 0:h.registerMetricGroup(`${o}_operations_total`,{label:"operation"}),errors:(d=t.metrics)==null?void 0:d.registerCounterGroup(`${o}_operation_errors_total`,{label:"operation"}),queryTime:(p=t.metrics)==null?void 0:p.registerMetricGroup(`${o}_operation_time_seconds`,{label:"operation"}),errorTime:(m=t.metrics)==null?void 0:m.registerMetricGroup(`${o}_operation_error_time_seconds`,{label:"operation"})};this.running=!1,this.components=t,this.log=t.logger.forComponent(i),this.protocol=n.protocol??q3e,this.kBucketSize=n.kBucketSize??20,this.clientMode=n.clientMode??!0,this.maxInboundStreams=n.maxInboundStreams??d8e,this.maxOutboundStreams=n.maxOutboundStreams??f8e,this.peerInfoMapper=n.peerInfoMapper??Xwe;const c=jS();this.providers=new I4e(t,{...n.providers,logPrefix:i,datastorePrefix:s,lock:c}),this.validators={...fwe,...n.validators},this.selectors={...hwe,...n.selectors},this.network=new A4e(t,{protocol:this.protocol,logPrefix:i,metricsPrefix:o}),this.routingTable=new Z4e(t,{kBucketSize:n.kBucketSize,pingOldContactTimeout:n.pingOldContactTimeout,pingOldContactConcurrency:n.pingOldContactConcurrency,pingOldContactMaxQueueSize:n.pingOldContactMaxQueueSize,pingNewContactTimeout:n.pingNewContactTimeout,pingNewContactConcurrency:n.pingNewContactConcurrency,pingNewContactMaxQueueSize:n.pingNewContactMaxQueueSize,protocol:this.protocol,logPrefix:i,metricsPrefix:o,prefixLength:n.prefixLength,splitThreshold:n.kBucketSplitThreshold,network:this.network});const l=Oe();n.allowQueryWithZeroPeers===!0&&l.resolve(),this.queryManager=new _4e(t,{disjointPaths:Math.ceil(this.kBucketSize/2),logPrefix:i,metricsPrefix:o,initialQuerySelfHasRun:l,routingTable:this.routingTable}),this.peerRouting=new C4e(t,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:i}),this.contentFetching=new c4e(t,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:i,datastorePrefix:s}),this.contentRouting=new u4e(t,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:i}),this.routingTableRefresh=new t8e(t,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:i}),this.rpc=new c8e(t,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:i,metricsPrefix:o,datastorePrefix:s,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new l8e(t,{protocol:this.protocol,logPrefix:i}),this.querySelf=new N4e(t,{peerRouting:this.peerRouting,interval:n.querySelfInterval,initialInterval:n.initialQuerySelfInterval,logPrefix:i,initialQuerySelfHasRun:l,routingTable:this.routingTable,operationMetrics:a}),this.reprovider=new M4e(t,{...n.reprovide,logPrefix:i,metricsPrefix:o,datastorePrefix:s,contentRouting:this.contentRouting,lock:c,operationMetrics:a}),this.network.addEventListener("peer",f=>{const g=f.detail;this.onPeerConnect(g).catch(v=>{this.log.error("could not add %p to routing table",g.id,v)}),this.dispatchEvent(new CustomEvent("peer",{detail:g}))}),this.topologyListener.addEventListener("peer",f=>{const g=f.detail;Promise.resolve().then(async()=>{const v=await this.components.peerStore.get(g),y={id:g,multiaddrs:v.addresses.map(({multiaddr:w})=>w),protocols:v.protocols};await this.onPeerConnect(y)}).catch(v=>{this.log.error("could not add %p to routing table - %e",g,v)})}),this.dhtPeerRouting=new h8e(this),this.dhtContentRouting=new u8e(this),n.clientMode==null&&t.events.addEventListener("self:peer:update",f=>{this.log("received update of self-peer info"),Promise.resolve().then(async()=>{const g=f.detail.peer.addresses.some(({multiaddr:y})=>a4e(y)),v=this.getMode();g&&v==="client"?await this.setMode("server"):v==="server"&&!g&&await this.setMode("client")}).catch(g=>{this.log.error("error setting dht server mode",g)})}),this.get=Bu(this.get.bind(this),a,"GET_VALUE"),this.findProviders=Bu(this.findProviders.bind(this),a,"FIND_PROVIDERS"),this.findPeer=Bu(this.findPeer.bind(this),a,"FIND_PEER"),this.getClosestPeers=Bu(this.getClosestPeers.bind(this),a,"GET_CLOSEST_PEERS"),this.provide=Bu(this.provide.bind(this),a,"PROVIDE"),this.put=Bu(this.put.bind(this),a,"PUT_VALUE")}get[(LN=Symbol.toStringTag,RN=ur,ON=mc,Vh)](){return this.dhtContentRouting}get[Kh](){return this.dhtPeerRouting}get[ey](){return this}async onPeerConnect(t){if(this.log.trace("peer %p connected",t.id),t=this.peerInfoMapper(t),t.multiaddrs.length===0){this.log.trace("ignoring %p as there were no valid addresses in %s after filtering",t.id,t.multiaddrs.map(n=>n.toString()));return}try{await this.routingTable.add(t.id)}catch(n){this.log.error("could not add %p to routing table",t.id,n)}}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(t,n=!1){if(t===this.getMode()&&!n){this.log("already in %s mode",t);return}if(await this.components.registrar.unhandle(this.protocol),t===this.getMode()&&!n){this.log("already in %s mode",t);return}t==="client"?(this.log("enabling client mode while in %s mode",this.getMode()),this.clientMode=!0):(this.log("enabling server mode while in %s mode",this.getMode()),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running||(this.running=!0,await this.setMode(this.clientMode?"client":"server",!0),await Oo(this.routingTable,this.queryManager,this.network,this.topologyListener,this.routingTableRefresh,this.reprovider),await Oo(this.querySelf))}async stop(){this.running=!1,await Nc(this.querySelf,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener,this.reprovider)}async*put(t,n,i={}){yield*this.contentFetching.put(t,n,i)}async*get(t,n={}){yield*this.contentFetching.get(t,n)}async*provide(t,n={}){yield*this.contentRouting.provide(t,this.components.addressManager.getAddresses(),n)}async cancelReprovide(t){await this.providers.removeProvider(t,this.components.peerId)}async*findProviders(t,n={}){yield*this.contentRouting.findProviders(t,n)}async*findPeer(t,n={}){yield*this.peerRouting.findPeer(t,n)}async*getClosestPeers(t,n={}){yield*this.peerRouting.getClosestPeers(t,n)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}}var Wv;(function(r){r[r.SEND_QUERY=0]="SEND_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADD_PEER=6]="ADD_PEER",r[r.DIAL_PEER=7]="DIAL_PEER"})(Wv||(Wv={}));function g8e(r={}){return e=>new p8e(e,r)}var y8e=r=>{if(Object.prototype.toString.call(r)!=="[object Object]")return!1;const e=Object.getPrototypeOf(r);return e===null||e===Object.prototype};const xm=y8e,{hasOwnProperty:nK}=Object.prototype,{propertyIsEnumerable:m8e}=Object,ud=(r,e,t)=>Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),w8e=v1,lP={concatArrays:!1,ignoreUndefined:!1},Kw=r=>{const e=[];for(const t in r)nK.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){const t=Object.getOwnPropertySymbols(r);for(const n of t)m8e.call(r,n)&&e.push(n)}return e};function Bd(r){return Array.isArray(r)?b8e(r):xm(r)?v8e(r):r}function b8e(r){const e=r.slice(0,0);return Kw(r).forEach(t=>{ud(e,t,Bd(r[t]))}),e}function v8e(r){const e=Object.getPrototypeOf(r)===null?Object.create(null):{};return Kw(r).forEach(t=>{ud(e,t,Bd(r[t]))}),e}const iK=(r,e,t,n)=>(t.forEach(i=>{typeof e[i]>"u"&&n.ignoreUndefined||(i in r&&r[i]!==Object.getPrototypeOf(r)?ud(r,i,Gv(r[i],e[i],n)):ud(r,i,Bd(e[i])))}),r),E8e=(r,e,t)=>{let n=r.slice(0,0),i=0;return[r,e].forEach(s=>{const o=[];for(let a=0;a<s.length;a++)nK.call(s,a)&&(o.push(String(a)),s===r?ud(n,i++,s[a]):ud(n,i++,Bd(s[a])));n=iK(n,s,Kw(s).filter(a=>!o.includes(a)),t)}),n};function Gv(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?E8e(r,e,t):!xm(e)||!xm(r)?Bd(e):iK(r,e,Kw(e),t)}var S8e=function(...r){const e=Gv(Bd(lP),this!==w8e&&this||{},lP);let t={_:{}};for(const n of r)if(n!==void 0){if(!xm(n))throw new TypeError("`"+n+"` is not an Option Object");t=Gv(t,{_:n},e)}return t._};const Px=Vo(S8e);function x8e(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function A8e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var C8e=A8e,I8e=C8e;let k8e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},_8e=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return sK(this,e)}},T8e=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return sK(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function sK(r,e){return new T8e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let P8e=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new k8e(e,t,n),this.decoder=new _8e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function oK({name:r,prefix:e,encode:t,decode:n}){return new P8e(r,e,t,n)}function aK({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=I8e(t,r);return oK({prefix:e,name:r,encode:n,decode:s=>x8e(i(s))})}function D8e(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function $8e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Hw({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return oK({prefix:e,name:r,encode(i){return $8e(i,n,t)},decode(i){return D8e(i,n,t,r)}})}const N8e=aK({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});aK({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var M8e=cK,uP=128,O8e=-128,R8e=Math.pow(2,31);function cK(r,e,t){e=e||[],t=t||0;for(var n=t;r>=R8e;)e[t++]=r&255|uP,r/=128;for(;r&O8e;)e[t++]=r&255|uP,r>>>=7;return e[t]=r|0,cK.bytes=t-n+1,e}var L8e=Qv,B8e=128,hP=127;function Qv(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw Qv.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&hP)<<i:(o&hP)*Math.pow(2,i),i+=7}while(o>=B8e);return Qv.bytes=s-n,t}var U8e=Math.pow(2,7),F8e=Math.pow(2,14),z8e=Math.pow(2,21),V8e=Math.pow(2,28),K8e=Math.pow(2,35),H8e=Math.pow(2,42),j8e=Math.pow(2,49),q8e=Math.pow(2,56),W8e=Math.pow(2,63),G8e=function(r){return r<U8e?1:r<F8e?2:r<z8e?3:r<V8e?4:r<K8e?5:r<H8e?6:r<j8e?7:r<q8e?8:r<W8e?9:10},Q8e={encode:M8e,decode:L8e,encodingLength:G8e},lK=Q8e;function dP(r,e,t=0){return lK.encode(r,e,t),e}function fP(r){return lK.encodingLength(r)}function pP(r,e){const t=e.byteLength,n=fP(r),i=n+fP(t),s=new Uint8Array(i+t);return dP(r,s,0),dP(t,s,n),s.set(e,i),new Y8e(r,t,e,s)}let Y8e=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function X8e({name:r,code:e,encode:t}){return new J8e(r,e,t)}let J8e=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?pP(this.code,t):t.then(n=>pP(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Z8e(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const e5e=X8e({name:"sha2-256",code:18,encode:Z8e("SHA-256")});function t5e(r){return r>=55296&&r<=56319}function r5e(r){return r>=56320&&r<=57343}var n5e=function(e,t,n){if(typeof t!="string")throw new Error("Input must be string");for(var i=t.length,s=0,o,a,c=0;c<i;c+=1){if(o=t.charCodeAt(c),a=t[c],t5e(o)&&r5e(t.charCodeAt(c+1))&&(c+=1,a+=t[c]),s+=e(a),s===n)return t.slice(0,c+1);if(s>n)return t.slice(0,c-a.length+1)}return t};function i5e(r){return r>=55296&&r<=56319}function s5e(r){return r>=56320&&r<=57343}var o5e=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var t=e.length,n=0,i=null,s=null,o=0;o<t;o++)i=e.charCodeAt(o),s5e(i)?s!=null&&i5e(s)?n+=1:n+=3:i<=127?n+=1:i>=128&&i<=2047?n+=2:i>=2048&&i<=65535&&(n+=3),s=i;return n},a5e=n5e,c5e=o5e,l5e=a5e.bind(null,c5e),u5e=l5e,h5e=/[\/\?<>\\:\*\|"]/g,d5e=/[\x00-\x1f\x80-\x9f]/g,f5e=/^\.+$/,p5e=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,g5e=/[\. ]+$/;function gP(r,e){if(typeof r!="string")throw new Error("Input must be string");var t=r.replace(h5e,e).replace(d5e,e).replace(f5e,e).replace(p5e,e).replace(g5e,e);return u5e(t,255)}var y5e=function(r,e){var t=e&&e.replacement||"",n=gP(r,t);return t===""?n:gP(n,"")};const m5e=Vo(y5e),E5={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function uK(r){const e="AES-GCM";let t=16;const n=12,i="SHA-256",s=16,o=32767,a=Fs.get();t*=8;async function c(d,p){const m=a.getRandomValues(new Uint8Array(s)),f=a.getRandomValues(new Uint8Array(n)),g={name:e,iv:f};typeof p=="string"&&(p=se(p));let v;if(p.length===0){v=await a.subtle.importKey("jwk",E5,{name:"AES-GCM"},!0,["encrypt"]);try{const w={name:"PBKDF2",salt:m,iterations:o,hash:{name:i}},b=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);v=await a.subtle.deriveKey(w,b,{name:e,length:t},!0,["encrypt"])}catch{v=await a.subtle.importKey("jwk",E5,{name:"AES-GCM"},!0,["encrypt"])}}else{const w={name:"PBKDF2",salt:m,iterations:o,hash:{name:i}},b=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);v=await a.subtle.deriveKey(w,b,{name:e,length:t},!0,["encrypt"])}const y=await a.subtle.encrypt(g,v,d);return er([m,g.iv,new Uint8Array(y)])}async function l(d,p){const m=d.subarray(0,s),f=d.subarray(s,s+n),g=d.subarray(s+n),v={name:e,iv:f};typeof p=="string"&&(p=se(p));let y;if(p.length===0)try{const b={name:"PBKDF2",salt:m,iterations:o,hash:{name:i}},E=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(b,E,{name:e,length:t},!0,["decrypt"])}catch{y=await a.subtle.importKey("jwk",E5,{name:"AES-GCM"},!0,["decrypt"])}else{const b={name:"PBKDF2",salt:m,iterations:o,hash:{name:i}},E=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(b,E,{name:e,length:t},!0,["decrypt"])}const w=await a.subtle.decrypt(v,y,g);return new Uint8Array(w)}return{encrypt:c,decrypt:l}}/*!
 * MIT License
 * 
 * Copyright (c) 2017-2024 Peculiar Ventures, LLC
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const w5e="[object ArrayBuffer]";class le{static isArrayBuffer(e){return Object.prototype.toString.call(e)===w5e}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const n=le.toUint8Array(e),i=le.toUint8Array(t);if(n.length!==i.byteLength)return!1;for(let s=0;s<n.length;s++)if(n[s]!==i[s])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let n=0;for(const o of t)n+=o.byteLength;const i=new Uint8Array(n);let s=0;for(const o of t){const a=this.toUint8Array(o);i.set(a,s),s+=a.length}return e[e.length-1]instanceof Function?this.toView(i,e[e.length-1]):i.buffer}}const S5="string",b5e=/^[0-9a-f\s]+$/i,v5e=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,E5e=/^[a-zA-Z0-9-_]+$/;class yP{static fromString(e){const t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n.buffer}static toString(e){const t=le.toUint8Array(e);let n="";for(let s=0;s<t.length;s++)n+=String.fromCharCode(t[s]);return decodeURIComponent(escape(n))}}class Ss{static toString(e,t=!1){const n=le.toArrayBuffer(e),i=new DataView(n);let s="";for(let o=0;o<n.byteLength;o+=2){const a=i.getUint16(o,t);s+=String.fromCharCode(a)}return s}static fromString(e,t=!1){const n=new ArrayBuffer(e.length*2),i=new DataView(n);for(let s=0;s<e.length;s++)i.setUint16(s*2,e.charCodeAt(s),t);return n}}class Ee{static isHex(e){return typeof e===S5&&b5e.test(e)}static isBase64(e){return typeof e===S5&&v5e.test(e)}static isBase64Url(e){return typeof e===S5&&E5e.test(e)}static ToString(e,t="utf8"){const n=le.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return Ss.toString(n,!0);case"utf16":case"utf16be":return Ss.toString(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return Ss.fromString(e,!0);case"utf16":case"utf16be":return Ss.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=le.toUint8Array(e);if(typeof btoa<"u"){const n=this.ToString(t,"binary");return btoa(n)}else return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ee.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ee.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=Ee.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return yP.fromString(e);case"utf16":case"utf16be":return Ss.fromString(e);case"utf16le":case"usc2":return Ss.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=Ee.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return yP.toString(e);case"utf16":case"utf16be":return Ss.toString(e);case"utf16le":case"usc2":return Ss.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);return n.buffer}static ToBinary(e){const t=le.toUint8Array(e);let n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return n}static ToHex(e){const t=le.toUint8Array(e);let n="";const i=t.length;for(let s=0;s<i;s++){const o=t[s];o<16&&(n+="0"),n+=o.toString(16)}return n}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ee.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const n=new Uint8Array(t.length/2);for(let i=0;i<t.length;i=i+2){const s=t.slice(i,i+2);n[i/2]=parseInt(s,16)}return n.buffer}static ToUtf16String(e,t=!1){return Ss.toString(e,t)}static FromUtf16String(e,t=!1){return Ss.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}static formatString(e){return(e==null?void 0:e.replace(/[\n\r\t ]/g,""))||""}}Ee.DEFAULT_UTF8_ENCODING="utf8";function S5e(...r){const e=r.map(i=>i.byteLength).reduce((i,s)=>i+s),t=new Uint8Array(e);let n=0;return r.map(i=>new Uint8Array(i)).forEach(i=>{for(const s of i)t[n++]=s}),t.buffer}function hK(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<r.byteLength;i++)if(t[i]!==n[i])return!1;return!0}/*!
 Copyright (c) Peculiar Ventures, LLC
*/function hd(r,e){let t=0;if(r.length===1)return r[0];for(let n=r.length-1;n>=0;n--)t+=r[r.length-1-n]*Math.pow(2,e*n);return t}function Jl(r,e,t=-1){const n=t;let i=r,s=0,o=Math.pow(2,e);for(let a=1;a<8;a++){if(r<o){let c;if(n<0)c=new ArrayBuffer(a),s=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),s=n}const l=new Uint8Array(c);for(let h=a-1;h>=0;h--){const d=Math.pow(2,h*e);l[s-h-1]=Math.floor(i/d),i-=l[s-h-1]*d}return c}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function Yv(...r){let e=0,t=0;for(const s of r)e+=s.length;const n=new ArrayBuffer(e),i=new Uint8Array(n);for(const s of r)i.set(s,t),t+=s.length;return i}function dK(){const r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const a=r[0]===255&&r[1]&128,c=r[0]===0&&(r[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=r[0]&128;const n=hd(t,8),i=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(i);for(let a=0;a<this.valueHex.byteLength;a++)s[a]=r[a];return s[0]&=127,hd(s,8)-n}function x5e(r){const e=r<0?r*-1:r;let t=128;for(let n=1;n<8;n++){if(e<=t){if(r<0){const o=t-e,a=Jl(o,8,n),c=new Uint8Array(a);return c[0]|=128,a}let i=Jl(e,8,n),s=new Uint8Array(i);if(s[0]&128){const o=i.slice(0),a=new Uint8Array(o);i=new ArrayBuffer(i.byteLength+1),s=new Uint8Array(i);for(let c=0;c<o.byteLength;c++)s[c+1]=a[c];s[0]=0}return i}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function A5e(r,e){if(r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<t.length;i++)if(t[i]!==n[i])return!1;return!0}function Hn(r,e){const t=r.toString(10);if(e<t.length)return"";const n=e-t.length,i=new Array(n);for(let o=0;o<n;o++)i[o]="0";return i.join("").concat(t)}/*!
 * Copyright (c) 2014, GMO GlobalSign
 * Copyright (c) 2015-2022, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */function Am(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Dx(r){let e=0,t=0;for(let i=0;i<r.length;i++){const s=r[i];e+=s.byteLength}const n=new Uint8Array(e);for(let i=0;i<r.length;i++){const s=r[i];n.set(new Uint8Array(s),t),t+=s.byteLength}return n.buffer}function ea(r,e,t,n){return e instanceof Uint8Array?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class jw{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return Dx(this.items)}}const Nf=[new Uint8Array([1])],mP="0123456789",x5="name",wP="valueHexView",C5e="isHexOnly",I5e="idBlock",k5e="tagClass",_5e="tagNumber",T5e="isConstructed",P5e="fromBER",D5e="toBER",$5e="local",bn="",ds=new ArrayBuffer(0),qw=new Uint8Array(0),op="EndOfContent",fK="OCTET STRING",pK="BIT STRING";function qs(r){var e;return e=class extends r{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}constructor(...n){var i;super(...n);const s=n[0]||{};this.isHexOnly=(i=s.isHexOnly)!==null&&i!==void 0?i:!1,this.valueHexView=s.valueHex?le.toUint8Array(s.valueHex):qw}fromBER(n,i,s){const o=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!ea(this,o,i,s))return-1;const a=i+s;return this.valueHexView=o.subarray(i,a),this.valueHexView.length?(this.blockLength=s,a):(this.warnings.push("Zero buffer length"),i)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",ds)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:Ee.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class bu{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=bn,warnings:n=[],valueBeforeDecode:i=qw}={}){this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=le.toUint8Array(i)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Ee.ToHex(this.valueBeforeDecodeView)}}}bu.NAME="baseBlock";class dn extends bu{fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}dn.NAME="valueBlock";class gK extends qs(bu){constructor({idBlock:e={}}={}){var t,n,i,s;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?le.toUint8Array(e.valueHex):qw,this.tagClass=(n=e.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(i=e.tagNumber)!==null&&i!==void 0?i:-1,this.isConstructed=(s=e.isConstructed)!==null&&s!==void 0?s:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",ds}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const i=new Uint8Array(1);if(!e){let s=this.tagNumber;s&=31,t|=s,i[0]=t}return i.buffer}if(!this.isHexOnly){const i=Jl(this.tagNumber,7),s=new Uint8Array(i),o=i.byteLength,a=new Uint8Array(o+1);if(a[0]=t|31,!e){for(let c=0;c<o-1;c++)a[c+1]=s[c]|128;a[o]=s[o-1]}return a.buffer}const n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=t|31,!e){const i=this.valueHexView;for(let s=0;s<i.length-1;s++)n[s+1]=i[s]|128;n[this.valueHexView.byteLength]=i[i.length-1]}return n.buffer}fromBER(e,t,n){const i=le.toUint8Array(e);if(!ea(this,i,t,n))return-1;const s=i.subarray(t,t+n);if(s.length===0)return this.error="Zero buffer length",-1;switch(s[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(s[0]&32)===32,this.isHexOnly=!1;const a=s[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,l=this.valueHexView=new Uint8Array(255),h=255;for(;s[c]&128;){if(l[c-1]=s[c]&127,c++,c>=s.length)return this.error="End of input reached before message was fully decoded",-1;if(c===h){h+=255;const p=new Uint8Array(h);for(let m=0;m<l.length;m++)p[m]=l[m];l=this.valueHexView=new Uint8Array(h)}}this.blockLength=c+1,l[c-1]=s[c]&127;const d=new Uint8Array(c);for(let p=0;p<c;p++)d[p]=l[p];l=this.valueHexView=new Uint8Array(c),l.set(d),this.blockLength<=9?this.tagNumber=hd(l,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}gK.NAME="identificationBlock";class yK extends bu{constructor({lenBlock:e={}}={}){var t,n,i;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(n=e.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(i=e.length)!==null&&i!==void 0?i:0}fromBER(e,t,n){const i=le.toUint8Array(e);if(!ea(this,i,t,n))return-1;const s=i.subarray(t,t+n);if(s.length===0)return this.error="Zero buffer length",-1;if(s[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=s[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(s[0]&128),this.longFormUsed===!1)return this.length=s[0],this.blockLength=1,t+this.blockLength;const o=s[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>s.length)return this.error="End of input reached before message was fully decoded",-1;const a=t+1,c=i.subarray(a,a+o);return c[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=hd(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(e=!1){let t,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=128),t;if(this.longFormUsed){const i=Jl(this.length,8);if(i.byteLength>127)return this.error="Too big length",ds;if(t=new ArrayBuffer(i.byteLength+1),e)return t;const s=new Uint8Array(i);n=new Uint8Array(t),n[0]=i.byteLength|128;for(let o=0;o<i.byteLength;o++)n[o+1]=s[o];return t}return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}yK.NAME="lengthBlock";const ye={};class Er extends bu{constructor({name:e=bn,optional:t=!1,primitiveSchema:n,...i}={},s){super(i),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new gK(i),this.lenBlock=new yK(i),this.valueBlock=s?new s(i):new dn(i)}fromBER(e,t,n){const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}toBER(e,t){const n=t||new jw;t||mK(this);const i=this.idBlock.toBER(e);if(n.write(i),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{const s=this.valueBlock.toBER(e);this.lenBlock.length=s.byteLength;const o=this.lenBlock.toBER(e);n.write(o),n.write(s)}return t?ds:n.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():Ee.ToHex(this.toBER())}onAsciiEncoding(){const e=this.constructor.NAME,t=Ee.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),n=e.toBER();return A5e(t,n)}}Er.NAME="BaseBlock";function mK(r){var e;if(r instanceof ye.Constructed)for(const t of r.valueBlock.value)mK(t)&&(r.lenBlock.isIndefiniteForm=!0);return!!(!((e=r.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}class $x extends Er{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=bn,...t}={},n){super(t,n),e&&this.fromString(e)}fromBER(e,t,n){const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}$x.NAME="BaseStringBlock";class wK extends qs(dn){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}wK.NAME="PrimitiveValueBlock";var bK;class Yp extends Er{constructor(e={}){super(e,wK),this.idBlock.isConstructed=!1}}bK=Yp;ye.Primitive=bK;Yp.NAME="PRIMITIVE";function N5e(r,e){if(r instanceof e)return r;const t=new e;return t.idBlock=r.idBlock,t.lenBlock=r.lenBlock,t.warnings=r.warnings,t.valueBeforeDecodeView=r.valueBeforeDecodeView,t}function Ud(r,e=0,t=r.length){const n=e;let i=new Er({},dn);const s=new bu;if(!ea(s,r,e,t))return i.error=s.error,{offset:-1,result:i};if(!r.subarray(e,e+t).length)return i.error="Zero buffer length",{offset:-1,result:i};let a=i.idBlock.fromBER(r,e,t);if(i.idBlock.warnings.length&&i.warnings.concat(i.idBlock.warnings),a===-1)return i.error=i.idBlock.error,{offset:-1,result:i};if(e=a,t-=i.idBlock.blockLength,a=i.lenBlock.fromBER(r,e,t),i.lenBlock.warnings.length&&i.warnings.concat(i.lenBlock.warnings),a===-1)return i.error=i.lenBlock.error,{offset:-1,result:i};if(e=a,t-=i.lenBlock.blockLength,!i.idBlock.isConstructed&&i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};let c=Er;switch(i.idBlock.tagClass){case 1:if(i.idBlock.tagNumber>=37&&i.idBlock.isHexOnly===!1)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};c=ye.EndOfContent;break;case 1:c=ye.Boolean;break;case 2:c=ye.Integer;break;case 3:c=ye.BitString;break;case 4:c=ye.OctetString;break;case 5:c=ye.Null;break;case 6:c=ye.ObjectIdentifier;break;case 10:c=ye.Enumerated;break;case 12:c=ye.Utf8String;break;case 13:c=ye.RelativeObjectIdentifier;break;case 14:c=ye.TIME;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:c=ye.Sequence;break;case 17:c=ye.Set;break;case 18:c=ye.NumericString;break;case 19:c=ye.PrintableString;break;case 20:c=ye.TeletexString;break;case 21:c=ye.VideotexString;break;case 22:c=ye.IA5String;break;case 23:c=ye.UTCTime;break;case 24:c=ye.GeneralizedTime;break;case 25:c=ye.GraphicString;break;case 26:c=ye.VisibleString;break;case 27:c=ye.GeneralString;break;case 28:c=ye.UniversalString;break;case 29:c=ye.CharacterString;break;case 30:c=ye.BmpString;break;case 31:c=ye.DATE;break;case 32:c=ye.TimeOfDay;break;case 33:c=ye.DateTime;break;case 34:c=ye.Duration;break;default:{const l=i.idBlock.isConstructed?new ye.Constructed:new ye.Primitive;l.idBlock=i.idBlock,l.lenBlock=i.lenBlock,l.warnings=i.warnings,i=l}}break;case 2:case 3:case 4:default:c=i.idBlock.isConstructed?ye.Constructed:ye.Primitive}return i=N5e(i,c),a=i.fromBER(r,e,i.lenBlock.isIndefiniteForm?t:i.lenBlock.length),i.valueBeforeDecodeView=r.subarray(n,n+i.blockLength),{offset:a,result:i}}function Co(r){if(!r.byteLength){const e=new Er({},dn);return e.error="Input buffer has zero length",{offset:-1,result:e}}return Ud(le.toUint8Array(r).slice(),0,r.byteLength)}function M5e(r,e){return r?1:e}class uc extends dn{constructor({value:e=[],isIndefiniteForm:t=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){const i=le.toUint8Array(e);if(!ea(this,i,t,n))return-1;if(this.valueBeforeDecodeView=i.subarray(t,t+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let s=t;for(;M5e(this.isIndefiniteForm,n)>0;){const o=Ud(i,s,n);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(s=o.offset,this.blockLength+=o.result.blockLength,n-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===op)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===op?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}toBER(e,t){const n=t||new jw;for(let i=0;i<this.value.length;i++)this.value[i].toBER(e,n);return t?ds:n.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}uc.NAME="ConstructedValueBlock";var vK;class _n extends Er{constructor(e={}){super(e,uc),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){const e=[];for(const n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(i=>`  ${i}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}vK=_n;ye.Constructed=vK;_n.NAME="CONSTRUCTED";class EK extends dn{fromBER(e,t,n){return t}toBER(e){return ds}}EK.override="EndOfContentValueBlock";var SK;class Nx extends Er{constructor(e={}){super(e,EK),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}SK=Nx;ye.EndOfContent=SK;Nx.NAME=op;var xK;class Ro extends Er{constructor(e={}){super(e,dn),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){const n=new ArrayBuffer(2);if(!e){const i=new Uint8Array(n);i[0]=5,i[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}}xK=Ro;ye.Null=xK;Ro.NAME="NULL";class AK extends qs(dn){get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=le.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,n){const i=le.toUint8Array(e);return ea(this,i,t,n)?(this.valueHexView=i.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,dK.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}AK.NAME="BooleanValueBlock";var CK;let Ww=class extends Er{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,AK),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};CK=Ww;ye.Boolean=CK;Ww.NAME="BOOLEAN";class IK extends qs(uc){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,n){let i=0;if(this.isConstructed){if(this.isHexOnly=!1,i=uc.prototype.fromBER.call(this,e,t,n),i===-1)return i;for(let s=0;s<this.value.length;s++){const o=this.value[s].constructor.NAME;if(o===op){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==fK)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,i=super.fromBER(e,t,n),this.blockLength=n;return i}toBER(e,t){return this.isConstructed?uc.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}IK.NAME="OctetStringValueBlock";var Mx;let Zi=class extends Er{constructor({idBlock:e={},lenBlock:t={},...n}={}){var i,s;(i=n.isConstructed)!==null&&i!==void 0||(n.isConstructed=!!(!((s=n.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},IK),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const s=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(s.byteLength){const o=Ud(s,0,s.byteLength);o.offset!==-1&&o.offset===n&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return _n.prototype.onAsciiEncoding.call(this);const e=this.constructor.NAME,t=Ee.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof Mx&&e.push(t.valueBlock.valueHexView);return le.concat(e)}};Mx=Zi;ye.OctetString=Mx;Zi.NAME=fK;class kK extends qs(uc){constructor({unusedBits:e=0,isConstructed:t=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let i=-1;if(this.isConstructed){if(i=uc.prototype.fromBER.call(this,e,t,n),i===-1)return i;for(const a of this.value){const c=a.constructor.NAME;if(c===op){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==pK)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const l=a.valueBlock;if(this.unusedBits>0&&l.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=l.unusedBits}return i}const s=le.toUint8Array(e);if(!ea(this,s,t,n))return-1;const o=s.subarray(t,t+n);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const a=o.subarray(1);try{if(a.byteLength){const c=Ud(a,0,a.byteLength);c.offset!==-1&&c.offset===n-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+n}toBER(e,t){if(this.isConstructed)return uc.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return ds;const n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}kK.NAME="BitStringValueBlock";var _K;let Nl=class extends Er{constructor({idBlock:e={},lenBlock:t={},...n}={}){var i,s;(i=n.isConstructed)!==null&&i!==void 0||(n.isConstructed=!!(!((s=n.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},kK),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return _n.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const o of t)e.push(o.toString(2).padStart(8,"0"));const n=e.join(""),i=this.constructor.NAME,s=n.substring(0,n.length-this.valueBlock.unusedBits);return`${i} : ${s}`}}};_K=Nl;ye.BitString=_K;Nl.NAME=pK;var TK;function O5e(r,e){const t=new Uint8Array([0]),n=new Uint8Array(r),i=new Uint8Array(e);let s=n.slice(0);const o=s.length-1,a=i.slice(0),c=a.length-1;let l=0;const h=c<o?o:c;let d=0;for(let p=h;p>=0;p--,d++){switch(!0){case d<a.length:l=s[o-d]+a[c-d]+t[0];break;default:l=s[o-d]+t[0]}switch(t[0]=l/10,!0){case d>=s.length:s=Yv(new Uint8Array([l%10]),s);break;default:s[o-d]=l%10}}return t[0]>0&&(s=Yv(t,s)),s}function bP(r){if(r>=Nf.length)for(let e=Nf.length;e<=r;e++){const t=new Uint8Array([0]);let n=Nf[e-1].slice(0);for(let i=n.length-1;i>=0;i--){const s=new Uint8Array([(n[i]<<1)+t[0]]);t[0]=s[0]/10,n[i]=s[0]%10}t[0]>0&&(n=Yv(t,n)),Nf.push(n)}return Nf[r]}function R5e(r,e){let t=0;const n=new Uint8Array(r),i=new Uint8Array(e),s=n.slice(0),o=s.length-1,a=i.slice(0),c=a.length-1;let l,h=0;for(let d=c;d>=0;d--,h++)switch(l=s[o-h]-a[c-h]-t,!0){case l<0:t=1,s[o-h]=l+10;break;default:t=0,s[o-h]=l}if(t>0)for(let d=o-c+1;d>=0;d--,h++)if(l=s[o-h]-t,l<0)t=1,s[o-h]=l+10;else{t=0,s[o-h]=l;break}return s.slice()}class Ox extends qs(dn){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=dK.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(x5e(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,i=0){const s=this.fromBER(e,t,n);if(s===-1)return s;const o=this.valueHexView;return o[0]===0&&o[1]&128?this.valueHexView=o.subarray(1):i!==0&&o.length<i&&(i-o.length>1&&(i=o.length+1),this.valueHexView=o.subarray(i-o.length)),s}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(t,1),this.valueHexView=n}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,n){const i=super.fromBER(e,t,n);return i===-1||this.setValueHex(),i}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),n=0,i;const s=this.valueHexView;let o="",a=!1;for(let c=s.byteLength-1;c>=0;c--){i=s[c];for(let l=0;l<8;l++){if((i&1)===1)switch(n){case e:t=R5e(bP(n),t),o="-";break;default:t=O5e(t,bP(n))}n++,i>>=1}}for(let c=0;c<t.length;c++)t[c]&&(a=!0),a&&(o+=mP.charAt(t[c]));return a===!1&&(o+=mP.charAt(0)),o}}TK=Ox;Ox.NAME="IntegerValueBlock";Object.defineProperty(TK.prototype,"valueHex",{set:function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var h1;class Io extends Er{constructor(e={}){super(e,Ox),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return Am(),BigInt(this.valueBlock.toString())}static fromBigInt(e){Am();const t=BigInt(e),n=new jw,i=t.toString(16).replace(/^-/,""),s=new Uint8Array(Ee.FromHex(i));if(t<0){const a=new Uint8Array(s.length+(s[0]&128?1:0));a[0]|=128;const l=BigInt(`0x${Ee.ToHex(a)}`)+t,h=le.toUint8Array(Ee.FromHex(l.toString(16)));h[0]|=128,n.write(h)}else s[0]&128&&n.write(new Uint8Array([0])),n.write(s);return new h1({valueHex:n.final()})}convertToDER(){const e=new h1({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new h1({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}h1=Io;ye.Integer=h1;Io.NAME="INTEGER";var PK;class Gw extends Io{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}PK=Gw;ye.Enumerated=PK;Gw.NAME="ENUMERATED";class Xv extends qs(dn){constructor({valueDec:e=-1,isFirstSid:t=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;const i=le.toUint8Array(e);if(!ea(this,i,t,n))return-1;const s=i.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=s[a]&127,this.blockLength++,!!(s[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,s[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=hd(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){Am();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const n=new Uint8Array(t.length/7);for(let i=0;i<n.length;i++)n[i]=parseInt(t.slice(i*7,i*7+7),2)+(i+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=i[o]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}const t=Jl(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",ds;const n=new Uint8Array(t.byteLength);if(!e){const i=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)n[o]=i[o]|128;n[s]=i[s]}return n}toString(){let e="";if(this.isHexOnly)e=Ee.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}Xv.NAME="sidBlock";class DK extends dn{constructor({value:e=bn,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let i=t;for(;n>0;){const s=new Xv;if(i=s.fromBER(e,i,n),i===-1)return this.blockLength=0,this.error=s.error,i;this.value.length===0&&(s.isFirstSid=!0),this.blockLength+=s.blockLength,n-=s.blockLength,this.value.push(s)}return i}toBER(e){const t=[];for(let n=0;n<this.value.length;n++){const i=this.value[n].toBER(e);if(i.byteLength===0)return this.error=this.value[n].error,ds;t.push(i)}return Dx(t)}fromString(e){this.value=[];let t=0,n=0,i="",s=!1;do if(n=e.indexOf(".",t),n===-1?i=e.substring(t):i=e.substring(t,n),t=n+1,s){const o=this.value[0];let a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}const c=parseInt(i,10);if(isNaN(c))return;o.valueDec=c+a,s=!1}else{const o=new Xv;if(i>Number.MAX_SAFE_INTEGER){Am();const a=BigInt(i);o.valueBigInt=a}else if(o.valueDec=parseInt(i,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,s=!0),this.value.push(o)}while(n!==-1)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let i=this.value[n].toString();n!==0&&(e=`${e}.`),t?(i=`{${i}}`,this.value[n].isFirstSid?e=`2.{${i} - 80}`:e+=i):e+=i}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}DK.NAME="ObjectIdentifierValueBlock";var $K;class wo extends Er{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,DK),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}$K=wo;ye.ObjectIdentifier=$K;wo.NAME="OBJECT IDENTIFIER";class Jv extends qs(bu){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,n){if(n===0)return t;const i=le.toUint8Array(e);if(!ea(this,i,t,n))return-1;const s=i.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=s[a]&127,this.blockLength++,!!(s[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,s[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=hd(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=i[o]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}const t=Jl(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",ds;const n=new Uint8Array(t.byteLength);if(!e){const i=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)n[o]=i[o]|128;n[s]=i[s]}return n.buffer}toString(){let e="";return this.isHexOnly?e=Ee.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}Jv.NAME="relativeSidBlock";class NK extends dn{constructor({value:e=bn,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let i=t;for(;n>0;){const s=new Jv;if(i=s.fromBER(e,i,n),i===-1)return this.blockLength=0,this.error=s.error,i;this.blockLength+=s.blockLength,n-=s.blockLength,this.value.push(s)}return i}toBER(e,t){const n=[];for(let i=0;i<this.value.length;i++){const s=this.value[i].toBER(e);if(s.byteLength===0)return this.error=this.value[i].error,ds;n.push(s)}return Dx(n)}fromString(e){this.value=[];let t=0,n=0,i="";do{n=e.indexOf(".",t),n===-1?i=e.substring(t):i=e.substring(t,n),t=n+1;const s=new Jv;if(s.valueDec=parseInt(i,10),isNaN(s.valueDec))return!0;this.value.push(s)}while(n!==-1);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let i=this.value[n].toString();n!==0&&(e=`${e}.`),t&&(i=`{${i}}`),e+=i}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}NK.NAME="RelativeObjectIdentifierValueBlock";var MK;class Rx extends Er{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,NK),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}MK=Rx;ye.RelativeObjectIdentifier=MK;Rx.NAME="RelativeObjectIdentifier";var OK;class or extends _n{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}OK=or;ye.Sequence=OK;or.NAME="SEQUENCE";var RK;let ko=class extends _n{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};RK=ko;ye.Set=RK;ko.NAME="SET";class LK extends qs(dn){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=bn}toJSON(){return{...super.toJSON(),value:this.value}}}LK.NAME="StringValueBlock";class BK extends LK{}BK.NAME="SimpleStringValueBlock";class ai extends $x{constructor({...e}={}){super(e,BK)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,le.toUint8Array(e))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);this.valueBlock.value=e}}ai.NAME="SIMPLE STRING";class UK extends ai{fromBuffer(e){this.valueBlock.valueHexView=le.toUint8Array(e);try{this.valueBlock.value=Ee.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=Ee.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(Ee.FromUtf8String(e)),this.valueBlock.value=e}}UK.NAME="Utf8StringValueBlock";var FK;class ta extends UK{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}FK=ta;ye.Utf8String=FK;ta.NAME="UTF8String";class zK extends ai{fromBuffer(e){this.valueBlock.value=Ee.ToUtf16String(e),this.valueBlock.valueHexView=le.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(Ee.FromUtf16String(e))}}zK.NAME="BmpStringValueBlock";var VK;class Qw extends zK{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}VK=Qw;ye.BmpString=VK;Qw.NAME="BMPString";class KK extends ai{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let i=0;i<n.length;i+=4)n[i]=n[i+3],n[i+1]=n[i+2],n[i+2]=0,n[i+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let i=0;i<t;i++){const s=Jl(e.charCodeAt(i),8),o=new Uint8Array(s);if(o.length>4)continue;const a=4-o.length;for(let c=o.length-1;c>=0;c--)n[i*4+c+a]=o[c]}this.valueBlock.value=e}}KK.NAME="UniversalStringValueBlock";var HK;class Yw extends KK{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}HK=Yw;ye.UniversalString=HK;Yw.NAME="UniversalString";var jK;class Xw extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}jK=Xw;ye.NumericString=jK;Xw.NAME="NumericString";var qK;class Jw extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}qK=Jw;ye.PrintableString=qK;Jw.NAME="PrintableString";var WK;class Zw extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}WK=Zw;ye.TeletexString=WK;Zw.NAME="TeletexString";var GK;class e4 extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}GK=e4;ye.VideotexString=GK;e4.NAME="VideotexString";var QK;class t4 extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}QK=t4;ye.IA5String=QK;t4.NAME="IA5String";var YK;class r4 extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}YK=r4;ye.GraphicString=YK;r4.NAME="GraphicString";var XK;class Xp extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}XK=Xp;ye.VisibleString=XK;Xp.NAME="VisibleString";var JK;class n4 extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}JK=n4;ye.GeneralString=JK;n4.NAME="GeneralString";var ZK;class i4 extends ai{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}ZK=i4;ye.CharacterString=ZK;i4.NAME="CharacterString";var eH;class Jp extends Xp{constructor({value:e,valueDate:t,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let i=0;i<e.length;i++)this.valueBlock.valueHexView[i]=e.charCodeAt(i)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,le.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}const i=parseInt(n[1],10);i>=50?this.year=1900+i:this.year=2e3+i,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=Hn(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=Hn(this.month,2),t[2]=Hn(this.day,2),t[3]=Hn(this.hour,2),t[4]=Hn(this.minute,2),t[5]=Hn(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}eH=Jp;ye.UTCTime=eH;Jp.NAME="UTCTime";var tH;class s4 extends Jp{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){const e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,n="",i="",s=0,o,a=0,c=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),t=!0;else{const d=new Number(e[e.length-1]);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(t){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let d=1,p=n.indexOf("+"),m="";if(p===-1&&(p=n.indexOf("-"),d=-1),p!==-1){if(m=n.substring(p+1),n=n.substring(0,p),m.length!==2&&m.length!==4)throw new Error("Wrong input string for conversion");let f=parseInt(m.substring(0,2),10);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");if(a=d*f,m.length===4){if(f=parseInt(m.substring(2,4),10),isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");c=d*f}}}let l=n.indexOf(".");if(l===-1&&(l=n.indexOf(",")),l!==-1){const d=new Number(`0${n.substring(l)}`);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");s=d.valueOf(),i=n.substring(0,l)}else i=n;switch(!0){case i.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,l!==-1)throw new Error("Wrong input string for conversion");break;case i.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=60*s;this.minute=Math.floor(d),d=60*(d-this.minute),this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case i.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=60*s;this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case i.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){const d=1e3*s;this.millisecond=Math.floor(d)}break;default:throw new Error("Wrong input string for conversion")}const h=o.exec(i);if(h===null)throw new Error("Wrong input string for conversion");for(let d=1;d<h.length;d++)switch(d){case 1:this.year=parseInt(h[d],10);break;case 2:this.month=parseInt(h[d],10);break;case 3:this.day=parseInt(h[d],10);break;case 4:this.hour=parseInt(h[d],10)+a;break;case 5:this.minute=parseInt(h[d],10)+c;break;case 6:this.second=parseInt(h[d],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const d=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=d.getUTCFullYear(),this.month=d.getUTCMonth(),this.day=d.getUTCDay(),this.hour=d.getUTCHours(),this.minute=d.getUTCMinutes(),this.second=d.getUTCSeconds(),this.millisecond=d.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push(Hn(this.year,4)),t.push(Hn(this.month,2)),t.push(Hn(this.day,2)),t.push(Hn(this.hour,2)),t.push(Hn(this.minute,2)),t.push(Hn(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(Hn(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}tH=s4;ye.GeneralizedTime=tH;s4.NAME="GeneralizedTime";var rH;class Lx extends ta{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}rH=Lx;ye.DATE=rH;Lx.NAME="DATE";var nH;class Bx extends ta{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}nH=Bx;ye.TimeOfDay=nH;Bx.NAME="TimeOfDay";var iH;class Ux extends ta{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}iH=Ux;ye.DateTime=iH;Ux.NAME="DateTime";var sH;class Fx extends ta{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}sH=Fx;ye.Duration=sH;Fx.NAME="Duration";var oH;class zx extends ta{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}oH=zx;ye.TIME=oH;zx.NAME="TIME";class Zl{constructor({name:e=bn,optional:t=!1}={}){this.name=e,this.optional=t}}class Vx extends Zl{constructor({value:e=[],...t}={}){super(t),this.value=e}}class Cm extends Zl{constructor({value:e=new Zl,local:t=!1,...n}={}){super(n),this.value=e,this.local=t}}class L5e{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=le.toUint8Array(e)}constructor({data:e=qw}={}){this.dataView=le.toUint8Array(e)}fromBER(e,t,n){const i=t+n;return this.dataView=le.toUint8Array(e).subarray(t,i),i}toBER(e){return this.dataView.slice().buffer}}function yl(r,e,t){if(t instanceof Vx){for(const s of t.value)if(yl(r,e,s).verified)return{verified:!0,result:r};{const s={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(x5)&&(s.name=t.name),s}}if(t instanceof Zl)return t.hasOwnProperty(x5)&&(r[t.name]=e),{verified:!0,result:r};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(I5e in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(P5e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(D5e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const n=t.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(k5e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(_5e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(T5e)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:r};if(!(C5e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:r};if(t.idBlock.isHexOnly){if(!(wP in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const s=t.idBlock.valueHexView,o=e.idBlock.valueHexView;if(s.length!==o.length)return{verified:!1,result:r};for(let a=0;a<s.length;a++)if(s[a]!==o[1])return{verified:!1,result:r}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,bn),t.name&&(r[t.name]=e)),t instanceof ye.Constructed){let s=0,o={verified:!1,result:{error:"Unknown error"}},a=t.valueBlock.value.length;if(a>0&&t.valueBlock.value[0]instanceof Cm&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:r};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let c=!0;for(let l=0;l<t.valueBlock.value.length;l++)c=c&&(t.valueBlock.value[l].optional||!1);return c?{verified:!0,result:r}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,bn),t.name&&delete r[t.name]),r.error="Inconsistent object length",{verified:!1,result:r})}for(let c=0;c<a;c++)if(c-s>=e.valueBlock.value.length){if(t.valueBlock.value[c].optional===!1){const l={verified:!1,result:r};return r.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,bn),t.name&&(delete r[t.name],l.name=t.name)),l}}else if(t.valueBlock.value[0]instanceof Cm){if(o=yl(r,e.valueBlock.value[c],t.valueBlock.value[0].value),o.verified===!1)if(t.valueBlock.value[0].optional)s++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,bn),t.name&&delete r[t.name]),o;if(x5 in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let l={};$5e in t.valueBlock.value[0]&&t.valueBlock.value[0].local?l=e:l=r,typeof l[t.valueBlock.value[0].name]>"u"&&(l[t.valueBlock.value[0].name]=[]),l[t.valueBlock.value[0].name].push(e.valueBlock.value[c])}}else if(o=yl(r,e.valueBlock.value[c-s],t.valueBlock.value[c]),o.verified===!1)if(t.valueBlock.value[c].optional)s++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,bn),t.name&&delete r[t.name]),o;if(o.verified===!1){const c={verified:!1,result:r};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,bn),t.name&&(delete r[t.name],c.name=t.name)),c}return{verified:!0,result:r}}if(t.primitiveSchema&&wP in e.valueBlock){const s=Ud(e.valueBlock.valueHexView);if(s.offset===-1){const o={verified:!1,result:s.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,bn),t.name&&(delete r[t.name],o.name=t.name)),o}return yl(r,s.result,t.primitiveSchema)}return{verified:!0,result:r}}function B5e(r,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};const t=Ud(le.toUint8Array(r));return t.offset===-1?{verified:!1,result:t.result}:yl(t.result,t.result,e)}const aH=Object.freeze(Object.defineProperty({__proto__:null,Any:Zl,BaseBlock:Er,BaseStringBlock:$x,BitString:Nl,BmpString:Qw,Boolean:Ww,CharacterString:i4,Choice:Vx,Constructed:_n,DATE:Lx,DateTime:Ux,Duration:Fx,EndOfContent:Nx,Enumerated:Gw,GeneralString:n4,GeneralizedTime:s4,GraphicString:r4,HexBlock:qs,IA5String:t4,Integer:Io,Null:Ro,NumericString:Xw,ObjectIdentifier:wo,OctetString:Zi,Primitive:Yp,PrintableString:Jw,RawData:L5e,RelativeObjectIdentifier:Rx,Repeated:Cm,Sequence:or,Set:ko,TIME:zx,TeletexString:Zw,TimeOfDay:Bx,UTCTime:Jp,UniversalString:Yw,Utf8String:ta,ValueBlock:dn,VideotexString:e4,ViewWriter:jw,VisibleString:Xp,compareSchema:yl,fromBER:Co,verifySchema:B5e},Symbol.toStringTag,{value:"Module"})),cH=Hw({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Hw({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});Hw({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});Hw({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const U5e=16,Zv=32,e7=1e4;async function o4(r,e){const n=await uK().encrypt(r,e);return cH.encode(n)}async function vP(r,e,t){if(r.type==="RSA")return K5e(r,e,t);if(r.type==="Ed25519")return F5e(r,e,t);if(r.type==="secp256k1")return z5e(r,e,t);if(r.type==="ECDSA")return V5e(r,e,t);throw new mu}async function F5e(r,e,t="libp2p-key"){if(t==="libp2p-key")return o4(Vp(r),e);throw new Z(`export format '${t}' is not supported`)}async function z5e(r,e,t="libp2p-key"){if(t==="libp2p-key")return o4(Vp(r),e);throw new Z("Export format is not supported")}async function V5e(r,e,t="libp2p-key"){if(t==="libp2p-key")return o4(Vp(r),e);throw new Z(`export format '${t}' is not supported`)}async function K5e(r,e,t="pkcs-8"){if(t==="pkcs-8")return H5e(r,e);if(t==="libp2p-key")return o4(Vp(r),e);throw new Z("Export format is not supported")}async function H5e(r,e){const t=Fs.get(),i=new or({value:[new Io({value:0}),new or({value:[new wo({value:"1.2.840.113549.1.1.1"}),new Ro]}),new Zi({valueHex:r.raw})]}).toBER(),s=new Uint8Array(i,0,i.byteLength),o=bc(U5e),a=await KU(US,e,o,{c:e7,dkLen:Zv}),c=bc(16),l=await t.subtle.importKey("raw",a,"AES-CBC",!1,["encrypt"]),h=await t.subtle.encrypt({name:"AES-CBC",iv:c},l,s),d=new or({value:[new Zi({valueHex:o}),new Io({value:e7}),new Io({value:Zv}),new or({value:[new wo({value:"1.2.840.113549.2.11"}),new Ro]})]}),p=new or({value:[new wo({value:"1.2.840.113549.1.5.13"}),new or({value:[new or({value:[new wo({value:"1.2.840.113549.1.5.12"}),d]}),new or({value:[new wo({value:"2.16.840.1.101.3.4.1.42"}),new Zi({valueHex:c})]})]})]}),f=new or({value:[p,new Zi({valueHex:h})]}).toBER(),g=new Uint8Array(f,0,f.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...re(g,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join(`
`)}async function EP(r,e){try{const t=await j5e(r,e);return Eie(t)}catch{}if(!r.includes("BEGIN"))throw new Z("Encrypted key was not a libp2p-key or a PEM file");return q5e(r,e)}async function j5e(r,e){const t=cH.decode(r);return uK().decrypt(t,e)}async function q5e(r,e){const t=Fs.get();let n;if(r.includes("-----BEGIN ENCRYPTED PRIVATE KEY-----")){const s=se(r.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:o}=Co(s),{iv:a,salt:c,iterations:l,keySize:h,cipherText:d}=W5e(o),p=await KU(US,e,c,{c:l,dkLen:h}),m=await t.subtle.importKey("raw",p,"AES-CBC",!1,["decrypt"]),f=d1(await t.subtle.decrypt({name:"AES-CBC",iv:a},m,d)),{result:g}=Co(f);n=SP(g)}else if(r.includes("-----BEGIN PRIVATE KEY-----")){const s=se(r.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:o}=Co(s);n=SP(o)}else throw new Z("Could not parse private key from PEM data");const i=_b(n);if(i.type!=="RSA")throw new Z("Could not parse RSA private key from PEM data");return i}function W5e(r){const e=r.valueBlock.value[0];if(e.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.13")throw new Z("Only pkcs5PBES2 encrypted private keys are supported");const n=e.valueBlock.value[1].valueBlock.value[0];if(n.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.12")throw new Z("Only pkcs5PBKDF2 key derivation functions are supported");const s=n.valueBlock.value[1],o=d1(s.valueBlock.value[0].getValue());let a=e7,c=Zv;if(s.valueBlock.value.length===3)a=Number(s.valueBlock.value[1].toBigInt()),c=Number(s.valueBlock.value[2].toBigInt());else if(s.valueBlock.value.length===2)throw new Z("Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key");const l=e.valueBlock.value[1].valueBlock.value[1],h=l.valueBlock.value[0].toString();if(h!=="OBJECT IDENTIFIER : 1.2.840.113549.3.7"){if(h!=="OBJECT IDENTIFIER : 1.3.14.3.2.7"){if(h!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2"){if(h!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22"){if(h!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42")throw new Z("Only AES-CBC encryption schemes are supported")}}}}const d=d1(l.valueBlock.value[1].getValue());return{cipherText:d1(r.valueBlock.value[1].getValue()),salt:o,iterations:a,keySize:c,iv:d}}function SP(r){return d1(r.valueBlock.value[2].getValue())}function d1(r){return new Uint8Array(r,0,r.byteLength)}const G5e="/pkcs8/",t7="/info/",Mf=new WeakMap,Jc={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},A5={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function Uu(r){return r==null||typeof r!="string"?!1:r===m5e(r.trim())&&r.length>0}async function dr(){const t=Math.random()*800+200;await new Promise(n=>setTimeout(n,t))}function Zc(r){return new yt(G5e+r)}function Fu(r){return new yt(t7+r)}async function Q5e(r){const e=Vp(r),t=await e5e.digest(e);return N8e.encode(t.bytes).substring(1)}var BN,UN;UN=Symbol.toStringTag,BN=ur;class Y5e{constructor(e,t){u(this,"components");u(this,"init");u(this,"log");u(this,"self");u(this,UN,"@libp2p/keychain");u(this,BN,["@libp2p/keychain"]);var i,s,o,a,c,l,h,d,p,m;if(this.components=e,this.log=e.logger.forComponent("libp2p:keychain"),this.init=Px(A5,t),this.self=t.selfKey??"self",this.init.pass!=null&&((i=this.init.pass)==null?void 0:i.length)<20)throw new Error("pass must be least 20 characters");if(((s=this.init.dek)==null?void 0:s.keyLength)!=null&&this.init.dek.keyLength<Jc.minKeyLength)throw new Error(`dek.keyLength must be least ${Jc.minKeyLength} bytes`);if(((a=(o=this.init.dek)==null?void 0:o.salt)==null?void 0:a.length)!=null&&this.init.dek.salt.length<Jc.minSaltLength)throw new Error(`dek.saltLength must be least ${Jc.minSaltLength} bytes`);if(((c=this.init.dek)==null?void 0:c.iterationCount)!=null&&this.init.dek.iterationCount<Jc.minIterationCount)throw new Error(`dek.iterationCount must be least ${Jc.minIterationCount}`);const n=this.init.pass!=null&&((l=this.init.dek)==null?void 0:l.salt)!=null?Ck(this.init.pass,(h=this.init.dek)==null?void 0:h.salt,(d=this.init.dek)==null?void 0:d.iterationCount,(p=this.init.dek)==null?void 0:p.keyLength,(m=this.init.dek)==null?void 0:m.hash):"";Mf.set(this,{dek:n})}static generateOptions(){const e=Object.assign({},A5),t=Math.ceil(Jc.minSaltLength/3)*3;return e.dek.salt=re(bc(t),"base64"),e}static get options(){return A5}async findKeyByName(e){if(!Uu(e))throw await dr(),new Z(`Invalid key name '${e}'`);const t=Fu(e);try{const n=await this.components.datastore.get(t);return JSON.parse(re(n))}catch(n){throw await dr(),this.log.error(n),new Qt(`Key '${e}' does not exist.`)}}async findKeyById(e){try{const t={prefix:t7};for await(const n of this.components.datastore.query(t)){const i=JSON.parse(re(n.value));if(i.id===e)return i}throw new Z(`Key with id '${e}' does not exist.`)}catch(t){throw await dr(),t}}async importKey(e,t){if(!Uu(e))throw await dr(),new Z(`Invalid key name '${e}'`);if(t==null)throw await dr(),new Z("Key is required");const n=Zc(e);if(await this.components.datastore.has(n))throw await dr(),new Z(`Key '${e}' already exists`);let s,o;try{s=await Q5e(t);const l=Mf.get(this);if(l==null)throw new Z("dek missing");const h=l.dek;o=await vP(t,h,t.type==="RSA"?"pkcs-8":"libp2p-key")}catch(l){throw await dr(),l}const a={name:e,id:s},c=this.components.datastore.batch();return c.put(n,se(o)),c.put(Fu(e),se(JSON.stringify(a))),await c.commit(),a}async exportKey(e){if(!Uu(e))throw await dr(),new Z(`Invalid key name '${e}'`);const t=Zc(e);try{const n=await this.components.datastore.get(t),i=re(n),s=Mf.get(this);if(s==null)throw new Z("dek missing");const o=s.dek;return await EP(i,o)}catch(n){throw await dr(),n}}async removeKey(e){if(!Uu(e)||e===this.self)throw await dr(),new Z(`Invalid key name '${e}'`);const t=Zc(e),n=await this.findKeyByName(e),i=this.components.datastore.batch();return i.delete(t),i.delete(Fu(e)),await i.commit(),n}async listKeys(){const e={prefix:t7},t=[];for await(const n of this.components.datastore.query(e))t.push(JSON.parse(re(n.value)));return t}async renameKey(e,t){if(!Uu(e)||e===this.self)throw await dr(),new Z(`Invalid old key name '${e}'`);if(!Uu(t)||t===this.self)throw await dr(),new Z(`Invalid new key name '${t}'`);const n=Zc(e),i=Zc(t),s=Fu(e),o=Fu(t);if(await this.components.datastore.has(i))throw await dr(),new Z(`Key '${t}' already exists`);try{const c=await this.components.datastore.get(n),l=await this.components.datastore.get(s),h=JSON.parse(re(l));h.name=t;const d=this.components.datastore.batch();return d.put(i,c),d.put(o,se(JSON.stringify(h))),d.delete(n),d.delete(s),await d.commit(),h}catch(c){throw await dr(),c}}async rotateKeychainPass(e,t){var a,c,l,h;if(typeof e!="string")throw await dr(),new Z(`Invalid old pass type '${typeof e}'`);if(typeof t!="string")throw await dr(),new Z(`Invalid new pass type '${typeof t}'`);if(t.length<20)throw await dr(),new Z(`Invalid pass length ${t.length}`);this.log("recreating keychain");const n=Mf.get(this);if(n==null)throw new Z("dek missing");const i=n.dek;this.init.pass=t;const s=t!=null&&((a=this.init.dek)==null?void 0:a.salt)!=null?Ck(t,this.init.dek.salt,(c=this.init.dek)==null?void 0:c.iterationCount,(l=this.init.dek)==null?void 0:l.keyLength,(h=this.init.dek)==null?void 0:h.hash):"";Mf.set(this,{dek:s});const o=await this.listKeys();for(const d of o){const p=await this.components.datastore.get(Zc(d.name)),m=re(p),f=await EP(m,i),g=s.toString(),v=await vP(f,g,f.type==="RSA"?"pkcs-8":"libp2p-key"),y=this.components.datastore.batch(),w={name:d.name,id:d.id};y.put(Zc(d.name),se(v)),y.put(Fu(d.name),se(JSON.stringify(w))),await y.commit()}this.log("keychain reconstructed")}}function lH(r={}){return e=>new Y5e(e,r)}class uH{constructor(e={}){u(this,"memoryStorage");u(this,"points");u(this,"duration");u(this,"blockDuration");u(this,"execEvenly");u(this,"execEvenlyMinDelayMs");u(this,"keyPrefix");this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??this.duration*1e3/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new X5e}async consume(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n);let o=this.memoryStorage.incrby(i,t,s);if(o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.consumedPoints>this.points)throw this.blockDuration>0&&o.consumedPoints<=this.points+t&&(o=this.memoryStorage.set(i,o.consumedPoints,this.blockDuration)),new Gie("Rate limit exceeded",o);if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let a=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));a<this.execEvenlyMinDelayMs&&(a=o.consumedPoints*this.execEvenlyMinDelayMs),await KV(a)}return o}penalty(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n),o=this.memoryStorage.incrby(i,t,s);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}reward(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n),o=this.memoryStorage.incrby(i,-t,s);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}block(e,t){const n=t*1e3,i=this.points+1;return this.memoryStorage.set(this.getKey(e),i,t),{remainingPoints:0,msBeforeNext:n===0?-1:n,consumedPoints:i,isFirstInDuration:!1}}set(e,t,n=0){const i=(n>=0?n:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,n),{remainingPoints:0,msBeforeNext:i===0?-1:i,consumedPoints:t,isFirstInDuration:!1}}get(e){const t=this.memoryStorage.get(this.getKey(e));return t!=null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return(e==null?void 0:e.customDuration)!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}}class X5e{constructor(){u(this,"storage");this.storage=new Map}incrby(e,t,n){const i=this.storage.get(e);if(i!=null){const s=i.expiresAt!=null?i.expiresAt.getTime()-new Date().getTime():-1;return i.expiresAt==null||s>0?(i.value+=t,{remainingPoints:0,msBeforeNext:s,consumedPoints:i.value,isFirstInDuration:!1}):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){const i=n*1e3,s=this.storage.get(e);s!=null&&clearTimeout(s.timeoutId);const o={value:t,expiresAt:i>0?new Date(Date.now()+i):void 0};return this.storage.set(e,o),i>0&&(o.timeoutId=setTimeout(()=>{this.storage.delete(e)},i),o.timeoutId.unref!=null&&o.timeoutId.unref()),{remainingPoints:0,msBeforeNext:i===0?-1:i,consumedPoints:o.value,isFirstInDuration:!0}}get(e){const t=this.storage.get(e);if(t!=null)return{remainingPoints:0,msBeforeNext:t.expiresAt!=null?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){const t=this.storage.get(e);return t!=null?(t.timeoutId!=null&&clearTimeout(t.timeoutId),this.storage.delete(e),!0):!1}}var et;(function(r){r[r.NEW_STREAM=0]="NEW_STREAM",r[r.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",r[r.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",r[r.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",r[r.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",r[r.RESET_RECEIVER=5]="RESET_RECEIVER",r[r.RESET_INITIATOR=6]="RESET_INITIATOR"})(et||(et={}));const Kx=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),xP=Object.freeze({NEW_STREAM:et.NEW_STREAM,MESSAGE:et.MESSAGE_INITIATOR,CLOSE:et.CLOSE_INITIATOR,RESET:et.RESET_INITIATOR}),J5e=Object.freeze({MESSAGE:et.MESSAGE_RECEIVER,CLOSE:et.CLOSE_RECEIVER,RESET:et.RESET_RECEIVER}),hH=1<<20,Z5e=4<<20;let e6e=class{constructor(e=hH,t=Z5e){u(this,"_buffer");u(this,"_headerInfo");u(this,"_maxMessageSize");u(this,"_maxUnprocessedMessageQueueSize");this._buffer=new Le,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw new wt("Unprocessed message queue size too large!");const t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(l){if(l.name==="InvalidMessageError")throw l;break}const{id:n,type:i,length:s,offset:o}=this._headerInfo;if(this._buffer.length-o<s)break;const c={id:n,type:i};(i===et.NEW_STREAM||i===et.MESSAGE_INITIATOR||i===et.MESSAGE_RECEIVER)&&(c.data=this._buffer.sublist(o,o+s)),t.push(c),this._buffer.consume(o+s),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:n}=CP(e),{value:i,offset:s}=CP(e,n),o=t&7;if(Kx[o]==null)throw new Error(`Invalid type received: ${o}`);if(i>this._maxMessageSize)throw new wt("Message size too large");return{id:t>>3,type:o,offset:n+s,length:i}}};const t6e=128,AP=127;function CP(r,e=0){let t=0,n=0,i=e,s;const o=r.length;do{if(i>=o||n>49)throw e=0,new RangeError("Could not decode varint");s=r.get(i++),t+=n<28?(s&AP)<<n:(s&AP)*Math.pow(2,n),n+=7}while(s>=t6e);return e=i-e,{value:t,offset:e}}const C5=10*1024;let r6e=class{constructor(){u(this,"_pool");u(this,"_poolOffset");this._pool=Pn(C5),this._poolOffset=0}write(e,t){const n=this._pool;let i=this._poolOffset;br(e.id<<3|e.type,n,i),i+=dt(e.id<<3|e.type),(e.type===et.NEW_STREAM||e.type===et.MESSAGE_INITIATOR||e.type===et.MESSAGE_RECEIVER)&&e.data!=null?(br(e.data.length,n,i),i+=dt(e.data.length)):(br(0,n,i),i+=dt(0));const s=n.subarray(this._poolOffset,i);C5-i<100?(this._pool=Pn(C5),this._poolOffset=0):this._poolOffset=i,t.append(s),(e.type===et.NEW_STREAM||e.type===et.MESSAGE_INITIATOR||e.type===et.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}};const n6e=new r6e;async function*i6e(r){for await(const e of r){const t=new Le;n6e.write(e,t),yield t}}class s6e extends Error{constructor(e="Stream input buffer error"){super(e),this.name="StreamInputBufferError"}}class o6e extends Sx{constructor(t){super(t);u(this,"name");u(this,"streamId");u(this,"send");u(this,"types");u(this,"maxDataSize");this.types=t.direction==="outbound"?xP:J5e,this.send=t.send,this.name=t.name,this.streamId=t.streamId,this.maxDataSize=t.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:xP.NEW_STREAM,data:new Le(se(this.name))})}async sendData(t){for(t=t.sublist();t.byteLength>0;){const n=Math.min(t.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:t.sublist(0,n)}),t.consume(n)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}function a6e(r){const{id:e,name:t,send:n,onEnd:i,type:s="initiator",maxMsgSize:o=hH}=r;return new o6e({id:s==="initiator"?`i${e}`:`r${e}`,streamId:e,name:`${t??e}`,direction:s==="initiator"?"outbound":"inbound",maxDataSize:o,onEnd:i,send:n,log:r.logger.forComponent(`libp2p:mplex:stream:${s}:${e}`)})}const c6e=1024,l6e=1024,u6e=1024*1024*4,h6e=5,d6e=500;function IP(r){const e={...r,type:`${Kx[r.type]} (${r.type})`};return r.type===et.NEW_STREAM&&(e.data=re(r.data instanceof Uint8Array?r.data:r.data.subarray())),(r.type===et.MESSAGE_INITIATOR||r.type===et.MESSAGE_RECEIVER)&&(e.data=re(r.data instanceof Uint8Array?r.data:r.data.subarray(),"base16")),e}class f6e{constructor(e,t){u(this,"protocol","/mplex/6.7.0");u(this,"sink");u(this,"source");u(this,"log");u(this,"_streamId");u(this,"_streams");u(this,"_init");u(this,"_source");u(this,"closeController");u(this,"rateLimiter");u(this,"closeTimeout");u(this,"logger");t=t??{},this.log=e.logger.forComponent("libp2p:mplex"),this.logger=e.logger,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=t,this.closeTimeout=t.closeTimeout??d6e,this.sink=this._createSink(),this._source=No({objectMode:!0,onEnd:()=>{for(const n of this._streams.initiators.values())n.destroy();for(const n of this._streams.receivers.values())n.destroy()}}),this.source=cn(this._source,n=>i6e(n)),this.closeController=new AbortController,this.rateLimiter=new uH({points:t.disconnectThreshold??h6e,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new il("Muxer already closed");const t=this._streamId++;e=e==null?t.toString():e.toString();const n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}async close(e){if(this.closeController.signal.aborted)return;const t=(e==null?void 0:e.signal)??AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map(async n=>n.close({signal:t}))),this._source.end(),await this._source.onEmpty({signal:t}),this.closeController.abort()}catch(n){this.abort(n)}}abort(e){this.closeController.signal.aborted||(this.streams.forEach(t=>{t.abort(e)}),this.closeController.abort(e))}_newReceiverStream(e){const{id:t,name:n}=e,i=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:i})}_newStream(e){const{id:t,name:n,type:i,registry:s}=e;if(this.log("new %s stream %s",i,t),i==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??l6e))throw new tw("Too many outbound streams open");if(s.has(t))throw new Error(`${i} stream ${t} already exists!`);const c=a6e({id:t,name:n,send:async l=>{this.log.enabled&&this.log.trace("%s stream %s send",i,t,IP(l)),this._source.push(l)},type:i,onEnd:()=>{this.log("%s stream with id %s and protocol %s ended",i,t,c.protocol),s.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(c)},maxMsgSize:this._init.maxMsgSize,logger:this.logger});return s.set(t,c),c}_createSink(){return async t=>{const n=()=>{wV(t,this.log)};this.closeController.signal.addEventListener("abort",n);try{const i=new e6e(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const s of t)for(const o of i.write(s))await this._handleIncoming(o);this._source.end()}catch(i){this.log("error in sink",i),this._source.end(i)}finally{this.closeController.signal.removeEventListener("abort",n)}}}async _handleIncoming(e){const{id:t,type:n}=e;if(this.log.enabled&&this.log.trace("incoming message",IP(e)),e.type===et.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??c6e)){this.log("too many inbound streams open"),this._source.push({id:t,type:et.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(new Error("Too many open streams"));return}return}const a=this._newReceiverStream({id:t,name:re(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(a);return}const s=((n&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(s==null){this.log("missing stream %s for message type %s",t,Kx[n]);try{await this.rateLimiter.consume("missing-stream",1)}catch{this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(new Error("Too many messages for missing streams"));return}return}const o=this._init.maxStreamBufferSize??u6e;try{switch(n){case et.MESSAGE_INITIATOR:case et.MESSAGE_RECEIVER:if(s.sourceReadableLength()>o)throw this._source.push({id:e.id,type:n===et.MESSAGE_INITIATOR?et.RESET_RECEIVER:et.RESET_INITIATOR}),new s6e("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers");s.sourcePush(e.data);break;case et.CLOSE_INITIATOR:case et.CLOSE_RECEIVER:s.remoteCloseWrite();break;case et.RESET_INITIATOR:case et.RESET_RECEIVER:s.reset();break;default:this.log("unknown message type %s",n)}}catch(a){this.log.error("error while processing message",a),s.abort(a)}}}var FN,zN;zN=Symbol.toStringTag,FN=ur;class p6e{constructor(e,t={}){u(this,"protocol","/mplex/6.7.0");u(this,"_init");u(this,"components");u(this,zN,"@libp2p/mplex");u(this,FN,["@libp2p/stream-multiplexing"]);this.components=e,this._init=t}createStreamMuxer(e={}){return new f6e(this.components,{...e,...this._init})}}function g6e(r={}){return e=>new p6e(e,r)}const I5=32,y6e="1.0.0",m6e="ping",w6e="ipfs",b6e=1e4,v6e=2,E6e=1;var VN,KN;KN=Symbol.toStringTag,VN=ur;class S6e{constructor(e,t={}){u(this,"protocol");u(this,"components");u(this,"started");u(this,"timeout");u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"runOnLimitedConnection");u(this,"log");u(this,KN,"@libp2p/ping");u(this,VN,["@libp2p/ping"]);this.components=e,this.log=e.logger.forComponent("libp2p:ping"),this.started=!1,this.protocol=`/${t.protocolPrefix??w6e}/${m6e}/${y6e}`,this.timeout=t.timeout??b6e,this.maxInboundStreams=t.maxInboundStreams??v6e,this.maxOutboundStreams=t.maxOutboundStreams??E6e,this.runOnLimitedConnection=t.runOnLimitedConnection??!0,this.handleMessage=this.handleMessage.bind(this)}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){this.log("incoming ping from %p",e.connection.remotePeer);const{stream:t}=e,n=Date.now(),i=sm(t);let s=!1;Promise.resolve().then(async()=>{for(;;){const o=AbortSignal.timeout(this.timeout);o.addEventListener("abort",()=>{t==null||t.abort(new Bp("ping timeout"))});const a=await i.read({bytes:I5,signal:o});await i.write(a,{signal:o}),s=!0}}).catch(o=>{s&&o.name==="UnexpectedEOFError"&&t.readStatus!=="ready"||(this.log.error("incoming ping from %p failed with error - %e",e.connection.remotePeer,o),t==null||t.abort(o))}).finally(()=>{const o=Date.now()-n;this.log("incoming ping from %p complete in %dms",e.connection.remotePeer,o);const a=AbortSignal.timeout(this.timeout);t.close({signal:a}).catch(c=>{this.log.error("error closing ping stream from %p - %e",e.connection.remotePeer,c),t==null||t.abort(c)})})}async ping(e,t={}){this.log("pinging %p",e);const n=Date.now(),i=bc(I5),s=await this.components.connectionManager.openConnection(e,t);let o;if(t.signal==null){const a=AbortSignal.timeout(this.timeout);t={...t,signal:a}}try{o=await s.newStream(this.protocol,{...t,runOnLimitedConnection:this.runOnLimitedConnection});const a=sm(o),[,c]=await Promise.all([a.write(i,t),a.read({...t,bytes:I5})]),l=Date.now()-n;if(!Ke(i,c.subarray()))throw new XL(`Received wrong ping ack after ${l}ms`);return this.log("ping %p complete in %dms",s.remotePeer,l),l}catch(a){throw this.log.error("error while pinging %p",s.remotePeer,a),o==null||o.abort(a),a}finally{o!=null&&await o.close(t)}}}function x6e(r={}){return e=>new S6e(e,r)}var gn;(function(r){(function(n){n.FIN="FIN",n.STOP_SENDING="STOP_SENDING",n.RESET="RESET",n.FIN_ACK="FIN_ACK"})(r.Flag||(r.Flag={}));let e;(function(n){n[n.FIN=0]="FIN",n[n.STOP_SENDING=1]="STOP_SENDING",n[n.RESET=2]="RESET",n[n.FIN_ACK=3]="FIN_ACK"})(e||(e={})),function(n){n.codec=()=>Dn(e)}(r.Flag||(r.Flag={}));let t;r.codec=()=>(t==null&&(t=Pe((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.flag!=null&&(i.uint32(8),r.Flag.codec().encode(n.flag,i)),n.message!=null&&(i.uint32(18),i.bytes(n.message)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.flag=r.Flag.codec().decode(n);break}case 2:{o.message=n.bytes();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>Te(n,r.codec()),r.decode=(n,i)=>_e(n,r.codec(),i)})(gn||(gn={}));const A6e=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],kP=Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),C6e="libp2p+webrtc+v1/",I6e=466,k6e=2*1024*1024,_6e=30*1e3,a4=16*1024;function T6e(r=a4){const e=dt(r-dt(r)),t=1+dt(Object.keys(gn.Flag).length-1),n=1,i=r-e-t-n,s=dt(i);return e+t+n+s}const P6e=T6e(),D6e=5e3,$6e=5e3,N6e=3e4,dH="/webrtc",r7="/webrtc-signaling/0.0.1",M6e="/libp2p/webrtc-direct/certificate",O6e="webrtc-direct-certificate-private-key",R6e=12096e5,_P=864e5;var TP=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||Array.prototype.slice.call(e))},L6e=function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r}(),B6e=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}(),U6e=function(){function r(e,t,n,i){this.name=e,this.version=t,this.os=n,this.bot=i,this.type="bot-device"}return r}(),F6e=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),z6e=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),V6e=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,K6e=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,PP=3,H6e=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",V6e]],DP=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function j6e(r){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new z6e:typeof navigator<"u"?W6e(navigator.userAgent):Q6e()}function q6e(r){return r!==""&&H6e.reduce(function(e,t){var n=t[0],i=t[1];if(e)return e;var s=i.exec(r);return!!s&&[n,s]},!1)}function W6e(r){var e=q6e(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new F6e;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<PP&&(i=TP(TP([],i,!0),Y6e(PP-i.length),!0)):i=[];var s=i.join("."),o=G6e(r),a=K6e.exec(r);return a&&a[1]?new U6e(t,s,o,a[1]):new L6e(t,s,o)}function G6e(r){for(var e=0,t=DP.length;e<t;e++){var n=DP[e],i=n[0],s=n[1],o=s.exec(r);if(o)return i}return null}function Q6e(){var r=typeof process<"u"&&process.version;return r?new B6e(process.version.slice(1)):null}function Y6e(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}const $P=j6e(),Hx=$P!=null&&$P.name==="firefox",fH=async function*(){},pH=async r=>{};function X6e(r,e,t=N6e,n){r.readyState==="open"&&Promise.resolve().then(async()=>{if(r.bufferedAmount>0){n.log("%s drain channel with %d buffered bytes",e,r.bufferedAmount);const i=Oe();let s=!1;r.bufferedAmountLowThreshold=0;const o=()=>{s||(n.log("%s drain channel closed before drain",e),i.resolve())};r.addEventListener("close",o,{once:!0}),r.addEventListener("bufferedamountlow",()=>{s=!0,r.removeEventListener("close",o),i.resolve()}),await Pp(i.promise,{milliseconds:t})}}).then(async()=>{r.readyState==="open"&&r.close()}).catch(i=>{n.log.error("error closing outbound stream",i)})}async function NP(r){return r=r??{},typeof r=="function"&&(r=await r()),r.iceServers=r.iceServers??A6e.map(e=>({urls:[e]})),r}const J6e=(r=32)=>C6e+[...Array(r)].map(()=>kP.at(Math.floor(Math.random()*kP.length))).join("");class n7{constructor(e,t){u(this,"log");u(this,"peerConnection");u(this,"remoteAddr");u(this,"timeline");u(this,"metrics");u(this,"source",fH());u(this,"sink",pH);this.log=e.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=t.remoteAddr,this.timeline=t.timeline,this.peerConnection=t.peerConnection;const n=this.peerConnection,i=n.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",n.connectionState,"initial state",i),(n.connectionState==="disconnected"||n.connectionState==="failed"||n.connectionState==="closed")&&(this.timeline.close=Date.now())}}async close(e){var t;this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),(t=this.metrics)==null||t.increment({close:!0})}abort(e){var t;this.log.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),(t=this.metrics)==null||t.increment({abort:!0})}}class Z6e extends Sx{constructor(t){const n=t.onEnd;t.onEnd=s=>{this.log.trace('readable and writeable ends closed with status "%s"',this.status),Promise.resolve(async()=>{if(!(this.timeline.abort!=null||this.timeline.reset!==null))try{await Pp(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(o){this.log.error("error receiving FIN_ACK",o)}}).then(()=>{this.incomingData.end(),n==null||n(s)}).catch(o=>{this.log.error("error ending stream",o)}).finally(()=>{this.channel.close()})};super(t);u(this,"channel");u(this,"incomingData");u(this,"maxBufferedAmount");u(this,"bufferedAmountLowEventTimeout");u(this,"maxMessageSize");u(this,"receiveFinAck");u(this,"finAckTimeout");u(this,"openTimeout");u(this,"closeController");switch(this.channel=t.channel,this.channel.binaryType="arraybuffer",this.incomingData=No(),this.bufferedAmountLowEventTimeout=t.bufferedAmountLowEventTimeout??_6e,this.maxBufferedAmount=t.maxBufferedAmount??k6e,this.maxMessageSize=(t.maxMessageSize??a4)-P6e,this.receiveFinAck=Oe(),this.finAckTimeout=t.closeTimeout??D6e,this.openTimeout=t.openTimeout??$6e,this.closeController=new AbortController,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(this.timeline.close===void 0||this.timeline.close===0)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new ry("Unknown datachannel state")}this.channel.onopen=s=>{this.timeline.open=new Date().getTime()},this.channel.onclose=s=>{this.log.trace("received onclose event"),this.closeController.abort(),this.receiveFinAck.resolve(),this.close().catch(o=>{this.log.error("error closing stream after channel closed",o)})},this.channel.onerror=s=>{this.log.trace("received onerror event"),this.closeController.abort();const o=s.error;this.abort(o)},this.channel.onmessage=async s=>{const{data:o}=s;o===null||o.byteLength===0||this.incomingData.push(new Uint8Array(o,0,o.byteLength))};const i=this;Promise.resolve().then(async()=>{for await(const s of Qh(this.incomingData)){const o=i.processIncomingProtobuf(s);o!=null&&i.sourcePush(new Le(o))}}).catch(s=>{this.log.error("error processing incoming data channel messages",s)})}sendNewStream(){}async _sendMessage(t,n=!0){if(this.channel.readyState==="closed"||this.channel.readyState==="closing")throw new ry(`Invalid datachannel state - ${this.channel.readyState}`);if(this.channel.readyState!=="open"){const i=AbortSignal.timeout(this.openTimeout),s=ct([this.closeController.signal,i]);try{this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await xi(this.channel,"open",s)}finally{s.clear()}this.log('channel state is now "%s", sending data',this.channel.readyState)}if(n&&this.channel.bufferedAmount>this.maxBufferedAmount){const i=AbortSignal.timeout(this.bufferedAmountLowEventTimeout),s=ct([this.closeController.signal,i]);try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await xi(this.channel,"bufferedamountlow",s)}catch(o){throw i.aborted?new Bp(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`):o}finally{s.clear()}}try{this.log.trace('sending message, channel state "%s"',this.channel.readyState),this.channel.send(t.subarray())}catch(i){this.log.error("error while sending message",i)}}async sendData(t){const n=t.byteLength;for(t=t.sublist();t.byteLength>0;){const i=Math.min(t.byteLength,this.maxMessageSize),s=t.subarray(0,i),o=gn.encode({message:s}),a=Gh.single(o);this.log.trace("sending %d/%d bytes on channel",s.byteLength,n),await this._sendMessage(a),t.consume(i)}this.log.trace('finished sending data, channel state "%s"',this.channel.readyState)}async sendReset(){try{await this._sendFlag(gn.Flag.RESET)}catch(t){this.log.error("failed to send reset - %e",t)}finally{this.channel.close()}}async sendCloseWrite(t){if(this.channel.readyState!=="open"){this.receiveFinAck.resolve();return}if(await this._sendFlag(gn.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await nn(this.receiveFinAck.promise,t==null?void 0:t.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorName:"FinAckNotReceivedError"})}catch(i){this.log.error("failed to await FIN_ACK",i)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){this.channel.readyState==="open"&&await this._sendFlag(gn.Flag.STOP_SENDING)}processIncomingProtobuf(t){const n=gn.decode(t);if(n.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',n.flag,this.writeStatus,this.readStatus),n.flag===gn.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(gn.Flag.FIN_ACK).catch(i=>{this.log.error("error sending FIN_ACK immediately",i)})),n.flag===gn.Flag.RESET&&this.reset(),n.flag===gn.Flag.STOP_SENDING&&this.remoteCloseRead(),n.flag===gn.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),this.readStatus==="ready")return n.message}async _sendFlag(t){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',t.toString(),this.channel.readyState),!1;this.log.trace("sending flag %s",t.toString());const n=gn.encode({flag:t}),i=Gh.single(n);try{return await this._sendMessage(i,!1),!0}catch(s){this.log.error("could not send flag %s - %e",t.toString(),s)}return!1}}function Im(r){const{channel:e,direction:t,handshake:n}=r;return new Z6e({id:`${e.id}`,log:r.logger.forComponent(`libp2p:webrtc:stream:${n===!0?"handshake":t}:${e.id}`),...r})}class jx{constructor(e,t){u(this,"protocol");u(this,"peerConnection");u(this,"bufferedStreams",[]);u(this,"metrics");u(this,"dataChannelOptions");u(this,"components");u(this,"log");this.components=e,this.peerConnection=t.peerConnection,this.metrics=t.metrics,this.protocol=t.protocol??dH,this.dataChannelOptions=t.dataChannelOptions??{},this.log=e.logger.forComponent("libp2p:webrtc:muxerfactory"),this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',n.id),n.label==="init"){this.log.trace("closing early init channel"),n.close();return}const i={},s=Im({channel:n,direction:"inbound",onEnd:o=>{i.onEnd(o)},logger:e.logger,...this.dataChannelOptions});i.stream=s,i.channel=n,i.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(o=>o.stream.id!==s.id)},this.bufferedStreams.push(i)}}createStreamMuxer(e){return new ebe(this.components,{...e,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}}var Dh,l2;class ebe{constructor(e,t){qe(this,Dh);u(this,"init");u(this,"streams");u(this,"protocol");u(this,"log");u(this,"peerConnection");u(this,"dataChannelOptions");u(this,"metrics");u(this,"logger");u(this,"source",fH());u(this,"sink",pH);this.init=t,this.log=e.logger.forComponent("libp2p:webrtc:muxer"),this.logger=e.logger,this.streams=t.streams.map(n=>n.stream),this.peerConnection=t.peerConnection,this.protocol=t.protocol??dH,this.metrics=t.metrics,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:n})=>{var o,a;if(this.log.trace("incoming datachannel with channel id %d",n.id),n.label==="init"){this.log.trace("closing init channel"),n.close();return}const i=n.id,s=Im({channel:n,direction:"inbound",onEnd:()=>{Ae(this,Dh,l2).call(this,s,n),this.log("incoming channel %s ended",i)},logger:this.logger,...this.dataChannelOptions});this.streams.push(s),(o=this.metrics)==null||o.increment({incoming_stream:!0}),(a=t==null?void 0:t.onIncomingStream)==null||a.call(t,s)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(n=>{var i,s,o;n.onEnd=()=>{this.log("incoming early channel %s ended with state %s",n.channel.id,n.channel.readyState),Ae(this,Dh,l2).call(this,n.stream,n.channel)},(i=this.metrics)==null||i.increment({incoming_stream:!0}),(o=(s=this.init)==null?void 0:s.onIncomingStream)==null||o.call(s,n.stream)})})}async close(e){try{await Promise.all(this.streams.map(async t=>t.close(e)))}catch(t){this.abort(t)}}abort(e){for(const t of this.streams)t.abort(e)}newStream(){var i;const e=this.peerConnection.createDataChannel(""),t=e.id;this.log.trace("opened outgoing datachannel with channel id %s",t);const n=Im({channel:e,direction:"outbound",onEnd:()=>{Ae(this,Dh,l2).call(this,n,e),this.log("outgoing channel %s ended",t)},logger:this.logger,...this.dataChannelOptions});return this.streams.push(n),(i=this.metrics)==null||i.increment({outgoing_stream:!0}),n}}Dh=new WeakSet,l2=function(e,t){var n,i,s;this.log.trace("stream %s %s %s onEnd",e.direction,e.id,e.protocol),X6e(t,`${e.direction} ${e.id} ${e.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(o=>o.id!==e.id),(n=this.metrics)==null||n.increment({stream_end:!0}),(s=(i=this.init)==null?void 0:i.onStreamEnd)==null||s.call(i,e)};const gH=globalThis.RTCPeerConnection,yH=globalThis.RTCSessionDescription,tbe=globalThis.RTCIceCandidate;class Zp extends Error{constructor(e){super(`WebRTC transport error: ${e}`),this.name="WebRTCTransportError"}}class Wa extends Zp{constructor(e="SDP handshake failed"){super(e),this.name="SDPHandshakeFailedError"}}class rbe extends Zp{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`),this.name="WebRTC/InvalidFingerprintError"}}class nbe extends Zp{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}}class ibe extends Zp{constructor(e){super(`unsupported hash algorithm code: ${e} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}}var es;(function(r){(function(n){n.SDP_OFFER="SDP_OFFER",n.SDP_ANSWER="SDP_ANSWER",n.ICE_CANDIDATE="ICE_CANDIDATE"})(r.Type||(r.Type={}));let e;(function(n){n[n.SDP_OFFER=0]="SDP_OFFER",n[n.SDP_ANSWER=1]="SDP_ANSWER",n[n.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(e||(e={})),function(n){n.codec=()=>Dn(e)}(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=Pe((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.type!=null&&(i.uint32(8),r.Type.codec().encode(n.type,i)),n.data!=null&&(i.uint32(18),i.string(n.data)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.data=n.string();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>Te(n,r.codec()),r.decode=(n,i)=>_e(n,r.codec(),i)})(es||(es={}));const mH=async(r,e,t)=>{var n,i,s,o;try{const a=Oe();for(sbe(r,a);;){const c=await Promise.race([a.promise,e.read({signal:t.signal}).catch(()=>{})]);if(c==null){(n=t.signal)==null||n.throwIfAborted();break}if(c.type!==es.Type.ICE_CANDIDATE)throw new wt("ICE candidate message expected");const l=JSON.parse(c.data??"null");if(l===""||l===null){(i=t.onProgress)==null||i.call(t,new Ie("webrtc:end-of-ice-candidates")),t.log.trace("end-of-candidates received");continue}const h=new tbe(l);t.log.trace("%s received new ICE candidate %o",t.direction,l);try{(s=t.onProgress)==null||s.call(t,new Ie("webrtc:add-ice-candidate",h.candidate)),await r.addIceCandidate(h)}catch(d){t.log.error("%s bad candidate received",t.direction,l,d)}}}catch(a){if(t.log.error("%s error parsing ICE candidate",t.direction,a),((o=t.signal)==null?void 0:o.aborted)===!0&&qx(r)!=="connected")throw a}};function qx(r){return Hx?r.iceConnectionState:r.connectionState}function sbe(r,e){r[Hx?"oniceconnectionstatechange":"onconnectionstatechange"]=t=>{switch(qx(r)){case"connected":e.resolve();break;case"failed":case"disconnected":case"closed":e.reject(new iS("RTCPeerConnection was closed"));break}}}async function obe({rtcConfiguration:r,dataChannel:e,signal:t,metrics:n,multiaddr:i,connectionManager:s,transportManager:o,log:a,logger:c,onProgress:l}){const{baseAddr:h}=lbe(i);n==null||n.dialerEvents.increment({open:!0}),a.trace("dialing base address: %a",h);const d=h.getPeerId();if(d==null)throw new Z("Relay peer was missing");const p=s.getConnections(Wt(d));let m,f=!1;p.length===0?(l==null||l(new Ie("webrtc:dial-relay")),m=await o.dial(h,{signal:t,onProgress:l}),f=!0):(l==null||l(new Ie("webrtc:reuse-relay-connection")),m=p[0]);try{l==null||l(new Ie("webrtc:open-signaling-stream"));const g=await m.newStream(r7,{signal:t,runOnLimitedConnection:!0}),v=Jn(g).pb(es),y=new gH(r),w=new jx({logger:c},{peerConnection:y,dataChannelOptions:e});try{const b=y.createDataChannel("init");y.onicecandidate=({candidate:x})=>{const I=JSON.stringify((x==null?void 0:x.toJSON())??null);a.trace("initiator sending ICE candidate %o",x),v.write({type:es.Type.ICE_CANDIDATE,data:I},{signal:t}).catch(T=>{a.error("error sending ICE candidate",T)})},y.onicecandidateerror=x=>{a.error("initiator ICE candidate error",x)};const E=await y.createOffer().catch(x=>{throw a.error("could not execute createOffer",x),new Wa("Failed to set createOffer")});a.trace("initiator send SDP offer %s",E.sdp),l==null||l(new Ie("webrtc:send-sdp-offer")),await v.write({type:es.Type.SDP_OFFER,data:E.sdp},{signal:t}),await y.setLocalDescription(E).catch(x=>{throw a.error("could not execute setLocalDescription",x),new Wa("Failed to set localDescription")}),l==null||l(new Ie("webrtc:read-sdp-answer")),a.trace("initiator read SDP answer");const C=await v.read({signal:t});if(C.type!==es.Type.SDP_ANSWER)throw new Wa("Remote should send an SDP answer");a.trace("initiator received SDP answer %s",C.data);const k=new yH({type:"answer",sdp:C.data});return await y.setRemoteDescription(k).catch(x=>{throw a.error("could not execute setRemoteDescription",x),new Wa("Failed to set remoteDescription")}),a.trace("initiator read candidates until connected"),l==null||l(new Ie("webrtc:read-ice-candidates")),await mH(y,v,{direction:"initiator",signal:t,log:a,onProgress:l}),a.trace("initiator connected, closing init channel"),b.close(),l==null||l(new Ie("webrtc:close-signaling-stream")),a.trace("closing signaling channel"),await g.close({signal:t}),a.trace("initiator connected to remote address %s",i),{remoteAddress:i,peerConnection:y,muxerFactory:w}}catch(b){throw a.error("outgoing signaling error",b),y.close(),g.abort(b),b}finally{y.onicecandidate=null,y.onicecandidateerror=null}}finally{if(f)try{await m.close({signal:t})}catch(g){m.abort(g)}}}const MP=Et(nz.matchers[0],Ge("p2p-circuit"));class Wx extends Yt{constructor(t,n){super();u(this,"transportManager");u(this,"shutdownController");u(this,"events");this.transportManager=t.transportManager,this.events=t.events,this.shutdownController=n.shutdownController,this.onTransportListening=this.onTransportListening.bind(this)}async listen(){this.events.addEventListener("transport:listening",this.onTransportListening)}onTransportListening(t){t.detail.getAddrs().filter(i=>MP.exactMatch(i)).map(i=>i.encapsulate("/webrtc")).length>0&&this.safeDispatchEvent("listening")}getAddrs(){return this.transportManager.getListeners().filter(t=>!(t instanceof Wx)).map(t=>t.getAddrs().filter(n=>MP.exactMatch(n)).map(n=>n.encapsulate("/webrtc"))).flat()}updateAnnounceAddrs(){}async close(){this.events.removeEventListener("transport:listening",this.onTransportListening),this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})}}async function abe({peerConnection:r,stream:e,signal:t,connection:n,log:i}){i.trace("new inbound signaling stream");const s=Jn(e).pb(es);try{r.onicecandidate=({candidate:h})=>{const d=JSON.stringify((h==null?void 0:h.toJSON())??null);i.trace("recipient sending ICE candidate %s",d),s.write({type:es.Type.ICE_CANDIDATE,data:d},{signal:t}).catch(p=>{i.error("error sending ICE candidate",p)})},i.trace("recipient read SDP offer");const a=await s.read({signal:t});if(a.type!==es.Type.SDP_OFFER)throw new Wa(`expected message type SDP_OFFER, received: ${a.type??"undefined"} `);i.trace("recipient received SDP offer %s",a.data);const c=new yH({type:"offer",sdp:a.data});await r.setRemoteDescription(c).catch(h=>{throw i.error("could not execute setRemoteDescription",h),new Wa("Failed to set remoteDescription")});const l=await r.createAnswer().catch(h=>{throw i.error("could not execute createAnswer",h),new Wa("Failed to create answer")});i.trace("recipient send SDP answer %s",l.sdp),await s.write({type:es.Type.SDP_ANSWER,data:l.sdp},{signal:t}),await r.setLocalDescription(l).catch(h=>{throw i.error("could not execute setLocalDescription",h),new Wa("Failed to set localDescription")}),i.trace("recipient read candidates until connected"),await mH(r,s,{direction:"recipient",signal:t,log:i})}catch(a){if(qx(r)!=="connected")throw i.error("error while handling signaling stream from peer %a",n.remoteAddr,a),r.close(),a;i("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",n.remoteAddr,a)}const o=$e(`/webrtc/p2p/${n.remoteAddr.getPeerId()}`);return i.trace("recipient connected to remote address %s",o),{remoteAddress:o}}var HN,jN,qN,WN;WN=J3,qN=Symbol.toStringTag,jN=ur,HN=mc;class cbe{constructor(e,t={}){u(this,"components");u(this,"init");u(this,"log");u(this,"_started",!1);u(this,"metrics");u(this,"shutdownController");u(this,WN,!0);u(this,qN,"@libp2p/webrtc");u(this,jN,["@libp2p/transport"]);u(this,HN,["@libp2p/identify","@libp2p/circuit-relay-v2-transport"]);this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}isStarted(){return this._started}async start(){await this.components.registrar.handle(r7,e=>{const t=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);this._onProtocol(e,t).catch(n=>{this.log.error("failed to handle incoming connect from %p",e.connection.remotePeer,n)}).finally(()=>{t.clear()})},{runOnLimitedConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(r7),this._started=!1}createListener(e){return new Wx(this.components,{shutdownController:this.shutdownController})}listenFilter(e){return e.filter(iv.exactMatch)}dialFilter(e){return this.listenFilter(e)}async dial(e,t){var c;this.log.trace("dialing address: %a",e);const{remoteAddress:n,peerConnection:i,muxerFactory:s}=await obe({rtcConfiguration:await NP(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:t.onProgress}),o=new n7(this.components,{peerConnection:i,timeline:{open:Date.now()},remoteAddr:n,metrics:(c=this.metrics)==null?void 0:c.dialerEvents}),a=await t.upgrader.upgradeOutbound(o,{skipProtection:!0,skipEncryption:!0,muxerFactory:s,onProgress:t.onProgress,signal:t.signal});return this._closeOnShutdown(i,o),a}async _onProtocol({connection:e,stream:t},n){var o;const i=new gH(await NP(this.init.rtcConfiguration)),s=new jx(this.components,{peerConnection:i,dataChannelOptions:this.init.dataChannel});try{const{remoteAddress:a}=await abe({peerConnection:i,connection:e,stream:t,signal:n,log:this.log});await t.close({signal:n});const c=new n7(this.components,{peerConnection:i,timeline:{open:new Date().getTime()},remoteAddr:a,metrics:(o=this.metrics)==null?void 0:o.listenerEvents});await this.components.upgrader.upgradeInbound(c,{skipEncryption:!0,skipProtection:!0,muxerFactory:s,signal:n}),this._closeOnShutdown(i,c)}catch(a){throw this.log.error("incoming signaling error",a),i.close(),t.abort(a),a}}_closeOnShutdown(e,t){const n=()=>{t.close().catch(i=>{this.log.error("could not close WebRTCMultiaddrConnection",i)})};this.shutdownController.signal.addEventListener("abort",n),e.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",n)})}}function lbe(r){const e=r.toString().split("/webrtc/");if(e.length!==2)throw new Z("webrtc protocol was not present in multiaddr");if(!e[0].includes("/p2p-circuit"))throw new Z("p2p-circuit protocol was not present in multiaddr");let t=$e(e[0]);const i=$e("/"+e[1]).getPeerId();if(i==null)throw new Z("destination peer id was missing");const s=t.protos().pop();if(s===void 0)throw new Z("invalid multiaddr");return s.name!=="p2p"&&(t=t.encapsulate(`/p2p/${i}`)),{baseAddr:t,peerId:Wt(i)}}/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var OP;(function(r){(function(e){var t=typeof globalThis=="object"?globalThis:typeof v1=="object"?v1:typeof self=="object"?self:typeof this=="object"?this:a(),n=i(r);typeof t.Reflect<"u"&&(n=i(t.Reflect,n)),e(n,t),typeof t.Reflect>"u"&&(t.Reflect=r);function i(c,l){return function(h,d){Object.defineProperty(c,h,{configurable:!0,writable:!0,value:d}),l&&l(h,d)}}function s(){try{return Function("return this;")()}catch{}}function o(){try{return(0,eval)("(function() { return this; })()")}catch{}}function a(){return s()||o()}})(function(e,t){var n=Object.prototype.hasOwnProperty,i=typeof Symbol=="function",s=i&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=i&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",c={__proto__:[]}instanceof Array,l=!a&&!c,h={create:a?function(){return M(Object.create(null))}:c?function(){return M({__proto__:null})}:function(){return M({})},has:l?function(P,N){return n.call(P,N)}:function(P,N){return N in P},get:l?function(P,N){return n.call(P,N)?P[N]:void 0}:function(P,N){return P[N]}},d=Object.getPrototypeOf(Function),p=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:D(),m=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:S(),f=typeof WeakMap=="function"?WeakMap:A(),g=i?Symbol.for("@reflect-metadata:registry"):void 0,v=Yd(),y=z4(v);function w(P,N,R,X){if(j(R)){if(!It(P))throw new TypeError;if(!Dt(N))throw new TypeError;return U(P,N)}else{if(!It(P))throw new TypeError;if(!he(N))throw new TypeError;if(!he(X)&&!j(X)&&!ce(X))throw new TypeError;return ce(X)&&(X=void 0),R=it(R),G(P,N,R,X)}}e("decorate",w);function b(P,N){function R(X,de){if(!he(X))throw new TypeError;if(!j(de)&&!rr(de))throw new TypeError;O(P,N,X,de)}return R}e("metadata",b);function E(P,N,R,X){if(!he(R))throw new TypeError;return j(X)||(X=it(X)),O(P,N,R,X)}e("defineMetadata",E);function C(P,N,R){if(!he(N))throw new TypeError;return j(R)||(R=it(R)),K(P,N,R)}e("hasMetadata",C);function k(P,N,R){if(!he(N))throw new TypeError;return j(R)||(R=it(R)),q(P,N,R)}e("hasOwnMetadata",k);function x(P,N,R){if(!he(N))throw new TypeError;return j(R)||(R=it(R)),Q(P,N,R)}e("getMetadata",x);function I(P,N,R){if(!he(N))throw new TypeError;return j(R)||(R=it(R)),H(P,N,R)}e("getOwnMetadata",I);function T(P,N){if(!he(P))throw new TypeError;return j(N)||(N=it(N)),B(P,N)}e("getMetadataKeys",T);function L(P,N){if(!he(P))throw new TypeError;return j(N)||(N=it(N)),W(P,N)}e("getOwnMetadataKeys",L);function V(P,N,R){if(!he(N))throw new TypeError;if(j(R)||(R=it(R)),!he(N))throw new TypeError;j(R)||(R=it(R));var X=Vc(N,R,!1);return j(X)?!1:X.OrdinaryDeleteMetadata(P,N,R)}e("deleteMetadata",V);function U(P,N){for(var R=P.length-1;R>=0;--R){var X=P[R],de=X(N);if(!j(de)&&!ce(de)){if(!Dt(de))throw new TypeError;N=de}}return N}function G(P,N,R,X){for(var de=P.length-1;de>=0;--de){var De=P[de],Be=De(N,R,X);if(!j(Be)&&!ce(Be)){if(!he(Be))throw new TypeError;X=Be}}return X}function K(P,N,R){var X=q(P,N,R);if(X)return!0;var de=sa(N);return ce(de)?!1:K(P,de,R)}function q(P,N,R){var X=Vc(N,R,!1);return j(X)?!1:Me(X.OrdinaryHasOwnMetadata(P,N,R))}function Q(P,N,R){var X=q(P,N,R);if(X)return H(P,N,R);var de=sa(N);if(!ce(de))return Q(P,de,R)}function H(P,N,R){var X=Vc(N,R,!1);if(!j(X))return X.OrdinaryGetOwnMetadata(P,N,R)}function O(P,N,R,X){var de=Vc(R,X,!0);de.OrdinaryDefineOwnMetadata(P,N,R,X)}function B(P,N){var R=W(P,N),X=sa(P);if(X===null)return R;var de=B(X,N);if(de.length<=0)return R;if(R.length<=0)return de;for(var De=new m,Be=[],ve=0,fe=R;ve<fe.length;ve++){var we=fe[ve],Se=De.has(we);Se||(De.add(we),Be.push(we))}for(var xe=0,je=de;xe<je.length;xe++){var we=je[xe],Se=De.has(we);Se||(De.add(we),Be.push(we))}return Be}function W(P,N){var R=Vc(P,N,!1);return R?R.OrdinaryOwnMetadataKeys(P,N):[]}function Y(P){if(P===null)return 1;switch(typeof P){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return P===null?1:6;default:return 6}}function j(P){return P===void 0}function ce(P){return P===null}function me(P){return typeof P=="symbol"}function he(P){return typeof P=="object"?P!==null:typeof P=="function"}function ue(P,N){switch(Y(P)){case 0:return P;case 1:return P;case 2:return P;case 3:return P;case 4:return P;case 5:return P}var R="string",X=Fc(P,s);if(X!==void 0){var de=X.call(P,R);if(he(de))throw new TypeError;return de}return Ne(P)}function Ne(P,N){var R,X,de;{var De=P.toString;if(kt(De)){var X=De.call(P);if(!he(X))return X}var R=P.valueOf;if(kt(R)){var X=R.call(P);if(!he(X))return X}}throw new TypeError}function Me(P){return!!P}function Xe(P){return""+P}function it(P){var N=ue(P);return me(N)?N:Xe(N)}function It(P){return Array.isArray?Array.isArray(P):P instanceof Object?P instanceof Array:Object.prototype.toString.call(P)==="[object Array]"}function kt(P){return typeof P=="function"}function Dt(P){return typeof P=="function"}function rr(P){switch(Y(P)){case 3:return!0;case 4:return!0;default:return!1}}function Xr(P,N){return P===N||P!==P&&N!==N}function Fc(P,N){var R=P[N];if(R!=null){if(!kt(R))throw new TypeError;return R}}function ia(P){var N=Fc(P,o);if(!kt(N))throw new TypeError;var R=N.call(P);if(!he(R))throw new TypeError;return R}function Su(P){return P.value}function xu(P){var N=P.next();return N.done?!1:N}function zc(P){var N=P.return;N&&N.call(P)}function sa(P){var N=Object.getPrototypeOf(P);if(typeof P!="function"||P===d||N!==d)return N;var R=P.prototype,X=R&&Object.getPrototypeOf(R);if(X==null||X===Object.prototype)return N;var de=X.constructor;return typeof de!="function"||de===P?N:de}function li(){var P;!j(g)&&typeof t.Reflect<"u"&&!(g in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&(P=ps(t.Reflect));var N,R,X,de=new f,De={registerProvider:Be,getProvider:fe,setProvider:Se};return De;function Be(xe){if(!Object.isExtensible(De))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case P===xe:break;case j(N):N=xe;break;case N===xe:break;case j(R):R=xe;break;case R===xe:break;default:X===void 0&&(X=new m),X.add(xe);break}}function ve(xe,je){if(!j(N)){if(N.isProviderFor(xe,je))return N;if(!j(R)){if(R.isProviderFor(xe,je))return N;if(!j(X))for(var St=ia(X);;){var Vt=xu(St);if(!Vt)return;var Bi=Su(Vt);if(Bi.isProviderFor(xe,je))return zc(St),Bi}}}if(!j(P)&&P.isProviderFor(xe,je))return P}function fe(xe,je){var St=de.get(xe),Vt;return j(St)||(Vt=St.get(je)),j(Vt)&&(Vt=ve(xe,je),j(Vt)||(j(St)&&(St=new p,de.set(xe,St)),St.set(je,Vt))),Vt}function we(xe){if(j(xe))throw new TypeError;return N===xe||R===xe||!j(X)&&X.has(xe)}function Se(xe,je,St){if(!we(St))throw new Error("Metadata provider not registered.");var Vt=fe(xe,je);if(Vt!==St){if(!j(Vt))return!1;var Bi=de.get(xe);j(Bi)&&(Bi=new p,de.set(xe,Bi)),Bi.set(je,St)}return!0}}function Yd(){var P;return!j(g)&&he(t.Reflect)&&Object.isExtensible(t.Reflect)&&(P=t.Reflect[g]),j(P)&&(P=li()),!j(g)&&he(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,g,{enumerable:!1,configurable:!1,writable:!1,value:P}),P}function z4(P){var N=new f,R={isProviderFor:function(we,Se){var xe=N.get(we);return j(xe)?!1:xe.has(Se)},OrdinaryDefineOwnMetadata:Be,OrdinaryHasOwnMetadata:de,OrdinaryGetOwnMetadata:De,OrdinaryOwnMetadataKeys:ve,OrdinaryDeleteMetadata:fe};return v.registerProvider(R),R;function X(we,Se,xe){var je=N.get(we),St=!1;if(j(je)){if(!xe)return;je=new p,N.set(we,je),St=!0}var Vt=je.get(Se);if(j(Vt)){if(!xe)return;if(Vt=new p,je.set(Se,Vt),!P.setProvider(we,Se,R))throw je.delete(Se),St&&N.delete(we),new Error("Wrong provider for target.")}return Vt}function de(we,Se,xe){var je=X(Se,xe,!1);return j(je)?!1:Me(je.has(we))}function De(we,Se,xe){var je=X(Se,xe,!1);if(!j(je))return je.get(we)}function Be(we,Se,xe,je){var St=X(xe,je,!0);St.set(we,Se)}function ve(we,Se){var xe=[],je=X(we,Se,!1);if(j(je))return xe;for(var St=je.keys(),Vt=ia(St),Bi=0;;){var NA=xu(Vt);if(!NA)return xe.length=Bi,xe;var Gj=Su(NA);try{xe[Bi]=Gj}catch(Qj){try{zc(Vt)}finally{throw Qj}}Bi++}}function fe(we,Se,xe){var je=X(Se,xe,!1);if(j(je)||!je.delete(we))return!1;if(je.size===0){var St=N.get(Se);j(St)||(St.delete(xe),St.size===0&&N.delete(St))}return!0}}function ps(P){var N=P.defineMetadata,R=P.hasOwnMetadata,X=P.getOwnMetadata,de=P.getOwnMetadataKeys,De=P.deleteMetadata,Be=new f,ve={isProviderFor:function(fe,we){var Se=Be.get(fe);return!j(Se)&&Se.has(we)?!0:de(fe,we).length?(j(Se)&&(Se=new m,Be.set(fe,Se)),Se.add(we),!0):!1},OrdinaryDefineOwnMetadata:N,OrdinaryHasOwnMetadata:R,OrdinaryGetOwnMetadata:X,OrdinaryOwnMetadataKeys:de,OrdinaryDeleteMetadata:De};return ve}function Vc(P,N,R){var X=v.getProvider(P,N);if(!j(X))return X;if(R){if(v.setProvider(P,N,y))return y;throw new Error("Illegal state.")}}function D(){var P={},N=[],R=function(){function ve(fe,we,Se){this._index=0,this._keys=fe,this._values=we,this._selector=Se}return ve.prototype["@@iterator"]=function(){return this},ve.prototype[o]=function(){return this},ve.prototype.next=function(){var fe=this._index;if(fe>=0&&fe<this._keys.length){var we=this._selector(this._keys[fe],this._values[fe]);return fe+1>=this._keys.length?(this._index=-1,this._keys=N,this._values=N):this._index++,{value:we,done:!1}}return{value:void 0,done:!0}},ve.prototype.throw=function(fe){throw this._index>=0&&(this._index=-1,this._keys=N,this._values=N),fe},ve.prototype.return=function(fe){return this._index>=0&&(this._index=-1,this._keys=N,this._values=N),{value:fe,done:!0}},ve}(),X=function(){function ve(){this._keys=[],this._values=[],this._cacheKey=P,this._cacheIndex=-2}return Object.defineProperty(ve.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ve.prototype.has=function(fe){return this._find(fe,!1)>=0},ve.prototype.get=function(fe){var we=this._find(fe,!1);return we>=0?this._values[we]:void 0},ve.prototype.set=function(fe,we){var Se=this._find(fe,!0);return this._values[Se]=we,this},ve.prototype.delete=function(fe){var we=this._find(fe,!1);if(we>=0){for(var Se=this._keys.length,xe=we+1;xe<Se;xe++)this._keys[xe-1]=this._keys[xe],this._values[xe-1]=this._values[xe];return this._keys.length--,this._values.length--,Xr(fe,this._cacheKey)&&(this._cacheKey=P,this._cacheIndex=-2),!0}return!1},ve.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=P,this._cacheIndex=-2},ve.prototype.keys=function(){return new R(this._keys,this._values,de)},ve.prototype.values=function(){return new R(this._keys,this._values,De)},ve.prototype.entries=function(){return new R(this._keys,this._values,Be)},ve.prototype["@@iterator"]=function(){return this.entries()},ve.prototype[o]=function(){return this.entries()},ve.prototype._find=function(fe,we){if(!Xr(this._cacheKey,fe)){this._cacheIndex=-1;for(var Se=0;Se<this._keys.length;Se++)if(Xr(this._keys[Se],fe)){this._cacheIndex=Se;break}}return this._cacheIndex<0&&we&&(this._cacheIndex=this._keys.length,this._keys.push(fe),this._values.push(void 0)),this._cacheIndex},ve}();return X;function de(ve,fe){return ve}function De(ve,fe){return fe}function Be(ve,fe){return[ve,fe]}}function S(){var P=function(){function N(){this._map=new p}return Object.defineProperty(N.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),N.prototype.has=function(R){return this._map.has(R)},N.prototype.add=function(R){return this._map.set(R,R),this},N.prototype.delete=function(R){return this._map.delete(R)},N.prototype.clear=function(){this._map.clear()},N.prototype.keys=function(){return this._map.keys()},N.prototype.values=function(){return this._map.keys()},N.prototype.entries=function(){return this._map.entries()},N.prototype["@@iterator"]=function(){return this.keys()},N.prototype[o]=function(){return this.keys()},N}();return P}function A(){var P=16,N=h.create(),R=X();return function(){function fe(){this._key=X()}return fe.prototype.has=function(we){var Se=de(we,!1);return Se!==void 0?h.has(Se,this._key):!1},fe.prototype.get=function(we){var Se=de(we,!1);return Se!==void 0?h.get(Se,this._key):void 0},fe.prototype.set=function(we,Se){var xe=de(we,!0);return xe[this._key]=Se,this},fe.prototype.delete=function(we){var Se=de(we,!1);return Se!==void 0?delete Se[this._key]:!1},fe.prototype.clear=function(){this._key=X()},fe}();function X(){var fe;do fe="@@WeakMap@@"+ve();while(h.has(N,fe));return N[fe]=!0,fe}function de(fe,we){if(!n.call(fe,R)){if(!we)return;Object.defineProperty(fe,R,{value:h.create()})}return fe[R]}function De(fe,we){for(var Se=0;Se<we;++Se)fe[Se]=Math.random()*255|0;return fe}function Be(fe){if(typeof Uint8Array=="function"){var we=new Uint8Array(fe);return typeof crypto<"u"?crypto.getRandomValues(we):typeof msCrypto<"u"?msCrypto.getRandomValues(we):De(we,fe),we}return De(new Array(fe),fe)}function ve(){var fe=Be(P);fe[6]=fe[6]&79|64,fe[8]=fe[8]&191|128;for(var we="",Se=0;Se<P;++Se){var xe=fe[Se];(Se===4||Se===6||Se===8)&&(we+="-"),xe<16&&(we+="0"),we+=xe.toString(16).toLowerCase()}return we}}function M(P){return P.__=void 0,delete P.__,P}})})(OP||(OP={}));var J;(function(r){r[r.Sequence=0]="Sequence",r[r.Set=1]="Set",r[r.Choice=2]="Choice"})(J||(J={}));var F;(function(r){r[r.Any=1]="Any",r[r.Boolean=2]="Boolean",r[r.OctetString=3]="OctetString",r[r.BitString=4]="BitString",r[r.Integer=5]="Integer",r[r.Enumerated=6]="Enumerated",r[r.ObjectIdentifier=7]="ObjectIdentifier",r[r.Utf8String=8]="Utf8String",r[r.BmpString=9]="BmpString",r[r.UniversalString=10]="UniversalString",r[r.NumericString=11]="NumericString",r[r.PrintableString=12]="PrintableString",r[r.TeletexString=13]="TeletexString",r[r.VideotexString=14]="VideotexString",r[r.IA5String=15]="IA5String",r[r.GraphicString=16]="GraphicString",r[r.VisibleString=17]="VisibleString",r[r.GeneralString=18]="GeneralString",r[r.CharacterString=19]="CharacterString",r[r.UTCTime=20]="UTCTime",r[r.GeneralizedTime=21]="GeneralizedTime",r[r.DATE=22]="DATE",r[r.TimeOfDay=23]="TimeOfDay",r[r.DateTime=24]="DateTime",r[r.Duration=25]="Duration",r[r.TIME=26]="TIME",r[r.Null=27]="Null"})(F||(F={}));class c4{constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if(typeof e=="number")this.fromNumber(e);else if(le.isBufferSource(e))this.unusedBits=t,this.value=le.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof Nl))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new Nl({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new Nl({name:e})}toNumber(){let e="";const t=new Uint8Array(this.value);for(const n of t)e+=n.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2);const n=t.length+7>>3;this.unusedBits=(n<<3)-t.length;const i=new Uint8Array(n);t=t.padStart(n<<3,"0").split("").reverse().join("");let s=0;for(;s<n;)i[s]=parseInt(t.slice(s<<3,(s<<3)+8),2),s++;this.value=i.buffer}}class Ye{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){typeof e=="number"?this.buffer=new ArrayBuffer(e):le.isBufferSource(e)?this.buffer=le.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof Zi))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new Zi({valueHex:this.buffer})}toSchema(e){return new Zi({name:e})}}const ube={fromASN:r=>r instanceof Ro?null:r.valueBeforeDecodeView,toASN:r=>{if(r===null)return new Ro;const e=Co(r);if(e.result.error)throw new Error(e.result.error);return e.result}},hbe={fromASN:r=>r.valueBlock.valueHexView.byteLength>=4?r.valueBlock.toString():r.valueBlock.valueDec,toASN:r=>new Io({value:+r})},dbe={fromASN:r=>r.valueBlock.valueDec,toASN:r=>new Gw({value:r})},Ct={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Io({valueHex:r})},fbe={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Nl({valueHex:r})},pbe={fromASN:r=>r.valueBlock.toString(),toASN:r=>new wo({value:r})},gbe={fromASN:r=>r.valueBlock.value,toASN:r=>new Ww({value:r})},km={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Zi({valueHex:r})},ybe={fromASN:r=>new Ye(r.getValue()),toASN:r=>r.toASN()};function Oi(r){return{fromASN:e=>e.valueBlock.value,toASN:e=>new r({value:e})}}const wH=Oi(ta),mbe=Oi(Qw),wbe=Oi(Yw),bbe=Oi(Xw),vbe=Oi(Jw),Ebe=Oi(Zw),Sbe=Oi(e4),xbe=Oi(t4),Abe=Oi(r4),Cbe=Oi(Xp),Ibe=Oi(n4),kbe=Oi(i4),_be={fromASN:r=>r.toDate(),toASN:r=>new Jp({valueDate:r})},Tbe={fromASN:r=>r.toDate(),toASN:r=>new s4({valueDate:r})},Pbe={fromASN:()=>null,toASN:()=>new Ro};function Gx(r){switch(r){case F.Any:return ube;case F.BitString:return fbe;case F.BmpString:return mbe;case F.Boolean:return gbe;case F.CharacterString:return kbe;case F.Enumerated:return dbe;case F.GeneralString:return Ibe;case F.GeneralizedTime:return Tbe;case F.GraphicString:return Abe;case F.IA5String:return xbe;case F.Integer:return hbe;case F.Null:return Pbe;case F.NumericString:return bbe;case F.ObjectIdentifier:return pbe;case F.OctetString:return km;case F.PrintableString:return vbe;case F.TeletexString:return Ebe;case F.UTCTime:return _be;case F.UniversalString:return wbe;case F.Utf8String:return wH;case F.VideotexString:return Sbe;case F.VisibleString:return Cbe;default:return null}}function Eo(r){return typeof r=="function"&&r.prototype?r.prototype.toASN&&r.prototype.fromASN?!0:Eo(r.prototype):!!(r&&typeof r=="object"&&"toASN"in r&&"fromASN"in r)}function bH(r){var e;if(r){const t=Object.getPrototypeOf(r);return((e=t==null?void 0:t.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:bH(t)}return!1}function Dbe(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<r.byteLength;i++)if(t[i]!==n[i])return!1;return!0}class $be{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){const n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!n.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return n}cache(e){const t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){const t={type:J.Sequence,items:{}},n=this.findParentSchema(e);return n&&(Object.assign(t,n),t.items=Object.assign({},t.items,n.items)),t}create(e,t){const n=this.items.get(e)||this.createDefault(e),i=[];for(const s in n.items){const o=n.items[s],a=t?s:"";let c;if(typeof o.type=="number"){const h=F[o.type],d=aH[h];if(!d)throw new Error(`Cannot get ASN1 class by name '${h}'`);c=new d({name:a})}else Eo(o.type)?c=new o.type().toSchema(a):o.optional?this.get(o.type).type===J.Choice?c=new Zl({name:a}):(c=this.create(o.type,!1),c.name=a):c=new Zl({name:a});const l=!!o.optional||o.defaultValue!==void 0;if(o.repeated){c.name="";const h=o.repeated==="set"?ko:or;c=new h({name:"",value:[new Cm({name:a,value:c})]})}if(o.context!==null&&o.context!==void 0)if(o.implicit)if(typeof o.type=="number"||Eo(o.type)){const h=o.repeated?_n:Yp;i.push(new h({name:a,optional:l,idBlock:{tagClass:3,tagNumber:o.context}}))}else{this.cache(o.type);const h=!!o.repeated;let d=h?c:this.get(o.type,!0).schema;d="valueBlock"in d?d.valueBlock.value:d.value,i.push(new _n({name:h?"":a,optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:d}))}else i.push(new _n({optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:[c]}));else c.optional=l,i.push(c)}switch(n.type){case J.Sequence:return new or({value:i,name:""});case J.Set:return new ko({value:i,name:""});case J.Choice:return new Vx({value:i,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){const t=Object.getPrototypeOf(e);return t?this.items.get(t)||this.findParentSchema(t):null}}const Ai=new $be,te=r=>e=>{let t;Ai.has(e)?t=Ai.get(e):(t=Ai.createDefault(e),Ai.set(e,t)),Object.assign(t,r)},$=r=>(e,t)=>{let n;Ai.has(e.constructor)?n=Ai.get(e.constructor):(n=Ai.createDefault(e.constructor),Ai.set(e.constructor,n));const i=Object.assign({},r);if(typeof i.type=="number"&&!i.converter){const s=Gx(r.type);if(!s)throw new Error(`Cannot get default converter for property '${t}' of ${e.constructor.name}`);i.converter=s}n.items[t]=i};class RP extends Error{constructor(){super(...arguments),this.schemas=[]}}class Nbe{static parse(e,t){const n=Co(e);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,t)}static fromASN(e,t){var n;try{if(Eo(t))return new t().fromASN(e);const i=Ai.get(t);Ai.cache(t);let s=i.schema;if(e.constructor===_n&&i.type!==J.Choice){s=new _n({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:i.schema.valueBlock.value});for(const c in i.items)delete e[c]}const o=yl({},e,s);if(!o.verified)throw new RP(`Data does not match to ${t.name} ASN1 schema. ${o.result.error}`);const a=new t;if(bH(t)){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const c=i.itemType;if(typeof c=="number"){const l=Gx(c);if(!l)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);return t.from(e.valueBlock.value,h=>l.fromASN(h))}else return t.from(e.valueBlock.value,l=>this.fromASN(l,c))}for(const c in i.items){const l=o.result[c];if(!l)continue;const h=i.items[c],d=h.type;if(typeof d=="number"||Eo(d)){const p=(n=h.converter)!==null&&n!==void 0?n:Eo(d)?new d:null;if(!p)throw new Error("Converter is empty");if(h.repeated)if(h.implicit){const m=h.repeated==="sequence"?or:ko,f=new m;f.valueBlock=l.valueBlock;const g=Co(f.toBER(!1));if(g.offset===-1)throw new Error(`Cannot parse the child item. ${g.result.error}`);if(!("value"in g.result.valueBlock&&Array.isArray(g.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const v=g.result.valueBlock.value;a[c]=Array.from(v,y=>p.fromASN(y))}else a[c]=Array.from(l,m=>p.fromASN(m));else{let m=l;if(h.implicit){let f;if(Eo(d))f=new d().toSchema("");else{const g=F[d],v=aH[g];if(!v)throw new Error(`Cannot get '${g}' class from asn1js module`);f=new v}f.valueBlock=m.valueBlock,m=Co(f.toBER(!1)).result}a[c]=p.fromASN(m)}}else if(h.repeated){if(!Array.isArray(l))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");a[c]=Array.from(l,p=>this.fromASN(p,d))}else a[c]=this.fromASN(l,d)}return a}catch(i){throw i instanceof RP&&i.schemas.push(t.name),i}}}class Qx{static serialize(e){return e instanceof Er?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&typeof e=="object"&&Eo(e))return e.toASN();if(!(e&&typeof e=="object"))throw new TypeError("Parameter 1 should be type of Object.");const t=e.constructor,n=Ai.get(t);Ai.cache(t);let i=[];if(n.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if(typeof n.itemType=="number"){const o=Gx(n.itemType);if(!o)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);i=e.map(a=>o.toASN(a))}else i=e.map(o=>this.toAsnItem({type:n.itemType},"[]",t,o))}else for(const o in n.items){const a=n.items[o],c=e[o];if(c===void 0||a.defaultValue===c||typeof a.defaultValue=="object"&&typeof c=="object"&&Dbe(this.serialize(a.defaultValue),this.serialize(c)))continue;const l=Qx.toAsnItem(a,o,t,c);if(typeof a.context=="number")if(a.implicit)if(!a.repeated&&(typeof a.type=="number"||Eo(a.type))){const h={};h.valueHex=l instanceof Ro?l.valueBeforeDecodeView:l.valueBlock.toBER(),i.push(new Yp({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},...h}))}else i.push(new _n({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:l.valueBlock.value}));else i.push(new _n({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:[l]}));else a.repeated?i=i.concat(l):i.push(l)}let s;switch(n.type){case J.Sequence:s=new or({value:i});break;case J.Set:s=new ko({value:i});break;case J.Choice:if(!i[0])throw new Error(`Schema '${t.name}' has wrong data. Choice cannot be empty.`);s=i[0];break}return s}static toAsnItem(e,t,n,i){let s;if(typeof e.type=="number"){const o=e.converter;if(!o)throw new Error(`Property '${t}' doesn't have converter for type ${F[e.type]} in schema '${n.name}'`);if(e.repeated){if(!Array.isArray(i))throw new TypeError("Parameter 'objProp' should be type of Array.");const a=Array.from(i,l=>o.toASN(l)),c=e.repeated==="sequence"?or:ko;s=new c({value:a})}else s=o.toASN(i)}else if(e.repeated){if(!Array.isArray(i))throw new TypeError("Parameter 'objProp' should be type of Array.");const o=Array.from(i,c=>this.toASN(c)),a=e.repeated==="sequence"?or:ko;s=new a({value:o})}else s=this.toASN(i);return s}}class at extends Array{constructor(e=[]){if(typeof e=="number")super(e);else{super();for(const t of e)this.push(t)}}}class oe{static serialize(e){return Qx.serialize(e)}static parse(e,t){return Nbe.parse(e,t)}static toString(e){const t=le.isBufferSource(e)?le.toArrayBuffer(e):oe.serialize(e),n=Co(t);if(n.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${n.result.error}`);return n.result.toString()}}function _(r,e,t,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}class LP{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){const t=e.split(".");if(t.length!==4)throw new Error("Invalid IPv4 address");return t.map(n=>{const i=parseInt(n,10);if(isNaN(i)||i<0||i>255)throw new Error("Invalid IPv4 address part");return i})}static parseIPv6(e){const n=this.expandIPv6(e).split(":");if(n.length!==8)throw new Error("Invalid IPv6 address");return n.reduce((i,s)=>{const o=parseInt(s,16);if(isNaN(o)||o<0||o>65535)throw new Error("Invalid IPv6 address part");return i.push(o>>8&255),i.push(o&255),i},[])}static expandIPv6(e){if(!e.includes("::"))return e;const t=e.split("::");if(t.length>2)throw new Error("Invalid IPv6 address");const n=t[0]?t[0].split(":"):[],i=t[1]?t[1].split(":"):[],s=8-(n.length+i.length);if(s<0)throw new Error("Invalid IPv6 address");return[...n,...Array(s).fill("0"),...i].join(":")}static formatIPv6(e){const t=[];for(let n=0;n<16;n+=2)t.push((e[n]<<8|e[n+1]).toString(16));return this.compressIPv6(t.join(":"))}static compressIPv6(e){const t=e.split(":");let n=-1,i=0,s=-1,o=0;for(let a=0;a<t.length;a++)t[a]==="0"?(s===-1&&(s=a),o++):(o>i&&(n=s,i=o),s=-1,o=0);if(o>i&&(n=s,i=o),i>1){const a=t.slice(0,n).join(":"),c=t.slice(n+i).join(":");return`${a}::${c}`}return e}static parseCIDR(e){const[t,n]=e.split("/"),i=parseInt(n,10);if(this.isIPv4(t)){if(i<0||i>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(t),i]}else{if(i<0||i>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(t),i]}}static decodeIP(e){if(e.length===64&&parseInt(e,16)===0)return"::/0";if(e.length!==16)return e;const t=parseInt(e.slice(8),16).toString(2).split("").reduce((i,s)=>i+ +s,0);let n=e.slice(0,8).replace(/(.{2})/g,i=>`${parseInt(i,16)}.`);return n=n.slice(0,-1),`${n}/${t}`}static toString(e){const t=new Uint8Array(e);if(t.length===4)return Array.from(t).join(".");if(t.length===16)return this.formatIPv6(t);if(t.length===8||t.length===32){const n=t.length/2,i=t.slice(0,n),s=t.slice(n);if(t.every(c=>c===0))return t.length===8?"0.0.0.0/0":"::/0";const a=s.reduce((c,l)=>c+(l.toString(2).match(/1/g)||[]).length,0);return t.length===8?`${Array.from(i).join(".")}/${a}`:`${this.formatIPv6(i)}/${a}`}return this.decodeIP(Ee.ToHex(e))}static fromString(e){if(e.includes("/")){const[n,i]=this.parseCIDR(e),s=new Uint8Array(n.length);let o=i;for(let c=0;c<s.length;c++)o>=8?(s[c]=255,o-=8):o>0&&(s[c]=255<<8-o,o=0);const a=new Uint8Array(n.length*2);return a.set(n,0),a.set(s,n.length),a.buffer}const t=this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e);return new Uint8Array(t).buffer}}var i7,s7,o7;let Sr=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};_([$({type:F.TeletexString})],Sr.prototype,"teletexString",void 0);_([$({type:F.PrintableString})],Sr.prototype,"printableString",void 0);_([$({type:F.UniversalString})],Sr.prototype,"universalString",void 0);_([$({type:F.Utf8String})],Sr.prototype,"utf8String",void 0);_([$({type:F.BmpString})],Sr.prototype,"bmpString",void 0);Sr=_([te({type:J.Choice})],Sr);let dd=class extends Sr{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?Ee.ToHex(this.anyValue):super.toString())}};_([$({type:F.IA5String})],dd.prototype,"ia5String",void 0);_([$({type:F.Any})],dd.prototype,"anyValue",void 0);dd=_([te({type:J.Choice})],dd);class l4{constructor(e={}){this.type="",this.value=new dd,Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],l4.prototype,"type",void 0);_([$({type:dd})],l4.prototype,"value",void 0);let fd=i7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,i7.prototype)}};fd=i7=_([te({type:J.Set,itemType:l4})],fd);let a7=s7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,s7.prototype)}};a7=s7=_([te({type:J.Sequence,itemType:fd})],a7);let Ht=o7=class extends a7{constructor(e){super(e),Object.setPrototypeOf(this,o7.prototype)}};Ht=o7=_([te({type:J.Sequence})],Ht);const Mbe={fromASN:r=>LP.toString(km.fromASN(r)),toASN:r=>km.toASN(LP.fromString(r))};class ap{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],ap.prototype,"typeId",void 0);_([$({type:F.Any,context:0})],ap.prototype,"value",void 0);class Yx{constructor(e={}){this.partyName=new Sr,Object.assign(this,e)}}_([$({type:Sr,optional:!0,context:0,implicit:!0})],Yx.prototype,"nameAssigner",void 0);_([$({type:Sr,context:1,implicit:!0})],Yx.prototype,"partyName",void 0);let Re=class{constructor(e={}){Object.assign(this,e)}};_([$({type:ap,context:0,implicit:!0})],Re.prototype,"otherName",void 0);_([$({type:F.IA5String,context:1,implicit:!0})],Re.prototype,"rfc822Name",void 0);_([$({type:F.IA5String,context:2,implicit:!0})],Re.prototype,"dNSName",void 0);_([$({type:F.Any,context:3,implicit:!0})],Re.prototype,"x400Address",void 0);_([$({type:Ht,context:4,implicit:!1})],Re.prototype,"directoryName",void 0);_([$({type:Yx,context:5})],Re.prototype,"ediPartyName",void 0);_([$({type:F.IA5String,context:6,implicit:!0})],Re.prototype,"uniformResourceIdentifier",void 0);_([$({type:F.OctetString,context:7,implicit:!0,converter:Mbe})],Re.prototype,"iPAddress",void 0);_([$({type:F.ObjectIdentifier,context:8,implicit:!0})],Re.prototype,"registeredID",void 0);Re=_([te({type:J.Choice})],Re);const Xx="1.3.6.1.5.5.7",Obe=`${Xx}.1`,Fd=`${Xx}.3`,u4=`${Xx}.48`,BP=`${u4}.1`,UP=`${u4}.2`,FP=`${u4}.3`,zP=`${u4}.5`,Lc="2.5.29";var c7;const l7=`${Obe}.1`;class e0{constructor(e={}){this.accessMethod="",this.accessLocation=new Re,Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],e0.prototype,"accessMethod",void 0);_([$({type:Re})],e0.prototype,"accessLocation",void 0);let rh=c7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,c7.prototype)}};rh=c7=_([te({type:J.Sequence,itemType:e0})],rh);const u7=`${Lc}.35`;class Jx extends Ye{}class ml{constructor(e={}){e&&Object.assign(this,e)}}_([$({type:Jx,context:0,optional:!0,implicit:!0})],ml.prototype,"keyIdentifier",void 0);_([$({type:Re,context:1,optional:!0,implicit:!0,repeated:"sequence"})],ml.prototype,"authorityCertIssuer",void 0);_([$({type:F.Integer,context:2,optional:!0,implicit:!0,converter:Ct})],ml.prototype,"authorityCertSerialNumber",void 0);const vH=`${Lc}.19`;class _m{constructor(e={}){this.cA=!1,Object.assign(this,e)}}_([$({type:F.Boolean,defaultValue:!1})],_m.prototype,"cA",void 0);_([$({type:F.Integer,optional:!0})],_m.prototype,"pathLenConstraint",void 0);var h7;let an=h7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,h7.prototype)}};an=h7=_([te({type:J.Sequence,itemType:Re})],an);var d7;let VP=d7=class extends an{constructor(e){super(e),Object.setPrototypeOf(this,d7.prototype)}};VP=d7=_([te({type:J.Sequence})],VP);var f7;const EH=`${Lc}.32`;let Lo=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};_([$({type:F.IA5String})],Lo.prototype,"ia5String",void 0);_([$({type:F.VisibleString})],Lo.prototype,"visibleString",void 0);_([$({type:F.BmpString})],Lo.prototype,"bmpString",void 0);_([$({type:F.Utf8String})],Lo.prototype,"utf8String",void 0);Lo=_([te({type:J.Choice})],Lo);class Zx{constructor(e={}){this.organization=new Lo,this.noticeNumbers=[],Object.assign(this,e)}}_([$({type:Lo})],Zx.prototype,"organization",void 0);_([$({type:F.Integer,repeated:"sequence"})],Zx.prototype,"noticeNumbers",void 0);class eA{constructor(e={}){Object.assign(this,e)}}_([$({type:Zx,optional:!0})],eA.prototype,"noticeRef",void 0);_([$({type:Lo,optional:!0})],eA.prototype,"explicitText",void 0);let Tm=class{constructor(e={}){Object.assign(this,e)}};_([$({type:F.IA5String})],Tm.prototype,"cPSuri",void 0);_([$({type:eA})],Tm.prototype,"userNotice",void 0);Tm=_([te({type:J.Choice})],Tm);class tA{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],tA.prototype,"policyQualifierId",void 0);_([$({type:F.Any})],tA.prototype,"qualifier",void 0);class h4{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],h4.prototype,"policyIdentifier",void 0);_([$({type:tA,repeated:"sequence",optional:!0})],h4.prototype,"policyQualifiers",void 0);let Pm=f7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,f7.prototype)}};Pm=f7=_([te({type:J.Sequence,itemType:h4})],Pm);let Dm=class{constructor(e=0){this.value=e}};_([$({type:F.Integer})],Dm.prototype,"value",void 0);Dm=_([te({type:J.Choice})],Dm);let KP=class extends Dm{};KP=_([te({type:J.Choice})],KP);var p7;const g7=`${Lc}.31`;var ji;(function(r){r[r.unused=1]="unused",r[r.keyCompromise=2]="keyCompromise",r[r.cACompromise=4]="cACompromise",r[r.affiliationChanged=8]="affiliationChanged",r[r.superseded=16]="superseded",r[r.cessationOfOperation=32]="cessationOfOperation",r[r.certificateHold=64]="certificateHold",r[r.privilegeWithdrawn=128]="privilegeWithdrawn",r[r.aACompromise=256]="aACompromise"})(ji||(ji={}));class SH extends c4{toJSON(){const e=[],t=this.toNumber();return t&ji.aACompromise&&e.push("aACompromise"),t&ji.affiliationChanged&&e.push("affiliationChanged"),t&ji.cACompromise&&e.push("cACompromise"),t&ji.certificateHold&&e.push("certificateHold"),t&ji.cessationOfOperation&&e.push("cessationOfOperation"),t&ji.keyCompromise&&e.push("keyCompromise"),t&ji.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&ji.superseded&&e.push("superseded"),t&ji.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}}let eu=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Re,context:0,repeated:"sequence",implicit:!0})],eu.prototype,"fullName",void 0);_([$({type:fd,context:1,implicit:!0})],eu.prototype,"nameRelativeToCRLIssuer",void 0);eu=_([te({type:J.Choice})],eu);class zd{constructor(e={}){Object.assign(this,e)}}_([$({type:eu,context:0,optional:!0})],zd.prototype,"distributionPoint",void 0);_([$({type:SH,context:1,optional:!0,implicit:!0})],zd.prototype,"reasons",void 0);_([$({type:Re,context:2,optional:!0,repeated:"sequence",implicit:!0})],zd.prototype,"cRLIssuer",void 0);let Eh=p7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,p7.prototype)}};Eh=p7=_([te({type:J.Sequence,itemType:zd})],Eh);var y7;let HP=y7=class extends Eh{constructor(e){super(e),Object.setPrototypeOf(this,y7.prototype)}};HP=y7=_([te({type:J.Sequence,itemType:zd})],HP);class Qr{constructor(e={}){this.onlyContainsUserCerts=Qr.ONLY,this.onlyContainsCACerts=Qr.ONLY,this.indirectCRL=Qr.ONLY,this.onlyContainsAttributeCerts=Qr.ONLY,Object.assign(this,e)}}Qr.ONLY=!1;_([$({type:eu,context:0,optional:!0})],Qr.prototype,"distributionPoint",void 0);_([$({type:F.Boolean,context:1,defaultValue:Qr.ONLY,implicit:!0})],Qr.prototype,"onlyContainsUserCerts",void 0);_([$({type:F.Boolean,context:2,defaultValue:Qr.ONLY,implicit:!0})],Qr.prototype,"onlyContainsCACerts",void 0);_([$({type:SH,context:3,optional:!0,implicit:!0})],Qr.prototype,"onlySomeReasons",void 0);_([$({type:F.Boolean,context:4,defaultValue:Qr.ONLY,implicit:!0})],Qr.prototype,"indirectCRL",void 0);_([$({type:F.Boolean,context:5,defaultValue:Qr.ONLY,implicit:!0})],Qr.prototype,"onlyContainsAttributeCerts",void 0);var f1;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(f1||(f1={}));let m7=class{constructor(e=f1.unspecified){this.reason=f1.unspecified,this.reason=e}toJSON(){return f1[this.reason]}toString(){return this.toJSON()}};_([$({type:F.Enumerated})],m7.prototype,"reason",void 0);m7=_([te({type:J.Choice})],m7);var w7;const xH=`${Lc}.37`;let $m=w7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,w7.prototype)}};$m=w7=_([te({type:J.Sequence,itemType:F.ObjectIdentifier})],$m);const Rbe=`${Fd}.1`,Lbe=`${Fd}.2`,Bbe=`${Fd}.3`,Ube=`${Fd}.4`,Fbe=`${Fd}.8`,zbe=`${Fd}.9`;let b7=class{constructor(e=new ArrayBuffer(0)){this.value=e}};_([$({type:F.Integer,converter:Ct})],b7.prototype,"value",void 0);b7=_([te({type:J.Choice})],b7);let v7=class{constructor(e){this.value=new Date,e&&(this.value=e)}};_([$({type:F.GeneralizedTime})],v7.prototype,"value",void 0);v7=_([te({type:J.Choice})],v7);var E7;let jP=E7=class extends an{constructor(e){super(e),Object.setPrototypeOf(this,E7.prototype)}};jP=E7=_([te({type:J.Sequence})],jP);const AH=`${Lc}.15`;var qi;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(qi||(qi={}));class k5 extends c4{toJSON(){const e=this.toNumber(),t=[];return e&qi.cRLSign&&t.push("crlSign"),e&qi.dataEncipherment&&t.push("dataEncipherment"),e&qi.decipherOnly&&t.push("decipherOnly"),e&qi.digitalSignature&&t.push("digitalSignature"),e&qi.encipherOnly&&t.push("encipherOnly"),e&qi.keyAgreement&&t.push("keyAgreement"),e&qi.keyCertSign&&t.push("keyCertSign"),e&qi.keyEncipherment&&t.push("keyEncipherment"),e&qi.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}}var S7;class d4{constructor(e={}){this.base=new Re,this.minimum=0,Object.assign(this,e)}}_([$({type:Re})],d4.prototype,"base",void 0);_([$({type:F.Integer,context:0,defaultValue:0,implicit:!0})],d4.prototype,"minimum",void 0);_([$({type:F.Integer,context:1,optional:!0,implicit:!0})],d4.prototype,"maximum",void 0);let Nm=S7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,S7.prototype)}};Nm=S7=_([te({type:J.Sequence,itemType:d4})],Nm);class CH{constructor(e={}){Object.assign(this,e)}}_([$({type:Nm,context:0,optional:!0,implicit:!0})],CH.prototype,"permittedSubtrees",void 0);_([$({type:Nm,context:1,optional:!0,implicit:!0})],CH.prototype,"excludedSubtrees",void 0);class IH{constructor(e={}){Object.assign(this,e)}}_([$({type:F.Integer,context:0,implicit:!0,optional:!0,converter:Ct})],IH.prototype,"requireExplicitPolicy",void 0);_([$({type:F.Integer,context:1,implicit:!0,optional:!0,converter:Ct})],IH.prototype,"inhibitPolicyMapping",void 0);var x7;class rA{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],rA.prototype,"issuerDomainPolicy",void 0);_([$({type:F.ObjectIdentifier})],rA.prototype,"subjectDomainPolicy",void 0);let qP=x7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,x7.prototype)}};qP=x7=_([te({type:J.Sequence,itemType:rA})],qP);var A7;const kH=`${Lc}.17`;let C7=A7=class extends an{constructor(e){super(e),Object.setPrototypeOf(this,A7.prototype)}};C7=A7=_([te({type:J.Sequence})],C7);let Bo=class{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}};_([$({type:F.ObjectIdentifier})],Bo.prototype,"type",void 0);_([$({type:F.Any,repeated:"set"})],Bo.prototype,"values",void 0);var I7;let WP=I7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,I7.prototype)}};WP=I7=_([te({type:J.Sequence,itemType:Bo})],WP);const _H=`${Lc}.14`;class hc extends Jx{}class TH{constructor(e={}){Object.assign(this,e)}}_([$({type:F.GeneralizedTime,context:0,implicit:!0,optional:!0})],TH.prototype,"notBefore",void 0);_([$({type:F.GeneralizedTime,context:1,implicit:!0,optional:!0})],TH.prototype,"notAfter",void 0);var p1;(function(r){r[r.keyUpdateAllowed=1]="keyUpdateAllowed",r[r.newExtensions=2]="newExtensions",r[r.pKIXCertificate=4]="pKIXCertificate"})(p1||(p1={}));class PH extends c4{toJSON(){const e=[],t=this.toNumber();return t&p1.pKIXCertificate&&e.push("pKIXCertificate"),t&p1.newExtensions&&e.push("newExtensions"),t&p1.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}}class DH{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new PH,Object.assign(this,e)}}_([$({type:F.GeneralString})],DH.prototype,"entrustVers",void 0);_([$({type:PH})],DH.prototype,"entrustInfoFlags",void 0);var k7;let GP=k7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,k7.prototype)}};GP=k7=_([te({type:J.Sequence,itemType:e0})],GP);class ge{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof ge&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&hK(e.parameters,this.parameters)||e.parameters===this.parameters)}}_([$({type:F.ObjectIdentifier})],ge.prototype,"algorithm",void 0);_([$({type:F.Any,optional:!0})],ge.prototype,"parameters",void 0);class ts{constructor(e={}){this.algorithm=new ge,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:ge})],ts.prototype,"algorithm",void 0);_([$({type:F.BitString})],ts.prototype,"subjectPublicKey",void 0);let mr=class{constructor(e){if(e)if(typeof e=="string"||typeof e=="number"||e instanceof Date){const t=new Date(e);t.getUTCFullYear()>2049?this.generalTime=t:this.utcTime=t}else Object.assign(this,e)}getTime(){const e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};_([$({type:F.UTCTime})],mr.prototype,"utcTime",void 0);_([$({type:F.GeneralizedTime})],mr.prototype,"generalTime",void 0);mr=_([te({type:J.Choice})],mr);class t0{constructor(e){this.notBefore=new mr(new Date),this.notAfter=new mr(new Date),e&&(this.notBefore=new mr(e.notBefore),this.notAfter=new mr(e.notAfter))}}_([$({type:mr})],t0.prototype,"notBefore",void 0);_([$({type:mr})],t0.prototype,"notAfter",void 0);var _7;let $i=class $H{constructor(e={}){this.extnID="",this.critical=$H.CRITICAL,this.extnValue=new Ye,Object.assign(this,e)}};$i.CRITICAL=!1;_([$({type:F.ObjectIdentifier})],$i.prototype,"extnID",void 0);_([$({type:F.Boolean,defaultValue:$i.CRITICAL})],$i.prototype,"critical",void 0);_([$({type:Ye})],$i.prototype,"extnValue",void 0);let Ic=_7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,_7.prototype)}};Ic=_7=_([te({type:J.Sequence,itemType:$i})],Ic);var tu;(function(r){r[r.v1=0]="v1",r[r.v2=1]="v2",r[r.v3=2]="v3"})(tu||(tu={}));class ci{constructor(e={}){this.version=tu.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new ge,this.issuer=new Ht,this.validity=new t0,this.subject=new Ht,this.subjectPublicKeyInfo=new ts,Object.assign(this,e)}}_([$({type:F.Integer,context:0,defaultValue:tu.v1})],ci.prototype,"version",void 0);_([$({type:F.Integer,converter:Ct})],ci.prototype,"serialNumber",void 0);_([$({type:ge})],ci.prototype,"signature",void 0);_([$({type:Ht})],ci.prototype,"issuer",void 0);_([$({type:t0})],ci.prototype,"validity",void 0);_([$({type:Ht})],ci.prototype,"subject",void 0);_([$({type:ts})],ci.prototype,"subjectPublicKeyInfo",void 0);_([$({type:F.BitString,context:1,implicit:!0,optional:!0})],ci.prototype,"issuerUniqueID",void 0);_([$({type:F.BitString,context:2,implicit:!0,optional:!0})],ci.prototype,"subjectUniqueID",void 0);_([$({type:Ic,context:3,optional:!0})],ci.prototype,"extensions",void 0);class ru{constructor(e={}){this.tbsCertificate=new ci,this.signatureAlgorithm=new ge,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:ci})],ru.prototype,"tbsCertificate",void 0);_([$({type:ge})],ru.prototype,"signatureAlgorithm",void 0);_([$({type:F.BitString})],ru.prototype,"signatureValue",void 0);class f4{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new mr,Object.assign(this,e)}}_([$({type:F.Integer,converter:Ct})],f4.prototype,"userCertificate",void 0);_([$({type:mr})],f4.prototype,"revocationDate",void 0);_([$({type:$i,optional:!0,repeated:"sequence"})],f4.prototype,"crlEntryExtensions",void 0);class ra{constructor(e={}){this.signature=new ge,this.issuer=new Ht,this.thisUpdate=new mr,Object.assign(this,e)}}_([$({type:F.Integer,optional:!0})],ra.prototype,"version",void 0);_([$({type:ge})],ra.prototype,"signature",void 0);_([$({type:Ht})],ra.prototype,"issuer",void 0);_([$({type:mr})],ra.prototype,"thisUpdate",void 0);_([$({type:mr,optional:!0})],ra.prototype,"nextUpdate",void 0);_([$({type:f4,repeated:"sequence",optional:!0})],ra.prototype,"revokedCertificates",void 0);_([$({type:$i,optional:!0,context:0,repeated:"sequence"})],ra.prototype,"crlExtensions",void 0);class nA{constructor(e={}){this.tbsCertList=new ra,this.signatureAlgorithm=new ge,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:ra})],nA.prototype,"tbsCertList",void 0);_([$({type:ge})],nA.prototype,"signatureAlgorithm",void 0);_([$({type:F.BitString})],nA.prototype,"signature",void 0);class Vd{constructor(e={}){this.issuer=new Ht,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:Ht})],Vd.prototype,"issuer",void 0);_([$({type:F.Integer,converter:Ct})],Vd.prototype,"serialNumber",void 0);let pd=class{constructor(e={}){Object.assign(this,e)}};_([$({type:hc,context:0,implicit:!0})],pd.prototype,"subjectKeyIdentifier",void 0);_([$({type:Vd})],pd.prototype,"issuerAndSerialNumber",void 0);pd=_([te({type:J.Choice})],pd);var Uo;(function(r){r[r.v0=0]="v0",r[r.v1=1]="v1",r[r.v2=2]="v2",r[r.v3=3]="v3",r[r.v4=4]="v4",r[r.v5=5]="v5"})(Uo||(Uo={}));let cp=class extends ge{};cp=_([te({type:J.Sequence})],cp);let Mm=class extends ge{};Mm=_([te({type:J.Sequence})],Mm);let Vs=class extends ge{};Vs=_([te({type:J.Sequence})],Vs);let Om=class extends ge{};Om=_([te({type:J.Sequence})],Om);let QP=class extends ge{};QP=_([te({type:J.Sequence})],QP);let T7=class extends ge{};T7=_([te({type:J.Sequence})],T7);let Kd=class{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}};_([$({type:F.ObjectIdentifier})],Kd.prototype,"attrType",void 0);_([$({type:F.Any,repeated:"set"})],Kd.prototype,"attrValues",void 0);var P7;class Ws{constructor(e={}){this.version=Uo.v0,this.sid=new pd,this.digestAlgorithm=new cp,this.signatureAlgorithm=new Mm,this.signature=new Ye,Object.assign(this,e)}}_([$({type:F.Integer})],Ws.prototype,"version",void 0);_([$({type:pd})],Ws.prototype,"sid",void 0);_([$({type:cp})],Ws.prototype,"digestAlgorithm",void 0);_([$({type:Kd,repeated:"set",context:0,implicit:!0,optional:!0})],Ws.prototype,"signedAttrs",void 0);_([$({type:Mm})],Ws.prototype,"signatureAlgorithm",void 0);_([$({type:Ye})],Ws.prototype,"signature",void 0);_([$({type:Kd,repeated:"set",context:1,implicit:!0,optional:!0})],Ws.prototype,"unsignedAttrs",void 0);let Rm=P7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,P7.prototype)}};Rm=P7=_([te({type:J.Set,itemType:Ws})],Rm);let YP=class extends mr{};YP=_([te({type:J.Choice})],YP);let XP=class extends Ws{};XP=_([te({type:J.Sequence})],XP);class iA{constructor(e={}){this.acIssuer=new Re,this.acSerial=0,this.attrs=[],Object.assign(this,e)}}_([$({type:Re})],iA.prototype,"acIssuer",void 0);_([$({type:F.Integer})],iA.prototype,"acSerial",void 0);_([$({type:Bo,repeated:"sequence"})],iA.prototype,"attrs",void 0);var D7;let Lm=D7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,D7.prototype)}};Lm=D7=_([te({type:J.Sequence,itemType:F.ObjectIdentifier})],Lm);class p4{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}}_([$({type:F.Integer,optional:!0})],p4.prototype,"pathLenConstraint",void 0);_([$({type:Lm,implicit:!0,context:0,optional:!0})],p4.prototype,"permittedAttrs",void 0);_([$({type:Lm,implicit:!0,context:1,optional:!0})],p4.prototype,"excludedAttrs",void 0);_([$({type:F.Boolean,defaultValue:!0})],p4.prototype,"permitUnSpecified",void 0);class vu{constructor(e={}){this.issuer=new an,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:an})],vu.prototype,"issuer",void 0);_([$({type:F.Integer,converter:Ct})],vu.prototype,"serial",void 0);_([$({type:F.BitString,optional:!0})],vu.prototype,"issuerUID",void 0);var $7;(function(r){r[r.publicKey=0]="publicKey",r[r.publicKeyCert=1]="publicKeyCert",r[r.otherObjectTypes=2]="otherObjectTypes"})($7||($7={}));class Eu{constructor(e={}){this.digestedObjectType=$7.publicKey,this.digestAlgorithm=new ge,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.Enumerated})],Eu.prototype,"digestedObjectType",void 0);_([$({type:F.ObjectIdentifier,optional:!0})],Eu.prototype,"otherObjectTypeID",void 0);_([$({type:ge})],Eu.prototype,"digestAlgorithm",void 0);_([$({type:F.BitString})],Eu.prototype,"objectDigest",void 0);class g4{constructor(e={}){Object.assign(this,e)}}_([$({type:an,optional:!0})],g4.prototype,"issuerName",void 0);_([$({type:vu,context:0,implicit:!0,optional:!0})],g4.prototype,"baseCertificateID",void 0);_([$({type:Eu,context:1,implicit:!0,optional:!0})],g4.prototype,"objectDigestInfo",void 0);let gd=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Re,repeated:"sequence"})],gd.prototype,"v1Form",void 0);_([$({type:g4,context:0,implicit:!0})],gd.prototype,"v2Form",void 0);gd=_([te({type:J.Choice})],gd);class y4{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}}_([$({type:F.GeneralizedTime})],y4.prototype,"notBeforeTime",void 0);_([$({type:F.GeneralizedTime})],y4.prototype,"notAfterTime",void 0);class r0{constructor(e={}){Object.assign(this,e)}}_([$({type:vu,implicit:!0,context:0,optional:!0})],r0.prototype,"baseCertificateID",void 0);_([$({type:an,implicit:!0,context:1,optional:!0})],r0.prototype,"entityName",void 0);_([$({type:Eu,implicit:!0,context:2,optional:!0})],r0.prototype,"objectDigestInfo",void 0);var N7;(function(r){r[r.v2=1]="v2"})(N7||(N7={}));class fs{constructor(e={}){this.version=N7.v2,this.holder=new r0,this.issuer=new gd,this.signature=new ge,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new y4,this.attributes=[],Object.assign(this,e)}}_([$({type:F.Integer})],fs.prototype,"version",void 0);_([$({type:r0})],fs.prototype,"holder",void 0);_([$({type:gd})],fs.prototype,"issuer",void 0);_([$({type:ge})],fs.prototype,"signature",void 0);_([$({type:F.Integer,converter:Ct})],fs.prototype,"serialNumber",void 0);_([$({type:y4})],fs.prototype,"attrCertValidityPeriod",void 0);_([$({type:Bo,repeated:"sequence"})],fs.prototype,"attributes",void 0);_([$({type:F.BitString,optional:!0})],fs.prototype,"issuerUniqueID",void 0);_([$({type:Ic,optional:!0})],fs.prototype,"extensions",void 0);class m4{constructor(e={}){this.acinfo=new fs,this.signatureAlgorithm=new ge,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:fs})],m4.prototype,"acinfo",void 0);_([$({type:ge})],m4.prototype,"signatureAlgorithm",void 0);_([$({type:F.BitString})],m4.prototype,"signatureValue",void 0);var Bm;(function(r){r[r.unmarked=1]="unmarked",r[r.unclassified=2]="unclassified",r[r.restricted=4]="restricted",r[r.confidential=8]="confidential",r[r.secret=16]="secret",r[r.topSecret=32]="topSecret"})(Bm||(Bm={}));class M7 extends c4{}class sA{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier,implicit:!0,context:0})],sA.prototype,"type",void 0);_([$({type:F.Any,implicit:!0,context:1})],sA.prototype,"value",void 0);class oA{constructor(e={}){this.policyId="",this.classList=new M7(Bm.unclassified),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],oA.prototype,"policyId",void 0);_([$({type:M7,defaultValue:new M7(Bm.unclassified)})],oA.prototype,"classList",void 0);_([$({type:sA,repeated:"set"})],oA.prototype,"securityCategories",void 0);class w4{constructor(e={}){Object.assign(this,e)}}_([$({type:Ye})],w4.prototype,"cotets",void 0);_([$({type:F.ObjectIdentifier})],w4.prototype,"oid",void 0);_([$({type:F.Utf8String})],w4.prototype,"string",void 0);class NH{constructor(e={}){this.values=[],Object.assign(this,e)}}_([$({type:an,implicit:!0,context:0,optional:!0})],NH.prototype,"policyAuthority",void 0);_([$({type:w4,repeated:"sequence"})],NH.prototype,"values",void 0);var O7;class b4{constructor(e={}){this.targetCertificate=new vu,Object.assign(this,e)}}_([$({type:vu})],b4.prototype,"targetCertificate",void 0);_([$({type:Re,optional:!0})],b4.prototype,"targetName",void 0);_([$({type:Eu,optional:!0})],b4.prototype,"certDigestInfo",void 0);let yd=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Re,context:0,implicit:!0})],yd.prototype,"targetName",void 0);_([$({type:Re,context:1,implicit:!0})],yd.prototype,"targetGroup",void 0);_([$({type:b4,context:2,implicit:!0})],yd.prototype,"targetCert",void 0);yd=_([te({type:J.Choice})],yd);let R7=O7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,O7.prototype)}};R7=O7=_([te({type:J.Sequence,itemType:yd})],R7);var L7;let JP=L7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,L7.prototype)}};JP=L7=_([te({type:J.Sequence,itemType:R7})],JP);class MH{constructor(e={}){Object.assign(this,e)}}_([$({type:an,implicit:!0,context:0,optional:!0})],MH.prototype,"roleAuthority",void 0);_([$({type:Re,implicit:!0,context:1})],MH.prototype,"roleName",void 0);class aA{constructor(e={}){this.service=new Re,this.ident=new Re,Object.assign(this,e)}}_([$({type:Re})],aA.prototype,"service",void 0);_([$({type:Re})],aA.prototype,"ident",void 0);_([$({type:Ye,optional:!0})],aA.prototype,"authInfo",void 0);var B7;class cA{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],cA.prototype,"otherCertFormat",void 0);_([$({type:F.Any})],cA.prototype,"otherCert",void 0);let md=class{constructor(e={}){Object.assign(this,e)}};_([$({type:ru})],md.prototype,"certificate",void 0);_([$({type:m4,context:2,implicit:!0})],md.prototype,"v2AttrCert",void 0);_([$({type:cA,context:3,implicit:!0})],md.prototype,"other",void 0);md=_([te({type:J.Choice})],md);let Um=B7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,B7.prototype)}};Um=B7=_([te({type:J.Set,itemType:md})],Um);class Hd{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],Hd.prototype,"contentType",void 0);_([$({type:F.Any,context:0})],Hd.prototype,"content",void 0);let lp=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Ye})],lp.prototype,"single",void 0);_([$({type:F.Any})],lp.prototype,"any",void 0);lp=_([te({type:J.Choice})],lp);class v4{constructor(e={}){this.eContentType="",Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],v4.prototype,"eContentType",void 0);_([$({type:lp,context:0,optional:!0})],v4.prototype,"eContent",void 0);let up=class{constructor(e={}){Object.assign(this,e)}};_([$({type:Ye,context:0,implicit:!0,optional:!0})],up.prototype,"value",void 0);_([$({type:Ye,converter:ybe,context:0,implicit:!0,optional:!0,repeated:"sequence"})],up.prototype,"constructedValue",void 0);up=_([te({type:J.Choice})],up);class n0{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new Om,Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],n0.prototype,"contentType",void 0);_([$({type:Om})],n0.prototype,"contentEncryptionAlgorithm",void 0);_([$({type:up,optional:!0})],n0.prototype,"encryptedContent",void 0);class E4{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],E4.prototype,"keyAttrId",void 0);_([$({type:F.Any,optional:!0})],E4.prototype,"keyAttr",void 0);var U7;class S4{constructor(e={}){this.subjectKeyIdentifier=new hc,Object.assign(this,e)}}_([$({type:hc})],S4.prototype,"subjectKeyIdentifier",void 0);_([$({type:F.GeneralizedTime,optional:!0})],S4.prototype,"date",void 0);_([$({type:E4,optional:!0})],S4.prototype,"other",void 0);let wd=class{constructor(e={}){Object.assign(this,e)}};_([$({type:S4,context:0,implicit:!0,optional:!0})],wd.prototype,"rKeyId",void 0);_([$({type:Vd,optional:!0})],wd.prototype,"issuerAndSerialNumber",void 0);wd=_([te({type:J.Choice})],wd);class lA{constructor(e={}){this.rid=new wd,this.encryptedKey=new Ye,Object.assign(this,e)}}_([$({type:wd})],lA.prototype,"rid",void 0);_([$({type:Ye})],lA.prototype,"encryptedKey",void 0);let Fm=U7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,U7.prototype)}};Fm=U7=_([te({type:J.Sequence,itemType:lA})],Fm);class uA{constructor(e={}){this.algorithm=new ge,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:ge})],uA.prototype,"algorithm",void 0);_([$({type:F.BitString})],uA.prototype,"publicKey",void 0);let nu=class{constructor(e={}){Object.assign(this,e)}};_([$({type:hc,context:0,implicit:!0,optional:!0})],nu.prototype,"subjectKeyIdentifier",void 0);_([$({type:uA,context:1,implicit:!0,optional:!0})],nu.prototype,"originatorKey",void 0);_([$({type:Vd,optional:!0})],nu.prototype,"issuerAndSerialNumber",void 0);nu=_([te({type:J.Choice})],nu);class jd{constructor(e={}){this.version=Uo.v3,this.originator=new nu,this.keyEncryptionAlgorithm=new Vs,this.recipientEncryptedKeys=new Fm,Object.assign(this,e)}}_([$({type:F.Integer})],jd.prototype,"version",void 0);_([$({type:nu,context:0})],jd.prototype,"originator",void 0);_([$({type:Ye,context:1,optional:!0})],jd.prototype,"ukm",void 0);_([$({type:Vs})],jd.prototype,"keyEncryptionAlgorithm",void 0);_([$({type:Fm})],jd.prototype,"recipientEncryptedKeys",void 0);let bd=class{constructor(e={}){Object.assign(this,e)}};_([$({type:hc,context:0,implicit:!0})],bd.prototype,"subjectKeyIdentifier",void 0);_([$({type:Vd})],bd.prototype,"issuerAndSerialNumber",void 0);bd=_([te({type:J.Choice})],bd);class i0{constructor(e={}){this.version=Uo.v0,this.rid=new bd,this.keyEncryptionAlgorithm=new Vs,this.encryptedKey=new Ye,Object.assign(this,e)}}_([$({type:F.Integer})],i0.prototype,"version",void 0);_([$({type:bd})],i0.prototype,"rid",void 0);_([$({type:Vs})],i0.prototype,"keyEncryptionAlgorithm",void 0);_([$({type:Ye})],i0.prototype,"encryptedKey",void 0);class s0{constructor(e={}){this.keyIdentifier=new Ye,Object.assign(this,e)}}_([$({type:Ye})],s0.prototype,"keyIdentifier",void 0);_([$({type:F.GeneralizedTime,optional:!0})],s0.prototype,"date",void 0);_([$({type:E4,optional:!0})],s0.prototype,"other",void 0);class o0{constructor(e={}){this.version=Uo.v4,this.kekid=new s0,this.keyEncryptionAlgorithm=new Vs,this.encryptedKey=new Ye,Object.assign(this,e)}}_([$({type:F.Integer})],o0.prototype,"version",void 0);_([$({type:s0})],o0.prototype,"kekid",void 0);_([$({type:Vs})],o0.prototype,"keyEncryptionAlgorithm",void 0);_([$({type:Ye})],o0.prototype,"encryptedKey",void 0);class a0{constructor(e={}){this.version=Uo.v0,this.keyEncryptionAlgorithm=new Vs,this.encryptedKey=new Ye,Object.assign(this,e)}}_([$({type:F.Integer})],a0.prototype,"version",void 0);_([$({type:T7,context:0,optional:!0})],a0.prototype,"keyDerivationAlgorithm",void 0);_([$({type:Vs})],a0.prototype,"keyEncryptionAlgorithm",void 0);_([$({type:Ye})],a0.prototype,"encryptedKey",void 0);class hA{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],hA.prototype,"oriType",void 0);_([$({type:F.Any})],hA.prototype,"oriValue",void 0);let kc=class{constructor(e={}){Object.assign(this,e)}};_([$({type:i0,optional:!0})],kc.prototype,"ktri",void 0);_([$({type:jd,context:1,implicit:!0,optional:!0})],kc.prototype,"kari",void 0);_([$({type:o0,context:2,implicit:!0,optional:!0})],kc.prototype,"kekri",void 0);_([$({type:a0,context:3,implicit:!0,optional:!0})],kc.prototype,"pwri",void 0);_([$({type:hA,context:4,implicit:!0,optional:!0})],kc.prototype,"ori",void 0);kc=_([te({type:J.Choice})],kc);var F7;let zm=F7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,F7.prototype)}};zm=F7=_([te({type:J.Set,itemType:kc})],zm);var z7;class x4{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],x4.prototype,"otherRevInfoFormat",void 0);_([$({type:F.Any})],x4.prototype,"otherRevInfo",void 0);let Vm=class{constructor(e={}){this.other=new x4,Object.assign(this,e)}};_([$({type:x4,context:1,implicit:!0})],Vm.prototype,"other",void 0);Vm=_([te({type:J.Choice})],Vm);let Km=z7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,z7.prototype)}};Km=z7=_([te({type:J.Set,itemType:Vm})],Km);class dA{constructor(e={}){Object.assign(this,e)}}_([$({type:Um,context:0,implicit:!0,optional:!0})],dA.prototype,"certs",void 0);_([$({type:Km,context:1,implicit:!0,optional:!0})],dA.prototype,"crls",void 0);var V7;let K7=V7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,V7.prototype)}};K7=V7=_([te({type:J.Set,itemType:Kd})],K7);class c0{constructor(e={}){this.version=Uo.v0,this.recipientInfos=new zm,this.encryptedContentInfo=new n0,Object.assign(this,e)}}_([$({type:F.Integer})],c0.prototype,"version",void 0);_([$({type:dA,context:0,implicit:!0,optional:!0})],c0.prototype,"originatorInfo",void 0);_([$({type:zm})],c0.prototype,"recipientInfos",void 0);_([$({type:n0})],c0.prototype,"encryptedContentInfo",void 0);_([$({type:K7,context:1,implicit:!0,optional:!0})],c0.prototype,"unprotectedAttrs",void 0);const Vbe="1.2.840.113549.1.7.2";var H7;let Hm=H7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,H7.prototype)}};Hm=H7=_([te({type:J.Set,itemType:cp})],Hm);class qd{constructor(e={}){this.version=Uo.v0,this.digestAlgorithms=new Hm,this.encapContentInfo=new v4,this.signerInfos=new Rm,Object.assign(this,e)}}_([$({type:F.Integer})],qd.prototype,"version",void 0);_([$({type:Hm})],qd.prototype,"digestAlgorithms",void 0);_([$({type:v4})],qd.prototype,"encapContentInfo",void 0);_([$({type:Um,context:0,implicit:!0,optional:!0})],qd.prototype,"certificates",void 0);_([$({type:Km,context:1,implicit:!0,optional:!0})],qd.prototype,"crls",void 0);_([$({type:Rm})],qd.prototype,"signerInfos",void 0);const hp="1.2.840.10045.2.1",fA="1.2.840.10045.4.1",OH="1.2.840.10045.4.3.1",pA="1.2.840.10045.4.3.2",gA="1.2.840.10045.4.3.3",yA="1.2.840.10045.4.3.4",ZP="1.2.840.10045.3.1.7",eD="1.3.132.0.34",tD="1.3.132.0.35";function l0(r){return new ge({algorithm:r})}const Kbe=l0(fA);l0(OH);const Hbe=l0(pA),jbe=l0(gA),qbe=l0(yA);let dp=class{constructor(e={}){Object.assign(this,e)}};_([$({type:F.ObjectIdentifier})],dp.prototype,"fieldType",void 0);_([$({type:F.Any})],dp.prototype,"parameters",void 0);dp=_([te({type:J.Sequence})],dp);class Wbe extends Ye{}let vd=class{constructor(e={}){Object.assign(this,e)}};_([$({type:F.OctetString})],vd.prototype,"a",void 0);_([$({type:F.OctetString})],vd.prototype,"b",void 0);_([$({type:F.BitString,optional:!0})],vd.prototype,"seed",void 0);vd=_([te({type:J.Sequence})],vd);var j7;(function(r){r[r.ecpVer1=1]="ecpVer1"})(j7||(j7={}));let Fo=class{constructor(e={}){this.version=j7.ecpVer1,Object.assign(this,e)}};_([$({type:F.Integer})],Fo.prototype,"version",void 0);_([$({type:dp})],Fo.prototype,"fieldID",void 0);_([$({type:vd})],Fo.prototype,"curve",void 0);_([$({type:Wbe})],Fo.prototype,"base",void 0);_([$({type:F.Integer,converter:Ct})],Fo.prototype,"order",void 0);_([$({type:F.Integer,optional:!0})],Fo.prototype,"cofactor",void 0);Fo=_([te({type:J.Sequence})],Fo);let _c=class{constructor(e={}){Object.assign(this,e)}};_([$({type:F.ObjectIdentifier})],_c.prototype,"namedCurve",void 0);_([$({type:F.Null})],_c.prototype,"implicitCurve",void 0);_([$({type:Fo})],_c.prototype,"specifiedCurve",void 0);_c=_([te({type:J.Choice})],_c);class A4{constructor(e={}){this.version=1,this.privateKey=new Ye,Object.assign(this,e)}}_([$({type:F.Integer})],A4.prototype,"version",void 0);_([$({type:Ye})],A4.prototype,"privateKey",void 0);_([$({type:_c,context:0,optional:!0})],A4.prototype,"parameters",void 0);_([$({type:F.BitString,context:1,optional:!0})],A4.prototype,"publicKey",void 0);class jm{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.Integer,converter:Ct})],jm.prototype,"r",void 0);_([$({type:F.Integer,converter:Ct})],jm.prototype,"s",void 0);const Mn="1.2.840.113549.1.1",iu=`${Mn}.1`,Gbe=`${Mn}.7`,Qbe=`${Mn}.9`,g1=`${Mn}.10`,Ybe=`${Mn}.2`,Xbe=`${Mn}.4`,qm=`${Mn}.5`,Jbe=`${Mn}.14`,q7=`${Mn}.11`,Wm=`${Mn}.12`,Gm=`${Mn}.13`,RH=`${Mn}.15`,LH=`${Mn}.16`,Qm="1.3.14.3.2.26",BH="2.16.840.1.101.3.4.2.4",Ym="2.16.840.1.101.3.4.2.1",Xm="2.16.840.1.101.3.4.2.2",Jm="2.16.840.1.101.3.4.2.3",Zbe="2.16.840.1.101.3.4.2.5",eve="2.16.840.1.101.3.4.2.6",tve="1.2.840.113549.2.2",rve="1.2.840.113549.2.5",C4=`${Mn}.8`;function tr(r){return new ge({algorithm:r,parameters:null})}tr(tve);tr(rve);const su=tr(Qm);tr(BH);tr(Ym);tr(Xm);tr(Jm);tr(Zbe);tr(eve);const UH=new ge({algorithm:C4,parameters:oe.serialize(su)}),FH=new ge({algorithm:Qbe,parameters:oe.serialize(km.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))});tr(iu);tr(Ybe);tr(Xbe);tr(qm);tr(RH);tr(LH);tr(Wm);tr(Gm);tr(RH);tr(LH);class I4{constructor(e={}){this.hashAlgorithm=new ge(su),this.maskGenAlgorithm=new ge({algorithm:C4,parameters:oe.serialize(su)}),this.pSourceAlgorithm=new ge(FH),Object.assign(this,e)}}_([$({type:ge,context:0,defaultValue:su})],I4.prototype,"hashAlgorithm",void 0);_([$({type:ge,context:1,defaultValue:UH})],I4.prototype,"maskGenAlgorithm",void 0);_([$({type:ge,context:2,defaultValue:FH})],I4.prototype,"pSourceAlgorithm",void 0);new ge({algorithm:Gbe,parameters:oe.serialize(new I4)});class ou{constructor(e={}){this.hashAlgorithm=new ge(su),this.maskGenAlgorithm=new ge({algorithm:C4,parameters:oe.serialize(su)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}}_([$({type:ge,context:0,defaultValue:su})],ou.prototype,"hashAlgorithm",void 0);_([$({type:ge,context:1,defaultValue:UH})],ou.prototype,"maskGenAlgorithm",void 0);_([$({type:F.Integer,context:2,defaultValue:20})],ou.prototype,"saltLength",void 0);_([$({type:F.Integer,context:3,defaultValue:1})],ou.prototype,"trailerField",void 0);new ge({algorithm:g1,parameters:oe.serialize(new ou)});class k4{constructor(e={}){this.digestAlgorithm=new ge,this.digest=new Ye,Object.assign(this,e)}}_([$({type:ge})],k4.prototype,"digestAlgorithm",void 0);_([$({type:Ye})],k4.prototype,"digest",void 0);var W7;class _4{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.Integer,converter:Ct})],_4.prototype,"prime",void 0);_([$({type:F.Integer,converter:Ct})],_4.prototype,"exponent",void 0);_([$({type:F.Integer,converter:Ct})],_4.prototype,"coefficient",void 0);let G7=W7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,W7.prototype)}};G7=W7=_([te({type:J.Sequence,itemType:_4})],G7);class Gs{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.Integer})],Gs.prototype,"version",void 0);_([$({type:F.Integer,converter:Ct})],Gs.prototype,"modulus",void 0);_([$({type:F.Integer,converter:Ct})],Gs.prototype,"publicExponent",void 0);_([$({type:F.Integer,converter:Ct})],Gs.prototype,"privateExponent",void 0);_([$({type:F.Integer,converter:Ct})],Gs.prototype,"prime1",void 0);_([$({type:F.Integer,converter:Ct})],Gs.prototype,"prime2",void 0);_([$({type:F.Integer,converter:Ct})],Gs.prototype,"exponent1",void 0);_([$({type:F.Integer,converter:Ct})],Gs.prototype,"exponent2",void 0);_([$({type:F.Integer,converter:Ct})],Gs.prototype,"coefficient",void 0);_([$({type:G7,optional:!0})],Gs.prototype,"otherPrimeInfos",void 0);class mA{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.Integer,converter:Ct})],mA.prototype,"modulus",void 0);_([$({type:F.Integer,converter:Ct})],mA.prototype,"publicExponent",void 0);var Q7;(function(r){r[r.Transient=0]="Transient",r[r.Singleton=1]="Singleton",r[r.ResolutionScoped=2]="ResolutionScoped",r[r.ContainerScoped=3]="ContainerScoped"})(Q7||(Q7={}));const fn=Q7;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Y7=function(r,e){return Y7=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},Y7(r,e)};function wA(r,e){Y7(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function nve(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(h){try{l(n.next(h))}catch(d){o(d)}}function c(h){try{l(n.throw(h))}catch(d){o(d)}}function l(h){h.done?s(h.value):i(h.value).then(a,c)}l((n=n.apply(r,[])).next())})}function ive(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(h){return c([l,h])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(h){l=[6,h],i=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function gg(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Zm(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s}function cl(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(Zm(arguments[e]));return r}var sve="injectionTokens";function ove(r){var e=Reflect.getMetadata("design:paramtypes",r)||[],t=Reflect.getOwnMetadata(sve,r)||{};return Object.keys(t).forEach(function(n){e[+n]=t[n]}),e}function zH(r){return!!r.useClass}function X7(r){return!!r.useFactory}var VH=function(){function r(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return r.prototype.createProxy=function(e){var t=this,n={},i=!1,s,o=function(){return i||(s=e(t.wrap()),i=!0),s};return new Proxy(n,this.createHandler(o))},r.prototype.createHandler=function(e){var t={},n=function(i){t[i]=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];s[0]=e();var a=Reflect[i];return a.apply(void 0,cl(s))}};return this.reflectMethods.forEach(n),t},r}();function zu(r){return typeof r=="string"||typeof r=="symbol"}function ave(r){return typeof r=="object"&&"token"in r&&"multiple"in r}function rD(r){return typeof r=="object"&&"token"in r&&"transform"in r}function cve(r){return typeof r=="function"||r instanceof VH}function u2(r){return!!r.useToken}function h2(r){return r.useValue!=null}function lve(r){return zH(r)||h2(r)||u2(r)||X7(r)}var bA=function(){function r(){this._registryMap=new Map}return r.prototype.entries=function(){return this._registryMap.entries()},r.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},r.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},r.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},r.prototype.setAll=function(e,t){this._registryMap.set(e,t)},r.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},r.prototype.clear=function(){this._registryMap.clear()},r.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},r}(),uve=function(r){wA(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(bA),yg=function(){function r(){this.scopedResolutions=new Map}return r}();function hve(r,e){if(r===null)return"at position #"+e;var t=r.split(",")[e].trim();return'"'+t+'" at position #'+e}function dve(r,e,t){return t===void 0&&(t="    "),cl([r],e.message.split(`
`).map(function(n){return t+n})).join(`
`)}function fve(r,e,t){var n=Zm(r.toString().match(/constructor\(([\w, ]+)\)/)||[],2),i=n[1],s=i===void 0?null:i,o=hve(s,e);return dve("Cannot inject the dependency "+o+' of "'+r.name+'" constructor. Reason:',t)}function pve(r){if(typeof r.dispose!="function")return!1;var e=r.dispose;return!(e.length>0)}var gve=function(r){wA(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(bA),yve=function(r){wA(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(bA),mve=function(){function r(){this.preResolution=new gve,this.postResolution=new yve}return r}(),KH=new Map,wve=function(){function r(e){this.parent=e,this._registry=new uve,this.interceptors=new mve,this.disposed=!1,this.disposables=new Set}return r.prototype.register=function(e,t,n){n===void 0&&(n={lifecycle:fn.Transient}),this.ensureNotDisposed();var i;if(lve(t)?i=t:i={useClass:t},u2(i))for(var s=[e],o=i;o!=null;){var a=o.useToken;if(s.includes(a))throw new Error("Token registration cycle detected! "+cl(s,[a]).join(" -> "));s.push(a);var c=this._registry.get(a);c&&u2(c.provider)?o=c.provider:o=null}if((n.lifecycle===fn.Singleton||n.lifecycle==fn.ContainerScoped||n.lifecycle==fn.ResolutionScoped)&&(h2(i)||X7(i)))throw new Error('Cannot use lifecycle "'+fn[n.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:i,options:n}),this},r.prototype.registerType=function(e,t){return this.ensureNotDisposed(),zu(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},r.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},r.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),zu(e)){if(zu(t))return this.register(e,{useToken:t},{lifecycle:fn.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:fn.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var n=e;return t&&!zu(t)&&(n=t),this.register(e,{useClass:n},{lifecycle:fn.Singleton})},r.prototype.resolve=function(e,t,n){t===void 0&&(t=new yg),n===void 0&&(n=!1),this.ensureNotDisposed();var i=this.getRegistration(e);if(!i&&zu(e)){if(n)return;throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"Single"),i){var s=this.resolveRegistration(i,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}if(cve(e)){var s=this.construct(e,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},r.prototype.executePreResolutionInterceptor=function(e,t){var n,i;if(this.interceptors.preResolution.has(e)){var s=[];try{for(var o=gg(this.interceptors.preResolution.getAll(e)),a=o.next();!a.done;a=o.next()){var c=a.value;c.options.frequency!="Once"&&s.push(c),c.callback(e,t)}}catch(l){n={error:l}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}this.interceptors.preResolution.setAll(e,s)}},r.prototype.executePostResolutionInterceptor=function(e,t,n){var i,s;if(this.interceptors.postResolution.has(e)){var o=[];try{for(var a=gg(this.interceptors.postResolution.getAll(e)),c=a.next();!c.done;c=a.next()){var l=c.value;l.options.frequency!="Once"&&o.push(l),l.callback(e,t,n)}}catch(h){i={error:h}}finally{try{c&&!c.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}this.interceptors.postResolution.setAll(e,o)}},r.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===fn.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var n=e.options.lifecycle===fn.Singleton,i=e.options.lifecycle===fn.ContainerScoped,s=n||i,o;return h2(e.provider)?o=e.provider.useValue:u2(e.provider)?o=s?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):zH(e.provider)?o=s?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):X7(e.provider)?o=e.provider.useFactory(this):o=this.construct(e.provider,t),e.options.lifecycle===fn.ResolutionScoped&&t.scopedResolutions.set(e,o),o},r.prototype.resolveAll=function(e,t,n){var i=this;t===void 0&&(t=new yg),n===void 0&&(n=!1),this.ensureNotDisposed();var s=this.getAllRegistrations(e);if(!s&&zu(e)){if(n)return[];throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"All"),s){var o=s.map(function(c){return i.resolveRegistration(c,t)});return this.executePostResolutionInterceptor(e,o,"All"),o}var a=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,a,"All"),a},r.prototype.isRegistered=function(e,t){return t===void 0&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},r.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},r.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var n=gg(this._registry.entries()),i=n.next();!i.done;i=n.next()){var s=Zm(i.value,2),o=s[0],a=s[1];this._registry.setAll(o,a.filter(function(c){return!h2(c.provider)}).map(function(c){return c.instance=void 0,c}))}}catch(c){e={error:c}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},r.prototype.createChildContainer=function(){var e,t;this.ensureNotDisposed();var n=new r(this);try{for(var i=gg(this._registry.entries()),s=i.next();!s.done;s=i.next()){var o=Zm(s.value,2),a=o[0],c=o[1];c.some(function(l){var h=l.options;return h.lifecycle===fn.ContainerScoped})&&n._registry.setAll(a,c.map(function(l){return l.options.lifecycle===fn.ContainerScoped?{provider:l.provider,options:l.options}:l}))}}catch(l){e={error:l}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r.prototype.beforeResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:n})},r.prototype.afterResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:n})},r.prototype.dispose=function(){return nve(this,void 0,void 0,function(){var e;return ive(this,function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach(function(n){var i=n.dispose();i&&e.push(i)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},r.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},r.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},r.prototype.construct=function(e,t){var n=this;if(e instanceof VH)return e.createProxy(function(s){return n.resolve(s,t)});var i=function(){var s=KH.get(e);if(!s||s.length===0){if(e.length===0)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var o=s.map(n.resolveParams(t,e));return new(e.bind.apply(e,cl([void 0],o)))}();return pve(i)&&this.disposables.add(i),i},r.prototype.resolveParams=function(e,t){var n=this;return function(i,s){var o,a,c;try{return ave(i)?rD(i)?i.multiple?(o=n.resolve(i.transform)).transform.apply(o,cl([n.resolveAll(i.token,new yg,i.isOptional)],i.transformArgs)):(a=n.resolve(i.transform)).transform.apply(a,cl([n.resolve(i.token,e,i.isOptional)],i.transformArgs)):i.multiple?n.resolveAll(i.token,new yg,i.isOptional):n.resolve(i.token,e,i.isOptional):rD(i)?(c=n.resolve(i.transform,e)).transform.apply(c,cl([n.resolve(i.token,e)],i.transformArgs)):n.resolve(i,e)}catch(l){throw new Error(fve(t,s,l))}}},r.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},r}(),xr=new wve;function T4(r){return function(e){KH.set(e,ove(e))}}if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var J7;class P4{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}}_([$({type:F.ObjectIdentifier})],P4.prototype,"attrId",void 0);_([$({type:F.Any,repeated:"set"})],P4.prototype,"attrValues",void 0);let nD=J7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,J7.prototype)}};nD=J7=_([te({type:J.Sequence,itemType:P4})],nD);var Z7;let iD=Z7=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,Z7.prototype)}};iD=Z7=_([te({type:J.Sequence,itemType:Hd})],iD);class HH{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],HH.prototype,"certId",void 0);_([$({type:F.Any,context:0})],HH.prototype,"certValue",void 0);class jH{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],jH.prototype,"crlId",void 0);_([$({type:F.Any,context:0})],jH.prototype,"crltValue",void 0);class qH extends Ye{}let D4=class{constructor(e={}){this.encryptionAlgorithm=new ge,this.encryptedData=new qH,Object.assign(this,e)}};_([$({type:ge})],D4.prototype,"encryptionAlgorithm",void 0);_([$({type:qH})],D4.prototype,"encryptedData",void 0);var e9,t9;(function(r){r[r.v1=0]="v1"})(t9||(t9={}));class WH extends Ye{}let r9=e9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,e9.prototype)}};r9=e9=_([te({type:J.Sequence,itemType:Bo})],r9);class u0{constructor(e={}){this.version=t9.v1,this.privateKeyAlgorithm=new ge,this.privateKey=new WH,Object.assign(this,e)}}_([$({type:F.Integer})],u0.prototype,"version",void 0);_([$({type:ge})],u0.prototype,"privateKeyAlgorithm",void 0);_([$({type:WH})],u0.prototype,"privateKey",void 0);_([$({type:r9,implicit:!0,context:0,optional:!0})],u0.prototype,"attributes",void 0);let sD=class extends u0{};sD=_([te({type:J.Sequence})],sD);let oD=class extends D4{};oD=_([te({type:J.Sequence})],oD);class GH{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],GH.prototype,"secretTypeId",void 0);_([$({type:F.Any,context:0})],GH.prototype,"secretValue",void 0);class h0{constructor(e={}){this.mac=new k4,this.macSalt=new Ye,this.iterations=1,Object.assign(this,e)}}_([$({type:k4})],h0.prototype,"mac",void 0);_([$({type:Ye})],h0.prototype,"macSalt",void 0);_([$({type:F.Integer,defaultValue:1})],h0.prototype,"iterations",void 0);class $4{constructor(e={}){this.version=3,this.authSafe=new Hd,this.macData=new h0,Object.assign(this,e)}}_([$({type:F.Integer})],$4.prototype,"version",void 0);_([$({type:Hd})],$4.prototype,"authSafe",void 0);_([$({type:h0,optional:!0})],$4.prototype,"macData",void 0);var n9;class N4{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:F.ObjectIdentifier})],N4.prototype,"bagId",void 0);_([$({type:F.Any,context:0})],N4.prototype,"bagValue",void 0);_([$({type:P4,repeated:"set",optional:!0})],N4.prototype,"bagAttributes",void 0);let aD=n9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,n9.prototype)}};aD=n9=_([te({type:J.Sequence,itemType:N4})],aD);var i9,s9,o9;const QH="1.2.840.113549.1.9",YH=`${QH}.7`,vA=`${QH}.14`;let e3=class extends Sr{constructor(e={}){super(e)}toString(){return this.ia5String||super.toString()}};_([$({type:F.IA5String})],e3.prototype,"ia5String",void 0);e3=_([te({type:J.Choice})],e3);let cD=class extends Hd{};cD=_([te({type:J.Sequence})],cD);let lD=class extends $4{};lD=_([te({type:J.Sequence})],lD);let uD=class extends D4{};uD=_([te({type:J.Sequence})],uD);let a9=class{constructor(e=""){this.value=e}toString(){return this.value}};_([$({type:F.IA5String})],a9.prototype,"value",void 0);a9=_([te({type:J.Choice})],a9);let hD=class extends e3{};hD=_([te({type:J.Choice})],hD);let dD=class extends Sr{};dD=_([te({type:J.Choice})],dD);let c9=class{constructor(e=new Date){this.value=e}};_([$({type:F.GeneralizedTime})],c9.prototype,"value",void 0);c9=_([te({type:J.Choice})],c9);let fD=class extends Sr{};fD=_([te({type:J.Choice})],fD);let l9=class{constructor(e="M"){this.value=e}toString(){return this.value}};_([$({type:F.PrintableString})],l9.prototype,"value",void 0);l9=_([te({type:J.Choice})],l9);let t3=class{constructor(e=""){this.value=e}toString(){return this.value}};_([$({type:F.PrintableString})],t3.prototype,"value",void 0);t3=_([te({type:J.Choice})],t3);let pD=class extends t3{};pD=_([te({type:J.Choice})],pD);let gD=class extends Sr{};gD=_([te({type:J.Choice})],gD);let u9=class{constructor(e=""){this.value=e}toString(){return this.value}};_([$({type:F.ObjectIdentifier})],u9.prototype,"value",void 0);u9=_([te({type:J.Choice})],u9);let yD=class extends mr{};yD=_([te({type:J.Choice})],yD);let h9=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};_([$({type:F.Integer})],h9.prototype,"value",void 0);h9=_([te({type:J.Choice})],h9);let mD=class extends Ws{};mD=_([te({type:J.Sequence})],mD);let r3=class extends Sr{};r3=_([te({type:J.Choice})],r3);let wD=i9=class extends Ic{constructor(e){super(e),Object.setPrototypeOf(this,i9.prototype)}};wD=i9=_([te({type:J.Sequence})],wD);let bD=s9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,s9.prototype)}};bD=s9=_([te({type:J.Set,itemType:Kd})],bD);let d9=class{constructor(e=""){this.value=e}toString(){return this.value}};_([$({type:F.BmpString})],d9.prototype,"value",void 0);d9=_([te({type:J.Choice})],d9);let f9=class extends ge{};f9=_([te({type:J.Sequence})],f9);let vD=o9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,o9.prototype)}};vD=o9=_([te({type:J.Sequence,itemType:f9})],vD);var p9;let n3=p9=class extends at{constructor(e){super(e),Object.setPrototypeOf(this,p9.prototype)}};n3=p9=_([te({type:J.Sequence,itemType:Bo})],n3);class Wd{constructor(e={}){this.version=0,this.subject=new Ht,this.subjectPKInfo=new ts,this.attributes=new n3,Object.assign(this,e)}}_([$({type:F.Integer})],Wd.prototype,"version",void 0);_([$({type:Ht})],Wd.prototype,"subject",void 0);_([$({type:ts})],Wd.prototype,"subjectPKInfo",void 0);_([$({type:n3,implicit:!0,context:0})],Wd.prototype,"attributes",void 0);class fp{constructor(e={}){this.certificationRequestInfo=new Wd,this.signatureAlgorithm=new ge,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}_([$({type:Wd})],fp.prototype,"certificationRequestInfo",void 0);_([$({type:ge})],fp.prototype,"signatureAlgorithm",void 0);_([$({type:F.BitString})],fp.prototype,"signature",void 0);/*!
 * MIT License
 * 
 * Copyright (c) Peculiar Ventures. All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const d0="crypto.algorithm";class bve{getAlgorithms(){return xr.resolveAll(d0)}toAsnAlgorithm(e){({...e});for(const t of this.getAlgorithms()){const n=t.toAsnAlgorithm(e);if(n)return n}if(/^[0-9.]+$/.test(e.name)){const t=new ge({algorithm:e.name});if("parameters"in e){const n=e;t.parameters=n.parameters}return t}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(const n of this.getAlgorithms()){const i=n.toWebAlgorithm(e);if(i)return i}return{name:e.algorithm,parameters:e.parameters}}}const au="crypto.algorithmProvider";xr.registerSingleton(au,bve);var d2;const On="1.3.36.3.3.2.8.1.1",ED=`${On}.1`,SD=`${On}.2`,xD=`${On}.3`,AD=`${On}.4`,CD=`${On}.5`,ID=`${On}.6`,kD=`${On}.7`,_D=`${On}.8`,TD=`${On}.9`,PD=`${On}.10`,DD=`${On}.11`,$D=`${On}.12`,ND=`${On}.13`,MD=`${On}.14`,OD="brainpoolP160r1",RD="brainpoolP160t1",LD="brainpoolP192r1",BD="brainpoolP192t1",UD="brainpoolP224r1",FD="brainpoolP224t1",zD="brainpoolP256r1",VD="brainpoolP256t1",KD="brainpoolP320r1",HD="brainpoolP320t1",jD="brainpoolP384r1",qD="brainpoolP384t1",WD="brainpoolP512r1",GD="brainpoolP512t1",$t="ECDSA";let pp=d2=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case $t.toLowerCase():if("hash"in e)switch((typeof e.hash=="string"?e.hash:e.hash.name).toLowerCase()){case"sha-1":return Kbe;case"sha-256":return Hbe;case"sha-384":return jbe;case"sha-512":return qbe}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t=ZP;break;case"K-256":t=d2.SECP256K1;break;case"P-384":t=eD;break;case"P-521":t=tD;break;case OD:t=ED;break;case RD:t=SD;break;case LD:t=xD;break;case BD:t=AD;break;case UD:t=CD;break;case FD:t=ID;break;case zD:t=kD;break;case VD:t=_D;break;case KD:t=TD;break;case HD:t=PD;break;case jD:t=DD;break;case qD:t=$D;break;case WD:t=ND;break;case GD:t=MD;break}if(t)return new ge({algorithm:hp,parameters:oe.serialize(new _c({namedCurve:t}))})}}return null}toWebAlgorithm(e){switch(e.algorithm){case fA:return{name:$t,hash:{name:"SHA-1"}};case pA:return{name:$t,hash:{name:"SHA-256"}};case gA:return{name:$t,hash:{name:"SHA-384"}};case yA:return{name:$t,hash:{name:"SHA-512"}};case hp:{if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(oe.parse(e.parameters,_c).namedCurve){case ZP:return{name:$t,namedCurve:"P-256"};case d2.SECP256K1:return{name:$t,namedCurve:"K-256"};case eD:return{name:$t,namedCurve:"P-384"};case tD:return{name:$t,namedCurve:"P-521"};case ED:return{name:$t,namedCurve:OD};case SD:return{name:$t,namedCurve:RD};case xD:return{name:$t,namedCurve:LD};case AD:return{name:$t,namedCurve:BD};case CD:return{name:$t,namedCurve:UD};case ID:return{name:$t,namedCurve:FD};case kD:return{name:$t,namedCurve:zD};case _D:return{name:$t,namedCurve:VD};case TD:return{name:$t,namedCurve:KD};case PD:return{name:$t,namedCurve:HD};case DD:return{name:$t,namedCurve:jD};case $D:return{name:$t,namedCurve:qD};case ND:return{name:$t,namedCurve:WD};case MD:return{name:$t,namedCurve:GD}}}}return null}};pp.SECP256K1="1.3.132.0.10";pp=d2=_([T4()],pp);xr.registerSingleton(d0,pp);const XH=Symbol("name"),JH=Symbol("value");class tt{constructor(e,t={},n=""){this[XH]=e,this[JH]=n;for(const i in t)this[i]=t[i]}}tt.NAME=XH;tt.VALUE=JH;class vve{static toTextObject(e){const t=new tt("Algorithm Identifier",{},Bc.toString(e.algorithm));if(e.parameters)switch(e.algorithm){case hp:{const n=new pp().toWebAlgorithm(e);n&&"namedCurve"in n?t["Named Curve"]=n.namedCurve:t.Parameters=e.parameters;break}default:t.Parameters=e.parameters}return t}}class Bc{static toString(e){const t=this.items[e];return t||e}}Bc.items={[Qm]:"sha1",[BH]:"sha224",[Ym]:"sha256",[Xm]:"sha384",[Jm]:"sha512",[iu]:"rsaEncryption",[qm]:"sha1WithRSAEncryption",[Jbe]:"sha224WithRSAEncryption",[q7]:"sha256WithRSAEncryption",[Wm]:"sha384WithRSAEncryption",[Gm]:"sha512WithRSAEncryption",[hp]:"ecPublicKey",[fA]:"ecdsaWithSHA1",[OH]:"ecdsaWithSHA224",[pA]:"ecdsaWithSHA256",[gA]:"ecdsaWithSHA384",[yA]:"ecdsaWithSHA512",[Rbe]:"TLS WWW server authentication",[Lbe]:"TLS WWW client authentication",[Bbe]:"Code Signing",[Ube]:"E-mail Protection",[Fbe]:"Time Stamping",[zbe]:"OCSP Signing",[Vbe]:"Signed Data"};class cu{static serialize(e){return this.serializeObj(e).join(`
`)}static pad(e=0){return"".padStart(2*e," ")}static serializeObj(e,t=0){const n=[];let i=this.pad(t++),s="";const o=e[tt.VALUE];o&&(s=` ${o}`),n.push(`${i}${e[tt.NAME]}:${s}`),i=this.pad(t);for(const a in e){if(typeof a=="symbol")continue;const c=e[a],l=a?`${a}: `:"";if(typeof c=="string"||typeof c=="number"||typeof c=="boolean")n.push(`${i}${l}${c}`);else if(c instanceof Date)n.push(`${i}${l}${c.toUTCString()}`);else if(Array.isArray(c))for(const h of c)h[tt.NAME]=a,n.push(...this.serializeObj(h,t));else if(c instanceof tt)c[tt.NAME]=a,n.push(...this.serializeObj(c,t));else if(le.isBufferSource(c))a?(n.push(`${i}${l}`),n.push(...this.serializeBufferSource(c,t+1))):n.push(...this.serializeBufferSource(c,t));else if("toTextObject"in c){const h=c.toTextObject();h[tt.NAME]=a,n.push(...this.serializeObj(h,t))}else throw new TypeError("Cannot serialize data in text format. Unsupported type.")}return n}static serializeBufferSource(e,t=0){const n=this.pad(t),i=le.toUint8Array(e),s=[];for(let o=0;o<i.length;){const a=[];for(let c=0;c<16&&o<i.length;c++){c===8&&a.push("");const l=i[o++].toString(16).padStart(2,"0");a.push(l)}s.push(`${n}${a.join(" ")}`)}return s}static serializeAlgorithm(e){return this.algorithmSerializer.toTextObject(e)}}cu.oidSerializer=Bc;cu.algorithmSerializer=vve;class Uc{constructor(...e){if(e.length===1){const t=e[0];this.rawData=oe.serialize(t),this.onInit(t)}else{const t=oe.parse(e[0],e[1]);this.rawData=le.toArrayBuffer(e[0]),this.onInit(t)}}equal(e){return e instanceof Uc?hK(e.rawData,this.rawData):!1}toString(e="text"){switch(e){case"asn":return oe.toString(this.rawData);case"text":return cu.serialize(this.toTextObject());case"hex":return Ee.ToHex(this.rawData);case"base64":return Ee.ToBase64(this.rawData);case"base64url":return Ee.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){const e=this.toTextObjectEmpty();return e[""]=this.rawData,e}toTextObjectEmpty(e){return new tt(this.getTextName(),{},e)}}Uc.NAME="ASN";class Ri extends Uc{constructor(...e){let t;le.isBufferSource(e[0])?t=le.toArrayBuffer(e[0]):t=oe.serialize(new $i({extnID:e[0],critical:e[1],extnValue:new Ye(le.toArrayBuffer(e[2]))})),super(t,$i)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[tt.NAME]===Ri.NAME&&(e[tt.NAME]=Bc.toString(this.type)),e}}var ZH;class Ga{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&e.extractable!==void 0}constructor(){this.items=new Map,this[ZH]="CryptoProvider",typeof self<"u"&&typeof crypto<"u"?this.set(Ga.DEFAULT,crypto):typeof global<"u"&&global.crypto&&global.crypto.subtle&&this.set(Ga.DEFAULT,global.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,t){return this.items.forEach(e,t)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=Ga.DEFAULT){const t=this.items.get(e.toLowerCase());if(!t)throw new Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if(typeof e=="string"){if(!t)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),t)}else this.items.set(Ga.DEFAULT,e);return this}}ZH=Symbol.toStringTag;Ga.DEFAULT="default";const gr=new Ga,Eve=/^[0-2](?:\.[1-9][0-9]*)+$/;function Sve(r){return new RegExp(Eve).test(r)}class ej{constructor(e={}){this.items={};for(const t in e)this.register(t,e[t])}get(e){return this.items[e]||null}findId(e){return Sve(e)?e:this.get(e)}register(e,t){this.items[e]=t,this.items[t]=e}}const Nn=new ej;Nn.register("CN","2.5.4.3");Nn.register("L","2.5.4.7");Nn.register("ST","2.5.4.8");Nn.register("O","2.5.4.10");Nn.register("OU","2.5.4.11");Nn.register("C","2.5.4.6");Nn.register("DC","0.9.2342.19200300.100.1.25");Nn.register("E","1.2.840.113549.1.9.1");Nn.register("G","2.5.4.42");Nn.register("I","2.5.4.43");Nn.register("SN","2.5.4.4");Nn.register("T","2.5.4.12");function xve(r,e){return`\\${Ee.ToHex(Ee.FromUtf8String(e)).toUpperCase()}`}function Ave(r){return r.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,xve)}class Ci{static isASCII(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!1;return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,t={}){this.extraNames=new ej,this.asn=new Ht;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const i=t[n];this.extraNames.register(n,i)}typeof e=="string"?this.asn=this.fromString(e):e instanceof Ht?this.asn=e:le.isBufferSource(e)?this.asn=oe.parse(e,Ht):this.asn=this.fromJSON(e)}getField(e){const t=this.extraNames.findId(e)||Nn.findId(e),n=[];for(const i of this.asn)for(const s of i)s.type===t&&n.push(s.value.toString());return n}getName(e){return this.extraNames.get(e)||Nn.get(e)}toString(){return this.asn.map(e=>e.map(t=>{const n=this.getName(t.type)||t.type,i=t.value.anyValue?`#${Ee.ToHex(t.value.anyValue)}`:Ave(t.value.toString());return`${n}=${i}`}).join("+")).join(", ")}toJSON(){var e;const t=[];for(const n of this.asn){const i={};for(const s of n){const o=this.getName(s.type)||s.type;(e=i[o])!==null&&e!==void 0||(i[o]=[]),i[o].push(s.value.anyValue?`#${Ee.ToHex(s.value.anyValue)}`:s.value.toString())}t.push(i)}return t}fromString(e){const t=new Ht,n=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g;let i=null,s=",";for(;i=n.exec(`${e},`);){let[,o,a]=i;const c=a[a.length-1];(c===","||c==="+")&&(a=a.slice(0,a.length-1),i[3]=c);const l=i[3];o=this.getTypeOid(o);const h=this.createAttribute(o,a);s==="+"?t[t.length-1].push(h):t.push(new fd([h])),s=l}return t}fromJSON(e){const t=new Ht;for(const n of e){const i=new fd;for(const s in n){const o=this.getTypeOid(s),a=n[s];for(const c of a){const l=this.createAttribute(o,c);i.push(l)}}t.push(i)}return t}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,t){const n=new l4({type:e});if(typeof t=="object")for(const i in t)switch(i){case"ia5String":n.value.ia5String=t[i];break;case"utf8String":n.value.utf8String=t[i];break;case"universalString":n.value.universalString=t[i];break;case"bmpString":n.value.bmpString=t[i];break;case"printableString":n.value.printableString=t[i];break}else if(t[0]==="#")n.value.anyValue=Ee.FromHex(t.slice(1));else{const i=this.processStringValue(t);e===this.getName("E")||e===this.getName("DC")?n.value.ia5String=i:Ci.isPrintableString(i)?n.value.printableString=i:n.value.utf8String=i}return n}processStringValue(e){const t=/"(.*?[^\\])?"/.exec(e);return t&&(e=t[1]),e.replace(/\\0a/ig,`
`).replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return oe.serialize(this.asn)}async getThumbprint(...e){var t;let n,i="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(i=e[0]||i,n=e[1]||gr.get()):n=e[0]||gr.get(),await n.subtle.digest(i,this.toArrayBuffer())}}const tj="Cannot initialize GeneralName from ASN.1 data.",QD=`${tj} Unsupported string format in use.`,Cve=`${tj} Value doesn't match to GUID regular expression.`,YD=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,XD="1.3.6.1.4.1.311.25.1",JD="1.3.6.1.4.1.311.20.2.3",_5="dns",T5="dn",P5="email",D5="ip",$5="url",N5="guid",M5="upn",mg="id";class Qa extends Uc{constructor(...e){let t;if(e.length===2)switch(e[0]){case T5:{const n=new Ci(e[1]).toArrayBuffer(),i=oe.parse(n,Ht);t=new Re({directoryName:i});break}case _5:t=new Re({dNSName:e[1]});break;case P5:t=new Re({rfc822Name:e[1]});break;case N5:{const n=new RegExp(YD,"i").exec(e[1]);if(!n)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");const i=n.slice(1).map((s,o)=>o<3?Ee.ToHex(new Uint8Array(Ee.FromHex(s)).reverse()):s).join("");t=new Re({otherName:new ap({typeId:XD,value:oe.serialize(new Ye(Ee.FromHex(i)))})});break}case D5:t=new Re({iPAddress:e[1]});break;case mg:t=new Re({registeredID:e[1]});break;case M5:{t=new Re({otherName:new ap({typeId:JD,value:oe.serialize(wH.toASN(e[1]))})});break}case $5:t=new Re({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else le.isBufferSource(e[0])?t=oe.parse(e[0],Re):t=e[0];super(t)}onInit(e){if(e.dNSName!=null)this.type=_5,this.value=e.dNSName;else if(e.rfc822Name!=null)this.type=P5,this.value=e.rfc822Name;else if(e.iPAddress!=null)this.type=D5,this.value=e.iPAddress;else if(e.uniformResourceIdentifier!=null)this.type=$5,this.value=e.uniformResourceIdentifier;else if(e.registeredID!=null)this.type=mg,this.value=e.registeredID;else if(e.directoryName!=null)this.type=T5,this.value=new Ci(e.directoryName).toString();else if(e.otherName!=null)if(e.otherName.typeId===XD){this.type=N5;const t=oe.parse(e.otherName.value,Ye),n=new RegExp(YD,"i").exec(Ee.ToHex(t));if(!n)throw new Error(Cve);this.value=n.slice(1).map((i,s)=>s<3?Ee.ToHex(new Uint8Array(Ee.FromHex(i)).reverse()):i).join("-")}else if(e.otherName.typeId===JD)this.type=M5,this.value=oe.parse(e.otherName.value,Sr).toString();else throw new Error(QD);else throw new Error(QD)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case T5:case _5:case N5:case D5:case mg:case M5:case $5:e=this.type.toUpperCase();break;case P5:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let t=this.value;return this.type===mg&&(t=Bc.toString(t)),new tt(e,void 0,t)}}class gp extends Uc{constructor(e){let t;if(e instanceof an)t=e;else if(Array.isArray(e)){const n=[];for(const i of e)if(i instanceof Re)n.push(i);else{const s=oe.parse(new Qa(i.type,i.value).rawData,Re);n.push(s)}t=new an(n)}else if(le.isBufferSource(e))t=oe.parse(e,an);else throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(t)}onInit(e){const t=[];for(const n of e){let i=null;try{i=new Qa(n)}catch{continue}t.push(i)}this.items=t}toJSON(){return this.items.map(e=>e.toJSON())}toTextObject(){const e=super.toTextObjectEmpty();for(const t of this.items){const n=t.toTextObject();let i=e[n[tt.NAME]];Array.isArray(i)||(i=[],e[n[tt.NAME]]=i),i.push(n)}return e}}gp.NAME="GeneralNames";const y1="-{5}",yp="\\n",Ive=`[^${yp}]+`,kve=`${y1}BEGIN (${Ive}(?=${y1}))${y1}`,_ve=`${y1}END \\1${y1}`,Ed="\\n",Tve=`[^:${yp}]+`,Pve=`(?:[^${yp}]+${Ed}(?: +[^${yp}]+${Ed})*)`,Dve="[a-zA-Z0-9=+/]+",$ve=`(?:${Dve}${Ed})+`,ZD=`${kve}${Ed}(?:((?:${Tve}: ${Pve})+))?${Ed}?(${$ve})${_ve}`;class Wn{static isPem(e){return typeof e=="string"&&new RegExp(ZD,"g").test(e)}static decodeWithHeaders(e){e=e.replace(/\r/g,"");const t=new RegExp(ZD,"g"),n=[];let i=null;for(;i=t.exec(e);){const s=i[3].replace(new RegExp(`[${yp}]+`,"g"),""),o={type:i[1],headers:[],rawData:Ee.FromBase64(s)},a=i[2];if(a){const c=a.split(new RegExp(Ed,"g"));let l=null;for(const h of c){const[d,p]=h.split(/:(.*)/);if(p===void 0){if(!l)throw new Error("Cannot parse PEM string. Incorrect header value");l.value+=d.trim()}else l&&o.headers.push(l),l={key:d,value:p.trim()}}l&&o.headers.push(l)}n.push(o)}return n}static decode(e){return this.decodeWithHeaders(e).map(n=>n.rawData)}static decodeFirst(e){const t=this.decode(e);if(!t.length)throw new RangeError("PEM string doesn't contain any objects");return t[0]}static encode(e,t){if(Array.isArray(e)){const n=new Array;return t?e.forEach(i=>{if(!le.isBufferSource(i))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");n.push(this.encodeStruct({type:t,rawData:le.toArrayBuffer(i)}))}):e.forEach(i=>{if(!("type"in i))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");n.push(this.encodeStruct(i))}),n.join(`
`)}else{if(!t)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:t,rawData:le.toArrayBuffer(e)})}}static encodeStruct(e){var t;const n=e.type.toLocaleUpperCase(),i=[];if(i.push(`-----BEGIN ${n}-----`),!((t=e.headers)===null||t===void 0)&&t.length){for(const l of e.headers)i.push(`${l.key}: ${l.value}`);i.push("")}const s=Ee.ToBase64(e.rawData);let o,a=0;const c=Array();for(;a<s.length&&(s.length-a<64?o=s.substring(a):(o=s.substring(a,a+64),a+=64),o.length!==0);)if(c.push(o),o.length<64)break;return i.push(...c),i.push(`-----END ${n}-----`),i.join(`
`)}}Wn.CertificateTag="CERTIFICATE";Wn.CrlTag="CRL";Wn.CertificateRequestTag="CERTIFICATE REQUEST";Wn.PublicKeyTag="PUBLIC KEY";Wn.PrivateKeyTag="PRIVATE KEY";class zo extends Uc{static isAsnEncoded(e){return le.isBufferSource(e)||typeof e=="string"}static toArrayBuffer(e){if(typeof e=="string"){if(Wn.isPem(e))return Wn.decode(e)[0];if(Ee.isHex(e))return Ee.FromHex(e);if(Ee.isBase64(e))return Ee.FromBase64(e);if(Ee.isBase64Url(e))return Ee.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}else{const t=Ee.ToBinary(e);return Wn.isPem(t)?Wn.decode(t)[0]:Ee.isHex(t)?Ee.FromHex(t):Ee.isBase64(t)?Ee.FromBase64(t):Ee.isBase64Url(t)?Ee.FromBase64Url(t):le.toArrayBuffer(e)}}constructor(...e){zo.isAsnEncoded(e[0])?super(zo.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){switch(e){case"pem":return Wn.encode(this.rawData,this.tag);default:return super.toString(e)}}}class os extends zo{static async create(e,t=gr.get()){if(e instanceof os)return e;if(Ga.isCryptoKey(e)){if(e.type!=="public")throw new TypeError("Public key is required");const n=await t.subtle.exportKey("spki",e);return new os(n)}else{if(e.publicKey)return e.publicKey;if(le.isBufferSource(e))return new os(e);throw new TypeError("Unsupported PublicKeyType")}}constructor(e){zo.isAsnEncoded(e)?super(e,ts):super(e),this.tag=Wn.PublicKeyTag}async export(...e){let t,n=["verify"],i={hash:"SHA-256",...this.algorithm};e.length>1?(i=e[0]||i,n=e[1]||n,t=e[2]||gr.get()):t=e[0]||gr.get();let s=this.rawData;const o=oe.parse(this.rawData,ts);return o.algorithm.algorithm===g1&&(s=Nve(o,s)),t.subtle.importKey("spki",s,i,!0,n)}onInit(e){const t=xr.resolve(au),n=this.algorithm=t.toWebAlgorithm(e.algorithm);switch(e.algorithm.algorithm){case iu:{const i=oe.parse(e.subjectPublicKey,mA),s=le.toUint8Array(i.modulus);n.publicExponent=le.toUint8Array(i.publicExponent),n.modulusLength=(s[0]?s:s.slice(1)).byteLength<<3;break}}}async getThumbprint(...e){var t;let n,i="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(i=e[0]||i,n=e[1]||gr.get()):n=e[0]||gr.get(),await n.subtle.digest(i,this.rawData)}async getKeyIdentifier(...e){let t,n="SHA-1";e.length===1?typeof e[0]=="string"?(n=e[0],t=gr.get()):t=e[0]:e.length===2?(n=e[0],t=e[1]):t=gr.get();const i=oe.parse(this.rawData,ts);return await t.subtle.digest(n,i.subjectPublicKey)}toTextObject(){const e=this.toTextObjectEmpty(),t=oe.parse(this.rawData,ts);switch(e.Algorithm=cu.serializeAlgorithm(t.algorithm),t.algorithm.algorithm){case hp:e["EC Point"]=t.subjectPublicKey;break;case iu:default:e["Raw Data"]=t.subjectPublicKey}return e}}function Nve(r,e){return r.algorithm=new ge({algorithm:iu,parameters:null}),e=oe.serialize(r),e}class mp extends Ri{static async create(e,t=!1,n=gr.get()){if("name"in e&&"serialNumber"in e)return new mp(e,t);const s=await(await os.create(e,n)).getKeyIdentifier(n);return new mp(Ee.ToHex(s),t)}constructor(...e){if(le.isBufferSource(e[0]))super(e[0]);else if(typeof e[0]=="string"){const t=new ml({keyIdentifier:new Jx(Ee.FromHex(e[0]))});super(u7,e[1],oe.serialize(t))}else{const t=e[0],n=t.name instanceof gp?oe.parse(t.name.rawData,an):t.name,i=new ml({authorityCertIssuer:n,authorityCertSerialNumber:Ee.FromHex(t.serialNumber)});super(u7,e[1],oe.serialize(i))}}onInit(e){super.onInit(e);const t=oe.parse(e.extnValue,ml);t.keyIdentifier&&(this.keyId=Ee.ToHex(t.keyIdentifier)),(t.authorityCertIssuer||t.authorityCertSerialNumber)&&(this.certId={name:t.authorityCertIssuer||[],serialNumber:t.authorityCertSerialNumber?Ee.ToHex(t.authorityCertSerialNumber):""})}toTextObject(){const e=this.toTextObjectWithoutValue(),t=oe.parse(this.value,ml);return t.authorityCertIssuer&&(e["Authority Issuer"]=new gp(t.authorityCertIssuer).toTextObject()),t.authorityCertSerialNumber&&(e["Authority Serial Number"]=t.authorityCertSerialNumber),t.keyIdentifier&&(e[""]=t.keyIdentifier),e}}mp.NAME="Authority Key Identifier";class EA extends Ri{constructor(...e){if(le.isBufferSource(e[0])){super(e[0]);const t=oe.parse(this.value,_m);this.ca=t.cA,this.pathLength=t.pathLenConstraint}else{const t=new _m({cA:e[0],pathLenConstraint:e[1]});super(vH,e[2],oe.serialize(t)),this.ca=e[0],this.pathLength=e[1]}}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ca&&(e.CA=this.ca),this.pathLength!==void 0&&(e["Path Length"]=this.pathLength),e}}EA.NAME="Basic Constraints";var e$;(function(r){r.serverAuth="1.3.6.1.5.5.7.3.1",r.clientAuth="1.3.6.1.5.5.7.3.2",r.codeSigning="1.3.6.1.5.5.7.3.3",r.emailProtection="1.3.6.1.5.5.7.3.4",r.timeStamping="1.3.6.1.5.5.7.3.8",r.ocspSigning="1.3.6.1.5.5.7.3.9"})(e$||(e$={}));class rj extends Ri{constructor(...e){if(le.isBufferSource(e[0])){super(e[0]);const t=oe.parse(this.value,$m);this.usages=t.map(n=>n)}else{const t=new $m(e[0]);super(xH,e[1],oe.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.usages.map(t=>Bc.toString(t)).join(", "),e}}rj.NAME="Extended Key Usages";var t$;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(t$||(t$={}));class nj extends Ri{constructor(...e){if(le.isBufferSource(e[0])){super(e[0]);const t=oe.parse(this.value,k5);this.usages=t.toNumber()}else{const t=new k5(e[0]);super(AH,e[1],oe.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=oe.parse(this.value,k5);return e[""]=t.toJSON().join(", "),e}}nj.NAME="Key Usages";class M4 extends Ri{static async create(e,t=!1,n=gr.get()){const s=await(await os.create(e,n)).getKeyIdentifier(n);return new M4(Ee.ToHex(s),t)}constructor(...e){if(le.isBufferSource(e[0])){super(e[0]);const t=oe.parse(this.value,hc);this.keyId=Ee.ToHex(t)}else{const t=typeof e[0]=="string"?Ee.FromHex(e[0]):e[0],n=new hc(t);super(_H,e[1],oe.serialize(n)),this.keyId=Ee.ToHex(t)}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=oe.parse(this.value,hc);return e[""]=t,e}}M4.NAME="Subject Key Identifier";class ij extends Ri{constructor(...e){le.isBufferSource(e[0])?super(e[0]):super(kH,e[1],new gp(e[0]||[]).rawData)}onInit(e){super.onInit(e);const t=oe.parse(e.extnValue,C7);this.names=new gp(t)}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.names.toTextObject();for(const n in t)e[n]=t[n];return e}}ij.NAME="Subject Alternative Name";class Li{static register(e,t){this.items.set(e,t)}static create(e){const t=new Ri(e),n=this.items.get(t.type);return n?new n(e):t}}Li.items=new Map;class sj extends Ri{constructor(...e){var t;if(le.isBufferSource(e[0])){super(e[0]);const n=oe.parse(this.value,Pm);this.policies=n.map(i=>i.policyIdentifier)}else{const n=e[0],i=(t=e[1])!==null&&t!==void 0?t:!1,s=new Pm(n.map(o=>new h4({policyIdentifier:o})));super(EH,i,oe.serialize(s)),this.policies=n}}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Policy=this.policies.map(t=>new tt("",{},Bc.toString(t))),e}}sj.NAME="Certificate Policies";Li.register(EH,sj);class oj extends Ri{constructor(...e){var t;if(le.isBufferSource(e[0]))super(e[0]);else if(Array.isArray(e[0])&&typeof e[0][0]=="string"){const i=e[0].map(o=>new zd({distributionPoint:new eu({fullName:[new Re({uniformResourceIdentifier:o})]})})),s=new Eh(i);super(g7,e[1],oe.serialize(s))}else{const n=new Eh(e[0]);super(g7,e[1],oe.serialize(n))}(t=this.distributionPoints)!==null&&t!==void 0||(this.distributionPoints=[])}onInit(e){super.onInit(e);const t=oe.parse(e.extnValue,Eh);this.distributionPoints=t}toTextObject(){const e=this.toTextObjectWithoutValue();return e["Distribution Point"]=this.distributionPoints.map(t=>{var n;const i={};return t.distributionPoint&&(i[""]=(n=t.distributionPoint.fullName)===null||n===void 0?void 0:n.map(s=>new Qa(s).toString()).join(", ")),t.reasons&&(i.Reasons=t.reasons.toString()),t.cRLIssuer&&(i["CRL Issuer"]=t.cRLIssuer.map(s=>s.toString()).join(", ")),i}),e}}oj.NAME="CRL Distribution Points";class aj extends Ri{constructor(...e){var t,n,i,s;if(le.isBufferSource(e[0]))super(e[0]);else if(e[0]instanceof rh){const o=new rh(e[0]);super(l7,e[1],oe.serialize(o))}else{const o=e[0],a=new rh;bg(a,o,BP,"ocsp"),bg(a,o,UP,"caIssuers"),bg(a,o,FP,"timeStamping"),bg(a,o,zP,"caRepository"),super(l7,e[1],oe.serialize(a))}(t=this.ocsp)!==null&&t!==void 0||(this.ocsp=[]),(n=this.caIssuers)!==null&&n!==void 0||(this.caIssuers=[]),(i=this.timeStamping)!==null&&i!==void 0||(this.timeStamping=[]),(s=this.caRepository)!==null&&s!==void 0||(this.caRepository=[])}onInit(e){super.onInit(e),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],oe.parse(e.extnValue,rh).forEach(n=>{switch(n.accessMethod){case BP:this.ocsp.push(new Qa(n.accessLocation));break;case UP:this.caIssuers.push(new Qa(n.accessLocation));break;case FP:this.timeStamping.push(new Qa(n.accessLocation));break;case zP:this.caRepository.push(new Qa(n.accessLocation));break}})}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ocsp.length&&wg(e,"OCSP",this.ocsp),this.caIssuers.length&&wg(e,"CA Issuers",this.caIssuers),this.timeStamping.length&&wg(e,"Time Stamping",this.timeStamping),this.caRepository.length&&wg(e,"CA Repository",this.caRepository),e}}aj.NAME="Authority Info Access";function wg(r,e,t){if(t.length===1)r[e]=t[0].toTextObject();else{const n=new tt("");t.forEach((i,s)=>{const o=i.toTextObject(),a=`${o[tt.NAME]} ${s+1}`;let c=n[a];Array.isArray(c)||(c=[],n[a]=c),c.push(o)}),r[e]=n}}function bg(r,e,t,n){const i=e[n];i&&(Array.isArray(i)?i:[i]).forEach(o=>{typeof o=="string"&&(o=new Qa("url",o)),r.push(new e0({accessMethod:t,accessLocation:oe.parse(o.rawData,Re)}))})}class Gd extends Uc{constructor(...e){let t;if(le.isBufferSource(e[0]))t=le.toArrayBuffer(e[0]);else{const n=e[0],i=Array.isArray(e[1])?e[1].map(s=>le.toArrayBuffer(s)):[];t=oe.serialize(new Bo({type:n,values:i}))}super(t,Bo)}onInit(e){this.type=e.type,this.values=e.values}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Value=this.values.map(t=>new tt("",{"":t})),e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty();return e[tt.NAME]===Gd.NAME&&(e[tt.NAME]=Bc.toString(this.type)),e}}Gd.NAME="Attribute";class cj extends Gd{constructor(...e){var t;if(le.isBufferSource(e[0]))super(e[0]);else{const n=new r3({printableString:e[0]});super(YH,[oe.serialize(n)])}(t=this.password)!==null&&t!==void 0||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){const t=oe.parse(this.values[0],r3);this.password=t.toString()}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[tt.VALUE]=this.password,e}}cj.NAME="Challenge Password";class SA extends Gd{constructor(...e){var t;if(le.isBufferSource(e[0]))super(e[0]);else{const n=e[0],i=new Ic;for(const s of n)i.push(oe.parse(s.rawData,$i));super(vA,[oe.serialize(i)])}(t=this.items)!==null&&t!==void 0||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){const t=oe.parse(this.values[0],Ic);this.items=t.map(n=>Li.create(oe.serialize(n)))}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.items.map(n=>n.toTextObject());for(const n of t)e[n[tt.NAME]]=n;return e}}SA.NAME="Extensions";class O4{static register(e,t){this.items.set(e,t)}static create(e){const t=new Gd(e),n=this.items.get(t.type);return n?new n(e):t}}O4.items=new Map;const f0="crypto.signatureFormatter";class Mve{toAsnSignature(e,t){return le.toArrayBuffer(t)}toWebSignature(e,t){return le.toArrayBuffer(t)}}var f2;let g9=f2=class{static createPssParams(e,t){const n=f2.getHashAlgorithm(e);return n?new ou({hashAlgorithm:n,maskGenAlgorithm:new ge({algorithm:C4,parameters:oe.serialize(n)}),saltLength:t}):null}static getHashAlgorithm(e){const t=xr.resolve(au);return typeof e=="string"?t.toAsnAlgorithm({name:e}):typeof e=="object"&&e&&"name"in e?t.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if("hash"in e){let t;if(typeof e.hash=="string")t=e.hash;else if(e.hash&&typeof e.hash=="object"&&"name"in e.hash&&typeof e.hash.name=="string")t=e.hash.name.toUpperCase();else throw new Error("Cannot get hash algorithm name");switch(t.toLowerCase()){case"sha-1":return new ge({algorithm:qm,parameters:null});case"sha-256":return new ge({algorithm:q7,parameters:null});case"sha-384":return new ge({algorithm:Wm,parameters:null});case"sha-512":return new ge({algorithm:Gm,parameters:null})}}else return new ge({algorithm:iu,parameters:null});break;case"rsa-pss":if("hash"in e){if(!("saltLength"in e&&typeof e.saltLength=="number"))throw new Error("Cannot get 'saltLength' from 'alg' argument");const t=f2.createPssParams(e.hash,e.saltLength);if(!t)throw new Error("Cannot create PSS parameters");return new ge({algorithm:g1,parameters:oe.serialize(t)})}else return new ge({algorithm:g1,parameters:null})}return null}toWebAlgorithm(e){switch(e.algorithm){case iu:return{name:"RSASSA-PKCS1-v1_5"};case qm:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case q7:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case Wm:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case Gm:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case g1:if(e.parameters){const t=oe.parse(e.parameters,ou);return{name:"RSA-PSS",hash:xr.resolve(au).toWebAlgorithm(t.hashAlgorithm),saltLength:t.saltLength}}else return{name:"RSA-PSS"}}return null}};g9=f2=_([T4()],g9);xr.registerSingleton(d0,g9);let y9=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new ge({algorithm:Qm});case"sha-256":return new ge({algorithm:Ym});case"sha-384":return new ge({algorithm:Xm});case"sha-512":return new ge({algorithm:Jm})}return null}toWebAlgorithm(e){switch(e.algorithm){case Qm:return{name:"SHA-1"};case Ym:return{name:"SHA-256"};case Xm:return{name:"SHA-384"};case Jm:return{name:"SHA-512"}}return null}};y9=_([T4()],y9);xr.registerSingleton(d0,y9);class Ii{addPadding(e,t){const n=le.toUint8Array(t),i=new Uint8Array(e);return i.set(n,e-n.length),i}removePadding(e,t=!1){let n=le.toUint8Array(e);for(let i=0;i<n.length;i++)if(n[i]){n=n.slice(i);break}if(t&&n[0]>127){const i=new Uint8Array(n.length+1);return i.set(n,1),i.buffer}return n.buffer}toAsnSignature(e,t){if(e.name==="ECDSA"){const n=e.namedCurve,i=Ii.namedCurveSize.get(n)||Ii.defaultNamedCurveSize,s=new jm,o=le.toUint8Array(t);return s.r=this.removePadding(o.slice(0,i),!0),s.s=this.removePadding(o.slice(i,i+i),!0),oe.serialize(s)}return null}toWebSignature(e,t){if(e.name==="ECDSA"){const n=oe.parse(t,jm),i=e.namedCurve,s=Ii.namedCurveSize.get(i)||Ii.defaultNamedCurveSize,o=this.addPadding(s,this.removePadding(n.r)),a=this.addPadding(s,this.removePadding(n.s));return S5e(o,a)}return null}}Ii.namedCurveSize=new Map;Ii.defaultNamedCurveSize=32;const O5="1.3.101.110",r$="1.3.101.111",R5="1.3.101.112",n$="1.3.101.113";let m9=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"ed25519":t=R5;break;case"x25519":t=O5;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t=R5;break;case"ed448":t=n$;break}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t=O5;break;case"x448":t=r$;break}}return t?new ge({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case R5:return{name:"Ed25519"};case n$:return{name:"EdDSA",namedCurve:"Ed448"};case O5:return{name:"X25519"};case r$:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};m9=_([T4()],m9);xr.registerSingleton(d0,m9);class Ove extends zo{constructor(e){zo.isAsnEncoded(e)?super(e,fp):super(e),this.tag=Wn.CertificateRequestTag}onInit(e){this.tbs=oe.serialize(e.certificationRequestInfo),this.publicKey=new os(e.certificationRequestInfo.subjectPKInfo);const t=xr.resolve(au);this.signatureAlgorithm=t.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signature,this.attributes=e.certificationRequestInfo.attributes.map(i=>O4.create(oe.serialize(i)));const n=this.getAttribute(vA);this.extensions=[],n instanceof SA&&(this.extensions=n.items),this.subjectName=new Ci(e.certificationRequestInfo.subject),this.subject=this.subjectName.toString()}getAttribute(e){for(const t of this.attributes)if(t.type===e)return t;return null}getAttributes(e){return this.attributes.filter(t=>t.type===e)}getExtension(e){for(const t of this.extensions)if(t.type===e)return t;return null}getExtensions(e){return this.extensions.filter(t=>t.type===e)}async verify(e=gr.get()){const t={...this.publicKey.algorithm,...this.signatureAlgorithm},n=await this.publicKey.export(t,["verify"],e),i=xr.resolveAll(f0).reverse();let s=null;for(const a of i)if(s=a.toWebSignature(t,this.signature),s)break;if(!s)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await e.subtle.verify(this.signatureAlgorithm,n,s,this.tbs)}toTextObject(){const e=this.toTextObjectEmpty(),t=oe.parse(this.rawData,fp),n=t.certificationRequestInfo,i=new tt("",{Version:`${tu[n.version]} (${n.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){const s=new tt("");for(const o of this.attributes){const a=o.toTextObject();s[a[tt.NAME]]=a}i.Attributes=s}return e.Data=i,e.Signature=new tt("",{Algorithm:cu.serializeAlgorithm(t.signatureAlgorithm),"":t.signature}),e}}Ove.NAME="PKCS#10 Certificate Request";class xA extends zo{constructor(e){zo.isAsnEncoded(e)?super(e,ru):super(e),this.tag=Wn.CertificateTag}onInit(e){const t=e.tbsCertificate;this.tbs=oe.serialize(t),this.serialNumber=Ee.ToHex(t.serialNumber),this.subjectName=new Ci(t.subject),this.subject=new Ci(t.subject).toString(),this.issuerName=new Ci(t.issuer),this.issuer=this.issuerName.toString();const n=xr.resolve(au);this.signatureAlgorithm=n.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signatureValue;const i=t.validity.notBefore.utcTime||t.validity.notBefore.generalTime;if(!i)throw new Error("Cannot get 'notBefore' value");this.notBefore=i;const s=t.validity.notAfter.utcTime||t.validity.notAfter.generalTime;if(!s)throw new Error("Cannot get 'notAfter' value");this.notAfter=s,this.extensions=[],t.extensions&&(this.extensions=t.extensions.map(o=>Li.create(oe.serialize(o)))),this.publicKey=new os(t.subjectPublicKeyInfo)}getExtension(e){for(const t of this.extensions)if(typeof e=="string"){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter(t=>typeof e=="string"?t.type===e:t instanceof e)}async verify(e={},t=gr.get()){let n,i;const s=e.publicKey;try{if(!s)n={...this.publicKey.algorithm,...this.signatureAlgorithm},i=await this.publicKey.export(n,["verify"],t);else if("publicKey"in s)n={...s.publicKey.algorithm,...this.signatureAlgorithm},i=await s.publicKey.export(n,["verify"],t);else if(s instanceof os)n={...s.algorithm,...this.signatureAlgorithm},i=await s.export(n,["verify"],t);else if(le.isBufferSource(s)){const l=new os(s);n={...l.algorithm,...this.signatureAlgorithm},i=await l.export(n,["verify"],t)}else n={...s.algorithm,...this.signatureAlgorithm},i=s}catch{return!1}const o=xr.resolveAll(f0).reverse();let a=null;for(const l of o)if(a=l.toWebSignature(n,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");const c=await t.subtle.verify(this.signatureAlgorithm,i,a,this.tbs);if(e.signatureOnly)return c;{const h=(e.date||new Date).getTime();return c&&this.notBefore.getTime()<h&&h<this.notAfter.getTime()}}async getThumbprint(...e){let t,n="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(n=e[0]||n,t=e[1])),t??(t=gr.get()),await t.subtle.digest(n,this.rawData)}async isSelfSigned(e=gr.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},e)}toTextObject(){const e=this.toTextObjectEmpty(),t=oe.parse(this.rawData,ru),n=t.tbsCertificate,i=new tt("",{Version:`${tu[n.version]} (${n.version})`,"Serial Number":n.serialNumber,"Signature Algorithm":cu.serializeAlgorithm(n.signature),Issuer:this.issuer,Validity:new tt("",{"Not Before":n.validity.notBefore.getTime(),"Not After":n.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(n.issuerUniqueID&&(i["Issuer Unique ID"]=n.issuerUniqueID),n.subjectUniqueID&&(i["Subject Unique ID"]=n.subjectUniqueID),this.extensions.length){const s=new tt("");for(const o of this.extensions){const a=o.toTextObject();s[a[tt.NAME]]=a}i.Extensions=s}return e.Data=i,e.Signature=new tt("",{Algorithm:cu.serializeAlgorithm(t.signatureAlgorithm),"":t.signatureValue}),e}}xA.NAME="Certificate";class Rve{static async createSelfSigned(e,t=gr.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},t)}static async create(e,t=gr.get()){var n;let i;e.publicKey instanceof os?i=e.publicKey.rawData:"publicKey"in e.publicKey?i=e.publicKey.publicKey.rawData:le.isBufferSource(e.publicKey)?i=e.publicKey:i=await t.subtle.exportKey("spki",e.publicKey);const s=e.serialNumber?le.toUint8Array(Ee.FromHex(e.serialNumber)):t.getRandomValues(new Uint8Array(16));s[0]>127&&(s[0]&=127),s.length>1&&s[0]===0&&(s[1]|=128);const o=e.notBefore||new Date,a=e.notAfter||new Date(o.getTime()+31536e6),c=new ru({tbsCertificate:new ci({version:tu.v3,serialNumber:s,validity:new t0({notBefore:o,notAfter:a}),extensions:new Ic(((n=e.extensions)===null||n===void 0?void 0:n.map(v=>oe.parse(v.rawData,$i)))||[]),subjectPublicKeyInfo:oe.parse(i,ts)})});if(e.subject){const v=e.subject instanceof Ci?e.subject:new Ci(e.subject);c.tbsCertificate.subject=oe.parse(v.toArrayBuffer(),Ht)}if(e.issuer){const v=e.issuer instanceof Ci?e.issuer:new Ci(e.issuer);c.tbsCertificate.issuer=oe.parse(v.toArrayBuffer(),Ht)}const l={hash:"SHA-256"},h="signingKey"in e?{...l,...e.signingAlgorithm,...e.signingKey.algorithm}:{...l,...e.signingAlgorithm},d=xr.resolve(au);c.tbsCertificate.signature=c.signatureAlgorithm=d.toAsnAlgorithm(h);const p=oe.serialize(c.tbsCertificate),m="signingKey"in e?await t.subtle.sign(h,e.signingKey,p):e.signature,f=xr.resolveAll(f0).reverse();let g=null;for(const v of f)if(g=v.toAsnSignature(h,m),g)break;if(!g)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return c.signatureValue=g,new xA(oe.serialize(c))}}var i$;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(i$||(i$={}));Li.register(vH,EA);Li.register(xH,rj);Li.register(AH,nj);Li.register(_H,M4);Li.register(u7,mp);Li.register(kH,ij);Li.register(g7,oj);Li.register(l7,aj);O4.register(YH,cj);O4.register(vA,SA);xr.registerSingleton(f0,Mve);xr.registerSingleton(f0,Ii);Ii.namedCurveSize.set("P-256",32);Ii.namedCurveSize.set("K-256",32);Ii.namedCurveSize.set("P-384",48);Ii.namedCurveSize.set("P-521",66);function lj(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Lve(r){return new TextEncoder().encode(r)}function Bve(r){return new TextDecoder().decode(r)}function Uve(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var Fve=Uve,zve=Fve;let Vve=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Kve=class{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return uj(this,e)}},Hve=class{constructor(e){u(this,"decoders");this.decoders=e}or(e){return uj(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function uj(r,e){return new Hve({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let jve=class{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Vve(e,t,n),this.decoder=new Kve(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function R4({name:r,prefix:e,encode:t,decode:n}){return new jve(r,e,t,n)}function p0({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=zve(t,r);return R4({prefix:e,name:r,encode:n,decode:s=>lj(i(s))})}function qve(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Wve(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Ir({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return R4({prefix:e,name:r,encode(i){return Wve(i,n,t)},decode(i){return qve(i,n,t,r)}})}const Gve=Ir({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Qve=Ir({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),AA=Ir({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Yve=Ir({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Xve=Object.freeze(Object.defineProperty({__proto__:null,base64:Gve,base64pad:Qve,base64url:AA,base64urlpad:Yve},Symbol.toStringTag,{value:"Module"}));var Jve=hj,s$=128,Zve=-128,e7e=Math.pow(2,31);function hj(r,e,t){e=e||[],t=t||0;for(var n=t;r>=e7e;)e[t++]=r&255|s$,r/=128;for(;r&Zve;)e[t++]=r&255|s$,r>>>=7;return e[t]=r|0,hj.bytes=t-n+1,e}var t7e=w9,r7e=128,o$=127;function w9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw w9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&o$)<<i:(o&o$)*Math.pow(2,i),i+=7}while(o>=r7e);return w9.bytes=s-n,t}var n7e=Math.pow(2,7),i7e=Math.pow(2,14),s7e=Math.pow(2,21),o7e=Math.pow(2,28),a7e=Math.pow(2,35),c7e=Math.pow(2,42),l7e=Math.pow(2,49),u7e=Math.pow(2,56),h7e=Math.pow(2,63),d7e=function(r){return r<n7e?1:r<i7e?2:r<s7e?3:r<o7e?4:r<a7e?5:r<c7e?6:r<l7e?7:r<u7e?8:r<h7e?9:10},f7e={encode:Jve,decode:t7e,encodingLength:d7e},i3=f7e;function a$(r,e=0){return[i3.decode(r,e),i3.decode.bytes]}function c$(r,e,t=0){return i3.encode(r,e,t),e}function l$(r){return i3.encodingLength(r)}function s3(r,e){const t=e.byteLength,n=l$(r),i=n+l$(t),s=new Uint8Array(i+t);return c$(r,s,0),c$(t,s,n),s.set(e,i),new dj(r,t,e,s)}function p7e(r){const e=lj(r),[t,n]=a$(e),[i,s]=a$(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new dj(t,i,o,e)}let dj=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function g7e({name:r,code:e,encode:t}){return new y7e(r,e,t)}let y7e=class{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?s3(this.code,t):t.then(n=>s3(this.code,n))}else throw Error("Unknown type, must be binary type")}};function m7e(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const CA=g7e({name:"sha2-256",code:18,encode:m7e("SHA-256")});class w7e extends Yt{async listen(){throw new nbe("WebRTCTransport.createListener")}getAddrs(){return[]}updateAnnounceAddrs(){}async close(){}}const b7e=p0({prefix:"9",name:"base10",alphabet:"0123456789"}),v7e=Object.freeze(Object.defineProperty({__proto__:null,base10:b7e},Symbol.toStringTag,{value:"Module"})),E7e=Ir({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),S7e=Ir({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),x7e=Object.freeze(Object.defineProperty({__proto__:null,base16:E7e,base16upper:S7e},Symbol.toStringTag,{value:"Module"})),A7e=Ir({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),C7e=Object.freeze(Object.defineProperty({__proto__:null,base2:A7e},Symbol.toStringTag,{value:"Module"})),fj=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),I7e=fj.reduce((r,e,t)=>(r[t]=e,r),[]),k7e=fj.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function _7e(r){return r.reduce((e,t)=>(e+=I7e[t],e),"")}function T7e(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const i=k7e[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const P7e=R4({prefix:"🚀",name:"base256emoji",encode:_7e,decode:T7e}),D7e=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:P7e},Symbol.toStringTag,{value:"Module"})),$7e=Ir({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),N7e=Ir({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),M7e=Ir({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),O7e=Ir({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),R7e=Ir({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),L7e=Ir({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),B7e=Ir({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),U7e=Ir({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),F7e=Ir({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),z7e=Object.freeze(Object.defineProperty({__proto__:null,base32:$7e,base32hex:R7e,base32hexpad:B7e,base32hexpadupper:U7e,base32hexupper:L7e,base32pad:M7e,base32padupper:O7e,base32upper:N7e,base32z:F7e},Symbol.toStringTag,{value:"Module"})),V7e=p0({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),K7e=p0({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),H7e=Object.freeze(Object.defineProperty({__proto__:null,base36:V7e,base36upper:K7e},Symbol.toStringTag,{value:"Module"})),j7e=p0({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),q7e=p0({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),W7e=Object.freeze(Object.defineProperty({__proto__:null,base58btc:j7e,base58flickr:q7e},Symbol.toStringTag,{value:"Module"})),G7e=Ir({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Q7e=Object.freeze(Object.defineProperty({__proto__:null,base8:G7e},Symbol.toStringTag,{value:"Module"})),Y7e=R4({prefix:"\0",name:"identity",encode:r=>Bve(r),decode:r=>Lve(r)}),X7e=Object.freeze(Object.defineProperty({__proto__:null,identity:Y7e},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const J7e={...X7e,...C7e,...Q7e,...v7e,...x7e,...z7e,...H7e,...W7e,...Xve,...D7e},pj=Object.values(J7e).map(r=>r.decoder).reduce((r,e)=>r.or(e)),Z7e=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function e9e(r){var t;if(r==null)return;const e=r.match(Z7e);return(t=e==null?void 0:e.groups)==null?void 0:t.fingerprint}function gj(r){const t=r.stringTuples().filter(n=>n[0]===I6e).map(n=>n[1])[0];if(t===void 0||t==="")throw new Z(`Couldn't find a certhash component of multiaddr: ${r.toString()}`);return t}function t9e(r){return p7e(pj.decode(r))}function r9e(r){const e=t9e(gj(r)),t=i9e(e.code),n=e.digest.reduce((s,o)=>s+o.toString(16).padStart(2,"0"),""),i=n.match(/.{1,2}/g);if(i==null)throw new rbe(n,r.toString());return`${t} ${i.join(":").toUpperCase()}`}function n9e(r){const e=r.split(":").map(i=>parseInt(i,16)),t=Uint8Array.from(e),n=s3(CA.code,t);return $e(`/certhash/${AA.encode(n.bytes)}`)}function i9e(r){switch(r){case 17:return"sha-1";case 18:return"sha-256";case 19:return"sha-512";default:throw new ibe(r)}}function s9e(r,e){const{host:t,port:n,family:i}=r.toOptions(),s=r9e(r);return{type:"answer",sdp:`v=0
o=- 0 0 IN IP${i} ${t}
s=-
t=0 0
a=ice-lite
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
c=IN IP${i} ${t}
a=mid:0
a=ice-options:ice2
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:${s}
a=setup:passive
a=sctp-port:5000
a=max-message-size:${a4}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function o9e(r,e){const{host:t,port:n,family:i}=r.toOptions();return{type:"offer",sdp:`v=0
o=- 0 0 IN IP${i} ${t}
s=-
c=IN IP${i} ${t}
t=0 0
a=ice-options:ice2,trickle
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:active
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:sha-256 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
a=sctp-port:5000
a=max-message-size:${a4}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function u$(r,e){if(r.sdp===void 0)throw new Z("Can't munge a missing SDP");const t=r.sdp.includes(`\r
`)?`\r
`:`
`;return r.sdp=r.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,`
a=ice-ufrag:`+e+t).replace(/\na=ice-pwd:[^\n]*\n/,`
a=ice-pwd:`+e+t),r}const L5=se("libp2p-webrtc-noise:");function a9e(r,e,t){const n=r.trim().toLowerCase().replaceAll(":",""),i=se(n,"hex"),s=s3(CA.code,i),o=pj.decode(gj(e)),a=L5.byteLength+s.bytes.byteLength+o.byteLength;return er(t==="server"?[L5,o,s.bytes]:[L5,s.bytes,o],a)}const c9e=Hx?"iceconnectionstatechange":"connectionstatechange";async function l9e(r,e,t){var i,s,o;const n=r.createDataChannel("",{negotiated:!0,id:0});try{if(t.role==="client"){t.log.trace("client creating local offer");const f=await r.createOffer();t.log.trace("client created local offer %s",f.sdp);const g=u$(f,e);t.log.trace("client setting local offer %s",g.sdp),await r.setLocalDescription(g);const v=s9e(t.remoteAddr,e);t.log.trace("client setting server description %s",v.sdp),await r.setRemoteDescription(v)}else{const f=o9e(t.remoteAddr,e);t.log.trace("server setting client %s %s",f.type,f.sdp),await r.setRemoteDescription(f),t.log.trace("server creating local answer");const g=await r.createAnswer();t.log.trace("server created local answer");const v=u$(g,e);t.log.trace("server setting local description %s",g.sdp),await r.setLocalDescription(v)}if(n.readyState!=="open"&&(t.log.trace("%s wait for handshake channel to open, starting status %s",t.role,n.readyState),await xi(n,"open",t.signal)),t.log.trace("%s handshake channel opened",t.role),t.role==="server"){const f=((i=r.remoteFingerprint())==null?void 0:i.value)??"";t.remoteAddr=t.remoteAddr.encapsulate(n9e(f))}const a=e9e((s=r.localDescription)==null?void 0:s.sdp);if(a==null)throw new Zp("Could not get fingerprint from local description sdp");t.log.trace("%s performing noise handshake",t.role);const c=a9e(a,t.remoteAddr,t.role),l=dV({prologueBytes:c})(t),h=Im({channel:n,direction:"outbound",handshake:!0,logger:t.logger,...t.dataChannel??{}}),d=new n7(t,{peerConnection:r,remoteAddr:t.remoteAddr,timeline:{open:Date.now()},metrics:t.events});r.addEventListener(c9e,()=>{switch(r.connectionState){case"failed":case"disconnected":case"closed":d.close().catch(f=>{t.log.error("error closing connection",f),d.abort(f)});break;default:break}}),(o=t.events)==null||o.increment({peer_connection:!0});const p=new jx(t,{peerConnection:r,metrics:t.events,dataChannelOptions:t.dataChannel});if(t.role==="client")return t.log.trace("%s secure inbound",t.role),await l.secureInbound(h,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0}),t.log.trace("%s upgrade outbound",t.role),await t.upgrader.upgradeOutbound(d,{skipProtection:!0,skipEncryption:!0,muxerFactory:p,signal:t.signal});t.log.trace("%s secure outbound",t.role);const m=await l.secureOutbound(h,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0});d.remoteAddr=d.remoteAddr.encapsulate(`/p2p/${m.remotePeer}`),t.log.trace("%s upgrade inbound",t.role),await t.upgrader.upgradeInbound(d,{skipProtection:!0,skipEncryption:!0,muxerFactory:p,signal:t.signal})}catch(a){throw n.close(),a}}async function u9e(r,e,t,n){n==null&&(n=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"}));const i=typeof t=="function"?await t():t;return new RTCPeerConnection({...i??{},certificates:[n]})}async function h9e(r){const e=await sU(r),t=await crypto.subtle.exportKey("pkcs8",e.privateKey);return["-----BEGIN PRIVATE KEY-----",...re(new Uint8Array(t),"base64pad").split(/(.{64})/).filter(Boolean),"-----END PRIVATE KEY-----"].join(`
`)}var GN,QN,YN;YN=J3,QN=Symbol.toStringTag,GN=ur;class d9e{constructor(e,t={}){u(this,"log");u(this,"metrics");u(this,"components");u(this,"init");u(this,"certificate");u(this,"privateKey");u(this,"emitter");u(this,"renewCertificateTask");u(this,YN,!0);u(this,QN,"@libp2p/webrtc-direct");u(this,GN,["@libp2p/transport"]);if(this.log=e.logger.forComponent("libp2p:webrtc-direct"),this.components=e,this.init=t,this.emitter=new Yt,t.certificateLifespan!=null&&t.certificateRenewalThreshold!=null&&t.certificateRenewalThreshold>=t.certificateLifespan)throw new Z("Certificate renewal threshold must be less than certificate lifespan");e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}async start(){this.certificate=await this.getCertificate()}async stop(){this.renewCertificateTask!=null&&clearTimeout(this.renewCertificateTask),this.certificate=void 0}async dial(e,t){var a;this.log("dial %a",e),t.signal.throwIfAborted();let n;const i=e.getPeerId();i!=null&&(n=Wt(i));const s=J6e(),o=await u9e("client",s,typeof this.init.rtcConfiguration=="function"?await this.init.rtcConfiguration():this.init.rtcConfiguration??{});try{return await l9e(o,s,{role:"client",log:this.log,logger:this.components.logger,metrics:this.components.metrics,events:(a=this.metrics)==null?void 0:a.dialerEvents,signal:t.signal,remoteAddr:e,dataChannel:this.init.dataChannel,upgrader:t.upgrader,peerId:this.components.peerId,remotePeerId:n,privateKey:this.components.privateKey})}catch(c){throw o.close(),c}}createListener(e){if(this.certificate==null)throw new Vl;return new w7e(this.components,{...this.init,...e,certificate:this.certificate,emitter:this.emitter})}listenFilter(e){return e.filter(nv.exactMatch)}dialFilter(e){return this.listenFilter(e)}async getCertificate(e){if(f9e(this.init.certificate))return this.log("using provided TLS certificate"),this.init.certificate;const t=await this.loadOrCreatePrivateKey(),{pem:n,certhash:i}=await this.loadOrCreateCertificate(t,e);return{privateKey:await h9e(t),pem:n,certhash:i}}async loadOrCreatePrivateKey(){if(this.privateKey!=null)return this.privateKey;const e=this.init.certificateKeychainName??O6e,t=this.getKeychain();try{if(t==null)throw this.log("no keychain configured - not checking for stored private key"),new Qt;this.log.trace("checking for stored private key"),this.privateKey=await t.exportKey(e)}catch(n){if(n.name!=="NotFoundError")throw n;this.log.trace("generating private key"),this.privateKey=await hw("ECDSA","P-256"),t!=null?(this.log.trace("storing private key"),await t.importKey(e,this.privateKey)):this.log("no keychain configured - not storing private key")}return this.privateKey}async loadOrCreateCertificate(e,t){if(this.certificate!=null&&t!==!0)return this.certificate;let n;const i=new yt(this.init.certificateDatastoreKey??M6e),s=await sU(e);try{if(t===!0)throw this.log.trace("forcing renewal of TLS certificate"),new Qt;this.log.trace("checking for stored TLS certificate"),n=await this.loadCertificate(i,s)}catch(a){if(a.name!=="NotFoundError")throw a;this.log.trace("generating new TLS certificate"),n=await this.createCertificate(i,s)}let o=n.notAfter.getTime()-(this.init.certificateRenewalThreshold??_P)-Date.now();return o<0&&(o=100),this.log("will renew TLS certificate after %d ms",o),this.renewCertificateTask=setTimeout(()=>{this.log("renewing TLS certificate"),this.getCertificate(!0).then(a=>{this.certificate=a,this.emitter.safeDispatchEvent("certificate:renew",{detail:a})}).catch(a=>{this.log.error("could not renew certificate - %e",a)})},o),{pem:n.toString("pem"),certhash:AA.encode((await CA.digest(new Uint8Array(n.rawData))).bytes)}}async loadCertificate(e,t){const n=await this.components.datastore.get(e),i=new xA(n),s=i.notAfter.getTime()-(this.init.certificateRenewalThreshold??_P);if(Date.now()>s)throw this.log("stored TLS certificate has expired"),new Qt;this.log("loaded certificate, expires in %d ms",s);const o=await i.publicKey.export(crypto),a=await crypto.subtle.exportKey("raw",o),c=await crypto.subtle.exportKey("raw",t.publicKey);if(!Ke(new Uint8Array(a,0,a.byteLength),new Uint8Array(c,0,c.byteLength)))throw this.log("stored TLS certificate public key did not match public key from private key"),new Qt;return this.log("loaded certificate, expiry time is %o",s),i}async createCertificate(e,t){const n=new Date,i=new Date(Date.now()+(this.init.certificateLifespan??R6e));n.setMilliseconds(0),i.setMilliseconds(0);const s=await Rve.createSelfSigned({serialNumber:(BigInt(Math.random().toString().replace(".",""))*100000n).toString(16),name:"CN=example.com, C=US, L=CA, O=example, ST=CA",notBefore:n,notAfter:i,keys:t,extensions:[new EA(!1,void 0,!0)]},crypto);return this.getKeychain()!=null?(this.log.trace("storing TLS certificate"),await this.components.datastore.put(e,se(s.toString("pem")))):this.log("no keychain is configured so not storing TLS certificate since the private key will not be reused"),s}getKeychain(){try{return this.components.keychain}catch{}}}function f9e(r){return r==null?!1:typeof r.privateKey=="string"&&typeof r.pem=="string"&&typeof r.certhash=="string"}function p9e(r){return e=>new d9e(e,r)}function yj(r){return e=>new cbe(e,r)}const g9e=async r=>{if(r.readyState>=2)throw new Error("socket closed");r.readyState!==1&&await new Promise((e,t)=>{function n(){r.removeEventListener("open",i),r.removeEventListener("error",s)}function i(){n(),e()}function s(o){n(),t(o.error??new Error(`connect ECONNREFUSED ${r.url}`))}r.addEventListener("open",i),r.addEventListener("error",s)})},y9e=(r,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,async n=>{for await(const i of n){try{await g9e(r)}catch(s){if(s.message==="socket closed")break;throw s}if(r.readyState===r.CLOSING||r.readyState===r.CLOSED)break;r.send(i)}e.closeOnEnd!=null&&r.readyState<=1&&await new Promise((i,s)=>{r.addEventListener("close",o=>{if(o.wasClean||o.code===1006)i();else{const a=Object.assign(new Error("ws error"),{event:o});s(a)}}),setTimeout(()=>{r.close()})})});var L4={},B4={};Object.defineProperty(B4,"__esModule",{value:!0});class m9e{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const t={value:e,done:!1};if(this.pullQueue.length){const n=this.pullQueue.shift();n&&n.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{const t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{const t=this.pushQueue.shift();return t?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((n,i)=>{this.pullQueue.push({resolve:n,reject:i})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}let mj=class{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){const i=new m9e;i.highWaterMark=t,i.lowWaterMark=n,i.removeCallback=e({push:s=>i.push(s),stop:()=>i.stop(),fail:s=>i.fail(s),on:(s,o)=>{i.eventHandlers[s]=o}})||(()=>{}),this[Symbol.asyncIterator]=()=>i[Symbol.asyncIterator](),Object.freeze(this)}};B4.EventIterator=mj;B4.default=mj;Object.defineProperty(L4,"__esModule",{value:!0});const IA=B4;var w9e=L4.EventIterator=IA.EventIterator;function b9e(r,e,t){return new IA.EventIterator(({push:n})=>(this.addEventListener(r,n,e),()=>this.removeEventListener(r,n,e)),t)}L4.subscribe=b9e;L4.default=IA.EventIterator;function h$(r){var e;return r instanceof ArrayBuffer||((e=r==null?void 0:r.constructor)==null?void 0:e.name)==="ArrayBuffer"&&typeof(r==null?void 0:r.byteLength)=="number"}const v9e=r=>{r.binaryType="arraybuffer";const e=async()=>{await new Promise((s,o)=>{if(n){s();return}if(i!=null){o(i);return}const a=h=>{r.removeEventListener("open",c),r.removeEventListener("error",l),h()},c=()=>{a(s)},l=h=>{a(()=>{o(h.error??new Error(`connect ECONNREFUSED ${r.url}`))})};r.addEventListener("open",c),r.addEventListener("error",l)})},t=async function*(){const s=new w9e(({push:o,stop:a,fail:c})=>{const l=d=>{let p=null;typeof d.data=="string"&&(p=se(d.data)),h$(d.data)&&(p=new Uint8Array(d.data)),d.data instanceof Uint8Array&&(p=d.data),p!=null&&o(p)},h=d=>{c(d.error??new Error("Socket error"))};return r.addEventListener("message",l),r.addEventListener("error",h),r.addEventListener("close",a),()=>{r.removeEventListener("message",l),r.removeEventListener("error",h),r.removeEventListener("close",a)}},{highWaterMark:1/0});await e();for await(const o of s)yield h$(o)?new Uint8Array(o):o}();let n=r.readyState===1,i;return r.addEventListener("open",()=>{n=!0,i=null}),r.addEventListener("close",()=>{n=!1,i=null}),r.addEventListener("error",s=>{n||(i=s.error??new Error(`connect ECONNREFUSED ${r.url}`))}),Object.assign(t,{connected:e})},E9e=(r,e)=>{e=e??{};const t=v9e(r);let n=e.remoteAddress,i=e.remotePort;if(r.url!=null)try{const o=new URL(r.url);n=o.hostname,i=parseInt(o.port,10)}catch{}if(n==null||i==null)throw new Error("Remote connection did not have address and/or port");return{sink:y9e(r,e),source:t,connected:async()=>{await t.connected()},close:async()=>{(r.readyState===r.CONNECTING||r.readyState===r.OPEN)&&await new Promise(o=>{r.addEventListener("close",()=>{o()}),r.close()})},destroy:()=>{r.terminate!=null?r.terminate():r.close()},remoteAddress:n,remotePort:i,socket:r}},S9e=WebSocket,x9e={"http:":"ws:","https:":"wss:"},d$="ws:",A9e=(r,e)=>{if(r.startsWith("//")&&(r=`${(e==null?void 0:e.protocol)??d$}${r}`),r.startsWith("/")&&e!=null){const n=e.protocol??d$,i=e.host,s=e.port!=null&&(i==null?void 0:i.endsWith(`:${e.port}`))!==!0?`:${e.port}`:"";r=`${n}//${i}${s}${r}`}const t=new URL(r);for(const[n,i]of Object.entries(x9e))t.protocol===n&&(t.protocol=i);return t};function C9e(r,e){const t=typeof window>"u"?void 0:window.location;e=e??{};const n=A9e(r,t),i=new S9e(n.toString(),e.websocket);return E9e(i,e)}function I9e(r){return r.filter(e=>zy.exactMatch(e)||J1.exactMatch(e))}function k9e(){throw new Error("WebSocket Servers can not be created in the browser!")}const _9e=500;function T9e(r,e,t){const n=t.logger.forComponent("libp2p:websockets:maconn"),i=t.metrics,s=t.metricPrefix??"",o={log:n,async sink(a){try{await r.sink(async function*(){for await(const c of a)c instanceof Uint8Array?yield c:yield c.subarray()}())}catch(c){c.type!=="aborted"&&n.error(c)}},source:r.source,remoteAddr:e,timeline:{open:Date.now()},async close(a={}){var h,d;const c=Date.now();if(a.signal==null){const p=AbortSignal.timeout(_9e);a={...a,signal:p}}const l=()=>{const{host:p,port:m}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s after %dms, destroying it manually",p,m,Date.now()-c),this.abort(new zl("Socket close timeout"))};(h=a.signal)==null||h.addEventListener("abort",l);try{await r.close()}catch(p){n.error("error closing WebSocket gracefully",p),this.abort(p)}finally{(d=a.signal)==null||d.removeEventListener("abort",l),o.timeline.close=Date.now()}},abort(a){const{host:c,port:l}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s due to error",c,l,a),r.destroy(),o.timeline.close=Date.now(),i==null||i.increment({[`${s}error`]:!0})}};return r.socket.addEventListener("close",()=>{i==null||i.increment({[`${s}close`]:!0}),o.timeline.close==null&&(o.timeline.close=Date.now())},{once:!0}),o}var XN,JN,ZN;ZN=J3,JN=Symbol.toStringTag,XN=ur;class P9e{constructor(e,t={}){u(this,"log");u(this,"init");u(this,"logger");u(this,"metrics");u(this,"components");u(this,ZN,!0);u(this,JN,"@libp2p/websockets");u(this,XN,["@libp2p/transport"]);this.log=e.logger.forComponent("libp2p:websockets"),this.logger=e.logger,this.components=e,this.init=t,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}async dial(e,t){var o;this.log("dialing %s",e),t=t??{};const n=await this._connect(e,t),i=T9e(n,e,{logger:this.logger,metrics:(o=this.metrics)==null?void 0:o.dialerEvents});this.log("new outbound connection %s",i.remoteAddr);const s=await t.upgrader.upgradeOutbound(i,t);return this.log("outbound connection %s upgraded",i.remoteAddr),s}async _connect(e,t){var o,a,c,l,h;(o=t==null?void 0:t.signal)==null||o.throwIfAborted();const n=e.toOptions();this.log("dialing %s:%s",n.host,n.port);const i=Oe(),s=C9e(bz(e),this.init);s.socket.addEventListener("error",()=>{var p;const d=new iS(`Could not connect to ${e.toString()}`);this.log.error("connection error:",d),(p=this.metrics)==null||p.dialerEvents.increment({error:!0}),i.reject(d)});try{(a=t.onProgress)==null||a.call(t,new Ie("websockets:open-connection")),await nn(Promise.race([s.connected(),i.promise]),t.signal)}catch(d){throw(c=t.signal)!=null&&c.aborted&&((l=this.metrics)==null||l.dialerEvents.increment({abort:!0})),s.close().catch(p=>{this.log.error("error closing raw socket",p)}),d}return this.log("connected %s",e),(h=this.metrics)==null||h.dialerEvents.increment({connect:!0}),s}createListener(e){return k9e({logger:this.logger,events:this.components.events,metrics:this.components.metrics},{...this.init,...e})}listenFilter(e){var t,n;return e=Array.isArray(e)?e:[e],((t=this.init)==null?void 0:t.filter)!=null?(n=this.init)==null?void 0:n.filter(e):I9e(e)}dialFilter(e){return this.listenFilter(e)}}function wj(r={}){return e=>new P9e(e,r)}function D9e(r,e){const t=e.map((n,i)=>({record:qp(n),index:i}));return t.sort((n,i)=>{const s=n.record.sequence,o=i.record.sequence;if(s>o)return-1;if(s<o)return 1;if(n.record.validityType===ss.ValidityType.EOL&&i.record.validityType===ss.ValidityType.EOL){const a=hv.fromString(n.record.validity).toDate(),c=hv.fromString(i.record.validity).toDate();if(a.getTime()>c.getTime())return-1;if(a.getTime()<c.getTime())return 1}return 0}),t[0].index}const bj="2.8.5",vj="js-libp2p";function Ej(r,e){return`${r??vj}/${e??bj} browser/${globalThis.navigator.userAgent}`}const $9e="5.3.0",N9e="helia",M9e={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};function O9e(r={}){const e=`${N9e}/${$9e} ${Ej()}`;return{privateKey:r.privateKey,dns:r.dns,nodeInfo:{userAgent:e},addresses:{listen:["/p2p-circuit","/webrtc"]},transports:[VV(),yj(),p9e(),wj()],connectionEncrypters:[dV()],streamMuxers:[Aye(),g6e()],peerDiscovery:[PV(M9e)],services:{autoNAT:sme(),dcutr:D3e(),delegatedRouting:()=>m0e("https://delegated-ipfs.dev",J0e()),dht:g8e({clientMode:!0,validators:{ipns:Bz},selectors:{ipns:D9e}}),identify:qV(),identifyPush:H3e(),keychain:lH(r.keychain),ping:x6e()}}}async function R9e(r,e={}){const t=e.selfKey??"self",n=lH(e)({datastore:r,logger:ww()});let i;return await r.has(new yt(`/pkcs8/${t}`))?i=await n.exportKey(t):(i=await hw(e.keyType??"Ed25519"),await n.importKey(t,i)),i}const L9e=32,{code:B9e}=Ue("dnsaddr");class U9e extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}}const Sj=async function(e,t={}){const n=t.maxRecursiveDepth??L9e;if(n===0)throw new U9e("Max recursive depth reached");const[,i]=e.stringTuples().find(([l])=>l===B9e)??[],o=await((t==null?void 0:t.dns)??iF()).query(`_dnsaddr.${i}`,{signal:t==null?void 0:t.signal,types:[Ec.TXT]}),a=e.getPeerId(),c=[];for(const l of o.Answer){const h=l.data.replace(/["']/g,"").trim().split("=")[1];if(h==null||a!=null&&!h.includes(a))continue;const d=$e(h);if(h.startsWith("/dnsaddr")){const p=await d.resolve({...t,maxRecursiveDepth:n-1});c.push(...p.map(m=>m.toString()))}else c.push(d.toString())}return c},F9e={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:r=>r},connectionManager:{resolvers:{dnsaddr:Sj}},transportManager:{faultTolerance:Hh.FATAL_ALL}};async function z9e(r){var t,n;const e=Px(F9e,r);if(e.connectionProtector===null&&((n=(t=globalThis.process)==null?void 0:t.env)==null?void 0:n.LIBP2P_FORCE_PNET)!=null)throw new Z("Private network is enforced, but no protector was provided");return e}function V9e(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function kA(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function K9e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,v=0,y=0,w=f.length;y!==w&&f[y]===0;)y++,g++;for(var b=(w-y)*h+1>>>0,E=new Uint8Array(b);y!==w;){for(var C=f[y],k=0,x=b-1;(C!==0||k<v)&&x!==-1;x--,k++)C+=256*E[x]>>>0,E[x]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");v=k,y++}for(var I=b-v;I!==b&&E[I]===0;)I++;for(var T=c.repeat(g);I<b;++I)T+=r.charAt(E[I]);return T}function p(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var v=0,y=0;f[g]===c;)v++,g++;for(var w=(f.length-g)*l+1>>>0,b=new Uint8Array(w);f[g];){var E=t[f.charCodeAt(g)];if(E===255)return;for(var C=0,k=w-1;(E!==0||C<y)&&k!==-1;k--,C++)E+=a*b[k]>>>0,b[k]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,g++}if(f[g]!==" "){for(var x=w-y;x!==w&&b[x]===0;)x++;for(var I=new Uint8Array(v+(w-x)),T=v;x!==w;)I[T++]=b[x++];return I}}}function m(f){var g=p(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:m}}var H9e=K9e,j9e=H9e;class q9e{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class W9e{constructor(e,t,n){u(this,"name");u(this,"prefix");u(this,"baseDecode");u(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return xj(this,e)}}class G9e{constructor(e){u(this,"decoders");this.decoders=e}or(e){return xj(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function xj(r,e){return new G9e({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}class Q9e{constructor(e,t,n,i){u(this,"name");u(this,"prefix");u(this,"baseEncode");u(this,"baseDecode");u(this,"encoder");u(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new q9e(e,t,n),this.decoder=new W9e(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function Aj({name:r,prefix:e,encode:t,decode:n}){return new Q9e(r,e,t,n)}function U4({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=j9e(t,r);return Aj({prefix:e,name:r,encode:n,decode:s=>kA(i(s))})}function Y9e(r,e,t,n){const i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,l=0;for(let h=0;h<s;++h){const d=i[r[h]];if(d===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function X9e(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function na({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return Aj({prefix:e,name:r,encode(i){return X9e(i,n,t)},decode(i){return Y9e(i,n,t,r)}})}const m1=na({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});na({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});na({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});na({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});na({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});na({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});na({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});na({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});na({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const B5=U4({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});U4({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const po=U4({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});U4({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var J9e=Cj,f$=128,Z9e=-128,eEe=Math.pow(2,31);function Cj(r,e,t){e=e||[],t=t||0;for(var n=t;r>=eEe;)e[t++]=r&255|f$,r/=128;for(;r&Z9e;)e[t++]=r&255|f$,r>>>=7;return e[t]=r|0,Cj.bytes=t-n+1,e}var tEe=b9,rEe=128,p$=127;function b9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw b9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&p$)<<i:(o&p$)*Math.pow(2,i),i+=7}while(o>=rEe);return b9.bytes=s-n,t}var nEe=Math.pow(2,7),iEe=Math.pow(2,14),sEe=Math.pow(2,21),oEe=Math.pow(2,28),aEe=Math.pow(2,35),cEe=Math.pow(2,42),lEe=Math.pow(2,49),uEe=Math.pow(2,56),hEe=Math.pow(2,63),dEe=function(r){return r<nEe?1:r<iEe?2:r<sEe?3:r<oEe?4:r<aEe?5:r<cEe?6:r<lEe?7:r<uEe?8:r<hEe?9:10},fEe={encode:J9e,decode:tEe,encodingLength:dEe},o3=fEe;function v9(r,e=0){return[o3.decode(r,e),o3.decode.bytes]}function a3(r,e,t=0){return o3.encode(r,e,t),e}function c3(r){return o3.encodingLength(r)}function pEe(r,e){const t=e.byteLength,n=c3(r),i=n+c3(t),s=new Uint8Array(i+t);return a3(r,s,0),a3(t,s,n),s.set(e,i),new _A(r,t,e,s)}function Ij(r){const e=kA(r),[t,n]=v9(e),[i,s]=v9(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new _A(t,i,o,e)}function gEe(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&V9e(r.bytes,t.bytes)}}let _A=class{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}};function g$(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return mEe(t,E9(r),e??po.encoder);default:return wEe(t,E9(r),e??m1.encoder)}}const y$=new WeakMap;function E9(r){const e=y$.get(r);if(e==null){const t=new Map;return y$.set(r,t),t}return e}var eM;class fr{constructor(e,t,n,i){u(this,"code");u(this,"version");u(this,"multihash");u(this,"bytes");u(this,"/");u(this,eM,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Of)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==bEe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return fr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=pEe(e,t);return fr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return fr.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&gEe(e.multihash,n.multihash)}toString(e){return g$(this,e)}toJSON(){return{"/":g$(this)}}link(){return this}[(eM=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof fr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new fr(n,i,s,o??m$(n,i,s.bytes))}else if(t[vEe]===!0){const{version:n,multihash:i,code:s}=t,o=Ij(i);return fr.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Of)throw new Error(`Version 0 CID must use dag-pb (code: ${Of}) block encoding`);return new fr(e,t,n,n.bytes)}case 1:{const i=m$(e,t,n.bytes);return new fr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return fr.create(0,Of,e)}static createV1(e,t){return fr.create(1,e,t)}static decode(e){const[t,n]=fr.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=fr.inspectBytes(e),n=t.size-t.multihashSize,i=kA(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new _A(t.multihashCode,t.digestSize,s,i);return[t.version===0?fr.createV0(o):fr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,p]=v9(e.subarray(t));return t+=p,d};let i=n(),s=Of;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){const[n,i]=yEe(e,t),s=fr.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return E9(s).set(n,e),s}}function yEe(r,e){switch(r[0]){case"Q":{const t=e??po;return[po.prefix,t.decode(`${po.prefix}${r}`)]}case po.prefix:{const t=e??po;return[po.prefix,t.decode(r)]}case m1.prefix:{const t=e??m1;return[m1.prefix,t.decode(r)]}case B5.prefix:{const t=e??B5;return[B5.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function mEe(r,e,t){const{prefix:n}=t;if(n!==po.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function wEe(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Of=112,bEe=18;function m$(r,e,t){const n=c3(r),i=n+c3(e),s=new Uint8Array(i+t.byteLength);return a3(r,s,0),a3(e,s,n),s.set(t,i),s}const vEe=Symbol.for("@ipld/js-cid/CID"),EEe=36e5,SEe=216e5;var wl;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=Pe((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.key!=null&&i.key!==""&&(s.uint32(10),s.string(i.key)),i.value!=null&&i.value.byteLength>0&&(s.uint32(18),s.bytes(i.value)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={key:"",value:We(0)},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.key=i.string();break}case 2:{a.value=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>Te(i,t.codec()),t.decode=(i,s)=>_e(i,t.codec(),s)})(r.Peer$metadataEntry||(r.Peer$metadataEntry={})),function(t){let n;t.codec=()=>(n==null&&(n=Pe((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.key!=null&&i.key!==""&&(s.uint32(10),s.string(i.key)),i.value!=null&&(s.uint32(18),u3.codec().encode(i.value,s)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={key:""},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const h=i.uint32();switch(h>>>3){case 1:{a.key=i.string();break}case 2:{a.value=u3.codec().decode(i,i.uint32(),{limits:(l=o.limits)==null?void 0:l.value});break}default:{i.skipType(h&7);break}}}return a})),n),t.encode=i=>Te(i,t.codec()),t.decode=(i,s)=>_e(i,t.codec(),s)}(r.Peer$tagsEntry||(r.Peer$tagsEntry={}));let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.addresses!=null)for(const s of t.addresses)n.uint32(10),l3.codec().encode(s,n);if(t.protocols!=null)for(const s of t.protocols)n.uint32(18),n.string(s);if(t.publicKey!=null&&(n.uint32(34),n.bytes(t.publicKey)),t.peerRecordEnvelope!=null&&(n.uint32(42),n.bytes(t.peerRecordEnvelope)),t.metadata!=null&&t.metadata.size!==0)for(const[s,o]of t.metadata.entries())n.uint32(50),r.Peer$metadataEntry.codec().encode({key:s,value:o},n);if(t.tags!=null&&t.tags.size!==0)for(const[s,o]of t.tags.entries())n.uint32(58),r.Peer$tagsEntry.codec().encode({key:s,value:o},n);t.updated!=null&&(n.uint32(64),n.uint64Number(t.updated)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,h,d,p;const s={addresses:[],protocols:[],metadata:new Map,tags:new Map},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const m=t.uint32();switch(m>>>3){case 1:{if(((a=i.limits)==null?void 0:a.addresses)!=null&&s.addresses.length===i.limits.addresses)throw new ht('Decode error - map field "addresses" had too many elements');s.addresses.push(l3.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.addresses$}));break}case 2:{if(((l=i.limits)==null?void 0:l.protocols)!=null&&s.protocols.length===i.limits.protocols)throw new ht('Decode error - map field "protocols" had too many elements');s.protocols.push(t.string());break}case 4:{s.publicKey=t.bytes();break}case 5:{s.peerRecordEnvelope=t.bytes();break}case 6:{if(((h=i.limits)==null?void 0:h.metadata)!=null&&s.metadata.size===i.limits.metadata)throw new ZI('Decode error - map field "metadata" had too many elements');const f=r.Peer$metadataEntry.codec().decode(t,t.uint32());s.metadata.set(f.key,f.value);break}case 7:{if(((d=i.limits)==null?void 0:d.tags)!=null&&s.tags.size===i.limits.tags)throw new ZI('Decode error - map field "tags" had too many elements');const f=r.Peer$tagsEntry.codec().decode(t,t.uint32(),{limits:{value:(p=i.limits)==null?void 0:p.tags$value}});s.tags.set(f.key,f.value);break}case 8:{s.updated=t.uint64Number();break}default:{t.skipType(m&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(wl||(wl={}));var l3;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(n.uint32(10),n.bytes(t.multiaddr)),t.isCertified!=null&&(n.uint32(16),n.bool(t.isCertified)),t.observed!=null&&(n.uint32(24),n.uint64Number(t.observed)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={multiaddr:We(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.multiaddr=t.bytes();break}case 2:{s.isCertified=t.bool();break}case 3:{s.observed=t.uint64Number();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(l3||(l3={}));var u3;(function(r){let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.value!=null&&t.value!==0&&(n.uint32(8),n.uint32(t.value)),t.expiry!=null&&(n.uint32(16),n.uint64(t.expiry)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={value:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.value=t.uint32();break}case 2:{s.expiry=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(u3||(u3={}));function xEe(r,e){if(r.publicKey!=null||e.publicKey==null)return r;let t;if(r.type==="RSA"){const i=po.decode(`z${r}`);t=Ij(i)}const n=$n(e.publicKey,t);return Yh(n)}function S9(r,e,t){const n=wl.decode(e);return x9(r,n,t)}function x9(r,e,t){const n=new Map,i=BigInt(Date.now());for(const[s,o]of e.tags.entries())o.expiry!=null&&o.expiry<i||n.set(s,o);return{...e,id:xEe(r,e),addresses:e.addresses.filter(({observed:s})=>s!=null&&s>Date.now()-t).map(({multiaddr:s,isCertified:o})=>({multiaddr:$e(s),isCertified:o??!1})),metadata:e.metadata,peerRecordEnvelope:e.peerRecordEnvelope??void 0,tags:n}}function AEe(r,e){return CEe(r.addresses,e.addresses)&&IEe(r.protocols,e.protocols)&&kEe(r.publicKey,e.publicKey)&&_Ee(r.peerRecordEnvelope,e.peerRecordEnvelope)&&TEe(r.metadata,e.metadata)&&PEe(r.tags,e.tags)}function CEe(r,e){return _j(r,e,(t,n)=>!(t.isCertified!==n.isCertified||!Ke(t.multiaddr,n.multiaddr)))}function IEe(r,e){return _j(r,e,(t,n)=>t===n)}function kEe(r,e){return kj(r,e)}function _Ee(r,e){return kj(r,e)}function TEe(r,e){return Tj(r,e,(t,n)=>Ke(t,n))}function PEe(r,e){return Tj(r,e,(t,n)=>t.value===n.value&&t.expiry===n.expiry)}function kj(r,e){return r==null&&e==null?!0:r!=null&&e!=null?Ke(r,e):!1}function _j(r,e,t){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!t(r[n],e[n]))return!1;return!0}function Tj(r,e,t){if(r.size!==e.size)return!1;for(const[n,i]of r.entries()){const s=e.get(n);if(s==null||!t(i,s))return!1}return!0}const Pj="/peers/";function vg(r){if(!qL(r)||r.type==null)throw new Z("Invalid PeerId");const e=r.toCID().toString();return new yt(`${Pj}${e}`)}async function DEe(r,e,t,n){const i=new Map;for(const s of t){if(s==null)continue;if(s.multiaddr instanceof Uint8Array&&(s.multiaddr=$e(s.multiaddr)),!Tw(s.multiaddr))throw new Z("Multiaddr was invalid");if(!await e(r,s.multiaddr))continue;const o=s.isCertified??!1,a=s.multiaddr.toString(),c=i.get(a);c!=null?s.isCertified=c.isCertified||o:i.set(a,{multiaddr:s.multiaddr,isCertified:o})}return[...i.values()].sort((s,o)=>s.multiaddr.toString().localeCompare(o.multiaddr.toString())).map(({isCertified:s,multiaddr:o})=>({isCertified:s,multiaddr:o.bytes}))}async function U5(r,e,t,n){var p,m;if(e==null)throw new Z("Invalid PeerData");if(e.publicKey!=null&&r.publicKey!=null&&!e.publicKey.equals(r.publicKey))throw new Z("publicKey bytes do not match peer id publicKey bytes");const i=(p=n.existingPeer)==null?void 0:p.peer;if(i!=null&&!r.equals(i.id))throw new Z("peer id did not match existing peer id");let s=(i==null?void 0:i.addresses)??[],o=new Set((i==null?void 0:i.protocols)??[]),a=(i==null?void 0:i.metadata)??new Map,c=(i==null?void 0:i.tags)??new Map,l=i==null?void 0:i.peerRecordEnvelope;if(t==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(s=[],e.multiaddrs!=null&&s.push(...e.multiaddrs.map(f=>({isCertified:!1,multiaddr:f}))),e.addresses!=null&&s.push(...e.addresses)),e.protocols!=null&&(o=new Set(e.protocols)),e.metadata!=null){const f=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);a=Eg(f,{validate:w$})}if(e.tags!=null){const f=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);c=Eg(f,{validate:b$,map:v$})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}if(t==="merge"){if(e.multiaddrs!=null&&s.push(...e.multiaddrs.map(f=>({isCertified:!1,multiaddr:f}))),e.addresses!=null&&s.push(...e.addresses),e.protocols!=null&&(o=new Set([...o,...e.protocols])),e.metadata!=null){const f=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(const[g,v]of f)v==null?a.delete(g):a.set(g,v);a=Eg([...a.entries()],{validate:w$})}if(e.tags!=null){const f=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),g=new Map(c);for(const[v,y]of f)y==null?g.delete(v):g.set(v,y);c=Eg([...g.entries()],{validate:b$,map:v$})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}let h;(i==null?void 0:i.id.publicKey)!=null?h=_i(i.id.publicKey):e.publicKey!=null?h=_i(e.publicKey):r.publicKey!=null&&(h=_i(r.publicKey));const d={addresses:await DEe(r,n.addressFilter??(async()=>!0),s,(m=n.existingPeer)==null?void 0:m.peerPB.addresses),protocols:[...o.values()].sort((f,g)=>f.localeCompare(g)),metadata:a,tags:c,publicKey:h,peerRecordEnvelope:l};return d.addresses.forEach(f=>{var g,v,y;f.observed=((y=(v=(g=n.existingPeer)==null?void 0:g.peerPB.addresses)==null?void 0:v.find(w=>Ke(w.multiaddr,w.multiaddr)))==null?void 0:y.observed)??Date.now()}),r.type!=="RSA"&&delete d.publicKey,d}function Eg(r,e){var n;const t=new Map;for(const[i,s]of r)s!=null&&e.validate(i,s);for(const[i,s]of r.sort(([o],[a])=>o.localeCompare(a)))s!=null&&t.set(i,((n=e.map)==null?void 0:n.call(e,i,s))??s);return t}function w$(r,e){if(typeof r!="string")throw new Z("Metadata key must be a string");if(!(e instanceof Uint8Array))throw new Z("Metadata value must be a Uint8Array")}function b$(r,e){if(typeof r!="string")throw new Z("Tag name must be a string");if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new Z("Tag value must be an integer");if(e.value<0||e.value>100)throw new Z("Tag value must be between 0-100")}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new Z("Tag ttl must be an integer");if(e.ttl<0)throw new Z("Tag ttl must be between greater than 0")}}function v$(r,e){let t;return e.expiry!=null&&(t=e.expiry),e.ttl!=null&&(t=BigInt(Date.now()+Number(e.ttl))),{value:e.value??0,expiry:t}}function Dj(r){const e=r.toString().split("/")[2],t=fr.parse(e,m1);return Md(t)}function F5(r,e,t){const n=Dj(r);return S9(n,e,t)}function $Ee(r,e){return{prefix:Pj,filters:(r.filters??[]).map(t=>({key:n,value:i})=>t(F5(n,i,e))),orders:(r.orders??[]).map(t=>(n,i)=>t(F5(n.key,n.value,e),F5(i.key,i.value,e)))}}var Tn,p2,g2,y2;class NEe{constructor(e,t={}){qe(this,Tn);u(this,"peerId");u(this,"datastore");u(this,"lock");u(this,"addressFilter");u(this,"log");u(this,"maxAddressAge");u(this,"maxPeerAge");this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.lock=jS({name:"peer-store",singleProcess:!0}),this.maxAddressAge=t.maxAddressAge??EEe,this.maxPeerAge=t.maxPeerAge??SEe}async has(e){try{return await this.load(e),!0}catch(t){if(t.name!=="NotFoundError")throw t}return!1}async delete(e){this.peerId.equals(e)||await this.datastore.delete(vg(e))}async load(e){const t=vg(e),n=await this.datastore.get(t),i=wl.decode(n);if(Ae(this,Tn,y2).call(this,e,i))throw await this.datastore.delete(t),new Qt;return x9(e,i,this.peerId.equals(e)?1/0:this.maxAddressAge)}async save(e,t){const n=await Ae(this,Tn,p2).call(this,e),i=await U5(e,t,"patch",{addressFilter:this.addressFilter});return Ae(this,Tn,g2).call(this,e,i,n)}async patch(e,t){const n=await Ae(this,Tn,p2).call(this,e),i=await U5(e,t,"patch",{addressFilter:this.addressFilter,existingPeer:n});return Ae(this,Tn,g2).call(this,e,i,n)}async merge(e,t){const n=await Ae(this,Tn,p2).call(this,e),i=await U5(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:n});return Ae(this,Tn,g2).call(this,e,i,n)}async*all(e){for await(const{key:t,value:n}of this.datastore.query($Ee(e??{},this.maxAddressAge))){const i=Dj(t);if(i.equals(this.peerId))continue;const s=wl.decode(n);if(Ae(this,Tn,y2).call(this,i,s)){await this.datastore.delete(t);continue}yield x9(i,s,this.peerId.equals(i)?1/0:this.maxAddressAge)}}}Tn=new WeakSet,p2=async function(e){try{const t=vg(e),n=await this.datastore.get(t),i=wl.decode(n);if(Ae(this,Tn,y2).call(this,e,i))throw await this.datastore.delete(t),new Qt;return{peerPB:i,peer:S9(e,n,this.maxAddressAge)}}catch(t){t.name!=="NotFoundError"&&this.log.error("invalid peer data found in peer store - %e",t)}},g2=async function(e,t,n){t.updated=Date.now();const i=wl.encode(t);return await this.datastore.put(vg(e),i),{peer:S9(e,i,this.maxAddressAge),previous:n==null?void 0:n.peer,updated:n==null||!AEe(t,n.peerPB)}},y2=function(e,t){if(t.updated==null)return!0;if(this.peerId.equals(e))return!1;const n=t.updated<Date.now()-this.maxPeerAge,i=Date.now()-this.maxAddressAge,s=t.addresses.filter(o=>o.observed!=null&&o.observed>i);return n&&s.length===0};var tM,$h,m2;tM=Symbol.toStringTag;class MEe{constructor(e,t={}){qe(this,$h);u(this,"store");u(this,"events");u(this,"peerId");u(this,"log");u(this,tM,"@libp2p/peer-store");this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new NEe(e,t)}async forEach(e,t){this.log.trace("forEach await read lock");const n=await this.store.lock.readLock();this.log.trace("forEach got read lock");try{for await(const i of this.store.all(t))e(i)}finally{this.log.trace("forEach release read lock"),n()}}async all(e){this.log.trace("all await read lock");const t=await this.store.lock.readLock();this.log.trace("all got read lock");try{return await im(this.store.all(e))}finally{this.log.trace("all release read lock"),t()}}async delete(e){this.log.trace("delete await write lock");const t=await this.store.lock.writeLock();this.log.trace("delete got write lock");try{await this.store.delete(e)}finally{this.log.trace("delete release write lock"),t()}}async has(e){this.log.trace("has await read lock");const t=await this.store.lock.readLock();this.log.trace("has got read lock");try{return await this.store.has(e)}finally{this.log.trace("has release read lock"),t()}}async get(e){this.log.trace("get await read lock");const t=await this.store.lock.readLock();this.log.trace("get got read lock");try{return await this.store.load(e)}finally{this.log.trace("get release read lock"),t()}}async save(e,t){this.log.trace("save await write lock");const n=await this.store.lock.writeLock();this.log.trace("save got write lock");try{const i=await this.store.save(e,t);return Ae(this,$h,m2).call(this,e,i),i.peer}finally{this.log.trace("save release write lock"),n()}}async patch(e,t){this.log.trace("patch await write lock");const n=await this.store.lock.writeLock();this.log.trace("patch got write lock");try{const i=await this.store.patch(e,t);return Ae(this,$h,m2).call(this,e,i),i.peer}finally{this.log.trace("patch release write lock"),n()}}async merge(e,t){this.log.trace("merge await write lock");const n=await this.store.lock.writeLock();this.log.trace("merge got write lock");try{const i=await this.store.merge(e,t);return Ae(this,$h,m2).call(this,e,i),i.peer}finally{this.log.trace("merge release write lock"),n()}}async consumePeerRecord(e,t){const n=await Ac.openAndCertify(e,Bs.DOMAIN),i=Md(n.publicKey.toCID());if((t==null?void 0:t.equals(i))===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",t,i),!1;const s=Bs.createFromProtobuf(n.payload);let o;try{o=await this.get(i)}catch(a){if(a.name!=="NotFoundError")throw a}if((o==null?void 0:o.peerRecordEnvelope)!=null){const a=await Ac.createFromProtobuf(o.peerRecordEnvelope),c=Bs.createFromProtobuf(a.payload);if(c.seqNumber>=s.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",c.seqNumber,s.seqNumber),!1}return await this.patch(s.peerId,{peerRecordEnvelope:e,addresses:s.multiaddrs.map(a=>({isCertified:!0,multiaddr:a}))}),!0}}$h=new WeakSet,m2=function(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))};function OEe(r,e={}){return new MEe(r,e)}function REe(r,e){let t;const n=function(){const i=function(){t=void 0,r()};clearTimeout(t),t=setTimeout(i,e)};return n.start=()=>{},n.stop=()=>{clearTimeout(t)},n}const E$=864e13,LEe=448,z5=449,BEe=53,UEe=54,FEe=55,zEe=56;class VEe{constructor(e,t={}){u(this,"log");u(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=new Map}has(e){const t=this.findHost(e);for(const n of this.mappings.values())if(n.domain===t)return!0;return!1}add(e,t){t.forEach(n=>{this.log("add DNS mapping %s to %s",n,e);const i=Rc(n)===!0;this.mappings.set(n,{domain:e,verified:i,expires:i?E$-Date.now():0,lastVerified:i?E$-Date.now():void 0})})}remove(e){const t=this.findHost(e);let n=!1;for(const[i,s]of this.mappings.entries())s.domain===t&&(this.log("removing %s to %s DNS mapping %e",i,s.domain,new Error("where")),this.mappings.delete(i),n=n||s.verified);return n}getAll(e){const t=[];for(let n=0;n<e.length;n++){const s=e[n].multiaddr.stringTuples(),o=s[0][1];if(o!=null)for(const[a,c]of this.mappings.entries()){if(o!==a)continue;this.maybeAddSNITuple(s,c.domain)&&(e.splice(n,1),n--,t.push({multiaddr:$e(`/${s.map(h=>[Ue(h[0]).name,h[1]].join("/")).join("/")}`),verified:c.verified,type:"dns-mapping",expires:c.expires,lastVerified:c.lastVerified}))}}return t}maybeAddSNITuple(e,t){var n;for(let i=0;i<e.length;i++)if(e[i][0]===LEe&&((n=e[i+1])==null?void 0:n[0])!==z5)return e.splice(i+1,0,[z5,t]),!0;return!1}confirm(e,t){const n=this.findHost(e);let i=!1;for(const[s,o]of this.mappings.entries())o.domain===n&&(this.log("marking %s to %s DNS mapping as verified",s,o.domain),i=o.verified,o.verified=!0,o.expires=Date.now()+t,o.lastVerified=Date.now());return i}unconfirm(e,t){const n=this.findHost(e);let i=!1;for(const[s,o]of this.mappings.entries())o.domain===n&&(this.log("removing verification of %s to %s DNS mapping",s,o.domain),i=i||o.verified,o.verified=!1,o.expires=Date.now()+t);return i}findHost(e){for(const t of e.stringTuples())if(t[0]===z5||t[0]===BEe||t[0]===UEe||t[0]===FEe||t[0]===zEe)return t[1]}}const V5=4,K5=41,H5=6,KEe=273;class HEe{constructor(e,t={}){u(this,"log");u(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=new Map}has(e){const t=e.stringTuples();for(const n of this.mappings.values())for(const i of n)if(i.externalIp===t[0][1])return!0;return!1}add(e,t,n,i=t,s="tcp"){const o=`${e}-${t}-${s}`,a=this.mappings.get(o)??[],c={internalIp:e,internalPort:t,externalIp:n,externalPort:i,externalFamily:td(n)?4:6,protocol:s,verified:!1,expires:0};a.push(c),this.mappings.set(o,a)}remove(e){const t=e.stringTuples(),n=t[0][1]??"",i=t[1][0]===H5?"tcp":"udp",s=parseInt(t[1][1]??"0");let o=!1;for(const[a,c]of this.mappings.entries()){for(let l=0;l<c.length;l++){const h=c[l];h.externalIp===n&&h.externalPort===s&&h.protocol===i&&(this.log("removing %s:%s to %s:%s %s IP mapping",h.externalIp,h.externalPort,n,s,i),o=o||h.verified,c.splice(l,1),l--)}c.length===0&&this.mappings.delete(a)}return o}getAll(e){const t=[];for(const{multiaddr:n}of e){const i=n.stringTuples();let s;if((i[0][0]===V5||i[0][0]===K5)&&i[1][0]===H5?s=`${i[0][1]}-${i[1][1]}-tcp`:(i[0][0]===V5||i[0][0]===K5)&&i[1][0]===KEe&&(s=`${i[0][1]}-${i[1][1]}-udp`),s==null)continue;const o=this.mappings.get(s);if(o!=null)for(const a of o)i[0][0]=a.externalFamily===4?V5:K5,i[0][1]=a.externalIp,i[1][1]=`${a.externalPort}`,t.push({multiaddr:$e(`/${i.map(c=>[Ue(c[0]).name,c[1]].join("/")).join("/")}`),verified:a.verified,type:"ip-mapping",expires:a.expires,lastVerified:a.lastVerified})}return t}confirm(e,t){const i=e.stringTuples()[0][1];let s=!1;for(const o of this.mappings.values())for(const a of o)a.externalIp===i&&(this.log("marking %s to %s IP mapping as verified",a.internalIp,a.externalIp),s=a.verified,a.verified=!0,a.expires=Date.now()+t,a.lastVerified=Date.now());return s}unconfirm(e,t){const n=e.stringTuples(),i=n[0][1]??"",s=n[1][0]===H5?"tcp":"udp",o=parseInt(n[1][1]??"0");let a=!1;for(const c of this.mappings.values())for(let l=0;l<c.length;l++){const h=c[l];h.externalIp===i&&h.externalPort===o&&h.protocol===s&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",h.externalIp,h.externalPort,i,o,s),a=a||h.verified,h.verified=!1,h.expires=Date.now()+t)}return a}}const jEe=4,qEe=41;function WEe(r){try{const[[e,t]]=r.stringTuples();if(t==null)return!1;if(e===jEe)return t.startsWith("169.254.");if(e===qEe)return t.toLowerCase().startsWith("fe80")}catch{}return!1}const GEe={maxObservedAddresses:10};class QEe{constructor(e,t={}){u(this,"log");u(this,"addresses");u(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??GEe.maxObservedAddresses}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(const t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&(Ql(e)||WEe(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:$e(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){var n;const t=((n=this.addresses.get(e.toString()))==null?void 0:n.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){const n=e.toString(),i=this.addresses.get(n)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},s=i.verified;return i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now(),this.log("marking observed address %a as verified",n),this.addresses.set(n,i),s}}const YEe=4,XEe=41,JEe=53,ZEe=54,eSe=55,tSe=56,rSe=[YEe,XEe,JEe,ZEe,eSe,tSe];function S$(r){try{const[[e]]=r.stringTuples();return rSe.includes(e)}catch{}return!1}const nSe={maxObservedAddresses:10};class iSe{constructor(e,t={}){u(this,"log");u(this,"addresses");u(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??nSe.maxObservedAddresses}get(e,t){if(Ql(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};const n=this.toKey(e);let i=this.addresses.get(n);return i==null&&(i={verified:!S$(e),expires:0},this.addresses.set(n,i)),{multiaddr:e,verified:i.verified,type:"transport",expires:i.expires,lastVerified:i.lastVerified}}has(e){const t=this.toKey(e);return this.addresses.has(t)}remove(e){var i;const t=this.toKey(e),n=((i=this.addresses.get(t))==null?void 0:i.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),n}confirm(e,t){const n=this.toKey(e),i=this.addresses.get(n)??{verified:!1,expires:0,lastVerified:0},s=i.verified;return i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now(),this.addresses.set(n,i),s}unconfirm(e,t){const n=this.toKey(e),i=this.addresses.get(n)??{verified:!1,expires:0},s=i.verified;return i.verified=!1,i.expires=Date.now()+t,this.addresses.set(n,i),s}toKey(e){if(S$(e)){const t=e.toOptions();return`${t.host}-${t.port}-${t.transport}`}return e.toString()}}const x$=6e4,A$={addressVerificationTTL:x$*10,addressVerificationRetry:x$*5},sSe=r=>r;function j5(r,e){const t=r.getPeerId();return t!=null&&Wt(t).equals(e)&&(r=r.decapsulate($e(`/p2p/${e.toString()}`))),r}var rM;rM=Symbol.toStringTag;class oSe{constructor(e,t={}){u(this,"log");u(this,"components");u(this,"listen");u(this,"announce");u(this,"appendAnnounce");u(this,"announceFilter");u(this,"observed");u(this,"dnsMappings");u(this,"ipMappings");u(this,"transportAddresses");u(this,"observedAddressFilter");u(this,"addressVerificationTTL");u(this,"addressVerificationRetry");u(this,rM,"@libp2p/address-manager");const{listen:n=[],announce:i=[],appendAnnounce:s=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=n.map(o=>o.toString()),this.announce=new Set(i.map(o=>o.toString())),this.appendAnnounce=new Set(s.map(o=>o.toString())),this.observed=new QEe(e,t),this.dnsMappings=new VEe(e,t),this.ipMappings=new HEe(e,t),this.transportAddresses=new iSe(e,t),this.announceFilter=t.announceFilter??sSe,this.observedAddressFilter=jl(1024),this.addressVerificationTTL=t.addressVerificationTTL??A$.addressVerificationTTL,this.addressVerificationRetry=t.addressVerificationRetry??A$.addressVerificationRetry,this._updatePeerStoreAddresses=REe(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}_updatePeerStoreAddresses(){const e=this.getAddresses().map(t=>t.getPeerId()===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(t=>{this.log.error("error updating addresses",t)})}getListenAddrs(){return Array.from(this.listen).map(e=>$e(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>$e(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>$e(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){const t=e.stringTuples(),n=`${t[0][1]}:${t[1][1]}`;this.observedAddressFilter.has(n)||(this.observedAddressFilter.add(n),e=j5(e,this.components.peerId),!this.ipMappings.has(e)&&(this.dnsMappings.has(e)||this.observed.add(e)))}confirmObservedAddr(e,t){e=j5(e,this.components.peerId);let n=!0;((t==null?void 0:t.type)==="transport"||this.transportAddresses.has(e))&&!this.transportAddresses.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="dns-mapping"||this.dnsMappings.has(e))&&!this.dnsMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="ip-mapping"||this.ipMappings.has(e))&&!this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="observed"||this.observed.has(e))&&(this.maybeUpgradeToIPMapping(e)?(this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL),n=!1):!this.observed.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1)),n||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=j5(e,this.components.peerId),this.observed.has(e)&&this.observed.remove(e),this.transportAddresses.has(e)&&this.transportAddresses.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.dnsMappings.has(e)&&this.dnsMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.ipMappings.has(e)&&this.ipMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry)}getAddresses(){const e=new Set,t=this.getAddressesWithMetadata().filter(n=>{if(!n.verified)return!1;const i=n.multiaddr.toString();return e.has(i)?!1:(e.add(i),!0)}).map(n=>n.multiaddr);return this.announceFilter(t.map(n=>{var s;const i=$e(n);return((s=i.protos().pop())==null?void 0:s.path)===!0||i.getPeerId()===this.components.peerId.toString()?i:i.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){const e=this.getAnnounceAddrs();if(e.length>0)return this.components.transportManager.getListeners().forEach(i=>{i.updateAnnounceAddrs(e)}),e.map(i=>({multiaddr:i,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];t=t.concat(this.components.transportManager.getAddrs().map(i=>this.transportAddresses.get(i,this.addressVerificationTTL)));const n=this.getAppendAnnounceAddrs();return n.length>0&&(this.components.transportManager.getListeners().forEach(i=>{i.updateAnnounceAddrs(n)}),t=t.concat(n.map(i=>({multiaddr:i,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),t=t.concat(this.observed.getAll()),t=t.concat(this.ipMappings.getAll(t)),t=t.concat(this.dnsMappings.getAll(t)),t}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove($e(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,n,i=t,s="tcp"){this.ipMappings.add(e,t,n,i,s),this.observed.removePrefixed(`/ip${td(n)?4:6}/${n}/${s}/${i}`)}removePublicAddressMapping(e,t,n,i=t,s="tcp"){this.ipMappings.remove($e(`/ip${td(n)?4:6}/${n}/${s}/${i}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(e){if(this.ipMappings.has(e))return!1;const t=e.toOptions();if(t.family===6||t.host==="127.0.0.1"||Rc(t.host)===!0)return!1;const n=this.components.transportManager.getListeners(),i=[s=>J1.exactMatch(s)||zy.exactMatch(s),s=>Fy.exactMatch(s),s=>Ide.exactMatch(s)];for(const s of i){if(!s(e))continue;const o=n.filter(l=>l.getAddrs().filter(h=>h.toOptions().family===4&&s(h)).length>0);if(o.length!==1)continue;const a=o[0].getAddrs().filter(l=>l.toOptions().host!=="127.0.0.1").pop();if(a==null)continue;const c=a.toOptions();return this.observed.remove(e),this.ipMappings.add(c.host,c.port,t.host,t.port,t.transport),!0}return!1}}var C$;(function(r){r.NOT_STARTED_YET="The libp2p node is not started yet",r.NOT_FOUND="Not found"})(C$||(C$={}));class aSe extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}}class cSe extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}}class q5 extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}}class I$ extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}}class lSe extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}}class uSe extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}}class hSe extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}}class k$ extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}}class dSe extends Error{constructor(e="No transport was configured to listen on this address"){super(e),this.name="UnsupportedListenAddressError"}}class fSe extends Error{constructor(e="Configured listen addresses could not be listened on"){super(e),this.name="UnsupportedListenAddressesError"}}class pSe extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}}class gSe extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}}class ySe extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}}class Sg extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}}class xg extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}}class mSe extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}}class wSe{constructor(e={}){u(this,"components",{});u(this,"_started",!1);this.components={};for(const[t,n]of Object.entries(e))this.components[t]=n;this.components.logger==null&&(this.components.logger=ww())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(t=>aS(t)).map(async t=>{var n;await((n=t[e])==null?void 0:n.call(t))}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const bSe=["metrics","connectionProtector","dns"],vSe=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function ESe(r={}){const e=new wSe(r);return new Proxy(e,{get(n,i,s){if(typeof i=="string"&&!vSe.includes(i)){const o=e.components[i];if(o==null&&!bSe.includes(i))throw new aSe(`${i} not set`);return o}return Reflect.get(n,i,s)},set(n,i,s){return typeof i=="string"?e.components[i]=s:Reflect.set(n,i,s),!0}})}function SSe(r){const e={};for(const t of Object.values(r.components))for(const n of xSe(t))e[n]=!0;for(const t of Object.values(r.components))for(const n of ASe(t))if(e[n]!==!0)throw new cSe(`Service "${CSe(t)}" required capability "${n}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function xSe(r){return Array.isArray(r==null?void 0:r[ur])?r[ur]:[]}function ASe(r){return Array.isArray(r==null?void 0:r[mc])?r[mc]:[]}function CSe(r){return(r==null?void 0:r[Symbol.toStringTag])??(r==null?void 0:r.toString())??"unknown"}const ISe=4,kSe=41;function _Se(r={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{if(J1.matches(e))return!1;const t=e.stringTuples();return t[0][0]===ISe||t[0][0]===kSe?!!Rc(`${t[0][1]}`):!1},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...r}}function $j(r){if(qL(r))return{peerId:r,multiaddrs:[]};let e=Array.isArray(r)?r:[r],t;if(e.length>0){const n=e[0].getPeerId();t=n==null?void 0:Wt(n),e.forEach(i=>{if(!Tw(i))throw new Z3("Invalid multiaddr");const s=i.getPeerId();if(s==null){if(t!=null)throw new Z("Multiaddrs must all have the same peer id or have no peer id")}else{const o=Wt(s);if((t==null?void 0:t.equals(o))!==!0)throw new Z("Multiaddrs must all have the same peer id or have no peer id")}})}return e=e.filter(n=>!Sde.exactMatch(n)),{peerId:t,multiaddrs:e}}const TSe=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function PSe(r,e){var i;const t=((i=r==null?void 0:r.streams)==null?void 0:i.map(s=>s.protocol))??[],n=(e==null?void 0:e.closableProtocols)??TSe;if(!(t.filter(s=>s!=null&&!n.includes(s)).length>0))try{await(r==null?void 0:r.close(e))}catch(s){r==null||r.abort(s)}}const Nj=1e4,DSe=1e4,_$=1e4,Mj=25,$Se=5,NSe=10,MSe=5,OSe="last-dial-failure",RSe="last-dial-success",Oj=500,Rj=100,Lj=50;async function LSe(r,e){let t=!1;for(const i of lx.keys())if(t=r.protoNames().includes(i),t)break;if(!t)return[r];const n=await r.resolve(e);return e.log("resolved %s to",r,n.map(i=>i.toString())),n}function A9(r){try{let e;if(typeof r=="string"?e=$e(r):e=r,!e.protoNames().includes("ipcidr")){const n=e.protoNames().includes("ip6")?"/ipcidr/128":"/ipcidr/32";e=e.encapsulate(n)}return f1e(e)}catch{throw new Error(`Can't convert to IpNet, Invalid multiaddr format: ${r}`)}}const BSe={maxConnections:Rj};class USe{constructor(e,t={}){u(this,"maxConnections");u(this,"connectionManager");u(this,"peerStore");u(this,"allow");u(this,"events");u(this,"log");this.maxConnections=t.maxConnections??BSe.maxConnections,this.allow=(t.allow??[]).map(n=>A9(n)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections %e",e)})}async _maybePruneConnections(){const e=this.connectionManager.getConnections(),t=e.length;if(this.log("checking max connections limit %d/%d",t,this.maxConnections),t<=this.maxConnections)return;const n=new Oc;for(const a of e){const c=a.remotePeer;if(!n.has(c)){n.set(c,0);try{const l=await this.peerStore.get(c);n.set(c,[...l.tags.values()].reduce((h,d)=>h+d.value,0))}catch(l){l.name!=="NotFoundError"&&this.log.error("error loading peer tags",l)}}}const i=this.sortConnections(e,n),s=Math.max(t-this.maxConnections,0),o=[];for(const a of i)if(this.log("too many connections open - closing a connection to %p",a.remotePeer),this.allow.some(l=>l.contains(a.remoteAddr.nodeAddress().address))||o.push(a),o.length===s)break;await Promise.all(o.map(async a=>{await PSe(a,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:o})}sortConnections(e,t){return e.sort((n,i)=>{const s=n.timeline.open,o=i.timeline.open;return s<o?1:s>o?-1:0}).sort((n,i)=>n.direction==="outbound"&&i.direction==="inbound"?1:n.direction==="inbound"&&i.direction==="outbound"?-1:0).sort((n,i)=>n.streams.length>i.streams.length?1:n.streams.length<i.streams.length?-1:0).sort((n,i)=>{const s=t.get(n.remotePeer)??0,o=t.get(i.remotePeer)??0;return s>o?1:s<o?-1:0})}}class FSe extends Hl{constructor(e={}){super({...e,sort:(t,n)=>t.options.priority>n.options.priority?-1:t.options.priority<n.options.priority?1:0})}}function zSe(r){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r)||/^::1$/.test(r)}function T$(r){if(!EV(r))return!1;const{address:e}=r.nodeAddress();return zSe(e)}function VSe(r,e){const t=Fy.exactMatch(r.multiaddr),n=Fy.exactMatch(e.multiaddr);if(t&&!n)return-1;if(!t&&n)return 1;const i=zy.exactMatch(r.multiaddr),s=zy.exactMatch(e.multiaddr);if(i&&!s)return-1;if(!i&&s)return 1;const o=J1.exactMatch(r.multiaddr),a=J1.exactMatch(e.multiaddr);if(o&&!a)return-1;if(!o&&a)return 1;const c=iv.exactMatch(r.multiaddr),l=iv.exactMatch(e.multiaddr);if(c&&!l)return-1;if(!c&&l)return 1;const h=nv.exactMatch(r.multiaddr),d=nv.exactMatch(e.multiaddr);if(h&&!d)return-1;if(!h&&d)return 1;const p=w_.exactMatch(r.multiaddr),m=w_.exactMatch(e.multiaddr);return p&&!m?-1:!p&&m?1:0}function KSe(r,e){const t=T$(r.multiaddr),n=T$(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function HSe(r,e){const t=Ql(r.multiaddr),n=Ql(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function jSe(r,e){return r.isCertified&&!e.isCertified?-1:!r.isCertified&&e.isCertified?1:0}function qSe(r,e){const t=Sc.exactMatch(r.multiaddr),n=Sc.exactMatch(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function WSe(r){return r.sort(VSe).sort(jSe).sort(qSe).sort(HSe).sort(KSe)}const Ag={maxParallelDials:Lj,maxDialQueueLength:Oj,maxPeerAddrsToDial:Mj,dialTimeout:Nj};class GSe{constructor(e,t={}){u(this,"queue");u(this,"components");u(this,"addressSorter");u(this,"maxPeerAddrsToDial");u(this,"maxDialQueueLength");u(this,"dialTimeout");u(this,"shutDownController");u(this,"connections");u(this,"log");this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??Ag.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??Ag.maxDialQueueLength,this.dialTimeout=t.dialTimeout??Ag.dialTimeout,this.connections=t.connections??new Oc,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.shutDownController=new AbortController,this.shutDownController.signal;for(const[n,i]of Object.entries(t.resolvers??{}))lx.set(n,i);this.queue=new FSe({concurrency:t.maxParallelDials??Ag.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",n=>{var i;((i=n.detail)==null?void 0:i.name)!==zl.name&&this.log.error("error in dial queue - %e",n.detail)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e,t={}){var a,c,l;const{peerId:n,multiaddrs:i}=$j(e),s=Array.from(this.connections.values()).flat().find(h=>t.force===!0?!1:h.remotePeer.equals(n)?!0:i.find(d=>d.equals(h.remoteAddr)));if((s==null?void 0:s.status)==="open")return this.log("already connected to %a",s.remoteAddr),(a=t.onProgress)==null||a.call(t,new Ie("dial-queue:already-connected")),s;const o=this.queue.queue.find(h=>{if((n==null?void 0:n.equals(h.options.peerId))===!0)return!0;const d=h.options.multiaddrs;if(d==null)return!1;for(const p of i)if(d.has(p.toString()))return!0;return!1});if(o!=null){this.log("joining existing dial target for %p",n);for(const h of i)o.options.multiaddrs.add(h.toString());return(c=t.onProgress)==null||c.call(t,new Ie("dial-queue:already-in-dial-queue")),o.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new fh("Dial queue is full");return this.log("creating dial target for %p",n,i.map(h=>h.toString())),(l=t.onProgress)==null||l.call(t,new Ie("dial-queue:add-to-dial-queue")),this.queue.add(async h=>{var p;(p=h.onProgress)==null||p.call(h,new Ie("dial-queue:start-dial"));const d=ct([this.shutDownController.signal,h.signal]);try{return await this.dialPeer(h,d)}finally{d.clear()}},{peerId:n,priority:t.priority??Uj,multiaddrs:new Set(i.map(h=>h.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})}async dialPeer(e,t){var h;const n=e.peerId,i=e.multiaddrs,s=new Set;let o=e.multiaddrs.size===0,a=0,c=0;const l=[];for(this.log("starting dial to %p",n);o||i.size>0;){c++,o=!1;const d=[],p=new Set(e.multiaddrs);i.clear(),this.log("calculating addrs to dial %p from %s",n,[...p]);const m=await this.calculateMultiaddrs(n,p,{...e,signal:t});for(const f of m){if(s.has(f.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",f.multiaddr,n);continue}d.push(f)}this.log("%s dial to %p with %s",c===1?"starting":"continuing",n,d.map(f=>f.multiaddr.toString())),(h=e==null?void 0:e.onProgress)==null||h.call(e,new Ie("dial-queue:calculated-addresses",d));for(const f of d){if(a===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",a,e.peerId),new fh("Peer had more than maxPeerAddrsToDial");a++;try{const g=await this.components.transportManager.dial(f.multiaddr,{...e,signal:t});this.log("dial to %a succeeded",f.multiaddr);try{await this.components.peerStore.merge(g.remotePeer,{multiaddrs:[g.remoteAddr],metadata:{[RSe]:se(Date.now().toString())}})}catch(v){this.log.error("could not update last dial failure key for %p",n,v)}return g}catch(g){if(this.log.error("dial failed to %a",f.multiaddr,g),s.add(f.multiaddr.toString()),n!=null)try{await this.components.peerStore.merge(n,{metadata:{[OSe]:se(Date.now().toString())}})}catch(v){this.log.error("could not update last dial failure key for %p",n,v)}if(t.aborted)throw new Bp(g.message);l.push(g)}}}throw l.length===1?l[0]:new AggregateError(l,"All multiaddr dials failed")}async calculateMultiaddrs(e,t=new Set,n={}){var d,p;const i=[...t].map(m=>({multiaddr:$e(m),isCertified:!1}));if(e!=null){if(this.components.peerId.equals(e))throw new fh("Tried to dial self");if(await((p=(d=this.components.connectionGater).denyDialPeer)==null?void 0:p.call(d,e))===!0)throw new k$("The dial request is blocked by gater.allowDialPeer");if(i.length===0){this.log("loading multiaddrs for %p",e);try{const m=await this.components.peerStore.get(e);i.push(...m.addresses),this.log("loaded multiaddrs for %p",e,i.map(({multiaddr:f})=>f.toString()))}catch(m){if(m.name!=="NotFoundError")throw m}}if(i.length===0){this.log("looking up multiaddrs for %p in the peer routing",e);try{const m=await this.components.peerRouting.findPeer(e,n);this.log("found multiaddrs for %p in the peer routing",e,i.map(({multiaddr:f})=>f.toString())),i.push(...m.multiaddrs.map(f=>({multiaddr:f,isCertified:!1})))}catch(m){m.name==="NoPeerRoutersError"?this.log("no peer routers configured",e):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",e,m)}}}let s=(await Promise.all(i.map(async m=>{const f=await LSe(m.multiaddr,{dns:this.components.dns,...n,log:this.log});return f.length===1&&f[0].equals(m.multiaddr)?m:f.map(g=>({multiaddr:g,isCertified:!1}))}))).flat();if(e!=null){const m=`/p2p/${e.toString()}`;s=s.map(f=>{const g=f.multiaddr.protos().pop();return(g==null?void 0:g.path)===!0?f:f.multiaddr.getPeerId()==null?{multiaddr:f.multiaddr.encapsulate(m),isCertified:f.isCertified}:f})}const o=s.filter(m=>{if(this.components.transportManager.dialTransportForMultiaddr(m.multiaddr)==null)return!1;const f=m.multiaddr.getPeerId();return e!=null&&f!=null?e.equals(f):!0}),a=new Map;for(const m of o){const f=m.multiaddr.toString(),g=a.get(f);if(g!=null){g.isCertified=g.isCertified||m.isCertified||!1;continue}a.set(f,m)}const c=[...a.values()];if(c.length===0)throw new pSe("The dial request has no valid addresses");const l=[];for(const m of c)this.components.connectionGater.denyDialMultiaddr!=null&&await this.components.connectionGater.denyDialMultiaddr(m.multiaddr)||l.push(m);const h=this.addressSorter==null?WSe(l):l.sort(this.addressSorter);if(h.length===0)throw new k$("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",s.map(({multiaddr:m})=>m.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",h.map(({multiaddr:m})=>m.toString())),h}async isDialable(e,t={}){Array.isArray(e)||(e=[e]);try{const n=await this.calculateMultiaddrs(void 0,new Set(e.map(i=>i.toString())),t);return t.runOnLimitedConnection===!1?n.find(i=>!Sc.matches(i.multiaddr))!=null:!0}catch(n){this.log.trace("error calculating if multiaddr(s) were dialable",n)}return!1}}var Bj={};function Ni(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var QSe=Ni;Ni.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Ni.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Ni.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};Ni.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Ni.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};Ni.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};Ni.prototype.start=Ni.prototype.try;Ni.prototype.errors=function(){return this._errors};Ni.prototype.attempts=function(){return this._attempts};Ni.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var i=this._errors[n],s=i.message,o=(r[s]||0)+1;r[s]=o,o>=t&&(e=i,t=o)}return e};(function(r){var e=QSe;r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in t)n[i]=t[i];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],o=0;o<n.retries;o++)s.push(this.createTimeout(o,n));return t&&t.forever&&!s.length&&s.push(this.createTimeout(o,n)),s.sort(function(a,c){return a-c}),s},r.createTimeout=function(t,n){var i=n.randomize?Math.random()+1:1,s=Math.round(i*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return s=Math.min(s,n.maxTimeout),s},r.wrap=function(t,n,i){if(n instanceof Array&&(i=n,n=null),!i){i=[];for(var s in t)typeof t[s]=="function"&&i.push(s)}for(var o=0;o<i.length;o++){var a=i[o],c=t[a];t[a]=(function(h){var d=r.operation(n),p=Array.prototype.slice.call(arguments,1),m=p.pop();p.push(function(f){d.retry(f)||(f&&(arguments[0]=d.mainError()),m.apply(this,arguments))}),d.attempt(function(){h.apply(t,p)})}).bind(t,c),t[a].options=n}}})(Bj);var YSe=Bj;const XSe=Vo(YSe),JSe=Object.prototype.toString,ZSe=r=>JSe.call(r)==="[object Error]",exe=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function txe(r){return r&&ZSe(r)&&r.name==="TypeError"&&typeof r.message=="string"?r.message==="Load failed"?r.stack===void 0:exe.has(r.message):!1}class rxe extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const P$=(r,e,t)=>{const n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r};async function nxe(r,e){return new Promise((t,n)=>{e={...e},e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.retries??(e.retries=10);const i=XSe.operation(e),s=()=>{var a;i.stop(),n((a=e.signal)==null?void 0:a.reason)};e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",s,{once:!0});const o=()=>{var a;(a=e.signal)==null||a.removeEventListener("abort",s),i.stop()};i.attempt(async a=>{try{const c=await r(a);o(),t(c)}catch(c){try{if(!(c instanceof Error))throw new TypeError(`Non-error was thrown: "${c}". You should only throw errors.`);if(c instanceof rxe)throw c.originalError;if(c instanceof TypeError&&!txe(c))throw c;if(P$(c,a,e),await e.shouldRetry(c)||(i.stop(),n(c)),await e.onFailedAttempt(c),!i.retry(c))throw i.mainError()}catch(l){P$(l,a,e),o(),n(l)}}})})}class ixe{constructor(e,t={}){u(this,"log");u(this,"queue");u(this,"started");u(this,"peerStore");u(this,"retries");u(this,"retryInterval");u(this,"backoffFactor");u(this,"connectionManager");u(this,"events");this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new vc({concurrency:t.maxParallelReconnects??MSe,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",n=>{this.maybeReconnect(n.detail).catch(i=>{this.log.error("failed to maybe reconnect to %p - %e",n.detail,i)})})}async maybeReconnect(e){if(!this.started)return;const t=await this.peerStore.get(e);D$(t)&&(this.queue.has(e)||this.queue.add(async n=>{await nxe(async i=>{if(this.started)try{await this.connectionManager.openConnection(e,{signal:n==null?void 0:n.signal})}catch(s){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,i,this.retries,s),s}},{signal:n==null?void 0:n.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:e}).catch(async n=>{this.log.error("failed to reconnect to %p - %e",e,n);const i={};[...t.tags.keys()].forEach(s=>{s.startsWith(X3)&&(i[s]=void 0)}),await this.peerStore.merge(e,{tags:i}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})}).catch(async n=>{this.log.error("failed to remove keep-alive tag from %p - %e",e,n)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[t=>D$(t)]});await Promise.all(e.map(async t=>{await this.connectionManager.openConnection(t.id).catch(n=>{this.log.error(n)})}))}).catch(e=>{this.log.error(e)})}stop(){this.started=!1,this.queue.abort()}}function D$(r){for(const e of r.tags.keys())if(e.startsWith(X3))return!0;return!1}const Uj=50,W5={maxConnections:Rj,inboundConnectionThreshold:$Se,maxIncomingPendingConnections:NSe};var nM;nM=Symbol.toStringTag;class sxe{constructor(e,t={}){u(this,"started");u(this,"connections");u(this,"allow");u(this,"deny");u(this,"maxIncomingPendingConnections");u(this,"incomingPendingConnections");u(this,"outboundPendingConnections");u(this,"maxConnections");u(this,"dialQueue");u(this,"reconnectQueue");u(this,"connectionPruner");u(this,"inboundConnectionRateLimiter");u(this,"peerStore");u(this,"metrics");u(this,"events");u(this,"log");u(this,"peerId");u(this,nM,"@libp2p/connection-manager");var n;if(this.maxConnections=t.maxConnections??W5.maxConnections,this.maxConnections<1)throw new Z("Connection Manager maxConnections must be greater than 0");this.connections=new Oc,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(i=>A9(i)),this.deny=(t.deny??[]).map(i=>A9(i)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??W5.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new uH({points:t.inboundConnectionThreshold??W5.inboundConnectionThreshold,duration:1}),this.connectionPruner=new USe({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{maxConnections:this.maxConnections,allow:(n=t.allow)==null?void 0:n.map(i=>$e(i))}),this.dialQueue=new GSe(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??Lj,maxDialQueueLength:t.maxDialQueueLength??Oj,maxPeerAddrsToDial:t.maxPeerAddrsToDial??Mj,dialTimeout:t.dialTimeout??Nj,resolvers:t.resolvers??{dnsaddr:Sj},connections:this.connections}),this.reconnectQueue=new ixe({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}async start(){var e,t,n;(e=this.metrics)==null||e.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const i={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(const s of this.connections.values())for(const o of s)i[o.direction]++;return i}}),(t=this.metrics)==null||t.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const i={};for(const s of this.connections.values())for(const o of s)for(const a of o.streams){const c=`${a.direction} ${a.protocol??"unnegotiated"}`;i[c]=(i[c]??0)+1}return i}}),(n=this.metrics)==null||n.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const i={};for(const o of this.connections.values())for(const a of o){const c={};for(const l of a.streams){const h=`${l.direction} ${l.protocol??"unnegotiated"}`;c[h]=(c[h]??0)+1}for(const[l,h]of Object.entries(c))i[l]=i[l]??[],i[l].push(h)}const s={};for(let[o,a]of Object.entries(i)){a=a.sort((l,h)=>l-h);const c=Math.floor(a.length*.9);s[o]=a[c]}return s}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await Oo(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await Nc(this.reconnectQueue,this.dialQueue,this.connectionPruner);const e=[];for(const t of this.connections.values())for(const n of t)e.push((async()=>{try{await n.close()}catch(i){this.log.error(i)}})());this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}onConnect(e){this._onConnect(e).catch(t=>{this.log.error(t)})}async _onConnect(e){const{detail:t}=e;if(!this.started){await t.close();return}if(t.status!=="open")return;const n=t.remotePeer,i=!this.connections.has(n),s=this.connections.get(n)??[];s.push(t),this.connections.set(n,s),n.publicKey!=null&&n.type==="RSA"&&await this.peerStore.patch(n,{publicKey:n.publicKey}),i&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){const{detail:t}=e,n=t.remotePeer,s=(this.connections.get(n)??[]).filter(o=>o.id!==t.id);this.connections.set(n,s),s.length===0&&(this.log("onDisconnect remove all connections for peer %p",n),this.connections.delete(n),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let t=[];for(const n of this.connections.values())t=t.concat(n);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){var n,i;if(!this.started)throw new Vl("Not started");this.outboundPendingConnections++;try{(n=t.signal)==null||n.throwIfAborted();const{peerId:s}=$j(e);if(this.peerId.equals(s))throw new sS("Can not dial self");if(s!=null&&t.force!==!0){this.log("dial %p",s);const l=this.getConnections(s).find(h=>h.limits==null);if(l!=null)return this.log("had an existing non-limited connection to %p",s),(i=t.onProgress)==null||i.call(t,new Ie("dial-queue:already-connected")),l}const o=await this.dialQueue.dial(e,{...t,priority:t.priority??Uj});if(o.status!=="open")throw new nS("Remote closed connection during opening");let a=this.connections.get(o.remotePeer);a==null&&(a=[],this.connections.set(o.remotePeer,a));let c=!1;for(const l of a)if(l.id===o.id&&(c=!0),t.force!==!0&&l.id!==o.id&&l.remoteAddr.equals(o.remoteAddr))return o.abort(new Z3("Duplicate multiaddr connection")),l;return c||a.push(o),o}finally{this.outboundPendingConnections--}}async closeConnections(e,t={}){const n=this.connections.get(e)??[];await Promise.all(n.map(async i=>{try{await i.close(t)}catch(s){i.abort(s)}}))}async acceptIncomingConnection(e){if(this.deny.some(i=>i.contains(e.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(i=>i.contains(e.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const i=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(i,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,i),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(n=>$e(n))}))}async isDialable(e,t={}){return this.dialQueue.isDialable(e,t)}}const oxe=1e4,axe="1.0.0",cxe="ping",lxe="ipfs",$$=32,uxe=!0;var iM,sM;sM=Symbol.toStringTag,iM=ur;class hxe{constructor(e,t={}){u(this,"protocol");u(this,"components");u(this,"log");u(this,"heartbeatInterval");u(this,"pingIntervalMs");u(this,"abortController");u(this,"timeout");u(this,"abortConnectionOnPingFailure");u(this,sM,"@libp2p/connection-monitor");u(this,iM,["@libp2p/connection-monitor"]);this.components=e,this.protocol=`/${t.protocolPrefix??lxe}/${cxe}/${axe}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??oxe,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??uxe,this.timeout=new ip({...t.pingTimeout??{},metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(async()=>{var n;let t=Date.now();try{const i=this.timeout.getTimeoutSignal({signal:(n=this.abortController)==null?void 0:n.signal}),s=await e.newStream(this.protocol,{signal:i,runOnLimitedConnection:!0}),o=sm(s);t=Date.now(),await Promise.all([o.write(bc($$),{signal:i}),o.read({bytes:$$,signal:i})]),e.rtt=Date.now()-t,await o.unwrap().close({signal:i})}catch(i){if(i.name!=="UnsupportedProtocolError")throw i;e.rtt=(Date.now()-t)/2}}).catch(t=>{this.log.error("error during heartbeat",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){var e;(e=this.abortController)==null||e.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}}var oM;oM=Symbol.toStringTag;class dxe{constructor(e,t){u(this,"routers");u(this,"started");u(this,"components");u(this,oM,"@libp2p/content-routing");var n,i,s,o,a;this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()}),getAttributesFromYieldedValue:(c,l)=>({...l,providers:[...Array.isArray(l.providers)?l.providers:[],c.id.toString()]})}))??this.findProviders,this.provide=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.provide,this.cancelReprovide=((s=e.metrics)==null?void 0:s.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.cancelReprovide,this.put=((o=e.metrics)==null?void 0:o.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([c])=>({key:re(c,"base36")})}))??this.put,this.get=((a=e.metrics)==null?void 0:a.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([c])=>({key:re(c,"base36")})}))??this.get}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw new q5("No content routers available");const n=this,i=new is;for await(const s of ic(...n.routers.map(o=>o.findProviders(e,t))))s!=null&&(s.multiaddrs.length>0&&await this.components.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),!i.has(s.id)&&(i.add(s.id),yield s))}async provide(e,t={}){if(this.routers.length===0)throw new q5("No content routers available");await Promise.all(this.routers.map(async n=>{await n.provide(e,t)}))}async cancelReprovide(e,t={}){if(this.routers.length===0)throw new q5("No content routers available");await Promise.all(this.routers.map(async n=>{await n.cancelReprovide(e,t)}))}async put(e,t,n){if(!this.isStarted())throw new Vl;await Promise.all(this.routers.map(async i=>{await i.put(e,t,n)}))}async get(e,t){if(!this.isStarted())throw new Vl;return Promise.any(this.routers.map(async n=>n.get(e,t)))}}var aM;aM=Symbol.toStringTag;class fxe{constructor(e,t={}){u(this,"log");u(this,"peerId");u(this,"peerStore");u(this,"routers");u(this,aM,"@libp2p/peer-routing");var n,i;this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([s],o)=>({...o,peer:s.toString()})}))??this.findPeer,this.getClosestPeers=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([s],o)=>({...o,key:re(s,"base36")}),getAttributesFromYieldedValue:(s,o)=>({...o,peers:[...Array.isArray(o.peers)?o.peers:[],s.id.toString()]})}))??this.getClosestPeers}async findPeer(e,t){if(this.routers.length===0)throw new I$("No peer routers available");if(e.toString()===this.peerId.toString())throw new lSe("Should not try to find self");const n=this,i=ic(...this.routers.map(s=>async function*(){try{yield await s.findPeer(e,t)}catch(o){n.log.error(o)}}()));for await(const s of i)if(s!=null)return s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),s;throw new Qt}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new I$("No peer routers available");const n=this,i=jl(1024);for await(const s of Gp(async function*(){const o=ic(...n.routers.map(a=>a.getClosestPeers(e,t)));for await(let a of o)yield async()=>{if(a.multiaddrs.length===0)try{a=await n.findPeer(a.id,{...t,useCache:!1})}catch(c){n.log.error("could not find peer multiaddrs",c);return}return a}}()))s!=null&&(s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),!i.has(s.id.toMultihash().bytes)&&(i.add(s.id.toMultihash().bytes),yield s))}}var cM,lM;class pxe extends(lM=Yt,cM=Symbol.toStringTag,lM){constructor(t){super();u(this,"peerRouting");u(this,"log");u(this,"walking");u(this,"walkers");u(this,"shutdownController");u(this,"walkController");u(this,"needNext");u(this,cM,"@libp2p/random-walk");this.log=t.logger.forComponent("libp2p:random-walk"),this.peerRouting=t.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}async*walk(t){var i,s;this.walking||this.startWalk(),this.walkers++;const n=ct([this.shutdownController.signal,t==null?void 0:t.signal]);try{for(;;)(i=this.needNext)==null||i.resolve(),this.needNext=Oe(),yield(await xi(this,"walk:peer",n,{errorEvent:"walk:error"})).detail}finally{n.clear(),this.walkers--,this.walkers===0&&((s=this.walkController)==null||s.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;const t=ct([this.walkController.signal,this.shutdownController.signal]),n=Date.now();let i=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const s=bc(32);let o=Date.now();for await(const a of this.peerRouting.getClosestPeers(s,{signal:t}))t.aborted&&this.log("aborting walk"),t.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",a.id,Date.now()-o,this.walkers),i++,this.safeDispatchEvent("walk:peer",{detail:a}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),await nn(this.needNext.promise,t)),o=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",s,this.walkers,i)}catch(s){this.log.error("random walk errored",s),this.safeDispatchEvent("walk:error",{detail:s})}this.log("no walkers left, ended walk")}).catch(s=>{this.log.error("random walk errored",s)}).finally(()=>{this.log("finished walk, found %d peers after %dms",i,Date.now()-n),this.walking=!1})}}const Fj=32,zj=64;var uM;uM=Symbol.toStringTag;class gxe{constructor(e){u(this,"log");u(this,"topologies");u(this,"handlers");u(this,"components");u(this,uM,"@libp2p/registrar");this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(t==null)throw new uSe(`No handler registered for protocol ${e}`);return t}getTopologies(e){const t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,n){if(this.handlers.has(e)&&(n==null?void 0:n.force)!==!0)throw new hSe(`Handler already registered for protocol ${e}`);const i=Px.bind({ignoreUndefined:!0})({maxInboundStreams:Fj,maxOutboundStreams:zj},n);this.handlers.set(e,{handler:t,options:i}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]})}async unhandle(e){(Array.isArray(e)?e:[e]).forEach(n=>{this.handlers.delete(n)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(e,t){if(t==null)throw new Z("invalid topology");const n=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let i=this.topologies.get(e);return i==null&&(i=new Map,this.topologies.set(e,i)),i.set(n,t),n}unregister(e){for(const[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),n.size===0&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail;this.components.peerStore.get(t).then(n=>{var i,s,o;for(const a of n.protocols){const c=this.topologies.get(a);if(c!=null)for(const l of c.values())((i=l.filter)==null?void 0:i.has(t))!==!1&&((s=l.filter)==null||s.remove(t),(o=l.onDisconnect)==null||o.call(l,t))}}).catch(n=>{n.name!=="NotFoundError"&&this.log.error("could not inform topologies of disconnecting peer %p",t,n)})}_onPeerUpdate(e){var s,o,a;const{peer:t,previous:n}=e.detail,i=((n==null?void 0:n.protocols)??[]).filter(c=>!t.protocols.includes(c));for(const c of i){const l=this.topologies.get(c);if(l!=null)for(const h of l.values())((s=h.filter)==null?void 0:s.has(t.id))!==!1&&((o=h.filter)==null||o.remove(t.id),(a=h.onDisconnect)==null||a.call(h,t.id))}}_onPeerIdentify(e){var s,o,a;const t=e.detail.protocols,n=e.detail.connection,i=e.detail.peerId;for(const c of t){const l=this.topologies.get(c);if(l!=null)for(const h of l.values())n.limits!=null&&h.notifyOnLimitedConnection!==!0||((s=h.filter)==null?void 0:s.has(i))!==!0&&((o=h.filter)==null||o.add(i),(a=h.onConnect)==null||a.call(h,i,n))}}}var hM;hM=Symbol.toStringTag;class yxe{constructor(e,t={}){u(this,"log");u(this,"components");u(this,"transports");u(this,"listeners");u(this,"faultTolerance");u(this,"started");u(this,hM,"@libp2p/transport-manager");this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=new Map,this.listeners=zF({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??Hh.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(t==null)throw new Z("Transport must have a valid tag");if(this.transports.has(t))throw new Z(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[t,n]of this.listeners)for(this.log("closing listeners for %s",t);n.length>0;){const i=n.pop();i!=null&&e.push(i.close())}await Promise.all(e),this.log("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){var i;const n=this.dialTransportForMultiaddr(e);if(n==null)throw new mSe(`No transport available for address ${String(e)}`);return(i=t==null?void 0:t.onProgress)==null||i.call(t,new Ie("transport-manager:selected-transport",n[Symbol.toStringTag])),n.dial(e,{...t,upgrader:this.components.upgrader})}getAddrs(){let e=[];for(const t of this.listeners.values())for(const n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(const t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(const t of this.transports.values())if(t.listenFilter([e]).length>0)return t}async listen(e){if(!this.isStarted())throw new Vl("Not started");if(e==null||e.length===0){this.log("no addresses were provided for listening, this node is dial only");return}const t={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};e.forEach(s=>{t.errors.set(s.toString(),new dSe)});const n=[];for(const[s,o]of this.transports.entries()){const a=o.listenFilter(e);for(const c of a){this.log("creating listener for %s on %a",s,c);const l=o.createListener({upgrader:this.components.upgrader});let h=this.listeners.get(s)??[];h==null&&(h=[],this.listeners.set(s,h)),h.push(l),l.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:l})}),l.addEventListener("close",()=>{const d=h.findIndex(p=>p===l);h.splice(d,1),this.components.events.safeDispatchEvent("transport:close",{detail:l})}),y_.matches(c)?t.ipv4.attempts++:m_.matches(c)&&t.ipv6.attempts++,n.push(l.listen(c).then(()=>{t.errors.delete(c.toString()),y_.matches(c)&&t.ipv4.success++,m_.matches(c)&&t.ipv6.success++},d=>{throw this.log.error("transport %s could not listen on address %a - %e",s,c,d),t.errors.set(c.toString(),d),d}))}}const i=await Promise.allSettled(n);if(!(i.length>0&&i.every(s=>s.status==="fulfilled"))){if(this.ipv6Unsupported(t)){this.log("all IPv4 addresses succeed but all IPv6 failed");return}if(this.faultTolerance===Hh.NO_FATAL){this.log("failed to listen on any address but fault tolerance allows this");return}throw new fSe(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...t.errors.entries()].map(([s,o])=>`
  ${s}: ${`${o.stack??o}`.split(`
`).join(`
  `)}
`).join("")}`)}}ipv6Unsupported(e){if(e.ipv4.attempts===0||e.ipv6.attempts===0)return!1;const t=e.ipv4.attempts===e.ipv4.success,n=e.ipv6.success===0;return t&&n}async remove(e){const t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);const n=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){const i=t.pop();i!=null&&n.push(i.close())}await Promise.all(n),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}const vn="/multistream/1.0.0",TA=1024,mxe=se(`
`);async function Qf(r,e,t){await r.write(e,t)}async function wxe(r,e,t){await r.writeV(e,t)}async function bxe(r,e){const t=await r.read(e);if(t.byteLength===0||t.get(t.byteLength-1)!==mxe[0])throw e.log.error("Invalid mss message - missing newline",t),new wt("Missing newline");return t.sublist(0,-1)}async function Sh(r,e){const t=await bxe(r,e);return re(t.subarray())}async function G5(r,e,t){if(e=Array.isArray(e)?[...e]:[e],e.length===1&&t.negotiateFully===!1)return vxe(r,e[0],t);const n=rd(r,{...t,maxDataLength:TA}),i=e.shift();if(i==null)throw new Error("At least one protocol must be specified");t.log.trace('select: write ["%s", "%s"]',vn,i);const s=se(`${vn}
`),o=se(`${i}
`);await wxe(n,[s,o],t),t.log.trace("select: reading multistream-select header");let a=await Sh(n,t);if(t.log.trace('select: read "%s"',a),a===vn&&(t.log.trace("select: reading protocol response"),a=await Sh(n,t),t.log.trace('select: read "%s"',a)),a===i)return{stream:n.unwrap(),protocol:i};for(const c of e){t.log.trace('select: write "%s"',c),await Qf(n,se(`${c}
`),t),t.log.trace("select: reading protocol response");const l=await Sh(n,t);if(t.log.trace('select: read "%s" for "%s"',l,c),l===c)return{stream:n.unwrap(),protocol:c}}throw new Lp("protocol selection failed")}function vxe(r,e,t){const n=r.sink.bind(r),i=r.source;let s=!1,o=!1;const a=Oe();let c=!1,l=!1;const h=Oe();let d=!1,p=!1;const m=Oe(),f=rd({sink:n,source:i},{...t,maxDataLength:TA});r.sink=async w=>{const{sink:b}=f.unwrap();await b(async function*(){let E=!1;for await(const C of w){if(l&&await h.promise,c)yield C;else{l=!0,t.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',vn,e,C.byteLength);const k=`${e}
`;yield new Le(Uint8Array.from([19]),se(`${vn}
`),br(k.length),se(k),C).subarray(),t.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',vn,e,C.byteLength),c=!0,l=!1,h.resolve(),g().catch(x=>{t.log.error("could not finish optimistic protocol negotiation of %s",e,x)})}E=!0}E||await g()}())};async function g(){if(o){t.log.trace("optimistic: already negotiating %s stream",e),await a.promise;return}o=!0;try{c||(t.log.trace("optimistic: doing send protocol for %s stream",e),await v()),d||(t.log.trace("optimistic: doing read protocol for %s stream",e),await y())}finally{o=!1,s=!0,a.resolve()}}async function v(){if(l){await h.promise;return}l=!0;try{t.log.trace('optimistic: write ["%s", "%s", data] in source',vn,e),await f.writeV([se(`${vn}
`),se(`${e}
`)]),t.log.trace('optimistic: wrote ["%s", "%s", data] in source',vn,e)}finally{c=!0,l=!1,h.resolve()}}async function y(){if(p){await m.promise;return}p=!0;try{t.log.trace("optimistic: reading multistream select header");let w=await Sh(f,t);if(t.log.trace('optimistic: read multistream select header "%s"',w),w===vn&&(w=await Sh(f,t)),t.log.trace('optimistic: read protocol "%s", expecting "%s"',w,e),w!==e)throw new Lp("protocol selection failed")}finally{d=!0,p=!1,m.resolve()}}if(r.source=async function*(){await g(),t.log.trace('optimistic: reading data from "%s" stream',e),yield*f.unwrap().source}(),r.closeRead!=null){const w=r.closeRead.bind(r);r.closeRead=async b=>{s||await g().catch(E=>{t.log.error("could not negotiate protocol before close read",E)}),await w(b)}}if(r.closeWrite!=null){const w=r.closeWrite.bind(r);r.closeWrite=async b=>{s||await g().catch(E=>{t.log.error("could not negotiate protocol before close write",E)}),await w(b)}}if(r.close!=null){const w=r.close.bind(r);r.close=async b=>{const E=[];l&&E.push(h.promise),p&&E.push(m.promise),E.length>0?await nn(Promise.all(E),b==null?void 0:b.signal):(s=!0,o=!1,a.resolve()),await w(b)}}return{stream:r,protocol:e}}async function Q5(r,e,t){e=Array.isArray(e)?e:[e],t.log.trace("handle: available protocols %s",e);const n=rd(r,{...t,maxDataLength:TA,maxLengthLength:2});for(;;){t.log.trace("handle: reading incoming string");const i=await Sh(n,t);if(t.log.trace('handle: read "%s"',i),i===vn){t.log.trace('handle: respond with "%s" for "%s"',vn,i),await Qf(n,se(`${vn}
`),t),t.log.trace('handle: responded with "%s" for "%s"',vn,i);continue}if(e.includes(i))return t.log.trace('handle: respond with "%s" for "%s"',i,i),await Qf(n,se(`${i}
`),t),t.log.trace('handle: responded with "%s" for "%s"',i,i),{stream:n.unwrap(),protocol:i};if(i==="ls"){const s=new Le(...e.map(o=>Gh.single(se(`${o}
`))),se(`
`));t.log.trace('handle: respond with "%s" for %s',e,i),await Qf(n,s,t),t.log.trace('handle: responded with "%s" for %s',e,i);continue}t.log.trace('handle: respond with "na" for "%s"',i),await Qf(n,se(`na
`),t),t.log('handle: responded with "na" for "%s"',i)}}const Exe=500;var dM,fM;fM=Symbol.toStringTag,dM=PZ;class Sxe{constructor(e){u(this,"id");u(this,"remoteAddr");u(this,"remotePeer");u(this,"direction");u(this,"timeline");u(this,"multiplexer");u(this,"encryption");u(this,"status");u(this,"limits");u(this,"log");u(this,"tags");u(this,"_newStream");u(this,"_close");u(this,"_abort");u(this,"_getStreams");u(this,fM,"Connection");u(this,dM,!0);const{remoteAddr:t,remotePeer:n,newStream:i,close:s,abort:o,getStreams:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=n,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.limits=e.limits,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=i,this._close=s,this._abort=o,this._getStreams=a,this.tags=[]}get streams(){return this._getStreams()}async newStream(e,t){if(this.status==="closing")throw new GL("the connection is being closed");if(this.status==="closed")throw new nS("the connection is closed");if(Array.isArray(e)||(e=[e]),this.limits!=null&&(t==null?void 0:t.runOnLimitedConnection)!==!0)throw new oS("Cannot open protocol stream on limited connection");const n=await this._newStream(e,t);return n.direction="outbound",n}async close(e={}){if(!(this.status==="closed"||this.status==="closing")){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",e.signal==null){const t=AbortSignal.timeout(Exe);e={...e,signal:t}}try{this.log.trace("closing underlying transport"),await this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(t){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,t),this.abort(t)}}}abort(e){this.status!=="closed"&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this._abort(e),this.status="closed",this.timeline.close=Date.now())}}function xxe(r){return new Sxe(r)}function Axe(r,e){try{const{options:t}=e.getHandler(r);return t.maxInboundStreams}catch(t){if(t.name!=="UnhandledProtocolError")throw t}return Fj}function Cxe(r,e,t={}){try{const{options:n}=e.getHandler(r);if(n.maxOutboundStreams!=null)return n.maxOutboundStreams}catch(n){if(n.name!=="UnhandledProtocolError")throw n}return t.maxOutboundStreams??zj}function N$(r,e,t){let n=0;return t.streams.forEach(i=>{i.direction===e&&i.protocol===r&&n++}),n}var pM;pM=Symbol.toStringTag;class Ixe{constructor(e,t){u(this,"components");u(this,"connectionEncrypters");u(this,"streamMuxers");u(this,"inboundUpgradeTimeout");u(this,"inboundStreamProtocolNegotiationTimeout");u(this,"outboundStreamProtocolNegotiationTimeout");u(this,"events");u(this,"metrics");u(this,pM,"@libp2p/upgrader");var n,i;this.components=e,this.connectionEncrypters=new Map,t.connectionEncrypters.forEach(s=>{this.connectionEncrypters.set(s.protocol,s)}),this.streamMuxers=new Map,t.streamMuxers.forEach(s=>{this.streamMuxers.set(s.protocol,s)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??DSe,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??_$,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??_$,this.events=e.events,this.metrics={dials:(n=e.metrics)==null?void 0:n.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:(i=e.metrics)==null?void 0:i.registerCounterGroup("libp2p_connection_manager_dial_errors_total")}}async shouldBlockConnection(e,...t){const n=this.components.connectionGater[e];if(n==null)return;if(await n.apply(this.components.connectionGater,t)===!0)throw new gSe(`The multiaddr connection is blocked by gater.${e}`)}createInboundAbortSignal(e){return ct([AbortSignal.timeout(this.inboundUpgradeTimeout),e])}async upgradeInbound(e,t){var s,o;let n=!1;const i=this.createInboundAbortSignal(t.signal);try{if((s=this.metrics.dials)==null||s.increment({inbound:!0}),n=await this.components.connectionManager.acceptIncomingConnection(e),!n)throw new ySe("Connection denied");await this.shouldBlockConnection("denyInboundConnection",e),await this._performUpgrade(e,"inbound",{...t,signal:i})}catch(a){throw(o=this.metrics.errors)==null||o.increment({inbound:!0}),a}finally{i.clear(),n&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){var n,i;try{(n=this.metrics.dials)==null||n.increment({outbound:!0});const s=e.remoteAddr.getPeerId();let o;s!=null&&(o=Wt(s),await this.shouldBlockConnection("denyOutboundConnection",o,e));let a="outbound";return t.initiator===!1&&(a="inbound"),await this._performUpgrade(e,a,t)}catch(s){throw(i=this.metrics.errors)==null||i.increment({outbound:!0}),s}}async _performUpgrade(e,t,n){var h,d,p;let i,s,o,a,c;(h=this.components.metrics)==null||h.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t);let l=e;if((n==null?void 0:n.skipProtection)!==!0){const m=this.components.connectionProtector;m!=null&&(e.log("protecting the %s connection",t),l=await m.protect(e,n))}try{if(i=l,(n==null?void 0:n.skipEncryption)!==!0){(d=n==null?void 0:n.onProgress)==null||d.call(n,new Ie(`upgrader:encrypt-${t}-connection`)),{conn:i,remotePeer:s,protocol:c,streamMuxer:a}=await(t==="inbound"?this._encryptInbound(l,n):this._encryptOutbound(l,n));const m={...l,...i};await this.shouldBlockConnection(t==="inbound"?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",s,m)}else{const m=e.remoteAddr.getPeerId();if(m==null)throw new Z3(`${t} connection that skipped encryption must have a peer id`);const f=Wt(m);c="native",s=f}if(s.equals(this.components.peerId)){const m=new sS("Can not dial self");throw e.abort(m),m}if(o=i,(n==null?void 0:n.muxerFactory)!=null)a=n.muxerFactory;else if(a==null&&this.streamMuxers.size>0){(p=n==null?void 0:n.onProgress)==null||p.call(n,new Ie(`upgrader:multiplex-${t}-connection`));const m=await(t==="inbound"?this._multiplexInbound({...l,...i},this.streamMuxers,n):this._multiplexOutbound({...l,...i},this.streamMuxers,n));a=m.muxerFactory,o=m.stream}}catch(m){throw e.log.error("failed to upgrade inbound connection %s %a - %e",t==="inbound"?"from":"to",e.remoteAddr,m),m}return await this.shouldBlockConnection(t==="inbound"?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",s,e),e.log("successfully upgraded %s connection",t),this._createConnection({cryptoProtocol:c,direction:t,maConn:e,upgradedConn:o,muxerFactory:a,remotePeer:s,limits:n==null?void 0:n.limits})}_createConnection(e){const{cryptoProtocol:t,direction:n,maConn:i,upgradedConn:s,remotePeer:o,muxerFactory:a,limits:c}=e;let l,h,d;a!=null&&(l=a.createStreamMuxer({direction:n,onIncomingStream:f=>{d!=null&&Promise.resolve().then(async()=>{var C;const g=this.components.registrar.getProtocols(),v=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout),{stream:y,protocol:w}=await Q5(f,g,{signal:v,log:f.log,yieldBytes:!1});if(d==null)return;d.log("incoming stream opened on %s",w);const b=Axe(w,this.components.registrar);if(N$(w,"inbound",d)===b){const k=new JL(`Too many inbound protocol streams for protocol "${w}" - limit ${b}`);throw f.abort(k),k}f.source=y.source,f.sink=y.sink,f.protocol=w,y.closeWrite!=null&&(f.closeWrite=y.closeWrite),y.closeRead!=null&&(f.closeRead=y.closeRead),y.close!=null&&(f.close=y.close),await this.components.peerStore.merge(o,{protocols:[w]}),(C=this.components.metrics)==null||C.trackProtocolStream(f,d),this._onStream({connection:d,stream:f,protocol:w})}).catch(async g=>{d.log.error("error handling incoming stream id %s - %e",f.id,g),f.timeline.close==null&&await f.close()})}}),h=async(f,g={})=>{var y;if(l==null)throw new Sg("Connection is not multiplexed");d.log.trace("starting new stream for protocols %s",f);const v=await l.newStream();d.log.trace("started new stream %s for protocols %s",v.id,f);try{if(g.signal==null){v.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",f);const k=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);g={...g,signal:k}}v.log.trace("selecting protocol from protocols %s",f);const{stream:w,protocol:b}=await G5(v,f,{...g,log:v.log,yieldBytes:!0});v.log.trace("selected protocol %s",b);const E=Cxe(b,this.components.registrar,g),C=N$(b,"outbound",d);if(C>=E){const k=new tw(`Too many outbound protocol streams for protocol "${b}" - ${C}/${E}`);throw v.abort(k),k}return await this.components.peerStore.merge(o,{protocols:[b]}),v.source=w.source,v.sink=w.sink,v.protocol=b,w.closeWrite!=null&&(v.closeWrite=w.closeWrite),w.closeRead!=null&&(v.closeRead=w.closeRead),w.close!=null&&(v.close=w.close),(y=this.components.metrics)==null||y.trackProtocolStream(v,d),v}catch(w){throw d.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e",n==="inbound"?"from":"to",e.maConn.remoteAddr,f,w),v.timeline.close==null&&v.abort(w),w}},Promise.all([l.sink(s.source),s.sink(l.source)]).catch(f=>{d.log.error("error piping data through muxer - %e",f)}));const p=i.timeline;i.timeline=new Proxy(p,{set:(...f)=>(f[1]==="close"&&f[2]!=null&&p.close==null&&(async()=>{try{d.status==="open"&&await d.close()}catch(g){d.log.error("error closing connection after timeline close %e",g)}finally{this.events.safeDispatchEvent("connection:close",{detail:d})}})().catch(g=>{d.log.error("error thrown while dispatching connection:close event %e",g)}),Reflect.set(...f))}),i.timeline.upgraded=Date.now();const m=()=>{throw new Sg("Connection is not multiplexed")};return d=xxe({remoteAddr:i.remoteAddr,remotePeer:o,status:"open",direction:n,timeline:i.timeline,multiplexer:l==null?void 0:l.protocol,encryption:t,limits:c,logger:this.components.logger,newStream:h??m,getStreams:()=>(l==null?void 0:l.streams)??[],close:async f=>{await(l==null?void 0:l.close(f)),await i.close(f)},abort:f=>{i.abort(f),l==null||l.abort(f)}}),this.events.safeDispatchEvent("connection:open",{detail:d}),d.__maConnTimeline=p,d}_onStream(e){const{connection:t,stream:n,protocol:i}=e,{handler:s,options:o}=this.components.registrar.getHandler(i);if(t.limits!=null&&o.runOnLimitedConnection!==!0)throw new oS("Cannot open protocol stream on limited connection");s({connection:t,stream:n})}async _encryptInbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{const{stream:i,protocol:s}=await Q5(e,n,{...t,log:e.log}),o=this.connectionEncrypters.get(s);if(o==null)throw new xg(`no crypto module found for ${s}`);return e.log("encrypting inbound connection to %a using %s",e.remoteAddr,s),{...await o.secureInbound(i,t),protocol:s}}catch(i){throw e.log.error("encrypting inbound connection from %a failed",e.remoteAddr,i),new xg(i.message)}}async _encryptOutbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",n);const{stream:i,protocol:s}=await G5(e,n,{...t,log:e.log,yieldBytes:!0}),o=this.connectionEncrypters.get(s);if(o==null)throw new xg(`no crypto module found for ${s}`);return e.log("encrypting outbound connection to %a using %s",e.remoteAddr,s),{...await o.secureOutbound(i,t),protocol:s}}catch(i){throw e.log.error("encrypting outbound connection to %a failed",e.remoteAddr,i),new xg(i.message)}}async _multiplexOutbound(e,t,n){const i=Array.from(t.keys());e.log("outbound selecting muxer %s",i);try{e.log.trace("selecting stream muxer from %s",i);const{stream:s,protocol:o}=await G5(e,i,{...n,log:e.log,yieldBytes:!0});e.log("selected %s as muxer protocol",o);const a=t.get(o);return{stream:s,muxerFactory:a}}catch(s){throw e.log.error("error multiplexing outbound connection",s),new Sg(String(s))}}async _multiplexInbound(e,t,n){const i=Array.from(t.keys());e.log("inbound handling muxers %s",i);try{const{stream:s,protocol:o}=await Q5(e,i,{...n,log:e.log}),a=t.get(o);return{stream:s,muxerFactory:a}}catch(s){throw e.log.error("error multiplexing inbound connection",s),new Sg(String(s))}}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}}var Ap,C9;class kxe extends Yt{constructor(t){var h,d,p,m,f,g,v,y,w,b,E,C;super();qe(this,Ap);u(this,"peerId");u(this,"peerStore");u(this,"contentRouting");u(this,"peerRouting");u(this,"metrics");u(this,"services");u(this,"logger");u(this,"status");u(this,"components");u(this,"log");this.status="stopped";const n=new Yt,i=n.dispatchEvent.bind(n);n.dispatchEvent=k=>{const x=i(k),I=this.dispatchEvent(new CustomEvent(k.type,{detail:k.detail}));return x||I},this.peerId=t.peerId,this.logger=t.logger??ww(),this.log=this.logger.forComponent("libp2p"),this.services={};const s=((h=t.nodeInfo)==null?void 0:h.name)??vj,o=((d=t.nodeInfo)==null?void 0:d.version)??bj,a=this.components=ESe({peerId:t.peerId,privateKey:t.privateKey,nodeInfo:{name:s,version:o,userAgent:((p=t.nodeInfo)==null?void 0:p.userAgent)??Ej(s,o)},logger:this.logger,events:n,datastore:t.datastore??new eV,connectionGater:_Se(t.connectionGater),dns:t.dns});this.peerStore=this.configureComponent("peerStore",OEe(a,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...t.peerStore})),t.metrics!=null&&(this.metrics=this.configureComponent("metrics",t.metrics(this.components))),a.events.addEventListener("peer:update",k=>{if(k.detail.previous==null){const x={id:k.detail.peer.id,multiaddrs:k.detail.peer.addresses.map(I=>I.multiaddr)};a.events.safeDispatchEvent("peer:discovery",{detail:x})}}),t.connectionProtector!=null&&this.configureComponent("connectionProtector",t.connectionProtector(a)),this.components.upgrader=new Ixe(this.components,{connectionEncrypters:(t.connectionEncrypters??[]).map((k,x)=>this.configureComponent(`connection-encryption-${x}`,k(this.components))),streamMuxers:(t.streamMuxers??[]).map((k,x)=>this.configureComponent(`stream-muxers-${x}`,k(this.components))),inboundUpgradeTimeout:(m=t.connectionManager)==null?void 0:m.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:((f=t.connectionManager)==null?void 0:f.inboundStreamProtocolNegotiationTimeout)??((g=t.connectionManager)==null?void 0:g.protocolNegotiationTimeout),outboundStreamProtocolNegotiationTimeout:((v=t.connectionManager)==null?void 0:v.outboundStreamProtocolNegotiationTimeout)??((y=t.connectionManager)==null?void 0:y.protocolNegotiationTimeout)}),this.configureComponent("transportManager",new yxe(this.components,t.transportManager)),this.configureComponent("connectionManager",new sxe(this.components,t.connectionManager)),((w=t.connectionMonitor)==null?void 0:w.enabled)!==!1&&this.configureComponent("connectionMonitor",new hxe(this.components,t.connectionMonitor)),this.configureComponent("registrar",new gxe(this.components)),this.configureComponent("addressManager",new oSe(this.components,t.addresses));const c=(t.peerRouters??[]).map((k,x)=>this.configureComponent(`peer-router-${x}`,k(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new fxe(this.components,{routers:c}));const l=(t.contentRouters??[]).map((k,x)=>this.configureComponent(`content-router-${x}`,k(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new dxe(this.components,{routers:l})),this.configureComponent("randomWalk",new pxe(this.components)),(t.peerDiscovery??[]).forEach((k,x)=>{this.configureComponent(`peer-discovery-${x}`,k(this.components)).addEventListener("peer",T=>{Ae(this,Ap,C9).call(this,T)})}),(b=t.transports)==null||b.forEach((k,x)=>{this.components.transportManager.add(this.configureComponent(`transport-${x}`,k(this.components)))}),t.services!=null)for(const k of Object.keys(t.services)){const x=t.services[k],I=x(this.components);if(I==null){this.log.error("service factory %s returned null or undefined instance",k);continue}this.services[k]=I,this.configureComponent(k,I),I[Vh]!=null&&(this.log("registering service %s for content routing",k),l.push(I[Vh])),I[Kh]!=null&&(this.log("registering service %s for peer routing",k),c.push(I[Kh])),I[ey]!=null&&(this.log("registering service %s for peer discovery",k),(C=(E=I[ey]).addEventListener)==null||C.call(E,"peer",T=>{Ae(this,Ap,C9).call(this,T)}))}SSe(a)}configureComponent(t,n){return n==null&&this.log.error("component %s was null or undefined",t),this.components[t]=n,n}async start(){var t,n,i,s;if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{await((n=(t=this.components).beforeStart)==null?void 0:n.call(t)),await this.components.start(),await((s=(i=this.components).afterStart)==null?void 0:s.call(i)),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(o){throw this.log.error("An error occurred starting libp2p",o),this.status="started",await this.stop(),o}}}async stop(){var t,n,i,s;this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",await((n=(t=this.components).beforeStop)==null?void 0:n.call(t)),await this.components.stop(),await((s=(i=this.components).afterStop)==null?void 0:s.call(i)),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(t){return this.components.connectionManager.getConnections(t)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const t=new is;for(const n of this.components.connectionManager.getConnections())t.add(n.remotePeer);return Array.from(t)}async dial(t,n={}){return this.components.connectionManager.openConnection(t,{priority:75,...n})}async dialProtocol(t,n,i={}){if(n==null)throw new Z("no protocols were provided to open a stream");if(n=Array.isArray(n)?n:[n],n.length===0)throw new Z("no protocols were provided to open a stream");return(await this.dial(t,i)).newStream(n,i)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(t,n={}){Tw(t)&&(t=Wt(t.getPeerId()??"")),await this.components.connectionManager.closeConnections(t,n)}async getPublicKey(t,n={}){if(this.log("getPublicKey %p",t),t.publicKey!=null)return t.publicKey;try{const a=await this.peerStore.get(t);if(a.id.publicKey!=null)return a.id.publicKey}catch(a){if(a.name!=="NotFoundError")throw a}const i=er([se("/pk/"),t.toMultihash().bytes]),s=await this.contentRouting.get(i,n),o=$n(s);return await this.peerStore.patch(t,{publicKey:o}),o}async handle(t,n,i){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async s=>{await this.components.registrar.handle(s,n,i)}))}async unhandle(t){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async n=>{await this.components.registrar.unhandle(n)}))}async register(t,n){return this.components.registrar.register(t,n)}unregister(t){this.components.registrar.unregister(t)}async isDialable(t,n={}){return this.components.connectionManager.isDialable(t,n)}}Ap=new WeakSet,C9=function(t){const{detail:n}=t;if(n.id.toString()===this.peerId.toString()){this.log.error("peer discovery mechanism discovered self");return}this.components.peerStore.merge(n.id,{multiaddrs:n.multiaddrs}).catch(i=>{this.log.error(i)})};async function _xe(r={}){r.privateKey??(r.privateKey=await hw("Ed25519"));const e=new kxe({...await z9e(r),peerId:aoe(r.privateKey)});return r.start!==!1&&await e.start(),e}async function Txe(r){const e=r.libp2p??{};e.privateKey==null&&r.datastore!=null&&(e.privateKey=await R9e(r.datastore,r.keychain));const t=O9e(e);return t.datastore=t.datastore??r.datastore,await _xe({...t,...e,start:!1})}async function Pxe(r={}){const e=r.datastore??new eV,t=r.blockstore??new c2e;let n;Dxe(r.libp2p)?n=r.libp2p:n=await Txe({...r,libp2p:{dns:r.dns,...r.libp2p,start:void 0},datastore:e});const i=new f2e({...r,libp2p:n,datastore:e,blockstore:t,blockBrokers:r.blockBrokers??[z1e(),Jhe()],routers:r.routers??[Ige(n),Age()],metrics:n.metrics});return r.start!==!1&&await i.start(),i}function Dxe(r){return r==null?!1:["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"].every(t=>typeof r[t]=="function")}function Vj(r){return r[Symbol.asyncIterator]!=null}const F4=r=>{const e=dt(r),t=Pn(e);return br(r,t),F4.bytes=e,t};F4.bytes=0;function PA(r,e){e=e??{};const t=e.lengthEncoder??F4;function*n(i){const s=t(i.byteLength);s instanceof Uint8Array?yield s:yield*s,i instanceof Uint8Array?yield i:yield*i}return Vj(r)?async function*(){for await(const i of r)yield*n(i)}():function*(){for(const i of r)yield*n(i)}()}PA.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??F4;return new Le(t(r.byteLength),r)};class $xe extends Error{constructor(){super(...arguments);u(this,"name","InvalidMessageLengthError");u(this,"code","ERR_INVALID_MSG_LENGTH")}}class Nxe extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthError");u(this,"code","ERR_MSG_DATA_TOO_LONG")}}class Mxe extends Error{constructor(){super(...arguments);u(this,"name","InvalidDataLengthLengthError");u(this,"code","ERR_MSG_LENGTH_TOO_LONG")}}class M$ extends Error{constructor(){super(...arguments);u(this,"name","UnexpectedEOFError");u(this,"code","ERR_UNEXPECTED_EOF")}}const Oxe=8,Rxe=1024*1024*4;var ll;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(ll||(ll={}));const DA=r=>{const e=hs(r);return DA.bytes=dt(e),e};DA.bytes=0;function I9(r,e){const t=new Le;let n=ll.LENGTH,i=-1;const s=(e==null?void 0:e.lengthDecoder)??DA,o=(e==null?void 0:e.maxLengthLength)??Oxe,a=(e==null?void 0:e.maxDataLength)??Rxe;function*c(){for(;t.byteLength>0;){if(n===ll.LENGTH)try{if(i=s(t),i<0)throw new $xe("Invalid message length");if(i>a)throw new Nxe("Message length too long");const l=s.bytes;t.consume(l),(e==null?void 0:e.onLength)!=null&&e.onLength(i),n=ll.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>o)throw new Mxe("Message length length too long");break}throw l}if(n===ll.DATA){if(t.byteLength<i)break;const l=t.sublist(0,i);t.consume(i),(e==null?void 0:e.onData)!=null&&e.onData(l),yield l,n=ll.LENGTH}}}return Vj(r)?async function*(){for await(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new M$("Unexpected end of input")}():function*(){for(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new M$("Unexpected end of input")}()}I9.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:s,value:o}=await r.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return I9(n,{...e??{},onLength:s=>{t=s}})};function Lxe(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}var Bxe=Kj,O$=128,Uxe=-128,Fxe=Math.pow(2,31);function Kj(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Fxe;)e[t++]=r&255|O$,r/=128;for(;r&Uxe;)e[t++]=r&255|O$,r>>>=7;return e[t]=r|0,Kj.bytes=t-n+1,e}var zxe=k9,Vxe=128,R$=127;function k9(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw k9.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&R$)<<i:(o&R$)*Math.pow(2,i),i+=7}while(o>=Vxe);return k9.bytes=s-n,t}var Kxe=Math.pow(2,7),Hxe=Math.pow(2,14),jxe=Math.pow(2,21),qxe=Math.pow(2,28),Wxe=Math.pow(2,35),Gxe=Math.pow(2,42),Qxe=Math.pow(2,49),Yxe=Math.pow(2,56),Xxe=Math.pow(2,63),Jxe=function(r){return r<Kxe?1:r<Hxe?2:r<jxe?3:r<qxe?4:r<Wxe?5:r<Gxe?6:r<Qxe?7:r<Yxe?8:r<Xxe?9:10},Zxe={encode:Bxe,decode:zxe,encodingLength:Jxe},h3=Zxe;function L$(r,e=0){return[h3.decode(r,e),h3.decode.bytes]}function B$(r,e,t=0){return h3.encode(r,e,t),e}function U$(r){return h3.encodingLength(r)}function F$(r,e){const t=e.byteLength,n=U$(r),i=n+U$(t),s=new Uint8Array(i+t);return B$(r,s,0),B$(t,s,n),s.set(e,i),new jj(r,t,e,s)}function Hj(r){const e=Lxe(r),[t,n]=L$(e),[i,s]=L$(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new jj(t,i,o,e)}class jj{constructor(e,t,n,i){u(this,"code");u(this,"size");u(this,"digest");u(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}}const Qd=1e3,$A=60*Qd,z$="/floodsub/1.0.0",V$="/meshsub/1.0.0",eAe="/meshsub/1.1.0",Y5="/meshsub/1.2.0",tAe=6,rAe=4,nAe=12,iAe=4,sAe=2,oAe=5,aAe=3,cAe=6,lAe=.25,uAe=3,K$=100,hAe=Qd,dAe=$A,fAe=16,pAe=$A,gAe=10*Qd,yAe=15,mAe=300,wAe=Qd,bAe=60,vAe=2,EAe=10*Qd,Vu=5e3,SAe=10,xAe=3*Qd,AAe=2*$A,CAe=120*1e3,IAe="ERR_TOPIC_VALIDATOR_REJECT",kAe="ERR_TOPIC_VALIDATOR_IGNORE",_Ae=0,TAe=128,PAe=1e3,DAe=1e3,$Ae=1,NAe=512,MAe=512,OAe={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxIdontwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};var Ml;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=Pe((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.subscribe!=null&&(s.uint32(8),s.bool(i.subscribe)),i.topic!=null&&(s.uint32(18),s.string(i.topic)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.subscribe=i.bool();break}case 2:{a.topic=i.string();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>Te(i,t.codec()),t.decode=(i,s)=>_e(i,t.codec(),s)})(r.SubOpts||(r.SubOpts={})),function(t){let n;t.codec=()=>(n==null&&(n=Pe((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.from!=null&&(s.uint32(10),s.bytes(i.from)),i.data!=null&&(s.uint32(18),s.bytes(i.data)),i.seqno!=null&&(s.uint32(26),s.bytes(i.seqno)),i.topic!=null&&i.topic!==""&&(s.uint32(34),s.string(i.topic)),i.signature!=null&&(s.uint32(42),s.bytes(i.signature)),i.key!=null&&(s.uint32(50),s.bytes(i.key)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={topic:""},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.from=i.bytes();break}case 2:{a.data=i.bytes();break}case 3:{a.seqno=i.bytes();break}case 4:{a.topic=i.string();break}case 5:{a.signature=i.bytes();break}case 6:{a.key=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>Te(i,t.codec()),t.decode=(i,s)=>_e(i,t.codec(),s)}(r.Message||(r.Message={})),function(t){let n;t.codec=()=>(n==null&&(n=Pe((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.ihave!=null)for(const a of i.ihave)s.uint32(10),r.ControlIHave.codec().encode(a,s);if(i.iwant!=null)for(const a of i.iwant)s.uint32(18),r.ControlIWant.codec().encode(a,s);if(i.graft!=null)for(const a of i.graft)s.uint32(26),r.ControlGraft.codec().encode(a,s);if(i.prune!=null)for(const a of i.prune)s.uint32(34),r.ControlPrune.codec().encode(a,s);if(i.idontwant!=null)for(const a of i.idontwant)s.uint32(42),r.ControlIDontWant.codec().encode(a,s);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l,h,d,p,m,f,g,v,y,w;const a={ihave:[],iwant:[],graft:[],prune:[],idontwant:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const b=i.uint32();switch(b>>>3){case 1:{if(((l=o.limits)==null?void 0:l.ihave)!=null&&a.ihave.length===o.limits.ihave)throw new ht('Decode error - map field "ihave" had too many elements');a.ihave.push(r.ControlIHave.codec().decode(i,i.uint32(),{limits:(h=o.limits)==null?void 0:h.ihave$}));break}case 2:{if(((d=o.limits)==null?void 0:d.iwant)!=null&&a.iwant.length===o.limits.iwant)throw new ht('Decode error - map field "iwant" had too many elements');a.iwant.push(r.ControlIWant.codec().decode(i,i.uint32(),{limits:(p=o.limits)==null?void 0:p.iwant$}));break}case 3:{if(((m=o.limits)==null?void 0:m.graft)!=null&&a.graft.length===o.limits.graft)throw new ht('Decode error - map field "graft" had too many elements');a.graft.push(r.ControlGraft.codec().decode(i,i.uint32(),{limits:(f=o.limits)==null?void 0:f.graft$}));break}case 4:{if(((g=o.limits)==null?void 0:g.prune)!=null&&a.prune.length===o.limits.prune)throw new ht('Decode error - map field "prune" had too many elements');a.prune.push(r.ControlPrune.codec().decode(i,i.uint32(),{limits:(v=o.limits)==null?void 0:v.prune$}));break}case 5:{if(((y=o.limits)==null?void 0:y.idontwant)!=null&&a.idontwant.length===o.limits.idontwant)throw new ht('Decode error - map field "idontwant" had too many elements');a.idontwant.push(r.ControlIDontWant.codec().decode(i,i.uint32(),{limits:(w=o.limits)==null?void 0:w.idontwant$}));break}default:{i.skipType(b&7);break}}}return a})),n),t.encode=i=>Te(i,t.codec()),t.decode=(i,s)=>_e(i,t.codec(),s)}(r.ControlMessage||(r.ControlMessage={})),function(t){let n;t.codec=()=>(n==null&&(n=Pe((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.topicID!=null&&(s.uint32(10),s.string(i.topicID)),i.messageIDs!=null)for(const a of i.messageIDs)s.uint32(18),s.bytes(a);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={messageIDs:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const h=i.uint32();switch(h>>>3){case 1:{a.topicID=i.string();break}case 2:{if(((l=o.limits)==null?void 0:l.messageIDs)!=null&&a.messageIDs.length===o.limits.messageIDs)throw new ht('Decode error - map field "messageIDs" had too many elements');a.messageIDs.push(i.bytes());break}default:{i.skipType(h&7);break}}}return a})),n),t.encode=i=>Te(i,t.codec()),t.decode=(i,s)=>_e(i,t.codec(),s)}(r.ControlIHave||(r.ControlIHave={})),function(t){let n;t.codec=()=>(n==null&&(n=Pe((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.messageIDs!=null)for(const a of i.messageIDs)s.uint32(10),s.bytes(a);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={messageIDs:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const h=i.uint32();switch(h>>>3){case 1:{if(((l=o.limits)==null?void 0:l.messageIDs)!=null&&a.messageIDs.length===o.limits.messageIDs)throw new ht('Decode error - map field "messageIDs" had too many elements');a.messageIDs.push(i.bytes());break}default:{i.skipType(h&7);break}}}return a})),n),t.encode=i=>Te(i,t.codec()),t.decode=(i,s)=>_e(i,t.codec(),s)}(r.ControlIWant||(r.ControlIWant={})),function(t){let n;t.codec=()=>(n==null&&(n=Pe((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.topicID!=null&&(s.uint32(10),s.string(i.topicID)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.topicID=i.string();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>Te(i,t.codec()),t.decode=(i,s)=>_e(i,t.codec(),s)}(r.ControlGraft||(r.ControlGraft={})),function(t){let n;t.codec=()=>(n==null&&(n=Pe((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.topicID!=null&&(s.uint32(10),s.string(i.topicID)),i.peers!=null)for(const a of i.peers)s.uint32(18),r.PeerInfo.codec().encode(a,s);i.backoff!=null&&(s.uint32(24),s.uint64Number(i.backoff)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l,h;const a={peers:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:{a.topicID=i.string();break}case 2:{if(((l=o.limits)==null?void 0:l.peers)!=null&&a.peers.length===o.limits.peers)throw new ht('Decode error - map field "peers" had too many elements');a.peers.push(r.PeerInfo.codec().decode(i,i.uint32(),{limits:(h=o.limits)==null?void 0:h.peers$}));break}case 3:{a.backoff=i.uint64Number();break}default:{i.skipType(d&7);break}}}return a})),n),t.encode=i=>Te(i,t.codec()),t.decode=(i,s)=>_e(i,t.codec(),s)}(r.ControlPrune||(r.ControlPrune={})),function(t){let n;t.codec=()=>(n==null&&(n=Pe((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.peerID!=null&&(s.uint32(10),s.bytes(i.peerID)),i.signedPeerRecord!=null&&(s.uint32(18),s.bytes(i.signedPeerRecord)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.peerID=i.bytes();break}case 2:{a.signedPeerRecord=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>Te(i,t.codec()),t.decode=(i,s)=>_e(i,t.codec(),s)}(r.PeerInfo||(r.PeerInfo={})),function(t){let n;t.codec=()=>(n==null&&(n=Pe((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.messageIDs!=null)for(const a of i.messageIDs)s.uint32(10),s.bytes(a);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={messageIDs:[]},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const h=i.uint32();switch(h>>>3){case 1:{if(((l=o.limits)==null?void 0:l.messageIDs)!=null&&a.messageIDs.length===o.limits.messageIDs)throw new ht('Decode error - map field "messageIDs" had too many elements');a.messageIDs.push(i.bytes());break}default:{i.skipType(h&7);break}}}return a})),n),t.encode=i=>Te(i,t.codec()),t.decode=(i,s)=>_e(i,t.codec(),s)}(r.ControlIDontWant||(r.ControlIDontWant={}));let e;r.codec=()=>(e==null&&(e=Pe((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.subscriptions!=null)for(const s of t.subscriptions)n.uint32(10),r.SubOpts.codec().encode(s,n);if(t.messages!=null)for(const s of t.messages)n.uint32(18),r.Message.codec().encode(s,n);t.control!=null&&(n.uint32(26),r.ControlMessage.codec().encode(t.control,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,h,d;const s={subscriptions:[],messages:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const p=t.uint32();switch(p>>>3){case 1:{if(((a=i.limits)==null?void 0:a.subscriptions)!=null&&s.subscriptions.length===i.limits.subscriptions)throw new ht('Decode error - map field "subscriptions" had too many elements');s.subscriptions.push(r.SubOpts.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.subscriptions$}));break}case 2:{if(((l=i.limits)==null?void 0:l.messages)!=null&&s.messages.length===i.limits.messages)throw new ht('Decode error - map field "messages" had too many elements');s.messages.push(r.Message.codec().decode(t,t.uint32(),{limits:(h=i.limits)==null?void 0:h.messages$}));break}case 3:{s.control=r.ControlMessage.codec().decode(t,t.uint32(),{limits:(d=i.limits)==null?void 0:d.control});break}default:{t.skipType(p&7);break}}}return s})),e),r.encode=t=>Te(t,r.codec()),r.decode=(t,n)=>_e(t,r.codec(),n)})(Ml||(Ml={}));class RAe{constructor(e,t,n){u(this,"gossip");u(this,"msgs",new Map);u(this,"msgIdToStrFn");u(this,"history",[]);u(this,"notValidatedCount",0);this.gossip=e,this.msgIdToStrFn=n;for(let i=0;i<t;i++)this.history[i]=[]}get size(){return this.msgs.size}put(e,t,n=!1){const{msgIdStr:i}=e;return this.msgs.has(i)?!1:(this.msgs.set(i,{message:t,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),n||this.notValidatedCount++,!0)}observeDuplicate(e,t){const n=this.msgs.get(e);n!=null&&!n.validated&&n.originatingPeers.add(t)}get(e){var t;return(t=this.msgs.get(this.msgIdToStrFn(e)))==null?void 0:t.message}getWithIWantCount(e,t){const n=this.msgs.get(e);if(n==null)return null;const i=(n.iwantCounts.get(t)??0)+1;return n.iwantCounts.set(t,i),{msg:n.message,count:i}}getGossipIDs(e){const t=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach(i=>{const s=this.msgs.get(i.msgIdStr);if(((s==null?void 0:s.validated)??!1)&&e.has(i.topic)){let o=t.get(i.topic);o==null&&(o=[],t.set(i.topic,o)),o.push(i.msgId)}});return t}validate(e){const t=this.msgs.get(e);if(t==null)return null;t.validated||this.notValidatedCount--;const{message:n,originatingPeers:i}=t;return t.validated=!0,t.originatingPeers=new Set,{message:n,originatingPeers:i}}shift(){this.history[this.history.length-1].forEach(t=>{const n=this.msgs.get(t.msgIdStr);n!=null&&(this.msgs.delete(t.msgIdStr),n.validated||this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(e){const t=this.msgs.get(e);return t==null?null:(this.msgs.delete(e),t)}}var H$;(function(r){r.StrictSign="StrictSign",r.StrictNoSign="StrictNoSign"})(H$||(H$={}));var Sd;(function(r){r[r.Signing=0]="Signing",r[r.Anonymous=1]="Anonymous"})(Sd||(Sd={}));var as;(function(r){r.Error="error",r.Ignore="ignore",r.Reject="reject",r.Blacklisted="blacklisted"})(as||(as={}));var yn;(function(r){r.InvalidSignature="invalid_signature",r.InvalidSeqno="invalid_seqno",r.InvalidPeerId="invalid_peerid",r.SignaturePresent="signature_present",r.SeqnoPresent="seqno_present",r.FromPresent="from_present",r.TransformFailed="transform_failed"})(yn||(yn={}));var wn;(function(r){r.duplicate="duplicate",r.invalid="invalid",r.valid="valid"})(wn||(wn={}));function j$(r){switch(r){case Ei.Ignore:return as.Ignore;case Ei.Reject:return as.Reject;default:throw new Error("Unreachable")}}var q$;(function(r){r.forward="forward",r.publish="publish"})(q$||(q$={}));var Sn;(function(r){r.Fanout="fanout",r.Random="random",r.Subscribed="subscribed",r.Outbound="outbound",r.NotEnough="not_enough",r.Opportunistic="opportunistic"})(Sn||(Sn={}));var $s;(function(r){r.Dc="disconnected",r.BadScore="bad_score",r.Prune="prune",r.Excess="excess"})($s||($s={}));var w1;(function(r){r.GraftBackoff="graft_backoff",r.BrokenPromise="broken_promise",r.MessageDeficit="message_deficit",r.IPColocation="IP_colocation"})(w1||(w1={}));var b1;(function(r){r.LowScore="low_score",r.MaxIhave="max_ihave",r.MaxIasked="max_iasked"})(b1||(b1={}));var nh;(function(r){r.graylist="graylist",r.publish="publish",r.gossip="gossip",r.mesh="mesh"})(nh||(nh={}));function LAe(r,e,t){return{protocolsEnabled:r.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:r.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:r.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:r.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEventsFanout:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_fanout_total",help:"Number of times we include peers in a topic mesh for fanout reasons",labelNames:["topic"]}),meshPeerInclusionEventsRandom:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_random_total",help:"Number of times we include peers in a topic mesh for random reasons",labelNames:["topic"]}),meshPeerInclusionEventsSubscribed:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_subscribed_total",help:"Number of times we include peers in a topic mesh for subscribed reasons",labelNames:["topic"]}),meshPeerInclusionEventsOutbound:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_outbound_total",help:"Number of times we include peers in a topic mesh for outbound reasons",labelNames:["topic"]}),meshPeerInclusionEventsNotEnough:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_not_enough_total",help:"Number of times we include peers in a topic mesh for not_enough reasons",labelNames:["topic"]}),meshPeerInclusionEventsOpportunistic:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_opportunistic_total",help:"Number of times we include peers in a topic mesh for opportunistic reasons",labelNames:["topic"]}),meshPeerInclusionEventsUnknown:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_unknown_total",help:"Number of times we include peers in a topic mesh for unknown reasons",labelNames:["topic"]}),meshPeerChurnEventsDisconnected:r.gauge({name:"gossipsub_peer_churn_events_disconnected_total",help:"Number of times we remove peers in a topic mesh for disconnected reasons",labelNames:["topic"]}),meshPeerChurnEventsBadScore:r.gauge({name:"gossipsub_peer_churn_events_bad_score_total",help:"Number of times we remove peers in a topic mesh for bad_score reasons",labelNames:["topic"]}),meshPeerChurnEventsPrune:r.gauge({name:"gossipsub_peer_churn_events_prune_total",help:"Number of times we remove peers in a topic mesh for prune reasons",labelNames:["topic"]}),meshPeerChurnEventsExcess:r.gauge({name:"gossipsub_peer_churn_events_excess_total",help:"Number of times we remove peers in a topic mesh for excess reasons",labelNames:["topic"]}),meshPeerChurnEventsUnknown:r.gauge({name:"gossipsub_peer_churn_events_unknown_total",help:"Number of times we remove peers in a topic mesh for unknown reasons",labelNames:["topic"]}),peersPerProtocol:r.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:r.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:r.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),acceptedMessagesTotal:r.gauge({name:"gossipsub_accepted_messages_total",help:"Total accepted messages for each topic",labelNames:["topic"]}),ignoredMessagesTotal:r.gauge({name:"gossipsub_ignored_messages_total",help:"Total ignored messages for each topic",labelNames:["topic"]}),rejectedMessagesTotal:r.gauge({name:"gossipsub_rejected_messages_total",help:"Total rejected messages for each topic",labelNames:["topic"]}),unknownValidationResultsTotal:r.gauge({name:"gossipsub_unknown_validation_results_total",help:"Total unknown validation results for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:r.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),asyncValidationDelayFromFirstSeenSec:r.histogram({name:"gossipsub_async_validation_delay_from_first_seen",help:"Async validation report delay from first seen in second",buckets:[.01,.03,.1,.3,1,3,10]}),asyncValidationUnknownFirstSeen:r.gauge({name:"gossipsub_async_validation_unknown_first_seen_count_total",help:"Async validation report unknown first seen value for message"}),peerReadStreamError:r.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:r.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:r.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:r.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:r.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:r.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:r.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:r.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:r.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:r.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:r.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:r.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:r.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:r.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:r.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:r.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:r.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:r.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:r.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:r.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:r.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:r.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),rpcSentIDontWant:r.gauge({name:"gossipsub_rpc_sent_idontwant_total",help:"RPC sent"}),msgPublishCount:r.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:r.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),directPeersPublishedTotal:r.gauge({name:"gossipsub_direct_peers_published_total",help:"Total direct peers that we publish a msg to",labelNames:["topic"]}),floodsubPeersPublishedTotal:r.gauge({name:"gossipsub_floodsub_peers_published_total",help:"Total floodsub peers that we publish a msg to",labelNames:["topic"]}),meshPeersPublishedTotal:r.gauge({name:"gossipsub_mesh_peers_published_total",help:"Total mesh peers that we publish a msg to",labelNames:["topic"]}),fanoutPeersPublishedTotal:r.gauge({name:"gossipsub_fanout_peers_published_total",help:"Total fanout peers that we publish a msg to",labelNames:["topic"]}),msgPublishBytes:r.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgPublishTime:r.histogram({name:"gossipsub_msg_publish_seconds",help:"Total time in seconds to publish a message",buckets:[.001,.002,.005,.01,.1,.5,1],labelNames:["topic"]}),msgForwardCount:r.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:r.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:r.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:r.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),prevalidationInvalidTotal:r.gauge({name:"gossipsub_pre_validation_invalid_total",help:"Total count of invalid messages received",labelNames:["topic"]}),prevalidationValidTotal:r.gauge({name:"gossipsub_pre_validation_valid_total",help:"Total count of valid messages received",labelNames:["topic"]}),prevalidationDuplicateTotal:r.gauge({name:"gossipsub_pre_validation_duplicate_total",help:"Total count of duplicate messages received",labelNames:["topic"]}),prevalidationUnknownTotal:r.gauge({name:"gossipsub_pre_validation_unknown_status_total",help:"Total count of unknown_status messages received",labelNames:["topic"]}),msgReceivedInvalid:r.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:r.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:r.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*t.maxMeshMessageDeliveriesWindowSec,.5*t.maxMeshMessageDeliveriesWindowSec,Number(t.maxMeshMessageDeliveriesWindowSec),2*t.maxMeshMessageDeliveriesWindowSec,4*t.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:r.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:r.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:r.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:r.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:r.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:r.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:r.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:r.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:r.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:r.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:r.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*t.behaviourPenaltyThreshold,.5*t.behaviourPenaltyThreshold,Number(t.behaviourPenaltyThreshold),2*t.behaviourPenaltyThreshold,4*t.behaviourPenaltyThreshold]}),ihaveRcvIgnored:r.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:r.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:r.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:r.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:r.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),idontwantRcvMsgids:r.gauge({name:"gossipsub_idontwant_rcv_msgids_total",help:"Total received IDONTWANT messages"}),idontwantRcvDonthaveMsgids:r.gauge({name:"gossipsub_idontwant_rcv_dont_have_msgids_total",help:"Total received IDONTWANT messageIDs that we do not have in mcache"}),iwantPromiseStarted:r.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:r.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:r.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:r.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:r.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:r.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:r.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*t.gossipPromiseExpireSec,Number(t.gossipPromiseExpireSec),2*t.gossipPromiseExpireSec,4*t.gossipPromiseExpireSec]}),iwantPromiseUntracked:r.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),connectedPeersBackoffSec:r.histogram({name:"gossipsub_connected_peers_backoff_seconds",help:"Backoff time in seconds",buckets:[1,2,4,10,20,60,120]}),cacheSize:r.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:r.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:r.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:r.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:r.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:e,toTopic(n){return this.topicStrToLabel.get(n)??n},onJoin(n){this.topicSubscriptionStatus.set({topicStr:n},1),this.meshPeerCounts.set({topicStr:n},0)},onLeave(n){this.topicSubscriptionStatus.set({topicStr:n},0),this.meshPeerCounts.set({topicStr:n},0)},onAddToMesh(n,i,s){const o=this.toTopic(n);switch(i){case Sn.Fanout:this.meshPeerInclusionEventsFanout.inc({topic:o},s);break;case Sn.Random:this.meshPeerInclusionEventsRandom.inc({topic:o},s);break;case Sn.Subscribed:this.meshPeerInclusionEventsSubscribed.inc({topic:o},s);break;case Sn.Outbound:this.meshPeerInclusionEventsOutbound.inc({topic:o},s);break;case Sn.NotEnough:this.meshPeerInclusionEventsNotEnough.inc({topic:o},s);break;case Sn.Opportunistic:this.meshPeerInclusionEventsOpportunistic.inc({topic:o},s);break;default:this.meshPeerInclusionEventsUnknown.inc({topic:o},s);break}},onRemoveFromMesh(n,i,s){const o=this.toTopic(n);switch(i){case $s.Dc:this.meshPeerChurnEventsDisconnected.inc({topic:o},s);break;case $s.BadScore:this.meshPeerChurnEventsBadScore.inc({topic:o},s);break;case $s.Prune:this.meshPeerChurnEventsPrune.inc({topic:o},s);break;case $s.Excess:this.meshPeerChurnEventsExcess.inc({topic:o},s);break;default:this.meshPeerChurnEventsUnknown.inc({topic:o},s);break}},onReportValidation(n,i,s){if(this.asyncValidationMcacheHit.inc({hit:n!=null?"hit":"miss"}),n!=null){const o=this.toTopic(n.message.topic);switch(i){case Ei.Accept:this.acceptedMessagesTotal.inc({topic:o});break;case Ei.Ignore:this.ignoredMessagesTotal.inc({topic:o});break;case Ei.Reject:this.rejectedMessagesTotal.inc({topic:o});break;default:this.unknownValidationResultsTotal.inc({topic:o});break}}s!=null?this.asyncValidationDelayFromFirstSeenSec.observe((Date.now()-s)/1e3):this.asyncValidationUnknownFirstSeen.inc()},onScorePenalty(n){this.scoringPenalties.inc({penalty:n},1)},onIhaveRcv(n,i,s){const o=this.toTopic(n);this.ihaveRcvMsgids.inc({topic:o},i),this.ihaveRcvNotSeenMsgids.inc({topic:o},s)},onIwantRcv(n,i){for(const[s,o]of n){const a=this.toTopic(s);this.iwantRcvMsgids.inc({topic:a},o)}this.iwantRcvDonthaveMsgids.inc(i)},onIdontwantRcv(n,i){this.idontwantRcvMsgids.inc(n),this.idontwantRcvDonthaveMsgids.inc(i)},onForwardMsg(n,i){const s=this.toTopic(n);this.msgForwardCount.inc({topic:s},1),this.msgForwardPeers.inc({topic:s},i)},onPublishMsg(n,i,s,o,a){const c=this.toTopic(n);this.msgPublishCount.inc({topic:c},1),this.msgPublishBytes.inc({topic:c},s*o),this.msgPublishPeersByTopic.inc({topic:c},s),this.directPeersPublishedTotal.inc({topic:c},i.direct),this.floodsubPeersPublishedTotal.inc({topic:c},i.floodsub),this.meshPeersPublishedTotal.inc({topic:c},i.mesh),this.fanoutPeersPublishedTotal.inc({topic:c},i.fanout),this.msgPublishTime.observe({topic:c},a/1e3)},onMsgRecvPreValidation(n){const i=this.toTopic(n);this.msgReceivedPreValidation.inc({topic:i},1)},onMsgRecvError(n){const i=this.toTopic(n);this.msgReceivedError.inc({topic:i},1)},onPrevalidationResult(n,i){const s=this.toTopic(n);switch(i){case wn.duplicate:this.prevalidationDuplicateTotal.inc({topic:s});break;case wn.invalid:this.prevalidationInvalidTotal.inc({topic:s});break;case wn.valid:this.prevalidationValidTotal.inc({topic:s});break;default:this.prevalidationUnknownTotal.inc({topic:s});break}},onMsgRecvInvalid(n,i){const s=this.toTopic(n),o=i.reason===as.Error?i.error:i.reason;this.msgReceivedInvalid.inc({error:o},1),this.msgReceivedInvalidByTopic.inc({topic:s},1)},onDuplicateMsgDelivery(n,i,s){const o=this.toTopic(n);this.duplicateMsgDeliveryDelay.observe({topic:o},i/1e3),s&&this.duplicateMsgLateDelivery.inc({topic:o},1)},onPublishDuplicateMsg(n){const i=this.toTopic(n);this.duplicateMsgIgnored.inc({topic:i},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(n,i){this.rpcRecvBytes.inc(i),this.rpcRecvCount.inc(1),n.subscriptions!=null&&this.rpcRecvSubscription.inc(n.subscriptions.length),n.messages!=null&&this.rpcRecvMessage.inc(n.messages.length),n.control!=null&&(this.rpcRecvControl.inc(1),n.control.ihave!=null&&this.rpcRecvIHave.inc(n.control.ihave.length),n.control.iwant!=null&&this.rpcRecvIWant.inc(n.control.iwant.length),n.control.graft!=null&&this.rpcRecvGraft.inc(n.control.graft.length),n.control.prune!=null&&this.rpcRecvPrune.inc(n.control.prune.length))},onRpcSent(n,i){var s,o,a,c,l;if(this.rpcSentBytes.inc(i),this.rpcSentCount.inc(1),n.subscriptions!=null&&this.rpcSentSubscription.inc(n.subscriptions.length),n.messages!=null&&this.rpcSentMessage.inc(n.messages.length),n.control!=null){const h=((s=n.control.ihave)==null?void 0:s.length)??0,d=((o=n.control.iwant)==null?void 0:o.length)??0,p=((a=n.control.graft)==null?void 0:a.length)??0,m=((c=n.control.prune)==null?void 0:c.length)??0,f=((l=n.control.idontwant)==null?void 0:l.length)??0;h>0&&this.rpcSentIHave.inc(h),d>0&&this.rpcSentIWant.inc(d),p>0&&this.rpcSentGraft.inc(p),m>0&&this.rpcSentPrune.inc(m),f>0&&this.rpcSentIDontWant.inc(f),(h>0||d>0||p>0||m>0||f>0)&&this.rpcSentControl.inc(1)}},registerScores(n,i){let s=0,o=0,a=0,c=0;for(const l of n)l>=i.graylistThreshold&&s++,l>=i.publishThreshold&&o++,l>=i.gossipThreshold&&a++,l>=0&&c++;this.peersByScoreThreshold.set({threshold:nh.graylist},s),this.peersByScoreThreshold.set({threshold:nh.publish},o),this.peersByScoreThreshold.set({threshold:nh.gossip},a),this.peersByScoreThreshold.set({threshold:nh.mesh},c),this.score.set(n)},registerScoreWeights(n){for(const[i,s]of n.byTopic)this.scoreWeights.set({topic:i,p:"p1"},s.p1w),this.scoreWeights.set({topic:i,p:"p2"},s.p2w),this.scoreWeights.set({topic:i,p:"p3"},s.p3w),this.scoreWeights.set({topic:i,p:"p3b"},s.p3bw),this.scoreWeights.set({topic:i,p:"p4"},s.p4w);this.scoreWeights.set({p:"p5"},n.p5w),this.scoreWeights.set({p:"p6"},n.p6w),this.scoreWeights.set({p:"p7"},n.p7w)},registerScorePerMesh(n,i){const s=new Map;n.forEach((o,a)=>{const c=this.topicStrToLabel.get(a)??"unknown";let l=s.get(c);l==null&&(l=new Set,s.set(c,l)),o.forEach(h=>l==null?void 0:l.add(h))});for(const[o,a]of s){const c=[];a.forEach(l=>{c.push(i.get(l)??0)}),this.scorePerMesh.set({topic:o},c)}}}}class ut extends Error{constructor(e="Invalid peer score params"){super(e),this.name="InvalidPeerScoreParamsError"}}u(ut,"name","InvalidPeerScoreParamsError");const BAe={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},UAe={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function FAe(r={}){return{...BAe,...r,topics:r.topics!=null?Object.entries(r.topics).reduce((e,[t,n])=>(e[t]=zAe(n),e),{}):{}}}function zAe(r={}){return{...UAe,...r}}function VAe(r){for(const[e,t]of Object.entries(r.topics))try{KAe(t)}catch(n){throw new ut(`invalid score parameters for topic ${e}: ${n.message}`)}if(r.topicScoreCap<0)throw new ut("invalid topic score cap; must be positive (or 0 for no cap)");if(r.appSpecificScore===null||r.appSpecificScore===void 0)throw new ut("missing application specific score function");if(r.IPColocationFactorWeight>0)throw new ut("invalid IPColocationFactorWeight; must be negative (or 0 to disable)");if(r.IPColocationFactorWeight!==0&&r.IPColocationFactorThreshold<1)throw new ut("invalid IPColocationFactorThreshold; must be at least 1");if(r.behaviourPenaltyWeight>0)throw new ut("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)");if(r.behaviourPenaltyWeight!==0&&(r.behaviourPenaltyDecay<=0||r.behaviourPenaltyDecay>=1))throw new ut("invalid BehaviourPenaltyDecay; must be between 0 and 1");if(r.decayInterval<1e3)throw new ut("invalid DecayInterval; must be at least 1s");if(r.decayToZero<=0||r.decayToZero>=1)throw new ut("invalid DecayToZero; must be between 0 and 1")}function KAe(r){if(r.topicWeight<0)throw new ut("invalid topic weight; must be >= 0");if(r.timeInMeshQuantum===0)throw new ut("invalid TimeInMeshQuantum; must be non zero");if(r.timeInMeshWeight<0)throw new ut("invalid TimeInMeshWeight; must be positive (or 0 to disable)");if(r.timeInMeshWeight!==0&&r.timeInMeshQuantum<=0)throw new ut("invalid TimeInMeshQuantum; must be positive");if(r.timeInMeshWeight!==0&&r.timeInMeshCap<=0)throw new ut("invalid TimeInMeshCap; must be positive");if(r.firstMessageDeliveriesWeight<0)throw new ut("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)");if(r.firstMessageDeliveriesWeight!==0&&(r.firstMessageDeliveriesDecay<=0||r.firstMessageDeliveriesDecay>=1))throw new ut("invalid FirstMessageDeliveriesDecay; must be between 0 and 1");if(r.firstMessageDeliveriesWeight!==0&&r.firstMessageDeliveriesCap<=0)throw new ut("invalid FirstMessageDeliveriesCap; must be positive");if(r.meshMessageDeliveriesWeight>0)throw new ut("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)");if(r.meshMessageDeliveriesWeight!==0&&(r.meshMessageDeliveriesDecay<=0||r.meshMessageDeliveriesDecay>=1))throw new ut("invalid MeshMessageDeliveriesDecay; must be between 0 and 1");if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesCap<=0)throw new ut("invalid MeshMessageDeliveriesCap; must be positive");if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesThreshold<=0)throw new ut("invalid MeshMessageDeliveriesThreshold; must be positive");if(r.meshMessageDeliveriesWindow<0)throw new ut("invalid MeshMessageDeliveriesWindow; must be non-negative");if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesActivation<1e3)throw new ut("invalid MeshMessageDeliveriesActivation; must be at least 1s");if(r.meshFailurePenaltyWeight>0)throw new ut("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)");if(r.meshFailurePenaltyWeight!==0&&(r.meshFailurePenaltyDecay<=0||r.meshFailurePenaltyDecay>=1))throw new ut("invalid MeshFailurePenaltyDecay; must be between 0 and 1");if(r.invalidMessageDeliveriesWeight>0)throw new ut("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)");if(r.invalidMessageDeliveriesDecay<=0||r.invalidMessageDeliveriesDecay>=1)throw new ut("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1")}const HAe={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function jAe(r={}){return{...HAe,...r}}function _9(r,e,t=()=>!0){const n=new Set;if(e<=0)return n;for(const i of r){if(n.size>=e)break;t(i)&&(n.add(i),r.delete(i))}return n}function qAe(r,e){return _9(r,e,()=>!0)}class WAe extends Map{constructor(t){super();u(this,"getDefault");this.getDefault=t}getOrDefault(t){let n=super.get(t);return n===void 0&&(n=this.getDefault(),this.set(t,n)),n}}function GAe(r,e,t,n){let i=0;Object.entries(e.topics).forEach(([o,a])=>{const c=t.topics[o];if(c===void 0)return;let l=0;if(a.inMesh){let m=a.meshTime/c.timeInMeshQuantum;m>c.timeInMeshCap&&(m=c.timeInMeshCap),l+=m*c.timeInMeshWeight}let h=a.firstMessageDeliveries;if(h>c.firstMessageDeliveriesCap&&(h=c.firstMessageDeliveriesCap),l+=h*c.firstMessageDeliveriesWeight,a.meshMessageDeliveriesActive&&a.meshMessageDeliveries<c.meshMessageDeliveriesThreshold){const m=c.meshMessageDeliveriesThreshold-a.meshMessageDeliveries,f=m*m;l+=f*c.meshMessageDeliveriesWeight}const d=a.meshFailurePenalty;l+=d*c.meshFailurePenaltyWeight;const p=a.invalidMessageDeliveries*a.invalidMessageDeliveries;l+=p*c.invalidMessageDeliveriesWeight,i+=l*c.topicWeight}),t.topicScoreCap>0&&i>t.topicScoreCap&&(i=t.topicScoreCap);const s=t.appSpecificScore(r);if(i+=s*t.appSpecificWeight,e.knownIPs.forEach(o=>{if(t.IPColocationFactorWhitelist.has(o))return;const a=n.get(o),c=a!=null?a.size:0;if(c>t.IPColocationFactorThreshold){const l=c-t.IPColocationFactorThreshold,h=l*l;i+=h*t.IPColocationFactorWeight}}),e.behaviourPenalty>t.behaviourPenaltyThreshold){const o=e.behaviourPenalty-t.behaviourPenaltyThreshold,a=o*o;i+=a*t.behaviourPenaltyWeight}return i}function Bt(r,t){var t=t||{};this._capacity=t.capacity,this._head=0,this._tail=0,Array.isArray(r)?this._fromArray(r):(this._capacityMask=3,this._list=new Array(4))}Bt.prototype.peekAt=function(e){var t=e;if(t===(t|0)){var n=this.size();if(!(t>=n||t<-n))return t<0&&(t+=n),t=this._head+t&this._capacityMask,this._list[t]}};Bt.prototype.get=function(e){return this.peekAt(e)};Bt.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};Bt.prototype.peekFront=function(){return this.peek()};Bt.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(Bt.prototype,"length",{get:function(){return this.size()}});Bt.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Bt.prototype.unshift=function(e){if(arguments.length===0)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Bt.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}};Bt.prototype.push=function(e){if(arguments.length===0)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Bt.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),n}};Bt.prototype.removeOne=function(e){var t=e;if(t===(t|0)&&this._head!==this._tail){var n=this.size(),i=this._list.length;if(!(t>=n||t<-n)){t<0&&(t+=n),t=this._head+t&this._capacityMask;var s=this._list[t],o;if(e<n/2){for(o=e;o>0;o--)this._list[t]=this._list[t=t-1+i&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(o=n-1-e;o>0;o--)this._list[t]=this._list[t=t+1+i&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+i&this._capacityMask}return s}}};Bt.prototype.remove=function(e,t){var n=e,i,s=t;if(n===(n|0)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(n>=o||n<-o||t<1)){if(n<0&&(n+=o),t===1||!t)return i=new Array(1),i[0]=this.removeOne(n),i;if(n===0&&n+t>=o)return i=this.toArray(),this.clear(),i;n+t>o&&(t=o-n);var c;for(i=new Array(t),c=0;c<t;c++)i[c]=this._list[this._head+n+c&this._capacityMask];if(n=this._head+n&this._capacityMask,e+t===o){for(this._tail=this._tail-t+a&this._capacityMask,c=t;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(e===0){for(this._head=this._head+t+a&this._capacityMask,c=t-1;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(n<o/2){for(this._head=this._head+e+t+a&this._capacityMask,c=e;c>0;c--)this.unshift(this._list[n=n-1+a&this._capacityMask]);for(n=this._head-1+a&this._capacityMask;s>0;)this._list[n=n-1+a&this._capacityMask]=void 0,s--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+t+a&this._capacityMask,c=o-(t+e);c>0;c--)this.push(this._list[n++]);for(n=this._tail;s>0;)this._list[n=n+1+a&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),i}}};Bt.prototype.splice=function(e,t){var n=e;if(n===(n|0)){var i=this.size();if(n<0&&(n+=i),!(n>i))if(arguments.length>2){var s,o,a,c=arguments.length,l=this._list.length,h=2;if(!i||n<i/2){for(o=new Array(n),s=0;s<n;s++)o[s]=this._list[this._head+s&this._capacityMask];for(t===0?(a=[],n>0&&(this._head=this._head+n+l&this._capacityMask)):(a=this.remove(n,t),this._head=this._head+n+l&this._capacityMask);c>h;)this.unshift(arguments[--c]);for(s=n;s>0;s--)this.unshift(o[s-1])}else{o=new Array(i-(n+t));var d=o.length;for(s=0;s<d;s++)o[s]=this._list[this._head+n+t+s&this._capacityMask];for(t===0?(a=[],n!=i&&(this._tail=this._head+n+l&this._capacityMask)):(a=this.remove(n,t),this._tail=this._tail-d+l&this._capacityMask);h<c;)this.push(arguments[h++]);for(s=0;s<d;s++)this.push(o[s])}return a}else return this.remove(n,t)}};Bt.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0};Bt.prototype.isEmpty=function(){return this._head===this._tail};Bt.prototype.toArray=function(){return this._copyArray(!1)};Bt.prototype._fromArray=function(e){var t=e.length,n=this._nextPowerOf2(t);this._list=new Array(n),this._capacityMask=n-1,this._tail=t;for(var i=0;i<t;i++)this._list[i]=e[i]};Bt.prototype._copyArray=function(e,t){var n=this._list,i=n.length,s=this.length;if(t=t|s,t==s&&this._head<this._tail)return this._list.slice(this._head,this._tail);var o=new Array(t),a=0,c;if(e||this._head>this._tail){for(c=this._head;c<i;c++)o[a++]=n[c];for(c=0;c<this._tail;c++)o[a++]=n[c]}else for(c=this._head;c<this._tail;c++)o[a++]=n[c];return o};Bt.prototype._growArray=function(){if(this._head!=0){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1};Bt.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};Bt.prototype._nextPowerOf2=function(e){var t=Math.log(e)/Math.log(2),n=1<<t+1;return Math.max(n,4)};var QAe=Bt;const YAe=Vo(QAe);var mn;(function(r){r[r.unknown=0]="unknown",r[r.valid=1]="valid",r[r.invalid=2]="invalid",r[r.ignored=3]="ignored"})(mn||(mn={}));class XAe{constructor(){u(this,"records");u(this,"queue");this.records=new Map,this.queue=new YAe}getRecord(e){return this.records.get(e)}ensureRecord(e){let t=this.records.get(e);if(t!=null)return t;t={status:mn.unknown,firstSeenTsMs:Date.now(),validated:0,peers:new Set},this.records.set(e,t);const n={msgId:e,expire:Date.now()+CAe};return this.queue.push(n),t}gc(){const e=Date.now();let t=this.queue.peekFront();for(;t!=null&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}class JAe{constructor(e,t,n,i){u(this,"params");u(this,"metrics");u(this,"peerStats",new Map);u(this,"peerIPs",new WAe(()=>new Set));u(this,"scoreCache",new Map);u(this,"deliveryRecords",new XAe);u(this,"_backgroundInterval");u(this,"scoreCacheValidityMs");u(this,"computeScore");u(this,"log");this.params=e,this.metrics=t,VAe(e),this.scoreCacheValidityMs=i.scoreCacheValidityMs,this.computeScore=i.computeScore??GAe,this.log=n.forComponent("libp2p:gossipsub:score")}get size(){return this.peerStats.size}start(){if(this._backgroundInterval!=null){this.log("Peer score already running");return}this._backgroundInterval=setInterval(()=>{this.background()},this.params.decayInterval),this.log("started")}stop(){if(this._backgroundInterval==null){this.log("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),this.log("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,t])=>[e,t]))}messageFirstSeenTimestampMs(e){const t=this.deliveryRecords.getRecord(e);return t!=null?t.firstSeenTsMs:null}refreshScores(){const e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach((n,i)=>{if(!n.connected){e>n.expire&&(this.removeIPsForPeer(i,n.knownIPs),this.peerStats.delete(i),this.scoreCache.delete(i));return}Object.entries(n.topics).forEach(([s,o])=>{const a=this.params.topics[s];a!==void 0&&(o.firstMessageDeliveries*=a.firstMessageDeliveriesDecay,o.firstMessageDeliveries<t&&(o.firstMessageDeliveries=0),o.meshMessageDeliveries*=a.meshMessageDeliveriesDecay,o.meshMessageDeliveries<t&&(o.meshMessageDeliveries=0),o.meshFailurePenalty*=a.meshFailurePenaltyDecay,o.meshFailurePenalty<t&&(o.meshFailurePenalty=0),o.invalidMessageDeliveries*=a.invalidMessageDeliveriesDecay,o.invalidMessageDeliveries<t&&(o.invalidMessageDeliveries=0),o.inMesh&&(o.meshTime=e-o.graftTime,o.meshTime>a.meshMessageDeliveriesActivation&&(o.meshMessageDeliveriesActive=!0)))}),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<t&&(n.behaviourPenalty=0)})}score(e){var a,c,l;(a=this.metrics)==null||a.scoreFnCalls.inc();const t=this.peerStats.get(e);if(t==null)return 0;const n=Date.now(),i=this.scoreCache.get(e);if(i!=null&&i.cacheUntil>n)return i.score;(c=this.metrics)==null||c.scoreFnRuns.inc();const s=this.computeScore(e,t,this.params,this.peerIPs),o=n+this.scoreCacheValidityMs;return i!=null?((l=this.metrics)==null||l.scoreCachedDelta.observe(Math.abs(s-i.score)),i.score=s,i.cacheUntil=o):this.scoreCache.set(e,{score:s,cacheUntil:o}),s}addPenalty(e,t,n){var s;const i=this.peerStats.get(e);i!=null&&(i.behaviourPenalty+=t,(s=this.metrics)==null||s.onScorePenalty(n))}addPeer(e){const t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){const n=this.peerStats.get(e);n!=null&&n.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){const n=this.peerStats.get(e);n!=null&&n.knownIPs.delete(t);const i=this.peerIPs.get(t);i!=null&&(i.delete(e),i.size===0&&this.peerIPs.delete(t))}removePeer(e){const t=this.peerStats.get(e);if(t!=null){if(this.score(e)>0){this.removeIPsForPeer(e,t.knownIPs),this.peerStats.delete(e);return}Object.entries(t.topics).forEach(([n,i])=>{i.firstMessageDeliveries=0;const s=this.params.topics[n].meshMessageDeliveriesThreshold;if(i.inMesh&&i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<s){const o=s-i.meshMessageDeliveries;i.meshFailurePenalty+=o*o}i.inMesh=!1,i.meshMessageDeliveriesActive=!1}),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){const n=this.peerStats.get(e);if(n!=null){const i=this.getPtopicStats(n,t);i!=null&&(i.inMesh=!0,i.graftTime=Date.now(),i.meshTime=0,i.meshMessageDeliveriesActive=!1)}}prune(e,t){const n=this.peerStats.get(e);if(n!=null){const i=this.getPtopicStats(n,t);if(i!=null){const s=this.params.topics[t].meshMessageDeliveriesThreshold;if(i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<s){const o=s-i.meshMessageDeliveries;i.meshFailurePenalty+=o*o}i.meshMessageDeliveriesActive=!1,i.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,n){this.markFirstMessageDelivery(e,n);const i=this.deliveryRecords.ensureRecord(t),s=Date.now();if(i.status!==mn.unknown){this.log("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,s-i.firstSeenTsMs,mn[i.status]);return}i.status=mn.valid,i.validated=s,i.peers.forEach(o=>{o!==e.toString()&&this.markDuplicateMessageDelivery(o,n)})}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,n,i){switch(i){case as.Error:this.markInvalidMessageDelivery(e,n);return;case as.Blacklisted:return}const s=this.deliveryRecords.ensureRecord(t);if(s.status!==mn.unknown){this.log("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-s.firstSeenTsMs,mn[s.status]);return}if(i===as.Ignore){s.status=mn.ignored,s.peers.clear();return}s.status=mn.invalid,this.markInvalidMessageDelivery(e,n),s.peers.forEach(o=>{this.markInvalidMessageDelivery(o,n)}),s.peers.clear()}duplicateMessage(e,t,n){const i=this.deliveryRecords.ensureRecord(t);if(!i.peers.has(e))switch(i.status){case mn.unknown:i.peers.add(e);break;case mn.valid:i.peers.add(e),this.markDuplicateMessageDelivery(e,n,i.validated);break;case mn.invalid:this.markInvalidMessageDelivery(e,n);break;case mn.ignored:break}}markInvalidMessageDelivery(e,t){const n=this.peerStats.get(e);if(n!=null){const i=this.getPtopicStats(n,t);i!=null&&(i.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){const n=this.peerStats.get(e);if(n!=null){const i=this.getPtopicStats(n,t);if(i!=null){let s=this.params.topics[t].firstMessageDeliveriesCap;i.firstMessageDeliveries=Math.min(s,i.firstMessageDeliveries+1),i.inMesh&&(s=this.params.topics[t].meshMessageDeliveriesCap,i.meshMessageDeliveries=Math.min(s,i.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,n){var s;const i=this.peerStats.get(e);if(i!=null){const o=n!==void 0?Date.now():0,a=this.getPtopicStats(i,t);if(a!=null&&a.inMesh){const c=this.params.topics[t];if(n!==void 0){const h=o-n,d=h>c.meshMessageDeliveriesWindow;if((s=this.metrics)==null||s.onDuplicateMsgDelivery(t,h,d),d)return}const l=c.meshMessageDeliveriesCap;a.meshMessageDeliveries=Math.min(l,a.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(const n of t){const i=this.peerIPs.get(n);i!=null&&(i.delete(e),i.size===0&&this.peerIPs.delete(n))}}getPtopicStats(e,t){let n=e.topics[t];return n!==void 0?n:this.params.topics[t]!==void 0?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=n,n):null}}function ZAe(r,e,t,n,i){let s=0;const o=new Map;if(Object.entries(e.topics).forEach(([p,m])=>{const f=i.get(p)??"unknown",g=t.topics[p];if(g===void 0)return;let v=o.get(f);v==null&&(v={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(f,v));let y=0,w=0,b=0,E=0,C=0;if(m.inMesh){const T=Math.max(m.meshTime/g.timeInMeshQuantum,g.timeInMeshCap);y+=T*g.timeInMeshWeight}let k=m.firstMessageDeliveries;if(k>g.firstMessageDeliveriesCap&&(k=g.firstMessageDeliveriesCap),w+=k*g.firstMessageDeliveriesWeight,m.meshMessageDeliveriesActive&&m.meshMessageDeliveries<g.meshMessageDeliveriesThreshold){const T=g.meshMessageDeliveriesThreshold-m.meshMessageDeliveries,L=T*T;b+=L*g.meshMessageDeliveriesWeight}const x=m.meshFailurePenalty;E+=x*g.meshFailurePenaltyWeight;const I=m.invalidMessageDeliveries*m.invalidMessageDeliveries;C+=I*g.invalidMessageDeliveriesWeight,s+=(y+w+b+E+C)*g.topicWeight,v.p1w+=y,v.p2w+=w,v.p3w+=b,v.p3bw+=E,v.p4w+=C}),t.topicScoreCap>0&&s>t.topicScoreCap){s=t.topicScoreCap;const p=t.topicScoreCap/s;for(const m of o.values())m.p1w*=p,m.p2w*=p,m.p3w*=p,m.p3bw*=p,m.p4w*=p}let a=0,c=0,l=0;const h=t.appSpecificScore(r);a+=h*t.appSpecificWeight,e.knownIPs.forEach(p=>{if(t.IPColocationFactorWhitelist.has(p))return;const m=n.get(p),f=m!=null?m.size:0;if(f>t.IPColocationFactorThreshold){const g=f-t.IPColocationFactorThreshold,v=g*g;c+=v*t.IPColocationFactorWeight}});const d=e.behaviourPenalty*e.behaviourPenalty;return l+=d*t.behaviourPenaltyWeight,s+=a+c+l,{byTopic:o,p5w:a,p6w:c,p7w:l,score:s}}function eCe(r,e,t,n,i){const s={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const o of r){const a=e.get(o);if(a!=null){const c=ZAe(o,a,t,n,i);for(const[l,h]of c.byTopic){let d=s.byTopic.get(l);d==null&&(d={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},s.byTopic.set(l,d)),d.p1w.push(h.p1w),d.p2w.push(h.p2w),d.p3w.push(h.p3w),d.p3bw.push(h.p3bw),d.p4w.push(h.p4w)}s.p5w.push(c.p5w),s.p6w.push(c.p6w),s.p7w.push(c.p7w),s.score.push(c.score)}else s.p5w.push(0),s.p6w.push(0),s.p7w.push(0),s.score.push(0)}return s}class tCe{constructor(e,t,n){u(this,"rawStream");u(this,"pushable");u(this,"closeController");u(this,"maxBufferSize");this.rawStream=e,this.pushable=No(),this.closeController=new AbortController,this.maxBufferSize=n.maxBufferSize??1/0,this.closeController.signal.addEventListener("abort",()=>{e.close().catch(i=>{e.abort(i)})}),cn(this.pushable,this.rawStream).catch(t)}get protocol(){return this.rawStream.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(PA.single(e))}pushPrefixed(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}async close(){this.closeController.abort(),await this.pushable.return()}}class rCe{constructor(e,t={}){u(this,"source");u(this,"rawStream");u(this,"closeController");this.rawStream=e,this.closeController=new AbortController,this.closeController.signal.addEventListener("abort",()=>{e.close().catch(n=>{e.abort(n)})}),this.source=cn(this.rawStream,n=>I9(n,t))}async close(){this.closeController.abort()}}class nCe{constructor(e,t,n){u(this,"gossipsubIWantFollowupMs");u(this,"msgIdToStrFn");u(this,"metrics");u(this,"promises",new Map);u(this,"requestMsByMsg",new Map);u(this,"requestMsByMsgExpire");this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=n,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){const n=Math.floor(Math.random()*t.length),i=t[n],s=this.msgIdToStrFn(i);let o=this.promises.get(s);o==null&&(o=new Map,this.promises.set(s,o));const a=Date.now();o.has(e)||(o.set(e,a+this.gossipsubIWantFollowupMs),this.metrics!=null&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(s)||this.requestMsByMsg.set(s,a)))}getBrokenPromises(){var i;const e=Date.now(),t=new Map;let n=0;return this.promises.forEach((s,o)=>{s.forEach((a,c)=>{a<e&&(t.set(c,(t.get(c)??0)+1),s.delete(c),n++)}),s.size===0&&this.promises.delete(o)}),(i=this.metrics)==null||i.iwantPromiseBroken.inc(n),t}deliverMessage(e,t=!1){this.trackMessage(e);const n=this.promises.get(e);n!=null&&(this.promises.delete(e),this.metrics!=null&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(n.size)))}rejectMessage(e,t){switch(this.trackMessage(e),t){case as.Error:return}this.promises.delete(e)}clear(){this.promises.clear()}prune(){var n;const e=Date.now()-this.requestMsByMsgExpire;let t=0;for(const[i,s]of this.requestMsByMsg.entries())if(s<e)this.requestMsByMsg.delete(i),t++;else break;(n=this.metrics)==null||n.iwantMessagePruned.inc(t)}trackMessage(e){if(this.metrics!=null){const t=this.requestMsByMsg.get(e);t!==void 0&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}const qj=se("libp2p-pubsub:");async function iCe(r,e,t,n){switch(r.type){case Sd.Signing:{const i={from:r.author.toMultihash().bytes,data:n,seqno:bc(8),topic:e,signature:void 0,key:void 0},s=er([qj,Ml.Message.encode(i)]);i.signature=await r.privateKey.sign(s),i.key=r.key;const o={type:"signed",from:r.author,data:t,sequenceNumber:BigInt(`0x${re(i.seqno??new Uint8Array(0),"base16")}`),topic:e,signature:i.signature,key:$n(i.key)};return{raw:i,msg:o}}case Sd.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:e,signature:void 0,key:void 0},msg:{type:"unsigned",data:t,topic:e}};default:throw new Error("Unreachable")}}async function sCe(r,e){switch(r){case tS:return e.signature!=null?{valid:!1,error:yn.SignaturePresent}:e.seqno!=null?{valid:!1,error:yn.SeqnoPresent}:e.key!=null?{valid:!1,error:yn.FromPresent}:{valid:!0,message:{type:"unsigned",topic:e.topic,data:e.data??new Uint8Array(0)}};case ty:{if(e.seqno==null)return{valid:!1,error:yn.InvalidSeqno};if(e.seqno.length!==8)return{valid:!1,error:yn.InvalidSeqno};if(e.signature==null)return{valid:!1,error:yn.InvalidSignature};if(e.from==null)return{valid:!1,error:yn.InvalidPeerId};let t;try{t=ri(Hj(e.from))}catch{return{valid:!1,error:yn.InvalidPeerId}}let n;if(e.key!=null){if(n=$n(e.key),t.publicKey!==void 0&&!n.equals(t.publicKey))return{valid:!1,error:yn.InvalidPeerId}}else{if(t.publicKey==null)return{valid:!1,error:yn.InvalidPeerId};n=t.publicKey}const i={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},s=er([qj,Ml.Message.encode(i)]);return await n.verify(s,e.signature)?{valid:!0,message:{type:"signed",from:t,data:e.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${re(e.seqno,"base16")}`),topic:e.topic,signature:e.signature,key:e.key!=null?$n(e.key):n}}:{valid:!1,error:yn.InvalidSignature}}default:throw new Error("Unreachable")}}function xs(r=[],e){return{subscriptions:[],messages:r,control:e!==void 0?{graft:e.graft??[],prune:e.prune??[],ihave:e.ihave??[],iwant:e.iwant??[],idontwant:e.idontwant??[]}:void 0}}function W$(r){return r.control===void 0&&(r.control={graft:[],prune:[],ihave:[],iwant:[],idontwant:[]}),r}function ro(r){if(r.length<=1)return r;const e=()=>Math.floor(Math.random()*Math.floor(r.length));for(let t=0;t<r.length;t++){const n=e(),i=r[t];r[t]=r[n],r[n]=i}return r}function oCe(r){return re(r,"base64")}function aCe(r,e,t){switch(r){case ty:return{type:Sd.Signing,author:e,key:_i(t.publicKey),privateKey:t};case tS:return{type:Sd.Anonymous};default:throw new Error(`Unknown signature policy "${r}"`)}}const cCe=(r,e)=>{const t=se(e.toString(16).padStart(16,"0"),"base16"),n=_i(r),i=new Uint8Array(n.byteLength+t.length);return i.set(n,0),i.set(t,n.byteLength),i};function lCe({name:r,code:e,encode:t}){return new uCe(r,e,t)}class uCe{constructor(e,t,n){u(this,"name");u(this,"code");u(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?F$(this.code,t):t.then(n=>F$(this.code,n))}else throw Error("Unknown type, must be binary type")}}function hCe(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const dCe=lCe({name:"sha2-256",code:18,encode:hCe("SHA-256")});function fCe(r){if(r.type!=="signed")throw new Error("expected signed message type");if(r.sequenceNumber==null)throw Error("missing seqno field");return cCe(r.from.publicKey??r.key,r.sequenceNumber)}async function pCe(r){return dCe.encode(r.data)}var d3;(function(r){r[r.ip4=4]="ip4",r[r.ip6=41]="ip6"})(d3||(d3={}));function gCe(r){for(const e of r.tuples())switch(e[0]){case d3.ip4:case d3.ip6:return ox(e[0],e[1])}return null}class X5{constructor(e){u(this,"entries",new Map);u(this,"validityMs");this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return this.entries.has(e)?!0:(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){const e=Date.now();for(const[t,n]of this.entries.entries())if(n.validUntilMs<e)this.entries.delete(t);else break}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);return t!=null&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}var Un;(function(r){r[r.started=0]="started",r[r.stopped=1]="stopped"})(Un||(Un={}));var gM,yM,mM,wM;class Wj extends(wM=Yt,mM=Symbol.toStringTag,yM=ur,gM=mc,wM){constructor(t,n={}){super();u(this,"globalSignaturePolicy");u(this,"multicodecs",[Y5,eAe,V$]);u(this,"publishConfig");u(this,"dataTransform");u(this,"peers",new Map);u(this,"streamsInbound",new Map);u(this,"streamsOutbound",new Map);u(this,"outboundInflightQueue",No({objectMode:!0}));u(this,"direct",new Set);u(this,"floodsubPeers",new Set);u(this,"seenCache");u(this,"acceptFromWhitelist",new Map);u(this,"topics",new Map);u(this,"subscriptions",new Set);u(this,"mesh",new Map);u(this,"fanout",new Map);u(this,"fanoutLastpub",new Map);u(this,"gossip",new Map);u(this,"control",new Map);u(this,"peerhave",new Map);u(this,"iasked",new Map);u(this,"backoff",new Map);u(this,"outbound",new Map);u(this,"msgIdFn");u(this,"fastMsgIdFn");u(this,"msgIdToStrFn");u(this,"fastMsgIdCache");u(this,"publishedMessageIds");u(this,"mcache");u(this,"score");u(this,"topicValidators",new Map);u(this,"log");u(this,"heartbeatTicks",0);u(this,"gossipTracer");u(this,"idontwantCounts",new Map);u(this,"idontwants",new Map);u(this,"components");u(this,"directPeerInitial",null);u(this,"opts");u(this,"decodeRpcLimits");u(this,"metrics");u(this,"status",{code:Un.stopped});u(this,"maxInboundStreams");u(this,"maxOutboundStreams");u(this,"runOnLimitedConnection");u(this,"allowedTopics");u(this,"heartbeatTimer",null);u(this,mM,"@chainsafe/libp2p-gossipsub");u(this,yM,["@libp2p/pubsub"]);u(this,gM,["@libp2p/identify"]);u(this,"runHeartbeat",()=>{var n;const t=(n=this.metrics)==null?void 0:n.heartbeatDuration.startTimer();this.heartbeat().catch(i=>{this.log("Error running heartbeat",i)}).finally(()=>{var i;if(t!=null&&t(),this.status.code===Un.started){clearTimeout(this.status.heartbeatTimeout);let s=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;s<this.opts.heartbeatInterval*.25&&(s+=this.opts.heartbeatInterval,(i=this.metrics)==null||i.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,s)}})});u(this,"tagMeshPeer",t=>{const{peerId:n,topic:i}=t.detail;this.components.peerStore.merge(this.peers.get(n)??Wt(n),{tags:{[i]:{value:100}}}).catch(s=>{this.log.error("Error tagging peer %s with topic %s",n,i,s)})});u(this,"untagMeshPeer",t=>{const{peerId:n,topic:i}=t.detail;this.components.peerStore.merge(this.peers.get(n)??Wt(n),{tags:{[i]:void 0}}).catch(s=>{this.log.error("Error untagging peer %s with topic %s",n,i,s)})});const i={fallbackToFloodsub:!0,floodPublish:!0,batchPublish:!1,tagMeshPeers:!0,doPX:!1,directPeers:[],D:tAe,Dlo:rAe,Dhi:nAe,Dscore:iAe,Dout:sAe,Dlazy:cAe,heartbeatInterval:hAe,fanoutTTL:dAe,mcacheLength:oAe,mcacheGossip:aAe,seenTTL:AAe,gossipsubIWantFollowupMs:xAe,prunePeers:fAe,pruneBackoff:pAe,unsubcribeBackoff:gAe,graftFloodThreshold:EAe,opportunisticGraftPeers:vAe,opportunisticGraftTicks:bAe,directConnectTicks:mAe,gossipFactor:lAe,idontwantMinDataSize:NAe,idontwantMaxMessages:MAe,...n,scoreParams:FAe(n.scoreParams),scoreThresholds:jAe(n.scoreThresholds)};if(this.components=t,this.decodeRpcLimits=i.decodeRpcLimits??OAe,this.globalSignaturePolicy=i.globalSignaturePolicy??ty,i.fallbackToFloodsub&&this.multicodecs.push(z$),this.log=t.logger.forComponent(i.debugName??"libp2p:gossipsub"),this.opts=i,this.direct=new Set(i.directPeers.map(s=>s.id.toString())),this.seenCache=new X5({validityMs:i.seenTTL}),this.publishedMessageIds=new X5({validityMs:i.seenTTL}),n.msgIdFn!=null)this.msgIdFn=n.msgIdFn;else switch(this.globalSignaturePolicy){case ty:this.msgIdFn=fCe;break;case tS:this.msgIdFn=pCe;break;default:throw new Error(`Invalid globalSignaturePolicy: ${this.globalSignaturePolicy}`)}if(n.fastMsgIdFn!=null&&(this.fastMsgIdFn=n.fastMsgIdFn,this.fastMsgIdCache=new X5({validityMs:i.seenTTL})),this.msgIdToStrFn=n.msgIdToStrFn??oCe,this.mcache=n.messageCache??new RAe(i.mcacheGossip,i.mcacheLength,this.msgIdToStrFn),n.dataTransform!=null&&(this.dataTransform=n.dataTransform),n.metricsRegister!=null){if(n.metricsTopicStrToLabel==null)throw Error("Must set metricsTopicStrToLabel with metrics");const s=Math.max(...Object.values(i.scoreParams.topics).map(a=>a.meshMessageDeliveriesWindow),DAe),o=LAe(n.metricsRegister,n.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:i.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:s/1e3});o.mcacheSize.addCollect(()=>{this.onScrapeMetrics(o)});for(const a of this.multicodecs)o.protocolsEnabled.set({protocol:a},1);this.metrics=o}else this.metrics=null;this.gossipTracer=new nCe(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new JAe(this.opts.scoreParams,this.metrics,this.components.logger,{scoreCacheValidityMs:i.heartbeatInterval}),this.maxInboundStreams=n.maxInboundStreams,this.maxOutboundStreams=n.maxOutboundStreams,this.runOnLimitedConnection=n.runOnLimitedConnection,this.allowedTopics=i.allowedTopics!=null?new Set(i.allowedTopics):null}getPeers(){return[...this.peers.values()]}isStarted(){return this.status.code===Un.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=aCe(this.globalSignaturePolicy,this.components.peerId,this.components.privateKey),this.outboundInflightQueue=No({objectMode:!0}),cn(this.outboundInflightQueue,async o=>{for await(const{peerId:a,connection:c}of o)await this.createOutboundStream(a,c)}).catch(o=>{this.log.error("outbound inflight queue error",o)}),await Promise.all(this.opts.directPeers.map(async o=>{await this.components.peerStore.merge(o.id,{multiaddrs:o.addrs})}));const t=this.components.registrar;await Promise.all(this.multicodecs.map(async o=>t.handle(o,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection})));const n={onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this),notifyOnLimitedConnection:this.runOnLimitedConnection},i=await Promise.all(this.multicodecs.map(async o=>t.register(o,n))),s=setTimeout(this.runHeartbeat,K$);this.status={code:Un.started,registrarTopologyIds:i,heartbeatTimeout:s,hearbeatStartMs:Date.now()+K$},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async o=>this.connect(o)))}).catch(o=>{this.log(o)})},wAe),this.opts.tagMeshPeers&&(this.addEventListener("gossipsub:graft",this.tagMeshPeer),this.addEventListener("gossipsub:prune",this.untagMeshPeer)),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==Un.started)return;const{registrarTopologyIds:t}=this.status;this.status={code:Un.stopped},this.opts.tagMeshPeers&&(this.removeEventListener("gossipsub:graft",this.tagMeshPeer),this.removeEventListener("gossipsub:prune",this.untagMeshPeer));const n=this.components.registrar;await Promise.all(this.multicodecs.map(async s=>n.unhandle(s))),t.forEach(s=>{n.unregister(s)}),this.outboundInflightQueue.end();const i=[];for(const s of this.streamsOutbound.values())i.push(s.close());this.streamsOutbound.clear();for(const s of this.streamsInbound.values())i.push(s.close());this.streamsInbound.clear(),await Promise.all(i),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer!=null&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache!=null&&this.fastMsgIdCache.clear(),this.directPeerInitial!=null&&clearTimeout(this.directPeerInitial),this.idontwantCounts.clear(),this.idontwants.clear(),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:t,connection:n}){if(!this.isStarted())return;const i=n.remotePeer;this.addPeer(i,n.direction,n.remoteAddr),this.createInboundStream(i,t),this.outboundInflightQueue.push({peerId:i,connection:n})}onPeerConnected(t,n){var i;(i=this.metrics)==null||i.newConnectionCount.inc({status:n.status}),!(!this.isStarted()||n.status!=="open")&&(this.addPeer(t,n.direction,n.remoteAddr),this.outboundInflightQueue.push({peerId:t,connection:n}))}onPeerDisconnected(t){this.log("connection ended %p",t),this.removePeer(t)}async createOutboundStream(t,n){var s;if(!this.isStarted())return;const i=t.toString();if(this.peers.has(i)&&!this.streamsOutbound.has(i))try{const o=new tCe(await n.newStream(this.multicodecs,{runOnLimitedConnection:this.runOnLimitedConnection}),c=>{this.log.error("outbound pipe error",c)},{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",t),this.streamsOutbound.set(i,o);const a=o.protocol;a===z$&&this.floodsubPeers.add(i),(s=this.metrics)==null||s.peersPerProtocol.inc({protocol:a},1),this.subscriptions.size>0&&(this.log("send subscriptions to",i),this.sendSubscriptions(i,Array.from(this.subscriptions),!0))}catch(o){this.log.error("createOutboundStream error",o)}}createInboundStream(t,n){if(!this.isStarted())return;const i=t.toString();if(!this.peers.has(i))return;const s=this.streamsInbound.get(i);s!==void 0&&(this.log("replacing existing inbound steam %s",i),s.close().catch(a=>{this.log.error(a)})),this.log("create inbound stream %s",i);const o=new rCe(n,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(i,o),this.pipePeerReadStream(t,o.source).catch(a=>{this.log(a)})}addPeer(t,n,i){const s=t.toString();if(!this.peers.has(s)){this.log("new peer %p",t),this.peers.set(s,t),this.score.addPeer(s);const o=gCe(i);o!==null?this.score.addIP(s,o):this.log("Added peer has no IP in current address %s %s",s,i.toString()),this.outbound.has(s)||this.outbound.set(s,n==="outbound")}}removePeer(t){var o,a;const n=t.toString();if(!this.peers.has(n))return;this.log("delete peer %p",t),this.peers.delete(n);const i=this.streamsOutbound.get(n),s=this.streamsInbound.get(n);i!=null&&((o=this.metrics)==null||o.peersPerProtocol.inc({protocol:i.protocol},-1)),i==null||i.close().catch(c=>{this.log.error(c)}),s==null||s.close().catch(c=>{this.log.error(c)}),this.streamsOutbound.delete(n),this.streamsInbound.delete(n);for(const c of this.topics.values())c.delete(n);for(const[c,l]of this.mesh)l.delete(n)&&((a=this.metrics)==null||a.onRemoveFromMesh(c,$s.Dc,1));for(const c of this.fanout.values())c.delete(n);this.floodsubPeers.delete(n),this.gossip.delete(n),this.control.delete(n),this.outbound.delete(n),this.idontwantCounts.delete(n),this.idontwants.delete(n),this.score.removePeer(n),this.acceptFromWhitelist.delete(n)}get started(){return this.status.code===Un.started}getMeshPeers(t){const n=this.mesh.get(t);return n!=null?Array.from(n):[]}getSubscribers(t){const n=this.topics.get(t);return(n!=null?Array.from(n):[]).map(i=>this.peers.get(i)??Wt(i))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(t,n){var i;try{await cn(n,async s=>{var o,a,c;for await(const l of s)try{const h=l.subarray(),d=Ml.decode(h,{limits:{subscriptions:this.decodeRpcLimits.maxSubscriptions,messages:this.decodeRpcLimits.maxMessages,control$:{ihave:this.decodeRpcLimits.maxIhaveMessageIDs,iwant:this.decodeRpcLimits.maxIwantMessageIDs,graft:this.decodeRpcLimits.maxControlMessages,prune:this.decodeRpcLimits.maxControlMessages,prune$:{peers:this.decodeRpcLimits.maxPeerInfos},idontwant:this.decodeRpcLimits.maxControlMessages,idontwant$:{messageIDs:this.decodeRpcLimits.maxIdontwantMessageIDs}}}});if((o=this.metrics)==null||o.onRpcRecv(d,h.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(t,d)}catch(p){(a=this.metrics)==null||a.onRpcRecvError(),this.log(p)}else this.handleReceivedRpc(t,d).catch(p=>{var m;(m=this.metrics)==null||m.onRpcRecvError(),this.log(p)})}catch(h){(c=this.metrics)==null||c.onRpcDataError(),this.log(h)}})}catch(s){(i=this.metrics)==null||i.onPeerReadStreamError(),this.handlePeerReadStreamError(s,t)}}handlePeerReadStreamError(t,n){this.log.error(t),this.onPeerDisconnected(n)}async handleReceivedRpc(t,n){var h;if(!this.acceptFrom(t.toString())){this.log("received message from unacceptable peer %p",t),(h=this.metrics)==null||h.rpcRecvNotAccepted.inc();return}const i=n.subscriptions!=null?n.subscriptions.length:0,s=n.messages!=null?n.messages.length:0;let o=0,a=0,c=0,l=0;if(n.control!=null&&(n.control.ihave!=null&&(o=n.control.ihave.length),n.control.iwant!=null&&(a=n.control.iwant.length),n.control.graft!=null&&(c=n.control.graft.length),n.control.prune!=null&&(l=n.control.prune.length)),this.log(`rpc.from ${t.toString()} subscriptions ${i} messages ${s} ihave ${o} iwant ${a} graft ${c} prune ${l}`),n.subscriptions!=null&&n.subscriptions.length>0){const d=[];n.subscriptions.forEach(p=>{const m=p.topic,f=p.subscribe===!0;if(m!=null){if(this.allowedTopics!=null&&!this.allowedTopics.has(m))return;this.handleReceivedSubscription(t,m,f),d.push({topic:m,subscribe:f})}}),this.safeDispatchEvent("subscription-change",{detail:{peerId:t,subscriptions:d}})}for(const d of n.messages){if(this.allowedTopics!=null&&!this.allowedTopics.has(d.topic))continue;const p=this.handleReceivedMessage(t,d).catch(m=>{var f;(f=this.metrics)==null||f.onMsgRecvError(d.topic),this.log(m)});this.opts.awaitRpcMessageHandler&&await p}n.control!=null&&await this.handleControlMessage(t.toString(),n.control)}handleReceivedSubscription(t,n,i){this.log("subscription update from %p topic %s",t,n);let s=this.topics.get(n);s==null&&(s=new Set,this.topics.set(n,s)),i?s.add(t.toString()):s.delete(t.toString())}async handleReceivedMessage(t,n){var o,a,c;(o=this.metrics)==null||o.onMsgRecvPreValidation(n.topic);const i=await this.validateReceivedMessage(t,n);(a=this.metrics)==null||a.onPrevalidationResult(n.topic,i.code);const s=i.code;switch(s){case wn.duplicate:this.score.duplicateMessage(t.toString(),i.msgIdStr,n.topic),this.gossipTracer.deliverMessage(i.msgIdStr,!0),this.mcache.observeDuplicate(i.msgIdStr,t.toString());return;case wn.invalid:if(i.msgIdStr!=null){const l=i.msgIdStr;this.score.rejectMessage(t.toString(),l,n.topic,i.reason),this.gossipTracer.rejectMessage(l,i.reason)}else this.score.rejectInvalidMessage(t.toString(),n.topic);(c=this.metrics)==null||c.onMsgRecvInvalid(n.topic,i);return;case wn.valid:this.score.validateMessage(i.messageId.msgIdStr),this.gossipTracer.deliverMessage(i.messageId.msgIdStr),this.mcache.put(i.messageId,n,!this.opts.asyncValidation),this.subscriptions.has(n.topic)&&(!this.components.peerId.equals(t)||this.opts.emitSelf)&&(super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:t,msgId:i.messageId.msgIdStr,msg:i.msg}})),super.dispatchEvent(new CustomEvent("message",{detail:i.msg}))),this.opts.asyncValidation||this.forwardMessage(i.messageId.msgIdStr,n,t.toString());break;default:throw new Error(`Invalid validation result: ${s}`)}}async validateReceivedMessage(t,n){var p,m,f,g;const i=(p=this.fastMsgIdFn)==null?void 0:p.call(this,n),s=i!==void 0?(m=this.fastMsgIdCache)==null?void 0:m.get(i):void 0;if(s!=null)return{code:wn.duplicate,msgIdStr:s};const o=await sCe(this.globalSignaturePolicy,n);if(!o.valid)return{code:wn.invalid,reason:as.Error,error:o.error};const a=o.message;try{this.dataTransform!=null&&(a.data=this.dataTransform.inboundTransform(n.topic,a.data))}catch(v){return this.log("Invalid message, transform failed",v),{code:wn.invalid,reason:as.Error,error:yn.TransformFailed}}const c=await this.msgIdFn(a),l=this.msgIdToStrFn(c),h={msgId:c,msgIdStr:l};if(i!==void 0&&this.fastMsgIdCache!=null&&this.fastMsgIdCache.put(i,l)&&((f=this.metrics)==null||f.fastMsgIdCacheCollision.inc()),this.seenCache.has(l))return{code:wn.duplicate,msgIdStr:l};this.seenCache.put(l),(((g=n.data)==null?void 0:g.length)??0)>=this.opts.idontwantMinDataSize&&this.sendIDontWants(c,n.topic,t.toString());const d=this.topicValidators.get(n.topic);if(d!=null){let v;try{v=await d(t,a)}catch(y){const w=y.code;w===kAe&&(v=Ei.Ignore),w===IAe?v=Ei.Reject:v=Ei.Ignore}if(v!==Ei.Accept)return{code:wn.invalid,reason:j$(v),msgIdStr:l}}return{code:wn.valid,messageId:h,msg:a}}getScore(t){return this.score.score(t)}sendSubscriptions(t,n,i){this.sendRpc(t,{subscriptions:n.map(s=>({topic:s,subscribe:i})),messages:[]})}async handleControlMessage(t,n){var l,h,d,p,m,f,g;if(n===void 0)return;const i=((l=n.ihave)==null?void 0:l.length)>0?this.handleIHave(t,n.ihave):[],s=((h=n.iwant)==null?void 0:h.length)>0?this.handleIWant(t,n.iwant):[],o=((d=n.graft)==null?void 0:d.length)>0?await this.handleGraft(t,n.graft):[];if(((p=n.prune)==null?void 0:p.length)>0&&await this.handlePrune(t,n.prune),((m=n.idontwant)==null?void 0:m.length)>0&&this.handleIdontwant(t,n.idontwant),i.length===0&&s.length===0&&o.length===0)return;const a=this.sendRpc(t,xs(s,{iwant:i,prune:o})),c=(f=i[0])==null?void 0:f.messageIDs;c!=null&&(a?this.gossipTracer.addPromise(t,c):(g=this.metrics)==null||g.iwantPromiseUntracked.inc(1))}acceptFrom(t){if(this.direct.has(t))return!0;const n=Date.now(),i=this.acceptFromWhitelist.get(t);if(i!=null&&i.messagesAccepted<TAe&&i.acceptUntil>=n)return i.messagesAccepted+=1,!0;const s=this.score.score(t);return s>=_Ae?this.acceptFromWhitelist.set(t,{messagesAccepted:0,acceptUntil:n+PAe}):this.acceptFromWhitelist.delete(t),s>=this.opts.scoreThresholds.graylistThreshold}handleIHave(t,n){var h,d,p;if(n.length===0)return[];const i=this.score.score(t);if(i<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",t,i),(h=this.metrics)==null||h.ihaveRcvIgnored.inc({reason:b1.LowScore}),[];const s=(this.peerhave.get(t)??0)+1;if(this.peerhave.set(t,s),s>SAe)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",t,s),(d=this.metrics)==null||d.ihaveRcvIgnored.inc({reason:b1.MaxIhave}),[];const o=this.iasked.get(t)??0;if(o>=Vu)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",t,o),(p=this.metrics)==null||p.ihaveRcvIgnored.inc({reason:b1.MaxIasked}),[];const a=new Map;if(n.forEach(({topicID:m,messageIDs:f})=>{var v;if(m==null||f==null||!this.mesh.has(m))return;let g=0;f.forEach(y=>{const w=this.msgIdToStrFn(y);this.seenCache.has(w)||(a.set(w,y),g++)}),(v=this.metrics)==null||v.onIhaveRcv(m,f.length,g)}),a.size===0)return[];let c=a.size;c+o>Vu&&(c=Vu-o),this.log("IHAVE: Asking for %d out of %d messages from %s",c,a.size,t);let l=Array.from(a.values());return ro(l),l=l.slice(0,c),this.iasked.set(t,o+c),[{messageIDs:l}]}handleIWant(t,n){var c;if(n.length===0)return[];const i=this.score.score(t);if(i<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",t,i),[];const s=new Map,o=new Map;let a=0;return n.forEach(({messageIDs:l})=>{l==null||l.forEach(h=>{const d=this.msgIdToStrFn(h),p=this.mcache.getWithIWantCount(d,t);if(p==null){a++;return}if(o.set(p.msg.topic,1+(o.get(p.msg.topic)??0)),p.count>uAe){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",t,h);return}s.set(d,p.msg)})}),(c=this.metrics)==null||c.onIwantRcv(o,a),s.size===0?(this.log("IWANT: Could not provide any wanted messages to %s",t),[]):(this.log("IWANT: Sending %d messages to %s",s.size,t),Array.from(s.values()))}async handleGraft(t,n){const i=[],s=this.score.score(t),o=Date.now();let a=this.opts.doPX;if(n.forEach(({topicID:l})=>{var p,m;if(l==null)return;const h=this.mesh.get(l);if(h==null){a=!1;return}if(h.has(t))return;const d=(p=this.backoff.get(l))==null?void 0:p.get(t);if(this.direct.has(t))this.log("GRAFT: ignoring request from direct peer %s",t),i.push(l),a=!1;else if(typeof d=="number"&&o<d){this.log("GRAFT: ignoring backed off peer %s",t),this.score.addPenalty(t,1,w1.GraftBackoff),a=!1;const f=d+this.opts.graftFloodThreshold-this.opts.pruneBackoff;o<f&&this.score.addPenalty(t,1,w1.GraftBackoff),this.addBackoff(t,l),i.push(l)}else s<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",t,s,l),i.push(l),a=!1,this.addBackoff(t,l)):h.size>=this.opts.Dhi&&!(this.outbound.get(t)??!1)?(i.push(l),this.addBackoff(t,l)):(this.log("GRAFT: Add mesh link from %s in %s",t,l),this.score.graft(t,l),h.add(t),(m=this.metrics)==null||m.onAddToMesh(l,Sn.Subscribed,1));this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:t,topic:l,direction:"inbound"}})}),i.length===0)return[];const c=!1;return Promise.all(i.map(async l=>this.makePrune(t,l,a,c)))}async handlePrune(t,n){var s;const i=this.score.score(t);for(const{topicID:o,backoff:a,peers:c}of n){if(o==null)continue;const l=this.mesh.get(o);if(l==null)return;this.log("PRUNE: Remove mesh link to %s in %s",t,o),this.score.prune(t,o),l.has(t)&&(l.delete(t),(s=this.metrics)==null||s.onRemoveFromMesh(o,$s.Prune,1)),typeof a=="number"&&a>0?this.doAddBackoff(t,o,a*1e3):this.addBackoff(t,o),c!=null&&c.length>0&&(i<this.opts.scoreThresholds.acceptPXThreshold?this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",t,i,o):await this.pxConnect(c)),this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:t,topic:o,direction:"inbound"}})}}handleIdontwant(t,n){var l;let i=this.idontwantCounts.get(t)??0;if(i>=this.opts.idontwantMaxMessages)return;const s=i;let o=this.idontwants.get(t);o==null&&(o=new Map,this.idontwants.set(t,o));let a=0;e:for(const{messageIDs:h}of n)for(const d of h){if(i>=this.opts.idontwantMaxMessages)break e;i++;const p=this.msgIdToStrFn(d);o.set(p,this.heartbeatTicks),this.mcache.msgs.has(p)||a++}this.idontwantCounts.set(t,i);const c=i-s;(l=this.metrics)==null||l.onIdontwantRcv(c,a)}addBackoff(t,n){this.doAddBackoff(t,n,this.opts.pruneBackoff)}doAddBackoff(t,n,i){let s=this.backoff.get(n);s==null&&(s=new Map,this.backoff.set(n,s));const o=Date.now()+i;(s.get(t)??0)<o&&s.set(t,o)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((t,n)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",n,t),this.score.addPenalty(n,t,w1.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%yAe!==0)return;const t=Date.now();this.backoff.forEach((n,i)=>{n.forEach((s,o)=>{s+$Ae*this.opts.heartbeatInterval<t&&n.delete(o)}),n.size===0&&this.backoff.delete(i)})}async directConnect(){const t=[];this.direct.forEach(n=>{this.streamsOutbound.has(n)||t.push(n)}),await Promise.all(t.map(async n=>this.connect(n)))}async pxConnect(t){t.length>this.opts.prunePeers&&(ro(t),t=t.slice(0,this.opts.prunePeers));const n=[];await Promise.all(t.map(async i=>{if(i.peerID==null)return;const s=ri(Hj(i.peerID)),o=s.toString();if(!this.peers.has(o)){if(i.signedPeerRecord==null){n.push(o);return}try{if(!await this.components.peerStore.consumePeerRecord(i.signedPeerRecord,s)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}n.push(o)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),n.length!==0&&await Promise.all(n.map(async i=>this.connect(i)))}async connect(t){var s;this.log("Initiating connection with %s",t);const n=Wt(t),i=await this.components.connectionManager.openConnection(n);for(const o of this.multicodecs)for(const a of this.components.registrar.getTopologies(o))(s=a.onConnect)==null||s.call(a,n,i)}subscribe(t){if(this.status.code!==Un.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(t)){this.subscriptions.add(t);for(const n of this.peers.keys())this.sendSubscriptions(n,[t],!0)}this.join(t)}unsubscribe(t){if(this.status.code!==Un.started)throw new Error("Pubsub is not started");const n=this.subscriptions.delete(t);if(this.log("unsubscribe from %s - am subscribed %s",t,n),n)for(const i of this.peers.keys())this.sendSubscriptions(i,[t],!1);this.leave(t)}join(t){var o,a,c;if(this.status.code!==Un.started)throw new Error("Gossipsub has not started");if(this.mesh.has(t))return;this.log("JOIN %s",t),(o=this.metrics)==null||o.onJoin(t);const n=new Set,i=this.backoff.get(t),s=this.fanout.get(t);if(s!=null&&(this.fanout.delete(t),this.fanoutLastpub.delete(t),s.forEach(l=>{!this.direct.has(l)&&this.score.score(l)>=0&&(i==null?void 0:i.has(l))!==!0&&n.add(l)}),(a=this.metrics)==null||a.onAddToMesh(t,Sn.Fanout,n.size)),n.size<this.opts.D){const l=n.size;this.getRandomGossipPeers(t,this.opts.D,d=>!n.has(d)&&!this.direct.has(d)&&this.score.score(d)>=0&&(i==null?void 0:i.has(d))!==!0).forEach(d=>{n.add(d)}),(c=this.metrics)==null||c.onAddToMesh(t,Sn.Random,n.size-l)}this.mesh.set(t,n),n.forEach(l=>{this.log("JOIN: Add mesh link to %s in %s",l,t),this.sendGraft(l,t)})}leave(t){var i;if(this.status.code!==Un.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",t),(i=this.metrics)==null||i.onLeave(t);const n=this.mesh.get(t);n!=null&&(Promise.all(Array.from(n).map(async s=>{this.log("LEAVE: Remove mesh link to %s in %s",s,t),await this.sendPrune(s,t)})).catch(s=>{this.log("Error sending prunes to mesh peers",s)}),this.mesh.delete(t))}selectPeersToForward(t,n,i){const s=new Set,o=this.topics.get(t);o!=null&&(this.direct.forEach(c=>{o.has(c)&&n!==c&&!((i==null?void 0:i.has(c))??!1)&&s.add(c)}),this.floodsubPeers.forEach(c=>{o.has(c)&&n!==c&&!((i==null?void 0:i.has(c))??!1)&&this.score.score(c)>=this.opts.scoreThresholds.publishThreshold&&s.add(c)}));const a=this.mesh.get(t);return a!=null&&a.size>0&&a.forEach(c=>{n!==c&&!((i==null?void 0:i.has(c))??!1)&&s.add(c)}),s}selectPeersToPublish(t){const n=new Set,i={direct:0,floodsub:0,mesh:0,fanout:0},s=this.topics.get(t);if(s!=null)if(this.opts.floodPublish)s.forEach(o=>{this.direct.has(o)?(n.add(o),i.direct++):this.score.score(o)>=this.opts.scoreThresholds.publishThreshold&&(n.add(o),i.floodsub++)});else{this.direct.forEach(a=>{s.has(a)&&(n.add(a),i.direct++)}),this.floodsubPeers.forEach(a=>{s.has(a)&&this.score.score(a)>=this.opts.scoreThresholds.publishThreshold&&(n.add(a),i.floodsub++)});const o=this.mesh.get(t);if(o!=null&&o.size>0)o.forEach(a=>{n.add(a),i.mesh++}),o.size<this.opts.D&&this.getRandomGossipPeers(t,this.opts.D-o.size,c=>!o.has(c)&&!this.direct.has(c)&&!this.floodsubPeers.has(c)&&this.score.score(c)>=this.opts.scoreThresholds.publishThreshold).forEach(c=>{n.add(c),i.mesh++});else{const a=this.fanout.get(t);if(a!=null&&a.size>0)a.forEach(c=>{n.add(c),i.fanout++});else{const c=this.getRandomGossipPeers(t,this.opts.D,l=>this.score.score(l)>=this.opts.scoreThresholds.publishThreshold);c.size>0&&(this.fanout.set(t,c),c.forEach(l=>{n.add(l),i.fanout++}))}this.fanoutLastpub.set(t,Date.now())}}return{tosend:n,tosendCount:i}}forwardMessage(t,n,i,s){var a;i!=null&&this.score.deliverMessage(i,t,n.topic);const o=this.selectPeersToForward(n.topic,i,s);o.forEach(c=>{this.sendRpc(c,xs([n]))}),(a=this.metrics)==null||a.onForwardMsg(n.topic,o.size)}async publish(t,n,i){var b,E;const s=Date.now(),o=this.dataTransform!=null?this.dataTransform.outboundTransform(t,n):n;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");const{raw:a,msg:c}=await iCe(this.publishConfig,t,n,o),l=await this.msgIdFn(c),h=this.msgIdToStrFn(l),d=(i==null?void 0:i.ignoreDuplicatePublishError)??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(h)){if(d)return(b=this.metrics)==null||b.onPublishDuplicateMsg(t),{recipients:[]};throw Error("PublishError.Duplicate")}const{tosend:p,tosendCount:m}=this.selectPeersToPublish(t),f=this.opts.emitSelf&&this.subscriptions.has(t),g=(i==null?void 0:i.allowPublishToZeroTopicPeers)??this.opts.allowPublishToZeroTopicPeers;if(p.size===0&&!g&&!f)throw Error("PublishError.NoPeersSubscribedToTopic");this.seenCache.put(h),this.mcache.put({msgId:l,msgIdStr:h},a,!0),this.publishedMessageIds.put(h);const v=(i==null?void 0:i.batchPublish)??this.opts.batchPublish,y=xs([a]);if(v)this.sendRpcInBatch(p,y);else for(const C of p)this.sendRpc(C,y)||p.delete(C);const w=Date.now()-s;return(E=this.metrics)==null||E.onPublishMsg(t,m,p.size,a.data!=null?a.data.length:0,w),f&&(p.add(this.components.peerId.toString()),super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:h,msg:c}})),super.dispatchEvent(new CustomEvent("message",{detail:c}))),{recipients:Array.from(p.values()).map(C=>this.peers.get(C)??Wt(C))}}sendRpcInBatch(t,n){var o;const i=Ml.encode(n),s=PA.single(i);for(const a of t){const c=this.streamsOutbound.get(a);if(c==null){this.log(`Cannot send RPC to ${a} as there is no open stream to it available`),t.delete(a);continue}try{c.pushPrefixed(s)}catch(l){t.delete(a),this.log.error(`Cannot send rpc to ${a}`,l)}(o=this.metrics)==null||o.onRpcSent(n,i.length)}}reportMessageValidationResult(t,n,i){var a;let s;if(i===Ei.Accept){if(s=this.mcache.validate(t),s!=null){const{message:c,originatingPeers:l}=s;this.score.deliverMessage(n,t,c.topic),this.forwardMessage(t,s.message,n,l)}}else if(s=this.mcache.remove(t),s!=null){const c=j$(i),{message:l,originatingPeers:h}=s;this.score.rejectMessage(n,t,l.topic,c);for(const d of h)this.score.rejectMessage(d,t,l.topic,c)}const o=this.score.messageFirstSeenTimestampMs(t);(a=this.metrics)==null||a.onReportValidation(s,i,o)}sendGraft(t,n){const s=xs([],{graft:[{topicID:n}]});this.sendRpc(t,s)}async sendPrune(t,n){const s=[await this.makePrune(t,n,this.opts.doPX,!0)],o=xs([],{prune:s});this.sendRpc(t,o)}sendIDontWants(t,n,i){var c;const s=this.mesh.get(n);if(s==null)return;const o=new Set(s);o.delete(i);for(const l of o)((c=this.streamsOutbound.get(l))==null?void 0:c.protocol)!==Y5&&o.delete(l);const a=xs([],{idontwant:[{messageIDs:[t]}]});this.sendRpcInBatch(o,a)}sendRpc(t,n){var c,l,h,d,p;const i=this.streamsOutbound.get(t);if(i==null)return this.log(`Cannot send RPC to ${t} as there is no open stream to it available`),!1;const s=this.control.get(t);s!=null&&(this.piggybackControl(t,n,s),this.control.delete(t));const o=this.gossip.get(t);o!=null&&(this.piggybackGossip(t,n,o),this.gossip.delete(t));const a=Ml.encode(n);try{i.push(a)}catch(m){return this.log.error(`Cannot send rpc to ${t}`,m),s!=null&&this.control.set(t,s),o!=null&&this.gossip.set(t,o),!1}if((c=this.metrics)==null||c.onRpcSent(n,a.length),((l=n.control)==null?void 0:l.graft)!=null)for(const m of(h=n.control)==null?void 0:h.graft)m.topicID!=null&&this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:t,topic:m.topicID,direction:"outbound"}});if(((d=n.control)==null?void 0:d.prune)!=null)for(const m of(p=n.control)==null?void 0:p.prune)m.topicID!=null&&this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:t,topic:m.topicID,direction:"outbound"}});return!0}piggybackControl(t,n,i){var o,a;const s=W$(n);for(const c of i.graft)c.topicID!=null&&(((o=this.mesh.get(c.topicID))==null?void 0:o.has(t))??!1)&&s.control.graft.push(c);for(const c of i.prune)c.topicID!=null&&!(((a=this.mesh.get(c.topicID))==null?void 0:a.has(t))??!1)&&s.control.prune.push(c)}piggybackGossip(t,n,i){const s=W$(n);s.control.ihave=i}async sendGraftPrune(t,n,i){const s=this.opts.doPX,o=!1;for(const[a,c]of t){const l=c.map(p=>({topicID:p}));let h=[];const d=n.get(a);d!=null&&(h=await Promise.all(d.map(async p=>this.makePrune(a,p,s&&!(i.get(a)??!1),o))),n.delete(a)),this.sendRpc(a,xs([],{graft:l,prune:h}))}for(const[a,c]of n){const l=await Promise.all(c.map(async h=>this.makePrune(a,h,s&&!(i.get(a)??!1),o)));this.sendRpc(a,xs([],{prune:l}))}}emitGossip(t){const n=this.mcache.getGossipIDs(new Set(t.keys()));for(const[i,s]of t)this.doEmitGossip(i,s,n.get(i)??[])}doEmitGossip(t,n,i){if(i.length===0||(ro(i),i.length>Vu&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",i.length),n.size===0))return;let s=this.opts.Dlazy;const a=this.opts.gossipFactor*n.size;let c=n;a>s&&(s=a),s>c.size?s=c.size:c=ro(Array.from(c)).slice(0,s),c.forEach(l=>{let h=i;i.length>Vu&&(h=ro(h.slice()).slice(0,Vu)),this.pushGossip(l,{topicID:t,messageIDs:h})})}flush(){for(const[t,n]of this.gossip.entries())this.gossip.delete(t),this.sendRpc(t,xs([],{ihave:n}));for(const[t,n]of this.control.entries()){this.control.delete(t);const i=xs([],{graft:n.graft,prune:n.prune});this.sendRpc(t,i)}}pushGossip(t,n){this.log("Add gossip to %s",t);const i=this.gossip.get(t)??[];this.gossip.set(t,i.concat(n))}async makePrune(t,n,i,s){var h;if(this.score.prune(t,n),((h=this.streamsOutbound.get(t))==null?void 0:h.protocol)===V$)return{topicID:n,peers:[]};const o=s?this.opts.unsubcribeBackoff:this.opts.pruneBackoff,a=o/1e3;if(this.doAddBackoff(t,n,o),!i)return{topicID:n,peers:[],backoff:a};const c=this.getRandomGossipPeers(n,this.opts.prunePeers,d=>d!==t&&this.score.score(d)>=0),l=await Promise.all(Array.from(c).map(async d=>{const p=this.peers.get(d)??Wt(d);let m;try{m=await this.components.peerStore.get(p)}catch(f){if(f.name!=="NotFoundError")throw f}return{peerID:p.toMultihash().bytes,signedPeerRecord:m==null?void 0:m.peerRecordEnvelope}}));return{topicID:n,peers:l,backoff:a}}async heartbeat(){var g,v;const{D:t,Dlo:n,Dhi:i,Dscore:s,Dout:o,fanoutTTL:a}=this.opts;this.heartbeatTicks++;const c=new Map,l=y=>{let w=c.get(y);return w===void 0&&(w=this.score.score(y),c.set(y,w)),w},h=new Map,d=new Map,p=new Map;this.clearBackoff(),this.peerhave.clear(),(g=this.metrics)==null||g.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.idontwantCounts.clear();for(const y of this.idontwants.values())for(const[w,b]of y)this.heartbeatTicks-b>=this.opts.mcacheLength&&y.delete(w);this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),(v=this.fastMsgIdCache)==null||v.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const m=new Map;this.mesh.forEach((y,w)=>{const b=this.topics.get(w),E=new Set,C=new Set;if(m.set(w,C),b!=null){const I=ro(Array.from(b)),T=this.backoff.get(w);for(const L of I){const V=this.streamsOutbound.get(L);if(V!=null&&this.multicodecs.includes(V.protocol)&&!y.has(L)&&!this.direct.has(L)){const U=l(L);(T==null?void 0:T.has(L))!==!0&&U>=0&&E.add(L),U>=this.opts.scoreThresholds.gossipThreshold&&C.add(L)}}}const k=(I,T)=>{var V;this.log("HEARTBEAT: Remove mesh link to %s in %s",I,w),this.addBackoff(I,w),y.delete(I),l(I)>=this.opts.scoreThresholds.gossipThreshold&&C.add(I),(V=this.metrics)==null||V.onRemoveFromMesh(w,T,1);const L=d.get(I);L==null?d.set(I,[w]):L.push(w)},x=(I,T)=>{var V;this.log("HEARTBEAT: Add mesh link to %s in %s",I,w),this.score.graft(I,w),y.add(I),C.delete(I),(V=this.metrics)==null||V.onAddToMesh(w,T,1);const L=h.get(I);L==null?h.set(I,[w]):L.push(w)};if(y.forEach(I=>{const T=l(I);T<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",I,T,w),k(I,$s.BadScore),p.set(I,!0))}),y.size<n){const I=t-y.size;qAe(E,I).forEach(L=>{x(L,Sn.NotEnough)})}if(y.size>i){let I=Array.from(y);I.sort((L,V)=>l(V)-l(L)),I=I.slice(0,s).concat(ro(I.slice(s)));let T=0;if(I.slice(0,t).forEach(L=>{(this.outbound.get(L)??!1)&&T++}),T<o){const L=U=>{const G=I[U];for(let K=U;K>0;K--)I[K]=I[K-1];I[0]=G};if(T>0){let U=T;for(let G=1;G<t&&U>0;G++)(this.outbound.get(I[G])??!1)&&(L(G),U--)}let V=t-T;for(let U=t;U<I.length&&V>0;U++)(this.outbound.get(I[U])??!1)&&(L(U),V--)}I.slice(t).forEach(L=>{k(L,$s.Excess)})}if(y.size>=n){let I=0;if(y.forEach(T=>{(this.outbound.get(T)??!1)&&I++}),I<o){const T=o-I;_9(E,T,V=>this.outbound.get(V)===!0).forEach(V=>{x(V,Sn.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&y.size>1){const I=Array.from(y).sort((V,U)=>l(V)-l(U)),T=Math.floor(y.size/2),L=l(I[T]);if(L<this.opts.scoreThresholds.opportunisticGraftThreshold){const V=this.opts.opportunisticGraftPeers,U=_9(E,V,G=>l(G)>L);for(const G of U)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",G,w),x(G,Sn.Opportunistic)}}});const f=Date.now();this.fanoutLastpub.forEach((y,w)=>{y+a<f&&(this.fanout.delete(w),this.fanoutLastpub.delete(w))}),this.fanout.forEach((y,w)=>{const b=this.topics.get(w);y.forEach(x=>{(!((b==null?void 0:b.has(x))??!1)||l(x)<this.opts.scoreThresholds.publishThreshold)&&y.delete(x)});const E=this.topics.get(w),C=[],k=new Set;if(m.set(w,k),E!=null){const x=ro(Array.from(E));for(const I of x){const T=this.streamsOutbound.get(I);if(T!=null&&this.multicodecs.includes(T.protocol)&&!y.has(I)&&!this.direct.has(I)){const L=l(I);L>=this.opts.scoreThresholds.publishThreshold&&C.push(I),L>=this.opts.scoreThresholds.gossipThreshold&&k.add(I)}}}if(y.size<t){const x=t-y.size;C.slice(0,x).forEach(I=>{y.add(I),k==null||k.delete(I)})}}),this.emitGossip(m),await this.sendGraftPrune(h,d,p),this.flush(),this.mcache.shift(),this.dispatchEvent(new CustomEvent("gossipsub:heartbeat"))}getRandomGossipPeers(t,n,i=()=>!0){const s=this.topics.get(t);if(s==null)return new Set;let o=[];return s.forEach(a=>{const c=this.streamsOutbound.get(a);c!=null&&this.multicodecs.includes(c.protocol)&&i(a)&&o.push(a)}),o=ro(o),n>0&&o.length>n&&(o=o.slice(0,n)),new Set(o)}onScrapeMetrics(t){var l,h;t.mcacheSize.set(this.mcache.size),t.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),t.cacheSize.set({cache:"direct"},this.direct.size),t.cacheSize.set({cache:"seenCache"},this.seenCache.size),t.cacheSize.set({cache:"fastMsgIdCache"},((l=this.fastMsgIdCache)==null?void 0:l.size)??0),t.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),t.cacheSize.set({cache:"mcache"},this.mcache.size),t.cacheSize.set({cache:"score"},this.score.size),t.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),t.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),t.cacheSize.set({cache:"topics"},this.topics.size),t.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),t.cacheSize.set({cache:"mesh"},this.mesh.size),t.cacheSize.set({cache:"fanout"},this.fanout.size),t.cacheSize.set({cache:"peers"},this.peers.size),t.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),t.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),t.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),t.cacheSize.set({cache:"gossip"},this.gossip.size),t.cacheSize.set({cache:"control"},this.control.size),t.cacheSize.set({cache:"peerhave"},this.peerhave.size),t.cacheSize.set({cache:"outbound"},this.outbound.size);let n=0;const i=Date.now();t.connectedPeersBackoffSec.reset();for(const d of this.backoff.values()){n+=d.size;for(const[p,m]of d.entries())this.peers.has(p)&&t.connectedPeersBackoffSec.observe(Math.max(0,m-i)/1e3)}t.cacheSize.set({cache:"backoff"},n);let s=0;for(const d of this.idontwants.values())s+=d.size;t.cacheSize.set({cache:"idontwants"},s);for(const[d,p]of this.topics)t.topicPeersCount.set({topicStr:d},p.size);for(const[d,p]of this.mesh)t.meshPeerCounts.set({topicStr:d},p.size);const o=[],a=new Map;t.behaviourPenalty.reset();for(const d of this.peers.keys()){const p=this.score.score(d);o.push(p),a.set(d,p),t.behaviourPenalty.observe(((h=this.score.peerStats.get(d))==null?void 0:h.behaviourPenalty)??0)}t.registerScores(o,this.opts.scoreThresholds),t.registerScorePerMesh(this.mesh,a);const c=eCe(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,t.topicStrToLabel);t.registerScoreWeights(c)}}u(Wj,"multicodec",Y5);function yCe(r={}){return e=>new Wj(e,r)}const mCe=()=>{const[r,e]=Ma.useState(""),[t,n]=Ma.useState([]),[i,s]=Ma.useState(null),[o,a]=Ma.useState(null);Ma.useEffect(()=>{async function l(){try{console.log("Starting OrbitDB initialization for GitHub Pages");let h;try{h=await Pxe({libp2p:{transports:[wj(),yj(),VV()],transportManager:{faultTolerance:Hh.NO_FATAL},peerDiscovery:[PV({list:["/dns4/bootstrap.libp2p.io/tcp/443/wss/p2p/12D3KooWQL1aS4qD3yCjmV7gNmx4F5gP7pNXG1qimV5DXe7tXUn","/dns4/bootstrap.libp2p.io/tcp/443/wss/p2p/12D3KooWAtfLqN4QmgjrZ9eZ9r4L1B7bH7d9eW8fA4n4bBAyKSm"]})],services:{identify:qV(),pubsub:yCe()}}})}catch(f){throw console.error("Failed to initialize Helia:",f),new Error("IPFS initialization failed")}if(console.log("IPFS initialized:",h),!h)throw new Error("IPFS instance is undefined");const d=await qie({ipfs:h});console.log("OrbitDB instance created:",d);const p=await d.open("citizenx-annotations",{type:"documents"});console.log("Database opened:",p),await p.load(),console.log("Database loaded"),s(p);const m=await p.all();n(m.map(f=>f.value)),p.events.on("update",async()=>{const f=await p.all();n(f.map(g=>g.value)),console.log("GitHub Pages database updated:",f)})}catch(h){console.error("OrbitDB initialization failed:",h),a("Failed to initialize decentralized storage")}}l()},[]);const c=async()=>{if(r.trim()&&i)try{const l={_id:Date.now().toString(),url:"sidepanel",text:r.trim(),timestamp:Date.now()};await i.put(l),e(""),console.log("Saved annotation to OrbitDB:",l)}catch(l){console.error("Failed to save annotation:",l),a("Failed to save annotation")}};return Bn.jsxs("div",{style:{padding:"16px",maxWidth:"300px"},children:[Bn.jsx("h1",{style:{fontSize:"1.5rem",fontWeight:"bold",margin:"0 0 8px 0"},children:"CitizenX Annotations"}),o&&Bn.jsx("p",{style:{color:"red",margin:"0 0 8px 0"},children:o}),Bn.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[Bn.jsx("input",{type:"text",value:r,onChange:l=>e(l.target.value),placeholder:"Enter annotation...",style:{flex:1,padding:"5px",border:"1px solid #ccc",borderRadius:"3px"}}),Bn.jsx("button",{onClick:c,disabled:!i,style:{padding:"5px 10px",background:i?"#007bff":"#ccc",color:"#fff",border:"none",borderRadius:"3px",cursor:i?"pointer":"not-allowed"},children:"Save"})]}),Bn.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:t.length===0?Bn.jsx("p",{style:{margin:0,color:"#666"},children:"No annotations yet."}):Bn.jsx("ul",{style:{margin:0,padding:0,listStyle:"none"},children:t.map(l=>Bn.jsxs("li",{style:{padding:"5px 0",borderBottom:"1px solid #eee",wordBreak:"break-word"},children:[l.text," ",Bn.jsxs("small",{children:["(",new Date(l.timestamp).toLocaleString(),")"]})]},l._id))})})]})};t6.createRoot(document.getElementById("root")).render(Bn.jsx(fq.StrictMode,{children:Bn.jsx(mCe,{})}));
